{"config":{"lang":["en","ko","zh"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>Welcome to the EKS Best Practices Guides.  The primary goal of this project is to offer a set of best practices for day 2 operations for Amazon EKS. We elected to publish this guidance to GitHub so we could iterate quickly, provide timely and effective recommendations for variety of concerns, and easily incorporate suggestions from the broader community.  </p> <p>We currently have published guides for the following topics: </p> <ul> <li>Best Practices for Security</li> <li>Best Practices for Reliability</li> <li>Best Practices for Cluster Autoscaling: karpenter, cluster-autoscaler</li> <li>Best Practices for Running Windows Containers</li> <li>Best Practices for Networking</li> <li>Best Practices for Scalability</li> <li>Best Practices for Cluster Upgrades</li> <li>Best Practices for Cost Optimization</li> </ul> <p>We also open sourced a Python based CLI (Command Line Interface) called hardeneks to check some of the recommendations from this guide.</p> <p>In the future we will be publishing best practices guidance for performance, cost optimization, and operational excellence. </p>"},{"location":"#related-guides","title":"Related guides","text":"<p>In addition to the EKS User Guide, AWS has published several other guides that may help you with your implementation of EKS.</p> <ul> <li>EMR Containers Best Practices Guides</li> <li>Data on EKS</li> <li>AWS Observability Best Practices</li> <li>Amazon EKS Blueprints for Terraform</li> <li>Amazon EKS Blueprints Quick Start</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>We encourage you to contribute to these guides. If you have implemented a practice that has proven to be effective, please share it with us by opening an issue or a pull request. Similarly, if you discover an error or flaw in the guidance we've already published, please submit a PR to correct it. The guidelines for submitting PRs can be found in our Contributing Guidelines.</p>"},{"location":"cluster-autoscaling/","title":"Kubernetes Cluster Autoscaler","text":""},{"location":"cluster-autoscaling/#overview","title":"Overview","text":"<p>The Kubernetes Cluster Autoscaler is a popular Cluster Autoscaling solution maintained by SIG Autoscaling. It is responsible for ensuring that your cluster has enough nodes to schedule your pods without wasting resources. It watches for pods that fail to schedule and for nodes that are underutilized. It then simulates the addition or removal of nodes before applying the change to your cluster. The AWS Cloud Provider implementation within Cluster Autoscaler controls the <code>.DesiredReplicas</code> field of your EC2 Auto Scaling Groups.</p> <p></p> <p>This guide will provide a mental model for configuring the Cluster Autoscaler and choosing the best set of tradeoffs to meet your organization\u2019s requirements. While there is no single best configuration, there are a set of configuration options that enable you to trade off performance, scalability, cost, and availability. Additionally, this guide will provide tips and best practices for optimizing your configuration for AWS.</p>"},{"location":"cluster-autoscaling/#glossary","title":"Glossary","text":"<p>The following terminology will be used frequently throughout this document. These terms can have broad meaning, but are limited to the definitions below for the purposes of this document.</p> <p>Scalability refers to how well the Cluster Autoscaler performs as your Kubernetes Cluster increases in number of pods and nodes. As scalability limits are reached, the Cluster Autoscaler\u2019s performance and functionality degrades. As the Cluster Autoscaler exceeds its scalability limits, it may no longer add or remove nodes in your cluster.</p> <p>Performance refers to how quickly the Cluster Autoscaler is able to make and execute scaling decisions. A perfectly performing Cluster Autoscaler would instantly make a decision and trigger a scaling action in response to stimuli, such as a pod becoming unschedulable.</p> <p>Availability means that pods can be scheduled quickly and without disruption. This includes when newly created pods need to be scheduled and when a scaled down node terminates any remaining pods scheduled to it.</p> <p>Cost is determined by the decision behind scale out and scale in events. Resources are wasted if an existing node is underutilized or a new node is added that is too large for incoming pods. Depending on the use case, there can be costs associated with prematurely terminating pods due to an aggressive scale down decision.</p> <p>Node Groups are an abstract Kubernetes concept for a group of nodes within a cluster.  It is not a true Kubernetes resource, but exists as an abstraction in the Cluster Autoscaler, Cluster API, and other components. Nodes within a Node Group share properties like labels and taints, but may consist of multiple Availability Zones or Instance Types.</p> <p>EC2 Auto Scaling Groups can be used as an implementation of Node Groups on EC2. EC2 Auto Scaling Groups are configured to launch instances that automatically join their Kubernetes Clusters and apply labels and taints to their corresponding Node resource in the Kubernetes API.</p> <p>EC2 Managed Node Groups are another implementation of Node Groups on EC2. They abstract away the complexity manually configuring EC2 Autoscaling Scaling Groups and provide additional management features like node version upgrade and graceful node termination.</p>"},{"location":"cluster-autoscaling/#operating-the-cluster-autoscaler","title":"Operating the Cluster Autoscaler","text":"<p>The Cluster Autoscaler is typically installed as a Deployment in your cluster. It uses leader election to ensure high availability, but work is done by a single replica at a time. It is not horizontally scalable. For basic setups, the default it should work out of the box using the provided installation instructions, but there are a few things to keep in mind.</p> <p>Ensure that:</p> <ul> <li>The Cluster Autoscaler\u2019s version matches the Cluster\u2019s Version. Cross version compatibility  is not tested or supported.</li> <li>Auto Discovery is enabled, unless you have specific advanced use cases that prevent use of this mode.</li> </ul>"},{"location":"cluster-autoscaling/#employ-least-privileged-access-to-the-iam-role","title":"Employ least privileged access to the IAM role","text":"<p>When the Auto Discovery is used, we strongly recommend that you employ least privilege access by limiting Actions <code>autoscaling:SetDesiredCapacity</code> and <code>autoscaling:TerminateInstanceInAutoScalingGroup</code> to the Auto Scaling groups that are scoped to the current cluster.</p> <p>This will prevents a Cluster Autoscaler running in one cluster from modifying nodegroups in a different cluster even if the <code>--node-group-auto-discovery</code> argument wasn't scoped down to the nodegroups of the cluster using tags (for example <code>k8s.io/cluster-autoscaler/&lt;cluster-name&gt;</code>).</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"autoscaling:SetDesiredCapacity\",\n                \"autoscaling:TerminateInstanceInAutoScalingGroup\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:ResourceTag/k8s.io/cluster-autoscaler/enabled\": \"true\",\n                    \"aws:ResourceTag/k8s.io/cluster-autoscaler/&lt;my-cluster&gt;\": \"owned\"\n                }\n            }\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"autoscaling:DescribeAutoScalingGroups\",\n                \"autoscaling:DescribeAutoScalingInstances\",\n                \"autoscaling:DescribeLaunchConfigurations\",\n                \"autoscaling:DescribeScalingActivities\",\n                \"autoscaling:DescribeTags\",\n                \"ec2:DescribeImages\",\n                \"ec2:DescribeInstanceTypes\",\n                \"ec2:DescribeLaunchTemplateVersions\",\n                \"ec2:GetInstanceTypesFromInstanceRequirements\",\n                \"eks:DescribeNodegroup\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n</code></pre>"},{"location":"cluster-autoscaling/#configuring-your-node-groups","title":"Configuring your Node Groups","text":"<p>Effective autoscaling starts with correctly configuring a set of Node Groups for your cluster. Selecting the right set of Node Groups is key to maximizing availability and reducing cost across your workloads. AWS implements Node Groups using EC2 Auto Scaling Groups, which are flexible to a large number of use cases. However, the Cluster Autoscaler makes some assumptions about your Node Groups. Keeping your EC2 Auto Scaling Group configurations consistent with these assumptions will minimize undesired behavior.</p> <p>Ensure that:</p> <ul> <li>Each Node in a Node Group has identical scheduling properties, such as Labels, Taints, and Resources.</li> <li>For MixedInstancePolicies, the Instance Types must be of the same shape for CPU, Memory, and GPU</li> <li>The first Instance Type specified in the policy will be used to simulate scheduling.</li> <li>If your policy has additional Instance Types with more resources, resources may be wasted after scale out.</li> <li>If your policy has additional Instance Types with less resources, pods may fail to schedule on the instances.</li> <li>Node Groups with many nodes are preferred over many Node Groups with fewer nodes. This will have the biggest impact on scalability.</li> <li>Wherever possible, prefer EC2 features when both systems provide support (e.g. Regions, MixedInstancePolicy)</li> </ul> <p>Note: We recommend using EKS Managed Node Groups. Managed Node Groups come with powerful management features, including features for Cluster Autoscaler like automatic EC2 Auto Scaling Group discovery and graceful node termination.</p>"},{"location":"cluster-autoscaling/#optimizing-for-performance-and-scalability","title":"Optimizing for Performance and Scalability","text":"<p>Understanding the autoscaling algorithm\u2019s runtime complexity will help you tune the Cluster Autoscaler to continue operating smoothly in large clusters with greater than 1,000 nodes.</p> <p>The primary knobs for tuning scalability of the Cluster Autoscaler are the resources provided to the process, the scan interval of the algorithm, and the number of Node Groups in the cluster. There are other factors involved in the true runtime complexity of this algorithm, such as scheduling plugin complexity and number of pods. These are considered to be unconfigurable parameters as they are natural to the cluster\u2019s workload and cannot easily be tuned.</p> <p>The Cluster Autoscaler loads the entire cluster\u2019s state into memory, including Pods, Nodes, and Node Groups. On each scan interval, the algorithm identifies unschedulable pods and simulates scheduling for each Node Group. Tuning these factors come with different tradeoffs which should be carefully considered for your use case.</p>"},{"location":"cluster-autoscaling/#vertically-autoscaling-the-cluster-autoscaler","title":"Vertically Autoscaling the Cluster Autoscaler","text":"<p>The simplest way to scale the Cluster Autoscaler to larger clusters is to increase the resource requests for its deployment. Both memory and CPU should be increased for large clusters, though this varies significantly with cluster size. The autoscaling algorithm stores all pods and nodes in memory, which can result in a memory footprint larger than a gigabyte in some cases. Increasing resources is typically done manually. If you find that constant resource tuning is creating an operational burden, consider using the Addon Resizer or Vertical Pod Autoscaler.</p>"},{"location":"cluster-autoscaling/#reducing-the-number-of-node-groups","title":"Reducing the number of Node Groups","text":"<p>Minimizing the number of node groups is one way to ensure that the Cluster Autoscaler will continue to perform well on large clusters. This may be challenging for some organizations who structure their node groups per team or per application. While this is fully supported by the Kubernetes API, this is considered to be a Cluster Autoscaler anti-pattern with repercussions for scalability. There are many reasons to use multiple node groups (e.g. Spot or GPUs), but in many cases there are alternative designs that achieve the same effect while using a small number of groups.</p> <p>Ensure that:</p> <ul> <li>Pod isolation is done using Namespaces rather than Node Groups.</li> <li>This may not be possible in low-trust multi-tenant clusters.</li> <li>Pod ResourceRequests and ResourceLimits are properly set to avoid resource contention.</li> <li>Larger instance types will result in more optimal bin packing and reduced system pod overhead.</li> <li>NodeTaints or NodeSelectors are used to schedule pods as the exception, not as the rule.</li> <li>Regional resources are defined as a single EC2 Auto Scaling Group with multiple Availability Zones.</li> </ul>"},{"location":"cluster-autoscaling/#reducing-the-scan-interval","title":"Reducing the Scan Interval","text":"<p>A low scan interval (e.g. 10 seconds) will ensure that the Cluster Autoscaler responds as quickly as possible when pods become unschedulable. However, each scan results in many API calls to the Kubernetes API and EC2 Auto Scaling Group or EKS Managed Node Group APIs. These API calls can result in rate limiting or even service unavailability for your Kubernetes Control Plane.</p> <p>The default scan interval is 10 seconds, but on AWS, launching a node takes significantly longer to launch a new instance. This means that it\u2019s possible to increase the interval without significantly increasing overall scale up time. For example, if it takes 2 minutes to launch a node, changing the interval to 1 minute will result a tradeoff of 6x reduced API calls for 38% slower scale ups.</p>"},{"location":"cluster-autoscaling/#sharding-across-node-groups","title":"Sharding Across Node Groups","text":"<p>The Cluster Autoscaler can be configured to operate on a specific set of Node Groups. Using this functionality, it\u2019s possible to deploy multiple instances of the Cluster Autoscaler, each configured to operate on a different set of Node Groups. This strategy enables you use arbitrarily large numbers of Node Groups, trading cost for scalability. We only recommend using this as a last resort for improving performance.</p> <p>The Cluster Autoscaler was not originally designed for this configuration, so there are some side effects. Since the shards do not communicate, it\u2019s possible for multiple autoscalers to attempt to schedule an unschedulable pod. This can result in unnecessary scale out of multiple Node Groups. These extra nodes will scale back in after the <code>scale-down-delay</code>.</p> <pre><code>metadata:\n  name: cluster-autoscaler\n  namespace: cluster-autoscaler-1\n\n...\n\n--nodes=1:10:k8s-worker-asg-1\n--nodes=1:10:k8s-worker-asg-2\n\n---\n\nmetadata:\n  name: cluster-autoscaler\n  namespace: cluster-autoscaler-2\n\n...\n\n--nodes=1:10:k8s-worker-asg-3\n--nodes=1:10:k8s-worker-asg-4\n</code></pre> <p>Ensure that:</p> <ul> <li>Each shard is configured to point to a unique set of EC2 Auto Scaling Groups</li> <li>Each shard is deployed to a separate namespace to avoid leader election conflicts</li> </ul>"},{"location":"cluster-autoscaling/#optimizing-for-cost-and-availability","title":"Optimizing for Cost and Availability","text":""},{"location":"cluster-autoscaling/#spot-instances","title":"Spot Instances","text":"<p>You can use Spot Instances in your node groups and save up to 90% off the on-demand price, with the trade-off the Spot Instances can be interrupted at any time when EC2 needs the capacity back. Insufficient Capacity Errors will occur when your EC2 Auto Scaling group cannot scale up due to lack of available capacity. Maximizing diversity by selecting many instance families can increase your chance of achieving your desired scale by tapping into many Spot capacity pools, and decrease the impact of Spot Instance interruptions on your cluster availability. Mixed Instance Policies with Spot Instances are a great way to increase diversity without increasing the number of node groups. Keep in mind, if you need guaranteed resources, use On-Demand Instances instead of Spot Instances.</p> <p>It\u2019s critical that all Instance Types have similar resource capacity when configuring Mixed Instance Policies. The autoscaler\u2019s scheduling simulator uses the first InstanceType in the MixedInstancePolicy. If subsequent Instance Types are larger, resources may be wasted after a scale up. If smaller, your pods may fail to schedule on the new instances due to insufficient capacity. For example, M4, M5, M5a, and M5n instances all have similar amounts of CPU and Memory and are great candidates for a MixedInstancePolicy. The EC2 Instance Selector tool can help you identify similar instance types.</p> <p></p> <p>It's recommended to isolate On-Demand and Spot capacity into separate EC2 Auto Scaling groups. This is preferred over using a base capacity strategy because the scheduling properties are fundamentally different. Since Spot Instances be interrupted at any time (when EC2 needs the capacity back), users will often taint their preemptable nodes, requiring an explicit pod toleration to the preemption behavior. These taints result in different scheduling properties for the nodes, so they should be separated into multiple EC2 Auto Scaling Groups.</p> <p>The Cluster Autoscaler has a concept of Expanders, which provide different strategies for selecting which Node Group to scale. The strategy <code>--expander=least-waste</code> is a good general purpose default, and if you're going to use multiple node groups for Spot Instance diversification (as described in the image above), it could help further cost-optimize the node groups by scaling the group which would be best utilized after the scaling activity.</p>"},{"location":"cluster-autoscaling/#prioritizing-a-node-group-asg","title":"Prioritizing a node group / ASG","text":"<p>You may also configure priority based autoscaling by using the Priority expander. <code>--expander=priority</code> enables your cluster to prioritize a node group / ASG, and if it is unable to scale for any reason, it will choose the next node group in the prioritized list. This is useful in situations where, for example, you want to use P3 instance types because their GPU provides optimal performance for your workload, but as a second option you can also use P2 instance types.</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cluster-autoscaler-priority-expander\n  namespace: kube-system\ndata:\n  priorities: |-\n    10:\n      - .*p2-node-group.*\n    50:\n      - .*p3-node-group.*\n</code></pre> <p>Cluster Autoscaler will try to scale up the EC2 Auto Scaling group matching the name p3-node-group. If this operation does not succeed within <code>--max-node-provision-time</code>, it will attempt to scale an EC2 Auto Scaling group matching the name p2-node-group. This value defaults to 15 minutes and can be reduced for more responsive node group selection, though if the value is too low, it can cause unnecessary scale outs.</p>"},{"location":"cluster-autoscaling/#overprovisioning","title":"Overprovisioning","text":"<p>The Cluster Autoscaler minimizes costs by ensuring that nodes are only added to the cluster when needed and are removed when unused. This significantly impacts deployment latency because many pods will be forced to wait for a node scale up before they can be scheduled. Nodes can take multiple minutes to become available, which can increase pod scheduling latency by an order of magnitude.</p> <p>This can be mitigated using overprovisioning, which trades cost for scheduling latency. Overprovisioning is implemented using temporary pods with negative priority, which occupy space in the cluster. When newly created pods are unschedulable and have higher priority, the temporary pods will be preempted to make room. The temporary pods then become unschedulable, triggering the Cluster Autoscaler to scale out new overprovisioned nodes.</p> <p>There are other less obvious benefits to overprovisioning. Without overprovisioning, one of the side effects of a highly utilized cluster is that pods will make less optimal scheduling decisions using the <code>preferredDuringSchedulingIgnoredDuringExecution</code> rule of Pod or Node Affinity. A common use case for this is to separate pods for a highly available application across availability zones using AntiAffinity. Overprovisioning can significantly increase the chance that a node of the correct zone is available.</p> <p>The amount of overprovisioned capacity is a careful business decision for your organization. At its core, it\u2019s a tradeoff between performance and cost. One way to make this decision is to determine your average scale up frequency and divide it by the amount of time it takes to scale up a new node. For example, if on average you require a new node every 30 seconds and EC2 takes 30 seconds to provision a new node, a single node of overprovisioning will ensure that there\u2019s always an extra node available, reducing scheduling latency by 30 seconds at the cost of a single additional EC2 Instance. To improve zonal scheduling decisions, overprovision a number of nodes equal to the number of availability zones in your EC2 Auto Scaling Group to ensure that the scheduler can select the best zone for incoming pods.</p>"},{"location":"cluster-autoscaling/#prevent-scale-down-eviction","title":"Prevent Scale Down Eviction","text":"<p>Some workloads are expensive to evict. Big data analysis, machine learning tasks, and test runners will eventually complete, but must be restarted if interrupted. The Cluster Autoscaler will attempt to scale down any node under the scale-down-utilization-threshold, which will interrupt any remaining pods on the node. This can be prevented by ensuring that pods that are expensive to evict are protected by a label recognized by the Cluster Autoscaler.</p> <p>Ensure that:</p> <ul> <li>Expensive to evict pods have the annotation <code>cluster-autoscaler.kubernetes.io/safe-to-evict=false</code></li> </ul>"},{"location":"cluster-autoscaling/#advanced-use-cases","title":"Advanced Use Cases","text":""},{"location":"cluster-autoscaling/#ebs-volumes","title":"EBS Volumes","text":"<p>Persistent storage is critical for building stateful applications, such as database or distributed caches. EBS Volumes enable this use case on Kubernetes, but are limited to a specific zone. These applications can be highly available if sharded across multiple AZs using a separate EBS Volume for each AZ. The Cluster Autoscaler can then balance the scaling of the EC2 Autoscaling Groups.</p> <p>Ensure that:</p> <ul> <li>Node group balancing is enabled by setting <code>balance-similar-node-groups=true</code>.</li> <li>Node Groups are configured with identical settings except for different availability zones and EBS Volumes.</li> </ul>"},{"location":"cluster-autoscaling/#co-scheduling","title":"Co-Scheduling","text":"<p>Machine learning distributed training jobs benefit significantly from the minimized latency of same-zone node configurations. These workloads deploy multiple pods to a specific zone. This can be achieved by setting Pod Affinity for all co-scheduled pods or Node Affinity using <code>topologyKey: failure-domain.beta.kubernetes.io/zone</code>. The Cluster Autoscaler will then scale out a specific zone to match demands. You may wish to allocate multiple EC2 Auto Scaling Groups, one per availability zone to enable failover for the entire co-scheduled workload.</p> <p>Ensure that:</p> <ul> <li>Node group balancing is enabled by setting <code>balance-similar-node-groups=false</code></li> <li>Node Affinity and/or Pod Preemption is used when clusters include both Regional and Zonal Node Groups.</li> <li>Use Node Affinity to force or encourage regional pods to avoid zonal Node Groups, and vice versa.</li> <li>If zonal pods schedule onto regional node groups, this will result in imbalanced capacity for your regional pods.</li> <li>If your zonal workloads can tolerate disruption and relocation, configure Pod Preemption to enable regionally scaled pods to force preemption and rescheduling on a less contested zone.</li> </ul>"},{"location":"cluster-autoscaling/#accelerators","title":"Accelerators","text":"<p>Some clusters take advantage of specialized hardware accelerators such as GPU. When scaling out, the accelerator device plugin can take several minutes to advertise the resource to the cluster. The Cluster Autoscaler has simulated that this node will have the accelerator, but until the accelerator becomes ready and updates the node\u2019s available resources, pending pods can not be scheduled on the node. This can result in repeated unnecessary scale out.</p> <p>Additionally, nodes with accelerators and high CPU or Memory utilization will not be considered for scale down, even if the accelerator is unused. This behavior can be expensive due to the relative cost of accelerators. Instead, the Cluster Autoscaler can apply special rules to consider nodes for scale down if they have unoccupied accelerators.</p> <p>To ensure the correct behavior for these cases, you can configure the kubelet on your accelerator nodes to label the node before it joins the cluster. The Cluster Autoscaler will use this label selector to trigger the accelerator optimized behavior.</p> <p>Ensure that:</p> <ul> <li>The Kubelet for GPU nodes is configured with <code>--node-labels k8s.amazonaws.com/accelerator=$ACCELERATOR_TYPE</code></li> <li>Nodes with Accelerators adhere to the identical scheduling properties rule noted above.</li> </ul>"},{"location":"cluster-autoscaling/#scaling-from-0","title":"Scaling from 0","text":"<p>Cluster Autoscaler is capable of scaling Node Groups to and from zero, which can yield significant cost savings. It detects the CPU, memory, and GPU resources of an Auto Scaling Group by inspecting the InstanceType specified in its LaunchConfiguration or LaunchTemplate. Some pods require additional resources like <code>WindowsENI</code> or <code>PrivateIPv4Address</code> or specific NodeSelectors or Taints which cannot be discovered from the LaunchConfiguration. The Cluster Autoscaler can account for these factors by discovering them from tags on the EC2 Auto Scaling Group. For example:</p> <pre><code>Key: k8s.io/cluster-autoscaler/node-template/resources/$RESOURCE_NAME\nValue: 5\nKey: k8s.io/cluster-autoscaler/node-template/label/$LABEL_KEY\nValue: $LABEL_VALUE\nKey: k8s.io/cluster-autoscaler/node-template/taint/$TAINT_KEY\nValue: NoSchedule\n</code></pre> <p>Note: Keep in mind, when scaling to zero your capacity is returned to EC2 and may be unavailable in the future.</p>"},{"location":"cluster-autoscaling/#additional-parameters","title":"Additional Parameters","text":"<p>There are many configuration options that can be used to tune the behavior and performance of the Cluster Autoscaler. A complete list of parameters is available on GitHub.</p> Parameter Description Default scan-interval How often cluster is reevaluated for scale up or down 10 seconds max-empty-bulk-delete Maximum number of empty nodes that can be deleted at the same time. 10 scale-down-delay-after-add How long after scale up that scale down evaluation resumes 10 minutes scale-down-delay-after-delete How long after node deletion that scale down evaluation resumes, defaults to scan-interval scan-interval scale-down-delay-after-failure How long after scale down failure that scale down evaluation resumes 3 minutes scale-down-unneeded-time How long a node should be unneeded before it is eligible for scale down 10 minutes scale-down-unready-time How long an unready node should be unneeded before it is eligible for scale down 20 minutes scale-down-utilization-threshold Node utilization level, defined as sum of requested resources divided by capacity, below which a node can be considered for scale down 0.5 scale-down-non-empty-candidates-count Maximum number of non empty nodes considered in one iteration as candidates for scale down with drain. Lower value means better CA responsiveness but possible slower scale down latency. Higher value can affect CA performance with big clusters (hundreds of nodes). Set to non positive value to turn this heuristic off - CA will not limit the number of nodes it considers.\u201c 30 scale-down-candidates-pool-ratio A ratio of nodes that are considered as additional non empty candidates for scale down when some candidates from previous iteration are no longer valid. Lower value means better CA responsiveness but possible slower scale down latency. Higher value can affect CA performance with big clusters (hundreds of nodes). Set to 1.0 to turn this heuristics off - CA will take all nodes as additional candidates. 0.1 scale-down-candidates-pool-min-count Minimum number of nodes that are considered as additional non empty candidates for scale down when some candidates from previous iteration are no longer valid. When calculating the pool size for additional candidates we take <code>max(#nodes * scale-down-candidates-pool-ratio, scale-down-candidates-pool-min-count)</code> 50"},{"location":"cluster-autoscaling/#additional-resources","title":"Additional Resources","text":"<p>This page contains a list of Cluster Autoscaler presentations and demos. If you'd like to add a presentation or demo here, please send a pull request.</p> Presentation/Demo Presenters Autoscaling and Cost Optimization on Kubernetes: From 0 to 100 Guy Templeton, Skyscanner &amp; Jiaxin Shan, Amazon SIG-Autoscaling Deep Dive Maciek Pytel &amp; Marcin Wielgus"},{"location":"cluster-autoscaling/#references","title":"References","text":"<ul> <li>https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md</li> <li>https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/aws/README.md</li> <li>https://github.com/aws/amazon-ec2-instance-selector</li> <li>https://github.com/aws/aws-node-termination-handler</li> </ul>"},{"location":"cost_optimization/awareness/","title":"Expenditure awareness","text":"<p>Expenditure awareness is understanding who, where and what is causing expenditures in your EKS cluster. Getting an accurate picture of this data will help raise awareness of your spend and highlight areas to remediate.</p>"},{"location":"cost_optimization/awareness/#recommendations","title":"Recommendations","text":""},{"location":"cost_optimization/awareness/#use-cost-explorer","title":"Use Cost Explorer","text":"<p>AWS Cost Explorer has an easy-to-use interface that lets you visualize, understand, and manage your AWS costs and usage over time. You can analyze cost and usage data, at various levels using the filters available in Cost Explorer.</p>"},{"location":"cost_optimization/awareness/#eks-control-plane-and-eks-fargate-costs","title":"EKS Control Plane and EKS Fargate costs","text":"<p>Using the filters, we can query the costs incurred for the EKS costs at the Control Plane and Fargate Pod as shown in the diagram below:</p> <p></p> <p>Using the filters, we can query the aggregate costs incurred for the Fargate Pods across regions in EKS - which includes both vCPU-Hours per CPU and GB Hrs as shown in the diagram below:</p> <p></p>"},{"location":"cost_optimization/awareness/#tagging-of-resources","title":"Tagging of Resources","text":"<p>Amazon EKS supports adding AWS tags to your Amazon EKS clusters. This makes it easy to control access to the EKS API for managing your clusters. Tags added to an EKS cluster are specific to the AWS EKS cluster resource, they do not propagate to other AWS resources used by the cluster such as EC2 instances or load balancers. Today, cluster tagging is supported for all new and existing EKS clusters via the AWS API, Console, and SDKs.</p> <p>AWS Fargate is a technology that provides on-demand, right-sized compute capacity for containers. Before you can schedule pods on Fargate in your cluster, you must define at least one Fargate profile that specifies which pods should use Fargate when they are launched. </p> <p>Adding and Listing tags to an EKS cluster: <pre><code>$ aws eks tag-resource --resource-arn arn:aws:eks:us-west-2:xxx:cluster/ekscluster1 --tags team=devops,env=staging,bu=cio,costcenter=1234\n$ aws eks list-tags-for-resource --resource-arn arn:aws:eks:us-west-2:xxx:cluster/ekscluster1\n{\n    \"tags\": {\n        \"bu\": \"cio\",\n        \"env\": \"staging\",\n        \"costcenter\": \"1234\",\n        \"team\": \"devops\"\n    }\n}\n</code></pre> After you activate cost allocation tags in the AWS Cost Explorer, AWS uses the cost allocation tags to organize your resource costs on your cost allocation report, to make it easier for you to categorize and track your AWS costs.</p> <p>Tags don't have any semantic meaning to Amazon EKS and are interpreted strictly as a string of characters. For example, you can define a set of tags for your Amazon EKS clusters to help you track each cluster's owner and stack level.</p>"},{"location":"cost_optimization/awareness/#use-aws-trusted-advisor","title":"Use AWS Trusted Advisor","text":"<p>AWS Trusted Advisor offers a rich set of best practice checks and recommendations across five categories: cost optimization; security; fault tolerance; performance; and service limits.</p> <p>For Cost Optimization, Trusted Advisor helps eliminate unused and idle resources and recommends making commitments to reserved capacity. The key action items that will help Amazon EKS will be around low utilsed EC2 instances, unassociated Elastic IP addresses, Idle Load Balancers, underutilized EBS volumes among other things. The complete list of checks are provided at https://aws.amazon.com/premiumsupport/technology/trusted-advisor/best-practice-checklist/. </p> <p>The Trusted Advisor also provides Savings Plans and Reserved Instances recommendations for EC2 instances and Fargate which allows you to commit to a consistent usage amount in exchange for discounted rates. </p> <p>Note</p> <p>that the recommendations from Trusted Advisor are generic recommendations and not specific to EKS. </p>"},{"location":"cost_optimization/awareness/#use-the-kubernetes-dashboard","title":"Use the Kubernetes dashboard","text":"<p>Kubernetes dashboard</p> <p>Kubernetes Dashboard is a general purpose, web-based UI for Kubernetes clusters, which provides information about the Kubernetes cluster including the resource usage at a cluster, node and pod level. The deployment of the Kubernetes dashboard on an Amazon EKS cluster is described in the Amazon EKS documentation. </p> <p>Dashboard provides resource usage breakdowns for each node and pod, as well as detailed metadata about pods, services, Deployments, and other Kubernetes objects. This consolidated information provides visibility into your Kubernetes environment.</p> <p></p> <p>kubectl top and describe commands</p> <p>Viewing resource usage metrics with kubectl top and kubectl describe commands. kubectl top will show current CPU and memory usage for the pods or nodes across your cluster, or for a specific pod or node. The kubectl describe command will give more detailed information about a specific node or a pod. <pre><code>$ kubectl top pods\n$ kubectl top nodes\n$ kubectl top pod pod-name --namespace mynamespace --containers\n</code></pre></p> <p>Using the top command, the output will displays the total amount of CPU (in cores) and memory (in MiB) that the node is using, and the percentages of the node\u2019s allocatable capacity those numbers represent. You can then drill-down to the next level, container level within pods by adding a --containers flag. </p> <pre><code>$ kubectl describe node &lt;node&gt;\n$ kubectl describe pod &lt;pod&gt;\n</code></pre> <p>kubectl describe returns the percent of total available capacity that each resource request or limit represents. </p> <p>kubectl top and describe, track the utilization and availability of critical resources such as CPU, memory, and storage across kubernetes pods, nodes and containers. This awareness will help in understanding resource usage and help in controlling costs. </p>"},{"location":"cost_optimization/awareness/#use-cloudwatch-container-insights","title":"Use CloudWatch Container Insights","text":"<p>Use CloudWatch Container Insights to collect, aggregate, and summarize metrics and logs from your containerized applications and microservices. Container Insights is available for Amazon Elastic Kubernetes Service on EC2, and Kubernetes platforms on Amazon EC2. The metrics include utilization for resources such as CPU, memory, disk, and network. </p> <p>The installation of insights is given in the documentation.</p> <p>CloudWatch creates aggregated metrics at the cluster, node, pod, task, and service level as CloudWatch metrics. </p> <p>The following query shows a list of nodes, sorted by average node CPU utilization <pre><code>STATS avg(node_cpu_utilization) as avg_node_cpu_utilization by NodeName\n| SORT avg_node_cpu_utilization DESC \n</code></pre></p> <p>CPU usage by Container name <pre><code>stats pct(container_cpu_usage_total, 50) as CPUPercMedian by kubernetes.container_name \n| filter Type=\"Container\"\n</code></pre> Disk usage by Container name <pre><code>stats floor(avg(container_filesystem_usage/1024)) as container_filesystem_usage_avg_kb by InstanceId, kubernetes.container_name, device \n| filter Type=\"ContainerFS\" \n| sort container_filesystem_usage_avg_kb desc\n</code></pre></p> <p>More sample queries are given in the Container Insights documention</p> <p>This awareness will help in understanding resource usage and help in controlling costs.</p>"},{"location":"cost_optimization/awareness/#using-kubecost-for-expenditure-awareness-and-guidance","title":"Using KubeCost for expenditure awareness and guidance","text":"<p>Third party tools like kubecost can also be deployed on Amazon EKS to get visibility into cost of running your Kubernetes cluster. Please refer to this AWS blog for tracking costs using Kubecost</p> <p>Deploying kubecost using Helm 3: <pre><code>$ curl -sSL https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash\n$ helm version --short\nv3.2.1+gfe51cd1\n$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/\n$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/c^C\n$ kubectl create namespace kubecost \nnamespace/kubecost created\n$ helm repo add kubecost https://kubecost.github.io/cost-analyzer/ \n\"kubecost\" has been added to your repositories\n\n$ helm install kubecost kubecost/cost-analyzer --namespace kubecost --set kubecostToken=\"aGRoZEBqc2pzLmNvbQ==xm343yadf98\"\nNAME: kubecost\nLAST DEPLOYED: Mon May 18 08:49:05 2020\nNAMESPACE: kubecost\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\n--------------------------------------------------Kubecost has been successfully installed. When pods are Ready, you can enable port-forwarding with the following command:\n\n    kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 9090\n\nNext, navigate to http://localhost:9090 in a web browser.\n$ kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 9090\n\nNote: If you are using Cloud 9 or have a need to forward it to a different port like 8080, issue the following command\n$ kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 8080:9090\n</code></pre> Kube Cost Dashboard - </p>"},{"location":"cost_optimization/awareness/#use-kubernetes-cost-allocation-and-capacity-planning-analytics-tool","title":"Use Kubernetes Cost Allocation and Capacity Planning Analytics Tool","text":"<p>Kubernetes Opex Analytics is a tool to help organizations track the resources being consumed by their Kubernetes clusters to prevent overpaying. To do so it generates, short- (7 days), mid- (14 days) and long-term (12 months) usage reports showing relevant insights on what amount of resources each project is spending over time. </p> <p></p>"},{"location":"cost_optimization/awareness/#magalix-kubeadvisor","title":"Magalix Kubeadvisor","text":"<p>KubeAdvisor continuously scans your Kubernetes clusters and reports how you can fix issues, apply best practices, and optimize your cluster (with recommendations of resources like CPU/Memory around cost-efficiency).</p>"},{"location":"cost_optimization/awareness/#spotio-previously-called-spotinst","title":"Spot.io, previously called Spotinst","text":"<p>Spotinst Ocean is an application scaling service. Similar to Amazon Elastic Compute Cloud (Amazon EC2) Auto Scaling groups, Spotinst Ocean is designed to optimize performance and costs by leveraging Spot Instances combined with On-Demand and Reserved Instances. Using a combination of automated Spot Instance management and the variety of instance sizes, the Ocean cluster autoscaler scales according to the pod resource requirements. Spotinst Ocean also includes a prediction algorithm to predict Spot Instance interruption 15 minutes ahead of time and spin up a new node in a different Spot capacity pool.</p> <p>This is available as an AWS Quickstart developed by Spotinst, Inc. in collaboration with AWS. </p> <p>The EKS workshop also has a module on Optimized Worker Node on Amazon EKS Management with Ocean by Spot.io which includes sections on cost allocation, right sizing and scaling strategies.</p>"},{"location":"cost_optimization/awareness/#yotascale","title":"Yotascale","text":"<p>Yotascale helps with accurately allocating Kubernetes costs. Yotascale Kubernetes Cost Allocation feature utilizes actual cost data, which is inclusive of Reserved Instance discounts and spot instance pricing instead of generic market-rate estimations, to inform the total Kubernetes cost footprint</p> <p>More details can be found at their website.</p>"},{"location":"cost_optimization/awareness/#alcide-advisor","title":"Alcide Advisor","text":"<p>Alcide is an AWS Partner Network (APN) Advanced Technology Partner. Alcide Advisor helps ensure your Amazon EKS cluster, nodes, and pods configuration are tuned to run according to security best practices and internal guidelines. Alcide Advisor is an agentless service for Kubernetes audit and compliance that\u2019s built to ensure a frictionless and secured DevSecOps flow by hardening the development stage before moving to production.</p> <p>More details can be found in this blog post.</p>"},{"location":"cost_optimization/awareness/#other-tools","title":"Other tools","text":""},{"location":"cost_optimization/awareness/#kubernetes-garbage-collection","title":"Kubernetes Garbage Collection","text":"<p>The role of the Kubernetes garbage collector is to delete certain objects that once had an owner, but no longer have an owner.</p>"},{"location":"cost_optimization/awareness/#fargate-count","title":"Fargate count","text":"<p>Fargatecount is an useful tool, which allows AWS customers to track, with a custom CloudWatch metric, the total number of EKS pods that have been deployed on Fargate in a specific region of a specific account. This helps in keeping track of all the Fargate pods running across an EKS cluster.</p>"},{"location":"cost_optimization/awareness/#kubernetes-ops-view","title":"Kubernetes Ops View","text":"<p>Kube Ops View is an useful tool, which provides a common operational picture visually for multiple Kubernetes clusters.</p> <pre><code>git clone https://github.com/hjacobs/kube-ops-view\ncd kube-ops-view\nkubectl apply -k deploy/\n</code></pre> <p></p>"},{"location":"cost_optimization/awareness/#popeye-a-kubernetes-cluster-sanitizer","title":"Popeye - A Kubernetes Cluster Sanitizer","text":"<p>Popeye - A Kubernetes Cluster Sanitizer is a utility that scans live Kubernetes cluster and reports potential issues with deployed resources and configurations. It sanitizes your cluster based on what's deployed and not what's sitting on disk. By scanning your cluster, it detects misconfigurations and helps you to ensure that best practices are in place</p>"},{"location":"cost_optimization/awareness/#resources","title":"Resources","text":"<p>Refer to the following resources to learn more about best practices for cost optimization.</p> <p>Documentation and Blogs +   Amazon EKS supports tagging</p> <p>Tools +   What is AWS Billing and Cost Management? +   Amazon CloudWatch Container Insights +   How to track costs in multi-tenant Amazon EKS clusters using Kubecost  +   Kube Cost +   Kube Opsview +  Kube Janitor +  Kubernetes Opex Analytics</p>"},{"location":"cost_optimization/cfm_framework/","title":"Cost Optimization - Introduction","text":"<p>AWS Cloud Economics is a discipline that helps customers increase efficiency and reduce their costs through the adoption of modern compute technologies like Amazon EKS. The discipline recommends following a methodology called the \u201cCloud Financial Management (CFM) framework\u201d which consists of 4 pillars: </p> <p></p>"},{"location":"cost_optimization/cfm_framework/#the-see-pillar-measurement-and-accountability","title":"The See pillar: Measurement and accountability","text":"<p>The See pillar is a foundational set of activities and technologies that define how to measure, monitor and create accountability for cloud spend. It is often referred to as \u201cObservability\u201d, \u201cInstrumentation\u201d, or \u201cTelemetry\u201d. The capabilities and limitations of the \u201cObservability\u201d infrastructure dictate what can be optimized. Obtaining a clear picture of your costs is a critical first step in cost optimization as you need to know where you are starting from. This type of visibility will also guide the types of activities you will need to do to further optimize your environment.  </p> <p>Here is a brief overview of our best practices for the See pillar:</p> <ul> <li>Define and maintain a tagging strategy for your workloads. <ul> <li>Use Instance Tagging, tagging EKS clusters allows you to see individual cluster costs and allocate them in your Cost &amp; Usage Reports. </li> </ul> </li> <li>Establish reporting and monitoring of EKS usage by using technologies like Kubecost. <ul> <li>Enable Cloud Intelligence Dashboards, by having resources properly tagged and using visualizations, you can measure and estimate costs.</li> </ul> </li> <li>Allocate cloud costs to applications, Lines of Business (LoBs), and revenue streams.</li> <li>Define, measure, and circulate efficiency/value KPIs with business stakeholders. For example, create a \u201cunit metric\u201d KPI that measures the cost per transaction, e.g. a ride sharing services might have a KPI for \u201ccost per ride\u201d.  </li> </ul> <p>For more details on the recommended technologies and activities associated with this pillar, please see the Cost Optimization - Observability section of this guide. </p>"},{"location":"cost_optimization/cfm_framework/#the-save-pillar-cost-optimization","title":"The Save pillar: Cost optimization","text":"<p>This pillar is based on the technologies and capabilities developed in the \u201cSee\u201d pillar. The following activities typically fall under this pillar: </p> <ul> <li>Identify and eliminate waste in your environment. </li> <li>Architect and design for cost efficiency.</li> <li>Choose the best purchasing option, e.g. on-demand instances vs Spot instances.</li> <li>Adapt as services evolve: as AWS services evolve, the way to efficiently use those services may change. Be willing to adapt to account for these changes. </li> </ul> <p>Since these activities are operational, they are highly dependent on your environment\u2019s characteristics. Ask yourself, what are the main drivers of costs? What business value do your different environments provide? What purchasing options and infrastructure choices, e.g. instance family types, are best suited for each environment?  </p> <p>Below is a prioritized list of the most common cost drivers for EKS clusters:</p> <ol> <li>Compute costs: Combining multiple types of instance families, purchasing options, and balancing scalability with availability require careful consideration. For further information, see the recommendations in the Cost Optimization - Compute section of this guide. </li> <li>Networking costs: using 3 AZs for EKS clusters can potentially increase inter-AZ traffic costs. For our recommendations on how to balance HA requirements with keeping network traffic costs down, please consult the Cost Optimization - Networking section of this guide. </li> <li>Storage costs: Depending on the stateful/stateless nature of the workloads in the EKS clusters, and how the different storage types are used, storage can be considered as part of the workload. For considerations relating to EKS storage costs, please consult the Cost Optimization - Storage section of this guide.</li> </ol>"},{"location":"cost_optimization/cfm_framework/#the-plan-pillar-planning-and-forecasting","title":"The Plan pillar:  Planning and forecasting","text":"<p>Once the recommendations in the See pillar are implemented, clusters are optimized on an on-going basis. As experience is gained in operating clusters efficiently, planning and forecasting activities can focus on:</p> <ul> <li>Budgeting and forecasting cloud costs dynamically. </li> <li>Quantifying the business value delivered by EKS container services.</li> <li>Integrating EKS cluster cost management with IT financial management planning. </li> </ul>"},{"location":"cost_optimization/cfm_framework/#the-run-pillar","title":"The Run pillar","text":"<p>Cost optimization is a continuous process and involves a flywheel of incremental improvements: </p> <p></p> <p>Securing executive sponsorship for these types of activities is crucial for integrating EKS cluster optimization into the organization\u2019s \u201cFinOps\u201d efforts. It allows stakeholder alignment through a shared understanding of EKS cluster costs, implementation of EKS cluster cost guardrails, and ensuring that the tooling, automation, and activities evolve with the organization\u2019s needs. </p>"},{"location":"cost_optimization/cfm_framework/#references","title":"References","text":"<ul> <li>AWS Cloud Economics, Cloud Financial Management</li> </ul>"},{"location":"cost_optimization/cost-effective/","title":"Cost-effective resources","text":"<p>Cost Effective resources means using the appropriate services, resources, and configurations for your workloads running on a Kubernetes cluster, which will result in cost savings.</p>"},{"location":"cost_optimization/cost-effective/#recommendations","title":"Recommendations","text":""},{"location":"cost_optimization/cost-effective/#ensure-that-the-infrastructure-used-to-deploy-the-containerized-service-matches-the-application-profile-and-scaling-needs","title":"Ensure that the infrastructure used to deploy the containerized service matches the application profile and scaling needs","text":"<p>There are several types of Kubernetes autoscaling supported in Amazon EKS - Cluster Autoscaler, Horizontal Pod Autoscaler and Vertical Pod Autoscaler. This section covers two of them, Cluster Auto Scaler and Horizontal Pod Autoscaler.</p>"},{"location":"cost_optimization/cost-effective/#use-cluster-autoscaler-to-adjust-the-size-of-a-kubernetes-cluster-to-meet-the-current-needs","title":"Use Cluster Autoscaler to adjust the size of a Kubernetes cluster to meet the current needs","text":"<p>The Kubernetes Cluster Autoscaler automatically adjusts the number of nodes in the EKS cluster when pods fail to launch due to lack of resources or when nodes in the cluster are underutilized and their pods can be rescheduled onto other nodes in the cluster. The Cluster Autoscaler scales worker nodes within any specified Auto Scaling group and runs as a deployment in your EKS cluster.</p> <p>Amazon EKS with EC2 managed node groups automate the provisioning and lifecycle management of nodes (Amazon EC2 instances) for Amazon EKS Kubernetes clusters. All managed nodes are provisioned as part of an Amazon EC2 Auto Scaling group that is managed for you by Amazon EKS and all resources including Amazon EC2 instances and Auto Scaling groups run within your AWS account. Amazon EKS tags managed node group resources so that they can be discovered the Kubernetes Cluster Autoscaler. </p> <p>The documentation at https://docs.aws.amazon.com/eks/latest/userguide/cluster-autoscaler.html provides detailed guidance on setting up a Managed Node Group and then deploying Kubernetes Cluster Auto Scaler. If you are running a stateful application across multiple Availability Zones that is backed by Amazon EBS volumes and using the Kubernetes Cluster Autoscaler, you should configure multiple node groups, each scoped to a single Availability Zone.</p> <p>Cluster Autoscaler logs for EC2 based Worker Nodes - </p> <p>When a pod cannot be scheduled due to lack of available resources, Cluster Autoscaler determines that the cluster must scale out and increases the size of the node group. When multiple node groups are used, Cluster Autoscaler chooses one based on the Expander configuration. Currently, the following strategies are supported in EKS:  + random - default expander, selects the instance group randomly + most-pods - selects the instance group that schedules the most amount of pods. + least-waste - selects the node group that will have the least idle CPU (if tied, unused memory) after scale-up. This is useful when you have different classes of nodes, for example, high CPU or high memory nodes, and only want to expand those when there are pending pods that need a lot of those resources. + priority - selects the node group that has the highest priority assigned by the user</p> <p>You can use the random placement strategy for the Expander in Cluster Autoscaler, if EC2 Spot instances are being used as worker nodes. This is the default expander, and arbitrarily chooses a node-group when the cluster must scale out. The random expander maximizes your ability to leverage multiple Spot capacity pools. </p> <p>Priority based expander selects an expansion option based on priorities assigned by a user to scaling groups. Sample priorities can be to let Autoscaler first try to scale out a spot instance node group and then, if it cannot, falls back to scaling out an on-demand node group. </p> <p>most-pods based expander is useful when you are using nodeSelector to make sure certain pods land on certain nodes. </p> <p>From the documentation to specify least-waste as the expander type for the Cluster Autoscaling configuration:</p> <pre><code>    spec:\n      containers:\n      - command:\n        - ./cluster-autoscaler\n        - --v=4\n        - --stderrthreshold=info\n        - --cloud-provider=aws\n        - --skip-nodes-with-local-storage=false\n        - --expander=least-waste\n        - --node-group-auto-discovery=asg:tag=k8s.io/cluster-autoscaler/enabled,k8s.io/cluster-autoscaler/&lt;YOUR CLUSTER NAME&gt;\n        - --balance-similar-node-groups\n        - --skip-nodes-with-system-pods=false\n</code></pre>"},{"location":"cost_optimization/cost-effective/#deploy-horizontal-pod-autoscaling-to-automatically-scales-the-number-of-pods-in-a-deployment-replication-controller-or-replica-set-based-on-that-resources-cpu-utilization-or-other-application-related-metrics","title":"Deploy Horizontal Pod Autoscaling to automatically scales the number of pods in a deployment, replication controller, or replica set based on that resource's CPU utilization or other application related metrics","text":"<p>The Kubernetes Horizontal Pod Autoscaler automatically scales the number of pods in a deployment, replication controller, or replica set based on resource metrics like CPU utilization or with custom metrics support, on some other application-provided metrics. This can help your applications scale out to meet increased demand or scale in when resources are not needed, thus freeing up your worker nodes for other applications. When you set a target metric utilization percentage, the Horizontal Pod Autoscaler scales your application in or out to try to meet that target. </p> <p>The k8s-cloudwatch-adapter is an implementation of the Kubernetes Custom Metrics API and External Metrics API with integration for CloudWatch metrics. It allows you to scale your Kubernetes deployment using the Horizontal Pod Autoscaler (HPA) with CloudWatch metrics.</p> <p>For an example of scaling using a resource metric like CPU, follow https://eksworkshop.com/beginner/080_scaling/test_hpa/ to deploy a sample app, perform a simple load test to test the autoscaling of pod and simulate pod autoscaling. </p> <p>Refer to this blog for an example of a custom metric for an application to scale according to the number of messages in the Amazon SQS (Simple Queue Service) queue.</p> <p>An example of an external metric from Amazon SQS from the blog:</p> <pre><code>apiVersion: metrics.aws/v1alpha1\nkind: ExternalMetric:\n  metadata:\n    name: hello-queue-length\n  spec:\n    name: hello-queue-length\n    resource:\n      resource: \"deployment\"\n    queries:\n      - id: sqs_helloworld\n        metricStat:\n          metric:\n            namespace: \"AWS/SQS\"\n            metricName: \"ApproximateNumberOfMessagesVisible\"\n            dimensions:\n              - name: QueueName\n                value: \"helloworld\"\n          period: 300\n          stat: Average\n          unit: Count\n        returnData: true\n</code></pre> <p>An example of an HPA utilizing this external metric: </p> <pre><code>kind: HorizontalPodAutoscaler\napiVersion: autoscaling/v2beta1\nmetadata:\n  name: sqs-consumer-scaler\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1beta1\n    kind: Deployment\n    name: sqs-consumer\n  minReplicas: 1\n  maxReplicas: 10\n  metrics:\n  - type: External\n    external:\n      metricName: hello-queue-length\n      targetAverageValue: 30\n</code></pre> <p>The combination of Cluster Auto Scaler for the Kubernetes worker nodes and Horizontal Pod Autoscaler for the pods, will ensure that the provisioned resources will be as close to the actual utilization as possible.</p> <p> (Image source: https://aws.amazon.com/blogs/containers/cost-optimization-for-kubernetes-on-aws/)</p> <p>Amazon EKS with Fargate</p> <p>*Horizontal Pod Autoscaling of Pods*</p> <p>Autoscaling EKS on Fargate can be done using the following mechanisms:</p> <ol> <li>Using the Kubernetes metrics server and configure auto-scaling based on CPU and/or memory usage.</li> <li>Configure autoscaling based on custom metrics like HTTP traffic using Prometheus and Prometheus metrics adapter</li> <li>Configure autoscaling based on App Mesh traffic</li> </ol> <p>The above scenarios are explained in a hands-on blog on \"Autoscaling EKS on Fargate with custom metrics</p> <p>*Vertical Pod Autoscaling*</p> <p>Use the Vertical Pod Autoscaler with pods running on Fargate to optimize the CPU and memory used for your applications. However, because changing the resource allocation for a pod requires the pod to be restarted, you must set the pod update policy to either Auto or Recreate to ensure correct functionality. </p>"},{"location":"cost_optimization/cost-effective/#recommendations_1","title":"Recommendations","text":""},{"location":"cost_optimization/cost-effective/#use-down-scaling-to-scale-down-kubernetes-deployments-statefulsets-andor-horizontalpodautoscalers-during-non-work-hours","title":"Use Down Scaling to scale down Kubernetes Deployments, StatefulSets, and/or HorizontalPodAutoscalers during non-work hours.","text":"<p>As part of controlling costs Down-Scaling resources that are not in-use can also have an huge impact on the overall costs. There are tools like kube-downscaler and Descheduler for Kubernetes. </p> <p>Kube-descaler, can be used to Scale down Kubernetes deployments after work hours or during set periods of time. </p> <p>Descheduler for Kubernetes, based on its policy, can find pods that can be moved and evicts them.  In its current implementation, the kubernetes descheduler does not reschedule evicted pods but relies on the default scheduler for that</p> <p>Kube-descaler</p> <p>Installation of kube-downscaler: <pre><code>git clone https://github.com/hjacobs/kube-downscaler\ncd kube-downscaler\nkubectl apply -k deploy/\n</code></pre></p> <p>The example configuration uses the --dry-run as a safety flag to prevent downscaling --- remove it to enable the downscaler, e.g. by editing the deployment: <pre><code>$ kubectl edit deploy kube-downscaler\n</code></pre></p> <p>Deploy an nginx pod and schedule it to be run in the time zone - Mon-Fri 09:00-17:00 Asia/Kolkata:  <pre><code>$ kubectl run nginx1 --image=nginx\n$ kubectl annotate deploy nginx1 'downscaler/uptime=Mon-Fri 09:00-17:00 Asia/Kolkata'\n</code></pre></p> <p>Note</p> <p>The default grace period of 15 minutes applies to the new nginx deployment, i.e. if the current time is not within Mon-Fri 9-17 (Asia/Kolkata timezone), it will downscale not immediately, but after 15 minutes. </p> <p></p> <p>More advanced downscaling deployment scenarios are available at the kube-down-scaler github project.</p> <p>Kubernetes descheduler</p> <p>The descheduler can be run as a Job or CronJob inside of a k8s cluster. Descheduler's policy is configurable and includes strategies that can be enabled or disabled. Seven strategies RemoveDuplicates, LowNodeUtilization, RemovePodsViolatingInterPodAntiAffinity, RemovePodsViolatingNodeAffinity, RemovePodsViolatingNodeTaints, RemovePodsHavingTooManyRestarts, and PodLifeTime are currently implemented. More details can be found in their documentation.</p> <p>A sample policy, which has the descheduler enabled for lowcpuutilization of nodes (where it covers the scenarios for both underutilized and overutilized), removing pods for too many restarts and others :</p> <pre><code>apiVersion: \"descheduler/v1alpha1\"\nkind: \"DeschedulerPolicy\"\nstrategies:\n  \"RemoveDuplicates\":\n     enabled: true\n  \"RemovePodsViolatingInterPodAntiAffinity\":\n     enabled: true\n  \"LowNodeUtilization\":\n     enabled: true\n     params:\n       nodeResourceUtilizationThresholds:\n         thresholds:\n           \"cpu\" : 20\n           \"memory\": 20\n           \"pods\": 20\n         targetThresholds:\n           \"cpu\" : 50\n           \"memory\": 50\n           \"pods\": 50\n  \"RemovePodsHavingTooManyRestarts\":\n     enabled: true\n     params:\n       podsHavingTooManyRestarts:\n         podRestartThresholds: 100\n         includingInitContainers: true\n</code></pre> <p>Cluster Turndown</p> <p>Cluster Turndown is an automated scaledown and scaleup of a Kubernetes cluster's backing nodes based on a custom schedule and turndown criteria. This feature can be used to reduce spend during down hours and/or reduce surface area for security reasons. The most common use case is to scale non-prod environments (e.g. dev clusters) to zero during off hours. Cluster Turndown is currently in ALPHA release.</p> <p>Cluster Turndown uses a Kubernetes Custom Resource Definition to create schedules. The following schedule will create a schedule that starts by turning down at the designated start date-time and turning back up at the designated end date-time (times should be in RFC3339 format, i.e. times based on offsets to UTC).</p> <pre><code>apiVersion: kubecost.k8s.io/v1alpha1\nkind: TurndownSchedule\nmetadata:\n  name: example-schedule\n  finalizers:\n  - \"finalizer.kubecost.k8s.io\"\nspec:\n  start: 2020-03-12T00:00:00Z\n  end: 2020-03-12T12:00:00Z\n  repeat: daily\n</code></pre>"},{"location":"cost_optimization/cost-effective/#use-limitranges-and-resource-quotas-to-help-manage-costs-by-constraining-the-amount-of-resources-allocated-at-an-namespace-level","title":"Use LimitRanges and Resource Quotas to help manage costs by constraining the amount of resources allocated at an Namespace level","text":"<p>By default, containers run with unbounded compute resources on a Kubernetes cluster. With resource quotas, cluster administrators can restrict resource consumption and creation on a namespace basis. Within a namespace, a Pod or Container can consume as much CPU and memory as defined by the namespace\u2019s resource quota. There is a concern that one Pod or Container could monopolize all available resources. </p> <p>Kubernetes controls the allocation of resources such as CPU, memory, PersistentVolumeClaims and others using Resource Quotas and Limit Ranges. ResourceQuota is at the Namespace level, while a LimitRange applies at an container level. </p> <p>Limit Ranges</p> <p>A LimitRange is a policy to constrain resource allocations (to Pods or Containers) in a namespace. </p> <p>The following is an example of setting an default memory request and a default memory limit using Limit Range. </p> <pre><code>apiVersion: v1\nkind: LimitRange\nmetadata:\n  name: mem-limit-range\nspec:\n  limits:\n  - default:\n      memory: 512Mi\n    defaultRequest:\n      memory: 256Mi\n    type: Container\n</code></pre> <p>More examples are available in the Kubernetes documentation.</p> <p>Resource Quotas</p> <p>When several users or teams share a cluster with a fixed number of nodes, there is a concern that one team could use more than its fair share of resources. Resource quotas are a tool for administrators to address this concern.</p> <p>The following is an example of how to set quotas for the total amount memory and CPU that can be used by all Containers running in a namespace, by specifying quotas in a ResourceQuota object. This specifies that a Container must have a memory request, memory limit, cpu request, and cpu limit, and should not exceed the threshold set in the ResourceQuota.</p> <pre><code>apiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: mem-cpu-demo\nspec:\n  hard:\n    requests.cpu: \"1\"\n    requests.memory: 1Gi\n    limits.cpu: \"2\"\n    limits.memory: 2Gi\n</code></pre> <p>More examples are available in the Kubernetes documentation.</p>"},{"location":"cost_optimization/cost-effective/#use-pricing-models-for-effective-utilization","title":"Use pricing models for effective utilization","text":"<p>The pricing details for Amazon EKS are given in the pricing page. There is a common control plane cost for both Amazon EKS on Fargate and EC2. </p> <p>If you are using AWS Fargate, pricing is calculated based on the vCPU and memory resources used from the time you start to download your container image until the Amazon EKS pod terminates, rounded up to the nearest second. A minimum charge of 1 minute applies. See detailed pricing information on the AWS Fargate pricing page.</p> <p>Amazon EKS on EC2:</p> <p>Amazon EC2 provides a wide selection of instance types optimized to fit different use cases. Instance types comprise varying combinations of CPU, memory, storage, and networking capacity and give you the flexibility to choose the appropriate mix of resources for your applications. Each instance type includes one or more instance sizes, allowing you to scale your resources to the requirements of your target workload.</p> <p>One of the key decision parameters apart from number of CPUs, memory, processor family type related to the instance type is the number of Elastic network interfaces(ENI's), which in-turn has a bearing on the maximum number of pods you can run on that EC2 Instance. The list of max pods per EC2 Instance type is maintained in a github.</p> <p>*On-Demand EC2 Instances:*</p> <p>With On-Demand instances, you pay for compute capacity by the hour or the second depending on which instances you run. No longer-term commitments or upfront payments are needed. </p> <p>Amazon EC2 A1 instances deliver significant cost savings and are ideally suited for scale-out and ARM-based workloads that are supported by the extensive Arm ecosystem. You can now use Amazon Elastic Container Service for Kubernetes (EKS) to run containers on Amazon EC2 A1 Instances as part of a public developer preview. Amazon ECR now supports multi-architecture container images, which makes it simpler to deploy container images for different architectures and operating systems from the same image repository. </p> <p>You can use the AWS Simple Monthly Calculator or the new pricing calculator to get pricing for the On-Demand EC2 instances for the EKS workder nodes.</p>"},{"location":"cost_optimization/cost-effective/#use-spot-ec2-instances","title":"Use Spot EC2 Instances:","text":"<p>Amazon EC2 Spot instances allow you to request spare Amazon EC2 computing capacity for up to 90% off the On-Demand price. </p> <p>Spot Instances are often a great fit for stateless containerized workloads because the approach to containers and Spot Instances are similar; ephemeral and autoscaled capacity. This means they both can be added and removed while adhering to SLAs and without impacting the performance or availability of your applications.</p> <p>You can create multiple nodegroups with a mix of on-demand instance types and EC2 Spot instances to leverage the advantages of pricing between these two instance types.</p> <p> (Image source: https://ec2spotworkshops.com/using_ec2_spot_instances_with_eks/spotworkers/workers_eksctl.html)</p> <p>A sample yaml file for eksctl to create a nodegroup with EC2 spot instances is given below. During the creation of the Node Group, we have configured a node-label so that kubernetes knows what type of nodes we have provisioned. We set the lifecycle for the nodes as Ec2Spot. We are also tainting with PreferNoSchedule to prefer pods not be scheduled on Spot Instances. This is a \u201cpreference\u201d or \u201csoft\u201d version of NoSchedule, i.e. the system will try to avoid placing a pod that does not tolerate the taint on the node, but it is not required. We are using this technique to make sure that only the right type of workloads are scheduled on Spot Instances.</p> <p><pre><code>apiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\nmetadata:\n  name: my-cluster-testscaling \n  region: us-west-2\nnodeGroups:\n  - name: ng-spot\n    labels:\n      lifecycle: Ec2Spot\n    taints:\n      spotInstance: true:PreferNoSchedule\n    minSize: 2\n    maxSize: 5\n    instancesDistribution: # At least two instance types should be specified\n      instanceTypes:\n        - m4.large\n        - c4.large\n        - c5.large\n      onDemandBaseCapacity: 0\n      onDemandPercentageAboveBaseCapacity: 0 # all the instances will be spot instances\n      spotInstancePools: 2\n</code></pre> Use the node-labels to identify the lifecycle of the nodes. <pre><code>$ kubectl get nodes --label-columns=lifecycle --selector=lifecycle=Ec2Spot\n</code></pre></p> <p>We should also deploy the AWS Node Termination Handler on each Spot Instance. This will monitor the EC2 metadata service on the instance for an interruption notice. The termination handler consists of a ServiceAccount, ClusterRole, ClusterRoleBinding, and a DaemonSet. AWS Node Termination Handler is not only for Spot Instances, it can also catch general EC2 maintenance events, so it can be used across all the worker nodes in the cluster.</p> <p>If a customer is well diversified and uses the capacity-optimized allocation strategy, Spot Instances will be available. You can use Node Affinity in your manifest file to configure this, to prefer Spot Instances, but not require them. This would allow the pods to be scheduled on On-Demand nodes if no spot instances were available or correctly labelled.</p> <pre><code>affinity:\nnodeAffinity:\n  preferredDuringSchedulingIgnoredDuringExecution:\n  - weight: 1\n    preference:\n      matchExpressions:\n      - key: lifecycle\n        operator: In\n        values:\n        - Ec2Spot\ntolerations:\n- key: \"spotInstance\"\noperator: \"Equal\"\nvalue: \"true\"\neffect: \"PreferNoSchedule\"\n</code></pre> <p>You can do a complete workshop with EC2 spot instances at the online EC2 Spot Workshop.</p>"},{"location":"cost_optimization/cost-effective/#use-compute-savings-plan","title":"Use Compute Savings Plan","text":"<p>Compute Savings Plans, a flexible discount model that provides you with the same discounts as Reserved Instances, in exchange for a commitment to use a specific amount (measured in dollars per hour) of compute power over a one or three year period. The details are covered in the Savings Plan launch FAQ.The plans automatically apply to any EC2 worker node regardless of region, instance family, operating system, or tenancy, including those that are part of EKS clusters. For example, you can shift from C4 to C5 instances, move a workload from Dublin to London benefiting from Savings Plan prices along the way, without having to do anything.</p> <p>The AWS Cost Explorer will help you to choose a Savings Plan, and will guide you through the purchase process. </p> <p>Note - The compute savings plans now also applies to AWS Fargate for AWS Elastic Kubernetes Service (EKS). </p> <p>Note - The above pricing does not include the other AWS services like Data transfer charges, CloudWatch, Elastic Load Balancer and other AWS services that may be used by the Kubernetes applications.</p>"},{"location":"cost_optimization/cost-effective/#resources","title":"Resources","text":"<p>Refer to the following resources to learn more about best practices for cost optimization.</p>"},{"location":"cost_optimization/cost-effective/#videos","title":"Videos","text":"<ul> <li>AWS re:Invent 2019: Save up to 90% and run production workloads on Spot Instances (CMP331-R1)</li> </ul>"},{"location":"cost_optimization/cost-effective/#documentation-and-blogs","title":"Documentation and Blogs","text":"<ul> <li>Cost optimization for Kubernetes on AWS</li> <li>Building for Cost optimization and Resilience for EKS with Spot Instances</li> <li>Autoscaling EKS on Fargate with custom metrics</li> <li>AWS Fargate considerations</li> <li>Using Spot Instances with EKS</li> <li>Extending the EKS API: Managed Node Groups</li> <li>Autoscaling with Amazon EKS </li> <li>Amazon EKS pricing</li> <li>AWS Fargate pricing</li> <li>Savings Plan</li> <li>Saving Cloud Costs with Kubernetes on AWS </li> </ul>"},{"location":"cost_optimization/cost-effective/#tools","title":"Tools","text":"<ul> <li>Kube downscaler</li> <li>Kubernetes Descheduler</li> <li>Cluster TurnDown</li> </ul>"},{"location":"cost_optimization/cost_opt_compute/","title":"Cost Optimization - Compute and Autoscaling","text":"<p>As a developer, you'll make estimates about your application\u2019s resource requirements, e.g. CPU and memory, but if you\u2019re not continually adjusting them they may become outdated which could increase your costs and worsen performance and reliability. Continually adjusting an application's resource requirements is more important than getting them right the first time.</p> <p>The best practices mentioned below will help you build and operate cost-aware workloads that achieve business outcomes while minimizing costs and allowing your organization to maximize its return on investment. A high level order of importance for optimizing your cluster compute costs are:</p> <ol> <li>Right-size workloads</li> <li>Reduce unused capacity</li> <li>Optimize compute capacity types (e.g. Spot) and accelerators (e.g. GPUs)</li> </ol>"},{"location":"cost_optimization/cost_opt_compute/#right-size-your-workloads","title":"Right-size your workloads","text":"<p>In most EKS clusters, the bulk of cost come from the EC2 instances that are used to run your containerized workloads. You will not be able to right-size your compute resources without understanding your workloads requirements. This is why it is essential that you use the appropriate requests and limits and make adjustments to those settings as necessary. In addition, dependencies, such as instance size and storage selection, may effect workload performance which can have a variety of unintended consequences on costs and reliability.</p> <p>Requests should align with the actual utilization. If a container's requests are too high there will be unused capacity which is a large factor in total cluster costs. Each container in a pod, e.g. application and sidecars, should have their own requests and limits set to make sure the aggregate pod limits are as accurate as possible.</p> <p>Utilize tools such as Goldilocks, KRR, and Kubecost which estimate resource requests and limits for your containers. Depending on the nature of the applications, performance/cost requirements, and complexity you need to evaluate which metrics are best to scale on, at what point your application performance degrades (saturation point), and how to tweak request and limits accordingly. Please refer to Application right sizing for further guidance on this topic.</p> <p>We recommend using the Horizontal Pod Autoscaler (HPA) to control how many replicas of your application should be running, the Vertical Pod Autoscaler (VPA) to adjust how many requests and limits your application needs per replica, and a node autoscaler like Karpenter or Cluster Autoscaler to continually adjust the total number of nodes in your cluster. Cost optimization techniques using Karpenter and Cluster Autoscaler are documented in a later section of this document.</p> <p>The Vertical Pod Autoscaler can adjust the requests and limits assigned to containers so workloads run optimally. You should run the VPA in auditing mode so it does not automatically make changes and restart your pods. It will suggest changes based on observed metrics. With any changes that affect production workloads you should review and test those changes first in a non-production environment because these can have impact on your application\u2019s reliability and performance.</p>"},{"location":"cost_optimization/cost_opt_compute/#reduce-consumption","title":"Reduce consumption","text":"<p>The best way to save money is to provision fewer resources. One way to do that is to adjust workloads based on their current requirements. You should start any cost optimization efforts with making sure your workloads define their requirements and scale dynamically. This will require getting metrics from your applications and setting configurations such as <code>PodDisruptionBudgets</code> and Pod Readiness Gates to make sure your application can safely scale up and down dynamically.</p> <p>The Horizontal Pod Autoscaler is a flexible workload autoscaler that can adjust how many replicas are needed to meet the performance and reliability requirements of your application. It has a flexible model for defining when to scale up and down based on various metrics such as CPU, memory, or custom metrics e.g. queue depth, number of connections to a pod, etc.</p> <p>The Kubernetes Metrics Server enables scaling in response to built-in metrics like CPU and memory usage, but if you want to scale based on other metrics, such as Amazon CloudWatch or SQS queue depth, you should consider event driven autoscaling projects such as KEDA. Please refer to this blog post on how to use KEDA with CloudWatch metrics. If you are unsure, which metrics to monitor and scale based on, check out the best practices on monitoring metrics that matters.</p> <p>Reducing workload consumption creates excess capacity in a cluster and with proper autoscaling configuration allows you to scale down nodes automatically and reduce your total spend. We recommend you do not try to optimize compute capacity manually. The Kubernetes scheduler and node autoscalers were designed to handle this process for you.</p>"},{"location":"cost_optimization/cost_opt_compute/#reduce-unused-capacity","title":"Reduce unused capacity","text":"<p>After you have determined the correct size for applications, reducing excess requests, you can begin to reduce the provisioned compute capacity. You should be able to do this dynamically if you have taken the time to correctly size your workloads from the sections above. There are two primary node autoscalers used with Kubernetes in AWS.</p>"},{"location":"cost_optimization/cost_opt_compute/#karpenter-and-cluster-autoscaler","title":"Karpenter and Cluster Autoscaler","text":"<p>Both Karpenter and the Kubernetes Cluster Autoscaler will scale the number of nodes in your cluster as pods are created or removed and compute requirements change. The primary goal of both is the same, but Karpenter takes a different approach for node management provisioning and de-provisioning which can help reduce costs and optimize cluster wide usage.</p> <p>As clusters grow in size and the variety of workloads increases it becomes more difficult to pre-configure node groups and instances. Just like with workload requests it\u2019s important to set an initial baseline and continually adjust as needed.</p>"},{"location":"cost_optimization/cost_opt_compute/#cluster-autoscaler-priority-expander","title":"Cluster Autoscaler Priority Expander","text":"<p>The Kubernetes Cluster Autoscaler works by scaling groups of nodes \u2014 called a node group \u2014 up and down as applications scale up and down. If you are not dynamically scaling workloads then the Cluster Autoscaler will not help you save money. The Cluster Autoscaler requires a cluster admin to create node groups ahead of time for workloads to consume. The node groups need to configured to use instances that have the same \"profile\", i.e. roughly the same amount of CPU and memory.</p> <p>You can have multiple node groups and the Cluster Autoscaler can be configured to set priority scaling levels and each node group can contain different sized nodes. Node groups can have different capacity types and the priority expander can be used to scale less expensive groups first.</p> <p>Below is an example of a snippet of cluster configuration that uses a `ConfigMap`` to prioritize reserved capacity before using on-demand instances.  You can use the same technique to prioritize Graviton or Spot Instances over other types.  </p> <pre><code>apiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\nmetadata:\n  name: my-cluster\nmanagedNodeGroups:\n  - name: managed-ondemand\n    minSize: 1\n    maxSize: 7\n    instanceType: m5.xlarge\n  - name: managed-reserved\n    minSize: 2\n    maxSize: 10\n    instanceType: c5.2xlarge\n</code></pre> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cluster-autoscaler-priority-expander\n  namespace: kube-system\ndata:\n  priorities: |-\n    10:\n      - .*ondemand.*\n    50:\n      - .*reserved.*\n</code></pre> <p>Using node groups can help the underlying compute resources do the expected thing by default, e.g. spread nodes across AZs, but not all workloads have the same requirements or expectations and it\u2019s better to let applications declare their requirements explicitly. For more information about Cluster Autoscaler, please see the best practices section.</p>"},{"location":"cost_optimization/cost_opt_compute/#descheduler","title":"Descheduler","text":"<p>The Cluster Autoscaler can add and remove node capacity from a cluster based on new pods needing to be scheduled or nodes being underutilized. It does not take a wholistic view of pod placement after it has been scheduled to a node. If you are using the Cluster Autoscaler you should also look at the Kubernetes descheduler to avoid wasting capacity in your cluster.</p> <p>If you have 10 nodes in a cluster and each node is 60% utilized you are not using 40% of the provisioned capacity in the cluster. With the Cluster Autoscaler you can set the utilization threashold per node to 60%, but that would only try to scale down a single node after utilization dropped below 60%.</p> <p>With the descheduler it can look at cluster capacity and utilization after pods have been scheduled or nodes have been added to the cluster. It attempts to keep the total capacity of the cluster above a specified threshold. It can also remove pods based on node taints or new nodes that join the cluster to make sure pods are running in their optimal compute environment. Note that, descheduler does not schedule replacement of evicted pods but relies on the default scheduler for that.</p>"},{"location":"cost_optimization/cost_opt_compute/#karpenter-consolidation","title":"Karpenter Consolidation","text":"<p>Karpenter takes a \u201cgroupless\u201d approach to node management. This approach is more flexible for different workload types and requires less up front configuration for cluster administrators. Instead of pre-defining groups and scaling each group as workloads need, Karpenter uses provisioners and node templates to define broadly what type of EC2 instances can be created and settings about the instances as they are created.</p> <p>Bin packing is the practice of utilizing more of the instance\u2019s resources by packing more workloads onto fewer, optimally sized, instances. While this helps to reduce your compute costs by only provisioning resources your workloads use, it has a trade-off. It can take longer to start new workloads because capacity has to be added to the cluster, especially during large scaling events. Consider the balance between cost optimization, performance, and availability when setting up bin packing. </p> <p>Karpenter can continuously monitor and binpack to improve instance resource utilization and lower your compute costs. Karpenter can also select a more cost efficient worker node for your workload. This can be achieved by turning on \u201cconsolidation\u201d flag to true in the provisioner (sample code snippet below).  The example below shows an example provisioner that enables consolidation. At the time of writing this guide, Karpenter won\u2019t replace a running Spot instance with a cheaper Spot instance. For further details on Karpenter consolidation, refer to this blog.  </p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\n  name: enable-binpacking\nspec:\n  consolidation:\n    enabled: true\n</code></pre> <p>For workloads that might not be interruptible e.g. long running batch jobs without checkpointing, consider annotating pods with the <code>do-not-evict</code> annotation. By opting pods out of eviction, you are telling Karpenter that it should not voluntarily remove nodes containing this pod. However, if a <code>do-not-evict</code> pod is added to a node while the node is draining, the remaining pods will still evict, but that pod will block termination until it is removed. In either case, the node will be cordoned to prevent additional work from being scheduled on the node. Below is an example showing how set the annotation:</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: label-demo\n  labels:\n    environment: production\n  annotations:  \n    \"karpenter.sh/do-not-evict\": \"true\"\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n</code></pre>"},{"location":"cost_optimization/cost_opt_compute/#remove-under-utilized-nodes-by-adjusting-cluster-autoscaler-parameters","title":"Remove under-utilized nodes by adjusting Cluster Autoscaler parameters","text":"<p>Node utilization is defined as the sum of requested resources divided by capacity. By default <code>scale-down-utilization-threshold</code> is set to 50%. This parameter can be used along with and <code>scale-down-unneeded-time</code>, which determines how long a node should be unneeded before it is eligible for scale down \u2014 the default is 10 minutes. Pods still running on a node that was scaled down will get scheduled on other nodes by kube-scheduler.  Adjusting these settings can help remove nodes that are underutilized, but it\u2019s important you test these values first so you don\u2019t force the cluster to scale down prematurely.</p> <p>You can prevent scale down from happening by ensuring that pods that are expensive to evict are protected by a label recognized by the Cluster Autoscaler. To do this, ensure that pods that are expensive to evict have the annotation <code>cluster-autoscaler.kubernetes.io/safe-to-evict=false</code>. Below is an example yaml to set the annotation:</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: label-demo\n  labels:\n    environment: production\n  annotations:  \n    \"cluster-autoscaler.kubernetes.io/safe-to-evict\": \"false\"\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n</code></pre>"},{"location":"cost_optimization/cost_opt_compute/#tag-nodes-with-cluster-autoscaler-and-karpenter","title":"Tag nodes with Cluster Autoscaler and Karpenter","text":"<p>AWS resource tags are used to organize your resources, and to track your AWS costs on a detailed level. They do not directly correlate with Kubernetes labels for cost tracking. It\u2019s recommended to start with Kubernetes resource labeling and utilize tools like Kubecost to get infrastructure cost reporting based on Kubernetes labels on pods, namespaces etc.</p> <p>Worker nodes need to have tags to show billing information in AWS Cost Explorer. With Cluster Autoscaler, tag your worker nodes inside a managed node group using launch template. For self managed node groups, tag your instances using EC2 auto scaling group. For instances provisioned by Karpenter, tag them using spec.tags in the node template.</p>"},{"location":"cost_optimization/cost_opt_compute/#multi-tenant-clusters","title":"Multi-tenant clusters","text":"<p>When working on clusters that are shared by different teams you may not have visibility to other workloads running on the same node. While resource requests can help isolate some \u201cnoisy neighbor\u201d concerns, such as CPU sharing, they may not isolate all resource boundaries such as disk I/O exhaustion. Not every consumable resource by a workload can be isolated or limited. Workloads that consume shared resources at higher rates than other workloads should be isolated through node taints and tolerations. Another advanced technique for such workload is CPU pinning which ensures exclusive CPU instead of shared CPU for the container.</p> <p>Isolating workloads at a node level can be more expensive, but it may be possible to schedule BestEffort jobs or take advantage of additional savings by using Reserved Instances, Graviton processors, or Spot.</p> <p>Shared clusters may also have cluster level resource constraints such as IP exhaustion, Kubernetes service limits, or API scaling requests. You should review the scalability best practices guide to make sure your clusters avoid these limits.</p> <p>You can isolate resources at a namespace or Karpenter provisioner level. Resource Quotas provide a way to set limits on how many resources workloads in a namespace can consume. This can be a good initial guard rail but it should be continually evaluated to make sure it doesn\u2019t artificially restrict workloads from scaling.</p> <p>Karpenter provisioners can set limits on some of the consumable resources in a cluster (e.g. CPU, GPU), but you will need to configure tenant applications to use the appropriate provisioner. This can prevent a single provisioner from creating too many nodes in a cluster, but it should be continually evaluated to make sure the limit isn\u2019t set too low and in turn, prevent workloads from scaling.</p>"},{"location":"cost_optimization/cost_opt_compute/#scheduled-autoscaling","title":"Scheduled Autoscaling","text":"<p>You may have the need to scale down your clusters on weekends and off hours. This is particularly relevant for test and non-production clusters where you want to scale down to zero when they are not in use. Solutions like cluster-turndown and kube-downscaler can scale down the replicas to zero based on a cron schedule.    </p>"},{"location":"cost_optimization/cost_opt_compute/#optimize-compute-capacity-types","title":"Optimize compute capacity types","text":"<p>After optimizing the total capacity of compute in your cluster and utilizing bin packing, you should look at what type of compute you have provisioned in your clusters and how you pay for those resources. AWS has Compute Savings plans that can reduce the cost for your compute which we will categorize into the following capacity types:</p> <ul> <li>Spot</li> <li>Savings Plans</li> <li>On-Demand</li> <li>Fargate</li> </ul> <p>Each capacity type has different trade-offs for management overhead, availability, and long term commitments and you will need to decide which is right for your environment. No environment should rely on a single capacity type and you can mix multiple run types in a single cluster to optimize specific workload requirements and cost.</p>"},{"location":"cost_optimization/cost_opt_compute/#spot","title":"Spot","text":"<p>The spot capacity type provisions EC2 instances from spare capacity in an Availability Zone. Spot offers the largest discounts\u2014up to 90% \u2014 but those instances can be interrupted when they are needed elsewhere. Additionally, there may not always be capacity to provision new Spot instances and existing Spot instances can be reclaimed with a 2 minute interruption notice. If your application has a long startup or shutdown process, Spot instances may not be the best option.</p> <p>Spot compute should use a wide variety of instance types to reduce the likelihood of not having spot capacity available. Instance interruptions need to be handled to safely shutdown nodes. Nodes provisioned with Karpenter or part of a Managed Node Group automatically support instance interruption notifications. If you are using self-managed nodes you will need to run the node termination handler separately to gracefully shutdown spot instances.</p> <p>It is possible to balance spot and on-demand instances in a single cluster. With Karpenter you can create weighted provisioners to achieve a balance of different capacity types. With Cluster Autoscaler you can create mixed node groups with spot and on-demand or reserved instances.</p> <p>Here is an example of using Karpenter to prioritize Spot instances ahead of On-Demand instances. When creating a provisioner, you can specify either Spot, On-Demand, or both (as shown below). When you specify both, and if the pod does not explicitly specify whether it needs to use Spot or On-Demand, then Karpenter prioritizes Spot when provisioning a node with price-capacity-optimization allocation strategy .</p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\n  name: spot-prioritized\nspec:\n  requirements:\n    - key: \"karpenter.sh/capacity-type\" \n      operator: In\n        values: [\"spot\", \"on-demand\"]\n</code></pre>"},{"location":"cost_optimization/cost_opt_compute/#savings-plans-reserved-instances-and-aws-edp","title":"Savings Plans, Reserved Instances, and AWS EDP","text":"<p>You can reduce your compute spend by using a compute savings plan. Savings plans offer reduced prices for a 1 or 3 year commitment of compute usage. The usage can apply to EC2 instances in an EKS cluster but also applies to any compute usage such as Lambda and Fargate. With savings plans you can reduce costs and still pick any EC2 instance type during your commitment period.</p> <p>Compute savings plan can reduce your EC2 cost by up to 66% without requiring commitments on what instance types, families, or regions you want to use. Savings are automatically applied to instances as you use them.</p> <p>EC2 Instance Savings Plans provides up to 72% savings on compute with a commitment of usage in a specific region and EC2 family, e.g. instances from the C family. You can shift usage to any AZ within the region, use any generation of the instance family, e.g. c5 or c6, and use any size of instance within the family. The discount will automatically be applied for any instance in your account that matches the savings plan criteria.</p> <p>Reserved Instances are similar to EC2 Instance Savings Plan but they also guarantee capacity in an Availability Zone or Region and reduce cost\u2014up to 72% \u2014 over on-demand instances. Once you calculate how much reserved capacity you will need you can select how long you would like to reserve them for (1 year or 3 years). The discounts will automatically be applied as you run those EC2 instances in your account.</p> <p>Customers also have the option to enroll in an Enterprise Agreement with AWS. Enterprise Agreements give customers the option to tailor agreements that best suit their needs. Customers can enjoy discounts on the pricing based on AWS EDP (Enterprise Discount Program). For additional information on Enterprise Agreements please contact your AWS sales representative. </p>"},{"location":"cost_optimization/cost_opt_compute/#on-demand","title":"On-Demand","text":"<p>On-Demand EC2 instances have the benefit of availability without interruptions \u2014 compared to spot \u2014 and no long term commitments \u2014 compared to savings plans. If you are looking to reduce costs in a cluster you should reduce your usage of on-demand EC2 instances.</p> <p>After optimizing your workload requirements you should be able to calculate a minimum and maximum capacity for your clusters. This number may change over time but rarely goes down. Consider using a Savings Plan for everything under the minimum, and spot for capacity that will not affect your application\u2019s availability. Anything else that may not be continuously used or is required for availability can use on-demand.</p> <p>As mentioned in this section, the best way to reduce your usage is to consume fewer resources and utilize the resources you provision to the fullest extent possible. With the Cluster Autoscaler you can remove underutilized nodes with the <code>scale-down-utilization-threshold</code> setting. With Karpenter it is recommended to enable consolidation.</p> <p>To manually identify EC2 instance types that can be used with your workloads you should use ec2-instance-selector which can show instances that are available in each region as well as instances compatible with EKS. Example usage for instances with x86 process architecture, 4 Gb of memory, 2 vCPUs and available in the us-east-1 region.</p> <pre><code>ec2-instance-selector --memory 4 --vcpus 2 --cpu-architecture x86_64 \\\n  -r us-east-1 --service eks\nc5.large\nc5a.large\nc5ad.large\nc5d.large\nc6a.large\nc6i.large\nt2.medium\nt3.medium\nt3a.medium\n</code></pre> <p>For non-production environments you can automatically have clusters scaled down during unused hours such as night and weekends. The kubecost project cluster-turndown is an example of a controller that can automatically scale your cluster down based on a set schedule.</p>"},{"location":"cost_optimization/cost_opt_compute/#fargate-compute","title":"Fargate compute","text":"<p>Fargate compute is a fully managed compute option for EKS clusters. It provides pod isolation by scheduling one pod per node in a Kubernetes cluster. It allows you to size your compute nodes to the CPU and RAM requirements of your workload to tightly control workload usage in a cluster.</p> <p>Fargate can scale workloads as small as .25 vCPU with 0.5 GB memory and as large as 16 vCPU with 120 GB memory. There are limits on how many pod size variations are available and you will need to understand how your workload best fits into a Fargate configuration. For example, if your workload requires 1 vCPU with 0.5 GB of memory the smallest Fargate pod will be 1 vCPU with 2 GB of memory.</p> <p>While Fargate has many benefits such as no EC2 instance or operating system management, it may require more compute capacity than traditional EC2 instances due to the fact that every deployed pod is isolated as a separate node in the cluster. This requires more duplication for things like the Kubelet, logging agents, and any DaemonSets you would typically deploy to a node. DaemonSets are not supported in Fargate and they will need to be converted into pod \u201csidecars\u201c and run alongside the application.</p> <p>Fargate cannot benefit from bin packing or CPU over provisioning because the boundary for the workload is a node which is not burstable or shareable between workloads. Fargate will save you EC2 instance management time which itself has a cost, but CPU and memory costs may be more expensive than other EC2 capacity types. Fargate pods can take advantage of compute savings plan to reduce the on-demand cost.</p>"},{"location":"cost_optimization/cost_opt_compute/#optimize-compute-usage","title":"Optimize Compute Usage","text":"<p>Another way to save money on your compute infrastructure is to use more efficient compute for the workload. This can come from more performant general purpose compute like Graviton processors which are up to 20% cheaper and 60% more energy efficient than x86\u2014or workload specific accelerators such as GPUs and FPGAs. You will need to build containers that can run on arm architecture and set up nodes with the right accelerators for your workloads.</p> <p>EKS has the ability to run clusters with mixed architecture (e.g. amd64 and arm64) and if your containers are compiled for multiple architectures you can take advantage of Graviton processors with Karpenter by allowing both architectures in your provisioner. To keep consistent performance, however, it is recommended you keep each workload on a single compute architecture and only use different architecture if there is no additional capacity available.</p> <p>Provisioners can be configured with multiple architectures and workloads can also request specific architectures in their workload specification.</p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\n  name: default\nspec:\n  requirements:\n  - key: \"kubernetes.io/arch\"\n    operator: In\n    values: [\"arm64\", \"amd64\"]\n</code></pre> <p>With Cluster Autoscaler you will need to create a node group for Graviton instances and set node tolerations on your workload to utilize the new capacity.</p> <p>GPUs and FPGAs can greatly increase the performance for your workload, but the workload will need to be optimized to use the accelerator. Many workload types for machine learning and artificial intelligence can use GPUs for compute and instances can be added to a cluster and mounted into a workload using resource requests.</p> <pre><code>spec:\n  template:\n    spec:\n    - containers:\n      ...\n      resources:\n          limits:\n            nvidia.com/gpu: \"1\"\n</code></pre> <p>Some GPU hardware can be shared across multiple workloads so a single GPU can be provisioned and used. To see how to configure workload GPU sharing see the virtual GPU device plugin for more information. You can also refer to the following blogs: </p> <ul> <li>GPU sharing on Amazon EKS with NVIDIA time-slicing and accelerated EC2 instances</li> <li>Maximizing GPU utilization with NVIDIA\u2019s Multi-Instance GPU (MIG) on Amazon EKS: Running more pods per GPU for enhanced performance</li> </ul>"},{"location":"cost_optimization/cost_opt_networking/","title":"Cost Optimization - Networking","text":"<p>Architecting systems for high availability (HA) is a best practice in order to accomplish resilience and fault-tolerance. In practice, this means spreading your workloads and the underlying infrastructure across multiple Availability Zones (AZs) in a given AWS Region. Ensuring these characteristics are in place for your Amazon EKS environment will enhance the overall reliability of your system. In conjunction with this, your EKS environments will likely also be composed of a variety of constructs (i.e. VPCs), components (i.e. ELBs), and integrations (i.e. ECR and other container registries). </p> <p>The combination of highly available systems and other use-case specific components can play a significant role in how data is transferred and processed. This will in turn have an impact on the costs incurred due to data transfer and processing. </p> <p>The practices detailed below will help you design and optimize your EKS environments in order to achieve cost-effectiveness for different domains and use cases.</p>"},{"location":"cost_optimization/cost_opt_networking/#pod-to-pod-communication","title":"Pod to Pod Communication","text":"<p>Depending on your setup, network communication and data transfer between Pods can have a significant impact on the overall cost of running Amazon EKS workloads. This section will cover different concepts and approaches to mitigating the costs tied to inter-pod communication, while considering highly available (HA) architectures, application performance and resilience. </p>"},{"location":"cost_optimization/cost_opt_networking/#restricting-traffic-to-an-availability-zone","title":"Restricting Traffic to an Availability Zone","text":"<p>Frequent egress cross-zone traffic (traffic distributed between AZs) can have a major impact on your network-related costs. Below are some strategies on how to control the amount of cross-zone traffic between Pods in your EKS cluster. </p> <p>If you want granular visibility into the amount of cross-zone traffic between Pods in your cluster (such as the amount of data transferred in bytes), refer to this post.</p> <p>Using Topology Aware Routing (formerly known as Topology Aware Hints)</p> <p></p> <p>When using topology aware routing, it's important to understand how Services, EndpointSlices and the <code>kube-proxy</code> work together when routing traffic. As the diagram above depicts, Services are the stable network abstraction layer that receive traffic destined for your Pods. When a Service is created, multiple EndpointSlices are created. Each EndpointSlice has a list of endpoints containing a subset of Pod addresses along with the nodes they're running on and any additional topology information. <code>kube-proxy</code> is a daemonset that runs on every node in your cluster and also fulfills a role of internal routing, but it does so based on what it consumes from the created EndpointSlices.</p> <p>When topology aware routing is enabled and implemented on a Kubernetes Service, the EndpointSlice controller will proportionally allocate endpoints to the different zones that your cluster is spread across. For each of those endpoints, the EndpointSlice controller will also set a hint for the zone. Hints describe which zone an endpoint should serve traffic for. <code>kube-proxy</code> will then route traffic from a zone to an endpoint based on the hints that get applied. </p> <p>The diagram below shows how EndpointSlices with hints are organized in such a way that <code>kube-proxy</code> can know what destination they should go to based on their zonal point of origin. Without hints, there is no such allocation or organization and traffic will be proxied to different zonal destinations regardless of where it\u2019s coming from. </p> <p></p> <p>In some cases, the EndpointSlice controller may apply a hint for a different zone, meaning the endpoint could end up serving traffic originating from a different zone. The reason for this is to try and maintain an even distribution of traffic between endpoints in different zones.</p> <p>Below is a code snippet on how to enable topology aware routing for a Service. </p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: orders-service\n  namespace: ecommerce\n    annotations:\n      service.kubernetes.io/topology-mode: Auto\nspec:\n  selector:\n    app: orders\n  type: ClusterIP\n  ports:\n  - protocol: TCP\n    port: 3003\n    targetPort: 3003\n</code></pre> <p>The screenshot below shows the result of the EndpointSlice controller having successfully applied a hint to an endpoint for a Pod replica running in the AZ <code>eu-west-1a</code>. </p> <p></p> <p>Note</p> <p>It\u2019s important to note that topology aware routing is still in beta. Also, this feature is more predictable when workloads are widely and evenly distributed across the cluster topology. Therefore, it is highly recommended to use it in conjunction with scheduling constraints that increase the availability of an application such as pod topology spread constraints.</p> <p>Using Autoscalers: Provision Nodes to a Specific AZ</p> <p>We strongly recommend running your workloads in highly available environments across multiple AZs. This improves the reliability of your applications, especially when there is an incident of an issue with an AZ. In the case you're willing to sacrifice reliability for the sake of reducing their network-related costs, you can restrict your nodes to a single AZ. </p> <p>To run all your Pods in the same AZ, either provision the worker nodes in the same AZ or schedule the Pods on the worker nodes running on the same AZ. To provision nodes within a single AZ, define a node group with subnets belonging to the same AZ with Cluster Autoscaler (CA). For Karpenter, use \u201ctopology.kubernetes.io/zone\u201d and specify the AZ where you\u2019d like to create the worker nodes. For example, the below Karpenter provisioner snippet provisions the nodes in the us-west-2a AZ.</p> <p>Karpenter</p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\nname: single-az\nspec:\n  requirements:\n  - key: \"topology.kubernetes.io/zone\u201c\n    operator: In\n    values: [\"us-west-2a\"]\n</code></pre> <p>Cluster Autoscaler (CA)</p> <pre><code>apiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\nmetadata:\n  name: my-ca-cluster\n  region: us-east-1\n  version: \"1.21\"\navailabilityZones:\n- us-east-1a\nmanagedNodeGroups:\n- name: managed-nodes\n  labels:\n    role: managed-nodes\n  instanceType: t3.medium\n  minSize: 1\n  maxSize: 10\n  desiredCapacity: 1\n...\n</code></pre> <p>Using Pod Assignment and Node Affinity</p> <p>Alternatively, if you have worker nodes running in multiple AZs, each node would have the label topology.kubernetes.io/zone with the value of its AZ (such as us-west-2a or us-west-2b). You can utilize <code>nodeSelector</code> or <code>nodeAffinity</code> to schedule Pods to the nodes in a single AZ. For example, the following manifest file will schedule the Pod inside a node running in AZ us-west-2a.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  labels:\n    env: test\nspec:\n  nodeSelector:\n    topology.kubernetes.io/zone: us-west-2a\n  containers:\n  - name: nginx\n    image: nginx \n    imagePullPolicy: IfNotPresent\n</code></pre>"},{"location":"cost_optimization/cost_opt_networking/#restricting-traffic-to-a-node","title":"Restricting Traffic to a Node","text":"<p>There are cases where restricting traffic at a zonal level isn\u2019t sufficient. Apart from reducing costs, you may have the added requirement of reducing network latency between certain applications that have frequent inter-communication. In order to achieve optimal network performance and reduce costs, you need a way to restrict traffic to a specific node. For example, Microservice A should always talk to Microservice B on Node 1, even in highly available (HA) setups. Having Microservice A on Node 1 talk to Microservice B on Node 2 may have a negative impact on the desired performance for applications of this nature, especially if Node 2 is in a separate AZ altogether. </p> <p>Using the Service Internal Traffic Policy</p> <p>In order to restrict Pod network traffic to a node, you can make use of the Service internal traffic policy. By default, traffic sent to a workload\u2019s Service will be randomly distributed across the different generated endpoints. So in a HA architecture, that means traffic from Microservice A could go to any replica of Microservice B on any given node across the different AZs. However, with the Service's internal traffic policy set to <code>Local</code>, traffic will be restricted to endpoints on the node that the traffic originated from. This policy dictates the exclusive use of node-local endpoints. By implication, your network traffic-related costs for that workload will be lower than if the distribution was cluster wide. Also, the latency will be lower, making your application more performant. </p> <p>Note</p> <p>It\u2019s important to note that this feature cannot be combined with topology aware routing in Kubernetes.</p> <p></p> <p>Below is a code snippet on how to set the internal traffic policy for a Service. </p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: orders-service\n  namespace: ecommerce\nspec:\n  selector:\n    app: orders\n  type: ClusterIP\n  ports:\n  - protocol: TCP\n    port: 3003\n    targetPort: 3003\n  internalTrafficPolicy: Local\n</code></pre> <p>To avoid unexpected behaviour from your application due to traffic drops, you should consider the following approaches:</p> <ul> <li>Run enough replicas for each of the communicating Pods</li> <li>Have a relatively even spread of Pods using topology spread constraints</li> <li>Make use of pod-affinity rules for co-location of communicating Pods</li> </ul> <p>In this example, you have 2 replicas of Microservice A and 3 replicas of Microservice B. If Microservice A has its replicas spread between Nodes 1 and 2, and Microservice B has all 3 of its replicas on Node 3, then they won't be able to communicate because of the <code>Local</code> internal traffic policy. When there are no available node-local endpoints the traffic is dropped. </p> <p></p> <p>If Microservice B does have 2 of its 3 replicas on Nodes 1 and 2, then there will be communication between the peer applications. But you would still have an isolated replica of Microservice B without any peer replica to communicate with. </p> <p></p> <p>Note</p> <p>In some scenarios, an isolated replica like the one depicted in the above diagram may not be a cause for concern if it still serves a purpose (such as serving requests from external incoming traffic).</p> <p>Using the Service Internal Traffic Policy with Topology Spread Constraints</p> <p>Using the internal traffic policy in conjunction with topology spread constraints can be useful to ensure that you have the right number of replicas for communicating microservices on different nodes. </p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: express-test\nspec:\n  replicas: 6\n  selector:\n    matchLabels:\n      app: express-test\n  template:\n    metadata:\n      labels:\n        app: express-test\n        tier: backend\n    spec:\n      topologySpreadConstraints:\n      - maxSkew: 1\n        topologyKey: \"topology.kubernetes.io/zone\"\n        whenUnsatisfiable: ScheduleAnyway\n        labelSelector:\n          matchLabels:\n            app: express-test\n</code></pre> <p>Using the Service Internal Traffic Policy with Pod Affinity Rules</p> <p>Another approach is to make use of Pod affinity rules when using the Service internal traffic policy. With Pod affinity, you can influence the scheduler to co-locate certain Pods because of their frequent communication. By applying strict scheduling constraints (<code>requiredDuringSchedulingIgnoredDuringExecution</code>) on certain Pods, this will give you better results for Pod co-location when the Scheduler is placing Pods on nodes.</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: graphql\n  namespace: ecommerce\n  labels:\n    app.kubernetes.io/version: \"0.1.6\"\n    ...\n    spec:\n      serviceAccountName: graphql-service-account\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n          - labelSelector:\n              matchExpressions:\n              - key: app\n                operator: In\n                values:\n                - orders\n            topologyKey: \"kubernetes.io/hostname\"\n</code></pre>"},{"location":"cost_optimization/cost_opt_networking/#load-balancer-to-pod-communication","title":"Load Balancer to Pod Communication","text":"<p>EKS workloads are typically fronted by a load balancer that distributes traffic to the relevant Pods in your EKS cluster. Your architecture may comprise internal and/or external facing load balancers. Depending on your architecture and network traffic configurations, the communication between load balancers and Pods can contribute a significant amount to data transfer charges.</p> <p>You can use the AWS Load Balancer Controller to automatically manage the creation of ELB resources (ALB and NLB). The data transfer charges you incur in such setups will depend on the path taken by the network traffic. The AWS Load Balancer Controller supports two network traffic modes, instance mode, and ip mode.</p> <p>When using instance mode, a NodePort will be opened on each node in your EKS cluster. The load balancer will then proxy traffic evenly across the nodes. If a node has the destination Pod running on it, then there will be no data transfer costs incurred. However, if the destination Pod is on a separate node and in a different AZ than the NodePort receiving the traffic, then there will be an extra network hop from the kube-proxy to the destination Pod. In such a scenario, there will be cross-AZ data transfer charges. Because of the even distribution of traffic across the nodes, it is highly likely that there will be additional data transfer charges associated with cross-zone network traffic hops from kube-proxies to the relevant destination Pods.</p> <p>The diagram below depicts a network path for traffic flowing from the load balancer to the NodePort, and subsequently from the <code>kube-proxy</code> to the destination Pod on a separate node in a different AZ. This is an example of the instance mode setting. </p> <p></p> <p>When using ip mode, network traffic is proxied from the load balancer directly to the destination Pod. As a result, there are no data transfer charges involved in this approach. </p> <p>Tip</p> <p>It is recommended that you set your load balancer to ip traffic mode to reduce data transfer charges. For this setup, it\u2019s also important to make sure that your load balancer is deployed across all the subnets in your VPC. </p> <p>The diagram below depicts network paths for traffic flowing from the load balancer to Pods in the network ip mode. </p> <p></p>"},{"location":"cost_optimization/cost_opt_networking/#data-transfer-from-container-registry","title":"Data Transfer from Container Registry","text":""},{"location":"cost_optimization/cost_opt_networking/#amazon-ecr","title":"Amazon ECR","text":"<p>Data transfer into the Amazon ECR private registry is free. In-region data transfer incurs no cost, but data transfer out to the internet and across regions will be charged at Internet Data Transfer rates on both sides of the transfer. </p> <p>You should utilize ECRs built-in image replication feature to replicate the relevant container images into the same region as your workloads. This way the replication would be charged once, and all the same region (intra-region) image pulls would be free.</p> <p>You can further reduce data transfer costs associated with pulling images from ECR (data transfer out) by using Interface VPC Endpoints to connect to the in-region ECR repositories. The alternative approach of connecting to ECR\u2019s public AWS endpoint (via a NAT Gateway and an Internet Gateway) will incur higher data processing and transfer costs. The next section will cover reducing data transfer costs between your workloads and AWS Services in greater detail. </p> <p>If you\u2019re running workloads with especially large images, you can build your own custom Amazon Machine Images (AMIs) with pre-cached container images. This can reduce the initial image pull time and potential data transfer costs from a container registry to the EKS worker nodes. </p>"},{"location":"cost_optimization/cost_opt_networking/#data-transfer-to-internet-aws-services","title":"Data Transfer to Internet &amp; AWS Services","text":"<p>It's a common practice to integrate Kubernetes workloads with other AWS services or third-party tools and platforms via the Internet. The underlying network infrastructure used to route traffic to and from the relevant destination can impact the costs incurred in the data transfer process.</p>"},{"location":"cost_optimization/cost_opt_networking/#using-nat-gateways","title":"Using NAT Gateways","text":"<p>NAT Gateways are network components that perform network address translation (NAT). The diagram below depicts Pods in an EKS cluster communicating with other AWS services (Amazon ECR, DynamoDB, and S3), and third-party platforms. In this example, the Pods are running in private subnets in separate AZs. To send and receive traffic from the Internet, a NAT Gateway is deployed to the public subnet of one AZ, allowing any resources with private IP addresses to share a single public IP address to access the Internet. This NAT Gateway in turn communicates with the Internet Gateway component, allowing for packets to be sent to their final destination.</p> <p></p> <p>When using NAT Gateways for such use cases, you can minimize the data transfer costs by deploying a NAT Gateway in each AZ. This way, traffic routed to the Internet will go through the NAT Gateway in the same AZ, avoiding inter-AZ data transfer. However, even though you\u2019ll save on the cost of inter-AZ data transfer, the implication of this setup is that you\u2019ll incur the cost of an additional NAT Gateway in your architecture. </p> <p>This recommended approach is depicted in the diagram below.</p> <p></p>"},{"location":"cost_optimization/cost_opt_networking/#using-vpc-endpoints","title":"Using VPC Endpoints","text":"<p>To further reduce costs in such architectures, you should use VPC Endpoints to establish connectivity between your workloads and AWS services. VPC Endpoints allow you to access AWS services from within a VPC without data/network packets traversing the Internet. All traffic is internal and stays within the AWS network. There are two types of VPC Endpoints: Interface VPC Endpoints (supported by many AWS services) and Gateway VPC Endpoints (only supported by S3 and DynamoDB).</p> <p>Gateway VPC Endpoints</p> <p>There are no hourly or data transfer costs associated with Gateway VPC Endpoints. When using Gateway VPC Endpoints, it's important to note that they are not extendable across VPC boundaries. They can't be used in VPC peering, VPN networking, or via Direct Connect.</p> <p>Interface VPC Endpoint</p> <p>VPC Endpoints have an hourly charge and, depending on the AWS service, may or may not have an additional charge associated with data processing via the underlying ENI. To reduce inter-AZ data transfer costs related to Interface VPC Endpoints, you can create a VPC Endpoint in each AZ. You can create multiple VPC Endpoints in the same VPC even if they're pointing to the same AWS service.</p> <p>The diagram below shows Pods communicating with AWS services via VPC Endpoints.</p> <p></p>"},{"location":"cost_optimization/cost_opt_networking/#data-transfer-between-vpcs","title":"Data Transfer between VPCs","text":"<p>In some cases, you may have workloads in distinct VPCs (within the same AWS region) that need to communicate with each other. This can be accomplished by allowing traffic to traverse the public internet through Internet Gateways attached to the respective VPCs. Such communication can be enabled by deploying infrastructure components like EC2 instances, NAT Gateways or NAT instances in public subnets. However, a setup including these components will incur charges for processing/transferring data in and out of the VPCs. If the traffic to and from the separate VPCs is moving across AZs, then there will be an additional charge in the transfer of data. The diagram below depicts a setup that uses NAT Gateways and Internet Gateways to establish communication between workloads in different VPCs. </p> <p></p>"},{"location":"cost_optimization/cost_opt_networking/#vpc-peering-connections","title":"VPC Peering Connections","text":"<p>To reduce costs for such use cases, you can make use of VPC Peering. With a VPC Peering connection, there are no data transfer charges for network traffic that stays within the same AZ. If traffic crosses AZs, there will be a cost incurred. Nonetheless, the VPC Peering approach is recommended for cost-effective communication between workloads in separate VPCs within the same AWS region. However, it\u2019s important to note that VPC peering is primarily effective for 1:1 VPC connectivity because it doesn\u2019t allow for transitive networking. </p> <p>The diagram below is a high-level representation of workloads communication via a VPC peering connection. </p> <p></p>"},{"location":"cost_optimization/cost_opt_networking/#transitive-networking-connections","title":"Transitive Networking Connections","text":"<p>As pointed out in the previous section, VPC Peering connections do not allow for transitive networking connectivity. If you want to connect 3 or more VPCs with transitive networking requirements, then you should use a Transit Gateway (TGW). This will enable you to overcome the limits of VPC Peering or any operational overhead associated with having multiple VPC Peering connections between multiple VPCs. You are billed on an hourly basis and for data sent to the TGW. There is no destination cost associated with inter-AZ traffic that flows through the TGW.</p> <p>The diagram below shows inter-AZ traffic flowing through a TGW between workloads in different VPCs but within the same AWS region.</p> <p></p>"},{"location":"cost_optimization/cost_opt_networking/#using-a-service-mesh","title":"Using a Service Mesh","text":"<p>Service meshes offer powerful networking capabilities that can be used to reduce network related costs in your EKS cluster environments. However, you should carefully consider the operational tasks and complexity that a service mesh will introduce to your environment if you adopt one. </p>"},{"location":"cost_optimization/cost_opt_networking/#restricting-traffic-to-availability-zones","title":"Restricting Traffic to Availability Zones","text":"<p>Using Istio\u2019s Locality Weighted Distribution</p> <p>Istio enables you to apply network policies to traffic after routing occurs. This is done using Destination Rules such as locality weighted distribution. Using this feature, you can control the weight (expressed as a percentage) of traffic that can go to a certain destination based on its origin. The source of this traffic can either be from an external (or public facing) load balancer or a Pod within the cluster itself. When all the Pod endpoints are available, the locality will be selected based on a weighted round-robin load balancing algorithm. In the case that certain endpoints are unhealthy or unavailable, the locality weight will be automatically adjusted to reflect this change in the available endpoints. </p> <p>Note</p> <p>Before implementing locality weighted distribution, you should start by understanding your network traffic patterns and the implications that the Destination Rule policy may have on your application\u2019s behaviour. As such, it\u2019s important to have distributed tracing mechanisms in place with tools such as AWS X-Ray or Jaeger. </p> <p>The Istio Destination Rules detailed above can also be applied to manage traffic from a load balancer to Pods in your EKS cluster. Locality weighted distribution rules can be applied to a Service that receives traffic from a highly available load balancer (specifically the Ingress Gateway). These rules allow you to control how much traffic goes where based on its zonal origin - the load balancer in this case. If configured correctly, less egress cross-zone traffic will be incurred compared to a load balancer that distributes traffic evenly or randomly to Pod replicas in different AZs. </p> <p>Below is a code block example of a Destination Rule resource in Istio. As can be seen below, this resource specifies weighted configurations for incoming traffic from 3 different AZs in the <code>eu-west-1</code> region. These configurations declare that a majority of the incoming traffic (70% in this case) from a given AZ should be proxied to a destination in the same AZ from which it originates. </p> <pre><code>apiVersion: networking.istio.io/v1beta1\nkind: DestinationRule\nmetadata:\n  name: express-test-dr\nspec:\n  host: express-test.default.svc.cluster.local\n  trafficPolicy:\n    loadBalancer:                        \n      localityLbSetting:\n        distribute:\n        - from: eu-west-1/eu-west-1a/    \n          to:\n            \"eu-west-1/eu-west-1a/*\": 70 \n            \"eu-west-1/eu-west-1b/*\": 20\n            \"eu-west-1/eu-west-1c/*\": 10\n        - from: eu-west-1/eu-west-1b/*    \n          to:\n            \"eu-west-1/eu-west-1a/*\": 20 \n            \"eu-west-1/eu-west-1b/*\": 70\n            \"eu-west-1/eu-west-1c/*\": 10\n        - from: eu-west-1/eu-west-1c/*    \n          to:\n            \"eu-west-1/eu-west-1a/*\": 20 \n            \"eu-west-1/eu-west-1b/*\": 10\n            \"eu-west-1/eu-west-1c/*\": 70**\n    connectionPool:\n      http:\n        http2MaxRequests: 10\n        maxRequestsPerConnection: 10\n    outlierDetection:\n      consecutiveGatewayErrors: 1\n      interval: 1m\n      baseEjectionTime: 30s\n</code></pre> <p>Note</p> <p>The minimum weight that can be distributed destination is 1%. The reason for this is to maintain failover regions and zones in the case that the endpoints in the main destination become unhealthy or unavailable.</p> <p>The diagram below depicts a scenario in which there is a highly available load balancer in the eu-west-1 region and locality weighted distribution is applied. The Destination Rule policy for this diagram is configured to send 60% of traffic coming from eu-west-1a to Pods in the same AZ, whereas 40% of the traffic from eu-west-1a should go to Pods in eu-west-1b. </p> <p></p>"},{"location":"cost_optimization/cost_opt_networking/#restricting-traffic-to-availability-zones-and-nodes","title":"Restricting Traffic to Availability Zones and Nodes","text":"<p>Using the Service Internal Traffic Policy with Istio</p> <p>To mitigate network costs associated with external incoming traffic and internal traffic between Pods, you can combine Istio\u2019s Destination Rules and the Kubernetes Service internal traffic policy.  The way to combine Istio destination rules with the service internal traffic policy will largely depend on 3 things:</p> <ul> <li>The role of the microservices</li> <li>Network traffic patterns across the microservices</li> <li>How the microservices should be deployed across the Kubernetes cluster topology</li> </ul> <p>The diagram below shows what the network flow would look like in the case of a nested request and how the aforementioned policies would control the traffic.</p> <p></p> <ol> <li>The end user makes a request to APP A, which in turn makes a nested request to APP C. This request is first sent to a highly available load balancer, which has instances in AZ 1 and AZ 2 as the above diagram shows.</li> <li>The external incoming request is then routed to the correct destination by the Istio Virtual Service.</li> <li>After the request is routed, the Istio Destination Rule controls how much traffic goes to the respective AZs based on where it originated from (AZ 1 or AZ 2). </li> <li>The traffic then goes to the Service for APP A, and is then proxied to the respective Pod endpoints. As shown in the diagram, 80% of the incoming traffic is sent to Pod endpoints in AZ 1, and 20% of the incoming traffic is sent to AZ 2.</li> <li>APP A then makes an internal request to APP C. APP C's Service has an internal traffic policy enabled (<code>internalTrafficPolicy``: Local</code>). </li> <li>The internal request from APP A (on NODE 1) to APP C is successful because of the available node-local endpoint for APP C. </li> <li>The internal request from APP A (on NODE 3) to APP C fails because there are no available node-local endpoints for APP C. As the diagram shows, APP C has no replicas on NODE 3. **** </li> </ol> <p>The screenshots below are captured from a live example of this approach. The first set of screenshots demonstrate a successful external request to a <code>graphql</code> and a successful nested request from the <code>graphql</code> to a co-located <code>orders</code> replica on the node <code>ip-10-0-0-151.af-south-1.compute.internal</code>. </p> <p> </p> <p>With Istio, you can verify and export the statistics of any upstream clusters and endpoints that your proxies are aware of. This can help provide a picture of the network flow as well as the share of distribution among the services of a workload. Continuing with the same example, the <code>orders</code> endpoints that the <code>graphql</code> proxy is aware of can be obtained using the following command:</p> <pre><code>kubectl exec -it deploy/graphql -n ecommerce -c istio-proxy -- curl localhost:15000/clusters | grep orders \n</code></pre> <pre><code>...\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_error::0**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_success::119**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_timeout::0**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_total::119**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**health_flags::healthy**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**region::af-south-1**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**zone::af-south-1b**\n...\n</code></pre> <p>In this case, the <code>graphql</code> proxy is only aware of the <code>orders</code> endpoint for the replica that it shares a node with. If you remove the <code>internalTrafficPolicy: Local</code> setting from the orders Service, and re-run a command like the one above, then the results will return all the endpoints of the replicas spread across the different nodes. Furthermore, by examining the <code>rq_total</code> for the respective endpoints, you'll notice a relatively even share in network distribution. Consequently, if the endpoints are associated with upstream services running in different AZs, then this network distribution across zones will result in higher costs.</p> <p>As mentioned in a previous section above, you can co-locate frequently communicating Pods by making use of pod-affinity.</p> <pre><code>...\nspec:\n...\n  template:\n    metadata:\n      labels:\n        app: graphql\n        role: api\n        workload: ecommerce\n    spec:\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n          - labelSelector:\n              matchExpressions:\n              - key: app\n                operator: In\n                values:\n                - orders\n            topologyKey: \"kubernetes.io/hostname\"\n      nodeSelector:\n        managedBy: karpenter\n        billing-team: ecommerce\n...\n</code></pre> <p>When the <code>graphql</code> and <code>orders</code> replicas don't co-exist on the same node (<code>ip-10-0-0-151.af-south-1.compute.internal</code>), the first request to <code>graphql</code> is successful as noted by the <code>200 response code</code> in the Postman screenshot below, whereas the second nested request from <code>graphql</code> to <code>orders</code> fails with a <code>503 response code</code>. </p> <p> </p>"},{"location":"cost_optimization/cost_opt_networking/#additional-resources","title":"Additional Resources","text":"<ul> <li>Addressing latency and data transfer costs on EKS using Istio</li> <li>Exploring the effect of Topology Aware Hints on network traffic in Amazon Elastic Kubernetes Service</li> <li>Getting visibility into your Amazon EKS Cross-AZ pod to pod network bytes</li> <li>Optimize AZ Traffic with Istio</li> <li>Optimize AZ Traffic with Topology Aware Routing</li> <li>Optimize Kubernetes Cost &amp; Performance with Service Internal Traffic Policy</li> <li>Optimize Kubernetes Cost &amp; Performance with Istio and Service Internal Traffic Policy</li> <li>Overview of Data Transfer Costs for Common Architectures </li> <li>Understanding data transfer costs for AWS container services</li> </ul>"},{"location":"cost_optimization/cost_opt_observability/","title":"Cost Optimization - Observability","text":""},{"location":"cost_optimization/cost_opt_observability/#introduction","title":"Introduction","text":"<p>Observability tools help you efficiently detect, remediate and investigate your workloads. The cost of telemetry data naturally increases as your use of EKS increases. At times, it can be challenging to balance your operational needs and measuring what matters to your business and keeping observability costs in check. This guide focuses on cost optimization strategies for the three pillars of observability: logs, metrics and traces. Each of these best practices can be applied independently to fit your organization\u2019s optimization goals. </p>"},{"location":"cost_optimization/cost_opt_observability/#logging","title":"Logging","text":"<p>Logging plays a vital role in monitoring and troubleshooting the applications in your cluster. There are several strategies that can be employed to optimize logging costs. The best practice strategies listed below include examining your log retention policies to implement granular controls on how long log data is kept, sending log data to different storage options based on importance, and utilizing log filtering to narrow down the types of logs messages that are stored. Efficiently managing log telemetry can lead to cost savings for your environments.</p>"},{"location":"cost_optimization/cost_opt_observability/#eks-control-plane","title":"EKS Control Plane","text":""},{"location":"cost_optimization/cost_opt_observability/#optimize-your-control-plane-logs","title":"Optimize Your Control Plane Logs","text":"<p>The Kubernetes control plane is a set of components that manage the clusters and these components send different types of information as log streams to a log group in Amazon CloudWatch. While there are benefits to enabling all control plane log types, you should be aware of the information in each log and the associated costs to storing all the log telemetry. You are charged for the standard CloudWatch Logs data ingestion and storage costs for logs sent to Amazon CloudWatch Logs from your clusters. Before enabling them, evaluate whether each log stream is necessary. </p> <p>For example, in non-production clusters, selectively enable specific log types, such as the api server logs, only for analysis and deactivate afterward. But for production clusters, where you might not be able to reproduce events, and resolving issues requires more log information, then you can enable all log types. Further control plane cost optimization implementation details are in this blog post. </p>"},{"location":"cost_optimization/cost_opt_observability/#stream-logs-to-s3","title":"Stream Logs to S3","text":"<p>Another cost optimization best practice is streaming control plane logs to S3 via CloudWatch Logs subscriptions. Leveraging CloudWatch Logs subscriptions allows you to selectively forward logs to S3 which provides more cost efficient long term storage compared to retaining logs indefinitely in CloudWatch. For example, for production clusters, you can create a critical log group and leverage subscriptions to stream these logs to S3 after 15 days. This will ensure you have have quick access to the logs for analysis but also save on cost by moving logs to a more cost efficient storage.</p> <p>Attention</p> <p>As of 9/5/2023 EKS logs are classified as Vended Logs in Amazon CloudWatch Logs. Vended Logs are specific AWS service logs natively published by AWS services on behalf of the customer and available at volume discount pricing. Please visit the Amazon CloudWatch pricing page to learn more about Vended Logs pricing.</p>"},{"location":"cost_optimization/cost_opt_observability/#eks-data-plane","title":"EKS Data Plane","text":""},{"location":"cost_optimization/cost_opt_observability/#log-retention","title":"Log Retention","text":"<p>Amazon CloudWatch\u2019s default retention policy is to keep logs indefinitely and never expire, incurring storage costs applicable to your AWS region. In order to reduce the storage costs, you can customize the retention policy for each log group based on your workload requirements.</p> <p>In a development environment, a lengthy retention period may not be necessary. But in a production environment, you can set a longer retention policy to meet troubleshooting, compliance, and capacity planning requirements. For example, if you are running an e-commerce application during the peak holiday season the system is under heavier load and issues can arise that may not be immediately noticeable, you will want to set a longer log retention for detailed troubleshooting and post event analysis. </p> <p>You can configure your retention periods in the AWS CloudWatch console or AWS API with the duration from 1 day to 10 years based on each log group. Having a flexible retention period can save log storage costs, while also maintaining critical logs.</p>"},{"location":"cost_optimization/cost_opt_observability/#log-storage-options","title":"Log Storage Options","text":"<p>Storage is a large driver of observability costs therefore it is crucial to optimize your log storage strategy. Your strategies should align with your workloads requirements while maintaining performance and scalability. One strategy to reduce the costs of storing logs is to leverage AWS S3 buckets and its different storage tiers.</p>"},{"location":"cost_optimization/cost_opt_observability/#forward-logs-directly-to-s3","title":"Forward logs directly to S3","text":"<p>Consider forwarding less critical logs, such as development environments, directly to S3 instead of Cloudwatch. This can have an immediate impact on log storage costs. One option is to forward the logs straight to S3 using Fluentbit. You define this in the <code>[OUTPUT]</code> section, the destination where FluentBit transmits container logs for retention. Review additional configurations parameter here.</p> <pre><code>[OUTPUT]\n        Name eks_to_s3\n        Match application.* \n        bucket $S3_BUCKET name\n        region us-east-2\n        store_dir /var/log/fluentbit\n        total_file_size 30M\n        upload_timeout 3m\n</code></pre>"},{"location":"cost_optimization/cost_opt_observability/#forward-logs-to-cloudwatch-only-for-short-term-analysis","title":"Forward logs to CloudWatch only for short term analysis","text":"<p>For more critical logs, such as a production environments where you might need to perform immediate analysis on the data, consider forwarding the logs to CloudWatch. You define this in the <code>[OUTPUT]</code> section, the destination where FluentBit transmits container logs for retention. Review additional configurations parameter here.</p> <pre><code>[OUTPUT]\n        Name eks_to_cloudwatch_logs\n        Match application.*\n        region us-east-2\n        log_group_name fluent-bit-cloudwatch\n        log_stream_prefix from-fluent-bit-\n        auto_create_group On\n</code></pre> <p>However, this will not have an instant affect on your cost savings. For additional savings, you will have to export these logs to Amazon S3.</p>"},{"location":"cost_optimization/cost_opt_observability/#export-to-amazon-s3-from-cloudwatch","title":"Export to Amazon S3 from CloudWatch","text":"<p>For storing Amazon CloudWatch logs long term, we recommend exporting your Amazon EKS CloudWatch logs to Amazon Simple Storage Service (Amazon S3). You can forward the logs to Amazon S3 bucket by creating an export task via the Console or the API. After you have done so, Amazon S3 presents many options to further reduce cost. You can define your own Amazon S3 Lifecycle rules to move your logs to a storage class that a fits your needs, or leverage the Amazon S3 Intelligent-Tiering storage class to have AWS automatically move data to long-term storage based on your usage pattern. Please refer to this blog for more details. For example, for your production environment logs reside in CloudWatch for more than 30 days then exported to Amazon S3 bucket. You can then use Amazon Athena to query the data in Amazon S3 bucket if you need to refer back to the logs at a later time.</p>"},{"location":"cost_optimization/cost_opt_observability/#reduce-log-levels","title":"Reduce Log Levels","text":"<p>Practice selective logging for your application. Both your applications and nodes output logs by default. For your application logs, adjust the log levels to align with the criticality of the workload and environment. For example, the java application below is outputting <code>INFO</code> logs which is the typical default application configuration and depending on the code can result in a high volume of log data.</p> <pre><code>import org.apache.log4j.*;\n\npublic class LogClass {\n   private static org.apache.log4j.Logger log = Logger.getLogger(LogClass.class);\n\n   public static void main(String[] args) {\n      log.setLevel(Level.INFO);\n\n      log.debug(\"This is a DEBUG message, check this out!\");\n      log.info(\"This is an INFO message, nothing to see here!\");\n      log.warn(\"This is a WARN message, investigate this!\");\n      log.error(\"This is an ERROR message, check this out!\");\n      log.fatal(\"This is a FATAL message, investigate this!\");\n   }\n}\n</code></pre> <p>In a development environment, change your log level to <code>DEBUG</code>, as this can help you debug issues or catch potential ones before they get into production.</p> <pre><code>      log.setLevel(Level.DEBUG);\n</code></pre> <p>In a production environment, consider modifying your log level to <code>ERROR</code> or <code>FATAL</code>. This will output log only when your application has errors, reducing the log output and help you focus on important data about your application status.</p> <pre><code>      log.setLevel(Level.ERROR);\n</code></pre> <p>You can fine tune various Kubernetes components log levels. For example, if you are using Bottlerocket as your EKS Node operating system, there are configuration settings that allow you to adjust the kubelet process log level. A snippet of this configuration setting is below. Note the default log level of 2 which adjusts the logging verbosity of the <code>kubelet</code> process. </p> <pre><code>[settings.kubernetes]\nlog-level = \"2\"\nimage-gc-high-threshold-percent = \"85\"\nimage-gc-low-threshold-percent = \"80\"\n</code></pre> <p>For a development environment, you can set the log level greater than 2 in order to view additional events, this is good for debugging. For a production environment, you can set the level to 0 in order to view only critical events.</p>"},{"location":"cost_optimization/cost_opt_observability/#leverage-filters","title":"Leverage Filters","text":"<p>When using a default EKS Fluentbit configuration to send container logs to Cloudwatch, FluentBit captures and send ALL application container logs enriched with Kubernetes metadata to Cloudwatch as shown in the <code>[INPUT]</code> configuration block below. </p> <pre><code>    [INPUT]\n        Name                tail\n        Tag                 application.*\n        Exclude_Path        /var/log/containers/cloudwatch-agent*, /var/log/containers/fluent-bit*, /var/log/containers/aws-node*, /var/log/containers/kube-proxy*\n        Path                /var/log/containers/*.log\n        Docker_Mode         On\n        Docker_Mode_Flush   5\n        Docker_Mode_Parser  container_firstline\n        Parser              docker\n        DB                  /var/fluent-bit/state/flb_container.db\n        Mem_Buf_Limit       50MB\n        Skip_Long_Lines     On\n        Refresh_Interval    10\n        Rotate_Wait         30\n        storage.type        filesystem\n        Read_from_Head      ${READ_FROM_HEAD}\n</code></pre> <p>The <code>[INPUT]</code> section above is ingesting all the container logs. This can generate a large amount of data that might not be necessary. Filtering out this data can reduce the amount of log data sent to CloudWatch therefore reducing your cost. You can apply a filter to you logs before it outputs to CloudWatch. Fluentbit defines this in the <code>[FILTER]</code> section. For example, filtering out the Kubernetes metadata from being appended to log events can reduce your log volume.</p> <pre><code>    [FILTER]\n        Name                nest\n        Match               application.*\n        Operation           lift\n        Nested_under        kubernetes\n        Add_prefix          Kube.\n\n    [FILTER]\n        Name                modify\n        Match               application.*\n        Remove              Kube.&lt;Metadata_1&gt;\n        Remove              Kube.&lt;Metadata_2&gt;\n        Remove              Kube.&lt;Metadata_3&gt;\n\n    [FILTER]\n        Name                nest\n        Match               application.*\n        Operation           nest\n        Wildcard            Kube.*\n        Nested_under        kubernetes\n        Remove_prefix       Kube.\n</code></pre>"},{"location":"cost_optimization/cost_opt_observability/#metrics","title":"Metrics","text":"<p>Metrics provide valuable information regarding the performance of your system. By consolidating all system-related or available resource metrics in a centralized location, you gain the capability to compare and analyze performance data. This centralized approach enables you to make more informed strategic decisions, such as scaling up or scaling down resources. Additionally, metrics play a crucial role in assessing the health of resources, allowing you to take proactive measures when necessary. Generally observability costs scale with telemetry data collection and retention. Below are a few strategies you can implement to reduce the cost of metric telemetry: collecting only metrics that matter, reducing the cardinality of your telemetry data, and fine tuning the granularity of your telemetry data collection. </p>"},{"location":"cost_optimization/cost_opt_observability/#monitor-what-matters-and-collect-only-what-you-need","title":"Monitor what matters and collect only what you need","text":"<p>The first cost reduction strategy is to reduce the number of metrics you are collecting and in turn, reduce retention costs. </p> <ol> <li>Begin by working backwards from your and/or your stakeholder\u2019s requirements to determine the metrics that are most important. Success metrics are different for everyone! Know what good looks like and measure for it.</li> <li>Consider diving deep into the workloads you are supporting and identifying its Key Performance Indicators (KPIs) a.k.a 'Golden Signals'. These should align to business and stake-holder requirements. Calculating SLIs, SLOs, and SLAs using Amazon CloudWatch and Metric Math is crucial for managing service reliability. Follow the best practices outlined in this guide to effectively monitor and maintain the performance of your EKS environment.  </li> <li>Then continue through the different layers of infrastructure to connect and correlate EKS cluster, node and additional infrastructure metrics to your workload KPIs. Store your business metrics and operational metrics in a system where you can correlate them together and draw conclusions based on observed impacts to both.</li> <li>EKS exposes metrics from the control plane, cluster kube-state-metrics, pods, and nodes. The relevance of all these metrics is dependent on your needs, however it\u2019s likely that you will not need every single metric across the different layers. You can use this EKS essential metrics guide as a baseline for monitoring the overall health of an EKS cluster and your workloads. </li> </ol> <p>Here is an example prometheus scrape config where we are using the <code>relabel_config</code> to keep only kubelet metrics and <code>metric_relabel_config</code> to drop all container metrics. </p> <pre><code>  kubernetes_sd_configs:\n  - role: endpoints\n    namespaces:\n      names:\n      - kube-system\n  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  tls_config:\n    insecure_skip_verify: true\n  relabel_configs:\n  - source_labels: [__meta_kubernetes_service_label_k8s_app]\n    regex: kubelet\n    action: keep\n\n  metric_relabel_configs:\n  - source_labels: [__name__]\n    regex: container_(network_tcp_usage_total|network_udp_usage_total|tasks_state|cpu_load_average_10s)\n    action: drop\n</code></pre>"},{"location":"cost_optimization/cost_opt_observability/#reduce-cardinality-where-applicable","title":"Reduce cardinality where applicable","text":"<p>Cardinality refers to the uniqueness of the data values in combination with its dimensions (eg. prometheus labels) for a specific metrics set. High cardinality metrics have many dimensions and each dimension metric combination has higher uniqueness. Higher cardinality results in larger metric telemetry data size and storage needs which increases cost. </p> <p>In the high cardinality example below, we see that the Metric, Latency, has Dimensions, RequestID, CustomerID, and Service and each Dimension has many unique values. Cardinality is the measure of the combination of the number of possible values per Dimension. In Prometheus, each set of unique dimensions/labels are consider as a new metric, therefore high cardinality means more metrics. </p> <p></p> <p>In EKS environments with many metrics and dimensions/labels per metric (Cluster, Namespace, Service, Pod, Container, etc), the cardinality tends to grow. In order to optimize cost, consider the cardinality of the metrics you are collecting carefully. For example, if you are aggregating a specific metric for visualization at the cluster level, then you can drop additional labels that are at a lower layer such as the namespace label. </p> <p>In order to identify high cardinality metrics in prometheus you can run the following PROMQL query to determine which scrape targets have the highest number of metrics (cardinality): </p> <pre><code>topk_max(5, max_over_time(scrape_samples_scraped[1h]))\n</code></pre> <p>and the following PROMQL query can help you determine which scrape targets have the highest metrics churn (how many new metrics series were created in a given scrape) rates :</p> <pre><code>topk_max(5, max_over_time(scrape_series_added[1h]))\n</code></pre> <p>If you are using grafana you can use Grafana Lab\u2019s Mimirtool to analyze your grafana dashboards and prometheus rules to identify unused high-cardinality metrics. Follow this guide on how to use the <code>mimirtool analyze</code> and <code>mimirtool analyze prometheus</code> commands to identify active metrics which are not referenced in your dashboards. </p>"},{"location":"cost_optimization/cost_opt_observability/#consider-metric-granularity","title":"Consider metric granularity","text":"<p>Collecting metrics at a higher granularity like every second vs every minute can have a big impact on how much telemetry is collected and stored which increases cost. Determine sensible scrape or metrics collection intervals that balance between enough granularity to see transient issues and low enough to be cost effective. Decrease granularity for metrics that are used for capacity planning and larger time window analysis. </p> <p>Below is a snippet from the default AWS Distro for Opentelemetry (ADOT) EKS Addon Collector configuration. </p> <p>Attention</p> <p>the global prometheus scrape interval is set to 15s. This scrape interval can be increased resulting in a decrease in the amount of metric data collected in prometheus. </p> <pre><code>apiVersion: opentelemetry.io/v1alpha1\nkind: OpenTelemetryCollector\nmetadata:\n  name: my-collector-amp\n\n...\n\n  config: |\n    extensions:\n      sigv4auth:\n        region: \"&lt;YOUR_AWS_REGION&gt;\"\n        service: \"aps\"\n\n    receivers:\n      #\n      # Scrape configuration for the Prometheus Receiver\n      # This is the same configuration used when Prometheus is installed using the community Helm chart\n      # \n      prometheus:\n        config:\n          global:\n  scrape_interval: 15s\n            scrape_timeout: 10s\n</code></pre>"},{"location":"cost_optimization/cost_opt_observability/#tracing","title":"Tracing","text":"<p>The primary cost associated with tracing stem from trace storage generation. With tracing, the aim is to gather sufficient data to diagnose and understand performance aspects. However, as X-Ray traces costs are based on data forwarded to to X-Ray, erasing traces after it has been forward will not reduce your costs. Let\u2019s review ways to lower your costs for tracing while maintaining data for you to perform proper analysis. </p>"},{"location":"cost_optimization/cost_opt_observability/#apply-sampling-rules","title":"Apply Sampling rules","text":"<p>The X-Ray sampling rate is conservative by default. Define sampling rules where you can control the amount of data that you gather. This will improve performance efficiency while reducing costs. By decreasing the sampling rate, you can collect traces from the request only what your workloads needs while maintaining a lower cost structure. </p> <p>For example, you have java application that you want to debug the traces of all the requests for 1 problematic route.</p> <p>Configure via the SDK to load sampling rules from a JSON document</p> <pre><code>{\n\"version\": 2,\n  \"rules\": [\n    {\n\"description\": \"debug-eks\",\n      \"host\": \"*\",\n      \"http_method\": \"PUT\",\n      \"url_path\": \"/history/*\",\n      \"fixed_target\": 0,\n      \"rate\": 1,\n      \"service_type\": \"debug-eks\"\n    }\n  ],\n  \"default\": {\n\"fixed_target\": 1,\n    \"rate\": 0.1\n  }\n}\n</code></pre> <p>Via the Console</p> <p></p>"},{"location":"cost_optimization/cost_opt_observability/#apply-tail-sampling-with-aws-distro-for-opentelemetry-adot","title":"Apply Tail Sampling with AWS Distro for OpenTelemetry (ADOT)","text":"<p>ADOT Tail Sampling allows you to control the volume of traces ingested in the service. However, Tail Sampling allows you to define the sampling policies after all the spans in the request have been completed instead of at the beginning. This further limits the amount of raw data transferred to CloudWatch, hence reducing cost.</p> <p>For example, if you\u2019re sampling 1% of traffic to a landing page and 10% of the requests to a payment page this might leave you with 300 traces for an 30 minute period. With an ADOT Tail Sampling rule of that filters specific errors, you could be left with 200 traces which decreases the number of traces stored. </p> <pre><code>processors:\n  groupbytrace:\n    wait_duration: 10s\n    num_traces: 300 \n    tail_sampling:\n    decision_wait: 1s # This value should be smaller than wait_duration\n    policies:\n      - ..... # Applicable policies**\n  batch/tracesampling:\n    timeout: 0s # No need to wait more since this will happen in previous processors\n    send_batch_max_size: 8196 # This will still allow us to limit the size of the batches sent to subsequent exporters\n\nservice:\n  pipelines:\n    traces/tailsampling:\n      receivers: [otlp]\n      processors: [groupbytrace, tail_sampling, batch/tracesampling]\n      exporters: [awsxray]\n</code></pre>"},{"location":"cost_optimization/cost_opt_observability/#leverage-amazon-s3-storage-options","title":"Leverage Amazon S3 Storage options","text":"<p>You should leverage AWS S3 bucket and its different storage classes to store the traces. Export traces to S3 before the retention period expires. Use Amazon S3 Lifecycle rules to move the trace data to the storage class that meets your requirements. </p> <p>For example, if you have traces that are 90 days old, Amazon S3 Intelligent-Tiering can automatically move the data to long-term storage based on your usage pattern. You can use Amazon Athena to query the data in Amazon S3 if you need to refer back to the traces at a later time. This can further reduce your cost for distributed tracing.</p>"},{"location":"cost_optimization/cost_opt_observability/#additional-resources","title":"Additional Resources:","text":"<ul> <li>Observability Best Practices Guide</li> <li>Best Practices Metrics Collection</li> <li>AWS re:Invent 2022 - Observability best practices at Amazon (COP343)</li> <li>AWS re:Invent 2022 - Observability: Best practices for modern applications (COP344)</li> </ul>"},{"location":"cost_optimization/cost_opt_storage/","title":"Cost Optimization - Storage","text":""},{"location":"cost_optimization/cost_opt_storage/#overview","title":"Overview","text":"<p>There are scenarios where you may want to run applications that need to preserve data for a short or long term basis. For such use cases, volumes can be defined and mounted by Pods so that their containers can tap into different storage mechanisms. Kubernetes supports different types of volumes for ephemeral and persistent storage. The choice of storage largely depends on application requirements. For each approach, there are cost implications, and the practices detailed below which will help you accomplish cost efficiency for workloads needing some form of storage in your EKS environments. </p>"},{"location":"cost_optimization/cost_opt_storage/#ephemeral-volumes","title":"Ephemeral Volumes","text":"<p>Ephemeral volumes are for applications that require transient local volumes but don't require data to be persisted after restarts. Examples of this include requirements for scratch space, caching, and read-only input data like configuration data and secrets. You can find more details of Kubernetes ephemeral volumes here. Most of ephemeral volumes (e.g. emptyDir, configMap, downwardAPI, secret, hostpath) are backed by locally-attached writable devices (usually the root disk) or RAM, so it's important to choose the most cost efficient and performant host volume. </p>"},{"location":"cost_optimization/cost_opt_storage/#using-ebs-volumes","title":"Using EBS Volumes","text":"<p>We recommend starting with gp3 as the host root volume. It is the latest general purpose SSD volume offered by Amazon EBS and also offers a lower price (up to 20%) per GB compared to gp2 volumes. </p>"},{"location":"cost_optimization/cost_opt_storage/#using-amazon-ec2-instance-stores","title":"Using Amazon EC2 Instance Stores","text":"<p>Amazon EC2 instance stores provide temporary block-level storage for your EC2 instances. The storage provided by EC2 instance stores is accessible through disks that are physically attached to the hosts. Unlike Amazon EBS, you can only attach instance store volumes when the instance is launched, and these volumes only exist during the lifetime of the instance. They cannot be detached and re-attached to other instances. You can learn more about Amazon EC2 instance stores here. There are no additional fees associated with an instance store volume. This makes them (instance store volumes) more cost efficient than the the general EC2 instances with large EBS volumes. </p> <p>To use local store volumes in Kubernetes, you should partition, configure, and format the disks using the Amazon EC2 user-data so that volumes can be mounted as a HostPath in the pod spec. Alternatively, you can leverage the Local Persistent Volume Static Provisioner to simplify local storage management. The Local Persistent Volume static provisioner allows you to access local instance store volumes through the standard Kubernetes PersistentVolumeClaim (PVC) interface. Furthermore, it will provision PersistentVolumes (PVs) that contains node affinity information to schedule Pods to the correct nodes. Although it uses Kubernetes PersistentVolumes, EC2 instance store volumes are ephemeral in nature. Data written to ephemeral disks is only available during the instance\u2019s lifetime. When the instance is terminated, so is the data. Please refer to this blog for more details.</p> <p>Keep in mind that when using Amazon EC2 instance store volumes, the total IOPS limit is shared with the host and it binds Pods to a specific host. You should thoroughly review your workload requirements before adopting Amazon EC2 instance store volumes.</p>"},{"location":"cost_optimization/cost_opt_storage/#persistent-volumes","title":"Persistent Volumes","text":"<p>Kubernetes is typically associated with running stateless applications. However, there are scenarios where you may want to run microservices that need to preserve persistent data or information from one request to the next. Databases are a common example for such use cases. However, Pods, and the containers or processes inside them, are ephemeral in nature. To persist data beyond the lifetime of a Pod, you can use PVs to define access to storage at a specific location that is independent from the Pod. The costs associated with PVs is highly dependent on the type of storage being used and how applications are consuming it. </p> <p>There are different types of storage options that support Kubernetes PVs on Amazon EKS listed here. The storage options covered below are Amazon EBS, Amazon EFS, Amazon FSx for Lustre, Amazon FSx for NetApp ONTAP.</p>"},{"location":"cost_optimization/cost_opt_storage/#amazon-elastic-block-store-ebs-volumes","title":"Amazon Elastic Block Store (EBS) Volumes","text":"<p>Amazon EBS volumes can be consumed as Kubernetes PVs to provide block-level storage volumes. These are well suited for databases that rely on random reads &amp; writes and throughput-intensive applications that perform long, continuous reads and writes. The Amazon Elastic Block Store Container Storage Interface (CSI) driver allows Amazon EKS clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes. The Container Storage Interface enables and facilitates interaction between Kubernetes and a storage system. When a CSI driver is deployed to your EKS cluster, you can access it\u2019s capabilities through the native Kubernetes storage resources such as Persistent Volumes (PVs), Persistent Volume Claims (PVCs) and Storage Classes (SCs). This link provides practical examples of how to interact with Amazon EBS volumes with Amazon EBS CSI driver.</p>"},{"location":"cost_optimization/cost_opt_storage/#choosing-the-right-volume","title":"Choosing the right volume","text":"<p>We recommend using the latest generation of block storage (gp3) as it provides the right balance between price and performance. It also allows you to scale volume IOPS and throughput independently of volume size without needing to provision additional block storage capacity. If you\u2019re currently using gp2 volumes, we highly recommend migrating to gp3 volumes. This blog explains how to migrate from gp2 on gp3 on Amazon EKS clusters. </p> <p>When you have applications that require higher performance and need volumes larger than what a single gp3 volume can support, you should consider using io2 block express. This type of storage is ideal for your largest, most I/O intensive, and mission critical deployment such as SAP HANA or other large databases with low latency requirements. Keep in mind that an instance's EBS performance is bounded by the instance's performance limits, so not all the instances support io2 block express volumes. You can check the supported instance types and other considerations in this doc. </p> <p>A single gp3 volume can support up to up to 16,000 max IOPS, 1,000 MiB/s max throughput, max 16TiB. The latest generation of Provisioned IOPS SSD volume that provides up to 256,000 IOPS, 4,000 MiB/s, throughput, and 64TiB.</p> <p>Among these options, you should best tailor your storage performance and cost to the needs of your applications.</p>"},{"location":"cost_optimization/cost_opt_storage/#monitor-and-optimize-over-time","title":"Monitor and optimize over time","text":"<p>It's important to understand your application's baseline performance and monitor it for selected volumes to check if it's meeting your requirements/expectations or if it's over-provisioned (e.g. a scenario where provisioned IOPS are not being fully utilized). </p> <p>Instead of allocating a large volume from the beginning, you can gradually increase the size of the volume as you accumulate data. You can dynamically re-size volumes using the volume resizing feature in the Amazon Elastic Block Store CSI driver (aws-ebs-csi-driver). Keep in mind that you can only increase the EBS volume size.</p> <p>To identify and remove any dangling EBS volumes, you can use AWS trusted advisor\u2019s cost optimization category. This feature helps you identify unattached volumes or volumes with very low write activity for a period of time. There is a cloud-native open-source, read-only tool called Popeye that scans live Kubernetes clusters and reports potential issues with deployed resources and configurations. For example, it can scan for unused PVs and PVCs and check whether they are bound or whether there is any volume mount error.</p> <p>For a deep dive on monitoring, please refer to the EKS cost optimization observability guide.  </p> <p>One other option you can consider is the AWS Compute Optimizer Amazon EBS volume recommendations. This tool automatically identifies the optimal volume configuration and correct level of performance needed. For example, it can be used for optimal settings pertaining to provisioned IOPS, volume sizes, and types of EBS volumes based on the maximum utilization during the past 14 days. It also quantifies the potential monthly cost savings derived from its recommendations. You can review this blog for more details.</p>"},{"location":"cost_optimization/cost_opt_storage/#backup-retention-policy","title":"Backup retention policy","text":"<p>You can back up the data on your Amazon EBS volumes by taking point-in-time snapshots. The Amazon EBS CSI driver supports volume snapshots. You can learn how to create a snapshot and restore an EBS PV using the steps outlined here. </p> <p>Subsequent snapshots are incremental backups, meaning that only the blocks on the device that have changed after your most recent snapshot are saved. This minimizes the time required to create the snapshot and saves on storage costs by not duplicating data. However, growing the number of old EBS snapshots without a proper retention policy can cause unexpected costs when operating at scale. If you\u2019re directly backing up Amazon EBS volumes through AWS API, you can leverage Amazon Data Lifecycle Manager (DLM) that provides an automated, policy-based lifecycle management solution for Amazon Elastic Block Store (EBS) Snapshots and EBS-backed Amazon Machine Images (AMIs). The console makes it easier to automate the creation, retention, and deletion of EBS Snapshots and AMIs. </p> <p>Note</p> <p>There is currently no way to make use of Amazon DLM via the Amazon EBS CSI driver.</p> <p>In a Kubernetes environment, you can leverage an open-source tool called Velero to backup your EBS Persistent Volumes. You can set a TTL flag when scheduling the job to expire backups. Here is a guide from Velero as an example. </p>"},{"location":"cost_optimization/cost_opt_storage/#amazon-elastic-file-system-efs","title":"Amazon Elastic File System (EFS)","text":"<p>Amazon Elastic File System (EFS) is a serverless, fully elastic file system that lets you share file data using standard file system interface and file system semantics for a broad spectrum of workloads and applications. Examples of workloads and applications include Wordpress and Drupal, developer tools like JIRA and Git, and shared notebook system such as Jupyter as well as home directories.</p> <p>One of main benefits of Amazon EFS is that it can be mounted by multiple containers spread across multiple nodes and multiple availability zones. Another benefit is that you only pay for the storage you use. EFS file systems will automatically grow and shrink as you add and remove files which eliminates the need for capacity planning. </p> <p>To use Amazon EFS in Kubernetes, you need to use the Amazon Elastic File System Container Storage Interface (CSI) Driver, aws-efs-csi-driver. Currently, the driver can dynamically create access points. However, the Amazon EFS file system has to be provisioned first and provided as an input to the Kubernetes storage class parameter. </p>"},{"location":"cost_optimization/cost_opt_storage/#choosing-the-right-efs-storage-class","title":"Choosing the right EFS storage class","text":"<p>Amazon EFS offers four storage classes. </p> <p>Two standard storage classes:</p> <ul> <li>Amazon EFS Standard </li> <li>Amazon EFS Standard-Infrequent Access (EFS Standard-IA) </li> </ul> <p>Two one-zone storage classes: </p> <ul> <li>Amazon EFS One Zone </li> <li>Amazon EFS One Zone-Infrequent Access (EFS One Zone-IA)</li> </ul> <p>The Infrequent Access (IA) storage classes are cost-optimized for files that are not accessed every day. With Amazon EFS lifecycle management, you can move files that have not been accessed for the duration of the lifecycle policy (7, 14, 30, 60, or 90 days) to the IA storage classes which can reduce the storage cost by up to 92 percent compared to EFS Standard and EFS One Zone storage classes respectively. </p> <p>With EFS Intelligent-Tiering, lifecycle management monitors the access patterns of your file system and automatically move files to the most optimal storage class. </p> <p>Note</p> <p>aws-efs-csi-driver currently doesn\u2019t have a control on changing storage classes, lifecycle management or Intelligent-Tiering. Those should be setup manually in the AWS console or through the EFS APIs.</p> <p>Note</p> <p>aws-efs-csi-driver isn\u2019t compatible with Window-based container images.</p> <p>Note</p> <p>There is a known memory issue when vol-metrics-opt-in (to emit volume metrics) is enabled due to the DiskUsage function that consumes an amount of memory that is proportional to the size of your filesystem. Currently, we recommend to disable the <code>--vol-metrics-opt-in</code> option on large filesystems to avoid consuming too much memory. Here is a github issue link for more details.</p>"},{"location":"cost_optimization/cost_opt_storage/#amazon-fsx-for-lustre","title":"Amazon FSx for Lustre","text":"<p>Lustre is a high-performance parallel file system commonly used in workloads requiring throughput up to hundreds of GB/s and sub-millisecond per-operation latencies. It\u2019s used for scenarios such as machine learning training, financial modeling, HPC, and video processing. Amazon FSx for Lustre provides a fully managed shared storage with the scalability and performance, seamlessly integrated with Amazon S3. </p> <p>You can use Kubernetes persistent storage volumes backed by FSx for Lustre using the FSx for Lustre CSI driver from Amazon EKS or your self-managed Kubernetes cluster on AWS. See the Amazon EKS documentation for more details and examples. </p>"},{"location":"cost_optimization/cost_opt_storage/#link-to-amazon-s3","title":"Link to Amazon S3","text":"<p>It's recommended to link a highly durable long-term data repository residing on Amazon S3 with your FSx for Lustre file system. Once linked, large datasets are lazy-loaded as needed from Amazon S3 to FSx for Lustre file systems. You can also run your analyses and your results back to S3, and then delete your [Lustre] file system. </p>"},{"location":"cost_optimization/cost_opt_storage/#choosing-the-right-deployment-and-storage-options","title":"Choosing the right deployment and storage options","text":"<p>FSx for Lustre provides different deployment options. The first option is called scratch and it doesn\u2019t replicate data, while the second option is called persistent which, as the name implies, persists data. </p> <p>The first option (scratch) can be used to reduce the cost of temporary shorter-term data processing. The persistent deployment option is designed for longer-term storage that automatically replicates data within an AWS Availability Zone. It also supports both SSD and HDD storage. </p> <p>You can configure the desired deployment type under parameters in the FSx for lustre filesystem\u2019s Kubernetes StorageClass. Here is an link that provides sample templates.</p> <p>Note</p> <p>For latency-sensitive workloads or workloads requiring the highest levels of IOPS/throughput, you should choose SSD storage. For throughput-focused workloads that aren\u2019t latency-sensitive, you should choose HDD storage.</p>"},{"location":"cost_optimization/cost_opt_storage/#enable-data-compression","title":"Enable data compression","text":"<p>You can also enable data compression on your file system by specifying \u201cLZ4\u201d as the Data Compression Type. Once it\u2019s enabled, all newly-written files will be automatically compressed on FSx for Lustre before they are written to disk and uncompressed when they are read. LZ4 data compression algorithm is lossless so the original data can be fully reconstructed from the compressed data. </p> <p>You can configure the data compression type as LZ4 under parameters in the FSx for lustre filesystem\u2019s Kubernetes StorageClass. Compression is disabled when the value is set to NONE, which is default. This link provides sample templates.</p> <p>Note</p> <p>Amazon FSx for Lustre isn\u2019t compatible with Window-based container images.</p>"},{"location":"cost_optimization/cost_opt_storage/#amazon-fsx-for-netapp-ontap","title":"Amazon FSx for NetApp ONTAP","text":"<p>Amazon FSx for NetApp ONTAP is a fully managed shared storage built on NetApp\u2019s ONTAP file system. FSx for ONTAP provides feature-rich, fast, and flexible shared file storage that\u2019s broadly accessible from Linux, Windows, and macOS compute instances running in AWS or on premises. </p> <p>Amazon FSx for NetApp ONTAP supports two tiers of storage: 1/primary tier and 2/capacity pool tier. </p> <p>The primary tier is a provisioned, high-performance SSD-based tier for active, latency-sensitive data. The fully elastic capacity pool tier is cost-optimized for infrequently accessed data, automatically scales as data is tiered to it, and offers virtually unlimited petabytes of capacity. You can enable data compression and deduplication on capacity pool storage and further reduce the amount of storage capacity your data consumes. NetApp\u2019s native, policy-based FabricPool feature continually monitors data access patterns, automatically transferring data bidirectionally between storage tiers to optimize performance and cost.</p> <p>NetApp's Astra Trident provides dynamic storage orchestration using a CSI driver which allows Amazon EKS clusters to manage the lifecycle of persistent volumes PVs backed by Amazon FSx for NetApp ONTAP file systems. To get started, see Use Astra Trident with Amazon FSx for NetApp ONTAP in the Astra Trident documentation.</p>"},{"location":"cost_optimization/cost_opt_storage/#other-considerations","title":"Other considerations","text":""},{"location":"cost_optimization/cost_opt_storage/#minimize-the-size-of-container-image","title":"Minimize the size of container image","text":"<p>Once containers are deployed, container images are cached on the host as multiple layers. By reducing the size of images, the amount of storage required on the host can be reduced. </p> <p>By using slimmed-down base images such as scratch images or distroless container images (that contain only your application and its runtime dependencies) from the beginning, you can reduce storage cost in addition to other ancillary benefits such as a reducing the attack surface area and shorter image pull times.</p> <p>You should also consider using open source tools, such as Slim.ai that provides an easy, secure way to create minimal images.</p> <p>Multiple layers of packages, tools, application dependencies, libraries can easily bloat the container image size. By using multi-stage builds, you can selectively copy artifacts from one stage to another, excluding everything that isn\u2019t necessary from the final image. You can check more image-building best practices here. </p> <p>Another thing to consider is how long to persist cached images. You may want to clean up the stale images from the image cache when a certain amount of disk is utilized. Doing so will help make sure you have enough space for the host\u2019s operation. By default, the kubelet performs garbage collection on unused images every five minutes and on unused containers every minute. </p> <p>To configure options for unused container and image garbage collection, tune the kubelet using a configuration file and change the parameters related to garbage collection using the <code>KubeletConfiguration</code> resource type. </p> <p>You can learn more about it in the Kubernetes documentation. </p>"},{"location":"cost_optimization/cost_optimization_index/","title":"Amazon EKS Best Practices Guide for Cost Optimization","text":"<p>Cost Optimization is achieving your business outcomes at the lowest price point. By following the documentation in this guide you will optimize your Amazon EKS workloads.</p>"},{"location":"cost_optimization/cost_optimization_index/#general-guidelines","title":"General Guidelines","text":"<p>In the cloud, there are a number of general guidelines that can help you achieve cost optimization of your microservices: + Ensure that workloads running on Amazon EKS are independent of specific infrastructure types for running your containers, this will give greater flexibility with regards to running them on the least expensive types of infrastructure. While using Amazon EKS with EC2, there can be exceptions when we have workloads that require specific type of EC2 Instance types like requiring a GPU or  other instance types, due to the nature of the workload. + Select optimally profiled container instances \u2014 profile your production or pre-production environments and monitor critical metrics like CPU and memory, using services like Amazon CloudWatch Container Insights for Amazon EKS or third party tools that are available in the Kubernetes ecosystem. This will ensure that we can allocate the right amount of resources and avoid  wastage of resources. + Take advantage of the different purchasing options that are available in AWS for running EKS with EC2, e.g. On-Demand, Spot and Savings Plan.</p>"},{"location":"cost_optimization/cost_optimization_index/#eks-cost-optimization-best-practices","title":"EKS Cost Optimization Best Practices","text":"<p>There are three general best practice areas for cost optimization in the cloud:</p> <ul> <li>Cost-effective resources (Auto Scaling, Down Scaling, Policies and Purchasing Options)</li> <li>Expenditure awareness (Using AWS and third party tools)</li> <li>Optimizing over time (Right Sizing)</li> </ul> <p>As with any guidance there are trade-offs. Ensure you work with your organization to understand the priorities for this workload and which best practices are most important. </p>"},{"location":"cost_optimization/cost_optimization_index/#how-to-use-this-guide","title":"How to use this guide","text":"<p>This guide is meant for devops teams who are responsible for implementing and managing the EKS clusters and the workloads they support. The guide is organized into different best practice areas for easier consumption. Each topic has a list of recommendations, tools to use and best practices for cost optimization of your EKS clusters. The topics do not need to read in a particular order.</p>"},{"location":"cost_optimization/cost_optimization_index/#key-aws-services-and-kubernetes-features","title":"Key AWS Services and Kubernetes features","text":"<p>Cost optimization is supported by the following AWS services and features: + EC2 Instance types, Savings Plan (and Reserved Instances) and Spot Instances, at different prices. + Auto Scaling along with Kubernetes native Auto Scaling policies. Consider Savings Plan (Previously Reserved Instances) for predictable workloads. Use managed data stores like EBS and EFS, for elasticity and durability of the application data. + The Billing and Cost Management console dashboard along with AWS Cost Explorer provides an overview of your AWS usage. Use AWS Organizations for granular billing details. Details of several third party tools have also been shared. + Amazon CloudWatch Container Metrics provides metrics around usage of resources by the EKS cluster. In addition to the Kubernetes dashboard, there are several tools in the Kubernetes ecosystem that can be used to reduce wastage.</p> <p>This guide includes a set of recommendations that you can use to improve the cost optimization of your Amazon EKS cluster.</p>"},{"location":"cost_optimization/cost_optimization_index/#feedback","title":"Feedback","text":"<p>This guide is being released on GitHub so as to collect direct feedback and suggestions from the broader EKS/Kubernetes community. If you have a best practice that you feel we ought to include in the guide, please file an issue or submit a PR in the GitHub repository. Our intention is to update the guide periodically as new features are added to the service or when a new best practice evolves.</p>"},{"location":"cost_optimization/optimizing/","title":"Optimizing over time (Right Sizing)","text":"<p>Right Sizing as per the AWS Well-Architected Framework, is \u201c\u2026 using the lowest cost resource that still meets the technical specifications of a specific workload\u201d.</p> <p>When you specify the resource <code>requests</code> for the Containers in a Pod, the scheduler uses this information to decide which node to place the Pod on. When you specify a resource <code>limits</code> for a Container, the kubelet enforces those limits so that the running container is not allowed to use more of that resource than the limit you set. The details of how Kubernetes manages resources for containers are given in the documentation.</p> <p>In Kubernetes, this means setting the right compute resources (CPU and memory are collectively referred to as compute resources) - setting the resource <code>requests</code> that align as close as possible to the actual utilization. The tools for getting the actual resource usags of Pods are given in the section on Rexommendations below.</p> <p>Amazon EKS on AWS Fargate: When pods are scheduled on Fargate, the vCPU and memory reservations within the pod specification determine how much CPU and memory to provision for the pod.  If you do not specify a vCPU and memory combination, then the smallest available combination is used (.25 vCPU and 0.5 GB memory). The list of vCPU and memory combinations that are available for pods running on Fargate are listed in the Amazon EKS User Guide. </p> <p>Amazon EKS on EC2: When you create a Pod, you can specify how much of each resource like CPU and Memory, a Container needs. It is important we do not over-provision (which will lead to wastage) or under-provision (will lead to throttling) the resources allocated to the containers. </p>"},{"location":"cost_optimization/optimizing/#recommendations","title":"Recommendations","text":""},{"location":"cost_optimization/optimizing/#use-tools-to-help-you-allocate-resources-based-on-observed-data","title":"Use tools to help you allocate resources based on observed data","text":"<p>There are tools like kube resource report which can help with right sizing of pods deployed on Amazon EKS with EC2 nodes.</p> <p>Deployment steps for kube resource report: <pre><code>$ git clone https://github.com/hjacobs/kube-resource-report\n$ cd kube-resource-report\n$ helm install kube-resource-report ./unsupported/chart/kube-resource-report\n$ helm status kube-resource-report\n$ export POD_NAME=$(kubectl get pods --namespace default -l \"app.kubernetes.io/name=kube-resource-report,app.kubernetes.io/instance=kube-resource-report\" -o jsonpath=\"{.items[0].metadata.name}\")\n$ echo \"Visit http://127.0.0.1:8080 to use your application\"\n$ kubectl port-forward $POD_NAME 8080:8080\n</code></pre> Screenshots from a sample reports from this tool:</p> <p></p> <p></p> <p></p> <p>FairwindsOps Goldilocks: The FairwindsOps Goldilocks is a tool that creates a Vertical Pod Autoscaler (VPA) for each deployment in a namespace and then queries them for information. Once the VPAs are in place, we see recommendations appear in the Goldilocks dashboard.</p> <p>Deploy the Vertical Pod Autoscaler as per the documentation.</p> <p>Enable Namespace - Pick an application namespace and label it like so in order to see some data, in the following example we are specifying the default namespace:</p> <pre><code>$ kubectl label ns default goldilocks.fairwinds.com/enabled=true\n</code></pre> <p>Viewing the Dashboard - The default installation creates a ClusterIP service for the dashboard. You can access via port forward:</p> <pre><code>$ kubectl -n goldilocks port-forward svc/goldilocks-dashboard 8080:80\n</code></pre> <p>Then open your browser to http://localhost:8080</p> <p></p>"},{"location":"cost_optimization/optimizing/#use-application-profiling-tools-like-cloudwatch-container-insights-and-prometheus-metrics-in-amazon-cloudwatch","title":"Use Application Profiling tools like CloudWatch Container Insights and Prometheus Metrics in Amazon CloudWatch","text":"<p>Use CloudWatch Container Insights to see how you can use native CloudWatch features to monitor your EKS Cluster performance. You can use CloudWatch Container Insights to collect, aggregate, and summarize metrics and logs from your containerized applications and microservices running on Amazon Elastic Kubernetes Service. The metrics include utilization for resources such as CPU, memory, disk, and network - which can help with right-sizing Pods and save costs. </p> <p>Container Insights Prometheus Metrics Monitoring At present, support for Prometheus metrics is still in beta. CloudWatch Container Insights monitoring for Prometheus automates the discovery of Prometheus metrics from containerized systems and workloads. Prometheus is an open-source systems monitoring and alerting toolkit. All Prometheus metrics are collected in the ContainerInsights/Prometheus namespace. </p> <p>The Metrics provided by cAdvisor and kube-state-metrics can be used for monitoring pods on Amazon EKS on AWS Fargate using Prometheus and Grafana, which can then be used to implement requests in your containers. Please refer to this blog for more details. </p> <p>Right Size Guide: The right size guide (rsg) is a simple CLI tool that provides you with memory and CPU recommendations for your application. This tool works across container orchestrators, including Kubernetes and easy to deploy. </p> <p>By using tools like CloudWatch Container Insights, Kube Resource Report, Goldilocks and others, applications running in the Kubernetes cluster can be right sized and potentially lower your costs.</p>"},{"location":"cost_optimization/optimizing/#resources","title":"Resources","text":"<p>Refer to the following resources to learn more about best practices for cost optimization.</p>"},{"location":"cost_optimization/optimizing/#documentation-and-blogs","title":"Documentation and Blogs","text":"<ul> <li>Amazon EKS Workshop - Setting up EKS CloudWatch Container Insights </li> <li>Using Prometheus Metrics in Amazon CloudWatch</li> <li>Monitoring Amazon EKS on AWS Fargate using Prometheus and Grafana</li> </ul>"},{"location":"cost_optimization/optimizing/#tools","title":"Tools","text":"<ul> <li>Kube resource report</li> <li>Right size guide</li> <li>Fargate count</li> <li>FairwindsOps Goldilocks</li> <li>Choose Right Node Size</li> </ul>"},{"location":"karpenter/","title":"Karpenter Best Practices","text":""},{"location":"karpenter/#karpenter","title":"Karpenter","text":"<p>Karpenter is an open-source cluster autoscaler that automatically provisions new nodes in response to unschedulable pods. Karpenter evaluates the aggregate resource requirements of the pending pods and chooses the optimal instance type to run them. It will automatically scale-in or terminate instances that don\u2019t have any non-daemonset pods to reduce waste. It also supports a consolidation feature which will actively move pods around and either delete or replace nodes with cheaper versions to reduce cluster cost.</p> <p>Reasons to use Karpenter</p> <p>Before the launch of Karpenter, Kubernetes users relied primarily on Amazon EC2 Auto Scaling groups and the Kubernetes Cluster Autoscaler (CAS) to dynamically adjust the compute capacity of their clusters. With Karpenter, you don\u2019t need to create dozens of node groups to achieve the flexibility and diversity you get with Karpenter. Moreover, Karpenter is not as tightly coupled to Kubernetes versions (as CAS is) and doesn\u2019t require you to jump between AWS and Kubernetes APIs.</p> <p>Karpenter consolidates instance orchestration responsibilities within a single system, which is simpler, more stable and cluster-aware. Karpenter was designed to overcome some of the challenges presented by Cluster Autoscaler by providing simplified ways to:</p> <ul> <li>Provision nodes based on workload requirements.</li> <li>Create diverse node configurations by instance type, using flexible NodePool options. Instead of managing many specific custom node groups, Karpenter could let you manage diverse workload capacity with a single, flexible NodePool.</li> <li>Achieve improved pod scheduling at scale by quickly launching nodes and scheduling pods.</li> </ul> <p>For information and documentation on using Karpenter, visit the karpenter.sh site.</p>"},{"location":"karpenter/#recommendations","title":"Recommendations","text":"<p>Best practices are divided into sections on Karpenter itself, NodePools, and pod scheduling.</p>"},{"location":"karpenter/#karpenter-best-practices_1","title":"Karpenter best practices","text":"<p>The following best practices cover topics related to Karpenter itself.</p>"},{"location":"karpenter/#use-karpenter-for-workloads-with-changing-capacity-needs","title":"Use Karpenter for workloads with changing capacity needs","text":"<p>Karpenter brings scaling management closer to Kubernetes native APIs than do Autoscaling Groups (ASGs) and Managed Node Groups (MNGs). ASGs and MNGs are AWS-native abstractions where scaling is triggered based on AWS level metrics, such as EC2 CPU load. Cluster Autoscaler bridges the Kubernetes abstractions into AWS abstractions, but loses some flexibility because of that, such as scheduling for a specific availability zone.</p> <p>Karpenter removes a layer of AWS abstraction to bring some of the flexibility directly into Kubernetes. Karpenter is best used for clusters with workloads that encounter periods of high, spiky demand or have diverse compute requirements. MNGs and ASGs are good for clusters running workloads that tend to be more static and consistent.  You can use a mix of dynamically and statically managed nodes, depending on your requirements.</p>"},{"location":"karpenter/#consider-other-autoscaling-projects-when","title":"Consider other autoscaling projects when...","text":"<p>You need features that are still being developed in Karpenter. Because Karpenter is a relatively new project, consider other autoscaling projects for the time being if you have a need for features that are not yet part of Karpenter.</p>"},{"location":"karpenter/#run-the-karpenter-controller-on-eks-fargate-or-on-a-worker-node-that-belongs-to-a-node-group","title":"Run the Karpenter controller on EKS Fargate or on a worker node that belongs to a node group","text":"<p>Karpenter is installed using a Helm chart. The Helm chart installs the Karpenter controller and a webhook pod as a Deployment that needs to run before the controller can be used for scaling your cluster. We recommend a minimum of one small node group with at least one worker node. As an alternative, you can run these pods on EKS Fargate by creating a Fargate profile for the <code>karpenter</code> namespace. Doing so will cause all pods deployed into this namespace to run on EKS Fargate. Do not run Karpenter on a node that is managed by Karpenter.</p>"},{"location":"karpenter/#avoid-using-custom-launch-templates-with-karpenter","title":"Avoid using custom launch templates with Karpenter","text":"<p>Karpenter strongly recommends against using custom launch templates. Using custom launch templates prevents multi-architecture support, the ability to automatically upgrade nodes, and securityGroup discovery. Using launch templates may also cause confusion because certain fields are duplicated within Karpenter\u2019s NodePools while others are ignored by Karpenter, e.g. subnets and instance types.</p> <p>You can often avoid using launch templates by using custom user data and/or directly specifying custom AMIs in the AWS node template.  More information on how to do this is available at NodeClasses.</p>"},{"location":"karpenter/#exclude-instance-types-that-do-not-fit-your-workload","title":"Exclude instance types that do not fit your workload","text":"<p>Consider excluding specific instances types with the node.kubernetes.io/instance-type key if they are not required by workloads running in your cluster.</p> <p>The following example shows how to avoid provisioning large Graviton instances.</p> <pre><code>- key: node.kubernetes.io/instance-type\n  operator: NotIn\n  values:\n  - m6g.16xlarge\n  - m6gd.16xlarge\n  - r6g.16xlarge\n  - r6gd.16xlarge\n  - c6g.16xlarge\n</code></pre>"},{"location":"karpenter/#enable-interruption-handling-when-using-spot","title":"Enable Interruption Handling when using Spot","text":"<p>Karpenter supports native interruption handling, enabled through the <code>--interruption-queue-name</code> CLI argument with the name of the SQS queue. Interruption handling watches for upcoming involuntary interruption events that would cause disruption to your workloads such as:</p> <ul> <li>Spot Interruption Warnings</li> <li>Scheduled Change Health Events (Maintenance Events)</li> <li>Instance Terminating Events</li> <li>Instance Stopping Events</li> </ul> <p>When Karpenter detects one of these events will occur to your nodes, it automatically cordons, drains, and terminates the node(s) ahead of the interruption event to give the maximum amount of time for workload cleanup prior to interruption. It is not advised to use AWS Node Termination Handler alongside Karpenter as explained here.</p> <p>Pods that require checkpointing or other forms of graceful draining, requiring the 2-mins before shutdown should enable Karpenter interruption handling in their clusters.</p>"},{"location":"karpenter/#amazon-eks-private-cluster-without-outbound-internet-access","title":"Amazon EKS private cluster without outbound internet access","text":"<p>When provisioning an EKS Cluster into a VPC with no route to the internet, you have to make sure you\u2019ve configured your environment in accordance with the private cluster requirements that appear in EKS documentation. In addition, you need to make sure you\u2019ve created an STS VPC regional endpoint in your VPC. If not, you will see errors similar to those that appear below.</p> <pre><code>{\"level\":\"FATAL\",\"time\":\"2024-02-29T14:28:34.392Z\",\"logger\":\"controller\",\"message\":\"Checking EC2 API connectivity, WebIdentityErr: failed to retrieve credentials\\ncaused by: RequestError: send request failed\\ncaused by: Post \\\"https://sts.&lt;region&gt;.amazonaws.com/\\\": dial tcp 54.239.32.126:443: i/o timeout\",\"commit\":\"596ea97\"}\n</code></pre> <p>These changes are necessary in a private cluster because the Karpenter Controller uses IAM Roles for Service Accounts (IRSA). Pods configured with IRSA acquire credentials by calling the AWS Security Token Service (AWS STS) API. If there is no outbound internet access, you must create and use an AWS STS VPC endpoint in your VPC.</p> <p>Private clusters also require you to create a VPC endpoint for SSM. When Karpenter tries to provision a new node, it queries the Launch template configs and an SSM parameter. If you do not have a SSM VPC endpoint in your VPC, it will cause the following error:</p> <pre><code>{\"level\":\"ERROR\",\"time\":\"2024-02-29T14:28:12.889Z\",\"logger\":\"controller\",\"message\":\"Unable to hydrate the AWS launch template cache, RequestCanceled: request context canceled\\ncaused by: context canceled\",\"commit\":\"596ea97\",\"tag-key\":\"karpenter.k8s.aws/cluster\",\"tag-value\":\"eks-workshop\"}\n...\n{\"level\":\"ERROR\",\"time\":\"2024-02-29T15:08:58.869Z\",\"logger\":\"controller.nodeclass\",\"message\":\"discovering amis from ssm, getting ssm parameter \\\"/aws/service/eks/optimized-ami/1.27/amazon-linux-2/recommended/image_id\\\", RequestError: send request failed\\ncaused by: Post \\\"https://ssm.&lt;region&gt;.amazonaws.com/\\\": dial tcp 67.220.228.252:443: i/o timeout\",\"commit\":\"596ea97\",\"ec2nodeclass\":\"default\",\"query\":\"/aws/service/eks/optimized-ami/1.27/amazon-linux-2/recommended/image_id\"}\n</code></pre> <p>There is no VPC endpoint for the Price List Query API. As a result, pricing data will go stale over time. Karpenter gets around this by including on-demand pricing data in its binary, but only updates that data when Karpenter is upgraded. Failed requests for pricing data will result in the following error messages:</p> <pre><code>{\"level\":\"ERROR\",\"time\":\"2024-02-29T15:08:58.522Z\",\"logger\":\"controller.pricing\",\"message\":\"retreiving on-demand pricing data, RequestError: send request failed\\ncaused by: Post \\\"https://api.pricing.&lt;region&gt;.amazonaws.com/\\\": dial tcp 18.196.224.8:443: i/o timeout; RequestError: send request failed\\ncaused by: Post \\\"https://api.pricing.&lt;region&gt;.amazonaws.com/\\\": dial tcp 18.185.143.117:443: i/o timeout\",\"commit\":\"596ea97\"}\n</code></pre> <p>In summary, to use Karpenter in a completely Private EKS Clusters, you need to create the following VPC endpoints:</p> <pre><code>com.amazonaws.&lt;region&gt;.ec2\ncom.amazonaws.&lt;region&gt;.ecr.api\ncom.amazonaws.&lt;region&gt;.ecr.dkr\ncom.amazonaws.&lt;region&gt;.s3 \u2013 For pulling container images\ncom.amazonaws.&lt;region&gt;.sts \u2013 For IAM roles for service accounts\ncom.amazonaws.&lt;region&gt;.ssm - For resolving default AMIs\ncom.amazonaws.&lt;region&gt;.sqs - For accessing SQS if using interruption handling\n</code></pre> <p>Note</p> <p>Karpenter (controller and webhook deployment) container images must be in or copied to Amazon ECR private or to a another private registry accessible from inside the VPC. The reason for this is that the Karpenter controller and webhook pods currently use Public ECR images. If these are not available from within the VPC, or from networks peered with the VPC, you will get Image pull errors when Kubernetes tries to pull these images from ECR public.</p> <p>For further information, see Issue 988 and Issue 1157.</p>"},{"location":"karpenter/#creating-nodepools","title":"Creating NodePools","text":"<p>The following best practices cover topics related to creating NodePools.</p>"},{"location":"karpenter/#create-multiple-nodepools-when","title":"Create multiple NodePools when...","text":"<p>When different teams are sharing a cluster and need to run their workloads on different worker nodes, or have different OS or instance type requirements, create multiple NodePools. For example, one team may want to use Bottlerocket, while another may want to use Amazon Linux. Likewise, one team might have access to expensive GPU hardware that wouldn\u2019t be needed by another team. Using multiple NodePools makes sure that the most appropriate assets are available to each team.</p>"},{"location":"karpenter/#create-nodepools-that-are-mutually-exclusive-or-weighted","title":"Create NodePools that are mutually exclusive or weighted","text":"<p>It is recommended to create NodePools that are either mutually exclusive or weighted to provide consistent scheduling behavior. If they are not and multiple NodePools are matched, Karpenter will randomly choose which to use, causing unexpected results. Useful examples for creating multiple NodePools include the following:</p> <p>Creating a NodePool with GPU and only allowing special workloads to run on these (expensive) nodes:</p> <pre><code># NodePool for GPU Instances with Taints\napiVersion: karpenter.sh/v1beta1\nkind: NodePool\nmetadata:\n  name: gpu\nspec:\n  disruption:\n    consolidateAfter: 1m0s\n    consolidationPolicy: WhenEmpty\n    expireAfter: Never\n  template:\n    metadata: {}\n    spec:\n      nodeClassRef:\n        name: default\n      requirements:\n      - key: node.kubernetes.io/instance-type\n        operator: In\n        values:\n        - p3.8xlarge\n        - p3.16xlarge\n      - key: kubernetes.io/os\n        operator: In\n        values:\n        - linux\n      - key: kubernetes.io/arch\n        operator: In\n        values:\n        - amd64\n      - key: karpenter.sh/capacity-type\n        operator: In\n        values:\n        - on-demand\n      taints:\n      - effect: NoSchedule\n        key: nvidia.com/gpu\n        value: \"true\"\n</code></pre> <p>Deployment with toleration for the taint:</p> <pre><code># Deployment of GPU Workload will have tolerations defined\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: inflate-gpu\nspec:\n  ...\n    spec:\n      tolerations:\n      - key: \"nvidia.com/gpu\"\n        operator: \"Exists\"\n        effect: \"NoSchedule\"\n</code></pre> <p>For a general deployment for another team, the NodePool spec could include nodeAffinify. A Deployment could then use nodeSelectorTerms to match <code>billing-team</code>.</p> <pre><code># NodePool for regular EC2 instances\napiVersion: karpenter.sh/v1beta1\nkind: NodePool\nmetadata:\n  name: generalcompute\nspec:\n  disruption:\n    expireAfter: Never\n  template:\n    metadata:\n      labels:\n        billing-team: my-team\n    spec:\n      nodeClassRef:\n        name: default\n      requirements:\n      - key: node.kubernetes.io/instance-type\n        operator: In\n        values:\n        - m5.large\n        - m5.xlarge\n        - m5.2xlarge\n        - c5.large\n        - c5.xlarge\n        - c5a.large\n        - c5a.xlarge\n        - r5.large\n        - r5.xlarge\n      - key: kubernetes.io/os\n        operator: In\n        values:\n        - linux\n      - key: kubernetes.io/arch\n        operator: In\n        values:\n        - amd64\n      - key: karpenter.sh/capacity-type\n        operator: In\n        values:\n        - on-demand\n</code></pre> <p>Deployment using nodeAffinity:</p> <pre><code># Deployment will have spec.affinity.nodeAffinity defined\nkind: Deployment\nmetadata:\n  name: workload-my-team\nspec:\n  replicas: 200\n  ...\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                - key: \"billing-team\"\n                  operator: \"In\"\n                  values: [\"my-team\"]\n</code></pre>"},{"location":"karpenter/#use-timers-ttl-to-automatically-delete-nodes-from-the-cluster","title":"Use timers (TTL) to automatically delete nodes from the cluster","text":"<p>You can use timers on provisioned nodes to set when to delete nodes that are devoid of workload pods or have reached an expiration time. Node expiry can be used as a means of upgrading, so that nodes are retired and replaced with updated versions. See Expiration in the Karpenter documentation for information on using <code>spec.disruption.expireAfter</code> to configure node expiry.</p>"},{"location":"karpenter/#avoid-overly-constraining-the-instance-types-that-karpenter-can-provision-especially-when-utilizing-spot","title":"Avoid overly constraining the Instance Types that Karpenter can provision, especially when utilizing Spot","text":"<p>When using Spot, Karpenter uses the Price Capacity Optimized allocation strategy to provision EC2 instances. This strategy instructs EC2 to provision instances from the deepest pools for the number of instances that you are launching and have the lowest risk of interruption. EC2 Fleet then requests Spot instances from the lowest priced of these pools. The more instance types you allow Karpenter to utilize, the better EC2 can optimize your spot instance\u2019s runtime. By default, Karpenter will use all Instance Types EC2 offers in the region and availability zones your cluster is deployed in. Karpenter intelligently chooses from the set of all instance types based on pending pods to make sure your pods are scheduled onto appropriately sized and equipped instances. For example, if your pod does not require a GPU, Karpenter will not schedule your pod to an EC2 instance type supporting a GPU. When you're unsure about which instance types to use, you can run the Amazon ec2-instance-selector to generate a list of instance types that match your compute requirements. For example, the CLI takes memory vCPU, architecture, and region as input parameters and provides you with a list of EC2 instances that satisfy those constraints.</p> <pre><code>$ ec2-instance-selector --memory 4 --vcpus 2 --cpu-architecture x86_64 -r ap-southeast-1\nc5.large\nc5a.large\nc5ad.large\nc5d.large\nc6i.large\nt2.medium\nt3.medium\nt3a.medium\n</code></pre> <p>You shouldn\u2019t place too many constraints on Karpenter when using Spot instances because doing so can affect the availability of your applications. Say, for example, all of the instances of a particular type are reclaimed and there are no suitable alternatives available to replace them. Your pods will remain in a pending state until the spot capacity for the configured instance types is replenished. You can reduce the risk of insufficient capacity errors by spreading your instances across different availability zones, because spot pools are different across AZs. That said, the general best practice is to allow Karpenter to use a diverse set of instance types when using Spot.</p>"},{"location":"karpenter/#scheduling-pods","title":"Scheduling Pods","text":"<p>The following best practices relate to deploying pods In a cluster using Karpenter for node provisioning.</p>"},{"location":"karpenter/#follow-eks-best-practices-for-high-availability","title":"Follow EKS best practices for high availability","text":"<p>If you need to run highly available applications, follow general EKS best practice recommendations. See Topology Spread in Karpenter documentation for details on how to spread pods across nodes and zones. Use Disruption Budgets to set the minimum available pods that need to be maintained, in case there are attempts to evict or delete pods.</p>"},{"location":"karpenter/#use-layered-constraints-to-constrain-the-compute-features-available-from-your-cloud-provider","title":"Use layered Constraints to constrain the compute features available from your cloud provider","text":"<p>Karpenter\u2019s model of layered constraints allows you to create a complex set of NodePool and pod deployment constraints to get the best possible matches for pod scheduling. Examples of constraints that a pod spec can request include the following:</p> <ul> <li>Needing to run in availability zones where only particular applications are available. Say, for example, you have pod that has to communicate with another application that runs on an EC2 instance residing in a particular availability zone. If your aim is to reduce cross-AZ traffic in your VPC, you may want to co-locate the pods in the AZ where the EC2 instance is located. This sort of targeting is often accomplished using node selectors. For additional information on Node selectors, please refer to the Kubernetes documentation.</li> <li>Requiring certain kinds of processors or other hardware. See the Accelerators section of the Karpenter docs for a podspec example that requires the pod to run on a GPU.</li> </ul>"},{"location":"karpenter/#create-billing-alarms-to-monitor-your-compute-spend","title":"Create billing alarms to monitor your compute spend","text":"<p>When you configure your cluster to automatically scale, you should create billing alarms to warn you when your spend has exceeded a threshold and add resource limits to your Karpenter configuration. Setting resource limits with Karpenter is similar to setting an AWS autoscaling group\u2019s maximum capacity in that it represents the maximum amount of compute resources that can be instantiated by a Karpenter NodePool.</p> <p>Note</p> <p>It is not possible to set a global limit for the whole cluster. Limits apply to specific NodePools.</p> <p>The snippet below tells Karpenter to only provision a maximum of 1000 CPU cores and 1000Gi of memory. Karpenter will stop adding capacity only when the limit is met or exceeded. When a limit is exceeded the Karpenter controller will write <code>memory resource usage of 1001 exceeds limit of 1000</code> or a similar looking message to the controller\u2019s logs. If you are routing your container logs to CloudWatch logs, you can create a metrics filter to look for specific patterns or terms in your logs and then create a CloudWatch alarm to alert you when your configured metrics threshold is breached.</p> <p>For further information using limits with Karpenter, see Setting Resource Limits in the Karpenter documentation.</p> <pre><code>spec:\n  limits:\n    cpu: 1000\n    memory: 1000Gi\n</code></pre> <p>If you don\u2019t use limits or constrain the instance types that Karpenter can provision, Karpenter will continue adding compute capacity to your cluster as needed. While configuring Karpenter in this way allows your cluster to scale freely, it can also have significant cost implications. It is for this reason that we recommend that configuring billing alarms. Billing alarms allow you to be alerted and proactively notified when the calculated estimated charges in your account(s) exceed a defined threshold. See Setting up an Amazon CloudWatch Billing Alarm to Proactively Monitor Estimated Charges for additional information.</p> <p>You may also want to enable Cost Anomaly Detection which is an AWS Cost Management feature that uses machine learning to continuously monitor your cost and usage to detect unusual spends. Further information can be found in the AWS Cost Anomaly Detection Getting Started guide. If you\u2019ve gone so far as to create a budget in AWS Budgets, you can also configure an action to notify you when a specific threshold has been breached. With budget actions you can send an email, post a message to an SNS topic, or send a message to a chatbot like Slack. For further information see Configuring AWS Budgets actions.</p>"},{"location":"karpenter/#use-the-karpentershdo-not-disrupt-annotation-to-prevent-karpenter-from-deprovisioning-a-node","title":"Use the karpenter.sh/do-not-disrupt annotation to prevent Karpenter from deprovisioning a node","text":"<p>If you are running a critical application on a Karpenter-provisioned node, such as a long running batch job or stateful application, and the node\u2019s TTL has expired, the application will be interrupted when the instance is terminated. By adding a <code>karpenter.sh/karpenter.sh/do-not-disrupt</code> annotation to the pod, you are instructing Karpenter to preserve the node until the Pod is terminated or the <code>karpenter.sh/do-not-disrupt</code> annotation is removed. See Distruption documentation for further information.</p> <p>If the only non-daemonset pods left on a node are those associated with jobs, Karpenter is able to target and terminate those nodes so long as the job status is succeed or failed.</p>"},{"location":"karpenter/#configure-requestslimits-for-all-non-cpu-resources-when-using-consolidation","title":"Configure requests=limits for all non-CPU resources when using consolidation","text":"<p>Consolidation and scheduling in general work by comparing the pods resource requests vs the amount of allocatable resources on a node.  The resource limits are not considered.  As an example, pods that have a memory limit that is larger than the memory request can burst above the request.  If several pods on the same node burst at the same time, this can cause some of the pods to be terminated due to an out of memory (OOM) condition.  Consolidation can make this more likely to occur as it works to pack pods onto nodes only considering their requests.</p>"},{"location":"karpenter/#use-limitranges-to-configure-defaults-for-resource-requests-and-limits","title":"Use LimitRanges to configure defaults for resource requests and limits","text":"<p>Because Kubernetes doesn\u2019t set default requests or limits, a container\u2019s consumption of resources from the underlying host, CPU, and memory is unbound. The Kubernetes scheduler looks at a pod\u2019s total requests (the higher of the total requests from the pod\u2019s containers or the total resources from the pod\u2019s Init containers) to determine which worker node to schedule the pod onto. Similarly, Karpenter considers a pod\u2019s requests to determine which type of instance it provisions. You can use a limit range to apply a sensible default for a namespace, in case resource requests are not specified by some pods.</p> <p>See Configure Default Memory Requests and Limits for a Namespace</p>"},{"location":"karpenter/#apply-accurate-resource-requests-to-all-workloads","title":"Apply accurate resource requests to all workloads","text":"<p>Karpenter is able to launch nodes that best fit your workloads when its information about your workloads requirements is accurate.  This is particularly important if using Karpenter's consolidation feature.</p> <p>See Configure and Size Resource Requests/Limits for all Workloads</p>"},{"location":"karpenter/#coredns-recommendations","title":"CoreDNS recommendations","text":""},{"location":"karpenter/#update-the-configuration-of-coredns-to-maintain-reliability","title":"Update the configuration of CoreDNS to maintain reliability","text":"<p>When deploying CoreDNS pods on nodes managed by Karpenter, given Karpenter's dynamic nature in rapidly terminating/creating new nodes to align with demand, it is advisable to adhere to the following best practices:</p> <p>CoreDNS lameduck duration</p> <p>CoreDNS readiness probe</p> <p>This will ensure that DNS queries are not directed to a CoreDNS Pod that is not yet ready or has been terminated.</p>"},{"location":"karpenter/#karpenter-blueprints","title":"Karpenter Blueprints","text":"<p>As Karpenter takes an application-first approach to provision compute capacity for to the Kubernetes data plane, there are common workload scenarios that you might be wondering how to configure them properly. Karpenter Blueprints is a repository that includes a list of common workload scenarios following the best practices described here. You'll have all the resources you need to even create an EKS cluster with Karpenter configured, and test each of the blueprints included in the repository. You can combine different blueprints to finally create the one you need for your workload(s).</p>"},{"location":"karpenter/#additional-resources","title":"Additional Resources","text":"<ul> <li>Karpenter/Spot Workshop</li> <li>Karpenter Node Provisioner</li> <li>TGIK Karpenter</li> <li>Karpenter vs. Cluster Autoscaler</li> <li>Groupless Autoscaling with Karpenter</li> <li>Tutorial: Run Kubernetes Clusters for Less with Amazon EC2 Spot and Karpenter</li> </ul>"},{"location":"networking/custom-networking/","title":"Custom Networking","text":"<p>By default, Amazon VPC CNI will assign Pods an IP address selected from the primary subnet.  The primary subnet is the subnet CIDR that the primary ENI is attached to, usually the subnet of the node/host.</p> <p>If the subnet CIDR is too small, the CNI may not be able to acquire enough secondary IP addresses to assign to your Pods. This is a common challenge for EKS IPv4 clusters.</p> <p>Custom networking is one solution to this problem.</p> <p>Custom networking addresses the IP exhaustion issue by assigning the node and Pod IPs from secondary VPC address spaces (CIDR). Custom networking support supports ENIConfig custom resource. The ENIConfig includes an alternate subnet CIDR range (carved from a secondary VPC CIDR), along with the security group(s) that the Pods will belong to. When custom networking is enabled, the VPC CNI creates secondary ENIs in the subnet  defined under ENIConfig. The CNI assigns Pods an IP addresses from a CIDR range defined in a ENIConfig CRD. </p> <p>Since the primary ENI is not used by custom networking, the maximum number of Pods you can run on a node is lower. The host network Pods continue to use IP address assigned to the primary ENI. Additionally, the primary ENI is used to handle source network translation and route Pods traffic outside the node. </p>"},{"location":"networking/custom-networking/#example-configuration","title":"Example Configuration","text":"<p>While custom networking will accept valid VPC range for secondary CIDR range, we recommend that you use CIDRs (/16) from the CG-NAT space, i.e. 100.64.0.0/10 or 198.19.0.0/16 as those are less likely to be used in a corporate setting than other RFC1918 ranges. For additional information about the permitted and restricted CIDR block associations you can use with your VPC, see IPv4 CIDR block association restrictions in the VPC and subnet sizing section of the VPC documentation.</p> <p>As shown in the diagram below, the primary Elastic Network Interface (ENI) of the worker node still uses the primary VPC CIDR range (in this case 10.0.0.0/16) but the secondary ENIs use the secondary VPC CIDR Range (in this case 100.64.0.0/16). Now, in order to have the Pods use the 100.64.0.0/16 CIDR range, you must configure the CNI plugin to use custom networking. You can follow through the steps as documented here.</p> <p></p> <p>If you want the CNI to use custom networking, set the <code>AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG</code> environment variable to <code>true</code>.</p> <pre><code>kubectl set env daemonset aws-node -n kube-system AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true\n</code></pre> <p>When <code>AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true</code>, the CNI will assign Pod IP address from a subnet defined in <code>ENIConfig</code>. The <code>ENIConfig</code> custom resource is used to define the subnet in which Pods will be scheduled.</p> <pre><code>apiVersion : crd.k8s.amazonaws.com/v1alpha1\nkind : ENIConfig\nmetadata:\n  name: us-west-2a\nspec: \n  securityGroups:\n    - sg-0dff111a1d11c1c11\n  subnet: subnet-011b111c1f11fdf11\n</code></pre> <p>Upon creating the <code>ENIconfig</code> custom resources, you will need to create new worker nodes and drain the existing nodes. The existing worker nodes and Pods will remain unaffected. </p>"},{"location":"networking/custom-networking/#recommendations","title":"Recommendations","text":""},{"location":"networking/custom-networking/#use-custom-networking-when","title":"Use Custom Networking When","text":"<p>We recommend you to consider custom networking if you are dealing with IPv4 exhaustion and can\u2019t use IPv6 yet. Amazon EKS support for RFC6598 space enables you to scale Pods beyond RFC1918 address exhaustion challenges. Please consider using prefix delegation with custom networking to increase the Pods density on a node. </p> <p>You might consider custom networking if you have a security requirement to run Pods on a different network with different security group requirements. When custom networking enabled, the pods use different subnet or security groups as defined in the ENIConfig than the node's primary network interface.</p> <p>Custom networking is indeed an ideal option for deploying multiple EKS clusters and applications to connect on-premise datacenter services. You can increase the number of private addresses (RFC1918) accessible to EKS in your VPC for services such as Amazon Elastic Load Balancing and NAT-GW, while using non-routable CG-NAT space for your Pods across multiple clusters. Custom networking with the transit gateway and a Shared Services VPC (including NAT gateways across several Availability Zones for high availability) enables you to deliver scalable and predictable traffic flows. This blog post describes an architectural pattern that is one of the most recommended ways to connect EKS Pods to a datacenter network using custom networking.</p>"},{"location":"networking/custom-networking/#avoid-custom-networking-when","title":"Avoid Custom Networking When","text":""},{"location":"networking/custom-networking/#ready-to-implement-ipv6","title":"Ready to Implement IPv6","text":"<p>Custom networking can mitigate IP exhaustion issues, but it requires additional operational overhead. If you are currently deploying a dual-stack (IPv4/IPv6) VPC or if your plan includes IPv6 support, we recommend implementing IPv6 clusters instead. You can set up IPv6 EKS clusters and migrate your apps. In an IPv6 EKS cluster, both Kubernetes and Pods get an IPv6 address and can communicate in and out to both IPv4 and IPv6 endpoints. Please review best practices for Running IPv6 EKS Clusters.</p>"},{"location":"networking/custom-networking/#exhausted-cg-nat-space","title":"Exhausted CG-NAT Space","text":"<p>Furthermore, if you're currently utilizing CIDRs from the CG-NAT space or are unable to link a secondary CIDR with your cluster VPC, you may need to explore other options, such as using an alternative CNI. We strongly recommend that you either obtain commercial support or possess the in-house knowledge to debug and submit patches to the open source CNI plugin project. Refer Alternate CNI Plugins user guide for more details.</p>"},{"location":"networking/custom-networking/#use-private-nat-gateway","title":"Use Private NAT Gateway","text":"<p>Amazon VPC now offers private NAT gateway capabilities. Amazon's private NAT Gateway enables instances in private subnets to connect to other VPCs and on-premises networks with overlapping CIDRs. Consider utilizing the method described on this blog post to employ a private NAT gateway to overcome communication issues for the EKS workloads caused by overlapping CIDRs, a significant complaint expressed by our clients. Custom networking cannot address the overlapping CIDR difficulties on its own, and it adds to the configuration challenges.</p> <p>The network architecture used in this blog post implementation follows the recommendations under Enable communication between overlapping networks in Amazon VPC documentation. As demonstrated in this blog post, you may expand the usage of private NAT Gateway in conjunction with RFC6598 addresses to manage customers' private IP exhaustion issues. The EKS clusters, worker nodes are deployed in the non-routable 100.64.0.0/16 VPC secondary CIDR range, whereas the private NAT gateway, NAT gateway are deployed to the routable RFC1918 CIDR ranges. The blog explains how a transit gateway is used to connect VPCs in order to facilitate communication across VPCs with overlapping non-routable CIDR ranges. For use cases in which EKS resources in a VPC's non-routable address range need to communicate with other VPCs that do not have overlapping address ranges, customers have the option of using VPC Peering to interconnect such VPCs. This method could provide potential cost savings as all data transit within an Availability Zone via a VPC peering connection is now free.</p> <p></p>"},{"location":"networking/custom-networking/#unique-network-for-nodes-and-pods","title":"Unique network for nodes and Pods","text":"<p>If you need to isolate your nodes and Pods to a specific network for security reasons, we recommend that you deploy nodes and Pods to a subnet from a larger secondary CIDR block (e.g. 100.64.0.0/8). Following the installation of the new CIDR in your VPC, you can deploy another node group using the secondary CIDR and drain the original nodes to automatically redeploy the pods to the new worker nodes. For more information on how to implement this, see this blog post.</p> <p>Custom networking is not used in the setup represented in the diagram below. Rather, Kubernetes worker nodes are deployed on subnets from your VPC's secondary VPC CIDR range, such as 100.64.0.0/10. You can keep the EKS cluster running (the control plane will remain on the original subnet/s), but the nodes and Pods will be moved to a secondary subnet/s. This is yet another, albeit unconventional, technique to mitigate the danger of IP exhaustion in a VPC. We propose draining the old nodes before redeploying the pods to the new worker nodes.</p> <p></p>"},{"location":"networking/custom-networking/#automate-configuration-with-availability-zone-labels","title":"Automate Configuration with Availability Zone Labels","text":"<p>You can enable Kubernetes to automatically apply the corresponding ENIConfig for the worker node Availability Zone (AZ).</p> <p>Kubernetes automatically adds the tag <code>topology.kubernetes.io/zone</code> to your worker nodes. Amazon EKS recommends using the availability zone as your ENI config name when you only have one secondary subnet (alternate CIDR) per AZ. Note that tag <code>failure-domain.beta.kubernetes.io/zone</code> is deprecated and replaced with the tag <code>topology.kubernetes.io/zone</code>.</p> <ol> <li>Set <code>name</code> field to the Availability Zone of your VPC.</li> <li>Enable automatic configuration with this command:</li> </ol> <pre><code>kubectl set env daemonset aws-node -n kube-system AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true\n</code></pre> <p>if you have multiple secondary subnets per availability zone, you need create a specific <code>ENI_CONFIG_LABEL_DEF</code>. You might consider configuring <code>ENI_CONFIG_LABEL_DEF</code> as <code>k8s.amazonaws.com/eniConfig</code> and label nodes with custom eniConfig names, such as <code>k8s.amazonaws.com/eniConfig=us-west-2a-subnet-1</code> and <code>k8s.amazonaws.com/eniConfig=us-west-2a-subnet-2</code>.</p>"},{"location":"networking/custom-networking/#replace-pods-when-configuring-secondary-networking","title":"Replace Pods when Configuring Secondary Networking","text":"<p>Enabling custom networking does not modify existing nodes. Custom networking is a disruptive action. Rather than doing a rolling replacement of all the worker nodes in your cluster after enabling custom networking, we suggest updating the AWS CloudFormation template in the EKS Getting Started Guide with a custom resource that calls a Lambda function to update the <code>aws-node</code> Daemonset with the environment variable to enable custom networking before the worker nodes are provisioned.</p> <p>If you had any nodes in your cluster with running Pods before you switched to the custom CNI networking feature, you should cordon and drain the nodes to gracefully shutdown the Pods and then terminate the nodes. Only new nodes matching the ENIConfig label or annotations use custom networking, and hence the Pods scheduled on these new nodes can be assigned an IP from secondary CIDR. </p>"},{"location":"networking/custom-networking/#calculate-max-pods-per-node","title":"Calculate Max Pods per Node","text":"<p>Since the node\u2019s primary ENI is no longer used to assign Pod IP addresses, there is a decrease in the number of Pods you can run on a given EC2 instance type. To work around this limitation you can use prefix assignment with custom networking. With prefix assignment, each secondary IP is replaced with a /28 prefix on secondary ENIs. </p> <p>Consider the maximum number of Pods for an m5.large instance with custom networking.</p> <p>The maximum number of Pods you can run without prefix assignment is 29</p> <ul> <li>((3 ENIs - 1) * (10 secondary IPs per ENI - 1)) + 2 = 20</li> </ul> <p>Enabling prefix attachments increases the number of Pods to 290.</p> <ul> <li>(((3 ENIs - 1) * ((10 secondary IPs per ENI - 1) * 16)) + 2 = 290</li> </ul> <p>However, we suggest setting max-pods to 110 rather than 290 because the instance has a rather small number of virtual CPUs. On bigger instances, EKS recommends a max pods value of 250. When utilizing prefix attachments with smaller instance types (e.g. m5.large), it is possible that you will exhaust the instance's CPU and memory resources well before its IP addresses.</p> <p>Info</p> <p>When the CNI prefix allocates a /28 prefix to an ENI, it has to be a contiguous block of IP addresses. If the subnet that the prefix is generated from is highly fragmented, the prefix attachment may fail. You can mitigate this from happening by creating a new dedicated VPC for the cluster or by reserving subnet a set of CIDR exclusively for prefix attachments. Visit Subnet CIDR reservations for more information on this topic.</p>"},{"location":"networking/custom-networking/#identify-existing-usage-of-cg-nat-space","title":"Identify Existing Usage of CG-NAT Space","text":"<p>Custom networking allows you to mitigate IP exhaustion issue, however it can\u2019t solve all the challenges. If you already using CG-NAT space for your cluster, or simply don\u2019t have the ability to associate a secondary CIDR with your cluster VPC, we suggest you to explore other options, like using an alternate CNI or moving to IPv6 clusters.</p>"},{"location":"networking/index/","title":"Amazon EKS Best Practices Guide for Networking","text":"<p>It is critical to understand Kubernetes networking to operate your cluster and applications efficiently. Pod networking, also called the cluster networking, is the center of Kubernetes networking. Kubernetes supports Container Network Interface (CNI) plugins for cluster networking. </p> <p>Amazon EKS officially supports Amazon Virtual Private Cloud (VPC) CNI plugin to implement Kubernetes Pod networking. The VPC CNI provides native integration with AWS VPC and works in underlay mode. In underlay mode, Pods and hosts are located at the same network layer and share the network namespace. The IP address of the Pod is consistent from the cluster and VPC perspective. </p> <p>This guide introduces the Amazon VPC Container Network Interface(VPC CNI) in the context of Kubernetes cluster networking. The VPC CNI is the default networking plugin supported by EKS and hence is the focus of the guide. The VPC CNI is highly configurable to support different use cases. This guide further includes dedicated sections on different VPC CNI use cases, operating modes, sub-components, followed by the recommendations.</p> <p>Amazon EKS runs upstream Kubernetes and is certified Kubernetes conformant. Although you can use alternate CNI plugins, this guide does not provide recommendations for managing alternate CNIs. Check the EKS Alternate CNI documentation for a list of partners and resources for managing alternate CNIs effectively.</p>"},{"location":"networking/index/#kubernetes-networking-model","title":"Kubernetes Networking Model","text":"<p>Kubernetes sets the following requirements on cluster networking:</p> <ul> <li>Pods scheduled on the same node must be able to communicate with other Pods without using NAT (Network Address Translation).</li> <li>All system daemons (background processes, for example, kubelet) running on a particular node can communicate with the Pods running on the same node.</li> <li>Pods that use the host network must be able to contact all other Pods on all other nodes without using NAT.</li> </ul> <p>See the Kubernetes network model for details on what Kubernetes expects from compatible networking implementations. The following figure illustrates the relationship between Pod network namespaces and the host network namespace.</p> <p></p>"},{"location":"networking/index/#container-networking-interface-cni","title":"Container Networking Interface (CNI)","text":"<p>Kubernetes supports CNI specifications and plugins to implement Kubernetes network model. A CNI consists of a specification (current version 1.0.0) and libraries for writing plugins to configure network interfaces in containers, along with a number of supported plugins. CNI concerns itself only with network connectivity of containers and removing allocated resources when the container is deleted. </p> <p>The CNI plugin is enabled by passing kubelet the <code>--network-plugin=cni</code> command-line option. Kubelet reads a file from <code>--cni-conf-dir</code> (default /etc/cni/net.d) and uses the CNI configuration from that file to set up each Pod\u2019s network. The CNI configuration file must match the CNI specification (minimum v0.4.0) and any required CNI plugins referenced by the configuration must be present in the <code>--cni-bin-dir</code> directory (default /opt/cni/bin). If there are multiple CNI configuration files in the directory, the kubelet uses the configuration file that comes first by name in lexicographic order.</p>"},{"location":"networking/index/#amazon-virtual-private-cloud-vpc-cni","title":"Amazon Virtual Private Cloud (VPC) CNI","text":"<p>The AWS-provided VPC CNI is the default networking add-on for EKS clusters. VPC CNI add-on is installed by default when you provision EKS clusters. VPC CNI runs on Kubernetes worker nodes. The VPC CNI add-on consists of the CNI binary and the IP Address Management (ipamd) plugin. The CNI assigns an IP address from the VPC network to a Pod. The ipamd manages AWS Elastic Networking Interfaces (ENIs) to each Kubernetes node and maintains the warm pool of IPs. The VPC CNI provides configuration options for pre-allocation of ENIs and IP addresses for fast Pod startup times. Refer to Amazon VPC CNI for recommended plugin management best practices.</p> <p>Amazon EKS recommends you specify subnets in at least two availability zones when you create a cluster. Amazon VPC CNI allocates IP addresses to Pods from the node subnets. We strongly recommend checking the subnets for available IP addresses. Please consider VPC and Subnet recommendations before deploying EKS clusters. </p> <p>Amazon VPC CNI allocates a warm pool of ENIs and secondary IP addresses from the subnet attached to the node\u2019s primary ENI. This mode of VPC CNI is called the \"secondary IP mode.\" The number of IP addresses and hence the number of Pods (Pod density) is defined by the number of ENIs and the IP address per ENI (limits) as defined by the instance type. The secondary mode is the default and works well for small clusters with smaller instance types. Please consider using prefix mode if you are experiencing pod density challenges. You can also increase the available IP addresses on node for Pods by assigning prefixes to ENIs.</p> <p>Amazon VPC CNI natively integrates with AWS VPC and allows users to apply existing AWS VPC networking and security best practices for building Kubernetes clusters. This includes the ability to use VPC flow logs, VPC routing policies, and security groups for network traffic isolation. By default, the Amazon VPC CNI applies security group associated with the primary ENI on the node to the Pods. Consider enabling security groups for Pods when you would like to assign different network rules for a Pod.</p> <p>By default, VPC CNI assigns IP addresses to Pods from the subnet assigned to the primary ENI of a node. It is common to experience a shortage of IPv4 addresses when running large clusters with thousands of workloads. AWS VPC allows you to extend available IPs by assigning a secondary CIDRs to work around exhaustion of IPv4 CIDR blocks. AWS VPC CNI allows you to use a different subnet CIDR range for Pods. This feature of VPC CNI is called custom networking. You might consider using custom networking to use 100.64.0.0/10 and 198.19.0.0/16 CIDRs (CG-NAT) with EKS. This effectively allows you to create an environment where Pods no longer consume any RFC1918 IP addresses from your VPC.</p> <p>Custom networking is one option to address the IPv4 address exhaustion problem, but it requires operational overhead. We recommend IPv6 clusters over custom networking to resolve this problem. Specifically, we recommend migrating to IPv6 clusters if you have completely exhausted all available IPv4 address space for your VPC. Evaluate your organization\u2019s plans to support IPv6, and consider if investing in IPv6 may have more long-term value. </p> <p>EKS\u2019s support for IPv6 is focused on solving the IP exhaustion problem caused by a limited IPv4 address space. In response to customer issues with IPv4 exhaustion, EKS has prioritized IPv6-only Pods over dual-stack Pods. That is, Pods may be able to access IPv4 resources, but they are not assigned an IPv4 address from VPC CIDR range. The VPC CNI assigns IPv6 addresses to Pods from the AWS managed VPC IPv6 CIDR block. </p>"},{"location":"networking/index/#subnet-calculator","title":"Subnet Calculator","text":"<p>This project includes a Subnet Calculator Excel Document. This calculator document simulates the IP address consumption of a specified workload under different ENI configuration options, such as <code>WARM_IP_TARGET</code> and <code>WARM_ENI_TARGET</code>. The document includes two sheets, a first for Warm ENI mode, and a second for Warm IP mode. Review the VPC CNI guidance for more information on these modes. </p> <p>Inputs: - Subnet CIDR Size - Warm ENI Target or Warm IP Target - List of instances     - type, number, and number of workload pods scheduled per instance</p> <p>Outputs: - Total number of pods hosted - Number of Subnet IPs consumed - Number of Subnet IPs remaining - Instance Level Details     - Number of Warm IPs/ENIs per instance     - Number of Active IPs/ENIs per instance</p>"},{"location":"networking/ip-optimization-strategies/","title":"Optimizing IP Address Utilization","text":"<p>Containerized environments are growing in scale at a rapid pace, thanks to application modernization. This means that more and more worker nodes and pods are being deployed.</p> <p>The Amazon VPC CNI plugin assigns each pod an IP address from the VPC's CIDR(s). This approach provides full visibility of the Pod addresses with tools such as VPC Flow Logs and other monitoring solutions. Depending on your workload type this can cause a substantial number of IP addresses to be consumed by the pods.</p> <p>When designing your AWS networking architecture, it is important to optimize Amazon EKS IP consumption at the VPC and at the node level. This will help you mitigate IP exhaustion issues and increase the pod density per node.</p> <p>In this section, we will discuss techniques that can help you achieve these goals.</p>"},{"location":"networking/ip-optimization-strategies/#optimize-node-level-ip-consumption","title":"Optimize node-level IP consumption","text":"<p>Prefix delegation is a feature of Amazon Virtual Private Cloud (Amazon VPC) that allows you to assign IPv4 or IPv6 prefixes to your Amazon Elastic Compute Cloud (Amazon EC2) instances. It increases the IP addresses per network interface (ENI), which increases the pod density per node and improves your compute efficiency. Prefix delegation is also supported with Custom Networking. </p> <p>For detailed information please see Prefix Delegation with Linux nodes and Prefix Delegation with Windows nodes sections.</p>"},{"location":"networking/ip-optimization-strategies/#mitigate-ip-exhaustion","title":"Mitigate IP exhaustion","text":"<p>To prevent your clusters from consuming all available IP addresses, we strongly recommend sizing your VPCs and subnets with growth in mind. </p> <p>Adopting IPv6 is a great way to avoid these problems from the very beginning. However, for organizations whose scalability needs exceed the initial planning and cannot adopt IPv6, improving the VPC design is the recommended response to IP address exhaustion. The most commonly used technique among Amazon EKS customers is adding non-routable Secondary CIDRs to the VPC and configuring the VPC CNI to use this additional IP space when allocating IP addresses to Pods. This is commonly referred to as Custom Networking. </p> <p>We will cover which variables of the Amazon VPC CNI you can use to optimize the warm pool of IPs assigned to your nodes. We will close this section with some other architectural patterns that are not intrinsic to Amazon EKS but can help mitigate IP exhaustion.</p>"},{"location":"networking/ip-optimization-strategies/#use-ipv6-recommended","title":"Use IPv6 (recommended)","text":"<p>Adopting IPv6 is the easiest way to work around the RFC1918 limitations; we strongly recommend you consider adopting IPv6 as your first option when choosing a network architecture. IPv6 provides a significantly larger total IP address space, and cluster administrators can focus on migrating and scaling applications without devoting effort towards working around IPv4 limits.</p> <p>Amazon EKS clusters support both IPv4 and IPv6. By default, EKS clusters use IPv4 address space. Specifying an IPv6 based address space at cluster creation time will enable the use of IPv6. In an IPv6 EKS cluster, pods and services receive IPv6 addresses while maintaining the ability for legacy IPv4 endpoints to connect to services running on IPv6 clusters and vice versa. All the pod-to-pod communication within a cluster always occurs over IPv6. Within a VPC (/56), the IPv6 CIDR block size for IPv6 subnets is fixed at /64. This provides 2^64 (approximately 18 quintillion) IPv6 addresses allowing to scale your deployments on EKS.</p> <p>For detailed information please see the Running IPv6 EKS Clusters section and for hands-on experience please see the Understanding IPv6 on Amazon EKS section of the Get hands-on with IPv6 workshop.</p> <p></p>"},{"location":"networking/ip-optimization-strategies/#optimize-ip-consumption-in-ipv4-clusters","title":"Optimize IP consumption in IPv4 clusters","text":"<p>This section is dedicated to customers that are running legacy applications, and/or are not ready to migrate to IPv6. While we encourage all organizations to migrate to IPv6 as soon as possible, we recognize that some may still need to look into alternative approaches to scale their container workloads with IPv4. For this reason, we will also walk you through the architectural patterns to optimize IPv4 (RFC1918) address space consumption with Amazon EKS clusters.</p>"},{"location":"networking/ip-optimization-strategies/#plan-for-growth","title":"Plan for Growth","text":"<p>As a first line of defense against IP exhaustion, we strongly recommend to size your IPv4 VPCs and subnets with growth in mind, to prevent your clusters to consume all the available IP addresses. You will not be able to create new Pods or nodes if the subnets don\u2019t have enough available IP addresses. </p> <p>Before building VPC and subnets, it is advised to work backwards from the required workload scale. For example, when clusters are built using eksctl (a simple CLI tool for creating and managing clusters on EKS) /19 subnets are created by default. A netmask of /19 is suitable for the majority of workload types allowing more than 8000 addresses to be allocated.</p> <p>Attention</p> <p>When you size VPCs and subnets, there might be a number of elements (other than pods and nodes) which can consume IP addresses, for example Load Balancers, RDS Databases and other in-vpc services. </p> <p>Additionally, Amazon EKS, can create up to 4 elastic network interfaces (X-ENI) that are required to allow communication towards the control plane (more info here). During cluster upgrades, Amazon EKS creates new X-ENIs and deletes the old ones when the upgrade is successful. For this reason we recommend a netmask of at least /28 (16 IP addresses) for subnets associated with an EKS cluster.</p> <p>You can use the sample EKS Subnet Calculator spreadsheet to plan for your network. The spreadsheet calculates IP usage based on workloads and VPC ENI configuration. The IP usage is compared to an IPv4 subnet to determine if the configuration and subnet size is sufficient for your workload. Keep in mind that, if subnets in your VPC run out of available IP addresses, we suggest creating a new subnet using the VPC\u2019s original CIDR blocks. Notice that now Amazon EKS now allows modification of cluster subnets and security groups.</p>"},{"location":"networking/ip-optimization-strategies/#expand-the-ip-space","title":"Expand the IP space","text":"<p>If you are about to exhaust the RFC1918 IP space, you can use the Custom Networking pattern to conserve routable IPs by scheduling Pods inside dedicated additional subnets.  While custom networking will accept valid VPC range for secondary CIDR range, we recommend that you use CIDRs (/16) from the CG-NAT space, i.e. <code>100.64.0.0/10</code> or <code>198.19.0.0/16</code> as those are less likely to be used in a corporate setting than RFC1918 ranges. </p> <p>For detailed information please see the dedicated section for Custom Networking.</p> <p></p>"},{"location":"networking/ip-optimization-strategies/#optimize-the-ips-warm-pool","title":"Optimize the IPs warm pool","text":"<p>With the default configuration, the VPC CNI keeps an entire ENI (and associated IPs) in the warm pool. This may consume a large number of IPs, especially on larger instance types.</p> <p>If your cluster subnet has a limited number of IP addresses available, scrutinize these VPC CNI configuration environment variables:</p> <ul> <li><code>WARM_IP_TARGET</code> </li> <li><code>MINIMUM_IP_TARGET</code></li> <li><code>WARM_ENI_TARGET</code></li> </ul> <p>You can configure the value of <code>MINIMUM_IP_TARGET</code> to closely match the number of Pods you expect to run on your nodes. Doing so will ensure that as Pods get created, and the CNI can assign IP addresses from the warm pool without calling the EC2 API.</p> <p>Please be mindful that setting the value of <code>WARM_IP_TARGET</code> too low, will cause additional calls to the EC2 API, and that might cause throttling of the requests. For large clusters use along with <code>MINIMUM_IP_TARGET</code> to avoid throttling of the requests.</p> <p>To configure these options, you can download the <code>aws-k8s-cni.yaml</code> manifest and set the environment variables. At the time of writing, the latest release is located here. Check the version of the configuration value matches the installed VPC CNI version.</p> <p>Warning</p> <p>These settings will be reset to defaults when you update the CNI. Please take a backup of the CNI, before you update it. Review the configuration settings to determine if you need to reapply them after update is successful.</p> <p>You can adjust the CNI parameters on the fly without downtime for your existing applications, but you should choose values that will support your scalability needs. For example, if you're working with batch workloads, we recommend updating the default <code>WARM_ENI_TARGET</code> to match the Pod scale needs. Setting <code>WARM_ENI_TARGET</code> to a high value always maintains the warm IP pool required to run large batch workloads and hence avoid data processing delays. </p> <p>Warning</p> <p>Improving your VPC design is the recommended response to IP address exhaustion. Consider solutions like IPv6 and Secondary CIDRs. Adjusting these values to minimize the number of Warm IPs should be a temporary solution after other options are excluded. Misconfiguring these values may interfere with cluster operation. </p> <p>Before making any changes to a production system, be sure to review the considerations on this page.</p>"},{"location":"networking/ip-optimization-strategies/#monitor-ip-address-inventory","title":"Monitor IP Address Inventory","text":"<p>In addition to the solutions described above, it is also important to have visibility over IP utilization. You can monitor the IP addresses inventory of subnets using CNI Metrics Helper. Some of the metrics available are:</p> <ul> <li>maximum number of ENIs the cluster can support</li> <li>number of ENIs already allocated</li> <li>number of IP addresses currently assigned to Pods</li> <li>total and maximum number of IP address available</li> </ul> <p>You can also set CloudWatch alarms to get notified if a subnet is running out of IP addresses. Please visit EKS user guide for install instructions of CNI metrics helper </p> <p>Warning</p> <p>Make sure <code>DISABLE_METRICS</code> variable for VPC CNI is set to false.</p>"},{"location":"networking/ip-optimization-strategies/#further-considerations","title":"Further considerations","text":"<p>There are other architectural patterns not intrinsic to Amazon EKS that can help with IP exhaustion. For example, you can optimize communication across VPCs or share a VPC across multiple accounts to limit the IPv4 address allocation. </p> <p>Learn more about these patterns here:</p> <ul> <li>Designing hyperscale Amazon VPC networks,</li> <li>Build secure multi-account multi-VPC connectivity with Amazon VPC Lattice.</li> </ul>"},{"location":"networking/ipv6/","title":"Running IPv6 EKS Clusters","text":"<p>EKS in IPv6 mode solves the IPv4 exhaustion challenge often manifested in large scale EKS clusters. EKS\u2019s support for IPv6 is focused on resolving the IPv4 exhaustion problem, which stems from the limited size of the IPv4 address space. This is a significant concern raised by a number of our customers and is distinct from Kubernetes\u2019 \u201cIPv4/IPv6 dual-stack\u201d feature. EKS/IPv6 will also provide the flexability to inter-connect network boundaries using IPv6 CIDRs hence minimizing the chances to suffer from CIDR overlap, therefor solving a 2-Fold problem (In-Cluster, Cross-Cluster). When deploying EKS clusters in IPv6 mode (--ip-family ipv6), the action is not a reversible. In simple words EKS IPv6 support is enabled for the entire lifetime of your cluster.</p> <p>In an IPv6 EKS cluster, Pods and Services will receive IPv6 addresses while maintaining compatibility with legacy IPv4 Endpoints. This includes the ability for external IPv4 endpoints to access in-cluster services, and Pods to access external IPv4 endpoints.</p> <p>Amazon EKS IPv6 support leverages the native VPC IPv6 capabilities. Each VPC is allocated with an IPv4 address prefix (CIDR block size can be from /16 to /28) and a unique /56 IPv6 address prefix (fixed) from within Amazon\u2019s GUA (Global Unicast Address); you can assign a /64 address prefix to each subnet in your VPC. IPv4 features, like Route Tables, Network Access Control Lists, Peering, and DNS resolution, work the same way in an IPv6 enabled VPC. The VPC is then referred as dual-stack VPC, following dual-stack subnets, the following diagram depict the IPV4&amp;IPv6 VPC foundation pattern that support EKS/IPv6 based clusters:</p> <p></p> <p>In the IPv6 world, every address is internet routable. By default, VPC allocates IPv6 CIDR from the public GUA range. VPCs do not support assigning private IPv6 addresses from the Unique Local Address (ULA) range as defined by RFC 4193 (fd00::/8 or fc00::/8). This is true even when you would like to assign an IPv6 CIDR owned by you. Egressing to the internet from Private Subnets is supported by implementing an egress-only internet gateway (EIGW) in a VPC, allowing outbound traffic while blocking all incoming traffic.  The following diagram depict a Pod IPv6 Internet egress flow inside an EKS/IPv6 cluster:</p> <p></p> <p>Best practices for implementing IPv6 subnets can be found in the VPC user guide.</p> <p>In an IPv6 EKS cluster, nodes and Pods receive public IPv6 addresses. EKS assigns IPv6 addresses to services based on Unique Local IPv6 Unicast Addresses (ULA). The ULA Service CIDR for an IPv6 cluster is automatically assigned during the cluster creation stage and cannot be specified, unlike IPv4. The following diagram depict an EKS/IPv6 based cluster control-plane &amp; data-plan foundation pattern:</p> <p></p>"},{"location":"networking/ipv6/#overview","title":"Overview","text":"<p>EKS/IPv6 is only supported in prefix mode (VPC-CNI Plug-in ENI IP assign mode). Learn more on Prefix  Mode.</p> <p>Prefix assignment only works on Nitro-based EC2 instances, hence EKS/IPv6 is only supported when the cluster data-plane uses EC2 Nitro-based instances. </p> <p>In simple words an IPv6 prefix of /80 (Per worker-node) will yield ~10^14 IPv6 addresses, the limiting factor will no longer be IPs but Pod density (Resources wise).</p> <p>IPv6 prefix assignment only occurs at the EKS worker-node bootstrap time. This behaviour is known to mitigate scenarios where high Pod churn EKS/IPv4 clusters are often delayed in Pod scheduling due to throttled API calls generated by the VPC CNI plug-in (ipamd) aimed to allocate Private IPv4 addresses in a timely fashion. It is also known to make the VPC-CNI plug-in advanced knobs tuning WARM_IP/ENI, MINIMUM_IP unnecessarily.</p> <p>The following diagram zooms into an IPv6 worker-node Elastic Network Interface (ENI):</p> <p></p> <p>Every EKS worker-node is assigned with IPv4 and IPv6 addresses, along with corresponding DNS entries. For a given worker-node, only a single IPv4 address from the dual-stack subnet is consumed. EKS support for IPv6 enables you to communicate with IPv4 endpoints (AWS, on-premise, internet) through a highly opinionated egress-only IPv4 model. EKS implements a host-local CNI plugin, secondary to the VPC CNI plugin, which allocates and configures an IPv4 address for a Pod. The CNI plugin configures a host-specific non-routable IPv4 address for a Pod from the 169.254.172.0/22 range. The IPv4 address assigned to the Pod is unique to the worker-node and is not advertised beyond the worker-node. 169.254.172.0/22 provides up to 1024 unique IPv4 addresses which can support large instance types.</p> <p>The following diagram depict the flow of an IPv6 Pod connecting to an IPv4 endpoint outside the cluster boundary (non-internet):</p> <p></p> <p>In the above diagram Pods will perform a DNS lookup for the endpoint and, upon receiving an IPv4 \u201cA\u201d response, Pod\u2019s node-only unique IPv4 address is translated through source network address translation (SNAT) to the Private IPv4 (VPC) address of the primary network interface attached to the EC2 Worker-node.</p> <p>EKS/IPv6 Pods will also need to connect to IPv4 endpoints over the internet using public IPv4 Addresses, to achieve that a similar flow exists. The following diagram depict the flow of an IPv6 Pod connecting to an IPv4 endpoint outside the cluster boundary (internet routable):  </p> <p></p> <p>In the above diagram Pods will perform a DNS lookup for the endpoint and, upon receiving an IPv4 \u201cA\u201d response, Pod\u2019s node-only unique IPv4 address is translated through source network address translation (SNAT) to the Private IPv4 (VPC) address of the primary network interface attached to the EC2 Worker-node. The Pod IPv4 Address (Source IPv4: EC2 Primary IP) is then routed to the IPv4 NAT Gateway where the EC2 Primary IP is translated (SNAT) into a valid internet routable IPv4 Public IP Address (NAT Gateway Assigned Public IP).</p> <p>Any Pod-to-Pod communication across the nodes always uses an IPv6 address. VPC CNI configures iptables to handle IPv6 while blocking any IPv4 connections.</p> <p>Kubernetes services will receive only IPv6 addresses (ClusterIP) from Unique Local IPv6 Unicast Addresses (ULA). The ULA Service CIDR for an IPv6 cluster is automatically assigned during EKS cluster creation stage and cannot be modified. The following diagram depict the Pod to Kubernetes Service flow:</p> <p></p> <p>Services are exposed to the internet using an AWS load balancer. The load balancer receives public IPv4 and IPv6 addresses, a.k.a dual-stack load balancer. For IPv4 clients accessing IPv6 cluster kubernetes services, the load balancer does IPv4 to IPv6 translation.</p> <p>Amazon EKS recommends running worker nodes and Pods in private subnets. You can create public load balancers in the public subnets that load balance traffic to Pods running on nodes that are in private subnets. The following diagram depict an internet IPv4 user accessing an EKS/IPv6 Ingress based service:</p> <p></p> <p>Note: The above pattern requires to deploy the most recent version of the AWS load balancer controller</p>"},{"location":"networking/ipv6/#eks-control-plane-data-plane-communication","title":"EKS Control Plane &lt;-&gt; Data Plane communication","text":"<p>EKS will provision Cross-Account ENIs (X-ENIs) in dual stack mode (IPv4/IPv6). Kubernetes node components such as kubelet and kube-proxy are configured to support dual stack. Kubelet and kube-proxy run in a hostNetwork mode and bind to both IPv4 and IPv6 addresses attached to the primary network interface of a node. The Kubernetes api-server communicates to Pods and node components via the X-ENIs is IPv6 based. Pods communicate with the api-servers via the X-ENIs, and Pod to api-server communication always uses IPv6 mode.</p> <p></p>"},{"location":"networking/ipv6/#recommendations","title":"Recommendations","text":""},{"location":"networking/ipv6/#maintain-access-to-ipv4-eks-apis","title":"Maintain Access to IPv4 EKS APIs","text":"<p>EKS APIs are accessible by IPv4 only. This also includes the Cluster API Endpoint. You will not be able to access cluster endpoints and APIs from an IPv6 only network. It is required that your network supports (1) an IPv6 transition mechanism such as NAT64/DNS64 that facilitates communication between IPv6 and IPv4 hosts and (2) a DNS service that supports translations of IPv4 endpoints.</p>"},{"location":"networking/ipv6/#schedule-based-on-compute-resources","title":"Schedule Based on Compute Resources","text":"<p>A single IPv6 prefix is sufficient to run many Pods on a single node. This also effectively removes ENI and IP limitations on the maximum number of Pods on a node. Although IPv6 removes direct dependency on max-Pods, when using prefix attachments with smaller instance types like the m5.large, you\u2019re likely to exhaust the instance\u2019s CPU and memory resources long before you exhaust its IP addresses. You must set the EKS recommended maximum Pod value by hand if you are using self-managed node groups or a managed node group with a custom AMI ID.</p> <p>You can use the following formula to determine the maximum number of Pods you can deploy on a node for a IPv6 EKS cluster.</p> <ul> <li> <p>((Number of network interfaces for instance type (number of prefixes per network interface-1)* 16) + 2</p> </li> <li> <p>((3 ENIs)((10 secondary IPs per ENI-1) 16)) + 2 = 460 (real)</p> </li> </ul> <p>Managed node groups automatically calculate the maximum number of Pods for you. Avoid changing EKS\u2019s recommended value for the maximum number of Pods to avoid Pod scheduling failures due to resource limitations.</p>"},{"location":"networking/ipv6/#evaluate-purpose-of-existing-custom-networking","title":"Evaluate Purpose of Existing Custom Networking","text":"<p>If custom networking is currently enabled, Amazon EKS recommends re-evaluating your need for it with IPv6. If you chose to use custom networking to address the IPv4 exhaustion issue, it is no longer necessary with IPv6. If you are utilizing custom networking to satisfy a security requirement, such as a separate network for nodes and Pods, you are encouraged to submit an EKS roadmap request.</p>"},{"location":"networking/ipv6/#fargate-pods-in-eksipv6-cluster","title":"Fargate Pods in EKS/IPv6 Cluster","text":"<p>EKS supports IPv6 for Pods running on Fargate. Pods running on Fargate will consume IPv6 and VPC Routable Private IPv4 addresses carved from the VPC CIDR ranges (IPv4&amp;IPv6). In simple words your EKS/Fargate Pods cluster wide density will be limited to the available IPv4 and IPv6 addresses. It is recommended to size your dual-stack subnets/VPC CIDRs for future growth. You will not be able to schedule new Fargate Pods if the underlying subnet does not contain an available IPv4 address, irrespective of IPv6 available addresses.</p>"},{"location":"networking/ipv6/#deploy-the-aws-load-balancer-controller-lbc","title":"Deploy the AWS Load Balancer Controller (LBC)","text":"<p>The upstream in-tree Kubernetes service controller does not support IPv6. We recommend using the most recent version of the AWS Load Balancer Controller add-on. The LBC will only deploy a dual-stack NLB or a dual-stack ALB upon consuming corresponding kubernetes service/ingress definition annotated with: <code>\"alb.ingress.kubernetes.io/ip-address-type: dualstack\"</code> and <code>\"alb.ingress.kubernetes.io/target-type: ip\"</code> </p> <p>AWS Network Load Balancer does not support dual-stack UDP protocol address types. If you have strong requirements for low-latency, real-time streaming, online gaming, and IoT, we recommend running IPv4 clusters. To learn more about managing health checks for UDP services, please refer to \u201cHow to route UDP traffic into Kubernetes\u201d.</p>"},{"location":"networking/loadbalancing/loadbalancing/","title":"Avoiding Errors &amp; Timeouts with Kubernetes Applications and AWS Load Balancers","text":"<p>After creating the necessary Kubernetes resources (Service, Deployment, Ingress, etc), your pods should be able to receive traffic from your clients through an Elastic Load Balancer. However, you may find that errors, timeouts, or connection resets are being generated when you make changes to the application or Kubernetes environment. Those changes could trigger an application deployment or a scaling action (either manual or automatic).</p> <p>Unfortunately, those errors may be generated even when your application is not logging problems. This is because the Kubernetes systems controlling the resources in your cluster may be running faster than the AWS systems that control the Load Balancer's target registration and health. Your Pods may also start receiving traffic before your application is ready to receive requests.</p> <p>Lets review the process through which a pod becomes Ready and how traffic can be routed into the pods.</p>"},{"location":"networking/loadbalancing/loadbalancing/#pod-readiness","title":"Pod Readiness","text":"<p>This diagram from a 2019 Kubecon talk, shows the steps taken for a pod to become Ready and receive traffic for a <code>LoadBalancer</code> service:  Ready? A Deep Dive into Pod Readiness Gates for Service Health... - Minhan Xia &amp; Ping Zou When a pod that is a member of a NodePort Service is created, Kubernetes will go through the following steps:</p> <ol> <li>The pod is created on the Kubernetes control plane (i.e. from a <code>kubectl</code> command or scaling action).</li> <li>The pod is scheduled by the <code>kube-scheduler</code> and is assigned to a node in the cluster. </li> <li>The kubelet running on the assigned node will receive the update (via <code>watch</code>) and will communicate with it\u2019s local Container Runtime to start the containers specified in the pod. <ol> <li>When the containers have started running (and optionally pass <code>ReadinessProbes</code>), the kubelet will update the pod status to <code>Ready</code> by sending an update to the <code>kube-apiserver</code></li> </ol> </li> <li>The Endpoint Controller will receive an update (via <code>watch</code>) that there is a new pod that is <code>Ready</code> to be added to the Endpoints list for the Service and will add the pod IP/Port tuples to the appropriate endpoints array.</li> <li><code>kube-proxy</code> receives an update (via <code>watch</code>) that there is a new IP/Port to add to the iptables rules for the Service.<ol> <li>The local iptables rules on the worker node will be updated with the additional target pod for the NodePort Service.</li> </ol> </li> </ol> <p>Note</p> <p>When using an Ingress resource and Ingress Controller (like the AWS Load Balancer Controller) step 5 is handled by the relevant controller instead of <code>kube-proxy</code>. The controller will then take the necessary configuration steps (such as registering/deregistering the target to a load balancer) to allow traffic to flow as expected.</p> <p>When a pod is terminated, or changes to a not-ready state, a similar process occurs. The API server will receive either an update from a controller, kubelet, or kubectl client to terminate the pod. Steps 3-5 continue from there but will remove the Pod IP/Tuple from the endpoints list and iptables rules rather than insert.</p>"},{"location":"networking/loadbalancing/loadbalancing/#impact-on-deployments","title":"Impact on Deployments","text":"<p>Below is a diagram showing the steps taken when an application deployment triggers the replacement of pods:  Ready? A Deep Dive into Pod Readiness Gates for Service Health... - Minhan Xia &amp; Ping Zou Of note in this diagram is that the second Pod will not be deployed until the first pod has reached the \u201cReady\u201d state. Steps 4 and 5 from the previous section will also happen in parallel with the deployment actions above.</p> <p>This means that the actions to propagate the new pod status may still be in-progress when the Deployment controller moves on to the next pods. Since this process also terminates the older version of pods, this could lead to a situation where the pods have reached a Ready status but those changes are still being propagated and the older versions of the pod have been terminated. </p> <p>This problem is exacerbated when working with load balancers from Cloud Providers like AWS as the Kubernetes systems described above do not, by default, take into account registration times or health checks on the Load Balancer. This means the Deployment update could completely cycle through the pods, but the Load Balancer has not finished performing the health checks or registrating the new Pods which could cause an outage.</p> <p>A similar problem occurs when a pod is terminated. Depending on the Load Balancer configuration the Pod may take a minute or two to deregister and stop taking new requests. Kubernetes does not delay rolling deployments for this deregistration, this can lead to a state where the Load Balancer is still sending traffic to the IP/port for a target Pod that has already been terminated.</p> <p>To avoid these problems we can add configuration to ensure the Kubernetes systems take actions more in line with the AWS Load Balancer behavior.</p>"},{"location":"networking/loadbalancing/loadbalancing/#recommendations","title":"Recommendations","text":""},{"location":"networking/loadbalancing/loadbalancing/#use-ip-target-type-load-balancers","title":"Use IP Target-Type Load Balancers","text":"<p>When creating a <code>LoadBalancer</code> type service the traffic is sent from the load balancer to any node in the cluster via Instance target type registration. Each node then redirects the traffic from the <code>NodePort</code> to a Pod/IP tuple in the Service\u2019s Endpoints array, this target could be running on a separate worker node</p> <p>Note</p> <p>Remember that array should only have \u201cReady\u201d pods</p> <p></p> <p>This adds an additional hop to your request, and adds complexity to the Load Balancer configuration. For example, if the Load Balancer above was configured with session affinity, that affinity could only hold between the load balancer and the backend node (depending on the affinity configuration). </p> <p>Since the Load Balancer is not communicating with the backend Pod directly, controlling the traffic flow and timing with the Kubernetes systems becomes more difficult.</p> <p>When using the AWS Load Balancer Controller, IP target type can be used to register the Pod IP/Port tuples with the Load Balancer directly:  This simplifies the traffic path from the Load Balancer to the target Pods. This means when a new target is registered we can be sure that target is a \u201cReady\u201d Pod IP and port, the health checks from the load balancer will hit the Pod Directly, and when reviewing VPC flow logs or monitoring utilities traffic between the Load Balancer and the Pods will be easily traceable.</p> <p>Using IP registration also allows us to control the timing and configuration of the traffic directly against the backend Pods, rather than trying to manage connections through the <code>NodePort</code> rules as well.</p>"},{"location":"networking/loadbalancing/loadbalancing/#utilize-pod-readiness-gates","title":"Utilize Pod Readiness Gates","text":"<p>Pod Readiness Gates are additional requirements that must be met before the Pod is allowed to reach the \u201cReady\u201d state.</p> <p>[...] the AWS Load Balancer controller can set the readiness condition on the pods that constitute your ingress or service backend. The condition status on a pod will be set to <code>True</code> only when the corresponding target in the ALB/NLB target group shows a health state of \u00bbHealthy\u00ab. This prevents the rolling update of a deployment from terminating old pods until the newly created pods are \u00bbHealthy\u00ab in the ALB/NLB target group and ready to take traffic.</p> <p>The readiness gates ensure that Kubernetes doesn\u2019t move \u201ctoo fast\u201d when creating new replicas during a deployment and avoids the situation where Kubernetes has completed the deployment but the new Pods have not completed registration.</p> <p>To enable these you will need to:</p> <ol> <li>Deploy the latest version of the AWS Load Balancer Controller (Refer to the documentation if upgrading older versions)</li> <li>Label the namespace where the target pods are running with the <code>elbv2.k8s.aws/pod-readiness-gate-inject: enabled</code> label to inject Pod Readiness Gates automatically.</li> <li>To ensure all of your pods in a namespace get the readiness gate config, you need create your Ingress or Service and label the namespace before creating the pods.</li> </ol>"},{"location":"networking/loadbalancing/loadbalancing/#ensure-pods-are-deregistered-from-load-balancers-before-termination","title":"Ensure Pods are Deregistered from Load Balancers before Termination","text":"<p>When a pod is terminated steps 4 and 5 from the pod readiness section occur at the same time that the container processes receive the termination signals. This means that if your container is able to shut down quickly it may shut down faster than the Load Balancer is able to deregister the target. To avoid this situation adjust the Pod spec with:</p> <ol> <li>Add a <code>preStop</code> lifecycle hook to allow the application to deregister and gracefully close connections. This hook is called immediately before a container is terminated due to an API request or management event such as a liveness/startup probe failure, preemption, resource contention and others. Critically, this hook is called and allowed to complete before the termination signals are sent, provided the grace period is long enough to accommodate the execution.</li> </ol> <pre><code>        lifecycle:\n          preStop:\n            exec:\n              command: [\"/bin/sh\", \"-c\", \"sleep 180\"] \n</code></pre> <p>A simple sleep command like the one above can be used to introduce a short delay between when the pod is marked <code>Terminating</code> (and Load Balancer deregistration begins) and when the termination signal is sent to the container process. If needed this hook can also be leveraged for more advanced application termination/shutdown procedures.</p> <ol> <li>Extend the <code>terminationGracePeriodSeconds</code> to accommodate the entire <code>prestop</code> execution time, as well as the time your application takes to gracefully respond to the termination signal. In the example below the grace period is extended to 200s which allows the entire <code>sleep 180</code> command to complete and then an extra 20s just to be sure my app can shutdown gracefully.</li> </ol> <pre><code>    spec:\n      terminationGracePeriodSeconds: 200\n      containers:\n      - name: webapp\n        image: webapp-st:v1.3\n        [...]\n        lifecycle:\n          preStop:\n            exec:\n              command: [\"/bin/sh\", \"-c\", \"sleep 180\"] \n</code></pre>"},{"location":"networking/loadbalancing/loadbalancing/#ensure-pods-have-readiness-probes","title":"Ensure Pods have Readiness Probes","text":"<p>When creating Pods in Kubernetes the default Readiness state is \u201cReady\u201d, however most applications take a moment or two to instantiate and become ready for requests. You can define a <code>readinessProbe</code> in the Pod spec with an exec command or network request that is used to determine if the application has completed its start up and is ready for traffic. </p> <p>Pods that are created with a <code>readinessProbe</code> defined start in a \u201cNotReady\u201d state, and only change to \u201cReady\u201d when the <code>readinessProbe</code> is successful. This ensures that applications are not put \u201cin-service\u201d until the application has completed startup.</p> <p>Liveness probes are recommended to allow for application restarts when entering a broken state, e.g. deadlocks, however care should be taken with stateful applications as liveness failures will trigger a restart of the application. Startup probes can also be leveraged for applications that are slow to start.</p> <p>The below probes use HTTP probes against port 80 to check when the web application becomes ready (the same probe configuration is also used for the liveness probe):</p> <pre><code>        [...]\n        ports:\n        - containerPort: 80\n        livenessProbe:\n          httpGet:\n            path: /\n            port: 80\n          failureThreshold: 1\n          periodSeconds: 10\n          initialDelaySeconds: 5\n        readinessProbe:\n          httpGet:\n            path: /\n            port: 80\n          periodSeconds: 5\n        [...]\n</code></pre>"},{"location":"networking/loadbalancing/loadbalancing/#configure-a-pod-disruption-budget","title":"Configure a Pod Disruption Budget","text":"<p>A Pod Disruption Budget (PDB) limits the number of Pods of a replicated application that are down simultaneously from voluntary disruptions. For example, a quorum-based application would like to ensure that the number of replicas running is never brought below the number needed for a quorum. A web front end might want to ensure that the number of replicas serving load never falls below a certain percentage of the total.</p> <p>The PDB will protect the application against things like the nodes being drained, or application deployments. The PDB ensures that a minimum number or percentage of pods remain available while taking these actions. </p> <p>Attention</p> <p>PDB\u2019s will NOT protect the application against involuntary disruptions like a failure in the host OS or loss of network connectivity. </p> <p>The example below ensures that there is always at least 1 Pod available with the label <code>app: echoserver</code>. You can configure the correct replica count for your application or use a percentage:</p> <pre><code>apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: echoserver-pdb\n  namespace: echoserver\nspec:\n  minAvailable: 1\n  selector:\n    matchLabels:\n      app: echoserver\n</code></pre>"},{"location":"networking/loadbalancing/loadbalancing/#gracefully-handle-termination-signals","title":"Gracefully handle Termination Signals","text":"<p>When a pod is Terminated the application running inside the container will receive two Signals. The first is the <code>SIGTERM</code> signal, which is a \u201cpolite\u201d request that the process cease execution. This signal can be blocked or the application could simply ignore this signal, so after the <code>terminationGracePeriodSeconds</code> has elapsed the application will receive the <code>SIGKILL</code> signal. <code>SIGKILL</code> is used to forcibly stop a process, it cannot be blocked, handled or ignored, and is therefore always fatal.</p> <p>These Signals are used by the container runtime to trigger your application to shutdown. The <code>SIGTERM</code> signal will also be sent after the <code>preStop</code> hook has executed. With the above configuration the <code>preStop</code> hook will ensure the pod has been deregistered from the Load Balancer, so the application can then gracefully closes any remaining open connections when the <code>SIGTERM</code> signal is received. </p> <p>Note</p> <p>Signal handling in container environments can be complicated when using \u201cwrapper scripts\u201d for the entrypoint of your application as the script will be PID 1 and may not forward the signal to your application.</p>"},{"location":"networking/loadbalancing/loadbalancing/#be-wary-of-the-deregistration-delay","title":"Be Wary of the Deregistration Delay","text":"<p>Elastic Load Balancing stops sending requests to targets that are deregistering. By default, Elastic Load Balancing waits 300 seconds before completing the deregistration process, which can help in-flight requests to the target to complete. To change the amount of time that Elastic Load Balancing waits, update the deregistration delay value. The initial state of a deregistering target is <code>draining</code>. After the deregistration delay elapses, the deregistration process completes and the state of the target is <code>unused</code>. If the target is part of an Auto Scaling group, it can be terminated and replaced.</p> <p>If a deregistering target has no in-flight requests and no active connections, Elastic Load Balancing immediately completes the deregistration process, without waiting for the deregistration delay to elapse. </p> <p>Attention</p> <p>Even though target deregistration is complete, the status of the target is displayed as <code>draining</code> until the deregistration delay timeout expires. After the timeout expires, the target transitions to an <code>unused</code> state.</p> <p>If a deregistering target terminates the connection before the deregistration delay elapses, the client receives a 500-level error response.</p> <p>This can be configured using annotations on the Ingress resource using the<code>alb.ingress.kubernetes.io/target-group-attributes</code> annotation. Example:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: echoserver-ip\n  namespace: echoserver\n  annotations:\n    alb.ingress.kubernetes.io/scheme: internet-facing\n    alb.ingress.kubernetes.io/target-type: ip\n    alb.ingress.kubernetes.io/load-balancer-name: echoserver-ip\n    alb.ingress.kubernetes.io/target-group-attributes: deregistration_delay.timeout_seconds=30\nspec:\n  ingressClassName: alb\n  rules:\n    - host: echoserver.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Exact\n            backend:\n              service:\n                name: echoserver-service\n                port:\n                  number: 8080\n</code></pre>"},{"location":"networking/monitoring/","title":"Monitoring EKS workloads for Network performance issues","text":""},{"location":"networking/monitoring/#monitoring-coredns-traffic-for-dns-throttling-issues","title":"Monitoring CoreDNS traffic for DNS throttling issues","text":"<p>Running DNS intensive workloads can sometimes experience intermittent CoreDNS failures due to DNS throttling, and this can impact applications where you may encounter occasional UnknownHostException errors.</p> <p>The Deployment for CoreDNS has an anti-affinity policy that instructs the Kubernetes scheduler to run instances of CoreDNS on separate worker nodes in the cluster, i.e. it should avoid co-locating replicas on the same worker node. This effectively reduces the number of DNS queries per network interface because traffic from each replica is routed through a different ENI. If you notice that DNS queries are being throttled because of the 1024 packets per second limit, you can 1) try increasing the number of CoreDNS replicas or 2) implement NodeLocal DNSCache. See Monitor CoreDNS Metrics for further information.</p>"},{"location":"networking/monitoring/#challenge","title":"Challenge","text":"<ul> <li>Packet drop happens in seconds and it can be tricky for us to properly monitor these patterns to determine if DNS throttling is actually happening.</li> <li>DNS queries are throttled at the elastic network interface level. So, throttled queries don't appear in the query logging. </li> <li>Flow logs do not capture all IP traffic. E.g. Traffic generated by instances when they contact the Amazon DNS server. If you use your own DNS server, then all traffic to that DNS server is logged</li> </ul>"},{"location":"networking/monitoring/#solution","title":"Solution","text":"<p>An easy way to identify the DNS throttling issues in worker nodes is by capturing <code>linklocal_allowance_exceeded</code> metric. The linklocal_allowance_exceeded is number of packets dropped because the PPS of the traffic to local proxy services exceeded the maximum for the network interface. This impacts traffic to the DNS service, the Instance Metadata Service, and the Amazon Time Sync Service. Instead of tracking this event real-time, we can stream this metric to Amazon Managed Service for Prometheus as well and can have them visualized in Amazon Managed Grafana</p>"},{"location":"networking/monitoring/#monitoring-dns-query-delays-using-conntrack-metrics","title":"Monitoring DNS query delays using Conntrack metrics","text":"<p>Another metric that can help in monitoring the CoreDNS throttling / query delay are <code>conntrack_allowance_available</code> and <code>conntrack_allowance_exceeded</code>. Connectivity failures caused by exceeding Connections Tracked allowances can have a larger impact than those resulting from exceeding other allowances. When relying on TCP to transfer data, packets that are queued or dropped due to exceeding EC2 instance network allowances, such as Bandwidth, PPS, etc., are typically handled gracefully thanks to TCP\u2019s congestion control capabilities. Impacted flows will be slowed down, and lost packets will be retransmitted. However, when an instance exceeds its Connections Tracked allowance, no new connections can be established until some of the existing ones are closed to make room for new connections. </p> <p><code>conntrack_allowance_available</code> and <code>conntrack_allowance_exceeded</code> helps customers in monitoring the connections tracked allowance which varies for every instance. These network performance metrics give customers visibility into the number of packets queued or dropped when an instance\u2019s networking allowances, such as Network Bandwidth, Packets-Per-Second (PPS), Connections Tracked, and Link-local service access (Amazon DNS, Instance Meta Data Service, Amazon Time Sync) are exceeded</p> <p><code>conntrack_allowance_available</code> is the number of tracked connections that can be established by the instance before hitting the Connections Tracked allowance of that instance type (supported for nitro-based instance only).  <code>conntrack_allowance_exceeded</code> is the number of packets dropped because connection tracking exceeded the maximum for the instance and new connections could not be established. </p>"},{"location":"networking/monitoring/#other-important-network-performance-metrics","title":"Other important Network performance metrics","text":"<p>Other important network performance metrics include:</p> <p><code>bw_in_allowance_exceeded</code> (ideal value of the metric should be zero) is the number of packets queued and/or dropped because the inbound aggregate bandwidth exceeded the maximum for the instance</p> <p><code>bw_out_allowance_exceeded</code> (ideal value of the metric should be zero) is the number of packets queued and/or dropped because the outbound aggregate bandwidth exceeded the maximum for the instance</p> <p><code>pps_allowance_exceeded</code> (ideal value of the metric should be zero) is the number of packets queued and/or dropped because the bidirectional PPS exceeded the maximum for the instance</p>"},{"location":"networking/monitoring/#capturing-the-metrics-to-monitor-workloads-for-network-performance-issues","title":"Capturing the metrics to monitor workloads for network performance issues","text":"<p>The Elastic Network Adapter (ENA ) driver publishes network performance metrics discussed above from the instances where they are enabled. All the network performance metrics can be published to CloudWatch using the CloudWatch agent. Please refer to the blog for more information.</p> <p>Let's now capture the metrics discussed above, store them in Amazon Managed Service for Prometheus and visualize using Amazon Managed Grafana</p>"},{"location":"networking/monitoring/#prerequisites","title":"Prerequisites","text":"<ul> <li>ethtool - Ensure the worker nodes have ethtool installed</li> <li>An AMP workspace configured in your AWS account. For instructions, see Create a workspace in the AMP User Guide.</li> <li>Amazon Managed Grafana Workspace</li> </ul>"},{"location":"networking/monitoring/#deploying-prometheus-ethtool-exporter","title":"Deploying Prometheus ethtool exporter","text":"<p>The deployment contains a python script that pulls information from ethtool and publishes it in prometheus format.</p> <pre><code>kubectl apply -f https://raw.githubusercontent.com/Showmax/prometheus-ethtool-exporter/master/deploy/k8s-daemonset.yaml\n</code></pre>"},{"location":"networking/monitoring/#deploy-the-adot-collector-to-scrape-the-ethtool-metrics-and-store-in-amazon-managed-service-for-prometheus-workspace","title":"Deploy the ADOT collector to scrape the ethtool metrics and store in Amazon Managed Service for Prometheus workspace","text":"<p>Each cluster where you install AWS Distro for OpenTelemetry (ADOT) must have this role to grant your AWS service account permissions to store metrics into Amazon Managed Service for Prometheus. Follow these steps to create and associate your IAM role to your Amazon EKS service account using IRSA:</p> <pre><code>eksctl create iamserviceaccount --name adot-collector --namespace default --cluster &lt;CLUSTER_NAME&gt; --attach-policy-arn arn:aws:iam::aws:policy/AmazonPrometheusRemoteWriteAccess --attach-policy-arn arn:aws:iam::aws:policy/AWSXrayWriteOnlyAccess --attach-policy-arn arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy --region &lt;REGION&gt; --approve  --override-existing-serviceaccounts\n</code></pre> <p>Let's deploy the ADOT collector to scrape the metrcis from the prometheus ethtool exporter and store it in Amazon Managed Service for Prometheus</p> <p>The following procedure uses an example YAML file with deployment as the mode value. This is the default mode and deploys the ADOT Collector similarly to a standalone application. This configuration receives OTLP metrics from the sample application and Amazon Managed Service for Prometheus metrics scraped from pods on the cluster</p> <pre><code>curl -o collector-config-amp.yaml https://raw.githubusercontent.com/aws-observability/aws-otel-community/master/sample-configs/operator/collector-config-amp.yaml\n</code></pre> <p>In collector-config-amp.yaml, replace the following with your own values: * mode: deployment * serviceAccount: adot-collector * endpoint: \"\" * region: \"\" * name: adot-collector <pre><code>kubectl apply -f collector-config-amp.yaml \n</code></pre> <p>Once the adot collector is deployed, the metrics will be stored successfully in Amazon Prometheus</p>"},{"location":"networking/monitoring/#configure-alert-manager-in-amazon-managed-service-for-prometheus-to-send-notifications","title":"Configure alert manager in Amazon Managed Service for Prometheus to send notifications","text":"<p>Let's configure recording rules and alerting rules to check for the metrics discussed so far. </p> <p>We will use the ACK Controller for Amazon Managed Service for Prometheus to provision the alerting and recording rules.</p> <p>Let's deploy the ACL controller for the Amazon Managed Service for Prometheus service:</p> <pre><code>export SERVICE=prometheusservice\nexport RELEASE_VERSION=`curl -sL https://api.github.com/repos/aws-controllers-k8s/$SERVICE-controller/releases/latest | grep '\"tag_name\":' | cut -d'\"' -f4`\nexport ACK_SYSTEM_NAMESPACE=ack-system\nexport AWS_REGION=us-east-1\naws ecr-public get-login-password --region us-east-1 | helm registry login --username AWS --password-stdin public.ecr.aws\nhelm install --create-namespace -n $ACK_SYSTEM_NAMESPACE ack-$SERVICE-controller \\\noci://public.ecr.aws/aws-controllers-k8s/$SERVICE-chart --version=$RELEASE_VERSION --set=aws.region=$AWS_REGION\n</code></pre> <p>Run the command and after a few moments you should see the following message:</p> <pre><code>You are now able to create Amazon Managed Service for Prometheus (AMP) resources!\n\nThe controller is running in \"cluster\" mode.\n\nThe controller is configured to manage AWS resources in region: \"us-east-1\"\n\nThe ACK controller has been successfully installed and ACK can now be used to provision an Amazon Managed Service for Prometheus workspace.\n</code></pre> <p>Let's now create a yaml file for provisioning the alert manager defnition and rule groups. Save the below file as <code>rulegroup.yaml</code></p> <pre><code>apiVersion: prometheusservice.services.k8s.aws/v1alpha1\nkind: RuleGroupsNamespace\nmetadata:\n   name: default-rule\nspec:\n   workspaceID: &lt;Your WORKSPACE-ID&gt;\n   name: default-rule\n   configuration: |\n     groups:\n     - name: ppsallowance\n       rules:\n       - record: metric:pps_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"pps_allowance_exceeded\"}[30s])\n       - alert: PPSAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"pps_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"PPSAllowanceExceeded is greater than 0\"\n     - name: bw_in\n       rules:\n       - record: metric:bw_in_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_in_allowance_exceeded\"}[30s])\n       - alert: BWINAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_in_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"BWInAllowanceExceeded is greater than 0\"\n     - name: bw_out\n       rules:\n       - record: metric:bw_out_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_out_allowance_exceeded\"}[30s])\n       - alert: BWOutAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_out_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"BWoutAllowanceExceeded is greater than 0\"            \n     - name: conntrack\n       rules:\n       - record: metric:conntrack_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"conntrack_allowance_exceeded\"}[30s])\n       - alert: ConntrackAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"conntrack_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"ConnTrackAllowanceExceeded is greater than 0\"\n     - name: linklocal\n       rules:\n       - record: metric:linklocal_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"linklocal_allowance_exceeded\"}[30s])\n       - alert: LinkLocalAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"linklocal_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Packets dropped due to PPS rate allowance exceeded for local services  (instance {{ $labels.instance }})\n           description: \"LinkLocalAllowanceExceeded is greater than 0\"\n</code></pre> <p>Replace Your WORKSPACE-ID with the Workspace ID of the  workspace you are using. </p> <p>Let's now configure the alert manager definition. Save the below fie as <code>alertmanager.yaml</code></p> <pre><code>apiVersion: prometheusservice.services.k8s.aws/v1alpha1  \nkind: AlertManagerDefinition\nmetadata:\n  name: alert-manager\nspec:\n  workspaceID: &lt;Your WORKSPACE-ID &gt;\n  configuration: |\n    alertmanager_config: |\n      route:\n         receiver: default_receiver\n       receivers:\n       - name: default_receiver\n          sns_configs:\n          - topic_arn: TOPIC-ARN\n            sigv4:\n              region: REGION\n            message: |\n              alert_type: {{ .CommonLabels.alertname }}\n              event_type: {{ .CommonLabels.event_type }}     \n</code></pre> <p>Replace You WORKSPACE-ID with the Workspace ID of the new workspace, TOPIC-ARN with the ARN of an Amazon Simple Notification Service topic where you want to send the alerts, and REGION with the current region of the workload. Make sure that your workspace has permissions to send messages to Amazon SNS.</p>"},{"location":"networking/monitoring/#visualize-ethtool-metrics-in-amazon-managed-grafana","title":"Visualize ethtool metrics in Amazon Managed Grafana","text":"<p>Let's visualize the metrics within the Amazon Managed Grafana and build a dashboard. Configure the Amazon Managed Service for Prometheus as a datasource inside the Amazon Managed Grafana console. For instructions, see Add Amazon Prometheus as a datasource</p> <p>Let's explore the metrics in Amazon Managed Grafana now: Click the explore button, and search for ethtool:</p> <p></p> <p>Let's build a dashboard for the linklocal_allowance_exceeded metric by using the query <code>rate(node_net_ethtool{device=\"eth0\",type=\"linklocal_allowance_exceeded\"}[30s])</code>. It will result in the below dashboard. </p> <p></p> <p>We can clearly see that there were no packets dropped as the value is zero. </p> <p>Let's build a dashboard for the conntrack_allowance_exceeded metric by using the query <code>rate(node_net_ethtool{device=\"eth0\",type=\"conntrack_allowance_exceeded\"}[30s])</code>. It will result in the below dashboard. </p> <p></p> <p>The metric <code>conntrack_allowance_exceeded</code> can be visualized in CloudWatch, provided you run a cloudwatch agent as described here. The resulting dashboard in CloudWatch will look like below:</p> <p></p> <p>We can clearly see that there were no packets dropped as the value is zero. If you are using Nitro-based instances, you can create a similar dashboard for <code>conntrack_allowance_available</code> and pro-actively monitor the connections in your EC2 instance. You can further extend this by configuring alerts in Amazon Managed Grafana to send notifications to Slack, SNS, Pagerduty etc.</p>"},{"location":"networking/prefix-mode/index_linux/","title":"Prefix Mode for Linux","text":"<p>Amazon VPC CNI assigns network prefixes to Amazon EC2 network interfaces to increase the number of IP addresses available to nodes and increase pod density per node. You can configure version 1.9.0 or later of the Amazon VPC CNI add-on to assign IPv4 and IPv6 CIDRs instead of assigning individual secondary IP addresses to network interfaces. </p> <p>Prefix mode is enabled by default on IPv6 clusters and is the only option supported. The VPC CNI assigns a /80 IPv6 prefix to a slot on an ENI. Please refer to the IPv6 section of this guide for further information. </p> <p>With prefix assignment mode, the maximum number of elastic network interfaces per instance type remains the same, but you can now configure Amazon VPC CNI to assign /28 (16 IP addresses) IPv4 address prefixes, instead of assigning individual IPv4 addresses to the slots on network interfaces. When <code>ENABLE_PREFIX_DELEGATION</code> is set to true VPC CNI allocates an IP address to a Pod from the prefix assigned to an ENI.  Please follow the instructions mentioned in the EKS user guide to enable Prefix IP mode. </p> <p></p> <p>The maximum number of IP addresses that you can assign to a network interface depends on the instance type. Each prefix that you assign to a network interface counts as one IP address. For example, a <code>c5.large</code> instance has a limit of <code>10</code> IPv4 addresses per network interface. Each network interface for this instance has a primary IPv4 address. If a network interface has no secondary IPv4 addresses, you can assign up to 9 prefixes to the network interface. For each additional IPv4 address that you assign to a network interface, you can assign one less prefix to the network interface. Review the AWS EC2 documentation on IP addresses per network interface per instance type and assigning prefixes to network interfaces.</p> <p>During worker node initialization, the VPC CNI assigns one or more prefixes to the primary ENI. The CNI pre-allocates a prefix for faster pod startup by maintaining a warm pool. The number of prefixes to be held in warm pool can be controlled by setting environment variables.</p> <ul> <li><code>WARM_PREFIX_TARGET</code>, the number of prefixes to be allocated in excess of current need.</li> <li><code>WARM_IP_TARGET</code>, the number of IP addresses to be allocated in excess of current need.</li> <li><code>MINIMUM_IP_TARGET</code>, the minimum number of IP addresses to be available at any time.</li> <li><code>WARM_IP_TARGET</code> and <code>MINIMUM_IP_TARGET</code> if set will override <code>WARM_PREFIX_TARGET</code>.</li> </ul> <p>As more Pods scheduled additional prefixes will be requested for the existing ENI. First, the VPC CNI attempts to allocate a new prefix to an existing ENI. If the ENI is at capacity, the VPC CNI attempts to allocate a new ENI to the node. New ENIs will be attached until the maximum ENI limit (defined by the instance type) is reached. When a new ENI is attached, ipamd will allocate one or more prefixes needed to maintain the <code>WARM_PREFIX_TARGET</code>, <code>WARM_IP_TARGET</code>, and <code>MINIMUM_IP_TARGET</code> setting.</p> <p></p>"},{"location":"networking/prefix-mode/index_linux/#recommendations","title":"Recommendations","text":""},{"location":"networking/prefix-mode/index_linux/#use-prefix-mode-when","title":"Use Prefix Mode when","text":"<p>Use prefix mode if you are experiencing Pod density issue on the worker nodes. To avoid VPC CNI errors, we recommend examining the subnets for contiguous block of addresses for /28 prefix before migrate to prefix mode. Please refer \u201cUse Subnet Reservations to Avoid Subnet Fragmentation (IPv4)\u201d section for Subnet reservation details. </p> <p>For backward compatibility, the max-pods limit is set to support secondary IP mode. To increase the pod density, please specify the <code>max-pods</code> value to Kubelet and <code>--use-max-pods=false</code> as the user data for the nodes. You may consider using the max-pod-calculator.sh script to calculate EKS\u2019s recommended maximum number of pods for a given instance type. Refer to the EKS user guide for example user data.</p> <pre><code>./max-pods-calculator.sh --instance-type m5.large --cni-version ``1.9``.0 --cni-prefix-delegation-enabled\n</code></pre> <p>Prefix assignment mode is especially relevant for users of CNI custom networking where the primary ENI is not used for pods. With prefix assignment, you can still attach more IPs on nearly every Nitro instance type, even without the primary ENI used for pods.</p>"},{"location":"networking/prefix-mode/index_linux/#avoid-prefix-mode-when","title":"Avoid Prefix Mode when","text":"<p>If your subnet is very fragmented and has insufficient available IP addresses to create /28 prefixes, avoid using prefix mode. The prefix attachment may fail if the subnet from which the prefix is produced is fragmented (a heavily used subnet with scattered secondary IP addresses). This problem may be avoided by creating a new subnet and reserving a prefix.</p> <p>In prefix mode, the security group assigned to the worker nodes is shared by the Pods. Consider using Security groups for Podsif you have a security requirement to achieve compliance by running applications with varying network security requirements on shared compute resources.</p>"},{"location":"networking/prefix-mode/index_linux/#use-similar-instance-types-in-the-same-node-group","title":"Use Similar Instance Types in the same Node Group","text":"<p>Your node group may contain instances of many types. If an instance has a low maximum pod count, that value is applied to all nodes in the node group. Consider using similar instance types in a node group to maximize node use. We recommend configuring node.kubernetes.io/instance-type in the requirements part of the provisioner API if you are using Karpenter for automated node scaling.</p> <p>Warning</p> <p>The maximum pod count for all nodes in a particular node group is defined by the lowest maximum pod count of any single instance type in the node group.</p>"},{"location":"networking/prefix-mode/index_linux/#configure-warm_prefix_target-to-conserve-ipv4-addresses","title":"Configure <code>WARM_PREFIX_TARGET</code> to conserve IPv4 addresses","text":"<p>The installation manifest\u2019s default value for <code>WARM_PREFIX_TARGET</code> is 1. In most cases, the recommended value of 1 for <code>WARM_PREFIX_TARGET</code> will provide a good mix of fast pod launch times while minimizing unused IP addresses assigned to the instance.</p> <p>If you have a need to further conserve IPv4 addresses per node use <code>WARM_IP_TARGET</code> and <code>MINIMUM_IP_TARGET</code> settings, which override <code>WARM_PREFIX_TARGET</code> when configured. By setting <code>WARM_IP_TARGET</code> to a value less than 16, you can prevent the CNI from keeping an entire excess prefix attached.</p>"},{"location":"networking/prefix-mode/index_linux/#prefer-allocating-new-prefixes-over-attaching-a-new-eni","title":"Prefer allocating new prefixes over attaching a new ENI","text":"<p>Allocating an additional prefix to an existing ENI is a faster EC2 API operation than creating and attaching a new ENI to the instance. Using prefixes improves performance while being frugal with IPv4 address allocation. Attaching a prefix typically completes in under a second, whereas attaching a new ENI can take up to 10 seconds. For most use cases, the CNI will only need a single ENI per worker node when running in prefix mode. If you can afford (in the worst case) up to 15 unused IPs per node, we strongly recommend using the newer prefix assignment networking mode, and realizing the performance and efficiency gains that come with it.</p>"},{"location":"networking/prefix-mode/index_linux/#use-subnet-reservations-to-avoid-subnet-fragmentation-ipv4","title":"Use Subnet Reservations to Avoid Subnet Fragmentation (IPv4)","text":"<p>When EC2 allocates a /28 IPv4 prefix to an ENI, it has to be a contiguous block of IP addresses from your subnet. If the subnet that the prefix is generated from is fragmented (a highly used subnet with scattered secondary IP addresses), the prefix attachment may fail, and you will see the following error message in the VPC CNI logs:</p> <pre><code>failed to allocate a private IP/Prefix address: InsufficientCidrBlocks: There are not enough free cidr blocks in the specified subnet to satisfy the request.\n</code></pre> <p>To avoid fragmentation and have sufficient contiguous space for creating prefixes, you may use VPC Subnet CIDR reservations to reserve IP space within a subnet for exclusive use by prefixes. Once you create a reservation, the VPC CNI plugin will call EC2 APIs to assign prefixes that are automatically allocated from the reserved space.</p> <p>It is recommended to create a new subnet, reserve space for prefixes, and enable prefix assignment with VPC CNI for worker nodes running in that subnet. If the new subnet is dedicated only to Pods running in your EKS cluster with VPC CNI prefix assignment enabled, then you can skip the prefix reservation step.</p>"},{"location":"networking/prefix-mode/index_linux/#avoid-downgrading-vpc-cni","title":"Avoid downgrading VPC CNI","text":"<p>Prefix mode works with VPC CNI version 1.9.0 and later. Downgrading of the Amazon VPC CNI add-on to a version lower than 1.9.0 must be avoided once the prefix mode is enabled and prefixes are assigned to ENIs. You must delete and recreate nodes if you decide to downgrade the VPC CNI.</p>"},{"location":"networking/prefix-mode/index_linux/#replace-all-nodes-during-the-transition-to-prefix-delegation","title":"Replace all nodes during the transition to Prefix Delegation","text":"<p>It is highly recommended that you create new node groups to increase the number of available IP addresses rather than doing rolling replacement of existing worker nodes. Cordon and drain all the existing nodes to safely evict all of your existing Pods. To prevent service disruptions, we suggest implementing Pod Disruption Budgets on your production clusters for critical workloads. Pods on new nodes will be assigned an IP from a prefix assigned to an ENI. After you confirm the Pods are running, you can delete the old nodes and node groups. If you are using managed node groups, please follow steps mentioned here to safely delete a node group.</p>"},{"location":"networking/prefix-mode/index_windows/","title":"Prefix Mode for Windows","text":"<p>In Amazon EKS, each Pod that runs on a Windows host is assigned a secondary IP address by the VPC resource controller by default. This IP address is a VPC-routable address that is allocated from the host's subnet. On Linux, each ENI attached to the instance has multiple slots that can be populated by a secondary IP address or a /28 CIDR (a prefix). Windows hosts, however, only support a single ENI and its available slots. Using only secondary IP addresses can artifically limit the number of pods you can run on a Windows host, even when there is an abundance of IP addresses available for assignment.</p> <p>In order to increase the pod density on Windows hosts, especially when using smaller instance types, you can enable Prefix Delegation for Windows nodes. When prefix delegation is enabled, /28 IPv4 prefixes are assigned to ENI slots rather than secondary IP addresses. Prefix delegation can be enabled by adding the <code>enable-windows-prefix-delegation: \"true\"</code> entry to the <code>amazon-vpc-cni</code> config map. This is the same config map where you need to set <code>enable-windows-ipam: \"true\"</code> entry for enabling Windows support.</p> <p>Please follow the instructions mentioned in the EKS user guide to enable Prefix Delegation mode for Windows nodes.</p> <p></p> <p>Figure: Comparison of Secondary IP mode with Prefix Delegation mode </p> <p>The maximum number of IP addresses you can assign to a network interface depends on the instance type and its size. Each prefix assigned to a network interface consumes an available slot. For example, a <code>c5.large</code> instance has a limit of <code>10</code> slots per network interface. The first slot on a network interface is always consumed by the interface's primary IP address, leaving you with 9 slots for prefixes and/or secondary IP addresses. If these  slots are assigned prefixes, the node can support (9 * 16) 144 IP address whereas if they're assigned secondary IP addresses it can only support 9 IP addresses. See the documentation on IP addresses per network interface per instance type and assigning prefixes to network interfaces for further information.</p> <p>During worker node initialization, the VPC Resource Controller assigns one or more prefixes to the primary ENI for faster pod startup by maintaining a warm pool of the IP addresses. The number of prefixes to be held in warm pool can be controlled by setting the following configuration parameters in <code>amazon-vpc-cni</code> config map.</p> <ul> <li><code>warm-prefix-target</code>, the number of prefixes to be allocated in excess of current need.</li> <li><code>warm-ip-target</code>, the number of IP addresses to be allocated in excess of current need.</li> <li><code>minimum-ip-target</code>, the minimum number of IP addresses to be available at any time.</li> <li><code>warm-ip-target</code> and/or <code>minimum-ip-target</code> if set will override <code>warm-prefix-target</code>.</li> </ul> <p>As more Pods are scheduled on the node, additional prefixes will be requested for the existing ENI. When a Pod is scheduled on the node, VPC Resource Controller would first try to assign an IPv4 address from the existing prefixes on the node. If that is not possible, then a new IPv4 prefix will be requested as long as the subnet has the required capacity.</p> <p></p> <p>Figure: Workflow during assignment of IPv4 address to the Pod</p>"},{"location":"networking/prefix-mode/index_windows/#recommendations","title":"Recommendations","text":""},{"location":"networking/prefix-mode/index_windows/#use-prefix-delegation-when","title":"Use Prefix Delegation when","text":"<p>Use prefix delegation if you are experiencing Pod density issues on the worker nodes. To avoid errors, we recommend examining the subnets for contiguous block of addresses for /28 prefix before migrating to prefix mode. Please refer \u201cUse Subnet Reservations to Avoid Subnet Fragmentation (IPv4)\u201d section for Subnet reservation details. </p> <p>By default, the <code>max-pods</code> on Windows nodes is set to <code>110</code>. For the vast majority of instance types, this should be sufficient. If you want to increase or decrease this limit, then add the following to the bootstrap command in your user data: <pre><code>-KubeletExtraArgs '--max-pods=example-value'\n</code></pre> For more details about the bootstrap configuration parameters for Windows nodes, please visit the documentation here.</p>"},{"location":"networking/prefix-mode/index_windows/#avoid-prefix-delegation-when","title":"Avoid Prefix Delegation when","text":"<p>If your subnet is very fragmented and has insufficient available IP addresses to create /28 prefixes, avoid using prefix mode. The prefix attachment may fail if the subnet from which the prefix is produced is fragmented (a heavily used subnet with scattered secondary IP addresses). This problem may be avoided by creating a new subnet and reserving a prefix.</p>"},{"location":"networking/prefix-mode/index_windows/#configure-parameters-for-prefix-delegation-to-conserve-ipv4-addresses","title":"Configure parameters for prefix delegation to conserve IPv4 addresses","text":"<p><code>warm-prefix-target</code>, <code>warm-ip-target</code>, and <code>minimum-ip-target</code> can be used to fine tune the behaviour of pre-scaling and dynamic scaling with prefixes. By default, the following values are used: <pre><code>warm-ip-target: \"1\"\nminimum-ip-target: \"3\"\n</code></pre> By fine tuning these configuration parameters, you can achieve an optimal balance of conserving the IP addresses and ensuring decreased Pod latency due to assignment of IP address. For more information about these configuration parameters, visit the documentation here.</p>"},{"location":"networking/prefix-mode/index_windows/#use-subnet-reservations-to-avoid-subnet-fragmentation-ipv4","title":"Use Subnet Reservations to Avoid Subnet Fragmentation (IPv4)","text":"<p>When EC2 allocates a /28 IPv4 prefix to an ENI, it has to be a contiguous block of IP addresses from your subnet. If the subnet that the prefix is generated from is fragmented (a highly used subnet with scattered secondary IP addresses), the prefix attachment may fail, and you will see the following node event: <pre><code>InsufficientCidrBlocks: The specified subnet does not have enough free cidr blocks to satisfy the request\n</code></pre> To avoid fragmentation and have sufficient contiguous space for creating prefixes, use VPC Subnet CIDR reservations to reserve IP space within a subnet for exclusive use by prefixes. Once you create a reservation, the IP addresses from the reserved blocks will not be assigned to other resources. That way, VPC Resource Controller will be able to get available prefixes during the assignment call to the node ENI.</p> <p>It is recommended to create a new subnet, reserve space for prefixes, and enable prefix assignment for worker nodes running in that subnet. If the new subnet is dedicated only to Pods running in your EKS cluster with prefix delegation enabled, then you can skip the prefix reservation step.</p>"},{"location":"networking/prefix-mode/index_windows/#replace-all-nodes-when-migrating-from-secondary-ip-mode-to-prefix-delegation-mode-or-vice-versa","title":"Replace all nodes when migrating from Secondary IP mode to Prefix Delegation mode or vice versa","text":"<p>It is highly recommended that you create new node groups to increase the number of available IP addresses rather than doing rolling replacement of existing worker nodes.</p> <p>When using self-managed node groups, the steps for transition would be:</p> <ul> <li>Increase the capacity in your cluster such that the new nodes would be able to accomodate your workloads</li> <li>Enable/Disable the Prefix Delegation feature for Windows</li> <li>Cordon and drain all the existing nodes to safely evict all of your existing Pods. To prevent service disruptions, we suggest implementing Pod Disruption Budgets on your production clusters for critical workloads.</li> <li>After you confirm the Pods are running, you can delete the old nodes and node groups. Pods on new nodes will be assigned an IPv4 address from a prefix assigned to the node ENI.</li> </ul> <p>When using managed node groups, the steps for transition would be:</p> <ul> <li>Enable/Disable the Prefix Delegation feature for Windows</li> <li>Update the node group using the steps mentioned here. This performs similar steps as above but are managed by EKS.</li> </ul> <p>Warning</p> <p>Run all Pods on a node in the same mode</p> <p>For Windows, we recommend that you avoid running Pods in both secondary IP mode and prefix delegation mode at the same time. Such a situation can arise when you migrate from secondary IP mode to prefix delegation mode or vice versa with running Windows workloads.</p> <p>While this will not impact your running Pods, there can be inconsistency with respect to the node's IP address capacity. For example, consider that a t3.xlarge node which has 14 slots for secondary IPv4 addresses. If you are running 10 Pods, then 10 slots on the ENI will be consumed by secondary IP addresses. After you enable prefix delegation the capacity advertised to the kube-api server would be (14 slots * 16 ip addresses per prefix) 244 but the actual capacity at that moment would be (4 remaining slots * 16 addresses per prefix) 64. This inconsistency between the amount of capacity advertised and the actual amount of capacity (remaining slots) can cause issues if you run more Pods than there are IP addresses available for assignment.</p> <p>That being said, you can use the migration strategy as described above to safely transition your Pods from secondary IP address to addresses obtained from prefixes. When toggling between the modes, the Pods will continue running normally and:</p> <ul> <li>When toggling from secondary IP mode to prefix delegation mode, the secondary IP addresses assigned to the running pods will not be released. Prefixes will be assigned to the free slots. Once a pod is terminated, the secondary IP and slot it was using will be released.</li> <li>When toggling from prefix delegation mode to secondary IP mode, a prefix will be released when all the IPs within its range are no longer allocated to pods. If any IP from the prefix is assigned to a pod then that prefix will be kept until the pods are terminated.</li> </ul>"},{"location":"networking/prefix-mode/index_windows/#debugging-issues-with-prefix-delegation","title":"Debugging Issues with Prefix Delegation","text":"<p>You can use our debugging guide here to deep dive into the issue you are facing with prefix delegation on Windows.</p>"},{"location":"networking/sgpp/","title":"Security Groups Per Pod","text":"<p>An AWS security group acts as a virtual firewall for EC2 instances to control inbound and outbound traffic. By default, the Amazon VPC CNI will use security groups associated with the primary ENI on the node. More specifically, every ENI associated with the instance will have the same EC2 Security Groups. Thus, every Pod on a node shares the same security groups as the node it runs on. </p> <p>As seen in the image below, all application Pods operating on worker nodes will have access to the RDS database service (considering RDS inbound allows node security group). Security groups are too coarse grained because they apply to all Pods running on a node. Security groups for Pods provides network segmentation for workloads which is an essential part a good defense in depth strategy.</p> <p> With security groups for Pods, you can improve compute efficiency by running applications with varying network security requirements on shared compute resources. Multiple types of security rules, such as Pod-to-Pod and Pod-to-External AWS services, can be defined in a single place with EC2 security groups and applied to workloads with Kubernetes native APIs. The image below shows security groups applied at the Pod level and how they simplify your application deployment and node architecture. The Pod can now access Amazon RDS database.</p> <p></p> <p>You can enable security groups for Pods by setting <code>ENABLE_POD_ENI=true</code> for VPC CNI. Once enabled, the \u201cVPC Resource Controller\u201c running on the control plane (managed by EKS) creates and attaches a trunk interface called \u201caws-k8s-trunk-eni\u201c to the node. The trunk interface acts as a standard network interface attached to the instance. To manage trunk interfaces, you must add the <code>AmazonEKSVPCResourceController</code> managed policy to the cluster role that goes with your Amazon EKS cluster.</p> <p>The controller also creates branch interfaces named \"aws-k8s-branch-eni\" and associates them with the trunk interface. Pods are assigned a security group using the SecurityGroupPolicy custom resource and are associated with a branch interface. Since security groups are specified with network interfaces, we are now able to schedule Pods requiring specific security groups on these additional network interfaces. Review the EKS User Guide Section on Security Groups for Pods, including deployment prerequisites.</p> <p></p> <p>Branch interface capacity is additive to existing instance type limits for secondary IP addresses. Pods that use security groups are not accounted for in the max-pods formula and when you use security group for pods you need to consider raising the max-pods value or be ok with running fewer pods than the node can actually support.</p> <p>A m5.large can have up to 9 branch network interfaces and up to 27 secondary IP addresses assigned to its standard network interfaces. As shown in the example below, the default max-pods for a m5.large is 29, and EKS counts the Pods that use security groups towards the maximum Pods. Please see the EKS user guide for instructions on how to change the max-pods for nodes.</p> <p>When security groups for Pods are used in combination with custom networking, the security group defined in security groups for Pods is used rather than the security group specified in the ENIConfig. As a result, when custom networking is enabled, carefully assess security group ordering while using security groups per Pod.</p>"},{"location":"networking/sgpp/#recommendations","title":"Recommendations","text":""},{"location":"networking/sgpp/#disable-tcp-early-demux-for-liveness-probe","title":"Disable TCP Early Demux for Liveness Probe","text":"<p>If are you using liveness or readiness probes, you also need to disable TCP early demux, so that the kubelet can connect to Pods on branch network interfaces via TCP. This is only required in strict mode. To do this run the following command:</p> <pre><code>kubectl edit daemonset aws-node -n kube-system\n</code></pre> <p>Under the <code>initContainer</code> section, change the value for <code>DISABLE_TCP_EARLY_DEMUX</code> to <code>true.</code></p>"},{"location":"networking/sgpp/#use-security-group-for-pods-to-leverage-existing-aws-configuration-investment","title":"Use Security Group For Pods to leverage existing AWS configuration investment.","text":"<p>Security groups makes it easier to restrict network access to VPC resources, such as RDS databases or EC2 instances. One clear advantage of security groups per Pod is the opportunity to reuse existing AWS security group resources.  If you are using security groups as a network firewall to limit access to your AWS services, we propose applying security groups to Pods using branch ENIs. Consider using security groups for Pods if you are transferring apps from EC2 instances to EKS and limit access to other AWS services with security groups.</p>"},{"location":"networking/sgpp/#configure-pod-security-group-enforcing-mode","title":"Configure Pod Security Group Enforcing Mode","text":"<p>Amazon VPC CNI plugin version 1.11 added a new setting named <code>POD_SECURITY_GROUP_ENFORCING_MODE</code> (\u201cenforcing mode\u201d). The enforcing mode controls both which security groups apply to the pod, and if source NAT is enabled. You may specify the enforcing mode as either strict or standard. Strict is the default, reflecting the previous behavior of the VPC CNI with <code>ENABLE_POD_ENI</code> set to <code>true</code>. </p> <p>In Strict Mode, only the branch ENI security groups are enforced. The source NAT is also disabled. </p> <p>In Standard Mode, the security groups associated with both the primary ENI and branch ENI (associated with the pod) are applied. Network traffic must comply with both security groups. </p> <p>Warning</p> <p>Any mode change will only impact newly launched Pods. Existing Pods will use the mode that was configured when the Pod was created. Customers will need to recycle existing Pods with security groups if they want to change the traffic behavior.</p>"},{"location":"networking/sgpp/#enforcing-mode-use-strict-mode-for-isolating-pod-and-node-traffic","title":"Enforcing Mode: Use Strict mode for isolating pod and node traffic:","text":"<p>By default, security groups for Pods is set to \"strict mode.\" Use this setting if you must completely separate Pod traffic from the rest of the node's traffic. In strict mode, the source NAT is turned off so the branch ENI outbound security groups can be used. </p> <p>Warning</p> <p>When strict mode is enabled, all outbound traffic from a pod will leave the node and enter the VPC network. Traffic between pods on the same node will go over the VPC. This increases VPC traffic and limits node-based features. The NodeLocal DNSCache is not supported with strict mode. </p>"},{"location":"networking/sgpp/#enforcing-mode-use-standard-mode-in-the-following-situations","title":"Enforcing Mode: Use Standard mode in the following situations","text":"<p>Client source IP visible to the containers in the Pod</p> <p>If you need to keep the client source IP visible to the containers in the Pod, consider setting <code>POD_SECURITY_GROUP_ENFORCING_MODE</code> to <code>standard</code>. Kubernetes services support externalTrafficPolicy=local to support preservation of the client source IP (default type cluster). You can now run Kubernetes services of type NodePort and LoadBalancer using instance targets with an externalTrafficPolicy set to Local in the standard mode. <code>Local</code> preserves the client source IP and avoids a second hop for LoadBalancer and NodePort type Services.</p> <p>Deploying NodeLocal DNSCache</p> <p>When using security groups for pods, configure standard mode to support Pods that use NodeLocal DNSCache. NodeLocal DNSCache improves Cluster DNS performance by running a DNS caching agent on cluster nodes as a DaemonSet. This will help the pods that have the highest DNS QPS requirements to query local kube-dns/CoreDNS having a local cache, which will improve the latency.</p> <p>NodeLocal DNSCache is not supported in strict mode as all network traffic, even to the node, enters the VPC. </p> <p>Supporting Kubernetes Network Policy</p> <p>We recommend using standard enforcing mode when using network policy with Pods that have associated security groups.</p> <p>We strongly recommend to utilize security groups for Pods to limit network-level access to AWS services that are not part of a cluster. Consider network policies to restrict network traffic between Pods inside a cluster, often known as East/West traffic. </p>"},{"location":"networking/sgpp/#identify-incompatibilities-with-security-groups-per-pod","title":"Identify Incompatibilities with Security Groups per Pod","text":"<p>Windows-based and non-nitro instances do not support security groups for Pods. To utilize security groups with Pods, the instances must be tagged with isTrunkingEnabled. Use network policies to manage access between Pods rather than security groups if your Pods do not depend on any AWS services within or outside of your VPC.</p>"},{"location":"networking/sgpp/#use-security-groups-per-pod-to-efficiently-control-traffic-to-aws-services","title":"Use Security Groups per Pod to efficiently control traffic to AWS Services","text":"<p>If an application running within the EKS cluster has to communicate with another resource within the VPC, e.g. an RDS database, then consider using SGs for pods. While there are policy engines that allow you to specify an CIDR or a DNS name, they are a less optimal choice when communicating with AWS services that have endpoints that reside within a VPC.</p> <p>In contrast, Kubernetes network policies provide a mechanism for controlling ingress and egress traffic both within and outside the cluster. Kubernetes network policies should be considered if your application has limited dependencies on other AWS services. You may configure network policies that specify egress rules based on CIDR ranges to limit access to AWS services as opposed to AWS native semantics like SGs. You may use Kubernetes network policies to control network traffic between Pods (often referred to as East/West traffic) and between Pods and external services. Kubernetes network policies are implemented at OSI levels 3 and 4. </p> <p>Amazon EKS allows you to use network policy engines such as Calico and Cilium. By default, the network policy engines are not installed. Please check the respective install guides for instructions on how to set up. For more information on how to use network policy, see EKS Security best practices. The DNS hostnames feature is available in the enterprise versions of network policy engines, which could be useful for controlling traffic between Kubernetes Services/Pods and resources that run outside of AWS. Also, you can consider DNS hostname support for AWS services that don't support security groups by default.</p>"},{"location":"networking/sgpp/#tag-a-single-security-group-to-use-aws-loadbalancer-controller","title":"Tag a single Security Group to use AWS Loadbalancer Controller","text":"<p>When many security groups are allocated to a Pod, Amazon EKS recommends tagging a single security group with <code>kubernetes.io/cluster/$name</code> shared or owned. The tag allows the AWS Loadbalancer Controller to update the rules of security groups to route traffic to the Pods. If just one security group is given to a Pod, the assignment of a tag is optional. Permissions set in a security group are additive, therefore tagging a single security group is sufficient for the loadbalancer controller to locate and reconcile the rules. It also helps to adhere to the default quotas defined by security groups.</p>"},{"location":"networking/sgpp/#configure-nat-for-outbound-traffic","title":"Configure NAT for Outbound Traffic","text":"<p>Source NAT is disabled for outbound traffic from Pods that are assigned security groups. For Pods using security groups that require access the internet launch worker nodes on private subnets configured with a NAT gateway or instance and enable external SNAT in the CNI.</p> <pre><code>kubectl set env daemonset -n kube-system aws-node AWS_VPC_K8S_CNI_EXTERNALSNAT=true\n</code></pre>"},{"location":"networking/sgpp/#deploy-pods-with-security-groups-to-private-subnets","title":"Deploy Pods with Security Groups to Private Subnets","text":"<p>Pods that are assigned security groups must be run on nodes that are deployed on to private subnets. Note that Pods with assigned security groups deployed to public subnets will not able to access the internet.</p>"},{"location":"networking/sgpp/#verify-terminationgraceperiodseconds-in-pod-specification-file","title":"Verify terminationGracePeriodSeconds in Pod Specification File","text":"<p>Ensure that <code>terminationGracePeriodSeconds</code> is non-zero in your Pod specification file (default 30 seconds). This is essential in order for Amazon VPC CNI to delete the Pod network from the worker node. When set to zero, the CNI plugin does not remove the Pod network from the host, and the branch ENI is not effectively cleaned up.</p>"},{"location":"networking/sgpp/#using-security-groups-for-pods-with-fargate","title":"Using Security Groups for Pods with Fargate","text":"<p>Security groups for Pods that run on Fargate work very similarly to Pods that run on EC2 worker nodes. For example, you have to create the security group before referencing it in the SecurityGroupPolicy you associate with your Fargate Pod. By default, the cluster security group is assiged to all Fargate Pods when you don't explicitly assign a SecurityGroupPolicy to a Fargate Pod. For simplicity's sake, you may want to add the cluster security group to a Fagate Pod's SecurityGroupPolicy otherwise you will have to add the minimum security group rules to your security group. You can find the cluster security group using the describe-cluster API.</p> <pre><code> aws eks describe-cluster --name CLUSTER_NAME --query 'cluster.resourcesVpcConfig.clusterSecurityGroupId'\n</code></pre> <pre><code>cat &gt;my-fargate-sg-policy.yaml &lt;&lt;EOF\napiVersion: vpcresources.k8s.aws/v1beta1\nkind: SecurityGroupPolicy\nmetadata:\n  name: my-fargate-sg-policy\n  namespace: my-fargate-namespace\nspec:\n  podSelector: \n    matchLabels:\n      role: my-fargate-role\n  securityGroups:\n    groupIds:\n      - cluster_security_group_id\n      - my_fargate_pod_security_group_id\nEOF\n</code></pre> <p>The minimum security group rules are listed here. These rules allow Fargate Pods to communicate with in-cluster services like kube-apiserver, kubelet, and CoreDNS. You also need add rules to allow inbound and outbound connections to and from your Fargate Pod. This will allow your Pod to communicate with other Pods or resources in your VPC. Additionally, you have to include rules for Fargate to pull container images from Amazon ECR or other container registries such as DockerHub. For more information, see AWS IP address ranges in the AWS General Reference. </p> <p>You can use the below commands to find the security groups applied to a Fargate Pod. </p> <pre><code>kubectl get pod FARGATE_POD -o jsonpath='{.metadata.annotations.vpc\\.amazonaws\\.com/pod-eni}{\"\\n\"}'\n</code></pre> <p>Note down the eniId from above command. </p> <pre><code>aws ec2 describe-network-interfaces --network-interface-ids ENI_ID --query 'NetworkInterfaces[*].Groups[*]'\n</code></pre> <p>Existing Fargate pods must be deleted and recreated in order for new security groups to be applied. For instance, the following command initiates the deployment of the example-app. To update specific pods, you can change the namespace and deployment name in the below command.</p> <pre><code>kubectl rollout restart -n example-ns deployment example-pod\n</code></pre>"},{"location":"networking/subnets/","title":"VPC and Subnet Considerations","text":"<p>Operating an EKS cluster requires knowledge of AWS VPC networking, in addition to Kubernetes networking.</p> <p>We recommend you understand the EKS control plane communication mechanisms before you start designing your VPC or deploying clusters into existing VPCs.</p> <p>Refer to Cluster VPC considerations and Amazon EKS security group considerations when architecting a VPC and subnets to be used with EKS.</p>"},{"location":"networking/subnets/#overview","title":"Overview","text":""},{"location":"networking/subnets/#eks-cluster-architecture","title":"EKS Cluster Architecture","text":"<p>An EKS cluster consists of two VPCs: </p> <ul> <li>An AWS-managed VPC that hosts the Kubernetes control plane. This VPC does not appear in the customer account. </li> <li>A customer-managed VPC that hosts the Kubernetes nodes. This is where containers run, as well as other customer-managed AWS infrastructure such as load balancers used by the cluster. This VPC appears in the customer account. You need to create customer-managed VPC prior creating a cluster. The eksctl creates a VPC if you do not provide one.</li> </ul> <p>The nodes in the customer VPC need the ability to connect to the managed API server endpoint in the AWS VPC. This allows the nodes to register with the Kubernetes control plane and receive requests to run application Pods.</p> <p>The nodes connect to the EKS control plane through (a) an EKS public endpoint or (b) a Cross-Account elastic network interfaces  (X-ENI) managed by EKS. When a cluster is created, you need to specify at least two VPC subnets. EKS places a X-ENI in each  subnet specified during cluster create (also called cluster subnets). The Kubernetes API server uses these Cross-Account ENIs to communicate with nodes deployed on the customer-managed cluster VPC subnets. </p> <p></p> <p>As the node starts, the EKS bootstrap script is executed and Kubernetes node configuration files are installed. As part of the boot process on each instance, the container runtime agents, kubelet, and Kubernetes node agents are launched.</p> <p>To register a node, Kubelet contacts the Kubernetes cluster endpoint. It establishes a connection with either the public endpoint outside of the VPC or the private endpoint within the VPC. Kubelet receives API instructions and provides status updates and heartbeats to the endpoint on a regular basis.</p>"},{"location":"networking/subnets/#eks-control-plane-communication","title":"EKS Control Plane Communication","text":"<p>EKS has two ways to control access to the cluster endpoint. Endpoint access control lets you choose whether the endpoint can be reached from the public internet or only through your VPC. You can turn on the public endpoint (which is the default), the private endpoint, or both at once. </p> <p>The configuration of the cluster API endpoint determines the path that nodes take to communicate to the control plane. Note that these endpoint settings can be changed at any time through the EKS console or API.</p>"},{"location":"networking/subnets/#public-endpoint","title":"Public Endpoint","text":"<p>This is the default behavior for new Amazon EKS clusters. When only the public endpoint for the cluster is enabled, Kubernetes API requests that originate from within your cluster\u2019s VPC (such as worker node to control plane communication) leave the VPC, but not Amazon\u2019s network. In order for nodes to connect to the control plane, they must have a public IP address and a route to an internet gateway or a route to a NAT gateway where they can use the public IP address of the NAT gateway.</p>"},{"location":"networking/subnets/#public-and-private-endpoint","title":"Public and Private Endpoint","text":"<p>When both the public and private endpoints are enabled, Kubernetes API requests from within the VPC communicate to the control plane via the X-ENIs within your VPC. Your cluster API server is accessible from the internet.</p>"},{"location":"networking/subnets/#private-endpoint","title":"Private Endpoint","text":"<p>There is no public access to your API server from the internet when only private endpoint is enabled. All traffic to your cluster API server must come from within your cluster\u2019s VPC or a connected network. The nodes communicate to API server via X-ENIs within your VPC. Note that cluster management tools must have access to the private endpoint. Learn more about how to connect to a private Amazon EKS cluster endpoint from outside the Amazon VPC.</p> <p>Note that the cluster's API server endpoint is resolved by public DNS servers to a private IP address from the VPC. In the past, the endpoint could only be resolved from within the VPC.</p>"},{"location":"networking/subnets/#vpc-configurations","title":"VPC configurations","text":"<p>Amazon VPC supports IPv4 and IPv6 addressing. Amazon EKS supports IPv4 by default. A VPC must have an IPv4 CIDR block associated with it. You can optionally associate multiple IPv4 Classless Inter-Domain Routing (CIDR) blocks and multiple IPv6 CIDR blocks to your VPC. When you create a VPC, you must specify an IPv4 CIDR block for the VPC from the private IPv4 address ranges as specified in RFC 1918. The allowed block size is between a <code>/16</code> prefix (65,536 IP addresses) and <code>/28</code> prefix (16 IP addresses). </p> <p>When creating a new VPC, you can attach a single IPv6 CIDR block, and up to five when changing an existing VPC. The prefix length of the IPv6 CIDR block size can be between /44 and /60 and for the IPv6 subnets it can be betwen /44/ and /64. You can request an IPv6 CIDR block from the pool of IPv6 addresses maintained by Amazon. Please refer to VPC CIDR blocks section of the VPC User Guide for more information.</p> <p>Amazon EKS clusters support both IPv4 and IPv6. By default, EKS clusters use IPv4 IP. Specifying IPv6 at cluster creation time will enable the use IPv6 clusters. IPv6 clusters require dual-stack VPCs and subnets.</p> <p>Amazon EKS recommends you use at least two subnets that are in different Availability Zones during cluster creation. The subnets you pass in during cluster creation are known as cluster subnets. When you create a cluster, Amazon EKS creates up to 4 cross account (x-account or x-ENIs) ENIs in the subnets that you specify. The x-ENIs are always deployed and are used for cluster administration traffic such as log delivery, exec, and proxy. Please refer to the EKS user guide for complete VPC and subnet requirement details. </p> <p>Kubernetes worker nodes can run in the cluster subnets, but it is not recommended. During cluster upgrades Amazon EKS provisions additional ENIs in the cluster subnets. When your cluster scales out, worker nodes and pods may consume the available IPs in the cluster subnet. Hence in order to make sure there are enough available IPs you might want to consider using dedicated cluster subnets with /28 netmask.</p> <p>Kubernetes worker nodes can run in either a public or a private subnet. Whether a subnet is public or private refers to whether traffic within the subnet is routed through an internet gateway. Public subnets have a route table entry to the internet through the internet gateway, but private subnets don't.</p> <p>The traffic that originates somewhere else and reaches your nodes is called ingress. Traffic that originates from the nodes and leaves the network is called egress. Nodes with public or elastic IP addresses (EIPs) within a subnet configured with an internet gateway allow ingress from outside of the VPC. Private subnets usually include a NAT gateway, which only allows ingress traffic to the nodes from within the VPC while still allowing traffic from the nodes to leave the VPC (egress).</p> <p>In the IPv6 world, every address is internet routable. The IPv6 addresses associated with the nodes and pods are public. Private subnets are supported by implementing an egress-only internet gateways (EIGW) in a VPC, allowing outbound traffic while blocking all incoming traffic. Best practices for implementing IPv6 subnets can be found in the VPC user guide.</p>"},{"location":"networking/subnets/#you-can-configure-vpc-and-subnets-in-three-different-ways","title":"You can configure VPC and Subnets in three different ways:","text":""},{"location":"networking/subnets/#using-only-public-subnets","title":"Using only public subnets","text":"<p>In the same public subnets, both nodes and ingress resources (such as load balancers) are created. Tag the public subnet with <code>kubernetes.io/role/elb</code> to construct load balancers that face the internet. In this configuration, the cluster endpoint can be configured to be public, private, or both (public and private).</p>"},{"location":"networking/subnets/#using-private-and-public-subnets","title":"Using private and public subnets","text":"<p>Nodes are created on private subnets, whereas Ingress resources are instantiated in public subnets. You can enable public, private, or both (public and private) access to the cluster endpoint. Depending on the configuration of the cluster endpoint, node traffic will enter via the NAT gateway or the ENI.</p>"},{"location":"networking/subnets/#using-only-private-subnets","title":"Using only private subnets","text":"<p>Both nodes and ingress are created in private subnets. Using the <code>kubernetes.io/role/internal-elb</code> subnet tag to construct internal load balancers. Accessing your cluster's endpoint will require a VPN connection. You must activate AWS PrivateLink for EC2 and all Amazon ECR and S3 repositories. Only the private endpoint of the cluster should be enabled. We suggest going through the EKS private cluster requirements before provisioning private clusters.</p>"},{"location":"networking/subnets/#communication-across-vpcs","title":"Communication across VPCs","text":"<p>There are many scenarios when you require multiple VPCs and separate EKS clusters deployed to these VPCs. </p> <p>You can use Amazon VPC Lattice to consistently and securely connect services across multiple VPCs and accounts (without requiring additional connectivity to be provided by services like VPC peering, AWS PrivateLink or AWS Transit Gateway). Learn more here.</p> <p></p> <p>Amazon VPC Lattice operates in the link-local address space in IPv4 and IPv6, providing connectivity between services that may have overlapping IPv4 addresses. For operational efficiency, we strongly recommend deploying EKS clusters and nodes to IP ranges that do not overlap. In case your infrastructure includes VPCs with overlapping IP ranges, you need to architect your network accordingly. We suggest Private NAT Gateway, or VPC CNI in custom networking mode in conjunction with transit gateway to integrate workloads on EKS to solve overlapping CIDR challenges while preserving routable RFC1918 IP addresses. </p> <p></p> <p>Consider utilizing AWS PrivateLink, also known as an endpoint service, if you are the service provider and would want to share your Kubernetes service and ingress (either ALB or NLB) with your customer VPC in separate accounts. </p>"},{"location":"networking/subnets/#sharing-vpc-across-multiple-accounts","title":"Sharing VPC across multiple accounts","text":"<p>Many enterprises adopted shared Amazon VPCs as a means to streamline network administration, reduce costs and improve security across multiple AWS Accounts in an AWS Organization. They utilize AWS Resource Access Manager (RAM) to securely share supported AWS resources with individual AWS Accounts, organizational units (OUs) or entire AWS Organization.</p> <p>You can deploy Amazon EKS clusters, managed node groups and other supporting AWS resources (like LoadBalancers, security groups, end points, etc.,) in shared VPC Subnets from an another AWS Account using AWS RAM. Below figure depicts an example highlevel architecture. This allows central networking teams control over the networking constructs like VPCs, Subnets, etc., while allowing application or platform teams to deploy Amazon EKS clusters in their respective AWS Accounts. A complete walkthrough of this scenario is available at this github repository.</p> <p></p>"},{"location":"networking/subnets/#considerations-when-using-shared-subnets","title":"Considerations when using Shared Subnets","text":"<ul> <li> <p>Amazon EKS clusters and worker nodes can be created within shared subnets that are all part of the same VPC. Amazon EKS does not support the creation of clusters across multiple VPCs. </p> </li> <li> <p>Amazon EKS uses AWS VPC Security Groups (SGs) to control the traffic between the Kubernetes control plane and the cluster's worker nodes. Security groups are also used to control the traffic between worker nodes, and other VPC resources, and external IP addresses. You must create these security groups in the application/participant account. Ensure that the security groups you intend to use for your pods are also located in the participant account. You can configure the inbound and outbound rules within your security groups to permit the necessary traffic to and from security groups located in the Central VPC account.</p> </li> <li> <p>Create IAM roles and associated policies within the participant account where your Amazon EKS cluster resides. These IAM roles and policies are essential for granting the necessary permissions to Kubernetes clusters managed by Amazon EKS, as well as to the nodes and pods running on Fargate. The permissions enable Amazon EKS to make calls to other AWS services on your behalf.</p> </li> <li> <p>You can follow following approaches to allow cross Account access to AWS resources like Amazon S3 buckets, Dynamodb tables, etc., from k8s pods:</p> <ul> <li> <p>Resource based policy approach: If the AWS service supports resource policies, you can add appropriate resource based policy to allow cross account access to IAM Roles assigned to the kubernetes pods. In this scenario, OIDC provider, IAM Roles, and permission policies exist in the application account. To find AWS Services that support Resource based policies, refer AWS services that work with IAM and look for the services that have Yes in the Resource Based column.</p> </li> <li> <p>OIDC Provider approach: IAM resources like OIDC Provider, IAM Roles, Permission, and Trust policies will be created in other participant AWS Account where the resources exists. These roles will be assigned to Kubernetes pods in application account, so that they can access cross account resources. Refer Cross account IAM roles for Kubernetes service accounts blog for a complete walkthrough of this approach.</p> </li> </ul> </li> <li> <p>You can deploy the Amazon Elastic Loadbalancer (ELB) resources (ALB or NLB) to route traffic to k8s pods either in application or central networking accounts. Refer to Expose Amazon EKS Pods Through Cross-Account Load Balancer walkthrough for detailed instructions on deploying the ELB resources in central networking account. This option offers enhanced flexibility, as it grants the Central Networking account full control over the security configuration of the Load Balancer resources.</p> </li> <li> <p>When using <code>custom networking feature</code> of Amazon VPC CNI, you need to use the Availability Zone (AZ) ID mappings listed in the central networking account to create each <code>ENIConfig</code>. This is due to random mapping of physical AZs to the AZ names in each AWS account.</p> </li> </ul>"},{"location":"networking/subnets/#security-groups","title":"Security Groups","text":"<p>A security group controls the traffic that is allowed to reach and leave the resources that it is associated with. Amazon EKS uses security groups to manage the communication between the control plane and nodes. When you create a cluster, Amazon EKS creates a security group that's named <code>eks-cluster-sg-my-cluster-uniqueID</code>. EKS associates these security groups to the managed ENIs and the nodes. The default rules allow all traffic to flow freely between your cluster and nodes, and allows all outbound traffic to any destination. </p> <p>When you create a cluster, you can specify your own security groups. Please see recommendation for security groups when you specify own security groups. </p>"},{"location":"networking/subnets/#recommendations","title":"Recommendations","text":""},{"location":"networking/subnets/#consider-multi-az-deployment","title":"Consider Multi-AZ  Deployment","text":"<p>AWS Regions provide multiple physically separated and isolated Availability Zones (AZ), which are connected with low-latency, high-throughput, and highly redundant networking. With Availability Zones, you can design and operate applications that automatically fail over between Availability Zones without interruption. Amazon EKS strongly recommends deploying EKS clusters to multiple availability zones. Please consider specifying subnets in at least two availability zones when you create the cluster.</p> <p>Kubelet running on nodes automatically adds labels to the node object such as <code>topology.kubernetes.io/region=us-west-2</code>, and <code>topology.kubernetes.io/zone=us-west-2d</code>. We recommend to use node labels in conjunction with Pod topology spread constraints to control how Pods are spread across zones. These hints enable Kubernetes scheduler to place Pods for better expected availability, reducing the risk that a correlated failure affects your whole workload. Please refer Assigning nodes to Pods to see examples for node selector and AZ spread constraints.</p> <p>You can define the subnets or availability zones when you create nodes. The nodes are placed in cluster subnets if no subnets are configured. EKS support for managed node groups automatically spreads the nodes across multiple availability zones on available capacity. Karpenterwill honor the AZ spread placement by scaling nodes to specified AZs if workloads define topology spread limits.</p> <p>AWS Elastic Load Balancers are managed by the AWS Load Balancer Controller for a Kubernetes cluster. It provisions an Application Load Balancer (ALB) for Kubernetes ingress resources and a Network Load Balancer (NLB) for Kubernetes services of type Loadbalancer. The Elastic Load Balancer controller uses tags to discover the subnets. ELB controller requires a minimum of two availability zones (AZs) to provision ingress resource successfully. Consider setting subnets in at least two AZs to take advantage of geographic redundancy's safety and reliability. </p>"},{"location":"networking/subnets/#deploy-nodes-to-private-subnets","title":"Deploy Nodes to Private Subnets","text":"<p>A VPC including both private and public subnets is the ideal method for deploying Kubernetes workloads on EKS. Consider setting a minimum of two public subnets and two private subnets in two distinct availability zones. The related route table of a public subnet contains a route to an internet gateway . Pods are able to interact with the Internet via a NAT gateway. Private subnets are supported by egress-only internet gateways in the IPv6 environment (EIGW).</p> <p>Instantiating nodes in private subnets offers maximal control over traffic to the nodes and is effective for the vast majority of Kubernetes applications. Ingress resources (like as load balancers) are instantiated in public subnets and route traffic to Pods operating on private subnets.</p> <p>Consider private only mode if you demand strict security and network isolation. In this configuration, three private subnets are deployed in distinct Availability Zones within the AWS Region's VPC. The resources deployed to the subnets cannot access the internet, nor can the internet access the resources in the subnets. In order for your Kubernetes application to access other AWS services, you must configure PrivateLink interfaces and/or gateway endpoints. You may setup internal load balancers to redirect traffic to Pods using AWS Load Balancer Controller. The private subnets must be tagged (<code>kubernetes.io/role/internal-elb: 1</code>) for the controller to provision load balancers. For nodes to register with the cluster, the cluster endpoint must be set to private mode.  Please visit private cluster guide for complete requirements and considerations.</p>"},{"location":"networking/subnets/#consider-public-and-private-mode-for-cluster-endpoint","title":"Consider Public and Private Mode for Cluster Endpoint","text":"<p>Amazon EKS offers public-only, public-and-private, and private-only cluster endpoint modes. The default mode is public-only, however we recommend configuring cluster endpoint in public and private mode. This option allows Kubernetes API calls within your cluster's VPC (such as node-to-control-plane communication) to utilize the private VPC endpoint and traffic to remain within your cluster's VPC. Your cluster API server, on the other hand, can be reached from the internet. However, we strongly recommend limiting the CIDR blocks that can use the public endpoint. Learn how to configure public and private endpoint access, including limiting CIDR blocks.</p> <p>We suggest a private-only endpoint when you need security and network isolation. We recommend using either of the options listed in the EKS user guide to connect to an API server privately.</p>"},{"location":"networking/subnets/#configure-security-groups-carefully","title":"Configure Security Groups Carefully","text":"<p>Amazon EKS supports using custom security groups. Any custom security groups must allow communication between nodes and the Kubernetes control plane. Please check port requirements and configure rules manually when your organization doesn't allow for open communication. </p> <p>EKS applies the custom security groups that you provide during cluster creation to the managed interfaces (X-ENIs). However, it does not immediately associate them with nodes. While creating node groups, it is strongly recommended to associate custom security groups manually. Please consider enabling securityGroupSelectorTerms to enable Karpenter node template discovery of custom security groups during autoscaling of nodes.</p> <p>We strongly recommend creating a security group to allow all inter-node communication traffic. During the bootstrap process, nodes require outbound Internet connectivity to access the cluster endpoint. Evaluate outward access requirements, such as on-premise connection and container registry access, and set rules appropriately. Before putting changes into production, we strongly suggest that you check connections carefully in your development environment.</p>"},{"location":"networking/subnets/#deploy-nat-gateways-in-each-availability-zone","title":"Deploy NAT Gateways in each Availability Zone","text":"<p>If you deploy nodes in private subnets (IPv4 and IPv6), consider creating a NAT Gateway in each Availability Zone (AZ) to ensure zone-independent architecture and reduce cross AZ expenditures. Each NAT gateway in an AZ is implemented with redundancy.</p>"},{"location":"networking/subnets/#use-cloud9-to-access-private-clusters","title":"Use Cloud9 to access Private Clusters","text":"<p>AWS Cloud9 is a web-based IDE than can run securely in Private Subnets without ingress access, using AWS Systems Manager. Egress can also be disabled on the Cloud9 instance. Learn more about using Cloud9 to access private clusters and subnets.</p> <p></p>"},{"location":"networking/vpc-cni/","title":"Amazon VPC CNI","text":"<p>Amazon EKS implements cluster networking through the Amazon VPC Container Network Interface(VPC CNI) plugin. The CNI plugin allows Kubernetes Pods to have the same IP address as they do on the VPC network. More specifically, all containers inside the Pod share a network namespace, and they can communicate with each-other using local ports.</p> <p>Amazon VPC CNI has two components:</p> <ul> <li>CNI Binary, which will setup Pod network to enable Pod-to-Pod communication. The CNI binary runs on a node root file system and is invoked by the kubelet when a new Pod gets added to, or an existing Pod removed from the node.</li> <li>ipamd, a long-running node-local IP Address Management (IPAM) daemon and is responsible for:</li> <li>managing ENIs on a node, and</li> <li>maintaining a warm-pool of available IP addresses or prefix</li> </ul> <p>When an instance is created, EC2 creates and attaches a primary ENI associated with a primary subnet. The primary subnet may be public or private. The Pods that run in hostNetwork mode use the primary IP address assigned to the node primary ENI and share the same network namespace as the host.</p> <p>The CNI plugin manages Elastic Network Interfaces (ENI) on the node. When a node is provisioned, the CNI plugin automatically allocates a pool of slots (IPs or Prefix\u2019s) from the node\u2019s subnet to the primary ENI. This pool is known as the warm pool, and its size is determined by the node\u2019s instance type. Depending on CNI settings, a slot may be an IP address or a prefix. When a slot on an ENI has been assigned, the CNI may attach additional ENIs with warm pool of slots to the nodes. These additional ENIs are called Secondary ENIs. Each ENI can only support a certain number of slots, based on instance type. The CNI attaches more ENIs to instances based on the number of slots needed, which usually corresponds to the number of Pods. This process continues until the node can no longer support additional ENI. The CNI also pre-allocates \u201cwarm\u201d ENIs and slots for faster Pod startup. Note each instance type has a maximum number of ENIs that may be attached. This is one constraint on Pod density (number of Pods per node), in addition to compute resources.</p> <p></p> <p>The maximum number of network interfaces, and the maximum number of slots that you can use varies by the type of EC2 Instance. Since each Pod consumes an IP address on a slot, the number of Pods you can run on a particular EC2 Instance depends on how many ENIs can be attached to it and how many slots each ENI supports. We suggest setting the maximum Pods per EKS user guide to avoid exhaustion of the instance\u2019s CPU and memory resources. Pods using <code>hostNetwork</code> are excluded from this calculation. You may consider using a script called max-pod-calculator.sh to calculate EKS\u2019s recommended maximum Pods for a given instance type.</p>"},{"location":"networking/vpc-cni/#overview","title":"Overview","text":"<p>Secondary IP mode is the default mode for VPC CNI. This guide provides a generic overview of VPC CNI behavior when Secondary IP mode is enabled. The functionality of ipamd (allocation of IP addresses) may vary depending on the configuration settings for VPC CNI, such as Prefix Mode, Security Groups Per Pod, and Custom Networking.</p> <p>The Amazon VPC CNI is deployed as a Kubernetes Daemonset named aws-node on worker nodes. When a worker node is provisioned, it has a default ENI, called the primary ENI, attached to it. The CNI allocates a warm pool of ENIs and secondary IP addresses from the subnet attached to the node\u2019s primary ENI. By default, ipamd attempts to allocate an additional ENI to the node. The IPAMD allocates additional ENI when a single Pod is scheduled and assigned a secondary IP address from the primary ENI. This \"warm\" ENI enables faster Pod networking. As the pool of secondary IP addresses runs out, the CNI adds another ENI to assign more.</p> <p>The number of ENIs and IP addresses in a pool are configured through environment variables called WARM_ENI_TARGET, WARM_IP_TARGET, MINIMUM_IP_TARGET. The <code>aws-node</code> Daemonset will periodically check that a sufficient number of ENIs are attached. A sufficient number of ENIs are attached when all of the <code>WARM_ENI_TARGET</code>, or <code>WARM_IP_TARGET</code> and <code>MINIMUM_IP_TARGET</code> conditions are met. If there are insufficient ENIs attached, the CNI will make an API call to EC2 to attach more until <code>MAX_ENI</code> limit is reached.</p> <ul> <li><code>WARM_ENI_TARGET</code> - Integer, Values &gt;0 indicate requirement Enabled</li> <li>The number of Warm ENIs to be maintained. An ENI is \u201cwarm\u201d when it is attached as a secondary ENI to a node, but it is not in use by any Pod. More specifically, no IP addresses of the ENI have been associated with a Pod.</li> <li>Example: Consider an instance with 2 ENIs, each ENI supporting 5 IP addresses. WARM_ENI_TARGET is set to 1. If exactly 5 IP addresses are associated with the instance, the CNI maintains 2 ENIs attached to the instance. The first ENI is in use, and all 5 possible IP addresses of this ENI are used. The second ENI is \u201cwarm\u201d with all 5 IP addresses in pool. If another Pod is launched on the instance, a 6th IP address will be needed. The CNI will assign this 6th Pod an IP address from the second ENI and from 5 IPs from the pool. The second ENI is now in use, and no longer in a \u201cwarm\u201d status. The CNI will allocate a 3rd ENI to maintain at least 1 warm ENI.</li> </ul> <p>Note</p> <p>The warm ENIs still consume IP addresses from the CIDR of your VPC. IP addresses are \u201cunused\u201d or \u201cwarm\u201d until they are associated with a workload, such as a Pod.</p> <ul> <li><code>WARM_IP_TARGET</code>, Integer, Values &gt;0 indicate requirement Enabled</li> <li>The number of Warm IP addresses to be maintained. A Warm IP is available on an actively attached ENI, but has not been assigned to a Pod. In other words, the number of Warm IPs available is the number of IPs that may be assigned to a Pod without requiring an additional ENI.</li> <li>Example: Consider an instance with 1 ENI, each ENI supporting 20 IP addresses. WARM_IP_TARGET is set to 5. WARM_ENI_TARGET is set to 0. Only 1 ENI will be attached until a 16th IP address is needed. Then, the CNI will attach a second ENI, consuming 20 possible addresses from the subnet CIDR.</li> <li><code>MINIMUM_IP_TARGET</code>, Integer, Values &gt;0 indicate requirement Enabled</li> <li>The minimum number of IP addresses to be allocated at any time. This is commonly used to front-load the assignment of multiple ENIs at instance launch.</li> <li>Example: Consider a newly launched instance. It has 1 ENI and each ENI supports 10 IP addresses. MINIMUM_IP_TARGET is set to 100. The ENI immediately attaches 9 more ENIs for a total of 100 addresses. This happens regardless of any WARM_IP_TARGET or WARM_ENI_TARGET values.</li> </ul> <p>This project includes a Subnet Calculator Excel Document. This calculator document simulates the IP address consumption of a specified workload under different ENI configuration options, such as <code>WARM_IP_TARGET</code> and <code>WARM_ENI_TARGET</code>.</p> <p></p> <p>When Kubelet receives an add Pod request, the CNI binary queries ipamd for an available IP address, which ipamd then provides to the Pod. The CNI binary wires up the host and Pod network.</p> <p>Pods deployed on a node are, by default, assigned to the same security groups as the primary ENI. Alternatively, Pods may be configured with different security groups.</p> <p></p> <p>As the pool of IP addresses is depleted, the plugin automatically attaches another elastic network interface to the instance and allocates another set of secondary IP addresses to that interface. This process continues until the node can no longer support additional elastic network interfaces.</p> <p></p> <p>When a Pod is deleted, VPC CNI places the Pod\u2019s IP address in a 30-second cool down cache. The IPs in a cool down cache are not assigned to new Pods. When the cooling-off period is over, VPC CNI moves Pod IP back to the warm pool. The cooling-off period prevents Pod IP addresses from being recycled prematurely and allows kube-proxy on all cluster nodes to finish updating the iptables rules. When the number of IPs or ENIs exceeds the number of warm pool settings, the ipamd plugin returns IPs and ENIs to the VPC.</p> <p>As described above in Secondary IP mode, each Pod receives one secondary private IP address from one of the ENIs attached to an instance. Since each Pod uses an IP address, the number of Pods you can run on a particular EC2 Instance depends on how many ENIs can be attached to it and how many IP addresses it supports. The VPC CNI checks the limits file to find out how many ENIs and IP addresses are allowed for each type of instance.</p> <p>You can use the following formula to determine maximum number of Pods you can deploy on a node.</p> <p><code>(Number of network interfaces for the instance type \u00d7 (the number of IP addresses per network interface - 1)) + 2</code></p> <p>The +2 indicates Pods that require host networking, such as kube-proxy and VPC CNI. Amazon EKS requires kube-proxy and VPC CNI to be operating on each node, and these requirements are factored into the max-pods value. If you want to run additional host networking pods, consider updating the max-pods value.</p> <p>The +2 indicates Kubernetes Pods that use host networking, such as kube-proxy and VPC CNI. Amazon EKS requires kube-proxy and VPC CNI to be running on every node and are calculated towards max-pods. Consider updating max-pods if you plan to run more host networking Pods. You can specify <code>--kubelet-extra-args \"\u2014max-pods=110\"</code> as user data in the launch template.</p> <p>As an example, on a cluster with 3 c5.large nodes (3 ENIs and max 10 IPs per ENI), when the cluster starts up and has 2 CoreDNS pods, the CNI will consume 49 IP addresses and keeps them in warm pool. The warm pool enables faster Pod launches when the application is deployed.</p> <p>Node 1 (with CoreDNS pod): 2 ENIs, 20 IPs assigned</p> <p>Node 2 (with CoreDNS pod): 2 ENIs, 20 IPs assigned</p> <p>Node 3 (no Pod): 1 ENI. 10 IPs assigned.</p> <p>Keep in mind that infrastructure pods, often running as daemon sets, each contribute to the max-pod count. These can include:</p> <ul> <li>CoreDNS</li> <li>Amazon Elastic LoadBalancer</li> <li>Operational pods for metrics-server</li> </ul> <p>We suggest that you plan your infrastructure by combining these Pods' capacities. For a list of the maximum number of Pods supported by each instance type, see eni-max-Pods.txt on GitHub.</p> <p></p>"},{"location":"networking/vpc-cni/#recommendations","title":"Recommendations","text":""},{"location":"networking/vpc-cni/#deploy-vpc-cni-managed-add-on","title":"Deploy VPC CNI Managed Add-On","text":"<p>When you provision a cluster, Amazon EKS installs VPC CNI automatically. Amazon EKS nevertheless supports managed add-ons that enable the cluster to interact with underlying AWS resources such as computing, storage, and networking. We highly recommend that you deploy clusters with managed add-ons including VPC CNI.</p> <p>Amazon EKS managed add-on offer VPC CNI installation and management for Amazon EKS clusters. Amazon EKS add-ons include the latest security patches, bug fixes, and are validated by AWS to work with Amazon EKS. The VPC CNI add-on enables you to continuously ensure the security and stability of your Amazon EKS clusters and decrease the amount of effort required to install, configure, and update add-ons. Additionally, a managed add-on can be added, updated, or deleted via the Amazon EKS API, AWS Management Console, AWS CLI, and eksctl.</p> <p>You can find the managed fields of VPC CNI using <code>--show-managed-fields</code> flag with the <code>kubectl get</code> command.</p> <pre><code>kubectl get daemonset aws-node --show-managed-fields -n kube-system -o yaml\n</code></pre> <p>Managed add-ons prevents configuration drift by automatically overwriting configurations every 15 minutes. This means that any changes to managed add-ons, made via the Kubernetes API after add-on creation, will overwrite by the automated drift-prevention process and also set to defaults during add-on update process.</p> <p>The fields managed by EKS are listed under managedFields with manager as EKS. Fields managed by EKS include service account, image, image url, liveness probe, readiness probe, labels, volumes, and volume mounts.</p> <p>Info</p> <p>The most frequently used fields such as WARM_ENI_TARGET, WARM_IP_TARGET, and MINIMUM_IP_TARGET are not managed and will not be reconciled. The changes to these fields will be preserved upon updating of the add-on.</p> <p>We suggest testing the add-on behavior in your non-production clusters for a specific configuration before updating production clusters. Additionally, follow the steps in the EKS user guide for add-on configurations.</p>"},{"location":"networking/vpc-cni/#migrate-to-managed-add-on","title":"Migrate to Managed Add-On","text":"<p>You will manage the version compatibility and update the security patches of self-managed VPC CNI. To update a self-managed add-on, you must use the Kubernetes APIs and instructions outlined in the EKS user guide. We recommend migrating to a managed add-on for existing EKS clusters and highly suggest creating a backup of your current CNI settings prior to migration. To configure managed add-ons, you can utilize the Amazon EKS API, AWS Management Console, or AWS Command Line Interface.</p> <pre><code>kubectl apply view-last-applied daemonset aws-node -n kube-system &gt; aws-k8s-cni-old.yaml\n</code></pre> <p>Amazon EKS will replace the CNI configuration settings if the field is listed as managed with default settings. We caution against modifying the managed fields. The add-on does not reconcile configuration fields such as the warm environment variables and CNI modes. The Pods and applications will continue to run while you migrate to a managed CNI.</p>"},{"location":"networking/vpc-cni/#backup-cni-settings-before-update","title":"Backup CNI Settings Before Update","text":"<p>VPC CNI runs on customer data plane (nodes), and hence Amazon EKS does not automatically update the add-on (managed and self-managed) when new versions are released or after you update your cluster to a new Kubernetes minor version. To update the add-on for an existing cluster, you must trigger an update via update-addon API or clicking update now link in the EKS console for add-ons. If you have deployed self-managed add-on, follow steps mentioned under updating self-managed VPC CNI add-on.</p> <p>We strongly recommend that you update one minor version at a time. For example, if your current minor version is <code>1.9</code> and you want to update to <code>1.11</code>, you should update to the latest patch version of <code>1.10</code> first, then update to the latest patch version of <code>1.11</code>.</p> <p>Perform an inspection of the aws-node Daemonset before updating Amazon VPC CNI. Take a backup of existing settings. If using a managed add-on, confirm that you have not updated any settings that Amazon EKS might override. We recommend a post update hook in your automation workflow or a manual apply step after an add-on update.</p> <pre><code>kubectl apply view-last-applied daemonset aws-node -n kube-system &gt; aws-k8s-cni-old.yaml\n</code></pre> <p>For a self-managed add-on, compare the backup with <code>releases</code> on GitHub to see the available versions and familiarize yourself with the changes in the version that you want to update to. We recommend using Helm to manage self-managed add-ons and leverage values files to apply settings. Any update operations involving Daemonset delete will result in application downtime and must be avoided.</p>"},{"location":"networking/vpc-cni/#understand-security-context","title":"Understand Security Context","text":"<p>We strongly suggest you to understand the security contexts configured for managing VPC CNI efficiently. Amazon VPC CNI has two components CNI binary and ipamd (aws-node) Daemonset. The CNI runs as a binary on a node and has access to node root file system, also has privileged access as it deals with iptables at the node level. The CNI binary is invoked by the kubelet when Pods gets added or removed.</p> <p>The aws-node Daemonset is a long-running process responsible for IP address management at the node level. The aws-node runs in <code>hostNetwork</code> mode and allows access to the loopback device, and network activity of other pods on the same node. The aws-node init-container runs in privileged mode and mounts the CRI socket allowing the Daemonset to monitor IP usage by the Pods running on the node. Amazon EKS is working to remove the privileged requirement of aws-node init container. Additionally, the aws-node needs to update NAT entries and to load the iptables modules and hence runs with NET_ADMIN privileges.</p> <p>Amazon EKS recommends deploying the security policies as defined by the aws-node manifest for IP management for the Pods and networking settings. Please consider updating to the latest version of VPC CNI. Furthermore, please consider opening a GitHub issue if you have a specific security requirement.</p>"},{"location":"networking/vpc-cni/#use-separate-iam-role-for-cni","title":"Use separate IAM role for CNI","text":"<p>The AWS VPC CNI requires AWS Identity and Access Management (IAM) permissions. The CNI policy needs to be set up before the IAM role can be used. You can use <code>AmazonEKS_CNI_Policy</code>, which is an AWS managed policy for IPv4 clusters. AmazonEKS CNI managed policy only has permissions for IPv4 clusters. You must create a separate IAM policy for IPv6 clusters with the permissions listed here.</p> <p>By default, VPC CNI inherits the Amazon EKS node IAM role (both managed and self-managed node groups).</p> <p>Configuring a separate IAM role with the relevant policies for Amazon VPC CNI is strongly recommended. If not, the pods of Amazon VPC CNI gets the permission assigned to the node IAM role and have access to the instance profile assigned to the node.</p> <p>The VPC CNI plugin creates and configures a service account called aws-node. By default, the service account binds to the Amazon EKS node IAM role with Amazon EKS CNI policy attached. To use the separate IAM role, we recommend that you create a new service account with Amazon EKS CNI policy attached. To use a new service account you must redeploy the CNI pods. Consider specifying a <code>--service-account-role-arn</code> for VPC CNI managed add-on when creating new clusters. Make sure you remove Amazon EKS CNI policy for both IPv4 and IPv6 from Amazon EKS node role.</p> <p>It is advised that you block access instance metadata to minimize the blast radius of security breach.</p>"},{"location":"networking/vpc-cni/#handle-livenessreadiness-probe-failures","title":"Handle Liveness/Readiness Probe failures","text":"<p>We advise increasing the liveness and readiness probe timeout values (default <code>timeoutSeconds: 10</code>) for EKS 1.20 an later clusters to prevent probe failures from causing your application's Pod to become stuck in a containerCreating state. This problem has been seen in data-intensive and batch-processing clusters. High CPU use causes aws-node probe health failures, leading to unfulfilled Pod CPU requests. In addition to modifying the probe timeout, ensure that the CPU resource requests (default <code>CPU: 25m</code>) for aws-node are correctly configured. We do not suggest updating the settings unless your node is having issues.</p> <p>We highly encourage you to run sudo <code>bash /opt/cni/bin/aws-cni-support.sh</code> on a node while you engage Amazon EKS support. The script will assist in evaluating kubelet logs and memory utilization on the node. Please consider installing SSM Agent on Amazon EKS worker nodes to run the script.</p>"},{"location":"networking/vpc-cni/#configure-iptables-forward-policy-on-non-eks-optimized-ami-instances","title":"Configure IPTables Forward Policy on non-EKS Optimized AMI Instances","text":"<p>If you are using custom AMI, make sure to set iptables forward policy to ACCEPT under kubelet.service. Many systems set the iptables forward policy to DROP.  You can build custom AMI using HashiCorp Packer and a build specification with resources and configuration scripts from the Amazon EKS AMI repository on AWS GitHub. You can update the kubelet.service and follow the instructions specified here to create a custom AMI.</p>"},{"location":"networking/vpc-cni/#routinely-upgrade-cni-version","title":"Routinely Upgrade CNI Version","text":"<p>The VPC CNI is backward compatible. The latest version works with all Amazon EKS supported Kubernetes versions. Additionally, the VPC CNI is offered as an EKS add-on (see \u201cDeploy VPC CNI Managed Add-On\u201d above). While EKS add-ons orchestrates upgrades of add-ons, it will not automatically upgrade add-ons like the CNI because they run on the data plane. You are responsible for upgrading the VPC CNI add-on following managed and self-managed worker node upgrades.</p>"},{"location":"performance/performance/","title":"Performance Efficiency Pillar","text":"<p>The performance efficiency pillar focuses on the efficient use of computing resources to meet requirements and how to maintain that efficiency as demand changes and technologies evolve. This section provides in-depth, best practices guidance for architecting for performance efficiency on AWS.</p>"},{"location":"performance/performance/#definition","title":"Definition","text":"<p>To ensure the efficient use of EKS container services, you should gather data on all aspects of the architecture, from the high-level design to the selection of EKS resource types. By reviewing your choices on a regular basis, you ensure that you are taking advantage of the continually evolving Amazon EKS and Container services. Monitoring will ensure that you are aware of any deviance from expected performance so you can take action on it.</p> <p>Performance efficiency for EKS containers is composed of three areas:</p> <ul> <li> <p>Optimize your container</p> </li> <li> <p>Resource Management</p> </li> <li> <p>Scalability Management</p> </li> </ul>"},{"location":"performance/performance/#best-practices","title":"Best Practices","text":""},{"location":"performance/performance/#optimize-your-container","title":"Optimize your container","text":"<p>You can run most applications in a Docker container without too much hassle. There are a number of things that you need to do to ensure it's running effectively in a production environment, including streamlining the build process. The following best practices will help you to achieve that.</p>"},{"location":"performance/performance/#recommendations","title":"Recommendations","text":"<ul> <li>Make your container images stateless: A container created with a Docker image should be ephemeral and immutable. In other words, the container should be disposable and independent, i.e. a new one can be built and put in place with absolutely no configuration changes. Design your containers to be stateless. If you would like to use persistent data, use volumes instead. If you would like to store secrets or sensitive application data used by services, you can use solutions like AWS Systems ManagerParameter Store or third-party offerings or open source solutions, such as HashiCorp Valut and Consul, for runtime configurations.</li> <li>Minimal base image : Start with a small base image. Every other instruction in the Dockerfile builds on top of this image. The smaller the base image, the smaller the resulting image is, and the more quickly it can be downloaded. For example, the alpine:3.7 image is 71 MB smaller than the centos:7 image. You can even use the scratch base image, which is an empty image on which you can build your own runtime environment.</li> <li>Avoid unnecessary packages: When building a container image, include only the dependencies what your application needs and avoid installing unnecessary packages. For example if your application does not need an SSH server, don't include one.  This will reduce complexity, dependencies, file sizes, and build times.  To exclude files not relevant to the build use a .dockerignore file.</li> <li>Use multi-stage build:Multi-stage builds allow you to build your application in a first \"build\" container and use the result in another container, while using the same Dockerfile.  To expand a bit on that, in multi-stage builds, you use multiple FROM statements in your Dockerfile. Each FROM instruction can use a different base, and each of them begins a new stage of the build. You can selectively copy artifacts from one stage to another, leaving behind everything you don't want in the final image.  This method drastically reduces the size of your final image, without struggling to reduce the number of intermediate layers and files.</li> <li>Minimize number of layers: Each instruction in the Dockerfile adds an extra layer to the Docker image. The number of instructions and layers should be kept to a minimum as this affects build performance and time. For example, the first  instruction below will create multiple layers, whereas the second instruction by using &amp;&amp;(chaining) we reduced the number of layers, which will help provide better performance. The is the best way to reduce the number of layers that will be created in your Dockerfile.</li> <li> <pre><code>        RUN apt-get -y update\n        RUN apt-get install -y python\n        RUN apt-get -y update &amp;&amp; apt-get install -y python\n</code></pre> </li> <li> <p>Properly tag your images: When building images, always tag them with useful and meaningful tags. This is a good way to organize and document metadata describing an image, for example, by including a unique counter like build id from a CI server (e.g. CodeBuild or Jenkins) to help with identifying the correct image. The tag latest is used by default if you do not provide one in your Docker commands.  We recommend not to use the automatically created latest tag, because by using this tag you'll automatically be running future major releases, which could include breaking changes for your application. The best practice is to avoid the latest tag and instead use the unique digest created by your CI server.</p> </li> <li>Use Build Cache to improve build speed : The cache allows you to take advantage of existing cached images, rather than building each image from scratch. For example, you should add the source code of your application as late as possible in your Dockerfile so that the base image and your application's dependencies get cached and aren't rebuilt on every build. To reuse already cached images, By default in Amazon EKS, the kubelet will try to pull each image from the specified registry. However, if the imagePullPolicy property of the container is set to IfNotPresent or Never, then a local image is used (preferentially or exclusively, respectively).</li> <li> <p>Image Security : Using public images  may be  a great way to start working on containers and deploying it to Kubernetes. However, using them in production can come with a set of challenges. Especially when it comes to security. Ensure to follow the best practices for packaging and distributing the containers/applications. For example, don't build your containers with passwords baked in also you might need to control what's inside them.  Recommend to use private repository such as Amazon ECR and leverage the in-built image scanning feature to identify software vulnerabilities in your container images.  </p> </li> <li> <p>Right size your containers:  As you develop and run applications in containers, there are a few key areas to consider. How you size containers and manage your application deployments can negatively impact the end-user experience of services that you provide. To help you succeed, the following best practices will help you right size your containers. After you determine the number of resources required for your application, you should set requests and limits Kubernetes to ensure that your applications are running correctly. </p> </li> </ul> <p> (a) Perform testing of the application:  to gather vital statistics and other performance \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Based upon this data you can work out the optimal configuration, in terms of memory and \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CPU, for your container. Vital statistics such as : CPU, Latency, I/O, Memory usage, \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Network . Determine expected, mean, and peak container memory and CPU usage by \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0doing a separate load test if necessary. Also consider all the processes that might \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0potentially run in parallel in the container. </p> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0     Recommend to use  CloudWatch Container insights or partner products, which will give \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0you the right information to size containers and the Worker nodes.</p> <p> (b)Test services independently:  As many applications depend on each other in a true \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0microservice architecture, you need to test them with a high degree of independence \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0meaning that the services are both able to properly function by themselves, as well as \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0function as part of a cohesive system.</p>"},{"location":"performance/performance/#resource-management","title":"Resource Management","text":"<p>One of the most common questions that asked in the adoption of Kubernetes is \"What should I put in a Pod?\". For example, a three tier LAMP application container. Should we keep this application in the same pod? Well, this works effectively as a single pod but this is an example of an anti-pattern for Pod creation. There are two reasons for that </p> <p>(a) If you have both the containers in the same Pod, you are forced to use the same scaling strategy which is not ideal for production environment also you can't effectively manage or constraint resources based on the usage. E.g: you might need to scale just the frontend not frontend and backend (MySQL) as a unit also if you would like to increase the resources dedicated just to the backend, you cant just do that.</p> <p>(b) If you have two separate pods, one for frontend and other for backend. Scaling would be very easy and you get a better reliability.</p> <p>The above might not work in all the use-cases. In the above example frontend and backend may land in different machines and they will communicate with each other via network, So you need to ask the question \"Will my application work correctly, If they are placed and run on different machines?\" If the answer is a \"no\" may be because of the application design or for some other technical reasons, then grouping of containers in a single pod makes sense. If the answer is \"Yes\" then multiple Pods is the correct approach.</p>"},{"location":"performance/performance/#recommendations_1","title":"Recommendations","text":"<ul> <li> <p>Package a single application per container: A container works best when a single application runs inside it. This application should have a single parent process. For example, do not run PHP and MySQL in the same container: it's harder to debug, and you can't horizontally scale the PHP container alone. This separation allows you to better tie the lifecycle of the application to that of the container.  Your containers should be both stateless and immutable. Stateless means that any state (persistent data of any kind) is stored outside of the container, for example, you can use different kinds of external storage like Persistent disk, Amazon EBS, and Amazon EFS if needed, or managed database like Amazon RDS.  Immutable means that a container will not be modified during its life: no updates, no patches, and no configuration changes. To update the application code or apply a patch, you build a new image and deploy it.</p> </li> <li> <p>Use Labels to Kubernetes Objects: Labels allow Kubernetes objects to be queried and operated upon in bulk. They can also be used to identify and organize Kubernetes objects into groups. As such defining labels should figure right at the top of any Kubernetes best practices list.</p> </li> <li> <p>Setting resource request limits: Setting request limits is the mechanism used to control the amount of system resources that a container can consume such as CPU and memory. These settings are what the container is guaranteed to get when the container initially starts. If a container requests a resource, container orchestrators such as Kubernetes will only schedule it on a node that can provide that resource. Limits, on the other hand, make sure that a container never goes above a certain value. The container is only allowed to go up to the limit, and then it is restricted.</p> </li> </ul> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 In the below example Pod manifest, we add a limit of 1.0 CPU and 256 MB of memory</p> <pre><code>        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: nginx-pod-webserver\n          labels:\n            name: nginx-pod\n        spec:\n          containers:\n          - name: nginx\n            image: nginx:latest\n            resources:\n              limits:\n                memory: \"256Mi\"\n                cpu: \"1000m\"\n              requests:\n                memory: \"128Mi\"\n                cpu: \"500m\"\n            ports:\n            - containerPort: 80\n</code></pre> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0It's a best practice to define these requests and limits in your pod definitions. If you don't \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0include these values, the scheduler doesn't understand what resources are needed. \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Without this information, the scheduler might schedule the pod on a node without \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sufficient resources to provide acceptable application performance.</p> <ul> <li>Limit the number of concurrent disruptions: Use  PodDisruptionBudget, This settings allows you to set a policy on the minimum available and maximum unavailable pods during voluntary eviction events. An example of an eviction would be when perform maintenance on the node or draining a node.</li> </ul> <p> Example: A web frontend might want to ensure that 8 Pods to be available at any \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0given time. In this scenario, an eviction can evict as many pods as it wants, as long as \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0eight are available. <pre><code>apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: frontend-demo\nspec:\n  minAvailable: 8\n  selector:\n    matchLabels:\n      app: frontend\n</code></pre></p> <p> N.B: You can also specify pod disruption budget as a percentage by using maxAvailable \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0or maxUnavailable parameter.</p> <ul> <li>Use Namespaces: Namespaces allows a physical cluster to be shared by multiple teams. A namespace allows to partition created resources into a logically named group. This allows you to set resource quotas per namespace, Role-Based Access Control (RBAC) per namespace, and also network policies per namespace. It gives you soft multitenancy features.</li> </ul> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0For example, If you have three applications running on a single Amazon EKS cluster \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0accessed by three different teams which requires multiple resource constraints and \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0different levels of QoS each group  you could create a namespace per team and give each \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0team a quota on the number of resources that it can utilize, such as CPU and memory.</p> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0You can also specify default limits in Kubernetes namespaces level by enabling \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LimitRange admission controller. These default limits will constrain the amount of CPU \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0or memory a given Pod can use unless the defaults are explicitly overridden by the Pod's \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0configuration.</p> <ul> <li> <p>Manage Resource Quota:  Each namespace can be assigned resource quota. Specifying quota allows to restrict how much of cluster resources can be consumed across all resources in a namespace. Resource quota can be defined by a ResourceQuota object. A presence of ResourceQuota object in a namespace ensures that resource quotas are enforced.</p> </li> <li> <p>Configure Health Checks for Pods: Health checks are a simple way to let the system know if an instance of your app is working or not. If an instance of your app is not working, then other services should not access it or send requests to it. Instead, requests should be sent to another instance of the app that is working. The system also should bring your app back to a healthy state.  By default, all the running pods have the restart policy set to always which means the kubelet running within a node will automatically restart a pod when the container encounters an error. Health checks extend this capability of kubelet through the concept of container probes.</p> </li> </ul> <p>Kubernetes provides two types of health checks: readiness and liveness probes.  For example, consider if one of your applications, which typically runs for long periods of time, transitions to a non-running state and can only recover by being restarted. You can use liveness probes to detect and remedy such situations. Using health checks gives your applications better reliability, and higher uptime.</p> <ul> <li>Advanced Scheduling Techniques: Generally, schedulers ensure that pods are placed only on nodes that have sufficient free resources, and across nodes, they try to balance out the resource utilization across nodes, deployments, replicas, and so on. But sometimes you want to control how your pods are scheduled. For example, perhaps you want to ensure that certain pods are only scheduled on nodes with specialized hardware, such as requiring a GPU machine for an ML workload. Or you want to collocate services that communicate frequently.</li> </ul> <p>Kubernetes offers manyadvanced scheduling featuresand multiple filters/constraints to schedule the pods on the right node.  For example, when using Amazon EKS, you can usetaints and tolerationsto restrict what workloads can run on specific nodes. You can also control pod scheduling using node selectorsandaffinity and anti-affinityconstructs and even have your own custom scheduler built for this purpose.</p>"},{"location":"performance/performance/#scalability-management","title":"Scalability Management","text":"<p>Containers are stateless. They are born and when they die, they are not resurrected.  There are many techniques that you can leverage on Amazon EKS, not only to scale out your containerized applications but also the Kubernetes worker node.</p>"},{"location":"performance/performance/#recommendations_2","title":"Recommendations","text":"<ul> <li> <p>On Amazon EKS, you can configure Horizontal pod autoscaler,which automatically scales the number of pods in a replication controller, deployment, or replica set based on observed CPU utilization (or usecustom metricsbased on application-provided metrics).</p> </li> <li> <p>You can use  Vertical Pod Autoscaler which automatically adjusts the CPU and memory reservations for your pods to help \"right size\" your applications. This adjustment can improve cluster resource utilization and free up CPU and memory for other pods.  This is useful in scenarios like your production database \"MongoDB\" does not scale the same way as a stateless application frontend, In this scenario you could use VPA to scale up the MongoDB Pod.</p> </li> <li> <p>To enable VPA you need to use  Kubernetes metrics server, which is an aggregator of resource usage data in your cluster. It is not deployed by default in Amazon EKS clusters.  You need to configure it before configure VPA alternatively you can also use Prometheus to provide metrics for the Vertical Pod Autoscaler.</p> </li> <li> <p>While HPA and VPA scale the deployments and pods, Cluster Autoscaler will scale-out  and scale-in the size of the pool of worker nodes. It adjusts the size of a Kubernetes cluster based on the current utilization. Cluster Autoscaler increases the size of the cluster when there are pods that failed to schedule on any of the current nodes due to insufficient resources or when adding a new node would increase the overall availability of cluster resources. Please follow this step by step guide to setup Cluster Autoscaler.  If you are using Amazon EKS on AWS Fargate, AWS Manages the control plane for you. </p> <p>Please have a look at the reliability pillar for detailed information.</p> </li> </ul>"},{"location":"performance/performance/#monitoring","title":"Monitoring","text":""},{"location":"performance/performance/#deployment-best-practices","title":"Deployment Best Practices","text":""},{"location":"performance/performance/#trade-offs","title":"Trade-Offs","text":""},{"location":"reliability/docs/","title":"Amazon EKS Best Practices Guide for Reliability","text":"<p>This section provides guidance about making workloads running on EKS resilient and highly-available  </p>"},{"location":"reliability/docs/#how-to-use-this-guide","title":"How to use this guide","text":"<p>This guide is meant for developers and architects who want to develop and operate highly-available and fault-tolerant services in EKS. The guide is organized into different topic areas for easier consumption. Each topic starts with a brief overview, followed by a list of recommendations and best practices for the reliability of your EKS clusters.</p>"},{"location":"reliability/docs/#introduction","title":"Introduction","text":"<p>The reliability best practices for EKS have been grouped under the following topics:</p> <ul> <li>Applications</li> <li>Control Plane </li> <li>Data Plane</li> </ul> <p>What makes a system reliable? If a system can function consistently and meet demands in spite of changes in its environment over a period of time, it can be called reliable. To achieve this, the system has to detect failures, automatically heal itself, and have the ability to scale based on demand. </p> <p>Customers can use Kubernetes as a foundation to operate mission-critical applications and services reliably. But aside from incorporating container-based application design principles, running workloads reliably also requires a reliable infrastructure. In Kubernetes, infrastructure comprises the control plane and data plane. </p> <p>EKS provides a production-grade Kubernetes control plane that is designed to be highly-available and fault-tolerant. </p> <p>In EKS, AWS is responsible for the reliability of the Kubernetes control plane. EKS runs Kubernetes control plane across three availability zones in an AWS Region. It automatically manages the availability and scalability of the Kubernetes API servers and the etcd cluster. </p> <p>The responsibility for the data plane\u2019s reliability is shared between you, the customer, and AWS. EKS offers three options for Kubernetes data plane. Fargate, which is the most managed option, handles provisioning and scaling of the data plane. The second option, managed nodes groups, handles provisioning, and updates of the data plane. And finally, self-managed nodes is the least managed option for the data plane. The more AWS-managed data plane you use, the less responsibility you have</p> <p>Managed node groups automate the provisioning and lifecycle management of EC2 nodes. You can use the EKS API (using EKS console, AWS API, AWS CLI, CloudFormation, Terraform, or <code>eksctl</code>),   to create, scale, and upgrade managed nodes. Managed nodes run EKS-optimized Amazon Linux 2 EC2 instances in your account, and you can install custom software packages by enabling SSH access. When you provision managed nodes, they run as part of an EKS-managed Auto Scaling Group that can span multiple Availability Zones; you control this through the subnets you provide when creating managed nodes. EKS also automatically tags managed nodes so they can be used with Cluster Autoscaler. </p> <p>Amazon EKS follows the shared responsibility model for CVEs and security patches on managed node groups. Because managed nodes run the Amazon EKS-optimized AMIs, Amazon EKS is responsible for building patched versions of these AMIs when bug fixes. However, you are responsible for deploying these patched AMI versions to your managed node groups. </p> <p>EKS also manages updating the nodes although you have to initiate the update process. The process of updating managed node is explained in the EKS documentation. </p> <p>If you run self-managed nodes, you can use Amazon EKS-optimized Linux AMI to create worker nodes. You are responsible for patching and upgrading the AMI and the nodes. It is a best practice to use <code>eksctl</code>, CloudFormation, or infrastructure as code tools to provision self-managed nodes because this will make it easy for you to upgrade self-managed nodes. Consider migrating to new nodes when updating worker nodes because the migration process taints the old node group as <code>NoSchedule</code> and drains the nodes after a new stack is ready to accept the existing pod workload. However, you can also perform an in-place upgrade of self-managed nodes.</p> <p></p> <p></p> <p>This guide includes a set of recommendations that you can use to improve the reliability of your EKS data plane, Kubernetes core components, and your applications.</p>"},{"location":"reliability/docs/#feedback","title":"Feedback","text":"<p>This guide is being released on GitHub to collect direct feedback and suggestions from the broader EKS/Kubernetes community. If you have a best practice that you feel we ought to include in the guide, please file an issue or submit a PR in the GitHub repository. We intend to update the guide periodically as new features are added to the service or when a new best practice evolves.</p>"},{"location":"reliability/docs/application/","title":"Running highly-available applications","text":"<p>Your customers expect your application to be always available, including when you're making changes and especially during spikes in traffic. A scalable and resilient architecture keeps your applications and services running without disruptions, which keeps your users happy. A scalable infrastructure grows and shrinks based on the needs of the business. Eliminating single points of failure is a critical step towards improving an application\u2019s availability and making it resilient.</p> <p>With Kubernetes, you can operate your applications and run them in a highly-available and resilient fashion. Its declarative management ensures that once you\u2019ve set up the application, Kubernetes will continuously try to match the current state with the desired state.</p>"},{"location":"reliability/docs/application/#recommendations","title":"Recommendations","text":""},{"location":"reliability/docs/application/#avoid-running-singleton-pods","title":"Avoid running singleton Pods","text":"<p>If your entire application runs in a single Pod, then your application will be unavailable if that Pod gets terminated. Instead of deploying applications using individual pods, create Deployments. If a Pod that is created by a Deployment fails or gets terminated, the Deployment controller will start a new pod to ensure the specified number of replica Pods are always running. </p>"},{"location":"reliability/docs/application/#run-multiple-replicas","title":"Run multiple replicas","text":"<p>Running multiple replicas Pods of an app using a Deployment helps it run in a highly-available manner. If one replica fails, the remaining replicas will still function, albeit at reduced capacity until Kubernetes creates another Pod to make up for the loss. Furthermore, you can use the Horizontal Pod Autoscaler to scale replicas automatically based on workload demand. </p>"},{"location":"reliability/docs/application/#schedule-replicas-across-nodes","title":"Schedule replicas across nodes","text":"<p>Running multiple replicas won\u2019t be very useful if all the replicas are running on the same node, and the node becomes unavailable. Consider using pod anti-affinity or pod topology spread constraints to spread replicas of a Deployment across multiple worker nodes. </p> <p>You can further improve a typical application\u2019s reliability by running it across multiple AZs. </p>"},{"location":"reliability/docs/application/#using-pod-anti-affinity-rules","title":"Using Pod anti-affinity rules","text":"<p>The manifest below tells Kubernetes scheduler to prefer to place pods on separate nodes and AZs. It doesn\u2019t require distinct nodes or AZ because if it did, then Kubernetes will not be able to schedule any pods once there is a pod running in each AZ. If your application requires just three replicas, you can use <code>requiredDuringSchedulingIgnoredDuringExecution</code> for <code>topologyKey: topology.kubernetes.io/zone</code>, and Kubernetes scheduler will not schedule two pods in the same AZ.</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spread-host-az\n  labels:\n    app: web-server\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      affinity:\n        podAntiAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: topology.kubernetes.io/zone\n            weight: 100\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: kubernetes.io/hostname \n            weight: 99\n      containers:\n      - name: web-app\n        image: nginx:1.16-alpine\n</code></pre>"},{"location":"reliability/docs/application/#using-pod-topology-spread-constraints","title":"Using Pod topology spread constraints","text":"<p>Similar to pod anti-affinity rules, pod topology spread constraints allow you to make your application available across different failure (or topology) domains like hosts or AZs. This approach works very well when you're trying to ensure fault tolerance as well as availability by having multiple replicas in each of the different topology domains. Pod anti-affinity rules, on the other hand, can easily produce a result where you have a single replica in a topology domain because the pods with an anti-affinity toward each other have a repelling effect. In such cases, a single replica on a dedicated node isn't ideal for fault tolerance nor is it a good use of resources. With topology spread constraints, you have more control over the spread or distribution that the scheduler should try to apply across the topology domains. Here are some important properties to use in this approach: 1. The <code>maxSkew</code> is used to control or determine the maximum point to which things can be uneven across the topology domains. For example, if an application has 10 replicas and is deployed across 3 AZs, you can't get an even spread, but you can influence how uneven the distribution will be. In this case, the <code>maxSkew</code> can be anything between 1 and 10. A value of 1 means you can potentially end up with a spread like <code>4,3,3</code>, <code>3,4,3</code> or <code>3,3,4</code> across the 3 AZs. In contrast, a value of 10 means you can potentially end up with a spread like <code>10,0,0</code>, <code>0,10,0</code> or <code>0,0,10</code> across 3 AZs. 2. The <code>topologyKey</code> is a key for one of the node labels and defines the type of topology domain that should be used for the pod distribution. For example, a zonal spread would have the following key-value pair: <pre><code>topologyKey: \"topology.kubernetes.io/zone\"\n</code></pre> 3. The <code>whenUnsatisfiable</code> property is used to determine how you want the scheduler to respond if the desired constraints can't be satisfied. 4. The <code>labelSelector</code> is used to find matching pods so that the scheduler can be aware of them when deciding where to place pods in accordance with the constraints that you specify.</p> <p>In addition to these above, there are other fields that you can read about further in the Kubernetes documentation.</p> <p></p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spread-host-az\n  labels:\n    app: web-server\nspec:\n  replicas: 10\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      topologySpreadConstraints:\n      - maxSkew: 1\n        topologyKey: \"topology.kubernetes.io/zone\"\n        whenUnsatisfiable: ScheduleAnyway\n        labelSelector:\n          matchLabels:\n            app: express-test\n      containers:\n      - name: web-app\n        image: nginx:1.16-alpine\n</code></pre>"},{"location":"reliability/docs/application/#run-kubernetes-metrics-server","title":"Run Kubernetes Metrics Server","text":"<p>Install the Kubernetes metrics server to help scale your applications. Kubernetes autoscaler add-ons like HPA and VPA need to track metrics of applications to scale them. The metrics-server collects resource metrics that can be used to make scaling decisions. The metrics are collected from kubelets and served in Metrics API format.</p> <p>The metrics server doesn\u2019t retain any data, and it\u2019s not a monitoring solution. Its purpose is to expose CPU and memory usage metrics to other systems. If you want to track your application's state over time, you need a monitoring tool like Prometheus or Amazon CloudWatch. </p> <p>Follow the EKS documentation to install metrics-server in your EKS cluster. </p>"},{"location":"reliability/docs/application/#horizontal-pod-autoscaler-hpa","title":"Horizontal Pod Autoscaler (HPA)","text":"<p>HPA can automatically scale your application in response to demand and help you avoid impacting your customers during peak traffic. It is implemented as a control loop in Kubernetes that periodically queries metrics from APIs that provide resource metrics.</p> <p>HPA can retrieve metrics from the following APIs: 1. <code>metrics.k8s.io</code> also known as Resource Metrics API \u2014 Provides CPU and memory usage for pods 2. <code>custom.metrics.k8s.io</code> \u2014 Provides metrics from other metric collectors like Prometheus; these metrics are internal to your Kubernetes cluster.  3. <code>external.metrics.k8s.io</code> \u2014 Provides metrics that are external to your Kubernetes cluster (E.g., SQS Queue Depth, ELB latency).</p> <p>You must use one of these three APIs to provide the metric to scale your application. </p>"},{"location":"reliability/docs/application/#scaling-applications-based-on-custom-or-external-metrics","title":"Scaling applications based on custom or external metrics","text":"<p>You can use custom or external metrics to scale your application on metrics other than CPU or memory utilization. Custom Metrics API servers provide the <code>custom-metrics.k8s.io</code> API that HPA can use to autoscale applications. </p> <p>You can use the Prometheus Adapter for Kubernetes Metrics APIs to collect metrics from Prometheus and use with the HPA. In this case, Prometheus adapter will expose Prometheus metrics in Metrics API format. </p> <p>Once you deploy the Prometheus Adapter, you can query custom metrics using kubectl. <code>kubectl get \u2014raw /apis/custom.metrics.k8s.io/v1beta1/</code></p> <p>External metrics, as the name suggests, provide the Horizontal Pod Autoscaler the ability to scale deployments using metrics that are external to the Kubernetes cluster. For example, in batch processing workloads, it is common to scale the number of replicas based on the number of jobs in flight in an SQS queue.</p> <p>To autoscale a Deployment using a CloudWatch metric, for example, scaling a batch-processor application based on SQS queue depth, you can use <code>k8s-cloudwatch-adapter</code>. <code>k8s-cloudwatch-adapter</code> is a community project and not maintained by AWS. </p>"},{"location":"reliability/docs/application/#vertical-pod-autoscaler-vpa","title":"Vertical Pod Autoscaler (VPA)","text":"<p>VPA automatically adjusts the CPU and memory reservation for your Pods to help you \u201cright-size\u201d your applications. For applications that need to be scaled vertically - which is done by increasing resource allocation - you can use VPA to automatically scale Pod replicas or provide scaling recommendations.</p> <p>Your application may become temporarily unavailable if VPA needs to scale it because VPA\u2019s current implementation does not perform in-place adjustments to Pods; instead, it will recreate the Pod that needs to be scaled. </p> <p>EKS Documentation includes a walkthrough for setting up VPA. </p> <p>Fairwinds Goldilocks project provides a dashboard to visualize VPA recommendations for CPU and memory requests and limits. Its VPA update mode allows you to auto-scale Pods based on VPA recommendations. </p>"},{"location":"reliability/docs/application/#updating-applications","title":"Updating applications","text":"<p>Modern applications require rapid innovation with a high degree of stability and availability. Kubernetes gives you the tools to update your applications continuously without disrupting your customers. </p> <p>Let\u2019s look at some of the best practices that make it possible to quickly deploy changes without sacrificing availability.</p>"},{"location":"reliability/docs/application/#have-a-mechanism-to-perform-rollbacks","title":"Have a mechanism to perform rollbacks","text":"<p>Having an undo button can evade disasters. It is a best practice to test deployments in a separate lower environment (test or development environment) before updating the production cluster. Using a CI/CD pipeline can help you automate and test deployments. With a continuous deployment pipeline, you can quickly revert to the older version if the upgrade happens to be defective.  </p> <p>You can use Deployments to update a running application. This is typically done by updating the container image. You can use <code>kubectl</code> to update a Deployment like this:</p> <pre><code>kubectl --record deployment.apps/nginx-deployment set image nginx-deployment nginx=nginx:1.16.1\n</code></pre> <p>The <code>--record</code> argument record the changes to the Deployment and helps you if you need to perform a rollback. <code>kubectl rollout history deployment</code> shows you the recorded changes to Deployments in your cluster. You can rollback a change using <code>kubectl rollout undo deployment &lt;DEPLOYMENT_NAME&gt;</code>.</p> <p>By default, when you update a Deployment that requires a recreation of pods, Deployment will perform a rolling update. In other words, Kubernetes will only update a portion of the running pods in a Deployment and not all the Pods at once. You can control how Kubernetes performs rolling updates through <code>RollingUpdateStrategy</code> property. </p> <p>When performing a rolling update of a Deployment, you can use the <code>Max Unavailable</code> property to specify the maximum number of Pods that can be unavailable during the update. The <code>Max Surge</code> property of Deployment allows you to set the maximum number of Pods that can be created over the desired number of Pods.</p> <p>Consider adjusting <code>max unavailable</code> to ensure that a rollout doesn\u2019t disrupt your customers. For example, Kubernetes sets 25% <code>max unavailable</code> by default, which means if you have 100 Pods, you may have only 75 Pods actively working during a rollout. If your application needs a minimum of 80 Pods, this rollout can be disruptive. Instead, you can set <code>max unavailable</code> to 20% to ensure that there are at least 80 functional Pods throughout the rollout. </p>"},{"location":"reliability/docs/application/#use-bluegreen-deployments","title":"Use blue/green deployments","text":"<p>Changes are inherently risky, but changes that cannot be undone can be potentially catastrophic. Change procedures that allow you to effectively turn back time through a rollback make enhancements and experimentation safer. Blue/green deployments give you a method to quickly retract the changes if things go wrong. In this deployment strategy, you create an environment for the new version. This environment is identical to the current version of the application being updated. Once the new environment is provisioned, traffic is routed to the new environment. If the new version produces the desired results without generating errors, the old environment is terminated. Otherwise, traffic is restored to the old version. </p> <p>You can perform blue/green deployments in Kubernetes by creating a new Deployment that is identical to the existing version\u2019s Deployment. Once you verify that the Pods in the new Deployment are running without errors, you can start sending traffic to the new Deployment by changing the <code>selector</code> spec in the Service that routes traffic to your application\u2019s Pods.</p> <p>Many continuous integration tools such as Flux, Jenkins, and Spinnaker let you automate blue/green deployments. AWS Containers Blog includes a walkthrough using AWS Load Balancer Controller: Using AWS Load Balancer Controller for blue/green deployment, canary deployment and A/B testing</p>"},{"location":"reliability/docs/application/#use-canary-deployments","title":"Use Canary deployments","text":"<p>Canary deployments are a variant of blue/green deployments that can significantly remove risk from changes. In this deployment strategy, you create a new Deployment with fewer Pods alongside your old Deployment, and divert a small percentage of traffic to the new Deployment. If metrics indicate that the new version is performing as well or better than the existing version, you progressively increase traffic to the new Deployment while scaling it up until all traffic is diverted to the new Deployment. If there's an issue, you can route all traffic to the old Deployment and stop sending traffic to the new Deployment.</p> <p>Although Kubernetes offers no native way to perform canary deployments, you can use tools such as Flagger with Istio or App Mesh.</p>"},{"location":"reliability/docs/application/#health-checks-and-self-healing","title":"Health checks and self-healing","text":"<p>No software is bug-free, but Kubernetes can help you to minimize the impact of software failures. In the past, if an application crashed, someone had to remediate the situation by restarting the application manually. Kubernetes gives you the ability to detect software failures in your Pods and automatically replace them with new replicas. With Kubernetes you can monitor the health of your applications and automatically replace unhealthy instances.  </p> <p>Kubernetes supports three types of health-checks:</p> <ol> <li>Liveness probe</li> <li>Startup probe (supported in Kubernetes version 1.16+)</li> <li>Readiness probe</li> </ol> <p>Kubelet, the Kubernetes agent, is responsible for running all the above-mentioned checks. Kubelet can check a Pods' health in three ways: kubelet can either run a shell command inside a Pod's container, send an HTTP GET request to its container, or open a TCP socket on a specified port.  </p> <p>If you choose an <code>exec</code>-based probe, which runs a shell script inside a container, ensure that the shell command exits before the <code>timeoutSeconds</code> value expires. Otherwise, your node will have <code>&lt;defunct&gt;</code> processes, leading to node failure. </p>"},{"location":"reliability/docs/application/#recommendations_1","title":"Recommendations","text":""},{"location":"reliability/docs/application/#use-liveness-probe-to-remove-unhealthy-pods","title":"Use Liveness Probe to remove unhealthy pods","text":"<p>The Liveness probe can detect deadlock conditions where the process continues to run, but the application becomes unresponsive. For example, if you are running a web service that listens on port 80, you can configure a Liveness probe to send an HTTP GET request on Pod\u2019s port 80. Kubelet will periodically send a GET request to the Pod and expect a response; if the Pod responds between 200-399 then the kubelet considers that Pod is healthy; otherwise, the Pod will be marked as unhealthy. If a Pod fails health-checks continuously, the kubelet will terminate it. </p> <p>You can use <code>initialDelaySeconds</code> to delay the first probe.</p> <p>When using the Liveness Probe, ensure that your application doesn\u2019t run into a situation in which all Pods simultaneously fail the Liveness Probe because Kubernetes will try to replace all your Pods, which will render your application offline. Furthermore, Kubernetes will continue to create new Pods that will also fail Liveness Probes, putting unnecessary strain on the control plane. Avoid configuring the Liveness Probe to depend on an a factor that is external to your Pod, for example, a external database. In other words, a non-responsive external-to-your-Pod database shouldn\u2019t make your Pods fail their Liveness Probes.</p> <p>Sandor Sz\u00fccs\u2019s post LIVENESS PROBES ARE DANGEROUS describes problems that can be caused by misconfigured probes.</p>"},{"location":"reliability/docs/application/#use-startup-probe-for-applications-that-take-longer-to-start","title":"Use Startup Probe for applications that take longer to start","text":"<p>When your app needs additional time to startup, you can use the Startup Probe to delay the Liveness and Readiness Probe. For example, a Java app that needs to hydrate cache from a database may need up to two minutes before it is fully functional. Any Liveness or Readiness Probe until it becomes fully functional might fail. Configuring a Startup Probe will allow the Java app to become healthy before Liveness or Readiness Probe are executed. </p> <p>Until the Startup Probe succeeds, all the other Probes are disabled. You can define the maximum time Kubernetes should wait for application startup. If, after the maximum configured time, the Pod still fails Startup Probes, it will be terminated, and a new Pod will be created. </p> <p>The Startup Probe is similar to the Liveness Probe -- if they fail, the Pod is recreated. As Ricardo A. explains in his post Fantastic Probes And How To Configure Them, Startup Probes should be used when the startup time of an application is unpredictable. If you know your application needs ten seconds to start, you should use Liveness/Readiness Probe with <code>initialDelaySeconds</code> instead.</p>"},{"location":"reliability/docs/application/#use-readiness-probe-to-detect-partial-unavailability","title":"Use Readiness Probe to detect partial unavailability","text":"<p>While the Liveness probe detects failures in an app that are resolved by terminating the Pod (hence, restarting the app), Readiness Probe detects conditions where the app may be temporarily unavailable. In these situations, the app may become temporarily unresponsive; however, it is expected to be healthy again once this operation completes.  </p> <p>For example, during intense disk I/O operations, applications may be temporarily unavailable to handle requests. Here, terminating the application\u2019s Pod is not a remedy; at the same time, additional requests sent to the Pod can fail. </p> <p>You can use the Readiness Probe to detect temporary unavailability in your app and stop sending requests to its Pod until it becomes functional again. Unlike Liveness Probe, where a failure would result in a recreation of Pod, a failed Readiness Probe would mean that Pod will not receive any traffic from Kubernetes Service. When the Readiness Probe succeeds, Pod will resume receiving traffic from Service. </p> <p>Just like the Liveness Probe, avoid configuring Readiness Probes that depend on a resource that\u2019s external to the Pod (such as a database). Here\u2019s a scenario where a poorly configured Readiness can render the application nonfunctional - if a Pod\u2019s Readiness Probe fails when the app\u2019s database is unreachable, other Pod replicas will also fail simultaneously since they share the same health-check criteria. Setting the probe in this way will ensure that whenever the database is unavailable, the Pod\u2019s Readiness Probes will fail, and Kubernetes will stop sending traffic all Pods.  </p> <p>A side-effect of using Readiness Probes is that they can increase the time it takes to update Deployments. New replicas will not receive traffic unless Readiness Probes are successful; until then, old replicas will continue to receive traffic. </p>"},{"location":"reliability/docs/application/#dealing-with-disruptions","title":"Dealing with disruptions","text":"<p>Pods have a finite lifetime - even if you have long-running Pods, it\u2019s prudent to ensure Pods terminate correctly when the time comes. Depending on your upgrade strategy, Kubernetes cluster upgrades may require you to create new worker nodes, which requires all Pods to be recreated on newer nodes. Proper termination handling and Pod Disruption Budgets can help you avoid service disruptions as Pods are removed from older nodes and recreated on newer nodes.  </p> <p>The preferred way to upgrade worker nodes is by creating new worker nodes and terminating old ones. Before terminating worker nodes, you should <code>drain</code> it. When a worker node is drained, all its pods are safely evicted. Safely is a key word here; when pods on a worker are evicted, they are not simply sent a <code>SIGKILL</code> signal. Instead, a <code>SIGTERM</code> signal is sent to the main process (PID 1) of each container in the Pods being evicted. After the <code>SIGTERM</code> signal is sent, Kubernetes will give the process some time (grace period) before a <code>SIGKILL</code> signal is sent. This grace period is 30 seconds by default; you can override the default by using <code>grace-period</code> flag in kubectl or declare <code>terminationGracePeriodSeconds</code> in your Podspec.</p> <p><code>kubectl delete pod &lt;pod name&gt; \u2014grace-period=&lt;seconds&gt;</code></p> <p>It is common to have containers in which the main process doesn\u2019t have PID 1. Consider this Python-based sample container:</p> <pre><code>$ kubectl exec python-app -it ps\n PID USER TIME COMMAND\n 1   root 0:00 {script.sh} /bin/sh ./script.sh\n 5   root 0:00 python app.py\n</code></pre> <p>In this example, the shell script receives <code>SIGTERM</code>, the main process, which happens to be a Python application in this example, doesn\u2019t get a <code>SIGTERM</code> signal. When the Pod is terminated, the Python application will be killed abruptly. This can be remediated by changing the <code>ENTRYPOINT</code> of the container to launch the Python application. Alternatively, you can use a tool like dumb-init to ensure that your application can handle signals.  </p> <p>You can also use Container hooks to execute a script or an HTTP request at container start or stop. The <code>PreStop</code> hook action runs before the container receives a <code>SIGTERM</code> signal and must complete before this signal is sent. The <code>terminationGracePeriodSeconds</code> value applies from when the <code>PreStop</code> hook action begins executing, not when the <code>SIGTERM</code> signal is sent.</p>"},{"location":"reliability/docs/application/#recommendations_2","title":"Recommendations","text":""},{"location":"reliability/docs/application/#protect-critical-workload-with-pod-disruption-budgets","title":"Protect critical workload with Pod Disruption Budgets","text":"<p>Pod Disruption Budget or PDB can temporarily halt the eviction process if the number of replicas of an application falls below the declared threshold. The eviction process will continue once the number of available replicas is over the threshold. You can use PDB to declare the <code>minAvailable</code> and <code>maxUnavailable</code> number of replicas. For example, if you want at least three copies of your app to be available, you can create a PDB. </p> <pre><code>apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: my-svc-pdb\nspec:\n  minAvailable: 3\n  selector:\n    matchLabels:\n      app: my-svc\n</code></pre> <p>The above PDB policy tells Kubernetes to halt the eviction process until three or more replicas are available. Node draining respects <code>PodDisruptionBudgets</code>. During an EKS managed node group upgrade, nodes are drained with a fifteen-minute timeout. After fifteen minutes, if the update is not forced (the option is called Rolling update in the EKS console), the update fails. If the update is forced, the pods are deleted.</p> <p>For self-managed nodes, you can also use tools like AWS Node Termination Handler, which ensures that the Kubernetes control plane responds appropriately to events that can cause your EC2 instance to become unavailable, such as EC2 maintenance events and EC2 Spot interruptions. It uses the Kubernetes API to cordon the node to ensure no new Pods are scheduled, then drains it, terminating any running Pods.</p> <p>You can use Pod anti-affinity to schedule a Deployment\u2018s Pods on different nodes and avoid PDB related delays during node upgrades. </p>"},{"location":"reliability/docs/application/#practice-chaos-engineering","title":"Practice chaos engineering","text":"<p>Chaos Engineering is the discipline of experimenting on a distributed system in order to build confidence in the system\u2019s capability to withstand turbulent conditions in production.</p> <p>In his blog, Dominik Tornow explains that Kubernetes is a declarative system where \u201cthe user supplies a representation of the desired state of the system to the system. The system then considers the current state and the desired state to determine the sequence of commands to transition from the current state to the desired state.\u201d This means Kubernetes always stores the desired state and if the system deviates, Kubernetes will take action to restore the state. For example, if a worker node becomes unavailable, Kubernetes will reschedule the Pods onto another worker node. Similarly, if a <code>replica</code> crashes, the Deployment Contoller will create a new <code>replica</code>. In this way, Kubernetes controllers automatically fix failures. </p> <p>Chaos engineering tools like Gremlin help you test the resiliency of your Kubernetes cluster and identify single points of failure. Tools that introduce artificial chaos in your cluster (and beyond) can uncover systemic weaknesses, present an opportunity to identify  bottlenecks and misconfigurations, and rectify problems in a controlled environment. The Chaos Engineering philosophy advocates breaking things on purpose and stress testing infrastructure to minimize unanticipated downtime. </p>"},{"location":"reliability/docs/application/#use-a-service-mesh","title":"Use a Service Mesh","text":"<p>You can use a service mesh to improve your application\u2019s resiliency. Service meshes enable service-to-service communication and increase the observability of your microservices network. Most service mesh products work by having a small network proxy run alongside each service that intercepts and inspects the application\u2019s network traffic. You can place your application in a mesh without modifying your application. Using service proxy\u2019s built-in features, you can have it generate network statistics, create access logs, and add HTTP headers to outbound requests for distributed tracing.</p> <p>A service mesh can help you make your microservices more resilient with features like automatic request retries, timeouts, circuit-breaking, and rate-limiting.</p> <p>If you operate multiple clusters, you can use a service mesh to enable cross-cluster service-to-service communication.</p>"},{"location":"reliability/docs/application/#service-meshes","title":"Service Meshes","text":"<ul> <li>AWS App Mesh</li> <li>Istio</li> <li>LinkerD</li> <li>Consul</li> </ul>"},{"location":"reliability/docs/application/#observability","title":"Observability","text":"<p>Observability is an umbrella term that includes monitoring, logging, and tracing. Microservices based applications are distributed by nature. Unlike monolithic applications where monitoring a single system is sufficient, in a distributed application architecture, you need to monitor each component\u2019s performance. You can use cluster-level monitoring, logging, and distributed tracing systems to identify issues in your cluster before they disrupt your customers. </p> <p>Kubernetes built-in tools for troubleshooting and monitoring are limited. The metrics-server collects resource metrics and stores them in memory but doesn\u2019t persist them. You can view the logs of a Pod using kubectl, but Kubernetes doesn't automatically retain logs. And the implementation of distributed tracing is done either at the application code level or using services meshes. </p> <p>Kubernetes' extensibility shines here. Kubernetes allows you to bring your preferred centralized monitoring, logging, and tracing solution. </p>"},{"location":"reliability/docs/application/#recommendations_3","title":"Recommendations","text":""},{"location":"reliability/docs/application/#monitor-your-applications","title":"Monitor your applications","text":"<p>The number of metrics you need to monitor in modern applications is growing continuously. It helps if you have an automated way to track your applications so you can focus on solving your customer\u2019s challenges. Cluster-wide monitoring tools like Prometheus or CloudWatch Container Insights can monitor your cluster and workload and provide you signals when, or preferably, before things go wrong. </p> <p>Monitoring tools allow you to create alerts that your operations team can subscribe to. Consider rules to activate alarms for events that can, when exacerbated, lead to an outage or impact application performance. </p> <p>If you\u2019re unclear on which metrics you should monitor, you can take inspiration from these methods:</p> <ul> <li>RED method. Stands for requests, errors, and duration. </li> <li>USE method. Stands for utilization, saturation, and errors.  </li> </ul> <p>Sysdig\u2019s post Best practices for alerting on Kubernetes includes a comprehensive list of components that can impact the availability of your applications.</p>"},{"location":"reliability/docs/application/#use-prometheus-client-library-to-expose-application-metrics","title":"Use Prometheus client library to expose application metrics","text":"<p>In addition to monitoring the state of the application and aggregating standard metrics, you can also use the Prometheus client library to expose application-specific custom metrics to improve the application's observability.</p>"},{"location":"reliability/docs/application/#use-centralized-logging-tools-to-collect-and-persist-logs","title":"Use centralized logging tools to collect and persist logs","text":"<p>Logging in EKS falls under two categories: control plane logs and application logs. EKS control plane logging provides audit and diagnostic logs directly from the control plane to CloudWatch Logs in your account. Application logs are logs produced by Pods running inside your cluster. Application logs include logs produced by Pods that run the business logic applications and Kubernetes system components such as CoreDNS, Cluster Autoscaler, Prometheus, etc. </p> <p>EKS provide five types of control plane logs:</p> <ol> <li>Kubernetes API server component logs</li> <li>Audit</li> <li>Authenticator</li> <li>Controller manager </li> <li>Scheduler</li> </ol> <p>The controller manager and scheduler logs can help diagnose control plane problems such as bottlenecks and errors. By default, EKS control plane logs aren\u2019t sent to CloudWatch Logs. You can enable control plane logging and select the types of EKS control plane logs you\u2019d like to capture for each cluster in your account</p> <p>Collecting application logs requires installing a log aggregator tool like Fluent Bit, Fluentd, or CloudWatch Container Insights in your cluster.  </p> <p>Kubernetes log aggregator tools run as DaemonSets and scrape container logs from nodes. Application logs are then sent to a centralized destination for storage. For example, CloudWatch Container Insights can use either Fluent Bit or Fluentd to collect logs and ship them to CloudWatch Logs for storage. Fluent Bit and Fluentd support many popular log analytics systems such as Elasticsearch and InfluxDB giving you the ability to change the storage backend for your logs by modifying Fluent bit or Fluentd\u2019s log configuration. </p>"},{"location":"reliability/docs/application/#use-a-distributed-tracing-system-to-identify-bottlenecks","title":"Use a distributed tracing system to identify bottlenecks","text":"<p>A typical modern application has components distributed over the network, and its reliability depends on the proper functioning of each of the components that make up the application. You can use a distributed tracing solution to understand how requests flow and how systems communicate. Traces can show you where bottlenecks exist in your application network and prevent problems that can cause cascading failures. </p> <p>You have two options to implement tracing in your applications: you can either implement distributed tracing at the code level using shared libraries or use a service mesh. </p> <p>Implementing tracing at the code level can be disadvantageous. In this method, you have to make changes to your code. This is further complicated if you have polyglot applications. You\u2019re also responsible for maintaining yet another library, across your services. </p> <p>Service Meshes like LinkerD, Istio, and AWS App Mesh can be used to implement distributed tracing in your application with minimal changes to the application code. You can use service mesh to standardize metrics generation, logging, and tracing. </p> <p>Tracing tools like AWS X-Ray, Jaeger support both shared library and service mesh implementations. </p> <p>Consider using a tracing tool like AWS X-Ray or Jaeger that supports both (shared library and service mesh) implementations so you will not have to switch tools if you later adopt service mesh. </p>"},{"location":"reliability/docs/controlplane/","title":"EKS Control Plane","text":"<p>Amazon Elastic Kubernetes Service (EKS) is a managed Kubernetes service that makes it easy for you to run Kubernetes on AWS without needing to install, operate, and maintain your own Kubernetes control plane or worker nodes. It runs upstream Kubernetes and is certified Kubernetes conformant. This conformance ensures that EKS supports the Kubernetes APIs, just like the open-source community version that you can install on EC2 or on-premises. Existing applications running on upstream Kubernetes are compatible with Amazon EKS.</p> <p>EKS automatically manages the availability and scalability of the Kubernetes control plane nodes, and it automatically replaces unhealthy control plane nodes.</p>"},{"location":"reliability/docs/controlplane/#eks-architecture","title":"EKS Architecture","text":"<p>EKS architecture is designed to eliminate any single points of failure that may compromise the availability and durability of the Kubernetes control plane.</p> <p>The Kubernetes control plane managed by EKS runs inside an EKS managed VPC. The EKS control plane comprises the Kubernetes API server nodes, etcd cluster. Kubernetes API server nodes that run components like the API server, scheduler, and <code>kube-controller-manager</code> run in an auto-scaling group. EKS runs a minimum of two API server nodes in distinct Availability Zones (AZs) within in AWS region. Likewise, for durability, the etcd server nodes also run in an auto-scaling group that spans three AZs. EKS runs a NAT Gateway in each AZ, and API servers and etcd servers run in a private subnet. This architecture ensures that an event in a single AZ doesn\u2019t affect the EKS cluster's availability.</p> <p>When you create a new cluster, Amazon EKS creates a highly-available endpoint for the managed Kubernetes API server that you use to communicate with your cluster (using tools like <code>kubectl</code>). The managed endpoint uses NLB to load balance Kubernetes API servers. EKS also provisions two ENIs in different AZs to facilitate communication to your worker nodes.</p> <p></p> <p>You can configure whether your Kubernetes cluster\u2019s API server is reachable from the public internet (using the public endpoint) or through your VPC (using the EKS-managed ENIs) or both.</p> <p>Whether users and worker nodes connect to the API server using the public endpoint or the EKS-managed ENI, there are redundant paths for connection.</p>"},{"location":"reliability/docs/controlplane/#recommendations","title":"Recommendations","text":""},{"location":"reliability/docs/controlplane/#monitor-control-plane-metrics","title":"Monitor Control Plane Metrics","text":"<p>Monitoring Kubernetes API metrics can give you insights into control plane performance and identify issues. An unhealthy control plane can compromise the availability of the workloads running inside the cluster. For example, poorly written controllers can overload the API servers, affecting your application's availability.</p> <p>Kubernetes exposes control plane metrics at the  <code>/metrics</code> endpoint.</p> <p>You can view the metrics exposed using <code>kubectl</code>:</p> <pre><code>kubectl get --raw /metrics\n</code></pre> <p>These metrics are represented in a Prometheus text format.</p> <p>You can use Prometheus to collect and store these metrics. In May 2020, CloudWatch added support for monitoring Prometheus metrics in CloudWatch Container Insights. So you can also use Amazon CloudWatch to monitor the EKS control plane. You can use Tutorial for Adding a New Prometheus Scrape Target: Prometheus KPI Server Metrics to collect metrics and create CloudWatch dashboard to monitor your cluster\u2019s control plane.</p> <p>You can find Kubernetes API server metrics  here. For example, <code>apiserver_request_duration_seconds</code> can indicate how long API requests are taking to run.</p> <p>Consider monitoring these control plane metrics:</p>"},{"location":"reliability/docs/controlplane/#api-server","title":"API Server","text":"Metric Description <code>apiserver_request_total</code> Counter of apiserver requests broken out for each verb, dry run value, group, version, resource, scope, component, and HTTP response code. <code>apiserver_request_duration_seconds*</code> Response latency distribution in seconds for each verb, dry run value, group, version, resource, subresource, scope, and component. <code>apiserver_admission_controller_admission_duration_seconds</code> Admission controller latency histogram in seconds, identified by name and broken out for each operation and API resource and type (validate or admit). <code>apiserver_admission_webhook_rejection_count</code> Count of admission webhook rejections. Identified by name, operation, rejection_code, type (validating or admit), error_type (calling_webhook_error, apiserver_internal_error, no_error) <code>rest_client_request_duration_seconds</code> Request latency in seconds. Broken down by verb and URL. <code>rest_client_requests_total</code> Number of HTTP requests, partitioned by status code, method, and host."},{"location":"reliability/docs/controlplane/#etcd","title":"etcd","text":"Metric Description <code>etcd_request_duration_seconds</code> Etcd request latency in seconds for each operation and object type. <code>etcd_db_total_size_in_bytes</code> or <code>apiserver_storage_db_total_size_in_bytes</code> (starting with EKS v1.26) or <code>apiserver_storage_size_bytes</code> (starting with EKS v1.28) Etcd database size. <p>Consider using the Kubernetes Monitoring Overview Dashboard to visualize and monitor Kubernetes API server requests and latency and etcd latency metrics.</p> <p>The following Prometheus query can be used to monitor the current size of etcd. The query assumes there is job called <code>kube-apiserver</code> for scraping metrics from API metrics endpoint and the EKS version is below v1.26. </p> <pre><code>max(etcd_db_total_size_in_bytes{job=\"kube-apiserver\"} / (8 * 1024 * 1024 * 1024))\n</code></pre> <p>Attention</p> <p>When the database size limit is exceeded, etcd emits a no space alarm and stops taking further write requests. In other words, the cluster becomes read-only, and all requests to mutate objects such as creating new pods, scaling deployments, etc., will be rejected by the cluster\u2019s API server.</p>"},{"location":"reliability/docs/controlplane/#cluster-authentication","title":"Cluster Authentication","text":"<p>EKS currently supports two types of authentication: bearer/service account tokens and IAM authentication which uses webhook token authentication. When users call the Kubernetes API, a webhook passes an authentication token included in the request to IAM. The token, a base 64 signed URL, is generated by the AWS Command Line Interface (AWS CLI).</p> <p>The IAM user or role that creates the EKS Cluster automatically gets full access to the cluster. You can manage access to the EKS cluster by editing the <code>aws-auth</code> configmap.</p> <p>If you misconfigure the <code>aws-auth</code> configmap and lose access to the cluster, you can still use the cluster creator\u2019s user or role to access your EKS cluster.</p> <p>In the unlikely event that you cannot use the IAM service in the AWS region, you can also use the Kubernetes service account\u2019s bearer token to manage the cluster.</p> <p>Create a \u201csuper-admin\u201d account that is permitted to perform all actions in the cluster:</p> <pre><code>kubectl -n kube-system create serviceaccount super-admin\n</code></pre> <p>Create a role binding that gives super-admin cluster-admin role:</p> <pre><code>kubectl create clusterrolebinding super-admin-rb --clusterrole=cluster-admin --serviceaccount=kube-system:super-admin\n</code></pre> <p>Get service account\u2019s secret:</p> <pre><code>SECRET_NAME=`kubectl -n kube-system get serviceaccount/super-admin -o jsonpath='{.secrets[0].name}'`\n</code></pre> <p>Get token associated with the secret:</p> <pre><code>TOKEN=`kubectl -n kube-system get secret $SECRET_NAME -o jsonpath='{.data.token}'| base64 --decode`\n</code></pre> <p>Add service account and token to <code>kubeconfig</code>:</p> <pre><code>kubectl config set-credentials super-admin --token=$TOKEN\n</code></pre> <p>Set the current-context in <code>kubeconfig</code> to use super-admin account:</p> <pre><code>kubectl config set-context --current --user=super-admin\n</code></pre> <p>Final <code>kubeconfig</code> should look like this:</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data:&lt;REDACTED&gt;\n    server: https://&lt;CLUSTER&gt;.gr7.us-west-2.eks.amazonaws.com\n  name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\ncontexts:\n- context:\n    cluster: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\n    user: super-admin\n  name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\ncurrent-context: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\nkind: Config\npreferences: {}\nusers:\n#- name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\n#  user:\n#    exec:\n#      apiVersion: client.authentication.k8s.io/v1alpha1\n#      args:\n#      - --region\n#      - us-west-2\n#      - eks\n#      - get-token\n#      - --cluster-name\n#      - &lt;&lt;cluster name&gt;&gt;\n#      command: aws\n#      env: null\n- name: super-admin\n  user:\n    token: &lt;&lt;super-admin sa\u2019s secret&gt;&gt;\n</code></pre>"},{"location":"reliability/docs/controlplane/#admission-webhooks","title":"Admission Webhooks","text":"<p>Kubernetes has two types of admission webhooks: validating admission webhooks and mutating admission webhooks. These allow a user to extend the kubernetes API and validate or mutate objects before they are accepted by the API. Poor configurations of these webhooks can distabilize the EKS control plane by blocking cluster critical operations.</p> <p>In order to avoid impacting cluster critical operations either avoid setting \"catch-all\" webhooks like the following:</p> <pre><code>- name: \"pod-policy.example.com\"\n  rules:\n  - apiGroups:   [\"*\"]\n    apiVersions: [\"*\"]\n    operations:  [\"*\"]\n    resources:   [\"*\"]\n    scope: \"*\"\n</code></pre> <p>Or make sure the webhook has a fail open policy with a timeout shorter than 30 seconds to ensure that if your webhook is unavailable it will not impair cluster critical workloads.</p>"},{"location":"reliability/docs/controlplane/#block-pods-with-unsafe-sysctls","title":"Block Pods with unsafe <code>sysctls</code>","text":"<p><code>Sysctl</code> is a Linux utility that allows users to modify kernel parameters during runtime. These kernel parameters control various aspects of the operating system's behavior, such as network, file system, virtual memory, and process management.</p> <p>Kubernetes allows assigning <code>sysctl</code> profiles for Pods. Kubernetes categorizes <code>systcls</code> as safe and unsafe. Safe <code>sysctls</code> are namespaced in the container or Pod, and setting them doesn\u2019t impact other Pods on the node or the node itself. In contrast, unsafe sysctls are disabled by default since they can potentially disrupt other Pods or make the node unstable.</p> <p>As unsafe <code>sysctls</code> are disabled by default, the kubelet will not create a Pod with unsafe <code>sysctl</code> profile. If you create such a Pod, the scheduler will repeatedly assign such Pods to nodes, while the node fails to launch it. This infinite loop ultimately strains the cluster control plane, making the cluster unstable.</p> <p>Consider using OPA Gatekeeper or Kyverno to reject  Pods with unsafe <code>sysctls</code>.</p>"},{"location":"reliability/docs/controlplane/#handling-cluster-upgrades","title":"Handling Cluster Upgrades","text":"<p>Since April 2021, Kubernetes release cycle has been changed from four releases a year (once a quarter) to three releases a year. A new minor version (like 1.21 or 1.22) is released approximately every fifteen weeks. Starting with Kubernetes 1.19, each minor version is supported for approximately twelve months after it's first released. With the advent of Kubernetes v1.28, the compatibility skew between the control plane and worker nodes has expanded from n-2 to n-3 minor versions. To learn more, see Best Practices for Cluster Upgrades.</p>"},{"location":"reliability/docs/controlplane/#running-large-clusters","title":"Running large clusters","text":"<p>EKS actively monitors the load on control plane instances and automatically scales them to ensure high performance. However, you should account for potential performance issues and limits within Kubernetes and quotas in AWS services when running large clusters.</p> <ul> <li>Clusters with more than 1000 services may experience network latency with using <code>kube-proxy</code> in <code>iptables</code> mode according to the tests performed by the ProjectCalico team. The solution is to switch to running <code>kube-proxy</code> in <code>ipvs</code> mode.</li> <li>You may also experience EC2 API request throttling if the CNI needs to request IP addresses for Pods or if you need to create new EC2 instances frequently. You can reduce calls EC2 API by configuring the CNI to cache IP addresses. You can use larger EC2 instance types to reduce EC2 scaling events.</li> </ul>"},{"location":"reliability/docs/controlplane/#additional-resources","title":"Additional Resources:","text":"<ul> <li>De-mystifying cluster networking for Amazon EKS worker nodes</li> <li>Amazon EKS cluster endpoint access control</li> <li>AWS re:Invent 2019: Amazon EKS under the hood (CON421-R1)</li> </ul>"},{"location":"reliability/docs/dataplane/","title":"EKS Data Plane","text":"<p>To operate high-available and resilient applications, you need a highly-available and resilient data plane. An elastic data plane ensures that Kubernetes can scale and heal your applications automatically. A resilient data plane consists of two or more worker nodes, can grow and shrink with the workload, and automatically recover from failures.</p> <p>You have two choices for worker nodes with EKS: EC2 instances and Fargate. If you choose EC2 instances, you can manage the worker nodes yourself or use EKS managed node groups. You can have a cluster with a mix of managed, self-managed worker nodes, and Fargate. </p> <p>EKS on Fargate offers the easiest path to a resilient data plane. Fargate runs each Pod in an isolated compute environment. Each Pod running on Fargate gets its own worker node. Fargate automatically scales the data plane as Kubernetes scales pods. You can scale both the data plane and your workload by using the horizontal pod autoscaler.</p> <p>The preferred way to scale EC2 worker nodes is by using Kubernetes Cluster Autoscaler, EC2 Auto Scaling groups or community projects like Atlassian\u2019s Escalator.</p>"},{"location":"reliability/docs/dataplane/#recommendations","title":"Recommendations","text":""},{"location":"reliability/docs/dataplane/#use-ec2-auto-scaling-groups-to-create-worker-nodes","title":"Use EC2 Auto Scaling Groups to create worker nodes","text":"<p>It is a best practice to create worker nodes using EC2 Auto Scaling groups instead of creating individual EC2 instances and joining them to the cluster. Auto Scaling Groups will automatically replace any terminated or failed nodes ensuring that the cluster always has the capacity to run your workload. </p>"},{"location":"reliability/docs/dataplane/#use-kubernetes-cluster-autoscaler-to-scale-nodes","title":"Use Kubernetes Cluster Autoscaler to scale nodes","text":"<p>Cluster Autoscaler adjusts the size of the data plane when there are pods that cannot be run because the cluster has insufficient resources, and adding another worker node would help. Although Cluster Autoscaler is a reactive process, it waits until pods are in Pending state due to insufficient capacity in the cluster. When such an event occurs, it adds EC2 instances to the cluster. Whenever the cluster runs out of capacity, new replicas - or new pods - will be unavailable (in Pending state) until worker nodes are added. This delay may impact your applications' reliability if the data plane cannot scale fast enough to meet the demands of the workload. If a worker node is consistently underutilized and all of its pods can be scheduled on other worker nodes, Cluster Autoscaler terminates it.</p>"},{"location":"reliability/docs/dataplane/#configure-over-provisioning-with-cluster-autoscaler","title":"Configure over-provisioning with Cluster Autoscaler","text":"<p>Cluster Autoscaler triggers a scale-up of the data-plane when Pods in the cluster are already Pending. Hence, there may be a delay between the time your application needs more replicas, and when it, in fact, gets more replicas. An option to account for this possible delay is through adding more than required replicas, inflating the number of replicas for the application. </p> <p>Another pattern that Cluster Autoscaler recommends uses pause Pods and the Priority Preemption feature. The pause Pod runs a pause container, which as the name suggests, does nothing but acts as a placeholder for compute capacity that can be used by other Pods in your cluster. Because it runs with a very low assigned priority, the pause Pod gets evicted from the node when another Pod needs to be created, and the cluster doesn\u2019t have available capacity. The Kubernetes Scheduler notices the eviction of the pause Pod and tries to reschedule it. But since the cluster is running at capacity, the pause Pod remains Pending, to which the Cluster Autoscaler reacts by adding nodes. </p> <p>A Helm chart is available to install cluster overprovisioner.</p>"},{"location":"reliability/docs/dataplane/#using-cluster-autoscaler-with-multiple-auto-scaling-groups","title":"Using Cluster Autoscaler with multiple Auto Scaling Groups","text":"<p>Run the Cluster Autoscaler with the <code>--node-group-auto-discovery</code> flag enabled. Doing so will allow the Cluster Autoscaler to find all autoscaling groups that include a particular defined tag and prevents the need to define and maintain each autoscaling group in the manifest.</p>"},{"location":"reliability/docs/dataplane/#using-cluster-autoscaler-with-local-storage","title":"Using Cluster Autoscaler with local storage","text":"<p>By default, the Cluster Autoscaler does not scale-down nodes that have pods deployed with local storage attached. Set the <code>--skip-nodes-with-local-storage</code> flag to false to allow Cluster Autoscaler to scale-down these nodes.</p>"},{"location":"reliability/docs/dataplane/#spread-worker-nodes-and-workload-across-multiple-azs","title":"Spread worker nodes and workload across multiple AZs","text":"<p>You can protect your workloads from failures in an individual AZ by running worker nodes and pods in multiple AZs. You can control the AZ the worker nodes are created in using the subnets you create the nodes in.</p> <p>If you are using Kubernetes 1.18+, the recommended method for spreading pods across AZs is to use Topology Spread Constraints for Pods.</p> <p>The deployment below spreads pods across AZs if possible, letting those pods run anyway if not:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-server\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      topologySpreadConstraints:\n        - maxSkew: 1\n          whenUnsatisfiable: ScheduleAnyway\n          topologyKey: topology.kubernetes.io/zone\n          labelSelector:\n            matchLabels:\n              app: web-server\n      containers:\n      - name: web-app\n        image: nginx\n        resources:\n          requests:\n            cpu: 1\n</code></pre> <p>Note</p> <p><code>kube-scheduler</code> is only aware of topology domains via nodes that exist with those labels.  If the above deployment is deployed to a cluster with nodes only in a single zone, all of the pods will schedule on those nodes as <code>kube-scheduler</code> isn't aware of the other zones.  For this topology spread to work as expected with the scheduler, nodes must already exist in all zones.  This issue will be resolved in Kubernetes 1.24 with the addition of the <code>MinDomainsInPodToplogySpread</code> feature gate which allows specifying a <code>minDomains</code> property to inform the scheduler of the number of eligible domains.</p> <p>Warning</p> <p>Setting <code>whenUnsatisfiable</code> to <code>DoNotSchedule</code> will cause pods to be unschedulable if the topology spread constraint can't be fulfilled.  It should only be set if its preferable for pods to not run instead of violating the topology spread constraint.</p> <p>On older versions of Kubernetes, you can use pod anti-affinity rules to schedule pods across multiple AZs. The manifest below informs Kubernetes scheduler to prefer scheduling pods in distinct AZs. </p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-server\n  labels:\n    app: web-server\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      affinity:\n        podAntiAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: failure-domain.beta.kubernetes.io/zone\n            weight: 100\n      containers:\n      - name: web-app\n        image: nginx\n</code></pre> <p>Warning</p> <p>Do not require that pods be scheduled across distinct AZs otherwise, the number of pods in a deployment will never exceed the number of AZs. </p>"},{"location":"reliability/docs/dataplane/#ensure-capacity-in-each-az-when-using-ebs-volumes","title":"Ensure capacity in each AZ when using EBS volumes","text":"<p>If you use Amazon EBS to provide Persistent Volumes, then you need to ensure that the pods and associated EBS volume are located in the same AZ. At the time of writing, EBS volumes are only available within a single AZ. A Pod cannot access EBS-backed persistent volumes located in a different AZ. Kubernetes scheduler knows which AZ a worker node is located in. Kubernetes will always schedule a Pod that requires an EBS volume in the same AZ as the volume. However, if there are no worker nodes available in the AZ where the volume is located, then the Pod cannot be scheduled. </p> <p>Create Auto Scaling Group for each AZ with enough capacity to ensure that the cluster always has capacity to schedule pods in the same AZ as the EBS volumes they need. In addition, you should enable the <code>--balance-similar-node-groups</code> feature in Cluster Autoscaler.</p> <p>If you are running an application that uses EBS volume but has no requirements to be highly available, then you can restrict the deployment of the application to a single AZ. In EKS, worker nodes are automatically added <code>failure-domain.beta.kubernetes.io/zone</code> label, which contains the name of the AZ. You can see the labels attached to your nodes by running <code>kubectl get nodes --show-labels</code>. More information about built-in node labels is available here. You can use node selectors to schedule a pod in a particular AZ. </p> <p>In the example below, the pod will only be scheduled in <code>us-west-2c</code> AZ:</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: single-az-pod\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: failure-domain.beta.kubernetes.io/zone\n            operator: In\n            values:\n            - us-west-2c\n  containers:\n  - name: single-az-container\n    image: kubernetes/pause\n</code></pre> <p>Persistent volumes (backed by EBS) are also automatically labeled with the name of AZ; you can see which AZ your persistent volume belongs to by running <code>kubectl get pv -L topology.ebs.csi.aws.com/zone</code>. When a pod is created and claims a volume, Kubernetes will schedule the Pod on a node in the same AZ as the volume. </p> <p>Consider this scenario; you have an EKS cluster with one node group. This node group has three worker nodes spread across three AZs. You have an application that uses an EBS-backed Persistent Volume. When you create this application and the corresponding volume, its Pod gets created in the first of the three AZs. Then, the worker node that runs this Pod becomes unhealthy and subsequently unavailable for use. Cluster Autoscaler will replace the unhealthy node with a new worker node; however, because the autoscaling group spans across three AZs, the new worker node may get launched in the second or the third AZ, but not in the first AZ as the situation demands. As the AZ-constrained EBS volume only exists in the first AZ, but there are no worker nodes available in that AZ, the Pod cannot be scheduled. Therefore, you should create one node group in each AZ, so there is always enough capacity available to run pods that cannot be scheduled in other AZs. </p> <p>Alternatively, EFS can simplify cluster autoscaling when running applications that need persistent storage. Clients can access EFS file systems concurrently from all the AZs in the region. Even if a Pod using EFS-backed Persistent Volume gets terminated and gets scheduled in different AZ, it will be able to mount the volume.</p>"},{"location":"reliability/docs/dataplane/#run-node-problem-detector","title":"Run node-problem-detector","text":"<p>Failures in worker nodes can impact the availability of your applications. node-problem-detector is a Kubernetes add-on that you can install in your cluster to detect worker node issues. You can use a npd\u2019s remedy system to drain and terminate the node automatically.</p>"},{"location":"reliability/docs/dataplane/#reserving-resources-for-system-and-kubernetes-daemons","title":"Reserving resources for system and Kubernetes daemons","text":"<p>You can improve worker nodes' stability by reserving compute capacity for the operating system and Kubernetes daemons. Pods  - especially ones without <code>limits</code> declared - can saturate system resources putting nodes in a situation where operating system processes and Kubernetes daemons (<code>kubelet</code>, container runtime, etc.) compete with pods for system resources. You can use <code>kubelet</code> flags <code>--system-reserved</code> and <code>--kube-reserved</code> to reserve resources for system process (<code>udev</code>, <code>sshd</code>, etc.) and Kubernetes daemons respectively. </p> <p>If you use the EKS-optimized Linux AMI, the CPU, memory, and storage are reserved for the system and Kubernetes daemons by default. When worker nodes based on this AMI launch, EC2 user-data is configured to trigger the <code>bootstrap.sh</code> script. This script calculates CPU and memory reservations based on the number of CPU cores and total memory available on the EC2 instance. The calculated values are written to the <code>KubeletConfiguration</code> file located at <code>/etc/kubernetes/kubelet/kubelet-config.json</code>. </p> <p>You may need to increase the system resource reservation if you run custom daemons on the node and the amount of CPU and memory reserved by default is insufficient. </p> <p><code>eksctl</code> offers the easiest way to customize resource reservation for system and Kubernetes daemons. </p>"},{"location":"reliability/docs/dataplane/#implement-qos","title":"Implement QoS","text":"<p>For critical applications, consider defining <code>requests</code>=<code>limits</code> for the container in the Pod. This will ensure that the container will not be killed if another Pod requests resources.</p> <p>It is a best practice to implement CPU and memory limits for all containers as it prevents a container inadvertently consuming system resources impacting the availability of other co-located processes.</p>"},{"location":"reliability/docs/dataplane/#configure-and-size-resource-requestslimits-for-all-workloads","title":"Configure and Size Resource Requests/Limits for all Workloads","text":"<p>Some general guidance can be applied to sizing resource requests and limits for workloads:</p> <ul> <li> <p>Do not specify resource limits on CPU.  In the absence of limits, the request acts as a weight on how much relative CPU time containers get. This allows your workloads to use the full CPU without an artificial limit or starvation.</p> </li> <li> <p>For non-CPU resources, configuring <code>requests</code>=<code>limits</code> provides the most predictable behavior. If <code>requests</code>!=<code>limits</code>, the container also has its QOS reduced from Guaranteed to Burstable making it more likely to be evicted in the event of node pressure.</p> </li> <li> <p>For non-CPU resources, do not specify a limit that is much larger than the request.  The larger <code>limits</code> are configured relative to <code>requests</code>, the more likely nodes will be overcommitted leading to high chances of workload interruption.</p> </li> <li> <p>Correctly sized requests are particularly important when using a node auto-scaling solution like Karpenter or Cluster AutoScaler.  These tools look at your workload requests to determine the number and size of nodes to be provisioned. If your requests are too small with larger limits, you may find your workloads evicted or OOM killed if they have been tightly packed on a node.</p> </li> </ul> <p>Determining resource requests can be difficult, but tools like the Vertical Pod Autoscaler can help you 'right-size' the requests by observing container resource usage at runtime.  Other tools that may be useful for determining request sizes include:</p> <ul> <li>Goldilocks</li> <li>Parca</li> <li>Prodfiler</li> <li>rsg</li> </ul>"},{"location":"reliability/docs/dataplane/#configure-resource-quotas-for-namespaces","title":"Configure resource quotas for namespaces","text":"<p>Namespaces are intended for use in environments with many users spread across multiple teams, or projects. They provide a scope for names and are a way to divide cluster resources between multiple teams, projects, workloads. You can limit the aggregate resource consumption in a namespace. The <code>ResourceQuota</code> object can limit the quantity of objects that can be created in a namespace by type, as well as the total amount of compute resources that may be consumed by resources in that project. You can limit the total sum of storage and/or compute (CPU and memory) resources that can be requested in a given namespace.</p> <p>If resource quota is enabled for a namespace for compute resources like CPU and memory, users must specify requests or limits for each container in that namespace.</p> <p>Consider configuring quotas for each namespace. Consider using <code>LimitRanges</code> to automatically apply preconfigured limits to containers within a namespaces. </p>"},{"location":"reliability/docs/dataplane/#limit-container-resource-usage-within-a-namespace","title":"Limit container resource usage within a namespace","text":"<p>Resource Quotas help limit the amount of resources a namespace can use. The <code>LimitRange</code> object can help you implement minimum and maximum resources a container can request. Using <code>LimitRange</code> you can set a default request and limits for containers, which is helpful if setting compute resource limits is not a standard practice in your organization. As the name suggests, <code>LimitRange</code> can enforce minimum and maximum compute resources usage per Pod or Container in a namespace. As well as, enforce minimum and maximum storage request per PersistentVolumeClaim in a namespace.</p> <p>Consider using <code>LimitRange</code> in conjunction with <code>ResourceQuota</code> to enforce limits at a container as well as namespace level. Setting these limits will ensure that a container or a namespace does not impinge on resources used by other tenants in the cluster. </p>"},{"location":"reliability/docs/dataplane/#coredns","title":"CoreDNS","text":"<p>CoreDNS fulfills name resolution and service discovery functions in Kubernetes. It is installed by default on EKS clusters. For interoperability, the Kubernetes Service for CoreDNS is still named kube-dns. CoreDNS Pods run as part of a Deployment in <code>kube-system</code> namespace, and in EKS, by default, it runs two replicas with declared requests and limits. DNS queries are sent to the <code>kube-dns</code> Service that runs in the <code>kube-system</code> Namespace.</p>"},{"location":"reliability/docs/dataplane/#recommendations_1","title":"Recommendations","text":""},{"location":"reliability/docs/dataplane/#monitor-coredns-metrics","title":"Monitor CoreDNS metrics","text":"<p>CoreDNS has built in support for Prometheus. You should especially consider monitoring CoreDNS latency (<code>coredns_dns_request_duration_seconds_sum</code>, before 1.7.0 version the metric was called <code>core_dns_response_rcode_count_total</code>), errors (<code>coredns_dns_responses_total</code>, NXDOMAIN, SERVFAIL, FormErr) and CoreDNS Pod\u2019s memory consumption.</p> <p>For troubleshooting purposes, you can use kubectl to view CoreDNS logs:</p> <pre><code>for p in $(kubectl get pods -n kube-system -l k8s-app=kube-dns -o jsonpath='{.items[*].metadata.name}'); do kubectl logs $p -n kube-system; done\n</code></pre>"},{"location":"reliability/docs/dataplane/#use-nodelocal-dnscache","title":"Use NodeLocal DNSCache","text":"<p>You can improve the Cluster DNS performance by running NodeLocal DNSCache. This feature runs a DNS caching agent on cluster nodes as a DaemonSet. All the pods use the DNS caching agent running on the node for name resolution instead of using <code>kube-dns</code> Service.</p>"},{"location":"reliability/docs/dataplane/#configure-cluster-proportional-scaler-for-coredns","title":"Configure cluster-proportional-scaler for CoreDNS","text":"<p>Another method of improving Cluster DNS performance is by automatically horizontally scaling the CoreDNS Deployment based on the number of nodes and CPU cores in the cluster. Horizontal cluster-proportional-autoscaler is a container that resizes the number of replicas of a Deployment based on the size of the schedulable data-plane.</p> <p>Nodes and the aggregate of CPU cores in the nodes are the two metrics with which you can scale CoreDNS. You can use both metrics simultaneously. If you use larger nodes, CoreDNS scaling is based on the number of CPU cores. Whereas, if you use smaller nodes, the number of CoreDNS replicas depends on the  CPU cores in your data-plane. Proportional autoscaler configuration looks like this:</p> <pre><code>linear: '{\"coresPerReplica\":256,\"min\":1,\"nodesPerReplica\":16}'\n</code></pre>"},{"location":"reliability/docs/dataplane/#choosing-an-ami-with-node-group","title":"Choosing an AMI with Node Group","text":"<p>EKS provides optimized EC2 AMIs that are used by customers to create both self-managed and managed nodegroups. These AMIs are published in every region for every supported Kubernetes version. EKS marks these AMIs as deprecated when any CVEs or bugs are discovered. Hence, the recommendation is not to consume deprecated AMIs while choosing an AMI for the node group.</p> <p>Deprecated AMIs can be filtered using Ec2 describe-images api using below command:</p> <pre><code>aws ec2 describe-images --image-id ami-0d551c4f633e7679c --no-include-deprecated\n</code></pre> <p>You can also recognize a deprecated AMI by verifying if the describe-image output contains a DeprecationTime as a field. For ex:</p> <pre><code>aws ec2 describe-images --image-id ami-xxx --no-include-deprecated\n{\n    \"Images\": [\n        {\n            \"Architecture\": \"x86_64\",\n            \"CreationDate\": \"2022-07-13T15:54:06.000Z\",\n            \"ImageId\": \"ami-xxx\",\n            \"ImageLocation\": \"123456789012/eks_xxx\",\n            \"ImageType\": \"machine\",\n            \"Public\": false,\n            \"OwnerId\": \"123456789012\",\n            \"PlatformDetails\": \"Linux/UNIX\",\n            \"UsageOperation\": \"RunInstances\",\n            \"State\": \"available\",\n            \"BlockDeviceMappings\": [\n                {\n                    \"DeviceName\": \"/dev/xvda\",\n                    \"Ebs\": {\n                        \"DeleteOnTermination\": true,\n                        \"SnapshotId\": \"snap-0993a2fc4bbf4f7f4\",\n                        \"VolumeSize\": 20,\n                        \"VolumeType\": \"gp2\",\n                        \"Encrypted\": false\n                    }\n                }\n            ],\n            \"Description\": \"EKS Kubernetes Worker AMI with AmazonLinux2 image, (k8s: 1.19.15, docker: 20.10.13-2.amzn2, containerd: 1.4.13-3.amzn2)\",\n            \"EnaSupport\": true,\n            \"Hypervisor\": \"xen\",\n            \"Name\": \"aws_eks_optimized_xxx\",\n            \"RootDeviceName\": \"/dev/xvda\",\n            \"RootDeviceType\": \"ebs\",\n            \"SriovNetSupport\": \"simple\",\n            \"VirtualizationType\": \"hvm\",\n            \"DeprecationTime\": \"2023-02-09T19:41:00.000Z\"\n        }\n    ]\n}\n</code></pre>"},{"location":"scalability/docs/","title":"EKS Scalability best practices","text":"<p>This guide provides advice for scaling EKS clusters. The goal of scaling an EKS cluster is to maximize the amount of work a single cluster can perform. Using a single, large EKS cluster can reduce operational load compared to using multiple clusters, but it has trade-offs for things like multi-region deployments, tenant isolation, and cluster upgrades. In this document we will focus on how to achieve maximum scalability with a single cluster.</p>"},{"location":"scalability/docs/#how-to-use-this-guide","title":"How to use this guide","text":"<p>This guide is meant for developers and administrators responsible for creating and managing EKS clusters in AWS. It focuses on some generic Kubernetes scaling practices, but it does not have specifics for self-managed Kubernetes clusters or clusters that run outside of an AWS region with EKS Anywhere.</p> <p>Each topic has a brief overview, followed by recommendations and best practices for operating EKS clusters at scale. Topics do not need to be read in a particular order and recommendations should not be applied without testing and verifying they work in your clusters.</p>"},{"location":"scalability/docs/#understanding-scaling-dimensions","title":"Understanding scaling dimensions","text":"<p>Scalability is different from performance and reliability, and all three should be considered when planning your cluster and workload needs. As clusters scale, they need to be monitored, but this guide will not cover monitoring best practices. EKS can scale to large sizes, but you will need to plan how you are going to scale a cluster beyond 300 nodes or 5000 pods. These are not absolute numbers, but they come from collaborating this guide with multiple users, engineers, and support professionals.</p> <p>Scaling in Kubernetes is multi-dimensional and there are no specific settings or recommendations that work in every situation. The main areas areas where we can provide guidance for scaling include:</p> <ul> <li>Kubernetes Control Plane</li> <li>Kubernetes Data Plane</li> <li>Cluster Services</li> <li>Workloads</li> </ul> <p>Kubernetes Control Plane in an EKS cluster includes all of the services AWS runs and scales for you automatically (e.g. Kubernetes API server). Scaling the Control Plane is AWS's responsibility, but using the Control Plane responsibly is your responsibility.</p> <p>Kubernetes Data Plane scaling deals with AWS resources that are required for your cluster and workloads, but they are outside of the EKS Control Plane. Resources including EC2 instances, kubelet, and storage all need to be scaled as your cluster scales.</p> <p>Cluster services are Kubernetes controllers and applications that run inside the cluster and provide functionality for your cluster and workloads. These can be EKS Add-ons and also other services or Helm charts you install for compliance and integrations. These services are often depended on by workloads and as your workloads scale your cluster services will need to scale with them.</p> <p>Workloads are the reason you have a cluster and should scale horizontally with the cluster. There are integrations and settings that workloads have in Kubernetes that can help the cluster scale. There are also architectural considerations with Kubernetes abstractions such as namespaces and services.</p>"},{"location":"scalability/docs/#extra-large-scaling","title":"Extra large scaling","text":"<p>If you are scaling a single cluster beyond 1000 nodes or 50,000 pods we would love to talk to you. We recommend reaching out to your support team or technical account manager to get in touch with specialists who can help you plan and scale beyond the information provided in this guide.</p>"},{"location":"scalability/docs/cluster-services/","title":"Cluster Services","text":"<p>Cluster services run inside an EKS cluster, but they are not user workloads. If you have a Linux server you often need to run services like NTP, syslog, and a container runtime to support your workloads. Cluster services are similar, supporting services that help you automate and operate your cluster. In Kubernetes these are usually run in the kube-system namespace and some are run as DaemonSets.</p> <p>Cluster services are expected to have a high up-time and are often critical during outages and for troubleshooting. If a core cluster service is not available you may lose access to data that can help recover or prevent an outage (e.g. high disk utilization). They should run on dedicated compute instances such as a separate node group or AWS Fargate. This will ensure that the cluster services are not impacted on shared instances by workloads that may be scaling up or using more resources.</p>"},{"location":"scalability/docs/cluster-services/#scale-coredns","title":"Scale CoreDNS","text":"<p>Scaling CoreDNS has two primary mechanisms. Reducing the number of calls to the CoreDNS service and increasing the number of replicas.</p>"},{"location":"scalability/docs/cluster-services/#reduce-external-queries-by-lowering-ndots","title":"Reduce external queries by lowering ndots","text":"<p>The ndots setting specifies how many periods (a.k.a. \"dots\") in a domain name are considered enough to avoid querying DNS. If your application has an ndots setting of 5 (default) and you request resources from an external domain such as api.example.com (2 dots) then CoreDNS will be queried for each search domain defined in /etc/resolv.conf for a more specific domain. By default the following domains will be searched before making an external request.</p> <pre><code>api.example.&lt;namespace&gt;.svc.cluster.local\napi.example.svc.cluster.local\napi.example.cluster.local\napi.example.&lt;region&gt;.compute.internal\n</code></pre> <p>The <code>namespace</code> and <code>region</code> values will be replaced with your workloads namespace and your compute region. You may have additional search domains based on your cluster settings.</p> <p>You can reduce the number of requests to CoreDNS by lowering the ndots option of your workload or fully qualifying your domain requests by including a trailing . (e.g. <code>api.example.com.</code> ). If your workload connects to external services via DNS we recommend setting ndots to 2 so workloads do not make unnecessary, cluster DNS queries inside the cluster. You can set a different DNS server and search domain if the workload doesn\u2019t require access to services inside the cluster.</p> <pre><code>spec:\n  dnsPolicy: \"None\"\n  dnsConfig:\n    options:\n      - name: ndots\n        value: \"2\"\n      - name: edns0\n</code></pre> <p>If you lower ndots to a value that is too low or the domains you are connecting to do not include enough specificity (including trailing .) then it is possible DNS lookups will fail. Make sure you test how this setting will impact your workloads.</p>"},{"location":"scalability/docs/cluster-services/#scale-coredns-horizontally","title":"Scale CoreDNS Horizontally","text":"<p>CoreDNS instances can scale by adding additional replicas to the deployment. It's recommended you use NodeLocal DNS or the cluster proportional autoscaler to scale CoreDNS.</p> <p>NodeLocal DNS will require run one instance per node\u2014as a DaemonSet\u2014which requires more compute resources in the cluster, but it will avoid failed DNS requests and decrease the response time for DNS queries in the cluster. The cluster proportional autoscaler will scale CoreDNS based on the number of nodes or cores in the cluster. This isn\u2019t a direct correlation to request queries, but can be useful depending on your workloads and cluster size. The default proportional scale is to add an additional replica for every 256 cores or 16 nodes in the cluster\u2014whichever happens first.</p>"},{"location":"scalability/docs/cluster-services/#scale-kubernetes-metrics-server-vertically","title":"Scale Kubernetes Metrics Server Vertically","text":"<p>The Kubernetes Metrics Server supports horizontal and vertical scaling. By horizontally scaling the Metrics Server it will be highly available, but it will not scale horizontally to handle more cluster metrics. You will need to vertically scale the Metrics Server based on their recommendations as nodes and collected metrics are added to the cluster.</p> <p>The Metrics Server keeps the data it collects, aggregates, and serves in memory. As a cluster grows, the amount of data the Metrics Server stores increases. In large clusters the Metrics Server will require more compute resources than the memory and CPU reservation specified in the default installation. You can use the Vertical Pod Autoscaler (VPA) or Addon Resizer to scale the Metrics Server. The Addon Resizer scales vertically in proportion to worker nodes and VPA scales based on CPU and memory usage.</p>"},{"location":"scalability/docs/cluster-services/#coredns-lameduck-duration","title":"CoreDNS lameduck duration","text":"<p>Pods use the <code>kube-dns</code> Service for name resolution. Kubernetes uses destination NAT (DNAT) to redirect <code>kube-dns</code> traffic from nodes to CoreDNS backend pods. As you scale the CoreDNS Deployment, <code>kube-proxy</code> updates iptables rules and chains on nodes to redirect DNS traffic to CoreDNS pods. Propagating new endpoints when you scale up and deleting rules when you scale down CoreDNS can take between 1 to 10 seconds depending on the size of the cluster. </p> <p>This propagation delay can cause DNS lookup failures when a CoreDNS pod gets terminated yet the node\u2019s iptables rules haven\u2019t been updated. In this scenario, the node may continue to send DNS queries to a terminated CoreDNS Pod. </p> <p>You can reduce DNS lookup failures by setting a lameduck duration in your CoreDNS pods. While in lameduck mode, CoreDNS will continue to respond to in-flight requests. Setting a lameduck duration will delay the CoreDNS shutdown process, allowing nodes the time they need to update their iptables rules and chains. </p> <p>We recommend setting CoreDNS lameduck duration to 30 seconds. </p>"},{"location":"scalability/docs/cluster-services/#coredns-readiness-probe","title":"CoreDNS readiness probe","text":"<p>We recommend using <code>/ready</code> instead of <code>/health</code> for CoreDNS's readiness probe.</p> <p>In alignment with the earlier recommendation to set the lameduck duration to 30 seconds, providing ample time for the node's iptables rules to be updated before pod termination, employing <code>/ready</code> instead of <code>/health</code> for the CoreDNS readiness probe ensures that the CoreDNS pod is fully prepared at startup to promptly respond to DNS requests.</p> <pre><code>readinessProbe:\n  httpGet:\n    path: /ready\n    port: 8181\n    scheme: HTTP\n</code></pre> <p>For more information about the CoreDNS Ready plugin please refer to https://coredns.io/plugins/ready/</p>"},{"location":"scalability/docs/cluster-services/#logging-and-monitoring-agents","title":"Logging and monitoring agents","text":"<p>Logging and monitoring agents can add significant load to your cluster control plane because the agents query the API server to enrich logs and metrics with workload metadata. The agent on a node only has access to the local node resources to see things like container and process name. Querying the API server it can add more details such as Kubernetes deployment name and labels. This can be extremely helpful for troubleshooting but detrimental to scaling.</p> <p>Because there are so many different options for logging and monitoring we cannot show examples for every provider. With fluentbit we recommend enabling Use_Kubelet to fetch metadata from the local kubelet instead of the Kubernetes API Server and set <code>Kube_Meta_Cache_TTL</code> to a number that reduces repeated calls when data can be cached (e.g. 60).</p> <p>Scaling monitoring and logging has two general options:</p> <ul> <li>Disable integrations</li> <li>Sampling and filtering</li> </ul> <p>Disabling integrations is often not an option because you lose log metadata. This eliminates the API scaling problem, but it will introduce other issues by not having the required metadata when needed.</p> <p>Sampling and filtering reduces the number of metrics and logs that are collected. This will lower the amount of requests to the Kubernetes API, and it will reduce the amount of storage needed for the metrics and logs that are collected. Reducing the storage costs will lower the cost for the overall system.</p> <p>The ability to configure sampling depends on the agent software and can be implemented at different points of ingestion. It\u2019s important to add sampling as close to the agent as possible because that is likely where the API server calls happen. Contact your provider to find out more about sampling support.</p> <p>If you are using CloudWatch and CloudWatch Logs you can add agent filtering using patterns described in the documentation.</p> <p>To avoid losing logs and metrics you should send your data to a system that can buffer data in case of an outage on the receiving endpoint. With fluentbit you can use Amazon Kinesis Data Firehose to temporarily keep data which can reduce the chance of overloading your final data storage location.</p>"},{"location":"scalability/docs/control-plane/","title":"Kubernetes Control Plane","text":"<p>The Kubernetes control plane consists of the Kubernetes API Server, Kubernetes Controller Manager, Scheduler and other components that are required for Kubernetes to function. Scalability limits of these components are different depending on what you\u2019re running in the cluster, but the areas with the biggest impact to scaling include the Kubernetes version, utilization, and individual Node scaling.</p>"},{"location":"scalability/docs/control-plane/#use-eks-124-or-above","title":"Use EKS 1.24 or above","text":"<p>EKS 1.24 introduced a number of changes and switches the container runtime to containerd instead of docker. Containerd helps clusters scale by increasing individual node performance by limiting container runtime features to closely align with Kubernetes\u2019 needs. Containerd is available in every supported version of EKS and if you would like to switch to containerd in versions prior to 1.24 please use the <code>--container-runtime</code> bootstrap flag.</p>"},{"location":"scalability/docs/control-plane/#limit-workload-and-node-bursting","title":"Limit workload and node bursting","text":"<p>Attention</p> <p>To avoid reaching API limits on the control plane you should limit scaling spikes that increase cluster size by double digit percentages at a time (e.g. 1000 nodes to 1100 nodes or 4000 to 4500 pods at once).</p> <p>The EKS control plane will automatically scale as your cluster grows, but there are limits on how fast it will scale. When you first create an EKS cluster the Control Plane will not immediately be able to scale to hundreds of nodes or thousands of pods. To read more about how EKS has made scaling improvements see this blog post.</p> <p>Scaling large applications requires infrastructure to adapt to become fully ready (e.g. warming load balancers). To control the speed of scaling make sure you are scaling based on the right metrics for your application. CPU and memory scaling may not accurately predict your application constraints and using custom metrics (e.g. requests per second) in Kubernetes Horizontal Pod Autoscaler (HPA) may be a better scaling option.</p> <p>To use a custom metric see the examples in the Kubernetes documentation. If you have more advanced scaling needs or need to scale based on external sources (e.g. AWS SQS queue) then use KEDA for event based workload scaling.</p>"},{"location":"scalability/docs/control-plane/#scale-nodes-and-pods-down-safely","title":"Scale nodes and pods down safely","text":""},{"location":"scalability/docs/control-plane/#replace-long-running-instances","title":"Replace long running instances","text":"<p>Replacing nodes regularly keeps your cluster healthy by avoiding configuration drift and issues that only happen after extended uptime (e.g. slow memory leaks). Automated replacement will give you good process and practices for node upgrades and security patching. If every node in your cluster is replaced regularly then there is less toil required to maintain separate processes for ongoing maintenance.</p> <p>Use Karpenter\u2019s time to live (TTL) settings to replace instances after they\u2019ve been running for a specified amount of time. Self managed node groups can use the <code>max-instance-lifetime</code> setting to cycle nodes automatically. Managed node groups do not currently have this feature but you can track the request here on GitHub.</p>"},{"location":"scalability/docs/control-plane/#remove-underutilized-nodes","title":"Remove underutilized nodes","text":"<p>You can remove nodes when they have no running workloads using the scale down threshold in the Kubernetes Cluster Autoscaler with the <code>--scale-down-utilization-threshold</code> or in Karpenter you can use the <code>ttlSecondsAfterEmpty</code> provisioner setting.</p>"},{"location":"scalability/docs/control-plane/#use-pod-disruption-budgets-and-safe-node-shutdown","title":"Use pod disruption budgets and safe node shutdown","text":"<p>Removing pods and nodes from a Kubernetes cluster requires controllers to make updates to multiple resources (e.g. EndpointSlices). Doing this frequently or too quickly can cause API server throttling and application outages as changes propogate to controllers. Pod Disruption Budgets are a best practice to slow down churn to protect workload availability as nodes are removed or rescheduled in a cluster.</p>"},{"location":"scalability/docs/control-plane/#use-client-side-cache-when-running-kubectl","title":"Use Client-Side Cache when running Kubectl","text":"<p>Using the kubectl command inefficiently can add additional load to the Kubernetes API Server. You should avoid running scripts or automation that uses kubectl repeatedly (e.g. in a for loop) or running commands without a local cache.</p> <p><code>kubectl</code> has a client-side cache that caches discovery information from the cluster to reduce the amount of API calls required. The cache is enabled by default and is refreshed every 10 minutes.</p> <p>If you run kubectl from a container or without a client-side cache you may run into API throttling issues. It is recommended to retain your cluster cache by mounting the <code>--cache-dir</code> to avoid making uncessesary API calls.</p>"},{"location":"scalability/docs/control-plane/#disable-kubectl-compression","title":"Disable kubectl Compression","text":"<p>Disabling kubectl compression in your kubeconfig file can reduce API and client CPU usage. By default the server will compress data sent to the client to optimize network bandwidth. This adds CPU load on the client and server for every request and disabling compression can reduce the overhead and latency if you have adequate bandwidth. To disable compression you can use the <code>--disable-compression=true</code> flag or set <code>disable-compression: true</code> in your kubeconfig file.</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    server: serverURL\n    disable-compression: true\n  name: cluster\n</code></pre>"},{"location":"scalability/docs/control-plane/#shard-cluster-autoscaler","title":"Shard Cluster Autoscaler","text":"<p>The Kubernetes Cluster Autoscaler has been tested to scale up to 1000 nodes. On a large cluster with more than 1000 nodes, it is recommended to run multiple instances of the Cluster Autoscaler in shard mode. Each Cluster Autoscaler instance is configured to scale a set of node groups. The following example shows 2 cluster autoscaling configurations that are configured to each scale 4 node groups.</p> <p>ClusterAutoscaler-1</p> <pre><code>autoscalingGroups:\n- name: eks-core-node-grp-20220823190924690000000011-80c1660e-030d-476d-cb0d-d04d585a8fcb\n  maxSize: 50\n  minSize: 2\n- name: eks-data_m1-20220824130553925600000011-5ec167fa-ca93-8ca4-53a5-003e1ed8d306\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m2-20220824130733258600000015-aac167fb-8bf7-429d-d032-e195af4e25f5\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m3-20220824130553914900000003-18c167fa-ca7f-23c9-0fea-f9edefbda002\n  maxSize: 450\n  minSize: 2\n</code></pre> <p>ClusterAutoscaler-2</p> <pre><code>autoscalingGroups:\n- name: eks-data_m4-2022082413055392550000000f-5ec167fa-ca86-6b83-ae9d-1e07ade3e7c4\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m5-20220824130744542100000017-02c167fb-a1f7-3d9e-a583-43b4975c050c\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m6-2022082413055392430000000d-9cc167fa-ca94-132a-04ad-e43166cef41f\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m7-20220824130553921000000009-96c167fa-ca91-d767-0427-91c879ddf5af\n  maxSize: 450\n  minSize: 2\n</code></pre>"},{"location":"scalability/docs/control-plane/#api-priority-and-fairness","title":"API Priority and Fairness","text":""},{"location":"scalability/docs/control-plane/#overview","title":"Overview","text":"<p>To protect itself from being overloaded during periods of increased requests, the API Server limits the number of inflight requests it can have outstanding at a given time. Once this limit is exceeded, the API Server will start rejecting requests and return a 429 HTTP response code for \"Too Many Requests\" back to clients. The server dropping requests and having clients try again later is preferable to having no server-side limits on the number of requests and overloading the control plane, which could result in degraded performance or unavailability.</p> <p>The mechanism used by Kubernetes to configure how these inflights requests are divided among different request types is called API Priority and Fairness. The API Server configures the total number of inflight requests it can accept by summing together the values specified by the <code>--max-requests-inflight</code> and <code>--max-mutating-requests-inflight</code> flags. EKS uses the default values of 400 and 200 requests for these flags, allowing a total of 600 requests to be dispatched at a given time. However, as it scales the control-plane to larger sizes in response to increased utilization and workload churn, it correspondingly increases the inflight request quota all the way till 2000 (subject to change). APF specifies how these inflight request quota is further sub-divided among different request types. Note that EKS control planes are highly available with at least 2 API Servers registered to each cluster. This means the total number of inflight requests your cluster can handle is twice (or higher if horizontally scaled out further) the inflight quota set per kube-apiserver. This amounts to several thousands of requests/second on the largest EKS clusters.</p> <p>Two kinds of Kubernetes objects, called PriorityLevelConfigurations and FlowSchemas, configure how the total number of requests is divided between different request types. These objects are maintained by the API Server automatically and EKS uses the default configuration of these objects for the given Kubernetes minor version. PriorityLevelConfigurations represent a fraction of the total number of allowed requests. For example, the workload-high PriorityLevelConfiguration is allocated 98 out of the total of 600 requests. The sum of requests allocated to all PriorityLevelConfigurations will equal 600 (or slightly above 600 because the API Server will round up if a given level is granted a fraction of a request). To check the PriorityLevelConfigurations in your cluster and the number of requests allocated to each, you can run the following command. These are the defaults on EKS 1.24:</p> <pre><code>$ kubectl get --raw /metrics | grep apiserver_flowcontrol_request_concurrency_limit\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"catch-all\"} 13\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"global-default\"} 49\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"leader-election\"} 25\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"node-high\"} 98\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"system\"} 74\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-high\"} 98\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-low\"} 245\n</code></pre> <p>The second type of object are FlowSchemas. API Server requests with a given set of properties are classified under the same FlowSchema. These properties include either the authenticated user or attributes of the request, such as the API group, namespace, or resource. A FlowSchema also specifies which PriorityLevelConfiguration this type of request should map to. The two objects together say, \"I want this type of request to count towards this share of inflight requests.\" When a request hits the API Server, it will check each of its FlowSchemas until it finds one that matches all the required properties. If multiple FlowSchemas match a request, the API Server will choose the FlowSchema with the smallest matching precedence which is specified as a property in the object.</p> <p>The mapping of FlowSchemas to PriorityLevelConfigurations can be viewed using this command:</p> <pre><code>$ kubectl get flowschemas\nNAME                           PRIORITYLEVEL     MATCHINGPRECEDENCE   DISTINGUISHERMETHOD   AGE     MISSINGPL\nexempt                         exempt            1                    &lt;none&gt;                7h19m   False\neks-exempt                     exempt            2                    &lt;none&gt;                7h19m   False\nprobes                         exempt            2                    &lt;none&gt;                7h19m   False\nsystem-leader-election         leader-election   100                  ByUser                7h19m   False\nendpoint-controller            workload-high     150                  ByUser                7h19m   False\nworkload-leader-election       leader-election   200                  ByUser                7h19m   False\nsystem-node-high               node-high         400                  ByUser                7h19m   False\nsystem-nodes                   system            500                  ByUser                7h19m   False\nkube-controller-manager        workload-high     800                  ByNamespace           7h19m   False\nkube-scheduler                 workload-high     800                  ByNamespace           7h19m   False\nkube-system-service-accounts   workload-high     900                  ByNamespace           7h19m   False\neks-workload-high              workload-high     1000                 ByUser                7h14m   False\nservice-accounts               workload-low      9000                 ByUser                7h19m   False\nglobal-default                 global-default    9900                 ByUser                7h19m   False\ncatch-all                      catch-all         10000                ByUser                7h19m   False\n</code></pre> <p>PriorityLevelConfigurations can have a type of Queue, Reject, or Exempt. For types Queue and Reject, a limit is enforced on the maximum number of inflight requests for that priority level, however, the behavior differs when that limit is reached. For example, the workload-high PriorityLevelConfiguration uses type Queue and has 98 requests available for use by the controller-manager, endpoint-controller, scheduler,eks related controllers and from pods running in the kube-system namespace. Since type Queue is used, the API Server will attempt to keep requests in memory and hope that the number of inflight requests drops below 98 before these requests time out. If a given request times out in the queue or if too many requests are already queued, the API Server has no choice but to drop the request and return the client a 429. Note that queuing may prevent a request from receiving a 429, but it comes with the tradeoff of increased end-to-end latency on the request.</p> <p>Now consider the catch-all FlowSchema that maps to the catch-all PriorityLevelConfiguration with type Reject. If clients reach the limit of 13 inflight requests, the API Server will not exercise queuing and will drop the requests instantly with a 429 response code. Finally, requests mapping to a PriorityLevelConfiguration with type Exempt will never receive a 429 and always be dispatched immediately. This is used for high-priority requests such as healthz requests or requests coming from the system:masters group.  </p>"},{"location":"scalability/docs/control-plane/#monitoring-apf-and-dropped-requests","title":"Monitoring APF and Dropped Requests","text":"<p>To confirm if any requests are being dropped due to APF, the API Server metrics for <code>apiserver_flowcontrol_rejected_requests_total</code> can be monitored to check the impacted FlowSchemas and PriorityLevelConfigurations. For example, this metric shows that 100 requests from the service-accounts FlowSchema were dropped due to requests timing out in workload-low queues:</p> <pre><code>% kubectl get --raw /metrics | grep apiserver_flowcontrol_rejected_requests_total\napiserver_flowcontrol_rejected_requests_total{flow_schema=\"service-accounts\",priority_level=\"workload-low\",reason=\"time-out\"} 100\n</code></pre> <p>To check how close a given PriorityLevelConfiguration is to receiving 429s or experiencing increased latency due to queuing, you can compare the difference between the concurrency limit and the concurrency in use. In this example, we have a buffer of 100 requests.</p> <pre><code>% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_request_concurrency_limit.*workload-low'\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-low\"} 245\n\n% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_request_concurrency_in_use.*workload-low'\napiserver_flowcontrol_request_concurrency_in_use{flow_schema=\"service-accounts\",priority_level=\"workload-low\"} 145\n</code></pre> <p>To check if a given PriorityLevelConfiguration is experiencing queuing but not necessarily dropped requests, the metric for <code>apiserver_flowcontrol_current_inqueue_requests</code> can be referenced:</p> <pre><code>% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_current_inqueue_requests.*workload-low'\napiserver_flowcontrol_current_inqueue_requests{flow_schema=\"service-accounts\",priority_level=\"workload-low\"} 10\n</code></pre> <p>Other useful Prometheus metrics include:</p> <ul> <li>apiserver_flowcontrol_dispatched_requests_total</li> <li>apiserver_flowcontrol_request_execution_seconds</li> <li>apiserver_flowcontrol_request_wait_duration_seconds</li> </ul> <p>See the upstream documentation for a complete list of APF metrics.</p>"},{"location":"scalability/docs/control-plane/#preventing-dropped-requests","title":"Preventing Dropped Requests","text":""},{"location":"scalability/docs/control-plane/#prevent-429s-by-changing-your-workload","title":"Prevent 429s by changing your workload","text":"<p>When APF is dropping requests due to a given PriorityLevelConfiguration exceeding its maximum number of allowed inflight requests, clients in the affected FlowSchemas can decrease the number of requests executing at a given time. This can be accomplished by reducing the total number of requests made over the period where 429s are occurring. Note that long-running requests such as expensive list calls are especially problematic because they count as an inflight request for the entire duration they are executing. Reducing the number of these expensive requests or optimizing the latency of these list calls (for example, by reducing the number of objects fetched per request or switching to using a watch request) can help reduce the total concurrency required by the given workload.</p>"},{"location":"scalability/docs/control-plane/#prevent-429s-by-changing-your-apf-settings","title":"Prevent 429s by changing your APF settings","text":"<p>Warning</p> <p>Only change default APF settings if you know what you are doing. Misconfigured APF settings can result in dropped API Server requests and significant workload disruptions.</p> <p>One other approach for preventing dropped requests is changing the default FlowSchemas or PriorityLevelConfigurations installed on EKS clusters. EKS installs the upstream default settings for FlowSchemas and PriorityLevelConfigurations for the given Kubernetes minor version. The API Server will automatically reconcile these objects back to their defaults if modified unless the following annotation on the objects is set to false:</p> <pre><code>  metadata:\n    annotations:\n      apf.kubernetes.io/autoupdate-spec: \"false\"\n</code></pre> <p>At a high-level, APF settings can be modified to either:</p> <ul> <li>Allocate more inflight capacity to requests you care about.</li> <li>Isolate non-essential or expensive requests that can starve capacity for other request types.</li> </ul> <p>This can be accomplished by either changing the default FlowSchemas and PriorityLevelConfigurations or by creating new objects of these types. Operators can increase the values for assuredConcurrencyShares for the relevant PriorityLevelConfigurations objects to increase the fraction of inflight requests they are allocated. Additionally, the number of requests that can be queued at a given time can also be increased if the application can handle the additional latency caused by requests being queued before they are dispatched.</p> <p>Alternatively, new FlowSchema and PriorityLevelConfigurations objects can be created that are specific to the customer's workload. Be aware that allocating more assuredConcurrencyShares to either existing PriorityLevelConfigurations or to new PriorityLevelConfigurations will cause the number of requests that can be handled by other buckets to be reduced as the overall limit will stay as 600 inflight per API Server.</p> <p>When making changes to APF defaults, these metrics should be monitored on a non-production cluster to ensure changing the settings do not cause unintended 429s:</p> <ol> <li>The metric for <code>apiserver_flowcontrol_rejected_requests_total</code> should be monitored for all FlowSchemas to ensure that no buckets start to drop requests.</li> <li>The values for <code>apiserver_flowcontrol_request_concurrency_limit</code> and <code>apiserver_flowcontrol_request_concurrency_in_use</code> should be compared to ensure that the concurrency in use is not at risk for breaching the limit for that priority level.</li> </ol> <p>One common use-case for defining a new FlowSchema and PriorityLevelConfiguration is for isolation. Suppose we want to isolate long-running list event calls from pods to their own share of requests. This will prevent important requests from pods using the existing service-accounts FlowSchema from receiving 429s and being starved of request capacity. Recall that the total number of inflight requests is finite, however, this example shows APF settings can be modified to better divide request capacity for the given workload:</p> <p>Example FlowSchema object to isolate list event requests:</p> <pre><code>apiVersion: flowcontrol.apiserver.k8s.io/v1beta1\nkind: FlowSchema\nmetadata:\n  name: list-events-default-service-accounts\nspec:\n  distinguisherMethod:\n    type: ByUser\n  matchingPrecedence: 8000\n  priorityLevelConfiguration:\n    name: catch-all\n  rules:\n  - resourceRules:\n    - apiGroups:\n      - '*'\n      namespaces:\n      - default\n      resources:\n      - events\n      verbs:\n      - list\n    subjects:\n    - kind: ServiceAccount\n      serviceAccount:\n        name: default\n        namespace: default\n</code></pre> <ul> <li>This FlowSchema captures all list event calls made by service accounts in the default namespace.</li> <li>The matching precedence 8000 is lower than the value of 9000 used by the existing service-accounts FlowSchema so these list event calls will match list-events-default-service-accounts rather than service-accounts.</li> <li>We're using the catch-all PriorityLevelConfiguration to isolate these requests. This bucket only allows 13 inflight requests to be used by these long-running list event calls. Pods will start to receive 429s as soon they try to issue more than 13 of these requests concurrently.</li> </ul>"},{"location":"scalability/docs/control-plane/#retrieving-resources-in-the-api-server","title":"Retrieving resources in the API server","text":"<p>Getting information from the API server is an expected behavior for clusters of any size. As you scale the number of resources in the cluster the frequency of requests and volume of data can quickly become a bottleneck for the control plane and will lead to API latency and slowness. Depending on the severity of the latency it cause unexpected downtime if you are not careful.</p> <p>Being aware of what you are requesting and how often are the first steps to avoiding these types of problems. Here is guidance to limit the volume of queries based on the scaling best practices. Suggestions in this section are provided in order starting with the options that are known to scale the best.</p>"},{"location":"scalability/docs/control-plane/#use-shared-informers","title":"Use Shared Informers","text":"<p>When building controllers and automation that integrate with the Kubernetes API you will often need to get information from Kubernetes resources. If you poll for these resources regularly it can cause a significant load on the API server.</p> <p>Using an informer from the client-go library will give you benefits of watching for changes to the resources based on events instead of polling for changes. Informers further reduce the load by using shared cache for the events and changes so multiple controllers watching the same resources do not add additional load.</p> <p>Controllers should avoid polling cluster wide resources without labels and field selectors especially in large clusters. Each un-filtered poll requires a lot of unnecessary data to be sent from etcd through the API server to be filtered by the client. By filtering based on labels and namespaces you can reduce the amount of work the API server needs to perform to fullfil the request and data sent to the client.</p>"},{"location":"scalability/docs/control-plane/#optimize-kubernetes-api-usage","title":"Optimize Kubernetes API usage","text":"<p>When calling the Kubernetes API with custom controllers or automation it's important that you limit the calls to only the resources you need. Without limits you can cause unneeded load on the API server and etcd.</p> <p>It is recommended that you use the watch argument whenever possible. With no arguments the default behavior is to list objects. To use watch instead of list you can append <code>?watch=true</code> to the end of your API request. For example, to get all pods in the default namespace with a watch use:</p> <pre><code>/api/v1/namespaces/default/pods?watch=true\n</code></pre> <p>If you are listing objects you should limit the scope of what you are listing and the amount of data returned. You can limit the returned data by adding <code>limit=500</code> argument to requests. The <code>fieldSelector</code> argument and <code>/namespace/</code> path can be useful to make sure your lists are as narrowly scoped as needed. For example, to list only running pods in the default namespace use the following API path and arguments.</p> <pre><code>/api/v1/namespaces/default/pods?fieldSelector=status.phase=Running&amp;limit=500\n</code></pre> <p>Or list all pods that are running with:</p> <pre><code>/api/v1/pods?fieldSelector=status.phase=Running&amp;limit=500\n</code></pre> <p>Another option to limit watch calls or listed objects is to use <code>resourceVersions</code> which you can read about in the Kubernetes documentation. Without a <code>resourceVersion</code> argument you will receive the most recent version available which requires an etcd quorum read which is the most expensive and slowest read for the database. The resourceVersion depends on what resources you are trying to query and can be found in the <code>metadata.resourseVersion</code> field. This is also recommended in case of using watch calls and not just list calls</p> <p>There is a special <code>resourceVersion=0</code> available that will return results from the API server cache. This can reduce etcd load but it does not support pagination.</p> <p><pre><code>/api/v1/namespaces/default/pods?resourceVersion=0\n</code></pre> It's recommended to use watch with a resourceVersion set to be the most recent known value received from its preceding list or watch. This is handled automatically in client-go. But it's suggested to double check it if you are using a k8s client in other languages.</p> <p><pre><code>/api/v1/namespaces/default/pods?watch=true&amp;resourceVersion=362812295\n</code></pre> If you call the API without any arguments it will be the most resource intensive for the API server and etcd. This call will get all pods in all namespaces without pagination or limiting the scope and require a quorum read from etcd.</p> <pre><code>/api/v1/pods\n</code></pre>"},{"location":"scalability/docs/data-plane/","title":"Kubernetes Data Plane","text":"<p>The Kubernetes Data Plane includes EC2 instances, load balancers, storage, and other APIs used by the Kubernetes Control Plane. For organization purposes we grouped cluster services in a separate page and load balancer scaling can be found in the workloads section. This section will focus on scaling compute resources.</p> <p>Selecting EC2 instance types is possibly one of the hardest decisions customers face because in clusters with multiple workloads. There is no one-size-fits all solution. Here are some tips to help you avoid common pitfalls with scaling compute.</p>"},{"location":"scalability/docs/data-plane/#automatic-node-autoscaling","title":"Automatic node autoscaling","text":"<p>We recommend you use node autoscaling that reduces toil and integrates deeply with Kubernetes. Managed node groups and Karpenter are recommended for large scale clusters.</p> <p>Managed node groups will give you the flexibility of Amazon EC2 Auto Scaling groups with added benefits for managed upgrades and configuration. It can be scaled with the Kubernetes Cluster Autoscaler and is a common option for clusters that have a variety of compute needs.</p> <p>Karpenter is an open source, workload-native node autoscaler created by AWS. It scales nodes in a cluster based on the workload requirements for resources (e.g. GPU) and taints and tolerations (e.g. zone spread) without managing node groups. Nodes are created directly from EC2 which avoids default node group quotas\u2014450 nodes per group\u2014and provides greater instance selection flexibility with less operational overhead. We recommend customers use Karpenter when possible.</p>"},{"location":"scalability/docs/data-plane/#use-many-different-ec2-instance-types","title":"Use many different EC2 instance types","text":"<p>Each AWS region has a limited number of available instances per instance type. If you create a cluster that uses only one instance type and scale the number of nodes beyond the capacity of the region you will receive an error that no instances are available. To avoid this issue you should not arbitrarily limit the type of instances that can be use in your cluster.</p> <p>Karpenter will use a broad set of compatible instance types by default and will pick an instance at provisioning time based on pending workload requirements, availability, and cost. You can broaden the list of instance types used in the <code>karpenter.k8s.aws/instance-category</code> key of NodePools.</p> <p>The Kubernetes Cluster Autoscaler requires node groups to be similarly sized so they can be consistently scaled. You should create multiple groups based on CPU and memory size and scale them independently. Use the ec2-instance-selector to identify instances that are similarly sized for your node groups.</p> <pre><code>ec2-instance-selector --service eks --vcpus-min 8 --memory-min 16\na1.2xlarge\na1.4xlarge\na1.metal\nc4.4xlarge\nc4.8xlarge\nc5.12xlarge\nc5.18xlarge\nc5.24xlarge\nc5.2xlarge\nc5.4xlarge\nc5.9xlarge\nc5.metal\n</code></pre>"},{"location":"scalability/docs/data-plane/#prefer-larger-nodes-to-reduce-api-server-load","title":"Prefer larger nodes to reduce API server load","text":"<p>When deciding what instance types to use, fewer, large nodes will put less load on the Kubernetes Control Plane because there will be fewer kubelets and DaemonSets running. However, large nodes may not be utilized fully like smaller nodes. Node sizes should be evaluated based on your workload availability and scale requirements.</p> <p>A cluster with three u-24tb1.metal instances (24 TB memory and 448 cores) has 3 kubelets, and would be limited to 110 pods per node by default. If your pods use 4 cores each then this might be expected (4 cores x 110 = 440 cores/node). With a 3 node cluster your ability to handle an instance incident would be low because 1 instance outage could impact 1/3 of the cluster. You should specify node requirements and pod spread in your workloads so the Kubernetes scheduler can place workloads properly.</p> <p>Workloads should define the resources they need and the availability required via taints, tolerations, and PodTopologySpread. They should prefer the largest nodes that can be fully utilized and meet availability goals to reduce control plane load, lower operations, and reduce cost.</p> <p>The Kubernetes Scheduler will automatically try to spread workloads across availability zones and hosts if resources are available. If no capacity is available the Kubernetes Cluster Autoscaler will attempt to add nodes in each Availability Zone evenly. Karpenter will attempt to add nodes as quickly and cheaply as possible unless the workload specifies other requirements.</p> <p>To force workloads to spread with the scheduler and new nodes to be created across availability zones you should use topologySpreadConstraints:</p> <pre><code>spec:\n  topologySpreadConstraints:\n    - maxSkew: 3\n      topologyKey: \"topology.kubernetes.io/zone\"\n      whenUnsatisfiable: ScheduleAnyway\n      labelSelector:\n        matchLabels:\n          dev: my-deployment\n    - maxSkew: 2\n      topologyKey: \"kubernetes.io/hostname\"\n      whenUnsatisfiable: ScheduleAnyway\n      labelSelector:\n        matchLabels:\n          dev: my-deployment\n</code></pre>"},{"location":"scalability/docs/data-plane/#use-similar-node-sizes-for-consistent-workload-performance","title":"Use similar node sizes for consistent workload performance","text":"<p>Workloads should define what size nodes they need to be run on to allow consistent performance and predictable scaling. A workload requesting 500m CPU will perform differently on an instance with 4 cores vs one with 16 cores. Avoid instance types that use burstable CPUs like T series instances.</p> <p>To make sure your workloads get consistent performance a workload can use the supported Karpenter labels to target specific instances sizes.</p> <pre><code>kind: deployment\n...\nspec:\n  template:\n    spec:\n    containers:\n    nodeSelector:\n      karpenter.k8s.aws/instance-size: 8xlarge\n</code></pre> <p>Workloads being scheduled in a cluster with the Kubernetes Cluster Autoscaler should match a node selector to node groups based on label matching.</p> <pre><code>spec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: eks.amazonaws.com/nodegroup\n            operator: In\n            values:\n            - 8-core-node-group    # match your node group name\n</code></pre>"},{"location":"scalability/docs/data-plane/#use-compute-resources-efficiently","title":"Use compute resources efficiently","text":"<p>Compute resources include EC2 instances and availability zones. Using compute resources effectively will increase your scalability, availability, performance, and reduce your total cost. Efficient resource usage is extremely difficult to predict in an autoscaling environment with multiple applications. Karpenter was created to provision instances on-demand based on the workload needs to maximize utilization and flexibility.</p> <p>Karpenter allows workloads to declare the type of compute resources it needs without first creating node groups or configuring label taints for specific nodes. See the Karpenter best practices for more information. Consider enabling consolidation in your Karpenter provisioner to replace nodes that are under utilized.</p>"},{"location":"scalability/docs/data-plane/#automate-amazon-machine-image-ami-updates","title":"Automate Amazon Machine Image (AMI) updates","text":"<p>Keeping worker node components up to date will make sure you have the latest security patches and compatible features with the Kubernetes API. Updating the kubelet is the most important component for Kubernetes functionality, but automating OS, kernel, and locally installed application patches will reduce maintenance as you scale.</p> <p>It is recommended that you use the latest Amazon EKS optimized Amazon Linux 2 or Amazon EKS optimized Bottlerocket AMI for your node image. Karpenter will automatically use the latest available AMI to provision new nodes in the cluster. Managed node groups will update the AMI during a node group update but will not update the AMI ID at node provisioning time.</p> <p>For Managed Node Groups you need to update the Auto Scaling Group (ASG) launch template with new AMI IDs when they are available for patch releases. AMI minor versions (e.g. 1.23.5 to 1.24.3) will be available in the EKS console and API as upgrades for the node group. Patch release versions (e.g. 1.23.5 to 1.23.6) will not be presented as upgrades for the node groups. If you want to keep your node group up to date with AMI patch releases you need to create new launch template version and let the node group replace instances with the new AMI release.</p> <p>You can find the latest available AMI from this page or use the AWS CLI.</p> <pre><code>aws ssm get-parameter \\\n  --name /aws/service/eks/optimized-ami/1.24/amazon-linux-2/recommended/image_id \\\n  --query \"Parameter.Value\" \\\n  --output text\n</code></pre>"},{"location":"scalability/docs/data-plane/#use-multiple-ebs-volumes-for-containers","title":"Use multiple EBS volumes for containers","text":"<p>EBS volumes have input/output (I/O) quota based on the type of volume (e.g. gp3) and the size of the disk. If your applications share a single EBS root volume with the host this can exhaust the disk quota for the entire host and cause other applications to wait for available capacity. Applications write to disk if they write files to their overlay partition, mount a local volume from the host, and also when they log to standard out (STDOUT) depending on the logging agent used.</p> <p>To avoid disk I/O exhaustion you should mount a second volume to the container state folder (e.g. /run/containerd), use separate EBS volumes for workload storage, and disable unnecessary local logging.</p> <p>To mount a second volume to your EC2 instances using eksctl you can use a node group with this configuration:</p> <pre><code>managedNodeGroups:\n  - name: al2-workers\n    amiFamily: AmazonLinux2\n    desiredCapacity: 2\n    volumeSize: 80\n    additionalVolumes:\n      - volumeName: '/dev/sdz'\n        volumeSize: 100\n    preBootstrapCommands:\n    - |\n      \"systemctl stop containerd\"\n      \"mkfs -t ext4 /dev/nvme1n1\"\n      \"rm -rf /var/lib/containerd/*\"\n      \"mount /dev/nvme1n1 /var/lib/containerd/\"\n      \"systemctl start containerd\"\n</code></pre> <p>If you are using terraform to provision your node groups please see examples in EKS Blueprints for terraform. If you are using Karpenter to provision nodes you can use <code>blockDeviceMappings</code> with node user-data to add additional volumes.</p> <p>To mount an EBS volume directly to your pod you should use the AWS EBS CSI driver and consume a volume with a storage class.</p> <pre><code>---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: ebs-sc\nprovisioner: ebs.csi.aws.com\nvolumeBindingMode: WaitForFirstConsumer\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: ebs-claim\nspec:\n  accessModes:\n    - ReadWriteOnce\n  storageClassName: ebs-sc\n  resources:\n    requests:\n      storage: 4Gi\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: app\nspec:\n  containers:\n  - name: app\n    image: public.ecr.aws/docker/library/nginx\n    volumeMounts:\n    - name: persistent-storage\n      mountPath: /data\n  volumes:\n  - name: persistent-storage\n    persistentVolumeClaim:\n      claimName: ebs-claim\n</code></pre>"},{"location":"scalability/docs/data-plane/#avoid-instances-with-low-ebs-attach-limits-if-workloads-use-ebs-volumes","title":"Avoid instances with low EBS attach limits if workloads use EBS volumes","text":"<p>EBS is one of the easiest ways for workloads to have persistent storage, but it also comes with scalability limitations. Each instance type has a maximum number of EBS volumes that can be attached. Workloads need to declare what instance types they should run on and limit the number of replicas on a single instance with Kubernetes taints.</p>"},{"location":"scalability/docs/data-plane/#disable-unnecessary-logging-to-disk","title":"Disable unnecessary logging to disk","text":"<p>Avoid unnecessary local logging by not running your applications with debug logging in production and disabling logging that reads and writes to disk frequently. Journald is the local logging service that keeps a log buffer in memory and flushes to disk periodically. Journald is preferred over syslog which logs every line immediately to disk. Disabling syslog also lowers the total amount of storage you need and avoids needing complicated log rotation rules. To disable syslog you can add the following snippet to your cloud-init configuration:</p> <pre><code>runcmd:\n  - [ systemctl, disable, --now, syslog.service ]\n</code></pre>"},{"location":"scalability/docs/data-plane/#patch-instances-in-place-when-os-update-speed-is-a-necessity","title":"Patch instances in place when OS update speed is a necessity","text":"<p>Attention</p> <p>Patching instances in place should only be done when required. Amazon recommends treating infrastructure as immutable and thoroughly testing updates that are promoted through lower environments the same way applications are. This section applies when that is not possible.</p> <p>It takes seconds to install a package on an existing Linux host without disrupting containerized workloads. The package can be installed and validated without cordoning, draining, or replacing the instance.</p> <p>To replace an instance you first need to create, validate, and distribute new AMIs. The instance needs to have a replacement created, and the old instance needs to be cordoned and drained. Then workloads need to be created on the new instance, verified, and repeated for all instances that need to be patched. It takes hours, days, or weeks to replace instances safely without disrupting workloads.</p> <p>Amazon recommends using immutable infrastructure that is built, tested, and promoted from an automated, declarative system, but if you have a requirement to patch systems quickly then you will need to patch systems in place and replace them as new AMIs are made available. Because of the large time differential between patching and replacing systems we recommend using AWS Systems Manager Patch Manager to automate patching nodes when required to do so.</p> <p>Patching nodes will allow you to quickly roll out security updates and replace the instances on a regular schedule after your AMI has been updated. If you are using an operating system with a read-only root file system like Flatcar Container Linux or Bottlerocket OS we recommend using the update operators that work with those operating systems. The Flatcar Linux update operator and Bottlerocket update operator will reboot instances to keep nodes up to date automatically.</p>"},{"location":"scalability/docs/kcp_monitoring/","title":"Control Plane Monitoring","text":""},{"location":"scalability/docs/kcp_monitoring/#api-server","title":"API Server","text":"<p>When looking at our API server it\u2019s important to remember that one of its functions is to throttle inbound requests to prevent overloading the control plane. What can seem like a bottleneck at the API server level might actually be protecting it from more serious issues. We need to factor in the pros and cons of increasing the volume of requests moving through the system. To make a determination if the API server values should be increased, here is small sampling of the things we need to be mindful of:</p> <ol> <li>What is the latency of requests moving through the system?</li> <li>Is that latency the API server itself, or something \u201cdownstream\u201d like etcd?</li> <li>Is the API server queue depth a factor in this latency?</li> <li>Are the API Priority and Fairness (APF) queues setup correctly for the API call patterns we want?</li> </ol>"},{"location":"scalability/docs/kcp_monitoring/#where-is-the-issue","title":"Where is the issue?","text":"<p>To start, we can use the metric for API latency to give us insight into how long it\u2019s taking the API server to service requests. Let\u2019s use the below PromQL and Grafana heatmap to display this data.</p> <pre><code>max(increase(apiserver_request_duration_seconds_bucket{subresource!=\"status\",subresource!=\"token\",subresource!=\"scale\",subresource!=\"/healthz\",subresource!=\"binding\",subresource!=\"proxy\",verb!=\"WATCH\"}[$__rate_interval])) by (le)\n</code></pre> <p>Tip</p> <p>For an in depth write up on how to monitor the API server with the API dashboard used in this article, please see the following blog</p> <p></p> <p>These requests are all under the one second mark, which is a good indication that the control plane is handling requests in a timely fashion.  But what if that was not the case?</p> <p>The format we are using in the above API Request Duration is a heatmap. What\u2019s nice about the heatmap format, is that it tells us the timeout value for the API by default (60 sec). However, what we really need to know is at what threshold should this value be of concern before we reach the timeout threshold. For a rough guideline of what acceptable thresholds are we can use the upstream Kubernetes SLO, which can be found here</p> <p>Tip</p> <p>Notice the max function on this statement? When using metrics that are aggregating multiple servers (by default two API servers on EKS) it\u2019s important not to average those servers together.</p>"},{"location":"scalability/docs/kcp_monitoring/#asymmetrical-traffic-patterns","title":"Asymmetrical traffic patterns","text":"<p>What if one API server [pod] was lightly loaded, and the other heavily loaded? If we averaged those two numbers together we might misinterpret what was happening. For example, here we have three API servers but all of the load is on one of these API servers. As a rule anything that has multiple servers such as etcd and API servers should be broken out when investing scale and performance issues.</p> <p></p> <p>With the move to API Priority and Fairness the total number of requests on the system is only one factor to check to see if the API server is oversubscribed. Since the system now works off a series of queues, we must look to see if any of these queues are full and if the traffic for that queue is getting dropped. </p> <p>Let\u2019s look at these queues with the following query:</p> <pre><code>max without(instance)(apiserver_flowcontrol_request_concurrency_limit{})\n</code></pre> <p>Note</p> <p>For more information on how API A&amp;F works please see the following best practices guide</p> <p>Here we see the seven different priority groups that come by default on the cluster</p> <p></p> <p>Next we want to see what percentage of that priority group is being used, so that we can understand if a certain priority level is being saturated. Throttling requests in the workload-low level might be desirable, however drops in a leader election level would not be. </p> <p>The API Priority and Fairness (APF) system has a number of complex options, some of those options can have unintended consequences. A common issue we see in the field is increasing the queue depth to the point it starts adding unnecessary latency. We can monitor this problem by using the <code>apiserver_flowcontrol_current_inqueue_request</code> metric. We can check for drops using the <code>apiserver_flowcontrol_rejected_requests_total</code>. These metrics will be a non-zero value if any bucket exceeds its concurrency. </p> <p></p> <p>Increasing the queue depth can make the API Server a significant source of latency and should be done with care. We recommend being judicious with the number of queues created. For example, the number of shares on a EKS system is 600, if we create too many queues, this can reduce the shares in important queues that need the throughput such as the leader-election queue or system queue. Creating too many extra queues can make it more difficult to size theses queues correctly. </p> <p>To focus on a simple impactful change you can make in APF we simply take shares from underutilized buckets and increase the size of buckets that are at their max usage. By intelligently redistributing the shares among these buckets, you can make drops less likely. </p> <p>For more information, visit API Priority and Fairness settings in the EKS Best Practices Guide.</p>"},{"location":"scalability/docs/kcp_monitoring/#api-vs-etcd-latency","title":"API vs. etcd latency","text":"<p>How can we use the metrics/logs of the API server to determine whether there\u2019s a problem with API server, or a problem that\u2019s upstream/downstream of the API server, or a combination of both. To understand this better, lets look at how API Server and etcd can be related, and how easy it can be to troubleshoot the wrong system.</p> <p>In the below chart we see API server latency, but we also see much of this latency is correlated to the etcd server due to the bars in the graph showing most of the latency at the etcd level. If there is 15 secs of etcd latency at the same time there is 20 seconds of API server latency, then the majority of the latency is actually at the etcd level.</p> <p>By looking at the whole flow, we see that it\u2019s wise to not focus solely on the API Server, but also look for signals that indicate that etcd is under duress (i.e. slow apply counters increasing). Being able to quickly move to the right problem area with just a glance is what makes a dashboard powerful. </p> <p>Tip</p> <p>The dashboard in section can be found at https://github.com/RiskyAdventure/Troubleshooting-Dashboards/blob/main/api-troubleshooter.json</p> <p></p>"},{"location":"scalability/docs/kcp_monitoring/#control-plane-vs-client-side-issues","title":"Control plane vs. Client side issues","text":"<p>In this chart we are looking for the API calls that took the most time to complete for that period. In this case we see a custom resource (CRD) is calling a APPLY function that is the most latent call during the 05:40 time frame. </p> <p></p> <p>Armed with this data we can use an Ad-Hoc PromQL or a CloudWatch Insights query to pull LIST requests from the audit log during that time frame to see which application this might be.</p>"},{"location":"scalability/docs/kcp_monitoring/#finding-the-source-with-cloudwatch","title":"Finding the Source with CloudWatch","text":"<p>Metrics are best used to find the problem area we want to look at and narrow both the timeframe and the search parameters of the problem. Once we have this data we want to transition to logs for more detailed times and errors. To do this we will turn our logs into metrics using CloudWatch Logs Insights. </p> <p>For example, to investigate the issue above, we will use the following CloudWatch Logs Insights query to pull the userAgent and requestURI so that we can pin down which application is causing this latency. </p> <p>Tip</p> <p>An appropriate Count needs to be used as to not pull normal List/Resync behavior on a Watch.</p> <pre><code>fields *@timestamp*, *@message*\n| filter *@logStream* like \"kube-apiserver-audit\"\n| filter ispresent(requestURI)\n| filter verb = \"list\"\n| parse requestReceivedTimestamp /\\d+-\\d+-(?&lt;StartDay&gt;\\d+)T(?&lt;StartHour&gt;\\d+):(?&lt;StartMinute&gt;\\d+):(?&lt;StartSec&gt;\\d+).(?&lt;StartMsec&gt;\\d+)Z/\n| parse stageTimestamp /\\d+-\\d+-(?&lt;EndDay&gt;\\d+)T(?&lt;EndHour&gt;\\d+):(?&lt;EndMinute&gt;\\d+):(?&lt;EndSec&gt;\\d+).(?&lt;EndMsec&gt;\\d+)Z/\n| fields (StartHour * 3600 + StartMinute * 60 + StartSec + StartMsec / 1000000) as StartTime, (EndHour * 3600 + EndMinute * 60 + EndSec + EndMsec / 1000000) as EndTime, (EndTime - StartTime) as DeltaTime\n| stats avg(DeltaTime) as AverageDeltaTime, count(*) as CountTime by requestURI, userAgent\n| filter CountTime &gt;=50\n| sort AverageDeltaTime desc\n</code></pre> <p>Using this query we found two different agents running a large number of high latency list operations. Splunk and CloudWatch agent. Armed with the data, we can make a decision to remove, update, or replace this controller with another project. </p> <p></p> <p>Tip</p> <p>For more details on this subject please see the following blog</p>"},{"location":"scalability/docs/kcp_monitoring/#scheduler","title":"Scheduler","text":"<p>Since the EKS control plane instances are run in separate AWS account we will not be able to scrape those components for metrics (The API server being the exception). However, since we have access to the audit logs for these components, we can turn those logs into metrics to see if any of the sub-systems are causing a scaling bottleneck. Let\u2019s use CloudWatch Logs Insights to see how many unscheduled pods are in the scheduler queue.</p>"},{"location":"scalability/docs/kcp_monitoring/#unscheduled-pods-in-the-scheduler-log","title":"Unscheduled pods in the scheduler log","text":"<p>If we had access to scrape the scheduler metrics directly on a self managed Kubernetes (such as Kops) we would use the following PromQL to understand the scheduler backlog.</p> <pre><code>max without(instance)(scheduler_pending_pods)\n</code></pre> <p>Since we do not have access to the above metric in EKS, we will use the below CloudWatch Logs Insights query to see the backlog by checking for how many pods were unable to unscheduled during a particular time frame. Then we could dive further into into the messages at the peak time frame to understand the nature of the bottleneck. For example, nodes not spinning up fast enough, or the rate limiter in the scheduler itself. </p> <pre><code>fields timestamp, pod, err, *@message*\n| filter *@logStream* like \"scheduler\"\n| filter *@message* like \"Unable to schedule pod\"\n| parse *@message*  /^.(?&lt;date&gt;\\d{4})\\s+(?&lt;timestamp&gt;\\d+:\\d+:\\d+\\.\\d+)\\s+\\S*\\s+\\S+\\]\\s\\\"(.*?)\\\"\\s+pod=(?&lt;pod&gt;\\\"(.*?)\\\")\\s+err=(?&lt;err&gt;\\\"(.*?)\\\")/\n| count(*) as count by pod, err\n| sort count desc\n</code></pre> <p>Here we see the errors from the scheduler saying the pod did not deploy because the storage PVC was unavailable. </p> <p></p> <p>Note</p> <p>Audit logging must be turned on the control plane to enable this function. It is also a best practice to limit the log retention as to not drive up cost over time unnecessarily. An example for turning on all logging functions using the EKSCTL tool below.  </p> <pre><code>cloudWatch:\n  clusterLogging:\n    enableTypes: [\"*\"]\n    logRetentionInDays: 10\n</code></pre>"},{"location":"scalability/docs/kcp_monitoring/#kube-controller-manager","title":"Kube Controller Manager","text":"<p>Kube Controller Manager, like all other controllers, has limits on how many operations it can do at once. Let\u2019s review what some of those flags are by looking at a KOPS configuration where we can set these parameters.</p> <pre><code>  kubeControllerManager:\n    concurrentEndpointSyncs: 5\n    concurrentReplicasetSyncs: 5\n    concurrentNamespaceSyncs: 10\n    concurrentServiceaccountTokenSyncs: 5\n    concurrentServiceSyncs: 5\n    concurrentResourceQuotaSyncs: 5\n    concurrentGcSyncs: 20\n    kubeAPIBurst: 20\n    kubeAPIQPS: \"30\"\n</code></pre> <p>These controllers have queues that fill up during times of high churn on a cluster. In this case we see the replicaset set controller has a large backlog in its queue. </p> <p></p> <p>We have two different ways of addressing such a situation. If running self managed we could simply increase the concurrent goroutines, however this would have an impact on etcd by processing more data in the KCM. The other option would be to reduce the number of replicaset objects using <code>.spec.revisionHistoryLimit</code> on the deployment to reduce the number of replicaset objects we can rollback, thus reducing the pressure on this controller. </p> <pre><code>spec:\n  revisionHistoryLimit: 2\n</code></pre> <p>Other Kubernetes features can be tuned or turned off to reduce pressure in high churn rate systems. For example, if the application in our pods doesn\u2019t need to speak to the k8s API directly then turning off the projected secret into those pods would decrease the load on ServiceaccountTokenSyncs. This is the more desirable way to address such issues if possible.</p> <pre><code>kind: Pod\nspec:\n  automountServiceAccountToken: false\n</code></pre> <p>In systems where we can\u2019t get access to the metrics, we can again look at the logs to detect contention. If we wanted to see the number of requests being being processed on a per controller or an aggregate level we would use the following CloudWatch Logs Insights Query. </p>"},{"location":"scalability/docs/kcp_monitoring/#total-volume-processed-by-the-kcm","title":"Total Volume Processed by the KCM","text":"<pre><code># Query to count API qps coming from kube-controller-manager, split by controller type.\n# If you're seeing values close to 20/sec for any particular controller, it's most likely seeing client-side API throttling.\nfields @timestamp, @logStream, @message\n| filter @logStream like /kube-apiserver-audit/\n| filter userAgent like /kube-controller-manager/\n# Exclude lease-related calls (not counted under kcm qps)\n| filter requestURI not like \"apis/coordination.k8s.io/v1/namespaces/kube-system/leases/kube-controller-manager\"\n# Exclude API discovery calls (not counted under kcm qps)\n| filter requestURI not like \"?timeout=32s\"\n# Exclude watch calls (not counted under kcm qps)\n| filter verb != \"watch\"\n# If you want to get counts of API calls coming from a specific controller, uncomment the appropriate line below:\n# | filter user.username like \"system:serviceaccount:kube-system:job-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:cronjob-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:deployment-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:replicaset-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:horizontal-pod-autoscaler\"\n# | filter user.username like \"system:serviceaccount:kube-system:persistent-volume-binder\"\n# | filter user.username like \"system:serviceaccount:kube-system:endpointslice-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:endpoint-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:generic-garbage-controller\"\n| stats count(*) as count by user.username\n| sort count desc\n</code></pre> <p>The key takeaway here is when looking into scalability issues, to look at every step in the path (API, scheduler, KCM, etcd) before moving to the detailed troubleshooting phase. Often in production you will find that it takes adjustments to more than one part of Kubernetes to allow the system to work at its most performant. It\u2019s easy to inadvertently troubleshoot what is just a symptom (such as a node timeout) of a much larger bottle neck. </p>"},{"location":"scalability/docs/kcp_monitoring/#etcd","title":"ETCD","text":"<p>etcd uses a memory mapped file to store key value pairs efficiently. There is a protection mechanism to set the size of this memory space available set commonly at the 2, 4, and 8GB limits. Fewer objects in the database means less clean up etcd needs to do when objects are updated and older versions needs to be cleaned out. This process of cleaning old versions of an object out is referred to as compaction. After a number of compaction operations, there is a subsequent process that recovers usable space space called defragging that happens above a certain threshold or on a fixed schedule of time. </p> <p>There are a couple user related items we can do to limit the number of objects in Kubernetes and thus reduce the impact of both the compaction and de-fragmentation process. For example, Helm keeps a high <code>revisionHistoryLimit</code>. This keeps older objects such as ReplicaSets on the system to be able to do rollbacks. By setting the history limits down to 2 we can reduce the the number of objects (like ReplicaSets) from ten to two which in turn would put less load on the system. </p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nspec:\n  revisionHistoryLimit: 2\n</code></pre> <p>From a monitoring standpoint, if system latency spikes occur in a set pattern separated by hours, checking to see if this defragmentation process is the source can be helpful. We can see this by using CloudWatch Logs.</p> <p>If you want to see start/end times of defrag use the following query:</p> <pre><code>fields *@timestamp*, *@message*\n| filter *@logStream* like /etcd-manager/\n| filter *@message* like /defraging|defraged/\n| sort *@timestamp* asc\n</code></pre> <p></p>"},{"location":"scalability/docs/kubernetes_slos/","title":"Kubernetes Upstream SLOs","text":"<p>Amazon EKS runs the same code as the upstream Kubernetes releases and ensures that EKS clusters operate within the SLOs defined by the Kubernetes community. The KubernetesScalability Special Interest Group (SIG) defines the scalability goals and investigates bottlenecks in performance through SLIs and SLOs. </p> <p>SLIs are how we measure a system like metrics or measures that can be used to determine how \u201cwell\u201d the system is running, e.g. request latency or count. SLOs define the values that are expected for when the system is running \u201cwell\u201d, e.g. request latency remains less than 3 seconds. The Kubernetes SLOs and SLIs focus on the performance of the Kubernetes components and are completely independent from the Amazon EKS Service SLAs which focus on availability of the EKS cluster endpoint.</p> <p>Kubernetes has a number of features that allow users to extend the system with custom add-ons or drivers, like CSI drivers, admission webhooks, and auto-scalers. These extensions can drastically impact the performance of a Kubernetes cluster in different ways, i.e. an admission webhook with <code>failurePolicy=Ignore</code> could add latency to K8s API requests if the webhook target is unavailable. The Kubernetes Scalability SIG defines scalability using a \"you promise, we promise\" framework:</p> <p>If you promise to:     - correctly configure your cluster     - use extensibility features \"reasonably\"     - keep the load in the cluster within recommended limits </p> <p>then we promise that your cluster scales, i.e.:     - all the SLOs are satisfied.   </p>"},{"location":"scalability/docs/kubernetes_slos/#kubernetes-slos","title":"Kubernetes SLOs","text":"<p>The Kubernetes SLOs don\u2019t account for all of the plugins and external limitations that could impact a cluster, such as worker node scaling or admission webhooks. These SLOs focus on Kubernetes components and ensure that Kubernetes actions and resources are operating within expectations. The SLOs help Kubernetes developers ensure that changes to Kubernetes code do not degrade performance for the entire system.</p> <p>The Kuberntes Scalability SIG defines the following official SLO/SLIs. The Amazon EKS team regularly runs scalability tests on EKS clusters for these SLOs/SLIs to monitor for performance degradation as changes are made and new versions are released.</p> Objective Definition SLO API request latency (mutating) Latency of processing mutating  API calls for single objects for every (resource, verb) pair, measured as 99th percentile over last 5 minutes In default Kubernetes installation, for every (resource, verb) pair, excluding virtual and aggregated resources and Custom Resource Definitions, 99th percentile per cluster-day &lt;= 1s API request latency (read-only) Latency of processing non-streaming read-only API calls for every (resource, scope) pair, measured as 99th percentile over last 5 minutes In default Kubernetes installation, for every (resource, scope) pair, excluding virtual and aggregated resources and Custom Resource Definitions, 99th percentile per cluster-day: (a) &lt;= 1s if <code>scope=resource</code> (b) &lt;= 30s otherwise (if <code>scope=namespace</code> or <code>scope=cluster</code>) Pod startup latency Startup latency of schedulable stateless pods, excluding time to pull images and run init containers, measured from pod creation timestamp to when all its containers are reported as started and observed via watch, measured as 99th percentile over last 5 minutes In default Kubernetes installation, 99th percentile per cluster-day &lt;= 5s"},{"location":"scalability/docs/kubernetes_slos/#api-request-latency","title":"API Request Latency","text":"<p>The <code>kube-apiserver</code> has <code>--request-timeout</code> defined as <code>1m0s</code> by default, which means a request can run for up to one minute (60 seconds) before being timed out and cancelled. The SLOs defined for Latency are broken out by the type of request that is being made, which can be mutating or read-only:</p>"},{"location":"scalability/docs/kubernetes_slos/#mutating","title":"Mutating","text":"<p>Mutating requests in Kubernetes make changes to a resource, such as creations, deletions, or updates. These requests are expensive because those changes must be written to the etcd backend before the updated object is returned. Etcd is a distributed key-value store that is used for all Kubernetes cluster data.</p> <p>This latency is measured as the 99th percentile over 5min for (resource, verb) pairs of Kubernetes resources, for example this would measure the latency for Create Pod requests and Update Node requests. The request latency must be &lt;= 1 second to satisfy the SLO.</p>"},{"location":"scalability/docs/kubernetes_slos/#read-only","title":"Read-only","text":"<p>Read-only requests retrieve a single resource (such as Get Pod X) or a collection (such as \u201cGet all Pods from Namespace X\u201d). The <code>kube-apiserver</code> maintains a cache of objects, so the requested resources may be returned from cache or they may need to be retrieved from etcd first.  These latencies are also measured by the 99th percentile over 5 minutes, however read-only requests can have separate scopes. The SLO defines two different objectives:</p> <ul> <li>For requests made for a single resource (i.e. <code>kubectl get pod -n mynamespace my-controller-xxx</code> ), the request latency should remain &lt;= 1 second.</li> <li>For requests that are made for multiple resources in a namespace or a cluster (for example, <code>kubectl get pods -A</code>) the latency should remain &lt;= 30 seconds</li> </ul> <p>The SLO has different target values for different request scopes because requests made for a list of Kubernetes resources expect the details of all objects in the request to be returned within the SLO. On large clusters, or large collections of resources, this can result in large response sizes which can take some time to return. For example, in a cluster running tens of thousands of Pods with each Pod being roughly 1 KiB when encoded in JSON, returning all Pods in the cluster would consist of 10MB or more. Kubernetes clients can help reduce this response size using APIListChunking to retrieve large collections of resources. </p>"},{"location":"scalability/docs/kubernetes_slos/#pod-startup-latency","title":"Pod Startup Latency","text":"<p>This SLO is primarily concerned with the time it takes from Pod creation to when the containers in that Pod actually begin execution. To measure this the difference from the creation timestamp recorded on the Pod, and when a WATCH on that Pod reports the containers have started is calculated (excluding time for container image pulls and init container execution). To satisfy the SLO the 99th percentile per cluster-day of this Pod Startup Latency must remain &lt;=5 seconds. </p> <p>Note that this SLO assumes that the worker nodes already exist in this cluster in a ready state for the Pod to be scheduled on. This SLO does not account for image pulls or init container executions, and also limits the test to \u201cstateless pods\u201d which don\u2019t leverage persistent storage plugins. </p>"},{"location":"scalability/docs/kubernetes_slos/#kubernetes-sli-metrics","title":"Kubernetes SLI Metrics","text":"<p>Kubernetes is also improving the Observability around the SLIs by adding Prometheus metrics to Kubernetes components that track these SLIs over time. Using Prometheus Query Language (PromQL) we can build queries that display the SLI performance over time in tools like Prometheus or Grafana dashboards, below are some examples for the SLOs above.</p>"},{"location":"scalability/docs/kubernetes_slos/#api-server-request-latency","title":"API Server Request Latency","text":"Metric Definition apiserver_request_sli_duration_seconds Response latency distribution (not counting webhook duration and priority &amp; fairness queue wait times) in seconds for each verb, group, version, resource, subresource, scope and component. apiserver_request_duration_seconds Response latency distribution in seconds for each verb, dry run value, group, version, resource, subresource, scope and component. <p>Note: The <code>apiserver_request_sli_duration_seconds</code> metric is available starting in Kubernetes 1.27.</p> <p>You can use these metrics to investigate the API Server response times and if there are bottlenecks in the Kubernetes components or other plugins/components. The queries below are based on the community SLO dashboard. </p> <p>API Request latency SLI (mutating) - this time does not include webhook execution or time waiting in queue.  <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"CREATE|DELETE|PATCH|POST|PUT\", subresource!~\"proxy|attach|log|exec|portforward\"}[5m])) by (resource, subresource, verb, scope, le)) &gt; 0</code></p> <p>API Request latency Total (mutating) - this is the total time the request took on the API server, this time may be longer than the SLI time because it includes webhook execution and API Priority and Fairness wait times. <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"CREATE|DELETE|PATCH|POST|PUT\", subresource!~\"proxy|attach|log|exec|portforward\"}[5m])) by (resource, subresource, verb, scope, le)) &gt; 0</code></p> <p>In these queries we are excluding the streaming API requests which do not return immediately, such as <code>kubectl port-forward</code> or <code>kubectl exec</code> requests (<code>subresource!~\"proxy|attach|log|exec|portforward\"</code>), and we are filtering for only the Kubernetes verbs that modify objects (<code>verb=~\"CREATE|DELETE|PATCH|POST|PUT\"</code>). We are then calculating the 99th percentile of that latency over the last 5 minutes.</p> <p>We can use a similar query for the read only API requests, we simply modify the verbs we\u2019re filtering for to include the Read only actions <code>LIST</code> and <code>GET</code>. There are also different SLO thresholds depending on the scope of the request, i.e. getting a single resource or listing a number of resources.</p> <p>API Request latency SLI  (read-only) - this time does not include webhook execution or time waiting in queue. For a single resource (scope=resource, threshold=1s) <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"GET\", scope=~\"resource\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>For a collection of resources in the same namespace (scope=namespace, threshold=5s) <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"LIST\", scope=~\"namespace\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>For a collection of resources across the entire cluster (scope=cluster, threshold=30s) <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"LIST\", scope=~\"cluster\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>API Request latency Total (read-only) - this is the total time the request took on the API server, this time may be longer than the SLI time because it includes webhook execution and wait times. For a single resource (scope=resource, threshold=1s) <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"GET\", scope=~\"resource\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>For a collection of resources in the same namespace (scope=namespace, threshold=5s) <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"LIST\", scope=~\"namespace\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>For a collection of resources across the entire cluster (scope=cluster, threshold=30s) <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"LIST\", scope=~\"cluster\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>The SLI metrics provide insight into how Kubernetes components are performing by excluding the time that requests spend waiting in API Priority and Fairness queues, working through admission webhooks, or other Kubernetes extensions. The total metrics provide a more holistic view as it reflects the time your applications would be waiting for a response from the API server. Comparing these metrics can provide insight into where the delays in request processing are being introduced. </p>"},{"location":"scalability/docs/kubernetes_slos/#pod-startup-latency_1","title":"Pod Startup Latency","text":"Metric Definition kubelet_pod_start_sli_duration_seconds Duration in seconds to start a pod, excluding time to pull images and run init containers, measured from pod creation timestamp to when all its containers are reported as started and observed via watch kubelet_pod_start_duration_seconds Duration in seconds from kubelet seeing a pod for the first time to the pod starting to run. This does not include the time to schedule the pod or scale out worker node capacity. <p>Note:  <code>kubelet_pod_start_sli_duration_seconds</code> is available starting in Kubernetes 1.27.</p> <p>Similar to the queries above you can use these metrics to gain insight into how long node scaling, image pulls and init containers are delaying the pod launch compared to Kubelet actions. </p> <p>Pod startup latency SLI - this is the time from the pod being created to when the application containers reported as running. This includes the time it takes for the worker node capacity to be available and the pod to be scheduled, but this does not include the time it takes to pull images or for the init containers to run. <code>histogram_quantile(0.99, sum(rate(kubelet_pod_start_sli_duration_seconds_bucket[5m])) by (le))</code></p> <p>Pod startup latency Total - this is the time it takes the kubelet to start the pod for the first time. This is measured from when the kubelet recieves the pod via WATCH, which does not include the time for worker node scaling or scheduling. This includes the time to pull images and init containers to run. <code>histogram_quantile(0.99, sum(rate(kubelet_pod_start_duration_seconds_bucket[5m])) by (le))</code></p>"},{"location":"scalability/docs/kubernetes_slos/#slos-on-your-cluster","title":"SLOs on Your Cluster","text":"<p>If you are collecting the Prometheus metrics from the Kubernetes resources in your EKS cluster you can gain deeper insights into the performance of the Kubernetes control plane components. </p> <p>The perf-tests repo includes Grafana dashboards that display the latencies and critical performance metrics for the cluster during tests. The perf-tests configuration leverages the kube-prometheus-stack, an open source project that comes configured to collect Kubernetes metrics, but you can also use Amazon Managed Prometheus and Amazon Managed Grafana.</p> <p>If you are using the <code>kube-prometheus-stack</code> or similar Prometheus solution you can install the same dashboard to observe the SLOs on your cluster in real time. </p> <ol> <li>You will first need to install the Prometheus Rules that are used in the dashboards with <code>kubectl apply -f prometheus-rules.yaml</code>. You can download a copy of the rules here: https://github.com/kubernetes/perf-tests/blob/master/clusterloader2/pkg/prometheus/manifests/prometheus-rules.yaml<ol> <li>Be sure to check the namespace in the file matches your environment</li> <li>Verify that the labels match the <code>prometheus.prometheusSpec.ruleSelector</code> helm value if you are using <code>kube-prometheus-stack</code></li> </ol> </li> <li>You can then install the dashboards in Grafana. The json dashboards and python scripts to generate them are available here: https://github.com/kubernetes/perf-tests/tree/master/clusterloader2/pkg/prometheus/manifests/dashboards<ol> <li>the <code>slo.json</code> dashboard displays the performance of the cluster in relation to the Kubernetes SLOs</li> </ol> </li> </ol> <p>Consider that the SLOs are focused on the performance of the Kubernetes components in your clusters, but there are additional metrics you can review which provide different perspectives or insights in to your cluster. Kubernetes community projects like Kube-state-metrics can help you quickly analyze trends in your cluster. Most common plugins and drivers from the Kubernetes community also emit Prometheus metrics, allowing you to investigate things like autoscalers or custom schedulers.  </p> <p>The Observability Best Practices Guide has examples of other Kubernetes metrics you can use to gain further insight. </p>"},{"location":"scalability/docs/node_efficiency/","title":"Node and Workload Efficiency","text":"<p>Being efficient with our workloads and nodes reduces complexity/cost while increasing performance and scale. There are many factors to consider when planning this efficiency, and it\u2019s easiest to think in terms of trade offs vs. one best practice setting for each feature. Let\u2019s explore these tradeoffs in depth in the following section.     </p>"},{"location":"scalability/docs/node_efficiency/#node-selection","title":"Node Selection","text":"<p>Using node sizes that are slightly larger (4-12xlarge) increases the available space that we have for running pods due to the fact it reduces the percentage of the node used for \u201coverhead\u201d such as DaemonSets and Reserves for system components. In the diagram below we see the difference between the usable space on a 2xlarge vs. a 8xlarge system with just a moderate number of DaemonSets. </p> <p>Note</p> <p>Since k8s scales horizontally as a general rule, for most applications it does not make sense to take the performance impact of NUMA sizes nodes, thus the recommendation of a range below that node size.</p> <p></p> <p>Large nodes sizes allow us to have a higher percentage of usable space per node. However, this model can be taken to to the extreme by packing the node with so many pods that it causes errors or saturates the node. Monitoring node saturation is key to successfully using larger node sizes. </p> <p>Node selection is rarely a one-size-fits-all proposition. Often it is best to split workloads with dramatically different churn rates into different node groups. Small batch workloads with a high churn rate would be best served by the the 4xlarge family of instances, while a large scale application such as Kafka which takes 8 vCPU and has a low churn rate would be better served by the 12xlarge family.   </p> <p></p> <p>Tip</p> <p>Another factor to consider with very large node sizes is since CGROUPS do not hide the total number of vCPU from the containerized application. Dynamic runtimes can often spawn an unintentional number of OS threads, creating latency that is difficult to troubleshoot. For these application CPU pinning is recommend. For a deeper exploration of topic please see the following video https://www.youtube.com/watch?v=NqtfDy_KAqg</p>"},{"location":"scalability/docs/node_efficiency/#node-bin-packing","title":"Node Bin-packing","text":""},{"location":"scalability/docs/node_efficiency/#kubernetes-vs-linux-rules","title":"Kubernetes vs. Linux Rules","text":"<p>There are two sets of rules we need to be mindful of when dealing with workloads on Kubernetes. The rules of the Kubernetes Scheduler, which uses the request value to schedule pods on a node, and then what happens after the pod is scheduled, which is the realm of Linux, not Kubernetes.</p> <p>After Kubernetes scheduler is finished, a new set of rules takes over, the Linux Completely Fair Scheduler (CFS). The key take away is that Linux CFS doesn\u2019t have a the concept of a core. We will discuss why thinking in cores can lead to major problems with optimizing workloads for scale.  </p>"},{"location":"scalability/docs/node_efficiency/#thinking-in-cores","title":"Thinking in Cores","text":"<p>The confusion starts because the Kubernetes scheduler does have the concept of cores. From a Kubernetes scheduler perspective if we looked at a node with 4 NGINX pods, each with a request of one core set, the node would look like this.</p> <p></p> <p>However, let\u2019s do a thought experiment on how different this looks from a Linux CFS perspective. The most important thing to remember when using the Linux CFS system is: busy containers (CGROUPS) are the only containers that count toward the share system. In this case, only the first container is busy so it is allowed to use all 4 cores on the node.</p> <p></p> <p>Why does this matter? Let\u2019s say we ran our performance testing in a development cluster where an NGINX application was the only busy container on that node. When we move the app to production, the following would happen: the NGINX application wants 4 vCPU of resources however, because all the other pods on the node are busy, our app\u2019s performance is constrained. </p> <p></p> <p>This situation would lead us to add more containers unnecessarily because we were not allowing our applications scale to their \u201csweet spot\u201c. Let's explore this important concept of a \u201dsweet spot\u201c in a bit more detail.</p>"},{"location":"scalability/docs/node_efficiency/#application-right-sizing","title":"Application right sizing","text":"<p>Each application has a certain point where it can not take anymore traffic. Going above this point can increase processing times and even drop traffic when pushed well beyond this point. This is known as the application\u2019s saturation point. To avoid scaling issues, we should attempt to scale the application before it reaches its saturation point. Let\u2019s call this point the sweet spot. </p> <p></p> <p>We need to test each of our applications to understand its sweet spot. There will be no universal guidance here as each application is different. During this testing we are trying to understand the best metric that shows our applications saturation point. Oftentimes, utilization metrics are used to indicate an application is saturated but this can quickly lead to scaling issues (We will explore this topic in detail in a later section). Once we have this \u201csweet spot\u201c we can use it to efficiently scale our workloads.</p> <p>Conversely, what would happen if we scale up well before the sweet spot and created unnecessary pods? Let\u2019s explore that in the next section. </p>"},{"location":"scalability/docs/node_efficiency/#pod-sprawl","title":"Pod sprawl","text":"<p>To see how creating unnecessary pods could quickly get out of hand, let's look at the first example on the left. The correct vertical scale of this container takes up about two vCPUs worth of utilization when handling 100 requests a second. However, If we were to under-provision the requests value by setting requests to half a core, we would now need 4 pods for each one pods we actually needed. Exacerbating this problem further, if our HPA was set at the default of 50% CPU, those pods would scale half empty, creating an 8:1 ratio. </p> <p></p> <p>Scaling this problem up we can quickly see how this can get out of hand. A deployment of ten pods whose sweet spot was set incorrectly could quickly spiral to 80 pods and the additional infrastructure needed to run them. </p> <p></p> <p>Now that we understand the impact of not allowing applications to operate in their sweet spot, let\u2019s return to the node level and ask why this difference between the Kubernetes scheduler and Linux CFS so important?</p> <p>When scaling up and down with HPA, we can have a scenario where we have a lot of space to allocate more pods. This would be a bad decision because the node depicted on the left is already at 100% CPU utilization. In a unrealistic but theoretically possible scenario, we could have the other extreme where our node is completely full, yet our CPU utilization is zero. </p> <p></p>"},{"location":"scalability/docs/node_efficiency/#setting-requests","title":"Setting Requests","text":"<p>It would tempting to set the request at the \u201csweet spot\u201d value for that application, however this would cause inefficiencies as pictured in the diagram below.  Here we have set the request value to 2 vCPU, however the average utilization of these pods runs only 1 CPU most of the time. This setting would cause us to waste 50% of our CPU cycles, which would be unacceptable. </p> <p></p> <p>This bring us to the complex answer to problem. Container utilization cannot be thought of in a vacuum; one must take into account the other applications running on the node. In the following example containers that are bursty in nature are mixed in with two low CPU utilization containers that might be memory constrained. In this way we allow the containers to hit their sweet spot without taxing the node.   </p> <p></p> <p>The important concept to take away from all this is that using Kubernetes scheduler concept of cores to understand Linux container performance can lead to poor decision making as they are not related. </p> <p>Tip</p> <p>Linux CFS has its strong points. This is especially true for I/O based workloads. However, if your application uses full cores without sidecars, and has no I/O requirements, CPU pinning can remove a great deal of complexity from this process and is encouraged with those caveats.</p>"},{"location":"scalability/docs/node_efficiency/#utilization-vs-saturation","title":"Utilization vs. Saturation","text":"<p>A common mistake in application scaling is only using CPU utilization for your scaling metric. In complex applications this is almost always a poor indicator that an application is actually saturated with requests. In the example on the left, we see all of our requests are actually hitting the web server, so CPU utilization is tracking well with saturation. </p> <p>In real world applications, it\u2019s likely that some of those requests will be getting serviced by a database layer or an authentication layer, etc. In this more common case, notice CPU is not tracking with saturation as the request is being serviced by other entities. In this case CPU is a very poor indicator for saturation.</p> <p></p> <p>Using the wrong metric in application performance is the number one reason for unnecessary and unpredictable scaling in Kubernetes. Great care must be taken in picking the correct saturation metric for the type of application that you're using. It is important to note that there is not a one size fits all recommendation that can be given. Depending on the language used and the type of application in question, there is a diverse set of metrics for saturation.</p> <p>We might think this problem is only with CPU Utilization, however other common metrics such as request per second can also fall into the exact same problem as discussed above.  Notice the request can also go to DB layers, auth layers, not being directly serviced by our web server, thus it\u2019s a poor metric for true saturation of the web server itself.</p> <p></p> <p>Unfortunately there are no easy answers when it comes to picking the right saturation metric. Here are some guidelines to take into consideration: </p> <ul> <li>Understand your language runtime - languages with multiple OS threads will react differently than single threaded applications, thus impacting the node differently.</li> <li>Understand the correct vertical scale - how much buffer do you want in your applications vertical scale before scaling a new pod?  </li> <li>What metrics truly reflect the saturation of your application - The saturation metric for a Kafka Producer would be quite different than a complex web application. </li> <li>How do all the other applications on the node effect each other - Application performance is not done in a vacuum the other workloads on the node have a major impact.</li> </ul> <p>To close out this section, it would be easy to dismiss the above as overly complex and unnecessary. It can often be the case that we are experiencing an issue but we are unaware of the true nature of the problem because we are looking at the wrong metrics. In the next section we will look at how that could happen. </p>"},{"location":"scalability/docs/node_efficiency/#node-saturation","title":"Node Saturation","text":"<p>Now that we have explored application saturation, let\u2019s look at this same concept from a node point of view. Let\u2019s take two CPUs that are 100% utilized to see the difference between utilization vs. saturation. </p> <p>The vCPU on the left is 100% utilized, however no other tasks are waiting to run on this vCPU, so in a purely theoretical sense, this is quite efficient. Meanwhile, we have 20 single threaded applications waiting to get processed by a vCPU in the second example. All 20 applications now will experience some type of latency while they're waiting their turn to be processed by the vCPU. In other words, the vCPU on the right is saturated.  </p> <p>Not only would we not see this problem if we where just looking at utilization, but we might attribute this latency to something unrelated such as networking which would lead us down the wrong path. </p> <p></p> <p>It is important to view saturation metrics, not just utilization metrics when increasing the total number of pods running on a node at any given time as we can easily miss the fact we have over-saturated a node. For this task we can use pressure stall information metrics as seen in the below chart.</p> <p>PromQL - Stalled I/O</p> <pre><code>topk(3, ((irate(node_pressure_io_stalled_seconds_total[1m])) * 100))\n</code></pre> <p></p> <p>Note</p> <p>For more on Pressure stall metrics, see https://facebookmicrosites.github.io/psi/docs/overview*</p> <p>With these metrics we can tell if threads are waiting on CPU, or even if every thread on the box is stalled waiting on resource like memory or I/O. For example, we could see what percentage every thread on the instance was stalled waiting on I/O over the period of 1 min.  </p> <pre><code>topk(3, ((irate(node_pressure_io_stalled_seconds_total[1m])) * 100))\n</code></pre> <p>Using this metric, we can see in the above chart every thread on the box was stalled 45% of the time waiting on I/O at the high water mark, meaning we were throwing away all of those CPU cycles in that minute. Understanding that this is happening can help us reclaim a significant amount of vCPU time, thus making scaling more efficient. </p>"},{"location":"scalability/docs/node_efficiency/#hpa-v2","title":"HPA V2","text":"<p>It is recommended to use the autoscaling/v2 version of the HPA API. The older versions of the HPA API could get stuck scaling in certain edge cases. It was also limited to pods only doubling during each scaling step, which created issues for small deployments that needed to scale rapidly.  </p> <p>Autoscaling/v2 allows us more flexibility to include multiple criteria to scale on and allows us a great deal of flexibility when using custom and external metrics (non K8s metrics).</p> <p>As an example, we can scaling on the highest of three values (see below). We scale if the average utilization of all the pods are over 50%, if custom metrics the packets per second of the ingress exceed an average of 1,000, or ingress object exceeds 10K request per second.</p> <p>Note</p> <p>This is just to show the flexibility of the auto-scaling API, we recommend against overly complex rules that can be difficult to troubleshoot in production. </p> <pre><code>apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: php-apache\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: php-apache\n  minReplicas: 1\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 50\n  - type: Pods\n    pods:\n      metric:\n        name: packets-per-second\n      target:\n        type: AverageValue\n        averageValue: 1k\n  - type: Object\n    object:\n      metric:\n        name: requests-per-second\n      describedObject:\n        apiVersion: networking.k8s.io/v1\n        kind: Ingress\n        name: main-route\n      target:\n        type: Value\n        value: 10k\n</code></pre> <p>However, we learned the danger of using such metrics for complex web applications. In this case we would be better served by using custom or external metric that accurately reflects the saturation of our application vs. the utilization. HPAv2 allows for this by having the ability to scale according to any metric, however we still need to find and export that metric to Kubernetes for use.</p> <p>For example, we can look at the active thread queue count in Apache. This often creates a \u201csmoother\u201d scaling profile (more on that term soon). If a thread is active, it doesn\u2019t matter if that thread is waiting on a database layer or servicing a request locally, if all of the applications threads are being used, it\u2019s a great indication that application is saturated. </p> <p>We can use this thread exhaustion as a signal to create a new pod with a fully available thread pool. This also gives us control over how big a buffer we want in the application to absorb during times of heavy traffic. For example, if we had a total thread pool of 10, scaling at 4 threads used vs. 8 threads used would have a major impact on the buffer we have available when scaling the application. A setting of 4 would make sense for an application that needs to rapidly scale under heavy load, where a setting of 8 would be more efficient with our resources if we had plenty of time to scale due to the number of requests increasing slowly vs. sharply over time. </p> <p></p> <p>What do we mean by the term \u201csmooth\u201d when it comes to scaling? Notice the below chart where we are using CPU as a metric. The pods in this deployment are spiking in a short period for from 50 pods, all the way up to 250 pods only to immediately scale down again. This is highly inefficient scaling is the leading cause on churn on clusters.</p> <p></p> <p>Notice how after we change to a metric that reflects the correct sweet spot of our application (mid-part of chart), we are able to scale smoothly. Our scaling is now efficient, and our pods are allowed to fully scale with the headroom we provided by adjusting requests settings. Now a smaller group of pods are doing the work the hundreds of pods were doing before.  Real world data shows that this is the number one factor in scalability of Kubernetes clusters. </p> <p></p> <p>The key takeaway is CPU utilization is only one dimension of both application and node performance. Using CPU utilization as a sole health indicator for our nodes and applications creates problems in scaling, performance and cost which are all tightly linked concepts. The more performant the application and nodes are, the less that you need to scale, which in turn lowers your costs. </p> <p>Finding and using the correct saturation metrics for scaling your particular application also allows you to monitor and alarm on the true bottlenecks for that application. If this critical step is skipped, reports of performance problems will be difficult, if not impossible, to understand.  </p>"},{"location":"scalability/docs/node_efficiency/#setting-cpu-limits","title":"Setting CPU Limits","text":"<p>To round out this section on misunderstood topics, we will cover CPU limits. In short, limits are metadata associated with the container that has a counter that resets every 100ms. This helps Linux keep track of how many CPU resources are used node-wide by a specific container in a 100ms period of time. </p> <p></p> <p>A common error with setting limits is assuming that the application is single threaded and only running on it\u2019s \u201cassigned\u201c vCPU. In the above section we learned that CFS doesn\u2019t assign cores, and in reality a container running large thread pools will schedule on all available vCPU\u2019s on the box. </p> <p>If 64 OS threads are running across 64 available cores (from a Linux node perspective) we will make the total bill of used CPU time in a 100ms period quite large after the time running on all of those 64 cores are added up. Since this might only occur during a garbage collection process it can be quite easy to miss something like this. This is why it is necessary to use metrics to ensure we have the correct usage over time before attempting to set a limit. </p> <p>Fortunately, we have a way to see exactly how much vCPU is being used by all the threads in a application. We will use the metric <code>container_cpu_usage_seconds_total</code> for this purpose. </p> <p>Since throttling logic happens every 100ms and this metric is a per second metric, we will PromQL to match this 100ms period. If you would like to dive deep into this PromQL statement work please see the following blog.</p> <p>PromQL query: </p> <pre><code>topk(3, max by (pod, container)(rate(container_cpu_usage_seconds_total{image!=\"\", instance=\"$instance\"}[$__rate_interval]))) / 10\n</code></pre> <p></p> <p>Once we feel we have the right value, we can put the limit in production. It then becomes necessary to see if our application is being throttled due to something unexpected. We can do this by looking at  <code>container_cpu_throttled_seconds_total</code></p> <pre><code>topk(3, max by (pod, container)(rate(container_cpu_cfs_throttled_seconds_total{image!=``\"\"``, instance=``\"$instance\"``}[$__rate_interval]))) / 10\n</code></pre> <p></p>"},{"location":"scalability/docs/node_efficiency/#memory","title":"Memory","text":"<p>The memory allocation is another example where it is easy to confuse Kubernetes scheduling behavior for Linux CGroup behavior. This is a more nuanced topic as there have been major changes in the way that CGroup v2 handles memory in Linux and Kubernetes has changed its syntax to reflect this; read this blog for further details.</p> <p>Unlike CPU requests, memory requests go unused after the scheduling process completes. This is because we can not compress memory in CGroup v1 the same way we can with CPU. That leaves us with just memory limits, which are designed to act as a fail safe for memory leaks by terminating the pod completely. This is an all or nothing style proposition, however we have now been given new ways to address this problem.</p> <p>First, it is important to understand that setting the right amount of memory for containers is not a straightforward as it appears. The file system in Linux will use memory as a cache to improve performance. This cache will grow over time, and it can be hard to know how much memory is just nice to have for the cache but can be reclaimed without a significant impact to application performance. This often results in misinterpreting memory usage.</p> <p>Having the ability to \u201ccompress\u201d memory was one of the primary drivers behind CGroup v2. For more history on why CGroup V2 was necessary, please see Chris Down\u2019s presentation at LISA21 where he covers why being unable to set the minimum memory correctly was one of the reasons that drove him to create CGroup v2  and pressure stall metrics. </p> <p>Fortunately, Kubernetes now has the concept of <code>memory.min</code> and <code>memory.high</code> under <code>requests.memory</code>. This gives us the option of aggressive releasing this cached memory for other containers to use. Once the container hits the memory high limit, the kernel can aggressively reclaim that container\u2019s memory up to the value set at <code>memory.min</code>. Thus giving us more flexibility when a node comes under memory pressure.</p> <p>The key question becomes, what value to set <code>memory.min</code> to? This is where memory pressure stall metrics come into play. We can use these metrics to detect memory \u201cthrashing\u201d at a container level. Then we can use controllers such as fbtax to detect the correct values for <code>memory.min</code> by looking for this memory thrashing, and dynamically set the <code>memory.min</code> value to this setting. </p>"},{"location":"scalability/docs/node_efficiency/#summary","title":"Summary","text":"<p>To sum up the section, it is easy to conflate the following concepts: </p> <ul> <li>Utilization and Saturation  </li> <li>Linux performance rules with Kubernetes Scheduler logic</li> </ul> <p>Great care must be taken to keep these concepts separated. Performance and scale are linked on a deep level. Unnecessary scaling creates performance problems, which in turn creates scaling problems. </p>"},{"location":"scalability/docs/quotas/","title":"Known Limits and Service Quotas","text":"<p>Amazon EKS can be used for a variety of workloads and can interact with a wide range of AWS services, and we have seen customer workloads encounter a similar range of AWS service quotas and other issues that hamper scalability. </p> <p>Your AWS account has default quotas (an upper limit on the number of each AWS resource your team can request). Each AWS service defines their own quota, and quotas are generally region-specific. You can request increases for some quotas (soft limits), and other quotas cannot be increased (hard limits). You should consider these values when architecting your applications. Consider reviewing these service limits periodically and incorporate them during in your application design.</p> <p>You can review the usage in your account and open a quota increase request at the AWS Service Quotas console, or using the AWS CLI. Refer to the AWS documentation from the respective AWS Service for more details on the Service Quotas and any further restrictions or notices on their increase.</p> <p>Note</p> <p>Amazon EKS Service Quotas lists the service quotas and has links to request increases where available.</p>"},{"location":"scalability/docs/quotas/#other-aws-service-quotas","title":"Other AWS Service Quotas","text":"<p>We have seen EKS customers impacted by the quotas listed below for other AWS services. Some of these may only apply to specific use cases or configurations, however you may consider if your solution will encounter any of these as it scales. The Quotas are organized by Service and each Quota has an ID in the format of L-XXXXXXXX you can use to look it up in the AWS Service Quotas console</p> Service Quota (L-xxxxx) Impact ID (L-xxxxx) default IAM Roles per account Can limit the number of clusters or IRSA roles in an account. L-FE177D64 1,000 IAM OpenId connect providers per account Can limit the number of Clusters per account, OpenID Connect is used by IRSA L-858F3967 100 IAM Role trust policy length Can limit the number of of clusters an IAM role is associated with for IRSA L-C07B4B0D 2,048 VPC Security groups per network interface Can limit the control or connectivity of the networking for your cluster L-2AFB9258 5 VPC IPv4 CIDR blocks per VPC Can limit the number of EKS Worker Nodes L-83CA0A9D 5 VPC Routes per route table Can limit the control or connectivity of the networking for your cluster L-93826ACB 50 VPC Active VPC peering connections per VPC Can limit the control or connectivity of the networking for your cluster L-7E9ECCDB 50 VPC Inbound or outbound rules per security group. Can limit the control or connectivity of the networking for your cluster, some controllers in EKS create new rules L-0EA8095F 50 VPC VPCs per Region Can limit the number of Clusters per account or the control or connectivity of the networking for your cluster L-F678F1CE 5 VPC Internet gateways per Region Can limit the number of Clusters per account or the control or connectivity of the networking for your cluster L-A4707A72 5 VPC Network interfaces per Region Can limit the number of EKS Worker nodes, or Impact EKS control plane scaling/update activities. L-DF5E4CA3 5,000 VPC Network Address Usage Can limit the number of Clusters per account or the control or connectivity of the networking for your cluster L-BB24F6E5 64,000 VPC Peered Network Address Usage Can limit the number of Clusters per account or the control or connectivity of the networking for your cluster L-CD17FD4B 128,000 ELB Listeners per Network Load Balancer Can limit the control of traffic ingress to the cluster. L-57A373D6 50 ELB Target Groups per Region Can limit the control of traffic ingress to the cluster. L-B22855CB 3,000 ELB Targets per Application Load Balancer Can limit the control of traffic ingress to the cluster. L-7E6692B2 1,000 ELB Targets per Network Load Balancer Can limit the control of traffic ingress to the cluster. L-EEF1AD04 3,000 ELB Targets per Availability Zone per Network Load Balancer Can limit the control of traffic ingress to the cluster. L-B211E961 500 ELB Targets per Target Group per Region Can limit the control of traffic ingress to the cluster. L-A0D0B863 1,000 ELB Application Load Balancers per Region Can limit the control of traffic ingress to the cluster. L-53DA6B97 50 ELB Classic Load Balancers per Region Can limit the control of traffic ingress to the cluster. L-E9E9831D 20 ELB Network Load Balancers per Region Can limit the control of traffic ingress to the cluster. L-69A177A2 50 EC2 Running On-Demand Standard (A, C, D, H, I, M, R, T, Z) instances (as a maximum vCPU count) Can limit the number of EKS Worker Nodes L-1216C47A 5 EC2 All Standard (A, C, D, H, I, M, R, T, Z) Spot Instance Requests (as a maximum vCPU count) Can limit the number of EKS Worker Nodes L-34B43A08 5 EC2 EC2-VPC Elastic IPs Can limit the number of NAT GWs (and thus VPCs), which may limit the number of clusters in a region L-0263D0A3 5 EBS Snapshots per Region Can limit the backup strategy for stateful workloads L-309BACF6 100,000 EBS Storage for General Purpose SSD (gp3) volumes, in TiB Can limit the number of EKS Worker Nodes, or PersistentVolume storage L-7A658B76 50 EBS Storage for General Purpose SSD (gp2) volumes, in TiB Can limit the number of EKS Worker Nodes,  or PersistentVolume storage L-D18FCD1D 50 ECR Registered repositories Can limit the number of workloads in your clusters L-CFEB8E8D 10,000 ECR Images per repository Can limit the number of workloads in your clusters L-03A36CE1 10,000 SecretsManager Secrets per Region Can limit the number of workloads in your clusters L-2F66C23C 500,000"},{"location":"scalability/docs/quotas/#aws-request-throttling","title":"AWS Request Throttling","text":"<p>AWS services also implement request throttling to ensure that they remain performant and available for all customers. Simliar to Service Quotas, each AWS service maintains their own request throttling thresholds. Consider reviewing the respective AWS Service documentation if your workloads will need to quickly issue a large number of API calls or if you notice request throttling errors in your application. </p> <p>EC2 API requests around provisioning EC2 network interfaces or IP addresses can encounter request throttling in large clusters or when clusters scale drastically. The table below shows some of the API actions that we have seen customers encounter request throttling from. You can review the EC2 rate limit defaults and the steps to request a rate limit increase in the EC2 documentation on Rate Throttling.</p> Mutating Actions Read-only Actions AssignPrivateIpAddresses DescribeDhcpOptions AttachNetworkInterface DescribeInstances CreateNetworkInterface DescribeNetworkInterfaces DeleteNetworkInterface DescribeSecurityGroups DeleteTags DescribeTags DetachNetworkInterface DescribeVpcs ModifyNetworkInterfaceAttribute DescribeVolumes UnassignPrivateIpAddresses"},{"location":"scalability/docs/quotas/#other-known-limits","title":"Other Known Limits","text":"<ul> <li> <p>Route 53 DNS resolvers are limited to 1024 Packets per second. This limit can be encountered when DNS traffic from a large cluster is funneled through a small number of CoreDNS Pod replicas. Scaling CoreDNS and optimizing DNS behavior can avoid timeouts on DNS lookups.</p> <ul> <li>Route 53 also has a fairly low rate limit of 5 requests per second to the Route 53 API. If you have a large number of domains to update with a project like External DNS you may see rate throttling and delays in updating domains.</li> </ul> </li> <li> <p>Some Nitro instance types have a volume attachment limit of 28 that is shared between Amazon EBS volumes, network interfaces, and NVMe instance store volumes. If your workloads are mounting numerous EBS volumes you may encounter limits to the pod density you can achieve with these instance types</p> </li> <li> <p>There is a maximum number of connections that can be tracked per Ec2 instance. If your workloads are handling a large number of connections you may see communication failures or errors because this maximum has been hit. You can use the <code>conntrack_allowance_available</code> and <code>conntrack_allowance_exceeded</code> network performance metrics to monitor the number of tracked connections on your EKS worker nodes.</p> </li> <li> <p>In EKS environment, etcd storage limit is 8 GiB as per upstream guidance. Please monitor metric <code>etcd_db_total_size_in_bytes</code> to track etcd db size. You can refer to alert rules <code>etcdBackendQuotaLowSpace</code> and <code>etcdExcessiveDatabaseGrowth</code> to setup this monitoring.</p> </li> </ul>"},{"location":"scalability/docs/scaling_theory/","title":"Kubernetes Scaling Theory","text":""},{"location":"scalability/docs/scaling_theory/#nodes-vs-churn-rate","title":"Nodes vs. Churn Rate","text":"<p>Often when we discuss the scalability of Kubernetes, we do so in terms of how many nodes there are in a single cluster. Interestingly, this is seldom the most useful metric for understanding scalability. For example, a 5,000 node cluster with a large but fixed number of pods would not put a great deal of stress on the control plane after the initial setup. However, if we took a 1,000 node cluster and tried creating 10,000 short lived jobs in less than a minute, it would put a great deal of sustained pressure on the control plane. </p> <p>Simply using the number of nodes to understand scaling can be misleading. It\u2019s better to think in terms of the rate of change that occurs within a specific period of time (let\u2019s use a 5 minute interval for this discussion, as this is what Prometheus queries typically use by default). Let\u2019s explore why framing the problem in terms of the rate of change can give us a better idea of what to tune to achieve our desired scale. </p>"},{"location":"scalability/docs/scaling_theory/#thinking-in-queries-per-second","title":"Thinking in Queries Per Second","text":"<p>Kubernetes has a number of protection mechanisms for each component - the Kubelet, Scheduler, Kube Controller Manager, and API server - to prevent overwhelming the next link in the Kubernetes chain. For example, the Kubelet has a flag to throttle calls to the API server at a certain rate. These protection mechanisms are generally, but not always, expressed in terms of queries allowed on a per second basis or QPS. </p> <p>Great care must be taken when changing these QPS settings. Removing one bottleneck, such as the queries per second on a Kubelet will have an impact on other down stream components. This can and will overwhelm the system above a certain rate, so understanding and monitoring each part of the service chain is key to successfully scaling workloads on Kubernetes.</p> <p>Note</p> <p>The API server has a more complex system with introduction of API Priority and Fairness which we will discuss separately.</p> <p>Note</p> <p>Caution, some metrics seem like the right fit but are in fact measuring something else. As an example, <code>kubelet_http_inflight_requests</code> relates to just the metrics server in Kubelet, not the number of requests from Kubelet to apiserver requests. This could cause us to misconfigure the QPS flag on the Kubelet. A query on audit logs for a particular Kubelet would be a more reliable way to check metrics.</p>"},{"location":"scalability/docs/scaling_theory/#scaling-distributed-components","title":"Scaling Distributed Components","text":"<p>Since EKS is a managed service, let\u2019s split the Kubernetes components into two categories: AWS managed components which include etcd, Kube Controller Manager, and the Scheduler (on the left part of diagram), and customer configurable components such as the Kubelet, Container Runtime, and the various operators that call AWS APIs such as the Networking and Storage drivers (on the right part of diagram). We leave the API server in the middle even though it is AWS managed, as the settings for API Priority and Fairness can be configured by customers. </p> <p></p>"},{"location":"scalability/docs/scaling_theory/#upstream-and-downstream-bottlenecks","title":"Upstream and Downstream Bottlenecks","text":"<p>As we monitor each service, it\u2019s important to look at metrics in both directions to look for bottlenecks. Let\u2019s learn how to do this by using Kubelet as an example. Kubelet talks both to the API server and the container runtime; how and what do we need to monitor to detect whether either component is experiencing an issue?</p>"},{"location":"scalability/docs/scaling_theory/#how-many-pods-per-node","title":"How many Pods per Node","text":"<p>When we look at scaling numbers, such as how many pods can run on a node, we could take the 110 pods per node that upstream supports at face value. </p> <p>Note</p> <p>https://kubernetes.io/docs/setup/best-practices/cluster-large/</p> <p>However, your workload is likely more complex than what was tested in a scalability test in Upstream. To ensure we can service the number of pods we want to run in production, let\u2019s make sure that the Kubelet is \u201ckeeping up\u201d with the Containerd runtime. </p> <p></p> <p>To oversimplify, the Kubelet is getting the status of the pods from the container runtime (in our case Containerd). What if we had too many pods changing status too quickly? If the rate of change is too high, requests [to the container runtime] can timeout.</p> <p>Note</p> <p>Kubernetes is constantly evolving, this subsystem is currently undergoing changes. https://github.com/kubernetes/enhancements/issues/3386</p> <p> </p> <p>In the graph above, we see a flat line indicating we have just hit the timeout value for the pod lifecycle event generation duration metric. If you would like to see this in your own cluster you could use the following PromQL syntax.</p> <pre><code>increase(kubelet_pleg_relist_duration_seconds_bucket{instance=\"$instance\"}[$__rate_interval])\n</code></pre> <p>If we witness this timeout behavior, we know we pushed the node over the limit it was capable of. We need to fix the cause of the timeout before proceeding further. This could be achieved by reducing the number of pods per node, or looking for errors that might be causing a high volume of retries (thus effecting the churn rate). The important take-away is that metrics are the best way to understand if a node is able to handle the churn rate of the pods assigned vs. using a fixed number. </p>"},{"location":"scalability/docs/scaling_theory/#scale-by-metrics","title":"Scale by Metrics","text":"<p>While the concept of using metrics to optimize systems is an old one, it\u2019s often overlooked as people begin their Kubernetes journey. Instead of focusing on specific numbers (i.e. 110 pods per node), we focus our efforts on finding the metrics that help us find bottlenecks in our system. Understanding the right thresholds for these metrics can give us a high degree of confidence our system is optimally configured.  </p>"},{"location":"scalability/docs/scaling_theory/#the-impact-of-changes","title":"The Impact of Changes","text":"<p>A common pattern that could get us into trouble is focusing on the first metric or log error that looks suspect. When we saw that the Kubelet was timing out earlier, we could try random things, such as increasing the per second rate that the Kubelet is allowed to send, etc. However, it is wise to look at the whole picture of everything downstream of the error we find first. Make each change with purpose and backed by data.</p> <p>Downstream of the Kubelet would be the Containerd runtime (pod errors), DaemonSets such as the storage driver (CSI) and the network driver (CNI) that talk to the EC2 API, etc. </p> <p></p> <p>Let\u2019s continue our earlier example of the Kubelet not keeping up with the runtime. There are a number of points where we could bin pack a node so densely that it triggers errors. </p> <p></p> <p>When designing the right node size for our workloads these are easy-to-overlook signals that might be putting unnecessary pressure on the system thus limiting both our scale and performance.</p>"},{"location":"scalability/docs/scaling_theory/#the-cost-of-unnecessary-errors","title":"The Cost of Unnecessary Errors","text":"<p>Kubernetes controllers excel at retrying when error conditions arise, however this comes at a cost. These retries can increase the pressure on components such as the Kube Controller Manager. It is an important tenant of scale testing to monitor for such errors. </p> <p>When fewer errors are occurring, it is easier spot issues in the system. By periodically ensuring that our clusters are error free before major operations (such as upgrades) we can simplify troubleshooting logs when unforeseen events happen.</p>"},{"location":"scalability/docs/scaling_theory/#expanding-our-view","title":"Expanding Our View","text":"<p>In large scale clusters with 1,000\u2019s of nodes we don\u2019t want to look for bottlenecks individually. In PromQL we can find the highest values in a data set using a function called topk; K being a variable we place the number of items we want. Here we use three nodes to get an idea whether all of the the Kubelets in the cluster are saturated. We have been looking at latency up to this point, now let\u2019s see if the Kubelet is discarding events. </p> <pre><code>topk(3, increase(kubelet_pleg_discard_events{}[$__rate_interval]))\n</code></pre> <p>Breaking this statement down. </p> <ul> <li>We use the Grafana variable <code>$__rate_interval</code> to ensure it gets the four samples it needs. This bypasses a complex topic in monitoring with a simple variable. </li> <li><code>topk</code> give us just the top results and the number 3 limits those results to three. This is a useful function for cluster wide metrics.</li> <li><code>{}</code> tell us there are no filters, normally you would put the job name of whatever the scraping rule, however since these names vary we will leave it blank. </li> </ul>"},{"location":"scalability/docs/scaling_theory/#splitting-the-problem-in-half","title":"Splitting the Problem in Half","text":"<p>To address a bottleneck in the system, we will take the approach of finding a metric that shows us there is a problem upstream or downstream as this allows us to split the problem in half. It will also be a core tenet of how we display our metrics data. </p> <p>A good place to start with this process is the API server, as it allow us to see if there\u2019s a problem with a client application or the Control Plane.</p>"},{"location":"scalability/docs/workloads/","title":"Workloads","text":"<p>Workloads have an impact on how large your cluster can scale. Workloads that use the Kubernetes APIs heavily will limit the total amount of workloads you can have in a single cluster, but there are some defaults you can change to help reduce the load.</p> <p>Workloads in a Kubernetes cluster have access to features that integrate with the Kubernetes API (e.g. Secrets and ServiceAccounts), but these features are not always required and should be disabled if they\u2019re not being used. Limiting workload access and dependence on the Kubernetes control plane will increase the number of workloads you can run in the cluster and improve the security of your clusters by removing unnecessary access to workloads and implementing least privilege practices. Please read the security best practices for more information.</p>"},{"location":"scalability/docs/workloads/#use-ipv6-for-pod-networking","title":"Use IPv6 for pod networking","text":"<p>You cannot transition a VPC from IPv4 to IPv6 so enabling IPv6 before provisioning a cluster is important. If you enable IPv6 in a VPC it does not mean you have to use it and if your pods and services use IPv6 you can still route traffic to and from IPv4 addresses. Please see the EKS networking best practices for more information.</p> <p>Using IPv6 in your cluster avoids some of the most common cluster and workload scaling limits. IPv6 avoids IP address exhaustion where pods and nodes cannot be created because no IP address is available. It also has per node performance improvements because pods receive IP addresses faster by reducing the number of ENI attachments per node. You can achieve similar node performance by using IPv4 prefix mode in the VPC CNI, but you still need to make sure you have enough IP addresses available in the VPC.</p>"},{"location":"scalability/docs/workloads/#limit-number-of-services-per-namespace","title":"Limit number of services per namespace","text":"<p>The maximum number of services in a namespaces is 5,000 and the maximum number of services in a cluster is 10,000. To help organize workloads and services, increase performance, and to avoid cascading impact for namespace scoped resources we recommend limiting the number of services per namespace to 500.</p> <p>The number of IP tables rules that are created per node with kube-proxy grows with the total number of services in the cluster. Generating thousands of IP tables rules and routing packets through those rules have a performance impact on the nodes and add network latency.</p> <p>Create Kubernetes namespaces that encompass a single application environment so long as the number of services per namespace is under 500. This will keep service discovery small enough to avoid service discovery limits and can also help you avoid service naming collisions. Applications environments (e.g. dev, test, prod) should use separate EKS clusters instead of namespaces.</p>"},{"location":"scalability/docs/workloads/#understand-elastic-load-balancer-quotas","title":"Understand Elastic Load Balancer Quotas","text":"<p>When creating your services consider what type of load balancing you will use (e.g. Network Load Balancer (NLB) or Application Load Balancer (ALB)). Each load balancer type provides different functionality and have different quotas. Some of the default quotas can be adjusted, but there are some quota maximums which cannot be changed. To view your account quotas and usage view the Service Quotas dashboard in the AWS console.</p> <p>For example, the default ALB targets is 1000. If you have a service with more than 1000 endpoints you will need to increase the quota or split the service across multiple ALBs or use Kubernetes Ingress. The default NLB targets is 3000, but is limited to 500 targets per AZ. If your cluster runs more than 500 pods for an NLB service you will need to use multiple AZs or request a quota limit increase.</p> <p>An alternative to using a load balancer coupled to a service is to use an ingress controller. The AWS Load Balancer controller can create ALBs for ingress resources, but you may consider running a dedicated controller in your cluster. An in-cluster ingress controller allows you to expose multiple Kubernetes services from a single load balancer by running a reverse proxy inside your cluster. Controllers have different features such as support for the Gateway API which may have benefits depending on how many and how large your workloads are.</p>"},{"location":"scalability/docs/workloads/#use-route-53-global-accelerator-or-cloudfront","title":"Use Route 53, Global Accelerator, or CloudFront","text":"<p>To make a service using multiple load balancers available as a single endpoint you need to use Amazon CloudFront, AWS Global Accelerator, or Amazon Route 53 to expose all of the load balancers as a single, customer facing endpoint. Each options has different benefits and can be used separately or together depending on your needs.</p> <p>Route 53 can expose multiple load balancers under a common name and can send traffic to each of them based on the weight assigned. You can read more about DNS weights in the documentation and you can read how to implement them with the Kubernetes external DNS controller in the AWS Load Balancer Controller documentation.</p> <p>Global Accelerator can route workloads to the nearest region based on request IP address. This may be useful for workloads that are deployed to multiple regions, but it does not improve routing to a single cluster in a single region. Using Route 53 in combination with the Global Accelerator has additional benefits such as health checking and automatic failover if an AZ is not available. You can see an example of using Global Accelerator with Route 53 in this blog post.</p> <p>CloudFront can be use with Route 53 and Global Accelerator or by itself to route traffic to multiple destinations. CloudFront caches assets being served from the origin sources which may reduce bandwidth requirements depending on what you are serving.</p>"},{"location":"scalability/docs/workloads/#use-endpointslices-instead-of-endpoints","title":"Use EndpointSlices instead of Endpoints","text":"<p>When discovering pods that match a service label you should use EndpointSlices instead of Endpoints. Endpoints were a simple way to expose services at small scales but large services that automatically scale or have updates causes a lot of traffic on the Kubernetes control plane. EndpointSlices have automatic grouping which enable things like topology aware hints.</p> <p>Not all controllers use EndpointSlices by default. You should verify your controller settings and enable it if needed. For the AWS Load Balancer Controller you should enable the <code>--enable-endpoint-slices</code> optional flag to use EndpointSlices.</p>"},{"location":"scalability/docs/workloads/#use-immutable-and-external-secrets-if-possible","title":"Use immutable and external secrets if possible","text":"<p>The kubelet keeps a cache of the current keys and values for the Secrets that are used in volumes for pods on that node. The kubelet sets a watch on the Secrets to detect changes. As the cluster scales, the growing number of watches can negatively impact the API server performance.</p> <p>There are two strategies to reduce the number of watches on Secrets:</p> <ul> <li>For applications that don\u2019t need access to Kubernetes resources, you can disable auto-mounting service account secrets by setting automountServiceAccountToken: false</li> <li>If your application\u2019s secrets are static and will not be modified in the future, mark the secret as immutable. The kubelet does not maintain an API watch for immutable secrets.</li> </ul> <p>To disable automatically mounting a service account to pods you can use the following setting in your workload. You can override these settings if specific workloads need a service account.</p> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: app\nautomountServiceAccountToken: true\n</code></pre> <p>Monitor the number of secrets in the cluster before it exceeds the limit of 10,000. You can see a total count of secrets in a cluster with the following command. You should monitor this limit through your cluster monitoring tooling.</p> <pre><code>kubectl get secrets -A | wc -l\n</code></pre> <p>You should set up monitoring to alert a cluster admin before this limit is reached. Consider using external secrets management options such as AWS Key Management Service (AWS KMS) or Hashicorp Vault with the Secrets Store CSI driver.</p>"},{"location":"scalability/docs/workloads/#limit-deployment-history","title":"Limit Deployment history","text":"<p>Pods can be slow when creating, updating, or deleting because old objects are still tracked in the cluster. You can reduce the <code>revisionHistoryLimit</code> of deployments to cleanup older ReplicaSets which will lower to total amount of objects tracked by the Kubernetes Controller Manager. The default history limit for Deployments in 10.</p> <p>If your cluster creates a lot of job objects through CronJobs or other mechanisms you should use the <code>ttlSecondsAfterFinished</code> setting to automatically clean up old pods in the cluster. This will remove successfully executed jobs from the job history after a specified amount of time.</p>"},{"location":"scalability/docs/workloads/#disable-enableservicelinks-by-default","title":"Disable enableServiceLinks by default","text":"<p>When a Pod runs on a Node, the kubelet adds a set of environment variables for each active Service. Linux processes have a maximum size for their environment which can be reached if you have too many services in your namespace. The number of services per namespace should not exceed 5,000. After this, the number of service environment variables outgrows shell limits, causing Pods to crash on startup. </p> <p>There are other reasons pods should not use service environment variables for service discovery. Environment variable name clashes, leaking service names, and total environment size are a few. You should use CoreDNS for discovering service endpoints.</p>"},{"location":"scalability/docs/workloads/#limit-dynamic-admission-webhooks-per-resource","title":"Limit dynamic admission webhooks per resource","text":"<p>Dynamic Admission Webhooks include admission webhooks and mutating webhooks. They are API endpoints not part of the Kubernetes Control Plane that are called in sequence when a resource is sent to the Kubernetes API. Each webhook has a default timeout of 10 seconds and can increase the amount of time an API request takes if you have multiple webhooks or any of them timeout.</p> <p>Make sure your webhooks are highly available\u2014especially during an AZ incident\u2014and the failurePolicy is set properly to reject the resource or ignore the failure. Do not call webhooks when not needed by allowing --dry-run kubectl commands to bypass the webhook.</p> <pre><code>apiVersion: admission.k8s.io/v1\nkind: AdmissionReview\nrequest:\n  dryRun: False\n</code></pre> <p>Mutating webhooks can modify resources in frequent succession. If you have 5 mutating webhooks and deploy 50 resources etcd will store all versions of each resource until compaction runs\u2014every 5 minutes\u2014to remove old versions of modified resources. In this scenario when etcd removes superseded resources there will be 200 resource version removed from etcd and depending on the size of the resources may use considerable space on the etcd host until defragmentation runs every 15 minutes.</p> <p>This defragmentation may cause pauses in etcd which could have other affects on the Kubernetes API and controllers. You should avoid frequent modification of large resources or modifying hundreds of resources in quick succession.</p>"},{"location":"security/docs/","title":"Amazon EKS Best Practices Guide for Security","text":"<p>This guide provides advice about protecting information, systems, and assets that are reliant on EKS while delivering business value through risk assessments and mitigation strategies. The guidance herein is part of a series of best practices guides that AWS is publishing to help customers implement EKS in accordance with best practices. Guides for Performance, Operational Excellence, Cost Optimization, and Reliability will be available in the coming months.</p>"},{"location":"security/docs/#how-to-use-this-guide","title":"How to use this guide","text":"<p>This guide is meant for security practitioners who are responsible for implementing and monitoring the effectiveness of security controls for EKS clusters and the workloads they support. The guide is organized into different topic areas for easier consumption. Each topic starts with a brief overview, followed by a list of recommendations and best practices for securing your EKS clusters. The topics do not need to be read in a particular order.</p>"},{"location":"security/docs/#understanding-the-shared-responsibility-model","title":"Understanding the Shared Responsibility Model","text":"<p>Security and compliance are considered shared responsibilities when using a managed service like EKS. Generally speaking, AWS is responsible for security \"of\" the cloud whereas you, the customer, are responsible for security \"in\" the cloud. With EKS, AWS is responsible for managing of the EKS managed Kubernetes control plane. This includes the Kubernetes control plane nodes, the ETCD database, and other infrastructure necessary for AWS to deliver a secure and reliable service. As a consumer of EKS, you are largely responsible for the topics in this guide, e.g. IAM, pod security, runtime security, network security, and so forth.</p> <p>When it comes to infrastructure security, AWS will assume additional responsibilities as you move from self-managed workers, to managed node groups, to Fargate. For example, with Fargate, AWS becomes responsible for securing the underlying instance/runtime used to run your Pods.</p> <p></p> <p>AWS will also assume responsibility of keeping the EKS optimized AMI up to date with Kubernetes patch versions and security patches. Customers using Managed Node Groups (MNG) are responsible for upgrading their Nodegroups to the latest AMI via EKS API, CLI, Cloudformation or AWS Console. Also unlike Fargate, MNGs will not automatically scale your infrastructure/cluster.  That can be handled by the cluster-autoscaler or other technologies such as Karpenter, native AWS autoscaling, SpotInst's Ocean, or Atlassian's Escalator.</p> <p></p> <p>Before designing your system, it is important to know where the line of demarcation is between your responsibilities and the provider of the service (AWS).</p> <p>For additional information about the shared responsibility model, see https://aws.amazon.com/compliance/shared-responsibility-model/</p>"},{"location":"security/docs/#introduction","title":"Introduction","text":"<p>There are several security best practice areas that are pertinent when using a managed Kubernetes service like EKS:</p> <ul> <li>Identity and Access Management</li> <li>Pod Security</li> <li>Runtime Security</li> <li>Network Security</li> <li>Multi-tenancy</li> <li>Multi Account for Multi-tenancy</li> <li>Detective Controls</li> <li>Infrastructure Security</li> <li>Data Encryption and Secrets Management</li> <li>Regulatory Compliance</li> <li>Incident Response and Forensics</li> <li>Image Security</li> </ul> <p>As part of designing any system, you need to think about its security implications and the practices that can affect your security posture. For example, you need to control who can perform actions against a set of resources. You also need the ability to quickly identify security incidents, protect your systems and services from unauthorized access, and maintain the confidentiality and integrity of data through data protection. Having a well-defined and rehearsed set of processes for responding to security incidents will improve your security posture too. These tools and techniques are important because they support objectives such as preventing financial loss or complying with regulatory obligations.</p> <p>AWS helps organizations achieve their security and compliance goals by offering a rich set of security services that have evolved based on feedback from a broad set of security conscious customers. By offering a highly secure foundation, customers can spend less time on \u201cundifferentiated heavy lifting\u201d and more time on achieving their business objectives.</p>"},{"location":"security/docs/#feedback","title":"Feedback","text":"<p>This guide is being released on GitHub so as to collect direct feedback and suggestions from the broader EKS/Kubernetes community. If you have a best practice that you feel we ought to include in the guide, please file an issue or submit a PR in the GitHub repository. Our intention is to update the guide periodically as new features are added to the service or when a new best practice evolves.</p>"},{"location":"security/docs/#further-reading","title":"Further Reading","text":"<p>Kubernetes Security Whitepaper, sponsored by the Security Audit Working Group, this Whitepaper describes key aspects of the Kubernetes attack surface and security architecture with the aim of helping security practitioners make sound design and implementation decisions.</p> <p>The CNCF published also a white paper on cloud native security. The paper examines how the technology landscape has evolved and advocates for the adoption of security practices that align with DevOps processes and agile methodologies.</p>"},{"location":"security/docs/#tools-and-resources","title":"Tools and resources","text":"<p>Amazon EKS Security Immersion Workshop</p>"},{"location":"security/docs/compliance/","title":"Compliance","text":"<p>Compliance is a shared responsibility between AWS and the consumers of its services. Generally speaking, AWS is responsible for \u201csecurity of the cloud\u201d whereas its users are responsible for \u201csecurity in the cloud.\u201d The line that delineates what AWS and its users are responsible for will vary depending on the service. For example, with Fargate, AWS is responsible for managing the physical security of its data centers, the hardware, the virtual infrastructure (Amazon EC2), and the container runtime (Docker). Users of Fargate are responsible for securing the container image and their application. Knowing who is responsible for what is an important consideration when running workloads that must adhere to compliance standards.</p> <p>The following table shows the compliance programs with which the different container services conform.</p> Compliance Program Amazon ECS Orchestrator Amazon EKS Orchestrator ECS Fargate Amazon ECR PCI DSS Level 1 1 1 1 1 HIPAA Eligible 1 1 1 1 SOC I 1 1 1 1 SOC II 1 1 1 1 SOC III 1 1 1 1 ISO 27001:2013 1 1 1 1 ISO 9001:2015 1 1 1 1 ISO 27017:2015 1 1 1 1 ISO 27018:2019 1 1 1 1 IRAP 1 1 1 1 FedRAMP Moderate (East/West) 1 1 0 1 FedRAMP High (GovCloud) 1 1 0 1 DOD CC SRG 1 DISA Review (IL5) 0 1 HIPAA BAA 1 1 1 1 MTCS 1 1 0 1 C5 1 1 0 1 K-ISMS 1 1 0 1 ENS High 1 1 0 1 OSPAR 1 1 0 1 HITRUST CSF 1 1 1 1 <p>Compliance status changes over time. For the latest status, always refer to https://aws.amazon.com/compliance/services-in-scope/.</p> <p>For further information about cloud accreditation models and best practices, see the AWS whitepaper, Accreditation Models for Secure Cloud Adoption</p>"},{"location":"security/docs/compliance/#shifting-left","title":"Shifting Left","text":"<p>The concept of shifting left involves catching policy violations and errors earlier in the software development lifecycle. From a security perspective, this can be very beneficial. A developer, for example, can fix issues with their configuration before their application is deployed to the cluster. Catching mistakes like this earlier will help prevent configurations that violate your policies from being deployed.</p>"},{"location":"security/docs/compliance/#policy-as-code","title":"Policy as Code","text":"<p>Policy can be thought of as a set of rules for governing behaviors, i.e. behaviors that are allowed or those that are prohibited. For example, you may have a policy that says that all Dockerfiles should include a USER directive that causes the container to run as a non-root user. As a document, a policy like this can be hard to discover and enforce. It may also become outdated as your requirements change. With Policy as Code (PaC) solutions, you can automate security, compliance, and privacy controls that detect, prevent, reduce, and counteract known and persistent threats. Furthermore, they give you mechanism to codify your policies and manage them as you do other code artifacts. The benefit of this approach is that you can reuse your DevOps and GitOps strategies to manage and consistently apply policies across fleets of Kubernetes clusters. Please refer to Pod Security for information about PaC options and the future of PSPs.</p>"},{"location":"security/docs/compliance/#use-policy-as-code-tools-in-pipelines-to-detect-violations-before-deployment","title":"Use policy-as-code tools in pipelines to detect violations before deployment","text":"<ul> <li>OPA is an open source policy engine that's part of the CNCF. It's used for making policy decisions and can be run a variety of different ways, e.g. as a language library or a service. OPA policies are written in a Domain Specific Language (DSL) called Rego. While it is often run as part of a Kubernetes Dynamic Admission Controller as the Gatekeeper project, OPA can also be incorporated into your CI/CD pipeline. This allows developers to get feedback about their configuration earlier in the release cycle which can subsequently help them resolve issues before they get to production. A collection of common OPA policies can be found in the GitHub repository for this project.</li> <li>Conftest is built on top of OPA and it provides a developer focused experience for testing Kubernetes configuration.</li> <li>Kyverno is a policy engine designed for Kubernetes. With Kyverno, policies are managed as Kubernetes resources and no new language is required to write policies. This allows using familiar tools such as kubectl, git, and kustomize to manage policies. Kyverno policies can validate, mutate, and generate Kubernetes resources plus ensure OCI image supply chain security. The Kyverno CLI can be used to test policies and validate resources as part of a CI/CD pipeline. All the Kyverno community policies can be found on the Kyverno website, and for examples using the Kyverno CLI to write tests in pipelines, see the policies repository.</li> </ul>"},{"location":"security/docs/compliance/#tools-and-resources","title":"Tools and resources","text":"<ul> <li>Amazon EKS Security Immersion Workshop - Regulatory Compliance</li> <li>kube-bench</li> <li>docker-bench-security</li> <li>AWS Inspector</li> <li>Kubernetes Security Review A 3rd party security assessment of Kubernetes 1.13.4 (2019)</li> <li>NeuVector by SUSE open source, zero-trust container security platform, provides compliance reporting and custom compliance checks</li> </ul>"},{"location":"security/docs/data/","title":"Data encryption and secrets management","text":""},{"location":"security/docs/data/#encryption-at-rest","title":"Encryption at rest","text":"<p>There are three different AWS-native storage options you can use with Kubernetes: EBS, EFS, and FSx for Lustre.  All three offer encryption at rest using a service managed key or a customer master key (CMK). For EBS you can use the in-tree storage driver or the EBS CSI driver.  Both include parameters for encrypting volumes and supplying a CMK.  For EFS, you can use the EFS CSI driver, however, unlike EBS, the EFS CSI driver does not support dynamic provisioning.  If you want to use EFS with EKS, you will need to provision and configure at-rest encryption for the file system prior to creating a PV. For further information about EFS file encryption, please refer to Encrypting Data at Rest. Besides offering at-rest encryption, EFS and FSx for Lustre include an option for encrypting data in transit.  FSx for Luster does this by default.  For EFS, you can add transport encryption by adding the <code>tls</code> parameter to <code>mountOptions</code> in your PV as in this example:</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: efs-pv\nspec:\n  capacity:\n    storage: 5Gi\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: efs-sc\n  mountOptions:\n    - tls\n  csi:\n    driver: efs.csi.aws.com\n    volumeHandle: &lt;file_system_id&gt;\n</code></pre> <p>The FSx CSI driver supports dynamic provisioning of Lustre file systems.  It encrypts data with a service managed key by default, although there is an option to provide your own CMK as in this example:</p> <pre><code>kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: fsx-sc\nprovisioner: fsx.csi.aws.com\nparameters:\n  subnetId: subnet-056da83524edbe641\n  securityGroupIds: sg-086f61ea73388fb6b\n  deploymentType: PERSISTENT_1\n  kmsKeyId: &lt;kms_arn&gt;\n</code></pre> <p>Attention</p> <p>As of May 28, 2020 all data written to the ephemeral volume in EKS Fargate pods is encrypted by default using an industry-standard AES-256 cryptographic algorithm. No modifications to your application are necessary as encryption and decryption are handled seamlessly by the service.</p>"},{"location":"security/docs/data/#encrypt-data-at-rest","title":"Encrypt data at rest","text":"<p>Encrypting data at rest is considered a best practice.  If you're unsure whether encryption is necessary, encrypt your data.</p>"},{"location":"security/docs/data/#rotate-your-cmks-periodically","title":"Rotate your CMKs periodically","text":"<p>Configure KMS to automatically rotate your CMKs.  This will rotate your keys once a year while saving old keys indefinitely so that your data can still be decrypted.  For additional information see Rotating customer master keys</p>"},{"location":"security/docs/data/#use-efs-access-points-to-simplify-access-to-shared-datasets","title":"Use EFS access points to simplify access to shared datasets","text":"<p>If you have shared datasets with different POSIX file permissions or want to restrict access to part of the shared file system by creating different mount points, consider using EFS access points. To learn more about working with access points, see https://docs.aws.amazon.com/efs/latest/ug/efs-access-points.html. Today, if you want to use an access point (AP) you'll need to reference the AP in the PV's <code>volumeHandle</code> parameter.</p> <p>Attention</p> <p>As of March 23, 2021 the EFS CSI driver supports dynamic provisioning of EFS Access Points. Access points are application-specific entry points into an EFS file system that make it easier to share a file system between multiple pods. Each EFS file system can have up to 120 PVs. See Introducing Amazon EFS CSI dynamic provisioning for additional information.</p>"},{"location":"security/docs/data/#secrets-management","title":"Secrets management","text":"<p>Kubernetes secrets are used to store sensitive information, such as user certificates, passwords, or API keys. They are persisted in etcd as base64 encoded strings.  On EKS, the EBS volumes for etcd nodes are encrypted with EBS encryption.  A pod can retrieve a Kubernetes secrets objects by referencing the secret in the <code>podSpec</code>.  These secrets can either be mapped to an environment variable or mounted as volume. For additional information on creating secrets, see https://kubernetes.io/docs/concepts/configuration/secret/.</p> <p>Caution</p> <p>Secrets in a particular namespace can be referenced by all pods in the secret's namespace.</p> <p>Caution</p> <p>The node authorizer allows the Kubelet to read all of the secrets mounted to the node.</p>"},{"location":"security/docs/data/#use-aws-kms-for-envelope-encryption-of-kubernetes-secrets","title":"Use AWS KMS for envelope encryption of Kubernetes secrets","text":"<p>This allows you to encrypt your secrets with a unique data encryption key (DEK). The DEK is then encrypted using a key encryption key (KEK) from AWS KMS which can be automatically rotated on a recurring schedule. With the KMS plugin for Kubernetes, all Kubernetes secrets are stored in etcd in ciphertext instead of plain text and can only be decrypted by the Kubernetes API server. For additional details, see using EKS encryption provider support for defense in depth</p>"},{"location":"security/docs/data/#audit-the-use-of-kubernetes-secrets","title":"Audit the use of Kubernetes Secrets","text":"<p>On EKS, turn on audit logging and create a CloudWatch metrics filter and alarm to alert you when a secret is used (optional). The following is an example of a metrics filter for the Kubernetes audit log, <code>{($.verb=\"get\") &amp;&amp; ($.objectRef.resource=\"secret\")}</code>.  You can also use the following queries with CloudWatch Log Insights:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| stats count(*) by objectRef.name as secret\n| filter verb=\"get\" and objectRef.resource=\"secrets\"\n</code></pre> <p>The above query will display the number of times a secret has been accessed within a specific timeframe.</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter verb=\"get\" and objectRef.resource=\"secrets\"\n| display objectRef.namespace, objectRef.name, user.username, responseStatus.code\n</code></pre> <p>This query will display the secret, along with the namespace and username of the user who attempted to access the secret and the response code.</p>"},{"location":"security/docs/data/#rotate-your-secrets-periodically","title":"Rotate your secrets periodically","text":"<p>Kubernetes doesn't automatically rotate secrets.  If you have to rotate secrets, consider using an external secret store, e.g. Vault or AWS Secrets Manager.</p>"},{"location":"security/docs/data/#use-separate-namespaces-as-a-way-to-isolate-secrets-from-different-applications","title":"Use separate namespaces as a way to isolate secrets from different applications","text":"<p>If you have secrets that cannot be shared between applications in a namespace, create a separate namespace for those applications.</p>"},{"location":"security/docs/data/#use-volume-mounts-instead-of-environment-variables","title":"Use volume mounts instead of environment variables","text":"<p>The values of environment variables can unintentionally appear in logs. Secrets mounted as volumes are instantiated as tmpfs volumes (a RAM backed file system) that are automatically removed from the node when the pod is deleted.</p>"},{"location":"security/docs/data/#use-an-external-secrets-provider","title":"Use an external secrets provider","text":"<p>There are several viable alternatives to using Kubernetes secrets, including AWS Secrets Manager and Hashicorp's Vault. These services offer features such as fine grained access controls, strong encryption, and automatic rotation of secrets that are not available with Kubernetes Secrets. Bitnami's Sealed Secrets is another approach that uses asymmetric encryption to create \"sealed secrets\". A public key is used to encrypt the secret while the private key used to decrypt the secret is kept within the cluster, allowing you to safely store sealed secrets in source control systems like Git. See Managing secrets deployment in Kubernetes using Sealed Secrets for further information.</p> <p>As the use of external secrets stores has grown, so has need for integrating them with Kubernetes. The Secret Store CSI Driver is a community project that uses the CSI driver model to fetch secrets from external secret stores. Currently, the Driver has support for AWS Secrets Manager, Azure, Vault, and GCP. The AWS provider supports both AWS Secrets Manager and AWS Parameter Store. It can also be configured to rotate secrets when they expire and can synchronize AWS Secrets Manager secrets to Kubernetes Secrets. Synchronization of secrets can be useful when you need to reference a secret as an environment variable instead of reading them from a volume.</p> <p>Note</p> <p>When the the secret store CSI driver has to fetch a secret, it assumes the IRSA role assigned to the pod that references a secret. The code for this operation can be found here.</p> <p>For additional information about the AWS Secrets &amp; Configuration Provider (ASCP) refer to the following resources:</p> <ul> <li>How to use AWS Secrets Configuration Provider with Kubernetes Secret Store CSI Driver</li> <li>Integrating Secrets Manager secrets with Kubernetes Secrets Store CSI Driver</li> </ul> <p>external-secrets is yet another way to use an external secret store with Kubernetes. Like the CSI Driver, external-secrets works against a variety of different backends, including AWS Secrets Manager. The difference is, rather than retrieving secrets from the external secret store, external-secrets copies secrets from these backends to Kubernetes as Secrets.  This lets you manage secrets using your preferred secret store and interact with secrets in a Kubernetes-native way.</p>"},{"location":"security/docs/data/#tools-and-resources","title":"Tools and resources","text":"<ul> <li>Amazon EKS Security Immersion Workshop - Data Encryption and Secrets Management</li> </ul>"},{"location":"security/docs/detective/","title":"Auditing and logging","text":"<p>Collecting and analyzing [audit] logs is useful for a variety of different reasons.  Logs can help with root cause analysis and attribution, i.e. ascribing a change to a particular user. When enough logs have been collected, they can be used to detect anomalous behaviors too. On EKS, the audit logs are sent to Amazon Cloudwatch Logs. The audit policy for EKS is as follows:</p> <pre><code>apiVersion: audit.k8s.io/v1beta1\nkind: Policy\nrules:\n  # Log aws-auth configmap changes\n  - level: RequestResponse\n    namespaces: [\"kube-system\"]\n    verbs: [\"update\", \"patch\", \"delete\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"configmaps\"]\n        resourceNames: [\"aws-auth\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: None\n    users: [\"system:kube-proxy\"]\n    verbs: [\"watch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"endpoints\", \"services\", \"services/status\"]\n  - level: None\n    users: [\"kubelet\"] # legacy kubelet identity\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes\", \"nodes/status\"]\n  - level: None\n    userGroups: [\"system:nodes\"]\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes\", \"nodes/status\"]\n  - level: None\n    users:\n      - system:kube-controller-manager\n      - system:kube-scheduler\n      - system:serviceaccount:kube-system:endpoint-controller\n    verbs: [\"get\", \"update\"]\n    namespaces: [\"kube-system\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"endpoints\"]\n  - level: None\n    users: [\"system:apiserver\"]\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"namespaces\", \"namespaces/status\", \"namespaces/finalize\"]\n  - level: None\n    users:\n      - system:kube-controller-manager\n    verbs: [\"get\", \"list\"]\n    resources:\n      - group: \"metrics.k8s.io\"\n  - level: None\n    nonResourceURLs:\n      - /healthz*\n      - /version\n      - /swagger*\n  - level: None\n    resources:\n      - group: \"\" # core\n        resources: [\"events\"]\n  - level: Request\n    users: [\"kubelet\", \"system:node-problem-detector\", \"system:serviceaccount:kube-system:node-problem-detector\"]\n    verbs: [\"update\",\"patch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes/status\", \"pods/status\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    userGroups: [\"system:nodes\"]\n    verbs: [\"update\",\"patch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes/status\", \"pods/status\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    users: [\"system:serviceaccount:kube-system:namespace-controller\"]\n    verbs: [\"deletecollection\"]\n    omitStages:\n      - \"RequestReceived\"\n  # Secrets, ConfigMaps, and TokenReviews can contain sensitive &amp; binary data,\n  # so only log at the Metadata level.\n  - level: Metadata\n    resources:\n      - group: \"\" # core\n        resources: [\"secrets\", \"configmaps\"]\n      - group: authentication.k8s.io\n        resources: [\"tokenreviews\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    resources:\n      - group: \"\"\n        resources: [\"serviceaccounts/token\"]\n  - level: Request\n    verbs: [\"get\", \"list\", \"watch\"]\n    resources: \n      - group: \"\" # core\n      - group: \"admissionregistration.k8s.io\"\n      - group: \"apiextensions.k8s.io\"\n      - group: \"apiregistration.k8s.io\"\n      - group: \"apps\"\n      - group: \"authentication.k8s.io\"\n      - group: \"authorization.k8s.io\"\n      - group: \"autoscaling\"\n      - group: \"batch\"\n      - group: \"certificates.k8s.io\"\n      - group: \"extensions\"\n      - group: \"metrics.k8s.io\"\n      - group: \"networking.k8s.io\"\n      - group: \"policy\"\n      - group: \"rbac.authorization.k8s.io\"\n      - group: \"scheduling.k8s.io\"\n      - group: \"settings.k8s.io\"\n      - group: \"storage.k8s.io\"\n    omitStages:\n      - \"RequestReceived\"\n  # Default level for known APIs\n  - level: RequestResponse\n    resources: \n      - group: \"\" # core\n      - group: \"admissionregistration.k8s.io\"\n      - group: \"apiextensions.k8s.io\"\n      - group: \"apiregistration.k8s.io\"\n      - group: \"apps\"\n      - group: \"authentication.k8s.io\"\n      - group: \"authorization.k8s.io\"\n      - group: \"autoscaling\"\n      - group: \"batch\"\n      - group: \"certificates.k8s.io\"\n      - group: \"extensions\"\n      - group: \"metrics.k8s.io\"\n      - group: \"networking.k8s.io\"\n      - group: \"policy\"\n      - group: \"rbac.authorization.k8s.io\"\n      - group: \"scheduling.k8s.io\"\n      - group: \"settings.k8s.io\"\n      - group: \"storage.k8s.io\"\n    omitStages:\n      - \"RequestReceived\"\n  # Default level for all other requests.\n  - level: Metadata\n    omitStages:\n      - \"RequestReceived\"\n</code></pre>"},{"location":"security/docs/detective/#recommendations","title":"Recommendations","text":""},{"location":"security/docs/detective/#enable-audit-logs","title":"Enable audit logs","text":"<p>The audit logs are part of the EKS managed Kubernetes control plane logs that are managed by EKS.  Instructions for enabling/disabling the control plane logs, which includes the logs for the Kubernetes API server, the controller manager, and the scheduler, along with the audit log, can be found here, https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html#enabling-control-plane-log-export.</p> <p>Info</p> <p>When you enable control plane logging, you will incur costs for storing the logs in CloudWatch. This raises a broader issue about the ongoing cost of security. Ultimately you will have to weigh those costs against the cost of a security breach, e.g. financial loss, damage to your reputation, etc. You may find that you can adequately secure your environment by implementing only some of the recommendations in this guide.</p> <p>Warning</p> <p>The maximum size for a CloudWatch Logs entry is 256KB whereas the maximum Kubernetes API request size is 1.5MiB. Log entries greater than 256KB will either be truncated or only include the request metadata.</p>"},{"location":"security/docs/detective/#utilize-audit-metadata","title":"Utilize audit metadata","text":"<p>Kubernetes audit logs include two annotations that indicate whether or not a request was authorized <code>authorization.k8s.io/decision</code> and the reason for the decision <code>authorization.k8s.io/reason</code>.  Use these attributes to ascertain why a particular API call was allowed.</p>"},{"location":"security/docs/detective/#create-alarms-for-suspicious-events","title":"Create alarms for suspicious events","text":"<p>Create an alarm to automatically alert you where there is an increase in 403 Forbidden and 401 Unauthorized responses, and then use attributes like <code>host</code>, <code>sourceIPs</code>, and <code>k8s_user.username</code> to find out where those requests are coming from.</p>"},{"location":"security/docs/detective/#analyze-logs-with-log-insights","title":"Analyze logs with Log Insights","text":"<p>Use CloudWatch Log Insights to monitor changes to RBAC objects, e.g. Roles, RoleBindings, ClusterRoles, and ClusterRoleBindings.  A few sample queries appear below:</p> <p>Lists updates to the <code>aws-auth</code> ConfigMap:</p> <pre><code>fields @timestamp, @message\n| filter @logStream like \"kube-apiserver-audit\"\n| filter verb in [\"update\", \"patch\"]\n| filter objectRef.resource = \"configmaps\" and objectRef.name = \"aws-auth\" and objectRef.namespace = \"kube-system\"\n| sort @timestamp desc\n</code></pre> <p>Lists creation of new or changes to validation webhooks:</p> <pre><code>fields @timestamp, @message\n| filter @logStream like \"kube-apiserver-audit\"\n| filter verb in [\"create\", \"update\", \"patch\"] and responseStatus.code = 201\n| filter objectRef.resource = \"validatingwebhookconfigurations\"\n| sort @timestamp desc\n</code></pre> <p>Lists create, update, delete operations to Roles:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"roles\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>Lists create, update, delete operations to RoleBindings:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"rolebindings\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>Lists create, update, delete operations to ClusterRoles:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"clusterroles\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>Lists create, update, delete operations to ClusterRoleBindings:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"clusterrolebindings\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>Plots unauthorized read operations against Secrets:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"secrets\" and verb in [\"get\", \"watch\", \"list\"] and responseStatus.code=\"401\"\n| stats count() by bin(1m)\n</code></pre> <p>List of failed anonymous requests:</p> <pre><code>fields @timestamp, @message, sourceIPs.0\n| sort @timestamp desc\n| limit 100\n| filter user.username=\"system:anonymous\" and responseStatus.code in [\"401\", \"403\"]\n</code></pre>"},{"location":"security/docs/detective/#audit-your-cloudtrail-logs","title":"Audit your CloudTrail logs","text":"<p>AWS APIs called by pods that are utilizing IAM Roles for Service Accounts (IRSA) are automatically logged to CloudTrail along with the name of the service account. If the name of a service account that wasn't explicitly authorized to call an API appears in the log, it may be an indication that the IAM role's trust policy was misconfigured. Generally speaking, Cloudtrail is a great way to ascribe AWS API calls to specific IAM principals.</p>"},{"location":"security/docs/detective/#use-cloudtrail-insights-to-unearth-suspicious-activity","title":"Use CloudTrail Insights to unearth suspicious activity","text":"<p>CloudTrail insights automatically analyzes write management events from CloudTrail trails and alerts you of unusual activity. This can help you identify when there's an increase in call volume on write APIs in your AWS account, including from pods that use IRSA to assume an IAM role. See Announcing CloudTrail Insights: Identify and Response to Unusual API Activity for further information.</p>"},{"location":"security/docs/detective/#additional-resources","title":"Additional resources","text":"<p>As the volume of logs increases, parsing and filtering them with Log Insights or another log analysis tool may become ineffective.  As an alternative, you might want to consider running Sysdig Falco and ekscloudwatch. Falco analyzes audit logs and flags anomalies or abuse over an extended period of time. The ekscloudwatch project forwards audit log events from CloudWatch to Falco for analysis. Falco provides a set of default audit rules along with the ability to add your own.</p> <p>Yet another option might be to store the audit logs in S3 and use the SageMaker Random Cut Forest algorithm to anomalous behaviors that warrant further investigation.</p>"},{"location":"security/docs/detective/#tools-and-resources","title":"Tools and resources","text":"<p>The following commercial and open source projects can be used to assess your cluster's alignment with established best practices:</p> <ul> <li>Amazon EKS Security Immersion Workshop - Detective Controls</li> <li>kubeaudit</li> <li>kube-scan Assigns a risk score to the workloads running in your cluster in accordance with the Kubernetes Common Configuration Scoring System framework</li> <li>kubesec.io</li> <li>polaris</li> <li>Starboard</li> <li>Snyk</li> <li>Kubescape Kubescape is an open source kubernetes security tool that scans clusters, YAML files, and Helm charts. It detects misconfigurations according to multiple frameworks (including NSA-CISA and MITRE ATT&amp;CK\u00ae.)</li> </ul>"},{"location":"security/docs/hosts/","title":"Protecting the infrastructure (hosts)","text":"<p>Inasmuch as it's important to secure your container images, it's equally important to safeguard the infrastructure that runs them. This section explores different ways to mitigate risks from attacks launched directly against the host.  These guidelines should be used in conjunction with those outlined in the Runtime Security section.</p>"},{"location":"security/docs/hosts/#recommendations","title":"Recommendations","text":""},{"location":"security/docs/hosts/#use-an-os-optimized-for-running-containers","title":"Use an OS optimized for running containers","text":"<p>Consider using Flatcar Linux, Project Atomic, RancherOS, and Bottlerocket, a special purpose OS from AWS designed for running Linux containers.  It includes a reduced attack surface, a disk image that is verified on boot, and enforced permission boundaries using SELinux.</p> <p>Alternately, use the EKS optimized AMI for your Kubernetes worker nodes. The EKS optimized AMI is released regularly and contains a minimal set of OS packages and binaries necessary to run your containerized workloads.</p> <p>Please refer Amazon EKS AMI RHEL Build Specification for a sample configuration script which can be used for building a custom Amazon EKS AMI running on Red Hat Enterprise Linux using Hashicorp Packer. This script can be further leveraged to build STIG compliant EKS custom AMIs.</p>"},{"location":"security/docs/hosts/#keep-your-worker-node-os-updated","title":"Keep your worker node OS updated","text":"<p>Regardless of whether you use a container-optimized host OS like Bottlerocket or a larger, but still minimalist, Amazon Machine Image like the EKS optimized AMIs, it is best practice to keep these host OS images up to date with the latest security patches.</p> <p>For the EKS optimized AMIs, regularly check the CHANGELOG and/or release notes channel and automate the rollout of updated worker node images into your cluster.</p>"},{"location":"security/docs/hosts/#treat-your-infrastructure-as-immutable-and-automate-the-replacement-of-your-worker-nodes","title":"Treat your infrastructure as immutable and automate the replacement of your worker nodes","text":"<p>Rather than performing in-place upgrades, replace your workers when a new patch or update becomes available. This can be approached a couple of ways. You can either add instances to an existing autoscaling group using the latest AMI as you sequentially cordon and drain nodes until all of the nodes in the group have been replaced with the latest AMI.  Alternatively, you can add instances to a new node group while you sequentially cordon and drain nodes from the old node group until all of the nodes have been replaced.  EKS managed node groups uses the first approach and will display a message in the console to upgrade your workers when a new AMI becomes available. <code>eksctl</code> also has a mechanism for creating node groups with the latest AMI and for gracefully cordoning and draining pods from nodes groups before the instances are terminated. If you decide to use a different method for replacing your worker nodes, it is strongly recommended that you automate the process to minimize human oversight as you will likely need to replace workers regularly as new updates/patches are released and when the control plane is upgraded.</p> <p>With EKS Fargate, AWS will automatically update the underlying infrastructure as updates become available.  Oftentimes this can be done seamlessly, but there may be times when an update will cause your pod to be rescheduled.  Hence, we recommend that you create deployments with multiple replicas when running your application as a Fargate pod.</p>"},{"location":"security/docs/hosts/#periodically-run-kube-bench-to-verify-compliance-with-cis-benchmarks-for-kubernetes","title":"Periodically run kube-bench to verify compliance with CIS benchmarks for Kubernetes","text":"<p>kube-bench is an open source project from Aqua that evaluates your cluster against the CIS benchmarks for Kubernetes. The benchmark describes the best practices for securing unmanaged Kubernetes clusters. The CIS Kubernetes Benchmark encompasses the control plane and the data plane. Since Amazon EKS provides a fully managed control plane, not all of the recommendations from the CIS Kubernetes Benchmark are applicable. To ensure this scope reflects how Amazon EKS is implemented, AWS created the CIS Amazon EKS Benchmark. The EKS benchmark inherits from CIS Kubernetes Benchmark with additional inputs from the community with specific configuration considerations for EKS clusters.</p> <p>When running kube-bench against an EKS cluster, follow these instructions from Aqua Security. For further information see Introducing The CIS Amazon EKS Benchmark.</p>"},{"location":"security/docs/hosts/#minimize-access-to-worker-nodes","title":"Minimize access to worker nodes","text":"<p>Instead of enabling SSH access, use SSM Session Manager when you need to remote into a host.  Unlike SSH keys which can be lost, copied, or shared, Session Manager allows you to control access to EC2 instances using IAM.  Moreover, it provides an audit trail and log of the commands that were run on the instance.</p> <p>As of August 19th, 2020 Managed Node Groups support custom AMIs and EC2 Launch Templates.  This allows you to embed the SSM agent into the AMI or install it as the worker node is being bootstrapped. If you rather not modify the Optimized AMI or the ASG's launch template, you can install the SSM agent with a DaemonSet as in this example.</p>"},{"location":"security/docs/hosts/#minimal-iam-policy-for-ssm-based-ssh-access","title":"Minimal IAM policy for SSM based SSH Access","text":"<p>The <code>AmazonSSMManagedInstanceCore</code> AWS managed policy contains a number of permissions that are not required for SSM Session Manager / SSM RunCommand if you're just looking to avoid SSH access. Of concern specifically is the <code>*</code> permissions for <code>ssm:GetParameter(s)</code> which would allow for the role to access all parameters in Parameter Store (including SecureStrings with the AWS managed KMS key configured).</p> <p>The following IAM policy contains the minimal set of permissions to enable node access via SSM Systems Manager.</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"EnableAccessViaSSMSessionManager\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssmmessages:OpenDataChannel\",\n        \"ssmmessages:OpenControlChannel\",\n        \"ssmmessages:CreateDataChannel\",\n        \"ssmmessages:CreateControlChannel\",\n        \"ssm:UpdateInstanceInformation\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"EnableSSMRunCommand\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssm:UpdateInstanceInformation\",\n        \"ec2messages:SendReply\",\n        \"ec2messages:GetMessages\",\n        \"ec2messages:GetEndpoint\",\n        \"ec2messages:FailMessage\",\n        \"ec2messages:DeleteMessage\",\n        \"ec2messages:AcknowledgeMessage\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n</code></pre> <p>With this policy in place and the Session Manager plugin installed, you can then run</p> <pre><code>aws ssm start-session --target [INSTANCE_ID_OF_EKS_NODE]\n</code></pre> <p>to access the node.</p> <p>Note</p> <p>You may also want to consider adding permissions to enable Session Manager logging.</p>"},{"location":"security/docs/hosts/#deploy-workers-onto-private-subnets","title":"Deploy workers onto private subnets","text":"<p>By deploying workers onto private subnets, you minimize their exposure to the Internet where attacks often originate.  Beginning April 22, 2020, the assignment of public IP addresses to nodes in a managed node groups will be controlled by the subnet they are deployed onto.  Prior to this, nodes in a Managed Node Group were automatically assigned a public IP. If you choose to deploy your worker nodes on to public subnets, implement restrictive AWS security group rules to limit their exposure.</p>"},{"location":"security/docs/hosts/#run-amazon-inspector-to-assess-hosts-for-exposure-vulnerabilities-and-deviations-from-best-practices","title":"Run Amazon Inspector to assess hosts for exposure, vulnerabilities, and deviations from best practices","text":"<p>You can use Amazon Inspector to check for unintended network access to your nodes and for vulnerabilities on the underlying Amazon EC2 instances.</p> <p>Amazon Inspector can provide common vulnerabilities and exposures (CVE) data for your Amazon EC2 instances only if the Amazon EC2 Systems Manager (SSM) agent is installed and enabled. This agent is preinstalled on several Amazon Machine Images (AMIs) including EKS optimized Amazon Linux AMIs. Regardless of SSM agent status, all of your Amazon EC2 instances are scanned for network reachability issues. For more information about configuring scans for Amazon EC2, see Scanning Amazon EC2 instances.</p> <p>Attention</p> <p>Inspector cannot be run on the infrastructure used to run Fargate pods.</p>"},{"location":"security/docs/hosts/#alternatives","title":"Alternatives","text":""},{"location":"security/docs/hosts/#run-selinux","title":"Run SELinux","text":"<p>Info</p> <p>Available on Red Hat Enterprise Linux (RHEL), CentOS, Bottlerocket, and Amazon Linux 2023</p> <p>SELinux provides an additional layer of security to keep containers isolated from each other and from the host. SELinux allows administrators to enforce mandatory access controls (MAC) for every user, application, process, and file.  Think of it as a backstop that restricts the operations that can be performed against to specific resources based on a set of labels.  On EKS, SELinux can be used to prevent containers from accessing each other's resources.</p> <p>Container SELinux policies are defined in the container-selinux package.  Docker CE requires this package (along with its dependencies) so that the processes and files created by Docker (or other container runtimes) run with limited system access. Containers leverage the <code>container_t</code> label which is an alias to <code>svirt_lxc_net_t</code>. These policies effectively prevent containers from accessing certain features of the host.</p> <p>When you configure SELinux for Docker, Docker automatically labels workloads <code>container_t</code> as a type and gives each container a unique MCS level. This will isolate containers from one another. If you need looser restrictions, you can create your own profile in SElinux which grants a container permissions to specific areas of the file system.  This is similar to PSPs in that you can create different profiles for different containers/pods.  For example, you can have a profile for general workloads with a set of restrictive controls and another for things that require privileged access.</p> <p>SELinux for Containers has a set of options that can be configured to modify the default restrictions. The following SELinux Booleans can be enabled or disabled based on your needs:</p> Boolean Default Description <code>container_connect_any</code> <code>off</code> Allow containers to access privileged ports on the host. For example, if you have a container that needs to map ports to 443 or 80 on the host. <code>container_manage_cgroup</code> <code>off</code> Allow containers to manage cgroup configuration. For example, a container running systemd will need this to be enabled. <code>container_use_cephfs</code> <code>off</code> Allow containers to use a ceph file system. <p>By default, containers are allowed to read/execute under <code>/usr</code> and read most content from <code>/etc</code>. The files under <code>/var/lib/docker</code> and <code>/var/lib/containers</code> have the label <code>container_var_lib_t</code>. To view a full list of default, labels see the container.fc file.</p> <pre><code>docker container run -it \\\n  -v /var/lib/docker/image/overlay2/repositories.json:/host/repositories.json \\\n  centos:7 cat /host/repositories.json\n# cat: /host/repositories.json: Permission denied\n\ndocker container run -it \\\n  -v /etc/passwd:/host/etc/passwd \\\n  centos:7 cat /host/etc/passwd\n# cat: /host/etc/passwd: Permission denied\n</code></pre> <p>Files labeled with <code>container_file_t</code> are the only files that are writable by containers. If you want a volume mount to be writeable, you will needed to specify <code>:z</code> or <code>:Z</code> at the end.</p> <ul> <li><code>:z</code> will re-label the files so that the container can read/write</li> <li><code>:Z</code> will re-label the files so that only the container can read/write</li> </ul> <pre><code>ls -Z /var/lib/misc\n# -rw-r--r--. root root system_u:object_r:var_lib_t:s0   postfix.aliasesdb-stamp\n\ndocker container run -it \\\n  -v /var/lib/misc:/host/var/lib/misc:z \\\n  centos:7 echo \"Relabeled!\"\n\nls -Z /var/lib/misc\n#-rw-r--r--. root root system_u:object_r:container_file_t:s0 postfix.aliasesdb-stamp\n</code></pre> <pre><code>docker container run -it \\\n  -v /var/log:/host/var/log:Z \\\n  fluentbit:latest\n</code></pre> <p>In Kubernetes, relabeling is slightly different. Rather than having Docker automatically relabel the files, you can specify a custom MCS label to run the pod. Volumes that support relabeling will automatically be relabeled so that they are accessible. Pods with a matching MCS label will be able to access the volume. If you need strict isolation, set a different MCS label for each pod.</p> <pre><code>securityContext:\n  seLinuxOptions:\n    # Provide a unique MCS label per container\n    # You can specify user, role, and type also\n    # enforcement based on type and level (svert)\n    level: s0:c144:c154\n</code></pre> <p>In this example <code>s0:c144:c154</code> corresponds to an MCS label assigned to a file that the container is allowed to access.</p> <p>On EKS you could create policies that allow for privileged containers to run, like FluentD and create an SELinux policy to allow it to read from /var/log on the host without needing to relabel the host directory. Pods with the same label will be able to access the same host volumes.</p> <p>We have implemented sample AMIs for Amazon EKS that have SELinux configured on CentOS 7 and RHEL 7. These AMIs were developed to demonstrate sample implementations that meet requirements of highly regulated customers, such as STIG, CJIS, and C2S.</p> <p>Caution</p> <p>SELinux will ignore containers where the type is unconfined.</p>"},{"location":"security/docs/hosts/#tools-and-resources","title":"Tools and resources","text":"<ul> <li>SELinux Kubernetes RBAC and Shipping Security Policies for On-prem Applications</li> <li>Iterative Hardening of Kubernetes</li> <li>Audit2Allow</li> <li>SEAlert</li> <li>Generate SELinux policies for containers with Udica describes a tool that looks at container spec files for Linux capabilities, ports, and mount points, and generates a set of SELinux rules that allow the container to run properly</li> <li>AMI Hardening playbooks for hardening the OS to meet different regulatory requirements</li> <li>Keiko Upgrade Manager an open source project from Intuit that orchestrates the rotation of worker nodes.</li> <li>Sysdig Secure</li> <li>eksctl</li> </ul>"},{"location":"security/docs/iam/","title":"Identity and Access Management","text":"<p>Identity and Access Management (IAM) is an AWS service that performs two essential functions: Authentication and Authorization.  Authentication involves the verification of a identity whereas authorization governs the actions that can be performed by AWS resources.  Within AWS, a resource can be another AWS service, e.g. EC2, or an AWS principal such as an IAM User or Role.  The rules governing the actions that a resource is allowed to perform are expressed as IAM policies.</p>"},{"location":"security/docs/iam/#controlling-access-to-eks-clusters","title":"Controlling Access to EKS Clusters","text":"<p>The Kubernetes project supports a variety of different strategies to authenticate requests to the kube-apiserver service, e.g. Bearer Tokens, X.509 certificates, OIDC, etc. EKS currently has native support for webhook token authentication, service account tokens, and as of February 21, 2021, OIDC authentication.</p> <p>The webhook authentication strategy calls a webhook that verifies bearer tokens. On EKS, these bearer tokens are generated by the AWS CLI or the aws-iam-authenticator client when you run <code>kubectl</code> commands. As you execute commands, the token is passed to the kube-apiserver which forwards it to the authentication webhook.  If the request is well-formed, the webhook calls a pre-signed URL embedded in the token's body. This URL validates the request's signature and returns information about the user, e.g. the user's account, Arn, and UserId to the kube-apiserver.</p> <p>To manually generate a authentication token, type the following command in a terminal window:</p> <pre><code>aws eks get-token --cluster-name &lt;cluster_name&gt;\n</code></pre> <p>You can also get a token programmatically. Below is an example written in Go:</p> <pre><code>package main\n\nimport (\n  \"fmt\"\n  \"log\"\n  \"sigs.k8s.io/aws-iam-authenticator/pkg/token\"\n)\n\nfunc main()  {\n  g, _ := token.NewGenerator(false, false)\n  tk, err := g.Get(\"&lt;cluster_name&gt;\")\n  if err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(tk)\n}\n</code></pre> <p>The output should resemble this:</p> <pre><code>{\n  \"kind\": \"ExecCredential\",\n  \"apiVersion\": \"client.authentication.k8s.io/v1alpha1\",\n  \"spec\": {},\n  \"status\": {\n    \"expirationTimestamp\": \"2020-02-19T16:08:27Z\",\n    \"token\": \"k8s-aws-v1.aHR0cHM6Ly9zdHMuYW1hem9uYXdzLmNvbS8_QWN0aW9uPUdldENhbGxlcklkZW50aXR5JlZlcnNpb249MjAxMS0wNi0xNSZYLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFKTkdSSUxLTlNSQzJXNVFBJTJGMjAyMDAyMTklMkZ1cy1lYXN0LTElMkZzdHMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDIwMDIxOVQxNTU0MjdaJlgtQW16LUV4cGlyZXM9NjAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JTNCeC1rOHMtYXdzLWlkJlgtQW16LVNpZ25hdHVyZT0yMjBmOGYzNTg1ZTMyMGRkYjVlNjgzYTVjOWE0MDUzMDFhZDc2NTQ2ZjI0ZjI4MTExZmRhZDA5Y2Y2NDhhMzkz\"\n  }\n}\n</code></pre> <p>Each token starts with <code>k8s-aws-v1.</code> followed by a base64 encoded string. The string, when decoded, should resemble to something similar to this:</p> <pre><code>https://sts.amazonaws.com/?Action=GetCallerIdentity&amp;Version=2011-06-15&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=XXXXJPFRILKNSRC2W5QA%2F20200219%2Fus-xxxx-1%2Fsts%2Faws4_request&amp;X-Amz-Date=20200219T155427Z&amp;X-Amz-Expires=60&amp;X-Amz-SignedHeaders=host%3Bx-k8s-aws-id&amp;X-Amz-Signature=XXXf8f3285e320ddb5e683a5c9a405301ad76546f24f28111fdad09cf648a393\n</code></pre> <p>The token consists of a pre-signed URL that includes an Amazon credential and signature. For additional details see https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html.</p> <p>The token has a time to live (TTL) of 15 minutes after which a new token will need to be generated. This is handled automatically when you use a client like <code>kubectl</code>, however, if you're using the Kubernetes dashboard, you will need to generate a new token and re-authenticate each time the token expires.</p> <p>Once the user's identity has been authenticated by the AWS IAM service, the kube-apiserver reads the <code>aws-auth</code> ConfigMap in the <code>kube-system</code> Namespace to determine the RBAC group to associate with the user.  The <code>aws-auth</code> ConfigMap is used to create a static mapping between IAM principals, i.e. IAM Users and Roles, and Kubernetes RBAC groups. RBAC groups can be referenced in Kubernetes RoleBindings or ClusterRoleBindings. They are similar to IAM Roles in that they define a set of actions (verbs) that can be performed against a collection of Kubernetes resources (objects).</p>"},{"location":"security/docs/iam/#cluster-access-manager","title":"Cluster Access Manager","text":"<p>Cluster Access Manager, now the preferred way to manage access of AWS IAM principals to Amazon EKS clusters, is a functionality of the AWS API and is an opt-in feature for EKS v1.23 and later clusters (new or existing). It simplifies identity mapping between AWS IAM and Kubernetes RBACs, eliminating the need to switch between AWS and Kubernetes APIs or editing the the <code>aws-auth</code> ConfigMap for access management, reducing operational overhead, and helping address misconfigurations. The tool also enables cluster administrators to revoke or refine <code>cluster-admin</code> permissions automatically granted to the AWS IAM principal used to create the cluster.</p> <p>This API relies on two concepts:</p> <ul> <li>Access Entries: A cluster identity directly linked to an AWS IAM principal (user or role) allowed to authenticate to an Amazon EKS cluster.</li> <li>Access Policies: Are Amazon EKS specific policies that provides the authorization for an Access Entry to perform actions in the Amazon EKS cluster.</li> </ul> <p>At launch Amazon EKS supports only predefined and AWS managed policies. Access policies are not IAM entities and are defined and managed by Amazon EKS.</p> <p>Cluster Access Manager allows the combination of upstream RBAC with Access Policies supporting allow and pass (but not deny) on Kubernetes AuthZ decisions regarding API server requests. A deny descision will happen when both, the upstream RBAC and Amazon EKS authorizers can't determine the outcome of a request evaluation.</p> <p>With this feature, Amazon EKS supports three modes of authentication:</p> <ol> <li><code>CONFIG_MAP</code> to continue using <code>aws-auth</code> configMap exclusively.</li> <li><code>API_AND_CONFIG_MAP</code> to source authenticated IAM principals from both EKS Access Entry APIs and the <code>aws-auth</code> configMap, prioritizing the Access Entries. Ideal to migrate existing <code>aws-auth</code> permissions to Access Entries.</li> <li><code>API</code> to exclusively rely on EKS Access Entry APIs. Being this one the new recommended approach.</li> </ol> <p>To get started, cluster administrators can create or update Amazon EKS clusters, setting the preferred authentication to <code>API_AND_CONFIG_MAP</code> or <code>API</code> method and define Access Entries to grant access the desired AWS IAM principals.</p> <pre><code>$ aws eks create-cluster \\\n    --name &lt;CLUSTER_NAME&gt; \\\n    --role-arn &lt;CLUSTER_ROLE_ARN&gt; \\\n    --resources-vpc-config subnetIds=&lt;value&gt;,endpointPublicAccess=true,endpointPrivateAccess=true \\\n    --logging '{\"clusterLogging\":[{\"types\":[\"api\",\"audit\",\"authenticator\",\"controllerManager\",\"scheduler\"],\"enabled\":true}]}' \\\n    --access-config authenticationMode=API_AND_CONFIG_MAP,bootstrapClusterCreatorAdminPermissions=false\n</code></pre> <p>The above command is an example to create an Amazon EKS cluster already without the admin permissions of the cluster creator.</p> <p>It is possible to update Amazon EKS clusters configuration to enable <code>API</code> authenticationMode using the <code>update-cluster-config</code> command, to do that on existing clusters using <code>CONFIG_MAP</code> you will have to first update to <code>API_AND_CONFIG_MAP</code> and then to <code>API</code>. These operations cannot be reverted, meaning that's not possible to switch from <code>API</code> to <code>API_AND_CONFIG_MAP</code> or <code>CONFIG_MAP</code>, and also from <code>API_AND_CONFIG_MAP</code> to <code>CONFIG_MAP</code>.</p> <pre><code>$ aws eks update-cluster-config \\\n    --name &lt;CLUSTER_NAME&gt; \\\n    --access-config authenticationMode=API\n</code></pre> <p>The API support commands to add and revoke access to the cluster, as well as validate the existing Access Policies and Access Entries for the specified cluster. The default policies are created to match Kubernets RBACs as follows.</p> EKS Access Policy Kubernetes RBAC AmazonEKSClusterAdminPolicy cluster-admin AmazonEKSAdminPolicy admin AmazonEKSEditPolicy edit AmazonEKSViewPolicy view <pre><code>$ aws eks list-access-policies\n{\n    \"accessPolicies\": [\n        {\n            \"name\": \"AmazonEKSAdminPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSAdminPolicy\"\n        },\n        {\n            \"name\": \"AmazonEKSClusterAdminPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy\"\n        },\n        {\n            \"name\": \"AmazonEKSEditPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSEditPolicy\"\n        },\n        {\n            \"name\": \"AmazonEKSViewPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSViewPolicy\"\n        }\n    ]\n}\n\n$ aws eks list-access-entries --cluster-name &lt;CLUSTER_NAME&gt;\n\n{\n    \"accessEntries\": []\n}\n</code></pre> <p>No Access Entries are available when the cluster is created without the cluster creator admin permission, which is the only entry created by default.</p>"},{"location":"security/docs/iam/#the-aws-auth-configmap-deprecated","title":"The <code>aws-auth</code> ConfigMap (deprecated)","text":"<p>One way Kubernetes integration with AWS authentication can be done is via the <code>aws-auth</code> ConfigMap, which resides in the <code>kube-system</code> Namespace. It is responsible for mapping the AWS IAM Identities (Users, Groups, and Roles) authentication, to Kubernetes role-based access control (RBAC) authorization. The <code>aws-auth</code> ConfigMap is automatically created in your Amazon EKS cluster during its provisioning phase. It was initially created to allow nodes to join your cluster, but as mentioned you can also use this ConfigMap to add RBACs access to IAM principals.</p> <p>To check your cluster's <code>aws-auth</code> ConfigMap, you can use the following command.</p> <pre><code>kubectl -n kube-system get configmap aws-auth -o yaml\n</code></pre> <p>This is a sample of a default configuration of the <code>aws-auth</code> ConfigMap.</p> <pre><code>apiVersion: v1\ndata:\n  mapRoles: |\n    - groups:\n      - system:bootstrappers\n      - system:nodes\n      - system:node-proxier\n      rolearn: arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:role/kube-system-&lt;SELF_GENERATED_UUID&gt;\n      username: system:node:{{SessionName}}\nkind: ConfigMap\nmetadata:\n  creationTimestamp: \"2023-10-22T18:19:30Z\"\n  name: aws-auth\n  namespace: kube-system\n</code></pre> <p>The main session of this ConfigMap, is under <code>data</code> in the <code>mapRoles</code> block, which is basically composed by 3 parameters.</p> <ul> <li>groups: The Kubernetes group(s) to map the IAM Role to. This can be a default group, or a custom group specified in a <code>clusterrolebinding</code> or <code>rolebinding</code>. In the above example we have just system groups declared.</li> <li>rolearn: The ARN of the AWS IAM Role be mapped to the Kubernetes group(s) add, using the following format <code>arn:&lt;PARTITION&gt;:iam::&lt;AWS_ACCOUNT_ID&gt;:role/role-name</code>.</li> <li>username: The username within Kubernetes to map to the AWS IAM role. This can be any custom name.</li> </ul> <p>It is also possible to map permissions for AWS IAM Users, defining a new configuration block for <code>mapUsers</code>, under <code>data</code> in the <code>aws-auth</code> ConfigMap, replacing the rolearn parameter for userarn, however as a Best Practice it's always recommended to user <code>mapRoles</code> instead.</p> <p>To manage permissions, you can edit the <code>aws-auth</code> ConfigMap adding or removing access to your Amazon EKS cluster. Although it's possible to edit the <code>aws-auth</code> ConfigMap manually, it's recommended using tools like <code>eksctl</code>, since this is a very senstitive configuration, and an inaccurate configuration can lock you outside your Amazon EKS Cluster. Check the subsection Use tools to make changes to the aws-auth ConfigMap below for more details.</p>"},{"location":"security/docs/iam/#cluster-access-recommendations","title":"Cluster Access Recommendations","text":""},{"location":"security/docs/iam/#make-the-eks-cluster-endpoint-private","title":"Make the EKS Cluster Endpoint private","text":"<p>By default when you provision an EKS cluster, the API cluster endpoint is set to public, i.e. it can be accessed from the Internet. Despite being accessible from the Internet, the endpoint is still considered secure because it requires all API requests to be authenticated by IAM and then authorized by Kubernetes RBAC. That said, if your corporate security policy mandates that you restrict access to the API from the Internet or prevents you from routing traffic outside the cluster VPC, you can:</p> <ul> <li>Configure the EKS cluster endpoint to be private. See Modifying Cluster Endpoint Access for further information on this topic.</li> <li>Leave the cluster endpoint public and specify which CIDR blocks can communicate with the cluster endpoint. The blocks are effectively a whitelisted set of public IP addresses that are allowed to access the cluster endpoint.</li> <li>Configure public access with a set of whitelisted CIDR blocks and set private endpoint access to enabled. This will allow public access from a specific range of public IPs while forcing all network traffic between the kubelets (workers) and the Kubernetes API through the cross-account ENIs that get provisioned into the cluster VPC when the control plane is provisioned.</li> </ul>"},{"location":"security/docs/iam/#dont-use-a-service-account-token-for-authentication","title":"Don't use a service account token for authentication","text":"<p>A service account token is a long-lived, static credential. If it is compromised, lost, or stolen, an attacker may be able to perform all the actions associated with that token until the service account is deleted. At times, you may need to grant an exception for applications that have to consume the Kubernetes API from outside the cluster, e.g. a CI/CD pipeline application. If such applications run on AWS infrastructure, like EC2 instances, consider using an instance profile and mapping that to a Kubernetes RBAC role.</p>"},{"location":"security/docs/iam/#employ-least-privileged-access-to-aws-resources","title":"Employ least privileged access to AWS Resources","text":"<p>An IAM User does not need to be assigned privileges to AWS resources to access the Kubernetes API. If you need to grant an IAM user access to an EKS cluster, create an entry in the <code>aws-auth</code> ConfigMap for that user that maps to a specific Kubernetes RBAC group.</p>"},{"location":"security/docs/iam/#remove-the-cluster-admin-permissions-from-the-cluster-creator-principal","title":"Remove the cluster-admin permissions from the cluster creator principal","text":"<p>By default Amazon EKS clusters are created with a permanent <code>cluster-admin</code> permission bound to the cluster creator principal. With the Cluster Access Manager API, it's possible to create clusters without this permission setting the <code>--access-config bootstrapClusterCreatorAdminPermissions</code> to <code>false</code>, when using <code>API_AND_CONFIG_MAP</code> or <code>API</code> authentication mode. Revoke this access considered a best practice to avoid any unwanted changes to the cluster configuration. The process to revoke this access, follows the same process to revoke any other access to the cluster.</p> <p>The API gives you flexibility to only disassociate an IAM principal from an Access Policy, in this case the <code>AmazonEKSClusterAdminPolicy</code>.</p> <pre><code>$ aws eks list-associated-access-policies \\\n    --cluster-name &lt;CLUSTER_NAME&gt; \\\n    --principal-arn &lt;IAM_PRINCIPAL_ARN&gt;\n\n$ aws eks disassociate-access-policy --cluster-name &lt;CLUSTER_NAME&gt; \\\n    --principal-arn &lt;IAM_PRINCIPAL_ARN. \\\n    --policy-arn arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy\n</code></pre> <p>Or completely removing the Access Entry associated with the <code>cluster-admin</code> permission.</p> <pre><code>$ aws eks list-access-entries --cluster-name &lt;CLUSTER_NAME&gt;\n\n{\n    \"accessEntries\": []\n}\n\n$ aws eks delete-access-entry --cluster-name &lt;CLUSTER_NAME&gt; \\\n  --principal-arn &lt;IAM_PRINCIPAL_ARN&gt;\n</code></pre> <p>This access can be granted again if needed during an incident, emergency or break glass scenario where the cluster is otherwise inaccessible.</p> <p>If the cluster still configured with the <code>CONFIG_MAP</code> authentication method, all additional users should be granted access to the cluster through the <code>aws-auth</code> ConfigMap, and after <code>aws-auth</code> ConfigMap is configured, the role assigned to the entity that created the cluster, can be deleted and only recreated in case of an incident, emergency or break glass scenario, or where the <code>aws-auth</code> ConfigMap is corrupted and the cluster is otherwise inaccessible. This can be particularly useful in production clusters.</p>"},{"location":"security/docs/iam/#use-iam-roles-when-multiple-users-need-identical-access-to-the-cluster","title":"Use IAM Roles when multiple users need identical access to the cluster","text":"<p>Rather than creating an entry for each individual IAM User, allow those users to assume an IAM Role and map that role to a Kubernetes RBAC group.  This will be easier to maintain, especially as the number of users that require access grows.</p> <p>Attention</p> <p>When accessing the EKS cluster with the IAM entity mapped by <code>aws-auth</code> ConfigMap, the username described is recorded in the user field of the Kubernetes audit log. If you're using an IAM role, the actual users who assume that role aren't recorded and can't be audited.</p> <p>If still using the <code>aws-auth</code> configMap as the authentication method, when assigning K8s RBAC permissions to an IAM role, you should include {{SessionName}} in your username. That way, the audit log will record the session name so you can track who the actual user assume this role along with the CloudTrail log.</p> <pre><code>- rolearn: arn:aws:iam::XXXXXXXXXXXX:role/testRole\n  username: testRole:{{SessionName}}\n  groups:\n    - system:masters\n</code></pre> <p>In Kubernetes 1.20 and above, this change is no longer required, since <code>user.extra.sessionName.0</code> was added to the Kubernetes audit log.</p>"},{"location":"security/docs/iam/#employ-least-privileged-access-when-creating-rolebindings-and-clusterrolebindings","title":"Employ least privileged access when creating RoleBindings and ClusterRoleBindings","text":"<p>Like the earlier point about granting access to AWS Resources, RoleBindings and ClusterRoleBindings should only include the set of permissions necessary to perform a specific function. Avoid using <code>[\"*\"]</code> in your Roles and ClusterRoles unless it's absolutely necessary. If you're unsure what permissions to assign, consider using a tool like audit2rbac to automatically generate Roles and binding based on the observed API calls in the Kubernetes Audit Log.</p>"},{"location":"security/docs/iam/#create-cluster-using-an-automated-process","title":"Create cluster using an automated process","text":"<p>As seen in earlier steps, when creating an Amazon EKS cluster, if not using the using <code>API_AND_CONFIG_MAP</code> or <code>API</code> authentication mode, and not opting out to delegate <code>cluster-admin</code> permissions to the cluster creator, the IAM entity user or role, such as a\u00a0federated user\u00a0that creates the cluster, is automatically granted\u00a0<code>system:masters</code>\u00a0permissions in the cluster's RBAC configuration. Even being a best practice to remove this permission, as described here if using the <code>CONFIG_MAP</code> authentication method, relying on <code>aws-auth</code> ConfigMap, this access cannot be revoked. Therefore it is a good idea to create the cluster with an infrastructure automation pipeline tied to dedicated IAM role, with no permissions to be assumed by other users or entities and regularly audit this role permissions, policies, and who have access to the trigger the pipeline. Also, this role should not be used to perform routine actions on the cluster, and be exclusively used to cluster level actions triggered by the pipeline, via SCM code changes for example.</p>"},{"location":"security/docs/iam/#create-the-cluster-with-a-dedicated-iam-role","title":"Create the cluster with a dedicated IAM role","text":"<p>When you create an Amazon EKS cluster, the IAM entity user or role, such as a\u00a0federated user\u00a0that creates the cluster, is automatically granted\u00a0<code>system:masters</code>\u00a0permissions in the cluster's RBAC configuration. This access cannot be removed and is not managed through the <code>aws-auth</code> ConfigMap. Therefore it is a good idea to create the cluster with a dedicated IAM role and regularly audit who can assume this role. This role should not be used to perform routine actions on the cluster, and instead additional users should be granted access to the cluster through the <code>aws-auth</code> ConfigMap for this purpose. After the <code>aws-auth</code> ConfigMap is configured, the role should be secured and only used in temporary elevated privilege mode / break glass for scenarios where the cluster is otherwise inaccessible. This can be particularly useful in clusters which do not have direct user access configured.</p>"},{"location":"security/docs/iam/#regularly-audit-access-to-the-cluster","title":"Regularly audit access to the cluster","text":"<p>Who requires access is likely to change over time. Plan to periodically audit the <code>aws-auth</code> ConfigMap to see who has been granted access and the rights they've been assigned. You can also use open source tooling like kubectl-who-can, or rbac-lookup to examine the roles bound to a particular service account, user, or group. We'll explore this topic further when we get to the section on auditing.  Additional ideas can be found in this article from NCC Group.</p>"},{"location":"security/docs/iam/#if-relying-on-aws-auth-configmap-use-tools-to-make-changes","title":"If relying on <code>aws-auth</code> configMap use tools to make changes","text":"<p>An improperly formatted aws-auth ConfigMap may cause you to lose access to the cluster. If you need to make changes to the ConfigMap, use a tool.</p> <p>eksctl The <code>eksctl</code> CLI includes a command for adding identity mappings to the aws-auth ConfigMap.</p> <p>View CLI Help:</p> <pre><code>$ eksctl create iamidentitymapping --help\n...\n</code></pre> <p>Check the identities mapped to your Amazon EKS Cluster.</p> <pre><code>$ eksctl get iamidentitymapping --cluster $CLUSTER_NAME --region $AWS_REGION\nARN                                                                   USERNAME                        GROUPS                                                  ACCOUNT\narn:aws:iam::788355785855:role/kube-system-&lt;SELF_GENERATED_UUID&gt;      system:node:{{SessionName}}     system:bootstrappers,system:nodes,system:node-proxier  \n</code></pre> <p>Make an IAM Role a Cluster Admin:</p> <pre><code>$ eksctl create iamidentitymapping --cluster  &lt;CLUSTER_NAME&gt; --region=&lt;region&gt; --arn arn:aws:iam::123456:role/testing --group system:masters --username admin\n...\n</code></pre> <p>For more information, review <code>eksctl</code> docs</p> <p>aws-auth by keikoproj</p> <p><code>aws-auth</code> by keikoproj includes both a cli and a go library.</p> <p>Download and view help CLI help:</p> <pre><code>$ go get github.com/keikoproj/aws-auth\n...\n$ aws-auth help\n...\n</code></pre> <p>Alternatively, install <code>aws-auth</code> with the krew plugin manager for kubectl.</p> <pre><code>$ kubectl krew install aws-auth\n...\n$ kubectl aws-auth\n...\n</code></pre> <p>Review the aws-auth docs on GitHub for more information, including the go library.</p> <p>AWS IAM Authenticator CLI</p> <p>The <code>aws-iam-authenticator</code> project includes a CLI for updating the ConfigMap.</p> <p>Download a release on GitHub.</p> <p>Add cluster permissions to an IAM Role:</p> <pre><code>$ ./aws-iam-authenticator add role --rolearn arn:aws:iam::185309785115:role/lil-dev-role-cluster --username lil-dev-user --groups system:masters --kubeconfig ~/.kube/config\n...\n</code></pre>"},{"location":"security/docs/iam/#alternative-approaches-to-authentication-and-access-management","title":"Alternative Approaches to Authentication and Access Management","text":"<p>While IAM is the preferred way to authenticate users who need access to an EKS cluster, it is possible to use an OIDC identity provider such as GitHub using an authentication proxy and Kubernetes impersonation. Posts for two such solutions have been published on the AWS Open Source blog:</p> <ul> <li>Authenticating to EKS Using GitHub Credentials with Teleport</li> <li>Consistent OIDC authentication across multiple EKS clusters using kube-oidc-proxy</li> </ul> <p>Attention</p> <p>EKS natively supports OIDC authentication without using a proxy. For further information, please read the launch blog, Introducing OIDC identity provider authentication for Amazon EKS. For an example showing how to configure EKS with Dex, a popular open source OIDC provider with connectors for a variety of different authention methods, see Using Dex &amp; dex-k8s-authenticator to authenticate to Amazon EKS. As described in the blogs, the username/group of users authenticated by an OIDC provider will appear in the Kubernetes audit log.</p> <p>You can also use AWS SSO to federate AWS with an external identity provider, e.g. Azure AD. If you decide to use this, the AWS CLI v2.0 includes an option to create a named profile that makes it easy to associate an SSO session with your current CLI session and assume an IAM role. Know that you must assume a role prior to running <code>kubectl</code> as the IAM role is used to determine the user's Kubernetes RBAC group.</p>"},{"location":"security/docs/iam/#identities-and-credentials-for-eks-pods","title":"Identities and Credentials for EKS pods","text":"<p>Certain applications that run within a Kubernetes cluster need permission to call the Kubernetes API to function properly. For example, the AWS Load Balancer Controller needs to be able to list a Service's Endpoints. The controller also needs to be able to invoke AWS APIs to provision and configure an ALB.  In this section we will explore the best practices for assigning rights and privileges to Pods.</p>"},{"location":"security/docs/iam/#kubernetes-service-accounts","title":"Kubernetes Service Accounts","text":"<p>A service account is a special type of object that allows you to assign a Kubernetes RBAC role to a pod.  A default service account is created automatically for each Namespace within a cluster. When you deploy a pod into a Namespace without referencing a specific service account, the default service account for that Namespace will automatically get assigned to the Pod and the Secret, i.e. the service account (JWT) token for that service account, will get mounted to the pod as a volume at <code>/var/run/secrets/kubernetes.io/serviceaccount</code>. Decoding the service account token in that directory will reveal the following metadata:</p> <pre><code>{\n  \"iss\": \"kubernetes/serviceaccount\",\n  \"kubernetes.io/serviceaccount/namespace\": \"default\",\n  \"kubernetes.io/serviceaccount/secret.name\": \"default-token-5pv4z\",\n  \"kubernetes.io/serviceaccount/service-account.name\": \"default\",\n  \"kubernetes.io/serviceaccount/service-account.uid\": \"3b36ddb5-438c-11ea-9438-063a49b60fba\",\n  \"sub\": \"system:serviceaccount:default:default\"\n}\n</code></pre> <p>The default service account has the following permissions to the Kubernetes API.</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  creationTimestamp: \"2020-01-30T18:13:25Z\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:discovery\n  resourceVersion: \"43\"\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/system%3Adiscovery\n  uid: 350d2ab8-438c-11ea-9438-063a49b60fba\nrules:\n- nonResourceURLs:\n  - /api\n  - /api/*\n  - /apis\n  - /apis/*\n  - /healthz\n  - /openapi\n  - /openapi/*\n  - /version\n  - /version/\n  verbs:\n  - get\n</code></pre> <p>This role authorizes unauthenticated and authenticated users to read API information and is deemed safe to be publicly accessible.</p> <p>When an application running within a Pod calls the Kubernetes APIs, the Pod needs to be assigned a service account that explicitly grants it permission to call those APIs.  Similar to guidelines for user access, the Role or ClusterRole bound to a service account should be restricted to the API resources and methods that the application needs to function and nothing else. To use a non-default service account simply set the <code>spec.serviceAccountName</code> field of a Pod to the name of the service account you wish to use. For additional information about creating service accounts, see https://kubernetes.io/docs/reference/access-authn-authz/rbac/#service-account-permissions.</p> <p>Note</p> <p>Prior to Kubernetes 1.24, Kubernetes would automatically create a secret for each a service account. This secret was mounted to the pod at /var/run/secrets/kubernetes.io/serviceaccount and would be used by the pod to authenticate to the Kubernetes API server. In Kubernetes 1.24, a service account token is dynamically generated when the pod runs and is only valid for an hour by default. A secret for the service account will not be created. If you have an application that runs outside the cluster that needs to authenticate to the Kubernetes API, e.g. Jenkins, you will need to create a secret of type <code>kubernetes.io/service-account-token</code> along with an annotation that references the service account such as <code>metadata.annotations.kubernetes.io/service-account.name: &lt;SERVICE_ACCOUNT_NAME&gt;</code>. Secrets created in this way do not expire.</p>"},{"location":"security/docs/iam/#iam-roles-for-service-accounts-irsa","title":"IAM Roles for Service Accounts (IRSA)","text":"<p>IRSA is a feature that allows you to assign an IAM role to a Kubernetes service account. It works by leveraging a Kubernetes feature known as Service Account Token Volume Projection. When Pods are configured with a Service Account that references an IAM Role, the Kubernetes API server will call the public OIDC discovery endpoint for the cluster on startup. The endpoint cryptographically signs the OIDC token issued by Kubernetes and the resulting token mounted as a volume. This signed token allows the Pod to call the AWS APIs associated IAM role. When an AWS API is invoked, the AWS SDKs calls <code>sts:AssumeRoleWithWebIdentity</code>. After validating the token's signature, IAM exchanges the Kubernetes issued token for a temporary AWS role credential.</p> <p>When using IRSA, it is important to reuse AWS SDK sessions to avoid unneeded calls to AWS STS.</p> <p>Decoding the (JWT) token for IRSA will produce output similar to the example you see below:</p> <pre><code>{\n  \"aud\": [\n    \"sts.amazonaws.com\"\n  ],\n  \"exp\": 1582306514,\n  \"iat\": 1582220114,\n  \"iss\": \"https://oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128\",\n  \"kubernetes.io\": {\n    \"namespace\": \"default\",\n    \"pod\": {\n      \"name\": \"alpine-57b5664646-rf966\",\n      \"uid\": \"5a20f883-5407-11ea-a85c-0e62b7a4a436\"\n    },\n    \"serviceaccount\": {\n      \"name\": \"s3-read-only\",\n      \"uid\": \"a720ba5c-5406-11ea-9438-063a49b60fba\"\n    }\n  },\n  \"nbf\": 1582220114,\n  \"sub\": \"system:serviceaccount:default:s3-read-only\"\n}\n</code></pre> <p>This particular token grants the Pod view-only privileges to S3 by assuming an IAM role. When the application attempts to read from S3, the token is exchanged for a temporary set of IAM credentials that resembles this:</p> <pre><code>{\n    \"AssumedRoleUser\": {\n        \"AssumedRoleId\": \"AROA36C6WWEJULFUYMPB6:abc\",\n        \"Arn\": \"arn:aws:sts::123456789012:assumed-role/eksctl-winterfell-addon-iamserviceaccount-de-Role1-1D61LT75JH3MB/abc\"\n    },\n    \"Audience\": \"sts.amazonaws.com\",\n    \"Provider\": \"arn:aws:iam::123456789012:oidc-provider/oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128\",\n    \"SubjectFromWebIdentityToken\": \"system:serviceaccount:default:s3-read-only\",\n    \"Credentials\": {\n        \"SecretAccessKey\": \"ORJ+8Adk+wW+nU8FETq7+mOqeA8Z6jlPihnV8hX1\",\n        \"SessionToken\": \"FwoGZXIvYXdzEGMaDMLxAZkuLpmSwYXShiL9A1S0X87VBC1mHCrRe/pB2oes+l1eXxUYnPJyC9ayOoXMvqXQsomq0xs6OqZ3vaa5Iw1HIyA4Cv1suLaOCoU3hNvOIJ6C94H1vU0siQYk7DIq9Av5RZe+uE2FnOctNBvYLd3i0IZo1ajjc00yRK3v24VRq9nQpoPLuqyH2jzlhCEjXuPScPbi5KEVs9fNcOTtgzbVf7IG2gNiwNs5aCpN4Bv/Zv2A6zp5xGz9cWj2f0aD9v66vX4bexOs5t/YYhwuwAvkkJPSIGvxja0xRThnceHyFHKtj0H+bi/PWAtlI8YJcDX69cM30JAHDdQH+ltm/4scFptW1hlvMaP+WReCAaCrsHrAT+yka7ttw5YlUyvZ8EPog+j6fwHlxmrXM9h1BqdikomyJU00gm1++FJelfP+1zAwcyrxCnbRl3ARFrAt8hIlrT6Vyu8WvWtLxcI8KcLcJQb/LgkW+sCTGlYcY8z3zkigJMbYn07ewTL5Ss7LazTJJa758I7PZan/v3xQHd5DEc5WBneiV3iOznDFgup0VAMkIviVjVCkszaPSVEdK2NU7jtrh6Jfm7bU/3P6ZG+CkyDLIa8MBn9KPXeJd/y+jTk5Ii+fIwO/+mDpGNUribg6TPxhzZ8b/XdZO1kS1gVgqjXyVC+M+BRBh6C4H21w/eMzjCtDIpoxt5rGKL6Nu/IFMipoC4fgx6LIIHwtGYMG7SWQi7OsMAkiwZRg0n68/RqWgLzBt/4pfjSRYuk=\",\n        \"Expiration\": \"2020-02-20T18:49:50Z\",\n        \"AccessKeyId\": \"XXXX36C6WWEJUMHA3L7Z\"\n    }\n}\n</code></pre> <p>A mutating webhook that runs as part of the EKS control plane injects the AWS Role ARN and the path to a web identity token file into the Pod as environment variables. These values can also be supplied manually.</p> <pre><code>AWS_ROLE_ARN=arn:aws:iam::AWS_ACCOUNT_ID:role/IAM_ROLE_NAME\nAWS_WEB_IDENTITY_TOKEN_FILE=/var/run/secrets/eks.amazonaws.com/serviceaccount/token\n</code></pre> <p>The kubelet will automatically rotate the projected token when it is older than 80% of its total TTL, or after 24 hours. The AWS SDKs are responsible for reloading the token when it rotates. For further information about IRSA, see https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-technical-overview.html.</p>"},{"location":"security/docs/iam/#eks-pod-identities","title":"EKS Pod Identities","text":"<p>EKS Pod Identities is a feature launched at re:Invent 2023 that allows you to assign an IAM role to a kubernetes service account, without the need to configure an Open Id Connect (OIDC) identity provider(IDP) for each cluster in your AWS account. To use EKS Pod Identity, you must deploy an agent which runs as a DaemonSet pod on every eligible worker node. This agent is made available to you as an EKS Add-on and is a pre-requisite to use EKS Pod Identity feature. Your applications must use a supported version of the AWS SDK to use this feature.</p> <p>When EKS Pod Identities are configured for a Pod, EKS will mount and refresh a pod identity token at <code>/var/run/secrets/pods.eks.amazonaws.com/serviceaccount/eks-pod-identity-token</code>. This token will be used by the AWS SDK to communicate with the EKS Pod Identity Agent, which uses the pod identity token and the agent's IAM role to create temporary credentials for your pods by calling the AssumeRoleForPodIdentity API. The pod identity token delivered to your pods is a JWT issued from your EKS cluster and cryptographically signed, with appropriate JWT claims for use with EKS Pod Identities.</p> <p>To learn more about EKS Pod Identities, please see this blog.</p> <p>You do not have to make any modifications to your application code to use EKS Pod Identities. Supported AWS SDK versions will automatically discover credentials made available with EKS Pod Identities by using the credential provider chain. Like IRSA, EKS pod identities sets variables within your pods to direct them how to find AWS credentials.</p>"},{"location":"security/docs/iam/#working-with-iam-roles-for-eks-pod-identities","title":"Working with IAM roles for EKS Pod Identities","text":"<ul> <li>EKS Pod Identities can only directly assume an IAM role that belongs to the same AWS account as the EKS cluster. To access an IAM role in another AWS account, you must assume that role by configuring a profile in your SDK configuration, or in your application's code.</li> <li>When EKS Pod Identities are being configured for Service Accounts, the person or process configuring the Pod Identity Association must have the <code>iam:PassRole</code> entitlement for that role.</li> <li>Each Service Account may only have one IAM role associated with it through EKS Pod Identities, however you can associate the same IAM role with multiple service accounts.</li> <li>IAM roles used with EKS Pod Identities must allow the <code>pods.eks.amazonaws.com</code> Service Principal to assume them, and set session tags. The following is an example role trust policy which allows EKS Pod Identities to use an IAM role:</li> </ul> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"pods.eks.amazonaws.com\"\n      },\n      \"Action\": [\n        \"sts:AssumeRole\",\n        \"sts:TagSession\"\n      ],\n      \"Condition\": {\n        \"StringEquals\": {\n          \"aws:SourceOrgId\": \"${aws:ResourceOrgId}\"\n        }\n      }\n    }\n  ]\n}\n</code></pre> <p>AWS recommends using condition keys like <code>aws:SourceOrgId</code> to help protect against the cross-service confused deputy problem. In the above example role trust policy, the <code>ResourceOrgId</code> is a variable equal to the AWS Organizations Organization ID of the AWS Organization that the AWS account belongs to. EKS will pass in a value for <code>aws:SourceOrgId</code> equal to that when assuming a role with EKS Pod Identities.</p>"},{"location":"security/docs/iam/#abac-and-eks-pod-identities","title":"ABAC and EKS Pod Identities","text":"<p>When EKS Pod Identities assumes an IAM role, it sets the following session tags:</p> EKS Pod Identities Session Tag Value kubernetes-namespace The namespace the pod associated with EKS Pod Identities runs in. kubernetes-service-account The name of the kubernetes service account associated with EKS Pod Identities eks-cluster-arn The ARN of the EKS cluster, e.g. <code>arn:${Partition}:eks:${Region}:${Account}:cluster/${ClusterName}</code>. The cluster ARN is unique, but if a cluster is deleted and recreated in the same region with the same name, within the same AWS account, it will have the same ARN. eks-cluster-name The name of the EKS cluster. Please note that EKS cluster names can be same within your AWS account, and EKS clusters in other AWS accounts. kubernetes-pod-name The name of the pod in EKS. kubernetes-pod-uid The UID of the pod in EKS. <p>These session tags allow you to use Attribute Based Access Control(ABAC) to grant access to your AWS resources to only specific kubernetes service accounts. When doing so, it is very important to understand that kubernetes service accounts are only unique within a namespace, and kubernetes namespaces are only unique within an EKS cluster. These session tags can be accessed in AWS policies by using the <code>aws:PrincipalTag/&lt;tag-key&gt;</code> global condition key, such as <code>aws:PrincipalTag/eks-cluster-arn</code></p> <p>For example, if you wanted to grant access to only a specific service account to access an AWS resource in your account with an IAM or resource policy, you would need to check <code>eks-cluster-arn</code> and  <code>kubernetes-namespace</code> tags as well as the <code>kubernetes-service-account</code> to ensure that only that service accounts from the intended cluster have access to that resource as other clusters could have identical <code>kubernetes-service-accounts</code> and <code>kubernetes-namespaces</code>.</p> <p>This example S3 Bucket policy only grants access to objects in the S3 bucket it's attached to, only if <code>kubernetes-service-account</code>, <code>kubernetes-namespace</code>, <code>eks-cluster-arn</code> all meet their expected values, where the EKS cluster is hosted in the AWS account <code>111122223333</code>.</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:aws:iam::111122223333:root\"\n            },\n            \"Action\": \"s3:*\",\n            \"Resource\":            [\n                \"arn:aws:s3:::ExampleBucket/*\"\n            ],\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalTag/kubernetes-service-account\": \"s3objectservice\",\n                    \"aws:PrincipalTag/eks-cluster-arn\": \"arn:aws:eks:us-west-2:111122223333:cluster/ProductionCluster\",\n                    \"aws:PrincipalTag/kubernetes-namespace\": \"s3datanamespace\"\n                }\n            }\n        }\n    ]\n}\n</code></pre>"},{"location":"security/docs/iam/#eks-pod-identities-compared-to-irsa","title":"EKS Pod Identities compared to IRSA","text":"<p>Both EKS Pod Identities and IRSA are preferred ways to deliver temporary AWS credentials to your EKS pods. Unless you have specific usecases for IRSA, we recommend you use EKS Pod Identities when using EKS. This table helps compare the two features.</p> # EKS Pod Identities IRSA Requires permission to create an OIDC IDP in your AWS accounts? No Yes Requires unique IDP setup per cluster No Yes Sets relevant session tags for use with ABAC Yes No Requires an iam:PassRole Check? Yes No Uses AWS STS Quota from your AWS account? No Yes Can access other AWS accounts Indirectly with role chaining Directly with sts:AssumeRoleWithWebIdentity Compatible with AWS SDKs Yes Yes Requires Pod Identity Agent Daemonset on nodes? Yes No"},{"location":"security/docs/iam/#identities-and-credentials-for-eks-pods-recommendations","title":"Identities and Credentials for EKS pods Recommendations","text":""},{"location":"security/docs/iam/#update-the-aws-node-daemonset-to-use-irsa","title":"Update the aws-node daemonset to use IRSA","text":"<p>At present, the aws-node daemonset is configured to use a role assigned to the EC2 instances to assign IPs to pods.  This role includes several AWS managed policies, e.g. AmazonEKS_CNI_Policy and EC2ContainerRegistryReadOnly that effectively allow all pods running on a node to attach/detach ENIs, assign/unassign IP addresses, or pull images from ECR. Since this presents a risk to your cluster, it is recommended that you update the aws-node daemonset to use IRSA. A script for doing this can be found in the repository for this guide.</p> <p>The aws-node daemonset does not support EKS Pod Identities at this time.</p>"},{"location":"security/docs/iam/#restrict-access-to-the-instance-profile-assigned-to-the-worker-node","title":"Restrict access to the instance profile assigned to the worker node","text":"<p>When you use IRSA or EKS Pod Identities, it updates the credential chain of the pod to use IRSA or EKS Pod Identities first, however, the pod can still inherit the rights of the instance profile assigned to the worker node. When using IRSA or EKS Pod Identities, it is strongly recommended that you block access instance metadata to help ensure that your applications only have the permissions they require, and not their nodes.</p> <p>Caution</p> <p>Blocking access to instance metadata will prevent pods that do not use IRSA or EKS Pod Identities from inheriting the role assigned to the worker node.</p> <p>You can block access to instance metadata by requiring the instance to use IMDSv2 only and updating the hop count to 1 as in the example below. You can also include these settings in the node group's launch template. Do not disable instance metadata as this will prevent components like the node termination handler and other things that rely on instance metadata from working properly.</p> <pre><code>$ aws ec2 modify-instance-metadata-options --instance-id &lt;value&gt; --http-tokens required --http-put-response-hop-limit 1\n...\n</code></pre> <p>If you are using Terraform to create launch templates for use with Managed Node Groups, add the metadata block to configure the hop count as seen in this code snippet:</p> <pre><code>resource \"aws_launch_template\" \"foo\" {\n  name = \"foo\"\n  ...\n    metadata_options {\n    http_endpoint               = \"enabled\"\n    http_tokens                 = \"required\"\n    http_put_response_hop_limit = 1\n    instance_metadata_tags      = \"enabled\"\n  }\n  ...\n</code></pre> <p>You can also block a pod's access to EC2 metadata by manipulating iptables on the node. For further information about this method, see Limiting access to the instance metadata service.</p> <p>If you have an application that is using an older version of the AWS SDK that doesn't support IRSA or EKS Pod Identities, you should update the SDK version.</p>"},{"location":"security/docs/iam/#scope-the-iam-role-trust-policy-for-irsa-roles-to-the-service-account-name-namespace-and-cluster","title":"Scope the IAM Role trust policy for IRSA Roles to the service account name, namespace, and cluster","text":"<p>The trust policy can be scoped to a Namespace or a specific service account within a Namespace. When using IRSA it's best to make the role trust policy as explicit as possible by including the service account name. This will effectively prevent other Pods within the same Namespace from assuming the role. The CLI <code>eksctl</code> will do this automatically when you use it to create service accounts/IAM roles. See https://eksctl.io/usage/iamserviceaccounts/ for further information.</p> <p>When working with IAM directly, this is adding condition into the role's trust policy that uses conditions to ensure the <code>:sub</code> claim are the namespace and service account you expect. As an example, before we had an IRSA token with a sub claim of \"system:serviceaccount:default:s3-read-only\" . This is the <code>default</code> namespace and the service account is <code>s3-read-only</code>. You would use a condition like the following to ensure that only your service account in a given namespace from your cluster can assume that role:</p> <pre><code>  \"Condition\": {\n      \"StringEquals\": {\n          \"oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128:aud\": \"sts.amazonaws.com\",\n          \"oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128:sub\": \"system:serviceaccount:default:s3-read-only\"\n      }\n  }\n</code></pre>"},{"location":"security/docs/iam/#use-one-iam-role-per-application","title":"Use one IAM role per application","text":"<p>With both IRSA and EKS Pod Identity, it is a best practice to give each application its own IAM role. This gives you improved isolation as you can modify one application without impacting another, and allows you to apply the principal of least privilege by only granting an application the permissions it needs.</p> <p>When using ABAC with EKS Pod Identity, you may use a common IAM role across multiple service accounts and rely on their session attributes for access control. This is especially useful when operating at scale, as ABAC allows you to operate with fewer IAM roles.</p>"},{"location":"security/docs/iam/#when-your-application-needs-access-to-imds-use-imdsv2-and-increase-the-hop-limit-on-ec2-instances-to-2","title":"When your application needs access to IMDS, use IMDSv2 and increase the hop limit on EC2 instances to 2","text":"<p>IMDSv2 requires you use a PUT request to get a session token.  The initial PUT request has to include a TTL for the session token.  Newer versions of the AWS SDKs will handle this and the renewal of said token automatically. It's also important to be aware that the default hop limit on EC2 instances is intentionally set to 1 to prevent IP forwarding. As a consequence, Pods that request a session token that are run on EC2 instances may eventually time out and fallback to using the IMDSv1 data flow. EKS adds support IMDSv2 by enabling both v1 and v2 and changing the hop limit to 2 on nodes provisioned by eksctl or with the official CloudFormation templates.</p>"},{"location":"security/docs/iam/#disable-auto-mounting-of-service-account-tokens","title":"Disable auto-mounting of service account tokens","text":"<p>If your application doesn't need to call the Kubernetes API set the <code>automountServiceAccountToken</code> attribute to <code>false</code> in the PodSpec for your application or patch the default service account in each namespace so that it's no longer mounted to pods automatically. For example:</p> <pre><code>kubectl patch serviceaccount default -p $'automountServiceAccountToken: false'\n</code></pre>"},{"location":"security/docs/iam/#use-dedicated-service-accounts-for-each-application","title":"Use dedicated service accounts for each application","text":"<p>Each application should have its own dedicated service account.  This applies to service accounts for the Kubernetes API as well as IRSA and EKS Pod Identity.</p> <p>Attention</p> <p>If you employ a blue/green approach to cluster upgrades instead of performing an in-place cluster upgrade when using IRSA, you will need to update the trust policy of each of the IRSA IAM roles with the OIDC endpoint of the new cluster. A blue/green cluster upgrade is where you create a cluster running a newer version of Kubernetes alongside the old cluster and use a load balancer or a service mesh to seamlessly shift traffic from services running on the old cluster to the new cluster. When using blue/green cluster upgrades with EKS Pod Identity, you would create pod identity associations between the IAM roles and service accounts in the new cluster. And update the IAM role trust policy if you have a <code>sourceArn</code> condition.</p>"},{"location":"security/docs/iam/#run-the-application-as-a-non-root-user","title":"Run the application as a non-root user","text":"<p>Containers run as root by default. While this allows them to read the web identity token file, running a container as root is not considered a best practice. As an alternative, consider adding the <code>spec.securityContext.runAsUser</code> attribute to the PodSpec.  The value of <code>runAsUser</code> is arbitrary value.</p> <p>In the following example, all processes within the Pod will run under the user ID specified in the <code>runAsUser</code> field.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: security-context-demo\nspec:\n  securityContext:\n    runAsUser: 1000\n    runAsGroup: 3000\n  containers:\n  - name: sec-ctx-demo\n    image: busybox\n    command: [ \"sh\", \"-c\", \"sleep 1h\" ]\n</code></pre> <p>When you run a container as a non-root user, it prevents the container from reading the IRSA service account token because the token is assigned 0600 [root] permissions by default. If you update the securityContext for your container to include fsgroup=65534 [Nobody] it will allow the container to read the token.</p> <pre><code>spec:\n  securityContext:\n    fsGroup: 65534\n</code></pre> <p>In Kubernetes 1.19 and above, this change is no longer required and applications can read the IRSA service account token without adding them to the Nobody group.</p>"},{"location":"security/docs/iam/#grant-least-privileged-access-to-applications","title":"Grant least privileged access to applications","text":"<p>Action Hero is a utility that you can run alongside your application to identify the AWS API calls and corresponding IAM permissions your application needs to function properly.  It is similar to IAM Access Advisor in that it helps you gradually limit the scope of IAM roles assigned to applications. Consult the documentation on granting least privileged access to AWS resources for further information.</p> <p>Consider setting a permissions boundary on IAM roles used with IRSA and Pod Identities. You can use the permissions boundary to ensure that the roles used by IRSA or Pod Identities can not exceed a maximum level of permissions. For an example guide on getting started with permissions boundaries with an example permissions boundary policy, please see this github repo.</p>"},{"location":"security/docs/iam/#review-and-revoke-unnecessary-anonymous-access-to-your-eks-cluster","title":"Review and revoke unnecessary anonymous access to your EKS cluster","text":"<p>Ideally anonymous access should be disabled for all API actions. Anonymous access is granted by creating a RoleBinding or ClusterRoleBinding for the Kubernetes built-in user system:anonymous. You can use the rbac-lookup tool to identify permissions that system:anonymous user has on your cluster:</p> <pre><code>./rbac-lookup | grep -P 'system:(anonymous)|(unauthenticated)'\nsystem:anonymous               cluster-wide        ClusterRole/system:discovery\nsystem:unauthenticated         cluster-wide        ClusterRole/system:discovery\nsystem:unauthenticated         cluster-wide        ClusterRole/system:public-info-viewer\n</code></pre> <p>Any role or ClusterRole other than system:public-info-viewer should not be bound to system:anonymous user or system:unauthenticated group.</p> <p>There may be some legitimate reasons to enable anonymous access on specific APIs. If this is the case for your cluster ensure that only those specific APIs are accessible by anonymous user and exposing those APIs without authentication doesn\u2019t make your cluster vulnerable.</p> <p>Prior to Kubernetes/EKS Version 1.14, system:unauthenticated group was associated to system:discovery and system:basic-user ClusterRoles by default.  Note that even if you have updated your cluster to version 1.14 or higher, these permissions may still be enabled on your cluster, since cluster updates do not revoke these permissions. To check which ClusterRoles have \"system:unauthenticated\" except system:public-info-viewer you can run the following command (requires jq util):</p> <pre><code>kubectl get ClusterRoleBinding -o json | jq -r '.items[] | select(.subjects[]?.name ==\"system:unauthenticated\") | select(.metadata.name != \"system:public-info-viewer\") | .metadata.name'\n</code></pre> <p>And \"system:unauthenticated\" can be removed from all the roles except \"system:public-info-viewer\" using:</p> <pre><code>kubectl get ClusterRoleBinding -o json | jq -r '.items[] | select(.subjects[]?.name ==\"system:unauthenticated\") | select(.metadata.name != \"system:public-info-viewer\") | del(.subjects[] | select(.name ==\"system:unauthenticated\"))' | kubectl apply -f -\n</code></pre> <p>Alternatively, you can check and remove it manually by kubectl describe and kubectl edit. To check if system:unauthenticated group has system:discovery permissions on your cluster run the following command:</p> <pre><code>kubectl describe clusterrolebindings system:discovery\n\nName:         system:discovery\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate: true\nRole:\n  Kind:  ClusterRole\n  Name:  system:discovery\nSubjects:\n  Kind   Name                    Namespace\n  ----   ----                    ---------\n  Group  system:authenticated\n  Group  system:unauthenticated\n</code></pre> <p>To check if system:unauthenticated group has system:basic-user permission on your cluster run the following command:</p> <pre><code>kubectl describe clusterrolebindings system:basic-user\n\nName:         system:basic-user\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate: true\nRole:\n  Kind:  ClusterRole\n  Name:  system:basic-user\nSubjects:\n  Kind   Name                    Namespace\n  ----   ----                    ---------\n  Group  system:authenticated\n  Group  system:unauthenticated\n</code></pre> <p>If system:unauthenticated group is bound to system:discovery and/or system:basic-user ClusterRoles on your cluster, you should disassociate these roles from system:unauthenticated group. Edit system:discovery ClusterRoleBinding using the following command:</p> <pre><code>kubectl edit clusterrolebindings system:discovery\n</code></pre> <p>The above command will open the current definition of system:discovery ClusterRoleBinding in an editor as shown below:</p> <pre><code># Please edit the object below. Lines beginning with a '#' will be ignored,\n# and an empty file will abort the edit. If an error occurs while saving this file will be\n# reopened with the relevant failures.\n#\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  creationTimestamp: \"2021-06-17T20:50:49Z\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:discovery\n  resourceVersion: \"24502985\"\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/system%3Adiscovery\n  uid: b7936268-5043-431a-a0e1-171a423abeb6\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:discovery\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:authenticated\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:unauthenticated\n</code></pre> <p>Delete the entry for system:unauthenticated group from the \u201csubjects\u201d section in the above editor screen.</p> <p>Repeat the same steps for system:basic-user ClusterRoleBinding.</p>"},{"location":"security/docs/iam/#reuse-aws-sdk-sessions-with-irsa","title":"Reuse AWS SDK sessions with IRSA","text":"<p>When you use IRSA, applications written using the AWS SDK use the token delivered to your pods to call <code>sts:AssumeRoleWithWebIdentity</code> to generate temporary AWS credentials. This is different from other AWS compute services, where the compute service delivers temporary AWS credentials directly to the AWS compute resource, such as a lambda function. This means that every time an AWS SDK session is initialized, a call to AWS STS for <code>AssumeRoleWithWebIdentity</code> is made. If your application scales rapidly and initializes many AWS SDK sessions, you may experience throttling from AWS STS as your code will be making many calls for <code>AssumeRoleWithWebIdentity</code>.</p> <p>To avoid this scenario, we recommend reusing AWS SDK sessions within your application so that unnecessary calls to <code>AssumeRoleWithWebIdentity</code> are not made.</p> <p>In the following example code, a session is created using the boto3 python SDK, and that same session is used to create clients and interact with both Amazon S3 and Amazon SQS. <code>AssumeRoleWithWebIdentity</code> is only called once, and the AWS SDK will refresh the credentials of <code>my_session</code> when they expire automatically.</p> <pre><code>import boto3\n\n# Create your own session\nmy_session = boto3.session.Session()\n\n# Now we can create low-level clients from our session\nsqs = my_session.client('sqs')\ns3 = my_session.client('s3')\n\ns3response = s3.list_buckets()\nsqsresponse = sqs.list_queues()\n\n\n#print the response from the S3 and SQS APIs\nprint(\"s3 response:\")\nprint(s3response)\nprint(\"---\")\nprint(\"sqs response:\")\nprint(sqsresponse)\n</code></pre> <p>If you're migrating an application from another AWS compute service, such as EC2, to EKS with IRSA, this is a particularly important detail. On other compute services initializing an AWS SDK session does not call AWS STS unless you instruct it to.</p>"},{"location":"security/docs/iam/#alternative-approaches","title":"Alternative approaches","text":"<p>While IRSA and EKS Pod Identities are the preferred ways to assign an AWS identity to a pod, they require that you include recent version of the AWS SDKs in your application. For a complete listing of the SDKs that currently support IRSA, see https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-minimum-sdk.html, for EKS Pod Identities, see https://docs.aws.amazon.com/eks/latest/userguide/pod-id-minimum-sdk.html. If you have an application that you can't immediately update with a compatible SDK, there are several community-built solutions available for assigning IAM roles to Kubernetes pods, including kube2iam and kiam. Although AWS doesn't endorse, condone, nor support the use of these solutions, they are frequently used by the community at large to achieve similar results as IRSA and EKS Pod Identities.</p> <p>If you need to use one of these non-aws provided solutions, please exercise due diligence and ensure you understand security implications of doing so.</p>"},{"location":"security/docs/iam/#tools-and-resources","title":"Tools and Resources","text":"<ul> <li>Amazon EKS Security Immersion Workshop - Identity and Access Management</li> <li>Terraform EKS Blueprints Pattern - Fully Private Amazon EKS Cluster</li> <li>Terraform EKS Blueprints Pattern - IAM Identity Center Single Sign-On for Amazon EKS Cluster</li> <li>Terraform EKS Blueprints Pattern - Okta Single Sign-On for Amazon EKS Cluster</li> <li>audit2rbac</li> <li>rbac.dev A list of additional resources, including blogs and tools, for Kubernetes RBAC</li> <li>Action Hero</li> <li>kube2iam</li> <li>kiam</li> </ul>"},{"location":"security/docs/image/","title":"Image security","text":"<p>You should consider the container image as your first line of defense against an attack. An insecure, poorly constructed image can allow an attacker to escape the bounds of the container and gain access to the host. Once on the host, an attacker can gain access to sensitive information or move laterally within the cluster or with your AWS account. The following best practices will help mitigate risk of this happening.</p>"},{"location":"security/docs/image/#recommendations","title":"Recommendations","text":""},{"location":"security/docs/image/#create-minimal-images","title":"Create minimal images","text":"<p>Start by removing all extraneous binaries from the container image. If you\u2019re using an unfamiliar image from Dockerhub, inspect the image using an application like Dive which can show you the contents of each of the container\u2019s layers. Remove all binaries with the SETUID and SETGID bits as they can be used to escalate privilege and consider removing all shells and utilities like nc and curl that can be used for nefarious purposes. You can find the files with SETUID and SETGID bits with the following command:</p> <pre><code>find / -perm /6000 -type f -exec ls -ld {} \\;\n</code></pre> <p>To remove the special permissions from these files, add the following directive to your container image:</p> <pre><code>RUN find / -xdev -perm /6000 -type f -exec chmod a-s {} \\; || true\n</code></pre> <p>Colloquially, this is known as de-fanging your image.</p>"},{"location":"security/docs/image/#use-multi-stage-builds","title":"Use multi-stage builds","text":"<p>Using multi-stage builds is a way to create minimal images. Oftentimes, multi-stage builds are used to automate parts of the Continuous Integration cycle. For example, multi-stage builds can be used to lint your source code or perform static code analysis. This affords developers an opportunity to get near immediate feedback instead of waiting for a pipeline to execute. Multi-stage builds are attractive from a security standpoint because they allow you to minimize the size of the final image pushed to your container registry. Container images devoid of build tools and other extraneous binaries improves your security posture by reducing the attack surface of the image. For additional information about multi-stage builds, see Docker's multi-stage builds documentation.</p>"},{"location":"security/docs/image/#create-software-bill-of-materials-sboms-for-your-container-image","title":"Create Software Bill of Materials (SBOMs) for your container image","text":"<p>A \u201csoftware bill of materials\u201d (SBOM) is a nested inventory of the software artifacts that make up your container image. SBOM is a key building block in software security and software supply chain risk management. Generating, storing SBOMS in a central repository and scanning SBOMs for vulnerabilities helps address the following concerns:</p> <ul> <li>Visibility: understand what components make up your container image. Storing in a central repository allows SBOMs to be audited and scanned anytime, even post deployment to detect and respond to new vulnerabilities such as zero day vulnerabilities.</li> <li>Provenance Verification: assurance that existing assumptions of where and how an artifact originates from are true and that the artifact or its accompanying metadata have not been tampered with during the build or delivery processes.</li> <li>Trustworthiness: assurance that a given artifact and its contents can be trusted to do what it is purported to do, i.e. is suitable for a purpose. This involves judgement on whether the code is safe to execute and making informed decisions about the risks associated with executing the code. Trustworthiness is assured by creating an attested pipeline execution report along with attested SBOM and attested CVE scan report to assure the consumers of the image that this image is in-fact created through secure means (pipeline) with secure components.</li> <li>Dependency Trust Verification: recursive checking of an artifact\u2019s dependency tree for trustworthiness and provenance of the artifacts it uses. Drift in SBOMs can help detect malicious activity including unauthorized, untrusted dependencies, infiltration attempts.</li> </ul> <p>The following tools can be used to generate SBOM:</p> <ul> <li>Amazon Inspector can be used to create and export SBOMs.</li> <li>Syft from Anchore can also be used for SBOM generation. For quicker vulnerability scans, the SBOM generated for a container image can be used as an input to scan. The SBOM and scan report are then attested and attached to the image before pushing the image to a central OCI repository such as Amazon ECR for review and audit purposes.</li> </ul> <p>Learn more about securing your software supply chain by reviewing CNCF Software Supply Chain Best Practices guide.</p>"},{"location":"security/docs/image/#scan-images-for-vulnerabilities-regularly","title":"Scan images for vulnerabilities regularly","text":"<p>Like their virtual machine counterparts, container images can contain binaries and application libraries with vulnerabilities or develop vulnerabilities over time. The best way to safeguard against exploits is by regularly scanning your images with an image scanner. Images that are stored in Amazon ECR can be scanned on push or on-demand (once during a 24 hour period). ECR currently supports two types of scanning - Basic and Enhanced. Basic scanning leverages Clair an open source image scanning solution for no cost. Enhanced scanning uses Amazon Inspector to provide automatic continuous scans for additional cost. After an image is scanned, the results are logged to the event stream for ECR in EventBridge. You can also see the results of a scan from within the ECR console. Images with a HIGH or CRITICAL vulnerability should be deleted or rebuilt. If an image that has been deployed develops a vulnerability, it should be replaced as soon as possible.</p> <p>Knowing where images with vulnerabilities have been deployed is essential to keeping your environment secure. While you could conceivably build an image tracking solution yourself, there are already several commercial offerings that provide this and other advanced capabilities out of the box, including:</p> <ul> <li>Grype</li> <li>Palo Alto - Prisma Cloud (twistcli)</li> <li>Aqua</li> <li>Kubei</li> <li>Trivy</li> <li>Snyk</li> </ul> <p>A Kubernetes validation webhook could also be used to validate that images are free of critical vulnerabilities. Validation webhooks are invoked prior to the Kubernetes API. They are typically used to reject requests that don't comply with the validation criteria defined in the webhook. This is an example of a serverless webhook that calls the ECR describeImageScanFindings API to determine whether a pod is pulling an image with critical vulnerabilities. If vulnerabilities are found, the pod is rejected and a message with list of CVEs is returned as an Event.</p>"},{"location":"security/docs/image/#use-attestations-to-validate-artifact-integrity","title":"Use attestations to validate artifact integrity","text":"<p>An attestation is a cryptographically signed \u201cstatement\u201d that claims something - a \u201cpredicate\u201d e.g. a pipeline run or the SBOM or the vulnerability scan report is true about another thing - a \u201csubject\u201d i.e. the container image.</p> <p>Attestations help users to validate that an artifact comes from a trusted source in the software supply chain. As an example, we may use a container image without knowing all the software components or dependencies that are included in that image. However, if we trust whatever the producer of the container image says about what software is present, we can use the producer\u2019s attestation to rely on that artifact. This means that we can proceed to use the artifact safely in our workflow in place of having done the analysis ourself.</p> <ul> <li>Attestations can be created using AWS Signer or Sigstore cosign.</li> <li>Kubernetes admission controllers such as Kyverno can be used to verify attestations.</li> <li>Refer to this workshop to learn more about software supply chain management best practices on AWS using open source tools with topics including creating and attaching attestations to a container image.</li> </ul>"},{"location":"security/docs/image/#create-iam-policies-for-ecr-repositories","title":"Create IAM policies for ECR repositories","text":"<p>Nowadays, it is not uncommon for an organization to have multiple development teams operating independently within a shared AWS account. If these teams don't need to share assets, you may want to create a set of IAM policies that restrict access to the repositories each team can interact with. A good way to implement this is by using ECR namespaces. Namespaces are a way to group similar repositories together. For example, all of the registries for team A can be prefaced with the team-a/ while those for team B can use the team-b/ prefix. The policy to restrict access might look like the following:</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AllowPushPull\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ecr:GetDownloadUrlForLayer\",\n        \"ecr:BatchGetImage\",\n        \"ecr:BatchCheckLayerAvailability\",\n        \"ecr:PutImage\",\n        \"ecr:InitiateLayerUpload\",\n        \"ecr:UploadLayerPart\",\n        \"ecr:CompleteLayerUpload\"\n      ],\n      \"Resource\": [\n        \"arn:aws:ecr:&lt;region&gt;:&lt;account_id&gt;:repository/team-a/*\"\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"security/docs/image/#consider-using-ecr-private-endpoints","title":"Consider using ECR private endpoints","text":"<p>The ECR API has a public endpoint. Consequently, ECR registries can be accessed from the Internet so long as the request has been authenticated and authorized by IAM. For those who need to operate in a sandboxed environment where the cluster VPC lacks an Internet Gateway (IGW), you can configure a private endpoint for ECR. Creating a private endpoint enables you to privately access the ECR API through a private IP address instead of routing traffic across the Internet. For additional information on this topic, see Amazon ECR interface VPC endpoints.</p>"},{"location":"security/docs/image/#implement-endpoint-policies-for-ecr","title":"Implement endpoint policies for ECR","text":"<p>The default endpoint policy for allows access to all ECR repositories within a region. This might allow an attacker/insider to exfiltrate data by packaging it as a container image and pushing it to a registry in another AWS account. Mitigating this risk involves creating an endpoint policy that limits API access to ECR repositories. For example, the following policy allows all AWS principles in your account to perform all actions against your and only your ECR repositories:</p> <pre><code>{\n  \"Statement\": [\n    {\n      \"Sid\": \"LimitECRAccess\",\n      \"Principal\": \"*\",\n      \"Action\": \"*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ecr:&lt;region&gt;:&lt;account_id&gt;:repository/*\"\n    }\n  ]\n}\n</code></pre> <p>You can enhance this further by setting a condition that uses the new <code>PrincipalOrgID</code> attribute which will prevent pushing/pulling of images by an IAM principle that is not part of your AWS Organization. See, aws:PrincipalOrgID for additional details. We recommended applying the same policy to both the <code>com.amazonaws.&lt;region&gt;.ecr.dkr</code> and the <code>com.amazonaws.&lt;region&gt;.ecr.api</code> endpoints. Since EKS pulls images for kube-proxy, coredns, and aws-node from ECR, you will need to add the account ID of the registry, e.g. <code>602401143452.dkr.ecr.us-west-2.amazonaws.com/*</code> to the list of resources in the endpoint policy or alter the policy to allow pulls from \"*\" and restrict pushes to your account ID. The table below reveals the mapping between the AWS accounts where EKS images are vended from and cluster region.</p> Account Number Region 602401143452 All commercial regions except for those listed below --- --- 800184023465 ap-east-1 - Asia Pacific (Hong Kong) 558608220178 me-south-1 - Middle East (Bahrain) 918309763551 cn-north-1 - China (Beijing) 961992271922 cn-northwest-1 - China (Ningxia) <p>For further information about using endpoint policies, see Using VPC endpoint policies to control Amazon ECR access.</p>"},{"location":"security/docs/image/#implement-lifecycle-policies-for-ecr","title":"Implement lifecycle policies for ECR","text":"<p>The NIST Application Container Security Guide warns about the risk of \"stale images in registries\", noting that over time old images with vulnerable, out-of-date software packages should be removed to prevent accidental deployment and exposure. Each ECR repository can have a lifecycle policy that sets rules for when images expire. The AWS official documentation describes how to set up test rules, evaluate them and then apply them. There are several lifecycle policy examples in the official docs that show different ways of filtering the images in a repository:</p> <ul> <li>Filtering by image age or count</li> <li>Filtering by tagged or untagged images</li> <li>Filtering by image tags, either in multiple rules or a single rule</li> </ul> Warning <p>If the image for long running application is purged from ECR, it can cause an image pull errors when the application is redeployed or scaled horizontally. When using image lifecycle policies, be sure you have good CI/CD practices in place to keep deployments and the images that they reference up to date and always create [image] expiry rules that account for how often you do releases/deployments.</p>"},{"location":"security/docs/image/#create-a-set-of-curated-images","title":"Create a set of curated images","text":"<p>Rather than allowing developers to create their own images, consider creating a set of vetted images for the different application stacks in your organization. By doing so, developers can forego learning how to compose Dockerfiles and concentrate on writing code. As changes are merged into Master, a CI/CD pipeline can automatically compile the asset, store it in an artifact repository and copy the artifact into the appropriate image before pushing it to a Docker registry like ECR. At the very least you should create a set of base images from which developers to create their own Dockerfiles. Ideally, you want to avoid pulling images from Dockerhub because 1/ you don't always know what is in the image and 2/ about a fifth of the top 1000 images have vulnerabilities. A list of those images and their vulnerabilities can be found here.</p>"},{"location":"security/docs/image/#add-the-user-directive-to-your-dockerfiles-to-run-as-a-non-root-user","title":"Add the USER directive to your Dockerfiles to run as a non-root user","text":"<p>As was mentioned in the pod security section, you should avoid running container as root. While you can configure this as part of the podSpec, it is a good habit to use the <code>USER</code> directive to your Dockerfiles. The <code>USER</code> directive sets the UID to use when running <code>RUN</code>, <code>ENTRYPOINT</code>, or <code>CMD</code> instruction that appears after the USER directive.</p>"},{"location":"security/docs/image/#lint-your-dockerfiles","title":"Lint your Dockerfiles","text":"<p>Linting can be used to verify that your Dockerfiles are adhering to a set of predefined guidelines, e.g. the inclusion of the <code>USER</code> directive or the requirement that all images be tagged. dockerfile_lint is an open source project from RedHat that verifies common best practices and includes a rule engine that you can use to build your own rules for linting Dockerfiles. It can be incorporated into a CI pipeline, in that builds with Dockerfiles that violate a rule will automatically fail.</p>"},{"location":"security/docs/image/#build-images-from-scratch","title":"Build images from Scratch","text":"<p>Reducing the attack surface of your container images should be primary aim when building images. The ideal way to do this is by creating minimal images that are devoid of binaries that can be used to exploit vulnerabilities. Fortunately, Docker has a mechanism to create images from <code>scratch</code>. With languages like Go, you can create a static linked binary and reference it in your Dockerfile as in this example:</p> <pre><code>############################\n# STEP 1 build executable binary\n############################\nFROM golang:alpine AS builder# Install git.\n# Git is required for fetching the dependencies.\nRUN apk update &amp;&amp; apk add --no-cache gitWORKDIR $GOPATH/src/mypackage/myapp/COPY . . # Fetch dependencies.\n# Using go get.\nRUN go get -d -v# Build the binary.\nRUN go build -o /go/bin/hello\n\n############################\n# STEP 2 build a small image\n############################\nFROM scratch# Copy our static executable.\nCOPY --from=builder /go/bin/hello /go/bin/hello# Run the hello binary.\nENTRYPOINT [\"/go/bin/hello\"]\n</code></pre> <p>This creates a container image that consists of your application and nothing else, making it extremely secure.</p>"},{"location":"security/docs/image/#use-immutable-tags-with-ecr","title":"Use immutable tags with ECR","text":"<p>Immutable tags force you to update the image tag on each push to the image repository. This can thwart an attacker from overwriting an image with a malicious version without changing the image's tags. Additionally, it gives you a way to easily and uniquely identify an image.</p>"},{"location":"security/docs/image/#sign-your-images-sboms-pipeline-runs-and-vulnerability-reports","title":"Sign your images, SBOMs, pipeline runs and vulnerability reports","text":"<p>When Docker was first introduced, there was no cryptographic model for verifying container images. With v2, Docker added digests to the image manifest. This allowed an image\u2019s configuration to be hashed and for the hash to be used to generate an ID for the image. When image signing is enabled, the Docker engine verifies the manifest\u2019s signature, ensuring that the content was produced from a trusted source and no tampering has occurred. After each layer is downloaded, the engine verifies the digest of the layer, ensuring that the content matches the content specified in the manifest. Image signing effectively allows you to create a secure supply chain, through the verification of digital signatures associated with the image.</p> <p>We can use AWS Signer or Sigstore Cosign, to sign container images, create attestations for SBOMs, vulnerability scan reports and pipeline run reports. These attestations assure the trustworthiness and integrity of the image, that it is in fact created by the trusted pipeline without any interference or tampering, and that it contains only the software components that are documented (in the SBOM) that is verified and trusted by the image publisher. These attestations can be attached to the container image and pushed to the repository.</p> <p>In the next section we will see how to use the attested artifacts for audits and admissions controller verification.</p>"},{"location":"security/docs/image/#image-integrity-verification-using-kubernetes-admission-controller","title":"Image integrity verification using Kubernetes admission controller","text":"<p>We can verify image signatures, attested artifacts in an automated way before deploying the image to target Kubernetes cluster using dynamic admission controller and admit deployments only when the security metadata of the artifacts comply with the admission controller policies.</p> <p>For example we can write a policy that cryptographically verifies the signature of an image, an attested SBOM, attested pipeline run report, or attested CVE scan report. We can write conditions in the policy to check data in the report, e.g. a CVE scan should not have any critical CVEs. Deployment is allowed only for images that satisfy these conditions and all other deployments will be rejected by the admissions controller.</p> <p>Examples of admission controller include:</p> <ul> <li>Kyverno</li> <li>OPA Gatekeeper</li> <li>Portieris</li> <li>Ratify</li> <li>Kritis</li> <li>Grafeas tutorial</li> <li>Voucher</li> </ul>"},{"location":"security/docs/image/#update-the-packages-in-your-container-images","title":"Update the packages in your container images","text":"<p>You should include RUN <code>apt-get update &amp;&amp; apt-get upgrade</code> in your Dockerfiles to upgrade the packages in your images. Although upgrading requires you to run as root, this occurs during image build phase. The application doesn't need to run as root. You can install the updates and then switch to a different user with the USER directive. If your base image runs as a non-root user, switch to root and back; don't solely rely on the maintainers of the base image to install the latest security updates.</p> <p>Run <code>apt-get clean</code> to delete the installer files from <code>/var/cache/apt/archives/</code>. You can also run <code>rm -rf /var/lib/apt/lists/*</code> after installing packages. This removes the index files or the lists of packages that are available to install. Be aware that these commands may be different for each package manager. For example:</p> <pre><code>RUN apt-get update &amp;&amp; apt-get install -y \\\n    curl \\\n    git \\\n    libsqlite3-dev \\\n    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre>"},{"location":"security/docs/image/#tools-and-resources","title":"Tools and resources","text":"<ul> <li>Amazon EKS Security Immersion Workshop - Image Security</li> <li>docker-slim Build secure minimal images</li> <li>dockle Verifies that your Dockerfile aligns with best practices for creating secure images</li> <li>dockerfile-lint Rule based linter for Dockerfiles</li> <li>hadolint A smart dockerfile linter</li> <li>Gatekeeper and OPA A policy based admission controller</li> <li>Kyverno A Kubernetes-native policy engine</li> <li>in-toto Allows the user to verify if a step in the supply chain was intended to be performed, and if the step was performed by the right actor</li> <li>Notary A project for signing container images</li> <li>Notary v2</li> <li>Grafeas An open artifact metadata API to audit and govern your software supply chain</li> <li>NeuVector by SUSE open source, zero-trust container security platform, provides container, image and registry scanning for vulnerabilities, secrets and compliance.</li> </ul>"},{"location":"security/docs/incidents/","title":"Incident response and forensics","text":"<p>Your ability to react quickly to an incident can help minimize damage caused from a breach. Having a reliable alerting system that can warn you of suspicious behavior is the first step in a good incident response plan. When an incident does arise, you have to quickly decide whether to destroy and replace the effected container, or isolate and inspect the container. If you choose to isolate the container as part of a forensic investigation and root cause analysis, then the following set of activities should be followed:</p>"},{"location":"security/docs/incidents/#sample-incident-response-plan","title":"Sample incident response plan","text":""},{"location":"security/docs/incidents/#identify-the-offending-pod-and-worker-node","title":"Identify the offending Pod and worker node","text":"<p>Your first course of action should be to isolate the damage.  Start by identifying where the breach occurred and isolate that Pod and its node from the rest of the infrastructure.</p>"},{"location":"security/docs/incidents/#identify-the-offending-pods-and-worker-nodes-using-workload-name","title":"Identify the offending Pods and worker nodes using workload name","text":"<p>If you know the name and namespace of the offending pod, you can identify the the worker node running the pod as follows:</p> <pre><code>kubectl get pods &lt;name&gt; --namespace &lt;namespace&gt; -o=jsonpath='{.spec.nodeName}{\"\\n\"}'   \n</code></pre> <p>If a Workload Resource such as a Deployment has been compromised, it is likely that all the pods that are part of the workload resource are compromised. Use the following command to list all the pods of the Workload Resource and the nodes they are running on:</p> <pre><code>selector=$(kubectl get deployments &lt;name&gt; \\\n --namespace &lt;namespace&gt; -o json | jq -j \\\n'.spec.selector.matchLabels | to_entries | .[] | \"\\(.key)=\\(.value)\"')\n\nkubectl get pods --namespace &lt;namespace&gt; --selector=$selector \\\n-o json | jq -r '.items[] | \"\\(.metadata.name) \\(.spec.nodeName)\"'\n</code></pre> <p>The above command is for deployments. You can run the same command for other workload resources such as replicasets,, statefulsets, etc.</p>"},{"location":"security/docs/incidents/#identify-the-offending-pods-and-worker-nodes-using-service-account-name","title":"Identify the offending Pods and worker nodes using service account name","text":"<p>In some cases, you may identify that a service account is compromised.  It is likely that pods using the identified service account are compromised. You can identify all the pods using the service account and nodes they are running on with the following command:</p> <pre><code>kubectl get pods -o json --namespace &lt;namespace&gt; | \\\n    jq -r '.items[] |\n    select(.spec.serviceAccount == \"&lt;service account name&gt;\") |\n    \"\\(.metadata.name) \\(.spec.nodeName)\"'\n</code></pre>"},{"location":"security/docs/incidents/#identify-pods-with-vulnerable-or-compromised-images-and-worker-nodes","title":"Identify Pods with vulnerable or compromised images and worker nodes","text":"<p>In some cases, you may discover that a container image being used in pods on your cluster is malicious or compromised. A container image is malicious or compromised, if it was found to contain malware, is a known bad image or has a CVE that has been exploited. You should consider all the pods using the container image compromised. You can identify the pods using the image and nodes they are running on with the following command:</p> <pre><code>IMAGE=&lt;Name of the malicious/compromised image&gt;\n\nkubectl get pods -o json --all-namespaces | \\\n    jq -r --arg image \"$IMAGE\" '.items[] | \n    select(.spec.containers[] | .image == $image) | \n    \"\\(.metadata.name) \\(.metadata.namespace) \\(.spec.nodeName)\"'\n</code></pre>"},{"location":"security/docs/incidents/#isolate-the-pod-by-creating-a-network-policy-that-denies-all-ingress-and-egress-traffic-to-the-pod","title":"Isolate the Pod by creating a Network Policy that denies all ingress and egress traffic to the pod","text":"<p>A deny all traffic rule may help stop an attack that is already underway by severing all connections to the pod. The following Network Policy will apply to a pod with the label <code>app=web</code>.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\nspec:\n  podSelector:\n    matchLabels: \n      app: web\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre> <p>Attention</p> <p>A Network Policy may prove ineffective if an attacker has gained access to underlying host. If you suspect that has happened, you can use AWS Security Groups to isolate a compromised host from other hosts. When changing a host's security group, be aware that it will impact all containers running on that host.  </p>"},{"location":"security/docs/incidents/#revoke-temporary-security-credentials-assigned-to-the-pod-or-worker-node-if-necessary","title":"Revoke temporary security credentials assigned to the pod or worker node if necessary","text":"<p>If the worker node has been assigned an IAM role that allows Pods to gain access to other AWS resources, remove those roles from the instance to prevent further damage from the attack. Similarly, if the Pod has been assigned an IAM role, evaluate whether you can safely remove the IAM policies from the role without impacting other workloads.</p>"},{"location":"security/docs/incidents/#cordon-the-worker-node","title":"Cordon the worker node","text":"<p>By cordoning the impacted worker node, you're informing the scheduler to avoid scheduling pods onto the affected node. This will allow you to remove the node for forensic study without disrupting other workloads.</p> <p>Info</p> <p>This guidance is not applicable to Fargate where each Fargate pod run in its own sandboxed environment.  Instead of cordoning, sequester the affected Fargate pods by applying a network policy that denies all ingress and egress traffic.</p>"},{"location":"security/docs/incidents/#enable-termination-protection-on-impacted-worker-node","title":"Enable termination protection on impacted worker node","text":"<p>An attacker may attempt to erase their misdeeds by terminating an affected node.  Enabling termination protection can prevent this from happening.  Instance scale-in protection will protect the node from a scale-in event.</p> <p>Warning</p> <p>You cannot enable termination protection on a Spot instance.</p>"},{"location":"security/docs/incidents/#label-the-offending-podnode-with-a-label-indicating-that-it-is-part-of-an-active-investigation","title":"Label the offending Pod/Node with a label indicating that it is part of an active investigation","text":"<p>This will serve as a warning to cluster administrators not to tamper with the affected Pods/Nodes until the investigation is complete.</p>"},{"location":"security/docs/incidents/#capture-volatile-artifacts-on-the-worker-node","title":"Capture volatile artifacts on the worker node","text":"<ul> <li>Capture the operating system memory. This will capture the Docker daemon (or other container runtime) and its subprocesses per container. This can be accomplished using tools like LiME and Volatility, or through higher-level tools such as Automated Forensics Orchestrator for Amazon EC2 that build on top of them.</li> <li>Perform a netstat tree dump of the processes running and the open ports. This will capture the docker daemon and its subprocess per container.</li> <li>Run commands to save container-level state before evidence is altered. You can use capabilities of the container runtime to capture information about currently running containers. For example, with Docker, you could do the following:</li> <li><code>docker top CONTAINER</code> for processes running.</li> <li><code>docker logs CONTAINER</code> for daemon level held logs.</li> <li> <p><code>docker inspect CONTAINER</code> for various information about the container.</p> <p>The same could be achieved with containerd using the nerdctl CLI, in place of <code>docker</code> (e.g. <code>nerdctl inspect</code>). Some additional commands are available depending on the container runtime. For example, Docker has <code>docker diff</code> to see changes to the container filesystem or <code>docker checkpoint</code> to save all container state including volatile memory (RAM). See this Kubernetes blog post for discussion of similar capabilities with containerd or CRI-O runtimes.</p> </li> <li> <p>Pause the container for forensic capture.</p> </li> <li>Snapshot the instance's EBS volumes.</li> </ul>"},{"location":"security/docs/incidents/#redeploy-compromised-pod-or-workload-resource","title":"Redeploy compromised Pod or Workload Resource","text":"<p>Once you have gathered data for forensic analysis, you can redeploy the compromised pod or workload resource.</p> <p>First roll out the fix for the vulnerability that was compromised and start new replacement pods. Then delete the vulnerable pods.</p> <p>If the vulnerable pods are managed by a higher-level Kubernetes workload resource (for example, a Deployment or DaemonSet), deleting them will schedule new ones. So vulnerable pods will be launched again. In that case you should deploy a new replacement workload resource after fixing the vulnerability. Then you should delete the vulnerable workload.</p>"},{"location":"security/docs/incidents/#recommendations","title":"Recommendations","text":""},{"location":"security/docs/incidents/#review-the-aws-security-incident-response-whitepaper","title":"Review the AWS Security Incident Response Whitepaper","text":"<p>While this section gives a brief overview along with a few  recommendations for handling suspected security breaches, the topic is exhaustively covered in the white paper, AWS Security Incident Response.</p>"},{"location":"security/docs/incidents/#practice-security-game-days","title":"Practice security game days","text":"<p>Divide your security practitioners into 2 teams: red and blue.  The red team will be focused on probing different systems for vulnerabilities while the blue team will be responsible for defending against them.  If you don't have enough security practitioners to create separate teams, consider hiring an outside entity that has knowledge of Kubernetes exploits.</p> <p>Kubesploit is a penetration testing framework from CyberArk that you can use to conduct game days. Unlike other tools which scan your cluster for vulnerabilities, kubesploit simulates a real-world attack. This gives your blue team an opportunity to practice its response to an attack and gauge its effectiveness.</p>"},{"location":"security/docs/incidents/#run-penetration-tests-against-your-cluster","title":"Run penetration tests against your cluster","text":"<p>Periodically attacking your own cluster can help you discover vulnerabilities and misconfigurations.  Before getting started, follow the penetration test guidelines before conducting a test against your cluster.</p>"},{"location":"security/docs/incidents/#tools-and-resources","title":"Tools and resources","text":"<ul> <li>kube-hunter, a penetration testing tool for Kubernetes.</li> <li>Gremlin, a chaos engineering toolkit that you can use to simulate attacks against your applications and infrastructure.</li> <li>Attacking and Defending Kubernetes Installations</li> <li>kubesploit</li> <li>NeuVector by SUSE open source, zero-trust container security platform, provides vulnerability- and risk reporting as well as security event notification</li> <li>Advanced Persistent Threats</li> <li>Kubernetes Practical Attack and Defense</li> <li>Compromising Kubernetes Cluster by Exploiting RBAC Permissions</li> </ul>"},{"location":"security/docs/multiaccount/","title":"Multi Account Strategy","text":"<p>AWS recommends using a multi account strategy and AWS organizations to help isolate and manage your business applications and data. There are many benefits to using a multi account strategy:</p> <ul> <li>Increased AWS API service quotas. Quotas are applied to AWS accounts, and using multiple accounts for your workloads increases the overall quota available to your workloads.</li> <li>Simpler Identity and Access Management (IAM) policies. Granting workloads and the operators that support them access to only their own AWS accounts means less time crafting fine-grained IAM policies to achieve the principle of least privilege.</li> <li>Improved Isolation of AWS resources. By design, all resources provisioned within an account are logically isolated from resources provisioned in other accounts. This isolation boundary provides you with a way to limit the risks of an application-related issue, misconfiguration, or malicious actions. If an issue occurs within one account, impacts to workloads contained in other accounts can be either reduced or eliminated.</li> <li>More benefits, as described in the AWS Multi Account Strategy Whitepaper</li> </ul> <p>The following sections will explain how to implement a multi account strategy for your EKS workloads using either a centralized, or de-centralized EKS cluster approach.</p>"},{"location":"security/docs/multiaccount/#planning-for-a-multi-workload-account-strategy-for-multi-tenant-clusters","title":"Planning for a Multi Workload Account Strategy for Multi Tenant Clusters","text":"<p>In a multi account AWS strategy, resources that belong to a given workload such as S3 buckets, ElastiCache clusters and DynamoDB Tables are all created in an AWS account that contains all the resources for that workload. These are referred to as a workload account, and the EKS cluster is deployed into an account referred to as the cluster account. Cluster accounts will be explored in the next section. Deploying resources into a dedicated workload account is similar to deploying kubernetes resources into a dedicated namespace.</p> <p>Workload accounts can then be further broken down by software development lifecycle or other requirements if appropriate. For example a given workload can have a production account, a development account, or accounts for hosting instances of that workload in a specific region. More information is available in this AWS whitepaper.</p> <p>You can adopt the following approaches when implementing EKS Multi account strategy:</p>"},{"location":"security/docs/multiaccount/#centralized-eks-cluster","title":"Centralized EKS Cluster","text":"<p>In this approach, your EKS Cluster will be deployed in a single AWS account called the <code>Cluster Account</code>. Using IAM roles for Service Accounts (IRSA) or EKS Pod Identities to deliver temporary AWS credentials and AWS Resource Access Manager (RAM) to simplify network access, you can adopt a multi account strategy for your multi tenant EKS cluster. The cluster account will contain the VPC, subnets, EKS cluster, EC2/Fargate compute resources (worker nodes), and any additional networking configurations needed to run your EKS cluster.</p> <p>In a multi workload account strategy for multi tenant cluster, AWS accounts typically align with kubernetes namespaces as a mechanism for isolating groups of resources. Best practices for tenant isolation within an EKS cluster should still be followed when implementing a multi account strategy for multi tenant EKS clusters.</p> <p>It is possible to have multiple <code>Cluster Accounts</code> in your AWS organization, and it is a best practice to have multiple <code>Cluster Accounts</code> that align with your software development lifecycle needs. For workloads operating at a very large scale, you may require multiple <code>Cluster Accounts</code> to ensure that there are enough kubernetes and AWS service quotas available to all your workloads.</p> In the above diagram, AWS RAM is used to share subnets from a cluster account into a workload account. Then workloads running in EKS pods use IRSA or EKS Pod Identities and role chaining to assume a role in their workload account and access their AWS resources."},{"location":"security/docs/multiaccount/#implementing-a-multi-workload-account-strategy-for-multi-tenant-cluster","title":"Implementing a Multi Workload Account Strategy for Multi Tenant Cluster","text":""},{"location":"security/docs/multiaccount/#sharing-subnets-with-aws-resource-access-manager","title":"Sharing Subnets With AWS Resource Access Manager","text":"<p>AWS Resource Access Manager (RAM) allows you to share resources across AWS accounts.</p> <p>If RAM is enabled for your AWS Organization, you can share the VPC Subnets from the Cluster account to your workload accounts. This will allow AWS resources owned by your workload accounts, such as Amazon ElastiCache Clusters or Amazon Relational Database Service (RDS) Databases to be deployed into the same VPC as your EKS cluster, and be consumable by the workloads running on your EKS cluster.</p> <p>To share a resource via RAM, open up RAM in the AWS console of the cluster account and select \"Resource Shares\" and \"Create Resource Share\". Name your Resource Share and Select the subnets you want to share. Select Next again and enter the 12 digit account IDs for the workload accounts you wish to share the subnets with, select next again, and click Create resource share to finish. After this step, the workload account can deploy resources into those subnets.</p> <p>RAM shares can also be created programmatically, or with infrastructure as code.</p>"},{"location":"security/docs/multiaccount/#choosing-between-eks-pod-identities-and-irsa","title":"Choosing Between EKS Pod Identities and IRSA","text":"<p>At re:Invent 2023, AWS launched EKS Pod Identities as a simpler way of delivering temporary AWS credentials to your pods on EKS. Both IRSA and EKS Pod Identities are valid methods for delivering temporary AWS credentials to your EKS pods and will continue to be supported. You should consider which method of delivering best meets your needs.</p> <p>When working with a EKS cluster and multiple AWS accounts, IRSA can directly assume roles in AWS accounts other than the account the EKS cluster is hosted in directly, while EKS Pod identities require you to configure role chaining. Refer EKS documentation for an in-depth comparison.</p>"},{"location":"security/docs/multiaccount/#accessing-aws-api-resources-with-iam-roles-for-service-accounts","title":"Accessing AWS API Resources with IAM Roles For Service Accounts","text":"<p>IAM Roles for Service Accounts (IRSA) allows you to deliver temporary AWS credentials to your workloads running on EKS. IRSA can be used to get temporary credentials for IAM roles in the workload accounts from the cluster account. This allows your workloads running on your EKS clusters in the cluster account to consume AWS API resources, such as S3 buckets hosted in the workload account seemlessly, and use IAM authentication for resources like Amazon RDS Databases or Amazon EFS FileSystems.</p> <p>AWS API resources and other Resources that use IAM authentication in a workload account can only be accessed by credentials for IAM roles in that same workload account, except where cross account access is capable and has been explicity enabled.</p>"},{"location":"security/docs/multiaccount/#enabling-irsa-for-cross-account-access","title":"Enabling IRSA for cross account access","text":"<p>To enable IRSA for workloads in your Cluster Account to access resources in your Workload accounts, you first must create an IAM OIDC identity provider in your workload account. This can be done with the same procedure for setting up IRSA, except the Identity Provider will be created in the workload account.</p> <p>Then when configuring IRSA for your workloads on EKS, you can follow the same steps as the documentation, but use the 12 digit account id of the workload account as mentioned in the section \"Example Create an identity provider from another account's cluster\".</p> <p>After this is configured, your application running in EKS will be able to directly use its service account to assume a role in the workload account, and use resources within it.</p>"},{"location":"security/docs/multiaccount/#accessing-aws-api-resources-with-eks-pod-identities","title":"Accessing AWS API Resources with EKS Pod Identities","text":"<p>EKS Pod Identities is a new way of delivering AWS credentials to your workloads running on EKS. EKS pod identities simplifies the configuration of AWS resources as you no longer need to manage OIDC configurations to deliver AWS credentials to your pods on EKS.</p>"},{"location":"security/docs/multiaccount/#enabling-eks-pod-identities-for-cross-account-access","title":"Enabling EKS Pod Identities for cross account access","text":"<p>Unlike IRSA, EKS Pod Identities can only be used to directly grant access to a role in the same account as the EKS cluster. To access a role in another AWS account, pods that use EKS Pod Identities must perform Role Chaining.</p> <p>Role chaining can be configured in an applications profile with their aws configuration file using the Process Credentials Provider available in various AWS SDKs. <code>credential_process</code> can be used as a credential source when configuring a profile, such as:</p> <pre><code># Content of the AWS Config file\n[profile account_b_role] \nsource_profile = account_a_role \nrole_arn = arn:aws:iam::444455556666:role/account-b-role\n\n[profile account_a_role] \ncredential_process = /eks-credential-processrole.sh\n</code></pre> <p>The source of the script called by credential_process:</p> <pre><code>#!/bin/bash\n# Content of the eks-credential-processrole.sh\n# This will retreive the credential from the pod identities agent,\n# and return it to the AWS SDK when referenced in a profile\ncurl -H \"Authorization: $(cat $AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE)\" $AWS_CONTAINER_CREDENTIALS_FULL_URI | jq -c '{AccessKeyId: .AccessKeyId, SecretAccessKey: .SecretAccessKey, SessionToken: .Token, Expiration: .Expiration, Version: 1}' \n</code></pre> <p>You can create an aws config file as shown above with both Account A and B roles and specify the AWS_CONFIG_FILE and AWS_PROFILE env vars in your pod spec. EKS Pod identity webhook does not override if the env vars already exists in the pod spec.</p> <pre><code># Snippet of the PodSpec\ncontainers: \n  - name: container-name\n    image: container-image:version\n    env:\n    - name: AWS_CONFIG_FILE\n      value: path-to-customer-provided-aws-config-file\n    - name: AWS_PROFILE\n      value: account_b_role\n</code></pre> <p>When configuring role trust policies for role chaining with EKS pod identities, you can reference EKS specific attributes as session tags and use attribute based access control(ABAC) to limit access to your IAM roles to only specific EKS Pod identity sessions, such as the Kubernetes Service Account a pod belongs to.</p> <p>Please note that some of these attributes may not be universally unique, for example two EKS clusters may have identical namespaces, and one cluster may have identically named service accounts across namespaces. So when granting access via EKS Pod Identities and ABAC, it is a best practice to always consider the cluster arn and namespace when granting access to a service account.</p>"},{"location":"security/docs/multiaccount/#abac-and-eks-pod-identities-for-cross-account-access","title":"ABAC and EKS Pod Identities for cross account access","text":"<p>When using EKS Pod Identities to assume roles (role chaining) in other accounts as part of a multi account strategy, you have the option to assign a unique IAM role for each service account that needs to access another account, or use a common IAM role across multiple service accounts and use ABAC to control what accounts it can access.</p> <p>To use ABAC to control what service accounts can assume a role into another account with role chaining, you create a role trust policy statement that only allows a role to be assumed by a role session when the expected values are present. The following role trust policy will only let a role from the EKS cluster account (account ID 111122223333) assume a role if the <code>kubernetes-service-account</code>, <code>eks-cluster-arn</code> and <code>kubernetes-namespace</code> tags all have the expected value.</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:aws:iam::111122223333:root\"\n            },\n            \"Action\": \"sts:AssumeRole\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalTag/kubernetes-service-account\": \"PayrollApplication\",\n                    \"aws:PrincipalTag/eks-cluster-arn\": \"arn:aws:eks:us-east-1:111122223333:cluster/ProductionCluster\",\n                    \"aws:PrincipalTag/kubernetes-namespace\": \"PayrollNamespace\"\n                }\n            }\n        }\n    ]\n}\n</code></pre> <p>When using this strategy it is a best practice to ensure that the common IAM role only has <code>sts:AssumeRole</code> permissions and no other AWS access.</p> <p>It is important when using ABAC that you control who has the ability to tag IAM roles and users to only those who have a strict need to do so. Someone with the ability to tag an IAM role or user would be able to set tags on roles/users identical to what would be set by EKS Pod Identities and may be able to escalate their privileges. You can restrict who has the access to set tags the <code>kubernetes-</code> and <code>eks-</code> tags on IAM role and users using IAM policy, or Service Control Policy (SCP).</p>"},{"location":"security/docs/multiaccount/#de-centralized-eks-clusters","title":"De-centralized EKS Clusters","text":"<p>In this approach, EKS clusters are deployed to respective workload AWS Accounts and live along side with other AWS resources like Amazon S3 buckets, VPCs, Amazon DynamoDB tables, etc., Each workload account is independent, self-sufficient, and operated by respective Business Unit/Application teams. This model allows the creation of reusuable blueprints for various cluster capabilities (AI/ML cluster, Batch processing, General purpose, etc.,) and vend the clusters based on the application team requirements. Both application and platform teams operate out of their respective GitOps repositories to manage the deployments to the workload clusters.</p> In the above diagram, Amazon EKS clusters and other AWS resources are deployed to respective workload accounts. Then workloads running in EKS pods use IRSA or EKS Pod Identities to access their AWS resources. <p>GitOps is a way of managing application and infrastructure deployment so that the whole system is described declaratively in a Git repository. It\u2019s an operational model that offers you the ability to manage the state of multiple Kubernetes clusters using the best practices of version control, immutable artifacts, and automation. In this multi cluster model, each workload cluster is bootstrapped with multiple Git repos, allowing each team (application, platform, security, etc.,) to deploy their respective changes on the cluster.</p> <p>You would utilize IAM roles for Service Accounts (IRSA) or EKS Pod Identities in each account to allow your EKS workloads to get temporary aws credentials to securely access other AWS resources. IAM roles are created in respective workload AWS Accounts and map them to k8s service accounts to provide temporary IAM access. So, no cross-account access is required in this approach. Follow the IAM roles for Service Accounts documentation on how to setup in each workload for IRSA, and EKS Pod Identities documentation on how to setup EKS pod identities in each account.</p>"},{"location":"security/docs/multiaccount/#centralized-networking","title":"Centralized Networking","text":"<p>You can also utilize AWS RAM to share the VPC Subnets to workload accounts and launch Amazon EKS clusters and other AWS resources in them. This enables centralized network managment/administration, simplified network connectivity, and de-centralized EKS clusters. Refer this AWS blog for a detailed walkthrough and considerations of this approach.</p> In the above diagram, AWS RAM is used to share subnets from a central networking account into a workload account. Then EKS cluster and other AWS resources are launched in those subnets in respective workload accounts. EKS pods use IRSA or EKS Pod Identities to access their AWS resources."},{"location":"security/docs/multiaccount/#centralized-vs-de-centralized-eks-clusters","title":"Centralized vs De-centralized EKS clusters","text":"<p>The decision to run with a Centralized or De-centralized will depend on your requirements. This table demonstrates the key differences with each strategy.</p> # Centralized EKS cluster De-centralized EKS clusters Cluster Management: Managing a single EKS cluster is easier than administrating multiple clusters An Efficient cluster management automation is necessary to reduce the operational overhead of managing multiple EKS clusters Cost Efficiency: Allows reuse of EKS cluster and network resources, which promotes cost efficiency Requires networking and cluster setups per workload, which requires additional resources Resilience: Multiple workloads on the centralized cluster may be impacted if a cluster becomes impaired If a cluster becomes impaired, the damage is limited to only the workloads that run on that cluster. All other workloads are unaffected Isolation &amp; Security: Isolation/Soft Multi-tenancy is achieved using k8s native constructs like <code>Namespaces</code>. Workloads may share the underlying resources like CPU, memory, etc. AWS resources are isolated into their own workload accounts which by default are not accessible from other AWS accounts. Stronger isolation on compute resources as the workloads run in individual clusters and nodes that don't share any resources. AWS resources are isolated into their own workload accounts which by default are not accessible from other AWS accounts. Performance &amp; Scalabity: As workloads grow to very large scales you may encounter kubernetes and AWS service quotas in the cluster account. You can deploy addtional cluster accounts to scale even further As more clusters and VPCs are present, each workload has more available k8s and AWS service quota Networking: Single VPC is used per cluster, allowing for simpler connectivity for applications on that cluster Routing must be established between the de-centralized EKS cluster VPCs Kubernetes Access Management: Need to maintain many different roles and users in the cluster to provide access to all workload teams and ensure kubernetes resources are properly segregated Simplified access management as each cluster is dedicated to a workload/team AWS Access Management: AWS resources are deployed into to their own account which can only be accessed by default with IAM roles in the workload account. IAM roles in the workload accounts are assumed cross account either with IRSA or EKS Pod Identities. AWS resources are deployed into to their own account which can only be accessed by default with IAM roles in the workload account. IAM roles in the workload accounts are delivered directly to pods with IRSA or EKS Pod Identities"},{"location":"security/docs/multitenancy/","title":"Tenant Isolation","text":"<p>When we think of multi-tenancy, we often want to isolate a user or application from other users or applications running on a shared infrastructure.</p> <p>Kubernetes is a single tenant orchestrator, i.e. a single instance of the control plane is shared among all the tenants  within a cluster. There are, however, various Kubernetes objects that you can use to create the semblance of multi-tenancy. For example, Namespaces and Role-based access controls (RBAC) can be implemented to logically isolate tenants from each other. Similarly, Quotas and Limit Ranges can be used to control the amount of cluster resources each tenant can consume. Nevertheless, the cluster is the only construct that provides a strong security boundary. This is because an attacker that manages to gain access to a host within the cluster can retrieve all Secrets, ConfigMaps, and Volumes, mounted on that host. They could also impersonate the Kubelet which would allow them to manipulate the attributes of the node and/or move laterally within the cluster.</p> <p>The following sections will explain how to implement tenant isolation while mitigating the risks of using a single tenant orchestrator like Kubernetes.</p>"},{"location":"security/docs/multitenancy/#soft-multi-tenancy","title":"Soft multi-tenancy","text":"<p>With soft multi-tenancy, you use native Kubernetes constructs, e.g. namespaces, roles and role bindings, and network policies, to create logical separation between tenants. RBAC, for example, can prevent tenants from accessing or manipulate each other's resources. Quotas and limit ranges control the amount of cluster resources each tenant can consume while network policies can help prevent applications deployed into different namespaces from communicating with each other.</p> <p>None of these controls, however, prevent pods from different tenants from sharing a node. If stronger isolation is required, you can use a node selector, anti-affinity rules, and/or taints and tolerations to force pods from different tenants to be scheduled onto separate nodes; often referred to as sole tenant nodes. This could get rather complicated, and cost prohibitive, in an environment with many tenants.</p> <p>Attention</p> <p>Soft multi-tenancy implemented with Namespaces does not allow you to provide tenants with a filtered list of Namespaces because Namespaces are a globally scoped Type. If a tenant has the ability to view a particular Namespace, it can view all Namespaces within the cluster.</p> <p>Warning</p> <p>With soft-multi-tenancy, tenants retain the ability to query CoreDNS for all services that run within the cluster by default. An attacker could exploit this by running dig SRV <code>*.*.svc.cluster.local</code> from any pod in the cluster.  If you need to restrict access to DNS records of services that run within your clusters, consider using the Firewall or Policy plugins for CoreDNS. For additional information, see https://github.com/coredns/policy#kubernetes-metadata-multi-tenancy-policy.</p> <p>Kiosk is an open source project that can aid in the implementation of soft multi-tenancy.  It is implemented as a series of CRDs and controllers that provide the following capabilities:</p> <ul> <li>Accounts &amp; Account Users to separate tenants in a shared Kubernetes cluster</li> <li>Self-Service Namespace Provisioning for account users</li> <li>Account Limits to ensure quality of service and fairness when sharing a cluster</li> <li>Namespace Templates for secure tenant isolation and self-service namespace initialization</li> </ul> <p>Loft is a commercial offering from the maintainers of Kiosk and DevSpace that adds the following capabilities:</p> <ul> <li>Multi-cluster access for granting access to spaces in different clusters</li> <li>Sleep mode scales down deployments in a space during periods of inactivity</li> <li>Single sign-on with OIDC authentication providers like GitHub</li> </ul> <p>There are three primary use cases that can be addressed by soft multi-tenancy.</p>"},{"location":"security/docs/multitenancy/#enterprise-setting","title":"Enterprise Setting","text":"<p>The first is in an Enterprise setting where the \"tenants\" are semi-trusted in that they are employees, contractors, or are otherwise authorized by the organization. Each tenant will typically align to an administrative division such as a department or team.</p> <p>In this type of setting, a cluster administrator will usually be responsible for creating namespaces and managing policies. They may also implement a delegated administration model where certain individuals are given oversight of a namespace, allowing them to perform CRUD operations for non-policy related objects like deployments, services, pods, jobs, etc.</p> <p>The isolation provided by a container runtime may be acceptable within this setting or it may need to be augmented with additional controls for pod security. It may also be necessary to restrict communication between services in different namespaces if stricter isolation is required.</p>"},{"location":"security/docs/multitenancy/#kubernetes-as-a-service","title":"Kubernetes as a Service","text":"<p>By contrast, soft multi-tenancy can be used in settings where you want to offer Kubernetes as a service (KaaS). With KaaS, your application is hosted in a shared cluster along with a collection of controllers and CRDs that provide a set of PaaS services.  Tenants interact directly with the Kubernetes API server and are permitted to perform CRUD operations on non-policy objects. There is also an element of self-service in that tenants may be allowed to create and manage their own namespaces. In this type of environment, tenants are assumed to be running untrusted code.</p> <p>To isolate tenants in this type of environment, you will likely need to implement strict network policies as well as pod sandboxing. Sandboxing is where you run the containers of a pod inside a micro VM like Firecracker or in a user-space kernel.  Today, you can create sandboxed pods with EKS Fargate.</p>"},{"location":"security/docs/multitenancy/#software-as-a-service-saas","title":"Software as a Service (SaaS)","text":"<p>The final use case for soft multi-tenancy is in a Software-as-a-Service (SaaS) setting.  In this environment, each tenant is associated with a particular instance of an application that's running within the cluster.  Each instance often has its own data and uses separate access controls that are usually independent of Kubernetes RBAC.</p> <p>Unlike the other use cases, the tenant in a SaaS setting does not directly interface with the Kubernetes API.  Instead, the SaaS application is responsible for interfacing with the Kubernetes API to create the necessary objects to support each tenant.</p>"},{"location":"security/docs/multitenancy/#kubernetes-constructs","title":"Kubernetes Constructs","text":"<p>In each of these instances the following constructs are used to isolate tenants from each other:</p>"},{"location":"security/docs/multitenancy/#namespaces","title":"Namespaces","text":"<p>Namespaces are fundamental to implementing soft multi-tenancy. They allow you to divide the cluster into logical partitions. Quotas, network policies, service accounts, and other objects needed to implement multi-tenancy are scoped to a namespace.</p>"},{"location":"security/docs/multitenancy/#network-policies","title":"Network policies","text":"<p>By default, all pods in a Kubernetes cluster are allowed to communicate with each other. This behavior can be altered using network policies.</p> <p>Network policies restrict communication between pods using labels or IP address ranges. In a multi-tenant environment where strict network isolation between tenants is required, we recommend starting with a default rule that denies communication between pods, and another rule that allows all pods to query the DNS server for name resolution. With that in place, you can begin adding more permissive rules that allow for communication within a namespace. This can be further refined as required.</p> <p>Note</p> <p>Amazon VPC CNI now supports Kubernetes Network Policies to create policies that can isolate sensitive workloads and protect them from unauthorized access when running Kubernetes on AWS. This means that you can use all the capabilities of the Network Policy API within your Amazon EKS cluster. This level of granular control enables you to implement the principle of least privilege, which ensures that only authorized pods are allowed to communicate with each other.</p> <p>Attention</p> <p>Network policies are necessary but not sufficient. The enforcement of network policies requires a policy engine such as Calico or Cilium.</p>"},{"location":"security/docs/multitenancy/#role-based-access-control-rbac","title":"Role-based access control (RBAC)","text":"<p>Roles and role bindings are the Kubernetes objects used to enforce role-based access control (RBAC) in Kubernetes. Roles contain lists of actions that can be performed against objects in your cluster. Role bindings specify the individuals or groups to whom the roles apply.  In the enterprise and KaaS settings, RBAC can be used to permit administration of objects by selected groups or individuals.</p>"},{"location":"security/docs/multitenancy/#quotas","title":"Quotas","text":"<p>Quotas are used to define limits on workloads hosted in your cluster. With quotas, you can specify the maximum amount of CPU and memory that a pod can consume, or you can limit the number of resources that can be allocated in a cluster or namespace. Limit ranges allow you to declare minimum, maximum, and default values for each limit.</p> <p>Overcommitting resources in a shared cluster is often beneficial because it allows you maximize your resources.  However, unbounded access to a cluster can cause resource starvation, which can lead to performance degradation and loss of application availability. If a pod's requests are set too low and the actual resource utilization exceeds the capacity of the node, the node will begin to experience CPU or memory pressure.  When this happens, pods may be restarted and/or evicted from the node.</p> <p>To prevent this from happening, you should plan to impose quotas on namespaces in a multi-tenant environment to force tenants to specify requests and limits when scheduling their pods on the cluster.  It will also mitigate a potential denial of service by constraining the amount of resources a pod can consume.</p> <p>You can also use quotas to apportion the cluster's resources to align with a tenant's spend.  This is particularly useful in the KaaS scenario.</p>"},{"location":"security/docs/multitenancy/#pod-priority-and-preemption","title":"Pod priority and preemption","text":"<p>Pod priority and preemption can be useful when you want to provide more importance to a Pod relative to other Pods.  For example, with pod priority you can configure pods from customer A to run at a higher priority than customer B. When there's insufficient capacity available, the scheduler will evict the lower-priority pods from customer B to accommodate the higher-priority pods from customer A.  This can be especially handy in a SaaS environment where customers willing to pay a premium receive a higher priority.</p> <p>Attention</p> <p>Pods priority can have an undesired effect on other Pods with lower priority. For example, although the victim pods are terminated gracefully but the PodDisruptionBudget is not guaranteed, which could break a application with lower priority that relies on a quorum of Pods, see Limitations of preemption.</p>"},{"location":"security/docs/multitenancy/#mitigating-controls","title":"Mitigating controls","text":"<p>Your chief concern as an administrator of a multi-tenant environment is preventing an attacker from gaining access to the underlying host. The following controls should be considered to mitigate this risk:</p>"},{"location":"security/docs/multitenancy/#sandboxed-execution-environments-for-containers","title":"Sandboxed execution environments for containers","text":"<p>Sandboxing is a technique by which each container is run in its own isolated virtual machine. Technologies that perform pod sandboxing include Firecracker and Weave's Firekube.</p> <p>For additional information about the effort to make Firecracker a supported runtime for EKS, see https://threadreaderapp.com/thread/1238496944684597248.html.</p>"},{"location":"security/docs/multitenancy/#open-policy-agent-opa-gatekeeper","title":"Open Policy Agent (OPA) &amp; Gatekeeper","text":"<p>Gatekeeper is a Kubernetes admission controller that enforces policies created with OPA. With OPA you can create a policy that runs pods from tenants on separate instances or at a higher priority than other tenants. A collection of common OPA policies can be found in the GitHub repository for this project.</p> <p>There is also an experimental OPA plugin for CoreDNS that allows you to use OPA to filter/control the records returned by CoreDNS.</p>"},{"location":"security/docs/multitenancy/#kyverno","title":"Kyverno","text":"<p>Kyverno is a Kubernetes native policy engine that can validate, mutate, and generate configurations with policies as Kubernetes resources. Kyverno uses Kustomize-style overlays for validation, supports JSON Patch and strategic merge patch for mutation, and can clone resources across namespaces based on flexible triggers.</p> <p>You can use Kyverno to isolate namespaces, enforce pod security and other best practices, and generate default configurations such as network policies.  Several examples are included in the GitHub repository for this project. Many others are included in the policy library on the Kyverno website.</p>"},{"location":"security/docs/multitenancy/#isolating-tenant-workloads-to-specific-nodes","title":"Isolating tenant workloads to specific nodes","text":"<p>Restricting tenant workloads to run on specific nodes can be used to increase isolation in the soft multi-tenancy model. With this approach, tenant-specific workloads are only run on nodes provisioned for the respective tenants. To achieve this isolation, native Kubernetes properties (node affinity, and taints and tolerations) are used to target specific nodes for pod scheduling, and prevent pods, from other tenants, from being scheduled on the tenant-specific nodes.</p>"},{"location":"security/docs/multitenancy/#part-1-node-affinity","title":"Part 1 - Node affinity","text":"<p>Kubernetes node affinity is used to target nodes for scheduling, based on node labels. With node affinity rules, the pods are attracted to specific nodes that match the selector terms. In the below pod specification, the <code>requiredDuringSchedulingIgnoredDuringExecution</code> node affinity is applied to the respective pod. The result is that the pod will target nodes that are labeled with the following key/value: <code>node-restriction.kubernetes.io/tenant: tenants-x</code>.</p> <pre><code>...\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: node-restriction.kubernetes.io/tenant\n            operator: In\n            values:\n            - tenants-x\n...\n</code></pre> <p>With this node affinity, the label is required during scheduling, but not during execution; if the underlying nodes' labels change, the pods will not be evicted due solely to that label change. However, future scheduling could be impacted.</p> <p>Warning</p> <p>The label prefix of <code>node-restriction.kubernetes.io/</code> has special meaning in Kubernetes. NodeRestriction which is enabled for EKS clusters prevents <code>kubelet</code> from adding/removing/updating labels with this prefix. Attackers aren't able to use the <code>kubelet</code>'s credentials to update the node object or modify the system setup to pass these labels into <code>kubelet</code> as <code>kubelet</code> isn't allowed to modify these labels. If this prefix is used for all pod to node scheduling, it prevents scenarios where an attacker may want to attract a different set of workloads to a node by modifying the node labels.</p> <p>Info</p> <p>Instead of node affinity, we could have used the node selector. However, node affinity is more expressive and allows for more conditions to be considered during pod scheduling. For additional information about the differences and more advanced scheduling choices, please see this CNCF blog post on Advanced Kubernetes pod to node scheduling.</p>"},{"location":"security/docs/multitenancy/#part-2-taints-and-tolerations","title":"Part 2 - Taints and tolerations","text":"<p>Attracting pods to nodes is just the first part of this three-part approach. For this approach to work, we must repel pods from scheduling onto nodes for which the pods are not authorized. To repel unwanted or unauthorized pods, Kubernetes uses node taints. Taints are used to place conditions on nodes that prevent pods from being scheduled. The below taint uses a key-value pair of <code>tenant: tenants-x</code>.</p> <pre><code>...\n    taints:\n      - key: tenant\n        value: tenants-x\n        effect: NoSchedule\n...\n</code></pre> <p>Given the above node <code>taint</code>, only pods that tolerate the taint will be allowed to be scheduled on the node. To allow authorized pods to be scheduled onto the node, the respective pod specifications must include a <code>toleration</code> to the taint, as seen below.</p> <pre><code>...\n  tolerations:\n  - effect: NoSchedule\n    key: tenant\n    operator: Equal\n    value: tenants-x\n...\n</code></pre> <p>Pods with the above <code>toleration</code> will not be stopped from scheduling on the node, at least not because of that specific taint. Taints are also used by Kubernetes to temporarily stop pod scheduling during certain conditions, like node resource pressure. With node affinity, and taints and tolerations, we can effectively attract the desired pods to specific nodes and repel unwanted pods.</p> <p>Attention</p> <p>Certain Kubernetes pods are required to run on all nodes. Examples of these pods are those started by the Container Network Interface (CNI) and kube-proxy daemonsets. To that end, the specifications for these pods contain very permissive tolerations, to tolerate different taints. Care should be taken to not change these tolerations. Changing these tolerations could result in incorrect cluster operation. Additionally, policy-management tools, such as OPA/Gatekeeper and Kyverno can be used to write validating policies that prevent unauthorized pods from using these permissive tolerations.</p>"},{"location":"security/docs/multitenancy/#part-3-policy-based-management-for-node-selection","title":"Part 3 - Policy-based management for node selection","text":"<p>There are several tools that can be used to help manage the node affinity and tolerations of pod specifications, including enforcement of rules in CICD pipelines. However, enforcement of isolation should also be done at the Kubernetes cluster level. For this purpose, policy-management tools can be used to mutate inbound Kubernetes API server requests, based on request payloads, to apply the respective node affinity rules and tolerations mentioned above.</p> <p>For example, pods destined for the tenants-x namespace can be stamped with the correct node affinity and toleration to permit scheduling on the tenants-x nodes. Utilizing policy-management tools configured using the Kubernetes Mutating Admission Webhook, policies can be used to mutate the inbound pod specifications. The mutations add the needed elements to allow desired scheduling. An example OPA/Gatekeeper policy that adds a node affinity is seen below.</p> <pre><code>apiVersion: mutations.gatekeeper.sh/v1alpha1\nkind: Assign\nmetadata:\n  name: mutator-add-nodeaffinity-pod\n  annotations:\n    aws-eks-best-practices/description: &gt;-\n      Adds Node affinity - https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity\nspec:\n  applyTo:\n  - groups: [\"\"]\n    kinds: [\"Pod\"]\n    versions: [\"v1\"]\n  match:\n    namespaces: [\"tenants-x\"]\n  location: \"spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms\"\n  parameters:\n    assign:\n      value: \n        - matchExpressions:\n          - key: \"tenant\"\n            operator: In\n            values:\n            - \"tenants-x\"\n</code></pre> <p>The above policy is applied to a Kubernetes API server request, to apply a pod to the tenants-x namespace. The policy adds the <code>requiredDuringSchedulingIgnoredDuringExecution</code> node affinity rule, so that pods are attracted to nodes with the <code>tenant: tenants-x</code> label.</p> <p>A second policy, seen below, adds the toleration to the same pod specification, using the same matching criteria of target namespace and groups, kinds, and versions.</p> <pre><code>apiVersion: mutations.gatekeeper.sh/v1alpha1\nkind: Assign\nmetadata:\n  name: mutator-add-toleration-pod\n  annotations:\n    aws-eks-best-practices/description: &gt;-\n      Adds toleration - https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\nspec:\n  applyTo:\n  - groups: [\"\"]\n    kinds: [\"Pod\"]\n    versions: [\"v1\"]\n  match:\n    namespaces: [\"tenants-x\"]\n  location: \"spec.tolerations\"\n  parameters:\n    assign:\n      value: \n      - key: \"tenant\"\n        operator: \"Equal\"\n        value: \"tenants-x\"\n        effect: \"NoSchedule\"\n</code></pre> <p>The above policies are specific to pods; this is due to the paths to the mutated elements in the policies' <code>location</code> elements. Additional policies could be written to handle resources that create pods, like Deployment and Job resources. The listed policies and other examples can been seen in the companion GitHub project for this guide.</p> <p>The result of these two mutations is that pods are attracted to the desired node, while at the same time, not repelled by the specific node taint. To verify this, we can see the snippets of output from two <code>kubectl</code> calls to get the nodes labeled with <code>tenant=tenants-x</code>, and get the pods in the <code>tenants-x</code> namespace.</p> <pre><code>kubectl get nodes -l tenant=tenants-x\nNAME                                        \nip-10-0-11-255...\nip-10-0-28-81...\nip-10-0-43-107...\n\nkubectl -n tenants-x get pods -owide\nNAME                                  READY   STATUS    RESTARTS   AGE   IP            NODE\ntenant-test-deploy-58b895ff87-2q7xw   1/1     Running   0          13s   10.0.42.143   ip-10-0-43-107...\ntenant-test-deploy-58b895ff87-9b6hg   1/1     Running   0          13s   10.0.18.145   ip-10-0-28-81...\ntenant-test-deploy-58b895ff87-nxvw5   1/1     Running   0          13s   10.0.30.117   ip-10-0-28-81...\ntenant-test-deploy-58b895ff87-vw796   1/1     Running   0          13s   10.0.3.113    ip-10-0-11-255...\ntenant-test-pod                       1/1     Running   0          13s   10.0.35.83    ip-10-0-43-107...\n</code></pre> <p>As we can see from the above outputs, all the pods are scheduled on the nodes labeled with <code>tenant=tenants-x</code>. Simply put, the pods will only run on the desired nodes, and the other pods (without the required affinity and tolerations) will not. The tenant workloads are effectively isolated.</p> <p>An example mutated pod specification is seen below.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: tenant-test-pod\n  namespace: tenants-x\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: tenant\n            operator: In\n            values:\n            - tenants-x\n...\n  tolerations:\n  - effect: NoSchedule\n    key: tenant\n    operator: Equal\n    value: tenants-x\n...\n</code></pre> <p>Attention</p> <p>Policy-management tools that are integrated to the Kubernetes API server request flow, using mutating and validating admission webhooks, are designed to respond to the API server's request within a specified timeframe. This is usually 3 seconds or less. If the webhook call fails to return a response within the configured time, the mutation and/or validation of the inbound API sever request may or may not occur. This behavior is based on whether the admission webhook configurations are set to Fail Open or Fail Close.</p> <p>In the above examples, we used policies written for OPA/Gatekeeper. However, there are other policy management tools that handle our node-selection use case as well. For example, this Kyverno policy could be used to handle the node affinity mutation.</p> <p>Tip</p> <p>If operating correctly, mutating policies will effect the desired changes to inbound API server request payloads. However, validating policies should also be included to verify that the desired changes occur, before changes are allowed to persist. This is especially important when using these policies for tenant-to-node isolation. It is also a good idea to include Audit policies to routinely check your cluster for unwanted configurations.</p>"},{"location":"security/docs/multitenancy/#references","title":"References","text":"<ul> <li> <p>k-rail Designed to help you secure a multi-tenant environment through the enforcement of certain policies.</p> </li> <li> <p>Security Practices for MultiTenant SaaS Applications using Amazon EKS</p> </li> </ul>"},{"location":"security/docs/multitenancy/#hard-multi-tenancy","title":"Hard multi-tenancy","text":"<p>Hard multi-tenancy can be implemented by provisioning separate clusters for each tenant.  While this provides very strong isolation between tenants, it has several drawbacks.</p> <p>First, when you have many tenants, this approach can quickly become expensive. Not only will you have to pay for the control plane costs for each cluster, you will not be able to share compute resources between clusters.  This will eventually cause fragmentation where a subset of your clusters are underutilized while others are overutilized.</p> <p>Second, you will likely need to buy or build special tooling to manage all of these clusters.  In time, managing hundreds or thousands of clusters may simply become too unwieldy.</p> <p>Finally, creating a cluster per tenant will be slow relative to a creating a namespace. Nevertheless, a hard-tenancy approach may be necessary in highly-regulated industries or in SaaS environments where strong isolation is required.</p>"},{"location":"security/docs/multitenancy/#future-directions","title":"Future directions","text":"<p>The Kubernetes community has recognized the current shortcomings of soft multi-tenancy and the challenges with hard multi-tenancy. The Multi-Tenancy Special Interest Group (SIG) is attempting to address these shortcomings through several incubation projects, including Hierarchical Namespace Controller (HNC) and Virtual Cluster.</p> <p>The HNC proposal (KEP) describes a way to create parent-child relationships between namespaces with [policy] object inheritance along with an ability for tenant administrators to create sub-namespaces.</p> <p>The Virtual Cluster proposal describes a mechanism for creating separate instances of the control plane services, including the API server, the controller manager, and scheduler, for each tenant within the cluster (also known as \"Kubernetes on Kubernetes\").</p> <p>The Multi-Tenancy Benchmarks proposal provides guidelines for sharing clusters using namespaces for isolation and segmentation, and a command line tool kubectl-mtb to validate conformance to the guidelines.</p>"},{"location":"security/docs/multitenancy/#multi-cluster-management-tools-and-resources","title":"Multi-cluster management tools and resources","text":"<ul> <li>Banzai Cloud</li> <li>Kommander</li> <li>Lens</li> <li>Nirmata</li> <li>Rafay</li> <li>Rancher</li> <li>Weave Flux</li> </ul>"},{"location":"security/docs/network/","title":"Network security","text":"<p>Network security has several facets.  The first involves the application of rules which restrict the flow of network traffic between services.  The second involves the encryption of traffic while it is in transit.  The mechanisms to implement these security measures on EKS are varied but often include the following items:</p>"},{"location":"security/docs/network/#traffic-control","title":"Traffic control","text":"<ul> <li>Network Policies</li> <li>Security Groups</li> </ul>"},{"location":"security/docs/network/#network-encryption","title":"Network encryption","text":"<ul> <li>Service Mesh</li> <li>Container Network Interfaces (CNIs)</li> <li>Ingress Controllers and Load Balancers</li> <li>Nitro Instances</li> <li>ACM Private CA with cert-manager</li> </ul>"},{"location":"security/docs/network/#network-policy","title":"Network policy","text":"<p>Within a Kubernetes cluster, all Pod to Pod communication is allowed by default. While this flexibility may help promote experimentation, it is not considered secure. Kubernetes network policies give you a mechanism to restrict network traffic between Pods (often referred to as East/West traffic) as well as between Pods and external services. Kubernetes network policies operate at layers 3 and 4 of the OSI model. Network policies use pod, namespace selectors and labels to identify source and destination pods, but can also include IP addresses, port numbers, protocols, or a combination of these. Network Policies can be applied to both Inbound or Outbound connections to the pod, often called Ingress and Egress rules.</p> <p>With native network policy support of Amazon VPC CNI Plugin, you can implement network policies to secure network traffic in kubernetes clusters. This integrates with the upstream Kubernetes Network Policy API, ensuring compatibility and adherence to Kubernetes standards. You can define policies using different identifiers supported by the upstream API. By default, all ingress and egress traffic is allowed to a pod. When a network policy with a policyType Ingress is specified, only allowed connections into the pod are those from the pod's node and those allowed by the ingress rules. Same applies for egress rules.  If multiple rules are defined, then union of all rules are taken into account when making the decision. Thus, order of evaluation does not affect the policy result.</p> <p>Attention</p> <p>When you first provision an EKS cluster, VPC CNI Network Policy functionality is not enabled by default. Ensure you deployed supported VPC CNI Add-on version and set <code>ENABLE_NETWORK_POLICY</code> flag to <code>true</code> on the vpc-cni add-on to enable this. Refer Amazon EKS User guide for detailed instructions.</p>"},{"location":"security/docs/network/#recommendations","title":"Recommendations","text":""},{"location":"security/docs/network/#getting-started-with-network-policies-follow-principle-of-least-privilege","title":"Getting Started with Network Policies - Follow Principle of Least Privilege","text":""},{"location":"security/docs/network/#create-a-default-deny-policy","title":"Create a default deny policy","text":"<p>As with RBAC policies, it is recommended to follow least privileged access principles with network policies. Start by creating a deny all policy that restricts all inbound and outbound traffic with in a namespace.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\n  namespace: default\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre> <p></p> <p>Tip</p> <p>The image above was created by the network policy viewer from Tufin.</p>"},{"location":"security/docs/network/#create-a-rule-to-allow-dns-queries","title":"Create a rule to allow DNS queries","text":"<p>Once you have the default deny all rule in place, you can begin layering on additional rules, such as a rule that allows pods to query CoreDNS for name resolution.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-dns-access\n  namespace: default\nspec:\n  podSelector:\n    matchLabels: {}\n  policyTypes:\n  - Egress\n  egress:\n  - to:\n    - namespaceSelector:\n        matchLabels:\n          kubernetes.io/metadata.name: kube-system\n      podSelector:\n        matchLabels:\n          k8s-app: kube-dns\n    ports:\n    - protocol: UDP\n      port: 53\n</code></pre> <p></p>"},{"location":"security/docs/network/#incrementally-add-rules-to-selectively-allow-the-flow-of-traffic-between-namespacespods","title":"Incrementally add rules to selectively allow the flow of traffic between namespaces/pods","text":"<p>Understand the application requirements and create fine-grained ingress and egress rules as needed. Below example shows how to restrict ingress traffic on port 80 to <code>app-one</code> from <code>client-one</code>. This helps minimize the attack surface and reduces the risk of unauthorized access.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-ingress-app-one\n  namespace: default\nspec:\n  podSelector:\n    matchLabels:\n      k8s-app: app-one\n  policyTypes:\n  - Ingress\n  ingress:\n  - from:\n    - podSelector:\n        matchLabels:\n          k8s-app: client-one\n    ports:\n    - protocol: TCP\n      port: 80\n</code></pre> <p></p>"},{"location":"security/docs/network/#monitoring-network-policy-enforcement","title":"Monitoring network policy enforcement","text":"<ul> <li>Use Network Policy editor</li> <li>Network policy editor helps with visualizations, security score, autogenerates from network flow logs</li> <li>Build network policies in an interactive way</li> <li>Audit Logs</li> <li>Regularly review audit logs of your EKS cluster</li> <li>Audit logs provide wealth of information about what actions have been performed on your cluster including changes to network policies</li> <li>Use this information to track changes to your network policies over time and detect any unauthorized or unexpected changes</li> <li>Automated testing</li> <li>Implement automated testing by creating a test environment that mirrors your production environment and periodically deploy workloads that attempt to violate your network policies.</li> <li>Monitoring metrics</li> <li>Configure your observability agents to scrape the prometheus metrics from the VPC CNI node agents, that allows to monitor the agent health, and sdk errors.</li> <li>Audit Network Policies regularly</li> <li>Periodically audit your Network Policies to make sure that they meet your current application requirements. As your application evolves, an audit gives you the opportunity to remove redundant ingress, egress rules and make sure that your applications don\u2019t have excessive permissions.</li> <li>Ensure Network Policies exists using Open Policy Agent (OPA)</li> <li>Use OPA Policy like shown below to ensure Network Policy always exists before onboarding application pods. This policy denies onboarding k8s pods with a label <code>k8s-app: sample-app</code> if corresponding network policy does not exist.</li> </ul> <pre><code>package kubernetes.admission\nimport data.kubernetes.networkpolicies\n\ndeny[msg] {\n    input.request.kind.kind == \"Pod\"\n    pod_label_value := {v[\"k8s-app\"] | v := input.request.object.metadata.labels}\n    contains_label(pod_label_value, \"sample-app\")\n    np_label_value := {v[\"k8s-app\"] | v := networkpolicies[_].spec.podSelector.matchLabels}\n    not contains_label(np_label_value, \"sample-app\")\n    msg:= sprintf(\"The Pod %v could not be created because it is missing an associated Network Policy.\", [input.request.object.metadata.name])\n}\ncontains_label(arr, val) {\n    arr[_] == val\n}\n</code></pre>"},{"location":"security/docs/network/#troubleshooting","title":"Troubleshooting","text":""},{"location":"security/docs/network/#monitor-the-vpc-network-policy-controller-node-agent-logs","title":"Monitor the vpc-network-policy-controller, node-agent logs","text":"<p>Enable the EKS Control plane controller manager logs to diagnose the network policy functionality.  You can stream the control plane logs to a CloudWatch log group and use CloudWatch Log insights to perform advanced queries. From the logs, you can view what pod endpoint objects are resolved to a Network Policy, reconcilation status of the policies, and debug if the policy is working as expected.</p> <p>In addition, Amazon VPC CNI allows you to enable the collection and export of policy enforcement logs to Amazon Cloudwatch from the EKS worker nodes. Once enabled, you can leverage CloudWatch Container Insights to provide insights on your usage related to Network Policies.</p> <p>Amazon VPC CNI also ships an SDK that provides an interface to interact with eBPF programs on the node. The SDK is installed when the <code>aws-node</code> is deployed onto the nodes. You can find the SDK binary installed under <code>/opt/cni/bin</code> directory on the node. At launch, the SDK provides support for fundamental functionalities such as inspecting eBPF programs and maps.</p> <pre><code>sudo /opt/cni/bin/aws-eks-na-cli ebpf progs\n</code></pre>"},{"location":"security/docs/network/#log-network-traffic-metadata","title":"Log network traffic metadata","text":"<p>AWS VPC Flow Logs captures metadata about the traffic flowing through a VPC, such as source and destination IP address and port along with accepted/dropped packets. This information could be analyzed to look for suspicious or unusual activity between resources within the VPC, including Pods.  However, since the IP addresses of pods frequently change as they are replaced, Flow Logs may not be sufficient on its own.  Calico Enterprise extends the Flow Logs with pod labels and other metadata, making it easier to decipher the traffic flows between pods.</p>"},{"location":"security/docs/network/#security-groups","title":"Security groups","text":"<p>EKS uses AWS VPC Security Groups (SGs) to control the traffic between the Kubernetes control plane and the cluster's worker nodes. Security groups are also used to control the traffic between worker nodes, and other VPC resources, and external IP addresses.  When you provision an EKS cluster (with Kubernetes version 1.14-eks.3 or greater), a cluster security group is automatically created for you.  This security group allows unfettered communication between the EKS control plane and the nodes from managed node groups. For simplicity, it is recommended that you add the cluster SG to all node groups, including unmanaged node groups.</p> <p>Prior to Kubernetes version 1.14 and EKS version eks.3, there were separate security groups configured for the EKS control plane and node groups. The minimum and suggested rules for the control plane and node group security groups can be found at https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html.  The minimum rules for the control plane security group allows port 443 inbound from the worker node SG. This rule is what allows the kubelets to communicate with the Kubernetes API server.  It also includes port 10250 for outbound traffic to the worker node SG; 10250 is the port that the kubelets listen on. Similarly, the minimum node group rules allow port 10250 inbound from the control plane SG and 443 outbound to the control plane SG.  Finally there is a rule that allows unfettered communication between nodes within a node group.</p> <p>If you need to control communication between services that run within the cluster and service the run outside the cluster such as an RDS database, consider security groups for pods. With security groups for pods, you can assign an existing security group to a collection of pods.</p> <p>Warning</p> <p>If you reference a security group that does not exist prior to the creation of the pods, the pods will not get scheduled.</p> <p>You can control which pods are assigned to a security group by creating a <code>SecurityGroupPolicy</code> object and specifying a <code>PodSelector</code> or a <code>ServiceAccountSelector</code>. Setting the selectors to <code>{}</code> will assign the SGs referenced in the <code>SecurityGroupPolicy</code> to all pods in a namespace or all Service Accounts in a namespace. Be sure you've familiarized yourself with all the considerations before implementing security groups for pods.</p> <p>Important</p> <p>If you use SGs for pods you must create SGs that allow port 53 outbound to the cluster security group.  Similarly, you must update the cluster security group to accept port 53 inbound traffic from the pod security group.</p> <p>Important</p> <p>The limits for security groups still apply when using security groups for pods so use them judiciously.</p> <p>Important</p> <p>You must create rules for inbound traffic from the cluster security group (kubelet) for all of the probes configured for pod.</p> <p>Important</p> <p>Security groups for pods relies on a feature known as ENI trunking which was created to increase the ENI density of an EC2 instance. When a pod is assigned to an SG, a VPC controller associates a branch ENI from the node group with the pod. If there aren't enough branch ENIs available in a node group at the time the pod is scheduled, the pod will stay in pending state. The number of branch ENIs an instance can support varies by instance type/family. See https://docs.aws.amazon.com/eks/latest/userguide/security-groups-for-pods.html#supported-instance-types for further details.</p> <p>While security groups for pods offers an AWS-native way to control network traffic within and outside of your cluster without the overhead of a policy daemon, other options are available. For example, the Cilium policy engine allows you to reference a DNS name in a network policy. Calico Enterprise includes an option for mapping network policies to AWS security groups. If you've implemented a service mesh like Istio, you can use an egress gateway to restrict network egress to specific, fully qualified domains or IP addresses. For further information about this option, read the three part series on egress traffic control in Istio.</p>"},{"location":"security/docs/network/#when-to-use-network-policy-vs-security-group-for-pods","title":"When to use Network Policy vs Security Group for Pods?","text":""},{"location":"security/docs/network/#when-to-use-kubernetes-network-policy","title":"When to use Kubernetes network policy","text":"<ul> <li>Controlling pod-to-pod traffic</li> <li>Suitable for controlling network traffic between pods inside a cluster (east-west traffic)</li> <li>Control traffic at the IP address or port level (OSI layer 3 or 4)</li> </ul>"},{"location":"security/docs/network/#when-to-use-aws-security-groups-for-pods-sgp","title":"When to use AWS Security groups for pods (SGP)","text":"<ul> <li>Leverage existing AWS configurations</li> <li>If you already have complex set of EC2 security groups that manage access to AWS services and you are migrating applications from EC2 instances to EKS, SGPs can be a very good choice allowing you to reuse security group resources and apply them to your pods.</li> <li>Control access to AWS services</li> <li>Your applications running within an EKS cluster wants to communicate with other AWS services (RDS database), use SGPs as an efficient mechanism to control the traffic from the pods to AWS services.</li> <li>Isolation of Pod &amp; Node traffic</li> <li>If you want to completely separate pod traffic from the rest of the node traffic, use SGP in <code>POD_SECURITY_GROUP_ENFORCING_MODE=strict</code> mode.</li> </ul>"},{"location":"security/docs/network/#best-practices-using-security-groups-for-pods-and-network-policy","title":"Best practices using <code>Security groups for pods</code> and <code>Network Policy</code>","text":"<ul> <li>Layered security</li> <li>Use a combination of SGP and kubernetes network policy for a layered security approach</li> <li>Use SGPs to limit network level access to AWS services that are not part of a cluster, while kubernetes network policies can restrict network traffic between pods inside the cluster</li> <li>Principle of least privilege</li> <li>Only allow necessary traffic between pods or namespaces</li> <li>Segment your applications</li> <li>Wherever possible, segment applications by the network policy to reduce the blast radius if an application is compromised</li> <li>Keep policies simple and clear</li> <li>Kubernetes network policies can be quite granular and complex, its best to keep them as simple as possible to reduce the risk of misconfiguration and ease the management overhead</li> <li>Reduce the attack surface</li> <li>Minimize the attack surface by limiting the exposure of your applications</li> </ul> <p>Attention</p> <p>Security Groups for pods provides two enforcing modes: <code>strict</code> and <code>standard</code>. You must use <code>standard</code> mode when using both Network Policy and Security Groups for pods features in an EKS cluster.</p> <p>When it comes to network security, a layered approach is often the most effective solution. Using kubernetes network policy and SGP in combination can provide a robust defense-in-depth strategy for your applications running in EKS.</p>"},{"location":"security/docs/network/#service-mesh-policy-enforcement-or-kubernetes-network-policy","title":"Service Mesh Policy Enforcement or Kubernetes network policy","text":"<p>A <code>service mesh</code> is a dedicated infrastructure layer that you can add to your applications. It allows you to transparently add capabilities like observability, traffic management, and security, without adding them to your own code.</p> <p>Service mesh enforces policies at Layer 7 (application) of OSI model whereas kubernetes network policies operate at Layer 3 (network) and Layer 4 (transport). There are many offerings in this space like AWS AppMesh, Istio, Linkerd, etc.,</p>"},{"location":"security/docs/network/#when-to-use-service-mesh-for-policy-enforcement","title":"When to use Service mesh for policy enforcement","text":"<ul> <li>Have existing investment in a service mesh</li> <li>Need more advanced capabilities like traffic management, observability &amp; security</li> <li>Traffic control, load balancing, circuit breaking, rate limiting, timeouts etc.</li> <li>Detailed insights into how your services are performing (latency, error rates, requests per second, request volumes etc.)</li> <li>You want to implement and leverage service mesh for security features like mTLS</li> </ul>"},{"location":"security/docs/network/#choose-kubernetes-network-policy-for-simpler-use-cases","title":"Choose Kubernetes network policy for simpler use cases","text":"<ul> <li>Limit which pods can communicate with each other</li> <li>Network policies require fewer resources than a service mesh making them a good fit for simpler use cases or for smaller clusters where the overhead of running and managing a service mesh might not be justified</li> </ul> <p>Tip</p> <p>Network policies and Service mesh can also be used together. Use network policies to provide a baseline level of security and isolation between your pods and then use a service mesh to add additional capabilities like traffic management, observability and security.</p>"},{"location":"security/docs/network/#thirdparty-network-policy-engines","title":"ThirdParty Network Policy Engines","text":"<p>Consider a Third Party Network Policy Engine when you have advanced policy requirements like Global Network Policies, support for DNS Hostname based rules, Layer 7 rules, ServiceAccount based rules, and explicit deny/log actions, etc., Calico, is an open source policy engine from Tigera that works well with EKS. In addition to implementing the full set of Kubernetes network policy features, Calico supports extended network polices with a richer set of features, including support for layer 7 rules, e.g. HTTP, when integrated with Istio. Calico policies can be scoped to Namespaces, Pods, service accounts, or globally.  When policies are scoped to a service account, it associates a set of ingress/egress rules with that service account.  With the proper RBAC rules in place, you can prevent teams from overriding these rules, allowing IT security professionals to safely delegate administration of namespaces. Isovalent, the maintainers of Cilium, have also extended the network policies to include partial support for layer 7 rules, e.g. HTTP.  Cilium also has support for DNS hostnames which can be useful for restricting traffic between Kubernetes Services/Pods and resources that run within or outside of your VPC. By contrast, Calico Enterprise includes a feature that allows you to map a Kubernetes network policy to an AWS security group, as well as DNS hostnames.</p> <p>You can find a list of common Kubernetes network policies at https://github.com/ahmetb/kubernetes-network-policy-recipes.  A similar set of rules for Calico are available at https://docs.projectcalico.org/security/calico-network-policy.</p>"},{"location":"security/docs/network/#migration-to-amazon-vpc-cni-network-policy-engine","title":"Migration to Amazon VPC CNI Network Policy Engine","text":"<p>To maintain consistency and avoid unexpected pod communication behavior, it is recommended to deploy only one Network Policy Engine in your cluster. If you want to migrate from 3P to VPC CNI Network Policy Engine, we recommend converting your existing 3P NetworkPolicy CRDs to the Kubernetes NetworkPolicy resources before enabling VPC CNI network policy support. And, test the migrated policies in a separate test cluster before applying them in you production environment. This allows you to identify and address any potential issues or inconsistencies in pod communication behavior.</p>"},{"location":"security/docs/network/#migration-tool","title":"Migration Tool","text":"<p>To assist in your migration process, we have developed a tool called K8s Network Policy Migrator that converts your existing Calico/Cilium network policy CRDs to Kubernetes native network policies. After conversion you can directly test the converted network policies on your new clusters running VPC CNI network policy controller. The tool is designed to help you streamline the migration process and ensure a smooth transition.</p> <p>Important</p> <p>Migration tool will only convert 3P policies that are compatible with native kubernetes network policy api. If you are using advanced network policy features offered by 3P plugins, Migration tool will skip and report them.</p> <p>Please note that migration tool is currently not supported by AWS VPC CNI Network policy engineering team, it is made available to customers on a best-effort basis. We encourage you to utilize this tool to facilitate your migration process. In the event that you encounter any issues or bugs with the tool, we kindly ask you create a GitHub issue. Your feedback is invaluable to us and will assist in the continuous improvement of our services.</p>"},{"location":"security/docs/network/#additional-resources","title":"Additional Resources","text":"<ul> <li>Kubernetes &amp; Tigera: Network Policies, Security, and Audit</li> <li>Calico Enterprise</li> <li>Cilium</li> <li>NetworkPolicy Editor an interactive policy editor from Cilium</li> <li>Inspektor Gadget advise network-policy gadget Suggests network policies based on an analysis of network traffic</li> </ul>"},{"location":"security/docs/network/#encryption-in-transit","title":"Encryption in transit","text":"<p>Applications that need to conform to PCI, HIPAA, or other regulations may need to encrypt data while it is in transit.  Nowadays TLS is the de facto choice for encrypting traffic on the wire.  TLS, like it's predecessor SSL, provides secure communications over a network using cryptographic protocols.  TLS uses symmetric encryption where the keys to encrypt the data are generated based on a shared secret that is negotiated at the beginning of the session. The following are a few ways that you can encrypt data in a Kubernetes environment.</p>"},{"location":"security/docs/network/#nitro-instances","title":"Nitro Instances","text":"<p>Traffic exchanged between the following Nitro instance types, e.g. C5n, G4, I3en, M5dn, M5n, P3dn, R5dn, and R5n, is automatically encrypted by default.  When there's an intermediate hop, like a transit gateway or a load balancer, the traffic is not encrypted. See Encryption in transit for further details on encryption in transit as well as the complete list of instances types that support network encryption by default.</p>"},{"location":"security/docs/network/#container-network-interfaces-cnis","title":"Container Network Interfaces (CNIs)","text":"<p>WeaveNet can be configured to automatically encrypt all traffic using NaCl encryption for sleeve traffic, and IPsec ESP for fast datapath traffic.</p>"},{"location":"security/docs/network/#service-mesh","title":"Service Mesh","text":"<p>Encryption in transit can also be implemented with a service mesh like App Mesh, Linkerd v2, and Istio. AppMesh supports mTLS with X.509 certificates or Envoy's Secret Discovery Service(SDS). Linkerd and Istio both have support for mTLS.</p> <p>The aws-app-mesh-examples GitHub repository provides walkthroughs for configuring mTLS using X.509 certificates and SPIRE as SDS provider with your Envoy container:</p> <ul> <li>Configuring mTLS using X.509 certificates</li> <li>Configuring TLS using SPIRE (SDS)</li> </ul> <p>App Mesh also supports TLS encryption with a private certificate issued by AWS Certificate Manager (ACM) or a certificate stored on the local file system of the virtual node.</p> <p>The aws-app-mesh-examples GitHub repository provides walkthroughs for configuring TLS using certificates issued by ACM and certificates that are packaged with your Envoy container:</p> <ul> <li>Configuring TLS with File Provided TLS Certificates</li> <li>Configuring TLS with AWS Certificate Manager</li> </ul>"},{"location":"security/docs/network/#ingress-controllers-and-load-balancers","title":"Ingress Controllers and Load Balancers","text":"<p>Ingress controllers are a way for you to intelligently route HTTP/S traffic that emanates from outside the cluster to services running inside the cluster. Oftentimes, these Ingresses are fronted by a layer 4 load balancer, like the Classic Load Balancer or the Network Load Balancer (NLB). Encrypted traffic can be terminated at different places within the network, e.g. at the load balancer, at the ingress resource, or the Pod. How and where you terminate your SSL connection will ultimately be dictated by your organization's network security policy. For instance, if you have a policy that requires end-to-end encryption, you will have to decrypt the traffic at the Pod. This will place additional burden on your Pod as it will have to spend cycles establishing the initial handshake. Overall SSL/TLS processing is very CPU intensive. Consequently, if you have the flexibility, try performing the SSL offload at the Ingress or the load balancer.</p>"},{"location":"security/docs/network/#use-encryption-with-aws-elastic-load-balancers","title":"Use encryption with AWS Elastic load balancers","text":"<p>The AWS Application Load Balancer (ALB) and Network Load Balancer (NLB) both have support for transport encryption (SSL and TLS).  The <code>alb.ingress.kubernetes.io/certificate-arn</code> annotation for the ALB lets you to specify which certificates to add to the ALB.  If you omit the annotation the controller will attempt to add certificates to listeners that require it by matching the available AWS Certificate Manager (ACM) certificates using the host field. Starting with EKS v1.15 you can use the <code>service.beta.kubernetes.io/aws-load-balancer-ssl-cert</code> annotation with the NLB as shown in the example below.</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: demo-app\n  namespace: default\n  labels:\n    app: demo-app\n  annotations:\n     service.beta.kubernetes.io/aws-load-balancer-type: \"nlb\"\n     service.beta.kubernetes.io/aws-load-balancer-ssl-cert: \"&lt;certificate ARN&gt;\"\n     service.beta.kubernetes.io/aws-load-balancer-ssl-ports: \"443\"\n     service.beta.kubernetes.io/aws-load-balancer-backend-protocol: \"http\"\nspec:\n  type: LoadBalancer\n  ports:\n  - port: 443\n    targetPort: 80\n    protocol: TCP\n  selector:\n    app: demo-app\n---\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  name: nginx\n  namespace: default\n  labels:\n    app: demo-app\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: demo-app\n  template:\n    metadata:\n      labels:\n        app: demo-app\n    spec:\n      containers:\n        - name: nginx\n          image: nginx\n          ports:\n            - containerPort: 443\n              protocol: TCP\n            - containerPort: 80\n              protocol: TCP\n</code></pre> <p>Following are additional examples for SSL/TLS termination.</p> <ul> <li>Securing EKS Ingress With Contour And Let\u2019s Encrypt The GitOps Way</li> <li>How do I terminate HTTPS traffic on Amazon EKS workloads with ACM?</li> </ul> <p>Attention</p> <p>Some Ingresses, like the AWS LB controller, implement the SSL/TLS using Annotations instead of as part of the Ingress Spec.</p>"},{"location":"security/docs/network/#acm-private-ca-with-cert-manager","title":"ACM Private CA with cert-manager","text":"<p>You can enable TLS and mTLS to secure your EKS application workloads at the ingress, on the pod, and between pods using ACM Private Certificate Authority (CA) and cert-manager, a popular Kubernetes add-on to distribute, renew, and revoke certificates. ACM Private CA is a highly-available, secure, managed CA without the upfront and maintenance costs of managing your own CA. If you are using the default Kubernetes certificate authority, there is an opportunity to improve your security and meet compliance requirements with ACM Private CA. ACM Private CA secures private keys in FIPS 140-2 Level 3 hardware security modules (very secure), compared with the default CA storing keys encoded in memory (less secure). A centralized CA also gives you more control and improved auditability for private certificates both inside and outside of a Kubernetes environment.</p>"},{"location":"security/docs/network/#short-lived-ca-mode-for-mutual-tls-between-workloads","title":"Short-Lived CA Mode for Mutual TLS Between Workloads","text":"<p>When using ACM Private CA for mTLS in EKS, it is recommended that you use short lived certificates with short-lived CA mode. Although it is possible to issue out short-lived certificates in the general-purpose CA mode, using short-lived CA mode works out more cost-effective (~75% cheaper than general mode) for use cases where new certificates need to be issued frequently. In addition to this, you should try to align the validity period of the private certificates with the lifetime of the pods in your EKS cluster. Learn more about ACM Private CA and its benefits here.</p>"},{"location":"security/docs/network/#acm-setup-instructions","title":"ACM Setup Instructions","text":"<p>Start by creating a Private CA by following procedures provided in the ACM Private CA tech docs. Once you have a Private CA, install cert-manager using regular installation instructions. After installing cert-manager, install the Private CA Kubernetes cert-manager plugin by following the setup instructions in GitHub. The plugin lets cert-manager request private certificates from ACM Private CA.</p> <p>Now that you have a Private CA and an EKS cluster with cert-manager and the plugin installed, it\u2019s time to set permissions and create the issuer. Update IAM permissions of the EKS node role to allow access to ACM Private CA. Replace the <code>&lt;CA_ARN&gt;</code> with the value from your Private CA:</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"awspcaissuer\",\n            \"Action\": [\n                \"acm-pca:DescribeCertificateAuthority\",\n                \"acm-pca:GetCertificate\",\n                \"acm-pca:IssueCertificate\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"&lt;CA_ARN&gt;\"\n        }\n    ]\n}\n</code></pre> <p>Service Roles for IAM Accounts, or IRSA can also be used. Please see the Additional Resources section below for complete examples.</p> <p>Create an Issuer in Amazon EKS by creating a Custom Resource Definition file named cluster-issuer.yaml with the following text in it, replacing <code>&lt;CA_ARN&gt;</code> and <code>&lt;Region&gt;</code> information with your Private CA.</p> <pre><code>apiVersion: awspca.cert-manager.io/v1beta1\nkind: AWSPCAClusterIssuer\nmetadata:\n          name: demo-test-root-ca\nspec:\n          arn: &lt;CA_ARN&gt;\n          region: &lt;Region&gt;\n</code></pre> <p>Deploy the Issuer you created.</p> <pre><code>kubectl apply -f cluster-issuer.yaml\n</code></pre> <p>Your EKS cluster is configured to request certificates from Private CA. You can now use cert-manager's <code>Certificate</code> resource to issue certificates by changing the <code>issuerRef</code> field's values to the Private CA Issuer you created above. For more details on how to specify and request Certificate resources, please check cert-manager's Certificate Resources guide. See examples here.</p>"},{"location":"security/docs/network/#acm-private-ca-with-istio-and-cert-manager","title":"ACM Private CA with Istio and cert-manager","text":"<p>If you are running Istio in your EKS cluster, you can disable the Istio control plane (specifically <code>istiod</code>) from functioning as the root Certificate Authority (CA), and configure ACM Private CA as the root CA for mTLS between workloads. If you're going with this approach, consider using the short-lived CA mode in ACM Private CA. Refer to the previous section and this blog post for more details.</p>"},{"location":"security/docs/network/#how-certificate-signing-works-in-istio-default","title":"How Certificate Signing Works in Istio (Default)","text":"<p>Workloads in Kubernetes are identified using service accounts. If you don't specify a service account, Kubernetes will automatically assign one to your workload. Also, service accounts automatically mount an associated token. This token is used by the service account for workloads to authenticate against the Kubernetes API. The service account may be sufficient as an identity for Kubernetes but Istio has its own identity management system and CA. When a workload starts up with its envoy sidecar proxy, it needs an identity assigned from Istio in order for it to be deemed as trustworthy and allowed to communicate with other services in the mesh.</p> <p>To get this identity from Istio, the <code>istio-agent</code> sends a request known as a certificate signing request (or CSR) to the Istio control plane. This CSR contains the service account token so that the workload's identity can be verified before being processed. This verification process is handled by <code>istiod</code>, which acts as both the Registration Authority (or RA) and the CA. The RA serves as a gatekeeper that makes sure only verified CSR makes it through to the CA. Once the CSR is verified, it will be forwarded to the CA which will then issue a certificate containing a SPIFFE identity with the service account. This certificate is called a SPIFFE verifiable identity document (or SVID). The SVID is assigned to the requesting service for identification purposes and to encrypt the traffic in transit between the communicating services.</p> <p></p>"},{"location":"security/docs/network/#how-certificate-signing-works-in-istio-with-acm-private-ca","title":"How Certificate Signing Works in Istio with ACM Private CA","text":"<p>You can use a cert-manager add-on called the Istio Certificate Signing Request agent (istio-csr) to integrate Istio with ACM Private CA. This agent allows Istio workloads and control plane components to be secured with cert manager issuers, in this case ACM Private CA. The istio-csr agent exposes the same service that istiod serves in the default config of validating incoming CSRs. Except, after verification, it will convert the requests into resources that cert manager supports (i.e. integrations with external CA issuers).</p> <p>Whenever there's a CSR from a workload, it will be forwarded to istio-csr, which will request certificates from ACM Private CA. This communication between istio-csr and ACM Private CA is enabled by the AWS Private CA issuer plugin. Cert manager uses this plugin to request TLS certificates from ACM Private CA. The issuer plugin will communicate with the ACM Private CA service to request a signed certificate for the workload. Once the certificate has been signed, it will be returned to istio-csr, which will read the signed request, and return it to the workload that initiated the CSR.</p> <p></p>"},{"location":"security/docs/network/#istio-with-private-ca-setup-instructions","title":"Istio with Private CA Setup Instructions","text":"<ol> <li>Start by following the same setup instructions in this section to complete the following:</li> <li>Create a Private CA</li> <li>Install cert-manager</li> <li>Install the issuer plugin</li> <li>Set permissions and create an issuer. The issuer represents the CA and is used to sign <code>istiod</code> and mesh workload certificates. It will communicate with ACM Private CA.</li> <li>Create an <code>istio-system</code> namespace. This is where the <code>istiod certificate</code> and other Istio resources will be deployed.</li> <li> <p>Install Istio CSR configured with AWS Private CA Issuer Plugin. You can preserve the certificate signing requests for workloads to verify that they get approved and signed (<code>preserveCertificateRequests=true</code>).</p> <pre><code>helm install -n cert-manager cert-manager-istio-csr jetstack/cert-manager-istio-csr \\\n--set \"app.certmanager.issuer.group=awspca.cert-manager.io\" \\\n--set \"app.certmanager.issuer.kind=AWSPCAClusterIssuer\" \\\n--set \"app.certmanager.issuer.name=&lt;the-name-of-the-issuer-you-created&gt;\" \\\n--set \"app.certmanager.preserveCertificateRequests=true\" \\\n--set \"app.server.maxCertificateDuration=48h\" \\\n--set \"app.tls.certificateDuration=24h\" \\\n--set \"app.tls.istiodCertificateDuration=24h\" \\\n--set \"app.tls.rootCAFile=/var/run/secrets/istio-csr/ca.pem\" \\\n--set \"volumeMounts[0].name=root-ca\" \\\n--set \"volumeMounts[0].mountPath=/var/run/secrets/istio-csr\" \\\n--set \"volumes[0].name=root-ca\" \\\n--set \"volumes[0].secret.secretName=istio-root-ca\"\n</code></pre> </li> <li> <p>Install Istio with custom configurations to replace <code>istiod</code> with <code>cert-manager istio-csr</code> as the certificate provider for the mesh. This process can be carried out using the Istio Operator.</p> <pre><code>apiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nmetadata:\n  name: istio\n  namespace: istio-system\nspec:\n  profile: \"demo\"\n  hub: gcr.io/istio-release\n  values:\n  global:\n    # Change certificate provider to cert-manager istio agent for istio agent\n    caAddress: cert-manager-istio-csr.cert-manager.svc:443\n  components:\n    pilot:\n      k8s:\n        env:\n          # Disable istiod CA Sever functionality\n        - name: ENABLE_CA_SERVER\n          value: \"false\"\n        overlays:\n        - apiVersion: apps/v1\n          kind: Deployment\n          name: istiod\n          patches:\n\n            # Mount istiod serving and webhook certificate from Secret mount\n          - path: spec.template.spec.containers.[name:discovery].args[7]\n            value: \"--tlsCertFile=/etc/cert-manager/tls/tls.crt\"\n          - path: spec.template.spec.containers.[name:discovery].args[8]\n            value: \"--tlsKeyFile=/etc/cert-manager/tls/tls.key\"\n          - path: spec.template.spec.containers.[name:discovery].args[9]\n            value: \"--caCertFile=/etc/cert-manager/ca/root-cert.pem\"\n\n          - path: spec.template.spec.containers.[name:discovery].volumeMounts[6]\n            value:\n              name: cert-manager\n              mountPath: \"/etc/cert-manager/tls\"\n              readOnly: true\n          - path: spec.template.spec.containers.[name:discovery].volumeMounts[7]\n            value:\n              name: ca-root-cert\n              mountPath: \"/etc/cert-manager/ca\"\n              readOnly: true\n\n          - path: spec.template.spec.volumes[6]\n            value:\n              name: cert-manager\n              secret:\n                secretName: istiod-tls\n          - path: spec.template.spec.volumes[7]\n            value:\n              name: ca-root-cert\n              configMap:\n                defaultMode: 420\n                name: istio-ca-root-cert\n</code></pre> </li> <li> <p>Deploy the above custom resource you created.</p> <pre><code>istioctl operator init\nkubectl apply -f istio-custom-config.yaml\n</code></pre> </li> <li> <p>Now you can deploy a workload to the mesh in your EKS cluster and enforce mTLS.</p> </li> </ol> <p></p>"},{"location":"security/docs/network/#tools-and-resources","title":"Tools and resources","text":"<ul> <li>Amazon EKS Security Immersion Workshop - Network security</li> <li>How to implement cert-manager and the ACM Private CA plugin to enable TLS in EKS.</li> <li>Setting up end-to-end TLS encryption on Amazon EKS with the new AWS Load Balancer Controller and ACM Private CA.</li> <li>Private CA Kubernetes cert-manager plugin on GitHub.</li> <li>Private CA Kubernetes cert-manager plugin user guide.</li> <li>How to use AWS Private Certificate Authority short-lived certificate mode</li> <li>Verifying Service Mesh TLS in Kubernetes, Using ksniff and Wireshark</li> <li>ksniff</li> <li>egress-operator An operator and DNS plugin to control egress traffic from your cluster without protocol inspection</li> <li>NeuVector by SUSE open source, zero-trust container security platform, provides policy network rules, data loss prevention (DLP), web application firewall (WAF) and network threat signatures.</li> </ul>"},{"location":"security/docs/pods/","title":"Pod Security","text":"<p>The pod specification includes a variety of different attributes that can strengthen or weaken your overall security posture.  As a Kubernetes practitioner your chief concern should be preventing a process that\u2019s running in a container from escaping the isolation boundaries of the container runtime and gaining access to the underlying host.</p>"},{"location":"security/docs/pods/#linux-capabilities","title":"Linux Capabilities","text":"<p>The processes that run within a container run under the context of the [Linux] root user by default.  Although the actions of root within a container are partially constrained by the set of Linux capabilities that the container runtime assigns to the containers, these default privileges could allow an attacker to escalate their privileges and/or gain access to sensitive information bound to the host, including Secrets and ConfigMaps.  Below is a list of the default capabilities assigned to containers.  For additional information about each capability, see http://man7.org/linux/man-pages/man7/capabilities.7.html.</p> <p><code>CAP_AUDIT_WRITE, CAP_CHOWN, CAP_DAC_OVERRIDE, CAP_FOWNER, CAP_FSETID, CAP_KILL, CAP_MKNOD, CAP_NET_BIND_SERVICE, CAP_NET_RAW, CAP_SETGID, CAP_SETUID, CAP_SETFCAP, CAP_SETPCAP, CAP_SYS_CHROOT</code></p> <p>Info</p> <p>EC2 and Fargate pods are assigned the aforementioned capabilities by default. Additionally, Linux capabilities can only be dropped from Fargate pods.</p> <p>Pods that are run as privileged, inherit all of the Linux capabilities associated with root on the host. This should be avoided if possible.</p>"},{"location":"security/docs/pods/#node-authorization","title":"Node Authorization","text":"<p>All Kubernetes worker nodes use an authorization mode called Node Authorization. Node Authorization authorizes all API requests that originate from the kubelet and allows nodes to perform the following actions:</p> <p>Read operations:</p> <ul> <li>services</li> <li>endpoints</li> <li>nodes</li> <li>pods</li> <li>secrets, configmaps, persistent volume claims and persistent volumes related to pods bound to the kubelet\u2019s node</li> </ul> <p>Write operations:</p> <ul> <li>nodes and node status (enable the <code>NodeRestriction</code> admission plugin to limit a kubelet to modify its own node)</li> <li>pods and pod status (enable the <code>NodeRestriction</code> admission plugin to limit a kubelet to modify pods bound to itself)</li> <li>events</li> </ul> <p>Auth-related operations:</p> <ul> <li>Read/write access to the CertificateSigningRequest (CSR) API for TLS bootstrapping</li> <li>the ability to create TokenReview and SubjectAccessReview for delegated authentication/authorization checks</li> </ul> <p>EKS uses the node restriction admission controller which only allows the node to modify a limited set of node attributes and pod objects that are bound to the node.   Nevertheless, an attacker who manages to get access to the host will still be able to glean sensitive information about the environment from the Kubernetes API that could allow them to move laterally within the cluster.</p>"},{"location":"security/docs/pods/#pod-security-solutions","title":"Pod Security Solutions","text":""},{"location":"security/docs/pods/#pod-security-policy-psp","title":"Pod Security Policy (PSP)","text":"<p>In the past, Pod Security Policy (PSP) resources were used to specify a set of requirements that pods had to meet before they could be created. As of Kubernetes version 1.21, PSP have been deprecated. They are scheduled for removal in Kubernetes version 1.25.</p> <p>Attention</p> <p>PSPs are deprecated in Kubernetes version 1.21. You will have until version 1.25 or roughly 2 years to transition to an alternative. This document explains the motivation for this deprecation.</p>"},{"location":"security/docs/pods/#migrating-to-a-new-pod-security-solution","title":"Migrating to a new pod security solution","text":"<p>Since PSPs have been removed as of Kubernetes v1.25, cluster administrators and operators must replace those security controls. Two solutions can fill this need:</p> <ul> <li>Policy-as-code (PAC) solutions from the Kubernetes ecosystem</li> <li>Kubernetes Pod Security Standards (PSS)</li> </ul> <p>Both the PAC and PSS solutions can coexist with PSP; they can be used in clusters before PSP is removed. This eases adoption when migrating from PSP. Please see this document when considering migrating from PSP to PSS.</p> <p>Kyverno, one of the PAC solutions outlined below, has specific guidance outlined in a blog post when migrating from PSPs to its solution including analogous policies, feature comparisons, and a migration procedure. Additional information and guidance on migration to Kyverno with respect to Pod Security Admission (PSA) has been published on the AWS blog here.</p>"},{"location":"security/docs/pods/#policy-as-code-pac","title":"Policy-as-code (PAC)","text":"<p>Policy-as-code (PAC) solutions provide guardrails to guide cluster users, and prevent unwanted behaviors, through prescribed and automated controls. PAC uses Kubernetes Dynamic Admission Controllers to intercept the Kubernetes API server request flow, via a webhook call, and mutate and validate request payloads, based on policies written and stored as code. Mutation and validation happens before the API server request results in a change to the cluster. PAC solutions use policies to match and act on API server request payloads, based on taxonomy and values.</p> <p>There are several open source PAC solutions available for Kubernetes. These solutions are not part of the Kubernetes project; they are sourced from the Kubernetes ecosystem. Some PAC solutions are listed below.</p> <ul> <li>OPA/Gatekeeper</li> <li>Open Policy Agent (OPA)</li> <li>Kyverno</li> <li>Kubewarden</li> <li>jsPolicy</li> </ul> <p>For further information about PAC solutions and how to help you select the appropriate solution for your needs, see the links below.</p> <ul> <li>Policy-based countermeasures for Kubernetes \u2013 Part 1</li> <li>Policy-based countermeasures for Kubernetes \u2013 Part 2</li> </ul>"},{"location":"security/docs/pods/#pod-security-standards-pss-and-pod-security-admission-psa","title":"Pod Security Standards (PSS) and Pod Security Admission (PSA)","text":"<p>In response to the PSP deprecation and the ongoing need to control pod security out-of-the-box, with a built-in Kubernetes solution, the Kubernetes Auth Special Interest Group created the Pod Security Standards (PSS) and Pod Security Admission (PSA). The PSA effort includes an admission controller webhook project that implements the controls defined in the PSS. This admission controller approach resembles that used in the PAC solutions.</p> <p>According to the Kubernetes documentation, the PSS \"define three different policies to broadly cover the security spectrum. These policies are cumulative and range from highly-permissive to highly-restrictive.\"</p> <p>These policies are defined as:</p> <ul> <li> <p>Privileged: Unrestricted (unsecure) policy, providing the widest possible level of permissions. This policy allows for known privilege escalations. It is the absence of a policy. This is good for applications such as logging agents, CNIs, storage drivers, and other system wide applications that need privileged access.</p> </li> <li> <p>Baseline: Minimally restrictive policy which prevents known privilege escalations. Allows the default (minimally specified) Pod configuration. The baseline policy prohibits use of hostNetwork, hostPID, hostIPC, hostPath, hostPort, the inability to add Linux capabilities, along with several other restrictions.</p> </li> <li> <p>Restricted: Heavily restricted policy, following current Pod hardening best practices.  This policy inherits from the baseline and adds further restrictions such as the inability to run as root or a root-group. Restricted policies may impact an application's ability to function. They are primarily targeted at running security critical applications.</p> </li> </ul> <p>These policies define profiles for pod execution, arranged into three levels of privileged vs. restricted access.</p> <p>To implement the controls defined by the PSS, PSA operates in three modes:</p> <ul> <li> <p>enforce: Policy violations will cause the pod to be rejected.</p> </li> <li> <p>audit: Policy violations will trigger the addition of an audit annotation to the event recorded in the audit log, but are otherwise allowed.</p> </li> <li> <p>warn: Policy violations will trigger a user-facing warning, but are otherwise allowed.</p> </li> </ul> <p>These modes and the profile (restriction) levels are configured at the Kubernetes Namespace level, using labels, as seen in the below example.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/enforce: restricted\n</code></pre> <p>When used independently, these operational modes have different responses that result in different user experiences. The enforce mode will prevent pods from being created if respective podSpecs violate the configured restriction level. However, in this mode, non-pod Kubernetes objects that create pods, such as Deployments, will not be prevented from being applied to the cluster, even if the podSpec therein violates the applied PSS. In this case the Deployment will be applied, while the pod(s) will be prevented from being applied.</p> <p>This is a difficult user experience, as there is no immediate indication that the successfully applied Deployment object belies failed pod creation. The offending podSpecs will not create pods. Inspecting the Deployment resource with <code>kubectl get deploy &lt;DEPLOYMENT_NAME&gt; -oyaml</code> will expose the message from the failed pod(s) <code>.status.conditions</code> element, as seen below.</p> <pre><code>...\nstatus:\n  conditions:\n    - lastTransitionTime: \"2022-01-20T01:02:08Z\"\n      lastUpdateTime: \"2022-01-20T01:02:08Z\"\n      message: 'pods \"test-688f68dc87-tw587\" is forbidden: violates PodSecurity \"restricted:latest\":\n        allowPrivilegeEscalation != false (container \"test\" must set securityContext.allowPrivilegeEscalation=false),\n        unrestricted capabilities (container \"test\" must set securityContext.capabilities.drop=[\"ALL\"]),\n        runAsNonRoot != true (pod or container \"test\" must set securityContext.runAsNonRoot=true),\n        seccompProfile (pod or container \"test\" must set securityContext.seccompProfile.type\n        to \"RuntimeDefault\" or \"Localhost\")'\n      reason: FailedCreate\n      status: \"True\"\n      type: ReplicaFailure\n...\n</code></pre> <p>In both the audit and warn modes, the pod restrictions do not prevent violating pods from being created and started. However, in these modes audit annotations on API server audit log events and warnings to API server clients, such as kubectl, are triggered, respectively, when pods, as well as objects that create pods, contain podSpecs with violations. A <code>kubectl</code> Warning message is seen below.</p> <pre><code>Warning: would violate PodSecurity \"restricted:latest\": allowPrivilegeEscalation != false (container \"test\" must set securityContext.allowPrivilegeEscalation=false), unrestricted capabilities (container \"test\" must set securityContext.capabilities.drop=[\"ALL\"]), runAsNonRoot != true (pod or container \"test\" must set securityContext.runAsNonRoot=true), seccompProfile (pod or container \"test\" must set securityContext.seccompProfile.type to \"RuntimeDefault\" or \"Localhost\")\ndeployment.apps/test created\n</code></pre> <p>The PSA audit and warn modes are useful when introducing the PSS without negatively impacting cluster operations.</p> <p>The PSA operational modes are not mutually exclusive, and can be used in a cumulative manner. As seen below, the multiple modes can be configured in a single namespace.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/audit: restricted\n    pod-security.kubernetes.io/enforce: restricted\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>In the above example, the user-friendly warnings and audit annotations are provided when applying Deployments, while the enforce of violations are also provided at the pod level. In fact multiple PSA labels can use different profile levels, as seen below.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/enforce: baseline\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>In the above example, PSA is configured to allow the creation of all pods that satisfy the baseline profile level, and then warn on pods (and objects that create pods) that violate the restricted profile level. This is a useful approach to determine the possible impacts when changing from the baseline to restricted profiles.</p>"},{"location":"security/docs/pods/#existing-pods","title":"Existing Pods","text":"<p>If a namespace with existing pods is modified to use a more restrictive PSS profile, the audit and warn modes will produce appropriate messages; however, enforce mode will not delete the pods. The warning messages are seen below.</p> <pre><code>Warning: existing pods in namespace \"policy-test\" violate the new PodSecurity enforce level \"restricted:latest\"\nWarning: test-688f68dc87-htm8x: allowPrivilegeEscalation != false, unrestricted capabilities, runAsNonRoot != true, seccompProfile\nnamespace/policy-test configured\n</code></pre>"},{"location":"security/docs/pods/#exemptions","title":"Exemptions","text":"<p>PSA uses Exemptions to exclude enforcement of violations against pods that would have otherwise been applied. These exemptions are listed below.</p> <ul> <li> <p>Usernames: requests from users with an exempt authenticated (or impersonated) username are ignored.</p> </li> <li> <p>RuntimeClassNames: pods and workload resources specifying an exempt runtime class name are ignored.</p> </li> <li> <p>Namespaces: pods and workload resources in an exempt namespace are ignored.</p> </li> </ul> <p>These exemptions are applied statically in the PSA admission controller configuration as part of the API server configuration.</p> <p>In the Validating Webhook implementation the exemptions can be configured within a Kubernetes ConfigMap resource that gets mounted as a volume into the pod-security-webhook container.</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: pod-security-webhook\n  namespace: pod-security-webhook\ndata:\n  podsecurityconfiguration.yaml: |\n    apiVersion: pod-security.admission.config.k8s.io/v1\n    kind: PodSecurityConfiguration\n    defaults:\n      enforce: \"restricted\"\n      enforce-version: \"latest\"\n      audit: \"restricted\"\n      audit-version: \"latest\"\n      warn: \"restricted\"\n      warn-version: \"latest\"\n    exemptions:\n      # Array of authenticated usernames to exempt.\n      usernames: []\n      # Array of runtime class names to exempt.\n      runtimeClasses: []\n      # Array of namespaces to exempt.\n      namespaces: [\"kube-system\",\"policy-test1\"]\n</code></pre> <p>As seen in the above ConfigMap YAML the cluster-wide default PSS level has been set to restricted for all PSA modes, audit, enforce, and warn. This affects all namespaces, except those exempted: <code>namespaces: [\"kube-system\",\"policy-test1\"]</code>. Additionally, in the ValidatingWebhookConfiguration resource, seen below, the pod-security-webhook namespace is also exempted from configured PSS.</p> <pre><code>...\nwebhooks:\n  # Audit annotations will be prefixed with this name\n  - name: \"pod-security-webhook.kubernetes.io\"\n    # Fail-closed admission webhooks can present operational challenges.\n    # You may want to consider using a failure policy of Ignore, but should \n    # consider the security tradeoffs.\n    failurePolicy: Fail\n    namespaceSelector:\n      # Exempt the webhook itself to avoid a circular dependency.\n      matchExpressions:\n        - key: kubernetes.io/metadata.name\n          operator: NotIn\n          values: [\"pod-security-webhook\"]\n...\n</code></pre> <p>Attention</p> <p>Pod Security Admissions graduated to stable in Kubernetes v1.25. If you wanted to use the Pod Security Admission feature prior to it being enabled by default, you needed to install the dynamic admission controller (mutating webhook). The instructions for installing and configuring the webhook can be found here.</p>"},{"location":"security/docs/pods/#choosing-between-policy-as-code-and-pod-security-standards","title":"Choosing between policy-as-code and Pod Security Standards","text":"<p>The Pod Security Standards (PSS) were developed to replace the Pod Security Policy (PSP), by providing a solution that was built-in to Kubernetes and did not require solutions from the Kubernetes ecosystem. That being said, policy-as-code (PAC) solutions are considerably more flexible.</p> <p>The following list of Pros and Cons is designed help you make a more informed decision about your pod security solution.</p>"},{"location":"security/docs/pods/#policy-as-code-as-compared-to-pod-security-standards","title":"Policy-as-code (as compared to Pod Security Standards)","text":"<p>Pros:</p> <ul> <li>More flexible and more granular (down to attributes of resources if need be)</li> <li>Not just focused on pods, can be used against different resources and actions</li> <li>Not just applied at the namespace level</li> <li>More mature than the Pod Security Standards</li> <li>Decisions can be based on anything in the API server request payload, as well as existing cluster resources and external data (solution dependent)</li> <li>Supports mutating API server requests before validation (solution dependent)</li> <li>Can generate complementary policies and Kubernetes resources (solution dependent - From pod policies, Kyverno can auto-gen policies for higher-level controllers, such as Deployments. Kyverno can also generate additional Kubernetes resources \"when a new resource is created or when the source is updated\" by using Generate Rules.)</li> <li>Can be used to shift left, into CICD pipelines, before making calls to the Kubernetes API server (solution dependent)</li> <li>Can be used to implement behaviors that are not necessarily security related, such as best practices, organizational standards, etc.</li> <li>Can be used in non-Kubernetes use cases (solution dependent)</li> <li>Because of flexibility, the user experience can be tuned to users' needs</li> </ul> <p>Cons:</p> <ul> <li>Not built into Kubernetes</li> <li>More complex to learn, configure, and support</li> <li>Policy authoring may require new skills/languages/capabilities</li> </ul>"},{"location":"security/docs/pods/#pod-security-admission-as-compared-to-policy-as-code","title":"Pod Security Admission (as compared to policy-as-code)","text":"<p>Pros:</p> <ul> <li>Built into Kubernetes</li> <li>Simpler to configure</li> <li>No new languages to use or policies to author</li> <li>If the cluster default admission level is configured to privileged, namespace labels can be used to opt namespaces into the pod security profiles.</li> </ul> <p>Cons:</p> <ul> <li>Not as flexible or granular as policy-as-code</li> <li>Only 3 levels of restrictions</li> <li>Primarily focused on pods</li> </ul>"},{"location":"security/docs/pods/#summary","title":"Summary","text":"<p>If you currently do not have a pod security solution, beyond PSP, and your required pod security posture fits the model defined in the Pod Security Standards (PSS), then an easier path may be to adopt the PSS, in lieu of a policy-as-code solution. However, if your pod security posture does not fit the PSS model, or you envision adding additional controls, beyond that defined by PSS, then a policy-as-code solution would seem a better fit.</p>"},{"location":"security/docs/pods/#recommendations","title":"Recommendations","text":""},{"location":"security/docs/pods/#use-multiple-pod-security-admission-psa-modes-for-a-better-user-experience","title":"Use multiple Pod Security Admission (PSA) modes for a better user experience","text":"<p>As mentioned earlier, PSA enforce mode prevents pods with PSS violations from being applied, but does not stop higher-level controllers, such as Deployments. In fact, the Deployment will be applied successfully without any indication that the pods failed to be applied. While you can use kubectl to inspect the Deployment object, and discover the failed pods message from the PSA, the user experience could be better. To make the user experience better, multiple PSA modes (audit, enforce, warn) should be used.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/audit: restricted\n    pod-security.kubernetes.io/enforce: restricted\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>In the above example, with enforce mode defined, when a Deployment manifest with PSS violations in the respective podSpec is attempted to be applied to the Kubernetes API server, the Deployment will be successfully applied, but the pods will not. And, since the audit and warn modes are also enabled, the API server client will receive a warning message and the API server audit log event will be annotated with a message as well.</p>"},{"location":"security/docs/pods/#restrict-the-containers-that-can-run-as-privileged","title":"Restrict the containers that can run as privileged","text":"<p>As mentioned, containers that run as privileged inherit all of the Linux capabilities assigned to root on the host.  Seldom do containers need these types of privileges to function properly.  There are multiple methods that can be used to restrict the permissions and capabilities of containers.</p> <p>Attention</p> <p>Fargate is a launch type that enables you to run \"serverless\" container(s) where the containers of a pod are run on infrastructure that AWS manages. With Fargate, you cannot run a privileged container or configure your pod to use hostNetwork or hostPort.</p>"},{"location":"security/docs/pods/#do-not-run-processes-in-containers-as-root","title":"Do not run processes in containers as root","text":"<p>All containers run as root by default.  This could be problematic if an attacker is able to exploit a vulnerability in the application and get shell access to the running container.  You can mitigate this risk a variety of ways.  First, by removing the shell from the container image.  Second, adding the USER directive to your Dockerfile or running the containers in the pod as a non-root user.  The Kubernetes podSpec includes a set of fields, under <code>spec.securityContext</code>, that let you specify the user and/or group under which to run your application.  These fields are <code>runAsUser</code> and <code>runAsGroup</code> respectively.  </p> <p>To enforce the use of the <code>spec.securityContext</code>, and its associated elements, within the Kubernetes podSpec, policy-as-code or Pod Security Standards can be added to clusters. These solutions allow you to write and/or use policies or profiles that can validate inbound Kubernetes API server request payloads, before they are persisted into etcd. Furthermore, policy-as-code solutions can mutate inbound requests, and in some cases, generate new requests.</p>"},{"location":"security/docs/pods/#never-run-docker-in-docker-or-mount-the-socket-in-the-container","title":"Never run Docker in Docker or mount the socket in the container","text":"<p>While this conveniently lets you to build/run images in Docker containers, you're basically relinquishing complete control of the node to the process running in the container. If you need to build container images on Kubernetes use Kaniko, buildah, or a build service like CodeBuild instead.</p> <p>Tip</p> <p>Kubernetes clusters used for CICD processing, such as building container images, should be isolated from clusters running more generalized workloads.</p>"},{"location":"security/docs/pods/#restrict-the-use-of-hostpath-or-if-hostpath-is-necessary-restrict-which-prefixes-can-be-used-and-configure-the-volume-as-read-only","title":"Restrict the use of hostPath or if hostPath is necessary restrict which prefixes can be used and configure the volume as read-only","text":"<p><code>hostPath</code> is a volume that mounts a directory from the host directly to the container.  Rarely will pods need this type of access, but if they do, you need to be aware of the risks.  By default pods that run as root will have write access to the file system exposed by hostPath.  This could allow an attacker to modify the kubelet settings, create symbolic links to directories or files not directly exposed by the hostPath, e.g. /etc/shadow, install ssh keys, read secrets mounted to the host, and other malicious things. To mitigate the risks from hostPath, configure the <code>spec.containers.volumeMounts</code> as <code>readOnly</code>, for example:</p> <pre><code>volumeMounts:\n- name: hostPath-volume\n    readOnly: true\n    mountPath: /host-path\n</code></pre> <p>You should also use policy-as-code solutions to restrict the directories that can be used by <code>hostPath</code> volumes, or prevent <code>hostPath</code> usage altogether.  You can use the Pod Security Standards Baseline or Restricted policies to prevent the use of <code>hostPath</code>.</p> <p>For further information about the dangers of privileged escalation, read Seth Art's blog Bad Pods: Kubernetes Pod Privilege Escalation.</p>"},{"location":"security/docs/pods/#set-requests-and-limits-for-each-container-to-avoid-resource-contention-and-dos-attacks","title":"Set requests and limits for each container to avoid resource contention and DoS attacks","text":"<p>A pod without requests or limits can theoretically consume all of the resources available on a host.  As additional pods are scheduled onto a node, the node may experience CPU or memory pressure which can cause the Kubelet to terminate or evict pods from the node.  While you can\u2019t prevent this from happening all together, setting requests and limits will help minimize resource contention and mitigate the risk from poorly written applications that consume an excessive amount of resources.</p> <p>The <code>podSpec</code> allows you to specify requests and limits for CPU and memory.  CPU is considered a compressible resource because it can be oversubscribed.  Memory is incompressible, i.e. it cannot be shared among multiple containers.  </p> <p>When you specify requests for CPU or memory, you\u2019re essentially designating the amount of memory that containers are guaranteed to get.  Kubernetes aggregates the requests of all the containers in a pod to determine which node to schedule the pod onto.  If a container exceeds the requested amount of memory it may be subject to termination if there\u2019s memory pressure on the node.</p> <p>Limits are the maximum amount of CPU and memory resources that a container is allowed to consume and directly corresponds to the <code>memory.limit_in_bytes</code> value of the cgroup created for the container.  A container that exceeds the memory limit will be OOM killed. If a container exceeds its CPU limit, it will be throttled.</p> <p>Tip</p> <p>When using container <code>resources.limits</code> it is strongly recommended that container resource usage (a.k.a. Resource Footprints) be data-driven and accurate, based on load testing. Absent an accurate and trusted resource footprint, container <code>resources.limits</code> can be padded. For example, <code>resources.limits.memory</code> could be padded 20-30% higher than observable maximums, to account for potential memory resource limit inaccuracies.</p> <p>Kubernetes uses three Quality of Service (QoS) classes to prioritize the workloads running on a node.  These include:</p> <ul> <li>guaranteed</li> <li>burstable</li> <li>best-effort</li> </ul> <p>If limits and requests are not set, the pod is configured as best-effort (lowest priority).  Best-effort pods are the first to get killed when there is insufficient memory.  If limits are set on all containers within the pod, or if the requests and limits are set to the same values and not equal to 0, the pod is configured as guaranteed (highest priority).  Guaranteed pods will not be killed unless they exceed their configured memory limits. If the limits and requests are configured with different values and not equal to 0, or one container within the pod sets limits and the others don\u2019t or have limits set for different resources, the pods are configured as burstable (medium priority). These pods have some resource guarantees, but can be killed once they exceed their requested memory.</p> <p>Attention</p> <p>Requests don't affect the <code>memory_limit_in_bytes</code> value of the container's cgroup; the cgroup limit is set to the amount of memory available on the host. Nevertheless, setting the requests value too low could cause the pod to be targeted for termination by the kubelet if the node undergoes memory pressure.</p> Class Priority Condition Kill Condition Guaranteed highest limit = request != 0 Only exceed memory limits Burstable medium limit != request != 0 Can be killed if exceed request memory Best-Effort lowest limit &amp; request Not Set First to get killed when there's insufficient memory <p>For additional information about resource QoS, please refer to the Kubernetes documentation.</p> <p>You can force the use of requests and limits by setting a resource quota on a namespace or by creating a limit range.  A resource quota allows you to specify the total amount of resources, e.g. CPU and RAM, allocated to a namespace.  When it\u2019s applied to a namespace, it forces you to specify requests and limits for all containers deployed into that namespace. By contrast, limit ranges give you more granular control of the allocation of resources. With limit ranges you can min/max for CPU and memory resources per pod or per container within a namespace.  You can also use them to set default request/limit values if none are provided.</p> <p>Policy-as-code solutions can be used enforce requests and limits. or to even create the resource quotas and limit ranges when namespaces are created.</p>"},{"location":"security/docs/pods/#do-not-allow-privileged-escalation","title":"Do not allow privileged escalation","text":"<p>Privileged escalation allows a process to change the security context under which its running.  Sudo is a good example of this as are binaries with the SUID or SGID bit.  Privileged escalation is basically a way for users to execute a file with the permissions of another user or group.  You can prevent a container from using privileged escalation by implementing a policy-as-code mutating policy that sets <code>allowPrivilegeEscalation</code> to <code>false</code> or by setting <code>securityContext.allowPrivilegeEscalation</code> in the <code>podSpec</code>. Policy-as-code policies can also be used to prevent API server requests from succeeding if incorrect settings are detected. Pod Security Standards can also be used to prevent pods from using privilege escalation.</p>"},{"location":"security/docs/pods/#disable-serviceaccount-token-mounts","title":"Disable ServiceAccount token mounts","text":"<p>For pods that do not need to access the Kubernetes API, you can disable the automatic mounting of a ServiceAccount token on a pod spec, or for all pods that use a particular ServiceAccount.</p> <p>Attention</p> <p>Disabling ServiceAccount mounting does not prevent a pod from having network access to the Kubernetes API. To prevent a pod from having any network access to the Kubernetes API, you will need to modify the EKS cluster endpoint access and use a NetworkPolicy to block pod access.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-no-automount\nspec:\n  automountServiceAccountToken: false\n</code></pre> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: sa-no-automount\nautomountServiceAccountToken: false\n</code></pre>"},{"location":"security/docs/pods/#disable-service-discovery","title":"Disable service discovery","text":"<p>For pods that do not need to lookup or call in-cluster services, you can reduce the amount of information given to a pod. You can set the Pod's DNS policy to not use CoreDNS, and not expose services in the pod's namespace as environment variables. See the Kubernetes docs on environment variables for more information on service links. The default value for a pod's DNS policy is \"ClusterFirst\" which uses in-cluster DNS, while the non-default value \"Default\" uses the underlying node's DNS resolution. See the Kubernetes docs on Pod DNS policy for more information.</p> <p>Attention</p> <p>Disabling service links and changing the pod's DNS policy does not prevent a pod from having network access to the in-cluster DNS service. An attacker can still enumerate services in a cluster by reaching the in-cluster DNS service. (ex: <code>dig SRV *.*.svc.cluster.local @$CLUSTER_DNS_IP</code>) To prevent in-cluster service discovery, use a NetworkPolicy to block pod access</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-no-service-info\nspec:\n    dnsPolicy: Default # \"Default\" is not the true default value\n    enableServiceLinks: false\n</code></pre>"},{"location":"security/docs/pods/#configure-your-images-with-read-only-root-file-system","title":"Configure your images with read-only root file system","text":"<p>Configuring your images with a read-only root file system prevents an attacker from overwriting a binary on the file system that your application uses. If your application has to write to the file system, consider writing to a temporary directory or attach and mount a volume. You can enforce this by setting the pod's SecurityContext as follows:</p> <pre><code>...\nsecurityContext:\n  readOnlyRootFilesystem: true\n...\n</code></pre> <p>Policy-as-code and Pod Security Standards can be used to enforce this behavior.</p> <p>Info</p> <p>As per Windows containers in Kubernetes <code>securityContext.readOnlyRootFilesystem</code> cannot be set to <code>true</code> for a container running on Windows as write access is required for registry and system processes to run inside the container.</p>"},{"location":"security/docs/pods/#tools-and-resources","title":"Tools and resources","text":"<ul> <li>Amazon EKS Security Immersion Workshop - Pod Security</li> <li>open-policy-agent/gatekeeper-library: The OPA Gatekeeper policy library a library of OPA/Gatekeeper policies that you can use as a substitute for PSPs.</li> <li>Kyverno Policy Library</li> <li>A collection of common OPA and Kyverno policies for EKS.</li> <li>Policy based countermeasures: part 1</li> <li>Policy based countermeasures: part 2</li> <li>Pod Security Policy Migrator a tool that converts PSPs to OPA/Gatekeeper, KubeWarden, or Kyverno policies</li> <li>NeuVector by SUSE open source, zero-trust container security platform, provides process and filesystem policies as well as admission control rules.</li> </ul>"},{"location":"security/docs/runtime/","title":"Runtime security","text":"<p>Runtime security provides active protection for your containers while they're running.  The idea is to detect and/or prevent malicious activity from occurring inside the container. This can be achieved with a number of mechanisms in the Linux kernel or kernel extensions that are integrated with Kubernetes, such as Linux capabilities, secure computing (seccomp), AppArmor, or SELinux. There are also options like Amazon GuardDuty and third party tools that can assist with establishing baselines and detecting anomalous activity with less manual configuration of Linux kernel mechanisms.</p> <p>Attention</p> <p>Kubernetes does not currently provide any native mechanisms for loading seccomp, AppArmor, or SELinux profiles onto Nodes.  They either have to be loaded manually or installed onto Nodes when they are bootstrapped. This has to be done prior to referencing them in your Pods because the scheduler is unaware of which nodes have profiles. See below how tools like Security Profiles Operator can help automate provisioning of profiles onto nodes.</p>"},{"location":"security/docs/runtime/#security-contexts-and-built-in-kubernetes-controls","title":"Security contexts and built-in Kubernetes controls","text":"<p>Many Linux runtime security mechanisms are tightly integrated with Kubernetes and can be configured through Kubernetes security contexts. One such option is the <code>privileged</code> flag, which is <code>false</code> by default and if enabled is essentially equivalent to root on the host. It is nearly always inappropriate to enable privileged mode in production workloads, but there are many more controls that can provide more granular privileges to containers as appropriate.</p>"},{"location":"security/docs/runtime/#linux-capabilities","title":"Linux capabilities","text":"<p>Linux capabilities allow you to grant certain capabilities to a Pod or container without providing all the abilities of the root user. Examples include <code>CAP_NET_ADMIN</code>, which allows configuring network interfaces or firewalls, or <code>CAP_SYS_TIME</code>, which allows manipulation of the system clock.</p>"},{"location":"security/docs/runtime/#seccomp","title":"Seccomp","text":"<p>With secure computing (seccomp) you can prevent a containerized application from making certain syscalls to the underlying host operating system's kernel. While the Linux operating system has a few hundred system calls, the lion's share of them are not necessary for running containers. By restricting what syscalls can be made by a container, you can effectively decrease your application's attack surface.</p> <p>Seccomp works by intercepting syscalls and only allowing those that have been allowlisted to pass through. Docker has a default seccomp profile which is suitable for a majority of general purpose workloads, and other container runtimes like containerd provide comparable defaults. You can configure your container or Pod to use the container runtime's default seccomp profile by adding the following to the <code>securityContext</code> section of the Pod spec:</p> <pre><code>securityContext:\n  seccompProfile:\n    type: RuntimeDefault\n</code></pre> <p>As of 1.22 (in alpha, stable as of 1.27), the above <code>RuntimeDefault</code> can be used for all Pods on a Node using a single kubelet flag, <code>--seccomp-default</code>. Then the profile specified in <code>securityContext</code> is only needed for other profiles.</p> <p>It's also possible to create your own profiles for things that require additional privileges. This can be very tedious to do manually, but there are tools like Inspektor Gadget (also recommended in the network security section for generating network policies) and Security Profiles Operator that support using tools like eBPF or logs to record baseline privilege requirements as seccomp profiles. Security Profiles Operator further allows automating the deployment of recorded profiles to nodes for use by Pods and containers.</p>"},{"location":"security/docs/runtime/#apparmor-and-selinux","title":"AppArmor and SELinux","text":"<p>AppArmor and SELinux are known as mandatory access control or MAC systems. They are similar in concept to seccomp but with different APIs and abilities, allowing access control for e.g. specific filesystem paths or network ports. Support for these tools depends on the Linux distribution, with Debian/Ubuntu supporting AppArmor and RHEL/CentOS/Bottlerocket/Amazon Linux 2023 supporting SELinux. Also see the infrastructure security section for further discussion of SELinux.</p> <p>Both AppArmor and SELinux are integrated with Kubernetes, but as of Kubernetes 1.28 AppArmor profiles must be specified via annotations while SELinux labels can be set through the SELinuxOptions field on the security context directly.</p> <p>As with seccomp profiles, the Security Profiles Operator mentioned above can assist with deploying profiles onto nodes in the cluster. (In the future, the project also aims to generate profiles for AppArmor and SELinux as it does for seccomp.)</p>"},{"location":"security/docs/runtime/#recommendations","title":"Recommendations","text":""},{"location":"security/docs/runtime/#use-amazon-guardduty-for-runtime-monitoring-and-detecting-threats-to-your-eks-environments","title":"Use Amazon GuardDuty for runtime monitoring and detecting threats to your EKS environments","text":"<p>If you do not currently have a solution for continuously monitoring EKS runtimes and analyzing EKS audit logs, and scanning for malware and other suspicious activity, Amazon strongly recommends the use of Amazon GuardDuty for customers who want a simple, fast, secure, scalable, and cost-effective one-click way to protect their AWS environments. Amazon GuardDuty is a security monitoring service that analyzes and processes foundational data sources, such as AWS CloudTrail management events, AWS CloudTrail event logs, VPC flow logs (from Amazon EC2 instances), Kubernetes audit logs, and DNS logs. It also includes EKS runtime monitoring. It uses continuously updated threat intelligence feeds, such as lists of malicious IP addresses and domains, and machine learning to identify unexpected, potentially unauthorized, and malicious activity within your AWS environment. This can include issues like escalation of privileges, use of exposed credentials, or communication with malicious IP addresses, domains, presence of malware on your Amazon EC2 instances and EKS container workloads, or discovery of suspicious API activity. GuardDuty informs you of the status of your AWS environment by producing security findings that you can view in the GuardDuty console or through Amazon EventBridge. GuardDuty also provides support for you to export your findings to an Amazon Simple Storage Service (S3) bucket, and integrate with other services such as AWS Security Hub and Detective.</p> <p>Watch this AWS Online Tech Talk \"Enhanced threat detection for Amazon EKS with Amazon GuardDuty - AWS Online Tech Talks\" to see how to enable these additional EKS security features step-by-step in minutes.</p>"},{"location":"security/docs/runtime/#optionally-use-a-3rd-party-solution-for-runtime-monitoring","title":"Optionally: Use a 3rd party solution for runtime monitoring","text":"<p>Creating and managing seccomp and Apparmor profiles can be difficult if you're not familiar with Linux security.  If you don't have the time to become proficient, consider using a 3rd party commercial solution.  A lot of them have moved beyond static profiles like Apparmor and seccomp and have begun using machine learning to block or alert on suspicious activity. A handful of these solutions can be found below in the tools section. Additional options can be found on the AWS Marketplace for Containers.</p>"},{"location":"security/docs/runtime/#consider-adddropping-linux-capabilities-before-writing-seccomp-policies","title":"Consider add/dropping Linux capabilities before writing seccomp policies","text":"<p>Capabilities involve various checks in kernel functions reachable by syscalls. If the check fails, the syscall typically returns an error. The check can be done either right at the beginning of a specific syscall, or deeper in the kernel in areas that might be reachable through multiple different syscalls (such as writing to a specific privileged file).  Seccomp, on the other hand, is a syscall filter which is applied to all syscalls before they are run. A process can set up a filter which allows them to revoke their right to run certain syscalls, or specific arguments for certain syscalls.</p> <p>Before using seccomp, consider whether adding/removing Linux capabilities gives you the control you need. See Setting capabilities for- containers for further information.</p>"},{"location":"security/docs/runtime/#see-whether-you-can-accomplish-your-aims-by-using-pod-security-policies-psps","title":"See whether you can accomplish your aims by using Pod Security Policies (PSPs)","text":"<p>Pod Security Policies offer a lot of different ways to improve your security posture without introducing undue complexity. Explore the options available in PSPs before venturing into building seccomp and Apparmor profiles.</p> <p>Warning</p> <p>As of Kubernetes 1.25, PSPs have been removed and replaced with the Pod Security Admission controller. Third-party alternatives which exist include OPA/Gatekeeper and Kyverno. A collection of Gatekeeper constraints and constraint templates for implementing policies commonly found in PSPs can be pulled from the Gatekeeper library repository on GitHub. And many replacements for PSPs can be found in the Kyverno policy library including the full collection of Pod Security Standards.</p>"},{"location":"security/docs/runtime/#tools-and-resources","title":"Tools and Resources","text":"<ul> <li>7 things you should know before you start</li> <li>AppArmor Loader</li> <li>Setting up nodes with profiles</li> <li>Security Profiles Operator is a Kubernetes enhancement which aims to make it easier for users to use SELinux, seccomp and AppArmor in Kubernetes clusters. It provides capabilities for both generating profiles from running workloads and loading profiles onto Kubernetes nodes for use in Pods.</li> <li>Inspektor Gadget allows inspecting, tracing, and profiling many aspects of runtime behavior on Kubernetes, including assisting in the generation of seccomp profiles.</li> <li>Aqua</li> <li>Qualys</li> <li>Stackrox</li> <li>Sysdig Secure</li> <li>Prisma</li> <li>NeuVector by SUSE open source, zero-trust container security platform, provides process profile rules and file access rules.</li> </ul>"},{"location":"upgrades/","title":"Best Practices for Cluster Upgrades","text":"<p>This guide shows cluster administrators how to plan and execute their Amazon EKS upgrade strategy. It also describes how to upgrade self-managed nodes, managed node groups, Karpenter nodes, and Fargate nodes. It does not include guidance on EKS Anywhere, self-managed Kubernetes, AWS Outposts, or AWS Local Zones. </p>"},{"location":"upgrades/#overview","title":"Overview","text":"<p>A Kubernetes version encompasses both the control plane and the data plane. To ensure smooth operation, both the control plane and the data plane should run the same Kubernetes minor version, such as 1.24. While AWS manages and upgrades the control plane, updating the worker nodes in the data plane is your responsibility.</p> <ul> <li>Control plane \u2014 The version of the control plane is determined by the Kubernetes API server. In Amazon EKS clusters, AWS takes care of managing this component. Control plane upgrades can be initiated via the AWS API. </li> <li>Data plane \u2014 The data plane version is associated with the Kubelet versions running on your individual nodes. It's possible to have nodes in the same cluster running different versions. You can check the versions of all nodes by running <code>kubectl get nodes</code>.</li> </ul>"},{"location":"upgrades/#before-upgrading","title":"Before Upgrading","text":"<p>If you're planning to upgrade your Kubernetes version in Amazon EKS, there are a few important policies, tools, and procedures you should put in place before starting an upgrade. </p> <ul> <li>Understand Deprecation Policies \u2014 Gain a deep understanding of how the  Kubernetes deprecation policy works. Be aware of any upcoming changes that may affect your existing applications. Newer versions of Kubernetes often phase out certain APIs and features, potentially causing issues for running applications.</li> <li>Review Kubernetes Change Log \u2014 Thoroughly review the Kubernetes change log alongside Amazon EKS Kubernetes versions to understand any possible impact to your cluster, such as breaking changes that may affect your workloads.</li> <li>Assess Cluster Add-Ons Compatibility \u2014 Amazon EKS doesn't automatically update an add-on when new versions are released or after you update your cluster to a new Kubernetes minor version. Review Updating an add-on to understand the compatibility of any existing cluster add-ons with the cluster version you intend to upgrade to.</li> <li>Enable Control Plane Logging \u2014 Enable control plane logging to capture logs, errors, or issues that can arise during the upgrade process. Consider reviewing these logs for any anomalies. Test cluster upgrades in a non-production environment, or integrate automated tests into your continuous integration workflow to assess version compatibility with your applications, controllers, and custom integrations.</li> <li>Explore eksctl for Cluster Management \u2014 Consider using eksctl to manage your EKS cluster. It provides you with the ability to update the control plane, manage add-ons, and handle worker node updates out-of-the-box. </li> <li>Opt for Managed Node Groups or EKS on Fargate \u2014 Streamline and automate worker node upgrades by using EKS managed node groups or EKS on Fargate. These options simplify the process and reduce manual intervention.</li> <li>Utilize kubectl Convert Plugin \u2014 Leverage the kubectl convert plugin to facilitate the conversion of Kubernetes manifest files between different API versions. This can help ensure that your configurations remain compatible with the new Kubernetes version.</li> </ul>"},{"location":"upgrades/#keep-your-cluster-up-to-date","title":"Keep your cluster up-to-date","text":"<p>Staying current with Kubernetes updates is paramount for a secure and efficient EKS environment, reflecting the shared responsibility model in Amazon EKS. By integrating these strategies into your operational workflow, you're positioning yourself to maintain up-to-date, secure clusters that take full advantage of the latest features and improvements. Tactics:</p> <ul> <li>Supported Version Policy \u2014 Aligned with the Kubernetes community, Amazon EKS typically provides three active Kubernetes versions while deprecating a fourth version each year. Deprecation notices are issued at least 60 days before a version reaches its end-of-support date. For more details, refer to the EKS Version FAQ.</li> <li>Auto-Upgrade Policy \u2014 We strongly recommend staying in sync with Kubernetes updates in your EKS cluster. Kubernetes community support, including bug fixes and security patches, typically ceases for versions older than one year. Deprecated versions may also lack vulnerability reporting, posing a potential risk. Failure to proactively upgrade before a version's end-of-life triggers an automatic upgrade, which could disrupt your workloads and systems. For additional information, consult the EKS Version Support Policy.</li> <li>Create Upgrade Runbooks \u2014 Establish a well-documented process for managing upgrades. As part of your proactive approach, develop runbooks and specialized tools tailored to your upgrade process. This not only enhances your preparedness but also simplifies complex transitions. Make it a standard practice to upgrade your clusters at least once a year. This practice aligns you with ongoing technological advancements, thereby boosting the efficiency and security of your environment.</li> </ul>"},{"location":"upgrades/#review-the-eks-release-calendar","title":"Review the EKS release calendar","text":"<p>Review the EKS Kubernetes release calendar to learn when new versions are coming, and when support for specific versions end. Generally, EKS releases three minor versions of Kubernetes annually, and each minor version is supported for about 14 months. </p> <p>Additionally, review the upstream Kubernetes release information.</p>"},{"location":"upgrades/#understand-how-the-shared-responsibility-model-applies-to-cluster-upgrades","title":"Understand how the shared responsibility model applies to cluster upgrades","text":"<p>You are responsible for initiating upgrade for both cluster control plane as well as the data plane. Learn how to initiate an upgrade. When you initiate a cluster upgrade, AWS manages upgrading the cluster control plane. You are responsible for upgrading the data plane, including Fargate pods and other add-ons. You must validate and plan upgrades for workloads running on your cluster to ensure their availability and operations are not impacted after cluster upgrade</p>"},{"location":"upgrades/#upgrade-clusters-in-place","title":"Upgrade clusters in-place","text":"<p>EKS supports an in-place cluster upgrade strategy. This maintains cluster resources, and keeps cluster configuration consistent (e.g., API endpoint, OIDC, ENIs, load balancers). This is less disruptive for cluster users, and it will use the existing workloads and resources in the cluster without requiring you to redeploy workloads or migrate external resources (e.g., DNS, storage).</p> <p>When performing an in-place cluster upgrade, it is important to note that only one minor version upgrade can be executed at a time (e.g., from 1.24 to 1.25). </p> <p>This means that if you need to update multiple versions, a series of sequential upgrades will be required. Planning sequential upgrades is more complicated, and has a higher risk of downtime. In this situation, evaluate a blue/green cluster upgrade strategy.</p>"},{"location":"upgrades/#upgrade-your-control-plane-and-data-plane-in-sequence","title":"Upgrade your control plane and data plane in sequence","text":"<p>To upgrade a cluster you will need to take the following actions:</p> <ol> <li>Review the Kubernetes and EKS release notes.</li> <li>Take a backup of the cluster. (optional)</li> <li>Identify and remediate deprecated and removed API usage in your workloads.</li> <li>Ensure Managed Node Groups, if used, are on the same Kubernetes version as the control plane. EKS managed node groups and nodes created by EKS Fargate Profiles only support 1 minor version skew between the control plane and data plane.</li> <li>Upgrade the cluster control plane using the AWS console or cli.</li> <li>Review add-on compatibility. Upgrade your Kubernetes add-ons and custom controllers, as required. </li> <li>Update kubectl.</li> <li>Upgrade the cluster data plane.  Upgrade your nodes to the same Kubernetes minor version as your upgraded cluster. </li> </ol>"},{"location":"upgrades/#use-the-eks-documentation-to-create-an-upgrade-checklist","title":"Use the EKS Documentation to create an upgrade checklist","text":"<p>The EKS Kubernetes version documentation includes a detailed list of changes for each version. Build a checklist for each upgrade. </p> <p>For specific EKS version upgrade guidance, review the documentation for notable changes and considerations for each version.</p> <ul> <li>EKS 1.27</li> <li>EKS 1.26</li> <li>EKS 1.25</li> <li>EKS 1.24</li> <li>EKS 1.23</li> <li>EKS 1.22</li> </ul>"},{"location":"upgrades/#upgrade-add-ons-and-components-using-the-kubernetes-api","title":"Upgrade add-ons and components using the Kubernetes API","text":"<p>Before you upgrade a cluster, you should understand what versions of Kubernetes components you are using. Inventory cluster components, and identify components that use the Kubernetes API directly. This includes critical cluster components such as monitoring and logging agents, cluster autoscalers, container storage drivers (e.g. EBS CSI, EFS CSI), ingress controllers, and any other workloads or add-ons that rely on the Kubernetes API directly. </p> <p>Tip</p> <p>Critical cluster components are often installed in a <code>*-system</code> namespace</p> <pre><code>kubectl get ns | grep '-system'\n</code></pre> <p>Once you have identified components that rely the Kubernetes API, check their documentation for version compatibility and upgrade requirements. For example, see the AWS Load Balancer Controller documentation for version compatibility. Some components may need to be upgraded or configuration changed before proceeding with a cluster upgrade. Some critical components to check include CoreDNS, kube-proxy, VPC CNI, and storage drivers. </p> <p>Clusters often contain many workloads that use the Kubernetes API and are required for workload functionality such as ingress controllers, continuous delivery systems, and monitoring tools. When you upgrade an EKS cluster, you must also upgrade your add-ons and third-party tools to make sure they are compatible.</p> <p>See the following examples of common add-ons and their relevant upgrade documentation:</p> <ul> <li>Amazon VPC CNI: For the recommended version of the Amazon VPC CNI add-on for each cluster version, see Updating the Amazon VPC CNI plugin for Kubernetes self-managed add-on. When installed as an Amazon EKS Add-on, it can only be upgraded one minor version at a time.</li> <li>kube-proxy: See Updating the Kubernetes kube-proxy self-managed add-on.</li> <li>CoreDNS: See Updating the CoreDNS self-managed add-on.</li> <li>AWS Load Balancer Controller: The AWS Load Balancer Controller needs to be compatible with the EKS version you have deployed. See the installation guide for more information. </li> <li>Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) driver: For installation and upgrade information, see Managing the Amazon EBS CSI driver as an Amazon EKS add-on.</li> <li>Amazon Elastic File System (Amazon EFS) Container Storage Interface (CSI) driver: For installation and upgrade information, see Amazon EFS CSI driver.</li> <li>Kubernetes Metrics Server: For more information, see metrics-server on GitHub.</li> <li>Kubernetes Cluster Autoscaler: To upgrade the version of Kubernetes Cluster Autoscaler, change the version of the image in the deployment. The Cluster Autoscaler is tightly coupled with the Kubernetes scheduler. You will always need to upgrade it when you upgrade the cluster. Review the GitHub releases to find the address of the latest release corresponding to your Kubernetes minor version.</li> <li>Karpenter: For installation and upgrade information, see the Karpenter documentation.</li> </ul>"},{"location":"upgrades/#verify-basic-eks-requirements-before-upgrading","title":"Verify basic EKS requirements before upgrading","text":"<p>AWS requires certain resources in your account to complete the upgrade process. If these resources aren\u2019t present, the cluster cannot be upgraded. A control plane upgrade requires the following resources:</p> <ol> <li>Available IP addresses: Amazon EKS requires up to five available IP addresses from the subnets you specified when you created the cluster in order to update the cluster. If not, update your cluster configuration to include new cluster subnets prior to performing the version update.</li> <li>EKS IAM role: The control plane IAM role is still present in the account with the necessary permissions.</li> <li>If your cluster has secret encryption enabled, then make sure that the cluster IAM role has permission to use the AWS Key Management Service (AWS KMS) key.</li> </ol>"},{"location":"upgrades/#verify-available-ip-addresses","title":"Verify available IP addresses","text":"<p>To update the cluster, Amazon EKS requires up to five available IP addresses from the subnets that you specified when you created your cluster.</p> <p>To verify that your subnets have enough IP addresses to upgrade the cluster you can run the following command:</p> <pre><code>CLUSTER=&lt;cluster name&gt;\naws ec2 describe-subnets --subnet-ids \\\n  $(aws eks describe-cluster --name ${CLUSTER} \\\n  --query 'cluster.resourcesVpcConfig.subnetIds' \\\n  --output text) \\\n  --query 'Subnets[*].[SubnetId,AvailabilityZone,AvailableIpAddressCount]' \\\n  --output table\n\n----------------------------------------------------\n|                  DescribeSubnets                 |\n+---------------------------+--------------+-------+\n|  subnet-067fa8ee8476abbd6 |  us-east-1a  |  8184 |\n|  subnet-0056f7403b17d2b43 |  us-east-1b  |  8153 |\n|  subnet-09586f8fb3addbc8c |  us-east-1a  |  8120 |\n|  subnet-047f3d276a22c6bce |  us-east-1b  |  8184 |\n+---------------------------+--------------+-------+\n</code></pre> <p>The VPC CNI Metrics Helper may be used to create a CloudWatch dashboard for VPC metrics.  Amazon EKS recommends updating the cluster subnets using the \"UpdateClusterConfiguration\" API prior to beginning a Kubernetes version upgrade if you are running out of IP addresses in the subnets initially specified during cluster creation. Please verify that the new subnets you will be provided:</p> <ul> <li>belong to same set of AZs that are selected during cluster creation. </li> <li>belong to the same VPC provided during cluster creation</li> </ul> <p>Please consider associating additional CIDR blocks if the IP addresses in the existing VPC CIDR block run out. AWS enables the association of additional CIDR blocks with your existing cluster VPC, effectively expanding your IP address pool. This expansion can be accomplished by introducing additional private IP ranges (RFC 1918) or, if necessary, public IP ranges (non-RFC 1918). You must add new VPC CIDR blocks and allow VPC refresh to complete before Amazon EKS can use the new CIDR. After that, you can update the subnets based on the newly set up CIDR blocks to the VPC.</p>"},{"location":"upgrades/#verify-eks-iam-role","title":"Verify EKS IAM role","text":"<p>To verify that the IAM role is available and has the correct assume role policy in your account you can run the following commands:</p> <pre><code>CLUSTER=&lt;cluster name&gt;\nROLE_ARN=$(aws eks describe-cluster --name ${CLUSTER} \\\n  --query 'cluster.roleArn' --output text)\naws iam get-role --role-name ${ROLE_ARN##*/} \\\n  --query 'Role.AssumeRolePolicyDocument'\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"eks.amazonaws.com\"\n            },\n            \"Action\": \"sts:AssumeRole\"\n        }\n    ]\n}\n</code></pre>"},{"location":"upgrades/#migrate-to-eks-add-ons","title":"Migrate to EKS Add-ons","text":"<p>Amazon EKS automatically installs add-ons such as the Amazon VPC CNI plugin for Kubernetes, <code>kube-proxy</code>, and CoreDNS for every cluster. Add-ons may be self-managed, or installed as Amazon EKS Add-ons. Amazon EKS Add-ons is an alternate way to manage add-ons using the EKS API. </p> <p>You can use Amazon EKS Add-ons to update versions with a single command. For Example:</p> <pre><code>aws eks update-addon \u2014cluster-name my-cluster \u2014addon-name vpc-cni \u2014addon-version version-number \\\n--service-account-role-arn arn:aws:iam::111122223333:role/role-name \u2014configuration-values '{}' \u2014resolve-conflicts PRESERVE\n</code></pre> <p>Check if you have any EKS Add-ons with:</p> <pre><code>aws eks list-addons --cluster-name &lt;cluster name&gt;\n</code></pre> <p>Warning</p> <p>EKS Add-ons are not automatically upgraded during a control plane upgrade. You must initiate EKS add-on updates, and select the desired version. </p> <ul> <li>You are responsible for selecting a compatible version from all available versions. Review the guidance on add-on version compatibility.</li> <li>Amazon EKS Add-ons may only be upgraded one minor version at a time. </li> </ul> <p>Learn more about what components are available as EKS Add-ons, and how to get started.</p> <p>Learn how to supply a custom configuration to an EKS Add-on.</p>"},{"location":"upgrades/#identify-and-remediate-removed-api-usage-before-upgrading-the-control-plane","title":"Identify and remediate removed API usage before upgrading the control plane","text":"<p>You should identify API usage of removed APIs before upgrading your EKS control plane. To do that we recommend using tools that can check a running cluster or static, rendered Kubernetes manifest files. </p> <p>Running the check against static manifest files is generally more accurate. If run against live clusters, these tools may return false positives. </p> <p>A deprecated Kubernetes API does not mean the API has been removed. You should check the Kubernetes Deprecation Policy to understand how API removal affects your workloads.</p>"},{"location":"upgrades/#cluster-insights","title":"Cluster Insights","text":"<p>Cluster Insights is a feature that provides findings on issues that may impact the ability to upgrade an EKS cluster to newer versions of Kubernetes. These findings are curated and managed by Amazon EKS and offer recommendations on how to remediate them. By leveraging Cluster Insights, you can minimize the effort spent to upgrade to newer Kubernetes versions.</p> <p>To view insights of an EKS cluster, you can run the command: <pre><code>aws eks list-insights --region &lt;region-code&gt; --cluster-name &lt;my-cluster&gt;\n\n{\n    \"insights\": [\n        {\n            \"category\": \"UPGRADE_READINESS\", \n            \"name\": \"Deprecated APIs removed in Kubernetes v1.29\", \n            \"insightStatus\": {\n                \"status\": \"PASSING\", \n                \"reason\": \"No deprecated API usage detected within the last 30 days.\"\n            }, \n            \"kubernetesVersion\": \"1.29\", \n            \"lastTransitionTime\": 1698774710.0, \n            \"lastRefreshTime\": 1700157422.0, \n            \"id\": \"123e4567-e89b-42d3-a456-579642341238\", \n            \"description\": \"Checks for usage of deprecated APIs that are scheduled for removal in Kubernetes v1.29. Upgrading your cluster before migrating to the updated APIs supported by v1.29 could cause application impact.\"\n        }\n    ]\n}\n</code></pre></p> <p>For a more descriptive output about the insight received, you can run the command: <pre><code>aws eks describe-insight --region &lt;region-code&gt; --id &lt;insight-id&gt; --cluster-name &lt;my-cluster&gt;\n</code></pre></p> <p>You also have the option to view insights in the Amazon EKS Console. After selecting your cluster from the cluster list, insight findings are located under the <code>Upgrade Insights</code> tab.</p> <p>If you find a cluster insight with <code>\"status\": ERROR</code>, you must address the issue prior to performing the cluster upgrade. Run the <code>aws eks describe-insight</code> command which will share the following remediation advice: </p> <p>Resources affected: <pre><code>\"resources\": [\n      {\n        \"insightStatus\": {\n          \"status\": \"ERROR\"\n        },\n        \"kubernetesResourceUri\": \"/apis/policy/v1beta1/podsecuritypolicies/null\"\n      }\n]\n</code></pre></p> <p>APIs deprecated: <pre><code>\"deprecationDetails\": [\n      {\n        \"usage\": \"/apis/flowcontrol.apiserver.k8s.io/v1beta2/flowschemas\", \n        \"replacedWith\": \"/apis/flowcontrol.apiserver.k8s.io/v1beta3/flowschemas\", \n        \"stopServingVersion\": \"1.29\", \n        \"clientStats\": [], \n        \"startServingReplacementVersion\": \"1.26\"\n      }\n]\n</code></pre></p> <p>Recommended action to take: <pre><code>\"recommendation\": \"Update manifests and API clients to use newer Kubernetes APIs if applicable before upgrading to Kubernetes v1.26.\"\n</code></pre></p> <p>Utilizing cluster insights through the EKS Console or CLI help speed the process of successfully upgrading EKS cluster versions. Learn more with the following resources: * Official EKS Docs * Cluster Insights launch blog.</p>"},{"location":"upgrades/#kube-no-trouble","title":"Kube-no-trouble","text":"<p>Kube-no-trouble is an open source command line utility with the command <code>kubent</code>. When you run <code>kubent</code> without any arguments it will use your current KubeConfig context and scan the cluster and print a report with what APIs will be deprecated and removed. </p> <pre><code>kubent\n\n4:17PM INF &gt;&gt;&gt; Kube No Trouble `kubent` &lt;&lt;&lt;\n4:17PM INF version 0.7.0 (git sha d1bb4e5fd6550b533b2013671aa8419d923ee042)\n4:17PM INF Initializing collectors and retrieving data\n4:17PM INF Target K8s version is 1.24.8-eks-ffeb93d\n4:l INF Retrieved 93 resources from collector name=Cluster\n4:17PM INF Retrieved 16 resources from collector name=\"Helm v3\"\n4:17PM INF Loaded ruleset name=custom.rego.tmpl\n4:17PM INF Loaded ruleset name=deprecated-1-16.rego\n4:17PM INF Loaded ruleset name=deprecated-1-22.rego\n4:17PM INF Loaded ruleset name=deprecated-1-25.rego\n4:17PM INF Loaded ruleset name=deprecated-1-26.rego\n4:17PM INF Loaded ruleset name=deprecated-future.rego\n__________________________________________________________________________________________\n&gt;&gt;&gt; Deprecated APIs removed in 1.25 &lt;&lt;&lt;\n------------------------------------------------------------------------------------------\nKIND                NAMESPACE     NAME             API_VERSION      REPLACE_WITH (SINCE)\nPodSecurityPolicy   &lt;undefined&gt;   eks.privileged   policy/v1beta1   &lt;removed&gt; (1.21.0)\n</code></pre> <p>It can also be used to scan static manifest files and helm packages. It is recommended to run <code>kubent</code> as part of a continuous integration (CI) process to identify issues before manifests are deployed. Scanning manifests is also more accurate than scanning live clusters. </p> <p>Kube-no-trouble provides a sample Service Account and Role with the appropriate permissions for scanning the cluster. </p>"},{"location":"upgrades/#pluto","title":"Pluto","text":"<p>Another option is pluto which is similar to <code>kubent</code> because it supports scanning a live cluster, manifest files, helm charts and has a GitHub Action you can include in your CI process.</p> <pre><code>pluto detect-all-in-cluster\n\nNAME             KIND                VERSION          REPLACEMENT   REMOVED   DEPRECATED   REPL AVAIL  \neks.privileged   PodSecurityPolicy   policy/v1beta1                 false     true         true\n</code></pre>"},{"location":"upgrades/#resources","title":"Resources","text":"<p>To verify that your cluster don't use deprecated APIs before the upgrade, you should monitor:</p> <ul> <li>metric <code>apiserver_requested_deprecated_apis</code> since Kubernetes v1.19:</li> </ul> <pre><code>kubectl get --raw /metrics | grep apiserver_requested_deprecated_apis\n\napiserver_requested_deprecated_apis{group=\"policy\",removed_release=\"1.25\",resource=\"podsecuritypolicies\",subresource=\"\",version=\"v1beta1\"} 1\n</code></pre> <ul> <li>events in the audit logs with <code>k8s.io/deprecated</code> set to <code>true</code>:</li> </ul> <pre><code>CLUSTER=\"&lt;cluster_name&gt;\"\nQUERY_ID=$(aws logs start-query \\\n --log-group-name /aws/eks/${CLUSTER}/cluster \\\n --start-time $(date -u --date=\"-30 minutes\" \"+%s\") # or date -v-30M \"+%s\" on MacOS \\\n --end-time $(date \"+%s\") \\\n --query-string 'fields @message | filter `annotations.k8s.io/deprecated`=\"true\"' \\\n --query queryId --output text)\n\necho \"Query started (query id: $QUERY_ID), please hold ...\" &amp;&amp; sleep 5 # give it some time to query\n\naws logs get-query-results --query-id $QUERY_ID\n</code></pre> <p>Which will output lines if deprecated APIs are in use:</p> <pre><code>{\n    \"results\": [\n        [\n            {\n                \"field\": \"@message\",\n                \"value\": \"{\\\"kind\\\":\\\"Event\\\",\\\"apiVersion\\\":\\\"audit.k8s.io/v1\\\",\\\"level\\\":\\\"Request\\\",\\\"auditID\\\":\\\"8f7883c6-b3d5-42d7-967a-1121c6f22f01\\\",\\\"stage\\\":\\\"ResponseComplete\\\",\\\"requestURI\\\":\\\"/apis/policy/v1beta1/podsecuritypolicies?allowWatchBookmarks=true\\\\u0026resourceVersion=4131\\\\u0026timeout=9m19s\\\\u0026timeoutSeconds=559\\\\u0026watch=true\\\",\\\"verb\\\":\\\"watch\\\",\\\"user\\\":{\\\"username\\\":\\\"system:apiserver\\\",\\\"uid\\\":\\\"8aabfade-da52-47da-83b4-46b16cab30fa\\\",\\\"groups\\\":[\\\"system:masters\\\"]},\\\"sourceIPs\\\":[\\\"::1\\\"],\\\"userAgent\\\":\\\"kube-apiserver/v1.24.16 (linux/amd64) kubernetes/af930c1\\\",\\\"objectRef\\\":{\\\"resource\\\":\\\"podsecuritypolicies\\\",\\\"apiGroup\\\":\\\"policy\\\",\\\"apiVersion\\\":\\\"v1beta1\\\"},\\\"responseStatus\\\":{\\\"metadata\\\":{},\\\"code\\\":200},\\\"requestReceivedTimestamp\\\":\\\"2023-10-04T12:36:11.849075Z\\\",\\\"stageTimestamp\\\":\\\"2023-10-04T12:45:30.850483Z\\\",\\\"annotations\\\":{\\\"authorization.k8s.io/decision\\\":\\\"allow\\\",\\\"authorization.k8s.io/reason\\\":\\\"\\\",\\\"k8s.io/deprecated\\\":\\\"true\\\",\\\"k8s.io/removed-release\\\":\\\"1.25\\\"}}\"\n            },\n[...]\n</code></pre>"},{"location":"upgrades/#update-kubernetes-workloads-use-kubectl-convert-to-update-manifests","title":"Update Kubernetes workloads. Use kubectl-convert to update manifests","text":"<p>After you have identified what workloads and manifests need to be updated, you may need to change the resource type in your manifest files (e.g. PodSecurityPolicies to PodSecurityStandards). This will require updating the resource specification and additional research depending on what resource is being replaced.</p> <p>If the resource type is staying the same but API version needs to be updated you can use the <code>kubectl-convert</code> command to automatically convert your manifest files.  For example, to convert an older Deployment to <code>apps/v1</code>. For more information, see Install kubectl convert pluginon the Kubernetes website.</p> <p><code>kubectl-convert -f &lt;file&gt; --output-version &lt;group&gt;/&lt;version&gt;</code></p>"},{"location":"upgrades/#configure-poddisruptionbudgets-and-topologyspreadconstraints-to-ensure-availability-of-your-workloads-while-the-data-plane-is-upgraded","title":"Configure PodDisruptionBudgets and topologySpreadConstraints to ensure availability of your workloads while the data plane is upgraded","text":"<p>Ensure your workloads have the proper PodDisruptionBudgets and topologySpreadConstraints to ensure availability of your workloads while the data plane is upgraded. Not every workload requires the same level of availability so you need to validate the scale and requirements of your workload.</p> <p>Make sure workloads are spread in multiple Availability Zones and on multiple hosts with topology spreads will give a higher level of confidence that workloads will migrate to the new data plane automatically without incident. </p> <p>Here is an example workload that will always have 80% of replicas available and spread replicas across zones and hosts</p> <pre><code>apiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: myapp\nspec:\n  minAvailable: \"80%\"\n  selector:\n    matchLabels:\n      app: myapp\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp\nspec:\n  replicas: 10\n  selector:\n    matchLabels:\n      app: myapp\n  template:\n    metadata:\n      labels:\n        app: myapp\n    spec:\n      containers:\n      - image: public.ecr.aws/eks-distro/kubernetes/pause:3.2\n        name: myapp\n        resources:\n          requests:\n            cpu: \"1\"\n            memory: 256M\n      topologySpreadConstraints:\n      - labelSelector:\n          matchLabels:\n            app: host-zone-spread\n        maxSkew: 2\n        topologyKey: kubernetes.io/hostname\n        whenUnsatisfiable: DoNotSchedule\n      - labelSelector:\n          matchLabels:\n            app: host-zone-spread\n        maxSkew: 2\n        topologyKey: topology.kubernetes.io/zone\n        whenUnsatisfiable: DoNotSchedule\n</code></pre> <p>AWS Resilience Hub has added Amazon Elastic Kubernetes Service (Amazon EKS) as a supported resource. Resilience Hub provides a single place to define, validate, and track the resilience of your applications so that you can avoid unnecessary downtime caused by software, infrastructure, or operational disruptions.</p>"},{"location":"upgrades/#use-managed-node-groups-or-karpenter-to-simplify-data-plane-upgrades","title":"Use Managed Node Groups or Karpenter to simplify data plane upgrades","text":"<p>Managed Node Groups and Karpenter both simplify node upgrades, but they take different approaches.</p> <p>Managed node groups automate the provisioning and lifecycle management of nodes. This means that you can create, automatically update, or terminate nodes with a single operation.</p> <p>In the default configuration, Karpenter automatically creates new nodes using the latest compatible EKS Optimized AMI. As EKS releases updated EKS Optimized AMIs or the cluster is upgraded, Karpenter will automatically start using these images. Karpenter also implements Node Expiry to update nodes.</p> <p>Karpenter can be configured to use custom AMIs. If you use custom AMIs with Karpenter, you are responsible for the version of kubelet. </p>"},{"location":"upgrades/#confirm-version-compatibility-with-existing-nodes-and-the-control-plane","title":"Confirm version compatibility with existing nodes and the control plane","text":"<p>Before proceeding with a Kubernetes upgrade in Amazon EKS, it's vital to ensure compatibility between your managed node groups, self-managed nodes, and the control plane. Compatibility is determined by the Kubernetes version you are using, and it varies based on different scenarios. Tactics:</p> <ul> <li>Kubernetes v1.28+ \u2014 **** Starting from Kubernetes version 1.28 and onwards, there's a more lenient version policy for core components. Specifically, the supported skew between the Kubernetes API server and the kubelet has been extended by one minor version, going from n-2 to n-3. For example, if your EKS control plane version is 1.28, you can safely use kubelet versions as old as 1.25. This version skew is supported across AWS Fargate, managed node groups, and self-managed nodes. We highly recommend keeping your Amazon Machine Image (AMI) versions up-to-date for security reasons. Older kubelet versions might pose security risks due to potential Common Vulnerabilities and Exposures (CVEs), which could outweigh the benefits of using older kubelet versions.</li> <li>Kubernetes &lt; v1.28 \u2014 If you are using a version older than v1.28, the supported skew between the API server and the kubelet is n-2. For example, if your EKS version is 1.27, the oldest kubelet version you can use is 1.25. This version skew is applicable across AWS Fargate, managed node groups, and self-managed nodes.</li> </ul>"},{"location":"upgrades/#enable-node-expiry-for-karpenter-managed-nodes","title":"Enable node expiry for Karpenter managed nodes","text":"<p>One way Karpenter implements node upgrades is using the concept of node expiry. This reduces the planning required for node upgrades. When you set a value for ttlSecondsUntilExpired in your provisioner, this activates node expiry. After nodes reach the defined age in seconds, they\u2019re safely drained and deleted. This is true even if they\u2019re in use, allowing you to replace nodes with newly provisioned upgraded instances. When a node is replaced, Karpenter uses the latest EKS-optimized AMIs. For more information, see Deprovisioning on the Karpenter website.</p> <p>Karpenter doesn\u2019t automatically add jitter to this value. To prevent excessive workload disruption, define a pod disruption budget, as shown in Kubernetes documentation.</p> <p>If you configure ttlSecondsUntilExpired on a provisioner, this applies to existing nodes associated with the provisioner.</p>"},{"location":"upgrades/#use-drift-feature-for-karpenter-managed-nodes","title":"Use Drift feature for Karpenter managed nodes","text":"<p>Karpenter's Drift feature can automatically upgrade the Karpenter-provisioned nodes to stay in-sync with the EKS control plane. Karpenter Drift currently needs to be enabled using a feature gate. Karpenter's default configuration uses the latest EKS-Optimized AMI for the same major and minor version as the EKS cluster's control plane.</p> <p>After an EKS Cluster upgrade completes, Karpenter's Drift feature will detect that the Karpenter-provisioned nodes are using EKS-Optimized AMIs for the previous cluster version, and automatically cordon, drain, and replace those nodes. To support pods moving to new nodes, follow Kubernetes best practices by setting appropriate pod resource quotas, and using pod disruption budgets (PDB). Karpenter's deprovisioning will pre-spin up replacement nodes based on the pod resource requests, and will respect the PDBs when deprovisioning nodes.</p>"},{"location":"upgrades/#use-eksctl-to-automate-upgrades-for-self-managed-node-groups","title":"Use eksctl to automate upgrades for self-managed node groups","text":"<p>Self managed node groups are EC2 instances that were deployed in your account and attached to the cluster outside of the EKS service. These are usually deployed and managed by some form of automation tooling. To upgrade self-managed node groups you should refer to your tools documentation.</p> <p>For example, eksctl supports deleting and draining self-managed nodes. </p> <p>Some common tools include:</p> <ul> <li>eksctl</li> <li>kOps</li> <li>EKS Blueprints</li> </ul>"},{"location":"upgrades/#backup-the-cluster-before-upgrading","title":"Backup the cluster before upgrading","text":"<p>New versions of Kubernetes introduce significant changes to your Amazon EKS cluster. After you upgrade a cluster, you can\u2019t downgrade it.</p> <p>Velero is an community supported open-source tool that can be used to take backups of existing clusters and apply the backups to a new cluster.</p> <p>Note that you can only create new clusters for Kubernetes versions currently supported by EKS. If the version your cluster is currently running is still supported and an upgrade fails, you can create a new cluster with the original version and restore the data plane. Note that AWS resources, including IAM, are not included in the backup by Velero. These resources would need to be recreated. </p>"},{"location":"upgrades/#restart-fargate-deployments-after-upgrading-the-control-plane","title":"Restart Fargate deployments after upgrading the control plane","text":"<p>To upgrade Fargate data plane nodes you need to redeploy the workloads. You can identify which workloads are running on fargate nodes by listing all pods with the <code>-o wide</code> option. Any node name that begins with <code>fargate-</code> will need to be redeployed in the cluster.</p>"},{"location":"upgrades/#evaluate-bluegreen-clusters-as-an-alternative-to-in-place-cluster-upgrades","title":"Evaluate Blue/Green Clusters as an alternative to in-place cluster upgrades","text":"<p>Some customers prefer to do a blue/green upgrade strategy. This can have benefits, but also includes downsides that should be considered.</p> <p>Benefits include:</p> <ul> <li>Possible to change multiple EKS versions at once (e.g. 1.23 to 1.25)</li> <li>Able to switch back to the old cluster</li> <li>Creates a new cluster which may be managed with newer systems (e.g. terraform)</li> <li>Workloads can be migrated individually</li> </ul> <p>Some downsides include:</p> <ul> <li>API endpoint and OIDC change which requires updating consumers (e.g. kubectl and CI/CD)</li> <li>Requires 2 clusters to be run in parallel during the migration, which can be expensive and limit region capacity</li> <li>More coordination is needed if workloads depend on each other to be migrated together</li> <li>Load balancers and external DNS cannot easily span multiple clusters</li> </ul> <p>While this strategy is possible to do, it is more expensive than an in-place upgrade and requires more time for coordination and workload migrations. It may be required in some situations and should be planned carefully.</p> <p>With high degrees of automation and declarative systems like GitOps, this may be easier to do. You will need to take additional precautions for stateful workloads so data is backed up and migrated to new clusters.</p> <p>Review these blogs posts for more information:</p> <ul> <li>Kubernetes cluster upgrade: the blue-green deployment strategy</li> <li>Blue/Green or Canary Amazon EKS clusters migration for stateless ArgoCD workloads</li> </ul>"},{"location":"upgrades/#track-planned-major-changes-in-the-kubernetes-project-think-ahead","title":"Track planned major changes in the Kubernetes project \u2014 Think ahead","text":"<p>Don\u2019t look only at the next version. Review new versions of Kubernetes as they are released, and identify major changes. For example, some applications directly used the docker API, and support for Container Runtime Interface (CRI) for Docker (also known as Dockershim) was removed in Kubernetes <code>1.24</code>. This kind of change requires more time to prepare for. </p> <p>Review all documented changes for the version that you\u2019re upgrading to, and note any required upgrade steps. Also, note any requirements or procedures that are specific to Amazon EKS managed clusters.</p> <ul> <li>Kubernetes changelog</li> </ul>"},{"location":"upgrades/#specific-guidance-on-feature-removals","title":"Specific Guidance on Feature Removals","text":""},{"location":"upgrades/#removal-of-dockershim-in-125-use-detector-for-docker-socket-dds","title":"Removal of Dockershim in 1.25 - Use Detector for Docker Socket (DDS)","text":"<p>The EKS Optimized AMI for 1.25 no longer includes support for Dockershim. If you have a dependency on Dockershim, e.g. you are mounting the Docker socket, you will need to remove those dependencies before upgrading your worker nodes to 1.25. </p> <p>Find instances where you have a dependency on the Docker socket before upgrading to 1.25. We recommend using Detector for Docker Socket (DDS), a kubectl plugin.. </p>"},{"location":"upgrades/#removal-of-podsecuritypolicy-in-125-migrate-to-pod-security-standards-or-a-policy-as-code-solution","title":"Removal of PodSecurityPolicy in 1.25 - Migrate to Pod Security Standards or a policy-as-code solution","text":"<p><code>PodSecurityPolicy</code> was deprecated in Kubernetes 1.21, and has been removed in Kubernetes 1.25. If you are using PodSecurityPolicy in your cluster, then you must migrate to the built-in Kubernetes Pod Security Standards (PSS) or to a policy-as-code solution before upgrading your cluster to version 1.25 to avoid interruptions to your workloads. </p> <p>AWS published a detailed FAQ in the EKS documentation.</p> <p>Review the Pod Security Standards (PSS) and Pod Security Admission (PSA) best practices. </p> <p>Review the PodSecurityPolicy Deprecation blog post on the Kubernetes website.</p>"},{"location":"upgrades/#deprecation-of-in-tree-storage-driver-in-123-migrate-to-container-storage-interface-csi-drivers","title":"Deprecation of In-Tree Storage Driver in 1.23 - Migrate to Container Storage Interface (CSI) Drivers","text":"<p>The Container Storage Interface (CSI) was designed to help Kubernetes replace its existing, in-tree storage driver mechanisms. The Amazon EBS container storage interface (CSI) migration feature is enabled by default in Amazon EKS <code>1.23</code> and later clusters. If you have pods running on a version <code>1.22</code> or earlier cluster, then you must install the Amazon EBS CSI driver before updating your cluster to version <code>1.23</code> to avoid service interruption. </p> <p>Review the Amazon EBS CSI migration frequently asked questions.</p>"},{"location":"upgrades/#additional-resources","title":"Additional Resources","text":""},{"location":"upgrades/#clowdhaus-eks-upgrade-guidance","title":"ClowdHaus EKS Upgrade Guidance","text":"<p>ClowdHaus EKS Upgrade Guidance is a CLI to aid in upgrading Amazon EKS clusters. It can analyze a cluster for any potential issues to remediate prior to upgrade. </p>"},{"location":"upgrades/#gonogo","title":"GoNoGo","text":"<p>GoNoGo is an alpha-stage tool to determine the upgrade confidence of your cluster add-ons. </p>"},{"location":"windows/docs/ami/","title":"Amazon EKS optimized Windows AMI management","text":"<p>Windows Amazon EKS optimized AMIs are built on top of Windows Server 2019 and Windows Server 2022. They are configured to serve as the base image for Amazon EKS nodes. By default, the AMIs include the following components: - kubelet - kube-proxy - AWS IAM Authenticator for Kubernetes - csi-proxy - containerd</p> <p>You can programmatically retrieve the Amazon Machine Image (AMI) ID for Amazon EKS optimized AMIs by querying the AWS Systems Manager Parameter Store API. This parameter eliminates the need for you to manually look up Amazon EKS optimized AMI IDs. For more information about the Systems Manager Parameter Store API, see GetParameter. Your user account must have the ssm:GetParameter IAM permission to retrieve the Amazon EKS optimized AMI metadata.</p> <p>The following example retrieves the AMI ID for the latest Amazon EKS optimized AMI for Windows Server 2019 LTSC Core. The version number listed in the AMI name relates to the corresponding Kubernetes build it is prepared for.</p> <pre><code>aws ssm get-parameter --name /aws/service/ami-windows-latest/Windows_Server-2019-English-Core-EKS_Optimized-1.21/image_id --region us-east-1 --query \"Parameter.Value\" --output text\n</code></pre> <p>Example output:</p> <pre><code>ami-09770b3eec4552d4e\n</code></pre>"},{"location":"windows/docs/ami/#managing-your-own-amazon-eks-optimized-windows-ami","title":"Managing your own Amazon EKS optimized Windows AMI","text":"<p>An essential step towards production environments is maintaining the same Amazon EKS optimized Windows AMI and kubelet version across the Amazon EKS cluster. </p> <p>Using the same version across the Amazon EKS cluster reduces the time during troubleshooting and increases cluster consistency. Amazon EC2 Image Builder helps create and maintain custom Amazon EKS optimized Windows AMIs to be used across an Amazon EKS cluster.</p> <p>Use Amazon EC2 Image Builder to select between Windows Server versions, AWS Windows Server AMI release dates, and/or OS build version. The build components step, allows you to select between existing EKS Optimized Windows Artifacts as well as the kubelet versions. For more information: https://docs.aws.amazon.com/eks/latest/userguide/eks-custom-ami-windows.html</p> <p></p> <p>NOTE: Prior to selecting a base image, consult the Windows Server Version and License section for important details pertaining to release channel updates.</p>"},{"location":"windows/docs/ami/#configuring-faster-launching-for-custom-eks-optimized-amis","title":"Configuring faster launching for custom EKS optimized AMIs","text":"<p>When using a custom Windows Amazon EKS optimized AMI, Windows worker nodes can be launched up to 65% faster by enabling the Fast Launch feature. This feature maintains a set of pre-provisioned snapshots which have the Sysprep specialize, Windows Out of Box Experience (OOBE) steps and required reboots already completed. These snapshots are then used on subsequent launches, reducing the time to scale-out or replace nodes. Fast Launch can be only enabled for AMIs you own through the EC2 console or in the AWS CLI and the number of snapshots maintained is configurable. </p> <p>NOTE: Fast Launch is not compatible with the default Amazon-provided EKS optimized AMI, create a custom AMI as above before attempting to enable it. </p> <p>For more information: AWS Windows AMIs - Configure your AMI for faster launching</p>"},{"location":"windows/docs/ami/#caching-windows-base-layers-on-custom-amis","title":"Caching Windows base layers on custom AMIs","text":"<p>Windows container images are larger than their Linux counterparts. If you are running any containerized .NET Framework-based application, the average image size is around 8.24GB. During pod scheduling, the container image must be fully pulled and extracted in the disk before the pod reaches Running status.</p> <p>During this process, the container runtime (containerd) pulls and extracts the entire container image in the disk. The pull operation is a parallel process, meaning the container runtime pulls the container image layers in parallel. In contrast, the extraction operation occurs in a sequential process, and it is I/O intensive. Due to that, the container image can take more than 8 minutes to be fully extracted and ready to be used by the container runtime (containerd), and as a result, the pod startup time can take several minutes.</p> <p>As mentioned in the Patching Windows Server and Container topic, there is an option to build a custom AMI with EKS. During the AMI preparation, you can add an additional EC2 Image builder component to pull all the necessary Windows container images locally and then generate the AMI. This strategy will drastically reduce the time a pod reaches the status Running. </p> <p>On Amazon EC2 Image Builder, create a component to download the necessary images and attach it to the Image recipe. The following example pulls a specific image from a ECR repository. </p> <pre><code>name: ContainerdPull\ndescription: This component pulls the necessary containers images for a cache strategy.\nschemaVersion: 1.0\n\nphases:\n  - name: build\n    steps:\n      - name: containerdpull\n        action: ExecutePowerShell\n        inputs:\n          commands:\n            - Set-ExecutionPolicy Unrestricted -Force\n            - (Get-ECRLoginCommand).Password | docker login --username AWS --password-stdin 111000111000.dkr.ecr.us-east-1.amazonaws.com\n            - ctr image pull mcr.microsoft.com/dotnet/framework/aspnet:latest\n            - ctr image pull 111000111000.dkr.ecr.us-east-1.amazonaws.com/myappcontainerimage:latest\n</code></pre> <p>To make sure the following component works as expected, check if the IAM role used by EC2 Image builder (EC2InstanceProfileForImageBuilder) has the attached policies:</p> <p></p>"},{"location":"windows/docs/ami/#blog-post","title":"Blog post","text":"<p>In the following blog post, you will find a step by step on how to implement caching strategy for custom Amazon EKS Windows AMIs:</p> <p>Speeding up Windows container launch times with EC2 Image builder and image cache strategy</p>"},{"location":"windows/docs/gmsa/","title":"Configure gMSA for Windows Pods and containers","text":""},{"location":"windows/docs/gmsa/#what-is-a-gmsa-account","title":"What is a gMSA account","text":"<p>Windows-based applications such as .NET applications often use Active Directory as an identity provider, providing authorization/authentication using NTLM or Kerberos protocol. </p> <p>An application server to exchange Kerberos tickets with Active Directory requires to be domain-joined. Windows containers don\u2019t support domain joins and would not make much sense as containers are ephemeral resources, creating a burden on the Active Directory RID pool.</p> <p>However, administrators can leverage gMSA Active Directory accounts to negotiate a Windows authentication for resources such as Windows containers, NLB, and server farms.</p>"},{"location":"windows/docs/gmsa/#windows-container-and-gmsa-use-case","title":"Windows container and gMSA use case","text":"<p>Applications that leverage on Windows authentication, and run as Windows containers, benefit from gMSA because the Windows Node is used to exchange the Kerberos ticket on behalf of the container.There are two options available to setup the Windows worker node to support gMSA integration:</p>"},{"location":"windows/docs/gmsa/#1-domain-joined-windows-worker-nodes","title":"1 - Domain-joined Windows worker nodes","text":"<p>In this setup, the Windows worker node is domain-joined in the Active Directory domain, and the AD Computer account of the Windows worker nodes is used to authenticate against Active Directory and retrieve the gMSA identity to be used with the pod. </p> <p>In the domain-joined approach, you can easily manage and harden your Windows worker nodes using existing Active Directory GPOs; however, it generates additional operational overhead and delays during Windows worker node joining in the Kubernetes cluster, as it requires additional reboots during node startup and Active Directory garage cleaning after the Kubernetes cluster terminates nodes.</p> <p>In the following blog post, you will find a detailed step-by-step on how to implement the Domain-joined Windows worker node approach:</p> <p>Windows Authentication on Amazon EKS Windows pods</p>"},{"location":"windows/docs/gmsa/#2-domainless-windows-worker-nodes","title":"2 - Domainless Windows worker nodes","text":"<p>In this setup, the Windows worker node isn't joined in the Active Directory domain, and a \"portable\" identity (user/password) is used to authenticate against Active Directory and retrieve the gMSA identity to be used with the pod.</p> <p></p> <p>The portable identity is an Active Directory user; the identity (user/password) is stored on AWS Secrets Manager or AWS System Manager Parameter Store, and an AWS-developed plugin called ccg_plugin will be used to retrieve this identity from AWS Secrets Manager or AWS System Manager Parameter Store and pass it to containerd to retrieve the gMSA identity and made it available for the pod.</p> <p>In this domainless approach, you can benefit from not having any Active Directory interaction during Windows worker node startup when using gMSA and reducing the operational overhead for Active Directory administrators.</p> <p>In the following blog post, you will find a detailed step-by-step on how to implement the Domainless Windows worker node approach:</p> <p>Domainless Windows Authentication for Amazon EKS Windows pods</p>"},{"location":"windows/docs/gmsa/#important-note","title":"Important note","text":"<p>Despite the pod being able to use a gMSA account, it is necessary to also setup the application or service accordingly to support Windows authentication, for instance, in order to setup Microsoft IIS to support Windows authentication, you should prepared it via dockerfile:</p> <pre><code>RUN Install-WindowsFeature -Name Web-Windows-Auth -IncludeAllSubFeature\nRUN Import-Module WebAdministration; Set-ItemProperty 'IIS:\\AppPools\\SiteName' -name processModel.identityType -value 2\nRUN Import-Module WebAdministration; Set-WebConfigurationProperty -Filter '/system.webServer/security/authentication/anonymousAuthentication' -Name Enabled -Value False -PSPath 'IIS:\\' -Location 'SiteName'\nRUN Import-Module WebAdministration; Set-WebConfigurationProperty -Filter '/system.webServer/security/authentication/windowsAuthentication' -Name Enabled -Value True -PSPath 'IIS:\\' -Location 'SiteName'\n</code></pre>"},{"location":"windows/docs/hardening/","title":"Windows worker nodes hardening","text":"<p>OS Hardening is a combination of OS configuration, patching, and removing unnecessary software packages, which aim to lock down a system and reduce the attack surface. It is a best practice to prepare your own EKS Optimized Windows AMI with the hardening configurations required by your company. </p> <p>AWS provides a new EKS Optimized Windows AMI every month containing the latest Windows Server Security Patches. However, it is still the user's responsibility to harden their AMI by applying the necessary OS configurations regardless of whether they use self-managed or managed node groups.</p> <p>Microsoft offers a range of tools like Microsoft Security Compliance Toolkit and Security Baselines that helps you to achieve hardening based on your security policies needs. CIS Benchmarks are also available and should be implemented on top of an Amazon EKS Optimized Windows AMI for production environments.</p>"},{"location":"windows/docs/hardening/#reducing-attack-surface-with-windows-server-core","title":"Reducing attack surface with Windows Server Core","text":"<p>Windows Server Core is a minimal installation option that is available as part of the EKS Optimized Windows AMI. Deploying Windows Server Core has a couple of benefits. First, it has a relatively small disk footprint, being 6GB on Server Core against 10GB on Windows Server with Desktop experience. Second, it has a smaller attack surface because of its smaller code base and available APIs.</p> <p>AWS provides customers with new Amazon EKS Optimized Windows AMIs every month, containing the latest Microsoft security patches, regardless of the Amazon EKS-supported version. As a best practice, Windows worker nodes must be replaced with new ones based on the latest Amazon EKS-optimized AMI. Any node running for more than 45 days without an update in place or node replacement lacks security best practices.</p>"},{"location":"windows/docs/hardening/#avoiding-rdp-connections","title":"Avoiding RDP connections","text":"<p>Remote Desktop Protocol (RDP) is a connection protocol developed by Microsoft to provide users with a graphical interface to connect to another Windows computer over a network. </p> <p>As a best practice, you should treat your Windows worker nodes as if they were ephemeral hosts. That means no management connections, no updates, and no troubleshooting. Any modification and update should be implemented as a new custom AMI and replaced by updating an Auto Scaling group. See Patching Windows Servers and Containers and Amazon EKS optimized Windows AMI management.</p> <p>Disable RDP connections on Windows nodes during the deployment by passing the value false on the ssh property, as the example below:</p> <pre><code>nodeGroups:\n- name: windows-ng\n  instanceType: c5.xlarge\n  minSize: 1\n  volumeSize: 50\n  amiFamily: WindowsServer2019CoreContainer\n  ssh:\n    allow: false\n</code></pre> <p>If access to the Windows node is needed, use AWS System Manager Session Manager to establish a secure PowerShell session through the AWS Console and SSM agent. To see how to implement the solution watch Securely Access Windows Instances Using AWS Systems Manager Session Manager</p> <p>In order to use System Manager Session Manager an additional IAM policy must be applied to the IAM role used to launch the Windows worker node. Below is an example where the AmazonSSMManagedInstanceCore is specified in the <code>eksctl</code> cluster manifest:</p> <pre><code> nodeGroups:\n- name: windows-ng\n  instanceType: c5.xlarge\n  minSize: 1\n  volumeSize: 50\n  amiFamily: WindowsServer2019CoreContainer\n  ssh:\n    allow: false\n  iam:\n    attachPolicyARNs:\n      - arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy\n      - arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy\n      - arn:aws:iam::aws:policy/ElasticLoadBalancingFullAccess\n      - arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly\n      - arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore\n</code></pre>"},{"location":"windows/docs/hardening/#amazon-inspector","title":"Amazon Inspector","text":"<p>Amazon Inspector is an automated security assessment service that helps improve the security and compliance of applications deployed on AWS. Amazon Inspector automatically assesses applications for exposure, vulnerabilities, and deviations from best practices. After performing an assessment, Amazon Inspector produces a detailed list of security findings prioritized by level of severity. These findings can be reviewed directly or as part of detailed assessment reports which are available via the Amazon Inspector console or API.</p> <p>Amazon Inspector can be used to run CIS Benchmark assessment on the Windows worker node and it can be installed on a Windows Server Core by performing the following tasks:</p> <ol> <li>Download the following .exe file: https://inspector-agent.amazonaws.com/windows/installer/latest/AWSAgentInstall.exe</li> <li>Transfer the agent to the Windows worker node.</li> <li>Run the following command on PowerShell to install the Amazon Inspector Agent: <code>.\\AWSAgentInstall.exe /install</code></li> </ol> <p>Below is the ouput after the first run. As you can see, it generated findings based on the CVE database. You can use this to harden your Worker nodes or create an AMI based on the hardened configurations.</p> <p></p> <p>For more information on Amazon Inspector, including how to install Amazon Inspector agents, set up the CIS Benchmark assessment, and generate reports, watch the Improving the security and compliance of Windows Workloads with Amazon Inspector video.</p>"},{"location":"windows/docs/hardening/#amazon-guardduty","title":"Amazon GuardDuty","text":"<p>Amazon GuardDuty is a threat detection service that continuously monitors for malicious activity and unauthorized behavior to protect your AWS accounts, workloads, and data stored in Amazon S3. With the cloud, the collection and aggregation of account and network activities is simplified, but it can be time consuming for security teams to continuously analyze event log data for potential threats. </p> <p>By using Amazon GuardDuty you have visilitiby on malicious actitivy against Windows worker nodes, like RDP brute force and Port Probe attacks. </p> <p>Watch the Threat Detection for Windows Workloads using Amazon GuardDuty video to learn how to implement and run CIS Benchmarks on Optimized EKS Windows AMI</p>"},{"location":"windows/docs/hardening/#security-in-amazon-ec2-for-windows","title":"Security in Amazon EC2 for Windows","text":"<p>Read up on the Security best practices for Amazon EC2 Windows instances to implement security controls at every layer.</p>"},{"location":"windows/docs/images/","title":"Container image scanning","text":"<p>Image Scanning is an automated vulnerability assessment feature that helps improve the security of your application\u2019s container images by scanning them for a broad range of operating system vulnerabilities.</p> <p>Currently, the Amazon Elastic Container Registry (ECR) is only able to scan Linux container image for vulnerabilities. However; there are third-party tools which can be integrated with an existing CI/CD pipeline for Windows container image scanning.</p> <ul> <li>Anchore</li> <li>PaloAlto Prisma Cloud </li> <li>Trend Micro - Deep Security Smart Check</li> </ul> <p>To learn more about how to integrate these solutions with Amazon Elastic Container Repository (ECR), check:</p> <ul> <li>Anchore, scanning images on Amazon Elastic Container Registry (ECR)</li> <li>PaloAlto, scanning images on Amazon Elastic Container Registry (ECR)</li> <li>TrendMicro, scanning images on Amazon Elastic Container Registry (ECR)</li> </ul>"},{"location":"windows/docs/licensing/","title":"Windows Server version and License","text":""},{"location":"windows/docs/licensing/#windows-server-version","title":"Windows Server version","text":"<p>An Amazon EKS Optimized Windows AMI is based on Windows Server 2019 and 2022 Datacenter edition on the Long-Term Servicing Channel (LTSC). The Datacenter version doesn't have a limitation on the number of containers running on a worker node. For more information: https://docs.microsoft.com/en-us/virtualization/windowscontainers/about/faq</p>"},{"location":"windows/docs/licensing/#long-term-servicing-channel-ltsc","title":"Long-Term Servicing Channel (LTSC)","text":"<p>Formerly called the \"Long-Term Servicing Branch\", this is the release model you are already familiar with, where a new major version of Windows Server is released every 2-3 years. Users are entitled to 5 years of mainstream support and 5 years of extended support.</p>"},{"location":"windows/docs/licensing/#licensing","title":"Licensing","text":"<p>When launching an Amazon EC2 instance with a Windows Server-based AMI, Amazon covers licensing costs and license compliance for you. </p>"},{"location":"windows/docs/logging/","title":"Logging","text":"<p>Containerized applications typically direct application logs to STDOUT. The container runtime traps these logs and does something with them - typically writes to a file. Where these files are stored depends on the container runtime and configuration. </p> <p>One fundamental difference with Windows pods is they do not generate STDOUT. You can run LogMonitor to retrieve the ETW (Event Tracing for Windows), Windows Event Logs and other application specific logs from running Windows containers and pipes formatted log output to STDOUT. These logs can then be streamed using fluent-bit or fluentd to your desired destination such as Amazon CloudWatch.</p> <p>The Log collection mechanism retrieves STDOUT/STDERR logs from Kubernetes pods. A DaemonSet is a common way to collect logs from containers. It gives you the ability to manage log routing/filtering/enrichment independently of the application. A fluentd DaemonSet can be used to stream these logs and any other application generated logs to a desired log aggregator.</p> <p>More detailed information about log streaming from Windows workloads to CloudWatch is explained here </p>"},{"location":"windows/docs/logging/#logging-recomendations","title":"Logging Recomendations","text":"<p>The general logging best practices are no different when operating Windows workloads in Kubernetes. </p> <ul> <li>Always log structured log entries (JSON/SYSLOG) which makes handling log entries easier as there are many pre-written parsers for such structured formats.</li> <li>Centralize logs - dedicated logging containers can be used specifically to gather and forward log messages from all containers to a destination</li> <li>Keep log verbosity down except when debugging. Verbosity places a lot of stress on the logging infrastructure and significant events can be lost in the noise.</li> <li> <p>Always log the application information along with transaction/request id for traceability. Kubernetes objects do-not carry the application name, so for example a pod name <code>windows-twryrqyw</code> may not carry any meaning when debugging logs. This helps with traceability and troubleshooting applications with your aggregated logs.</p> <p>How you generate these transaction/correlation id's depends on the programming construct. But a very common pattern is to use a logging Aspect/Interceptor, which can use MDC (Mapped diagnostic context) to inject a unique transaction/correlation id to every incoming request, like so: </p> </li> </ul> <pre><code>import org.slf4j.MDC;\nimport java.util.UUID;\nClass LoggingAspect { //interceptor\n\n    @Before(value = \"execution(* *.*(..))\")\n    func before(...) {\n        transactionId = generateTransactionId();\n        MDC.put(CORRELATION_ID, transactionId);\n    }\n\n    func generateTransactionId() {\n        return UUID.randomUUID().toString();\n    }\n}\n</code></pre>"},{"location":"windows/docs/monitoring/","title":"Monitoring","text":"<p>Prometheus, a graduated CNCF project is by far the most popular monitoring system with native integration into Kubernetes. Prometheus collects metrics around containers, pods, nodes, and clusters. Additionally, Prometheus leverages AlertsManager which lets you program alerts to warn you if something in your cluster is going wrong. Prometheus stores the metric data as a time series data identified by metric name and key/value pairs. Prometheus includes away to query using a language called PromQL, which is short for Prometheus Query Language. </p> <p>The high level architecture of Prometheus metrics collection is shown below:</p> <p></p> <p>Prometheus uses a pull mechanism and scrapes metrics from targets using exporters and from the Kubernetes API using the kube state metrics. This means applications and services must expose a HTTP(S) endpoint containing Prometheus formatted metrics. Prometheus will then, as per its configuration, periodically pull metrics from these HTTP(S) endpoints.</p> <p>An exporter lets you consume third party metrics as Prometheus formatted metrics. A Prometheus exporter is typically deployed on each node. For a complete list of exporters please refer to the Prometheus exporters. While node exporter is suited for exporting host hardware and OS metrics for linux nodes, it wont work for Windows nodes. </p> <p>In a mixed node EKS cluster with Windows nodes when you use the stable Prometheus helm chart, you will see failed pods on the Windows nodes, as this exporter is not intended for Windows. You will need to treat the Windows worker pool separate and instead install the Windows exporter on the Windows worker node group. </p> <p>In order to setup Prometheus monitoring for Windows nodes, you need to download and install the WMI exporter on the Windows server itself and then setup the targets inside the scrape configuration of the Prometheus configuration file. The releases page provides all available .msi installers, with respective feature sets and bug fixes. The installer will setup the windows_exporter as a Windows service, as well as create an exception in the Windows firewall. If the installer is run without any parameters, the exporter will run with default settings for enabled collectors, ports, etc.</p> <p>You can check out the scheduling best practices section of this guide which suggests the use of taints/tolerations or RuntimeClass to selectively deploy node exporter only to linux nodes, while the Windows exporter is installed on Windows nodes as you bootstrap the node or using a configuration management tool of your choice (example chef, Ansible, SSM etc).</p> <p>Note that, unlike the linux nodes where the node exporter is installed as a daemonset , on Windows nodes the WMI exporter is installed on the host itself. The exporter will export metrics such as the CPU usage, the memory and the disk I/O usage and can also be used to monitor IIS sites and applications, the network interfaces and services. </p> <p>The windows_exporter will expose all metrics from enabled collectors by default. This is the recommended way to collect metrics to avoid errors. However, for advanced use the windows_exporter can be passed an optional list of collectors to filter metrics. The collect[] parameter, in the Prometheus configuration lets you do that.</p> <p>The default install steps for Windows include downloading and starting the exporter as a service during the bootstrapping process with arguments, such as the collectors you want to filter.</p> <pre><code>&gt; Powershell Invoke-WebRequest https://github.com/prometheus-community/windows_exporter/releases/download/v0.13.0/windows_exporter-0.13.0-amd64.msi -OutFile &lt;DOWNLOADPATH&gt; \n\n&gt; msiexec /i &lt;DOWNLOADPATH&gt; ENABLED_COLLECTORS=\"cpu,cs,logical_disk,net,os,system,container,memory\"\n</code></pre> <p>By default, the metrics can be scraped at the /metrics endpoint on port 9182. At this point, Prometheus can consume the metrics by adding the following scrape_config to the Prometheus configuration </p> <pre><code>scrape_configs:\n    - job_name: \"prometheus\"\n      static_configs: \n        - targets: ['localhost:9090']\n    ...\n    - job_name: \"wmi_exporter\"\n      scrape_interval: 10s\n      static_configs: \n        - targets: ['&lt;windows-node1-ip&gt;:9182', '&lt;windows-node2-ip&gt;:9182', ...]\n</code></pre> <p>Prometheus configuration is reloaded using </p> <pre><code>&gt; ps aux | grep prometheus\n&gt; kill HUP &lt;PID&gt; \n</code></pre> <p>A better and recommended way to add targets is to use a  Custom Resource Definition called ServiceMonitor, which comes as part of the Prometheus operator] that provides the definition for a ServiceMonitor Object and a controller that will activate the ServiceMonitors we define and automatically build the required Prometheus configuration. </p> <p>The ServiceMonitor, which declaratively specifies how groups of Kubernetes services should be monitored, is used to define an application you wish to scrape metrics from within Kubernetes. Within the ServiceMonitor we specify the Kubernetes labels that the operator can use to identify the Kubernetes Service which in turn identifies the Pods, that we wish to monitor. </p> <p>In order to leverage the ServiceMonitor, create an Endpoint object pointing to specific Windows targets, a headless service and a ServiceMontor for the Windows nodes.</p> <pre><code>apiVersion: v1\nkind: Endpoints\nmetadata:\n  labels:\n    k8s-app: wmiexporter\n  name: wmiexporter\n  namespace: kube-system\nsubsets:\n- addresses:\n  - ip: NODE-ONE-IP\n    targetRef:\n      kind: Node\n      name: NODE-ONE-NAME\n  - ip: NODE-TWO-IP\n    targetRef:\n      kind: Node\n      name: NODE-TWO-NAME\n  - ip: NODE-THREE-IP\n    targetRef:\n      kind: Node\n      name: NODE-THREE-NAME\n  ports:\n  - name: http-metrics\n    port: 9182\n    protocol: TCP\n\n---\napiVersion: v1\nkind: Service ##Headless Service\nmetadata:\n  labels:\n    k8s-app: wmiexporter\n  name: wmiexporter\n  namespace: kube-system\nspec:\n  clusterIP: None\n  ports:\n  - name: http-metrics\n    port: 9182\n    protocol: TCP\n    targetPort: 9182\n  sessionAffinity: None\n  type: ClusterIP\n\n---\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor ##Custom ServiceMonitor Object\nmetadata:\n  labels:\n    k8s-app: wmiexporter\n  name: wmiexporter\n  namespace: monitoring\nspec:\n  endpoints:\n  - interval: 30s\n    port: http-metrics\n  jobLabel: k8s-app\n  namespaceSelector:\n    matchNames:\n    - kube-system\n  selector:\n    matchLabels:\n      k8s-app: wmiexporter\n</code></pre> <p>For more details on the operator and the usage of ServiceMonitor, checkout the official operator documentation. Note that Prometheus does support dynamic target discovery using many service discovery options.</p>"},{"location":"windows/docs/networking/","title":"Windows Networking","text":""},{"location":"windows/docs/networking/#windows-container-networking-overview","title":"Windows Container Networking Overview","text":"<p>Windows containers are fundamentally different than Linux containers. Linux containers use Linux constructs like namespaces, the union file system, and cgroups. On Windows, those constructs are abstracted from containerd by the Host Compute Service (HCS). HCS acts as an API layer that sits above the container implementation on Windows. Windows containers also leverage the Host Network Service (HNS) that defines the network topology on a node. </p> <p></p> <p>From a networking perspective, HCS and HNS make Windows containers function like virtual machines. For example, each container has a virtual network adapter (vNIC) that is connected to a Hyper-V virtual switch (vSwitch) as shown in the diagram above.</p>"},{"location":"windows/docs/networking/#ip-address-management","title":"IP Address Management","text":"<p>A node in Amazon EKS uses it's Elastic Network Interface (ENI) to connect to an AWS VPC network. Presently, only a single ENI per Windows worker node is supported. The IP address management for Windows nodes is performed by VPC Resource Controller which runs in control plane. More details about the workflow for IP address management of Windows nodes can be found here.</p> <p>The number of pods that a Windows worker node can support is dictated by the size of the node and the number of available IPv4 addresses. You can calculate the IPv4 address available on the node as below: - By default, only secondary IPv4 addresses are assigned to the ENI. In such a case:   <pre><code>Total IPv4 addresses available for Pods = Number of supported IPv4 addresses in the primary interface - 1\n</code></pre>   We subtract one from the total count since one IPv4 addresses will be used as the primary address of the ENI and hence cannot be allocated to the Pods.</p> <ul> <li>If the cluster has been configured for high pod density by enabling prefix delegation feature then-   <pre><code>Total IPv4 addresses available for Pods = (Number of supported IPv4 addresses in the primary interface - 1) * 16\n</code></pre>   Here, instead of allocating secondary IPv4 addresses, VPC Resource Controller will allocate <code>/28 prefixes</code> and therefore, the overall number of available IPv4 addresses will be boosted 16 times.</li> </ul> <p>Using the formula above, we can calculate max pods for an Windows worker noded based on a m5.large instance as below: - By default, when running in secondary IP mode-   <pre><code>10 secondary IPv4 addresses per ENI - 1 = 9 available IPv4 addresses\n</code></pre> - When using <code>prefix delegation</code>-   <pre><code>(10 secondary IPv4 addresses per ENI - 1) * 16 = 144 available IPv4 addresses\n</code></pre></p> <p>For more information on how many IP addresses an instance type can support, see IP addresses per network interface per instance type. </p> <p>Another key consideration is the flow of network traffic. With Windows there is a risk of port exhaustion on nodes with more than 100 services. When this condition arises, the nodes will start throwing errors with the following message:</p> <p>\"Policy creation failed: hcnCreateLoadBalancer failed in Win32: The specified port already exists.\"</p> <p>To address this issue, we leverage Direct Server Return (DSR). DSR is an implementation of asymmetric network load distribution. In other words, the request and response traffic use different network paths. This feature speeds up communication between pods and reduces the risk of port exhaustion. We therefore recommend enabling DSR on Windows nodes. </p> <p>DSR is enabled by default in Windows Server SAC EKS Optimized AMIs. For Windows Server 2019 LTSC EKS Optimized AMIs, you will need to enable it during instance provisioning using the script below and by using Windows Server 2019 Full or Core as the amiFamily in the <code>eksctl</code> nodeGroup. See eksctl custom AMI for additional information. </p> <p><pre><code>nodeGroups:\n- name: windows-ng\n  instanceType: c5.xlarge\n  minSize: 1\n  volumeSize: 50\n  amiFamily: WindowsServer2019CoreContainer\n  ssh:\n    allow: false\n</code></pre> In order to utilize DSR in Windows Server 2019 and above, you will need to specify the following kube-proxy flags during instance startup.  You can do this by adjusting the userdata script associated with the self-managed node groups Launch Template.</p> <pre><code>&lt;powershell&gt;\n[string]$EKSBinDir = \"$env:ProgramFiles\\Amazon\\EKS\"\n[string]$EKSBootstrapScriptName = 'Start-EKSBootstrap.ps1'\n[string]$EKSBootstrapScriptFile = \"$EKSBinDir\\$EKSBootstrapScriptName\"\n(Get-Content $EKSBootstrapScriptFile).replace('\"--proxy-mode=kernelspace\",', '\"--proxy-mode=kernelspace\", \"--feature-gates WinDSR=true\", \"--enable-dsr\",') | Set-Content $EKSBootstrapScriptFile \n&amp; $EKSBootstrapScriptFile -EKSClusterName \"eks-windows\" -APIServerEndpoint \"https://&lt;REPLACE-EKS-CLUSTER-CONFIG-API-SERVER&gt;\" -Base64ClusterCA \"&lt;REPLACE-EKSCLUSTER-CONFIG-DETAILS-CA&gt;\" -DNSClusterIP \"172.20.0.10\" -KubeletExtraArgs \"--node-labels=alpha.eksctl.io/cluster-name=eks-windows,alpha.eksctl.io/nodegroup-name=windows-ng-ltsc2019 --register-with-taints=\" 3&gt;&amp;1 4&gt;&amp;1 5&gt;&amp;1 6&gt;&amp;1\n&lt;/powershell&gt;\n</code></pre> <p>DSR enablement can be verified following the instructions in the Microsoft Networking blog and the Windows Containers on AWS Lab.</p> <p></p>"},{"location":"windows/docs/networking/#container-network-interface-cni-options","title":"Container Network Interface (CNI) options","text":"<p>The AWSVPC CNI is the de facto CNI plugin for Windows and Linux worker nodes. While the AWSVPC CNI satisfies the needs of many customers, still there may be times when you need to consider alternatives like an overlay network to avoid IP exhaustion. In these cases, the Calico CNI can be used in place of the AWSVPC CNI. Project Calico is open source software that was developed by Tigera. That software includes a CNI that works with EKS. Instructions for installing Calico CNI in EKS can be found on the Project Calico EKS installation page.</p>"},{"location":"windows/docs/networking/#network-polices","title":"Network Polices","text":"<p>It is considered a best practice to change from the default mode of open communication between pods on your Kubernetes cluster to limiting access based on network polices. The open source Project Calico has strong support for network polices that work with both Linux and Windows nodes. This feature is separate and not dependent on using the Calico CNI. We therefore recommend installing Calico and using it for network policy management. </p> <p>Instructions for installing Calico in EKS can be found on the Installing Calico on Amazon EKS page.</p> <p>In addition, the advice provided in the Amazon EKS Best Practices Guide for Security - Network Section applies equally to EKS clusters with Windows worker nodes, however, some features like \"Security Groups for Pods\" are not supported by Windows at this time.</p>"},{"location":"windows/docs/oom/","title":"Avoiding OOM errors","text":"<p>Windows does not have an out-of-memory process killer as Linux does. Windows always treats all user-mode memory allocations as virtual, and pagefiles are mandatory. The net effect is that Windows won't reach out of memory conditions the same way Linux does. Processes will page to disk instead of being subject to out of memory (OOM) termination. If memory is over-provisioned and all physical memory is exhausted, then paging can slow down performance.</p>"},{"location":"windows/docs/oom/#reserving-system-and-kubelet-memory","title":"Reserving system and kubelet memory","text":"<p>Different from Linux where <code>--kubelet-reserve</code> capture resource reservation for kubernetes system daemons like kubelet, container runtime, etc; and <code>--system-reserve</code> capture resource reservation for OS system daemons like sshd, udev and etc. On Windows these flags do not capture and set memory limits on kubelet or processes running on the node.</p> <p>However, you can combine these flags to manage NodeAllocatable to reduce Capacity on the node with Pod manifest memory resource limit to control memory allocation per pod. Using this strategy you have a better control of memory allocation as well as a mechanism to minimize out-of-memory (OOM) on Windows nodes.</p> <p>On Windows nodes, a best practice is to reserve at least 2GB of memory for the OS and process. Use <code>--kubelet-reserve</code> and/or <code>--system-reserve</code> to reduce NodeAllocatable.</p> <p>Following the Amazon EKS Self-managed Windows nodes documentation, use the CloudFormation template to launch a new Windows node group with customizations to kubelet configuration. The CloudFormation has an element called <code>BootstrapArguments</code> which is the same as <code>KubeletExtraArgs</code>. Use with the following flags and values:</p> <pre><code>--kube-reserved memory=0.5Gi,ephemeral-storage=1Gi --system-reserved memory=1.5Gi,ephemeral-storage=1Gi --eviction-hard memory.available&lt;200Mi,nodefs.available&lt;10%\"\n</code></pre> <p>If eksctl is the deployment tool, check the following documentation to customize the kubelet configuration https://eksctl.io/usage/customizing-the-kubelet/</p>"},{"location":"windows/docs/oom/#windows-container-memory-requirements","title":"Windows container memory requirements","text":"<p>As per Microsoft documentation, a Windows Server base image for NANO requires at least 30MB, whereas Server Core requires 45MB. These numbers grow as you add Windows components such as the .NET Framework, Web Services as IIS and applications.</p> <p>It is essential for you to know the minimum amount of memory required by your Windows container image, i.e. the base image plus its application layers, and set it as the container's resources/requests in the pod specification. You should also set a limit to avoid pods to consume all the available node memory in case of an application issue.</p> <p>In the example below, when the Kubernetes scheduler tries to place a pod on a node, the pod's requests are used to determine which node has sufficient resources available for scheduling.</p> <pre><code> spec:\n  - name: iis\n    image: mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2019\n    resources:\n      limits:\n        cpu: 1\n        memory: 800Mi\n      requests:\n        cpu: .1\n        memory: 128Mi\n</code></pre>"},{"location":"windows/docs/oom/#conclusion","title":"Conclusion","text":"<p>Using this approach minimizes the risks of memory exhaustion but does not prevent it happen. Using Amazon CloudWatch Metrics, you can set up alerts and remediations in case of memory exhaustion occurs.</p>"},{"location":"windows/docs/patching/","title":"Patching Windows Servers and Containers","text":"<p>Patching Windows Server is a standard management task for Windows Administrators. This can be accomplished using different tools like Amazon System Manager - Patch Manager, WSUS, System Center Configuration Manager, and many others. However, Windows nodes in an Amazon EKS cluster should not be treated as an ordinary Windows servers. They should be treated as an immutable server. Simply put, avoid updating an existing node, just launch a new one based on an new updated AMI.</p> <p>Using EC2 Image Builder you can automate AMIs build, by creating recipes and adding components.</p> <p>The following example shows components, which can be pre-existing ones built by AWS (Amazon-managed) as well as the components you create (Owned by me). Pay close attention to the Amazon-managed component called update-windows, this updates Windows Server before generating the AMI through the EC2 Image Builder pipeline.</p> <p></p> <p>EC2 Image Builder allows you to build AMI's based off Amazon Managed Public AMIs and customize them to meet your business requirements. You can then associate those AMIs with Launch Templates which allows you to link a new AMI to the Auto Scaling Group created by the EKS Nodegroup. After that is complete, you can begin terminating the existing Windows Nodes and new ones will be launched based on the new updated AMI.</p>"},{"location":"windows/docs/patching/#pushing-and-pulling-windows-images","title":"Pushing and pulling Windows images","text":"<p>Amazon publishes EKS optimized AMIs that include two cached Windows container images.  </p> <pre><code>mcr.microsoft.com/windows/servercore\nmcr.microsoft.com/windows/nanoserver\n</code></pre> <p></p> <p>Cached images are updated following the updates on the main OS. When Microsoft releases a new Windows update that directly affects the Windows container base image, the update will be launched as an ordinary Windows Update on the main OS. Keeping the environment up-to-date offers a more secure environment at the Node and Container level.</p> <p>The size of a Windows container image influences push/pull operations which can lead to slow container startup times. Caching Windows container images allows the expensive I/O operations (file extraction) to occur on the AMI build creation instead of the container launch. As a result, all the necessary image layers will be extracted on the AMI and will be ready to be used, speeding up the time a Windows container launches and can start accepting traffic. During a push operation, only the layers that compose your image are uploaded to the repository.</p> <p>The following example shows that on the Amazon ECR the fluentd-windows-sac2004 images have only 390.18MB. This is the amount of upload that happened during the push operation.</p> <p>The following example shows a fluentd Windows ltsc image pushed to an Amazon ECR repository.  The size of the layer stored in ECR is 533.05MB.</p> <p></p> <p>The output below from <code>docker image ls</code> , the size of the fluentd v1.14-windows-ltsc2019-1 is 6.96GB on disk, but that doesn't mean it downloaded and extracted that amount of data.</p> <p>In practice, during the pull operation only the compressed 533.05MB will be downloaded and extracted.</p> <pre><code>REPOSITORY                                                              TAG                        IMAGE ID       CREATED         SIZE\n111122223333.dkr.ecr.us-east-1.amazonaws.com/fluentd-windows-coreltsc   latest                     721afca2c725   7 weeks ago     6.96GB\nfluent/fluentd                                                          v1.14-windows-ltsc2019-1   721afca2c725   7 weeks ago     6.96GB\namazonaws.com/eks/pause-windows                                         latest                     6392f69ae6e7   10 months ago   255MB\n</code></pre> <p>The size column shows the overall size of image, 6.96GB. Breaking it down:</p> <ul> <li>Windows Server Core 2019 LTSC Base image = 5.74GB</li> <li>Fluentd Uncompressed Base Image = 6.96GB</li> <li>Difference on disk = 1.2GB</li> <li>Fluentd compressed final image ECR = 533.05MB</li> </ul> <p>The base image already exists on the local disk, resulting in the total amount on disk being 1.2GB additional. The next time you see the amount of GBs in the size column, don't worry too much, likely more than 70% is already on disk as a cached container image. </p>"},{"location":"windows/docs/patching/#reference","title":"Reference","text":"<p>Speeding up Windows container launch times with EC2 Image builder and image cache strategy</p>"},{"location":"windows/docs/scheduling/","title":"Running Heterogeneous workloads\u00b6","text":"<p>Kubernetes has support for heterogeneous clusters where you can have a mixture of Linux and Windows nodes in the same cluster. Within that cluster, you can have a mixture of Pods that run on Linux and Pods that run on Windows. You can even run multiple versions of Windows in the same cluster. However, there are several factors (as mentioned below) that will need to be accounted for when making this decision.</p>"},{"location":"windows/docs/scheduling/#assigning-pods-to-nodes-best-practices","title":"Assigning PODs to Nodes Best practices","text":"<p>In order to keep Linux and Windows workloads on their respective OS-specific nodes, you need to use some combination of node selectors and taints/tolerations. The main goal of scheduling workloads in a heterogeneous environment is to avoid breaking compatibility for existing Linux workloads.</p>"},{"location":"windows/docs/scheduling/#ensuring-os-specific-workloads-land-on-the-appropriate-container-host","title":"Ensuring OS-specific workloads land on the appropriate container host","text":"<p>Users can ensure Windows containers can be scheduled on the appropriate host using nodeSelectors. All Kubernetes nodes today have the following default labels:</p> <pre><code>kubernetes.io/os = [windows|linux]\nkubernetes.io/arch = [amd64|arm64|...]\n</code></pre> <p>If a Pod specification does not include a nodeSelector like <code>\"kubernetes.io/os\": windows</code>, the Pod may be scheduled on any host, Windows or Linux. This can be problematic since a Windows container can only run on Windows and a Linux container can only run on Linux. </p> <p>In Enterprise environments, it's not uncommon to have a large number of pre-existing deployments for Linux containers, as well as an ecosystem of off-the-shelf configurations, like Helm charts. In these situations, you may be hesitant to make changes to a deployment's nodeSelectors. The alternative is to use Taints.</p> <p>For example: <code>--register-with-taints='os=windows:NoSchedule'</code></p> <p>If you are using EKS, eksctl offers ways to apply taints through clusterConfig:</p> <pre><code>NodeGroups:\n  - name: windows-ng\n    amiFamily: WindowsServer2022FullContainer\n    ...\n    labels:\n      nodeclass: windows2022\n    taints:\n      os: \"windows:NoSchedule\"\n</code></pre> <p>Adding a taint to all Windows nodes, the scheduler will not schedule pods on those nodes unless they tolerate the taint. Pod manifest example:</p> <pre><code>nodeSelector:\n    kubernetes.io/os: windows\ntolerations:\n    - key: \"os\"\n      operator: \"Equal\"\n      value: \"windows\"\n      effect: \"NoSchedule\"\n</code></pre>"},{"location":"windows/docs/scheduling/#handling-multiple-windows-build-in-the-same-cluster","title":"Handling multiple Windows build in the same cluster","text":"<p>The Windows container base image used by each pod must match the same kernel build version as the node. If you want to use multiple Windows Server builds in the same cluster, then you should set additional node labels, nodeSelectors or leverage a label called windows-build.</p> <p>Kubernetes 1.17 automatically adds a new label node.kubernetes.io/windows-build to simplify the management of multiple Windows build in the same cluster. If you're running an older version, then it's recommended to add this label manually to Windows nodes.</p> <p>This label reflects the Windows major, minor, and build number that need to match for compatibility. Below are values used today for each Windows Server version.</p> <p>It's important to note that Windows Server is moving to the Long-Term Servicing Channel (LTSC) as the primary release channel. The Windows Server Semi-Annual Channel (SAC) was retired on August 9, 2022. There will be no future SAC releases of Windows Server.</p> Product Name Build Number(s) Server full 2022 LTSC 10.0.20348 Server core 2019 LTSC 10.0.17763 <p>It is possible to check the OS build version through the following command:</p> <pre><code>kubectl get nodes -o wide\n</code></pre> <p>The KERNEL-VERSION output matches the Windows OS build version.</p> <pre><code>NAME                          STATUS   ROLES    AGE   VERSION                INTERNAL-IP   EXTERNAL-IP     OS-IMAGE                         KERNEL-VERSION                  CONTAINER-RUNTIME\nip-10-10-2-235.ec2.internal   Ready    &lt;none&gt;   23m   v1.24.7-eks-fb459a0    10.10.2.235   3.236.30.157    Windows Server 2022 Datacenter   10.0.20348.1607                 containerd://1.6.6\nip-10-10-31-27.ec2.internal   Ready    &lt;none&gt;   23m   v1.24.7-eks-fb459a0    10.10.31.27   44.204.218.24   Windows Server 2019 Datacenter   10.0.17763.4131                 containerd://1.6.6\nip-10-10-7-54.ec2.internal    Ready    &lt;none&gt;   31m   v1.24.11-eks-a59e1f0   10.10.7.54    3.227.8.172     Amazon Linux 2                   5.10.173-154.642.amzn2.x86_64   containerd://1.6.19\n</code></pre> <p>The example below applies an additional nodeSelector to the pod manifest in order to match the correct Windows-build version when running different Windows node groups OS versions.</p> <pre><code>nodeSelector:\n    kubernetes.io/os: windows\n    node.kubernetes.io/windows-build: '10.0.20348'\ntolerations:\n    - key: \"os\"\n    operator: \"Equal\"\n    value: \"windows\"\n    effect: \"NoSchedule\"\n</code></pre>"},{"location":"windows/docs/scheduling/#simplifying-nodeselector-and-toleration-in-pod-manifests-using-runtimeclass","title":"Simplifying NodeSelector and Toleration in Pod manifests using RuntimeClass","text":"<p>You can also make use of RuntimeClass to simplify the process of using taints and tolerations. This can be accomplished by creating a RuntimeClass object which is used to encapsulate these taints and tolerations.</p> <p>Create a RuntimeClass by running the following manifest:</p> <pre><code>apiVersion: node.k8s.io/v1beta1\nkind: RuntimeClass\nmetadata:\n  name: windows-2022\nhandler: 'docker'\nscheduling:\n  nodeSelector:\n    kubernetes.io/os: 'windows'\n    kubernetes.io/arch: 'amd64'\n    node.kubernetes.io/windows-build: '10.0.20348'\n  tolerations:\n  - effect: NoSchedule\n    key: os\n    operator: Equal\n    value: \"windows\"\n</code></pre> <p>Once the Runtimeclass is created, assign it using as a Spec on the Pod manifest:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: iis-2022\n  labels:\n    app: iis-2022\nspec:\n  replicas: 1\n  template:\n    metadata:\n      name: iis-2022\n      labels:\n        app: iis-2022\n    spec:\n      runtimeClassName: windows-2022\n      containers:\n      - name: iis\n</code></pre>"},{"location":"windows/docs/scheduling/#managed-node-group-support","title":"Managed Node Group Support","text":"<p>To help customers run their Windows applications in a more streamlined manner, AWS launched the support for Amazon EKS Managed Node Group (MNG) support for Windows containers on December 15, 2022. To help align operations teams, Windows MNGs are enabled using the same workflows and tools as Linux MNGs. Full and core AMI (Amazon Machine Image) family versions of Windows Server 2019 and 2022 are supported. </p> <p>Following AMI families are supported for Managed Node Groups(MNG)s.</p> AMI Family WINDOWS_CORE_2019_x86_64 WINDOWS_FULL_2019_x86_64 WINDOWS_CORE_2022_x86_64 WINDOWS_FULL_2022_x86_64"},{"location":"windows/docs/scheduling/#additional-documentations","title":"Additional documentations","text":"<p>AWS Official Documentation: https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html</p> <p>To better understand how Pod Networking (CNI) works, check the following link: https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html</p> <p>AWS Blog on Deploying Managed Node Group for Windows on EKS: https://aws.amazon.com/blogs/containers/deploying-amazon-eks-windows-managed-node-groups/</p>"},{"location":"windows/docs/security/","title":"Pod Security Contexts","text":"<p>Pod Security Policies (PSP) and Pod Security Standards (PSS) are two main ways of enforcing security in Kubernetes. Note that PodSecurityPolicy is deprecated as of Kubernetes v1.21, and will be removed in v1.25 and Pod Security Standard (PSS) is the Kubernetes recommended approach for enforcing security going forward.</p> <p>A Pod Security Policy (PSP) is a native solution in Kubernetes to implement security policies. PSP is a cluster-level resource that controls security-sensitive aspects of the Pod specification. Using Pod Security Policy you can define a set of conditions that Pods must meet to be accepted by the cluster. The PSP feature has been available from the early days of Kubernetes and is designed to block misconfigured pods from being created on a given cluster.</p> <p>For more information on Pod Security Policies please reference the Kubernetes documentation. According to the Kubernetes deprecation policy, older versions will stop getting support nine months after the deprecation of the feature.</p> <p>On the other hand, Pod Security Standards (PSS) which is the recommended security approach and typically implemented using Security Contexts are defined as part of the Pod and container specifications in the Pod manifest. PSS is the official standard that the Kubernetes project team has defined to address the security-related best practices for Pods. It defines policies such as baseline (minimally restrictive, default), privileged (unrestrictive) and restricted (most restrictive).</p> <p>We recommend starting with the baseline profile. PSS baseline profile provides a solid balance between security and potential friction, requiring a minimal list of exceptions, it serves as a good starting point for workload security. If you are currently using PSPs we recommend switching to PSS. More details on the PSS policies can be found in the Kubernetes documentation. These policies can be enforced with several tools including those from OPA and Kyverno. For example, Kyverno provides the full collection of PSS policies here.</p> <p>Security context settings allow one to give privileges to select processes, use program profiles to restrict capabilities to individual programs, allow privilege escalation, filter system calls, among other things.</p> <p>Windows pods in Kubernetes have some limitations and differentiators from standard Linux-based workloads when it comes to security contexts.</p> <p>Windows uses a Job object per container with a system namespace filter to contain all processes in a container and provide logical isolation from the host. There is no way to run a Windows container without the namespace filtering in place. This means that system privileges cannot be asserted in the context of the host, and thus privileged containers are not available on Windows.</p> <p>The following <code>windowsOptions</code> are the only documented Windows Security Context options while the rest are general Security Context options</p> <p>For a list of security context attributes that are supported in Windows vs linux, please refer to the official documentation here.</p> <p>The Pod specific settings are applied to all containers. If unspecified, the options from the PodSecurityContext will be used. If set in both SecurityContext and PodSecurityContext, the value specified in SecurityContext takes precedence.</p> <p>For example, runAsUserName setting for Pods and containers which is a Windows option is a rough equivalent of the Linux-specific runAsUser setting and in the following manifest, the pod specific security context is applied to all containers</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: run-as-username-pod-demo\nspec:\n  securityContext:\n    windowsOptions:\n      runAsUserName: \"ContainerUser\"\n  containers:\n  - name: run-as-username-demo\n    ...\n  nodeSelector:\n    kubernetes.io/os: windows\n</code></pre> <p>Whereas in the following, the container level security context overrides the pod level security context.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: run-as-username-container-demo\nspec:\n  securityContext:\n    windowsOptions:\n      runAsUserName: \"ContainerUser\"\n  containers:\n  - name: run-as-username-demo\n    ..\n    securityContext:\n        windowsOptions:\n            runAsUserName: \"ContainerAdministrator\"\n  nodeSelector:\n    kubernetes.io/os: windows\n</code></pre> <p>Examples of acceptable values for the runAsUserName field: ContainerAdministrator, ContainerUser, NT AUTHORITY\\NETWORK SERVICE, NT AUTHORITY\\LOCAL SERVICE</p> <p>It is generally a good idea to run your containers with ContainerUser for Windows pods. The users are not shared between the container and host but the ContainerAdministrator does have additional privileges with in the container. Note that, there are username limitations to be aware of.</p> <p>A good example of when to use ContainerAdministrator is to set PATH. You can use the USER directive to do that, like so:</p> <pre><code>USER ContainerAdministrator\nRUN setx /M PATH \"%PATH%;C:/your/path\"\nUSER ContainerUser\n</code></pre> <p>Also note that, secrets are written in clear text on the node's volume (as compared to tmpfs/in-memory on linux). This means you have to do two things</p> <ul> <li>Use file ACLs to secure the secrets file location</li> <li>Use volume-level encryption using BitLocker</li> </ul>"},{"location":"windows/docs/storage/","title":"Persistent storage options","text":""},{"location":"windows/docs/storage/#what-is-an-in-tree-vs-out-of-tree-volume-plugin","title":"What is an in-tree vs. out-of-tree volume plugin?","text":"<p>Before the introduction of the Container Storage Interface (CSI), all volume plugins were in-tree meaning they were built, linked, compiled, and shipped with the core Kubernetes binaries and extend the core Kubernetes API. This meant that adding a new storage system to Kubernetes (a volume plugin) required checking code into the core Kubernetes code repository.</p> <p>Out-of-tree volume plugins are developed independently of the Kubernetes code base, and are deployed (installed) on Kubernetes clusters as extensions. This gives vendors the ability to update drivers out-of-band, i.e. separately from the Kubernetes release cycle. This is largely possible because Kubernetes has created a storage interface or CSI that provides vendors a standard way of interfacing with k8s. </p> <p>You can check more about Amazon Elastic Kubernetes Services (EKS) storage classes and CSI Drivers on https://docs.aws.amazon.com/eks/latest/userguide/storage.html</p>"},{"location":"windows/docs/storage/#in-tree-volume-plugin-for-windows","title":"In-tree Volume Plugin for Windows","text":"<p>Kubernetes volumes enable applications, with data persistence requirements, to be deployed on Kubernetes. The management of persistent volumes consists of provisioning/de-provisioning/resizing of volumes, attaching/detaching a volume to/from a Kubernetes node, and mounting/dismounting a volume to/from individual containers in a pod. The code for implementing these volume management actions for a specific storage back-end or protocol is shipped in the form of a Kubernetes volume plugin (In-tree Volume Plugins). On Amazon Elastic Kubernetes Services (EKS) the following class of Kubernetes volume plugins are supported on Windows:</p> <p>In-tree Volume Plugin: awsElasticBlockStore</p> <p>In order to use In-tree volume plugin on Windows nodes, it is necessary to create an additional StorageClass to use NTFS as the fsType. On EKS, the default StorageClass uses ext4 as the default fsType. </p> <p>A StorageClass provides a way for administrators to describe the \"classes\" of storage they offer. Different classes might map to quality-of-service levels, backup policies, or arbitrary policies determined by the cluster administrators. Kubernetes is unopinionated about what classes represent. This concept is sometimes called \"profiles\" in other storage systems.</p> <p>You can check it by running the following command:</p> <pre><code>kubectl describe storageclass gp2\n</code></pre> <p>Output:</p> <pre><code>Name:            gp2\nIsDefaultClass:  Yes\nAnnotations:     kubectl.kubernetes.io/last-applied-configuration={\"apiVersion\":\"storage.k8s.io/v1\",\"kind\":\"StorageClas\n\",\"metadata\":{\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"},\"name\":\"gp2\"},\"parameters\":{\"fsType\"\n\"ext4\",\"type\":\"gp2\"},\"provisioner\":\"kubernetes.io/aws-ebs\",\"volumeBindingMode\":\"WaitForFirstConsumer\"}\n,storageclass.kubernetes.io/is-default-class=true\nProvisioner:           kubernetes.io/aws-ebs\nParameters:            fsType=ext4,type=gp2\nAllowVolumeExpansion:  &lt;unset&gt;\nMountOptions:          &lt;none&gt;\nReclaimPolicy:         Delete\nVolumeBindingMode:     WaitForFirstConsumer\nEvents:                &lt;none&gt;\n</code></pre> <p>To create the new StorageClass to support NTFS, use the following manifest:</p> <pre><code>kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: gp2-windows\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp2\n  fsType: ntfs\nvolumeBindingMode: WaitForFirstConsumer\n</code></pre> <p>Create the StorageClass by running the following command:</p> <pre><code>kubectl apply -f NTFSStorageClass.yaml\n</code></pre> <p>The next step is to create a Persistent Volume Claim (PVC).</p> <p>A PersistentVolume (PV) is a piece of storage in the cluster that has been provisioned by an administrator or dynamically provisioned using PVC. It is a resource in the cluster just like a node is a cluster resource. This API object captures the details of the implementation of the storage, be that NFS, iSCSI, or a cloud-provider-specific storage system.</p> <p>A PersistentVolumeClaim (PVC) is a request for storage by a user. Claims can request specific size and access modes (e.g., they can be mounted ReadWriteOnce, ReadOnlyMany or ReadWriteMany).</p> <p>Users need PersistentVolumes with different attributes, such as performance, for different use cases. Cluster administrators need to be able to offer a variety of PersistentVolumes that differ in more ways than just size and access modes, without exposing users to the details of how those volumes are implemented. For these needs, there is the StorageClass resource.</p> <p>In the example below, the PVC has been created within the namespace windows.</p> <pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: ebs-windows-pv-claim\n  namespace: windows\nspec: \n  accessModes:\n    - ReadWriteOnce\n  storageClassName: gp2-windows\n  resources: \n    requests:\n      storage: 1Gi\n</code></pre> <p>Create the PVC by running the following command:</p> <pre><code>kubectl apply -f persistent-volume-claim.yaml\n</code></pre> <p>The following manifest creates a Windows Pod, setup the VolumeMount as <code>C:\\Data</code> and uses the PVC as the attached storage on <code>C:\\Data</code>. </p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: windows-server-ltsc2019\n  namespace: windows\nspec:\n  selector:\n    matchLabels:\n      app: windows-server-ltsc2019\n      tier: backend\n      track: stable\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: windows-server-ltsc2019\n        tier: backend\n        track: stable\n    spec:\n      containers:\n      - name: windows-server-ltsc2019\n        image: mcr.microsoft.com/windows/servercore:ltsc2019\n        ports:\n        - name: http\n          containerPort: 80\n        imagePullPolicy: IfNotPresent\n        volumeMounts:\n        - mountPath: \"C:\\\\data\"\n          name: test-volume\n      volumes:\n        - name: test-volume\n          persistentVolumeClaim:\n            claimName: ebs-windows-pv-claim\n      nodeSelector:\n        kubernetes.io/os: windows\n        node.kubernetes.io/windows-build: '10.0.17763'\n</code></pre> <p>Test the results by accessing the Windows pod via PowerShell:</p> <pre><code>kubectl exec -it podname powershell -n windows\n</code></pre> <p>Inside the Windows Pod, run: <code>ls</code></p> <p>Output:</p> <pre><code>PS C:\\&gt; ls\n\n\n    Directory: C:\\\n\n\nMode                 LastWriteTime         Length Name\n----                 -------------         ------ ----\nd-----          3/8/2021   1:54 PM                data\nd-----          3/8/2021   3:37 PM                inetpub\nd-r---          1/9/2021   7:26 AM                Program Files\nd-----          1/9/2021   7:18 AM                Program Files (x86)\nd-r---          1/9/2021   7:28 AM                Users\nd-----          3/8/2021   3:36 PM                var\nd-----          3/8/2021   3:36 PM                Windows\n-a----         12/7/2019   4:20 AM           5510 License.txt\n</code></pre> <p>The data directory is provided by the EBS volume.</p>"},{"location":"windows/docs/storage/#out-of-tree-for-windows","title":"Out-of-tree for Windows","text":"<p>Code associated with CSI plugins ship as out-of-tree scripts and binaries that are typically distributed as container images and deployed using standard Kubernetes constructs like DaemonSets and StatefulSets. CSI plugins handle a wide range of volume management actions in Kubernetes. CSI plugins typically consist of node plugins (that run on each node as a DaemonSet) and controller plugins.</p> <p>CSI node plugins (especially those associated with persistent volumes exposed as either block devices or over a shared file-system) need to perform various privileged operations like scanning of disk devices, mounting of file systems, etc. These operations differ for each host operating system. For Linux worker nodes, containerized CSI node plugins are typically deployed as privileged containers. For Windows worker nodes, privileged operations for containerized CSI node plugins is supported using csi-proxy, a community-managed, stand-alone binary that needs to be pre-installed on each Windows node. </p> <p>The Amazon EKS Optimized Windows AMI includes CSI-proxy starting from April 2022. Customers can use the SMB CSI Driver on Windows nodes to access Amazon FSx for Windows File Server, Amazon FSx for NetApp ONTAP SMB Shares, and/or AWS Storage Gateway \u2013 File Gateway.</p> <p>The following blog has implementation details on how to setup SMB CSI Driver to use Amazon FSx for Windows File Server as a persistent storage for Windows Pods.</p>"},{"location":"windows/docs/storage/#amazon-fsx-for-windows-file-server","title":"Amazon FSx for Windows File Server","text":"<p>An option is to use Amazon FSx for Windows File Server through an SMB feature called SMB Global Mapping which makes it possible to mount a SMB share on the host, then pass directories on that share into a container. The container doesn't need to be configured with a specific server, share, username or password - that's all handled on the host instead. The container will work the same as if it had local storage.</p> <p>The SMB Global Mapping is transparent to the orchestrator, and it is mounted through HostPath which can imply in secure concerns.</p> <p>In the example below,  the path <code>G:\\Directory\\app-state</code> is an SMB share on the Windows Node.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-fsx\nspec:\n  containers:\n  - name: test-fsx\n    image: mcr.microsoft.com/windows/servercore:ltsc2019\n    command:\n      - powershell.exe\n      - -command\n      - \"Add-WindowsFeature Web-Server; Invoke-WebRequest -UseBasicParsing -Uri 'https://dotnetbinaries.blob.core.windows.net/servicemonitor/2.0.1.6/ServiceMonitor.exe' -OutFile 'C:\\\\ServiceMonitor.exe'; echo '&lt;html&gt;&lt;body&gt;&lt;br/&gt;&lt;br/&gt;&lt;marquee&gt;&lt;H1&gt;Hello EKS!!!&lt;H1&gt;&lt;marquee&gt;&lt;/body&gt;&lt;html&gt;' &gt; C:\\\\inetpub\\\\wwwroot\\\\default.html; C:\\\\ServiceMonitor.exe 'w3svc'; \"\n    volumeMounts:\n      - mountPath: C:\\dotnetapp\\app-state\n        name: test-mount\n  volumes:\n    - name: test-mount\n      hostPath: \n        path: G:\\Directory\\app-state\n        type: Directory\n  nodeSelector:\n      beta.kubernetes.io/os: windows\n      beta.kubernetes.io/arch: amd64\n</code></pre> <p>The following blog has implementation details on how to setup Amazon FSx for Windows File Server as a persistent storage for Windows Pods. </p>"},{"location":"ko/","title":"\uc18c\uac1c","text":"<p>EKS \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc\uc5d0 \uc624\uc2e0 \uac83\uc744 \ud658\uc601\ud569\ub2c8\ub2e4. \uc774 \ud504\ub85c\uc81d\ud2b8\uc758 \uc8fc\uc694 \ubaa9\ud45c\ub294 Amazon EKS\uc758 Day 2 \uc791\uc5c5\uc5d0 \ub300\ud55c \uc77c\ub828\uc758 \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc81c\uacf5\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc6b0\ub9ac\ub294 \uc774 \uc9c0\uce68\uc744 GitHub\uc5d0 \uac8c\uc2dc\ud558\uae30\ub85c \uacb0\uc815\ud558\uc5ec \uc2e0\uc18d\ud558\uac8c \ubc18\ubcf5\ud558\uace0, \ub2e4\uc591\ud55c \ubb38\uc81c\uc5d0 \ub300\ud574 \uc2dc\uae30 \uc801\uc808\ud558\uace0 \ud6a8\uacfc\uc801\uc778 \uad8c\uc7a5 \uc0ac\ud56d\uc744 \uc81c\uacf5\ud558\uace0, \ub354 \uad11\ubc94\uc704\ud55c \ucee4\ubba4\ub2c8\ud2f0\uc758 \uc81c\uc548\uc744 \uc27d\uac8c \ud1b5\ud569\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud604\uc7ac \ub2e4\uc74c \uc8fc\uc81c\uc5d0 \ub300\ud55c \uac00\uc774\ub4dc\ub97c \uac8c\uc2dc\ud588\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840</li> <li>\uc2e0\ub8b0\uc131 \ubaa8\ubc94 \uc0ac\ub840</li> <li>\ud074\ub7ec\uc2a4\ud130 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1 \ubaa8\ubc94 \uc0ac\ub840: karpenter, cluster-autoscaler</li> <li>Windows \ucee8\ud14c\uc774\ub108 \uc2e4\ud589 \ubaa8\ubc94 \uc0ac\ub840</li> <li>\ub124\ud2b8\uc6cc\ud0b9 \ubaa8\ubc94 \uc0ac\ub840</li> <li>\ud655\uc7a5\uc131 \ubaa8\ubc94 \uc0ac\ub840</li> <li>\ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc \ubaa8\ubc94 \uc0ac\ub840</li> <li>\ube44\uc6a9 \ucd5c\uc801\ud654 \ubaa8\ubc94 \uc0ac\ub840</li> </ul> <p>\ub610\ud55c \uc774 \uac00\uc774\ub4dc\uc758 \uad8c\uc7a5 \uc0ac\ud56d \uc911 \uc77c\ubd80\ub97c \ud655\uc778\ud558\uae30 \uc704\ud574 hardeneks\ub77c\ub294 Python \uae30\ubc18 CLI(Command Line Interface)\ub97c \uc624\ud508 \uc18c\uc2a4\ub85c \uc81c\uacf5\ud588\uc2b5\ub2c8\ub2e4.</p> <p>\ud5a5\ud6c4 \uc131\ub2a5, \ube44\uc6a9 \ucd5c\uc801\ud654 \ubc0f \uc6b4\uc601 \uc6b0\uc218\uc131\uc5d0 \ub300\ud55c \ubaa8\ubc94 \uc0ac\ub840 \uc9c0\uce68\uc744 \uac8c\uc2dc\ud560 \uc608\uc815\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/#_2","title":"\uad00\ub828 \uac00\uc774\ub4dc","text":"<p>AWS\ub294 EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\uc678\uc5d0\ub3c4 EKS \uad6c\uc131\uc5d0 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \ub2e4\ub978 \uac00\uc774\ub4dc\ub97c \uac8c\uc2dc\ud588\uc2b5\ub2c8\ub2e4.</p> <ul> <li>EMR \ucee8\ud14c\uc774\ub108 \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc</li> <li>Data on EKS</li> <li>AWS \uc635\uc800\ubc84\ube4c\ub9ac\ud2f0 \ubaa8\ubc94 \uc0ac\ub840</li> <li>Amazon EKS Blueprints for Terraform</li> <li>Amazon EKS Blueprints Quick Start</li> </ul>"},{"location":"ko/#_3","title":"\uae30\uc5ec","text":"<p>\uc774 \uac00\uc774\ub4dc\uc5d0 \uae30\uc5ec\ud574 \uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4. \ud6a8\uacfc\uac00 \uc785\uc99d\ub41c \ubc29\ubc95\uc744 \uad6c\ud604\ud588\ub2e4\uba74 \uc774\uc288\ub098 \ud480 \ub9ac\ud018\uc2a4\ud2b8(PR)\ub97c \uc5f4\uc5b4 \uacf5\uc720\ud574 \uc8fc\uc138\uc694.\ub9c8\ucc2c\uac00\uc9c0\ub85c, \uc774\ubbf8 \uac8c\uc2dc\ud55c \uc9c0\uce68\uc5d0\uc11c \uc624\ub958\ub098 \uacb0\ud568\uc744 \ubc1c\uacac\ud55c \uacbd\uc6b0 PR\uc744 \uc81c\ucd9c\ud558\uc5ec \uc218\uc815\ud558\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4. PR \uc81c\ucd9c \uc9c0\uce68\uc740 \uae30\uc5ec \uac00\uc774\ub4dc\ub77c\uc778\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/index/","title":"\ub124\ud2b8\uc6cc\ud06c\ub97c \uc704\ud55c Amazon EKS \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc","text":"<p>\ud074\ub7ec\uc2a4\ud130\uc640 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud6a8\uc728\uc801\uc73c\ub85c \uc6b4\uc601\ud558\ub824\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud0b9\ub97c \uc774\ud574\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \ub124\ud2b8\uc6cc\ud0b9\uc774\ub77c\uace0\ub3c4 \ud558\ub294 \ud30c\ub4dc \ub124\ud2b8\uc6cc\ud0b9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud0b9\uc758 \uc911\uc2ec\uc785\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud074\ub7ec\uc2a4\ud130 \ub124\ud2b8\uc6cc\ud0b9\uc744 \uc704\ud55c \ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4(CNI) \ud50c\ub7ec\uadf8\uc778\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. </p> <p>Amazon EKS\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc \ub124\ud2b8\uc6cc\ud0b9\uc744 \uad6c\ud604\ud558\ub294 Amazon Virtual Private Cloud(VPC) CNI \ud50c\ub7ec\uadf8\uc778\uc744 \uacf5\uc2dd\uc801\uc73c\ub85c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. VPC CNI\ub294 AWS VPC\uc640\uc758 \ub124\uc774\ud2f0\ube0c \ud1b5\ud569\uc744 \uc81c\uacf5\ud558\uba70 \uc5b8\ub354\ub808\uc774(underlay) \ubaa8\ub4dc\uc5d0\uc11c \uc791\ub3d9\ud569\ub2c8\ub2e4. \uc5b8\ub354\ub808\uc774 \ubaa8\ub4dc\uc5d0\uc11c\ub294 \ud30c\ub4dc\uc640 \ud638\uc2a4\ud2b8\uac00 \ub3d9\uc77c\ud55c \ub124\ud2b8\uc6cc\ud06c \uacc4\uce35\uc5d0 \uc704\uce58\ud558\uba70 \ub124\ud2b8\uc6cc\ud06c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uacf5\uc720\ud569\ub2c8\ub2e4. \ud30c\ub4dc\uc758 IP \uc8fc\uc18c\ub294 \ud074\ub7ec\uc2a4\ud130 \ubc0f VPC \uad00\uc810\uc5d0\uc11c \uc77c\uad00\ub418\uac8c \uad6c\uc131\ub429\ub2c8\ub2e4. </p> <p>\uc774 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ub124\ud2b8\uc6cc\ud0b9\uc758 \ub9e5\ub77d\uc5d0\uc11c Amazon VPC \ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4(VPC CNI)\ub97c \uc18c\uac1c\ud569\ub2c8\ub2e4. VPC CNI\ub294 EKS\uc5d0\uc11c \uc9c0\uc6d0\ud558\ub294 \uae30\ubcf8 \ub124\ud2b8\uc6cc\ud0b9 \ud50c\ub7ec\uadf8\uc778\uc774\ubbc0\ub85c \uc774 \uac00\uc774\ub4dc\uc5d0\uc11c \uc911\uc810\uc801\uc73c\ub85c \ub2e4\ub8e8\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4. VPC CNI\ub294 \ub2e4\uc591\ud55c \uc0ac\uc6a9 \uc0ac\ub840\ub97c \uc9c0\uc6d0\ud558\ub3c4\ub85d \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uc774 \uac00\uc774\ub4dc\uc5d0\ub294 \ub2e4\uc591\ud55c VPC CNI \uc0ac\uc6a9 \uc0ac\ub840, \uc6b4\uc601 \ubaa8\ub4dc, \ud558\uc704 \uad6c\uc131 \uc694\uc18c\uc5d0 \ub300\ud55c \uc139\uc158\uacfc \uad8c\uc7a5 \uc0ac\ud56d\uc744 \ud3ec\ud568\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Amazon EKS\ub294 \uc5c5\uc2a4\ud2b8\ub9bc \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc2e4\ud589\ud558\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc801\ud569\uc131 \uc778\uc99d\uc744 \ubc1b\uc558\uc2b5\ub2c8\ub2e4. \ub300\uccb4 CNI \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc9c0\ub9cc, \uc774 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \ub300\uccb4 CNI \uad00\ub9ac\uc5d0 \ub300\ud55c \uad8c\uc7a5 \uc0ac\ud56d\uc744 \uc81c\uacf5\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub300\uccb4 CNI\ub97c \ud6a8\uacfc\uc801\uc73c\ub85c \uad00\ub9ac\ud558\uae30 \uc704\ud55c \ud30c\ud2b8\ub108 \ubc0f \ub9ac\uc18c\uc2a4 \ubaa9\ub85d\uc740 EKS Alternate CNI \uc124\uba85\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/index/#_1","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud0b9 \ubaa8\ub378","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud074\ub7ec\uc2a4\ud130 \ub124\ud2b8\uc6cc\ud0b9\uc5d0 \ub300\ud574 \ub2e4\uc74c\uacfc \uac19\uc740 \uc694\uad6c \uc0ac\ud56d\uc744 \uc815\uc758\ud588\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\ub3d9\uc77c\ud55c \ub178\ub4dc\uc5d0 \uc2a4\ucf00\uc904\ub9c1\ub41c \ud30c\ub4dc\ub294 NAT(Network Address Translation)\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 \ub2e4\ub978 \ud30c\ub4dc\uc640 \ud1b5\uc2e0\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4.</li> <li>\ud2b9\uc815 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ubaa8\ub4e0 \uc2dc\uc2a4\ud15c \ub370\ubaac(\ubc31\uadf8\ub77c\uc6b4\ub4dc \ud504\ub85c\uc138\uc2a4, \uc608: kubelet)\uc740 \ub3d9\uc77c\ud55c \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\uc640 \ud1b5\uc2e0\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4.</li> <li>\ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud06c\ub97c \uc0ac\uc6a9\ud558\ub294 \ud30c\ub4dc\ub294 NAT\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 \ub2e4\ub978 \ubaa8\ub4e0 \ub178\ub4dc\uc758 \ub2e4\ub978 \ubaa8\ub4e0 \ud30c\ub4dc\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4.</li> </ul> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc694\uad6c\ud558\ub294 \ud638\ud658 \uac00\ub2a5\ud55c \ub124\ud2b8\uc6cc\ud0b9 \uad6c\ud604\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \ubaa8\ub378\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4. \ub2e4\uc74c \uadf8\ub9bc\uc740 \ud30c\ub4dc \ub124\ud2b8\uc6cc\ud06c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc640 \ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud06c \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uac04\uc758 \uad00\uacc4\ub97c \ubcf4\uc5ec\uc90d\ub2c8\ub2e4.</p> <p></p>"},{"location":"ko/networking/index/#cni","title":"\ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud0b9 \uc778\ud130\ud398\uc774\uc2a4 (CNI)","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \ubaa8\ub378\uc744 \uad6c\ud604\ud558\uae30 \uc704\ud55c CNI \uc0ac\uc591 \ubc0f \ud50c\ub7ec\uadf8\uc778\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. CNI\ub294 \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub97c \uad6c\uc131\ud558\uae30 \uc704\ud55c \ud50c\ub7ec\uadf8\uc778\uc744 \uc791\uc131\ud558\uae30 \uc704\ud55c \uc0ac\uc591(\ud604\uc7ac \ubc84\uc804 1.0.0)\uacfc \ub77c\uc774\ube0c\ub7ec\ub9ac, \uc9c0\uc6d0 \uac00\ub2a5\ud55c \uc5ec\ub7ec \ud50c\ub7ec\uadf8\uc778\uc73c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. CNI\ub294 \ucee8\ud14c\uc774\ub108\uc758 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uacfc \ucee8\ud14c\uc774\ub108 \uc0ad\uc81c \uc2dc \ud560\ub2f9\ub41c \ub9ac\uc18c\uc2a4 \uc81c\uac70\uc5d0\ub9cc \uad00\uc5ec\ud569\ub2c8\ub2e4.</p> <p>CNI \ud50c\ub7ec\uadf8\uc778\uc740 kubelet\uc5d0 <code>--network-plugin=cni</code> \uba85\ub839\uc904 \uc635\uc158\uc744 \uc804\ub2ec\ud568\uc73c\ub85c\uc368 \ud65c\uc131\ud654\ub429\ub2c8\ub2e4. kubelet\uc740 <code>--cni-conf-dir</code> (\uae30\ubcf8\uc801\uc73c\ub85c /etc/cni/net.d)\uc5d0\uc11c \ud30c\uc77c\uc744 \uc77d\uace0 \ud574\ub2f9 \ud30c\uc77c\uc758 CNI \uad6c\uc131\uc744 \ud65c\uc6a9\ud558\uc5ec \uac01 \ud30c\ub4dc\uc758 \ub124\ud2b8\uc6cc\ud06c\ub97c \uc124\uc815\ud569\ub2c8\ub2e4. CNI \uad6c\uc131 \ud30c\uc77c\uc740 CNI \uc0ac\uc591 (\ucd5c\uc18c v0.4.0) \uacfc \uc77c\uce58\ud574\uc57c \ud558\uba70 \uad6c\uc131\uc5d0\uc11c \ucc38\uc870\ud558\ub294 \ubaa8\ub4e0 \ud544\uc218 CNI \ud50c\ub7ec\uadf8\uc778\uc740 <code>--cni-bin-dir</code> \ub514\ub809\ud130\ub9ac(\uae30\ubcf8\uc801\uc73c\ub85c /opt/cni/bin)\uc5d0 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \ub514\ub809\ud130\ub9ac\uc5d0 CNI \uad6c\uc131 \ud30c\uc77c\uc774 \uc5ec\ub7ec \uac1c \uc788\ub294 \uacbd\uc6b0, kubelet\uc740 \uad6c\uc131 \ud30c\uc77c\uc744 \uc624\ub984\ucc28\uc21c \uae30\uc900\uc73c\ub85c \uc55e\uc5d0 \uc624\ub294 \uc774\ub984\uc744 \uac00\uc9c4 \ud30c\uc77c\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/index/#amazon-virtual-private-cloud-vpc-cni","title":"Amazon Virtual Private Cloud (VPC) CNI","text":"<p>AWS\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 VPC CNI\ub294 EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uae30\ubcf8 \ub124\ud2b8\uc6cc\ud0b9 \uc560\ub4dc\uc628\uc785\ub2c8\ub2e4. VPC CNI \uc560\ub4dc\uc628\uc740 EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud560 \ub54c \uae30\ubcf8\uc801\uc73c\ub85c \uc124\uce58\ub429\ub2c8\ub2e4. VPC CNI\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6cc\ucee4 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub429\ub2c8\ub2e4. VPC CNI \uc560\ub4dc\uc628\uc740 CNI \ubc14\uc774\ub108\ub9ac\uc640 IP \uc8fc\uc18c \uad00\ub9ac(ipamd) \ud50c\ub7ec\uadf8\uc778\uc73c\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. CNI\ub294 VPC \ub124\ud2b8\uc6cc\ud06c\uc758 IP \uc8fc\uc18c\ub97c \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ud569\ub2c8\ub2e4. ipamd\ub294 \uac01 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc\uc5d0 \ub300\ud55c AWS Elastic Networking Interface(ENI) \ub97c \uad00\ub9ac\ud558\uace0 IP \uc6dc \ud480\uc744 \uc720\uc9c0\ud569\ub2c8\ub2e4. VPC CNI\ub294 \ube60\ub978 \ud30c\ub4dc \uae30\ub3d9 \uc2dc\uac04\uc744 \uc704\ud574 ENI\uc640 IP \uc8fc\uc18c\ub97c \uc0ac\uc804 \ud560\ub2f9\ud558\uae30 \uc704\ud55c \uad6c\uc131 \uc635\uc158\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. Amazon VPC CNI\uc5d0\uc11c \uad8c\uc7a5 \ud50c\ub7ec\uadf8\uc778 \uad00\ub9ac \ubaa8\ubc94 \uc0ac\ub840\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>Amazon EKS\ub294 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud560 \ub54c \ucd5c\uc18c \ub450 \uac1c\uc758 \uac00\uc6a9 \uc601\uc5ed\uc5d0 \uc11c\ube0c\ub137\uc744 \uc9c0\uc815\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. Amazon VPC CNI\ub294 \ub178\ub4dc\uc758 \uc11c\ube0c\ub137\uc5d0\uc11c \ud30c\ub4dc IP \uc8fc\uc18c\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. \ud574\ub2f9 \uc11c\ube0c\ub137\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c\ub97c \ud655\uc778\ud560 \uac83\uc744 \uac15\ub825\ud558\uac8c \uad8c\uc7a5\ud569\ub2c8\ub2e4. EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud558\uae30 \uc804\uc5d0 VPC \ubc0f \uc11c\ube0c\ub137 \uad8c\uc7a5\uc0ac\ud56d\uc744 \uace0\ub824\ud569\ub2c8\ub2e4.</p> <p>Amazon VPC CNI\ub294 \ub178\ub4dc\uc758 \uae30\ubcf8 ENI\uc5d0 \uc5f0\uacb0\ub41c \uc11c\ube0c\ub137\uc758 ENI\uc640 \ubcf4\uc870 IP \uc8fc\uc18c\ub85c \uad6c\uc131\ub41c \uc6dc \ud480\uc744 \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc774 VPC CNI \ubaa8\ub4dc\ub97c \u201c\ubcf4\uc870 IP \ubaa8\ub4dc(secondary IP mode)\u201d\ub77c\uace0 \ud569\ub2c8\ub2e4. IP \uc8fc\uc18c \uc218\uc640 \uc774\uc5d0 \ub530\ub978 \ud30c\ub4dc \uc218(\ud30c\ub4dc\uc758 \ubc00\ub3c4)\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\ubcc4\ub85c \uc815\uc758\ub41c ENI \ubc0f ENI \ub2f9 IP \uc8fc\uc18c \uc218(\uc81c\ud55c)\uc5d0 \ub530\ub77c \uc815\uc758\ub429\ub2c8\ub2e4. \ubcf4\uc870 \ubaa8\ub4dc\ub294 \uae30\ubcf8\uac12\uc774\uba70 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc774 \uc791\uc740 \uc18c\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc801\ud569\ud569\ub2c8\ub2e4. \ud30c\ub4dc \ubc00\ub3c4 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0, Prefix \ubaa8\ub4dc\uc0ac\uc6a9\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. ENI\uc5d0 Prefix\ub97c \ud560\ub2f9\ud558\uc5ec \ud30c\ub4dc\uc6a9 \ub178\ub4dc\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c\ub97c \ub298\ub9b4 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Amazon VPC CNI\ub294 \uae30\ubcf8\uc801\uc73c\ub85c AWS VPC\uc640 \ud1b5\ud569\ub418\uba70, \uc774\ub97c \ud1b5\ud574 \uc0ac\uc6a9\uc790\ub294 \uae30\uc874 AWS VPC \ub124\ud2b8\uc6cc\ud0b9 \ubc0f \ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc801\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\ub97c \uad6c\ucd95\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc5ec\uae30\uc5d0\ub294 VPC flow logs, VPC \ub77c\uc6b0\ud305 \uc815\ucc45 \ubc0f \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d \uaca9\ub9ac\ub97c \uc704\ud55c \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c Amazon VPC CNI\ub294 \ub178\ub4dc\uc758 \uae30\ubcf8 ENI\uc640 \uc5f0\uacb0\ub41c \ubcf4\uc548 \uadf8\ub8f9\uc744 \ud30c\ub4dc\uc5d0 \uc801\uc6a9\ud569\ub2c8\ub2e4. \ud30c\ub4dc\uc5d0 \ubcc4\ub3c4\uc758 \ub124\ud2b8\uc6cc\ud06c \uaddc\uce59\uc744 \ud560\ub2f9\ud558\uace0 \uc2f6\uc740 \uacbd\uc6b0 \ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9 \ud65c\uc131\ud654\ub97c \uace0\ub824\ud569\ub2c8\ub2e4.</p> <p>\uae30\ubcf8\uc801\uc73c\ub85c VPC CNI\ub294 \ub178\ub4dc\uc758 \uae30\ubcf8 ENI\uc5d0 \ud560\ub2f9\ub41c \uc11c\ube0c\ub137\uc758 IP \uc8fc\uc18c\ub97c Pod\uc5d0 \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc218\ucc9c \uac1c\uc758 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc788\ub294 \ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\ub97c \uc2e4\ud589\ud560 \uacbd\uc6b0\uc5d0\ub294 IPv4 \uc8fc\uc18c \ubd80\uc871\uc774 \ubc1c\uc0dd\ud558\ub294 \uac83\uc774 \uc77c\ubc18\uc801\uc785\ub2c8\ub2e4. AWS VPC\ub97c \uc0ac\uc6a9\ud558\uba74 \ubcf4\uc870 CIDR \ud560\ub2f9\uc744 \ud1b5\ud574 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP\ub97c \ud655\uc7a5\ud558\uc5ec IPv4 CIDR \ube14\ub85d \uace0\uac08\uc744 \ud574\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. AWS VPC CNI\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\uc5d0 \ub300\ud574 \ub2e4\ub978 \uc11c\ube0c\ub137 CIDR \ubc94\uc704\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. VPC CNI\uc758 \uc774\ub7ec\ud55c \uae30\ub2a5\uc744 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub124\ud2b8\uc6cc\ud0b9\uc774\ub77c\uace0 \ud569\ub2c8\ub2e4. EKS\uc5d0\uc11c 100.64.0.0/10 \ubc0f 198.19.0.0/16 CIDR(CG-NAT)\uc744 \ud568\uaed8 \uc0ac\uc6a9\ud558\ub824\uba74 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub124\ud2b8\uc6cc\ud0b9\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \ud30c\ub4dc\uac00 VPC\uc758 RFC1918 IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc744 \uacbd\uc6b0\uc758 \ud658\uacbd\uc744 \ud6a8\uacfc\uc801\uc73c\ub85c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub124\ud2b8\uc6cc\ud0b9\uc740 IPv4 \uc8fc\uc18c \uace0\uac08 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \ud55c \uac00\uc9c0 \ubc29\ubc95\uc774\uc9c0\ub9cc \uc6b4\uc601 \uc624\ubc84\ud5e4\ub4dc\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub824\uba74 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub124\ud2b8\uc6cc\ud0b9\ubcf4\ub2e4 IPv6 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ud2b9\ud788, VPC\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c IPv4 \uc8fc\uc18c\ub97c \ubaa8\ub450 \uc18c\uc9c4\ud55c \uacbd\uc6b0 IPv6 \ud074\ub7ec\uc2a4\ud130\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. IPv6\uc758 \uc9c0\uc6d0\uc744 \uc704\ud55c \uc870\uc9c1\uc5d0\uc11c\uc758 \uacc4\ud68d\uc744 \ud655\uc778\ud558\uace0, IPv6\uc5d0 \ud22c\uc790\ud558\ub294 \uac83\uc774 \uc7a5\uae30\uc801 \uac00\uce58\uac00 \ub354 \ub192\uc744\uc9c0 \uace0\ub824\ud569\ub2c8\ub2e4.</p> <p>EKS\uc758 IPv6 \uc9c0\uc6d0\uc740 \uc81c\ud55c\ub41c IPv4 \uc8fc\uc18c \uacf5\uac04\uc73c\ub85c \uc778\ud574 \ubc1c\uc0dd\ud558\ub294 IP \uace0\uac08 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \ub370 \uc911\uc810\uc744 \ub450\uace0 \uc788\uc2b5\ub2c8\ub2e4. IPv4 \uace0\uac08\ub85c \uc778\ud55c \uace0\uac1d\ub4e4\uc758 \ubb38\uc81c\uc5d0 \ub300\uc751\ud558\uc5ec EKS\ub294 \ub4c0\uc5bc \uc2a4\ud0dd \ud30c\ub4dc\ubcf4\ub2e4 IPv6 \uc804\uc6a9 \ud30c\ub4dc\uc758 \uc6b0\uc120\uc21c\uc704\ub97c \ub192\uc785\ub2c8\ub2e4. \uc989, \ud30c\ub4dc\ub294 IPv4 \ub9ac\uc18c\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc9c0\ub9cc VPC CIDR \ubc94\uc704\uc758 IPv4 \uc8fc\uc18c\ub294 \ud560\ub2f9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. VPC CNI\ub294 AWS \uad00\ub9ac\ud615 VPC IPv6 CIDR \ube14\ub85d\uc5d0\uc11c \ud30c\ub4dc\uc5d0 IPv6 \uc8fc\uc18c\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. </p>"},{"location":"ko/networking/index/#_2","title":"\uc11c\ube0c\ub137 \uacc4\uc0b0\uae30","text":"<p>\uc774 \ud504\ub85c\uc81d\ud2b8\uc5d0\ub294 \uc11c\ube0c\ub137 \uacc4\uc0b0\uae30 Excel \ubb38\uc11c\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uacc4\uc0b0\uae30 \ubb38\uc11c\ub294 <code>WARM_IP_TARGET</code> \ubc0f <code>WARM_ENI_TARGET</code>\uacfc \uac19\uc740 \ub2e4\uc591\ud55c ENI \uad6c\uc131 \uc635\uc158\uc5d0 \ub530\ub77c \uc9c0\uc815\ub41c \uc6cc\ud06c\ub85c\ub4dc\uc758 IP \uc8fc\uc18c \uc0ac\uc6a9\uc744 \uc2dc\ubbac\ub808\uc774\uc158\ud569\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\ub294 \ub450 \uac1c\uc758 \uc2dc\ud2b8\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uccab \ubc88\uc9f8 \uc2dc\ud2b8\ub294 \uc6dc ENI \ubaa8\ub4dc\uc6a9\uc774\uace0 \ub2e4\ub978 \ud558\ub098\ub294 \uc6dc IP \ubaa8\ub4dc\uc6a9\uc785\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ubaa8\ub4dc\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 VPC CNI guidance\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4. </p> <p>\uc785\ub825 \uac12: - \uc11c\ube0c\ub137 CIDR \ud06c\uae30 - \uc6dc ENI \ud0c0\uac9f \ub610\ub294 \uc6dc IP \ud0c0\uac9f - \uc778\uc2a4\ud134\uc2a4 \ubaa9\ub85d     - \uc720\ud615, \uac1c\uc218 \ubc0f \uc778\uc2a4\ud134\uc2a4\ub2f9 \uc2a4\ucf00\uc904\ub9c1\ub41c \uc6cc\ud06c\ub85c\ub4dc \ud30c\ub4dc\uc758 \uc218</p> <p>\ucd9c\ub825 \uac12: - \ud638\uc2a4\ud305\ub41c \ucd1d \ud30c\ub4dc \uc218 - \uc0ac\uc6a9\ub41c \uc11c\ube0c\ub137 IP \uc218 - \ub0a8\uc544 \uc788\ub294 \uc11c\ube0c\ub137 IP \uc218 - \uc778\uc2a4\ud134\uc2a4 \uc218\uc900 \uc138\ubd80 \uc815\ubcf4     - \uc778\uc2a4\ud134\uc2a4\ub2f9 \uc6dc IP/ENI \uc218     - \uc778\uc2a4\ud134\uc2a4\ub2f9 \ud65c\uc131 IP/ENI \uc218</p>"},{"location":"ko/networking/prefix-mode/index_linux/","title":"Linux\uc6a9 Prefix \ubaa8\ub4dc","text":"<p>Amazon VPC CNI\ub294 Amazon EC2 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ub124\ud2b8\uc6cc\ud06c Prefix\ub97c \ud560\ub2f9\ud558\uc5ec \ub178\ub4dc\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c \uc218\ub97c \ub298\ub9ac\uace0 \ub178\ub4dc\ub2f9 \ud30c\ub4dc \ubc00\ub3c4\ub97c \ub192\uc785\ub2c8\ub2e4. Amazon VPC CNI \uc560\ub4dc\uc628 \ubc84\uc804 1.9.0 \uc774\uc0c1\uc744 \uad6c\uc131\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \uac1c\ubcc4 \ubcf4\uc870 IP \uc8fc\uc18c\ub97c \ud560\ub2f9\ud558\ub294 \ub300\uc2e0 IPv4 \ubc0f IPv6 CIDR\uc744 \ud560\ub2f9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>IPv6 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c\ub294 Prefix \ubaa8\ub4dc\ub9cc \uc9c0\uc6d0\ub418\uba70 \uae30\ubcf8\uc801\uc73c\ub85c \ud65c\uc131\ud654\ub418\uc5b4\uc788\uc2b5\ub2c8\ub2e4. VPC CNI\ub294 ENI\uc758 \uc2ac\ub86f\uc5d0 /80 IPv6 Prefix\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc774 \uac00\uc774\ub4dc\uc758 IPv6 \uc139\uc158\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>Prefix \ud560\ub2f9 \ubaa8\ub4dc\uc5d0\uc11c \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\ub2f9 \ucd5c\ub300 elastic network interfaces \uc218\ub294 \ub3d9\uc77c\ud558\uac8c \uc720\uc9c0\ub418\uc9c0\ub9cc, \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc758 \uc2ac\ub86f\uc5d0 \uac1c\ubcc4 IPv4 \uc8fc\uc18c\ub97c \ud560\ub2f9\ud558\ub294 \ub300\uc2e0 /28(16\uac1c\uc758 IP \uc8fc\uc18c) IPv4 \uc8fc\uc18c Prefix\ub97c \ud560\ub2f9\ud558\ub3c4\ub85d Amazon VPC CNI\ub97c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>ENABLE_PREFIX_DELEGATION</code>\uc774 true\ub85c \uc124\uc815\ub418\uba74 CNI\ub294 ENI\uc5d0 \ud560\ub2f9\ub41c Prefix\uc5d0\uc11c \ud30c\ub4dc\uc5d0 IP \uc8fc\uc18c\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\uc5d0 \ub098\uc640 \uc788\ub294 \uc548\ub0b4\ub97c \ub530\ub77c Prefix IP \ubaa8\ub4dc\ub97c \ud65c\uc131\ud654\ud569\ub2c8\ub2e4. </p> <p></p> <p>\ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 IP \uc8fc\uc18c \uc218\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ub530\ub77c \ub2e4\ub985\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ud558\ub294 \uac01 Prefix\ub294 \ud558\ub098\uc758 IP \uc8fc\uc18c\ub85c \uac04\uc8fc\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, <code>c5.large</code> \uc778\uc2a4\ud134\uc2a4\uc758 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub2f9 IPv4 \uc8fc\uc18c\ub294 <code>10</code>\uac1c\ub85c \uc81c\ud55c\ub429\ub2c8\ub2e4. \uc774 \uc778\uc2a4\ud134\uc2a4\uc758 \uac01 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0\ub294 \uae30\ubcf8 IPv4 \uc8fc\uc18c\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ubcf4\uc870 IPv4 \uc8fc\uc18c\uac00 \uc5c6\ub294 \uacbd\uc6b0 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ucd5c\ub300 9\uac1c\uc758 Prefix\ub97c \ud560\ub2f9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ud55c \uac01 \ucd94\uac00 IPv4 \uc8fc\uc18c\uc758 \uacbd\uc6b0 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \uc811\ub450\uc0ac\ub97c \ud558\ub098 \ub354 \uc801\uac8c \ud560\ub2f9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\ubcc4 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub2f9 IP \uc8fc\uc18c \ubc0f \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 Prefix \ud560\ub2f9\uc5d0 \ub300\ud55c AWS EC2 \uc124\uba85\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>\uc6cc\ucee4 \ub178\ub4dc\ub97c \ucd08\uae30\ud654\ud558\ub294 \ub3d9\uc548 VPC CNI\ub294 \uae30\ubcf8 ENI\uc5d0 \ud558\ub098 \uc774\uc0c1\uc758 Prefix\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. CNI\ub294 \uc6dc \ud480\uc744 \uc720\uc9c0 \uad00\ub9ac\ud558\uc5ec \ud30c\ub4dc \uc2dc\uc791 \uc18d\ub3c4\ub97c \ub192\uc774\uae30 \uc704\ud574 Prefix\ub97c \ubbf8\ub9ac \ud560\ub2f9\ud569\ub2c8\ub2e4. \ud658\uacbd \ubcc0\uc218\ub97c \uc124\uc815\ud558\uc5ec \uc6dc \ud480\uc5d0 \ubcf4\uad00\ud560 Prefix \uc218\ub97c \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li><code>WARM_PREFIX_TARGET</code>, \ud604\uc7ac \ud544\uc694 \uc218\ub7c9\uc744 \ucd08\uacfc\ud558\uc5ec \ud560\ub2f9\ud560 Prefix \uc218</li> <li><code>WARM_IP_TARGET</code>, \ud604\uc7ac \ud544\uc694 \uc218\ub7c9\uc744 \ucd08\uacfc\ud558\uc5ec \ud560\ub2f9\ud560 IP \uc8fc\uc18c \uc218</li> <li><code>MINIMUM_IP_TARGET</code>, \uc5b8\uc81c\ub4e0\uc9c0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ucd5c\uc18c IP \uc8fc\uc18c \uc218</li> <li><code>WARM_IP_TARGET</code> \ubc0f <code>MINIMUM_IP_TARGET</code>\uc774 \uc124\uc815\ub41c \uacbd\uc6b0 <code>WARM_PREFIX_TARGET</code>\ub97c \uc624\ubc84\ub77c\uc774\ub4dc \ud569\ub2c8\ub2e4.</li> </ul> <p>\ub354 \ub9ce\uc740 \ud30c\ub4dc\uac00 \uc608\uc57d\ub418\uba74 \uae30\uc874 ENI\uc5d0 \ub300\ud574 \ucd94\uac00 Prefix\uac00 \uc694\uccad\ub429\ub2c8\ub2e4. \uba3c\uc800 VPC CNI\ub294 \uae30\uc874 ENI\uc5d0 \uc0c8 Prefix\ub97c \ud560\ub2f9\ud558\ub824\uace0 \uc2dc\ub3c4\ud569\ub2c8\ub2e4. \ub9cc\uc57d ENI\uc758 \uc6a9\ub7c9\uc774 \ubd80\uc871\ud560 \uacbd\uc6b0, VPC CNI\ub294 \ub178\ub4dc\uc5d0 \uc0c8 ENI\ub97c \ud560\ub2f9\ud558\ub824\uace0 \uc2dc\ub3c4\ud569\ub2c8\ub2e4. \ucd5c\ub300 ENI \ud55c\ub3c4(\uc778\uc2a4\ud134\uc2a4 \uc720\ud615\ubcc4\ub85c \uc815\uc758)\uc5d0 \ub3c4\ub2ec\ud560 \ub54c\uae4c\uc9c0 \uc0c8 ENI\uac00 \uc5f0\uacb0\ub429\ub2c8\ub2e4. \uc0c8 ENI\uac00 \uc5f0\uacb0\ub418\uba74 ipamd\ub294 <code>WARM_PREFIX_TARGET</code>, <code>WARM_IP_TARGET</code> \ubc0f <code>MINIMUM_IP_TARGET</code> \uc124\uc815\uc744 \uc720\uc9c0\ud558\ub294 \ub370 \ud544\uc694\ud55c \ud558\ub098 \uc774\uc0c1\uc758 Prefix\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4.</p> <p></p>"},{"location":"ko/networking/prefix-mode/index_linux/#_1","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/networking/prefix-mode/index_linux/#prefix","title":"\ub2e4\uc74c\uacfc \uac19\uc740 \uacbd\uc6b0 Prefix \ubaa8\ub4dc \uc0ac\uc6a9","text":"<p>\uc6cc\ucee4 \ub178\ub4dc\uc5d0\uc11c Pod \ubc00\ub3c4 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0 Prefix \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. VPC CNI \uc624\ub958\ub97c \ubc29\uc9c0\ud558\ub824\uba74 Prefix \ubaa8\ub4dc\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\uae30 \uc804\uc5d0 \uc11c\ube0c\ub137\uc5d0\uc11c /28 Prefix\uc758 \uc5f0\uc18d\ub41c \uc8fc\uc18c \ube14\ub85d\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc11c\ube0c\ub137 \uc608\uc57d\uc5d0 \ub300\ud55c \uc138\ubd80 \uc815\ubcf4\ub294 \u201c\uc11c\ube0c\ub137 \uc608\uc57d\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc11c\ube0c\ub137 \ud30c\ud3b8\ud654 (IPv4) \ubc29\uc9c0\u201d \uc139\uc158\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4. </p> <p>\uc774\uc804 \ubc84\uc804\uacfc\uc758 \ud638\ud658\uc131\uc744 \uc704\ud574 max-pods \uc81c\ud55c\uc774 \ubcf4\uc870 IP \ubaa8\ub4dc\ub97c \uc9c0\uc6d0\ud558\ub3c4\ub85d \uc124\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc \ubc00\ub3c4\ub97c \ub192\uc774\ub824\uba74, <code>max-pods</code> \uac12\uc744 Kubelet\uc5d0 \uc9c0\uc815\ud558\uace0, \ub178\ub4dc\uc758 \uc0ac\uc6a9\uc790 \ub370\uc774\ud130(User data)\uc5d0 <code>--use-max-pods=false</code>\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. max-pod-calculator.sh \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud2b9\uc815 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ub300\ud55c EKS\uc758 \uad8c\uc7a5 \ucd5c\ub300 \ud30c\ub4dc \uc218\ub97c \uacc4\uc0b0\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9\uc790 \ub370\uc774\ud130\uc758 \uc608\ub294 EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <pre><code>./max-pods-calculator.sh --instance-type m5.large --cni-version ``1.9``.0 --cni-prefix-delegation-enabled\n</code></pre> <p>Prefix \ud560\ub2f9 \ubaa8\ub4dc\ub294 \uae30\ubcf8 ENI\uac00 \ud30c\ub4dc\uc5d0 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 CNI \ucee4\uc2a4\ud140 \ub124\ud2b8\uc6cc\ud0b9 \uc0ac\uc6a9\uc790\uc5d0\uac8c \ud2b9\ud788 \uc801\ud569\ud569\ub2c8\ub2e4. Prefix \ud560\ub2f9\uc744 \uc0ac\uc6a9\ud558\uba74 \ud30c\ub4dc\uc5d0 \uae30\ubcf8 ENI\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc544\ub3c4 \uac70\uc758 \ubaa8\ub4e0 Nitro \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0\uc11c \ub354 \ub9ce\uc740 IP\ub97c \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_linux/#prefix_1","title":"\ub2e4\uc74c\uacfc \uac19\uc740 \uacbd\uc6b0\uc5d0\ub294 Prefix \ubaa8\ub4dc\ub97c \uad8c\uc7a5\ud558\uc9c0 \uc54a\uc74c","text":"<p>\uc11c\ube0c\ub137\uc774 \ub9e4\uc6b0 \ud30c\ud3b8\ud654 \ub418\uc5b4 \uc788\uace0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c\uac00 \ubd80\uc871\ud558\uc5ec /28 Prefix\ub97c \ub9cc\ub4e4 \uc218 \uc5c6\ub294 \uacbd\uc6b0\uc5d0\ub294 Prefix \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624. Prefix\uac00 \uc0dd\uc131\ub418\ub294 \uc11c\ube0c\ub137\uc774 \ud30c\ud3b8\ud654 \ub41c \uacbd\uc6b0(\uc0ac\uc6a9\ub7c9\uc774 \ub9ce\uace0 \ubcf4\uc870 IP \uc8fc\uc18c\uac00 \ud769\uc5b4\uc838 \uc788\ub294 \uc11c\ube0c\ub137), Prefix \uc5f0\uacb0\uc5d0 \uc2e4\ud328\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2e0\uaddc \uc11c\ube0c\ub137\uc744 \ub9cc\ub4e4\uace0 Prefix\ub97c \uc608\uc57d\ud558\uba74 \uc774 \ubb38\uc81c\ub97c \ud53c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Prefix \ubaa8\ub4dc\uc5d0\uc11c\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ud560\ub2f9\ub41c \ubcf4\uc548 \uadf8\ub8f9\uc774 \ud30c\ub4dc\uc5d0 \uacf5\uc720\ub429\ub2c8\ub2e4. \uacf5\uc720 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\uc5d0\uc11c \ub2e4\uc591\ud55c \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548 \uc694\uad6c\uc0ac\ud56d\uc774 \uc788\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589\ud558\uc5ec \uaddc\uc815 \uc900\uc218\ub97c \ub2ec\uc131\ud574\uc57c \ud558\ub294 \ubcf4\uc548 \uc694\uad6c\uc0ac\ud56d\uc774 \uc788\ub294 \uacbd\uc6b0 \ud30c\ub4dc\uc758 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_linux/#_2","title":"\ub3d9\uc77c\ud55c \ub178\ub4dc \uadf8\ub8f9\uc5d0\uc11c \uc720\uc0ac\ud55c \uc778\uc2a4\ud134\uc2a4 \uc720\ud615 \uc0ac\uc6a9","text":"<p>\ub178\ub4dc \uadf8\ub8f9\uc5d0\ub294 \uc5ec\ub7ec \uc720\ud615\uc758 \uc778\uc2a4\ud134\uc2a4\uac00 \ud3ec\ud568\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd5c\ub300 \ud30c\ub4dc \uc218\uac00 \uc801\uc740 \uc778\uc2a4\ud134\uc2a4\uc758 \uac12\uc774 \ub178\ub4dc \uadf8\ub8f9\uc758 \ubaa8\ub4e0 \ub178\ub4dc\uc5d0 \uc801\uc6a9\ub429\ub2c8\ub2e4. \ub178\ub4dc \uc0ac\uc6a9\uc744 \uadf9\ub300\ud654\ud558\ub824\uba74 \ub178\ub4dc \uadf8\ub8f9\uc5d0\uc11c \uc720\uc0ac\ud55c \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub178\ub4dc \uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1\uc744 \uc704\ud574 Karpenter\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 provisioner API\uc758 requirements \ubd80\ubd84\uc5d0\uc11c node.kubernetes.io/instance-type\uc744 \uad6c\uc131\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p> <p>Warning</p> <p>\ud2b9\uc815 \ub178\ub4dc \uadf8\ub8f9\uc758 \ubaa8\ub4e0 \ub178\ub4dc\uc5d0 \ub300\ud55c \ucd5c\ub300 \ud30c\ub4dc \uc218\ub294 \ub178\ub4dc \uadf8\ub8f9 \ub0b4 \ub2e8\uc77c \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc758 \ucd5c\uc18c \ucd5c\ub300 \ud30c\ub4dc \uc218\ub85c \uc815\uc758\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_linux/#ipv4-warm_prefix_target","title":"IPv4 \uc8fc\uc18c\ub97c \ubcf4\uc874\ud558\ub3c4\ub85d 'WARM_PREFIX_TARGET'\uc744 \uad6c\uc131","text":"<p>\uc124\uce58 \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc758 <code>WARM_PREFIX_TARGET</code> \uae30\ubcf8\uac12\uc740 1\uc785\ub2c8\ub2e4. \ub300\ubd80\ubd84\uc758 \uacbd\uc6b0, <code>WARM_PREFIX_TARGET</code>\uc758 \uad8c\uc7a5 \uac12\uc778 1\uc744 \uc0ac\uc6a9\ud558\uba74 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ud560\ub2f9\ub41c \ubbf8\uc0ac\uc6a9 IP \uc8fc\uc18c\ub97c \ucd5c\uc18c\ud654\ud558\uba74\uc11c \ube60\ub978 \ud30c\ub4dc \uc2dc\uc791 \uc2dc\uac04\uc744 \uc801\uc808\ud788 \uc870\ud569\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub178\ub4dc\ub2f9 IPv4 \uc8fc\uc18c\ub97c \ucd94\uac00\ub85c \ubcf4\uc874\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \uad6c\uc131 \uc2dc <code>WARM_PREFIX_TARGET</code>\uc744 \uc624\ubc84\ub77c\uc774\ub4dc\ud558\ub294 <code>WARM_IP_TARGET</code> \ubc0f <code>MINIMUM_IP_TARGET</code> \uc124\uc815\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. <code>WARM_IP_TARGET</code>\uc744 16 \ubbf8\ub9cc\uc758 \uac12\uc73c\ub85c \uc124\uc815\ud558\uba74 CNI\uac00 \ucd08\uacfc Prefix \uc804\uccb4\ub97c \uc5f0\uacb0\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_linux/#eni-prefix","title":"\uc2e0\uaddc ENI \ucd94\uac00\ubcf4\ub2e4\ub294 \uc2e0\uaddc Prefix \ud560\ub2f9","text":"<p>EC2 API \uc791\uc5c5 \uc2dc \uae30\uc874 ENI\uc5d0 Prefix\ub97c \ucd94\uac00\ub85c \ud560\ub2f9\ud558\ub294 \uac83\uc774 \uc2e0\uaddc ENI\ub97c \uc0dd\uc131\ud558\uc5ec \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc5f0\uacb0\ud558\ub294 \uac83\ubcf4\ub2e4 \ub354 \ube60\ub985\ub2c8\ub2e4. Prefix\ub97c \uc0ac\uc6a9\ud558\uba74 IPv4 \uc8fc\uc18c \ud560\ub2f9\uc744 \uc808\uc57d\ud558\uba74\uc11c \uc131\ub2a5\uc744 \ud5a5\uc0c1\uc2dc\ud0ac \uc218 \uc788\uc2b5\ub2c8\ub2e4. Prefix \uc5f0\uacb0\uc740 \uc77c\ubc18\uc801\uc73c\ub85c 1\ucd08 \uc774\ub0b4\uc5d0 \uc644\ub8cc\ub418\uc9c0\ub9cc \uc2e0\uaddc ENI\ub97c \uc5f0\uacb0\ud558\ub294 \ub370\uc5d0\ub294 \ucd5c\ub300 10\ucd08\uac00 \uac78\ub9b4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub300\ubd80\ubd84\uc758 \uc0ac\uc6a9 \uc0ac\ub840\uc5d0\uc11c CNI\ub294 Prefix \ubaa8\ub4dc\uc5d0\uc11c \uc2e4\ud589\ud560 \ub54c \uc6cc\ucee4 \ub178\ub4dc\ub2f9 \ud558\ub098\uc758 ENI\ub9cc \ud544\uc694\ub85c\ud569\ub2c8\ub2e4. (\ucd5c\uc545\uc758 \uacbd\uc6b0)\ub178\ub4dc\ub2f9 \ucd5c\ub300 15\uac1c\uc758 \ubbf8\uc0ac\uc6a9 IP\ub97c \uac10\ub2f9\ud560 \uc218 \uc788\ub2e4\uba74, \ucd5c\uc2e0 Prefix \ud560\ub2f9 \ub124\ud2b8\uc6cc\ud0b9 \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uadf8\uc5d0 \ub530\ub978 \uc131\ub2a5 \ubc0f \ud6a8\uc728\uc131 \ud5a5\uc0c1\uc744 \uc2e4\ud604\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_linux/#ipv4","title":"\uc11c\ube0c\ub137 \uc608\uc57d\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc11c\ube0c\ub137 \ud30c\ud3b8\ud654 (IPv4) \ub97c \ubc29\uc9c0","text":"<p>EC2\uac00 ENI\uc5d0 /28 IPv4 Prefix\ub97c \ud560\ub2f9\ud560 \uacbd\uc6b0, \ud574\ub2f9 Prefix\ub294 \uc11c\ube0c\ub137\uc758 \uc5f0\uc18d\ub41c IP \uc8fc\uc18c \ube14\ub85d\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4. Prefix\uac00 \uc0dd\uc131\ub418\ub294 \uc11c\ube0c\ub137\uc774 \ud30c\ud3b8\ud654\ub41c \uacbd\uc6b0 (\ubcf4\uc870 IP \uc8fc\uc18c\uac00 \ud769\uc5b4\uc838 \uc788\uace0 \ub9ce\uc774 \uc0ac\uc6a9\ub418\ub294 \uc11c\ube0c\ub137) Prefix \uc5f0\uacb0\uc5d0 \uc2e4\ud328\ud560 \uc218 \uc788\uc73c\uba70 VPC CNI \ub85c\uadf8\uc5d0 \ub2e4\uc74c\uacfc \uac19\uc740 \uc624\ub958 \uba54\uc2dc\uc9c0\uac00 \ud45c\uc2dc\ub429\ub2c8\ub2e4.</p> <pre><code>failed to allocate a private IP/Prefix address: InsufficientCidrBlocks: There are not enough free cidr blocks in the specified subnet to satisfy the request.\n</code></pre> <p>\ud30c\ud3b8\ud654\ub97c \ubc29\uc9c0\ud558\uba74\uc11c Prefix\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\ub294 \ucda9\ubd84\ud55c \uc5f0\uc18d \uacf5\uac04\uc744 \ud655\ubcf4\ud558\ub824\uba74 VPC \uc11c\ube0c\ub137 CIDR \uc608\uc57d\uc744 \uc0ac\uc6a9\ud558\uc5ec Prefix\ub9cc \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \uc11c\ube0c\ub137 \ub0b4 IP \uacf5\uac04\uc744 \uc608\uc57d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\uc57d\uc744 \uc0dd\uc131\ud558\uba74 VPC CNI \ud50c\ub7ec\uadf8\uc778\uc740 EC2 API\ub97c \ud638\ucd9c\ud558\uc5ec \uc608\uc57d\ub41c \uacf5\uac04\uc5d0\uc11c \uc790\ub3d9\uc73c\ub85c \ud560\ub2f9\ub418\ub294 Prefix\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4.</p> <p>\uc2e0\uaddc \uc11c\ube0c\ub137\uc744 \ub9cc\ub4e4\uace0, Prefix\ub97c \uc704\ud55c \uacf5\uac04\uc744 \uc608\uc57d\ud558\uace0, VPC CNI\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud574\ub2f9 \uc11c\ube0c\ub137\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 Prefix\ub97c \ud560\ub2f9\ud558\ub3c4\ub85d \uc124\uc815\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc2e0\uaddc \uc11c\ube0c\ub137\uc774 VPC CNI Prefix \ud560\ub2f9\uc744 \ud65c\uc131\ud654\ud55c \uc0c1\ud0dc\uc5d0\uc11c EKS \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc \uc804\uc6a9\uc73c\ub85c \uc0ac\uc6a9\ub418\ub294 \uacbd\uc6b0, Prefix \uc608\uc57d \ub2e8\uacc4\ub97c \uac74\ub108\ub6f8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_linux/#vpc-cni","title":"VPC CNI \ub2e4\uc6b4\uadf8\ub808\uc774\ub4dc\ub97c \ud53c\ud560 \uac83","text":"<p>Prefix \ubaa8\ub4dc\ub294 VPC CNI \ubc84\uc804 1.9.0 \uc774\uc0c1\uc5d0\uc11c \uc791\ub3d9\ud569\ub2c8\ub2e4. Prefix \ubaa8\ub4dc\ub97c \ud65c\uc131\ud654\ud558\uace0 Prefix\ub97c ENI\uc5d0 \ud560\ub2f9\ud55c \ud6c4\uc5d0\ub294 Amazon VPC CNI \ucd94\uac00 \uae30\ub2a5\uc744 1.9.0 \ubbf8\ub9cc \ubc84\uc804\uc73c\ub85c \ub2e4\uc6b4\uadf8\ub808\uc774\ub4dc\ud558\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4. VPC CNI\ub97c \ub2e4\uc6b4\uadf8\ub808\uc774\ub4dc\ud558\ub824\uba74 \ub178\ub4dc\ub97c \uc0ad\uc81c\ud558\uace0 \ub2e4\uc2dc \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_linux/#prefix-delegation","title":"Prefix Delegation\uc73c\ub85c \uc804\ud658\ud558\ub294 \ub3d9\uc548 \ubaa8\ub4e0 \ub178\ub4dc\ub97c \uad50\uccb4","text":"<p>\uae30\uc874 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc21c\ucc28\uc801\uc73c\ub85c \uad50\uccb4\ud558\ub294 \ub300\uc2e0 \uc2e0\uaddc \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\uc5ec \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c \uc218\ub97c \ub298\ub9ac\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uae30\uc874 \ub178\ub4dc\ub97c \ubaa8\ub450 \ucc28\ub2e8\ud558\uace0 drain\ud558\uc5ec \ubaa8\ub4e0 \uae30\uc874 \ud30c\ub4dc\ub97c \uc548\uc804\ud558\uac8c \uc81c\uac70\ud569\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uc911\ub2e8\uc744 \ubc29\uc9c0\ud558\ub824\uba74 \uc911\uc694\ud55c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc704\ud574 \ud504\ub85c\ub355\uc158 \ud074\ub7ec\uc2a4\ud130\uc5d0 Pod Disruption Budgets\uc744 \uc124\uc815\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc2e0\uaddc \ub178\ub4dc\uc758 \ud30c\ub4dc\uc5d0\ub294 ENI\uc5d0 \ud560\ub2f9\ub41c Prefix\uc758 IP\uac00 \ud560\ub2f9\ub429\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \uc2e4\ud589\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud55c \ud6c4, \uae30\uc874 \ub178\ub4dc\uc640 \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0ad\uc81c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, \uc124\uba85\ub41c \ub2e8\uacc4\uc5d0 \ub530\ub77c \uc548\uc804\ud558\uac8c \ub178\ub4dc \uadf8\ub8f9 \uc0ad\uc81c\ub97c \uc9c4\ud589\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_windows/","title":"\uc708\ub3c4\uc6b0\uc6a9 Prefix \ubaa8\ub4dc","text":"<p>Amazon EKS\uc5d0\uc11c \uc708\ub3c4\uc6b0 \ud638\uc2a4\ud2b8\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uac01 \ud30c\ub4dc\ub294 \uae30\ubcf8\uc801\uc73c\ub85c VPC \ub9ac\uc18c\uc2a4 \ucee8\ud2b8\ub864\ub7ec\uc5d0 \uc758\ud574 \ubcf4\uc870 IP \uc8fc\uc18c\uac00 \ud560\ub2f9\ub429\ub2c8\ub2e4. \uc774 IP \uc8fc\uc18c\ub294 \ud638\uc2a4\ud2b8\uc758 \uc11c\ube0c\ub137\uc5d0\uc11c \ud560\ub2f9\ub418\uc5b4 VPC\uc5d0\uc11c \ub77c\uc6b0\ud305\uc774 \uac00\ub2a5\ud55c \uc8fc\uc18c\uc785\ub2c8\ub2e4. Linux\uc5d0\uc11c\ub294 \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc5f0\uacb0\ub41c \uac01 ENI\uc5d0 \ubcf4\uc870 IP \uc8fc\uc18c \ub610\ub294 /28 CIDR(Prefix)\ub85c \ucc44\uc6b8 \uc218 \uc788\ub294 \uc5ec\ub7ec \uc2ac\ub86f\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc708\ub3c4\uc6b0 \ud638\uc2a4\ud2b8\ub294 \ub2e8\uc77c ENI\uc640 \uc2ac\ub86f\ub9cc \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \ubcf4\uc870 IP \uc8fc\uc18c\ub9cc \uc0ac\uc6a9\ud558\uba74 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 IP \uc8fc\uc18c\uac00 \ub9ce\ub354\ub77c\ub3c4 \uc708\ub3c4\uc6b0 \ud638\uc2a4\ud2b8\uc5d0\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc \uc218\uac00 \uc778\uc704\uc801\uc73c\ub85c \uc81c\ud55c\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud2b9\ud788 \ube44\uad50\uc801 \uc791\uc740 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc708\ub3c4\uc6b0 \ud638\uc2a4\ud2b8\uc5d0\uc11c \ud30c\ub4dc \ubc00\ub3c4\ub97c \ub192\uc774\uae30 \uc704\ud574 \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0 Prefix Delegation\uc744 \ud65c\uc131\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Prefix Delegation\uc744 \ud65c\uc131\ud654\ud558\uba74 /28 IPv4 Prefix\uac00 \ubcf4\uc870 IP \uc8fc\uc18c \ub300\uc2e0 ENI \uc2ac\ub86f\uc5d0 \ud560\ub2f9\ub429\ub2c8\ub2e4. Prefix Delegation\uc740 <code>amazon-vpc-cni</code> \ucee8\ud53c\uadf8\ub9f5\uc5d0 <code>enable-windows-prefix-delegation: \"true\"</code>\ud56d\ubaa9\uc744 \ucd94\uac00\ud558\uc5ec \ud65c\uc131\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud574\ub2f9 \ucee8\ud53c\uadf8\ub9f5\uc740 \uc708\ub3c4\uc6b0 \uc9c0\uc6d0\uc744 \ud65c\uc131\ud654\ud558\uae30 \uc704\ud574 <code>enable-windows-ipam: \"true\"</code> \ud56d\ubaa9\uc744 \uc124\uc815\ud588\ub358 \uac83\uacfc \ub3d9\uc77c\ud55c \ucee8\ud53c\uadf8\ub9f5\uc785\ub2c8\ub2e4.</p> <p>EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\uc5d0 \uc124\uba85\ub41c \uc548\ub0b4\uc5d0 \ub530\ub77c \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0 \ub300\ud574 Prefix Delegation \ubaa8\ub4dc\ub97c \ud65c\uc131\ud654\ud569\ub2c8\ub2e4.</p> <p></p> <p>\uadf8\ub9bc: \ubcf4\uc870 IP \ubaa8\ub4dc\uc640 Prefix Delegation \ubaa8\ub4dc\uc758 \ube44\uad50 </p> <p>\ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 IP \uc8fc\uc18c \uc218\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uacfc \ud06c\uae30\uc5d0 \ub530\ub77c \ub2e4\ub985\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ub41c \uac01 Prefix\ub294 \uac00\uc6a9 \uc2ac\ub86f\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, <code>c5.large</code> \uc778\uc2a4\ud134\uc2a4\ub294 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub2f9 <code>10</code> \uc2ac\ub86f\uc73c\ub85c \uc81c\ud55c\ub429\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc758 \uccab \ubc88\uc9f8 \uc2ac\ub86f\uc740 \ud56d\uc0c1 \uc778\ud130\ud398\uc774\uc2a4\uc758 \uae30\ubcf8 IP \uc8fc\uc18c\ub85c \uc0ac\uc6a9\ub418\ubbc0\ub85c Prefix \ubc0f/\ub610\ub294 \ubcf4\uc870 IP \uc8fc\uc18c\ub97c \uc704\ud55c \uc2ac\ub86f\uc774 9\uac1c\ub9cc \ub0a8\uac8c \ub429\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc2ac\ub86f\uc5d0 Prefix\uac00 \ud560\ub2f9\ub41c \uacbd\uc6b0 \ub178\ub4dc\ub294 (9 * 16) 144 IP \uc8fc\uc18c\ub97c \uc9c0\uc6d0\ud560 \uc218 \uc788\uc9c0\ub9cc \ubcf4\uc870 IP \uc8fc\uc18c\uac00 \ud560\ub2f9\ub41c \uacbd\uc6b0 9\uac1c\uc758 IP \uc8fc\uc18c\ub9cc \uc9c0\uc6d0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\ubcc4 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub2f9 IP \uc8fc\uc18c \ubc0f \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 Prefix \ud560\ub2f9 \uc124\uba85\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>\uc6cc\ucee4 \ub178\ub4dc \ucd08\uae30\ud654 \uc911\uc5d0 VPC \ub9ac\uc18c\uc2a4 \ucee8\ud2b8\ub864\ub7ec\ub294 IP \uc8fc\uc18c\uc758 \uc6dc \ud480\uc744 \uc720\uc9c0\ud558\uc5ec \ud30c\ub4dc \uc2dc\uc791 \uc18d\ub3c4\ub97c \ub192\uc774\uae30 \uc704\ud574 \uae30\ubcf8 ENI\uc5d0 \ud558\ub098 \uc774\uc0c1\uc758 Prefix\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc6dc \ud480\uc5d0 \ubcf4\uad00\ud560 Prefix \uc218\ub294 <code>amazon-vpc-cni</code> \ucee8\ud53c\uadf8\ub9f5\uc5d0\uc11c \ub2e4\uc74c \uad6c\uc131 \ub9e4\uac1c\ubcc0\uc218\ub97c \uad6c\uc131\ud558\uc5ec \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li><code>warm-prefix-target</code>, \ud604\uc7ac \ud544\uc694 \uc218\ub7c9\uc744 \ucd08\uacfc\ud558\uc5ec \ud560\ub2f9\ud560 Prefix \uc218</li> <li><code>warm-ip-target</code>, \ud604\uc7ac \ud544\uc694 \uc218\ub7c9\uc744 \ucd08\uacfc\ud558\uc5ec \ud560\ub2f9\ud560 IP \uc8fc\uc18c \uc218</li> <li><code>minimum-ip-target</code>, \uc5b8\uc81c\ub4e0\uc9c0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ucd5c\uc18c IP \uc8fc\uc18c \uc218</li> <li><code>warm-ip-target</code> \ubc0f/\ub610\ub294 <code>minimum-ip-target</code> \uac00 \uc801\uc6a9\ub41c \uacbd\uc6b0, <code>warm-prefix-target</code>\ub97c \uc624\ubc84\ub77c\uc774\ub4dc\ud569\ub2c8\ub2e4.</li> </ul> <p>\ub178\ub4dc\uc5d0 \ub354 \ub9ce\uc740 \ud30c\ub4dc\uac00 \uc2a4\ucf00\uc904\ub9c1\ub418\uba74 \uae30\uc874 ENI\uc5d0 \ub300\ud574 \ucd94\uac00 Prefix\uac00 \uc694\uccad\ub429\ub2c8\ub2e4. \ub178\ub4dc\uc5d0 \ud30c\ub4dc\uac00 \uc2a4\ucf00\uc904\ub9c1\ub418\uba74 VPC \ub9ac\uc18c\uc2a4 \ucee8\ud2b8\ub864\ub7ec\ub294 \uba3c\uc800 \ub178\ub4dc\uc758 \uae30\uc874 Prefix\uc5d0\uc11c IPv4 \uc8fc\uc18c\ub97c \ud560\ub2f9\ud558\ub824\uace0 \uc2dc\ub3c4\ud569\ub2c8\ub2e4. \ub9cc\uc57d \ubd88\uac00\ud55c \uacbd\uc6b0, \uc11c\ube0c\ub137\uc5d0 \ud544\uc694\ud55c \uc6a9\ub7c9\uc774 \uc788\ub294 \ud55c\ub3c4 \ub0b4\uc5d0\uc11c \uc2e0\uaddc IPv4 Prefix\uac00 \uc694\uccad\ub429\ub2c8\ub2e4.</p> <p></p> <p>\uadf8\ub9bc: IPv4 \uc8fc\uc18c\ub97c Pod\uc5d0 \ud560\ub2f9\ud558\ub294 \ub3d9\uc548\uc758 \uc6cc\ud06c\ud50c\ub85c</p>"},{"location":"ko/networking/prefix-mode/index_windows/#_1","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/networking/prefix-mode/index_windows/#prefix-delegation","title":"\ub2e4\uc74c\uacfc \uac19\uc740 \uacbd\uc6b0 Prefix Delegation \uc0ac\uc6a9","text":"<p>\uc6cc\ucee4 \ub178\ub4dc\uc5d0\uc11c \ud30c\ub4dc \ubc00\ub3c4 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0 Prefix Delegation\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc624\ub958\ub97c \ubc29\uc9c0\ud558\ub824\uba74 Prefix \ubaa8\ub4dc\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\uae30 \uc804\uc5d0 \uc11c\ube0c\ub137\uc5d0\uc11c /28 Prefix\uc758 \uc5f0\uc18d\ub41c \uc8fc\uc18c \ube14\ub85d\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc11c\ube0c\ub137 \uc608\uc57d \uc138\ubd80 \uc815\ubcf4\ub294 \u201c\uc11c\ube0c\ub137 \uc608\uc57d\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc11c\ube0c\ub137 \ud30c\ud3b8\ud654(IPv4) \ubc29\uc9c0\u201d \uc139\uc158\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4. </p> <p>\uae30\ubcf8\uc801\uc73c\ub85c \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc758 <code>max-pods</code>\ub294 <code>110</code>\uc73c\ub85c \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ub300\ubd80\ubd84\uc758 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0\uc11c\ub294 \uc774 \uc815\ub3c4\uba74 \ucda9\ubd84\ud569\ub2c8\ub2e4. \ud574\ub2f9 \ud55c\ub3c4\ub97c \ub298\ub9ac\uac70\ub098 \uc904\uc774\ub824\uba74 \uc0ac\uc6a9\uc790 \ub370\uc774\ud130(User data)\uc758 \ubd80\ud2b8\uc2a4\ud2b8\ub7a9 \uba85\ub839\uc5b4\uc5d0 \ub2e4\uc74c\uc744 \ucd94\uac00\ud558\uc138\uc694. <pre><code>-KubeletExtraArgs '--max-pods=example-value'\n</code></pre> \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc758 \ubd80\ud2b8\uc2a4\ud2b8\ub7a9 \uad6c\uc131 \ub9e4\uac1c \ubcc0\uc218\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc774 \ub9c1\ud06c\uc758 \uc124\uba85\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_windows/#prefix-delegation_1","title":"\ub2e4\uc74c\uacfc \uac19\uc740 \uacbd\uc6b0 Prefix Delegation\uc744 \uad8c\uc7a5\ud558\uc9c0 \uc54a\uc74c","text":"<p>\uc11c\ube0c\ub137\uc774 \ub9e4\uc6b0 \ud30c\ud3b8\ud654\ub418\uc5b4 \uc788\uace0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c\uac00 \ubd80\uc871\ud558\uc5ec /28 Prefix\ub97c \ub9cc\ub4e4 \uc218 \uc5c6\ub294 \uacbd\uc6b0\uc5d0\ub294 Prefix \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624. Prefix\uac00 \uc0dd\uc131\ub418\ub294 \uc11c\ube0c\ub137\uc774 \ud30c\ud3b8\ud654 \ub41c \uacbd\uc6b0(\uc0ac\uc6a9\ub7c9\uc774 \ub9ce\uace0 \ubcf4\uc870 IP \uc8fc\uc18c\uac00 \ud769\uc5b4\uc838 \uc788\ub294 \uc11c\ube0c\ub137), Prefix \uc5f0\uacb0\uc5d0 \uc2e4\ud328\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2e0\uaddc \uc11c\ube0c\ub137\uc744 \ub9cc\ub4e4\uace0 Prefix\ub97c \uc608\uc57d\ud558\uba74 \uc774 \ubb38\uc81c\ub97c \ud53c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_windows/#ipv4-prefix-delegation","title":"IPv4 \uc8fc\uc18c\ub97c \ubcf4\uc874\ud558\ub3c4\ub85d Prefix Delegation \ub9e4\uac1c \ubcc0\uc218 \uad6c\uc131","text":"<p><code>warm-prefix-target</code>, <code>warm-ip-target</code> \ubc0f <code>minimum-ip-target</code>\uc740 Prefix\ub97c \uc0ac\uc6a9\ud55c \uc0ac\uc804 \uc2a4\ucf00\uc77c\ub9c1 \ubc0f \ub3d9\uc801 \uc2a4\ucf00\uc77c\ub9c1\uc758 \ub3d9\uc791\uc744 \ubbf8\uc138\uc870\uc815\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \ub2e4\uc74c\uacfc \uac19\uc740 \uac12\uc774 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. <pre><code>warm-ip-target: \"1\"\nminimum-ip-target: \"3\"\n</code></pre> \uc774\ub7ec\ud55c \uad6c\uc131 \ud30c\ub77c\ubbf8\ud130\ub97c \ubbf8\uc138 \uc870\uc815\ud558\uba74 IP \uc8fc\uc18c \ubcf4\uc874\uacfc IP \uc8fc\uc18c \ud560\ub2f9\uc73c\ub85c \uc778\ud55c \ud30c\ub4dc \uc9c0\uc5f0 \uc2dc\uac04 \uac10\uc18c \uc0ac\uc774\uc5d0\uc11c \ucd5c\uc801\uc758 \uade0\ud615\uc744 \uc774\ub8f0 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uad6c\uc131 \ub9e4\uac1c\ubcc0\uc218\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc774 \ub9c1\ud06c\uc758 \uc124\uba85\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_windows/#ipv4","title":"\uc11c\ube0c\ub137 \uc608\uc57d\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc11c\ube0c\ub137 \ud30c\ud3b8\ud654 (IPv4) \ub97c \ubc29\uc9c0","text":"<p>EC2\uac00 ENI\uc5d0 /28 IPv4 Prefix\ub97c \ud560\ub2f9\ud560 \uacbd\uc6b0, \ud574\ub2f9 Prefix\ub294 \uc11c\ube0c\ub137\uc758 \uc5f0\uc18d\ub41c IP \uc8fc\uc18c \ube14\ub85d\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4. Prefix\uac00 \uc0dd\uc131\ub418\ub294 \uc11c\ube0c\ub137\uc774 \ud30c\ud3b8\ud654\ub41c \uacbd\uc6b0 (\ubcf4\uc870 IP \uc8fc\uc18c\uac00 \ud769\uc5b4\uc838 \uc788\uace0 \ub9ce\uc774 \uc0ac\uc6a9\ub418\ub294 \uc11c\ube0c\ub137) Prefix \uc5f0\uacb0\uc5d0 \uc2e4\ud328\ud560 \uc218 \uc788\uc73c\uba70 \ub2e4\uc74c\uacfc \uac19\uc740 \ub178\ub4dc \uc774\ubca4\ud2b8\uac00 \ud45c\uc2dc\ub429\ub2c8\ub2e4. <pre><code>InsufficientCidrBlocks: The specified subnet does not have enough free cidr blocks to satisfy the request\n</code></pre> \ud30c\ud3b8\ud654\ub97c \ubc29\uc9c0\ud558\uace0 Prefix\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\ub294 \ucda9\ubd84\ud55c \uc5f0\uc18d \uacf5\uac04\uc744 \ud655\ubcf4\ud558\ub824\uba74 VPC \uc11c\ube0c\ub137 CIDR \uc608\uc57d\uc744 \uc0ac\uc6a9\ud558\uc5ec Prefix\ub9cc \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \uc11c\ube0c\ub137 \ub0b4 IP \uacf5\uac04\uc744 \uc608\uc57d\ud569\ub2c8\ub2e4. \uc608\uc57d\uc744 \uc0dd\uc131\ud55c \ud6c4\uc5d0\ub294 \uc608\uc57d\ub41c \ube14\ub85d\uc758 IP \uc8fc\uc18c\uac00 \ub2e4\ub978 \ub9ac\uc18c\uc2a4\uc5d0 \ud560\ub2f9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 VPC \ub9ac\uc18c\uc2a4 \ucee8\ud2b8\ub864\ub7ec\uac00 \ub178\ub4dc ENI\uc5d0 \ub300\ud55c \ud560\ub2f9 \uc791\uc5c5 \ud638\ucd9c \uc911\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c Prefix\ub97c \uac00\uc838\uc62c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc2e0\uaddc \uc11c\ube0c\ub137\uc744 \ub9cc\ub4e4\uace0, Prefix\ub97c \uc704\ud55c \uacf5\uac04\uc744 \uc608\uc57d\ud558\uace0, \ud574\ub2f9 \uc11c\ube0c\ub137\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 Prefix \ud560\ub2f9\uc744 \ud65c\uc131\ud654\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc2e0\uaddc \uc11c\ube0c\ub137\uc774 Prefix Delegation\uc774 \ud65c\uc131\ud654\ub41c \uc0c1\ud0dc\uc758 EKS \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ud30c\ub4dc \uc804\uc6a9\uc77c \uacbd\uc6b0, Prefix \uc608\uc57d \ub2e8\uacc4\ub97c \uac74\ub108\ub6f8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/prefix-mode/index_windows/#ip-prefix-delegation","title":"\ubcf4\uc870 IP \ubaa8\ub4dc\uc5d0\uc11c Prefix Delegation \ubaa8\ub4dc\ub85c \ub610\ub294 \uadf8 \ubc18\ub300\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud560 \uacbd\uc6b0 \ubaa8\ub4e0 \ub178\ub4dc\ub97c \uad50\uccb4","text":"<p>\uae30\uc874 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc21c\ucc28\uc801\uc73c\ub85c \uad50\uccb4\ud558\ub294 \ub300\uc2e0 \uc2e0\uaddc \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\uc5ec \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c \uc218\ub97c \ub298\ub9b4 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p> <p>\uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ub2e8\uacc4\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uc0c8 \ub178\ub4dc\uac00 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc218\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud074\ub7ec\uc2a4\ud130\uc758 \uc6a9\ub7c9\uc744 \uc99d\uc124\ud569\ub2c8\ub2e4.</li> <li>\uc708\ub3c4\uc6b0\uc6a9 Prefix Delegation \uae30\ub2a5\uc744 \ud65c\uc131\ud654/\ube44\ud65c\uc131\ud654\ud569\ub2c8\ub2e4.</li> <li>\uae30\uc874 \ub178\ub4dc\ub97c \ubaa8\ub450 \ucc28\ub2e8\ud558\uace0 drain\ud558\uc5ec \uae30\uc874 \ud30c\ub4dc\ub97c \uc548\uc804\ud558\uac8c \uc81c\uac70\ud569\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uc911\ub2e8\uc744 \ubc29\uc9c0\ud558\ub824\uba74 \uc911\uc694\ud55c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc704\ud574 \ud504\ub85c\ub355\uc158 \ud074\ub7ec\uc2a4\ud130\uc5d0 Pod Disruption Budgets\ub97c \uc801\uc6a9\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</li> <li>\ud30c\ub4dc\uac00 \uc2e4\ud589\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud55c \ud6c4\uc5d0 \uc774\uc804 \ub178\ub4dc\uc640 \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0ad\uc81c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2e0\uaddc \ub178\ub4dc\uc758 \ud30c\ub4dc\uc5d0\ub294 \ub178\ub4dc ENI\uc5d0 \ud560\ub2f9\ub41c Prefix\uc758 IPv4 \uc8fc\uc18c\uac00 \ud560\ub2f9\ub429\ub2c8\ub2e4.</li> </ul> <p>\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ub2e8\uacc4\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uc708\ub3c4\uc6b0\uc6a9 Prefix Delegation \uae30\ub2a5\uc744 \ud65c\uc131\ud654/\ube44\ud65c\uc131\ud654\ud569\ub2c8\ub2e4.</li> <li>\uc774 \ub9c1\ud06c\uc5d0 \uc124\uba85\ub41c \ub2e8\uacc4\ub97c \ub530\ub77c \ub178\ub4dc \uadf8\ub8f9\uc744 \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4. \uc774 \uc808\ucc28\ub294 \uc704\uc640 \ube44\uc2b7\ud55c \ub2e8\uacc4\ub97c \uc218\ud589\ud558\uc9c0\ub9cc EKS\uc5d0\uc11c \uad00\ub9ac\ub429\ub2c8\ub2e4.</li> </ul> <p>Warning</p> <p>\ub178\ub4dc\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \ub3d9\uc77c\ud55c \ubaa8\ub4dc\ub85c \uc2e4\ud589\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p> <p>\uc708\ub3c4\uc6b0\uc758 \uacbd\uc6b0, \ubcf4\uc870 IP \ubaa8\ub4dc\uc640 Prefix Delegation \ubaa8\ub4dc\uc5d0\uc11c \ub3d9\uc2dc\uc5d0 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\uc9c0 \uc54a\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc0c1\ud669\uc740 \uc708\ub3c4\uc6b0 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uc0c1\ud0dc\uc5d0\uc11c \ubcf4\uc870 IP \ubaa8\ub4dc\uc5d0\uc11c Prefix Delegation \ubaa8\ub4dc\ub85c \ub610\ub294 \uadf8 \ubc18\ub300\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud560 \ub54c \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774\ub294 \uc2e4\ud589 \uc911\uc778 \ud30c\ub4dc\uc5d0 \uc601\ud5a5\uc744 \uc8fc\uc9c0\ub294 \uc54a\uc9c0\ub9cc, \ub178\ub4dc\uc758 IP \uc8fc\uc18c \uc6a9\ub7c9\uacfc \uad00\ub828\ud558\uc5ec \ubd88\uc77c\uce58\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ubcf4\uc870 IPv4 \uc8fc\uc18c\uc6a9 \uc2ac\ub86f\uc774 14\uac1c \uc788\ub294 t3.xlarge \ub178\ub4dc\ub97c \uc608\ub85c \ub4e4\uc5b4 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. 10\uac1c\uc758 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0, ENI\uc758 \uc2ac\ub86f 10\uac1c\uac00 \ubcf4\uc870 IP \uc8fc\uc18c\ub85c \uc0ac\uc6a9\ub429\ub2c8\ub2e4. Prefix Delegation\uc744 \ud65c\uc131\ud654\ud558\uba74 kube-api \uc11c\ubc84\uc5d0 \uad11\uace0\ub418\ub294 \uc6a9\ub7c9\uc740 (\uc2ac\ub86f 14\uac1c * Prefix\ub2f9 16\uac1c\uc758 IP \uc8fc\uc18c) 244\uac1c\uac00 \ub418\uc9c0\ub9cc, \ud574\ub2f9 \uc2dc\uc810\uc758 \uc2e4\uc81c \uc6a9\ub7c9\uc740 (\ub0a8\uc740 \uc2ac\ub86f 4\uac1c * Prefix\ub2f9 16\uac1c \uc8fc\uc18c) 64\uac1c\uac00 \ub429\ub2c8\ub2e4. \uc54c\ub824\uc9c4 \uc6a9\ub7c9\uacfc \uc2e4\uc81c \uc6a9\ub7c9(\ub0a8\uc740 \uc2ac\ub86f)\uac04\uc758 \uc774\ub7ec\ud55c \ubd88\uc77c\uce58\ub85c \uc778\ud574 \ud560\ub2f9\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 IP \uc8fc\uc18c\ubcf4\ub2e4 \ub9ce\uc740 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\ub9cc, \uc704\uc5d0\uc11c \uc124\uba85\ud55c \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc804\ub7b5\uc744 \ud65c\uc6a9\ud558\uc5ec \ud30c\ub4dc\ub97c \ubcf4\uc870 IP \uc8fc\uc18c\uc5d0\uc11c Prefix\uc5d0\uc11c \uc5bb\uc740 \uc8fc\uc18c\ub85c \uc548\uc804\ud558\uac8c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubaa8\ub4dc\ub97c \ubcc0\uacbd\ud574\ub3c4 \ud30c\ub4dc\ub294 \uc815\uc0c1\uc801\uc73c\ub85c \uacc4\uc18d \uc2e4\ud589\ub418\uba70 \ub2e4\uc74c\uacfc \uac19\uc774 \ub3d9\uc791\ud569\ub2c8\ub2e4.</p> <ul> <li>\ubcf4\uc870 IP \ubaa8\ub4dc\uc5d0\uc11c Prefix Delegation \ubaa8\ub4dc\ub85c \uc804\ud658\ud560 \ub54c \uc2e4\ud589 \uc911\uc778 \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub41c \ubcf4\uc870 IP \uc8fc\uc18c\ub294 \ud574\uc81c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ube48 \uc2ac\ub86f\uc5d0\ub294 Prefix\uac00 \ud560\ub2f9\ub429\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \uc885\ub8cc\ub418\uba74 \uc0ac\uc6a9\ud558\ub358 \ubcf4\uc870 IP\uc640 \uc2ac\ub86f\uc774 \ud574\uc81c\ub429\ub2c8\ub2e4.</li> <li>Prefix Delegation \ubaa8\ub4dc\uc5d0\uc11c \ubcf4\uc870 IP \ubaa8\ub4dc\ub85c \uc804\ud658\ud560 \uacbd\uc6b0, \ud574\ub2f9 \ubc94\uc704 \ub0b4\uc758 \ubaa8\ub4e0 IP\uac00 \ub354 \uc774\uc0c1 \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub418\uc9c0 \uc54a\uc744 \uacbd\uc6b0 Prefix\uac00 \ud574\uc81c\ub429\ub2c8\ub2e4. Prefix\uc758 IP\uac00 \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub41c \uacbd\uc6b0, \ud574\ub2f9 Prefix\ub294 \ud30c\ub4dc\uac00 \uc885\ub8cc\ub420 \ub54c\uae4c\uc9c0 \uc720\uc9c0\ub429\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/networking/prefix-mode/index_windows/#prefix-delegation_2","title":"Prefix Delegation \uad00\ub828 \ub514\ubc84\uae45 \ubb38\uc81c","text":"<p>\uc774 \ub9c1\ud06c\uc758 \ub514\ubc84\uae45 \uac00\uc774\ub4dc\ub97c \ud65c\uc6a9\ud558\uc5ec \uc708\ub3c4\uc6b0\uc5d0\uc11c \uc9c1\uba74\ud558\uace0 \uc788\ub294 Prefix Delegation\uc640 \uad00\ub828\ub41c \ubb38\uc81c\ub97c \uc790\uc138\ud788 \uc0b4\ud3b4\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/","title":"VPC \ubc0f \uc11c\ube0c\ub137 \uace0\ub824 \uc0ac\ud56d","text":"<p>EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc6b4\uc601\ud558\ub824\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud0b9 \uc678\uc5d0\ub3c4 AWS VPC \ub124\ud2b8\uc6cc\ud0b9\uc5d0 \ub300\ud55c \uc9c0\uc2dd\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.</p> <p>VPC\ub97c \uc124\uacc4\ud558\uac70\ub098 \uae30\uc874 VPC\uc5d0 \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud558\uae30 \uc804\uc5d0 EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ud1b5\uc2e0 \uba54\ucee4\ub2c8\uc998\uc744 \uc774\ud574\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p> <p>EKS\uc5d0\uc11c \uc0ac\uc6a9\ud560 VPC\uc640 \uc11c\ube0c\ub137\uc744 \uc124\uacc4\ud560 \ub54c\ub294 \ud074\ub7ec\uc2a4\ud130 VPC \uace0\ub824 \uc0ac\ud56d \ubc0f Amazon EKS \ubcf4\uc548 \uadf8\ub8f9 \uace0\ub824 \uc0ac\ud56d\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_1","title":"\uac1c\uc694","text":""},{"location":"ko/networking/subnets/#eks","title":"EKS \ud074\ub7ec\uc2a4\ud130 \uc544\ud0a4\ud14d\ucc98","text":"<p>EKS \ud074\ub7ec\uc2a4\ud130\ub294 \ub450 \uac1c\uc758 VPC\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. </p> <ul> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ud638\uc2a4\ud305\ud558\ub294 AWS \uad00\ub9ac\ud615 VPC. \uc774 VPC\ub294 \uace0\uac1d \uacc4\uc815\uc5d0 \ud45c\uc2dc\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. </li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc\ub97c \ud638\uc2a4\ud305\ud558\ub294 \uace0\uac1d \uad00\ub9ac\ud615 VPC. \uc5ec\uae30\uc5d0\uc11c \ucee8\ud14c\uc774\ub108\ub294 \ubb3c\ub860 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ub85c\ub4dc \ubc38\ub7f0\uc11c\uc640 \uac19\uc740 \uae30\ud0c0 \uace0\uac1d \uad00\ub9ac\ud615 AWS \uc778\ud504\ub77c\uac00 \uc2e4\ud589\ub429\ub2c8\ub2e4. \uc774 VPC\ub294 \uace0\uac1d \uacc4\uc815\uc5d0 \ud45c\uc2dc\ub429\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uae30 \uc804, \uace0\uac1d \uad00\ub9ac\ud615 VPC\ub97c \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \uc0ac\uc6a9\uc790\uac00 VPC\ub97c \uc81c\uacf5\ud558\uc9c0 \uc54a\uc744 \uacbd\uc6b0 eksctl\uc774 VPC\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4.</li> </ul> <p>\uace0\uac1d VPC\uc758 \ub178\ub4dc\ub294 AWS VPC\uc758 \uad00\ub9ac\ud615 API \uc11c\ubc84 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \ub178\ub4dc\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \ub4f1\ub85d\ub418\uace0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub77c\ub294 \uc694\uccad\uc744 \uc218\uc2e0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub178\ub4dc\ub294 (a) EKS \ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ub610\ub294 (b) EKS\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 \uad50\ucc28 \uacc4\uc815 Elastic Network Interface(X-ENI)\ub97c \ud1b5\ud574 EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \uc5f0\uacb0\ub429\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud560 \ub54c\ub294 \ucd5c\uc18c \ub450 \uac1c\uc758 VPC \uc11c\ube0c\ub137\uc744 \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. EKS\ub294 \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131 \uc2dc \uc9c0\uc815\ub41c \uac01 \uc11c\ube0c\ub137(\ud074\ub7ec\uc2a4\ud130 \uc11c\ube0c\ub137\uc774\ub77c\uace0\ub3c4 \ud568)\uc5d0 X-ENI\ub97c \ubc30\uce58\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\ub294 \uc774\ub7ec\ud55c \uad50\ucc28 \uacc4\uc815 ENI\ub97c \uc0ac\uc6a9\ud558\uc5ec \uace0\uac1d \uad00\ub9ac\ud615 \ud074\ub7ec\uc2a4\ud130 VPC \uc11c\ube0c\ub137\uc5d0 \ubc30\ud3ec\ub41c \ub178\ub4dc\uc640 \ud1b5\uc2e0\ud569\ub2c8\ub2e4. </p> <p></p> <p>\ub178\ub4dc\ub97c \uc2dc\uc791\ud558\uba74 EKS \ubd80\ud2b8\uc2a4\ud2b8\ub7a9 \uc2a4\ud06c\ub9bd\ud2b8\uac00 \uc2e4\ud589\ub418\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc \uad6c\uc131 \ud30c\uc77c\uc774 \uc124\uce58\ub429\ub2c8\ub2e4. \uac01 \uc778\uc2a4\ud134\uc2a4\uc758 \ubd80\ud305 \ud504\ub85c\uc138\uc2a4\uc758 \uc77c\ubd80\ub85c\uc368 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784 \uc5d0\uc774\uc804\ud2b8, kubelet \ubc0f \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc \uc5d0\uc774\uc804\ud2b8\uac00 \uc2dc\uc791\ub429\ub2c8\ub2e4.</p> <p>\ub178\ub4dc\ub97c \ub4f1\ub85d\ud558\uae30 \uc704\ud574 kubelet\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc811\uc18d\ud569\ub2c8\ub2e4. VPC \uc678\ubd80\uc758 \ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ub610\ub294 VPC \ub0b4\uc758 \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc640\uc758 \uc5f0\uacb0\uc744 \uc124\uc815\ud569\ub2c8\ub2e4. Kubelet\uc740 API \uba85\ub839\uc744 \uc218\uc2e0\ud558\uace0 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc0c1\ud0dc \uc5c5\ub370\uc774\ud2b8 \ubc0f \ud558\ud2b8\ube44\ud2b8\ub97c \uc815\uae30\uc801\uc73c\ub85c \uc81c\uacf5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#eks_1","title":"EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ud1b5\uc2e0","text":"<p>EKS\uc5d0\ub294 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \ub300\ud55c \uc811\uadfc\uc744 \uc81c\uc5b4\ud558\ub294 \ub450 \uac00\uc9c0 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc811\uadfc \uc81c\uc5b4\ub97c \ud1b5\ud574 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uac00 \ud37c\ube14\ub9ad \uc778\ud130\ub137\uc744 \ud1b5\ud574 \uc811\uadfc\ud560 \uc218 \uc788\ub294\uc9c0 \uc544\ub2c8\uba74 VPC\ub97c \ud1b5\ud574\uc11c\ub9cc \uc811\uadfc\ud560 \uc218 \uc788\ub294\uc9c0 \uc5ec\ubd80\ub97c \uc120\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8(\uae30\ubcf8\uac12), \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ub610\ub294 \ub458 \ub2e4\ub97c \ud55c \ubc88\uc5d0 \ud65c\uc131\ud654 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ud074\ub7ec\uc2a4\ud130 API \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc758 \uad6c\uc131\uc740 \ub178\ub4dc\uac00 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ud1b5\uc2e0\ud558\uae30 \uc704\ud55c \uacbd\ub85c\ub97c \uacb0\uc815\ud569\ub2c8\ub2e4. \ucc38\uace0\ub85c \uc774\ub7ec\ud55c \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc124\uc815\uc740 EKS \ucf58\uc194 \ub610\ub294 API\ub97c \ud1b5\ud574 \uc5b8\uc81c\ub4e0\uc9c0 \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_2","title":"\ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8","text":"<p>\ud574\ub2f9 \uad6c\uc131\uc740 \uc2e0\uaddc Amazon EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uae30\ubcf8 \ub3d9\uc791\uc785\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc758 \ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub9cc \ud65c\uc131\ud654\ub41c \uacbd\uc6b0 \ud074\ub7ec\uc2a4\ud130\uc758 VPC \ub0b4\uc5d0\uc11c \uc2dc\uc791\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc694\uccad(\uc608: \uc6cc\ucee4\ub178\ub4dc\uc5d0\uc11c \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc73c\ub85c\uc758 \ud1b5\uc2e0)\uc740 VPC \uc678\ubd80\ub85c \uac00\uc9c0\ub9cc Amazon \ub124\ud2b8\uc6cc\ud06c \uc678\ubd80\ub85c\ub294 \uac00\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub178\ub4dc\uac00 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \uc5f0\uacb0\ub418\ub824\uba74 \ud37c\ube14\ub9ad IP \uc8fc\uc18c \ubc0f \uc778\ud130\ub137 \uac8c\uc774\ud2b8\uc6e8\uc774\uc5d0 \ub300\ud55c \uacbd\ub85c \ub610\ub294 NAT \uac8c\uc774\ud2b8\uc6e8\uc774\uc758 \ud37c\ube14\ub9ad IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 NAT \uac8c\uc774\ud2b8\uc6e8\uc774\uc5d0 \ub300\ud55c \uacbd\ub85c\uac00 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_3","title":"\ud37c\ube14\ub9ad \ubc0f \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8","text":"<p>\ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc640 \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uac00 \ubaa8\ub450 \ud65c\uc131\ud654\ub418\uba74 VPC \ub0b4\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc694\uccad\uc774 VPC \ub0b4\uc758 X-ENI\ub97c \ud1b5\ud574 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ud1b5\uc2e0\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 API \uc11c\ubc84\ub294 \uc778\ud130\ub137\uc5d0\uc11c \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_4","title":"\ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8","text":"<p>\ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub9cc \ud65c\uc131\ud654\ub41c \uacbd\uc6b0 \uc778\ud130\ub137\uc5d0\uc11c API \uc11c\ubc84\uc5d0 \uacf5\uac1c\uc801\uc73c\ub85c \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 API \uc11c\ubc84\ub85c \ud5a5\ud558\ub294 \ubaa8\ub4e0 \ud2b8\ub798\ud53d\uc740 \ud074\ub7ec\uc2a4\ud130\uc758 VPC \ub610\ub294 \uc5f0\uacb0\ub41c \ub124\ud2b8\uc6cc\ud06c \uc548\uc5d0\uc11c \ub4e4\uc5b4\uc640\uc57c \ud569\ub2c8\ub2e4. \ub178\ub4dc\ub294 VPC \ub0b4\uc758 X-ENI\ub97c \ud1b5\ud574 API \uc11c\ubc84\uc640 \ud1b5\uc2e0\ud569\ub2c8\ub2e4. \ub2e8, \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac \ub3c4\uad6c\ub294 \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. Amazon VPC \uc678\ubd80\uc5d0\uc11c \ud504\ub77c\uc774\ube57 Amazon EKS \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc5f0\uacb0\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubd05\ub2c8\ub2e4.</p> <p>\ucc38\uace0\ub85c \ud074\ub7ec\uc2a4\ud130\uc758 API \uc11c\ubc84 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub294 \ud37c\ube14\ub9ad DNS \uc11c\ubc84\uc5d0\uc11c VPC\uc758 \ud504\ub77c\uc774\ube57 IP \uc8fc\uc18c\ub85c \ub9ac\uc878\ube0c\ub429\ub2c8\ub2e4. \uacfc\uac70\uc5d0\ub294 VPC \ub0b4\uc5d0\uc11c\ub9cc \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ub9ac\uc878\ube0c\ud560 \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#vpc_1","title":"VPC \uad6c\uc131","text":"<p>Amazon VPC\ub294 IPv4 \ubc0f IPv6 \uc8fc\uc18c\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. Amazon EKS\ub294 \uae30\ubcf8\uc801\uc73c\ub85c IPv4\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. VPC\uc5d0\ub294 IPv4 CIDR \ube14\ub85d\uc774 \uc5f0\uacb0\ub418\uc5b4 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc120\ud0dd\uc801\uc73c\ub85c \uc5ec\ub7ec IPv4 Classless Inter-Domain Routing(CIDR) \ube14\ub85d\uacfc \uc5ec\ub7ec IPv6 CIDR \ube14\ub85d\uc744 VPC\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. VPC\ub97c \uc0dd\uc131\ud560 \uacbd\uc6b0 RFC 1918\uc5d0 \uc9c0\uc815\ub41c \ud504\ub77c\uc774\ube57 IPv4 \uc8fc\uc18c \ubc94\uc704\uc5d0\uc11c VPC\uc5d0 \ub300\ud55c IPv4 CIDR \ube14\ub85d\uc744 \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \ud5c8\uc6a9\ub418\ub294 \ube14\ub85d \ud06c\uae30\ub294 <code>/16</code> Prefix(65,536\uac1c\uc758 IP \uc8fc\uc18c)\uc640 <code>/28</code> Prefix(16\uac1c\uc758 IP \uc8fc\uc18c) \uc0ac\uc774\uc785\ub2c8\ub2e4. </p> <p>\uc2e0\uaddc VPC\ub97c \ub9cc\ub4e4 \ub54c\ub294 \ud558\ub098\uc758 IPv6 CIDR \ube14\ub85d\uc744 \uc5f0\uacb0\ud560 \uc218 \uc788\uc73c\uba70, \uae30\uc874 VPC\ub97c \ubcc0\uacbd\ud560 \ub54c\ub294 \ucd5c\ub300 5\uac1c\uae4c\uc9c0 \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. IPv6 VPC\uc758 CIDR \ube14\ub85d\uc758 Prefix \uae38\uc774\ub294 1\uc870 \uac1c \uc774\uc0c1\uc758 IP \uc8fc\uc18c\ub97c \uac00\uc9c4 /64\ub85c \uace0\uc815\ub429\ub2c8\ub2e4. Amazon\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 IPv6 \uc8fc\uc18c \ud480\uc5d0\uc11c IPv6 CIDR \ube14\ub85d\uc744 \uc694\uccad\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Amazon EKS \ud074\ub7ec\uc2a4\ud130\ub294 IPv4\uc640 IPv6\ub97c \ubaa8\ub450 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c EKS \ud074\ub7ec\uc2a4\ud130\ub294 IPv4 IP\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131 \uc2dc IPv6\uc744 \uc9c0\uc815\ud558\uba74 IPv6 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. IPv6 \ud074\ub7ec\uc2a4\ud130\uc5d0\ub294 \ub4c0\uc5bc \uc2a4\ud0dd VPC\uc640 \uc11c\ube0c\ub137\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.</p> <p>Amazon EKS\ub294 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\ub294 \ub3d9\uc548 \uc11c\ub85c \ub2e4\ub978 \uac00\uc6a9 \uc601\uc5ed\uc5d0 \uc788\ub294 \uc11c\ube0c\ub137\uc744 \ub450 \uac1c \uc774\uc0c1 \uc0ac\uc6a9\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud560 \ub54c \uc804\ub2ec\ud558\ub294 \uc11c\ube0c\ub137\uc744 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube0c\ub137\uc774\ub77c\uace0 \ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud560 \ub54c Amazon EKS\ub294 \uc9c0\uc815\ud55c \uc11c\ube0c\ub137\uc5d0 \ucd5c\ub300 4\uac1c\uc758 \uad50\ucc28 \uacc4\uc815(x-account \ub610\ub294 x-ENIs) ENI\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4.x-ENI\ub294 \ud56d\uc0c1 \ubc30\ud3ec\ub418\uba70 \ub85c\uadf8 \uc804\uc1a1, \uc2e4\ud589 \ubc0f \ud504\ub85d\uc2dc\uc640 \uac19\uc740 \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac \ud2b8\ub798\ud53d\uc5d0 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc804\uccb4 VPC \ubc0f \uc11c\ube0c\ub137 \uc694\uad6c \uc0ac\ud56d \uc138\ubd80 \uc815\ubcf4\ub294 EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4. </p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6cc\ucee4 \ub178\ub4dc\ub294 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube0c\ub137\uc5d0\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\uc9c0\ub9cc \uad8c\uc7a5\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc \uc911\uc5d0 Amazon EKS\ub294 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube0c\ub137\uc5d0 \ucd94\uac00 ENI\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uac00 \ud655\uc7a5\ub418\uba74 \uc6cc\ucee4 \ub178\ub4dc\uc640 \ud30c\ub4dc\uac00 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube0c\ub137\uc5d0\uc11c \uac00\uc6a9 IP\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP\ub97c \ucda9\ubd84\ud788 \ud655\ubcf4\ud558\ub824\uba74 /28 \ub137\ub9c8\uc2a4\ud06c\uac00 \uc788\ub294 \uc804\uc6a9 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube0c\ub137 \uc0ac\uc6a9\uc744 \uace0\ub824\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6cc\ucee4 \ub178\ub4dc\ub294 \ud37c\ube14\ub9ad \ub610\ub294 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc11c\ube0c\ub137\uc774 \ud37c\ube14\ub9ad\uc778\uc9c0 \ud504\ub77c\uc774\ube57\uc778\uc9c0\ub294 \uc11c\ube0c\ub137 \ub0b4\uc758 \ud2b8\ub798\ud53d\uc774 \uc778\ud130\ub137 \uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \ud1b5\ud574 \ub77c\uc6b0\ud305\ub418\ub294\uc9c0 \uc5ec\ubd80\ub97c \ub73b\ud569\ub2c8\ub2e4. \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc5d0\ub294 \uc778\ud130\ub137 \uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \ud1b5\ud574 \uc778\ud130\ub137\uc73c\ub85c \ub77c\uc6b0\ud305\ub418\ub294 \ub77c\uc6b0\ud2b8 \ud14c\uc774\ube14 \ud56d\ubaa9\uc774 \uc788\uc9c0\ub9cc \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\ub294 \uc5c6\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\ub978 \uacf3\uc5d0\uc11c \uc2dc\uc791\ud558\uc5ec \ub178\ub4dc\uc5d0 \ub3c4\ucc29\ud558\ub294 \ud2b8\ub798\ud53d\uc744 \uc778\uadf8\ub808\uc2a4(ingress)\ub77c\uace0 \ud569\ub2c8\ub2e4. \ub178\ub4dc\uc5d0\uc11c \uc2dc\uc791\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc678\ubd80\ub85c \uac00\ub294 \ud2b8\ub798\ud53d\uc744 \uc774\uadf8\ub808\uc2a4(egress)\ub77c\uace0 \ud569\ub2c8\ub2e4. \uc778\ud130\ub137 \uac8c\uc774\ud2b8\uc6e8\uc774\ub85c \uad6c\uc131\ub41c \uc11c\ube0c\ub137 \ub0b4\uc5d0 \ud37c\ube14\ub9ad \ub610\ub294 Elastic IP Address(EIP)\ub97c \uac00\uc9c4 \ub178\ub4dc\ub294 VPC \uc678\ubd80\ub85c\ubd80\ud130\uc758 \uc778\uadf8\ub808\uc2a4\ub97c \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\ub294 \uc77c\ubc18\uc801\uc73c\ub85c NAT \uac8c\uc774\ud2b8\uc6e8\uc774\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\ub294\ub370, \uc774 \uac8c\uc774\ud2b8\uc6e8\uc774\ub294 \ub178\ub4dc\ub85c\ubd80\ud130\uc758 \ud2b8\ub798\ud53d\uc774 VPC\ub97c \ub098\uac00\ub294 \uac83(\uc774\uadf8\ub808\uc2a4)\uc740 \ud5c8\uc6a9\ud558\uba74\uc11c VPC \ub0b4\uc5d0\uc11c \ub178\ub4dc\ub85c\uc758 \uc778\uadf8\ub808\uc2a4 \ud2b8\ub798\ud53d\ub9cc \ud5c8\uc6a9\ud569\ub2c8\ub2e4.</p> <p>IPv6 \ud658\uacbd\uc5d0\uc11c\ub294 \ubaa8\ub4e0 \uc8fc\uc18c\ub97c \uc778\ud130\ub137\uc73c\ub85c \ub77c\uc6b0\ud305\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc \ubc0f \ud30c\ub4dc\uc640 \uc5f0\uacb0\ub41c IPv6 \uc8fc\uc18c\ub294 \ud37c\ube14\ub9ad\uc785\ub2c8\ub2e4. \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc740 VPC\uc5d0 egress-only internet gateways (EIGW)\ub97c \uad6c\uc131\ud558\uc5ec \uc544\uc6c3\ubc14\uc6b4\ub4dc \ud2b8\ub798\ud53d\uc744 \ud5c8\uc6a9\ud558\ub294 \ub3d9\uc2dc\uc5d0 \ub4e4\uc5b4\uc624\ub294 \ud2b8\ub798\ud53d\uc740 \ubaa8\ub450 \ucc28\ub2e8\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c \uc9c0\uc6d0\ub429\ub2c8\ub2e4. IPv6 \uc11c\ube0c\ub137 \uad6c\ud604\uc758 \ubaa8\ubc94 \uc0ac\ub840\ub294 VPC \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#vpc_2","title":"\ub2e4\uc74c\uacfc \uac19\uc740 \uc138 \uac00\uc9c0 \ubc29\ubc95\uc73c\ub85c VPC\uc640 \uc11c\ube0c\ub137\uc744 \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.","text":""},{"location":"ko/networking/subnets/#_5","title":"\ud37c\ube14\ub9ad \uc11c\ube0c\ub137\ub9cc \uc0ac\uc6a9","text":"<p>\ub3d9\uc77c\ud55c \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc5d0\uc11c \ub178\ub4dc\uc640 \uc778\uadf8\ub808\uc2a4 \ub9ac\uc18c\uc2a4(\uc608: \ub85c\ub4dc \ubc38\ub7f0\uc11c)\uac00 \ubaa8\ub450 \uc0dd\uc131\ub429\ub2c8\ub2e4. \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc5d0 <code>kubernetes.io/role/elb</code> \ud0dc\uadf8\ub97c \uc9c0\uc815\ud558\uc5ec \uc778\ud130\ub137\uc5d0 \uc5f0\uacb0\ub41c \ub85c\ub4dc \ubc38\ub7f0\uc11c\ub97c \uad6c\uc131\ud569\ub2c8\ub2e4. \ud574\ub2f9 \uad6c\uc131\uc5d0\uc11c\ub294 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud37c\ube14\ub9ad, \ud504\ub77c\uc774\ube57 \ub610\ub294 \ub458 \ub2e4 (\ud37c\ube14\ub9ad \ubc0f \ud504\ub77c\uc774\ube57)\ub85c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_6","title":"\ud504\ub77c\uc774\ube57 \ubc0f \ud37c\ube14\ub9ad \uc11c\ube0c\ub137 \uc0ac\uc6a9","text":"<p>\ub178\ub4dc\ub294 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\uc11c \uc0dd\uc131\ub418\ub294 \ubc18\uba74, \uc778\uadf8\ub808\uc2a4 \ub9ac\uc18c\uc2a4\ub294 \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc5d0\uc11c \uc778\uc2a4\ud134\uc2a4\ud654\ub429\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \ub300\ud55c \ud37c\ube14\ub9ad, \ud504\ub77c\uc774\ube57 \ub610\ub294 \ub458 \ub2e4(\ud37c\ube14\ub9ad \ubc0f \ud504\ub77c\uc774\ube57) \uc561\uc138\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc758 \uad6c\uc131\uc5d0 \ub530\ub77c \ub178\ub4dc \ud2b8\ub798\ud53d\uc740 NAT \uac8c\uc774\ud2b8\uc6e8\uc774 \ub610\ub294 ENI\ub97c \ud1b5\ud574 \ub4e4\uc5b4\uc635\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_7","title":"\ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\ub9cc \uc0ac\uc6a9","text":"<p>\ub178\ub4dc\uc640 \uc778\uadf8\ub808\uc2a4 \ubaa8\ub450 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\uc11c \uc0dd\uc131\ub429\ub2c8\ub2e4. <code>kubernetes.io/role/internal-elb</code> \uc11c\ube0c\ub137 \ud0dc\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub0b4\ubd80\uc6a9 \ub85c\ub4dc \ubc38\ub7f0\uc11c\ub97c \uad6c\uc131\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc758 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc811\uadfc\ud558\ub824\uba74 VPN \uc5f0\uacb0\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. EC2\uc640 \ubaa8\ub4e0 Amazon ECR \ubc0f S3 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ub300\ud574 AWS PrivateLink\ub97c \ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc758 \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub9cc \ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4. \ud504\ub77c\uc774\ube57 \ud074\ub7ec\uc2a4\ud130\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uae30 \uc804 EKS \ud504\ub77c\uc774\ube57 \ud074\ub7ec\uc2a4\ud130 \uc694\uad6c \uc0ac\ud56d\uc744 \uc77d\uc5b4\ubcfc \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#vpc_3","title":"VPC\uac04 \ud1b5\uc2e0","text":"<p>\uc5ec\ub7ec \uac1c\uc758 VPC\uc640 \uc774\ub7ec\ud55c VPC\uc5d0 \ubc30\ud3ec\ub41c \ubcc4\ub3c4\uc758 EKS \ud074\ub7ec\uc2a4\ud130\ub4e4\uc774 \ud544\uc694\ud55c \uacbd\uc6b0\uac00 \ub9ce\uc774 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>Amazon VPC Lattice\ub97c \uc0ac\uc6a9\ud558\uba74 \uc5ec\ub7ec VPC\uc640 \uacc4\uc815\uc5d0\uc11c \uc11c\ube44\uc2a4\ub97c \uc77c\uad00\ub418\uace0 \uc548\uc804\ud558\uac8c \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(VPC \ud53c\uc5b4\ub9c1, AWS PrivateLink \ub610\ub294 AWS Transit Gateway\uc640 \uac19\uc740 \uc11c\ube44\uc2a4\uc5d0\uc11c \ucd94\uac00 \uc5f0\uacb0\uc744 \uc81c\uacf5\ud560 \ud544\uc694 \uc5c6\uc74c). \uc5ec\uae30\uc5d0\uc11c \uc790\uc138\ud55c \ub0b4\uc6a9\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>Amazon VPC Lattice\ub294 IPv4 \ubc0f IPv6\uc758 \ub9c1\ud06c \ub85c\uceec \uc8fc\uc18c \uacf5\uac04\uc5d0\uc11c \uc791\ub3d9\ud558\uba70, IPv4 \uc8fc\uc18c\uac00 \uacb9\uce60 \uc218 \uc788\ub294 \uc11c\ube44\uc2a4 \uac04\uc758 \uc5f0\uacb0\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc6b4\uc601 \ud6a8\uc728\uc131\uc744 \uc704\ud574 EKS \ud074\ub7ec\uc2a4\ud130\uc640 \ub178\ub4dc\ub97c \uacb9\uce58\uc9c0 \uc54a\ub294 IP \ubc94\uc704\uc5d0 \ubc30\ud3ec\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc778\ud504\ub77c\uc5d0 IP \ubc94\uc704\uac00 \uacb9\uce58\ub294 VPC\uac00 \ud3ec\ud568\ub41c \uacbd\uc6b0\uc5d0\ub294 \uadf8\uc5d0 \ub9de\uac8c \ub124\ud2b8\uc6cc\ud06c\ub97c \uc124\uacc4\ud574\uc57c \ud569\ub2c8\ub2e4. \ub77c\uc6b0\ud305 \uac00\ub2a5\ud55c RFC1918 IP \uc8fc\uc18c\ub97c \uc720\uc9c0\ud558\uba74\uc11c \uc911\ubcf5\ub418\ub294 CIDR \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 \ud504\ub77c\uc774\ube57 NAT \uac8c\uc774\ud2b8\uc6e8\uc774 \ub610\ub294 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub124\ud2b8\uc6cc\ud0b9 \ubaa8\ub4dc\uc5d0\uc11c transit gateway\uc640 \ud568\uaed8 VPC CNI\ub97c \uc0ac\uc6a9\ud558\uc5ec EKS\uc758 \uc6cc\ud06c\ub85c\ub4dc\ub97c \ud1b5\ud569\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p> <p></p> <p>\uc11c\ube44\uc2a4 \uc81c\uacf5\uc790\uc774\uace0 \ubcc4\ub3c4\uc758 \uacc4\uc815\uc73c\ub85c \uace0\uac1d VPC\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4 \ubc0f \uc778\uadf8\ub808\uc2a4(ALB \ub610\ub294 NLB)\ub97c \uacf5\uc720\ud558\ub824\ub294 \uacbd\uc6b0, \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc11c\ube44\uc2a4\ub77c\uace0\ub3c4 \ubd88\ub9ac\ub294 AWS PrivateLink \ud65c\uc6a9\uc744 \uace0\ub824\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#vpc_4","title":"\uc5ec\ub7ec \uacc4\uc815\uc5d0\uc11c\uc758 VPC \uacf5\uc720","text":"<p>\ub9ce\uc740 \uae30\uc5c5\uc5d0\uc11c AWS \uc870\uc9c1 \ub0b4 \uc5ec\ub7ec AWS \uacc4\uc815\uc758 \ub124\ud2b8\uc6cc\ud06c \uad00\ub9ac\ub97c \uac04\uc18c\ud654\ud558\uace0, \ube44\uc6a9\uc744 \uc808\uac10\ud558\uace0, \ubcf4\uc548\uc744 \uac1c\uc120\ud558\uae30 \uc704\ud55c \uc218\ub2e8\uc73c\ub85c \uacf5\uc720 Amazon VPC\ub97c \ub3c4\uc785\ud569\ub2c8\ub2e4. \uc774\ub4e4\uc740 AWS Resource Access Manager(RAM)\ub97c \ud65c\uc6a9\ud558\uc5ec \uc9c0\uc6d0\ub418\ub294 AWS \ub9ac\uc18c\uc2a4\ub97c \uac1c\ubcc4 AWS \uacc4\uc815, \uc870\uc9c1 \ub2e8\uc704(OU) \ub610\ub294 \uc804\uccb4 AWS \uc870\uc9c1\uacfc \uc548\uc804\ud558\uac8c \uacf5\uc720\ud569\ub2c8\ub2e4.</p> <p>AWS RAM\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub2e4\ub978 AWS \uacc4\uc815\uc758 \uacf5\uc720\uc6a9 VPC \uc11c\ube0c\ub137\uc5d0 Amazon EKS \ud074\ub7ec\uc2a4\ud130, \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 \ubc0f \uae30\ud0c0 \uc9c0\uc6d0 AWS \ub9ac\uc18c\uc2a4(\uc608: \ub85c\ub4dc\ubc38\ub7f0\uc11c, \ubcf4\uc548 \uadf8\ub8f9, \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ub4f1)\ub97c \ubc30\ud3ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc544\ub798 \uadf8\ub9bc\uc740 \uc0c1\uc704 \uc218\uc900 \uc544\ud0a4\ud14d\ucc98\uc758 \uc608\ub97c \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uc911\uc559 \ub124\ud2b8\uc6cc\ud06c \ud300\uc740 VPC, \uc11c\ube0c\ub137 \ub4f1\uacfc \uac19\uc740 \ub124\ud2b8\uc6cc\ud0b9 \uad6c\uc870\ub97c \uc81c\uc5b4\ud558\uace0, \ub3d9\uc2dc\uc5d0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub610\ub294 \ud50c\ub7ab\ud3fc \ud300\uc740 \uac01\uc790\uc758 AWS \uacc4\uc815\uc5d0 Amazon EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc2dc\ub098\ub9ac\uc624\uc5d0 \ub300\ud55c \uc804\uccb4 \uc124\uba85\uc740 \uc774 github \uc800\uc7a5\uc18c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p>"},{"location":"ko/networking/subnets/#_8","title":"\uacf5\uc720 \uc11c\ube0c\ub137 \uc0ac\uc6a9 \uc2dc \uace0\ub824 \uc0ac\ud56d","text":"<ul> <li> <p>Amazon EKS \ud074\ub7ec\uc2a4\ud130\uc640 \uc6cc\ucee4 \ub178\ub4dc\ub294 \ubaa8\ub450 \ub3d9\uc77c\ud55c VPC\uc758 \uacf5\uc720 \uc11c\ube0c\ub137 \ub0b4\uc5d0\uc11c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Amazon EKS\ub294 \uc5ec\ub7ec VPC\uc5d0\uc11c\uc758 \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. </p> </li> <li> <p>Amazon EKS\ub294 AWS VPC \ubcf4\uc548 \uadf8\ub8f9(SG)\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ud074\ub7ec\uc2a4\ud130\uc758 \uc6cc\ucee4 \ub178\ub4dc \uc0ac\uc774\uc758 \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud569\ub2c8\ub2e4. \ub610\ud55c \ubcf4\uc548 \uadf8\ub8f9\uc740 \uc6cc\ucee4 \ub178\ub4dc, \uae30\ud0c0 VPC \ub9ac\uc18c\uc2a4 \ubc0f \uc678\ubd80 IP \uc8fc\uc18c \uac04\uc758 \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud558\ub294 \ub370\uc5d0\ub3c4 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158/\ucc38\uc5ec\uc790(participant) \uacc4\uc815\uc5d0\uc11c \uc774\ub7ec\ud55c \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \ud30c\ub4dc\uc5d0 \uc0ac\uc6a9\ud560 \ubcf4\uc548 \uadf8\ub8f9\ub3c4 \ucc38\uc5ec\uc790 \uacc4\uc815\uc5d0 \uc788\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. \ubcf4\uc548 \uadf8\ub8f9 \ub0b4\uc5d0\uc11c \uc778\ubc14\uc6b4\ub4dc \ubc0f \uc544\uc6c3\ubc14\uc6b4\ub4dc \uaddc\uce59\uc744 \uad6c\uc131\ud558\uc5ec \uc911\uc559 VPC \uacc4\uc815\uc5d0 \uc788\ub294 \ubcf4\uc548 \uadf8\ub8f9\uc5d0\uc11c \uc1a1\uc218\uc2e0\ub418\ub294 \ud544\uc694\ud55c \ud2b8\ub798\ud53d\uc744 \ud5c8\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> </li> <li> <p>Amazon EKS \ud074\ub7ec\uc2a4\ud130\uac00 \uc788\ub294 \ucc38\uc5ec\uc790 \uacc4\uc815 \ub0b4\uc5d0 IAM \uc5ed\ud560 \ubc0f \uad00\ub828 \uc815\ucc45\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c IAM \uc5ed\ud560 \ubc0f \uc815\ucc45\uc740 Amazon EKS\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc640 Fargate\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ub178\ub4dc \ubc0f \ud30c\ub4dc\uc5d0 \ud544\uc694\ud55c \uad8c\ud55c\uc744 \ubd80\uc5ec\ud558\uae30 \uc704\ud574 \ubc18\ub4dc\uc2dc \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \uad8c\ud55c\uc744 \ud1b5\ud574 Amazon EKS\ub294 \uc0ac\uc6a9\uc790\ub97c \ub300\uc2e0\ud558\uc5ec \ub2e4\ub978 AWS \uc11c\ube44\uc2a4\ub97c \ud638\ucd9c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> </li> <li> <p>\ub2e4\uc74c \uc811\uadfc \ubc29\uc2dd\uc5d0 \ub530\ub77c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uc5d0\uc11c Amazon S3 \ubc84\ud0b7, Dynamodb \ud14c\uc774\ube14 \ub4f1\uacfc \uac19\uc740 AWS \ub9ac\uc18c\uc2a4\uc758 \uacc4\uc815 \uac04 \uc561\uc138\uc2a4\ub97c \ud5c8\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li> <p>\ub9ac\uc18c\uc2a4 \uae30\ubc18 \uc815\ucc45 \uc811\uadfc \ubc29\uc2dd: AWS \uc11c\ube44\uc2a4\uac00 \ub9ac\uc18c\uc2a4 \uc815\ucc45\uc744 \uc9c0\uc6d0\ud558\ub294 \uacbd\uc6b0 \uc801\uc808\ud55c \ub9ac\uc18c\uc2a4 \uae30\ubc18 \uc815\ucc45\uc744 \ucd94\uac00\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub41c IAM \uc5ed\ud560\uc5d0 \ub300\ud55c \uacc4\uc815 \uac04 \uc561\uc138\uc2a4\ub97c \ud5c8\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc2dc\ub098\ub9ac\uc624\uc5d0\uc11c\ub294 OIDC \uacf5\uae09\uc790, IAM \uc5ed\ud560 \ubc0f \uad8c\ud55c \uc815\ucc45\uc774 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uacc4\uc815\uc5d0 \uc874\uc7ac\ud558\uac8c \ub429\ub2c8\ub2e4. \ub9ac\uc18c\uc2a4 \uae30\ubc18 \uc815\ucc45\uc744 \uc9c0\uc6d0\ud558\ub294 AWS \uc11c\ube44\uc2a4\ub97c \ucc3e\uc73c\ub824\uba74 IAM\uacfc \ud568\uaed8 \uc791\ub3d9\ud558\ub294 AWS \uc11c\ube44\uc2a4\ub97c \ucc38\uc870\ud558\uace0 \ub9ac\uc18c\uc2a4 \uae30\ubc18 \uc5f4\uc5d0\uc11c '\uc608'\ub77c\uace0 \ud45c\uc2dc\ub41c \uc11c\ube44\uc2a4\ub97c \ucc3e\uc544\ubcf4\uc2ed\uc2dc\uc624.</p> </li> <li> <p>OIDC \uacf5\uae09\uc790 \uc811\uadfc \ubc29\uc2dd: OIDC \uacf5\uae09\uc790, IAM \uc5ed\ud560, \uad8c\ud55c \ubc0f \uc2e0\ub8b0 \uc815\ucc45\uacfc \uac19\uc740 IAM \ub9ac\uc18c\uc2a4\ub294 \ub9ac\uc18c\uc2a4\uac00 \uc788\ub294 \ub2e4\ub978 \ucc38\uc5ec\uc790 AWS \uacc4\uc815\uc5d0\uc11c \uc0dd\uc131\ub429\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc5ed\ud560\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uacc4\uc815\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub418\uc5b4 \uacc4\uc815 \uac04 \ub9ac\uc18c\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. \uc774 \uc811\uadfc \ubc29\uc2dd\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc704\ud55c \uad50\ucc28 \uacc4\uc815 \uac04 IAM \uc5ed\ud560 \ube14\ub85c\uadf8\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> </li> </ul> </li> <li> <p>Amazon Elastic Loadbalancer(ELB) \ub9ac\uc18c\uc2a4(ALB \ub610\ub294 NLB)\ub97c \ubc30\ud3ec\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub610\ub294 \uc911\uc559 \ub124\ud2b8\uc6cc\ud0b9 \uacc4\uc815\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\ub85c \ud2b8\ub798\ud53d\uc744 \ub77c\uc6b0\ud305\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc911\uc559 \ub124\ud2b8\uc6cc\ud0b9 \uacc4\uc815\uc5d0 ELB \ub9ac\uc18c\uc2a4\ub97c \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \uc548\ub0b4\ub294 \uad50\ucc28 \uacc4\uc815 \ub85c\ub4dc \ubc38\ub7f0\uc11c\ub97c \ud1b5\ud574 Amazon EKS \ud30c\ub4dc \ub178\ucd9c\uc548\ub0b4\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4. \uc774 \uc635\uc158\uc740 \ub85c\ub4dc \ubc38\ub7f0\uc11c \ub9ac\uc18c\uc2a4\uc758 \ubcf4\uc548 \uad6c\uc131\uc5d0 \ub300\ud55c \ubaa8\ub4e0 \uad8c\ud55c\uc744 \uc911\uc559 \ub124\ud2b8\uc6cc\ud0b9 \uacc4\uc815\uc5d0 \ubd80\uc5ec\ud558\ubbc0\ub85c \uc720\uc5f0\uc131\uc774 \ud5a5\uc0c1\ub429\ub2c8\ub2e4.</p> </li> <li> <p>Amazon VPC CNI\uc758 <code>\uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub124\ud2b8\uc6cc\ud0b9 \uae30\ub2a5(custom networking feature)</code>\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc911\uc559 \ub124\ud2b8\uc6cc\ud0b9 \uacc4\uc815\uc5d0 \ub098\uc5f4\ub41c \uac00\uc6a9 \uc601\uc5ed(AZ) ID \ub9e4\ud551\uc744 \uc0ac\uc6a9\ud558\uc5ec \uac01\uac01\uc758 <code>ENIConfig</code>\ub97c \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub294 \ubb3c\ub9ac\uc801 AZ\ub97c \uac01 AWS \uacc4\uc815\uc758 AZ \uc774\ub984\uc5d0 \ubb34\uc791\uc704\ub85c \ub9e4\ud551\ud558\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4.</p> </li> </ul>"},{"location":"ko/networking/subnets/#_9","title":"\ubcf4\uc548 \uadf8\ub8f9","text":"<p>\ubcf4\uc548 \uadf8\ub8f9\uc740 \uc5f0\uacb0\ub41c \ub9ac\uc18c\uc2a4\uc5d0 \ub4e4\uc5b4\uc624\uac70\ub098 \ub098\uac00\ub294 \uac83\uc774 \ud5c8\uc6a9\ub418\ub294 \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud569\ub2c8\ub2e4. Amazon EKS\ub294 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ub178\ub4dc\uac04\uc758 \ud1b5\uc2e0\uc744 \uad00\ub9ac\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uba74 Amazon EKS\ub294 <code>eks-cluster-sg-my-cluster-uniqueID</code>\ub77c\ub294 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. EKS\ub294 \uc774\ub7ec\ud55c \ubcf4\uc548 \uadf8\ub8f9\uc744 \uad00\ub9ac\ud615 ENI \ubc0f \ub178\ub4dc\uc5d0 \uc5f0\uacb0\ud569\ub2c8\ub2e4. \uae30\ubcf8 \uaddc\uce59\uc744 \uc0ac\uc6a9\ud558\uba74 \ud074\ub7ec\uc2a4\ud130\uc640 \ub178\ub4dc \uac04\uc5d0 \ubaa8\ub4e0 \ud2b8\ub798\ud53d\uc774 \uc790\uc720\ub86d\uac8c \uc804\ub2ec\ub418\uace0, \ubaa8\ub4e0 \uc544\uc6c3\ubc14\uc6b4\ub4dc \ud2b8\ub798\ud53d\uc774 \ubaa8\ub4e0 \ubaa9\uc801\uc9c0\ub85c \uc804\ub2ec\ub418\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. </p> <p>\ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud560 \ub54c \uc790\uccb4 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uccb4 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc9c0\uc815\ud558\ub294 \uacbd\uc6b0 \ubcf4\uc548 \uadf8\ub8f9 \uad8c\uc7a5 \uc0ac\ud56d\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4. </p>"},{"location":"ko/networking/subnets/#_10","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/networking/subnets/#az","title":"\ub2e4\uc911 AZ \ubc30\ud3ec \uace0\ub824","text":"<p>AWS \ub9ac\uc804\uc740 \ubb3c\ub9ac\uc801\uc73c\ub85c \ubd84\ub9ac\ub418\uace0 \uaca9\ub9ac\ub41c \uc5ec\ub7ec \uac00\uc6a9 \uc601\uc5ed(AZ)\uc744 \uc81c\uacf5\ud558\uba70, \uc774\ub7ec\ud55c \uac00\uc6a9 \uc601\uc5ed\uc740 \uc9c0\uc5f0 \uc2dc\uac04\uc774 \uc9e7\uace0 \ucc98\ub9ac\ub7c9\uc774 \ub192\uc73c\uba70 \uc911\ubcf5\uc131\uc774 \ub192\uc740 \ub124\ud2b8\uc6cc\ud0b9\uc73c\ub85c \uc5f0\uacb0\ub429\ub2c8\ub2e4. \uac00\uc6a9 \uc601\uc5ed\uc744 \ud65c\uc6a9\ud558\uc5ec \uac00\uc6a9 \uc601\uc5ed \uac04\uc5d0 \uc911\ub2e8 \uc5c6\uc774 \uc790\ub3d9\uc73c\ub85c \uc7a5\uc560 \uc870\uce58\ub418\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc124\uacc4\ud558\uace0 \uc6b4\uc601\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Amazon EKS\ub294 EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc5ec\ub7ec \uac00\uc6a9 \uc601\uc5ed\uc5d0 \ubc30\ud3ec\ud560 \uac83\uc744 \uac15\ub825\ud788 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud560 \ub54c \ucd5c\uc18c \ub450 \uac1c\uc758 \uac00\uc6a9 \uc601\uc5ed\uc5d0 \uc11c\ube0c\ub137\uc744 \uc9c0\uc815\ud558\ub294 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4.</p> <p>\ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 Kubelet\uc740 <code>topology.kubernetes.io/region=us-west-2</code>, <code>topology.kubernetes.io/zone=us-west-2d</code>\uc640 \uac19\uc740 \ub808\uc774\ube14\uc744 \ub178\ub4dc \uc624\ube0c\uc81d\ud2b8\uc5d0 \uc790\ub3d9\uc73c\ub85c \ucd94\uac00\ud569\ub2c8\ub2e4. \ub178\ub4dc \ub808\uc774\ube14\uc744 Pod topology spread constraints\uc640 \ud568\uaed8 \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\uac00 \uc5ec\ub7ec \uc601\uc5ed\uc5d0 \ubd84\uc0b0\ub418\ub294 \ubc29\uc2dd\uc744 \uc81c\uc5b4\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ud78c\ud2b8\ub97c \ud1b5\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uac00 \uc608\uc0c1 \uac00\uc6a9\uc131\uc744 \ub192\uc774\uae30 \uc704\ud574 \ud30c\ub4dc\ub97c \ubc30\uce58\ud558\uc5ec \uc0c1\uad00 \uad00\uacc4\uac00 \uc788\ub294 \uc7a5\uc560\uac00 \uc804\uccb4 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc704\ud5d8\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc \uc140\ub809\ud130 \ubc0f AZ \ubd84\uc0b0 \uc81c\uc57d \uc870\uac74\uc758 \uc608\ub97c \ubcf4\ub824\uba74 \ud30c\ub4dc\uc5d0 \ub178\ub4dc \ud560\ub2f9\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>\ub178\ub4dc\ub97c \uc0dd\uc131\ud560 \ub54c \uc11c\ube0c\ub137 \ub610\ub294 \uac00\uc6a9 \uc601\uc5ed\uc744 \uc815\uc758\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc11c\ube0c\ub137\uc774 \uad6c\uc131\ub418\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \ub178\ub4dc\ub294 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube0c\ub137\uc5d0 \ubc30\uce58\ub429\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc5d0 \ub300\ud55c EKS \uc9c0\uc6d0\uc740 \uac00\uc6a9 \uc6a9\ub7c9\uc744 \uae30\uc900\uc73c\ub85c \uc5ec\ub7ec \uac00\uc6a9 \uc601\uc5ed\uc5d0 \ub178\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \ubd84\uc0b0\ud569\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\uac00 topology spread constraints\ub97c \uc815\uc758\ud558\ub294 \uacbd\uc6b0 Karpenter\ub294 \ub178\ub4dc\ub97c \uc9c0\uc815\ub41c AZ\ub85c \ud655\uc7a5\ud558\uc5ec AZ \ubd84\uc0b0 \ubc30\uce58\ub97c \uc900\uc218\ud569\ub2c8\ub2e4.</p> <p>AWS Elastic Loadbalancer\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 AWS \ub85c\ub4dc \ubc38\ub7f0\uc11c \ucee8\ud2b8\ub864\ub7ec\uc5d0 \uc758\ud574 \uad00\ub9ac\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc778\uadf8\ub808\uc2a4 \ub9ac\uc18c\uc2a4\ub97c \uc704\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub85c\ub4dc \ubc38\ub7f0\uc11c(ALB)\uc640 \ub85c\ub4dc\ubc38\ub7f0\uc11c \uc720\ud615\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4\ub97c \uc704\ud55c \ub124\ud2b8\uc6cc\ud06c \ub85c\ub4dc \ubc38\ub7f0\uc11c(NLB)\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud569\ub2c8\ub2e4. Elastic Loadbalancer \ucee8\ud2b8\ub864\ub7ec\ub294 \ud0dc\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc11c\ube0c\ub137\uc744 \uac80\uc0c9\ud569\ub2c8\ub2e4. ELB \ucee8\ud2b8\ub864\ub7ec\uac00 \uc778\uadf8\ub808\uc2a4 \ub9ac\uc18c\uc2a4\ub97c \uc131\uacf5\uc801\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub824\uba74 \ucd5c\uc18c \ub450 \uac1c\uc758 \uac00\uc6a9 \uc601\uc5ed (AZ)\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc9c0\ub9ac\uc801 \uc774\uc911\ud654\uc758 \uc548\uc804\uc131\uacfc \uc548\uc815\uc131\uc744 \ud65c\uc6a9\ud558\uae30 \uc704\ud574 \ucd5c\uc18c \ub450 \uac1c\uc758 AZ\uc5d0 \uc11c\ube0c\ub137\uc744 \uc124\uc815\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. </p>"},{"location":"ko/networking/subnets/#_11","title":"\ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0 \ub178\ub4dc \ubc30\ud3ec","text":"<p>\ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uacfc \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc744 \ubaa8\ub450 \ud3ec\ud568\ud558\ub294 VPC\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6cc\ud06c\ub85c\ub4dc\ub97c EKS\uc5d0 \ubc30\ud3ec\ud558\ub294 \ub370 \uac00\uc7a5 \uc801\ud569\ud55c \ubc29\ubc95\uc785\ub2c8\ub2e4. \uc11c\ub85c \ub2e4\ub978 \ub450 \uac00\uc6a9 \uc601\uc5ed\uc5d0 \ucd5c\uc18c \ub450 \uac1c\uc758 \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uacfc \ub450 \uac1c\uc758 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc744 \uc124\uc815\ud560 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc758 \ub77c\uc6b0\ud305 \ud14c\uc774\ube14\uc5d0\ub294 \uc778\ud130\ub137 \uac8c\uc774\ud2b8\uc6e8\uc774\uc5d0 \ub300\ud55c \uacbd\ub85c\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc\ub294 NAT \uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \ud1b5\ud574 \uc778\ud130\ub137\uacfc \uc0c1\ud638\uc791\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. IPv6 \ud658\uacbd(EIGW)\uc5d0\uc11c\uc758 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc740 \uc678\ubd80 \uc804\uc6a9 \uc778\ud130\ub137 \uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \ud1b5\ud574 \uc9c0\uc6d0\ub429\ub2c8\ub2e4.</p> <p>\ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\uc11c \ub178\ub4dc\ub97c \uc778\uc2a4\ud134\uc2a4\ud654\ud558\uba74 \ub178\ub4dc\uc5d0 \ub300\ud55c \ud2b8\ub798\ud53d \uc81c\uc5b4\ub97c \ucd5c\ub300\ud654 \ud560 \uc218 \uc788\uc73c\uba70 \ub300\ubd80\ubd84\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \uc801\ud569\ud569\ub2c8\ub2e4. \uc778\uadf8\ub808\uc2a4 \ub9ac\uc18c\uc2a4(\uc608: \ub85c\ub4dc \ubc38\ub7f0\uc11c)\ub294 \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc5d0\uc11c \uc778\uc2a4\ud134\uc2a4\ud654\ub418\uace0 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\uc11c \uc791\ub3d9\ud558\ub294 \ud30c\ub4dc\ub85c \ud2b8\ub798\ud53d\uc744 \ub77c\uc6b0\ud305\ud569\ub2c8\ub2e4.</p> <p>\uc5c4\uaca9\ud55c \ubcf4\uc548 \ubc0f \ub124\ud2b8\uc6cc\ud06c \uaca9\ub9ac\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \ud504\ub77c\uc774\ube57 \uc804\uc6a9 \ubaa8\ub4dc\ub97c \uace0\ub824\ud569\ub2c8\ub2e4. \uc774 \uad6c\uc131\uc5d0\uc11c\ub294 \uc138 \uac1c\uc758 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc774 AWS \ub9ac\uc804 \ub0b4 VPC\uc758 \uc11c\ub85c \ub2e4\ub978 \uac00\uc6a9 \uc601\uc5ed\uc5d0 \ubc30\ud3ec\ub429\ub2c8\ub2e4. \uc11c\ube0c\ub137\uc5d0 \ubc30\ud3ec\ub41c \ub9ac\uc18c\uc2a4\ub294 \uc778\ud130\ub137\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\uc73c\uba70 \uc778\ud130\ub137\uc5d0\uc11c \uc11c\ube0c\ub137\uc758 \ub9ac\uc18c\uc2a4\ub85c\ub3c4 \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ub2e4\ub978 AWS \uc11c\ube44\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc73c\ub824\uba74 PrivateLink \uc778\ud130\ud398\uc774\uc2a4 \ubc0f/\ub610\ub294 \uac8c\uc774\ud2b8\uc6e8\uc774 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uad6c\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. AWS \ub85c\ub4dc \ubc38\ub7f0\uc11c \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub0b4\ubd80 \ub85c\ub4dc \ubc38\ub7f0\uc11c\uac00 \ud2b8\ub798\ud53d\uc744 \ud30c\ub4dc\ub85c \ub9ac\ub514\ub809\uc158\ud558\ub3c4\ub85d \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud2b8\ub864\ub7ec\uac00 \ub85c\ub4dc \ubc38\ub7f0\uc11c\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub824\uba74 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0 (<code>`kubernetes.io/role/internal-elb: 1</code>) \ud0dc\uadf8\ub97c \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \ub178\ub4dc\ub97c \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub4f1\ub85d\ud558\ub824\uba74 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud504\ub77c\uc774\ube57 \ubaa8\ub4dc\ub85c \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \uc804\uccb4 \uc694\uad6c \uc0ac\ud56d \ubc0f \uace0\ub824 \uc0ac\ud56d\uc740 \ud504\ub77c\uc774\ube57 \ud074\ub7ec\uc2a4\ud130 \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_12","title":"\ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc758 \ud37c\ube14\ub9ad \ubc0f \ud504\ub77c\uc774\ube57 \ubaa8\ub4dc \uace0\ub824","text":"<p>Amazon EKS\ub294 \ud37c\ube14\ub9ad \uc804\uc6a9, \ud37c\ube14\ub9ad \ubc0f \ud504\ub77c\uc774\ube57, \ud504\ub77c\uc774\ube57 \uc804\uc6a9 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ubaa8\ub4dc\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. \uae30\ubcf8 \ubaa8\ub4dc\ub294 \ud37c\ube14\ub9ad \uc804\uc6a9\uc774\uc9c0\ub9cc \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud37c\ube14\ub9ad \ubc0f \ud504\ub77c\uc774\ube57 \ubaa8\ub4dc\ub85c \uad6c\uc131\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc774 \uc635\uc158\uc744 \uc0ac\uc6a9\ud558\uba74 \ud074\ub7ec\uc2a4\ud130 VPC \ub0b4\uc5d0\uc11c\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \ud638\ucd9c(\uc608: \ub178\ub4dc\uc640 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uac04 \ud1b5\uc2e0)\uc5d0 \ud504\ub77c\uc774\ube57 VPC \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud65c\uc6a9\ud558\uace0 \ud2b8\ub798\ud53d\uc774 \ud074\ub7ec\uc2a4\ud130\uc758 VPC \ub0b4\uc5d0 \uc720\uc9c0\ub418\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubc18\uba74 \ud074\ub7ec\uc2a4\ud130 API \uc11c\ubc84\ub294 \uc778\ud130\ub137\uc744 \ud1b5\ud574 \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 CIDR \ube14\ub85d\uc740 \uc81c\ud55c\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. CIDR \ube14\ub85d \uc81c\ud55c\uc744 \ud3ec\ud568\ud558\uc5ec \ud37c\ube14\ub9ad \ubc0f \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc561\uc138\uc2a4\ub97c \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uc744 \uc54c\uc544\ubd05\ub2c8\ub2e4.</p> <p>\ubcf4\uc548 \ubc0f \ub124\ud2b8\uc6cc\ud06c \uaca9\ub9ac\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \ud504\ub77c\uc774\ube57 \uc804\uc6a9 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\uc5d0 \uc81c\uc2dc\ub41c \uc635\uc158 \uc911 \ud558\ub098\ub97c \uc0ac\uc6a9\ud558\uc5ec API \uc11c\ubc84\uc5d0 \ud504\ub77c\uc774\ube57\ud558\uac8c \uc5f0\uacb0\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#_13","title":"\ubcf4\uc548 \uadf8\ub8f9\uc744 \uc2e0\uc911\ud558\uac8c \uad6c\uc131","text":"<p>Amazon EKS\ub294 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ubcf4\uc548 \uadf8\ub8f9 \uc0ac\uc6a9\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \ubaa8\ub4e0 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ubcf4\uc548 \uadf8\ub8f9\uc740 \ub178\ub4dc\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uac04\uc758 \ud1b5\uc2e0\uc744 \ud5c8\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uc870\uc9c1 \ub0b4\uc5d0\uc11c \uac1c\ubc29\ud615 \ud1b5\uc2e0\uc744 \ud5c8\uc6a9\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0 \ud3ec\ud2b8 \uc694\uad6c \uc0ac\ud56d\uc744 \ud655\uc778\ud558\uace0 \uaddc\uce59\uc744 \uc218\ub3d9\uc73c\ub85c \uad6c\uc131\ud569\ub2c8\ub2e4. </p> <p>EKS\ub294 \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131 \uc911\uc5d0 \uc81c\uacf5\ud558\ub294 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uad00\ub9ac\ud615 \uc778\ud130\ud398\uc774\uc2a4(X-ENI)\uc5d0 \uc801\uc6a9\ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ubcf4\uc548\uadf8\ub8f9\uc774 \ub178\ub4dc\uc640 \uc989\uc2dc \uc5f0\uacb0\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0dd\uc131\ud560 \ub54c\ub294 \uc218\ub3d9\uc73c\ub85c \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc5f0\uacb0\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ub178\ub4dc \uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1 \uc911 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ubcf4\uc548 \uadf8\ub8f9\uc758 Karpenter \ub178\ub4dc \ud15c\ud50c\ub9bf \uac80\uc0c9\uc744 \ud65c\uc131\ud654\ud558\ub824\uba74 securityGroupSelectorTerms\ub97c \ud65c\uc131\ud654\ud560 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4.</p> <p>\ubaa8\ub4e0 \ub178\ub4dc \uac04 \ud1b5\uc2e0 \ud2b8\ub798\ud53d\uc744 \ud5c8\uc6a9\ud558\ub294 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\ub294 \uac83\uc744 \uac15\ub825\ud788 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ubd80\ud2b8\uc2a4\ud2b8\ub7a9 \ud504\ub85c\uc138\uc2a4 \uc911\uc5d0 \ub178\ub4dc\uac00 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc561\uc138\uc2a4\ud558\ub824\uba74 \uc544\uc6c3\ubc14\uc6b4\ub4dc \uc778\ud130\ub137 \uc5f0\uacb0\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc628\ud504\ub808\ubbf8\uc2a4 \uc5f0\uacb0 \ubc0f \ucee8\ud14c\uc774\ub108 \ub808\uc9c0\uc2a4\ud2b8\ub9ac \uc561\uc138\uc2a4\uc640 \uac19\uc740 \uc678\ubd80 \uc561\uc138\uc2a4 \uc694\uad6c \uc0ac\ud56d\uc744 \ud3c9\uac00\ud558\uace0 \uaddc\uce59\uc744 \uc801\uc808\ud558\uac8c \uc124\uc815\ud569\ub2c8\ub2e4. \ubcc0\uacbd \uc0ac\ud56d\uc744 \ud504\ub85c\ub355\uc158\uc5d0 \uc801\uc6a9\ud558\uae30 \uc804\uc5d0 \uac1c\ubc1c \ud658\uacbd\uc5d0\uc11c \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uc744 \uc8fc\uc758 \uae4a\uac8c \ud655\uc778\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#nat","title":"\uac01 \uac00\uc6a9 \uc601\uc5ed\uc5d0 NAT \uac8c\uc774\ud2b8\uc6e8\uc774 \ubc30\ud3ec","text":"<p>\ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137(IPv4 \ubc0f IPv6)\uc5d0 \ub178\ub4dc\ub97c \ubc30\ud3ec\ud558\ub294 \uacbd\uc6b0 \uac01 \uac00\uc6a9 \uc601\uc5ed(AZ)\uc5d0 NAT \uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \uc0dd\uc131\ud558\uc5ec \uac00\uc6a9 \uc601\uc5ed\uc5d0 \ub3c5\ub9bd\uc801\uc778 \uc544\ud0a4\ud14d\ucc98\ub97c \ubcf4\uc7a5\ud558\uace0 AZ \uac04 \ube44\uc6a9\uc744 \uc808\uac10\ud558\ub294 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. AZ\uc758 \uac01 NAT \uac8c\uc774\ud2b8\uc6e8\uc774\ub294 \uc774\uc911\ud654\ub85c \uad6c\ud604\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/networking/subnets/#cloud9","title":"Cloud9\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud504\ub77c\uc774\ube57 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc561\uc138\uc2a4","text":"<p>AWS Cloud9\ub294 AWS Systems Manager\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc778\uadf8\ub808\uc2a4 \uc561\uc138\uc2a4 \uc5c6\uc774 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\uc11c \uc548\uc804\ud558\uac8c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uc6f9 \uae30\ubc18 IDE\uc785\ub2c8\ub2e4. Cloud9 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc774\uadf8\ub808\uc2a4\ub97c \ube44\ud65c\uc131\ud654\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. Cloud9\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud504\ub77c\uc774\ube57 \ud074\ub7ec\uc2a4\ud130\uc640 \uc11c\ube0c\ub137\uc5d0 \uc561\uc138\uc2a4\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\uc2ed\uc2dc\uc624.</p> <p></p>"},{"location":"ko/networking/vpc-cni/","title":"Amazon VPC CNI","text":"<p>Amazon EKS\ub294 Amazon VPC \ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4(VPC CNI) \ud50c\ub7ec\uadf8\uc778\uc744 \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130 \ub124\ud2b8\uc6cc\ud0b9\uc744 \uad6c\ud604\ud569\ub2c8\ub2e4. CNI \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uac00 VPC \ub124\ud2b8\uc6cc\ud06c\uc5d0\uc11c\uc640 \ub3d9\uc77c\ud55c IP \uc8fc\uc18c\ub97c \uac00\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uad6c\uccb4\uc801\uc73c\ub85c\ub294 \ud30c\ub4dc \ub0b4\ubd80\uc758 \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\ub294 \ub124\ud2b8\uc6cc\ud06c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uacf5\uc720\ud558\uba70 \ub85c\uceec \ud3ec\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc11c\ub85c \ud1b5\uc2e0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Amazon VPC CNI\uc5d0\ub294 \ub450 \uac00\uc9c0 \uad6c\uc131 \uc694\uc18c\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>CNI \ubc14\uc774\ub108\ub9ac\ub294 \ud30c\ub4dc \uac04 \ud1b5\uc2e0\uc744 \ud65c\uc131\ud654\ud558\ub294 \ud30c\ub4dc \ub124\ud2b8\uc6cc\ud06c\ub97c \uad6c\uc131\ud569\ub2c8\ub2e4. CNI \ubc14\uc774\ub108\ub9ac\ub294 \ub178\ub4dc\uc758 \ub8e8\ud2b8 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0\uc11c \uc2e4\ud589\ub418\uba70, \uc0c8 \ud30c\ub4dc\uac00 \ub178\ub4dc\uc5d0 \ucd94\uac00\ub418\uac70\ub098 \uae30\uc874 \ud30c\ub4dc\uac00 \ub178\ub4dc\uc5d0\uc11c \uc81c\uac70\ub420 \ub54c kubelet\uc5d0 \uc758\ud574 \ud638\ucd9c\ub429\ub2c8\ub2e4.</li> <li>\uc624\ub798 \uc2e4\ud589\ub418\ub294(long-running) \ub178\ub4dc \ub85c\uceec(node-local) IP \uc8fc\uc18c \uad00\ub9ac (IPAM) \ub370\ubaac\uc778 ipamd\ub294 \ub2e4\uc74c\uc744 \ub2f4\ub2f9\ud569\ub2c8\ub2e4.</li> <li>\ub178\ub4dc\uc758 ENI \uad00\ub9ac \ubc0f</li> <li>\uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c \ub610\ub294 Prefix\uc758 \uc6dc \ud480 \uc720\uc9c0</li> </ul> <p>\uc778\uc2a4\ud134\uc2a4\uac00 \uc0dd\uc131\ub418\uba74 EC2\ub294 \uae30\ubcf8 \uc11c\ube0c\ub137\uacfc \uc5f0\uacb0\ub41c \uae30\ubcf8 ENI\ub97c \uc0dd\uc131\ud558\uc5ec \uc5f0\uacb0\ud569\ub2c8\ub2e4. \uae30\ubcf8 \uc11c\ube0c\ub137\uc740 \ud37c\ube14\ub9ad \ub610\ub294 \ud504\ub77c\uc774\ube57\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud06c \ubaa8\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\ub294 \ub178\ub4dc \uae30\ubcf8 ENI\uc5d0 \ud560\ub2f9\ub41c \uae30\ubcf8 IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud558\uba70 \ud638\uc2a4\ud2b8\uc640 \ub3d9\uc77c\ud55c \ub124\ud2b8\uc6cc\ud06c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uacf5\uc720\ud569\ub2c8\ub2e4.</p> <p>CNI \ud50c\ub7ec\uadf8\uc778\uc740 \ub178\ub4dc\uc758 Elastic Network Interface (ENI)\ub97c \uad00\ub9ac\ud569\ub2c8\ub2e4. \ub178\ub4dc\uac00 \ud504\ub85c\ube44\uc800\ub2dd\ub418\uba74 CNI \ud50c\ub7ec\uadf8\uc778\uc740 \ub178\ub4dc\uc758 \uc11c\ube0c\ub137\uc5d0\uc11c \uae30\ubcf8 ENI\uc5d0 \uc2ac\ub86f \ud480(IP \ub610\ub294 Prefix)\uc744 \uc790\ub3d9\uc73c\ub85c \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc774 \ud480\uc744 \uc6dc \ud480\uc774\ub77c\uace0 \ud558\uba70, \ud06c\uae30\ub294 \ub178\ub4dc\uc758 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ub530\ub77c \uacb0\uc815\ub429\ub2c8\ub2e4. CNI \uc124\uc815\uc5d0 \ub530\ub77c \uc2ac\ub86f\uc740 IP \uc8fc\uc18c \ub610\ub294 Prefix\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. ENI\uc758 \uc2ac\ub86f\uc774 \ud560\ub2f9\ub418\uba74 CNI\ub294 \uc6dc \uc2ac\ub86f \ud480\uc774 \uc788\ub294 \ucd94\uac00 ENI\ub97c \ub178\ub4dc\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ucd94\uac00 ENI\ub97c \ubcf4\uc870 ENI\ub77c\uace0 \ud569\ub2c8\ub2e4. \uac01 ENI\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ub530\ub77c \ud2b9\uc815 \uac2f\uc218\uc758 \uc2ac\ub86f\ub9cc \uc9c0\uc6d0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CNI\ub294 \ud544\uc694\ud55c \uc2ac\ub86f \uc218\ub97c \uae30\ubc18\uc73c\ub85c \uc778\uc2a4\ud134\uc2a4\uc5d0 \ub354 \ub9ce\uc740 ENI\ub97c \uc5f0\uacb0\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c \uc2ac\ub86f \uac2f\uc218\ub294 \ubcf4\ud1b5 \ud30c\ub4dc \uac2f\uc218\uc5d0 \ud574\ub2f9\ud569\ub2c8\ub2e4. \uc774 \ud504\ub85c\uc138\uc2a4\ub294 \ub178\ub4dc\uac00 \ucd94\uac00 ENI\ub97c \ub354 \uc774\uc0c1 \uc81c\uacf5\ud560 \uc218 \uc5c6\uc744 \ub54c\uae4c\uc9c0 \uacc4\uc18d\ub429\ub2c8\ub2e4. \ub610\ud55c CNI\ub294 \ud30c\ub4dc \uc2dc\uc791 \uc18d\ub3c4\ub97c \ub192\uc774\uae30 \uc704\ud574 '\uc6dc' ENI\uc640 \uc2ac\ub86f\uc744 \uc0ac\uc804 \ud560\ub2f9\ud569\ub2c8\ub2e4. \ucc38\uace0\ub85c, \uac01 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0\ub294 \uc5f0\uacb0\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 ENI \uc218\uac00 \uc874\uc7ac\ud569\ub2c8\ub2e4. \uc774 \uc870\uac74\uc740 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\uc640 \ub354\ubd88\uc5b4 \ud30c\ub4dc \ubc00\ub3c4(\ub178\ub4dc\ub2f9 \ud30c\ub4dc \uc218)\uc5d0 \ub300\ud55c \ub610 \ud558\ub098\uc758 \uc81c\uc57d \uc870\uac74\uc785\ub2c8\ub2e4.</p> <p></p> <p>\ucd5c\ub300 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4 \uc218, \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uc2ac\ub86f \uc218\ub294 EC2 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ub530\ub77c \ub2e4\ub985\ub2c8\ub2e4. \uac01 \ud30c\ub4dc\ub294 \uc2ac\ub86f\uc758 IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \ud2b9\uc815 EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc\uc758 \uc218\ub294 \uc5f0\uacb0\ud560 \uc218 \uc788\ub294 ENI\uc758 \uc218\uc640 \uac01 ENI\uac00 \uc9c0\uc6d0\ud558\ub294 \uc2ac\ub86f\uc758 \uc218\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9d1\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4\uc758 CPU \ubc0f \uba54\ubaa8\ub9ac \ub9ac\uc18c\uc2a4\uac00 \uace0\uac08\ub418\uc9c0 \uc54a\ub3c4\ub85d EKS \uc0ac\uc6a9 \uac00\uc774\ub4dc\uc5d0 \ub530\ub77c \ucd5c\ub300 \ud30c\ub4dc\ub97c \uc124\uc815\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. <code>hostNetwork</code>\ub97c \uc0ac\uc6a9\ud558\ub294 \ud30c\ub4dc\ub294 \uc774 \uacc4\uc0b0\uc5d0\uc11c \uc81c\uc678\ub429\ub2c8\ub2e4. \uc8fc\uc5b4\uc9c4 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ub300\ud55c EKS\uc758 \uad8c\uc7a5 \ucd5c\ub300 \ud30c\ub4dc \uac1c\uc218\ub97c \uacc4\uc0b0\ud558\uae30 \uc704\ud574 max-pod-calculator.sh\ub77c\ub294 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/networking/vpc-cni/#_1","title":"\uac1c\uc694","text":"<p>\ubcf4\uc870 IP \ubaa8\ub4dc\ub294 VPC CNI\uc758 \uae30\ubcf8 \ubaa8\ub4dc\uc785\ub2c8\ub2e4. \uc774 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \ubcf4\uc870 IP \ubaa8\ub4dc\uac00 \ud65c\uc131\ud654\ub41c \uacbd\uc6b0\uc758 VPC CNI \ub3d9\uc791\uc5d0 \ub300\ud55c \uc77c\ubc18\uc801\uc778 \uac1c\uc694\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. ipamd\uc758 \uae30\ub2a5(IP \uc8fc\uc18c \ud560\ub2f9)\uc740 VPC CNI\uc758 \uad6c\uc131 \uc124\uc815, \uc608\ub97c \ub4e4\uc5b4 Prefix \ubaa8\ub4dc, \ud30c\ub4dc\ub2f9 \ubcf4\uc548 \uadf8\ub8f9 \uc218, \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub124\ud2b8\uc6cc\ud0b9\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Amazon VPC CNI\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 aws-node\ub77c\ub294 \uc774\ub984\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\ubaac\uc14b\uc73c\ub85c \ubc30\ud3ec\ub429\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc\uac00 \ud504\ub85c\ube44\uc800\ub2dd\ub418\uba74 primary ENI\ub77c\uace0 \ud558\ub294 \uae30\ubcf8 ENI\uac00 \uc5f0\uacb0\ub429\ub2c8\ub2e4. CNI\ub294 \ub178\ub4dc\uc758 \uae30\ubcf8 ENI\uc5d0 \uc5f0\uacb0\ub41c \uc11c\ube0c\ub137\uc5d0\uc11c \uc6dc \ud480\uc758 ENI\uc640 \ubcf4\uc870 IP \uc8fc\uc18c\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c ipamd\ub294 \ub178\ub4dc\uc5d0 \ucd94\uac00 ENI\ub97c \ud560\ub2f9\ud558\ub824\uace0 \uc2dc\ub3c4\ud569\ub2c8\ub2e4. \ub2e8\uc77c \ud30c\ub4dc\uac00 \uc2a4\ucf00\uc904\ub418\uace0 \uae30\ubcf8 ENI\uc758 \ubcf4\uc870 IP \uc8fc\uc18c\uac00 \ud560\ub2f9\ub418\uba74 IPAMD\ub294 \ucd94\uac00 ENI\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc774 \u201c\uc6dc\u201d ENI\ub294 \ub354 \ube60\ub978 \ud30c\ub4dc \ub124\ud2b8\uc6cc\ud0b9\uc744 \uac00\ub2a5\ud558\uac8c \ud569\ub2c8\ub2e4. \ubcf4\uc870 IP \uc8fc\uc18c \ud480\uc774 \ubd80\uc871\ud574\uc9c0\uba74 CNI\ub294 \ub2e4\ub978 ENI\ub97c \ucd94\uac00\ud558\uc5ec \ub354 \ub9ce\uc740 \uc8fc\uc18c\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4.</p> <p>\ud480\uc758 ENI \ubc0f IP \uc8fc\uc18c \uc218\ub294 WARM_ENI_TARGET, WARM_IP_TARGET, MINIMUM_IP_TARGET\uc774\ub77c\ub294 \ud658\uacbd \ubcc0\uc218\ub97c \ud1b5\ud574 \uad6c\uc131\ub429\ub2c8\ub2e4. <code>aws-node</code> \ub370\ubaac\uc14b\uc740 \ucda9\ubd84\ud55c \uc218\uc758 ENI\uac00 \uc5f0\uacb0\ub418\uc5b4 \uc788\ub294\uc9c0 \uc8fc\uae30\uc801\uc73c\ub85c \ud655\uc778\ud569\ub2c8\ub2e4. <code>WARM_ENI_TARGET</code> \ud639\uc740 <code>WARM_IP_TARGET</code> \ubc0f <code>MINIMUM_IP_TARGET</code> \uc870\uac74\uc774 \ucda9\uc871\ub418\uba74 \ucda9\ubd84\ud55c \uc218\uc758 ENI\uac00 \uc5f0\uacb0\ub429\ub2c8\ub2e4. \uc5f0\uacb0\ub41c ENI\uac00 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 CNI\ub294 <code>MAX_ENI</code> \ud55c\ub3c4\uc5d0 \ub3c4\ub2ec\ud560 \ub54c\uae4c\uc9c0 EC2\uc5d0 API\ub97c \ud638\ucd9c\ud558\uc5ec \ucd94\uac00\ub85c ENI\ub97c \uc5f0\uacb0\ud569\ub2c8\ub2e4.</p> <ul> <li><code>WARM_ENI_TARGET</code> - \uc815\uc218 \uac12, \uac12\uc774 &gt;0\uc774\uba74 \uc694\uad6c \uc0ac\ud56d\uc774 \ud65c\uc131\ud654\ub41c \uac83\uc785\ub2c8\ub2e4.</li> <li>\uad00\ub9ac\ud560 \uc6dc ENI\uc758 \uc218\uc785\ub2c8\ub2e4. ENI\ub294 \ub178\ub4dc\uc5d0 \ubcf4\uc870 ENI\ub85c \uc5f0\uacb0\ub418\uba74 \u201c\uc6dc\u201d \uc0c1\ud0dc\uac00 \ub418\uc9c0\ub9cc, \uc5b4\ub5a4 \ud30c\ub4dc\uc5d0\uc11c\ub3c4 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uad6c\uccb4\uc801\uc73c\ub85c \ub9d0\ud558\uba74 ENI\uc758 IP \uc8fc\uc18c\uac00 \ud30c\ub4dc\uc640 \uc5f0\uacb0\ub418\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\uc785\ub2c8\ub2e4.</li> <li>\uc608: ENI\uac00 2\uac1c\uc774\uace0 \uac01 ENI\uac00 5\uac1c\uc758 IP \uc8fc\uc18c\ub97c \uc9c0\uc6d0\ud558\ub294 \uc778\uc2a4\ud134\uc2a4\ub97c \uc608\ub85c \ub4e4\uc5b4 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. WARM_ENI_TARGET\uc740 1\ub85c \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc815\ud655\ud788 5\uac1c\uc758 IP \uc8fc\uc18c\uac00 \uc5f0\uacb0\ub41c \uacbd\uc6b0 CNI\ub294 \uc778\uc2a4\ud134\uc2a4\uc5d0 2\uac1c\uc758 ENI\ub97c \uc5f0\uacb0\ud55c \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud569\ub2c8\ub2e4. \uccab \ubc88\uc9f8 ENI\uac00 \uc0ac\uc6a9 \uc911\uc774\uba70 \uc774 ENI\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c 5\uac1c IP \uc8fc\uc18c\uac00 \ubaa8\ub450 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \ub450 \ubc88\uc9f8 ENI\ub294 \ud480\uc5d0 5\uac1c IP \uc8fc\uc18c\uac00 \ubaa8\ub450 \uc788\ub294 \u201c\uc6dc\u201d \uc0c1\ud0dc\uc785\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \ub2e4\ub978 \ud30c\ub4dc\ub97c \uc2dc\uc791\ud558\ub294 \uacbd\uc6b0 6\ubc88\uc9f8 IP \uc8fc\uc18c\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. CNI\ub294 \uc774 6\ubc88\uc9f8 \ud30c\ub4dc\uc5d0 \ub450 \ubc88\uc9f8 ENI \ubc0f \ud480\uc758 5\uac1c\uc758 IP\uc5d0\uc11c IP \uc8fc\uc18c\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc774\uc81c \ub450 \ubc88\uc9f8 ENI\uac00 \uc0ac\uc6a9\ub418\uba70 \ub354 \uc774\uc0c1 \u201c\uc6dc\u201d \uc0c1\ud0dc\uac00 \uc544\ub2c8\uac8c \ub429\ub2c8\ub2e4. CNI\ub294 \ucd5c\uc18c 1\uac1c\uc758 \uc6dc ENI\ub97c \uc720\uc9c0\ud558\uae30 \uc704\ud574 \uc138 \ubc88\uc9f8 ENI\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4.</li> </ul> <p>Note</p> <p>\uc6dc ENI\ub3c4 VPC\uc758 CIDR\uc5d0 \uc788\ub294 IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. IP \uc8fc\uc18c\ub294 \ud30c\ub4dc\uc640 \uac19\uc740 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc5f0\uacb0\ub418\uae30 \uc804\uae4c\uc9c0\ub294 \u201c\ubbf8\uc0ac\uc6a9\u201d \ub610\ub294 \u201c\uc6dc\u201d \uc0c1\ud0dc\uac00 \ub429\ub2c8\ub2e4.</p> <ul> <li><code>WARM_IP_TARGET</code>, \uc815\uc218, \uac12\uc774 &gt;0\uc774\uba74 \uc694\uad6c \uc0ac\ud56d\uc774 \ud65c\uc131\ud654\ub41c \uac83\uc785\ub2c8\ub2e4.</li> <li>\uc720\uc9c0\ud560 \uc6dc IP \uc8fc\uc18c \uc218\uc785\ub2c8\ub2e4. \uc6dc IP\ub294 \ud65c\uc131 \uc5f0\uacb0\ub41c ENI\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc9c0\ub9cc \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \uc989, \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc6dc IP\uc758 \uc218\ub294 \ucd94\uac00 ENI \uc5c6\uc774 \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 IP\uc758 \uc218\uc785\ub2c8\ub2e4.</li> <li>\uc608: ENI\uac00 1\uac1c\uc774\uace0 \uac01 ENI\uac00 20\uac1c\uc758 IP \uc8fc\uc18c\ub97c \uc9c0\uc6d0\ud558\ub294 \uc778\uc2a4\ud134\uc2a4\ub97c \uc608\ub85c \ub4e4\uc5b4 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. WARM_IP_TARGET\uc740 5\ub85c \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. WARM_ENI_TARGET\uc740 0\uc73c\ub85c \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. 16\ubc88\uc9f8 IP \uc8fc\uc18c\uac00 \ud544\uc694\ud560 \ub54c\uae4c\uc9c0\ub294 ENI 1\uac1c\ub9cc \uc5f0\uacb0\ub429\ub2c8\ub2e4. \uadf8 \ub2e4\uc74c\uc5d0\ub294 CNI\uac00 \uc11c\ube0c\ub137 CIDR\uc758 \uac00\ub2a5\ud55c \uc8fc\uc18c 20\uac1c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub450 \ubc88\uc9f8 ENI\ub97c \uc5f0\uacb0\ud569\ub2c8\ub2e4.</li> <li><code>MINIMUM_IP_TARGET</code>, \uc815\uc218, \uac12\uc774 &gt;0\uc774\uba74 \uc694\uad6c \uc0ac\ud56d\uc774 \ud65c\uc131\ud654\ub41c \uac83\uc785\ub2c8\ub2e4.</li> <li>\uc5b8\uc81c\ub4e0\uc9c0 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 \ucd5c\uc18c IP \uc8fc\uc18c \uc218\uc785\ub2c8\ub2e4. \uc774\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \uc778\uc2a4\ud134\uc2a4 \uc2dc\uc791 \uc2dc \uc5ec\ub7ec ENI \ud560\ub2f9\uc744 \ubbf8\ub9ac \ubd88\ub7ec\uc624\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4.</li> <li>\uc608: \uc0c8\ub85c \uc2dc\uc791\ud55c \uc778\uc2a4\ud134\uc2a4\ub97c \uc608\ub85c \ub4e4\uc5b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. ENI\ub294 1\uac1c\uc774\uace0 \uac01 ENI\ub294 10\uac1c\uc758 IP \uc8fc\uc18c\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. MINIMUM_IP_TARGET\uc740 100\uc73c\ub85c \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. ENI\ub294 \ucd1d 100\uac1c\uc758 \uc8fc\uc18c\uc5d0 \ub300\ud574 9\uac1c\uc758 ENI\ub97c \uc989\uc2dc \ucd94\uac00\ub85c \uc5f0\uacb0\ud569\ub2c8\ub2e4. \uc774\ub294 <code>WARM_IP_TARGET</code> \ub610\ub294 <code>WARM_ENI_TARGET</code>\uac12\uacfc \uc0c1\uad00\uc5c6\uc774 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.</li> </ul> <p>\uc774 \ud504\ub85c\uc81d\ud2b8\uc5d0\ub294 \uc11c\ube0c\ub137 \uacc4\uc0b0\uae30 Excel \ubb38\uc11c\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\ub294 <code>WARM_IP_TARGET</code> \ubc0f <code>WARM_ENI_TARGET</code>\uacfc \uac19\uc740 \ub2e4\uc591\ud55c ENI \uad6c\uc131 \uc635\uc158\uc5d0 \ub530\ub77c \uc9c0\uc815\ub41c \uc6cc\ud06c\ub85c\ub4dc\uc758 IP \uc8fc\uc18c \uc0ac\uc6a9\uc744 \uc2dc\ubbac\ub808\uc774\uc158\ud569\ub2c8\ub2e4.</p> <p></p> <p>Kubelet\uc774 \ud30c\ub4dc \ucd94\uac00 \uc694\uccad\uc744 \ubc1b\uc73c\uba74, CNI \ubc14\uc774\ub108\ub9ac\ub294 ipamd\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c\ub97c \ucffc\ub9ac\ud558\uace0, ipamd\ub294 \uc774\ub97c \ud30c\ub4dc\uc5d0 \uc81c\uacf5\ud569\ub2c8\ub2e4. CNI \ubc14\uc774\ub108\ub9ac\ub294 \ud638\uc2a4\ud2b8\uc640 \ud30c\ub4dc \ub124\ud2b8\uc6cc\ud06c\ub97c \uc5f0\uacb0\ud569\ub2c8\ub2e4.</p> <p>\ub178\ub4dc\uc5d0 \ubc30\ud3ec\ub41c \ud30c\ub4dc\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uae30\ubcf8 ENI\uc640 \ub3d9\uc77c\ud55c \ubcf4\uc548 \uadf8\ub8f9\uc5d0 \ud560\ub2f9\ub418\uba70, \ud30c\ub4dc\ub97c \ub2e4\ub978 \ubcf4\uc548 \uadf8\ub8f9\uc73c\ub85c \uad6c\uc131\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>IP \uc8fc\uc18c \ud480\uc774 \uace0\uac08\ub418\uba74 \ud50c\ub7ec\uadf8\uc778\uc740 \uc790\ub3d9\uc73c\ub85c \ub2e4\ub978 Elastic Network Interface\ub97c \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc5f0\uacb0\ud558\uace0 \ud574\ub2f9 \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ub2e4\ub978 \ubcf4\uc870 IP \uc8fc\uc18c \uc138\ud2b8\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4. \uc774 \ud504\ub85c\uc138\uc2a4\ub294 \ub178\ub4dc\uac00 \ub354 \uc774\uc0c1 \ucd94\uac00 Elastic Network Interface\ub97c \uc9c0\uc6d0\ud560 \uc218 \uc5c6\uc744 \ub54c\uae4c\uc9c0 \uacc4\uc18d\ub429\ub2c8\ub2e4.</p> <p></p> <p>\ud30c\ub4dc\uac00 \uc0ad\uc81c\ub418\uba74 VPC CNI\ub294 \ud30c\ub4dc\uc758 IP \uc8fc\uc18c\ub97c 30\ucd08 \ucfe8\ub2e4\uc6b4 \uce90\uc2dc\uc5d0 \uc800\uc7a5\ud569\ub2c8\ub2e4. \ucfe8 \ub2e4\uc6b4 \uce90\uc2dc\uc758 IP\ub294 \uc2e0\uaddc \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ucfe8\ub9c1\uc624\ud504 \uc8fc\uae30\uac00 \ub05d\ub098\uba74 VPC CNI\ub294 \ud30c\ub4dc IP\ub97c \uc6dc \ud480\ub85c \ub2e4\uc2dc \uc62e\uae41\ub2c8\ub2e4. \ucfe8\ub9c1 \uc624\ud504 \uc8fc\uae30\ub294 \ud30c\ub4dc IP \uc8fc\uc18c\uac00 \ub108\ubb34 \uc774\ub974\uac8c \uc7ac\ud65c\uc6a9\ub418\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uace0 \ubaa8\ub4e0 \ud074\ub7ec\uc2a4\ud130 \ub178\ub4dc\uc758 kube-proxy\uac00 iptables \uaddc\uce59 \uc5c5\ub370\uc774\ud2b8\ub97c \uc644\ub8cc\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. IP \ub610\ub294 ENI\uc758 \uc218\uac00 \uc6dc \ud480 \uc124\uc815 \uc218\ub97c \ucd08\uacfc\ud558\uba74 ipamd \ud50c\ub7ec\uadf8\uc778\uc740 VPC\uc5d0 IP\uc640 ENI\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.</p> <p>\ubcf4\uc870 IP \ubaa8\ub4dc\uc5d0\uc11c \uc55e\uc11c \uc124\uba85\ud55c \ubc14\uc640 \uac19\uc774, \uac01 \ud30c\ub4dc\ub294 \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc5f0\uacb0\ub41c ENI \uc911 \ud558\ub098\ub85c\ubd80\ud130 \ud558\ub098\uc758 \ubcf4\uc870 \ud504\ub77c\uc774\ube57 IP \uc8fc\uc18c\ub97c \uc218\uc2e0\ud569\ub2c8\ub2e4. \uac01 \ud30c\ub4dc\ub294 IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \ud2b9\uc815 EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc\uc758 \uc218\ub294 \uc5f0\uacb0\ud560 \uc218 \uc788\ub294 ENI\uc758 \uc218\uc640 \uc9c0\uc6d0\ud558\ub294 IP \uc8fc\uc18c\uc758 \uc218\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9d1\ub2c8\ub2e4. VPC CNI\ub294 limit\ud30c\uc77c\uc744 \ud655\uc778\ud558\uc5ec \uac01 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ud5c8\uc6a9\ub418\ub294 ENI\uc640 IP \uc8fc\uc18c \uc218\ub97c \uc54c\uc544\ub0c5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uacf5\uc2dd\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\uc5d0 \ubc30\ud3ec\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \ud30c\ub4dc \uc218\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p><code>(\uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc758 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4 \uc218 \u00d7 (\ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub2f9 IP \uc8fc\uc18c \uc218 - 1)) + 2</code></p> <p>+2\ub294 kube-proxy \ubc0f VPC CNI\uc640 \uac19\uc740 \ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud0b9\uc5d0\uc11c \ud544\uc694\ud55c \ud30c\ub4dc\ub97c \ub098\ud0c0\ub0c5\ub2c8\ub2e4. Amazon EKS\uc5d0\uc11c\ub294 \uac01 \ub178\ub4dc\uc5d0\uc11c kube-proxy \ubc0f VPC CNI\uac00 \uc791\ub3d9\ud574\uc57c \ud558\uba70, \uc774\ub7ec\ud55c \uc694\uad6c \uc0ac\ud56d\uc740 max-pods \uac12\uc5d0 \ubc18\uc601\ub429\ub2c8\ub2e4. \ucd94\uac00 \ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud0b9 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub824\uba74 max-pods \uac12 \uc5c5\ub370\uc774\ud2b8\ub97c \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624.</p> <p>+2\ub294 kube-proxy \ubc0f VPC CNI\uc640 \uac19\uc740 \ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud0b9\uc744 \uc0ac\uc6a9\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\ub97c \ub098\ud0c0\ub0c5\ub2c8\ub2e4. Amazon EKS\ub294 \ubaa8\ub4e0 \ub178\ub4dc\uc5d0\uc11c kube-proxy\uc640 VPC CNI\ub97c \uc2e4\ud589\ud574\uc57c \ud558\uba70, \uc774\ub294 max-pods \uae30\uc900\uc73c\ub85c \uacc4\uc0b0\ub429\ub2c8\ub2e4. \ub354 \ub9ce\uc740 \ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud0b9 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud560 \uacc4\ud68d\uc774\ub77c\uba74 max-pods \uac12\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. \uc2dc\uc791 \ud15c\ud50c\ub9bf\uc5d0\uc11c <code>--kubelet-extra-args \"\u2014max-pods=110\"</code>\uc744 \uc0ac\uc6a9\uc790 \ub370\uc774\ud130\ub85c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4, c5.large \ub178\ub4dc 3\uac1c(ENI 3\uac1c, ENI\ub2f9 \ucd5c\ub300 10\uac1c IP)\uac00 \uc788\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud074\ub7ec\uc2a4\ud130\uac00 \uc2dc\uc791\ub418\uace0, CoreDNS \ud30c\ub4dc 2\uac1c\uac00 \uc788\ub294 \uacbd\uc6b0 CNI\ub294 49\uac1c\uc758 IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6dc \ud480\uc5d0 \ubcf4\uad00\ud569\ub2c8\ub2e4. \uc6dc \ud480\uc744 \uc0ac\uc6a9\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec \uc2dc \ud30c\ub4dc\ub97c \ub354 \ube60\ub974\uac8c \uc2dc\uc791\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub178\ub4dc 1 (CoreDNS \ud30c\ub4dc \ud3ec\ud568): ENI 2\uac1c, IP 20\uac1c \ud560\ub2f9</p> <p>\ub178\ub4dc 2 (CoreDNS \ud30c\ub4dc \ud3ec\ud568): ENI 2\uac1c, IP 20\uac1c \ud560\ub2f9</p> <p>\ub178\ub4dc 3 (\ud30c\ub4dc \uc5c6\uc74c): ENI 1\uac1c, IP 10\uac1c \ud560\ub2f9</p> <p>\uc8fc\ub85c \ub370\ubaac\uc14b\uc73c\ub85c \uc2e4\ud589\ub418\ub294 \uc778\ud504\ub77c \ud30c\ub4dc\ub294 \uac01\uac01 \ucd5c\ub300 \ud30c\ub4dc \uc218\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce5c\ub2e4\ub294 \uc810\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc5d0\ub294 \ub2e4\uc74c\uc774 \ud3ec\ud568\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>CoreDNS</li> <li>Amazon Elastic LoadBalancer</li> <li>metrics-server \uc6b4\uc601\uc6a9 Pods</li> </ul> <p>\uc774\ub7ec\ud55c \ud30c\ub4dc\ub4e4\uc758 \uc6a9\ub7c9\uc744 \uc870\ud569\ud558\uc5ec \uc778\ud504\ub77c\ub97c \uacc4\ud68d\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uac01 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0\uc11c \uc9c0\uc6d0\ud558\ub294 \ucd5c\ub300 \ud30c\ub4dc \uc218 \ubaa9\ub85d\uc740 GitHub\uc758 eni-max-Pods.txt\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p></p>"},{"location":"ko/networking/vpc-cni/#_2","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/networking/vpc-cni/#vpc-cni","title":"VPC CNI \uad00\ub9ac\ud615 \uc560\ub4dc\uc628 \ubc30\ud3ec","text":"<p>\ud074\ub7ec\uc2a4\ud130\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uba74 Amazon EKS\uac00 \uc790\ub3d9\uc73c\ub85c VPC CNI\ub97c \uc124\uce58\ud569\ub2c8\ub2e4. \uadf8\ub7fc\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 Amazon EKS\ub294 \ud074\ub7ec\uc2a4\ud130\uac00 \ucef4\ud4e8\ud305, \uc2a4\ud1a0\ub9ac\uc9c0, \ub124\ud2b8\uc6cc\ud0b9\uacfc \uac19\uc740 \uae30\ubcf8 AWS \ub9ac\uc18c\uc2a4\uc640 \uc0c1\ud638 \uc791\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. VPC CNI\ub97c \ube44\ub86f\ud55c \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>Amazon EKS \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc740 Amazon EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc704\ud55c VPC CNI \uc124\uce58 \ubc0f \uad00\ub9ac\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. Amazon EKS \uc560\ub4dc\uc628\uc5d0\ub294 \ucd5c\uc2e0 \ubcf4\uc548 \ud328\uce58, \ubc84\uadf8 \uc218\uc815\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc73c\uba70, Amazon EKS\uc640 \ud638\ud658\ub418\ub294\uc9c0 AWS\uc758 \uac80\uc99d\uc744 \uac70\ucce4\uc2b5\ub2c8\ub2e4. VPC CNI \uc560\ub4dc\uc628\uc744 \uc0ac\uc6a9\ud558\uba74 Amazon EKS \ud074\ub7ec\uc2a4\ud130\uc758 \ubcf4\uc548 \ubc0f \uc548\uc815\uc131\uc744 \uc9c0\uc18d\uc801\uc73c\ub85c \ubcf4\uc7a5\ud558\uace0 \ucd94\uac00 \uae30\ub2a5\uc744 \uc124\uce58, \uad6c\uc131 \ubc0f \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \ub370 \ud544\uc694\ud55c \ub178\ub825\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc740 Amazon EKS API, AWS \uad00\ub9ac \ucf58\uc194, AWS CLI \ubc0f eksctl\uc744 \ud1b5\ud574 \ucd94\uac00, \uc5c5\ub370\uc774\ud2b8 \ub610\ub294 \uc0ad\uc81c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p><code>kubectl get</code> \uba85\ub839\uc5b4\uc640 \ud568\uaed8 <code>--show-managed-fields</code> \ud50c\ub798\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec VPC CNI\uc758 \uad00\ub9ac\ud615 \ud544\ub4dc\ub97c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl get daemonset aws-node --show-managed-fields -n kube-system -o yaml\n</code></pre> <p>\uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc740 15\ubd84\ub9c8\ub2e4 \uad6c\uc131\uc744 \uc790\ub3d9\uc73c\ub85c \ub36e\uc5b4\uc4f0\ub294 \uac83\uc73c\ub85c \uad6c\uc131 \ubcc0\ub3d9\uc744 \ubc29\uc9c0\ud569\ub2c8\ub2e4. \uc989, \uc560\ub4dc\uc628 \uc0dd\uc131 \ud6c4 Kubernetes API\ub97c \ud1b5\ud574 \ubcc0\uacbd\ud55c \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc740 \uc790\ub3d9\ud654\ub41c \ub4dc\ub9ac\ud504\ud2b8 \ubc29\uc9c0 \ud504\ub85c\uc138\uc2a4\uc5d0 \uc758\ud574 \ub36e\uc5b4\uc4f0\uc5ec\uc9c0\uace0 \uc560\ub4dc\uc628 \uc5c5\ub370\uc774\ud2b8 \ud504\ub85c\uc138\uc2a4 \uc911\uc5d0\ub3c4 \uae30\ubcf8\uac12\uc73c\ub85c \uc124\uc815\ub429\ub2c8\ub2e4.</p> <p>EKS\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 \ud544\ub4dc\ub294 managedFields \ud558\uc704\uc5d0 \ub098\uc5f4\ub418\uba70 \uc774 \ud544\ub4dc\uc5d0 \ub300\ud55c \uad00\ub9ac\uc790\ub294 EKS\uc785\ub2c8\ub2e4. EKS\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 \ud544\ub4dc\uc5d0\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8, \uc774\ubbf8\uc9c0, \uc774\ubbf8\uc9c0 URL, liveness probe, readiness probe, \ub808\uc774\ube14, \ubcfc\ub968 \ubc0f \ubcfc\ub968 \ub9c8\uc6b4\ud2b8\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4.</p> <p>Info</p> <p>WARM_ENI_TARGET, WARM_IP_TARGET, MINIMUM_IP_TARGET\uacfc \uac19\uc774 \uc790\uc8fc \uc0ac\uc6a9\ub418\ub294 \ud544\ub4dc\ub294 \uad00\ub9ac\ub418\uc9c0 \uc54a\uc73c\uba70 \uc870\uc815\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ud544\ub4dc\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc740 \uc560\ub4dc\uc628 \uc5c5\ub370\uc774\ud2b8 \uc2dc\uc5d0\ub3c4 \uc720\uc9c0\ub429\ub2c8\ub2e4.</p> <p>\ud504\ub85c\ub355\uc158 \ud074\ub7ec\uc2a4\ud130\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uae30 \uc804, \ud2b9\uc815 \uad6c\uc131\uc758 \ube44\ud504\ub85c\ub355\uc158 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc560\ub4dc\uc628 \ub3d9\uc791\uc744 \ud14c\uc2a4\ud2b8\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uc560\ub4dc\uc628 \uad6c\uc131\uc5d0 \ub300\ud574\uc11c\ub294 EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\uc758 \ub2e8\uacc4\ub97c \ub530\ub77c\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/vpc-cni/#_3","title":"\uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158","text":"<p>\uc790\uccb4 \uad00\ub9ac\ud615 VPC CNI\uc758 \ubc84\uc804 \ud638\ud658\uc131\uc744 \uad00\ub9ac\ud558\uace0 \ubcf4\uc548 \ud328\uce58\ub97c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4. \uc790\uccb4 \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\ub824\uba74 EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\uc5d0 \uc124\uba85\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc640 \uc548\ub0b4 \uc0ac\ud56d\ub4e4\uc744 \ud65c\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uae30\uc874 EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uacbd\uc6b0, \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\ub294 \uac83\uc774 \uc88b\uc73c\uba70, \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc804\uc5d0 \ud604\uc7ac CNI \uc124\uc815\uc744 \ubc31\uc5c5\ud574 \ub458 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc744 \uad6c\uc131\ud558\uae30 \uc704\ud574 Amazon EKS API, AWS \uad00\ub9ac \ucf58\uc194 \ub610\ub294 AWS \uba85\ub839\uc904 \uc778\ud130\ud398\uc774\uc2a4\ub97c \ud65c\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl apply view-last-applied daemonset aws-node -n kube-system &gt; aws-k8s-cni-old.yaml\n</code></pre> <p>\ud544\ub4dc \uae30\ubcf8 \uc124\uc815\uc5d0 \uad00\ub9ac\ud615\uc73c\ub85c \ud45c\uc2dc\ub41c \uacbd\uc6b0 Amazon EKS\ub294 CNI \uad6c\uc131 \uc124\uc815\uc744 \ub300\uccb4\ud569\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ud544\ub4dc\ub97c \uc218\uc815\ud558\uc9c0 \uc54a\ub3c4\ub85d \uc8fc\uc758\ud569\ub2c8\ub2e4. \uc560\ub4dc\uc628\uc740 \uc6dc \ud658\uacbd \ubcc0\uc218 \ubc0f CNI \ubaa8\ub4dc\uc640 \uac19\uc740 \uad6c\uc131 \ud544\ub4dc\ub97c \uc870\uc815\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc\uc640 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \uad00\ub9ac\ud615 CNI\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\ub294 \ub3d9\uc548 \uacc4\uc18d \uc2e4\ud589\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/networking/vpc-cni/#cni","title":"\uc5c5\ub370\uc774\ud2b8 \uc804 CNI \uc124\uc815 \ubc31\uc5c5","text":"<p>VPC CNI\ub294 \uace0\uac1d\uc758 \ub370\uc774\ud130 \ud50c\ub808\uc778(\ub178\ub4dc)\uc5d0\uc11c \uc2e4\ud589\ub418\ubbc0\ub85c Amazon EKS\ub294 \uc2e0\uaddc \ubc84\uc804\uc774 \ucd9c\uc2dc\ub418\uac70\ub098 \ud074\ub7ec\uc2a4\ud130\ub97c \uc5c5\ub370\uc774\ud2b8\ud55c \ud6c4\uc5d0 \uc2e0\uaddc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9c8\uc774\ub108 \ubc84\uc804\uc73c\ub85c (\uad00\ub9ac\ud615 \ubc0f \uc790\uccb4 \uad00\ub9ac\ud615)\uc560\ub4dc\uc628\uc744 \uc790\ub3d9\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uae30\uc874 \ud074\ub7ec\uc2a4\ud130\uc758 \uc560\ub4dc\uc628\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\ub824\uba74 update-addon API\ub97c \uc0ac\uc6a9\ud558\uac70\ub098 EKS \ucf58\uc194\uc5d0\uc11c \uc560\ub4dc\uc628\uc6a9 \uc9c0\uae08 \uc5c5\ub370\uc774\ud2b8(Update Now) \ub9c1\ud06c\ub97c \ud074\ub9ad\ud558\uc5ec \uc5c5\ub370\uc774\ud2b8\ub97c \ud2b8\ub9ac\uac70\ud574\uc57c \ud569\ub2c8\ub2e4. \uc790\uccb4 \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc744 \ubc30\ud3ec\ud55c \uacbd\uc6b0 \uc790\uccb4 \uad00\ub9ac\ud615 VPC CNI \uc560\ub4dc\uc628 \uc5c5\ub370\uc774\ud2b8\uc5d0 \uc548\ub0b4\ub41c \ub2e8\uacc4\ub97c \ub530\ub974\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p> <p>\ub9c8\uc774\ub108 \ubc84\uc804\uc740 \ud55c \ubc88\uc5d0 \ud558\ub098\uc529 \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ud604\uc7ac \ub9c8\uc774\ub108 \ubc84\uc804\uc774 <code>1.9</code>\uc774\uace0 <code>1.11</code>\ub85c \uc5c5\ub370\uc774\ud2b8\ud560 \uacbd\uc6b0, \uba3c\uc800 <code>1.10</code>\uc758 \ucd5c\uc2e0 \ud328\uce58 \ubc84\uc804\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud55c \ub2e4\uc74c <code>1.11</code>\uc758 \ucd5c\uc2e0 \ud328\uce58 \ubc84\uc804\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>Amazon VPC CNI\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uae30 \uc804\uc5d0 AWS \ub178\ub4dc \ub370\ubaac\uc14b \uac80\uc0ac\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. \uae30\uc874 \uc124\uc815\uc744 \ubc31\uc5c5\ud569\ub2c8\ub2e4. \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 Amazon EKS\uc5d0\uc11c \uc7ac\uc815\uc758\ud560 \uc218 \uc788\ub294 \uc124\uc815\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0 \uc54a\uc558\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. \uace0\uac1d\uc758 \uc790\ub3d9\ud654 \uc6cc\ud06c\ud50c\ub85c\uc758 \uc5c5\ub370\uc774\ud2b8 \ud6c5\uc744 \uc801\uc6a9\ud558\uac70\ub098 \ud639\uc740 \uc560\ub4dc\uc628 \uc5c5\ub370\uc774\ud2b8 \ud6c4 \uc218\ub3d9 \uc801\uc6a9 \ub2e8\uacc4\ub97c \ucd94\uac00\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p> <pre><code>kubectl apply view-last-applied daemonset aws-node -n kube-system &gt; aws-k8s-cni-old.yaml\n</code></pre> <p>\uc790\uccb4 \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc758 \uacbd\uc6b0 \ubc31\uc5c5\uc744 GitHub\uc758 <code>releases</code> \ub0b4\uc6a9\uacfc \ube44\uad50\ud558\uc5ec \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ubc84\uc804\uc744 \ud655\uc778\ud558\uace0 \uc5c5\ub370\uc774\ud2b8\ud558\ub824\ub294 \ubc84\uc804\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc744 \uc219\uc9c0\ud569\ub2c8\ub2e4. \uc790\uccb4 \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc744 \uad00\ub9ac\ud558\uae30 \uc704\ud574 \ud5ec\ub984(Helm)\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud558\uba70, values \ud30c\uc77c\uc744 \ud65c\uc6a9\ud558\uc5ec \uc124\uc815\uc744 \uc801\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ub370\ubaac\uc14b \uc0ad\uc81c\uc640 \uad00\ub828\ub41c \ubaa8\ub4e0 \uc5c5\ub370\uc774\ud2b8 \uc791\uc5c5\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub2e4\uc6b4\ud0c0\uc784\uc73c\ub85c \uc774\uc5b4\uc9c0\ubbc0\ub85c \ud53c\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/vpc-cni/#_4","title":"\ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8 \uc774\ud574","text":"<p>VPC CNI\ub97c \ud6a8\uc728\uc801\uc73c\ub85c \uad00\ub9ac\ud558\uae30 \uc704\ud574 \uad6c\uc131\ub41c \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc774\ud574\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. Amazon VPC CNI\uc5d0\ub294 CNI \ubc14\uc774\ub108\ub9ac\uc640 ipamd(aws-node) \ub370\ubaac\uc14b\uc774\ub77c\ub294 \ub450 \uac00\uc9c0 \uad6c\uc131 \uc694\uc18c\uac00 \uc788\uc2b5\ub2c8\ub2e4. CNI\ub294 \ub178\ub4dc\uc5d0\uc11c \ubc14\uc774\ub108\ub9ac\ub85c \uc2e4\ud589\ub418\uba70 \ub178\ub4dc \ub8e8\ud2b8 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc73c\uba70, \ub178\ub4dc \uc218\uc900\uc5d0\uc11c iptables\ub97c \ucc98\ub9ac\ud558\ubbc0\ub85c privileged \uc811\uadfc\uc5d0 \ub300\ud55c \uad8c\ud55c\ub3c4 \uac16\uc2b5\ub2c8\ub2e4. CNI \ubc14\uc774\ub108\ub9ac\ub294 \ud30c\ub4dc\uac00 \ucd94\uac00\ub418\uac70\ub098 \uc81c\uac70\ub420 \ub54c kubelet\uc5d0 \uc758\ud574 \ud638\ucd9c\ub429\ub2c8\ub2e4.</p> <p>aws-node \ub370\ubaac\uc14b\uc740 \ub178\ub4dc \uc218\uc900\uc5d0\uc11c IP \uc8fc\uc18c \uad00\ub9ac\ub97c \ub2f4\ub2f9\ud558\ub294 \uc7a5\uae30 \uc2e4\ud589 \ud504\ub85c\uc138\uc2a4\uc785\ub2c8\ub2e4. aws-node\ub294 <code>hostNetwork</code> \ubaa8\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\uba70 \ub8e8\ud504\ubc31 \ub514\ubc14\uc774\uc2a4 \ubc0f \ub3d9\uc77c\ud55c \ub178\ub4dc\uc5d0 \uc788\ub294 \ub2e4\ub978 \ud30c\ub4dc\uc758 \ub124\ud2b8\uc6cc\ud06c \ud65c\ub3d9\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \ud5c8\uc6a9\ud569\ub2c8\ub2e4. aws-node\uc758 \ucd08\uae30\ud654 \ucee8\ud14c\uc774\ub108\ub294 privileged \ubaa8\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\uba70 CRI \uc18c\ucf13\uc744 \ub9c8\uc6b4\ud2b8\ud558\uc5ec \ub370\ubaac\uc14b\uc774 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\uc758 IP \uc0ac\uc6a9\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. Amazon EKS\ub294 aws-node\uc758 \ucd08\uae30\ud654 \ucee8\ud14c\uc774\ub108\uc758 privileged \uc694\uad6c \uc870\uac74\uc744 \uc81c\uac70\ud558\uae30 \uc704\ud574 \ub178\ub825\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c aws-node\ub294 NAT \uc5d4\ud2b8\ub9ac\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uace0 iptables \ubaa8\ub4c8\uc744 \ub85c\ub4dc\ud574\uc57c \ud558\ubbc0\ub85c NET_ADMIN \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>Amazon EKS\ub294 \ud30c\ub4dc \ubc0f \ub124\ud2b8\uc6cc\ud0b9 \uc124\uc815\uc758 IP \uad00\ub9ac\ub97c \uc704\ud574 aws-node \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0\uc11c \uc815\uc758\ud55c \ub300\ub85c \ubcf4\uc548 \uc815\ucc45\uc744 \ubc30\ud3ec\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ucd5c\uc2e0 \ubc84\uc804\uc758 VPC CNI\ub85c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. \ub610\ud55c \ud2b9\uc815 \ubcf4\uc548 \uc694\uad6c \uc0ac\ud56d\uc774 \uc788\ub294 \uacbd\uc6b0 GitHub \uc774\uc288\ub97c \ud655\uc778\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/vpc-cni/#cni-iam","title":"CNI\uc5d0 \ubcc4\ub3c4\uc758 IAM \uc5ed\ud560 \uc0ac\uc6a9","text":"<p>AWS VPC CNI\uc5d0\ub294 AWS \uc790\uaca9 \uc99d\uba85 \ubc0f \uc561\uc138\uc2a4 \uad00\ub9ac(IAM) \uad8c\ud55c\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. IAM \uc5ed\ud560\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 \uba3c\uc800 CNI \uc815\ucc45\uc744 \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. IPv4 \ud074\ub7ec\uc2a4\ud130\uc6a9 AWS \uad00\ub9ac\ud615 \uc815\ucc45\uc778 <code>AmazonEKS_CNI_Policy</code>\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Amazon EKS\uc758 CNI \uad00\ub9ac\ud615 \uc815\ucc45\uc5d0\ub294 IPv4 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uad8c\ud55c\ub9cc \uc874\uc7ac\ud569\ub2c8\ub2e4. \uc774 \ub9c1\ud06c\uc5d0 \ud45c\uc2dc\ub41c \uad8c\ud55c\uc744 \uc0ac\uc6a9\ud558\uc5ec IPv6 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud574 \ubcc4\ub3c4\uc758 IAM \uc815\ucc45\uc744 \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uae30\ubcf8\uc801\uc73c\ub85c VPC CNI\ub294 (\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uacfc \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 \ubaa8\ub450)Amazon EKS \ub178\ub4dc IAM \uc5ed\ud560\uc744 \uc0c1\uc18d\ud569\ub2c8\ub2e4.</p> <p>Amazon VPC CNI\uc5d0 \ub300\ud55c \uad00\ub828 \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubcc4\ub3c4\uc758 IAM \uc5ed\ud560\uc744 \uad6c\uc131\ud558\ub294 \uac83\uc744 \uac15\ub825\ud558\uac8c \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uadf8\ub807\uc9c0 \uc54a\uc740 \uacbd\uc6b0 Amazon VPC CNI\uc758 \ud30c\ub4dc\ub294 \ub178\ub4dc IAM \uc5ed\ud560\uc5d0 \ud560\ub2f9\ub41c \uad8c\ud55c\uc744 \uc5bb\uace0 \ub178\ub4dc\uc5d0 \ud560\ub2f9\ub41c \uc778\uc2a4\ud134\uc2a4 \ud504\ub85c\ud544\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>VPC CNI \ud50c\ub7ec\uadf8\uc778\uc740 aws-node\ub77c\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc0dd\uc131\ud558\uace0 \uad6c\uc131\ud569\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub294 Amazon EKS CNI \uc815\ucc45\uc774 \uc5f0\uacb0\ub41c Amazon EKS \ub178\ub4dc\uc758 IAM \uc5ed\ud560\uc5d0 \ubc14\uc778\ub529\ub429\ub2c8\ub2e4. \ubcc4\ub3c4\uc758 IAM \uc5ed\ud560\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 Amazon EKS CNI \uc815\ucc45\uc774 \uc5f0\uacb0\ub41c \uc2e0\uaddc \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc0dd\uc131\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc2e0\uaddc \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 CNI \ud30c\ub4dc \uc7ac\ubc30\ud3ec\ub97c \uc9c4\ud589\ud574\uc57c \ud569\ub2c8\ub2e4. \uc2e0\uaddc \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud560 \ub54c VPC CNI \uad00\ub9ac\ud615 \uc560\ub4dc\uc628\uc5d0 <code>--service-account-role-arn</code>\uc744 \uc9c0\uc815\ud558\ub294 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. \uc774 \ub54c Amazon EKS \ub178\ub4dc\uc758 IAM \uc5ed\ud560\uc5d0\uc11c IPv4\uc640 IPv6 \ubaa8\ub450\uc5d0 \ub300\ud55c Amazon EKS CNI \uc815\ucc45\uc744 \ubc18\ub4dc\uc2dc \uc81c\uac70\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ubcf4\uc548 \uce68\ud574\uc758 \ud53c\ud574 \ubc94\uc704\ub97c \ucd5c\uc18c\ud654\ud558\uae30 \uc704\ud574 \uc778\uc2a4\ud134\uc2a4 \uba54\ud0c0\ub370\uc774\ud130 \uc811\uadfc\uc744 \ucc28\ub2e8\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/vpc-cni/#livenessreadiness-probe","title":"Liveness/Readiness Probe \uc2e4\ud328 \ucc98\ub9ac","text":"<p>\ud504\ub85c\ube0c \uc2e4\ud328\ub85c \uc778\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ud30c\ub4dc\uac00 \ucee8\ud14c\uc774\ub108 \uc0dd\uc131 \uc0c1\ud0dc\uc5d0\uc11c \uba48\ucd94\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud574 EKS 1.20 \ubc84\uc804 \uc774\uc0c1 \ud074\ub7ec\uc2a4\ud130\uc758 liveness \ubc0f readiness probe\uc758 \ud0c0\uc784\uc544\uc6c3 \uac12 (\uae30\ubcf8\uac12 <code>TimeoutSeconds: 10</code>)\uc744 \ub192\uc77c \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ud574\ub2f9 \uc774\uc288\ub294 \ub370\uc774\ud130 \uc9d1\uc57d\uc801\uc778 \ubc30\uce58 \ucc98\ub9ac \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ubc1c\uacac\ub418\uc5c8\uc2b5\ub2c8\ub2e4. CPU\ub97c \ub9ce\uc774 \uc0ac\uc6a9\ud558\uba74 aws-node \ud504\ub85c\ube0c \uc0c1\ud0dc \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\uc5ec Pod CPU \ub9ac\uc18c\uc2a4 \uc694\uccad\uc774 \ucda9\uc871\ub418\uc9c0 \uc54a\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud504\ub85c\ube0c \ud0c0\uc784\uc544\uc6c3\uc744 \uc218\uc815\ud558\ub294 \uac83 \uc678\uc5d0\ub3c4 aws-node\uc5d0 \ub300\ud55c CPU \ub9ac\uc18c\uc2a4 \uc694\uccad(\uae30\ubcf8\uac12 <code>CPU: 25m</code>)\uc774 \uc62c\ubc14\ub974\uac8c \uad6c\uc131\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. \ub178\ub4dc\uc5d0 \ubb38\uc81c\uac00 \uc788\ub294 \uacbd\uc6b0\uac00 \uc544\ub2c8\uba74 \uc124\uc815\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0 \uc54a\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p> <p>Amazon EKS \uc9c0\uc6d0\uc744 \ubc1b\ub294 \ub3d9\uc548 \ub178\ub4dc\uc5d0\uc11c sudo <code>bash /opt/cni/bin/aws-cni-support.sh</code>\ub97c \uc2e4\ud589\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc774 \uc2a4\ud06c\ub9bd\ud2b8\ub294 \ub178\ub4dc\uc758 kubelet \ub85c\uadf8\uc640 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960\uc744 \ud3c9\uac00\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4. \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud558\uae30 \uc704\ud574 Amazon EKS \uc6cc\ucee4 \ub178\ub4dc\uc5d0 SSM \uc5d0\uc774\uc804\ud2b8\ub97c \uc124\uce58\ud558\ub294 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/networking/vpc-cni/#eks-ami-iptables","title":"\ube44 EKS \ucd5c\uc801\ud654 AMI \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c IPtables \uc804\ub2ec \uc815\ucc45 \uad6c\uc131","text":"<p>\uc0ac\uc6a9\uc790 \uc9c0\uc815 AMI\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 kubelet.service\uc5d0\uc11c iptables \uc804\ub2ec \uc815\ucc45\uc744 ACCEPT\ub85c \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \ub9ce\uc740 \uc2dc\uc2a4\ud15c\uc5d0\uc11c iptables \uc804\ub2ec \uc815\ucc45\uc774 DROP\uc73c\ub85c \uc124\uc815\ub429\ub2c8\ub2e4. HashiCorp Packer\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc0ac\uc6a9\uc790 \uc9c0\uc815 AMI\ub97c, AWS GitHub\uc758 Amazon EKS AMI \uc800\uc7a5\uc18c\uc5d0\uc11c \ub9ac\uc18c\uc2a4 \ubc0f \uad6c\uc131 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \ube4c\ub4dc \uc0ac\uc591\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. kubelet.service\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uace0 \uc774 \ub9c1\ud06c\uc5d0 \uc124\uba85\ub41c \uc548\ub0b4\uc5d0 \ub530\ub77c \uc0ac\uc6a9\uc790 \uc9c0\uc815 AMI\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/networking/vpc-cni/#cni_1","title":"\uc815\uae30\uc801\uc778 CNI \ubc84\uc804 \uc5c5\uadf8\ub808\uc774\ub4dc","text":"<p>VPC CNI\ub294 \uc774\uc804 \ubc84\uc804\uacfc \ud638\ud658\ub429\ub2c8\ub2e4. \ucd5c\uc2e0 \ubc84\uc804\uc740 \ubaa8\ub4e0 Amazon EKS\uc5d0\uc11c \uc9c0\uc6d0\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uacfc \ud638\ud658\ub429\ub2c8\ub2e4. \ub610\ud55c VPC CNI\ub294 EKS \uc560\ub4dc\uc628\uc73c\ub85c \uc81c\uacf5\ub429\ub2c8\ub2e4(\uc704\uc758 \u201cVPC CNI \uad00\ub9ac\ud615 \uc560\ub4dc\uc628 \ubc30\ud3ec\u201d \ucc38\uc870). EKS \uc560\ub4dc\uc628\uc740 \uc560\ub4dc\uc628 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uad00\ub9ac\ud558\uc9c0\ub9cc CNI\uc640 \uac19\uc740 \uc560\ub4dc\uc628\uc740 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc5d0\uc11c \uc2e4\ud589\ub418\ubbc0\ub85c \uc790\ub3d9\uc73c\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ubc0f \uc790\uccb4 \uad00\ub9ac\ud615 \uc6cc\ucee4 \ub178\ub4dc \uc5c5\uadf8\ub808\uc774\ub4dc \ud6c4\uc5d0\ub294 VPC CNI \uc560\ub4dc\uc628\uc744 \uc5c5\uadf8\ub808\uc774\ub4dc\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/","title":"\uc2e0\ub8b0\uc131\uc744 \uc704\ud55c Amazon EKS \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc","text":"<p>\uc774 \uc139\uc158\uc5d0\uc11c\ub294 EKS\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc758 \ubcf5\uc6d0\ub825\uacfc \uac00\uc6a9\uc131\uc744 \ub192\uc774\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc9c0\uce68\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/#_1","title":"\uc774 \uac00\uc774\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95","text":"<p>\uc774 \uc548\ub0b4\uc11c\ub294 EKS\uc5d0\uc11c \uac00\uc6a9\uc131\uc774 \ub192\uace0 \ub0b4\uacb0\ud568\uc131\uc774 \uc788\ub294 \uc11c\ube44\uc2a4\ub97c \uac1c\ubc1c\ud558\uace0 \uc6b4\uc601\ud558\ub824\ub294 \uac1c\ubc1c\uc790\uc640 \uc124\uacc4\uc790\ub97c \ub300\uc0c1\uc73c\ub85c \ud569\ub2c8\ub2e4. \uc774 \uac00\uc774\ub4dc\ub294 \ubcf4\ub2e4 \uc27d\uac8c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ub2e4\uc591\ud55c \uc8fc\uc81c \uc601\uc5ed\uc73c\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uac01 \ud56d\ubaa9\uc740 \uac04\ub7b5\ud55c \uac1c\uc694\ub85c \uc2dc\uc791\ud558\uc5ec EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uc2e0\ub8b0\uc131\uc744 \uc704\ud55c \uad8c\uc7a5 \uc0ac\ud56d \ubc0f \ubaa8\ubc94 \uc0ac\ub840 \ubaa9\ub85d\uc774 \uc774\uc5b4\uc9d1\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/#_2","title":"\uc18c\uac1c","text":"<p>EKS\uc758 \uc2e0\ub8b0\uc131 \ubaa8\ubc94 \uc0ac\ub840\ub294 \ub2e4\uc74c \uc8fc\uc81c\uc5d0 \ub530\ub77c \uadf8\ub8f9\ud654\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uc560\ud50c\ub9ac\ucf00\uc774\uc158</li> <li>\ucee8\ud2b8\ub864 \ud50c\ub808\uc778</li> <li>\ub370\uc774\ud130 \ud50c\ub808\uc778</li> </ul> <p>\ubb34\uc5c7\uc774 \uc2dc\uc2a4\ud15c\uc744 \uc2e0\ub8b0\ud560 \uc218 \uc788\uac8c \ub9cc\ub4dc\ub098\uc694? \uc77c\uc815 \uae30\uac04\uc758 \ud658\uacbd \ubcc0\ud654\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 \uc2dc\uc2a4\ud15c\uc774 \uc77c\uad00\ub418\uac8c \uc791\ub3d9\ud558\uace0 \uc694\uad6c \uc0ac\ud56d\uc744 \ucda9\uc871\ud560 \uc218 \uc788\ub2e4\uba74 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub2e4\uace0 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \uc704\ud574\uc11c\ub294 \uc2dc\uc2a4\ud15c\uc774 \uc7a5\uc560\ub97c \uac10\uc9c0\ud558\uace0 \uc790\ub3d9\uc73c\ub85c \ubcf5\uad6c\ud558\uba70 \uc218\uc694\uc5d0 \ub530\ub77c \ud655\uc7a5\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uace0\uac1d\uc740 Kubernetes\ub97c \uae30\ubc18\uc73c\ub85c \uc0ac\uc6a9\ud558\uc5ec \uc5c5\ubb34\uc0c1 \uc911\uc694\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubc0f \uc11c\ube44\uc2a4\ub97c \uc548\uc815\uc801\uc73c\ub85c \uc6b4\uc601\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \ucee8\ud14c\uc774\ub108 \uae30\ubc18 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc124\uacc4 \uc6d0\uce59\uc744 \ud1b5\ud569\ud558\ub294 \uac83 \uc678\uc5d0\ub3c4 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc548\uc815\uc801\uc73c\ub85c \uc2e4\ud589\ud558\ub824\uba74 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \uc778\ud504\ub77c\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc778\ud504\ub77c\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ub370\uc774\ud130 \ud50c\ub808\uc778\uc73c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4.</p> <p>EKS\ub294 \uac00\uc6a9\uc131\uacfc \ub0b4\uacb0\ud568\uc131\uc744 \uc81c\uacf5\ud558\ub3c4\ub85d \uc124\uacc4\ub41c \ud504\ub85c\ub355\uc158 \ub4f1\uae09\uc758 Kubernetes \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4.</p> <p>EKS\uc5d0\uc11c AWS\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \uc2e0\ub8b0\uc131\uc744 \ucc45\uc784\uc9d1\ub2c8\ub2e4. EKS\ub294 AWS \ub9ac\uc804\uc758 \uc138 \uac00\uc6a9 \uc601\uc5ed\uc5d0\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \ubc0f etcd \ud074\ub7ec\uc2a4\ud130\uc758 \uac00\uc6a9\uc131\uacfc \ud655\uc7a5\uc131\uc744 \uc790\ub3d9\uc73c\ub85c \uad00\ub9ac\ud569\ub2c8\ub2e4.</p> <p>\ub370\uc774\ud130 \ud50c\ub808\uc778\uc758 \uc2e0\ub8b0\uc131\uc5d0 \ub300\ud55c \ucc45\uc784\uc740 \uc0ac\uc6a9\uc790, \uace0\uac1d, AWS \uac04\uc5d0 \uacf5\uc720\ub429\ub2c8\ub2e4. EKS\ub294 Kubernetes \ub370\uc774\ud130 \ud50c\ub808\uc778\uc5d0 \ub300\ud55c \uc138 \uac00\uc9c0 \uc635\uc158\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uac00\uc7a5 \ub9ce\uc774 \uad00\ub9ac\ub418\ub294 \uc635\uc158\uc778 Fargate\ub294 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc758 \ud504\ub85c\ube44\uc800\ub2dd \ubc0f \ud655\uc7a5\uc744 \ucc98\ub9ac\ud569\ub2c8\ub2e4. \ub450 \ubc88\uc9f8 \uc635\uc158\uc778 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\ud654\ub294 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc758 \ud504\ub85c\ube44\uc800\ub2dd \ubc0f \uc5c5\ub370\uc774\ud2b8\ub97c \ucc98\ub9ac\ud569\ub2c8\ub2e4. \ub9c8\uc9c0\ub9c9\uc73c\ub85c, \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc\ub294 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc5d0 \ub300\ud55c \uad00\ub9ac\uac00 \uac00\uc7a5 \uc801\uc740 \uc635\uc158\uc785\ub2c8\ub2e4. AWS \uad00\ub9ac\ud615 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc744 \ub354 \ub9ce\uc774 \uc0ac\uc6a9\ud560\uc218\ub85d \ucc45\uc784\uc740 \uc904\uc5b4\ub4ed\ub2c8\ub2e4.</p> <p>\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 EC2 \ub178\ub4dc\uc758 \ud504\ub85c\ube44\uc800\ub2dd \ubc0f \uc218\uba85 \uc8fc\uae30 \uad00\ub9ac\ub97c \uc790\ub3d9\ud654\ud569\ub2c8\ub2e4. EKS API (EKS \ucf58\uc194, AWS API, AWS CLI, CloudFormation, Terraform \ub610\ub294 <code>eksctl</code> \uc0ac\uc6a9)\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad00\ub9ac\ud615 \ub178\ub4dc\ub97c \uc0dd\uc131, \ud655\uc7a5 \ubc0f \uc5c5\uadf8\ub808\uc774\ub4dc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc\ub294 \uacc4\uc815\uc5d0\uc11c EKS\uc5d0 \ucd5c\uc801\ud654\ub41c Amazon Linux 2 EC2 \uc778\uc2a4\ud134\uc2a4\ub97c \uc2e4\ud589\ud558\uba70, SSH \uc561\uc138\uc2a4\ub97c \ud65c\uc131\ud654\ud558\uc5ec \uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uba74 \uc5ec\ub7ec \uac00\uc6a9 \uc601\uc5ed\uc5d0 \uac78\uccd0 \uc788\uc744 \uc218 \uc788\ub294 EKS \uad00\ub9ac\ud615 Auto Scaling \uadf8\ub8f9\uc758 \uc77c\ubd80\ub85c \uc2e4\ud589\ub418\ubbc0\ub85c \uad00\ub9ac\ud615 \ub178\ub4dc\ub97c \uc0dd\uc131\ud560 \ub54c \uc81c\uacf5\ud558\ub294 \uc11c\ube0c\ub137\uc744 \ud1b5\ud574 \uc774\ub97c \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c EKS\ub294 \uad00\ub9ac\ud615 \ub178\ub4dc\uc5d0 \uc790\ub3d9\uc73c\ub85c \ud0dc\uadf8\ub97c \uc9c0\uc815\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub7ec\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p> <p>Amazon EKS\ub294 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc758 CVE \ubc0f \ubcf4\uc548 \ud328\uce58\uc5d0 \ub300\ud55c \uacf5\ub3d9 \ucc45\uc784 \ubaa8\ub378\uc744 \ub530\ub985\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc\ub294 Amazon EKS\uc5d0 \ucd5c\uc801\ud654\ub41c AMI\ub4e4\uc744 \uc2e4\ud589\ud558\ubbc0\ub85c Amazon EKS\ub294 \ubc84\uadf8 \uc218\uc815 \uc2dc \uc774\ub7ec\ud55c AMI\ub4e4\uc758 \ud328\uce58 \ubc84\uc804\uc744 \ub9cc\ub4e4 \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc774\ub7ec\ud55c \ud328\uce58\uac00 \uc801\uc6a9\ub41c AMI \ubc84\uc804\uc744 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc5d0 \ubc30\ud3ec\ud558\ub294 \uac83\uc740 \uc0ac\uc6a9\uc790\uc758 \ucc45\uc784\uc785\ub2c8\ub2e4.</p> <p>EKS\ub294 \uc5c5\ub370\uc774\ud2b8 \ud504\ub85c\uc138\uc2a4\ub97c \uc2dc\uc791\ud574\uc57c \ud558\uc9c0\ub9cc \ub178\ub4dc \uc5c5\ub370\uc774\ud2b8\ub3c4 \uad00\ub9ac\ud569\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc \uc5c5\ub370\uc774\ud2b8 \ud504\ub85c\uc138\uc2a4\ub294 EKS \uc124\uba85\uc11c\uc5d0 \uc124\uba85\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 Amazon EKS\uc5d0 \ucd5c\uc801\ud654\ub41c Linux AMI\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc791\uc5c5\uc790 \ub178\ub4dc\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. AMI\uc640 \ub178\ub4dc\uc758 \ud328\uce58 \ubc0f \uc5c5\uadf8\ub808\uc774\ub4dc\ub294 \uc0ac\uc6a9\uc790\uac00 \ub2f4\ub2f9\ud569\ub2c8\ub2e4. <code>eksctl</code>, CloudFormation \ub610\ub294 \ucf54\ub4dc\ud615 \uc778\ud504\ub77c \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc27d\uac8c \ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c\ub294 \uc774\uc804 \ub178\ub4dc \uadf8\ub8f9\uc744 <code>NoSchedule</code>\ub85c taints\ud558\uace0 \uc0c8 \uc2a4\ud0dd\uc774 \uae30\uc874 \ud3ec\ub4dc \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc218\uc6a9\ud560 \uc900\ube44\uac00 \ub418\uba74 \ub178\ub4dc\ub97c drains\ud558\uae30 \ub54c\ubb38\uc5d0 \uc791\uc5c5\uc790 \ub178\ub4dc\ub97c \uc5c5\ub370\uc774\ud2b8\ud560 \ub54c \uc0c8 \ub178\ub4dc\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. \ud558\uc9c0\ub9cc \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc\uc758 in-place \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc218\ud589\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p></p> <p>\uc774 \uac00\uc774\ub4dc\uc5d0\ub294 EKS \ub370\uc774\ud130 \ud50c\ub808\uc778, Kubernetes \ud575\uc2ec \uad6c\uc131 \uc694\uc18c \ubc0f \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc2e0\ub8b0\uc131\uc744 \uac1c\uc120\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc77c\ub828\uc758 \uad8c\uc7a5 \uc0ac\ud56d\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/#_3","title":"\ud53c\ub4dc\ubc31","text":"<p>\uc774 \uac00\uc774\ub4dc\ub294 \uad11\ubc94\uc704\ud55c EKS/Kubernetes \ucee4\ubba4\ub2c8\ud2f0\ub85c\ubd80\ud130 \uc9c1\uc811\uc801\uc778 \ud53c\ub4dc\ubc31\uacfc \uc81c\uc548\uc744 \uc218\uc9d1\ud558\uae30 \uc704\ud574 GitHub\uc5d0 \uac8c\uc2dc \ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uac00\uc774\ub4dc\uc5d0 \ud3ec\ud568\uc2dc\ucf1c\uc57c \ud55c\ub2e4\uace0 \uc0dd\uac01\ub418\ub294 \ubaa8\ubc94 \uc0ac\ub840\uac00 \uc788\ub2e4\uba74 GitHub \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ubb38\uc81c\ub97c \uc81c\ucd9c\ud558\uac70\ub098 PR\uc744 \uc81c\ucd9c\ud574 \uc8fc\uc138\uc694. \uc11c\ube44\uc2a4\uc5d0 \uc0c8\ub85c\uc6b4 \uae30\ub2a5\uc774 \ucd94\uac00\ub418\uac70\ub098 \uc0c8\ub85c\uc6b4 \ubaa8\ubc94 \uc0ac\ub840\uac00 \uac1c\ubc1c\ub418\uba74 \uac00\uc774\ub4dc\ub97c \uc815\uae30\uc801\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud560 \uacc4\ud68d\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/","title":"\uace0\uac00\uc6a9\uc131 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc2e4\ud589","text":"<p>\uace0\uac1d\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ubcc0\uacbd\ud560 \ub54c\ub098 \ud2b8\ub798\ud53d\uc774 \uae09\uc99d\ud560 \ub54c \uc870\ucc28 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ud56d\uc0c1 \uc0ac\uc6a9 \uac00\ub2a5\ud558\uae30\ub97c \uae30\ub300\ud569\ub2c8\ub2e4. \ud655\uc7a5 \uac00\ub2a5\ud558\uace0 \ubcf5\uc6d0\ub825\uc774 \ub6f0\uc5b4\ub09c \uc544\ud0a4\ud14d\ucc98\ub97c \ud1b5\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \uc11c\ube44\uc2a4\ub97c \uc911\ub2e8 \uc5c6\uc774 \uc2e4\ud589\ud558\uc5ec \uc0ac\uc6a9\uc790 \ub9cc\uc871\ub3c4\ub97c \uc720\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud655\uc7a5 \uac00\ub2a5\ud55c \uc778\ud504\ub77c\ub294 \ube44\uc988\ub2c8\uc2a4 \uc694\uad6c \uc0ac\ud56d\uc5d0 \ub530\ub77c \ud655\uc7a5 \ubc0f \ucd95\uc18c\ub429\ub2c8\ub2e4. \ub2e8\uc77c \uc7a5\uc560 \uc9c0\uc810\uc744 \uc81c\uac70\ud558\ub294 \uac83\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uac00\uc6a9\uc131\uc744 \uac1c\uc120\ud558\uace0 \ubcf5\uc6d0\ub825\uc744 \ub192\uc774\uae30 \uc704\ud55c \uc911\uc694\ud55c \ub2e8\uacc4\uc785\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc0ac\uc6a9\ud558\uba74 \uac00\uc6a9\uc131\uacfc \ubcf5\uc6d0\ub825\uc774 \ub6f0\uc5b4\ub09c \ubc29\uc2dd\uc73c\ub85c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc6b4\uc601\ud558\uace0 \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc120\uc5b8\uc801 \uad00\ub9ac\ub97c \ud1b5\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc124\uc815\ud55c \ud6c4\uc5d0\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc9c0\uc18d\uc801\uc73c\ub85c \ud604\uc7ac \uc0c1\ud0dc\ub97c \uc6d0\ud558\ub294 \uc0c1\ud0dc\uc640 \uc77c\uce58\ud558\ub3c4\ub85d \uc2dc\ub3c4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#_2","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/reliability/docs/application/#_3","title":"\uc2f1\uae00\ud1a4 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\uc9c0 \ub9c8\uc138\uc694","text":"<p>\uc804\uccb4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ub2e8\uc77c \ud30c\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uacbd\uc6b0, \ud574\ub2f9 \ud30c\ub4dc\uac00 \uc885\ub8cc\ub418\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uac8c \ub429\ub2c8\ub2e4. \uac1c\ubcc4 \ud3ec\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ubc30\ud3ec\ud558\ub294 \ub300\uc2e0 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624. \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub85c \uc0dd\uc131\ub41c \ud30c\ub4dc\uac00 \uc2e4\ud328\ud558\uac70\ub098 \uc885\ub8cc\ub418\ub294 \uacbd\uc6b0, \ub514\ud50c\ub85c\uc774\uba3c\ud2b8 \ucee8\ud2b8\ub864\ub7ec\ub294 \uc0c8 \ud30c\ub4dc\ub97c \uc2dc\uc791\ud558\uc5ec \uc9c0\uc815\ub41c \uac1c\uc218\uc758 \ub808\ud50c\ub9ac\uce74 \ud30c\ub4dc\uac00 \ud56d\uc0c1 \uc2e4\ud589\ub418\ub3c4\ub85d \ud569\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_4","title":"\uc5ec\ub7ec \uac1c\uc758 \ub808\ud50c\ub9ac\uce74 \uc2e4\ud589","text":"<p>\ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc571\uc758 \uc5ec\ub7ec \ubcf5\uc81c\ubcf8 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\uba74 \uac00\uc6a9\uc131\uc774 \ub192\uc740 \ubc29\uc2dd\uc73c\ub85c \uc571\uc744 \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\ub098\uc758 \ubcf5\uc81c\ubcf8\uc5d0 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\ub354\ub77c\ub3c4 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc190\uc2e4\uc744 \ub9cc\ud68c\ud558\uae30 \uc704\ud574 \ub2e4\ub978 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\uae30 \uc804\uae4c\uc9c0\ub294 \uc6a9\ub7c9\uc774 \uc904\uc5b4\ub4e4\uae30\ub294 \ud558\uc9c0\ub9cc \ub098\uba38\uc9c0 \ubcf5\uc81c\ubcf8\uc740 \uc5ec\uc804\ud788 \uc791\ub3d9\ud55c\ub2e4. \ub610\ud55c Horizontal Pod Autoscaler\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6cc\ud06c\ub85c\ub4dc \uc218\uc694\uc5d0 \ub530\ub77c \ubcf5\uc81c\ubcf8\uc744 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_5","title":"\uc5ec\ub7ec \ub178\ub4dc\uc5d0 \ubcf5\uc81c\ubcf8\uc744 \uc2a4\ucf00\uc904\ub9c1\ud569\ub2c8\ub2e4.","text":"<p>\ubaa8\ub4e0 \ubcf5\uc81c\ubcf8\uc774 \ub3d9\uc77c\ud55c \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\uace0 \uc788\uace0 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uac8c \ub418\uba74 \uc5ec\ub7ec \ubcf5\uc81c\ubcf8\uc744 \uc2e4\ud589\ud558\ub294 \uac83\uc740 \uadf8\ub2e4\uc9c0 \uc720\uc6a9\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc anti-affinity \ub610\ub294 \ud30c\ub4dc topology spread contraints\uc744 \uc0ac\uc6a9\ud574 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ubcf5\uc81c\ubcf8\uc744 \uc5ec\ub7ec \uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ubd84\uc0b0\uc2dc\ud0a4\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. </p> <p>\uc5ec\ub7ec AZ\uc5d0\uc11c \uc2e4\ud589\ud558\uc5ec \uc77c\ubc18\uc801\uc778 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc2e0\ub8b0\uc131\uc744 \ub354\uc6b1 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#anti-affinity","title":"\ud30c\ub4dc anti-affinity \uaddc\uce59 \uc0ac\uc6a9","text":"<p>\uc544\ub798 \ub9e4\ub2c8\ud398\uc2a4\ud2b8\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uc5d0\uac8c \ud30c\ub4dc\ub97c \ubcc4\ub3c4\uc758 \ub178\ub4dc\uc640 AZ\uc5d0 \ubc30\uce58\ud558\ub3c4\ub85d prefer\ub77c\uace0 \uc9c0\uc2dc\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ub418\uc5b4\uc788\ub2e4\uba74 \ubcc4\ub3c4\uc758 \ub178\ub4dc\ub098 AZ\uac00 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uadf8\ub807\uac8c \ud558\uba74 \uac01 AZ\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ud3ec\ub4dc\uac00 \uc788\uc73c\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc5b4\ub5a4 \ud30c\ub4dc\ub3c4 \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc5c6\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ub2e8 \uc138 \uac1c\uc758 \ubcf5\uc81c\ubcf8\uc774 \ud544\uc694\ud55c \uacbd\uc6b0, <code>topologyKey: topology.kubernetes.io/zone</code>\uc5d0 \ub300\ud574 <code>requiredDuringSchedulingIgnoredDuringExecution</code>\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc73c\uba70, \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\ub294 \ub3d9\uc77c\ud55c AZ\uc5d0 \ub450 \uac1c\uc758 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spread-host-az\n  labels:\n    app: web-server\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      affinity:\n        podAntiAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: topology.kubernetes.io/zone\n            weight: 100\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: kubernetes.io/hostname \n            weight: 99\n      containers:\n      - name: web-app\n        image: nginx:1.16-alpine\n</code></pre>"},{"location":"ko/reliability/docs/application/#topology-spread-constraints","title":"\ud3ec\ub4dc topology spread constraints \uc0ac\uc6a9","text":"<p>\ud3ec\ub4dc anti-affinity \uaddc\uce59\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c, \ud3ec\ub4dc topology spread constraints\uc744 \uc0ac\uc6a9\ud558\uba74 \ud638\uc2a4\ud2b8 \ub610\ub294 AZ\uc640 \uac19\uc740 \ub2e4\uc591\ud55c \uc7a5\uc560 (\ub610\ub294 \ud1a0\ud3f4\ub85c\uc9c0) \ub3c4\uba54\uc778\uc5d0\uc11c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc811\uadfc \ubc29\uc2dd\uc740 \uc11c\ub85c \ub2e4\ub978 \ud1a0\ud3f4\ub85c\uc9c0 \ub3c4\uba54\uc778 \uac01\uac01\uc5d0 \uc5ec\ub7ec \ubcf5\uc81c\ubcf8\uc744 \ubcf4\uc720\ud558\uc5ec \ub0b4\uacb0\ud568\uc131\uacfc \uac00\uc6a9\uc131\uc744 \ubcf4\uc7a5\ud558\ub824\ub294 \uacbd\uc6b0\uc5d0 \ub9e4\uc6b0 \ud6a8\uacfc\uc801\uc785\ub2c8\ub2e4. \ubc18\uba74, \ud30c\ub4dc anti-affinity \uaddc\uce59\uc740 anti-affinity\uac00 \uc788\ub294 \ud30c\ub4dc \uc11c\ub85c\uc5d0 \ub300\ud574 \uac70\ubd80 \ud6a8\uacfc\uac00 \uc788\uae30 \ub54c\ubb38\uc5d0 \ud1a0\ud3f4\ub85c\uc9c0 \ub3c4\uba54\uc778\uc5d0 \ub2e8\uc77c \ubcf5\uc81c\ubcf8\uc774 \uc788\ub3c4\ub85d \uc27d\uac8c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uacbd\uc6b0 \uc804\uc6a9 \ub178\ub4dc\uc758 \ub2e8\uc77c \ubcf5\uc81c\ubcf8\uc740 \ub0b4\uacb0\ud568\uc131 \uce21\uba74\uc5d0\uc11c \uc774\uc0c1\uc801\uc774\uc9c0\ub3c4 \uc54a\uace0 \ub9ac\uc18c\uc2a4\ub97c \uc801\uc808\ud558\uac8c \uc0ac\uc6a9\ud558\uc9c0\ub3c4 \uc54a\uc2b5\ub2c8\ub2e4. topology spread constraints\uc744 \uc0ac\uc6a9\ud558\uba74 \uc2a4\ucf00\uc904\ub7ec\uac00 \ud1a0\ud3f4\ub85c\uc9c0 \ub3c4\uba54\uc778 \uc804\uccb4\uc5d0 \uc801\uc6a9\ud558\ub824\uace0 \uc2dc\ub3c4\ud558\ub294 \ubd84\ubc30 \ub610\ub294 \ubc30\ud3ec\ub97c \ubcf4\ub2e4 \ud6a8\uacfc\uc801\uc73c\ub85c \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc811\uadfc \ubc29\uc2dd\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \uc911\uc694\ud55c \uc18d\uc131\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. 1. <code>MaxSkew</code>\ub294 \ud1a0\ud3f4\ub85c\uc9c0 \ub3c4\uba54\uc778 \uc804\uccb4\uc5d0\uc11c \uade0\ub4f1\ud558\uc9c0 \uc54a\uac8c \ubd84\uc0b0\ub420 \uc218 \uc788\ub294 \ucd5c\ub300 \uc815\ub3c4\ub97c \uc81c\uc5b4\ud558\uac70\ub098 \uacb0\uc815\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 10\uac1c\uc758 \ubcf5\uc81c\ubcf8\uc774 \uc788\uace0 3\uac1c\uc758 AZ\uc5d0 \ubc30\ud3ec\ub41c \uacbd\uc6b0 \uade0\ub4f1\ud558\uac8c \ubd84\uc0b0\ub420 \uc218\ub294 \uc5c6\uc9c0\ub9cc \ubd84\ud3ec\uc758 \ubd88\uade0\uc77c\uc131\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 <code>MaxSkew</code>\ub294 1\uc5d0\uc11c 10 \uc0ac\uc774\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uac12\uc774 1\uc774\uba74 3\uac1c\uc758 AZ\uc5d0 \uac78\uccd0 <code>4,3,3</code>, <code>3,4,3</code> \ub610\ub294 <code>3,3,4</code>\uc640 \uac19\uc740 \ubd84\ubc30\uac00 \uc0dd\uc131\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubc18\ub300\ub85c \uac12\uc774 10\uc774\uba74 3\uac1c\uc758 AZ\uc5d0 \uac78\uccd0 <code>10,0,0</code>, <code>0,10,0</code> \ub610\ub294 <code>0,0,10</code>\uacfc \uac19\uc740 \ubd84\ubc30\uac00 \ub098\uc62c \uc218 \uc788\ub2e4\ub294 \uc758\ubbf8\uc785\ub2c8\ub2e4. 2. <code>TopologyKey</code>\ub294 \ub178\ub4dc \ub808\uc774\ube14 \uc911 \ud558\ub098\uc758 \ud0a4\uc774\uba70 \ud3ec\ub4dc \ubc30\ud3ec\uc5d0 \uc0ac\uc6a9\ud574\uc57c \ud558\ub294 \ud1a0\ud3f4\ub85c\uc9c0 \ub3c4\uba54\uc778 \uc720\ud615\uc744 \uc815\uc758\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc874(zone)\ubcc4 \ubd84\ubc30\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \ud0a4-\uac12 \uc30d\uc744 \uac00\uc9d1\ub2c8\ub2e4. <pre><code>topologyKey: \"topology.kubernetes.io/zone\"\n</code></pre> 3. <code>WhenUnsatisfiable</code> \uc18d\uc131\uc740 \uc6d0\ud558\ub294 \uc81c\uc57d \uc870\uac74\uc744 \ucda9\uc871\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0 \uc2a4\ucf00\uc904\ub7ec\uac00 \uc5b4\ub5bb\uac8c \uc751\ub2f5\ud560\uc9c0 \uacb0\uc815\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. 4. <code>LabelSelector</code>\ub294 \uc77c\uce58\ud558\ub294 \ud30c\ub4dc\ub97c \ucc3e\ub294 \ub370 \uc0ac\uc6a9\ub418\uba70, \uc774\ub97c \ud1b5\ud574 \uc2a4\ucf00\uc904\ub7ec\ub294 \uc9c0\uc815\ud55c \uc81c\uc57d \uc870\uac74\uc5d0 \ub530\ub77c \ud30c\ub4dc\ub97c \ubc30\uce58\ud560 \uc704\uce58\ub97c \uacb0\uc815\ud560 \ub54c \uc774\ub97c \uc778\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc704\uc758 \ud544\ub4dc \uc678\uc5d0\ub3c4, \ub2e4\ub978 \ud544\ub4dc\uc5d0 \ub300\ud574\uc11c\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc124\uba85\uc11c\uc5d0\uc11c \ub354 \uc790\uc138\ud788 \uc54c\uc544\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spread-host-az\n  labels:\n    app: web-server\nspec:\n  replicas: 10\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      topologySpreadConstraints:\n      - maxSkew: 1\n        topologyKey: \"topology.kubernetes.io/zone\"\n        whenUnsatisfiable: ScheduleAnyway\n        labelSelector:\n          matchLabels:\n            app: express-test\n      containers:\n      - name: web-app\n        image: nginx:1.16-alpine\n</code></pre>"},{"location":"ko/reliability/docs/application/#_6","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uba54\ud2b8\ub9ad \uc11c\ubc84 \uc2e4\ud589","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uba54\ud2b8\ub9ad \uc11c\ubc84 \ub97c \uc124\uce58\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud655\uc7a5\uc5d0 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4. HPA \ubc0f VPA\uc640 \uac19\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub7ec \uc560\ub4dc\uc628\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uba54\ud2b8\ub9ad\uc744 \ucd94\uc801\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud655\uc7a5\ud569\ub2c8\ub2e4. \uba54\ud2b8\ub9ad \uc11c\ubc84\ub294 \uaddc\ubaa8 \uc870\uc815 \uacb0\uc815\uc744 \ub0b4\ub9ac\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ub9ac\uc18c\uc2a4 \uba54\ud2b8\ub9ad\uc744 \uc218\uc9d1\ud569\ub2c8\ub2e4. \uba54\ud2b8\ub9ad\uc740 kubelets\uc5d0\uc11c \uc218\uc9d1\ub418\uc5b4 \uba54\ud2b8\ub9ad API \ud615\uc2dd\uc73c\ub85c \uc81c\uacf5\ub429\ub2c8\ub2e4.</p> <p>\uba54\ud2b8\ub9ad \uc11c\ubc84\ub294 \ub370\uc774\ud130\ub97c \ubcf4\uad00\ud558\uc9c0 \uc54a\uc73c\uba70 \ubaa8\ub2c8\ud130\ub9c1 \uc194\ub8e8\uc158\ub3c4 \uc544\ub2d9\ub2c8\ub2e4. \uadf8 \ubaa9\uc801\uc740 CPU \ubc0f \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9 \uba54\ud2b8\ub9ad\uc744 \ub2e4\ub978 \uc2dc\uc2a4\ud15c\uc5d0 \uacf5\uac1c\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc2dc\uac04 \uacbd\uacfc\uc5d0 \ub530\ub978 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc0c1\ud0dc\ub97c \ucd94\uc801\ud558\ub824\uba74 Prometheus \ub610\ub294 Amazon CloudWatch\uc640 \uac19\uc740 \ubaa8\ub2c8\ud130\ub9c1 \ub3c4\uad6c\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. </p> <p>EKS \uc124\uba85\uc11c\uc5d0 \ub530\ub77c EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \uba54\ud2b8\ub9ad \uc11c\ubc84\ub97c \uc124\uce58\ud558\uc2ed\uc2dc\uc624. </p>"},{"location":"ko/reliability/docs/application/#horizontal-pod-autoscaler-hpa","title":"Horizontal Pod Autoscaler (HPA)","text":"<p>HPA\ub294 \uc218\uc694\uc5d0 \ub530\ub77c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ud558\uace0 \ud2b8\ub798\ud53d\uc774 \ucd5c\uace0\uc870\uc5d0 \ub2ec\ud560 \ub54c \uace0\uac1d\uc5d0\uac8c \uc601\ud5a5\uc744 \ubbf8\uce58\uc9c0 \uc54a\ub3c4\ub85d \ub3c4\uc640\uc90d\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\ub294 \uc81c\uc5b4 \ub8e8\ud504\ub85c \uad6c\ud604\ub418\uc5b4 \uc788\uc5b4 \ub9ac\uc18c\uc2a4 \uba54\ud2b8\ub9ad\uc744 \uc81c\uacf5\ud558\ub294 API\uc5d0\uc11c \uba54\ud2b8\ub9ad\uc744 \uc815\uae30\uc801\uc73c\ub85c \ucffc\ub9ac\ud569\ub2c8\ub2e4.</p> <p>HPA\ub294 \ub2e4\uc74c API\uc5d0\uc11c \uba54\ud2b8\ub9ad\uc744 \uac80\uc0c9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. 1. \ub9ac\uc18c\uc2a4 \uba54\ud2b8\ub9ad API\ub77c\uace0\ub3c4 \ud558\ub294 <code>metrics.k8s.io</code> \u2014 \ud30c\ub4dc\uc758 CPU \ubc0f \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. 2. <code>custom.metrics.k8s.io</code> \u2014 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\uc640 \uac19\uc740 \ub2e4\ub978 \uba54\ud2b8\ub9ad \ucf5c\ub809\ud130\uc758 \uba54\ud2b8\ub9ad\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uba54\ud2b8\ub9ad\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0 internal \uc785\ub2c8\ub2e4.  3. <code>external.metrics.k8s.io</code> \u2014 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0 __external__\uc778 \uba54\ud2b8\ub9ad\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4 (\uc608: SQS \ub300\uae30\uc5f4 \uae38\uc774, ELB \uc9c0\uc5f0 \uc2dc\uac04).</p> <p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud655\uc7a5\ud558\uae30 \uc704\ud55c \uba54\ud2b8\ub9ad\uc744 \uc81c\uacf5\ud558\ub824\uba74 \uc774 \uc138 \uac00\uc9c0 API \uc911 \ud558\ub098\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_7","title":"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub610\ub294 \uc678\ubd80 \uc9c0\ud45c\ub97c \uae30\ubc18\uc73c\ub85c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uaddc\ubaa8 \uc870\uc815","text":"<p>\uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub610\ub294 \uc678\ubd80 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uc5ec CPU \ub610\ub294 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub960 \uc774\uc678\uc758 \uc9c0\ud45c\uc5d0 \ub530\ub77c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ucee4\uc2a4\ud140 \uba54\ud2b8\ub9ad API \uc11c\ubc84\ub294 HPA\uac00 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc790\ub3d9 \uc2a4\ucf00\uc77c\ub9c1\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 <code>custom-metrics.k8s.io</code> API\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. </p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uba54\ud2b8\ub9ad API\uc6a9 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \uc5b4\ub311\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\uc5d0\uc11c \uba54\ud2b8\ub9ad\uc744 \uc218\uc9d1\ud558\uace0 HPA\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \uc5b4\ub311\ud130\ub294 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \uba54\ud2b8\ub9ad\uc744 \uba54\ud2b8\ub9ad API \ud615\uc2dd\uc73c\ub85c \ub178\ucd9c\ud569\ub2c8\ub2e4. \ubaa8\ub4e0 \ucee4\uc2a4\ud140 \uba54\ud2b8\ub9ad \uad6c\ud604 \ubaa9\ub85d\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc124\uba85\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \uc5b4\ub311\ud130\ub97c \ubc30\ud3ec\ud55c \ud6c4\uc5d0\ub294 kubectl\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc0ac\uc6a9\uc790 \uc9c0\uc815 \uba54\ud2b8\ub9ad\uc744 \ucffc\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>kubectl get \u2014raw /apis/custom.metrics.k8s.io/v1beta1/</code></p> <p>\uc678\ubd80 \uba54\ud2b8\ub9ad\uc740 \uc774\ub984\uc5d0\uc11c \uc54c \uc218 \uc788\ub4ef\uc774 Horizontal Pod Autoscaler\uc5d0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \uc678\ubd80\uc758 \uba54\ud2b8\ub9ad\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubc30\ud3ec\ub97c \ud655\uc7a5\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ubc30\uce58 \ucc98\ub9ac \uc6cc\ud06c\ub85c\ub4dc\uc5d0\uc11c\ub294 SQS \ub300\uae30\uc5f4\uc5d0\uc11c \uc9c4\ud589 \uc911\uc778 \uc791\uc5c5 \uc218\uc5d0 \ub530\ub77c \ubcf5\uc81c\ubcf8 \uc218\ub97c \uc870\uc815\ud558\ub294 \uac83\uc774 \uc77c\ubc18\uc801\uc785\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4 SQS \ub300\uae30\uc5f4 \uae4a\uc774\uc5d0 \ub530\ub77c \ubc30\uce58-\ud504\ub85c\uc138\uc11c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud06c\uae30 \uc870\uc815\uacfc \uac19\uc774 CloudWatch \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc790\ub3d9 \ud655\uc7a5\ud558\ub824\uba74 <code>k8s-cloudwatch-adapter</code>\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>k8s-\ud074\ub77c\uc6b0\ub4dc\uc6cc\uce58 \uc5b4\ub311\ud130</code>\ub294 \ucee4\ubba4\ub2c8\ud2f0 \ud504\ub85c\uc81d\ud2b8\uc774\uba70 AWS\uc5d0\uc11c \uc720\uc9c0 \uad00\ub9ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#vertical-pod-autoscaler-vpa","title":"Vertical Pod Autoscaler (VPA)","text":"<p>VPA\ub294 \ud30c\ub4dc\uc758 CPU \ubc0f \uba54\ubaa8\ub9ac \uc608\uc57d\uc744 \uc790\ub3d9\uc73c\ub85c \uc870\uc815\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \u201c\uc801\uc808\ud55c \ud06c\uae30\u201d\ub85c \uc870\uc815\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. \ub9ac\uc18c\uc2a4 \ud560\ub2f9\uc744 \ub298\ub824 \uc218\uc9c1\uc73c\ub85c \ud655\uc7a5\ud574\uc57c \ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uacbd\uc6b0 VPA\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud3ec\ub4dc \ubcf5\uc81c\ubcf8\uc744 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ud558\uac70\ub098 \uaddc\ubaa8 \uc870\uc815 \uad8c\uc7a5 \uc0ac\ud56d\uc744 \uc81c\uacf5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>VPA\uc758 \ud604\uc7ac \uad6c\ud604\uc740 \ud30c\ub4dc\uc5d0 \ub300\ud55c \uc778\ud50c\ub808\uc774\uc2a4 \uc870\uc815\uc744 \uc218\ud589\ud558\uc9c0 \uc54a\uace0 \ub300\uc2e0 \uc2a4\ucf00\uc77c\ub9c1\uc774 \ud544\uc694\ud55c \ud30c\ub4dc\ub97c \ub2e4\uc2dc \uc0dd\uc131\ud558\uae30 \ub54c\ubb38\uc5d0 VPA\uac00 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud655\uc7a5\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc77c\uc2dc\uc801\uc73c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uac8c \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>EKS \uc124\uba85\uc11c\uc5d0\ub294 VPA \uc124\uc815 \ubc29\ubc95\uc774 \uc218\ub85d\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>Fairwinds Goldilocks \ud504\ub85c\uc81d\ud2b8\ub294 CPU \ubc0f \uba54\ubaa8\ub9ac \uc694\uccad \ubc0f \uc81c\ud55c\uc5d0 \ub300\ud55c VPA \uad8c\uc7a5 \uc0ac\ud56d\uc744 \uc2dc\uac01\ud654\ud560 \uc218 \uc788\ub294 \ub300\uc2dc\ubcf4\ub4dc\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. VPA \uc5c5\ub370\uc774\ud2b8 \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\uba74 VPA \uad8c\uc7a5 \uc0ac\ud56d\uc5d0 \ub530\ub77c \ud30c\ub4dc\ub97c \uc790\ub3d9 \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_8","title":"\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc5c5\ub370\uc774\ud2b8","text":"<p>\ucd5c\uc2e0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\ub294 \ub192\uc740 \uc218\uc900\uc758 \uc548\uc815\uc131\uacfc \uac00\uc6a9\uc131\uc744 \uac16\ucd98 \ube60\ub978 \ud601\uc2e0\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uace0\uac1d\uc5d0\uac8c \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uc73c\uba74\uc11c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc9c0\uc18d\uc801\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud560 \uc218 \uc788\ub294 \ub3c4\uad6c\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. </p> <p>\uac00\uc6a9\uc131 \uc800\ud558 \uc5c6\uc774 \ubcc0\uacbd \uc0ac\ud56d\uc744 \uc2e0\uc18d\ud558\uac8c \ubc30\ud3ec\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#_9","title":"\ub864\ubc31\uc744 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uba54\ucee4\ub2c8\uc998 \ub9c8\ub828","text":"<p>\uc2e4\ud589 \ucde8\uc18c \ubc84\ud2bc\uc774 \uc788\uc73c\uba74 \uc7ac\ud574\ub97c \ud53c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud504\ub85c\ub355\uc158 \ud074\ub7ec\uc2a4\ud130\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uae30 \uc804\uc5d0 \ubcc4\ub3c4\uc758 \ud558\uc704 \ud658\uacbd(\ud14c\uc2a4\ud2b8 \ub610\ub294 \uac1c\ubc1c \ud658\uacbd)\uc5d0\uc11c \ubc30\ud3ec\ub97c \ud14c\uc2a4\ud2b8\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4. CI/CD \ud30c\uc774\ud504\ub77c\uc778\uc744 \uc0ac\uc6a9\ud558\uba74 \ubc30\ud3ec\ub97c \uc790\ub3d9\ud654\ud558\uace0 \ud14c\uc2a4\ud2b8\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc9c0\uc18d\uc801 \ubc30\ud3ec \ud30c\uc774\ud504\ub77c\uc778\uc744 \uc0ac\uc6a9\ud558\uba74 \uc5c5\uadf8\ub808\uc774\ub4dc\uc5d0 \uacb0\ud568\uc774 \ubc1c\uc0dd\ud560 \uacbd\uc6b0 \uc774\uc804 \ubc84\uc804\uc73c\ub85c \ube60\ub974\uac8c \ub418\ub3cc\ub9b4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2e4\ud589 \uc911\uc778 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc5c5\ub370\uc774\ud2b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uc5ec \uc218\ud589\ub429\ub2c8\ub2e4. <code>kubectl</code>\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub2e4\uc74c\uacfc \uac19\uc774 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc5c5\ub370\uc774\ud2b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl --record deployment.apps/nginx-deployment set image nginx-deployment nginx=nginx:1.16.1\n</code></pre> <p><code>--record</code> \uc778\uc218\ub294 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc744 \uae30\ub85d\ud558\uace0 \ub864\ubc31\uc744 \uc218\ud589\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4. <code>kubectl rollout history deployment</code>\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc5d0 \ub300\ud574 \uae30\ub85d\ub41c \ubcc0\uacbd \uc0ac\ud56d\uc744 \ubcf4\uc5ec\uc900\ub2e4. <code>kubectl rollout undo deployment &lt;DEPLOYMENT_NAME&gt;</code>\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubcc0\uacbd\uc0ac\ud56d\uc744 \ub864\ubc31\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uae30\ubcf8\uc801\uc73c\ub85c, \ud30c\ub4dc\ub97c \uc7ac\uc0dd\uc131\ud574\uc57c \ud558\ub294 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uba74 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub294 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. \uc989, \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ud30c\ub4dc\uc758 \uc77c\ubd80\ub9cc \uc5c5\ub370\uc774\ud2b8\ud558\uace0 \ubaa8\ub4e0 \ud30c\ub4dc\ub294 \ud55c \ubc88\uc5d0 \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. <code>RollingUpdateStrategy</code> \ud504\ub85c\ud37c\ud2f0\ub97c \ud1b5\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\ub97c \uc218\ud589\ud558\ub294 \ubc29\uc2dd\uc744 \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\ub97c \uc218\ud589\ud560 \ub54c, <code>Max Unavailable</code> \ud504\ub85c\ud37c\ud2f0\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc5c5\ub370\uc774\ud2b8 \uc911\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \ud30c\ub4dc\uc758 \ucd5c\ub300 \uac1c\uc218\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 <code>Max Surge</code> \ud504\ub85c\ud37c\ud2f0\ub97c \uc0ac\uc6a9\ud558\uba74 \uc6d0\ud558\ub294 \ud30c\ub4dc \uc218\ubcf4\ub2e4 \ub354 \uc0dd\uc131\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \ud30c\ub4dc \uc218\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub864\uc544\uc6c3\uc73c\ub85c \uc778\ud574 \uace0\uac1d\uc774 \ud63c\ub780\uc5d0 \ube60\uc9c0\uc9c0 \uc54a\ub3c4\ub85d <code>max unavailable</code>\uc744 \uc870\uc815\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. \uc608\ub97c \ub4e4\uc5b4 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uae30\ubcf8\uc801\uc73c\ub85c 25%\uc758 <code>max unavailable</code>\uc744 \uc124\uc815\ud569\ub2c8\ub2e4. \uc989, 100\uac1c\uc758 \ud30c\ub4dc\uac00 \uc788\ub294 \uacbd\uc6b0 \ub864\uc544\uc6c3 \uc911\uc5d0 \ud65c\uc131 \uc0c1\ud0dc\ub85c \uc791\ub3d9\ud558\ub294 \ud30c\ub4dc\ub294 75\uac1c\ub9cc \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ucd5c\uc18c 80\uac1c\uc758 \ud30c\ub4dc\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \uc774 \ub864\uc544\uc6c3\uc73c\ub85c \uc778\ud574 \uc911\ub2e8\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub300\uc2e0, <code>max unavailable</code>\uc744 20% \ub85c \uc124\uc815\ud558\uc5ec \ub864\uc544\uc6c3 \ub0b4\ub0b4 \uc791\ub3d9\ud558\ub294 \ud30c\ub4dc\uac00 80\uac1c \uc774\uc0c1 \uc788\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_10","title":"\ube14\ub8e8/\uadf8\ub9b0 \ubc30\ud3ec \uc0ac\uc6a9","text":"<p>\ubcc0\uacbd\uc740 \ubcf8\uc9c8\uc801\uc73c\ub85c \uc704\ud5d8\ud558\uc9c0\ub9cc, \ucde8\uc18c\ud560 \uc218 \uc5c6\ub294 \ubcc0\uacbd\uc740 \uc7a0\uc7ac\uc801\uc73c\ub85c \uce58\uba85\uc801\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub864\ubc31\uc744 \ud1b5\ud574 \uc2dc\uac04\uc744 \ud6a8\uacfc\uc801\uc73c\ub85c \ub418\ub3cc\ub9b4 \uc218 \uc788\ub294 \ubcc0\uacbd \uc808\ucc28\ub97c \uc0ac\uc6a9\ud558\uba74 \ud5a5\uc0c1\ub41c \uae30\ub2a5\uacfc \uc2e4\ud5d8\uc774 \ub354 \uc548\uc804\ud574\uc9d1\ub2c8\ub2e4. \ube14\ub8e8/\uadf8\ub9b0 \ubc30\ud3ec\ub294 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uacbd\uc6b0 \ubcc0\uacbd \uc0ac\ud56d\uc744 \uc2e0\uc18d\ud558\uac8c \ucca0\ud68c\ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774 \ubc30\ud3ec \uc804\ub7b5\uc5d0\uc11c\ub294 \uc0c8 \ubc84\uc804\uc744 \uc704\ud55c \ud658\uacbd\uc744 \ub9cc\ub4ed\ub2c8\ub2e4. \uc774 \ud658\uacbd\uc740 \uc5c5\ub370\uc774\ud2b8 \uc911\uc778 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ud604\uc7ac \ubc84\uc804\uacfc \ub3d9\uc77c\ud569\ub2c8\ub2e4. \uc0c8 \ud658\uacbd\uc774 \ud504\ub85c\ube44\uc804\ub418\uba74 \ud2b8\ub798\ud53d\uc774 \uc0c8 \ud658\uacbd\uc73c\ub85c \ub77c\uc6b0\ud305\ub429\ub2c8\ub2e4. \uc0c8 \ubc84\uc804\uc5d0\uc11c \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uace0 \uc6d0\ud558\ub294 \uacb0\uacfc\ub97c \uc5bb\uc744 \uacbd\uc6b0 \uc774\uc804 \ud658\uacbd\uc740 \uc885\ub8cc\ub429\ub2c8\ub2e4. \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 \ud2b8\ub798\ud53d\uc774 \uc774\uc804 \ubc84\uc804\uc73c\ub85c \ubcf5\uc6d0\ub429\ub2c8\ub2e4. </p> <p>\uae30\uc874 \ubc84\uc804\uc758 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc640 \ub3d9\uc77c\ud55c \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc0dd\uc131\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ube14\ub8e8/\uadf8\ub9b0 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ud30c\ub4dc\uac00 \uc624\ub958 \uc5c6\uc774 \uc2e4\ud589\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud588\uc73c\uba74, \ud2b8\ub798\ud53d\uc744 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ud30c\ub4dc\ub85c \ub77c\uc6b0\ud305\ud558\ub294 \uc11c\ube44\uc2a4\uc758 <code>selector</code> \uc2a4\ud399\uc744 \ubcc0\uacbd\ud558\uc5ec \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub85c \ud2b8\ub798\ud53d\uc744 \ubcf4\ub0b4\uae30 \uc2dc\uc791\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Flux, Jenkins, Spinnaker\uc640 \uac19\uc740 \ub9ce\uc740 \uc9c0\uc18d\uc801 \ud1b5\ud569(CI) \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 \ube14\ub8e8/\uadf8\ub9b0 \ubc30\ud3ec\ub97c \uc790\ub3d9\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ube14\ub85c\uadf8\uc5d0\ub294 Jenkins\ub97c \uc0ac\uc6a9\ud55c \ub2e8\uacc4\ubcc4 \uc124\uba85\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4: Jenkins\ub97c \uc0ac\uc6a9\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uc81c\ub85c \ub2e4\uc6b4\ud0c0\uc784 \ubc30\ud3ec</p>"},{"location":"ko/reliability/docs/application/#canary","title":"Canary \ub514\ud50c\ub85c\uc774\uba3c\ud2b8 \uc0ac\uc6a9\ud558\uae30","text":"<p>Canary \ubc30\ud3ec\ub294 \ube14\ub8e8/\uadf8\ub9b0 \ubc30\ud3ec\uc758 \ubcc0\ud615\uc73c\ub85c, \ubcc0\uacbd\uc73c\ub85c \uc778\ud55c \uc704\ud5d8\uc744 \ud06c\uac8c \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc30\ud3ec \uc804\ub7b5\uc5d0\uc11c\ub294 \uae30\uc874 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc640 \ud568\uaed8 \ub354 \uc801\uc740 \uc218\uc758 \ud30c\ub4dc\uac00 \ud3ec\ud568\ub41c \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc0dd\uc131\ud558\uace0 \uc18c\ub7c9\uc758 \ud2b8\ub798\ud53d\uc744 \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub85c \uc804\ud658\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc9c0\ud45c\uc5d0\uc11c \uc0c8 \ubc84\uc804\uc774 \uae30\uc874 \ubc84\uc804\uacfc \uac19\uac70\ub098 \ub354 \ub098\uc740 \uc131\ub2a5\uc744 \ubcf4\uc778\ub2e4\uba74, \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub85c \ud5a5\ud558\ub294 \ud2b8\ub798\ud53d\uc744 \uc810\uc9c4\uc801\uc73c\ub85c \ub298\ub9ac\uba74\uc11c \ubaa8\ub4e0 \ud2b8\ub798\ud53d\uc774 \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub85c \uc804\ud658\ub420 \ub54c\uae4c\uc9c0 \uaddc\ubaa8\ub97c \ub298\ub9bd\ub2c8\ub2e4. \ub9cc\uc57d \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 \ubaa8\ub4e0 \ud2b8\ub798\ud53d\uc744 \uc774\uc804 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub85c \ub77c\uc6b0\ud305\ud558\uace0 \uc0c8 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub85c\uc758 \ud2b8\ub798\ud53d \uc804\uc1a1\uc744 \uc911\ub2e8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 canary \ubc30\ud3ec\ub97c \uc218\ud589\ud558\ub294 \uae30\ubcf8 \ubc29\ubc95\uc744 \uc81c\uacf5\ud558\uc9c0 \uc54a\uc9c0\ub9cc, Flagger\uc640 \uac19\uc740 \ub3c4\uad6c\ub97c Istio \ub610\ub294 App Mesh\uc640 \ud568\uaed8 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#_11","title":"\uc0c1\ud0dc \uc810\uac80 \ubc0f \uc790\uac00 \ubcf5\uad6c","text":"<p>\ubc84\uadf8\uac00 \uc5c6\ub294 \uc18c\ud504\ud2b8\uc6e8\uc5b4\ub294 \uc5c6\uc9c0\ub9cc \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc0ac\uc6a9\ud558\uba74 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc624\ub958\uc758 \uc601\ud5a5\uc744 \ucd5c\uc18c\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uacfc\uac70\uc5d0\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ucda9\ub3cc\ud558\uba74 \ub204\uad70\uac00 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc218\ub3d9\uc73c\ub85c \ub2e4\uc2dc \uc2dc\uc791\ud558\uc5ec \uc0c1\ud669\uc744 \ud574\uacb0\ud574\uc57c \ud588\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc0ac\uc6a9\ud558\uba74 \ud30c\ub4dc\uc758 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc7a5\uc560\ub97c \uac10\uc9c0\ud558\uace0 \uc790\ub3d9\uc73c\ub85c \uc0c8 \ubcf5\uc81c\ubcf8\uc73c\ub85c \uad50\uccb4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc0ac\uc6a9\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc0c1\ud0dc\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\uace0 \ube44\uc815\uc0c1 \uc778\uc2a4\ud134\uc2a4\ub97c \uc790\ub3d9\uc73c\ub85c \uad50\uccb4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc138 \uac00\uc9c0 \uc720\ud615\uc758 \uc0c1\ud0dc \uac80\uc0ac\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4.</p> <ol> <li>Liveness probe</li> <li>Startup probe (\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804 1.16 \uc774\uc0c1\uc5d0\uc11c \uc9c0\uc6d0)</li> <li>Readiness probe</li> </ol> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc5d0\uc774\uc804\ud2b8\uc778 Kubelet\uc740 \uc704\uc5d0\uc11c \uc5b8\uae09\ud55c \ubaa8\ub4e0 \uac80\uc0ac\ub97c \uc2e4\ud589\ud560 \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4. Kubelet\uc740 \uc138 \uac00\uc9c0 \ubc29\ubc95\uc73c\ub85c \ud30c\ub4dc\uc758 \uc0c1\ud0dc\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. kubelet\uc740 \ud30c\ub4dc\uc758 \ucee8\ud14c\uc774\ub108 \ub0b4\uc5d0\uc11c \uc178 \uba85\ub839\uc744 \uc2e4\ud589\ud558\uac70\ub098, \ucee8\ud14c\uc774\ub108\uc5d0 HTTP GET \uc694\uccad\uc744 \ubcf4\ub0b4\uac70\ub098, \uc9c0\uc815\ub41c \ud3ec\ud2b8\uc5d0 TCP \uc18c\ucf13\uc744 \uc5f4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ucee8\ud14c\uc774\ub108 \ub0b4\uc5d0\uc11c \uc178 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud558\ub294 <code>exec</code> \uae30\ubc18 \ud504\ub85c\ube0c\ub97c \uc120\ud0dd\ud558\ub294 \uacbd\uc6b0, <code>TimeoutSeconds</code> \uac12\uc774 \ub9cc\ub8cc\ub418\uae30 \uc804\uc5d0 \uc178 \uba85\ub839\uc5b4\uac00 \uc885\ub8cc\ub418\ub294\uc9c0 \ud655\uc778\ud558\uc2ed\uc2dc\uc624. \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 \ub178\ub4dc\uc5d0 \ub178\ub4dc \uc7a5\uc560\ub97c \uc77c\uc73c\ud0a4\ub294 <code>&lt;defunct&gt;</code> \ud504\ub85c\uc138\uc2a4\uac00 \uc0dd\uae41\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_12","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/reliability/docs/application/#liveness-probe","title":"Liveness Probe\ub97c \uc0ac\uc6a9\ud558\uc5ec \ube44\uc815\uc0c1 \ud30c\ub4dc \uc81c\uac70","text":"<p>Liveness probe\ub294 \ud504\ub85c\uc138\uc2a4\uac00 \uacc4\uc18d \uc2e4\ud589\ub418\uc9c0\ub9cc \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc751\ub2f5\ud558\uc9c0 \uc54a\ub294 \uad50\ucc29 \uc0c1\ud0dc\ub97c \uac10\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ud3ec\ud2b8 80\uc5d0\uc11c \uc218\uc2e0 \ub300\uae30\ud558\ub294 \uc6f9 \uc11c\ube44\uc2a4\ub97c \uc2e4\ud589 \uc911\uc778 \uacbd\uc6b0 \ud30c\ub4dc\uc758 \ud3ec\ud2b8 80\uc5d0\uc11c HTTP GET \uc694\uccad\uc744 \ubcf4\ub0b4\ub3c4\ub85d Liveness \ud504\ub85c\ube0c\ub97c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Kubelet\uc740 \uc8fc\uae30\uc801\uc73c\ub85c GET \uc694\uccad\uc744 \ud30c\ub4dc\uc5d0 \ubcf4\ub0b4\uace0 \uc751\ub2f5\uc744 \uae30\ub2e4\ub9bd\ub2c8\ub2e4. \ud30c\ub4dc\uac00 200-399 \uc0ac\uc774\uc5d0\uc11c \uc751\ub2f5\ud558\uba74 kubelet\uc740 \ud30c\ub4dc\uac00 \uc815\uc0c1\uc774\ub77c\uace0 \uac04\uc8fc\ud558\uace0, \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 \ud30c\ub4dc\ub294 \ube44\uc815\uc0c1\uc73c\ub85c \ud45c\uc2dc\ub429\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \uc0c1\ud0dc \uccb4\ud06c\uc5d0 \uacc4\uc18d \uc2e4\ud328\ud558\uba74 kubelet\uc740 \ud30c\ub4dc\ub97c \uc885\ub8cc\ud569\ub098\ub2e4.</p> <p><code>initialDelaySeconds</code>\ub97c \uc0ac\uc6a9\ud558\uc5ec \uccab \ubc88\uc9f8 \ud504\ub85c\ube0c\ub97c \uc9c0\uc5f0\uc2dc\ud0ac \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Liveness Probe\ub97c \uc0ac\uc6a9\ud560 \ub54c\ub294 \ubaa8\ub4e0 \ud30c\ub4dc\uac00 \ub3d9\uc2dc\uc5d0 Liveness Probe\uc5d0 \uc2e4\ud328\ud558\ub294 \uc0c1\ud669\uc774 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud574\uc57c \ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \uad50\uccb4\ud558\ub824\uace0 \uc2dc\ub3c4\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc624\ud504\ub77c\uc778\uc73c\ub85c \uc804\ud658\ud558\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uac8c\ub2e4\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uacc4\uc18d\ud574\uc11c \uc0c8\ub85c\uc6b4 \ud30c\ub4dc\ub97c \ub9cc\ub4e4\uc9c0\ub9cc Liveness Probe\ub3c4 \uc2e4\ud328\ud560 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \ubd88\ud544\uc694\ud55c \ubd80\ub2f4\uc744 \uc90d\ub2c8\ub2e4. \ud30c\ub4dc \uc678\ubd80 \uc694\uc18c(\uc608: \uc678\ubd80 \ub370\uc774\ud130\ubca0\uc774\uc2a4)\uc5d0 \uc758\uc874\ud558\ub3c4\ub85d Liveness Probe\ub97c \uad6c\uc131\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624. \ub2e4\uc2dc \ub9d0\ud574, \ud30c\ub4dc \uc678\ubd80 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uac00 \uc751\ub2f5\ud558\uc9c0 \uc54a\ub294\ub2e4\uace0 \ud574\uc11c \ud30c\ub4dc\uac00 Liveness Probe\uc5d0 \uc2e4\ud328\ud558\ub294 \uc77c\uc774 \uc788\uc5b4\uc11c\ub294 \uc548 \ub429\ub2c8\ub2e4.</p> <p>Sandor Sz\u00fccs\uc758 \uac8c\uc2dc\ubb3c \ud65c\uc131 \ud504\ub85c\ube0c\ub294 \uc704\ud5d8\ud558\ub2e4\uc5d0\uc11c\ub294 \uc798\ubabb \uad6c\uc131\ub41c \ud504\ub85c\ube0c\ub85c \uc778\ud574 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \ubb38\uc81c\ub97c \uc124\uba85\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#startup-probe","title":"\uc2dc\uc791\ud558\ub294 \ub370 \uc2dc\uac04\uc774 \uc624\ub798 \uac78\ub9ac\ub294 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\ub294 Startup Probe\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.","text":"<p>\uc571\uc744 \uc2dc\uc791\ud558\ub294 \ub370 \ucd94\uac00 \uc2dc\uac04\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 Startup Probe\ub97c \uc0ac\uc6a9\ud558\uc5ec Liveness \ubc0f Readniness Probe\ub97c \uc9c0\uc5f0\uc2dc\ud0ac \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ub370\uc774\ud130\ubca0\uc774\uc2a4\ub85c \ubd80\ud130 \ub370\uc774\ud130\ub97c \uce90\uc2f1\ud574\uc57c \ud558\ub294 Java \uc571\uc774 \uc81c\ub300\ub85c \uc791\ub3d9\ud558\ub824\uba74 \ucd5c\ub300 2\ubd84\uc774 \uac78\ub9b4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc644\uc804\ud788 \uc791\ub3d9\ud558\uae30 \uc804\uae4c\uc9c0\ub294 \ubaa8\ub4e0 Liveness \ub610\ub294 Readniness Probe\uac00 \uc2e4\ud328\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Startup Probe\ub97c \uad6c\uc131\ud558\uba74 Liveness \ub610\ub294 Readniness Probe\ub97c \uc2e4\ud589\ud558\uae30 \uc804\uc5d0 Java \uc571\uc744 \uc815\uc0c1\uc0c1\ud0dc\ub85c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>Startup Probe\uac00 \uc131\uacf5\ud560 \ub54c\uae4c\uc9c0 \ub2e4\ub978 \ubaa8\ub4e0 \ud504\ub85c\ube0c\ub294 \ube44\ud65c\uc131\ud654\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc2dc\uc791\uc744 \uc704\ud574 \ub300\uae30\ud574\uc57c \ud558\ub294 \ucd5c\ub300 \uc2dc\uac04\uc744 \uc815\uc758\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd5c\ub300 \uad6c\uc131 \uc2dc\uac04\uc774 \uc9c0\ub09c \ud6c4\uc5d0\ub3c4 \ud30c\ub4dc\uac00 \uc5ec\uc804\ud788 \uc2a4\ud0c0\ud2b8\uc5c5 \ud504\ub85c\ube0c\uc5d0 \uc2e4\ud328\ud558\uba74 \ud30c\ub4dc\ub294 \uc885\ub8cc\ub418\uace0 \uc0c8 \ud30c\ub4dc\uac00 \uc0dd\uc131\ub429\ub2c8\ub2e4. </p> <p>Startup Probe\ub294 Liveness Probe\uc640 \ube44\uc2b7\ud569\ub2c8\ub2e4. \uc989, \uc2e4\ud328\ud558\uba74 \ud30c\ub4dc\uac00 \ub2e4\uc2dc \uc0dd\uc131\ub429\ub2c8\ub2e4. Ricardo A.\uac00 \uc790\uc2e0\uc758 \uae00 \ud658\uc0c1\uc801\uc778 \ud504\ub85c\ube0c \ubc0f \uad6c\uc131 \ubc29\ubc95\uc5d0\uc11c \uc124\uba85\ud588\ub4ef\uc774, \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc2dc\uc791 \uc2dc\uac04\uc744 \uc608\uce21\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0\uc5d0\ub294 Startup Probe\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2dc\uc791\ud558\ub294 \ub370 10\ucd08\uac00 \uac78\ub9b0\ub2e4\ub294 \uac83\uc744 \uc54c\uace0 \uc788\ub2e4\uba74 \ub300\uc2e0 <code>initialDelaySeconds</code>\uc640 \ud568\uaed8 Liveness/Readiness Probe\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#readiness-probe","title":"Readiness Probe\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubd80\ubd84\uc801\uc73c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uc0c1\ud0dc\ub97c \uac10\uc9c0\ud558\uc138\uc694","text":"<p>Liveness probe\ub294 \ud30c\ub4dc \uc885\ub8cc(\uc989, \uc571 \uc7ac\uc2dc\uc791)\ub97c \ud1b5\ud574 \ud574\uacb0\ub418\ub294 \uc571 \uc7a5\uc560\ub97c \uac10\uc9c0\ud558\ub294 \ubc18\uba74, Readiness Probe\ub294 \uc571\uc744 temporarily \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uc0c1\ud0dc\ub97c \uac10\uc9c0\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc0c1\ud669\uc5d0\uc11c\ub294 \uc571\uc774 \uc77c\uc2dc\uc801\uc73c\ub85c \uc751\ub2f5\ud558\uc9c0 \uc54a\uc744 \uc218 \uc788\uc9c0\ub9cc \uc774 \uc791\uc5c5\uc774 \uc644\ub8cc\ub418\uba74 \ub2e4\uc2dc \uc815\uc0c1\uc774 \ub420 \uac83\uc73c\ub85c \uc608\uc0c1\ub429\ub2c8\ub2e4. </p> <p>\uc608\ub97c \ub4e4\uc5b4, \uc9d1\uc911\uc801\uc778 \ub514\uc2a4\ud06c I/O \uc791\uc5c5 \uc911\uc5d0\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc77c\uc2dc\uc801\uc73c\ub85c \uc694\uccad\uc744 \ucc98\ub9ac\ud560 \uc218 \uc5c6\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc5ec\uae30\uc11c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ud30c\ub4dc\ub97c \uc885\ub8cc\ud558\ub294 \uac83\uc740 \ud574\uacb0\ucc45\uc774 \uc544\ub2c8\uba70, \ub3d9\uc2dc\uc5d0 \ud30c\ub4dc\ub85c \uc804\uc1a1\ub41c \ucd94\uac00 \uc694\uccad\uc774 \uc2e4\ud328\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Readiness Probe\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc571\uc758 \uc77c\uc2dc\uc801\uc778 \uac00\uc6a9\uc131 \uc911\ub2e8\uc744 \uac10\uc9c0\ud558\uace0 \ub2e4\uc2dc \uc791\ub3d9\ud560 \ub54c\uae4c\uc9c0 \ud574\ub2f9 \ud30c\ub4dc\uc5d0 \ub300\ud55c \uc694\uccad \uc804\uc1a1\uc744 \uc911\ub2e8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2e4\ud328\ub85c \uc778\ud574 \ud30c\ub4dc\uac00 \uc7ac\uc0dd\uc131\ub418\ub294 Liveness Probe\uc640 \ub2ec\ub9ac, Readiness Probe\uac00 \uc2e4\ud328\ud558\uba74 \ud30c\ub4dc\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4\ub85c\ubd80\ud130 \uc5b4\ub5a0\ud55c \ud2b8\ub798\ud53d\ub3c4 \uc218\uc2e0\ud558\uc9c0 \uc54a\uac8c \ub429\ub2c8\ub2e4. Readiness Probe\uac00 \uc131\uacf5\ud558\uba74 \ud30c\ub4dc\ub294 \uc11c\ube44\uc2a4\ub85c\ubd80\ud130 \ud2b8\ub798\ud53d\uc744 \ub2e4\uc2dc \uc218\uc2e0\ud569\ub2c8\ub2e4. </p> <p>Liveness Probe\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \ud30c\ub4dc \uc678\ubd80\uc758 \ub9ac\uc18c\uc2a4(\uc608: \ub370\uc774\ud130\ubca0\uc774\uc2a4)\uc5d0 \uc758\uc874\ud558\ub294 Readiness Probe\ub97c \uad6c\uc131\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624. \ub2e4\uc74c\uc740 \uc798\ubabb \uad6c\uc131\ub41c Readiness\ub85c \uc778\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc791\ub3d9\ud558\uc9c0 \uc54a\uc744 \uc218 \uc788\ub294 \uc2dc\ub098\ub9ac\uc624\uc785\ub2c8\ub2e4. \uc571\uc758 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc5c6\uc744 \ub54c \ud30c\ub4dc\uc758 Readiness Probe\uc5d0 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\uba74 \ub2e4\ub978 \ud30c\ub4dc \ubcf5\uc81c\ubcf8\ub3c4 \ub3d9\uc77c\ud55c \uc0c1\ud0dc \uc810\uac80 \uae30\uc900\uc744 \uacf5\uc720\ud558\ubbc0\ub85c \ub3d9\uc2dc\uc5d0 \uc2e4\ud328\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ubc29\uc2dd\uc73c\ub85c \ud504\ub85c\ube0c\ub97c \uc124\uc815\ud558\uba74 \ub370\uc774\ud130\ubca0\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc744 \ub54c\ub9c8\ub2e4 \ud30c\ub4dc\uc758 Readiness Probe\uac00 \uc2e4\ud328\ud558\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 all \ud30c\ub4dc\ub85c \ud2b8\ub798\ud53d \uc804\uc1a1\uc744 \uc911\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>Readiness Probes \uc0ac\uc6a9\uc758 \ubd80\uc791\uc6a9\uc740 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \ub370 \uac78\ub9ac\ub294 \uc2dc\uac04\uc744 \ub298\ub9b4 \uc218 \uc788\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. Readiness Probe\uac00 \uc131\uacf5\ud558\uc9c0 \uc54a\ub294 \ud55c \uc0c8 \ubcf5\uc81c\ubcf8\uc740 \ud2b8\ub798\ud53d\uc744 \uc218\uc2e0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uadf8\ub54c\uae4c\uc9c0\ub294 \uae30\uc874 \ubcf5\uc81c\ubcf8\uc774 \uacc4\uc18d\ud574\uc11c \ud2b8\ub798\ud53d\uc744 \uc218\uc2e0\ud558\uac8c \ub429\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_13","title":"\uc7a5\uc560 \ucc98\ub9ac","text":"<p>\ud30c\ub4dc\uc758 \uc218\uba85\uc740 \uc720\ud55c\ud569\ub2c8\ub2e4. - \ud30c\ub4dc\ub97c \uc624\ub798 \uc2e4\ud589\ud558\ub354\ub77c\ub3c4 \ub54c\uac00 \ub418\uba74 \ud30c\ub4dc\uac00 \uc62c\ubc14\ub974\uac8c \uc885\ub8cc\ub418\ub3c4\ub85d \ud558\ub294 \uac83\uc774 \ud604\uba85\ud569\ub2c8\ub2e4. \uc5c5\uadf8\ub808\uc774\ub4dc \uc804\ub7b5\uc5d0 \ub530\ub77c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\ub824\uba74 \uc0c8 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc0dd\uc131\ud574\uc57c \ud560 \uc218 \uc788\uc73c\uba70, \uc774 \uacbd\uc6b0 \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \uc0c8 \ub178\ub4dc\uc5d0\uc11c \ub2e4\uc2dc \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \uc801\uc808\ud55c \uc885\ub8cc \ucc98\ub9ac \ubc0f \ud30c\ub4dc \uc911\ub2e8 \uc608\uc0b0\uc744 \ub9c8\ub828\ud558\uba74 \ud30c\ub4dc\uac00 \uc774\uc804 \ub178\ub4dc\uc5d0\uc11c \uc81c\uac70\ub418\uace0 \uc0c8 \ub178\ub4dc\uc5d0\uc11c \uc7ac\uc0dd\uc131\ub420 \ub54c \uc11c\ube44\uc2a4 \uc911\ub2e8\uc744 \ud53c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\uc6cc\ucee4 \ub178\ub4dc\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\ub294 \uac00\uc7a5 \uc88b\uc740 \ubc29\ubc95\uc740 \uc0c8 \uc6cc\ucee4 \ub178\ub4dc\ub97c \ub9cc\ub4e4\uace0 \uae30\uc874 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc885\ub8cc\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc885\ub8cc\ud558\uae30 \uc804\uc5d0 \uba3c\uc800 \uc6cc\ucee4 \ub178\ub4dc\ub97c <code>drain</code> \ud574\uc57c \ud569\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc\uac00 \ube44\uc6cc\uc9c0\uba74 \ud574\ub2f9 \ub178\ub4dc\uc758 \ubaa8\ub4e0 \ud3ec\ub4dc\uac00 \uc548\uc804\ud558\uac8c \uc81c\uac70\ub429\ub2c8\ub2e4. \uc5ec\uae30\uc11c \uac00\uc7a5 \uc911\uc694\ud55c \ub2e8\uc5b4\ub294 \uc548\uc804\uc785\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc\uc5d0\uc11c \ud30c\ub4dc\uac00 \uc81c\uac70\ub418\uba74 \ub2e8\uc21c\ud788 <code>SIGKILL</code> \uc2dc\uadf8\ub110\uc774 \uc804\uc1a1\ub418\ub294 \uac83\uc774 \uc544\ub2d9\ub2c8\ub2e4. \ub300\uc2e0, <code>SIGTERM</code> \uc2e0\ud638\uac00 \uc81c\uac70\ub418\ub294 \ud30c\ub4dc\uc5d0 \uc788\ub294 \uac01 \ucee8\ud14c\uc774\ub108\uc758 \uba54\uc778 \ud504\ub85c\uc138\uc2a4(PID 1)\ub85c \ubcf4\ub0b4\uc9c4\ub2e4. <code>SIGTERM</code> \uc2e0\ud638\uac00 \uc804\uc1a1\ub41c \ud6c4, \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud504\ub85c\uc138\uc2a4\uc5d0 <code>SIGKILL</code> \uc2e0\ud638\uac00 \uc804\uc1a1\ub418\uae30\uae4c\uc9c0 \uc77c\uc815 \uc2dc\uac04(\uc720\uc608 \uae30\uac04)\uc744 \uc90d\ub2c8\ub2e4. \uc774 \uc720\uc608 \uae30\uac04\uc740 \uae30\ubcf8\uc801\uc73c\ub85c 30\ucd08\uc785\ub2c8\ub2e4. kubectl\uc5d0\uc11c <code>grace-period</code> \ud50c\ub798\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uae30\ubcf8\uac12\uc744 \uc7ac\uc815\uc758\ud558\uac70\ub098 Podspec\uc5d0\uc11c <code>terminationGracePeriodSeconds</code>\ub97c \uc120\uc5b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p><code>kubectl delete pod &lt;pod name&gt; \u2014grace-period=&lt;seconds&gt;</code></p> <p>\uba54\uc778 \ud504\ub85c\uc138\uc2a4\uc5d0 PID 1\uc774 \uc5c6\ub294 \ucee8\ud14c\uc774\ub108\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc77c\ubc18\uc801\uc785\ub2c8\ub2e4. \ub2e4\uc74c\uacfc \uac19\uc740 Python \uae30\ubc18 \uc0d8\ud50c \ucee8\ud14c\uc774\ub108\ub97c \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624.</p> <pre><code>$ kubectl exec python-app -it ps\n PID USER TIME COMMAND\n 1   root 0:00 {script.sh} /bin/sh ./script.sh\n 5   root 0:00 python app.py\n</code></pre> <p>\uc774 \uc608\uc81c\uc5d0\uc11c \uc178 \uc2a4\ud06c\ub9bd\ud2b8\ub294 <code>SIGTERM</code>\uc744 \uc218\uc2e0\ud558\ub294\ub370, \uc774 \uc608\uc81c\uc758 \uba54\uc778 \ud504\ub85c\uc138\uc2a4\ub294 \ud30c\uc774\uc36c \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc774\uc9c0\ub9cc <code>SIGTERM</code> \uc2e0\ud638\ub97c \ubc1b\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \uc885\ub8cc\ub418\uba74, \ud30c\uc774\uc36c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uac11\uc790\uae30 \uc885\ub8cc\ub429\ub2c8\ub2e4. \uc774 \ubb38\uc81c\ub294 \ucee8\ud14c\uc774\ub108\uc758 <code>ENTRYPOINT</code>\ub97c \ubcc0\uacbd\ud558\uc5ec \ud30c\uc774\uc36c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589\ud568\uc73c\ub85c\uc368 \ud574\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ub294 dumb-init\uacfc \uac19\uc740 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc2e0\ud638\ub97c \ucc98\ub9ac\ud560 \uc218 \uc788\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ucee8\ud14c\uc774\ub108 \ud6c4\ud06c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108 \uc2dc\uc791 \ub610\ub294 \uc911\uc9c0 \uc2dc \uc2a4\ud06c\ub9bd\ud2b8 \ub610\ub294 HTTP \uc694\uccad\uc744 \uc2e4\ud589\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. <code>Prestop</code> \ud6c4\ud06c \uc561\uc158\uc740 \ucee8\ud14c\uc774\ub108\uac00 <code>SIGTERM</code> \uc2e0\ud638\ub97c \uc218\uc2e0\ud558\uae30 \uc804\uc5d0 \uc2e4\ud589\ub418\uba70 \uc774 \uc2e0\ud638\uac00 \uc804\uc1a1\ub418\uae30 \uc804\uc5d0 \uc644\ub8cc\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. <code>terminationGracePeriodSeconds</code> \uac12\uc740 <code>SIGTERM</code> \uc2e0\ud638\uac00 \uc804\uc1a1\ub420 \ub54c\uac00 \uc544\ub2c8\ub77c <code>PreStop</code> \ud6c4\ud06c \uc561\uc158\uc774 \uc2e4\ud589\ub418\uae30 \uc2dc\uc791\ud560 \ub54c\ubd80\ud130 \uc801\uc6a9\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#_14","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/reliability/docs/application/#pod-disruption-budget","title":"Pod Disruption Budget\uc73c\ub85c \uc911\uc694\ud55c \uc6cc\ud06c\ub85c\ub4dc\ub97c \ubcf4\ud638\ud558\uc138\uc694","text":"<p>Pod Disruption Budget \ub610\ub294 PDB\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ubcf5\uc81c\ubcf8 \uc218\uac00 \uc120\uc5b8\ub41c \uc784\uacc4\uac12 \uc544\ub798\ub85c \ub5a8\uc5b4\uc9c0\uba74 \uc81c\uac70 \ud504\ub85c\uc138\uc2a4\ub97c \uc77c\uc2dc\uc801\uc73c\ub85c \uc911\ub2e8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ubcf5\uc81c\ubcf8 \uc218\uac00 \uc784\uacc4\uac12\uc744 \ucd08\uacfc\ud558\uba74 \uc81c\uac70 \ud504\ub85c\uc138\uc2a4\uac00 \uacc4\uc18d\ub429\ub2c8\ub2e4. PDB\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubcf5\uc81c\ubcf8\uc758 <code>minAvailable</code> \ubc0f <code>maxUnavailable</code> \uc218\ub97c \uc120\uc5b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc571 \ubcf5\uc81c\ubcf8\uc744 3\uac1c \uc774\uc0c1 \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ud558\ub824\uba74 PDB\ub97c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <pre><code>apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: my-svc-pdb\nspec:\n  minAvailable: 3\n  selector:\n    matchLabels:\n      app: my-svc\n</code></pre> <p>\uc704\uc758 PDB \uc815\ucc45\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uac8c 3\uac1c \uc774\uc0c1\uc758 \ubcf5\uc81c\ubcf8\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc744 \ub54c\uae4c\uc9c0 \uc81c\uac70 \ud504\ub85c\uc138\uc2a4\ub97c \uc911\ub2e8\ud558\ub3c4\ub85d \uc9c0\uc2dc\ud569\ub2c8\ub2e4. \ub178\ub4dc \ub4dc\ub808\uc774\ub2dd\uc740 <code>PodDisruptionBudgets</code>\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. EKS \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 \uc5c5\uadf8\ub808\uc774\ub4dc \uc911\uc5d0\ub294 15\ubd84 \ud0c0\uc784\uc544\uc6c3\uc73c\ub85c \ub178\ub4dc\uac00 \uace0\uac08\ub429\ub2c8\ub2e4. 15\ubd84 \ud6c4 \uc5c5\ub370\uc774\ud2b8\ub97c \uac15\uc81c \uc2e4\ud589\ud558\uc9c0 \uc54a\uc73c\uba74(EKS \ucf58\uc194\uc5d0\uc11c\ub294 \ub864\ub9c1 \uc5c5\ub370\uc774\ud2b8\ub77c\uace0 \ud568) \uc5c5\ub370\uc774\ud2b8\uac00 \uc2e4\ud328\ud569\ub2c8\ub2e4. \uc5c5\ub370\uc774\ud2b8\ub97c \uac15\uc81c\ub85c \uc801\uc6a9\ud558\uba74 \ud30c\ub4dc\uac00 \uc0ad\uc81c\ub429\ub2c8\ub2e4.</p> <p>\uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc\uc758 \uacbd\uc6b0 AWS Node Termination Handler\uc640 \uac19\uc740 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 Kubernetes \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc774 EC2 \uc720\uc9c0 \uad00\ub9ac \uc774\ubca4\ud2b8 \ubc0f EC2 \uc2a4\ud31f \uc911\ub2e8 \ub4f1 EC2 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uac8c \ub420 \uc218 \uc788\ub294 \uc774\ubca4\ud2b8\uc5d0 \uc801\uc808\ud558\uac8c \ub300\uc751\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\ub97c \ube44\uc6b0\uace0 \uc0c8 \ud30c\ub4dc\uac00 \uc2a4\ucf00\uc904\ub418\uc9c0 \uc54a\ub3c4\ub85d \ud55c \ub2e4\uc74c, \ud30c\ub4dc\ub97c \ub4dc\ub808\uc774\ub2dd\ud558\uc5ec \uc2e4\ud589 \uc911\uc778 \ud30c\ub4dc\ub97c \uc885\ub8cc\ud55c\ub2e4.</p> <p>\ud30c\ub4dc anti-affinity\ub97c \uc0ac\uc6a9\ud574 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ud30c\ub4dc\ub97c \ub2e4\ub978 \ub178\ub4dc\uc5d0 \uc2a4\ucf00\uc904\ub9c1\ud558\uace0 \ub178\ub4dc \uc5c5\uadf8\ub808\uc774\ub4dc \uc911 PDB \uad00\ub828 \uc9c0\uc5f0\uc744 \ud53c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_15","title":"\uce74\uc624\uc2a4 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1 \uc5f0\uc2b5","text":"<p>\uce74\uc624\uc2a4 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1\uc740 \ud504\ub85c\ub355\uc158\uc5d0\uc11c\uc758 \uaca9\ub82c\ud55c \uc870\uac74\uc744 \uacac\ub51c \uc218 \uc788\ub294 \uc2dc\uc2a4\ud15c\uc758 \uc131\ub2a5\uc5d0 \ub300\ud55c \uc2e0\ub8b0\ub97c \uad6c\ucd95\ud558\uae30 \uc704\ud574 \ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uc744 \uc2e4\ud5d8\ud558\ub294 \ubd84\uc57c\uc785\ub2c8\ub2e4.</p> <p>Dominik Tornow\ub294 \uc790\uc2e0\uc758 \ube14\ub85c\uadf8 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc120\uc5b8\uc801 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \u201c\uc0ac\uc6a9\uc790\uac00 \uc6d0\ud558\ub294 \uc2dc\uc2a4\ud15c \uc0c1\ud0dc\ub97c \uc2dc\uc2a4\ud15c\uc5d0 \ud45c\uc2dc\ud569\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c \uc2dc\uc2a4\ud15c\uc740 \ud604\uc7ac \uc0c1\ud0dc\uc640 \uc6d0\ud558\ub294 \uc0c1\ud0dc\ub97c \uace0\ub824\ud558\uc5ec \ud604\uc7ac \uc0c1\ud0dc\uc5d0\uc11c \uc6d0\ud558\ub294 \uc0c1\ud0dc\ub85c \uc804\ud658\ud558\uae30 \uc704\ud55c \uba85\ub839 \uc21c\uc11c\ub97c \uacb0\uc815\ud569\ub2c8\ub2e4.\u201d\ub77c\uace0 \uc124\uba85\ud569\ub2c8\ub2e4. \uc989, \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud56d\uc0c1 \uc6d0\ud558\ub294 \uc0c1\ud0dc\ub97c \uc800\uc7a5\ud558\uace0 \uc2dc\uc2a4\ud15c\uc774 \uc774\ub97c \ubc97\uc5b4\ub098\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc0c1\ud0dc\ub97c \ubcf5\uc6d0\ud558\uae30 \uc704\ud55c \uc870\uce58\ub97c \ucde8\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uac8c \ub418\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud30c\ub4dc\ub97c \ub2e4\ub978 \uc6cc\ucee4 \ub178\ub4dc\ub85c \ub2e4\uc2dc \uc2a4\ucf00\uc904\ud569\ub2c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c, <code>replica</code>\uac00 \ucda9\ub3cc\ud558\uba74 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8 \ucee8\ud2b8\ub864\ub7ec\uac00 \uc0c8 <code>replica</code>\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc774\ub7f0 \ubc29\uc2dd\uc73c\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864\ub7ec\ub294 \uc7a5\uc560\ub97c \uc790\ub3d9\uc73c\ub85c \uc218\uc815\ud569\ub2c8\ub2e4. </p> <p>Gremlin\uacfc \uac19\uc740 \uce74\uc624\uc2a4 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 \ubcf5\uc6d0\ub825\uc744 \ud14c\uc2a4\ud2b8\ud558\uace0 \ub2e8\uc77c \uc7a5\uc560 \uc9c0\uc810\uc744 \uc2dd\ubcc4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130(\ubc0f \uadf8 \uc774\uc0c1)\uc5d0 \uc778\uc704\uc801\uc778 \ud63c\ub3c8\uc744 \uc720\ubc1c\ud558\ub294 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 \uc2dc\uc2a4\ud15c \uc57d\uc810\uc744 \ubc1c\uacac\ud558\uace0 \ubcd1\ubaa9 \ud604\uc0c1\uacfc \uc798\ubabb\ub41c \uad6c\uc131\uc744 \uc2dd\ubcc4\ud558\uba70 \ud1b5\uc81c\ub41c \ud658\uacbd\uc5d0\uc11c \ubb38\uc81c\ub97c \uc218\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uce74\uc624\uc2a4 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1 \ucca0\ud559\uc740 \uc758\ub3c4\uc801\uc73c\ub85c \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uace0 \uc778\ud504\ub77c\uc5d0 \uc2a4\ud2b8\ub808\uc2a4\ub97c \uc8fc\uc5b4 \uc608\uc0c1\uce58 \ubabb\ud55c \ub2e4\uc6b4\ud0c0\uc784\uc744 \ucd5c\uc18c\ud654\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_16","title":"\uc11c\ube44\uc2a4 \uba54\uc2dc \uc0ac\uc6a9","text":"<p>\uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ubcf5\uc6d0\ub825\uc744 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uba54\uc2dc\ub294 \uc11c\ube44\uc2a4 \uac04 \ud1b5\uc2e0\uc744 \uac00\ub2a5\ud558\uac8c \ud558\uace0 \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4 \ub124\ud2b8\uc6cc\ud06c\uc758 \uac00\uc2dc\uc131\uc744 \ub192\uc785\ub2c8\ub2e4. \ub300\ubd80\ubd84\uc758 \uc11c\ube44\uc2a4 \uba54\uc2dc \uc81c\ud488\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d\uc744 \uac00\ub85c\ucc44\uace0 \uac80\uc0ac\ud558\ub294 \uc18c\uaddc\ubaa8 \ub124\ud2b8\uc6cc\ud06c \ud504\ub85d\uc2dc\ub97c \uac01 \uc11c\ube44\uc2a4\uc640 \ud568\uaed8 \uc2e4\ud589\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c \uc791\ub3d9\ud569\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc218\uc815\ud558\uc9c0 \uc54a\uace0\ub3c4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uba54\uc2dc\uc5d0 \ubc30\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \ud504\ub85d\uc2dc\uc5d0 \ub0b4\uc7a5\ub41c \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \ud1b5\uacc4\ub97c \uc0dd\uc131\ud558\uace0, \uc561\uc138\uc2a4 \ub85c\uadf8\ub97c \uc0dd\uc131\ud558\uace0, \ubd84\uc0b0 \ucd94\uc801\uc744 \uc704\ud55c \uc544\uc6c3\ubc14\uc6b4\ub4dc \uc694\uccad\uc5d0 HTTP \ud5e4\ub354\ub97c \ucd94\uac00\ud558\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uba74 \uc790\ub3d9 \uc694\uccad \uc7ac\uc2dc\ub3c4, \uc81c\ud55c \uc2dc\uac04, \ud68c\ub85c \ucc28\ub2e8, \uc18d\ub3c4 \uc81c\ud55c\uacfc \uac19\uc740 \uae30\ub2a5\uc744 \ud1b5\ud574 \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4\uc758 \ubcf5\uc6d0\ub825\uc744 \ub192\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc5ec\ub7ec \ud074\ub7ec\uc2a4\ud130\ub97c \uc6b4\uc601\ud558\ub294 \uacbd\uc6b0 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \uac04 \uc11c\ube44\uc2a4 \uac04 \ud1b5\uc2e0\uc744 \ud65c\uc131\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#_17","title":"\uc11c\ube44\uc2a4 \uba54\uc2dc","text":"<ul> <li>AWS App Mesh</li> <li>Istio</li> <li>LinkerD</li> <li>Consul</li> </ul>"},{"location":"ko/reliability/docs/application/#observability","title":"Observability","text":"<p>Observability\ub294 \ubaa8\ub2c8\ud130\ub9c1, \ub85c\uae45, \ucd94\uc801\uc744 \ud3ec\ud568\ud558\ub294 \ud3ec\uad04\uc801\uc778 \uc6a9\uc5b4\uc785\ub2c8\ub2e4. \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4 \uae30\ubc18 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \uae30\ubcf8\uc801\uc73c\ub85c \ubc30\ud3ec\ub429\ub2c8\ub2e4. \ub2e8\uc77c \uc2dc\uc2a4\ud15c\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \uac83\uc73c\ub85c \ucda9\ubd84\ud55c \ubaa8\ub180\ub9ac\uc2dd \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \ub2ec\ub9ac \ubd84\uc0b0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc544\ud0a4\ud14d\ucc98\uc5d0\uc11c\ub294 \uac01 \uad6c\uc131 \uc694\uc18c\uc758 \uc131\ub2a5\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud574\uc57c \ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc218\uc900 \ubaa8\ub2c8\ud130\ub9c1, \ub85c\uae45 \ubc0f \ubd84\uc0b0 \ucd94\uc801 \uc2dc\uc2a4\ud15c\uc744 \uc0ac\uc6a9\ud558\uc5ec \uace0\uac1d\uc774 \uc911\ub2e8\ub418\uae30 \uc804\uc5d0 \ud074\ub7ec\uc2a4\ud130\uc758 \ubb38\uc81c\ub97c \uc2dd\ubcc4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ubb38\uc81c \ud574\uacb0 \ubc0f \ubaa8\ub2c8\ud130\ub9c1\uc744 \uc704\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub0b4\uc7a5 \ub3c4\uad6c\ub294 \uc81c\ud55c\uc801\uc785\ub2c8\ub2e4. \uba54\ud2b8\ub9ad \uc11c\ubc84\ub294 \ub9ac\uc18c\uc2a4 \uba54\ud2b8\ub9ad\uc744 \uc218\uc9d1\ud558\uc5ec \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud558\uc9c0\ub9cc \uc720\uc9c0\ud558\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. kubectl\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\uc758 \ub85c\uadf8\ub97c \ubcfc \uc218 \uc788\uc9c0\ub9cc, \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ub85c\uadf8\ub97c \uc790\ub3d9\uc73c\ub85c \ubcf4\uad00\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \ubd84\uc0b0 \ucd94\uc801 \uad6c\ud604\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ucf54\ub4dc \uc218\uc900\uc5d0\uc11c \ub610\ub294 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc218\ud589\ub429\ub2c8\ub2e4. </p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \ud655\uc7a5\uc131\uc740 \uc5ec\uae30\uc11c \ube5b\uc744 \ubc1c\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc0ac\uc6a9\ud558\uba74 \uc120\ud638\ud558\ub294 \uc911\uc559 \uc9d1\uc911\uc2dd \ubaa8\ub2c8\ud130\ub9c1, \ub85c\uae45 \ubc0f \ucd94\uc801 \uc194\ub8e8\uc158\uc744 \uac00\uc838\uc62c \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_18","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/reliability/docs/application/#_19","title":"\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubaa8\ub2c8\ud130\ub9c1","text":"<p>\ucd5c\uc2e0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \ubaa8\ub2c8\ud130\ub9c1\ud574\uc57c \ud558\ub294 \uc9c0\ud45c\uc758 \uc218\ub294 \uacc4\uc18d \uc99d\uac00\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc790\ub3d9\uc73c\ub85c \ucd94\uc801\ud558\uba74 \uace0\uac1d\uc758 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294\ub370 \uc9d1\uc911\ud560 \uc218 \uc788\uc5b4 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4. Prometheus \ub610\ub294 CloudWatch Container Insights\uc640 \uac19\uc740 \ud074\ub7ec\uc2a4\ud130 \uc804\ubc18\uc758 \ubaa8\ub2c8\ud130\ub9c1 \ub3c4\uad6c\ub294 \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc6cc\ud06c\ub85c\ub4dc\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\uace0 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \ub54c \ub610\ub294 \uac00\uae09\uc801\uc774\uba74 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uae30 \uc804\uc5d0 \uc2e0\ud638\ub97c \uc81c\uacf5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ubaa8\ub2c8\ud130\ub9c1 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 \uc6b4\uc601 \ud300\uc774 \uad6c\ub3c5\ud560 \uc218 \uc788\ub294 \uc54c\ub9bc\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc545\ud654 \uc2dc \uac00\ub3d9 \uc911\ub2e8\uc73c\ub85c \uc774\uc5b4\uc9c0\uac70\ub098 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc131\ub2a5\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub294 \uc774\ubca4\ud2b8\uc5d0 \ub300\ud574 \uacbd\ubcf4\ub97c \ud65c\uc131\ud654\ud558\ub294 \uaddc\uce59\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. </p> <p>\uc5b4\ub5a4 \uba54\ud2b8\ub9ad\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud574\uc57c \ud560\uc9c0 \uc798 \ubaa8\ub974\uaca0\ub2e4\uba74 \ub2e4\uc74c \ubc29\ubc95\uc5d0\uc11c \uc601\uac10\uc744 \uc5bb\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>RED method. \uc694\uccad, \uc624\ub958, \uae30\uac04\uc744 \ub098\ud0c0\ub0c5\ub2c8\ub2e4. </li> <li>USE method. \uc0ac\uc6a9\ub960, \ud3ec\ud654\ub3c4, \uc624\ub958\ub97c \ub098\ud0c0\ub0c5\ub2c8\ub2e4. </li> </ul> <p>Sysdig\uc758 \uac8c\uc2dc\ubb3c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc54c\ub9bc \ubaa8\ubc94 \uc0ac\ub840\uc5d0\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uac00\uc6a9\uc131\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub294 \uad6c\uc131 \uc694\uc18c\uc758 \ud3ec\uad04\uc801\uc778 \ubaa9\ub85d\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#_20","title":"\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ud074\ub77c\uc774\uc5b8\ud2b8 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uba54\ud2b8\ub9ad\uc744 \uacf5\uac1c\ud558\uc138\uc694","text":"<p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc0c1\ud0dc\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\uace0 \ud45c\uc900 \uba54\ud2b8\ub9ad\uc744 \uc9d1\uacc4\ud558\ub294 \uac83 \uc678\uc5d0\ub3c4 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ud074\ub77c\uc774\uc5b8\ud2b8 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\ubcc4 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \uba54\ud2b8\ub9ad\uc744 \uacf5\uac1c\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uac00\uc2dc\uc131\uc744 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/application/#_21","title":"\uc911\uc559 \uc9d1\uc911\uc2dd \ub85c\uae45 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub85c\uadf8\ub97c \uc218\uc9d1\ud558\uace0 \uc720\uc9c0\ud569\ub2c8\ub2e4.","text":"<p>EKS \ub85c\uae45\uc740 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uadf8\uc640 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub85c\uadf8\uc758 \ub450 \uac00\uc9c0 \ubc94\uc8fc\uc5d0 \uc18d\ud569\ub2c8\ub2e4. EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uae45\uc740 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \uac10\uc0ac \ubc0f \uc9c4\ub2e8 \ub85c\uadf8\ub97c \uacc4\uc815\uc758 CloudWatch Logs\ub85c \uc9c1\uc811 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub85c\uadf8\ub294 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\uc5d0\uc11c \uc0dd\uc131\ub418\ub294 \ub85c\uadf8\uc785\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub85c\uadf8\uc5d0\ub294 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589\ud558\ub294 \ud30c\ub4dc\uc640 CoreDNS, Cluster Autoscaler, Prometheus \ub4f1\uacfc \uac19\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\uc2a4\ud15c \ucef4\ud3ec\ub10c\ud2b8\uc5d0\uc11c \uc0dd\uc131\ub41c \ub85c\uadf8\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. </p> <p>EKS\ub294 \ub2e4\uc12f \uac00\uc9c0 \uc720\ud615\uc758 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uadf8\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4.:</p> <ol> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \uad6c\uc131 \uc694\uc18c \ub85c\uadf8</li> <li>\uac10\uc0ac</li> <li>\uc778\uc99d\uc790(Authenticator)</li> <li>\ucee8\ud2b8\ub864\ub7ec \ub9e4\ub2c8\uc800 </li> <li>\uc2a4\ucf00\uc904\ub7ec</li> </ol> <p>\ucee8\ud2b8\ub864\ub7ec \uad00\ub9ac\uc790 \ubc0f \uc2a4\ucf00\uc904\ub7ec \ub85c\uadf8\ub294 \ubcd1\ubaa9 \ud604\uc0c1 \ubc0f \uc624\ub958\uc640 \uac19\uc740 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ubb38\uc81c\ub97c \uc9c4\ub2e8\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uadf8\ub294 CloudWatch Logs\ub85c \uc804\uc1a1\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uae45\uc744 \ud65c\uc131\ud654\ud558\uace0 \uacc4\uc815\uc758 \uac01 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud574 \ucea1\ucc98\ud558\ub824\ub294 EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uadf8\uc758 \uc720\ud615\uc744 \uc120\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub85c\uadf8\ub97c \uc218\uc9d1\ud558\ub824\uba74 \ud074\ub7ec\uc2a4\ud130\uc5d0 Fluent Bit, Fluentd \ub610\ub294 CloudWatch Container Insights\uc640 \uac19\uc740 \ub85c\uadf8 \uc218\uc9d1 \ub3c4\uad6c\ub97c \uc124\uce58\ud574\uc57c \ud569\ub2c8\ub2e4. </p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub85c\uadf8 \uc560\uadf8\ub9ac\uac8c\uc774\ud130 \ub3c4\uad6c\ub294 \ub370\ubaac\uc14b\uc73c\ub85c \uc2e4\ud589\ub418\uba70 \ub178\ub4dc\uc758 \ucee8\ud14c\uc774\ub108 \ub85c\uadf8\ub97c \uc2a4\ud06c\ub7a9\ud569\ub2c8\ub2e4. \uadf8\ub7ec\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub85c\uadf8\uac00 \uc911\uc559 \uc9d1\uc911\uc2dd \ub300\uc0c1\uc73c\ub85c \uc804\uc1a1\ub418\uc5b4 \uc800\uc7a5\ub429\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 CloudWatch \ucee8\ud14c\uc774\ub108 \uc778\uc0ac\uc774\ud2b8\ub294 Fluent Bit \ub610\ub294 Fluentd\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub85c\uadf8\ub97c \uc218\uc9d1\ud558\uace0 \uc774\ub97c CloudWatch Logs\ub85c \uc804\uc1a1\ud558\uc5ec \uc800\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Fluent Bit\uacfc Fluentd\ub294 Elasticsearch \ubc0f InfluxDB\uc640 \uac19\uc740 \ub110\ub9ac \uc0ac\uc6a9\ub418\ub294 \uc5ec\ub7ec \ub85c\uadf8 \ubd84\uc11d \uc2dc\uc2a4\ud15c\uc744 \uc9c0\uc6d0\ud558\ubbc0\ub85c Fluent Bit \ub610\ub294 Fluentd\uc758 \ub85c\uadf8 \uad6c\uc131\uc744 \uc218\uc815\ud558\uc5ec \ub85c\uadf8\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \ubc31\uc5d4\ub4dc\ub97c \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/application/#_22","title":"\ubd84\uc0b0 \ucd94\uc801 \uc2dc\uc2a4\ud15c\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubcd1\ubaa9 \ud604\uc0c1\uc744 \uc2dd\ubcc4\ud558\uc2ed\uc2dc\uc624.","text":"<p>\uc77c\ubc18\uc801\uc778 \ucd5c\uc2e0 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc5d0\ub294 \ub124\ud2b8\uc6cc\ud06c\ub97c \ud1b5\ud574 \uad6c\uc131 \uc694\uc18c\uac00 \ubd84\uc0b0\ub418\uc5b4 \uc788\uc73c\uba70 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc744 \uad6c\uc131\ud558\ub294 \uac01 \uad6c\uc131 \uc694\uc18c\uac00 \uc81c\ub300\ub85c \uc791\ub3d9\ud558\ub294\uc9c0\uc5d0 \ub530\ub77c \uc2e0\ub8b0\uc131\uc774 \ub2ec\ub77c\uc9d1\ub2c8\ub2e4. \ubd84\uc0b0 \ucd94\uc801 \uc194\ub8e8\uc158\uc744 \uc0ac\uc6a9\ud558\uba74 \uc694\uccad\uc758 \ud750\ub984\uacfc \uc2dc\uc2a4\ud15c\uc774 \ud1b5\uc2e0\ud558\ub294 \ubc29\uc2dd\uc744 \uc774\ud574\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd94\uc801\uc744 \ud1b5\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub124\ud2b8\uc6cc\ud06c\uc5d0\uc11c \ubcd1\ubaa9 \ud604\uc0c1\uc774 \ubc1c\uc0dd\ud558\ub294 \uc704\uce58\ub97c \ud30c\uc545\ud558\uace0 \uc5f0\uc1c4\uc801 \uc7a5\uc560\ub97c \uc77c\uc73c\ud0ac \uc218 \uc788\ub294 \ubb38\uc81c\ub97c \uc608\ubc29\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \ucd94\uc801\uc744 \uad6c\ud604\ud558\ub294 \ubc29\ubc95\uc5d0\ub294 \ub450 \uac00\uc9c0\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uacf5\uc720 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucf54\ub4dc \uc218\uc900\uc5d0\uc11c \ubd84\uc0b0 \ucd94\uc801\uc744 \uad6c\ud604\ud558\uac70\ub098 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\ucf54\ub4dc \uc218\uc900\uc5d0\uc11c \ucd94\uc801\uc744 \uad6c\ud604\ud558\ub294 \uac83\uc740 \ubd88\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uba54\uc11c\ub4dc\uc5d0\uc11c\ub294 \ucf54\ub4dc\ub97c \ubcc0\uacbd\ud574\uc57c \ud569\ub2c8\ub2e4. \ub2e4\uad6d\uc5b4 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc774\ub294 \ub354 \ubcf5\uc7a1\ud569\ub2c8\ub2e4. \ub610\ud55c \uc11c\ube44\uc2a4 \uc804\uccb4\uc5d0 \uac78\uccd0 \ub610 \ub2e4\ub978 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc720\uc9c0 \uad00\ub9ac\ud560 \ucc45\uc784\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>LinkerD, Istio, AWS App Mesh\uc640 \uac19\uc740 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ucf54\ub4dc\ub97c \ucd5c\uc18c\ud55c\uc73c\ub85c \ubcc0\uacbd\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \ubd84\uc0b0 \ucd94\uc801\uc744 \uad6c\ud604\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc9c0\ud45c \uc0dd\uc131, \ub85c\uae45 \ubc0f \ucd94\uc801\uc744 \ud45c\uc900\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>AWS X-Ray, Jaeger\uc640 \uac19\uc740 \ucd94\uc801 \ub3c4\uad6c\ub294 \uacf5\uc720 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc640 \uc11c\ube44\uc2a4 \uba54\uc2dc \uad6c\ud604\uc744 \ubaa8\ub450 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. </p> <p>(\uacf5\uc720 \ub77c\uc774\ube0c\ub7ec\ub9ac \ubc0f \uc11c\ube44\uc2a4 \uba54\uc2dc) \uad6c\ud604\uc744 \ubaa8\ub450 \uc9c0\uc6d0\ud558\ub294 AWS X-Ray \ub610\ub294 Jaeger\uc640 \uac19\uc740 \ucd94\uc801 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud574 \ubcf4\uc2ee\uc2dc\uc624. \uadf8\ub7ec\uba74 \ub098\uc911\uc5d0 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \ucc44\ud0dd\ud560 \ub54c \ub3c4\uad6c\ub97c \uc804\ud658\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub429\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/controlplane/","title":"EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778","text":"<p>Amazon Elastic Kubernetes Service(EKS)\ub294 \uc790\uccb4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub610\ub294 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc124\uce58, \uc6b4\uc601 \ubc0f \uc720\uc9c0 \uad00\ub9ac\ud560 \ud544\uc694 \uc5c6\uc774 AWS\uc5d0\uc11c \uc27d\uac8c \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc2e4\ud589\ud560 \uc218 \uc788\uac8c \ud574\uc8fc\ub294 \uad00\ub9ac\ud615 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4\uc785\ub2c8\ub2e4. \uc5c5\uc2a4\ud2b8\ub9bc \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc2e4\ud589\ud558\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uaddc\uc815 \uc900\uc218 \uc778\uc99d\uc744 \ubc1b\uc558\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uaddc\uc815 \uc900\uc218\ub97c \ud1b5\ud574 EKS\ub294 EC2 \ub610\ub294 \uc628\ud504\ub808\ubbf8\uc2a4\uc5d0 \uc124\uce58\ud560 \uc218 \uc788\ub294 \uc624\ud508 \uc18c\uc2a4 \ucee4\ubba4\ub2c8\ud2f0 \ubc84\uc804\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc5c5\uc2a4\ud2b8\ub9bc \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uae30\uc874 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 Amazon EKS\uc640 \ud638\ud658\ub429\ub2c8\ub2e4.</p> <p>EKS\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub178\ub4dc\uc758 \uac00\uc6a9\uc131\uacfc \ud655\uc7a5\uc131\uc744 \uc790\ub3d9\uc73c\ub85c \uad00\ub9ac\ud558\uace0 \ube44\uc815\uc0c1 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub178\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \ub300\uccb4\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/controlplane/#eks_1","title":"EKS \uc544\ud0a4\ud14d\ucc98","text":"<p>EKS \uc544\ud0a4\ud14d\ucc98\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \uac00\uc6a9\uc131\uacfc \ub0b4\uad6c\uc131\uc744 \uc190\uc0c1\uc2dc\ud0ac \uc218 \uc788\ub294 \ub2e8\uc77c \uc7a5\uc560 \uc9c0\uc810\uc744 \uc81c\uac70\ud558\ub3c4\ub85d \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <p>EKS\ub85c \uad00\ub9ac\ub418\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 EKS \uad00\ub9ac\ud615 VPC \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub429\ub2c8\ub2e4. EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \ub178\ub4dc, \uae30\ud0c0 \ud074\ub7ec\uc2a4\ud130\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. API \uc11c\ubc84, \uc2a4\ucf00\uc904\ub7ec, <code>kube-controller-manager</code>\uc640 \uac19\uc740 \uad6c\uc131 \uc694\uc18c\ub97c \uc2e4\ud589\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \ub178\ub4dc\ub294 \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uc5d0\uc11c \uc2e4\ud589\ub429\ub2c8\ub2e4. EKS\ub294 AWS \ub9ac\uc804 \ub0b4\uc758 \ubcc4\uac1c\uc758 \uac00\uc6a9 \uc601\uc5ed(AZ)\uc5d0\uc11c \ucd5c\uc18c 2\uac1c\uc758 API \uc11c\ubc84 \ub178\ub4dc\ub97c \uc2e4\ud589\ud569\ub2c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c \ub0b4\uad6c\uc131\uc744 \uc704\ud574 etcd \uc11c\ubc84 \ub178\ub4dc\ub3c4 3\uac1c\uc758 AZ\uc5d0 \uac78\uce5c \uc790\ub3d9 \ud06c\uae30 \uc870\uc815 \uadf8\ub8f9\uc5d0\uc11c \uc2e4\ud589\ub429\ub2c8\ub2e4. EKS\ub294 \uac01 AZ\uc5d0\uc11c NAT \uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \uc2e4\ud589\ud558\uace0, API \uc11c\ubc84 \ubc0f etcd \uc11c\ubc84\ub294 \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0\uc11c \uc2e4\ud589\ub429\ub2c8\ub2e4. \uc774 \uc544\ud0a4\ud14d\ucc98\ub294 \ub2e8\uc77c AZ\uc758 \uc774\ubca4\ud2b8\uac00 EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uac00\uc6a9\uc131\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce58\uc9c0 \uc54a\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p> <p>\uc0c8 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uba74 Amazon EKS\ub294 \ud074\ub7ec\uc2a4\ud130\uc640 \ud1b5\uc2e0\ud558\ub294 \ub370 \uc0ac\uc6a9\ud558\ub294 \uad00\ub9ac\ud615 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\ub97c \uc704\ud55c \uace0\uac00\uc6a9\uc131 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4(<code>kubectl</code>\uacfc \uac19\uc740 \ub3c4\uad6c \uc0ac\uc6a9). \uad00\ub9ac\ud615 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub294 NLB\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\uc758 \ubd80\ud558\ub97c \ubd84\uc0b0\ud569\ub2c8\ub2e4. \ub610\ud55c EKS\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc640\uc758 \uc6d0\ud65c\ud55c \ud1b5\uc2e0\uc744 \uc704\ud574 \uc11c\ub85c \ub2e4\ub978 AZ\uc5d0 \ub450 \uac1c\uc758 ENI\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud569\ub2c8\ub2e4.</p> <p></p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 API \uc11c\ubc84\ub294 \ud37c\ube14\ub9ad \uc778\ud130\ub137(\ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc0ac\uc6a9) \ub610\ub294 VPC(EKS \uad00\ub9ac ENI \uc0ac\uc6a9) \ub610\ub294 \ub458 \ub2e4\ub97c \ud1b5\ud574 \uc5f0\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc0ac\uc6a9\uc790\uc640 \uc6cc\ucee4 \ub178\ub4dc\uac00 \ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec API \uc11c\ubc84\uc5d0 \uc5f0\uacb0\ud558\ub4e0 EKS\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 ENI\ub97c \uc0ac\uc6a9\ud558\ub4e0 \uad00\uacc4\uc5c6\uc774 \uc5f0\uacb0\uc744 \uc704\ud55c \uc911\ubcf5 \uacbd\ub85c\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/controlplane/#_1","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/reliability/docs/controlplane/#_2","title":"\ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uba54\ud2b8\ub9ad \ubaa8\ub2c8\ud130\ub9c1","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uba54\ud2b8\ub9ad\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud558\uba74 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uc131\ub2a5\uc5d0 \ub300\ud55c \ud1b5\ucc30\ub825\uc744 \uc5bb\uace0 \ubb38\uc81c\ub97c \uc2dd\ubcc4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ube44\uc815\uc0c1 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc758 \uac00\uc6a9\uc131\uc744 \uc190\uc0c1\uc2dc\ud0ac \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc798\ubabb \uc791\uc131\ub41c \ucee8\ud2b8\ub864\ub7ec\ub294 API \uc11c\ubc84\uc5d0 \uacfc\ubd80\ud558\ub97c \uc77c\uc73c\ucf1c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uac00\uc6a9\uc131\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 <code>/metrics</code> \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0\uc11c \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uba54\ud2b8\ub9ad\uc744 \ub178\ucd9c\ud569\ub2c8\ub2e4.</p> <p><code>kubectl</code>\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ucd9c\ub41c \uba54\ud2b8\ub9ad\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl get --raw /metrics\n</code></pre> <p>\uc774\ub7ec\ud55c \uc9c0\ud45c\ub294 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ud14d\uc2a4\ud2b8 \ud615\uc2dd\uc73c\ub85c \ud45c\uc2dc\ub429\ub2c8\ub2e4.</p> <p>\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\ub7ec\ud55c \uc9c0\ud45c\ub97c \uc218\uc9d1\ud558\uace0 \uc800\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. 2020\ub144 5\uc6d4, CloudWatch\ub294 CloudWatch Container Insights\uc5d0 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \uc9c0\ud45c \ubaa8\ub2c8\ud130\ub9c1\uc5d0 \ub300\ud55c \uc9c0\uc6d0\uc744 \ucd94\uac00\ud588\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c Amazon CloudWatch\ub97c \uc0ac\uc6a9\ud558\uc5ec EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc0c8 Prometheus \uc2a4\ud06c\ub7a9 \ub300\uc0c1 \ucd94\uac00 \uc790\uc2b5\uc11c: \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 KPI \uc11c\ubc84 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc9c0\ud45c\ub97c \uc218\uc9d1\ud558\uace0 CloudWatch \ub300\uc2dc\ubcf4\ub4dc\ub97c \uc0dd\uc131\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc758 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \uba54\ud2b8\ub9ad\uc740 \uc5ec\uae30\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, <code>apiserver_request_duration_seconds</code>\ub294 API \uc694\uccad\uc744 \uc2e4\ud589\ud558\ub294 \ub370 \uac78\ub9ac\ub294 \uc2dc\uac04\uc744 \ub098\ud0c0\ub0bc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c\uacfc \uac19\uc740 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uba54\ud2b8\ub9ad\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud574 \ubcf4\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/reliability/docs/controlplane/#api","title":"API \uc11c\ubc84","text":"\uba54\ud2b8\ub9ad \uc124\uba85 <code>apiserver_request_total</code> \uac01 \uba54\uc18c\ub4dc, \ub4dc\ub77c\uc774 \ub7f0 \uac12, \uadf8\ub8f9, \ubc84\uc804, \ub9ac\uc18c\uc2a4, \ubc94\uc704, \uad6c\uc131 \uc694\uc18c, HTTP \uc751\ub2f5 \ucf54\ub4dc\uc5d0 \ub300\ud574 \uad6c\ubd84\ub41c API \uc11c\ubc84 \uc694\uccad \uce74\uc6b4\ud130\uc785\ub2c8\ub2e4. <code>apiserver_request_duration_seconds*</code> \uac01 \uba54\uc18c\ub4dc, \ub4dc\ub77c\uc774 \ub7f0 \uac12, \uadf8\ub8f9, \ubc84\uc804, \ub9ac\uc18c\uc2a4, \ud558\uc704 \ub9ac\uc18c\uc2a4, \ubc94\uc704, \uad6c\uc131 \uc694\uc18c\uc5d0 \ub300\ud55c \uc751\ub2f5 \uc9c0\uc5f0 \uc2dc\uac04 \ubd84\ud3ec(\ucd08 \ub2e8\uc704) <code>apiserver_admission_controller_admission_duration_seconds</code> admission controller \uc9c0\uc5f0 \uc2dc\uac04 \ud788\uc2a4\ud1a0\uadf8\ub7a8(\ucd08), \uc774\ub984\uc73c\ub85c \uc2dd\ubcc4\ub418\uba70 \uac01 \uc791\uc5c5, API \ub9ac\uc18c\uc2a4 \ubc0f \uc720\ud615\ubcc4\ub85c \uad6c\ubd84\ub428(\uac80\uc99d \ub610\ub294 \uc2b9\uc778). <code>apiserver_admission_webhook_rejection_count</code> admission webhook \uac70\ubd80 \uac74\uc218.\uc774\ub984, \uc791\uc5c5, \uac70\ubd80 \ucf54\ub4dc, \uc720\ud615(\uac80\uc99d \ub610\ub294 \uc2b9\uc778), \uc624\ub958 \uc720\ud615(calling_webhook_error, apiserver_internal_error, no_error) \uc73c\ub85c \uc2dd\ubcc4\ub429\ub2c8\ub2e4. <code>rest_client_request_duration_seconds</code> \uc694\uccad \uc9c0\uc5f0 \uc2dc\uac04(\ucd08)\ub3d9\uc0ac\uc640 URL\ubcc4\ub85c \ubd84\ub958\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. <code>rest_client_requests_total</code> \uc0c1\ud0dc \ucf54\ub4dc, \uba54\uc11c\ub4dc, \ud638\uc2a4\ud2b8\ubcc4\ub85c \ud30c\ud2f0\uc158\uc744 \ub098\ub208 HTTP \uc694\uccad \uc218"},{"location":"ko/reliability/docs/controlplane/#etcd","title":"etcd","text":"\uba54\ud2b8\ub9ad \uc124\uba85 <code>etcd_request_duration_seconds</code> \uac01 \uc791\uc5c5 \ubc0f \uac1d\uccb4 \uc720\ud615\uc5d0 \ub300\ud55c Etcd \uc694\uccad \uc9c0\uc5f0 \uc2dc\uac04(\ucd08) <code>etcd_db_total_size_in_bytes</code> \ub610\ub294 <code>apiserver_storage_db_total_size_in_bytes</code> (EKS v1.26\ubd80\ud130 \uc2dc\uc791) Etcd \ub370\uc774\ud130\ubca0\uc774\uc2a4 \ud06c\uae30 <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubaa8\ub2c8\ud130\ub9c1 \uac1c\uc694 \ub300\uc2dc\ubcf4\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \uc694\uccad\uacfc \uc9c0\uc5f0 \uc2dc\uac04 \ubc0f etcd \uc9c0\uc5f0 \uc2dc\uac04 \uba54\ud2b8\ub9ad\uc744 \uc2dc\uac01\ud654\ud558\uace0 \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624.</p> <p>\ub2e4\uc74c \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec etcd\uc758 \ud604\uc7ac \ud06c\uae30\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ucffc\ub9ac\ub294 API \uba54\ud2b8\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0\uc11c \uba54\ud2b8\ub9ad\uc744 \uc2a4\ud06c\ub7a9\ud558\ub294 <code>kube-apiserver</code>\ub77c\ub294 \uc791\uc5c5\uc774 \uc788\uace0 EKS \ubc84\uc804\uc774 v1.26 \ubbf8\ub9cc\uc778 \uac83\uc73c\ub85c \uac00\uc815\ud569\ub2c8\ub2e4. </p> <pre><code>max(etcd_db_total_size_in_bytes{job=\"kube-apiserver\"} / (8 * 1024 * 1024 * 1024))\n</code></pre>"},{"location":"ko/reliability/docs/controlplane/#_3","title":"\ud074\ub7ec\uc2a4\ud130 \uc778\uc99d","text":"<p>EKS\ub294 \ud604\uc7ac bearer/\uc11c\ube44\uc2a4 \uacc4\uc815 \ud1a0\ud070\uacfc \uc6f9\ud6c4\ud06c \ud1a0\ud070 \uc778\uc99d\uc744 \uc0ac\uc6a9\ud558\ub294 IAM \uc778\uc99d \ub4f1 \ub450 \uac00\uc9c0 \uc720\ud615\uc758 \uc778\uc99d\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc0ac\uc6a9\uc790\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \ud638\ucd9c\ud558\uba74 \uc6f9\ud6c4\ud06c\ub294 \uc694\uccad\uc5d0 \ud3ec\ud568\ub41c \uc778\uc99d \ud1a0\ud070\uc744 IAM\uc5d0 \uc804\ub2ec\ud569\ub2c8\ub2e4. base 64\ub85c \uc11c\uba85\ub41c URL\uc778 \ud1a0\ud070\uc740 AWS \uba85\ub839\uc904 \uc778\ud130\ud398\uc774\uc2a4(AWS CLI)\uc5d0 \uc758\ud574 \uc0dd\uc131\ub429\ub2c8\ub2e4.</p> <p>EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\ub294 IAM \uc0ac\uc6a9\uc790 \ub610\ub294 \uc5ed\ud560\uc740 \uc790\ub3d9\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc804\uccb4 \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \uc5bb\uc2b5\ub2c8\ub2e4. <code>aws-auth</code> configmap\uc744 \ud3b8\uc9d1\ud558\uc5ec EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uad00\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p><code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5\uc744 \uc798\ubabb \uad6c\uc131\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \uc783\uc740 \uacbd\uc6b0\uc5d0\ub3c4 \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\uc790\uc758 \uc0ac\uc6a9\uc790 \ub610\ub294 \uc5ed\ud560\uc744 \uc0ac\uc6a9\ud558\uc5ec EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub4dc\ubb38 \uacbd\uc6b0\uc774\uae34 \ud558\uc9c0\ub9cc AWS \ub9ac\uc804\uc5d0\uc11c IAM \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0\uc5d0\ub3c4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4 \uacc4\uc815\uc758 bearer \ud1a0\ud070\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\ub97c \uad00\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ubaa8\ub4e0 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\ub294 \u201csuper-admin\u201d \uacc4\uc815\uc744 \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624.</p> <pre><code>kubectl -n kube-system create serviceaccount super-admin\n</code></pre> <p>super-admin cluster-admin \uc5ed\ud560\uc744 \ubd80\uc5ec\ud558\ub294 \uc5ed\ud560 \ubc14\uc778\ub529\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4.</p> <pre><code>kubectl create clusterrolebinding super-admin-rb --clusterrole=cluster-admin --serviceaccount=kube-system:super-admin\n</code></pre> <p>\uc11c\ube44\uc2a4 \uacc4\uc815 \uc2dc\ud06c\ub9bf \uac00\uc838\uc624\uae30:</p> <pre><code>secret_name=`kubectl -n kube-system get serviceaccount/super-admin -o jsonpath=' {.secrets [0] .name} '`\n</code></pre> <p>\uc2dc\ud06c\ub9bf\uacfc \uad00\ub828\ub41c \ud1a0\ud070 \uac00\uc838\uc624\uae30:</p> <pre><code>SECRET_NAME=`kubectl -n kube-system get serviceaccount/super-admin -o jsonpath='{.secrets[0].name}'`\n</code></pre> <p>\uc11c\ube44\uc2a4 \uacc4\uc815\uacfc \ud1a0\ud070\uc744 `kubeconfig'\uc5d0 \ucd94\uac00\ud569\ub2c8\ub2e4.</p> <pre><code>TOKEN=`kubectl -n kube-system get secret $SECRET_NAME -o jsonpath='{.data.token}'| base64 --decode`\n</code></pre> <p>super-admin \uacc4\uc815\uc744 \uc0ac\uc6a9\ud558\ub3c4\ub85d <code>kubeconfig</code>\uc5d0\uc11c \ud604\uc7ac \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc124\uc815\ud569\ub2c8\ub2e4.</p> <pre><code>kubectl config set-credentials super-admin --token=$TOKEN\n</code></pre> <p>\ucd5c\uc885 <code>kubeconfig</code>\ub294 \ub2e4\uc74c\uacfc \uac19\uc544\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data:&lt;REDACTED&gt;\n    server: https://&lt;CLUSTER&gt;.gr7.us-west-2.eks.amazonaws.com\n  name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\ncontexts:\n- context:\n    cluster: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\n    user: super-admin\n  name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\ncurrent-context: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\nkind: Config\npreferences: {}\nusers:\n#- name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\n#  user:\n#    exec:\n#      apiVersion: client.authentication.k8s.io/v1alpha1\n#      args:\n#      - --region\n#      - us-west-2\n#      - eks\n#      - get-token\n#      - --cluster-name\n#      - &lt;&lt;cluster name&gt;&gt;\n#      command: aws\n#      env: null\n- name: super-admin\n  user:\n    token: &lt;&lt;super-admin sa\u2019s secret&gt;&gt;\n</code></pre>"},{"location":"ko/reliability/docs/controlplane/#admission-webhooks","title":"Admission Webhooks","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\ub294 admission webhooks \uac80\uc99d \ubc0f \ubcc0\uacbd\uc774\ub77c\ub294 \ub450 \uac00\uc9c0 \uc720\ud615\uc758 admission webhooks\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uc0ac\uc6a9\uc790\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \ud655\uc7a5\ud558\uace0 API\uc5d0\uc11c \uac1d\uccb4\ub97c \uc2b9\uc778\ud558\uae30 \uc804\uc5d0 \uac1d\uccb4\ub97c \uac80\uc99d\ud558\uac70\ub098 \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc6f9\ud6c4\ud06c\ub97c \uc798\ubabb \uad6c\uc131\ud558\uba74 \ud074\ub7ec\uc2a4\ud130\uc758 \uc911\uc694\ud55c \uc791\uc5c5\uc774 \ucc28\ub2e8\ub418\uc5b4 EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc774 \ubd88\uc548\uc815\ud574\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud074\ub7ec\uc2a4\ud130 \ud06c\ub9ac\ud2f0\uceec \uc791\uc5c5\uc5d0 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uc73c\ub824\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \u201ccatch-all\u201d \uc6f9\ud6c5\uc744 \uc124\uc815\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624.</p> <pre><code>- name: \"pod-policy.example.com\"\n  rules:\n  - apiGroups:   [\"*\"]\n    apiVersions: [\"*\"]\n    operations:  [\"*\"]\n    resources:   [\"*\"]\n    scope: \"*\"\n</code></pre> <p>\ub610\ub294 \uc6f9\ud6c4\ud06c\uc5d0 30\ucd08 \ubbf8\ub9cc\uc758 \uc81c\ud55c \uc2dc\uac04\uc744 \uac00\uc9c4 Fail Open \uc815\ucc45\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uc5ec \uc6f9\ud6c4\ud06c\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0 \ud074\ub7ec\uc2a4\ud130\uc758 \uc911\uc694\ud55c \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\ub3c4\ub85d \ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/reliability/docs/controlplane/#sysctls","title":"\uc548\uc804\ud558\uc9c0 \uc54a\uc740 <code>sysctls</code>\uac00 \uc788\ub294 \ud30c\ub4dc\ub97c \ucc28\ub2e8\ud55c\ub2e4.","text":"<p><code>Sysctl</code>\uc740 \uc0ac\uc6a9\uc790\uac00 \ub7f0\ud0c0\uc784 \uc911\uc5d0 \ucee4\ub110 \ud30c\ub77c\ubbf8\ud130\ub97c \uc218\uc815\ud560 \uc218 \uc788\ub294 \ub9ac\ub205\uc2a4 \uc720\ud2f8\ub9ac\ud2f0\uc785\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ucee4\ub110 \ub9e4\uac1c\ubcc0\uc218\ub294 \ub124\ud2b8\uc6cc\ud06c, \ud30c\uc77c \uc2dc\uc2a4\ud15c, \uac00\uc0c1 \uba54\ubaa8\ub9ac, \ud504\ub85c\uc138\uc2a4 \uad00\ub9ac \ub4f1 \uc6b4\uc601 \uccb4\uc81c \ub3d9\uc791\uc758 \ub2e4\uc591\ud55c \uce21\uba74\uc744 \uc81c\uc5b4\ud569\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc0ac\uc6a9\ud558\uba74 \ud30c\ub4dc\uc5d0 <code>sysctl</code> \ud504\ub85c\ud544\uc744 \ud560\ub2f9\ud560 \uc218 \uc788\ub2e4.\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 <code>systcls</code>\ub97c \uc548\uc804\ud55c \uac83\uacfc \uc548\uc804\ud558\uc9c0 \uc54a\uc740 \uac83\uc73c\ub85c \ubd84\ub958\ud569\ub2c8\ub2e4. \uc548\uc804\ud55c <code>sysctls</code>\ub294 \ucee8\ud14c\uc774\ub108 \ub610\ub294 \ud30c\ub4dc\uc5d0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uac00 \uc9c0\uc815\ub418\uba70, \uc774\ub97c \uc124\uc815\ud574\ub3c4 \ub178\ub4dc\uc758 \ub2e4\ub978 \ud30c\ub4dc\ub098 \ub178\ub4dc \uc790\uccb4\uc5d0\ub294 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ubc18\ub300\ub85c \uc548\uc804\ud558\uc9c0 \uc54a\uc740 sysctl\uc740 \ub2e4\ub978 \ud30c\ub4dc\ub97c \ubc29\ud574\ud558\uac70\ub098 \ub178\ub4dc\ub97c \ubd88\uc548\uc815\ud558\uac8c \ub9cc\ub4e4 \uc218 \uc788\uc73c\ubbc0\ub85c \uae30\ubcf8\uc801\uc73c\ub85c \ube44\ud65c\uc131\ud654\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc548\uc804\ud558\uc9c0 \uc54a\uc740 <code>sysctls</code>\uac00 \uae30\ubcf8\uc801\uc73c\ub85c \ube44\ud65c\uc131\ud654\ub418\ubbc0\ub85c, kubelet\uc740 \uc548\uc804\ud558\uc9c0 \uc54a\uc740 <code>sysctl</code> \ud504\ub85c\ud544\uc744 \uac00\uc9c4 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\uba74, \uc2a4\ucf00\uc904\ub7ec\ub294 \ud574\ub2f9 \ud30c\ub4dc\ub97c \ub178\ub4dc\uc5d0 \ubc18\ubcf5\uc801\uc73c\ub85c \ud560\ub2f9\ud558\uc9c0\ub9cc \ub178\ub4dc\ub294 \uc2e4\ud589\uc5d0 \uc2e4\ud328\ud569\ub2c8\ub2e4. \uc774 \ubb34\ud55c \ub8e8\ud504\ub294 \uad81\uadf9\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \ubd80\ub2f4\uc744 \uc8fc\uc5b4 \ud074\ub7ec\uc2a4\ud130\ub97c \ubd88\uc548\uc815\ud558\uac8c \ub9cc\ub4ed\ub2c8\ub2e4.</p> <p>\uc548\uc804\ud558\uc9c0 \uc54a\uc740 <code>sysctls</code>\uac00 \uc788\ub294 \ud30c\ub4dc\ub97c \uac70\ubd80\ud558\ub824\uba74 OPA \uac8c\uc774\ud2b8\ud0a4\ud37c \ub610\ub294 Kyverno\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/reliability/docs/controlplane/#_4","title":"\ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc \ucc98\ub9ac","text":"<p>2021\ub144 4\uc6d4\ubd80\ud130 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9b4\ub9ac\uc2a4 \uc8fc\uae30\uac00 \uc5f0\uac04 4\uac1c \ub9b4\ub9ac\uc2a4(\ubd84\uae30\uc5d0 \ud55c \ubc88)\uc5d0\uc11c \uc5f0\uac04 \uc138 \ubc88\uc758 \ub9b4\ub9ac\uc2a4\ub85c \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc0c8 \ub9c8\uc774\ub108 \ubc84\uc804(\uc608: 1.21 \ub610\ub294 1.22) \uc740 \ub300\ub7b5 15\uc8fc\ub9c8\ub2e4 \ub9b4\ub9ac\uc2a4\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 1.19\ubd80\ud130 \uac01 \ub9c8\uc774\ub108 \ubc84\uc804\uc740 \ucc98\uc74c \ub9b4\ub9ac\uc2a4\ub41c \ud6c4 \uc57d 12\uac1c\uc6d4 \ub3d9\uc548 \uc9c0\uc6d0\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ucd5c\uc18c \ub450 \uac1c\uc758 \ub9c8\uc774\ub108 \ubc84\uc804\uc5d0 \ub300\ud574 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \uc6cc\ucee4 \ub178\ub4dc \uac04\uc758 \ud638\ud658\uc131\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee4\ubba4\ub2c8\ud2f0\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804 \uc9c0\uc6d0\uc5d0 \ub530\ub77c EKS\ub294 \uc5b8\uc81c\ub4e0\uc9c0 \ucd5c\uc18c 3\uac1c\uc758 \ud504\ub85c\ub355\uc158 \ubc84\uc804\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc81c\uacf5\ud558\uba70, \ub124 \ubc88\uc9f8 \ubc84\uc804\uc740 \uc9c0\uc6d0 \uc911\ub2e8\ub420 \uc608\uc815\uc785\ub2c8\ub2e4.</p> <p>EKS\ub294 \uc9c0\uc6d0 \uc885\ub8cc\uc77c \ucd5c\uc18c 60\uc77c \uc804\uc5d0 \ud574\ub2f9 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9c8\uc774\ub108 \ubc84\uc804\uc758 \uc9c0\uc6d0 \uc911\ub2e8\uc744 \ubc1c\ud45c\ud569\ub2c8\ub2e4. \uc9c0\uc6d0 \uc885\ub8cc\uc77c\uc774 \ub418\uba74 \uc9c0\uc6d0 \uc911\ub2e8\ub41c \ubc84\uc804\uc744 \uc2e4\ud589\ud558\ub294 \ud074\ub7ec\uc2a4\ud130\ub294 EKS\uac00 \uc9c0\uc6d0\ud558\ub294 \ub2e4\uc74c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uc73c\ub85c \uc790\ub3d9 \uc5c5\ub370\uc774\ud2b8\ub418\uae30 \uc2dc\uc791\ud569\ub2c8\ub2e4.</p> <p>EKS\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 EKS \ud50c\ub7ab\ud3fc \ubc84\uc804 \ubaa8\ub450\uc5d0 \ub300\ud574 in-place \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc218\ud589\ud569\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130 \uc6b4\uc601\uc774 \ub2e8\uc21c\ud654\ub418\uace0 \ub2e4\uc6b4\ud0c0\uc784 \uc5c6\uc774 \ucd5c\uc2e0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ub2a5\uc744 \ud65c\uc6a9\ud558\uace0 \ubcf4\uc548 \ud328\uce58\ub97c \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc0c8 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uc5d0\ub294 \uc911\uc694\ud55c \ubcc0\uacbd \uc0ac\ud56d\uc774 \uc801\uc6a9\ub418\uba70 \uc5c5\uadf8\ub808\uc774\ub4dc \ud6c4\uc5d0\ub294 \ud074\ub7ec\uc2a4\ud130\ub97c \ub2e4\uc6b4\uadf8\ub808\uc774\ub4dc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ucd5c\uc2e0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uc73c\ub85c \uc6d0\ud65c\ud558\uac8c \uc804\ud658\ud558\ub824\uba74 \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc \ucc98\ub9ac\ub97c \uc704\ud55c \ud504\ub85c\uc138\uc2a4\ub97c \uc798 \ubb38\uc11c\ud654\ud574\uc57c \ud569\ub2c8\ub2e4. \ucd5c\uc2e0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uc73c\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc\ud560 \ub54c in-place \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc218\ud589\ud558\ub294 \ub300\uc2e0 \uc0c8 \ud074\ub7ec\uc2a4\ud130\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\ub294 \uac83\uc744 \uace0\ub824\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. VMware\uc758 Velero\uc640 \uac19\uc740 \ud074\ub7ec\uc2a4\ud130 \ubc31\uc5c5 \ubc0f \ubcf5\uc6d0 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 \uc0c8 \ud074\ub7ec\uc2a4\ud130\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\ub294\ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uc0c8 \ubc84\uc804\uc5d0\uc11c\ub294 \uae30\uc874 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc190\uc0c1\uc2dc\ud0ac \uc218 \uc788\ub294 API\uc640 \uae30\ub2a5\uc744 \ub354 \uc774\uc0c1 \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc9c0\uc6d0 \uc911\ub2e8 \uc815\ucc45\uc744 \uc219\uc9c0\ud574\uc57c \ud569\ub2c8\ub2e4.</li> <li>\ud074\ub7ec\uc2a4\ud130\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\uae30 \uc804\uc5d0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubcc0\uacbd \ub85c\uadf8 \ubc0f Amazon EKS \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uc744 \uac80\ud1a0\ud558\uc5ec \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ubbf8\uce58\ub294 \ubd80\uc815\uc801\uc778 \uc601\ud5a5\uc744 \ud30c\uc545\ud574\uc57c \ud569\ub2c8\ub2e4.</li> <li>\ube44\ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0\uc11c \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \ud14c\uc2a4\ud2b8\ud558\uace0 \ud604\uc7ac \uc6cc\ud06c\ub85c\ub4dc \ubc0f \ucee8\ud2b8\ub864\ub7ec\uc5d0 \ubbf8\uce58\ub294 \uc601\ud5a5\uc744 \ud30c\uc545\ud574 \ubcf4\uc2ed\uc2dc\uc624. \uc0c8 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uc73c\ub85c \uc774\ub3d9\ud558\uae30 \uc804\uc5d0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158, \ucee8\ud2b8\ub864\ub7ec \ubc0f \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ud1b5\ud569\uc758 \ud638\ud658\uc131\uc744 \ud14c\uc2a4\ud2b8\ud558\ub294 \uc9c0\uc18d\uc801 \ud1b5\ud569 \uc6cc\ud06c\ud50c\ub85c\ub97c \uad6c\ucd95\ud558\uc5ec \ud14c\uc2a4\ud2b8\ub97c \uc790\ub3d9\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\ud074\ub7ec\uc2a4\ud130\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc\ud55c \ud6c4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc560\ub4dc\uc628\uc744 \uc5c5\uadf8\ub808\uc774\ub4dc\ud574\uc57c \ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. Amazon EKS \ud074\ub7ec\uc2a4\ud130 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804 \uc5c5\ub370\uc774\ud2b8\ub97c \uac80\ud1a0\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \uc560\ub4dc\uc628\uacfc \ud074\ub7ec\uc2a4\ud130 \ubc84\uc804\uc758 \ud638\ud658\uc131\uc744 \uac80\uc99d\ud558\uc2ed\uc2dc\uc624.</li> <li>\ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uae45\uc744 \ucf1c\uace0 \ub85c\uadf8\uc5d0\uc11c \uc624\ub958\uac00 \uc788\ub294\uc9c0 \uac80\ud1a0\ud574 \ubcf4\uc2ed\uc2dc\uc624.</li> <li>EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uad00\ub9ac\ud560 \ub54c\ub294 <code>eksctl</code>\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. <code>eksctl</code>\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud2b8\ub864 \ud50c\ub808\uc778, \uc560\ub4dc\uc628, \uc6cc\ucee4 \ub178\ub4dc \uc5c5\ub370\uc774\ud2b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uc5c5\uadf8\ub808\uc774\ub4dc\uc5d0\ub294 \uc6cc\ucee4 \ub178\ub4dc \uc5c5\uadf8\ub808\uc774\ub4dc\uac00 \ud3ec\ud568\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. EKS \uc6cc\ucee4 \ub178\ub4dc \uc5c5\ub370\uc774\ud2b8\ub294 \uc0ac\uc6a9\uc790\uc758 \ucc45\uc784\uc785\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc \uc5c5\uadf8\ub808\uc774\ub4dc \ud504\ub85c\uc138\uc2a4\ub97c \uc790\ub3d9\ud654\ud558\ub824\uba74 EKS \uad00\ub9ac \ub178\ub4dc \uadf8\ub8f9 \ub610\ub294 EKS on Fargate\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624.</li> <li>\ud544\uc694\ud55c \uacbd\uc6b0 <code>kubectl convert</code> \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9e4\ub2c8\ud398\uc2a4\ud2b8 \ud30c\uc77c\uc744 \ub2e4\ub978 API \ubc84\uc804 \uac04\uc5d0 \ubcc0\ud658\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4 </li> </ul>"},{"location":"ko/reliability/docs/controlplane/#_5","title":"\ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130 \uc2e4\ud589","text":"<p>EKS\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uc778\uc2a4\ud134\uc2a4\uc758 \ubd80\ud558\ub97c \ub2a5\ub3d9\uc801\uc73c\ub85c \ubaa8\ub2c8\ud130\ub9c1\ud558\uace0 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ud558\uc5ec \uace0\uc131\ub2a5\uc744 \ubcf4\uc7a5\ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\ub97c \uc2e4\ud589\ud560 \ub54c\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc0f AWS \uc11c\ube44\uc2a4\uc758 \ud560\ub2f9\ub7c9 \ub0b4\uc5d0\uc11c \ubc1c\uc0dd\ud560 \uc218 \uc788\ub294 \uc131\ub2a5 \ubb38\uc81c\uc640 \ud55c\uacc4\ub97c \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <ul> <li>ProjectCalico \ud300\uc5d0\uc11c \uc218\ud589\ud55c \ud14c\uc2a4\ud2b8\uc5d0 \ub530\ub974\uba74, \uc11c\ube44\uc2a4\uac00 1000\uac1c \uc774\uc0c1\uc778 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c <code>iptables</code> \ubaa8\ub4dc\uc5d0\uc11c <code>kube-proxy</code>\ub97c \uc0ac\uc6a9\ud560 \uacbd\uc6b0 \ub124\ud2b8\uc6cc\ud06c \uc9c0\uc5f0\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud574\uacb0 \ubc29\ubc95\uc740 <code>ipvs</code> \ubaa8\ub4dc\uc5d0\uc11c <code>kube-proxy</code>\ub85c \uc2e4\ud589\uc73c\ub85c \uc804\ud658\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. </li> <li>CNI\uc5d0\uc11c \ud30c\ub4dc\uc758 IP \uc8fc\uc18c\ub97c \uc694\uccad\ud574\uc57c \ud558\uac70\ub098 \uc0c8 EC2 \uc778\uc2a4\ud134\uc2a4\ub97c \uc790\uc8fc \uc0dd\uc131\ud574\uc57c \ud558\ub294 \uacbd\uc6b0\uc5d0\ub3c4 EC2 API \uc694\uccad \uc81c\ud55c\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. IP \uc8fc\uc18c\ub97c \uce90\uc2f1\ud558\ub3c4\ub85d CNI\ub97c \uad6c\uc131\ud558\uba74 EC2 API \ud638\ucd9c\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub354 \ud070 EC2 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc0ac\uc6a9\ud558\uc5ec EC2 \uc870\uc815 \uc774\ubca4\ud2b8\ub97c \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/reliability/docs/controlplane/#_6","title":"\ud55c\ub3c4 \ubc0f \uc11c\ube44\uc2a4 \ud560\ub2f9\ub7c9 \uc54c\uc544\ubcf4\uae30","text":"<p>AWS\ub294 \uc2e4\uc218\ub85c \ub9ac\uc18c\uc2a4\ub97c \uacfc\ub3c4\ud558\uac8c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud574 \uc11c\ube44\uc2a4 \ud55c\ub3c4(\ud300\uc774 \uc694\uccad\ud560 \uc218 \uc788\ub294 \uac01 \ub9ac\uc18c\uc2a4 \uc218\uc758 \uc0c1\ud55c\uc120)\ub97c \uc124\uc815\ud569\ub2c8\ub2e4. Amazon EKS \uc11c\ube44\uc2a4 \ud560\ub2f9\ub7c9\uc5d0\ub294 \uc11c\ube44\uc2a4 \ud55c\ub3c4\uac00 \ub098\uc640 \uc788\uc2b5\ub2c8\ub2e4. AWS \uc11c\ube44\uc2a4 \ud560\ub2f9\ub7c9\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubcc0\uacbd\ud560 \uc218 \uc788\ub294 \ub450 \uac00\uc9c0 \uc720\ud615\uc758 \ud55c\ub3c4, Soft limit\uac00 \uc788\uc2b5\ub2c8\ub2e4. Hard limit\ub294 \ubcc0\uacbd\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc124\uacc4\ud560 \ub54c\ub294 \uc774\ub7ec\ud55c \uac12\uc744 \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc11c\ube44\uc2a4 \uc81c\ud55c\uc744 \uc815\uae30\uc801\uc73c\ub85c \uac80\ud1a0\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc124\uacc4 \uc911\uc5d0 \ud1b5\ud569\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uc624\ucf00\uc2a4\ud2b8\ub808\uc774\uc158 \uc5d4\uc9c4\uc758 \uc81c\ud55c \uc678\uc5d0\ub3c4 ELB(Elastic Load Balancing) \ubc0f Amazon VPC\uc640 \uac19\uc740 \ub2e4\ub978 AWS \uc11c\ube44\uc2a4\uc5d0\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc131\ub2a5\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub294 \uc81c\ud55c\uc774 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>EC2 \ud55c\ub3c4\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 EC2 \uc11c\ube44\uc2a4 \uc81c\ud55c\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</li> <li>\uac01 EC2 \uc778\uc2a4\ud134\uc2a4\ub294 Amazon \uc81c\uacf5 DNS \uc11c\ubc84\ub85c \uc804\uc1a1\ud560 \uc218 \uc788\ub294 \ud328\ud0b7 \uc218\ub97c \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub2f9 \ucd08\ub2f9 \ucd5c\ub300 1024 \ud328\ud0b7\uc73c\ub85c \uc81c\ud55c\ud569\ub2c8\ub2e4.</li> <li>EKS \ud658\uacbd\uc5d0\uc11c etcd \uc2a4\ud1a0\ub9ac\uc9c0 \ud55c\ub3c4\ub294 \uc5c5\uc2a4\ud2b8\ub9bc \uc9c0\uce68\uc5d0 \ub530\ub77c 8GB\uc785\ub2c8\ub2e4. etcd db \ud06c\uae30\ub97c \ucd94\uc801\ud558\ub824\uba74 <code>etcd_db_total_size_in_bytes</code> \uc9c0\ud45c\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\uc2ed\uc2dc\uc624. \uc774 \ubaa8\ub2c8\ud130\ub9c1\uc744 \uc124\uc815\ud558\ub824\uba74 \uacbd\uace0 \uaddc\uce59 <code>etcdBackendQuotaLowSpace</code> \ubc0f <code>etcdExcessiveDatabaseGrowth</code>\ub97c \ucc38\uc870\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/reliability/docs/controlplane/#_7","title":"\ucd94\uac00 \ub9ac\uc18c\uc2a4:","text":"<ul> <li>Amazon EKS \uc6cc\ucee4 \ub178\ub4dc\uc758 \ud074\ub7ec\uc2a4\ud130 \ub124\ud2b8\uc6cc\ud0b9\uc5d0 \ub300\ud55c \uc774\ud574\ud558\uae30 \uc26c\uc6b4 \uc124\uba85</li> <li>\uc544\ub9c8\uc874 EKS \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc561\uc138\uc2a4 \uc81c\uc5b4</li> <li>AWS re:Invent 2019: \uc544\ub9c8\uc874 EKS \uc5b8\ub354 \ub354 \ud6c4\ub4dc (CON421-R1)</li> </ul>"},{"location":"ko/reliability/docs/dataplane/","title":"EKS \ub370\uc774\ud130 \ud50c\ub808\uc778","text":"<p>\uac00\uc6a9\uc131\uacfc \ubcf5\uc6d0\ub825\uc774 \ub6f0\uc5b4\ub09c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc6b4\uc601\ud558\ub824\uba74 \uac00\uc6a9\uc131\uacfc \ubcf5\uc6d0\ub825\uc774 \ub6f0\uc5b4\ub09c \ub370\uc774\ud130 \ud50c\ub808\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ud0c4\ub825\uc801\uc778 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc744 \uc0ac\uc6a9\ud558\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ud558\uace0 \ubcf5\uad6c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcf5\uc6d0\ub825\uc774 \ub6f0\uc5b4\ub09c \ub370\uc774\ud130 \ud50c\ub808\uc778\uc740 2\uac1c \uc774\uc0c1\uc758 \uc6cc\ucee4 \ub178\ub4dc\ub85c \uad6c\uc131\ub418\uba70, \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub530\ub77c \ud655\uc7a5 \ubc0f \ucd95\uc18c\ub420 \uc218 \uc788\uc73c\uba70 \uc7a5\uc560 \ubc1c\uc0dd \uc2dc \uc790\ub3d9\uc73c\ub85c \ubcf5\uad6c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>EKS\ub97c \uc0ac\uc6a9\ud558\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0\ub294 EC2 \uc778\uc2a4\ud134\uc2a4\uc640 [Fargate] (https://docs.aws.amazon.com/eks/latest/userguide/fargate.html)\ub77c\ub294 \ub450 \uac00\uc9c0 \uc635\uc158\uc774 \uc788\uc2b5\ub2c8\ub2e4. EC2 \uc778\uc2a4\ud134\uc2a4\ub97c \uc120\ud0dd\ud558\uba74 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc9c1\uc811 \uad00\ub9ac\ud558\uac70\ub098 EKS \uad00\ub9ac \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\ud615 \uc6cc\ucee4 \ub178\ub4dc\uc640 \uc790\uccb4 \uad00\ub9ac\ud615 \uc6cc\ucee4 \ub178\ub4dc\uc640 Fargate\uac00 \ud63c\ud569\ub41c \ud074\ub7ec\uc2a4\ud130\ub97c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>Fargate\uc758 EKS\ub294 \ubcf5\uc6d0\ub825\uc774 \ub6f0\uc5b4\ub09c \ub370\uc774\ud130 \ud50c\ub808\uc778\uc744 \uc704\ud55c \uac00\uc7a5 \uc26c\uc6b4 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. Fargate\ub294 \uaca9\ub9ac\ub41c \ucef4\ud4e8\ud305 \ud658\uacbd\uc5d0\uc11c \uac01 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud569\ub2c8\ub2e4. Fargate\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uac01 \ud30c\ub4dc\uc5d0\ub294 \uc790\uccb4 \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \ud30c\ub4dc\ub97c \ud655\uc7a5\ud568\uc5d0 \ub530\ub77c Fargate\ub294 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc744 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ud569\ub2c8\ub2e4. horizontal pod autoscaler\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub370\uc774\ud130 \ud50c\ub808\uc778\uacfc \uc6cc\ud06c\ub85c\ub4dc\ub97c \ubaa8\ub450 \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>EC2 \uc6cc\ucee4 \ub178\ub4dc\ub97c \ud655\uc7a5\ud558\ub294 \ub370 \uc120\ud638\ub418\ub294 \ubc29\ubc95\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler, EC2 Auto Scaling \uadf8\ub8f9 \ub610\ub294 Atlassian's Esclator\uc640 \uac19\uc740 \ucee4\ubba4\ub2c8\ud2f0 \ud504\ub85c\uc81d\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#_1","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/reliability/docs/dataplane/#ec2","title":"EC2 \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc6cc\ucee4 \ub178\ub4dc \uc0dd\uc131","text":"<p>\uac1c\ubcc4 EC2 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc870\uc778\ud558\ub294 \ub300\uc2e0 EC2 \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc0dd\uc131\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4. \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uc740 \uc885\ub8cc\ub418\uac70\ub098 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud55c \ub178\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \uad50\uccb4\ud558\ubbc0\ub85c \ud074\ub7ec\uc2a4\ud130\uac00 \ud56d\uc0c1 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uc6a9\ub7c9\uc744 \ud655\ubcf4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/dataplane/#cluster-autoscaler","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\ub97c \ud655\uc7a5\ud558\uc138\uc694","text":"<p>Cluster Autoscaler\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \ub9ac\uc18c\uc2a4\uac00 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc544 \uc2e4\ud589\ud560 \uc218 \uc5c6\ub294 \ud30c\ub4dc\uac00 \uc788\uc744 \ub54c \ub370\uc774\ud130 \ud50c\ub808\uc778 \ud06c\uae30\ub97c \uc870\uc815\ud558\uba70, \ub2e4\ub978 \uc6cc\ucee4 \ub178\ub4dc\ub97c \ucd94\uac00\ud558\uc5ec \ub3c4\uc6c0\uc744 \uc90d\ub2c8\ub2e4. Cluster Autoscaler\ub294 \ubc18\uc751\ud615 \ud504\ub85c\uc138\uc2a4\uc774\uae34 \ud558\uc9c0\ub9cc \ud074\ub7ec\uc2a4\ud130\uc758 \uc6a9\ub7c9\uc774 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc544 \ud30c\ub4dc\uac00 pending \uc0c1\ud0dc\uac00 \ub420 \ub54c\uae4c\uc9c0 \uae30\ub2e4\ub9bd\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc774\ubca4\ud2b8\uac00 \ubc1c\uc0dd\ud558\uba74 \ud074\ub7ec\uc2a4\ud130\uc5d0 EC2 \uc778\uc2a4\ud134\uc2a4\uac00 \ucd94\uac00\ub429\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc758 \uc6a9\ub7c9\uc774 \ubd80\uc871\ud574\uc9c0\uba74 \uc6cc\ucee4 \ub178\ub4dc\uac00 \ucd94\uac00\ub420 \ub54c\uae4c\uc9c0 \uc0c8 \ubcf5\uc81c\ubcf8 \ub610\ub294 \uc0c8 \ud30c\ub4dc\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uac8c \ub429\ub2c8\ub2e4(Pending \uc0c1\ud0dc). \ub370\uc774\ud130 \ud50c\ub808\uc778\uc774 \uc6cc\ud06c\ub85c\ub4dc \uc218\uc694\ub97c \ucda9\uc871\ud560 \ub9cc\ud07c \ucda9\ubd84\ud788 \ube60\ub974\uac8c \ud655\uc7a5\ub418\uc9c0 \uc54a\ub294 \uacbd\uc6b0 \uc774\ub7ec\ud55c \uc9c0\uc5f0\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc2e0\ub8b0\uc131\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc\uc758 \uc0ac\uc6a9\ub960\uc774 \uc9c0\uc18d\uc801\uc73c\ub85c \ub0ae\uace0 \ud574\ub2f9 \ub178\ub4dc\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \ub2e4\ub978 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc788\ub294 \uacbd\uc6b0 Cluster Autoscaler\ub294 \ud574\ub2f9 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc885\ub8cc\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#cluster-autoscaler_1","title":"Cluster Autoscaler\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc624\ubc84 \ud504\ub85c\ube44\uc800\ub2dd\uc744 \uad6c\uc131\ud569\ub2c8\ub2e4.","text":"<p>Cluster Autoscaler\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \ud30c\ub4dc\uac00 \uc774\ubbf8 pending \uc0c1\ud0dc\uc77c \ub54c \ub370\uc774\ud130 \ud50c\ub808\uc778 \uc2a4\ucf00\uc77c\ub9c1\uc744 \ud2b8\ub9ac\uac70\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ub354 \ub9ce\uc740 \ubcf5\uc81c\ubcf8\uc774 \ud544\uc694\ud55c \uc2dc\uc810\uacfc \uc2e4\uc81c\ub85c \ub354 \ub9ce\uc740 \ubcf5\uc81c\ubcf8\uc744 \uac00\uc838\uc624\ub294 \uc2dc\uc810 \uc0ac\uc774\uc5d0 \uc9c0\uc5f0\uc774 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc9c0\uc5f0\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc740 \ud544\uc694\ud55c \uac83\ubcf4\ub2e4 \ub9ce\uc740 \ubcf5\uc81c\ubcf8\uc744 \ucd94\uac00\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ubcf5\uc81c\ubcf8 \uc218\ub97c \ub298\ub9ac\ub294 \uac83\uc785\ub2c8\ub2e4. </p> <p>Cluster Autoscaler\uc5d0\uc11c \uad8c\uc7a5\ud558\ub294 \ub610 \ub2e4\ub978 \ud328\ud134\uc740 pause \ud30c\ub4dc\uc640 \uc6b0\uc120\uc21c\uc704 \uc120\uc810 \uae30\ub2a5\uc785\ub2c8\ub2e4. pause \ud30c\ub4dc\ub294 pause \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud558\ub294\ub370, \uc774\ub984\uc5d0\uc11c \uc54c \uc218 \uc788\ub4ef\uc774 \ud074\ub7ec\uc2a4\ud130\uc758 \ub2e4\ub978 \ud30c\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ucef4\ud4e8\ud305 \uc6a9\ub7c9\uc758 placeholder \uc5ed\ud560\uc744 \ud558\ub294 \uac83 \uc678\uc5d0\ub294 \uc544\ubb34\uac83\ub3c4 \ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub9e4\uc6b0 \ub0ae\uc740 \ud560\ub2f9 \uc6b0\uc120 \uc21c\uc704\ub85c \uc2e4\ud589\ub418\uae30 \ub54c\ubb38\uc5d0, \ub2e4\ub978 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud574\uc57c \ud558\uace0 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uac00\uc6a9 \uc6a9\ub7c9\uc774 \uc5c6\uc744 \ub54c \uc77c\uc2dc \uc911\uc9c0 \ud30c\ub4dc\uac00 \ub178\ub4dc\uc5d0\uc11c \uc81c\uac70\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\ub294 pause \ud30c\ub4dc\uc758 \ucd95\ucd9c\uc744 \uac10\uc9c0\ud558\uace0 \uc2a4\ucf00\uc904\uc744 \ub2e4\uc2dc \uc7a1\uc73c\ub824\uace0 \ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ud074\ub7ec\uc2a4\ud130\uac00 \ucd5c\ub300 \uc6a9\ub7c9\uc73c\ub85c \uc2e4\ud589\ub418\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc77c\uc2dc \uc911\uc9c0 \ud30c\ub4dc\ub294 pending \uc0c1\ud0dc\ub85c \uc720\uc9c0\ub418\uba70, Cluster Autoscaler\ub294 \uc774\uc5d0 \ub300\uc751\ud558\uc5ec \ub178\ub4dc\ub97c \ucd94\uac00\ud569\ub2c8\ub2e4. </p> <p>Helm \ucc28\ud2b8\ub97c \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130 \uc624\ubc84\ud504\ub85c\ube44\uc800\ub108\ub97c \uc124\uce58\ud560 \uc218 \uc788\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#cluster-autoscaler_2","title":"\uc5ec\ub7ec \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uacfc \ud568\uaed8 Cluster Autoscaler \uc0ac\uc6a9","text":"<p><code>--node-group-auto-discovery</code> \ud50c\ub798\uadf8\ub97c \ud65c\uc131\ud654\ud55c \uc0c1\ud0dc\ub85c Cluster Autoscaler\ub97c \uc2e4\ud589\ud569\ub2c8\ub2e4.\uc774\ub807\uac8c \ud558\uba74 Cluster Autoscaler\uac00 \uc815\uc758\ub41c \ud2b9\uc815 \ud0dc\uadf8\uac00 \ud3ec\ud568\ub41c \ubaa8\ub4e0 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uc744 \ucc3e\uc744 \uc218 \uc788\uc73c\ubbc0\ub85c \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0\uc11c \uac01 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uc744 \uc815\uc758\ud558\uace0 \uc720\uc9c0\ud560 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#cluster-autoscaler_3","title":"\ub85c\uceec \uc2a4\ud1a0\ub9ac\uc9c0\uc640 \ud568\uaed8 Cluster Autoscaler \uc0ac\uc6a9","text":"<p>\uae30\ubcf8\uc801\uc73c\ub85c Cluster Autoscaler\ub294 \ub85c\uceec \uc2a4\ud1a0\ub9ac\uc9c0\uac00 \uc5f0\uacb0\ub41c \uc0c1\ud0dc\ub85c \ubc30\ud3ec\ub41c \ud30c\ub4dc\uac00 \uc788\ub294 \ub178\ub4dc\ub97c \ucd95\uc18c\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. <code>--skip-nodes-with-local-storage</code> \ud50c\ub798\uadf8\ub97c false\ub85c \uc124\uc815\ud558\uba74 Cluster Autoscaler\uac00 \uc774\ub7ec\ud55c \ub178\ub4dc\ub97c \ucd95\uc18c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#az","title":"\uc6cc\ucee4 \ub178\ub4dc\uc640 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc5ec\ub7ec AZ\uc5d0 \ubd84\uc0b0\ud569\ub2c8\ub2e4.","text":"<p>\uc5ec\ub7ec AZ\uc5d0\uc11c \uc6cc\ucee4 \ub178\ub4dc\uc640 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\uc5ec \uac1c\ubcc4 AZ\uc5d0\uc11c \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub3c4\ub85d \uc6cc\ud06c\ub85c\ub4dc\ub97c \ubcf4\ud638\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc\ub97c \uc0dd\uc131\ud558\ub294 \uc11c\ube0c\ub137\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc0dd\uc131\ub418\ub294 AZ\ub97c \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 1.18+\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 AZ\uc5d0 \ud30c\ub4dc\ub97c \ubd84\uc0b0\ud558\ub294 \ub370 \uad8c\uc7a5\ub418\ub294 \ubc29\ubc95\uc740 \ud30c\ub4dc\uc5d0 \ub300\ud55c \ud1a0\ud3f4\ub85c\uc9c0 \ubd84\uc0b0 \uc81c\uc57d\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p> <p>\uc544\ub798 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub294 \uac00\ub2a5\ud55c \uacbd\uc6b0 AZ\uc5d0 \ud30c\ub4dc\ub97c \ubd84\uc0b0\uc2dc\ud0a4\uace0, \uadf8\ub807\uc9c0 \uc54a\uc744 \uacbd\uc6b0 \ud574\ub2f9 \ud30c\ub4dc\ub294 \uadf8\ub0e5 \uc2e4\ud589\ub418\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-server\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      topologySpreadConstraints:\n        - maxSkew: 1\n          whenUnsatisfiable: ScheduleAnyway\n          topologyKey: topology.kubernetes.io/zone\n          labelSelector:\n            matchLabels:\n              app: web-server\n      containers:\n      - name: web-app\n        image: nginx\n        resources:\n          requests:\n            cpu: 1\n</code></pre> <p>\ucc38\uace0</p> <p><code>kube-scheduler</code>\ub294 \ud574\ub2f9 \ub808\uc774\ube14\uc774 \uc788\ub294 \ub178\ub4dc\ub97c \ud1b5\ud55c \ud1a0\ud3f4\ub85c\uc9c0 \ub3c4\uba54\uc778\ub9cc \uc778\uc2dd\ud569\ub2c8\ub2e4. \uc704\uc758 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \ub2e8\uc77c \uc874\uc5d0\ub9cc \ub178\ub4dc\uac00 \uc788\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ubc30\ud3ec\ud558\uba74, <code>kube-scheduler</code>\uac00 \ub2e4\ub978 \uc874\uc744 \uc778\uc2dd\ud558\uc9c0 \ubabb\ud558\ubbc0\ub85c \ubaa8\ub4e0 \ud30c\ub4dc\uac00 \ud574\ub2f9 \ub178\ub4dc\uc5d0\uc11c \uc2a4\ucf00\uc904\ub9c1\ub429\ub2c8\ub2e4. \uc774 Topology Spread\uac00 \uc2a4\ucf00\uc904\ub7ec\uc640 \ud568\uaed8 \uc608\uc0c1\ub300\ub85c \uc791\ub3d9\ud558\ub824\uba74 \ubaa8\ub4e0 \uc874\uc5d0 \ub178\ub4dc\uac00 \uc774\ubbf8 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774 \ubb38\uc81c\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 1.24\uc5d0\uc11c <code>MinDomainsInPodToplogySpread</code> \uae30\ub2a5 \uac8c\uc774\ud2b8\uac00 \ucd94\uac00\ub418\uba74\uc11c \ud574\uacb0\ub420 \uac83\uc785\ub2c8\ub2e4. \uc774 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uba74 \uc2a4\ucf00\uc904\ub7ec\uc5d0 \uc801\uaca9 \ub3c4\uba54\uc778 \uc218\ub97c \uc54c\ub9ac\uae30 \uc704\ud574 <code>MinDomains</code> \uc18d\uc131\uc744 \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uacbd\uace0</p> <p><code>whenUnsatisfiable</code>\ub97c <code>Donot Schedule</code>\ub85c \uc124\uc815\ud558\uba74 Topology Spread Constraints\uc744 \ucda9\uc871\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc5c6\uac8c \ub429\ub2c8\ub2e4. Topology Spread Constraints\uc744 \uc704\ubc18\ud558\ub294 \ub300\uc2e0 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\uc9c0 \uc54a\ub294 \uac83\uc774 \ub354 \uc88b\uc740 \uacbd\uc6b0\uc5d0\ub9cc \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc774\uc804 \ubc84\uc804\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c\ub294 \ud30c\ub4dc anti-affinity \uaddc\uce59\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc5ec\ub7ec AZ\uc5d0 \uac78\uccd0 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ub9e4\ub2c8\ud398\uc2a4\ud2b8\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uc5d0\uac8c \ubcc4\uac1c\uc758 AZ\uc5d0\uc11c \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud558\ub294 \uac83\uc744 \uc120\ud638\ud55c\ub2e4\uace0 \uc54c\ub824\uc90d\ub2c8\ub2e4. </p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-server\n  labels:\n    app: web-server\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      affinity:\n        podAntiAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: failure-domain.beta.kubernetes.io/zone\n            weight: 100\n      containers:\n      - name: web-app\n        image: nginx\n</code></pre> <p>\uacbd\uace0</p> <p>\ud30c\ub4dc\ub97c \uc11c\ub85c \ub2e4\ub978 AZ\uc5d0 \uc2a4\ucf00\uc904\ud560 \ud544\uc694\ub294 \uc5c6\uc2b5\ub2c8\ub2e4. \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ud30c\ub4dc \uc218\uac00 AZ \uc218\ub97c \uc808\ub300 \ucd08\uacfc\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/dataplane/#ebs-az","title":"EBS \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud560 \ub54c \uac01 AZ\uc758 \uc6a9\ub7c9\uc744 \ud655\ubcf4\ud558\uc2ed\uc2dc\uc624.","text":"<p>Amazon EBS\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc601\uad6c \ubcfc\ub968 \uc81c\uacf5\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ud30c\ub4dc \ubc0f \uad00\ub828 EBS \ubcfc\ub968\uc774 \ub3d9\uc77c\ud55c AZ\uc5d0 \uc788\ub294\uc9c0 \ud655\uc778\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774 \uae00\uc744 \uc4f0\ub294 \uc2dc\uc810\uc5d0\uc11c EBS \ubcfc\ub968\uc740 \ub2e8\uc77c AZ \ub0b4\uc5d0\uc11c\ub9cc \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc\ub294 \ub2e4\ub978 AZ\uc5d0 \uc704\uce58\ud55c EBS \uc9c0\uc6d0 \uc601\uad6c \ubcfc\ub968\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\ub294 \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc5b4\ub290 AZ\uc5d0 \uc704\uce58\ud558\ub294\uc9c0 \uc54c\uace0 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud574\ub2f9 \ubcfc\ub968\uacfc \ub3d9\uc77c\ud55c AZ\uc5d0 EBS \ubcfc\ub968\uc774 \ud544\uc694\ud55c \ud30c\ub4dc\ub97c \ud56d\uc0c1 \uc2a4\ucf00\uc904\ub9c1\ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ubcfc\ub968\uc774 \uc704\uce58\ud55c AZ\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc5c6\ub294 \uacbd\uc6b0 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. </p> <p>\ud074\ub7ec\uc2a4\ud130\uac00 \ud56d\uc0c1 \ud544\uc694\ud55c EBS \ubcfc\ub968\uacfc \ub3d9\uc77c\ud55c AZ\uc5d0 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc788\ub294 \uc6a9\ub7c9\uc744 \ud655\ubcf4\ud560 \uc218 \uc788\ub3c4\ub85d \ucda9\ubd84\ud55c \uc6a9\ub7c9\uc744 \uac16\ucd98 \uac01 AZ\uc5d0 \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624. \ub610\ud55c \ud074\ub7ec\uc2a4\ud130 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub7ec\uc5d0\uc11c <code>--balance-similar-similar-node groups</code> \uae30\ub2a5\uc744 \ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>EBS \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud558\uc9c0\ub9cc \uac00\uc6a9\uc131\uc744 \ub192\uc774\uae30 \uc704\ud55c \uc694\uad6c \uc0ac\ud56d\uc774 \uc5c6\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589 \uc911\uc778 \uacbd\uc6b0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec\ub97c \ub2e8\uc77c AZ\ub85c \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. EKS\uc5d0\uc11c\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 AZ \uc774\ub984\uc774 \ud3ec\ud568\ub41c <code>failure-domain.beta.kubernetes.io/zone</code> \ub808\uc774\ube14\uc774 \uc790\ub3d9\uc73c\ub85c \ucd94\uac00\ub429\ub2c8\ub2e4. <code>kubectl get nodes --show-labels</code>\ub97c \uc2e4\ud589\ud558\uc5ec \ub178\ub4dc\uc5d0 \ucca8\ubd80\ub41c \ub808\uc774\ube14\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ube4c\ud2b8\uc778 \ub178\ub4dc \ub808\uc774\ube14\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [\uc5ec\uae30] (https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#built-in-node-labels)\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc \uc140\ub809\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud2b9\uc815 AZ\uc5d0\uc11c \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\uc544\ub798 \uc608\uc2dc\uc5d0\uc11c\ub294 \ud30c\ub4dc\uac00 <code>us-west-2c</code> AZ\uc5d0\uc11c\ub9cc \uc2a4\ucf00\uc904\ub9c1\ub429\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: single-az-pod\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: failure-domain.beta.kubernetes.io/zone\n            operator: In\n            values:\n            - us-west-2c\n  containers:\n  - name: single-az-container\n    image: kubernetes/pause\n</code></pre> <p>\ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968(EBS \uc9c0\uc6d0) \uc5ed\uc2dc AZ \uc774\ub984\uc73c\ub85c \uc790\ub3d9 \ub808\uc774\ube14\uc774 \uc9c0\uc815\ub429\ub2c8\ub2e4. <code>kubectl get pv -L topology.ebs.csi.aws.com/zone</code> \uba85\ub839\uc744 \uc2e4\ud589\ud574 \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968\uc774 \uc5b4\ub290 AZ\uc5d0 \uc18d\ud558\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \uc0dd\uc131\ub418\uace0 \ubcfc\ub968\uc744 \uc694\uccad\ud558\uba74, \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud574\ub2f9 \ubcfc\ub968\uacfc \ub3d9\uc77c\ud55c AZ\uc5d0 \uc788\ub294 \ub178\ub4dc\uc5d0 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud569\ub2c8\ub2e4. </p> <p>\ub178\ub4dc \uadf8\ub8f9\uc774 \ud558\ub098\uc778 EKS \ud074\ub7ec\uc2a4\ud130\uac00 \uc788\ub294 \uc2dc\ub098\ub9ac\uc624\ub97c \uc0dd\uac01\ud574 \ubcf4\uc2ed\uc2dc\uc624. \uc774 \ub178\ub4dc \uadf8\ub8f9\uc5d0\ub294 3\uac1c\uc758 AZ\uc5d0 \ubd84\uc0b0\ub41c \uc138 \uac1c\uc758 \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc788\uc2b5\ub2c8\ub2e4. EBS \uc9c0\uc6d0 \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \ud574\ub2f9 \ubcfc\ub968\uc744 \uc0dd\uc131\ud558\uba74 \ud574\ub2f9 \ud30c\ub4dc\uac00 \uc138 \uac1c\uc758 AZ \uc911 \uccab \ubc88\uc9f8 AZ\uc5d0 \uc0dd\uc131\ub429\ub2c8\ub2e4. \uadf8\ub7ec\uba74 \uc774 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uc6cc\ucee4 \ub178\ub4dc\uac00 \ube44\uc815\uc0c1 \uc0c1\ud0dc\uac00 \ub418\uace0 \uc774\ud6c4\uc5d0\ub294 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uac8c \ub41c\ub2e4. Cluster Autoscaler\ub294 \ube44\uc815\uc0c1 \ub178\ub4dc\ub97c \uc0c8 \uc6cc\ucee4 \ub178\ub4dc\ub85c \uad50\uccb4\ud569\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \uc790\ub3d9 \ud655\uc7a5 \uadf8\ub8f9\uc774 \uc138 \uac1c\uc758 AZ\uc5d0 \uac78\uccd0 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc0c1\ud669\uc5d0 \ub530\ub77c \uc0c8 \uc6cc\ucee4 \ub178\ub4dc\uac00 \ub450 \ubc88\uc9f8 \ub610\ub294 \uc138 \ubc88\uc9f8 AZ\uc5d0\uc11c \uc2dc\uc791\ub420 \uc218 \uc788\uc9c0\ub9cc \uccab \ubc88\uc9f8 AZ\uc5d0\uc11c\ub294 \uc2e4\ud589\ub418\uc9c0 \uc54a\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. AZ \uc81c\uc57d\uc774 \uc788\ub294 EBS \ubcfc\ub968\uc740 \uccab \ubc88\uc9f8 AZ\uc5d0\ub9cc \uc874\uc7ac\ud558\uace0 \ud574\ub2f9 AZ\uc5d0\ub294 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc5c6\uc73c\ubbc0\ub85c \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c \uac01 AZ\uc5d0 \ub178\ub4dc \uadf8\ub8f9\uc744 \ud558\ub098\uc529 \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub798\uc57c \ub2e4\ub978 AZ\uc5d0\uc11c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc5c6\ub294 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \ucda9\ubd84\ud55c \uc6a9\ub7c9\uc774 \ud56d\uc0c1 \ud655\ubcf4\ub429\ub2c8\ub2e4. </p> <p>\ub610\ub294 \uc601\uad6c \uc2a4\ud1a0\ub9ac\uc9c0\uac00 \ud544\uc694\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589\ud560 \ub54c [EFS] (https://github.com/kubernetes-sigs/aws-efs-csi-driver)\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \uc790\ub3d9 \ud06c\uae30 \uc870\uc815\uc744 \ub2e8\uc21c\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub77c\uc774\uc5b8\ud2b8\ub294 \ub9ac\uc804 \ub0b4 \ubaa8\ub4e0 AZ\uc5d0\uc11c \ub3d9\uc2dc\uc5d0 EFS \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. EFS \uae30\ubc18 \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud558\ub294 \ud30c\ub4dc\uac00 \uc885\ub8cc\ub418\uc5b4 \ub2e4\ub978 AZ\uc5d0 \uc2a4\ucf00\uc904\ub418\ub354\ub77c\ub3c4 \ubcfc\ub968\uc744 \ub9c8\uc6b4\ud2b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#_2","title":"\ub178\ub4dc \ubb38\uc81c \uac10\uc9c0\uae30 \uc2e4\ud589","text":"<p>\uc6cc\ucee4 \ub178\ub4dc\uc758 \uc7a5\uc560\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uac00\uc6a9\uc131\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4. node-problem-detector\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc124\uce58\ud558\uc5ec \uc6cc\ucee4 \ub178\ub4dc \ubb38\uc81c\ub97c \ud0d0\uc9c0\ud560 \uc218 \uc788\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc560\ub4dc\uc628\uc785\ub2c8\ub2e4. npd\uc758 \uce58\ub8cc \uc2dc\uc2a4\ud15c\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \ube44\uc6b0\uace0 \uc885\ub8cc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#_3","title":"\uc2dc\uc2a4\ud15c \ubc0f \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\ubaac\uc744 \uc704\ud55c \ub9ac\uc18c\uc2a4 \uc608\uc57d","text":"<p>\uc6b4\uc601 \uccb4\uc81c \ubc0f \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\ubaac\uc744 \uc704\ud55c \ucef4\ud4e8\ud305 \uc6a9\ub7c9\ub97c \uc608\uc57d\ud558\uc5ec \uc6cc\ucee4 \ub178\ub4dc\uc758 \uc548\uc815\uc131\uc744 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc, \ud2b9\ud788 <code>limits</code>\uc774 \uc120\uc5b8\ub418\uc9c0 \uc54a\uc740 \ud30c\ub4dc\ub294 \uc2dc\uc2a4\ud15c \ub9ac\uc18c\uc2a4\ub97c \ud3ec\ud654\uc2dc\ucf1c \uc6b4\uc601\uccb4\uc81c \ud504\ub85c\uc138\uc2a4\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\ubaac (<code>kubelet</code>, \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784 \ub4f1)\uc774 \uc2dc\uc2a4\ud15c \ub9ac\uc18c\uc2a4\ub97c \ub193\uace0 \ud30c\ub4dc\uc640 \uacbd\uc7c1\ud558\ub294 \uc0c1\ud669\uc5d0 \ub193\uc774\uac8c \ub429\ub2c8\ub2e4.<code>kubelet</code> \ud50c\ub798\uadf8 <code>--system-reserved</code>\uc640 <code>--kube-reserved</code>\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2dc\uc2a4\ud15c \ud504\ub85c\uc138\uc2a4 (<code>udev</code>, <code>sshd</code> \ub4f1)\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\ubaac\uc744 \uc704\ud55c \ub9ac\uc18c\uc2a4\ub97c \uac01\uac01 \uc608\uc57d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>EKS\uc5d0 \ucd5c\uc801\ud654\ub41c Linux AMI\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 CPU, \uba54\ubaa8\ub9ac \ubc0f \uc2a4\ud1a0\ub9ac\uc9c0\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uc2dc\uc2a4\ud15c \ubc0f \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\ubaac\uc6a9\uc73c\ub85c \uc608\uc57d\ub429\ub2c8\ub2e4. \uc774 AMI\ub97c \uae30\ubc18\uc73c\ub85c \ud558\ub294 \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc2dc\uc791\ub418\uba74 <code>bootstrap.sh</code> \uc2a4\ud06c\ub9bd\ud2b8 \ub97c \ud2b8\ub9ac\uac70\ud558\ub3c4\ub85d EC2 \uc0ac\uc6a9\uc790 \ub370\uc774\ud130\uac00 \uad6c\uc131\ub429\ub2c8\ub2e4. \uc774 \uc2a4\ud06c\ub9bd\ud2b8\ub294 EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 CPU \ucf54\uc5b4 \uc218\uc640 \ucd1d \uba54\ubaa8\ub9ac\ub97c \uae30\ubc18\uc73c\ub85c CPU \ubc0f \uba54\ubaa8\ub9ac \uc608\uc57d\uc744 \uacc4\uc0b0\ud569\ub2c8\ub2e4. \uacc4\uc0b0\ub41c \uac12\uc740 <code>/etc/kubernetes/kubelet/kubelet-config.json</code>\uc5d0 \uc788\ub294 <code>KubeletConfiguration</code> \ud30c\uc77c\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4. </p> <p>\ub178\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub370\ubaac\uc744 \uc2e4\ud589\ud558\uace0 \uae30\ubcf8\uc801\uc73c\ub85c \uc608\uc57d\ub41c CPU \ubc0f \uba54\ubaa8\ub9ac \uc591\uc774 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \uc2dc\uc2a4\ud15c \ub9ac\uc18c\uc2a4 \uc608\uc57d\uc744 \ub298\ub824\uc57c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p><code>eksctl</code>\uc740 \uc2dc\uc2a4\ud15c \ubc0f \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\ubaac\uc758 \ub9ac\uc18c\uc2a4 \uc608\uc57d\uc744 \uc0ac\uc6a9\uc790 \uc9c0\uc815\ud558\ub294 \uac00\uc7a5 \uc26c\uc6b4 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/dataplane/#qos","title":"QoS \uad6c\ud604","text":"<p>\uc911\uc694\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uacbd\uc6b0, \ud30c\ub4dc\uc758 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud574 <code>requests</code>=<code>limits</code> \uc815\uc758\ub97c \uace0\ub824\ud574\ubcf4\uc2ed\uc2dc\uc624. \uc774\ub807\uac8c \ud558\uba74 \ub2e4\ub978 \ud30c\ub4dc\uac00 \ub9ac\uc18c\uc2a4\ub97c \uc694\uccad\ud558\ub354\ub77c\ub3c4 \ucee8\ud14c\uc774\ub108\uac00 \uc885\ub8cc\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <p>\ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\uc5d0 CPU \ubc0f \uba54\ubaa8\ub9ac \uc81c\ud55c\uc744 \uc801\uc6a9\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ucee8\ud14c\uc774\ub108\uac00 \uc2e4\uc218\ub85c \uc2dc\uc2a4\ud15c \ub9ac\uc18c\uc2a4\ub97c \uc18c\ube44\ud558\uc5ec \uac19\uc740 \uc704\uce58\uc5d0 \ubc30\uce58\ub41c \ub2e4\ub978 \ud504\ub85c\uc138\uc2a4\uc758 \uac00\uc6a9\uc131\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce58\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#_4","title":"\ubaa8\ub4e0 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub300\ud55c \ub9ac\uc18c\uc2a4 \uc694\uccad/\uc81c\ud55c \uad6c\uc131 \ubc0f \ud06c\uae30 \uc870\uc815","text":"<p>\ub9ac\uc18c\uc2a4 \uc694\uccad\uc758 \ud06c\uae30 \uc870\uc815 \ubc0f \uc6cc\ud06c\ub85c\ub4dc \ud55c\ub3c4\uc5d0 \ub300\ud55c \uba87 \uac00\uc9c0 \uc77c\ubc18\uc801\uc778 \uc9c0\uce68\uc744 \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li> <p>CPU\uc5d0 \ub9ac\uc18c\uc2a4 \uc81c\ud55c\uc744 \uc9c0\uc815\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624. \uc81c\ud55c\uc774 \uc5c6\ub294 \uacbd\uc6b0 \uc694\uccad\uc740 \ucee8\ud14c\uc774\ub108\uc758 \uc0c1\ub300\uc801 CPU \uc0ac\uc6a9 \uc2dc\uac04\uc5d0 \uac00\uc911\uce58 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc778\uc704\uc801\uc778 \uc81c\ud55c\uc774\ub098 \uacfc\ub2e4 \ud604\uc0c1 \uc5c6\uc774 \uc6cc\ud06c\ub85c\ub4dc\uc5d0\uc11c CPU \uc804\uccb4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> </li> <li> <p>CPU\uac00 \uc544\ub2cc \ub9ac\uc18c\uc2a4\uc758 \uacbd\uc6b0, <code>requests</code>=<code>limits</code>\ub97c \uad6c\uc131\ud558\uba74 \uac00\uc7a5 \uc608\uce21 \uac00\ub2a5\ud55c \ub3d9\uc791\uc774 \uc81c\uacf5\ub429\ub2c8\ub2e4. \ub9cc\uc57d <code>requests</code>!=<code>limits</code>\uc774\uba74, \ucee8\ud14c\uc774\ub108\uc758 QOS\ub3c4 Guaranteed\uc5d0\uc11c Burstable\ub85c \uac10\uc18c\ud558\uc5ec node pressure \uc774\ubca4\ud2b8\uc5d0 \ucd95\ucd9c\ub420 \uac00\ub2a5\uc131\uc774 \ub192\uc544\uc84c\uc2b5\ub2c8\ub2e4.</p> </li> <li> <p>CPU\uac00 \uc544\ub2cc \ub9ac\uc18c\uc2a4\uc758 \uacbd\uc6b0 \uc694\uccad\ubcf4\ub2e4 \ud6e8\uc52c \ud070 \uc81c\ud55c\uc744 \uc9c0\uc815\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624. <code>limits</code>\uc774 <code>requests</code>\uc5d0 \ube44\ud574 \ud06c\uac8c \uad6c\uc131\ub420\uc218\ub85d \ub178\ub4dc\uac00 \uc624\ubc84 \ucee4\ubc0b\ub418\uc5b4 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc911\ub2e8\ub420 \uac00\ub2a5\uc131\uc774 \ub192\uc544\uc9d1\ub2c8\ub2e4.</p> </li> <li> <p>Karpenter \ub610\ub294 Cluster AutoScaler\uc640 \uac19\uc740 \ub178\ub4dc \uc790\ub3d9 \ud06c\uae30 \uc870\uc815 \uc194\ub8e8\uc158\uc744 \uc0ac\uc6a9\ud560 \ub54c\ub294 \uc694\uccad \ud06c\uae30\ub97c \uc62c\ubc14\ub974\uac8c \uc9c0\uc815\ud558\ub294 \uac83\uc774 \ud2b9\ud788 \uc911\uc694\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ub3c4\uad6c\ub294 \uc6cc\ud06c\ub85c\ub4dc \uc694\uccad\uc744 \uac80\ud1a0\ud558\uc5ec \ud504\ub85c\ube44\uc800\ub2dd\ud560 \ub178\ub4dc\uc758 \uc218\uc640 \ud06c\uae30\ub97c \uacb0\uc815\ud569\ub2c8\ub2e4. \uc694\uccad\uc774 \ub108\ubb34 \uc791\uc544 \uc81c\ud55c\uc774 \ub354 \ud070 \uacbd\uc6b0, \uc6cc\ud06c\ub85c\ub4dc\uac00 \ub178\ub4dc\uc5d0 \uaf49 \ucc28 \uc788\uc73c\uba74 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc81c\uac70\ub418\uac70\ub098 OOM\uc73c\ub85c \uc885\ub8cc\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> </li> </ul> <p>\ub9ac\uc18c\uc2a4 \uc694\uccad\uc744 \uacb0\uc815\ud558\ub294 \uac83\uc740 \uc5b4\ub824\uc6b8 \uc218 \uc788\uc9c0\ub9cc Vertical Pod Autoscaler\uc640 \uac19\uc740 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 \ub7f0\ud0c0\uc784 \uc2dc \ucee8\ud14c\uc774\ub108 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub7c9\uc744 \uad00\ucc30\ud558\uc5ec \uc694\uccad \uaddc\ubaa8\ub97c '\uc801\uc815'\ud558\uac8c \uc870\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc694\uccad \ud06c\uae30\ub97c \uacb0\uc815\ud558\ub294 \ub370 \uc720\uc6a9\ud560 \uc218 \uc788\ub294 \ub2e4\ub978 \ub3c4\uad6c\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <ul> <li>Goldilocks</li> <li>Parca</li> <li>Prodfiler</li> <li>rsg</li> </ul>"},{"location":"ko/reliability/docs/dataplane/#_5","title":"\ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ub9ac\uc18c\uc2a4 \ud560\ub2f9\ub7c9 \uad6c\uc131","text":"<p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub294 \uc0ac\uc6a9\uc790\uac00 \uc5ec\ub7ec \ud300 \ub610\ub294 \ud504\ub85c\uc81d\ud2b8\uc5d0 \ubd84\uc0b0\ub418\uc5b4 \uc788\ub294 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9\ud558\uae30 \uc704\ud55c \uac83\uc785\ub2c8\ub2e4. \uc774\ub984 \ubc94\uc704\ub97c \uc81c\uacf5\ud558\uace0 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4\ub97c \uc5ec\ub7ec \ud300, \ud504\ub85c\uc81d\ud2b8, \uc6cc\ud06c\ub85c\ub4dc \uac04\uc5d0 \ub098\ub204\ub294 \ubc29\ubc95\uc785\ub2c8\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ucd1d \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub7c9\uc744 \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>ResourceQuota</code> \uac1d\uccb4\ub294 \uc720\ud615\ubcc4\ub85c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ub9cc\ub4e4 \uc218 \uc788\ub294 \uac1c\uccb4 \uc218\uc640 \ud574\ub2f9 \ud504\ub85c\uc81d\ud2b8\uc758 \ub9ac\uc18c\uc2a4\uac00 \uc18c\ube44\ud560 \uc218 \uc788\ub294 \ucd1d \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4 \uc591\uc744 \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc9c0\uc815\ub41c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \uc694\uccad\ud560 \uc218 \uc788\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \ubc0f/\ub610\ub294 \ucef4\ud4e8\ud305(CPU \ubc0f \uba54\ubaa8\ub9ac) \ub9ac\uc18c\uc2a4\uc758 \ucd1d\ud569\uc744 \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>CPU \ubc0f \uba54\ubaa8\ub9ac\uc640 \uac19\uc740 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\uc758 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ub9ac\uc18c\uc2a4 \ucffc\ud130\uac00 \ud65c\uc131\ud654\ub41c \uacbd\uc6b0 \uc0ac\uc6a9\uc790\ub294 \ud574\ub2f9 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \uac01 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c \uc694\uccad \ub610\ub294 \uc81c\ud55c\uc744 \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uac01 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ub7c9\uc744 \uad6c\uc131\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4\uc758 \ucee8\ud14c\uc774\ub108\uc5d0 \uc0ac\uc804 \uad6c\uc131\ub41c \uc81c\ud55c\uc744 \uc790\ub3d9\uc73c\ub85c \uc801\uc6a9\ud558\ub824\uba74 <code>LimitRanges</code>\ub97c \uc0ac\uc6a9\ud574 \ubcf4\uc2ed\uc2dc\uc624. </p>"},{"location":"ko/reliability/docs/dataplane/#_6","title":"\ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4\uc5d0\uc11c \ucee8\ud14c\uc774\ub108 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\uc744 \uc81c\ud55c\ud569\ub2c8\ub2e4.","text":"<p>\ub9ac\uc18c\uc2a4 \ucffc\ud130\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uac00 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ub9ac\uc18c\uc2a4\uc758 \uc591\uc744 \uc81c\ud55c\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4. <code>LimitRange</code> \uac1c\uccb4\ub294 \ucee8\ud14c\uc774\ub108\uac00 \uc694\uccad\ud560 \uc218 \uc788\ub294 \ucd5c\uc18c \ubc0f \ucd5c\ub300 \ub9ac\uc18c\uc2a4\ub97c \uad6c\ud604\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>LimitRange</code>\ub97c \uc0ac\uc6a9\ud558\uba74 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c \uae30\ubcf8 \uc694\uccad \ubc0f \uc81c\ud55c\uc744 \uc124\uc815\ud560 \uc218 \uc788\ub294\ub370, \uc774\ub294 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4 \uc81c\ud55c\uc744 \uc124\uc815\ud558\ub294 \uac83\uc774 \uc870\uc9c1\uc758 \ud45c\uc900 \uad00\ud589\uc774 \uc544\ub2cc \uacbd\uc6b0\uc5d0 \uc720\uc6a9\ud569\ub2c8\ub2e4. \uc774\ub984\uc5d0\uc11c \uc54c \uc218 \uc788\ub4ef\uc774, <code>LimitRange</code>\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ud30c\ub4dc \ub610\ub294 \ucee8\ud14c\uc774\ub108\ub2f9 \ucd5c\uc18c \ubc0f \ucd5c\ub300 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub7c9\uc744 \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \ud37c\uc2dc\uc2a4\ud134\ud2b8\ubcfc\ub968\ud074\ub808\uc784\ub2f9 \ucd5c\uc18c \ubc0f \ucd5c\ub300 \uc2a4\ud1a0\ub9ac\uc9c0 \uc694\uccad\uc744 \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucee8\ud14c\uc774\ub108\uc640 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc218\uc900\uc5d0\uc11c \uc81c\ud55c\uc744 \uc801\uc6a9\ud558\ub824\uba74 <code>LimitRange</code>\uc640 <code>ResourceQuota</code>\ub97c \ud568\uaed8 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc81c\ud55c\uc744 \uc124\uc815\ud558\uba74 \ucee8\ud14c\uc774\ub108 \ub610\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uac00 \ud074\ub7ec\uc2a4\ud130\uc758 \ub2e4\ub978 \ud14c\ub10c\ud2b8\uac00 \uc0ac\uc6a9\ud558\ub294 \ub9ac\uc18c\uc2a4\uc5d0 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/reliability/docs/dataplane/#coredns","title":"CoreDNS","text":"<p>CoreDNS\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc774\ub984 \ud655\uc778 \ubc0f \uc11c\ube44\uc2a4 \uac80\uc0c9 \uae30\ub2a5\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \uae30\ubcf8\uc801\uc73c\ub85c \uc124\uce58\ub429\ub2c8\ub2e4. \uc0c1\ud638 \uc6b4\uc6a9\uc131\uc744 \uc704\ud574 CoreDNS\uc6a9 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4\uc758 \uc774\ub984\uc740 \uc5ec\uc804\ud788 kube-dns\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4. CoreDNS \ud30c\ub4dc\ub294 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \uc77c\ubd80\ub85c <code>kube-system</code> \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub418\uba70, EKS\uc5d0\uc11c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uc694\uccad\uacfc \uc81c\ud55c\uc774 \uc120\uc5b8\ub41c \ub450 \uac1c\uc758 \ubcf5\uc81c\ubcf8\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4. DNS \ucffc\ub9ac\ub294 <code>kube-system</code> \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 <code>kube-dns</code> \uc11c\ube44\uc2a4\ub85c \uc804\uc1a1\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#_7","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/reliability/docs/dataplane/#dns","title":"\ud575\uc2ec DNS \uc9c0\ud45c \ubaa8\ub2c8\ud130\ub9c1","text":"<p>CoreDNS\ub294 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\uc5d0 \ub300\ud55c \uc9c0\uc6d0\uc744 \ub0b4\uc7a5\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. \ud2b9\ud788 CoreDNS \uc9c0\uc5f0 \uc2dc\uac04(<code>coredns_dns_request_duration_seconds_sum</code>, 1.7.0 \ubc84\uc804 \uc774\uc804\uc5d0\ub294 \uba54\ud2b8\ub9ad\uc774 <code>core_dns_response_rcode_count_total</code>\uc774\ub77c\uace0 \ubd88\ub838\uc74c), \uc624\ub958 (<code>coredns_dns_responses_total</code>, NXDOMAIN, SERVFAIL, FormErr) \ubc0f CoreDNS \ud30c\ub4dc\uc758 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc5d0 \ub300\ud55c \ubaa8\ub2c8\ud130\ub9c1\uc744 \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ubb38\uc81c \ud574\uacb0\uc744 \uc704\ud574 kubectl\uc744 \uc0ac\uc6a9\ud558\uc5ec CoreDNS \ub85c\uadf8\ub97c \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>for p in $(kubectl get pods \u2014namespace=kube-system -l k8s-app=kube-dns -o name); do kubectl logs \u2014namespace=kube-system $p; done\n</code></pre>"},{"location":"ko/reliability/docs/dataplane/#dns_1","title":"\ub178\ub4dc \ub85c\uceec DNS \uce90\uc2dc \uc0ac\uc6a9","text":"<p>\ub178\ub4dc \ub85c\uceec DNS \uce90\uc2dc\ub97c \uc2e4\ud589\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 DNS \uc131\ub2a5\uc744 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uae30\ub2a5\uc740 \ud074\ub7ec\uc2a4\ud130 \ub178\ub4dc\uc5d0\uc11c DNS \uce90\uc2f1 \uc5d0\uc774\uc804\ud2b8\ub97c \ub370\ubaac\uc14b\uc73c\ub85c \uc2e4\ud589\ud569\ub2c8\ub2e4. \ubaa8\ub4e0 \ud3ec\ub4dc\ub294 \uc774\ub984 \ud655\uc778\uc744 \uc704\ud574 <code>kube-dns</code> \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub294 \ub300\uc2e0 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 DNS \uce90\uc2f1 \uc5d0\uc774\uc804\ud2b8\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/reliability/docs/dataplane/#coredns-cluster-proportional-scaler","title":"CoreDNS\uc758 cluster-proportional-scaler\ub97c \uad6c\uc131\ud569\ub2c8\ub2e4.","text":"<p>\ud074\ub7ec\uc2a4\ud130 DNS \uc131\ub2a5\uc744 \uac1c\uc120\ud558\ub294 \ub610 \ub2e4\ub978 \ubc29\ubc95\uc740 \ud074\ub7ec\uc2a4\ud130\uc758 \ub178\ub4dc \ubc0f CPU \ucf54\uc5b4 \uc218\uc5d0 \ub530\ub77c CoreDNS \ubc30\ud3ec\ub97c \uc790\ub3d9\uc73c\ub85c \uc218\ud3c9\uc73c\ub85c \ud655\uc7a5\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc218\ud3c9 \ud074\ub7ec\uc2a4\ud130 \ube44\ub840 \uc790\ub3d9 \ud655\uc7a5\uc740 \uc2a4\ucf00\uc904 \uac00\ub2a5\ud55c \ub370\uc774\ud130 \ud50c\ub808\uc778\uc758 \ud06c\uae30\uc5d0 \ub530\ub77c \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ubcf5\uc81c\ubcf8 \uc218\ub97c \uc870\uc815\ud558\ub294 \ucee8\ud14c\uc774\ub108\uc785\ub2c8\ub2e4.</p> <p>\ub178\ub4dc\uc640 \ub178\ub4dc\uc758 CPU \ucf54\uc5b4 \uc9d1\uacc4\ub294 CoreDNS\ub97c \ud655\uc7a5\ud560 \uc218 \uc788\ub294 \ub450 \uac00\uc9c0 \uc9c0\ud45c\uc785\ub2c8\ub2e4. \ub450 \uc9c0\ud45c\ub97c \ub3d9\uc2dc\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub354 \ud070 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 CoreDNS \uc2a4\ucf00\uc77c\ub9c1\uc740 CPU \ucf54\uc5b4 \uc218\ub97c \uae30\ubc18\uc73c\ub85c \ud569\ub2c8\ub2e4. \ubc18\uba74 \ub354 \uc791\uc740 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 CoreDNS \ubcf5\uc81c\ubcf8\uc758 \uc218\ub294 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc758 CPU \ucf54\uc5b4\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9d1\ub2c8\ub2e4. \ube44\ub840 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub7ec \uad6c\uc131\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>linear: '{\"coresPerReplica\":256,\"min\":1,\"nodesPerReplica\":16}'\n</code></pre>"},{"location":"ko/reliability/docs/dataplane/#ami","title":"\ub178\ub4dc \uadf8\ub8f9\uc774 \uc788\ub294 AMI \uc120\ud0dd","text":"<p>EKS\ub294 \uace0\uac1d\uc774 \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uacfc \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc744 \ubaa8\ub450 \uc0dd\uc131\ud558\ub294 \ub370 \uc0ac\uc6a9\ud558\ub294 \ucd5c\uc801\ud654\ub41c EC2 AMI\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c AMI\ub294 \uc9c0\uc6d0\ub418\ub294 \ubaa8\ub4e0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804\uc5d0 \ub300\ud574 \ubaa8\ub4e0 \ub9ac\uc804\uc5d0 \uac8c\uc2dc\ub429\ub2c8\ub2e4. EKS\ub294 CVE \ub610\ub294 \ubc84\uadf8\uac00 \ubc1c\uacac\ub418\uba74 \uc774\ub7ec\ud55c AMI\ub97c \ub354 \uc774\uc0c1 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 \uac83\uc73c\ub85c \ud45c\uc2dc\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \ub178\ub4dc \uadf8\ub8f9\uc5d0 \uc0ac\uc6a9\ud560 AMI\ub97c \uc120\ud0dd\ud560 \ub54c\ub294 \ub354 \uc774\uc0c1 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 AMI\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>Ec2 describe-images api\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc544\ub798 \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub354 \uc774\uc0c1 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 AMI\ub97c \ud544\ud130\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>aws ec2 describe-images --image-id ami-0d551c4f633e7679c --no-include-deprecated\n</code></pre> <p>\uc774\ubbf8\uc9c0 \uc124\uba85 \ucd9c\ub825\uc5d0 DeprecationTime\uc774 \ud544\ub4dc\ub85c \ud3ec\ud568\ub418\uc5b4 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uc5ec \uc9c0\uc6d0 \uc911\ub2e8\ub41c AMI\ub97c \uc2dd\ubcc4\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uba74:</p> <pre><code>aws ec2 describe-images --image-id ami-xxx --no-include-deprecated\n{\n    \"Images\": [\n        {\n            \"Architecture\": \"x86_64\",\n            \"CreationDate\": \"2022-07-13T15:54:06.000Z\",\n            \"ImageId\": \"ami-xxx\",\n            \"ImageLocation\": \"123456789012/eks_xxx\",\n            \"ImageType\": \"machine\",\n            \"Public\": false,\n            \"OwnerId\": \"123456789012\",\n            \"PlatformDetails\": \"Linux/UNIX\",\n            \"UsageOperation\": \"RunInstances\",\n            \"State\": \"available\",\n            \"BlockDeviceMappings\": [\n                {\n                    \"DeviceName\": \"/dev/xvda\",\n                    \"Ebs\": {\n                        \"DeleteOnTermination\": true,\n                        \"SnapshotId\": \"snap-0993a2fc4bbf4f7f4\",\n                        \"VolumeSize\": 20,\n                        \"VolumeType\": \"gp2\",\n                        \"Encrypted\": false\n                    }\n                }\n            ],\n            \"Description\": \"EKS Kubernetes Worker AMI with AmazonLinux2 image, (k8s: 1.19.15, docker: 20.10.13-2.amzn2, containerd: 1.4.13-3.amzn2)\",\n            \"EnaSupport\": true,\n            \"Hypervisor\": \"xen\",\n            \"Name\": \"aws_eks_optimized_xxx\",\n            \"RootDeviceName\": \"/dev/xvda\",\n            \"RootDeviceType\": \"ebs\",\n            \"SriovNetSupport\": \"simple\",\n            \"VirtualizationType\": \"hvm\",\n            \"DeprecationTime\": \"2023-02-09T19:41:00.000Z\"\n        }\n    ]\n}\n</code></pre>"},{"location":"ko/scalability/docs/","title":"EKS \ud655\uc7a5\uc131 \ubaa8\ubc94\uc0ac\ub840","text":"<p>\uc774 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 EKS \ud074\ub7ec\uc2a4\ud130 \ud655\uc7a5\uc5d0 \ub300\ud55c \uc870\uc5b8\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ud655\uc7a5\ud558\ub294 \ubaa9\uc801\uc740 \ub2e8\uc77c \ud074\ub7ec\uc2a4\ud130\uac00 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc791\uc5c5\ub7c9\uc744 \ucd5c\ub300\ud654\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \ud558\ub098\uc758 \ub300\uaddc\ubaa8 EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ac\uc6a9\ud558\uba74 \uc5ec\ub7ec \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc5d0 \ube44\ud574 \uc6b4\uc601 \ubd80\ud558\ub97c \uc904\uc77c \uc218 \uc788\uc9c0\ub9cc \uba40\ud2f0 \ub9ac\uc804 \ubc30\ud3ec, \ud14c\ub10c\ud2b8 \uaca9\ub9ac, \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc \ub4f1\uc758 \uce21\uba74\uc5d0\uc11c \ub2e8\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\uc5d0\uc11c\ub294 \ub2e8\uc77c \ud074\ub7ec\uc2a4\ud130\ub85c \ud655\uc7a5\uc131\uc744 \uadf9\ub300\ud654\ud558\ub294 \ubc29\ubc95\uc5d0 \ucd08\uc810\uc744 \ub9de\ucd9c \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/#_1","title":"\uac00\uc774\ub4dc \uc0ac\uc6a9\ubc95","text":"<p>\ud574\ub2f9 \uac00\uc774\ub4dc\ub294 AWS\uc5d0\uc11c EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uace0 \uad00\ub9ac\ud558\ub294 \uac1c\ubc1c\uc790 \ubc0f \uad00\ub9ac\uc790\ub97c \ub300\uc0c1\uc73c\ub85c \ud569\ub2c8\ub2e4. \uc774 \ubc31\uc11c\ub294 \uba87 \uac00\uc9c0 \uc77c\ubc18\uc801\uc778 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud655\uc7a5 \uc0ac\ub840\ub97c \uc911\uc810\uc801\uc73c\ub85c \ub2e4\ub8e8\uc9c0\ub9cc, \uc790\uccb4 \uad00\ub9ac\ud615 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ub610\ub294 EKS Anywhere\ub97c \uc0ac\uc6a9\ud558\uc5ec AWS \ub9ac\uc804 \uc678\ubd80\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uad6c\uccb4\uc801\uc778 \ub0b4\uc6a9\uc740 \ub514\ub8e8\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <p>\uac01 \uc8fc\uc81c\uc5d0\ub294 \uac04\ub7b5\ud55c \uac1c\uc694\uac00 \ud3ec\ud568\ub418\uba70, EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ub300\uaddc\ubaa8\ub85c \uc6b4\uc601\ud558\uae30 \uc704\ud55c \uad8c\uc7a5 \uc0ac\ud56d \ubc0f \ubaa8\ubc94 \uc0ac\ub840\uac00 \uc774\uc5b4\uc9d1\ub2c8\ub2e4. \uc8fc\uc81c\ub97c \ud2b9\uc815 \uc21c\uc11c\ub85c \uc77d\uc744 \ud544\uc694\ub294 \uc5c6\uc73c\uba70 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc791\ub3d9\ud558\ub294\uc9c0 \ud14c\uc2a4\ud2b8\ud558\uace0 \uac80\uc99d\ud558\uc9c0 \uc54a\uace0\ub294 \uad8c\uc7a5 \uc0ac\ud56d\uc744 \uc801\uc6a9\ud574\uc11c\ub294 \uc548 \ub429\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/#_2","title":"\ud06c\uae30 \uc870\uc815 \uc694\uc18c\uc5d0 \ub300\ud55c \uc774\ud574","text":"<p>\ud655\uc7a5\uc131\uc740 \uc131\ub2a5 \ubc0f \uc548\uc815\uc131\uacfc \ub2e4\ub974\ubbc0\ub85c \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc6cc\ud06c\ub85c\ub4dc \uc694\uad6c \uc0ac\ud56d\uc744 \uacc4\ud68d\ud560 \ub54c\ub294 \uc774 \uc138 \uac00\uc9c0\ub97c \ubaa8\ub450 \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uac00 \ud655\uc7a5\ub418\uba74 \ubaa8\ub2c8\ud130\ub9c1\uc774 \ud544\uc694\ud558\uc9c0\ub9cc \uc774 \uac00\uc774\ub4dc\uc5d0\uc11c\ub294 \ubaa8\ub2c8\ud130\ub9c1 \ubaa8\ubc94 \uc0ac\ub840\ub97c \ub2e4\ub8e8\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. EKS\ub294 \ub300\uaddc\ubaa8\ub85c \ud655\uc7a5\ud560 \uc218 \uc788\uc9c0\ub9cc, \ud074\ub7ec\uc2a4\ud130\ub97c 300\uac1c \ub178\ub4dc \ub610\ub294 5000\uac1c \uc774\uc0c1\uc758 \ud30c\ub4dc\ub85c \ud655\uc7a5\ud560 \ubc29\ubc95\uc744 \uacc4\ud68d\ud574\uc57c \ud569\ub2c8\ub2e4. \uc808\ub300\uc801\uc778 \uc218\uce58\ub294 \uc544\ub2c8\uc9c0\ub9cc \uc774 \uac00\uc774\ub4dc\ub97c \uc5ec\ub7ec \uc0ac\uc6a9\uc790, \uc5d4\uc9c0\ub2c8\uc5b4 \ubc0f \uc11c\ud3ec\ud2b8 \uc804\ubb38\uac00\uc640 \uacf5\ub3d9\uc73c\ub85c \uc791\uc5c5\ud55c \uacb0\uacfc\uc785\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \ud655\uc7a5\uc740 \ub2e4\ucc28\uc6d0\uc801\uc774\uba70 \ubaa8\ub4e0 \uc0c1\ud669\uc5d0 \ub9de\ub294 \ud2b9\uc815 \uc124\uc815\uc774\ub098 \uad8c\uc7a5 \uc0ac\ud56d\uc740 \uc5c6\uc2b5\ub2c8\ub2e4. \ud655\uc7a5\uc5d0 \ub300\ud55c \uc9c0\uce68\uc744 \uc81c\uacf5\ud560 \uc218 \uc788\ub294 \uc8fc\uc694 \uc601\uc5ed\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\uc774\ud130 \ud50c\ub808\uc778</li> <li>\ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4</li> <li>\uc6cc\ud06c\ub85c\ub4dc</li> </ul> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 EKS \ud074\ub7ec\uc2a4\ud130\uc5d0\ub294 AWS\uac00 \uc2e4\ud589\ud558\uace0 \uc0ac\uc6a9\uc790\ub97c \uc704\ud574 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ub418\ub294 \ubaa8\ub4e0 \uc11c\ube44\uc2a4 (\uc608: \ucfe0\ubc84\ub124\ud2f0\uc2a4 API Server) \uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ud655\uc7a5\ud558\ub294 \uac83\uc740 AWS\uc758 \ucc45\uc784\uc774\uc9c0\ub9cc \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ucc45\uc784\uac10 \uc788\uac8c \uc0ac\uc6a9\ud558\ub294 \uac83\uc740 \uc0ac\uc6a9\uc790\uc758 \ucc45\uc784\uc785\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\uc774\ud130 \ud50c\ub808\uc778 \uaddc\ubaa8 \uc870\uc815\uc740 \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ud544\uc694\ud55c AWS \ub9ac\uc18c\uc2a4\ub97c \ub2e4\ub8e8\uc9c0\ub9cc EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ubc97\uc5b4\ub0a9\ub2c8\ub2e4. EC2 \uc778\uc2a4\ud134\uc2a4, kublet, \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \ube44\ub86f\ud55c \ubaa8\ub4e0 \ub9ac\uc18c\uc2a4\ub294 \ud074\ub7ec\uc2a4\ud130 \ud655\uc7a5\uc5d0 \ub530\ub77c \ud655\uc7a5\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\ub294 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\uba70 \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uae30\ub2a5\uc744 \uc81c\uacf5\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864\ub7ec \ubc0f \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc785\ub2c8\ub2e4. \uc5ec\uae30\uc5d0\ub294 EKS \uc560\ub4dc\uc628\uc774 \ud3ec\ud568\ub420 \uc218 \uc788\uc73c\uba70 \uaddc\uc815 \uc900\uc218 \ubc0f \ud1b5\ud569\uc744 \uc704\ud574 \uc124\uce58\ud558\ub294 \uae30\ud0c0 \uc11c\ube44\uc2a4 \ub610\ub294 \ud5ec\ub984 \ucc28\ud2b8\ub3c4 \ud3ec\ud568\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc11c\ube44\uc2a4\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9c0\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc73c\uba70 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ud655\uc7a5\ub428\uc5d0 \ub530\ub77c \ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\ub3c4 \ud568\uaed8 \ud655\uc7a5\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc6cc\ud06c\ub85c\ub4dc\ub294 \ud074\ub7ec\uc2a4\ud130\uac00 \uc788\ub294 \uc774\uc720\uc774\uba70 \ud074\ub7ec\uc2a4\ud130\uc640 \ud568\uaed8 \uc218\ud3c9\uc73c\ub85c \ud655\uc7a5\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \ud655\uc7a5\uc5d0 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uc6cc\ud06c\ub85c\ub4dc \ud1b5\ud569 \ubc0f \uc124\uc815\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ubc0f \uc11c\ube44\uc2a4\uc640 \uac19\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucd94\uc0c1\ud654\uc5d0 \ub300\ud55c \uc544\ud0a4\ud14d\ucc98 \uace0\ub824 \uc0ac\ud56d\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/#_3","title":"\ucd08\ub300\ud615 \uc2a4\ucf00\uc77c\ub9c1","text":"<p>\ub2e8\uc77c \ud074\ub7ec\uc2a4\ud130\ub97c 1,000\uac1c \ub178\ub4dc \ub610\ub294 50,000\uac1c \uc774\uc0c1\uc758 \ud30c\ub4dc\ub85c \ud655\uc7a5\ud558\ub824\ub294 \uacbd\uc6b0 \ubb38\uc758\ud558\uace0 \uc2f6\uc2b5\ub2c8\ub2e4. \uc9c0\uc6d0 \ud300\uc774\ub098 \uae30\uc220 \uacc4\uc815 \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc5ec \uc774 \uac00\uc774\ub4dc\uc5d0 \uc81c\uacf5\ub41c \uc815\ubcf4 \uc774\uc0c1\uc73c\ub85c \uacc4\ud68d\ud558\uace0 \ud655\uc7a5\ud558\ub294 \ub370 \ub3c4\uc6c0\uc744 \uc904 \uc218 \uc788\ub294 \uc804\ubb38\uac00\uc5d0\uac8c \ubb38\uc758\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/cluster-services/","title":"\ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4","text":"<p>\ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\ub294 EKS \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\uc9c0\ub9cc \uc0ac\uc6a9\uc790 \uc6cc\ud06c\ub85c\ub4dc\ub294 \uc544\ub2d9\ub2c8\ub2e4. \ub9ac\ub205\uc2a4 \uc11c\ubc84\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc9c0\uc6d0\ud558\uae30 \uc704\ud574 NTP, syslog \ubc0f \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uacfc \uac19\uc740 \uc11c\ube44\uc2a4\ub97c \uc2e4\ud589\ud574\uc57c \ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\ub3c4 \ube44\uc2b7\ud558\uba70 \ud074\ub7ec\uc2a4\ud130\ub97c \uc790\ub3d9\ud654\ud558\uace0 \uc6b4\uc601\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub418\ub294 \uc11c\ube44\uc2a4\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc774\ub4e4\uc740 \uc77c\ubc18\uc801\uc73c\ub85c kube-system \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub418\uace0 \uc77c\ubd80\ub294 \ub370\ubaac\uc14b\ub85c \uc2e4\ud589\ub429\ub2c8\ub2e4.</p> <p>\ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\ub294 \uac00\ub3d9 \uc2dc\uac04\uc774 \uae38\uc5b4\uc9c8 \uac83\uc73c\ub85c \uc608\uc0c1\ub418\uba70 \uc815\uc804 \ubc0f \ubb38\uc81c \ud574\uacb0\uc5d0 \uc911\uc694\ud55c \uc5ed\ud560\uc744 \ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \ucf54\uc5b4 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0 \uc7a5\uc560 \ubcf5\uad6c \ub610\ub294 \uc608\ubc29\uc5d0 \ub3c4\uc6c0\uc774 \ub418\ub294 \ub370\uc774\ud130 (\uc608: \ub192\uc740 \ub514\uc2a4\ud06c \uc0ac\uc6a9\ub960)\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\uac8c \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcc4\ub3c4\uc758 \ub178\ub4dc \uadf8\ub8f9 \ub610\ub294 AWS Fargate\uc640 \uac19\uc740 \uc804\uc6a9 \ucef4\ud4e8\ud305 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc2e4\ud589\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uaddc\ubaa8\uac00 \ucee4\uc9c0\uac70\ub098 \ub9ac\uc18c\uc2a4\ub97c \ub354 \ub9ce\uc774 \uc0ac\uc6a9\ud558\ub294 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uacf5\uc720 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ubbf8\uce58\ub294 \uc601\ud5a5\uc744 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\uac00 \ubc1b\uc9c0 \uc54a\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/cluster-services/#coredns","title":"CoreDNS \uc2a4\ucf00\uc77c\ub9c1","text":"<p>CoreDNS \uc2a4\ucf00\uc77c\ub9c1\uc5d0\ub294 \ub450 \uac00\uc9c0 \uae30\ubcf8 \uba54\ucee4\ub2c8\uc998\uc774 \uc788\uc2b5\ub2c8\ub2e4. CoreDNS \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \ud638\ucd9c \uc218\ub97c \uc904\uc774\uace0 \ubcf5\uc81c\ubcf8 \uc218\ub97c \ub298\ub9bd\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/cluster-services/#ndot","title":"ndot\uc744 \uc904\uc5ec \uc678\ubd80 \ucffc\ub9ac\ub97c \uc904\uc785\ub2c8\ub2e4.","text":"<p>ndots \uc124\uc815\uc740 DNS \ucffc\ub9ac\ub97c \ud53c\ud558\uae30\uc5d0 \ucda9\ubd84\ud558\ub2e4\uace0 \uac04\uc8fc\ub418\ub294 \ub3c4\uba54\uc778 \uc774\ub984\uc758 \ub9c8\uce68\ud45c (\uc77c\uba85 \"\uc810\") \uc218\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 ndots \uc124\uc815\uc774 5 (\uae30\ubcf8\uac12) \uc774\uace0 api.example.com (\uc810 2\uac1c) \uacfc \uac19\uc740 \uc678\ubd80 \ub3c4\uba54\uc778\uc5d0\uc11c \ub9ac\uc18c\uc2a4\ub97c \uc694\uccad\ud558\ub294 \uacbd\uc6b0 /etc/resolv.conf\uc5d0 \uc815\uc758\ub41c \uac01 \uac80\uc0c9 \ub3c4\uba54\uc778\uc5d0 \ub300\ud574 CoreDNS\uac00 \ucffc\ub9ac\ub418\uc5b4 \ub354 \uad6c\uccb4\uc801\uc778 \ub3c4\uba54\uc778\uc774 \uac80\uc0c9\ub429\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \uc678\ubd80 \uc694\uccad\uc744 \ud558\uae30 \uc804\uc5d0 \ub2e4\uc74c \ub3c4\uba54\uc778\uc774 \uac80\uc0c9\ub429\ub2c8\ub2e4.</p> <pre><code>api.example.&lt;namespace&gt;.svc.cluster.local\napi.example.svc.cluster.local\napi.example.cluster.local\napi.example.&lt;region&gt;.compute.internal\n</code></pre> <p><code>namespace</code> \ubc0f <code>region</code> \uac12\uc740 \uc6cc\ud06c\ub85c\ub4dc \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ubc0f \ucef4\ud4e8\ud305 \uc9c0\uc5ed\uc73c\ub85c \ub300\uccb4\ub429\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc124\uc815\uc5d0 \ub530\ub77c \ucd94\uac00 \uac80\uc0c9 \ub3c4\uba54\uc778\uc774 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc6cc\ud06c\ub85c\ub4dc\uc758 ndots \uc635\uc158 \ub0ae\ucd94\uae30 \ub610\ub294 \ud6c4\ud589 \ud56d\ubaa9\uc744 \ud3ec\ud568\ud558\uc5ec \ub3c4\uba54\uc778 \uc694\uccad\uc744 \uc644\uc804\ud788 \uac80\uc99d\ud558\uc5ec CoreDNS\uc5d0 \ub300\ud55c \uc694\uccad \uc218\ub97c \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.(\uc608: <code>api.example.com.</code>). \uc6cc\ud06c\ub85c\ub4dc\uac00 DNS\ub97c \ud1b5\ud574 \uc678\ubd80 \uc11c\ube44\uc2a4\uc5d0 \uc5f0\uacb0\ud558\ub294 \uacbd\uc6b0 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ubd88\ud544\uc694\ud558\uac8c \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c DNS \ucffc\ub9ac\ub97c \ud074\ub7ec\uc2a4\ud130\ub9c1\ud558\uc9c0 \uc54a\ub3c4\ub85d ndots\ub97c 2\ub85c \uc124\uc815\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ud074\ub7ec\uc2a4\ud130 \ub0b4\ubd80 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\uac00 \ud544\uc694\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \ub2e4\ub978 DNS \uc11c\ubc84 \ubc0f \uac80\uc0c9 \ub3c4\uba54\uc778\uc744 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>spec:\n  dnsPolicy: \"None\"\n  dnsConfig:\n    options:\n      - name: ndots\n        value: \"2\"\n      - name: edns0\n</code></pre> <p>ndots\ub97c \ub108\ubb34 \ub0ae\uc740 \uac12\uc73c\ub85c \ub0ae\ucd94\uac70\ub098 \uc5f0\uacb0\ud558\ub824\ub294 \ub3c4\uba54\uc778\uc758 \uad6c\uccb4\uc131\uc774 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 (\ud6c4\ud589 \ud3ec\ud568) DNS \uc870\ud68c\uac00 \uc2e4\ud328\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uc774 \uc124\uc815\uc774 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc5b4\ub5a4 \uc601\ud5a5\uc744 \ubbf8\uce60\uc9c0 \ud14c\uc2a4\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/cluster-services/#coredns_1","title":"CoreDNS \uc218\ud3c9 \uc2a4\ucf00\uc77c\ub9c1","text":"<p>CoreDNS \uc778\uc2a4\ud134\uc2a4\ub294 \ubc30\ud3ec\uc5d0 \ubcf5\uc81c\ubcf8\uc744 \ucd94\uac00\ud558\uc5ec \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CoreDNS\ub97c \ud655\uc7a5\ud558\ub824\uba74 NodeLocal DNS \ub610\ub294 cluster proportional autoscaler\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>NodeLocal DNS\ub294 \ub178\ub4dc\ub2f9 \ud558\ub098\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \ub370\ubaac\uc14b\uc73c\ub85c \uc2e4\ud589\ud574\uc57c \ud558\uba70, \uc774\ub97c \uc704\ud574\uc11c\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub354 \ub9ce\uc740 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\uac00 \ud544\uc694\ud558\uc9c0\ub9cc DNS \uc694\uccad \uc2e4\ud328\ub97c \ubc29\uc9c0\ud558\uace0 \ud074\ub7ec\uc2a4\ud130\uc758 DNS \ucffc\ub9ac\uc5d0 \ub300\ud55c \uc751\ub2f5 \uc2dc\uac04\uc744 \uc904\uc785\ub2c8\ub2e4. Cluster propertional autoscaler\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \ub178\ub4dc \ub610\ub294 \ucf54\uc5b4 \uc218\uc5d0 \ub530\ub77c CoreDNS\uc758 \ud06c\uae30\ub97c \uc870\uc815\ud569\ub2c8\ub2e4. \uc774\ub294 \ucffc\ub9ac \uc694\uccad\uacfc \uc9c1\uc811\uc801\uc778 \uc0c1\uad00 \uad00\uacc4\ub294 \uc544\ub2c8\uc9c0\ub9cc \uc6cc\ud06c\ub85c\ub4dc \ubc0f \ud074\ub7ec\uc2a4\ud130 \ud06c\uae30\uc5d0 \ub530\ub77c \uc720\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8 \ube44\ub840 \ucc99\ub3c4\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 256\uac1c \ucf54\uc5b4 \ub610\ub294 16\uac1c \ub178\ub4dc\ub9c8\ub2e4 \ucd94\uac00 \ubcf5\uc81c\ubcf8\uc744 \ucd94\uac00\ud558\ub294 \uac83\uc785\ub2c8\ub2e4(\ub458 \uc911 \uba3c\uc800 \ubc1c\uc0dd\ud558\ub294 \uae30\uc900).</p>"},{"location":"ko/scalability/docs/cluster-services/#metric-server","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 Metric Server \uc218\uc9c1 \ud655\uc7a5","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 Metric Server\ub294 \uc218\ud3c9 \ubc0f \uc218\uc9c1 \ud655\uc7a5\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. Metric Server\ub97c \uc218\ud3c9\uc801\uc73c\ub85c \ud655\uc7a5\ud558\uba74 \uac00\uc6a9\uc131\uc740 \ub192\uc544\uc9c0\uc9c0\ub9cc \ub354 \ub9ce\uc740 \ud074\ub7ec\uc2a4\ud130 \uba54\ud2b8\ub9ad\uc744 \ucc98\ub9ac\ud560 \uc218 \uc788\uc744 \ub9cc\ud07c \uc218\ud3c9\uc801\uc73c\ub85c \ud655\uc7a5\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \ub178\ub4dc\uc640 \uc218\uc9d1\ub41c \uc9c0\ud45c\uac00 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ucd94\uac00\ub428\uc5d0 \ub530\ub77c \uad8c\uc7a5 \uc0ac\ud56d\uc5d0 \ub530\ub77c \uba54\ud2b8\ub9ad \uc11c\ubc84\ub97c \uc218\uc9c1\uc73c\ub85c \ud655\uc7a5\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>Metric Server\ub294 \uc218\uc9d1, \uc9d1\uacc4 \ubc0f \uc81c\uacf5\ud558\ub294 \ub370\uc774\ud130\ub97c \uba54\ubaa8\ub9ac\uc5d0 \ubcf4\uad00\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uac00 \ucee4\uc9c0\uba74 Metric Server\uac00 \uc800\uc7a5\ud558\ub294 \ub370\uc774\ud130 \uc591\ub3c4 \ub298\uc5b4\ub0a9\ub2c8\ub2e4. \ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c Metric Server\ub294 \uae30\ubcf8 \uc124\uce58\uc5d0 \uc9c0\uc815\ub41c \uba54\ubaa8\ub9ac \ubc0f CPU \uc608\uc57d\ub7c9\ubcf4\ub2e4 \ub354 \ub9ce\uc740 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\ub97c \ud544\uc694\ub85c \ud569\ub2c8\ub2e4.Vertical Pod Autoscaler(VPA) \ub610\ub294 Addon Resizer\ub97c \uc0ac\uc6a9\ud558\uc5ec Metric Server\ub97c \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Addon Resizer\ub294 Worker \ub178\ub4dc\uc5d0 \ube44\ub840\ud558\uc5ec \uc218\uc9c1\uc73c\ub85c \ud655\uc7a5\ub418\uace0 VPA\ub294 CPU \ubc0f \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc5d0 \ub530\ub77c \uc870\uc815\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/cluster-services/#coredns-lameduck","title":"CoreDNS lameduck \uc9c0\uc18d \uc2dc\uac04","text":"<p>\ud30c\ub4dc\ub294 \uc774\ub984 \ud655\uc778\uc744 \uc704\ud574 <code>kube-dns</code> \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 Destination NAT (DNAT) \ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\uc5d0\uc11c CoreDNS \ubc31\uc5d4\ub4dc \ud30c\ub4dc\ub85c <code>kube-dns</code> \ud2b8\ub798\ud53d\uc744 \ub9ac\ub514\ub809\uc158\ud569\ub2c8\ub2e4. CoreDNS Deployment\ub97c \ud655\uc7a5\ud558\uba74, <code>kube-proxy</code>\ub294 \ub178\ub4dc\uc758 iptables \uaddc\uce59 \ubc0f \uccb4\uc778\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\uc5ec DNS \ud2b8\ub798\ud53d\uc744 CoreDNS \ud30c\ub4dc\ub85c \ub9ac\ub514\ub809\uc158\ud569\ub2c8\ub2e4. \ud655\uc7a5 \uc2dc \uc0c8 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc804\ud30c\ud558\uace0 \ucd95\uc18c\ud560 \ub54c \uaddc\uce59\uc744 \uc0ad\uc81c\ud558\ub294\ub370 \ud074\ub7ec\uc2a4\ud130 \ud06c\uae30\uc5d0 \ub530\ub77c CoreDNS\ub97c \uc0ad\uc81c\ud558\ub294 \ub370 1~10\ucd08 \uc815\ub3c4 \uac78\ub9b4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\uc774\ub7ec\ud55c \uc804\ud30c \uc9c0\uc5f0\uc73c\ub85c \uc778\ud574 CoreDNS \ud30c\ub4dc\uac00 \uc885\ub8cc\ub418\uc5c8\uc9c0\ub9cc \ub178\ub4dc\uc758 iptables \uaddc\uce59\uc774 \uc5c5\ub370\uc774\ud2b8\ub418\uc9c0 \uc54a\uc740 \uacbd\uc6b0 DNS \uc870\ud68c \uc624\ub958\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc2dc\ub098\ub9ac\uc624\uc5d0\uc11c \ub178\ub4dc\ub294 \uc885\ub8cc\ub41c CoreDNS \ud30c\ub4dc\uc5d0 DNS \ucffc\ub9ac\ub97c \uacc4\uc18d \uc804\uc1a1\ud560 \uc218 \uc788\ub2e4.</p> <p>CoreDNS \ud30c\ub4dc\uc5d0 lameduck \uae30\uac04\uc744 \uc124\uc815\ud558\uc5ec DNS \uc870\ud68c \uc2e4\ud328\ub97c \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. Lameduck \ubaa8\ub4dc\uc5d0 \uc788\ub294 \ub3d9\uc548 CoreDNS\ub294 \uacc4\uc18d\ud574\uc11c \uc9c4\ud589 \uc911\uc778 \uc694\uccad\uc5d0 \uc751\ub2f5\ud569\ub2c8\ub2e4.Lameduck \uae30\uac04\uc744 \uc124\uc815\ud558\uba74 CoreDNS \uc885\ub8cc \ud504\ub85c\uc138\uc2a4\uac00 \uc9c0\uc5f0\ub418\uc5b4 \ub178\ub4dc\uac00 iptables \uaddc\uce59 \ubc0f \uccb4\uc778\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \ub370 \ud544\uc694\ud55c \uc2dc\uac04\uc744 \ud655\ubcf4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>CoreDNS lameduck \uc9c0\uc18d \uc2dc\uac04\uc744 30\ucd08\ub85c \uc124\uc815\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/cluster-services/#coredns-readiness","title":"CoreDNS readiness \ud504\ub85c\ube0c","text":"<p>CoreDNS\uc758 Readiness \ud504\ub85c\ube0c\uc5d0\ub294 <code>/health</code> \ub300\uc2e0 <code>/ready</code>\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \ucd94\ucc9c\ud569\ub2c8\ub2e4.</p> <p>Lameduck \uc9c0\uc18d \uc2dc\uac04\uc744 30\ucd08\ub85c \uc124\uc815\ud558\ub77c\ub294 \uc774\uc804 \uad8c\uc7a5 \uc0ac\ud56d\uc5d0 \ub530\ub77c, \ud30c\ub4dc \uc885\ub8cc \uc804\uc5d0 \ub178\ub4dc\uc758 iptables \uaddc\uce59\uc744 \uc5c5\ub370\uc774\ud2b8\ud560 \uc218 \uc788\ub294 \ucda9\ubd84\ud55c \uc2dc\uac04\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. CoreDNS \uc900\ube44 \uc0c1\ud0dc \ud504\ub85c\ube0c\uc5d0 <code>/health</code> \ub300\uc2e0 `/ready'\ub97c \uc0ac\uc6a9\ud558\uba74 \uc2dc\uc791 \uc2dc CoreDNS \ud30c\ub4dc\uac00 DNS \uc694\uccad\uc5d0 \uc989\uc2dc \uc751\ub2f5\ud560 \uc218 \uc788\ub3c4\ub85d \uc644\ubcbd\ud558\uac8c \uc900\ube44\ub429\ub2c8\ub2e4.</p> <pre><code>readinessProbe:\n  httpGet:\n    path: /ready\n    port: 8181\n    scheme: HTTP\n</code></pre> <p>CoreDNS Ready \ud50c\ub7ec\uadf8\uc778\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 https://coredns.io/plugins/ready/ \uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/scalability/docs/cluster-services/#_2","title":"\ub85c\uae45 \ubc0f \ubaa8\ub2c8\ud130\ub9c1 \uc5d0\uc774\uc804\ud2b8","text":"<p>\ub85c\uae45 \ubc0f \ubaa8\ub2c8\ud130\ub9c1 \uc5d0\uc774\uc804\ud2b8\ub294 API \uc11c\ubc84\ub97c \ucffc\ub9ac\ud558\uc5ec \uc6cc\ud06c\ub85c\ub4dc \uba54\ud0c0\ub370\uc774\ud130\ub85c \ub85c\uadf8\uc640 \uba54\ud2b8\ub9ad\uc744 \ubcf4\uac15\ud558\ubbc0\ub85c \ud074\ub7ec\uc2a4\ud130 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \uc0c1\ub2f9\ud55c \ub85c\ub4dc\ub97c \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc\uc758 \uc5d0\uc774\uc804\ud2b8\ub294 \ucee8\ud14c\uc774\ub108 \ubc0f \ud504\ub85c\uc138\uc2a4 \uc774\ub984\uacfc \uac19\uc740 \ud56d\ubaa9\uc744 \ubcf4\uae30 \uc704\ud574 \ub85c\uceec \ub178\ub4dc \ub9ac\uc18c\uc2a4\uc5d0\ub9cc \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. API \uc11c\ubc84\ub97c \ucffc\ub9ac\ud558\uba74 Kubernetes Deployment \uc774\ub984 \ubc0f \ub808\uc774\ube14\uacfc \uac19\uc740 \uc138\ubd80 \uc815\ubcf4\ub97c \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \ubb38\uc81c \ud574\uacb0\uc5d0\ub294 \ub9e4\uc6b0 \uc720\uc6a9\ud558\uc9c0\ub9cc \ud655\uc7a5\uc5d0\ub294 \ud574\ub85c\uc6b8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub85c\uae45 \ubc0f \ubaa8\ub2c8\ud130\ub9c1\uc5d0 \ub300\ud55c \uc635\uc158\uc774 \ub108\ubb34 \ub2e4\uc591\ud558\uae30 \ub54c\ubb38\uc5d0 \ubaa8\ub4e0 \uacf5\uae09\uc790\uc5d0 \ub300\ud55c \uc608\ub97c \ud45c\uc2dc\ud560 \uc218\ub294 \uc5c6\uc2b5\ub2c8\ub2e4. fluentbit\ub97c \uc0ac\uc6a9\ud558\uba74 Use_Kubelet\uc744 \ud65c\uc131\ud654\ud558\uc5ec Kubernetes API \uc11c\ubc84 \ub300\uc2e0 \ub85c\uceec kubelet\uc5d0\uc11c \uba54\ud0c0\ub370\uc774\ud130\ub97c \uac00\uc838\uc624\uace0 <code>Kube_Meta_Cache_TTL</code>\uc744 \uc904\uc774\ub294 \uc22b\uc790\ub85c \uc124\uc815\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub370\uc774\ud130\ub97c \uce90\uc2dc\ud560 \uc218 \uc788\uc744 \ub54c \ud638\ucd9c\uc744 \ubc18\ubcf5\ud569\ub2c8\ub2e4(\uc608: 60).</p> <p>\uc870\uc815 \ubaa8\ub2c8\ud130\ub9c1 \ubc0f \ub85c\uae45\uc5d0\ub294 \ub450 \uac00\uc9c0 \uc77c\ubc18 \uc635\uc158\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\ud1b5\ud569 \ube44\ud65c\uc131\ud654</li> <li>\uc0d8\ud50c\ub9c1 \ubc0f \ud544\ud130\ub9c1</li> </ul> <p>\ub85c\uadf8 \uba54\ud0c0\ub370\uc774\ud130\uac00 \uc190\uc2e4\ub418\ubbc0\ub85c \ud1b5\ud569\uc744 \ube44\ud65c\uc131\ud654\ud558\ub294 \uac83\uc774 \uc635\uc158\uc774 \uc544\ub2cc \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 API \ud655\uc7a5 \ubb38\uc81c\uac00 \uc81c\uac70\ub418\uc9c0\ub9cc \ud544\uc694\ud560 \ub54c \ud544\uc694\ud55c \uba54\ud0c0\ub370\uc774\ud130\uac00 \uc5c6\uc5b4 \ub2e4\ub978 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.</p> <p>\uc0d8\ud50c\ub9c1 \ubc0f \ud544\ud130\ub9c1\uc744 \uc218\ud589\ud558\uba74 \uc218\uc9d1\ub418\ub294 \uc9c0\ud45c \ubc0f \ub85c\uadf8 \uc218\uac00 \uc904\uc5b4\ub4ed\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 Kubernetes API\uc5d0 \ub300\ud55c \uc694\uccad \uc591\uc774 \uc904\uc5b4\ub4e4\uace0 \uc218\uc9d1\ub418\ub294 \uc9c0\ud45c \ubc0f \ub85c\uadf8\uc5d0 \ud544\uc694\ud55c \uc2a4\ud1a0\ub9ac\uc9c0 \uc591\uc774 \uc904\uc5b4\ub4ed\ub2c8\ub2e4. \uc2a4\ud1a0\ub9ac\uc9c0 \ube44\uc6a9\uc744 \uc904\uc774\uba74 \uc804\uccb4 \uc2dc\uc2a4\ud15c \ube44\uc6a9\ub3c4 \ub0ae\uc544\uc9d1\ub2c8\ub2e4.</p> <p>\uc0d8\ud50c\ub9c1\uc744 \uad6c\uc131\ud558\ub294 \uae30\ub2a5\uc740 \uc5d0\uc774\uc804\ud2b8 \uc18c\ud504\ud2b8\uc6e8\uc5b4\uc5d0 \ub530\ub77c \ub2e4\ub974\uba70 \ub2e4\uc591\ud55c \uc218\uc9d1 \uc9c0\uc810\uc5d0\uc11c \uad6c\ud604\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. API \uc11c\ubc84 \ud638\ucd9c\uc774 \ubc1c\uc0dd\ud560 \uac00\ub2a5\uc131\uc774 \ub192\uae30 \ub54c\ubb38\uc5d0 \uc5d0\uc774\uc804\ud2b8\uc5d0 \ucd5c\ub300\ud55c \uac00\uae5d\uac8c \uc0d8\ud50c\ub9c1\uc744 \ucd94\uac00\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. \uc0d8\ud50c\ub9c1 \uc9c0\uc6d0\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\ub824\uba74 \uacf5\uae09\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc138\uc694.</p> <p>CloudWatch \ubc0f CloudWatch Logs\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ubb38\uc11c\uc5d0 \uc124\uba85\ub41c \ud328\ud134\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc5d0\uc774\uc804\ud2b8 \ud544\ud130\ub9c1\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub85c\uadf8 \ubc0f \uc9c0\ud45c \uc190\uc2e4\uc744 \ubc29\uc9c0\ud558\ub824\uba74 \uc218\uc2e0 \ubc1b\ub294 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0\uc11c \uc911\ub2e8\uc774 \ubc1c\uc0dd\ud560 \uacbd\uc6b0 \ub370\uc774\ud130\ub97c \ubc84\ud37c\ub9c1\ud560 \uc218 \uc788\ub294 \uc2dc\uc2a4\ud15c\uc73c\ub85c \ub370\uc774\ud130\ub97c \ubcf4\ub0b4\uc57c \ud569\ub2c8\ub2e4. Fluentbit\ub97c \uc0ac\uc6a9\ud558\uba74 Amazon Kinesis Data Firehose\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub370\uc774\ud130\ub97c \uc784\uc2dc\ub85c \ubcf4\uad00\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \ucd5c\uc885 \ub370\uc774\ud130 \uc800\uc7a5 \uc704\uce58\uc5d0 \uacfc\ubd80\ud558\uac00 \uac78\ub9b4 \uac00\ub2a5\uc131\uc774 \uc904\uc5b4\ub4ed\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API Server, \ucfe0\ubc84\ub124\ud2f0\uc2a4 Controller Manager, Scheduler \ubc0f \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc791\ub3d9\ud558\ub294 \ub370 \ud544\uc694\ud55c \uae30\ud0c0 \uad6c\uc131 \uc694\uc18c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uad6c\uc131 \uc694\uc18c\uc758 \ud655\uc7a5\uc131 \uc81c\ud55c\uc740 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ud56d\ubaa9\uc5d0 \ub530\ub77c \ub2e4\ub974\uc9c0\ub9cc \ud655\uc7a5\uc5d0 \uac00\uc7a5 \ud070 \uc601\ud5a5\uc744 \ubbf8\uce58\ub294 \uc601\uc5ed\uc5d0\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804, \uc0ac\uc6a9\ub960 \ubc0f \uac1c\ubcc4 \ub178\ub4dc \ud655\uc7a5\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#eks-124","title":"EKS 1.24 \uc774\uc0c1\uc744 \uc0ac\uc6a9\ud558\uc138\uc694","text":"<p>EKS 1.24\uc5d0\ub294 \uc5ec\ub7ec \uac00\uc9c0 \ubcc0\uacbd \uc0ac\ud56d\uc774 \ub3c4\uc785\ub418\uc5c8\uc73c\uba70 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc744 docker \ub300\uc2e0 containerd\ub85c \uc804\ud658\ud588\uc2b5\ub2c8\ub2e4. Containerd\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uc694\uad6c \uc0ac\ud56d\uc5d0 \uae34\ubc00\ud558\uac8c \ub9de\ucdb0 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784 \uae30\ub2a5\uc744 \uc81c\ud55c\ud558\uc5ec \uac1c\ubcc4 \ub178\ub4dc \uc131\ub2a5\uc744 \ub192\uc5ec \ud074\ub7ec\uc2a4\ud130 \ud655\uc7a5\uc744 \ub3d5\uc2b5\ub2c8\ub2e4. Containerd\ub294 \uc9c0\uc6d0\ub418\ub294 \ubaa8\ub4e0 EKS \ubc84\uc804\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc73c\uba70, 1.24 \uc774\uc804 \ubc84\uc804\uc5d0\uc11c Containerd\ub85c \uc804\ud658\ud558\ub824\uba74 <code>--container-runtime</code> bootstrap flag\ub97c \uc0ac\uc6a9\ud558\uc138\uc694.</p>"},{"location":"ko/scalability/docs/control-plane/#_2","title":"\uc6cc\ud06c\ub85c\ub4dc \ubc0f \ub178\ub4dc \ubc84\uc2a4\ud305 \uc81c\ud55c","text":"<p>Attention</p> <p>\ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0\uc11c API \ud55c\ub3c4\uc5d0 \ub3c4\ub2ec\ud558\uc9c0 \uc54a\uc73c\ub824\uba74 \ud074\ub7ec\uc2a4\ud130 \ud06c\uae30\ub97c \ud55c \ubc88\uc5d0 \ub450 \uc790\ub9bf\uc218 \ube44\uc728\ub85c \ub298\ub9ac\ub294 \uae09\uaca9\ud55c \ud655\uc7a5\uc744 \uc81c\ud55c\ud574\uc57c \ud569\ub2c8\ub2e4(\uc608: \ud55c \ubc88\uc5d0 1000\uac1c \ub178\ub4dc\uc5d0\uc11c 1100\uac1c \ub178\ub4dc\ub85c \ub610\ub294 4000\uac1c\uc5d0\uc11c 4500\uac1c \ud30c\ub4dc\ub85c).</p> <p>EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 \ud074\ub7ec\uc2a4\ud130\uac00 \uc131\uc7a5\ud568\uc5d0 \ub530\ub77c \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ub418\uc9c0\ub9cc \ud655\uc7a5 \uc18d\ub3c4\uc5d0\ub294 \uc81c\ud55c\uc774 \uc788\uc2b5\ub2c8\ub2e4. EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ucc98\uc74c \uc0dd\uc131\ud560 \ub54c \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 \uc989\uc2dc \uc218\ubc31 \uac1c\uc758 \ub178\ub4dc \ub610\ub294 \uc218\ucc9c \uac1c\uc758 \ud30c\ub4dc\ub85c \ud655\uc7a5\ub420 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. EKS\uc758 \uc2a4\ucf00\uc77c\ub9c1 \uac1c\uc120 \ubc29\ubc95\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\ub824\uba74 \uc774 \ube14\ub85c\uadf8 \uac8c\uc2dc\ubb3c\uc744 \ucc38\uc870\ud558\uc138\uc694.</p> <p>\ub300\uaddc\ubaa8 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud655\uc7a5\ud558\ub824\uba74 \uc778\ud504\ub77c\uac00 \uc644\ubcbd\ud558\uac8c \uc900\ube44\ub418\ub3c4\ub85d \uc870\uc815\ud574\uc57c \ud569\ub2c8\ub2e4(\uc608: \ub85c\ub4dc \ubc38\ub7f0\uc11c \uc6cc\ubc0d). \ud655\uc7a5 \uc18d\ub3c4\ub97c \uc81c\uc5b4\ud558\ub824\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \uc801\ud569\ud55c \uce21\uc815 \uc9c0\ud45c\ub97c \uae30\ubc18\uc73c\ub85c \ud655\uc7a5\ud558\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. CPU \ubc0f \uba54\ubaa8\ub9ac \ud655\uc7a5\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc81c\uc57d \uc870\uac74\uc744 \uc815\ud655\ud558\uac8c \uc608\uce21\ud558\uc9c0 \ubabb\ud560 \uc218 \uc788\uc73c\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 HPA(Horizontal Pod Autoscaler)\uc5d0\uc11c \uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc9c0\ud45c(\uc608: \ucd08\ub2f9 \uc694\uccad)\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ub354 \ub098\uc740 \ud655\uc7a5 \uc635\uc158\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc0ac\uc6a9\uc790 \uc815\uc758 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c\uc758 \uc608\ub97c \ucc38\uc870\ud558\uc138\uc694. \uace0\uae09 \ud655\uc7a5\uc774 \ud544\uc694\ud558\uac70\ub098 \uc678\ubd80 \uc18c\uc2a4(\uc608: AWS SQS \ub300\uae30\uc5f4)\ub97c \uae30\ubc18\uc73c\ub85c \ud655\uc7a5\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \uc774\ubca4\ud2b8 \uae30\ubc18 \uc6cc\ud06c\ub85c\ub4dc \ud655\uc7a5\uc744 \uc704\ud574 KEDA\ub97c \uc0ac\uc6a9\ud558\uc138\uc694.</p>"},{"location":"ko/scalability/docs/control-plane/#_3","title":"\ub178\ub4dc\uc640 \ud30c\ub4dc\ub97c \uc548\uc804\ud558\uac8c \ucd95\uc18c","text":""},{"location":"ko/scalability/docs/control-plane/#_4","title":"\uc7a5\uae30 \uc2e4\ud589 \uc778\uc2a4\ud134\uc2a4 \uad50\uccb4","text":"<p>\uc815\uae30\uc801\uc73c\ub85c \ub178\ub4dc\ub97c \uad50\uccb4\ud558\uba74 \uad6c\uc131 \ub4dc\ub9ac\ud504\ud2b8\uc640 \uac00\ub3d9 \uc2dc\uac04\uc774 \uc5f0\uc7a5\ub41c \ud6c4\uc5d0\ub9cc \ubc1c\uc0dd\ud558\ub294 \ubb38\uc81c(\uc608: \ub290\ub9b0 \uba54\ubaa8\ub9ac \ub204\uc218)\ub97c \ubc29\uc9c0\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\ub97c \uac74\uac15\ud55c \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\ub3d9 \uad50\uccb4\ub294 \ub178\ub4dc \uc5c5\uadf8\ub808\uc774\ub4dc \ubc0f \ubcf4\uc548 \ud328\uce58\uc5d0 \ub300\ud55c \uc88b\uc740 \ud504\ub85c\uc138\uc2a4\uc640 \uc0ac\ub840\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc758 \ubaa8\ub4e0 \ub178\ub4dc\uac00 \uc815\uae30\uc801\uc73c\ub85c \uad50\uccb4\ub418\uba74 \uc9c0\uc18d\uc801\uc778 \uc720\uc9c0 \uad00\ub9ac\ub97c \uc704\ud574 \ubcc4\ub3c4\uc758 \ud504\ub85c\uc138\uc2a4\ub97c \uc720\uc9c0\ud558\ub294 \ub370 \ud544\uc694\ud55c \ub178\ub825\uc774 \uc904\uc5b4\ub4ed\ub2c8\ub2e4.</p> <p>Karpenter\uc758 Time To Live (TTL) \uc124\uc815\uc744 \ud1b5\ud574 \uc9c0\uc815\ub41c \uc2dc\uac04 \ub3d9\uc548 \uc778\uc2a4\ud134\uc2a4\uac00 \uc2e4\ud589\ub41c \ud6c4 \uc778\uc2a4\ud134\uc2a4\ub97c \uad50\uccb4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 <code>max-instance-lifetime</code> \uc124\uc815\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \uad50\uccb4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc5d0\ub294 \ud604\uc7ac \uc774 \uae30\ub2a5\uc774 \uc5c6\uc9c0\ub9cc \uc5ec\uae30 GitHub\uc5d0\uc11c \uc694\uccad\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#_5","title":"\ud65c\uc6a9\ub3c4\uac00 \ub0ae\uc740 \ub178\ub4dc \uc81c\uac70","text":"<p><code>--scale-down-utilization-threshold</code>\ub97c \ud1b5\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler\uc758 \ucd95\uc18c \uc784\uacc4\uac12\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc2e4\ud589 \uc911\uc778 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc5c6\uc744 \ub54c \ub178\ub4dc\ub97c \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ub294 Karpenter\uc5d0\uc11c <code>ttlSecondsAfterEmpty</code> \ud504\ub85c\ube44\uc800\ub108 \uc124\uc815\uc744 \ud65c\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#pod-distruption-budgets","title":"Pod Distruption Budgets \ubc0f \uc548\uc804\ud55c \ub178\ub4dc \uc167\ub2e4\uc6b4 \uc0ac\uc6a9","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud30c\ub4dc\uc640 \ub178\ub4dc\ub97c \uc81c\uac70\ud558\ub824\uba74 \ucee8\ud2b8\ub864\ub7ec\uac00 \uc5ec\ub7ec \ub9ac\uc18c\uc2a4(\uc608: EndpointSlices)\ub97c \uc5c5\ub370\uc774\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774 \uc791\uc5c5\uc744 \uc790\uc8fc \ub610\ub294 \ub108\ubb34 \ube60\ub974\uac8c \uc218\ud589\ud558\uba74 \ubcc0\uacbd \uc0ac\ud56d\uc774 \ucee8\ud2b8\ub864\ub7ec\uc5d0 \uc804\ud30c\ub418\uba74\uc11c API Server \uc4f0\ub85c\ud2c0\ub9c1 \ubc0f \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc911\ub2e8\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Pod Distruption Budgets\uc740 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ub178\ub4dc\uac00 \uc81c\uac70\ub418\uac70\ub098 \uc2a4\ucf00\uc904\uc774 \uc870\uc815\ub420 \ub54c \ubcc0\ub3d9 \uc18d\ub3c4\ub97c \ub2a6\ucd94\uc5b4 \uc6cc\ud06c\ub85c\ub4dc \uac00\uc6a9\uc131\uc744 \ubcf4\ud638\ud558\ub294 \ubaa8\ubc94 \uc0ac\ub840\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#kubectl","title":"Kubectl \uc2e4\ud589 \uc2dc \ud074\ub77c\uc774\uc5b8\ud2b8\uce21 \uce90\uc2dc \uc0ac\uc6a9","text":"<p>kubectl \uba85\ub839\uc744 \ube44\ud6a8\uc728\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API Server\uc5d0 \ucd94\uac00 \ub85c\ub4dc\uac00 \ubc1c\uc0dd\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. kubectl\uc744 \ubc18\ubcf5\uc801\uc73c\ub85c(\uc608: for \ub8e8\ud504\uc5d0\uc11c) \uc0ac\uc6a9\ud558\ub294 \uc2a4\ud06c\ub9bd\ud2b8\ub098 \uc790\ub3d9\ud654\ub97c \uc2e4\ud589\ud558\uac70\ub098 \ub85c\uceec \uce90\uc2dc \uc5c6\uc774 \uba85\ub839\uc744 \uc2e4\ud589\ud558\ub294 \uac83\uc744 \ud53c\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p><code>kubectl</code>\uc5d0\ub294 \ud544\uc694\ud55c API \ud638\ucd9c \uc591\uc744 \uc904\uc774\uae30 \uc704\ud574 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uac80\uc0c9 \uc815\ubcf4\ub97c \uce90\uc2dc\ud558\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8 \uce21 \uce90\uc2dc\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uce90\uc2dc\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ud65c\uc131\ud654\ub418\uc5b4 \uc788\uc73c\uba70 10\ubd84\ub9c8\ub2e4 \uc0c8\ub85c \uace0\uccd0\uc9d1\ub2c8\ub2e4.</p> <p>\ucee8\ud14c\uc774\ub108\uc5d0\uc11c \ub610\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8 \uce21 \uce90\uc2dc \uc5c6\uc774 kubectl\uc744 \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 API \uc4f0\ub85c\ud2c0\ub9c1 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubd88\ud544\uc694\ud55c API \ud638\ucd9c\uc744 \ud53c\ud558\uae30 \uc704\ud574 <code>--cache-dir</code>\uc744 \ub9c8\uc6b4\ud2b8\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \uce90\uc2dc\ub97c \uc720\uc9c0\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#kubectl-compression","title":"kubectl Compression \ube44\ud65c\uc131\ud654","text":"<p>kubeconfig \ud30c\uc77c\uc5d0\uc11c kubectl compression\uc744 \ube44\ud65c\uc131\ud654\ud558\uba74 API \ubc0f \ud074\ub77c\uc774\uc5b8\ud2b8 CPU \uc0ac\uc6a9\ub7c9\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \uc11c\ubc84\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \uc804\uc1a1\ub41c \ub370\uc774\ud130\ub97c \uc555\ucd95\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \ub300\uc5ed\ud3ed\uc744 \ucd5c\uc801\ud654\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc694\uccad\ub9c8\ub2e4 \ud074\ub77c\uc774\uc5b8\ud2b8\uc640 \uc11c\ubc84\uc5d0 CPU \ubd80\ud558\uac00 \uac00\uc911\ub418\uba70, \ub300\uc5ed\ud3ed\uc774 \ucda9\ubd84\ud558\ub2e4\uba74 \uc555\ucd95\uc744 \ube44\ud65c\uc131\ud654\ud558\uba74 \uc624\ubc84\ud5e4\ub4dc\uc640 \uc9c0\uc5f0 \uc2dc\uac04\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc555\ucd95\uc744 \ube44\ud65c\uc131\ud654\ud558\ub824\uba74 kubeconfig \ud30c\uc77c\uc5d0\uc11c <code>--disable-compression=true</code> \ud50c\ub798\uadf8\ub97c \uc0ac\uc6a9\ud558\uac70\ub098 <code>disable-compression: true</code>\ub85c \uc124\uc815\ud558\uba74 \ub429\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    server: serverURL\n    disable-compression: true\n  name: cluster\n</code></pre>"},{"location":"ko/scalability/docs/control-plane/#cluster-autoscaler","title":"Cluster Autoscaler \uc0e4\ub529","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler\ub294 \ud14c\uc2a4\ud2b8\ub97c \uac70\ucce4\uc2b5\ub2c8\ub2e4. \ucd5c\ub300 1,000\uac1c \ub178\ub4dc\uae4c\uc9c0 \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. 1000\uac1c \uc774\uc0c1\uc758 \ub178\ub4dc\uac00 \uc788\ub294 \ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c\ub294 Cluster AutoScaler\ub97c \uc5ec\ub7ec \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc0e4\ub4dc \ubaa8\ub4dc\ub85c \uc2e4\ud589\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uac01 \ud074\ub7ec\uc2a4\ud130 \uc624\ud1a0\uc2a4\ucf00\uc77c\ub7ec \uc778\uc2a4\ud134\uc2a4\ub294 \ub178\ub4dc \uadf8\ub8f9 \uc138\ud2b8\ub97c \ud655\uc7a5\ud558\ub3c4\ub85d \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \uc608\ub294 \uac01 4\uac1c\uc758 \ub178\ub4dc \uadf8\ub8f9\uc5d0 \uad6c\uc131\ub41c 2\uac1c\uc758 \ud074\ub7ec\uc2a4\ud130 \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \uad6c\uc131\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4.</p> <p>ClusterAutoscaler-1</p> <pre><code>autoscalingGroups:\n- name: eks-core-node-grp-20220823190924690000000011-80c1660e-030d-476d-cb0d-d04d585a8fcb\n  maxSize: 50\n  minSize: 2\n- name: eks-data_m1-20220824130553925600000011-5ec167fa-ca93-8ca4-53a5-003e1ed8d306\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m2-20220824130733258600000015-aac167fb-8bf7-429d-d032-e195af4e25f5\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m3-20220824130553914900000003-18c167fa-ca7f-23c9-0fea-f9edefbda002\n  maxSize: 450\n  minSize: 2\n</code></pre> <p>ClusterAutoscaler-2</p> <pre><code>autoscalingGroups:\n- name: eks-data_m4-2022082413055392550000000f-5ec167fa-ca86-6b83-ae9d-1e07ade3e7c4\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m5-20220824130744542100000017-02c167fb-a1f7-3d9e-a583-43b4975c050c\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m6-2022082413055392430000000d-9cc167fa-ca94-132a-04ad-e43166cef41f\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m7-20220824130553921000000009-96c167fa-ca91-d767-0427-91c879ddf5af\n  maxSize: 450\n  minSize: 2\n</code></pre>"},{"location":"ko/scalability/docs/control-plane/#_6","title":"\uac1c\uc694","text":"<p>\uc694\uccad\uc774 \uc99d\uac00\ud558\ub294 \uae30\uac04 \ub3d9\uc548 \uacfc\ubd80\ud558\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub3c4\ub85d \ubcf4\ud638\ud558\uae30 \uc704\ud574 API \uc11c\ubc84\ub294 \ud2b9\uc815 \uc2dc\uac04\uc5d0 \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 \uc9c4\ud589 \uc911\uc778 \uc694\uccad \uc218\ub97c \uc81c\ud55c\ud569\ub2c8\ub2e4. \uc774 \uc81c\ud55c\uc744 \ucd08\uacfc\ud558\uba74 API \uc11c\ubc84\ub294 \uc694\uccad\uc744 \uac70\ubd80\ud558\uae30 \uc2dc\uc791\ud558\uace0 \"Too many requests\"\uc5d0 \ub300\ud55c 429 HTTP \uc751\ub2f5 \ucf54\ub4dc\ub97c \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \ubc18\ud658\ud569\ub2c8\ub2e4. \uc11c\ubc84\uac00 \uc694\uccad\uc744 \uc0ad\uc81c\ud558\uace0 \ud074\ub77c\uc774\uc5b8\ud2b8\uac00 \ub098\uc911\uc5d0 \ub2e4\uc2dc \uc2dc\ub3c4\ud558\ub3c4\ub85d \ud558\ub294 \uac83\uc774 \uc694\uccad \uc218\uc5d0 \ub300\ud55c \uc11c\ubc84 \uce21 \uc81c\ud55c\uc744 \ub450\uc9c0 \uc54a\uace0 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \uacfc\ubd80\ud558\ub97c \uc8fc\uc5b4 \uc131\ub2a5\uc774 \uc800\ud558\ub418\uac70\ub098 \uac00\uc6a9\uc131\uc774 \uc800\ud558\ub420 \uc218 \uc788\ub294 \uac83\ubcf4\ub2e4 \ub354 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>\uc774\ub7ec\ud55c \uc9c4\ud589 \uc911\uc778 \uc694\uccad\uc774 \ub2e4\uc591\ud55c \uc694\uccad \uc720\ud615\uc73c\ub85c \ub098\ub204\uc5b4\uc9c0\ub294 \ubc29\uc2dd\uc744 \uad6c\uc131\ud558\uae30 \uc704\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \uba54\ucee4\ub2c8\uc998\uc744 API Priority and Fairness\uc774\ub77c\uace0 \ud569\ub2c8\ub2e4. API \uc11c\ubc84\ub294 <code>--max-requests-inflight</code> \ubc0f <code>--max-mutating-requests-inflight</code> \ud50c\ub798\uadf8\ub85c \uc9c0\uc815\ub41c \uac12\uc744 \ud569\uc0b0\ud558\uc5ec \ud5c8\uc6a9\ud560 \uc218 \uc788\ub294 \ucd1d \uc9c4\ud589 \uc911\uc778 \uc694\uccad \uc218\ub97c \uad6c\uc131\ud569\ub2c8\ub2e4. EKS\ub294 \uc774\ub7ec\ud55c \ud50c\ub798\uadf8\uc5d0 \ub300\ud574 \uae30\ubcf8\uac12\uc778 400\uac1c \ubc0f 200\uac1c \uc694\uccad\uc744 \uc0ac\uc6a9\ud558\ubbc0\ub85c \uc8fc\uc5b4\uc9c4 \uc2dc\uac04\uc5d0 \ucd1d 600\uac1c\uc758 \uc694\uccad\uc744 \uc804\ub2ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. APF\ub294 \uc774\ub7ec\ud55c 600\uac1c\uc758 \uc694\uccad\uc744 \ub2e4\uc591\ud55c \uc694\uccad \uc720\ud615\uc73c\ub85c \ub098\ub204\ub294 \ubc29\ubc95\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc740 \uac01 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ucd5c\uc18c 2\uac1c\uc758 API \uc11c\ubc84\uac00 \ub4f1\ub85d\ub418\uc5b4 \uc788\uc5b4 \uac00\uc6a9\uc131\uc774 \ub192\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ud074\ub7ec\uc2a4\ud130 \uc804\uccb4\uc758 \ucd1d \uc9c4\ud589 \uc911\uc778 \uc694\uccad \uc218\uac00 1200\uac1c\ub85c \ub298\uc5b4\ub0a9\ub2c8\ub2e4.</p> <p>PriorityLevelConfigurations \ubc0f FlowSchemas\ub77c\ub294 \ub450 \uc885\ub958\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac1d\uccb4\ub294 \ucd1d \uc694\uccad \uc218\uac00 \ub2e4\uc591\ud55c \uc694\uccad \uc720\ud615 \uac04\uc5d0 \ubd84\ud560\ub418\ub294 \ubc29\uc2dd\uc744 \uad6c\uc131\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uac1d\uccb4\ub294 API \uc11c\ubc84\uc5d0 \uc758\ud574 \uc790\ub3d9\uc73c\ub85c \uc720\uc9c0 \uad00\ub9ac\ub418\uba70 EKS\ub294 \uc9c0\uc815\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9c8\uc774\ub108 \ubc84\uc804\uc5d0 \ub300\ud574 \uc774\ub7ec\ud55c \uac1d\uccb4\uc758 \uae30\ubcf8 \uad6c\uc131\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. PriorityLevelConfigurations\ub294 \ud5c8\uc6a9\ub41c \ucd1d \uc694\uccad \uc218\uc758 \uc77c\ubd80\ub97c \ub098\ud0c0\ub0c5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ub192\uc740 PriorityLevelConfiguration\uc5d0\ub294 \ucd1d 600\uac1c\uc758 \uc694\uccad \uc911 98\uac1c\uac00 \ud560\ub2f9\ub429\ub2c8\ub2e4. \ubaa8\ub4e0 PriorityLevelConfigurations\uc5d0 \ud560\ub2f9\ub41c \uc694\uccad\uc758 \ud569\uacc4\ub294 600\uc785\ub2c8\ub2e4(\ub610\ub294 \ud2b9\uc815 \uc218\uc900\uc774 \uc694\uccad\uc758 \uc77c\ubd80\ub9cc \ud5c8\uc6a9\ub41c \uacbd\uc6b0 API Server\uac00 \ubc18\uc62c\ub9bc\ud558\ubbc0\ub85c 600\ubcf4\ub2e4 \uc57d\uac04 \ub192\uc74c). \ud074\ub7ec\uc2a4\ud130\uc758 PriorityLevelConfigurations\uc640 \uac01\uac01\uc5d0 \ud560\ub2f9\ub41c \uc694\uccad \uc218\ub97c \ud655\uc778\ud558\ub824\uba74 \ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. EKS 1.24\uc758 \uae30\ubcf8\uac12\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>$ kubectl get --raw /metrics | grep apiserver_flowcontrol_request_concurrency_limit\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"catch-all\"} 13\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"global-default\"} 49\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"leader-election\"} 25\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"node-high\"} 98\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"system\"} 74\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-high\"} 98\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-low\"} 245\n</code></pre> <p>\ub450 \ubc88\uc9f8 \uc720\ud615\uc758 \uac1d\uccb4\ub294 FlowSchemas\uc785\ub2c8\ub2e4. \ud2b9\uc815 \uc18d\uc131 \uc138\ud2b8\uac00 \ud3ec\ud568\ub41c API \uc11c\ubc84 \uc694\uccad\uc740 \ub3d9\uc77c\ud55c FlowSchema\ub85c \ubd84\ub958\ub429\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc18d\uc131\uc5d0\ub294 \uc778\uc99d\ub41c \uc0ac\uc6a9\uc790\ub098 API Group, \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub610\ub294 \ub9ac\uc18c\uc2a4\uc640 \uac19\uc740 \uc694\uccad\uc758 \uc18d\uc131\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4. FlowSchema\ub294 \ub610\ud55c \uc774 \uc720\ud615\uc758 \uc694\uccad\uc774 \ub9e4\ud551\ub418\uc5b4\uc57c \ud558\ub294 PriorityLevelConfiguration\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. \ub450 \uac1c\uccb4\ub294 \ud568\uaed8 \"\uc774 \uc720\ud615\uc758 \uc694\uccad\uc774 \uc774 inflight \uc694\uccad \ube44\uc728\uc5d0 \ud3ec\ud568\ub418\uae30\ub97c \uc6d0\ud569\ub2c8\ub2e4.\"\ub77c\uace0 \ub9d0\ud569\ub2c8\ub2e4. \uc694\uccad\uc774 API Server\uc5d0 \ub3c4\ub2ec\ud558\uba74 \ubaa8\ub4e0 \ud544\uc218 \uc18d\uc131\uacfc \uc77c\uce58\ud558\ub294 FlowSchemas\ub97c \ucc3e\uc744 \ub54c\uae4c\uc9c0 \uac01 FlowSchemas\ub97c \ud655\uc778\ud569\ub2c8\ub2e4. \uc5ec\ub7ec FlowSchemas\uac00 \uc694\uccad\uacfc \uc77c\uce58\ud558\ub294 \uacbd\uc6b0 API Server\ub294 \uac1c\uccb4\uc758 \uc18d\uc131\uc73c\ub85c \uc9c0\uc815\ub41c \uc77c\uce58 \uc6b0\uc120 \uc21c\uc704\uac00 \uac00\uc7a5 \uc791\uc740 FlowSchema\ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4.</p> <p>FlowSchemas\uc640 PriorityLevelConfigurations\uc758 \ub9e4\ud551\uc740 \ub2e4\uc74c \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>$ kubectl get flowschemas\nNAME                           PRIORITYLEVEL     MATCHINGPRECEDENCE   DISTINGUISHERMETHOD   AGE     MISSINGPL\nexempt                         exempt            1                    &lt;none&gt;                7h19m   False\neks-exempt                     exempt            2                    &lt;none&gt;                7h19m   False\nprobes                         exempt            2                    &lt;none&gt;                7h19m   False\nsystem-leader-election         leader-election   100                  ByUser                7h19m   False\nendpoint-controller            workload-high     150                  ByUser                7h19m   False\nworkload-leader-election       leader-election   200                  ByUser                7h19m   False\nsystem-node-high               node-high         400                  ByUser                7h19m   False\nsystem-nodes                   system            500                  ByUser                7h19m   False\nkube-controller-manager        workload-high     800                  ByNamespace           7h19m   False\nkube-scheduler                 workload-high     800                  ByNamespace           7h19m   False\nkube-system-service-accounts   workload-high     900                  ByNamespace           7h19m   False\neks-workload-high              workload-high     1000                 ByUser                7h14m   False\nservice-accounts               workload-low      9000                 ByUser                7h19m   False\nglobal-default                 global-default    9900                 ByUser                7h19m   False\ncatch-all                      catch-all         10000                ByUser                7h19m   False\n</code></pre> <p>PriorityLevelConfigurations\uc5d0\ub294 Queue, Reject \ub610\ub294 Exempt \uc720\ud615\uc774 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Queue \ubc0f Reject \uc720\ud615\uc758 \uacbd\uc6b0 \ud574\ub2f9 \uc6b0\uc120\uc21c\uc704 \uc218\uc900\uc5d0 \ub300\ud55c \ucd5c\ub300 \uc9c4\ud589 \uc911\uc778 \uc694\uccad \uc218\uc5d0 \uc81c\ud55c\uc774 \uc801\uc6a9\ub418\uc9c0\ub9cc \ud574\ub2f9 \uc81c\ud55c\uc5d0 \ub3c4\ub2ec\ud558\uba74 \ub3d9\uc791\uc774 \ub2ec\ub77c\uc9d1\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ub192\uc740 PriorityLevelConfiguration\uc740 Queue \uc720\ud615\uc744 \uc0ac\uc6a9\ud558\uba70 \ucee8\ud2b8\ub864\ub7ec \ub9e4\ub2c8\uc800, \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ucee8\ud2b8\ub864\ub7ec, \uc2a4\ucf00\uc904\ub7ec \ubc0f kube-system \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc694\uccad\uc774 98\uac1c \uc788\uc2b5\ub2c8\ub2e4. Queue \uc720\ud615\uc774 \uc0ac\uc6a9\ub418\ubbc0\ub85c API Server\ub294 \uc694\uccad\uc744 \uba54\ubaa8\ub9ac\uc5d0 \uc720\uc9c0\ud558\ub824\uace0 \uc2dc\ub3c4\ud558\uba70 \uc774\ub7ec\ud55c \uc694\uccad\uc774 \uc2dc\uac04 \ucd08\uacfc\ub418\uae30 \uc804\uc5d0 \uc9c4\ud589 \uc911\uc778 \uc694\uccad \uc218\uac00 98\uac1c \ubbf8\ub9cc\uc73c\ub85c \ub5a8\uc5b4\uc9c0\uae30\ub97c \ud76c\ub9dd\ud569\ub2c8\ub2e4. \ud2b9\uc815 \uc694\uccad\uc774 \ub300\uae30\uc5f4\uc5d0\uc11c \uc2dc\uac04 \ucd08\uacfc\ub418\uac70\ub098 \ub108\ubb34 \ub9ce\uc740 \uc694\uccad\uc774 \uc774\ubbf8 \ub300\uae30\uc5f4\uc5d0 \uc788\ub294 \uacbd\uc6b0 API Server\ub294 \uc694\uccad\uc744 \uc0ad\uc81c\ud558\uace0 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 429\ub97c \ubc18\ud658\ud560 \uc218\ubc16\uc5d0 \uc5c6\uc2b5\ub2c8\ub2e4. \ub300\uae30\uc5f4\uc5d0 \uc788\uc73c\uba74 \uc694\uccad\uc774 429\ub97c \uc218\uc2e0\ud558\uc9c0 \ubabb\ud560 \uc218 \uc788\uc9c0\ub9cc \uc694\uccad\uc758 \uc885\ub2e8 \uac04 \uc9c0\uc5f0 \uc2dc\uac04\uc774 \ub298\uc5b4\ub098\ub294 \ub2e8\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774\uc81c Reject \uc720\ud615\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud3ec\uad04\uc801\uc778 PriorityLevelConfiguration\uc5d0 \ub9e4\ud551\ub418\ub294 \ud3ec\uad04\uc801\uc778 FlowSchema\ub97c \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \ud074\ub77c\uc774\uc5b8\ud2b8\uac00 13\uac1c\uc758 \uc9c4\ud589 \uc911\uc778 \uc694\uccad \uc81c\ud55c\uc5d0 \ub3c4\ub2ec\ud558\uba74 API Server\ub294 \ub300\uae30\uc5f4\uc744 \uc2e4\ud589\ud558\uc9c0 \uc54a\uace0 429 \uc751\ub2f5 \ucf54\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc694\uccad\uc744 \uc989\uc2dc \uc0ad\uc81c\ud569\ub2c8\ub2e4. \ub9c8\uc9c0\ub9c9\uc73c\ub85c Exempt \uc720\ud615\uc744 \uc0ac\uc6a9\ud558\uc5ec PriorityLevelConfiguration\uc5d0 \ub9e4\ud551\ud558\ub294 \uc694\uccad\uc740 429\ub97c \uc218\uc2e0\ud558\uc9c0 \uc54a\uc73c\uba70 \ud56d\uc0c1 \uc989\uc2dc \uc804\ub2ec\ub429\ub2c8\ub2e4. \uc774\ub294 healthz \uc694\uccad\uc774\ub098 system:masters \uadf8\ub8f9\uc5d0\uc11c \uc624\ub294 \uc694\uccad\uacfc \uac19\uc740 \uc6b0\uc120\uc21c\uc704\uac00 \ub192\uc740 \uc694\uccad\uc5d0 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/control-plane/#apf","title":"APF \ubc0f \uc0ad\uc81c\ub41c \uc694\uccad \ubaa8\ub2c8\ud130\ub9c1","text":"<p>APF\ub85c \uc778\ud574 \uc0ad\uc81c\ub41c \uc694\uccad\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud558\ub824\uba74 <code>apiserver_flowcontrol_rejected_requests_total</code>\uc5d0 \ub300\ud55c API Server \uc9c0\ud45c\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\uc5ec \uc601\ud5a5\uc744 \ubc1b\uc740 FlowSchemas \ubc0f PriorityLevelConfigurations\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc774 \uc9c0\ud45c\ub294 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ub0ae\uc740 \ub300\uae30\uc5f4\uc758 \uc694\uccad \uc2dc\uac04 \ucd08\uacfc\ub85c \uc778\ud574 service account FlowSchema\uc758 \uc694\uccad 100\uac1c\uac00 \uc0ad\uc81c\ub418\uc5c8\uc74c\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4.</p> <pre><code>% kubectl get --raw /metrics | grep apiserver_flowcontrol_rejected_requests_total\napiserver_flowcontrol_rejected_requests_total{flow_schema=\"service-accounts\",priority_level=\"workload-low\",reason=\"time-out\"} 100\n</code></pre> <p>\uc9c0\uc815\ub41c PriorityLevelConfiguration\uc774 429\ub97c \uc218\uc2e0\ud558\uac70\ub098 \ud050\ub85c \uc778\ud574 \uc9c0\uc5f0 \uc2dc\uac04\uc774 \uc99d\uac00\ud558\ub294 \uc815\ub3c4\ub97c \ud655\uc778\ud558\ub824\uba74 \ub3d9\uc2dc\uc131 \uc81c\ud55c\uacfc \uc0ac\uc6a9 \uc911\uc778 \ub3d9\uc2dc\uc131\uc758 \ucc28\uc774\ub97c \ube44\uad50\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc608\uc5d0\ub294 100\uac1c\uc758 \uc694\uccad \ubc84\ud37c\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_request_concurrency_limit.*workload-low'\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-low\"} 245\n\n% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_request_concurrency_in_use.*workload-low'\napiserver_flowcontrol_request_concurrency_in_use{flow_schema=\"service-accounts\",priority_level=\"workload-low\"} 145\n</code></pre> <p>\ud2b9\uc815 PriorityLevelConfiguration\uc5d0\uc11c \ub300\uae30\uc5f4\uc774 \ubc1c\uc0dd\ud558\uc9c0\ub9cc \ubc18\ub4dc\uc2dc \uc694\uccad\uc774 \uc0ad\uc81c\ub418\ub294 \uac83\uc740 \uc544\ub2cc\uc9c0 \ud655\uc778\ud558\ub824\uba74 <code>apiserver_flowcontrol_current_inqueue_requests</code>\uc5d0 \ub300\ud55c \uce21\uc815 \uc9c0\ud45c\ub97c \ucc38\uc870\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_current_inqueue_requests.*workload-low'\napiserver_flowcontrol_current_inqueue_requests{flow_schema=\"service-accounts\",priority_level=\"workload-low\"} 10\n</code></pre> <p>\uae30\ud0c0 \uc720\uc6a9\ud55c Prometheus \uce21\uc815\ud56d\ubaa9\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4:</p> <ul> <li>apiserver_flowcontrol_dispatched_requests_total</li> <li>apiserver_flowcontrol_request_execution_seconds</li> <li>apiserver_flowcontrol_request_wait_duration_seconds</li> </ul> <p>APF \uc9c0\ud45c\uc758 \uc804\uccb4 \ubaa9\ub85d\uc740 \uc5c5\uc2a4\ud2b8\ub9bc \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc138\uc694.</p>"},{"location":"ko/scalability/docs/control-plane/#_7","title":"\uc0ad\uc81c\ub41c \uc694\uccad \ubc29\uc9c0","text":""},{"location":"ko/scalability/docs/control-plane/#429","title":"\uc6cc\ud06c\ub85c\ub4dc\ub97c \ubcc0\uacbd\ud558\uc5ec 429\ub97c \ubc29\uc9c0","text":"<p>APF\uac00 \ud5c8\uc6a9\ub41c \ucd5c\ub300 \ub0b4\ubd80 \uc694\uccad \uc218\ub97c \ucd08\uacfc\ud558\ub294 \uc9c0\uc815\ub41c PriorityLevelConfiguration\uc73c\ub85c \uc778\ud574 \uc694\uccad\uc744 \uc0ad\uc81c\ud558\ub294 \uacbd\uc6b0 \uc601\ud5a5\uc744 \ubc1b\ub294 FlowSchemas\uc758 \ud074\ub77c\uc774\uc5b8\ud2b8\ub294 \uc9c0\uc815\ub41c \uc2dc\uac04\uc5d0 \uc2e4\ud589\ub418\ub294 \uc694\uccad \uc218\ub97c \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 429\uac00 \ubc1c\uc0dd\ud558\ub294 \uae30\uac04 \ub3d9\uc548 \uc774\ub8e8\uc5b4\uc9c4 \ucd1d \uc694\uccad \uc218\ub97c \uc904\uc784\uc73c\ub85c\uc368 \ub2ec\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ube44\uc6a9\uc774 \ub9ce\uc774 \ub4dc\ub294 \ubaa9\ub85d \ud638\ucd9c\uacfc \uac19\uc740 \uc7a5\uae30 \uc2e4\ud589 \uc694\uccad\uc740 \uc2e4\ud589\ub418\ub294 \uc804\uccb4 \uae30\uac04 \ub3d9\uc548 \uc9c4\ud589 \uc911\uc778 \uc694\uccad\uc73c\ub85c \uacc4\uc0b0\ub418\uae30 \ub54c\ubb38\uc5d0 \ud2b9\ud788 \ubb38\uc81c\uac00 \ub429\ub2c8\ub2e4. \ube44\uc6a9\uc774 \ub9ce\uc774 \ub4dc\ub294 \uc694\uccad \uc218\ub97c \uc904\uc774\uac70\ub098 \ubaa9\ub85d \ud638\ucd9c\uc758 \ub300\uae30 \uc2dc\uac04\uc744 \ucd5c\uc801\ud654\ud558\uba74(\uc608: \uc694\uccad \ub2f9 \uac00\uc838\uc624\ub294 \uac1d\uccb4 \uc218\ub97c \uc904\uc774\uac70\ub098 watch \uc694\uccad\uc744 \uc0ac\uc6a9\ud558\ub3c4\ub85d \uc804\ud658) \ud574\ub2f9 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ud544\uc694\ud55c \ucd1d \ub3d9\uc2dc\uc131\uc744 \uc904\uc774\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#apf-429","title":"APF \uc124\uc815\uc744 \ubcc0\uacbd\ud558\uc5ec 429\ub97c \ubc29\uc9c0","text":"<p>\uacbd\uace0</p> <p>\uc218\ud589 \uc911\uc778 \uc791\uc5c5\uc744 \uc54c\uace0 \uc788\ub294 \uacbd\uc6b0\uc5d0\ub9cc \uae30\ubcf8 APF \uc124\uc815\uc744 \ubcc0\uacbd\ud558\uc2ed\uc2dc\uc624. APF \uc124\uc815\uc774 \uc798\ubabb \uad6c\uc131\ub418\uba74 API Server \uc694\uccad\uc774 \uc911\ub2e8\ub418\uace0 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ud06c\uac8c \uc911\ub2e8\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc694\uccad \uc0ad\uc81c\ub97c \ubc29\uc9c0\ud558\uae30 \uc704\ud55c \ub610 \ub2e4\ub978 \uc811\uadfc \ubc29\uc2dd\uc740 EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc124\uce58\ub41c \uae30\ubcf8 FlowSchemas \ub610\ub294 PriorityLevelConfigurations\ub97c \ubcc0\uacbd\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. EKS\ub294 \uc9c0\uc815\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9c8\uc774\ub108 \ubc84\uc804\uc5d0 \ub300\ud55c FlowSchemas \ubc0f PriorityLevelConfigurations\uc758 \uc5c5\uc2a4\ud2b8\ub9bc \uae30\ubcf8 \uc124\uc815\uc744 \uc124\uce58\ud569\ub2c8\ub2e4. API\ub294 \uac1d\uccb4\uc5d0 \ub300\ud55c \ub2e4\uc74c \uc8fc\uc11d\uc774 false\ub85c \uc124\uc815\ub418\uc9c0 \uc54a\uc740 \ud55c \uc774\ub7ec\ud55c \uac1d\uccb4\ub97c \uae30\ubcf8\uac12\uc73c\ub85c \uc790\ub3d9\uc73c\ub85c \ub2e4\uc2dc \uc870\uc815\ud569\ub2c8\ub2e4.</p> <pre><code>  metadata:\n    annotations:\n      apf.kubernetes.io/autoupdate-spec: \"false\"\n</code></pre> <p>\ub192\uc740 \uc218\uc900\uc5d0\uc11c APF \uc124\uc815\uc740 \ub2e4\uc74c \uc911 \ud558\ub098\ub85c \uc218\uc815\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uad00\uc2ec \uc788\ub294 \uc694\uccad\uc5d0 \ub354 \ub9ce\uc740 \uae30\ub0b4 \uc218\uc6a9 \ub2a5\ub825\uc744 \ud560\ub2f9\ud558\uc138\uc694.</li> <li>\ub2e4\ub978 \uc694\uccad \uc720\ud615\uc5d0 \ub300\ud55c \uc6a9\ub7c9\uc774 \ubd80\uc871\ud560 \uc218 \uc788\ub294 \ube44\ud544\uc218\uc801\uc774\uac70\ub098 \ube44\uc6a9\uc774 \ub9ce\uc774 \ub4dc\ub294 \uc694\uccad\uc744 \uaca9\ub9ac\ud569\ub2c8\ub2e4.</li> </ul> <p>\uc774\ub294 \uae30\ubcf8 FlowSchemas \ubc0f PriorityLevelConfigurations\ub97c \ubcc0\uacbd\ud558\uac70\ub098 \uc774\ub7ec\ud55c \uc720\ud615\uc758 \uc0c8 \uac1c\uccb4\ub97c \uc0dd\uc131\ud558\uc5ec \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\ub294 \uad00\ub828 PriorityLevelConfigurations \uac1c\uccb4\uc5d0 \ub300\ud55c authenticateConcurrencyShares \uac12\uc744 \ub298\ub824 \ud560\ub2f9\ub418\ub294 \uc9c4\ud589 \uc911 \uc694\uccad \ube44\uc728\uc744 \ub298\ub9b4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uc694\uccad\uc774 \ubc1c\uc1a1\ub418\uae30 \uc804\uc5d0 \ub300\uae30\uc5f4\uc5d0 \ucd94\uac00\ub418\uc5b4 \ubc1c\uc0dd\ud558\ub294 \ucd94\uac00 \ub300\uae30 \uc2dc\uac04\uc744 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 \uacbd\uc6b0 \ud2b9\uc815 \uc2dc\uac04\uc5d0 \ub300\uae30\uc5f4\uc5d0 \ucd94\uac00\ud560 \uc218 \uc788\ub294 \uc694\uccad \uc218\ub3c4 \ub298\uc5b4\ub0a0 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub610\ub294 \uace0\uac1d\uc758 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub9de\ub294 \uc0c8\ub85c\uc6b4 FlowSchema \ubc0f PriorityLevelConfigurations \uac1c\uccb4\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\uc874 PriorityLevelConfigurations \ub610\ub294 \uc0c8\ub85c\uc6b4 PriorityLevelConfigurations\uc5d0 \ub354 \ub9ce\uc740 secureConcurrencyShares\ub97c \ud560\ub2f9\ud558\uba74 \uc804\uccb4 \ud55c\ub3c4\uac00 API Server \ub2f9 600\uac1c\ub85c \uc720\uc9c0\ub418\ubbc0\ub85c \ub2e4\ub978 \ubc84\ud0b7\uc5d0\uc11c \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 \uc694\uccad \uc218\uac00 \uc904\uc5b4\ub4ed\ub2c8\ub2e4.</p> <p>APF \uae30\ubcf8\uac12\uc744 \ubcc0\uacbd\ud560 \ub54c \uc124\uc815 \ubcc0\uacbd\uc73c\ub85c \uc778\ud574 \uc758\ub3c4\ud558\uc9c0 \uc54a\uc740 429\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub3c4\ub85d \ube44\ud504\ub85c\ub355\uc158 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc774\ub7ec\ud55c \uce21\uc815\ud56d\ubaa9\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <ol> <li>\ubc84\ud0b7\uc774 \uc694\uccad \uc0ad\uc81c\ub97c \uc2dc\uc791\ud558\uc9c0 \uc54a\ub3c4\ub85d \ubaa8\ub4e0 FlowSchemas\uc5d0 \ub300\ud574 <code>apiserver_flowcontrol_rejected_requests_total</code>\uc5d0 \ub300\ud55c \uce21\uc815 \uc9c0\ud45c\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud574\uc57c \ud569\ub2c8\ub2e4.</li> <li><code>apiserver_flowcontrol_request_concurrency_limit</code> \ubc0f <code>apiserver_flowcontrol_request_concurrency_in_use</code> \uac12\uc744 \ube44\uad50\ud558\uc5ec \uc0ac\uc6a9 \uc911\uc778 \ub3d9\uc2dc\uc131\uc774 \ud574\ub2f9 \uc6b0\uc120\uc21c\uc704 \uc218\uc900\uc758 \uc81c\ud55c\uc744 \uc704\ubc18\ud560 \uc704\ud5d8\uc774 \uc5c6\ub294\uc9c0 \ud655\uc778\ud574\uc57c \ud569\ub2c8\ub2e4.</li> </ol> <p>\uc0c8\ub85c\uc6b4 FlowSchema \ubc0f PriorityLevelConfiguration\uc744 \uc815\uc758\ud558\ub294 \uc77c\ubc18\uc801\uc778 \uc0ac\uc6a9 \uc0ac\ub840 \uc911 \ud558\ub098\ub294 \uaca9\ub9ac\uc785\ub2c8\ub2e4. \ud30c\ub4dc\uc5d0\uc11c \uc7a5\uae30 \uc2e4\ud589 \ubaa9\ub85d \uc774\ubca4\ud2b8 \ud638\ucd9c\uc744 \uc790\uccb4 \uc694\uccad \uacf5\uc720\ub85c \ubd84\ub9ac\ud55c\ub2e4\uace0 \uac00\uc815\ud574 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uae30\uc874 \uc11c\ube44\uc2a4 \uacc4\uc815 FlowSchema\ub97c \uc0ac\uc6a9\ud558\ub294 \ud30c\ub4dc\uc758 \uc911\uc694\ud55c \uc694\uccad\uc774 429\ub97c \uc218\uc2e0\ud558\uc5ec \uc694\uccad \uc6a9\ub7c9\uc774 \ubd80\uc871\ud574\uc9c0\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc9c4\ud589 \uc911\uc778 \uc694\uccad\uc758 \ucd1d \uac1c\uc218\ub294 \uc720\ud55c\ud558\uc9c0\ub9cc \uc774 \uc608\uc5d0\uc11c\ub294 APF \uc124\uc815\uc744 \uc218\uc815\ud558\uc5ec \uc9c0\uc815\ub41c \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub300\ud55c \uc694\uccad \uc6a9\ub7c9\uc744 \ub354 \uc798 \ub098\ub20c \uc218 \uc788\uc74c\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4.</p> <p>List \uc774\ubca4\ud2b8 \uc694\uccad\uc744 \ubd84\ub9ac\ud558\uae30 \uc704\ud55c FlowSchema \uac1d\uccb4\uc758 \uc608:</p> <pre><code>apiVersion: flowcontrol.apiserver.k8s.io/v1beta1\nkind: FlowSchema\nmetadata:\n  name: list-events-default-service-accounts\nspec:\n  distinguisherMethod:\n    type: ByUser\n  matchingPrecedence: 8000\n  priorityLevelConfiguration:\n    name: catch-all\n  rules:\n  - resourceRules:\n    - apiGroups:\n      - '*'\n      namespaces:\n      - default\n      resources:\n      - events\n      verbs:\n      - list\n    subjects:\n    - kind: ServiceAccount\n      serviceAccount:\n        name: default\n        namespace: default\n</code></pre> <ul> <li>\uc774 FlowSchema\ub294 \uae30\ubcf8 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 Service Account\uc5d0\uc11c \uc218\ud589\ub41c \ubaa8\ub4e0 List \uc774\ubca4\ud2b8 \ud638\ucd9c\uc744 \ucea1\ucc98\ud569\ub2c8\ub2e4.</li> <li>\uc77c\uce58 \uc6b0\uc120 \uc21c\uc704 8000\uc740 \uae30\uc874 Service Account FlowSchema\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \uac12 9000\ubcf4\ub2e4 \ub0ae\uc73c\ubbc0\ub85c \uc774\ub7ec\ud55c List \uc774\ubca4\ud2b8 \ud638\ucd9c\uc740 Service Account\uac00 \uc544\ub2cc list-events-default-service-account\uc640 \uc77c\uce58\ud569\ub2c8\ub2e4.</li> <li>\uc774\ub7ec\ud55c \uc694\uccad\uc744 \uaca9\ub9ac\ud558\uae30 \uc704\ud574 \ud3ec\uad04\uc801\uc778 PriorityLevelConfiguration\uc744 \uc0ac\uc6a9\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc84\ud0b7\uc740 \uc7a5\uae30 \uc2e4\ud589\ub418\ub294 list \uc774\ubca4\ud2b8 \ud638\ucd9c\uc5d0\uc11c 13\uac1c\uc758 \uc9c4\ud589 \uc911\uc778 \uc694\uccad\ub9cc \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ud30c\ub4dc\ub294 \ub3d9\uc2dc\uc5d0 13\uac1c \uc774\uc0c1\uc758 \uc694\uccad\uc744 \ubc1c\ud589\ud558\ub824\uace0 \uc2dc\ub3c4\ud558\uc9c0\ub9cc \uc989\uc2dc 429\ub97c \uc751\ub2f5\ubc1b\uae30 \uc2dc\uc791\ud569\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/scalability/docs/control-plane/#api-server","title":"API Server\uc5d0\uc11c \ub9ac\uc18c\uc2a4 \uac80\uc0c9","text":"<p>API Server\uc5d0\uc11c \uc815\ubcf4\ub97c \uac00\uc838\uc624\ub294 \uac83\uc740 \ubaa8\ub4e0 \uaddc\ubaa8\uc758 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc608\uc0c1\ub418\ub294 \ub3d9\uc791\uc785\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc758 \ub9ac\uc18c\uc2a4 \uc218\ub97c \ud655\uc7a5\ud558\uba74 \uc694\uccad \ube48\ub3c4\uc640 \ub370\uc774\ud130 \ubcfc\ub968\uc774 \ube60\ub974\uac8c \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \ubcd1\ubaa9 \ud604\uc0c1\uc774 \ub418\uc5b4 API \uc4f0\ub85c\ud2c0\ub9c1 \ubc0f \uc18d\ub3c4 \uc800\ud558\ub85c \uc774\uc5b4\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc9c0\uc5f0 \uc2dc\uac04\uc758 \uc2ec\uac01\ub3c4\uc5d0 \ub530\ub77c \uc8fc\uc758\ud558\uc9c0 \uc54a\uc73c\uba74 \uc608\uc0c1\uce58 \ubabb\ud55c \ub2e4\uc6b4\ud0c0\uc784\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774\ub7ec\ud55c \uc720\ud615\uc758 \ubb38\uc81c\ub97c \ubc29\uc9c0\ud558\uae30 \uc704\ud55c \uccab \ubc88\uc9f8 \ub2e8\uacc4\ub294 \ubb34\uc5c7\uc744 \uc694\uccad\ud558\uace0 \uc5bc\ub9c8\ub098 \uc790\uc8fc \uc694\uccad\ud558\ub294\uc9c0 \ud30c\uc545\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \ub2e4\uc74c\uc740 \uaddc\ubaa8 \uc870\uc815 \ubaa8\ubc94 \uc0ac\ub840\uc5d0 \ub530\ub77c \ucffc\ub9ac \uc591\uc744 \uc81c\ud55c\ud558\ub294 \uc9c0\uce68\uc785\ub2c8\ub2e4. \uc774 \uc139\uc158\uc758 \uc81c\uc548 \uc0ac\ud56d\uc740 \ud655\uc7a5\uc131\uc774 \uac00\uc7a5 \uc88b\uc740 \uac83\uc73c\ub85c \uc54c\ub824\uc9c4 \uc635\uc158\ubd80\ud130 \uc21c\uc11c\ub300\ub85c \uc81c\uacf5\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#shared-informers","title":"Shared Informers \uc0ac\uc6a9","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc640 \ud1b5\ud569\ub418\ub294 \ucee8\ud2b8\ub864\ub7ec \ubc0f \uc790\ub3d9\ud654\ub97c \uad6c\ucd95\ud560 \ub54c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4\uc5d0\uc11c \uc815\ubcf4\ub97c \uac00\uc838\uc640\uc57c \ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ub9ac\uc18c\uc2a4\ub97c \uc815\uae30\uc801\uc73c\ub85c \ud3f4\ub9c1\ud558\uba74 API Server\uc5d0 \uc0c1\ub2f9\ud55c \ubd80\ud558\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>client-go \ub77c\uc774\ube0c\ub7ec\ub9ac\uc758 informer \ub97c \uc0ac\uc6a9\ud558\uba74 \ubcc0\uacbd \uc0ac\ud56d\uc744 \ud3f4\ub9c1\ud558\ub294 \ub300\uc2e0 \uc774\ubca4\ud2b8\ub97c \uae30\ubc18\uc73c\ub85c \ub9ac\uc18c\uc2a4\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc744 \uad00\ucc30\ud560 \uc218 \uc788\ub2e4\ub294 \uc774\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4. Shared Informer\ub294 \uc774\ubca4\ud2b8 \ubc0f \ubcc0\uacbd \uc0ac\ud56d\uc5d0 \uacf5\uc720 \uce90\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubd80\ud558\ub97c \ub354\uc6b1 \uc904\uc774\ubbc0\ub85c \ub3d9\uc77c\ud55c \ub9ac\uc18c\uc2a4\ub97c \uac10\uc2dc\ud558\ub294 \uc5ec\ub7ec \ucee8\ud2b8\ub864\ub7ec\ub85c \uc778\ud574 \ucd94\uac00 \ubd80\ud558\uac00 \uac00\uc911\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <p>\ucee8\ud2b8\ub864\ub7ec\ub294 \ud2b9\ud788 \ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\uc758 \uacbd\uc6b0 label \ubc0f field selectors \uc5c6\uc774 \ud074\ub7ec\uc2a4\ud130 \uc804\uccb4 \ub9ac\uc18c\uc2a4\ub97c \ud3f4\ub9c1\ud558\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4. \ud544\ud130\ub9c1\ub418\uc9c0 \uc54a\uc740 \uac01 \ud3f4\ub9c1\uc5d0\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8\uac00 \ud544\ud130\ub9c1\ud558\uae30 \uc704\ud574 etcd\uc5d0\uc11c API Server\ub97c \ud1b5\ud574 \ub9ce\uc740 \uc591\uc758 \ubd88\ud544\uc694\ud55c \ub370\uc774\ud130\ub97c \uc804\uc1a1\ud574\uc57c \ud569\ub2c8\ub2e4. \ub808\uc774\ube14\uacfc \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uae30\ubc18\uc73c\ub85c \ud544\ud130\ub9c1\ud558\uba74 API \uc11c\ubc84\uac00 \uc694\uccad\uc744 \ucc98\ub9ac\ud558\uace0 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \uc804\uc1a1\ub418\ub294 \ub370\uc774\ud130\ub97c \ucc98\ub9ac\ud558\uae30 \uc704\ud574 \uc218\ud589\ud574\uc57c \ud558\ub294 \uc791\uc5c5\ub7c9\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/control-plane/#api","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc0ac\uc6a9 \ucd5c\uc801\ud654","text":"<p>\uc0ac\uc6a9\uc790 \uc815\uc758 \ucee8\ud2b8\ub864\ub7ec \ub610\ub294 \uc790\ub3d9\ud654\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \ud638\ucd9c\ud560 \ub54c \ud544\uc694\ud55c \ub9ac\uc18c\uc2a4\ub85c\ub9cc \ud638\ucd9c\uc744 \uc81c\ud55c\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. \uc81c\ud55c\uc774 \uc5c6\uc73c\uba74 API Server \ubc0f etcd\uc5d0 \ubd88\ud544\uc694\ud55c \ub85c\ub4dc\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uac00\ub2a5\ud558\uba74 watch \uc778\uc790\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc778\uc790\uac00 \uc5c6\uc73c\uba74 \uae30\ubcf8 \ub3d9\uc791\uc740 \uac1d\uccb4\ub97c \ub098\uc5f4\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. list \ub300\uc2e0 watch\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 API \uc694\uccad \ub05d\uc5d0 <code>?watch=true</code>\ub97c \ucd94\uac00\ud558\uba74 \ub429\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 watch\ub97c \uc0ac\uc6a9\ud558\uc5ec \uae30\ubcf8 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \uac00\uc838\uc624\ub824\uba74 \ub2e4\uc74c\uc744 \uc0ac\uc6a9\ud558\uc138\uc694.</p> <pre><code>/api/v1/namespaces/default/pods?watch=true\n</code></pre> <p>\uac1d\uccb4\ub97c \ub098\uc5f4\ud558\ub294 \uacbd\uc6b0 \ub098\uc5f4\ud558\ub294 \ud56d\ubaa9\uc758 \ubc94\uc704\uc640 \ubc18\ud658\ub418\ub294 \ub370\uc774\ud130\uc758 \uc591\uc744 \uc81c\ud55c\ud574\uc57c \ud569\ub2c8\ub2e4. \uc694\uccad\uc5d0 <code>limit=500</code> \uc778\uc218\ub97c \ucd94\uac00\ud558\uc5ec \ubc18\ud658\ub418\ub294 \ub370\uc774\ud130\ub97c \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>fieldSelector</code> \uc778\uc218\uc640 <code>/namespace/</code> \uacbd\ub85c\ub294 \ubaa9\ub85d\uc758 \ubc94\uc704\ub97c \ud544\uc694\uc5d0 \ub530\ub77c \uc881\uac8c \uc9c0\uc815\ud558\ub294 \ub370 \uc720\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uae30\ubcf8 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ud30c\ub4dc\ub9cc \ub098\uc5f4\ud558\ub824\uba74 \ub2e4\uc74c API \uacbd\ub85c\uc640 \uc778\uc218\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p> <pre><code>/api/v1/namespaces/default/pods?fieldSelector=status.phase=Running&amp;limit=500\n</code></pre> <p>\ub610\ub294 \ub2e4\uc74c\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc2e4\ud589 \uc911\uc778 \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \ub098\uc5f4\ud569\ub2c8\ub2e4.</p> <pre><code>/api/v1/pods?fieldSelector=status.phase=Running&amp;limit=500\n</code></pre> <p>\ub098\uc5f4\ub41c \uc624\ube0c\uc81d\ud2b8\ub97c \uc81c\ud55c\ud558\ub294 \ub610 \ub2e4\ub978 \uc635\uc158\uc740 <code>ResourceVersions</code> (\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc124\uba85\uc11c \ucc38\uc870)\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83 \uc785\ub2c8\ub2e4. <code>ResourceVersion</code> \uc778\uc790\uac00 \uc5c6\uc73c\uba74 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ucd5c\uc2e0 \ubc84\uc804\uc744 \ubc1b\uac8c \ub418\uba70, \uc774 \uacbd\uc6b0 \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc5d0\uc11c \uac00\uc7a5 \ube44\uc6a9\uc774 \ub9ce\uc774 \ub4e4\uace0 \uac00\uc7a5 \ub290\ub9b0 etcd \ucffc\ub7fc \uc77d\uae30\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. resourceVersion\uc740 \ucffc\ub9ac\ud558\ub824\ub294 \ub9ac\uc18c\uc2a4\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9c0\uba70, <code>Metadata.Resourceversion</code> \ud544\ub4dc\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>API Server \uce90\uc2dc\uc5d0\uc11c \uacb0\uacfc\ub97c \ubc18\ud658\ud558\ub294 \ud2b9\ubcc4\ud55c <code>ResourceVersion=0</code>\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 etcd \ubd80\ud558\ub97c \uc904\uc77c \uc218 \uc788\uc9c0\ub9cc Pagination\uc740 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <pre><code>/api/v1/namespaces/default/pods?resourceVersion=0\n</code></pre> <p>\uc778\uc790 \uc5c6\uc774 API\ub97c \ud638\ucd9c\ud558\uba74 API Server \ubc0f etcd\uc5d0\uc11c \ub9ac\uc18c\uc2a4\ub97c \uac00\uc7a5 \ub9ce\uc774 \uc0ac\uc6a9\ud558\uac8c \ub429\ub2c8\ub2e4.\uc774 \ud638\ucd9c\uc744 \uc0ac\uc6a9\ud558\uba74 Pagination\uc774\ub098 \ubc94\uc704 \uc81c\ud55c \uc5c6\uc774 \ubaa8\ub4e0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \uac00\uc838\uc624\uace0 etcd\uc5d0\uc11c \ucffc\ub7fc\uc744 \uc77d\uc5b4\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>/api/v1/pods\n</code></pre>"},{"location":"ko/scalability/docs/data-plane/","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\uc774\ud130 \ud50c\ub808\uc778","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub370\uc774\ud130 \ud50c\ub808\uc778\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc774 \uc0ac\uc6a9\ud558\ub294 EC2 \uc778\uc2a4\ud134\uc2a4, \ub85c\ub4dc \ubc38\ub7f0\uc11c, \uc2a4\ud1a0\ub9ac\uc9c0 \ubc0f \uae30\ud0c0 API\ub97c \ud3ec\ud568\ud569\ub2c8\ub2e4. \uc870\uc9c1\ud654\ub97c \uc704\ud574 \ud074\ub7ec\uc2a4\ud130 \uc11c\ube44\uc2a4\ub97c \ubcc4\ub3c4\uc758 \ud398\uc774\uc9c0\ub85c \uadf8\ub8f9\ud654\ud588\uc73c\uba70 \ub85c\ub4dc \ubc38\ub7f0\uc11c \ud655\uc7a5\uc740 \uc6cc\ud06c\ub85c\ub4dc \uc139\uc158\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc139\uc158\uc5d0\uc11c\ub294 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4 \ud655\uc7a5\uc5d0 \uc911\uc810\uc744 \ub461\ub2c8\ub2e4.</p> <p>\uc5ec\ub7ec \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc788\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c\ub294 EC2 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc120\ud0dd\ud558\ub294 \uac83\uc774 \uace0\uac1d\uc774 \uc9c1\uba74\ud558\ub294 \uac00\uc7a5 \uc5b4\ub824\uc6b4 \uacb0\uc815 \uc911 \ud558\ub098\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubaa8\ub4e0 \uc0c1\ud669\uc5d0 \ub9de\ub294 \ub2e8\uc77c \uc194\ub8e8\uc158\uc740 \uc5c6\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c\uc740 \ucef4\ud4e8\ud305 \ud655\uc7a5\uacfc \uad00\ub828\ub41c \uc77c\ubc18\uc801\uc778 \uc704\ud5d8\uc744 \ubc29\uc9c0\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub418\ub294 \uba87 \uac00\uc9c0 \ud301\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/data-plane/#_2","title":"\uc790\ub3d9 \ub178\ub4dc \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1","text":"<p>\uc218\uace0\ub97c \uc904\uc774\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \uae34\ubc00\ud558\uac8c \ud1b5\ud569\ub418\ub294 \ub178\ub4dc \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\uc5d0\ub294 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 \ubc0f Karpenter \ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 \uad00\ub9ac\ud615 \uc5c5\uadf8\ub808\uc774\ub4dc \ubc0f \uad6c\uc131\uc5d0 \ub300\ud55c \ucd94\uac00 \uc774\uc810\uacfc \ud568\uaed8 Amazon EC2 Auto Scaling \uadf8\ub8f9\uc758 \uc720\uc5f0\uc131\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud655\uc7a5\ud560 \uc218 \uc788\uc73c\uba70 \ub2e4\uc591\ud55c \ucef4\ud4e8\ud305 \uc694\uad6c \uc0ac\ud56d\uc774 \uc788\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc77c\ubc18\uc801\uc778 \uc635\uc158\uc785\ub2c8\ub2e4.</p> <p>Karpenter\ub294 AWS\uc5d0\uc11c \ub9cc\ub4e0 \uc624\ud508 \uc18c\uc2a4 \uc6cc\ud06c\ub85c\ub4dc \ub124\uc774\ud2f0\ube0c \ub178\ub4dc \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub7ec\uc785\ub2c8\ub2e4. \ub178\ub4dc \uadf8\ub8f9\uc744 \uad00\ub9ac\ud558\uc9c0 \uc54a\uace0\ub3c4 \ub9ac\uc18c\uc2a4 (\uc608: GPU) \uc640 taint \ubc0f tolerations (\uc608: zone spread)\uc5d0 \ub300\ud55c \uc6cc\ud06c\ub85c\ub4dc \uc694\uad6c \uc0ac\ud56d\uc744 \uae30\ubc18\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130\uc758 \ub178\ub4dc\ub97c \ud655\uc7a5\ud569\ub2c8\ub2e4. \ub178\ub4dc\ub294 EC2\ub85c\ubd80\ud130 \uc9c1\uc811 \uc0dd\uc131\ub418\ubbc0\ub85c \uae30\ubcf8 \ub178\ub4dc \uadf8\ub8f9 \ud560\ub2f9\ub7c9 (\uadf8\ub8f9\ub2f9 450\uac1c \ub178\ub4dc)\uc774 \ud544\uc694 \uc5c6\uc73c\uba70 \uc6b4\uc601 \uc624\ubc84\ud5e4\ub4dc\ub97c \uc904\uc774\uba74\uc11c \uc778\uc2a4\ud134\uc2a4 \uc120\ud0dd \uc720\uc5f0\uc131\uc774 \ud5a5\uc0c1\ub429\ub2c8\ub2e4. \uace0\uac1d\uc740 \uac00\ub2a5\ud558\uba74 Karpenter\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/data-plane/#ec2","title":"\ub2e4\uc591\ud55c EC2 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615 \uc0ac\uc6a9","text":"<p>\uac01 AWS \ub9ac\uc804\uc5d0\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\ubcc4\ub85c \uc0ac\uc6a9 \u200b\u200b\uac00\ub2a5\ud55c \uc778\uc2a4\ud134\uc2a4 \uc218\uac00 \uc81c\ud55c\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ud558\ub098\uc758 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\ub9cc \uc0ac\uc6a9\ud558\ub294 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uace0 \ub9ac\uc804\uc758 \uc6a9\ub7c9\uc744 \ucd08\uacfc\ud558\uc5ec \ub178\ub4dc \uc218\ub97c \ud655\uc7a5\ud558\uba74 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc778\uc2a4\ud134\uc2a4\uac00 \uc5c6\ub2e4\ub294 \uc624\ub958\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4. \uc774 \ubb38\uc81c\ub97c \ubc29\uc9c0\ud558\ub824\uba74 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc784\uc758\ub85c \uc81c\ud55c\ud574\uc11c\ub294 \uc548 \ub429\ub2c8\ub2e4.</p> <p>Karpenter\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ud638\ud658\ub418\ub294 \ub2e4\uc591\ud55c \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc0ac\uc6a9\ud558\uba70 \ubcf4\ub958 \uc911\uc778 \uc6cc\ud06c\ub85c\ub4dc \uc694\uad6c \uc0ac\ud56d, \uac00\uc6a9\uc131 \ubc0f \ube44\uc6a9\uc744 \uae30\ubc18\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd \uc2dc \uc778\uc2a4\ud134\uc2a4\ub97c \uc120\ud0dd\ud569\ub2c8\ub2e4. NodePools\uc758 <code>karpenter.k8s.aws/instance-category</code> \ud0a4\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615 \ubaa9\ub85d\uc744 \uc815\uc758\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \ub178\ub4dc \uadf8\ub8f9\uc774 \uc77c\uad00\ub418\uac8c \ud655\uc7a5\ub420 \uc218 \uc788\ub3c4\ub85d \uc720\uc0ac\ud55c \ud06c\uae30\uc758 \uc720\ud615\uc744 \ud544\uc694\ub85c \ud569\ub2c8\ub2e4. CPU \ubc0f \uba54\ubaa8\ub9ac \ud06c\uae30\ub97c \uae30\uc900\uc73c\ub85c \uc5ec\ub7ec \uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\uace0 \ub3c5\ub9bd\uc801\uc73c\ub85c \ud655\uc7a5\ud574\uc57c \ud569\ub2c8\ub2e4. ec2-instance-selector\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc \uadf8\ub8f9\uacfc \ube44\uc2b7\ud55c \ud06c\uae30\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \uc2dd\ubcc4\ud558\uc138\uc694.</p> <pre><code>ec2-instance-selector --service eks --vcpus-min 8 --memory-min 16\na1.2xlarge\na1.4xlarge\na1.metal\nc4.4xlarge\nc4.8xlarge\nc5.12xlarge\nc5.18xlarge\nc5.24xlarge\nc5.2xlarge\nc5.4xlarge\nc5.9xlarge\nc5.metal\n</code></pre>"},{"location":"ko/scalability/docs/data-plane/#api","title":"API \uc11c\ubc84 \ubd80\ud558\ub97c \uc904\uc774\uae30 \uc704\ud574 \ub354 \ud070 \ub178\ub4dc\ub97c \uc120\ud638","text":"<p>\uc5b4\ub5a4 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc0ac\uc6a9\ud560\uc9c0 \uacb0\uc815\ud560 \ub54c \ub178\ub4dc \uc218\uac00 \uc801\uace0 \ud06c\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \uac78\ub9ac\ub294 \ubd80\ud558\uac00 \uc904\uc5b4\ub4ed\ub2c8\ub2e4. \uc2e4\ud589 \uc911\uc778 kubelet\uacfc \ub370\ubaac\uc14b\uc758 \uc218\uac00 \uc904\uc5b4\ub4e4\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \ud070 \ub178\ub4dc\ub294 \uc791\uc740 \ub178\ub4dc\ucc98\ub7fc \ucda9\ubd84\ud788 \ud65c\uc6a9\ub418\uc9c0 \uc54a\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc \ud06c\uae30\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc758 \uac00\uc6a9\uc131 \ubc0f \ud655\uc7a5\uc131\uc744 \uae30\ubc18\uc73c\ub85c \ud3c9\uac00\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>u-24tb1.metal \uc778\uc2a4\ud134\uc2a4 3\uac1c (24TB Memory \ubc0f 448 cores)\uac00 \uc788\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0\ub294 3\uac1c\uc758 kubelets\uac00 \uc788\uc73c\uba70 \uae30\ubcf8\uc801\uc73c\ub85c \ub178\ub4dc\ub2f9 110\uac1c\uc758 \ud30c\ub4dc\ub85c \uc81c\ud55c\ub429\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \uac01\uac01 4\uac1c\uc758 \ucf54\uc5b4\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc774\ub294 \uc608\uc0c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4 (4\ucf54\uc5b4 x 110 = \ub178\ub4dc\ub2f9 440\ucf54\uc5b4). \ud074\ub7ec\uc2a4\ud130\uc5d0 3\uac1c\uc758 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud558\uba74 \uc778\uc2a4\ud134\uc2a4 1\uac1c\uac00 \uc911\ub2e8\ub420 \ub54c \ud074\ub7ec\uc2a4\ud130\uc758 1/3\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc73c\ubbc0\ub85c \uc778\uc2a4\ud134\uc2a4 \uc778\uc2dc\ub358\ud2b8\ub97c \ucc98\ub9ac\ud558\ub294 \ub2a5\ub825\uc774 \ub5a8\uc5b4\uc9d1\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uac00 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc801\uc808\ud558\uac8c \ubc30\uce58\ud560 \uc218 \uc788\ub3c4\ub85d \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub178\ub4dc \uc694\uad6c \uc0ac\ud56d\uacfc pod spread\ub97c \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc6cc\ud06c\ub85c\ub4dc\ub294 taint, tolerations \ubc0f PodTopologySpread\ub97c \ud1b5\ud574 \ud544\uc694\ud55c \ub9ac\uc18c\uc2a4\uc640 \ud544\uc694\ud55c \uac00\uc6a9\uc131\uc744 \uc815\uc758\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub4e4\uc740 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \ubd80\ud558 \uac10\uc18c, \uc6b4\uc601 \uac10\uc18c, \ube44\uc6a9 \uc808\uac10\uc774\ub77c\ub294 \uac00\uc6a9\uc131 \ubaa9\ud45c\ub97c \ucda9\ubd84\ud788 \ud65c\uc6a9\ud560 \uc218 \uc788\uace0 \uac00\uc6a9\uc131 \ubaa9\ud45c\ub97c \ucda9\uc871\ud560 \uc218 \uc788\ub294 \uac00\uc7a5 \ud070 \ub178\ub4dc\ub97c \uc120\ud638\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 Scheduler\ub294 \ub9ac\uc18c\uc2a4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uacbd\uc6b0 \uac00\uc6a9 \uc601\uc5ed\uacfc \ud638\uc2a4\ud2b8\uc5d0 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \ubd84\uc0b0\ud558\ub824\uace0 \ud569\ub2c8\ub2e4. \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc6a9\ub7c9\uc774 \uc5c6\ub294 \uacbd\uc6b0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler\ub294 \uac01 \uac00\uc6a9 \uc601\uc5ed\uc5d0 \ub178\ub4dc\ub97c \uade0\ub4f1\ud558\uac8c \ucd94\uac00\ud558\ub824\uace0 \uc2dc\ub3c4\ud569\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub2e4\ub978 \uc694\uad6c \uc0ac\ud56d\uc774 \uc9c0\uc815\ub418\uc5b4 \uc788\uc9c0 \uc54a\ub294 \ud55c Karpenter\ub294 \uac00\ub2a5\ud55c \ud55c \ube60\ub974\uace0 \uc800\ub834\ud558\uac8c \ub178\ub4dc\ub97c \ucd94\uac00\ud558\ub824\uace0 \uc2dc\ub3c4\ud569\ub2c8\ub2e4.</p> <p>\uc2a4\ucf00\uc904\ub7ec\ub97c \ud1b5\ud574 \uc6cc\ud06c\ub85c\ub4dc\ub97c \ubd84\uc0b0\uc2dc\ud0a4\uace0 \uac00\uc6a9 \uc601\uc5ed \uc804\uccb4\uc5d0 \uc0c8 \ub178\ub4dc\ub97c \uc0dd\uc131\ud558\ub3c4\ub85d \ud558\ub824\uba74 TopologySpreadConstraints (topologySpreadConstraints) \ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>spec:\n  topologySpreadConstraints:\n    - maxSkew: 3\n      topologyKey: \"topology.kubernetes.io/zone\"\n      whenUnsatisfiable: ScheduleAnyway\n      labelSelector:\n        matchLabels:\n          dev: my-deployment\n    - maxSkew: 2\n      topologyKey: \"kubernetes.io/hostname\"\n      whenUnsatisfiable: ScheduleAnyway\n      labelSelector:\n        matchLabels:\n          dev: my-deployment\n</code></pre>"},{"location":"ko/scalability/docs/data-plane/#_3","title":"\uc77c\uad00\ub41c \uc6cc\ud06c\ub85c\ub4dc \uc131\ub2a5\uc744 \uc704\ud574 \uc720\uc0ac\ud55c \ub178\ub4dc \ud06c\uae30 \uc0ac\uc6a9","text":"<p>\uc6cc\ud06c\ub85c\ub4dc\ub294 \uc77c\uad00\ub41c \uc131\ub2a5\uacfc \uc608\uce21 \uac00\ub2a5\ud55c \ud655\uc7a5\uc744 \ud5c8\uc6a9\ud558\uae30 \uc704\ud574 \uc2e4\ud589\ud574\uc57c \ud558\ub294 \ub178\ub4dc \ud06c\uae30\ub97c \uc815\uc758\ud574\uc57c \ud569\ub2c8\ub2e4. 500m CPU\ub97c \uc694\uccad\ud558\ub294 \uc6cc\ud06c\ub85c\ub4dc\ub294 4 cores \uc778\uc2a4\ud134\uc2a4\uc640 16 cores \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \ub2e4\ub974\uac8c \uc218\ud589\ub429\ub2c8\ub2e4. T \uc2dc\ub9ac\uc988 \uc778\uc2a4\ud134\uc2a4\uc640 \uac19\uc774 \ubc84\uc2a4\ud2b8 \uac00\ub2a5\ud55c CPU\ub97c \uc0ac\uc6a9\ud558\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc740 \ud53c\ud558\uc138\uc694.</p> <p>\uc6cc\ud06c\ub85c\ub4dc\uac00 \uc77c\uad00\ub41c \uc131\ub2a5\uc744 \uc5bb\uc744 \uc218 \uc788\ub3c4\ub85d \uc6cc\ud06c\ub85c\ub4dc\ub294 \uc9c0\uc6d0\ub418\ub294 Karpenter \ub808\uc774\ube14\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud2b9\uc815 \uc778\uc2a4\ud134\uc2a4 \ud06c\uae30\ub97c \ub300\uc0c1\uc73c\ub85c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kind: deployment\n...\nspec:\n  template:\n    spec:\n    containers:\n    nodeSelector:\n      karpenter.k8s.aws/instance-size: 8xlarge\n</code></pre> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 Cluster Autoscaler\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2a4\ucf00\uc904\ub9c1\ub418\ub294 \uc6cc\ud06c\ub85c\ub4dc\ub294 \ub808\uc774\ube14 \ub9e4\uce6d\uc744 \uae30\ubc18\uc73c\ub85c node selector\ub97c \ub178\ub4dc \uadf8\ub8f9\uacfc \uc77c\uce58\uc2dc\ucf1c\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>spec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: eks.amazonaws.com/nodegroup\n            operator: In\n            values:\n            - 8-core-node-group    # match your node group name\n</code></pre>"},{"location":"ko/scalability/docs/data-plane/#_4","title":"\ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\ub97c \ud6a8\uc728\uc801\uc73c\ub85c \uc0ac\uc6a9","text":"<p>\ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\uc5d0\ub294 EC2 \uc778\uc2a4\ud134\uc2a4 \ubc0f \uac00\uc6a9 \uc601\uc5ed\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4. \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\ub97c \ud6a8\uacfc\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\uba74 \ud655\uc7a5\uc131, \uac00\uc6a9\uc131, \uc131\ub2a5\uc774 \ud5a5\uc0c1\ub418\uace0 \ucd1d \ube44\uc6a9\uc774 \uc808\uac10\ub429\ub2c8\ub2e4. \uc624\ud1a0 \uc2a4\ucf00\uc77c\ub9c1 \ud658\uacbd\uc5d0\uc11c \uc5ec\ub7ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \ud6a8\uc728\uc801\uc778 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub7c9\uc744 \uc608\uce21\ud558\uae30\uac00 \uadf9\ud788 \uc5b4\ub835\uc2b5\ub2c8\ub2e4. Karpenter\ub294 \uc6cc\ud06c\ub85c\ub4dc \uc694\uad6c \uc0ac\ud56d\uc5d0 \ub530\ub77c \uc628\ub514\ub9e8\ub4dc\ub85c \uc778\uc2a4\ud134\uc2a4\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uc5ec \ud65c\uc6a9\ub3c4\uc640 \uc720\uc5f0\uc131\uc744 \uadf9\ub300\ud654\ud558\uae30 \uc704\ud574 \ub9cc\ub4e4\uc5b4\uc84c\uc2b5\ub2c8\ub2e4.</p> <p>Karpenter\ub97c \uc0ac\uc6a9\ud558\uba74 \uba3c\uc800 \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\uac70\ub098 \ud2b9\uc815 \ub178\ub4dc\uc5d0 \ub300\ud55c label taint\ub97c \uad6c\uc131\ud558\uc9c0 \uc54a\uace0\ub3c4 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ud544\uc694\ud55c \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4 \uc720\ud615\uc744 \uc120\uc5b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Karpenter best practices\ub97c \ucc38\uc870\ud558\uc138\uc694. Karpenter provisioner\uc5d0\uc11c consolidation\uc744 \ud65c\uc131\ud654\ud558\uc5ec \ud65c\uc6a9\ub3c4\uac00 \ub0ae\uc740 \ub178\ub4dc\ub97c \uad50\uccb4\ud574 \ubcf4\uc138\uc694.</p>"},{"location":"ko/scalability/docs/data-plane/#amazon-machine-image-ami","title":"Amazon Machine Image (AMI) \uc5c5\ub370\uc774\ud2b8 \uc790\ub3d9\ud654","text":"<p>Worker \ub178\ub4dc \uad6c\uc131 \uc694\uc18c\ub97c \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud558\uba74 \ucd5c\uc2e0 \ubcf4\uc548 \ud328\uce58\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc640 \ud638\ud658\ub418\ub294 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. kublet \uc5c5\ub370\uc774\ud2b8\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ub2a5\uc758 \uac00\uc7a5 \uc911\uc694\ud55c \uad6c\uc131 \uc694\uc18c\uc774\uc9c0\ub9cc OS, \ucee4\ub110 \ubc0f \ub85c\uceec\uc5d0 \uc124\uce58\ub41c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud328\uce58\ub97c \uc790\ub3d9\ud654\ud558\uba74 \ud655\uc7a5\uc5d0 \ub530\ub978 \uc720\uc9c0 \uad00\ub9ac \ube44\uc6a9\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub178\ub4dc \uc774\ubbf8\uc9c0\uc5d0\ub294 \ucd5c\uc2e0 Amazon EKS optimized Amazon Linux 2 \ub610\ub294 Amazon EKS optimized Bottlerocket AMI\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. Karpenter\ub294 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ucd5c\uc2e0 AMI \ub97c \uc790\ub3d9\uc73c\ub85c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc0c8 \ub178\ub4dc\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud569\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 \ub178\ub4dc \uadf8\ub8f9 \uc5c5\ub370\uc774\ud2b8 \uc911\uc5d0 AMI\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0\ub9cc \ub178\ub4dc \ud504\ub85c\ube44\uc800\ub2dd \uc2dc\uc5d0\ub294 AMI ID\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <p>\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc758 \uacbd\uc6b0 \ud328\uce58 \ub9b4\ub9ac\uc2a4\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ub418\uba74 Auto Scaling Group (ASG) \uc2dc\uc791 \ud15c\ud50c\ub9bf\uc744 \uc0c8 AMI ID\ub85c \uc5c5\ub370\uc774\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4. AMI \ub9c8\uc774\ub108 \ubc84\uc804 (\uc608: 1.23.5~1.24.3)\uc740 EKS \ucf58\uc194 \ubc0f API\uc5d0\uc11c \ub178\ub4dc \uadf8\ub8f9 \uc5c5\uadf8\ub808\uc774\ub4dc\ub85c \uc81c\uacf5\ub429\ub2c8\ub2e4. \ud328\uce58 \ub9b4\ub9ac\uc2a4 \ubc84\uc804 (\uc608: 1.23.5 ~ 1.23.6)\uc740 \ub178\ub4dc \uadf8\ub8f9\uc5d0 \ub300\ud55c \uc5c5\uadf8\ub808\uc774\ub4dc\ub85c \uc81c\uacf5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. AMI \ud328\uce58 \ub9b4\ub9ac\uc2a4\ub97c \ud1b5\ud574 \ub178\ub4dc \uadf8\ub8f9\uc744 \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud558\ub824\uba74 \uc0c8 \uc2dc\uc791 \ud15c\ud50c\ub9bf \ubc84\uc804\uc744 \uc0dd\uc131\ud558\uace0 \ub178\ub4dc \uadf8\ub8f9\uc774 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0c8 AMI \ub9b4\ub9ac\uc2a4\ub85c \uad50\uccb4\ud558\ub3c4\ub85d \ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc774 \ud398\uc774\uc9c0 \uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ucd5c\uc2e0 AMI\ub97c \ucc3e\uac70\ub098 AWS CLI\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>aws ssm get-parameter \\\n  --name /aws/service/eks/optimized-ami/1.24/amazon-linux-2/recommended/image_id \\\n  --query \"Parameter.Value\" \\\n  --output text\n</code></pre>"},{"location":"ko/scalability/docs/data-plane/#ebs","title":"\ucee8\ud14c\uc774\ub108\uc5d0 \uc5ec\ub7ec EBS \ubcfc\ub968 \uc0ac\uc6a9","text":"<p>EBS \ubcfc\ub968\uc5d0\ub294 \ubcfc\ub968 \uc720\ud615 (\uc608: gp3) \ubc0f \ub514\uc2a4\ud06c \ud06c\uae30\uc5d0 \ub530\ub978 \uc785/\ucd9c\ub825 (I/O) \ud560\ub2f9\ub7c9\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ud638\uc2a4\ud2b8\uc640 \ub2e8\uc77c EBS \ub8e8\ud2b8 \ubcfc\ub968\uc744 \uacf5\uc720\ud558\ub294 \uacbd\uc6b0 \uc804\uccb4 \ud638\uc2a4\ud2b8\uc758 \ub514\uc2a4\ud06c \ud560\ub2f9\ub7c9\uc774 \uace0\uac08\ub418\uace0 \ub2e4\ub978 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uac00\uc6a9 \uc6a9\ub7c9\uc744 \uae30\ub2e4\ub9ac\uac8c \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uc751 \uc6a9 \ud504\ub85c\uadf8\ub7a8\uc740 \uc624\ubc84\ub808\uc774 \ud30c\ud2f0\uc158\uc5d0 \ud30c\uc77c\uc744 \uc4f0\uace0, \ud638\uc2a4\ud2b8\uc5d0\uc11c \ub85c\uceec \ubcfc\ub968\uc744 \ub9c8\uc6b4\ud2b8\ud558\uace0, \uc0ac\uc6a9\ub41c \ub85c\uae45 \uc5d0\uc774\uc804\ud2b8\uc5d0 \ub530\ub77c \ud45c\uc900 \ucd9c\ub825 (STDOUT)\uc5d0 \ub85c\uadf8\uc628\ud560 \ub54c\ub3c4 \ub514\uc2a4\ud06c\uc5d0 \uae30\ub85d\ud569\ub2c8\ub2e4.</p> <p>Disk I/O \uc18c\ubaa8\ub97c \ubc29\uc9c0\ud558\ub824\uba74 \ub450 \ubc88\uc9f8 \ubcfc\ub968\uc744 \ucee8\ud14c\uc774\ub108 state \ud3f4\ub354 (\uc608: /run/containerd)\uc5d0 \ub9c8\uc6b4\ud2b8\ud558\uace0, \uc6cc\ud06c\ub85c\ub4dc \uc2a4\ud1a0\ub9ac\uc9c0\uc6a9\uc73c\ub85c \ubcc4\ub3c4\uc758 EBS \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud558\uace0, \ubd88\ud544\uc694\ud55c \ub85c\uceec \ub85c\uae45\uc744 \ube44\ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>eksctl\uc744 \uc0ac\uc6a9\ud558\uc5ec EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ub450 \ubc88\uc9f8 \ubcfc\ub968\uc744 \ub9c8\uc6b4\ud2b8\ud558\ub824\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \uad6c\uc131\uc758 \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>managedNodeGroups:\n  - name: al2-workers\n    amiFamily: AmazonLinux2\n    desiredCapacity: 2\n    volumeSize: 80\n    additionalVolumes:\n      - volumeName: '/dev/sdz'\n        volumeSize: 100\n    preBootstrapCommands:\n    - |\n      \"systemctl stop containerd\"\n      \"mkfs -t ext4 /dev/nvme1n1\"\n      \"rm -rf /var/lib/containerd/*\"\n      \"mount /dev/nvme1n1 /var/lib/containerd/\"\n      \"systemctl start containerd\"\n</code></pre> <p>Terraform\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc \uadf8\ub8f9\uc744 \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \uacbd\uc6b0 EKS Blueprints for terraform\uc758 \uc608\ub97c \ucc38\uc870\ud558\uc138\uc694. Karpenter\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \uacbd\uc6b0 \ub178\ub4dc \uc0ac\uc6a9\uc790 \ub370\uc774\ud130\uc640 \ud568\uaed8 <code>blockDeviceMappings</code>\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucd94\uac00 \ubcfc\ub968\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>EBS \ubcfc\ub968\uc744 \ud30c\ub4dc\uc5d0 \uc9c1\uc811 \ud0d1\uc7ac\ud558\ub824\uba74 AWS EBS CSI \ub4dc\ub77c\uc774\ubc84\ub97c \uc0ac\uc6a9\ud558\uace0 \uc2a4\ud1a0\ub9ac\uc9c0 \ud074\ub798\uc2a4\uac00 \uc788\ub294 \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: ebs-sc\nprovisioner: ebs.csi.aws.com\nvolumeBindingMode: WaitForFirstConsumer\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: ebs-claim\nspec:\n  accessModes:\n    - ReadWriteOnce\n  storageClassName: ebs-sc\n  resources:\n    requests:\n      storage: 4Gi\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: app\nspec:\n  containers:\n  - name: app\n    image: public.ecr.aws/docker/library/nginx\n    volumeMounts:\n    - name: persistent-storage\n      mountPath: /data\n  volumes:\n  - name: persistent-storage\n    persistentVolumeClaim:\n      claimName: ebs-claim\n</code></pre>"},{"location":"ko/scalability/docs/data-plane/#ebs-ebs","title":"\uc6cc\ud06c\ub85c\ub4dc\uc5d0\uc11c EBS \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 EBS \uc5f0\uacb0 \uc81c\ud55c\uc774 \ub0ae\uc740 \uc778\uc2a4\ud134\uc2a4\ub97c \ud53c\ud558\uc138\uc694.","text":"<p>EBS\ub294 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc601\uad6c \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \ud655\ubcf4\ud558\ub294 \uac00\uc7a5 \uc26c\uc6b4 \ubc29\ubc95 \uc911 \ud558\ub098\uc774\uc9c0\ub9cc \ud655\uc7a5\uc131 \uc81c\ud55c\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uac01 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0\ub294 \uc5f0\uacb0\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 EBS \ubcfc\ub968 \uc218\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\ub294 \uc2e4\ud589\ud574\uc57c \ud558\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc744 \uc120\uc5b8\ud558\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 taints\uac00 \uc788\ub294 \ub2e8\uc77c \uc778\uc2a4\ud134\uc2a4\uc758 \ubcf5\uc81c\ubcf8 \uc218\ub97c \uc81c\ud55c\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/data-plane/#_5","title":"\ub514\uc2a4\ud06c\uc5d0 \ubd88\ud544\uc694\ud55c \ub85c\uae45\uc744 \ube44\ud65c\uc131\ud654","text":"<p>\ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0\uc11c \ub514\ubc84\uadf8 \ub85c\uae45\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589\ud558\uc9c0 \uc54a\uace0 \ub514\uc2a4\ud06c\ub97c \uc790\uc8fc \uc77d\uace0 \uc4f0\ub294 \ub85c\uae45\uc744 \ube44\ud65c\uc131\ud654\ud558\uc5ec \ubd88\ud544\uc694\ud55c \ub85c\uceec \ub85c\uae45\uc744 \ud53c\ud558\uc138\uc694. Journald\ub294 \ub85c\uadf8 \ubc84\ud37c\ub97c \uba54\ubaa8\ub9ac\uc5d0 \uc720\uc9c0\ud558\uace0 \uc8fc\uae30\uc801\uc73c\ub85c \ub514\uc2a4\ud06c\uc5d0 \ud50c\ub7ec\uc2dc\ud558\ub294 \ub85c\uceec \ub85c\uae45 \uc11c\ube44\uc2a4\uc785\ub2c8\ub2e4. Journald\ub294 \ubaa8\ub4e0 \ud589\uc744 \uc989\uc2dc \ub514\uc2a4\ud06c\uc5d0 \uae30\ub85d\ud558\ub294 syslog\ubcf4\ub2e4 \uc120\ud638\ub429\ub2c8\ub2e4. syslog\ub97c \ube44\ud65c\uc131\ud654\ud558\uba74 \ud544\uc694\ud55c \ucd1d \uc2a4\ud1a0\ub9ac\uc9c0 \uc6a9\ub7c9\ub3c4 \uc904\uc5b4\ub4e4\uace0 \ubcf5\uc7a1\ud55c \ub85c\uadf8 \uc21c\ud658 \uaddc\uce59\uc774 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. syslog\ub97c \ube44\ud65c\uc131\ud654\ud558\ub824\uba74 cloud-init \uad6c\uc131\uc5d0 \ub2e4\uc74c \ucf54\ub4dc \uc870\uac01\uc744 \ucd94\uac00\ud558\uba74 \ub429\ub2c8\ub2e4.</p> <pre><code>runcmd:\n  - [ systemctl, disable, --now, syslog.service ]\n</code></pre>"},{"location":"ko/scalability/docs/data-plane/#os-in-place","title":"OS \uc5c5\ub370\uc774\ud2b8 \uc18d\ub3c4\uac00 \ud544\uc694\ud560 \ub54c in place \ubc29\uc2dd\uc73c\ub85c \uc778\uc2a4\ud134\uc2a4 \ud328\uce58","text":"<p>Attention</p> <p>\uc778\uc2a4\ud134\uc2a4 \ud328\uce58\ub294 \ud544\uc694\ud55c \uacbd\uc6b0\uc5d0\ub9cc \uc218\ud589\ud574\uc57c \ud569\ub2c8\ub2e4. Amazon\uc5d0\uc11c\ub294 \uc778\ud504\ub77c\ub97c \ubcc0\uacbd\ud560 \uc218 \uc5c6\ub294 \uac83\uc73c\ub85c \ucde8\uae09\ud558\uace0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \ub3d9\uc77c\ud55c \ubc29\uc2dd\uc73c\ub85c \ud558\uc704 \ud658\uacbd\uc744 \ud1b5\ud574 \uc2b9\uaca9\ub418\ub294 \uc5c5\ub370\uc774\ud2b8\ub97c \ucca0\uc800\ud788 \ud14c\uc2a4\ud2b8\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \uc774 \uc139\uc158\uc740 \uc774\uac83\uc774 \ubd88\uac00\ub2a5\ud560 \ub54c \uc801\uc6a9\ub429\ub2c8\ub2e4.</p> <p>\ucee8\ud14c\uc774\ub108\ud654\ub41c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc911\ub2e8\ud558\uc9c0 \uc54a\uace0 \uae30\uc874 Linux \ud638\uc2a4\ud2b8\uc5d0 \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud558\ub294 \ub370 \uba87 \ucd08 \ubc16\uc5d0 \uac78\ub9ac\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4\ub97c \ucc28\ub2e8(cordoning), \ub4dc\ub808\uc774\ub2dd(draining) \ub610\ub294 \uad50\uccb4(replacing)\ud558\uc9c0 \uc54a\uace0\ub3c4 \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud558\uace0 \uac80\uc99d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc778\uc2a4\ud134\uc2a4\ub97c \uad50\uccb4\ud558\ub824\uba74 \uba3c\uc800 \uc0c8 AMI\ub97c \uc0dd\uc131, \uac80\uc99d \ubc0f \ubc30\ud3ec\ud574\uc57c \ud569\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4\uc5d0\ub294 \ub300\uccb4 \uc778\uc2a4\ud134\uc2a4\uac00 \uc0dd\uc131\ub418\uc5b4\uc57c \ud558\uba70, \uc774\uc804 \uc778\uc2a4\ud134\uc2a4\ub294 \ucc28\ub2e8 \ubc0f \uc81c\uac70\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c \uc0c8 \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc0dd\uc131\ud558\uace0 \ud655\uc778\ud558\uace0 \ud328\uce58\uac00 \ud544\uc694\ud55c \ubaa8\ub4e0 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ub300\ud574 \ubc18\ubcf5\ud574\uc57c \ud569\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc911\ub2e8\ud558\uc9c0 \uc54a\uace0 \uc778\uc2a4\ud134\uc2a4\ub97c \uc548\uc804\ud558\uac8c \uad50\uccb4\ud558\ub824\uba74 \uba87 \uc2dc\uac04, \uba70\uce60 \ub610\ub294 \uba87 \uc8fc\uac00 \uac78\ub9bd\ub2c8\ub2e4.</p> <p>Amazon\uc5d0\uc11c\ub294 \uc790\ub3d9\ud654\ub41c \uc120\uc5b8\uc801 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \uad6c\ucd95, \ud14c\uc2a4\ud2b8 \ubc0f \uc2b9\uaca9\ub418\ub294 \ubd88\ubcc0 \uc778\ud504\ub77c\ub97c \uc0ac\uc6a9\ud560 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc2dc\uc2a4\ud15c\uc5d0 \uc2e0\uc18d\ud558\uac8c \ud328\uce58\ub97c \uc801\uc6a9\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \uc2dc\uc2a4\ud15c\uc744 \ud328\uce58\ud558\uace0 \uc0c8 AMI\uac00 \ucd9c\uc2dc\ub418\uba74 \uad50\uccb4\ud574\uc57c \ud569\ub2c8\ub2e4. \uc2dc\uc2a4\ud15c \ud328\uce58\uc640 \uad50\uccb4 \uc0ac\uc774\uc758 \uc2dc\uac04 \ucc28\uc774\uac00 \ud06c\uae30 \ub54c\ubb38\uc5d0 AWS Systems Manager Patch Manager\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ud544\uc694\ud55c \uacbd\uc6b0 \ub178\ub4dc \ud328\uce58\ub97c \uc790\ub3d9\ud654\ud569\ub2c8\ub2e4.</p> <p>\ub178\ub4dc \ud328\uce58\ub97c \uc0ac\uc6a9\ud558\uba74 \ubcf4\uc548 \uc5c5\ub370\uc774\ud2b8\ub97c \uc2e0\uc18d\ud558\uac8c \ucd9c\uc2dc\ud558\uace0 AMI\uac00 \uc5c5\ub370\uc774\ud2b8\ub41c \ud6c4 \uc815\uae30\uc801\uc778 \uc77c\uc815\uc5d0 \ub530\ub77c \uc778\uc2a4\ud134\uc2a4\ub97c \uad50\uccb4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Flatcar Container Linux \ub610\ub294 Bottlerocket OS\uc640 \uac19\uc740 \uc77d\uae30 \uc804\uc6a9 \ub8e8\ud2b8 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc774 \uc788\ub294 \uc6b4\uc601 \uccb4\uc81c\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ud574\ub2f9 \uc6b4\uc601 \uccb4\uc81c\uc5d0\uc11c \uc791\ub3d9\ud558\ub294 \uc5c5\ub370\uc774\ud2b8 \uc5f0\uc0b0\uc790\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. Flatcar Linux update operator \ubc0f Bottlerocket update operator\ub294 \uc778\uc2a4\ud134\uc2a4\ub97c \uc7ac\ubd80\ud305\ud558\uc5ec \ub178\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/kcp_monitoring/","title":"\ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ubaa8\ub2c8\ud130\ub9c1","text":""},{"location":"ko/scalability/docs/kcp_monitoring/#api-server","title":"API Server","text":"<p>API Server\ub97c \uc0b4\ud3b4\ubcfc \ub54c \uadf8 \uae30\ub2a5 \uc911 \ud558\ub098\uac00 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \uacfc\ubd80\ud558\ub97c \ubc29\uc9c0\ud558\uae30 \uc704\ud574 \uc778\ubc14\uc6b4\ub4dc \uc694\uccad\uc744 \uc870\uc808\ud558\ub294 \uac83\uc784\uc744 \uae30\uc5b5\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. API Server \uc218\uc900\uc5d0\uc11c \ubcd1\ubaa9 \ud604\uc0c1\uc774 \ubc1c\uc0dd\ud558\ub294 \uac83\ucc98\ub7fc \ubcf4\uc77c \uc218 \uc788\ub294 \uac83\uc740 \uc2e4\uc81c\ub85c \ub354 \uc2ec\uac01\ud55c \ubb38\uc81c\ub85c\ubd80\ud130 \uc774\ub97c \ubcf4\ud638\ud558\ub294 \uac83\uc77c \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc2dc\uc2a4\ud15c\uc744 \ud1b5\ud574 \uc774\ub3d9\ud558\ub294 \uc694\uccad\ub7c9 \uc99d\uac00\uc758 \uc7a5\ub2e8\uc810\uc744 \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4. API Server \uac12\uc744 \ub298\ub824\uc57c \ud558\ub294\uc9c0 \uacb0\uc815\ud558\uae30 \uc704\ud574 \uc5fc\ub450\uc5d0 \ub450\uc5b4\uc57c \ud560 \uc0ac\ud56d\uc5d0 \ub300\ud55c \uc791\uc740 \uc0d8\ud50c\ub9c1\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <ol> <li>\uc2dc\uc2a4\ud15c\uc744 \ud1b5\ud574 \uc774\ub3d9\ud558\ub294 \uc694\uccad\uc758 \ub300\uae30 \uc2dc\uac04\uc740 \uc5bc\ub9c8\ub098 \ub429\ub2c8\uae4c?</li> <li>\uc9c0\uc5f0 \uc2dc\uac04\uc740 API Server \uc790\uccb4\uc785\ub2c8\uae4c, \uc544\ub2c8\uba74 etcd\uc640 \uac19\uc740 \"\ub2e4\uc6b4\uc2a4\ud2b8\ub9bc\"\uc785\ub2c8\uae4c?</li> <li>API \uc11c\ubc84 \ub300\uae30\uc5f4 \uae4a\uc774\uac00 \uc774 \uc9c0\uc5f0 \uc2dc\uac04\uc758 \uc694\uc778\uc785\ub2c8\uae4c?</li> <li>API \uc6b0\uc120 \uc21c\uc704 \ubc0f \uacf5\uc815\uc131(APF) \ub300\uae30\uc5f4\uc774 \uc6b0\ub9ac\uac00 \uc6d0\ud558\ub294 API \ud638\ucd9c \ud328\ud134\uc5d0 \ub9de\uac8c \uc62c\ubc14\ub974\uac8c \uc124\uc815\ub418\uc5b4 \uc788\uc2b5\ub2c8\uae4c?</li> </ol>"},{"location":"ko/scalability/docs/kcp_monitoring/#_2","title":"\ubb38\uc81c\uac00 \uc788\ub294 \uacf3\uc740 \uc5b4\ub514\uc785\ub2c8\uae4c?","text":"<p>\uba3c\uc800 API \uc9c0\uc5f0 \uc2dc\uac04 \uce21\uc815 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uc5ec API Server\uac00 \uc694\uccad\uc744 \ucc98\ub9ac\ud558\ub294 \ub370 \uac78\ub9ac\ub294 \uc2dc\uac04\uc744 \ud30c\uc545\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc544\ub798 PromQL \ubc0f Grafana \ud788\ud2b8\ub9f5\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc774 \ub370\uc774\ud130\ub97c \ud45c\uc2dc\ud574 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p> <pre><code>max(increase(apiserver_request_duration_seconds_bucket{subresource!=\"status\",subresource!=\"token\",subresource!=\"scale\",subresource!=\"/healthz\",subresource!=\"binding\",subresource!=\"proxy\",verb!=\"WATCH\"}[$__rate_interval])) by (le)\n</code></pre> <p>\ud301</p> <p>\uc774 \ubb38\uc11c\uc5d0 \uc0ac\uc6a9\ub41c API \ub300\uc2dc\ubcf4\ub4dc\ub85c API \uc11c\ubc84\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ub2e4\uc74c blog\ub97c \ucc38\uc870\ud558\uc138\uc694.</p> <p></p> <p>\uc774\ub7ec\ud55c \uc694\uccad\uc740 \ubaa8\ub450 1\ucd08 \uc544\ub798\uc5d0 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc774 \uc801\uc2dc\uc5d0 \uc694\uccad\uc744 \ucc98\ub9ac\ud558\uace0 \uc788\uc74c\uc744 \ub098\ud0c0\ub0b4\ub294 \uc88b\uc740 \ud45c\uc2dc\uc785\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uadf8\ub807\uc9c0 \uc54a\ub2e4\uba74 \uc5b4\ub5a8\uae4c\uc694?</p> <p>\uc704\uc758 API \uc694\uccad \uae30\uac04\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ud615\uc2dd\uc740 \ud788\ud2b8\ub9f5\uc785\ub2c8\ub2e4. \ud788\ud2b8\ub9f5 \ud615\uc2dd\uc758 \uc88b\uc740 \uc810\uc740 \uae30\ubcf8\uc801\uc73c\ub85c API\uc758 \uc81c\ud55c \uc2dc\uac04 \uac12(60\ucd08)\uc744 \uc54c\ub824\uc900\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \uc2e4\uc81c\ub85c \uc54c\uc544\uc57c \ud560 \uac83\uc740 \uc2dc\uac04 \ucd08\uacfc \uc784\uacc4\uac12\uc5d0 \ub3c4\ub2ec\ud558\uae30 \uc804\uc5d0 \uc774 \uac12\uc774 \uc5b4\ub5a4 \uc784\uacc4\uac12\uc5d0 \uad00\uc2ec\uc744 \uac00\uc838\uc57c \ud558\ub294\uac00\uc785\ub2c8\ub2e4. \ud5c8\uc6a9 \uac00\ub2a5\ud55c \uc784\uacc4\uac12\uc5d0 \ub300\ud55c \ub300\ub7b5\uc801\uc778 \uc9c0\uce68\uc744 \ubcf4\ub824\uba74 \uc5ec\uae30\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\ub294 \uc5c5\uc2a4\ud2b8\ub9bc \ucfe0\ubc84\ub124\ud2f0\uc2a4 SLO\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud301</p> <p>\uc774 \uba85\ub839\ubb38\uc758 max \ud568\uc218\ub97c \ud655\uc778\ud558\uc138\uc694. \uc5ec\ub7ec \uc11c\ubc84(\uae30\ubcf8\uc801\uc73c\ub85c EKS\uc758 \ub450 API Server)\ub97c \uc9d1\uacc4\ud558\ub294 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud560 \ub54c \ud574\ub2f9 \uc11c\ubc84\uc758 \ud3c9\uade0\uc744 \uad6c\ud558\uc9c0 \uc54a\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/kcp_monitoring/#_3","title":"\ube44\ub300\uce6d \ud2b8\ub798\ud53d \ud328\ud134","text":"<p>\ud55c API Server [pod]\ub294 \ub85c\ub4dc\uac00 \uc57d\ud558\uace0 \ub2e4\ub978 \ud558\ub098\ub294 \uacfc\ubd80\ud558\uac00 \uac78\ub9ac\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c\uc694?\uc774 \ub450 \uc22b\uc790\uc758 \ud3c9\uade0\uc744 \uad6c\ud558\uba74 \ubb34\uc2a8 \uc77c\uc774 \ubc8c\uc5b4\uc84c\ub294\uc9c0 \uc798\ubabb \ud574\uc11d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \uc5ec\uae30\uc5d0\ub294 \uc138 \uac1c\uc758 API Server\uac00 \uc788\uc9c0\ub9cc \ubaa8\ub4e0 \ub85c\ub4dc\ub294 \uc774 API Server \uc911 \ud558\ub098\uc5d0 \uc788\uc2b5\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c etcd \ubc0f API \uc11c\ubc84\uc640 \uac19\uc774 \uc5ec\ub7ec \uc11c\ubc84\uac00 \uc788\ub294 \ubaa8\ub4e0 \uac83\uc740 \uaddc\ubaa8 \ubc0f \uc131\ub2a5 \ubb38\uc81c\uc5d0 \ud22c\uc790\ud560 \ub54c \ubd84\ub9ac\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4.</p> <p></p> <p>API \uc6b0\uc120\uc21c\uc704 \ubc0f \uacf5\uc815\uc131(APF)\uc73c\ub85c \uc804\ud658\ud558\uba74\uc11c \uc2dc\uc2a4\ud15c\uc758 \ucd1d \uc694\uccad \uc218\ub294 API Server\uac00 \ucd08\uacfc \uad6c\ub3c5\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud558\ub294 \ud558\ub098\uc758 \uc694\uc18c\uc77c \ubfd0\uc785\ub2c8\ub2e4. \uc774\uc81c \uc2dc\uc2a4\ud15c\uc5d0\uc11c \uc77c\ub828\uc758 \ub300\uae30\uc5f4\uc744 \uc0ac\uc6a9\ud558\ubbc0\ub85c \ub300\uae30\uc5f4\uc774 \uaf49 \ucc3c\ub294\uc9c0, \ud574\ub2f9 \ub300\uae30\uc5f4\uc758 \ud2b8\ub798\ud53d\uc774 \uc0ad\uc81c\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud574\uc57c \ud569\ub2c8\ub2e4. </p> <p>\ub2e4\uc74c \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\ub7ec\ud55c \ub300\uae30\uc5f4\uc744 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p> <pre><code>max without(instance)(apiserver_flowcontrol_request_concurrency_limit{})\n</code></pre> <p>Note</p> <p>API A&amp;F \uc791\ub3d9 \ubc29\uc2dd\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ub2e4\uc74c \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc138\uc694.</p> <p>\uc5ec\uae30\uc5d0\uc11c\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uae30\ubcf8\uc801\uc73c\ub85c \uc81c\uacf5\ub418\ub294 7\uac1c\uc758 \uc11c\ub85c \ub2e4\ub978 \uc6b0\uc120\uc21c\uc704 \uadf8\ub8f9\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>\ub2e4\uc74c\uc73c\ub85c \ud2b9\uc815 \uc6b0\uc120\uc21c\uc704 \uc218\uc900\uc774 \ud3ec\ud654 \uc0c1\ud0dc\uc778\uc9c0 \ud30c\uc545\ud558\uae30 \uc704\ud574 \ud574\ub2f9 \uc6b0\uc120\uc21c\uc704 \uadf8\ub8f9\uc774 \uba87 \ud37c\uc13c\ud2b8\uc758 \ube44\uc728\ub85c \uc0ac\uc6a9\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uace0\uc790 \ud569\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\uac00 \ub0ae\uc740 \uc218\uc900\uc5d0\uc11c\ub294 \uc694\uccad\uc744 \uc2a4\ub85c\ud2c0\ub9c1\ud558\ub294 \uac83\uc774 \ubc14\ub78c\uc9c1\ud560 \uc218 \uc788\uc9c0\ub9cc \ub9ac\ub354 \uc120\ucd9c \uc218\uc900\uc5d0\uc11c\ub294 \uadf8\ub807\uc9c0 \uc54a\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>API \uc6b0\uc120 \uc21c\uc704 \ubc0f \uacf5\uc815\uc131(APF) \uc2dc\uc2a4\ud15c\uc5d0\ub294 \uc5ec\ub7ec \uac00\uc9c0 \ubcf5\uc7a1\ud55c \uc635\uc158\uc774 \uc788\uc73c\uba70, \uc774\ub7ec\ud55c \uc635\uc158 \uc911 \uc77c\ubd80\ub294 \uc758\ub3c4\ud558\uc9c0 \uc54a\uc740 \uacb0\uacfc\ub97c \ucd08\ub798\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\uc5d0\uc11c \uc77c\ubc18\uc801\uc73c\ub85c \ubcfc \uc218 \uc788\ub294 \ubb38\uc81c\ub294 \ubd88\ud544\uc694\ud55c \ub300\uae30 \uc2dc\uac04\uc774 \ucd94\uac00\ub418\uae30 \uc2dc\uc791\ud558\ub294 \uc9c0\uc810\uae4c\uc9c0 \ub300\uae30\uc5f4 \uae4a\uc774\ub97c \ub298\ub9ac\ub294 \uac83\uc785\ub2c8\ub2e4. <code>apiserver_flowcontrol_current_inqueue_request</code> \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774 \ubb38\uc81c\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>apiserver_flowcontrol_rejected_requests_total</code>\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc0ad\uc81c\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubc84\ud0b7\uc774 \ub3d9\uc2dc\uc131\uc744 \ucd08\uacfc\ud558\ub294 \uacbd\uc6b0 \uc774\ub7ec\ud55c \uc9c0\ud45c\ub294 0\uc774 \uc544\ub2cc \uac12\uc774 \ub429\ub2c8\ub2e4.</p> <p></p> <p>\ub300\uae30\uc5f4 \uae4a\uc774\ub97c \ub298\ub9ac\uba74 API Server\uac00 \uc9c0\uc5f0 \uc2dc\uac04\uc758 \uc911\uc694\ud55c \uc6d0\uc778\uc774 \ub420 \uc218 \uc788\uc73c\ubbc0\ub85c \uc8fc\uc758\ud574\uc11c \uc218\ud589\ud574\uc57c \ud569\ub2c8\ub2e4. \uc0dd\uc131\ub41c \ub300\uae30\uc5f4 \uc218\ub97c \uc2e0\uc911\ud558\uac8c \uacb0\uc815\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 EKS \uc2dc\uc2a4\ud15c\uc758 \uacf5\uc720 \uc218\ub294 600\uac1c\uc785\ub2c8\ub2e4. \ub108\ubb34 \ub9ce\uc740 \ub300\uae30\uc5f4\uc744 \uc0dd\uc131\ud558\uba74 \ub9ac\ub354 \uc120\ud0dd \ub300\uae30\uc5f4\uc774\ub098 \uc2dc\uc2a4\ud15c \ub300\uae30\uc5f4\uacfc \uac19\uc774 \ucc98\ub9ac\ub7c9\uc774 \ud544\uc694\ud55c \uc911\uc694\ud55c \ub300\uae30\uc5f4\uc758 \uacf5\uc720\uac00 \uc904\uc5b4\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd94\uac00 \ub300\uae30\uc5f4\uc744 \ub108\ubb34 \ub9ce\uc774 \uc0dd\uc131\ud558\uba74 \uc774\ub7ec\ud55c \ub300\uae30\uc5f4\uc758 \ud06c\uae30\ub97c \uc62c\ubc14\ub974\uac8c \uc9c0\uc815\ud558\uae30\uac00 \ub354 \uc5b4\ub824\uc6cc\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>APF\uc5d0\uc11c \uc218\ud589\ud560 \uc218 \uc788\ub294 \uac04\ub2e8\ud558\uace0 \uc601\ud5a5\ub825 \uc788\ub294 \ubcc0\uacbd\uc5d0 \ucd08\uc810\uc744 \ub9de\ucd94\uae30 \uc704\ud574 \ud65c\uc6a9\ub3c4\uac00 \ub0ae\uc740 \ubc84\ud0b7\uc5d0\uc11c \uacf5\uc720\ub97c \uac00\uc838\uc640 \ucd5c\ub300 \uc0ac\uc6a9\ub7c9\uc5d0 \uc788\ub294 \ubc84\ud0b7\uc758 \ud06c\uae30\ub97c \ub298\ub9bd\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ubc84\ud0b7 \uac04\uc5d0 \uacf5\uc720\ub97c \uc9c0\ub2a5\uc801\uc73c\ub85c \uc7ac\ubd84\ubc30\ud568\uc73c\ub85c\uc368 \uc0ad\uc81c \uac00\ub2a5\uc131\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 EKS \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc API \uc6b0\uc120\uc21c\uc704 \ubc0f \uacf5\uc815\uc131 \uc124\uc815\uc744 \ucc38\uc870\ud558\uc138\uc694.</p>"},{"location":"ko/scalability/docs/kcp_monitoring/#api-vs-etcd","title":"API vs. etcd \uc9c0\uc5f0 \uc2dc\uac04","text":"<p>API Server\uc758 \uba54\ud2b8\ub9ad/\ub85c\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec API Server\uc5d0 \ubb38\uc81c\uac00 \uc788\ub294\uc9c0, API Server\uc758 \uc5c5\uc2a4\ud2b8\ub9bc/\ub2e4\uc6b4\uc2a4\ud2b8\ub9bc \ub610\ub294 \uc774 \ub458\uc758 \uc870\ud569\uc5d0 \ubb38\uc81c\uac00 \uc788\ub294\uc9c0 \ud310\ub2e8\ud558\ub824\uba74 \uc5b4\ub5bb\uac8c \ud574\uc57c \ud569\ub2c8\uae4c? \uc774\ub97c \ub354 \uc798 \uc774\ud574\ud558\uae30 \uc704\ud574 API Server\uc640 etcd\uac00 \uc5b4\ub5a4 \uad00\ub828\uc774 \uc788\ub294\uc9c0, \uadf8\ub9ac\uace0 \uc798\ubabb\ub41c \uc2dc\uc2a4\ud15c\uc744 \ud574\uacb0\ud558\ub294 \uac83\uc774 \uc5bc\ub9c8\ub098 \uc26c\uc6b4\uc9c0 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p> <p>\uc544\ub798 \ucc28\ud2b8\uc5d0\uc11c\ub294 API Server\uc758 \uc9c0\uc5f0 \uc2dc\uac04\uc744 \ubcfc \uc218 \uc788\uc9c0\ub9cc, etcd \uc218\uc900\uc5d0\uc11c \ub300\ubd80\ubd84\uc758 \uc9c0\uc5f0 \uc2dc\uac04\uc744 \ubcf4\uc5ec\uc8fc\ub294 \uadf8\ub798\ud504\uc758 \ub9c9\ub300\ub85c \uc778\ud574 \uc774 \uc9c0\uc5f0 \uc2dc\uac04\uc758 \uc0c1\ub2f9 \ubd80\ubd84\uc774 etcd \uc11c\ubc84\uc640 \uc5f0\uad00\ub418\uc5b4 \uc788\uc74c\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. etcd \ub300\uae30 \uc2dc\uac04\uc774 15\ucd08\uc774\uace0 \ub3d9\uc2dc\uc5d0 API \uc11c\ubc84 \ub300\uae30 \uc2dc\uac04\uc774 20\ucd08\uc778 \uacbd\uc6b0 \ub300\uae30 \uc2dc\uac04\uc758 \ub300\ubd80\ubd84\uc740 \uc2e4\uc81c\ub85c etcd \uc218\uc900\uc5d0 \uc788\uc2b5\ub2c8\ub2e4</p> <p>\uc804\uccb4 \ud750\ub984\uc744 \uc0b4\ud3b4\ubcf4\uba74 API Server\uc5d0\ub9cc \uc9d1\uc911\ud558\uc9c0 \uc54a\uace0 etcd\uac00 \uc555\ubc15\uc744 \ubc1b\uace0 \uc788\uc74c\uc744 \ub098\ud0c0\ub0b4\ub294 \uc2e0\ud638(\uc608: slow apply counters \uc99d\uac00)\ub97c \ucc3e\ub294 \uac83\uc774 \ud604\uba85\ud558\ub2e4\ub294 \uac83\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Tip</p> <p>The dashboard in section can be found at https://github.com/RiskyAdventure/Troubleshooting-Dashboards/blob/main/api-troubleshooter.json</p> <p></p>"},{"location":"ko/scalability/docs/kcp_monitoring/#_4","title":"\ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ud074\ub77c\uc774\uc5b8\ud2b8 \uce21 \ubb38\uc81c","text":"<p>\uc774 \ucc28\ud2b8\uc5d0\uc11c\ub294 \ud574\ub2f9 \uae30\uac04 \ub3d9\uc548 \uc644\ub8cc\ud558\ub294 \ub370 \uac00\uc7a5 \ub9ce\uc740 \uc2dc\uac04\uc774 \uac78\ub9b0 API \ud638\ucd9c\uc744 \ucc3e\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 \uc0ac\uc6a9\uc790 \uc815\uc758 \ub9ac\uc18c\uc2a4(CRD)\uac00 05:40 \uc2dc\uac04 \ud504\ub808\uc784 \ub3d9\uc548 \uac00\uc7a5 \uc624\ub798\uac78\ub9b0 \ud638\ucd9c\uc774 APPLY \ud568\uc218\ub77c\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>\uc774 \ub370\uc774\ud130\ub97c \ubc14\ud0d5\uc73c\ub85c Ad-Hoc PromQL \ub610\ub294 CloudWatch Insights \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud574\ub2f9 \uae30\uac04 \ub3d9\uc548 \uac10\uc0ac \ub85c\uadf8\uc5d0\uc11c LIST \uc694\uccad\uc744 \uac00\uc838\uc640\uc11c \uc5b4\ub5a4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc778\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/kcp_monitoring/#cloudwatch","title":"CloudWatch\ub85c \uc18c\uc2a4 \ucc3e\uae30","text":"<p>\uba54\ud2b8\ub9ad\uc740 \uc0b4\ud3b4\ubcf4\uace0\uc790 \ud558\ub294 \ubb38\uc81c \uc601\uc5ed\uc744 \ucc3e\uace0 \ubb38\uc81c\uc758 \uae30\uac04\uacfc \uac80\uc0c9 \ub9e4\uac1c\ubcc0\uc218\ub97c \ubaa8\ub450 \uc881\ud788\ub294 \ub370 \uac00\uc7a5 \uc798 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc774 \ub370\uc774\ud130\uac00 \ud655\ubcf4\ub418\uba74 \ub354 \uc790\uc138\ud55c \uc2dc\uac04\uacfc \uc624\ub958\uc5d0 \ub300\ud55c \ub85c\uadf8\ub85c \uc804\ud658\ud558\ub824\uace0 \ud569\ub2c8\ub2e4. \uc774\ub97c \uc704\ud574 CloudWatch Logs Insights\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub85c\uadf8\ub97c \uba54\ud2b8\ub9ad\uc73c\ub85c \uc804\ud658\ud569\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4, \uc704\uc758 \ubb38\uc81c\ub97c \uc870\uc0ac\ud558\uae30 \uc704\ud574 \ub2e4\uc74c CloudWatch Logs Insights \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc0ac\uc6a9\uc790 \uc5d0\uc774\uc804\ud2b8 \ubc0f requestURI\ub97c \uac00\uc838\uc640\uc11c \uc5b4\ub5a4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc774 \uc9c0\uc5f0\uc744 \uc77c\uc73c\ud0a4\ub294\uc9c0 \uc815\ud655\ud788 \ud30c\uc545\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud301</p> <p>Watch\uc5d0\uc11c \uc815\uc0c1\uc801\uc778 List/Resync \ub3d9\uc791\uc744 \uac00\uc838\uc624\uc9c0 \uc54a\uc73c\ub824\uba74 \uc801\uc808\ud55c \uac1c\uc218\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>fields *@timestamp*, *@message*\n| filter *@logStream* like \"kube-apiserver-audit\"\n| filter ispresent(requestURI)\n| filter verb = \"list\"\n| parse requestReceivedTimestamp /\\d+-\\d+-(?&lt;StartDay&gt;\\d+)T(?&lt;StartHour&gt;\\d+):(?&lt;StartMinute&gt;\\d+):(?&lt;StartSec&gt;\\d+).(?&lt;StartMsec&gt;\\d+)Z/\n| parse stageTimestamp /\\d+-\\d+-(?&lt;EndDay&gt;\\d+)T(?&lt;EndHour&gt;\\d+):(?&lt;EndMinute&gt;\\d+):(?&lt;EndSec&gt;\\d+).(?&lt;EndMsec&gt;\\d+)Z/\n| fields (StartHour * 3600 + StartMinute * 60 + StartSec + StartMsec / 1000000) as StartTime, (EndHour * 3600 + EndMinute * 60 + EndSec + EndMsec / 1000000) as EndTime, (EndTime - StartTime) as DeltaTime\n| stats avg(DeltaTime) as AverageDeltaTime, count(*) as CountTime by requestURI, userAgent\n| filter CountTime &gt;=50\n| sort AverageDeltaTime desc\n</code></pre> <p>\uc774 \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub300\uae30 \uc2dc\uac04\uc774 \uae34 list \uc791\uc5c5\uc744 \ub300\ub7c9\uc73c\ub85c \uc2e4\ud589\ud558\ub294 \ub450 \uac1c\uc758 \uc11c\ub85c \ub2e4\ub978 \uc5d0\uc774\uc804\ud2b8(Splunk \ubc0f CloudWatch Agent)\ub97c \ubc1c\uacac\ud588\uc2b5\ub2c8\ub2e4. \ub370\uc774\ud130\ub97c \ubc14\ud0d5\uc73c\ub85c \uc774 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc81c\uac70, \uc5c5\ub370\uc774\ud2b8\ud558\uac70\ub098 \ub2e4\ub978 \ud504\ub85c\uc81d\ud2b8\ub85c \uad50\uccb4\ud558\uae30\ub85c \uacb0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>Tip</p> <p>\uc774 \uc8fc\uc81c\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ub2e4\uc74c \ube14\ub85c\uadf8\ub97c \ucc38\uc870\ud558\uc138\uc694.</p>"},{"location":"ko/scalability/docs/kcp_monitoring/#scheduler","title":"Scheduler","text":"<p>EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uc778\uc2a4\ud134\uc2a4\ub294 \ubcc4\ub3c4\uc758 AWS \uacc4\uc815\uc5d0\uc11c \uc2e4\ud589\ub418\ubbc0\ub85c \uce21\uc815 \uc9c0\ud45c\uc5d0 \ub300\ud55c \ud574\ub2f9 \uad6c\uc131 \uc694\uc18c\ub97c \uc218\uc9d1\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4(API Server\ub294 \uc608\uc678\uc784). \uadf8\ub7ec\ub098 \uc774\ub7ec\ud55c \uad6c\uc131 \uc694\uc18c\uc5d0 \ub300\ud55c \uac10\uc0ac \ub85c\uadf8\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \ud574\ub2f9 \ub85c\uadf8\ub97c \uc9c0\ud45c\ub85c \ubcc0\ud658\ud558\uc5ec \ud655\uc7a5 \uc2dc \ubcd1\ubaa9 \ud604\uc0c1\uc744 \uc77c\uc73c\ud0a4\ub294 \ud558\uc704 \uc2dc\uc2a4\ud15c\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CloudWatch Logs Insights\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2a4\ucf00\uc904\ub7ec \ub300\uae30\uc5f4\uc5d0 \uc608\uc57d\ub418\uc9c0 \uc54a\uc740 Pod\uac00 \uba87 \uac1c \uc788\ub294\uc9c0 \ud655\uc778\ud574 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/kcp_monitoring/#_5","title":"\uc2a4\ucf00\uc904\ub7ec \ub85c\uadf8\uc5d0\uc11c \uc608\uc57d\ub418\uc9c0 \uc54a\uc740 \ud30c\ub4dc","text":"<p>\uc790\uccb4 \uad00\ub9ac\ud615 \ucfe0\ubc84\ub124\ud2f0\uc2a4(\uc608: Kops)\uc5d0\uc11c \uc9c1\uc811 \uc2a4\ucf00\uc904\ub7ec \uc9c0\ud45c\ub97c \uc2a4\ud06c\ub7a9\ud560 \uc218 \uc788\ub294 \uc561\uc138\uc2a4 \uad8c\ud55c\uc774 \uc788\ub294 \uacbd\uc6b0 \ub2e4\uc74c PromQL\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc2a4\ucf00\uc904\ub7ec \ubc31\ub85c\uadf8\ub97c \uc774\ud574\ud569\ub2c8\ub2e4.</p> <pre><code>max without(instance)(scheduler_pending_pods)\n</code></pre> <p>EKS\uc5d0\uc11c\ub294 \uc704 \uc9c0\ud45c\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\uc73c\ubbc0\ub85c \uc544\ub798 CloudWatch Logs Insights \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud2b9\uc815 \uae30\uac04 \ub3d9\uc548 \uc608\uc57d\uc744 \ucde8\uc18c\ud560 \uc218 \uc5c6\uc5c8\ub358 \ud30c\ub4dc \uc218\ub97c \ud655\uc778\ud558\uc5ec \ubc31\ub85c\uadf8\ub97c \ud655\uc778\ud560 \uac83\uc785\ub2c8\ub2e4. \uadf8\ub7ec\uba74 \ud53c\ud06c \ud0c0\uc784\uc758 \uba54\uc2dc\uc9c0\ub97c \ub354 \uc790\uc138\ud788 \ubd84\uc11d\ud558\uc5ec \ubcd1\ubaa9 \ud604\uc0c1\uc758 \ud2b9\uc131\uc744 \uc774\ud574\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc\uac00 \ucda9\ubd84\ud788 \ube60\ub974\uac8c \uad50\uccb4\ub418\uc9c0 \uc54a\uac70\ub098 \uc2a4\ucf00\uc904\ub7ec \uc790\uccb4\uc758 rate limiter\ub97c \uc608\ub85c \ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <pre><code>fields timestamp, pod, err, *@message*\n| filter *@logStream* like \"scheduler\"\n| filter *@message* like \"Unable to schedule pod\"\n| parse *@message*  /^.(?&lt;date&gt;\\d{4})\\s+(?&lt;timestamp&gt;\\d+:\\d+:\\d+\\.\\d+)\\s+\\S*\\s+\\S+\\]\\s\\\"(.*?)\\\"\\s+pod=(?&lt;pod&gt;\\\"(.*?)\\\")\\s+err=(?&lt;err&gt;\\\"(.*?)\\\")/\n| count(*) as count by pod, err\n| sort count desc\n</code></pre> <p>\uc5ec\uae30\uc11c\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 PVC\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc5b4 \ud30c\ub4dc\uac00 \ubc30\ud3ec\ub418\uc9c0 \uc54a\uc558\ub2e4\ub294 \uc2a4\ucf00\uc904\ub7ec\uc758 \uc624\ub958\ub97c \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\ucc38\uace0</p> <p>\uc774 \uae30\ub2a5\uc744 \ud65c\uc131\ud654\ud558\ub824\uba74 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0\uc11c \uac10\uc0ac \ub85c\uae45\uc744 \ucf1c\uc57c \ud569\ub2c8\ub2e4. \uc2dc\uac04\uc774 \uc9c0\ub0a8\uc5d0 \ub530\ub77c \ubd88\ud544\uc694\ud558\uac8c \ube44\uc6a9\uc774 \uc99d\uac00\ud558\uc9c0 \uc54a\ub3c4\ub85d \ub85c\uadf8 \ubcf4\uc874\uc744 \uc81c\ud55c\ud558\ub294 \uac83\ub3c4 \uac00\uc7a5 \uc88b\uc740 \ubc29\ubc95\uc785\ub2c8\ub2e4. \ub2e4\uc74c\uc740 EKSCTL \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubaa8\ub4e0 \ub85c\uae45 \uae30\ub2a5\uc744 \ucf1c\ub294 \uc608\uc81c\uc785\ub2c8\ub2e4.  </p> <pre><code>cloudWatch:\n  clusterLogging:\n    enableTypes: [\"*\"]\n    logRetentionInDays: 10\n</code></pre>"},{"location":"ko/scalability/docs/kcp_monitoring/#kube-controller-manager","title":"Kube Controller Manager","text":"<p>\ub2e4\ub978 \ubaa8\ub4e0 \ucee8\ud2b8\ub864\ub7ec\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c Kube Controller Manager\ub294 \ud55c \ubc88\uc5d0 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc791\uc5c5 \uc218\uc5d0 \uc81c\ud55c\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ud30c\ub77c\ubbf8\ud130\ub97c \uc124\uc815\ud560 \uc218 \uc788\ub294 KOPS \uad6c\uc131\uc744 \uc0b4\ud3b4\ubcf4\uba74\uc11c \uc774\ub7ec\ud55c \ud50c\ub798\uadf8 \uc911 \uc77c\ubd80\uac00 \ubb34\uc5c7\uc778\uc9c0 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p> <pre><code>  kubeControllerManager:\n    concurrentEndpointSyncs: 5\n    concurrentReplicasetSyncs: 5\n    concurrentNamespaceSyncs: 10\n    concurrentServiceaccountTokenSyncs: 5\n    concurrentServiceSyncs: 5\n    concurrentResourceQuotaSyncs: 5\n    concurrentGcSyncs: 20\n    kubeAPIBurst: 20\n    kubeAPIQPS: \"30\"\n</code></pre> <p>\uc774\ub7ec\ud55c \ucee8\ud2b8\ub864\ub7ec\uc5d0\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ubcc0\ub3d9\uc774 \uc2ec\ud560 \ub54c \ub300\uae30\uc5f4\uc774 \uaf49 \ucc28\uac8c \ub429\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 replicaset controller\uc758 \ub300\uae30\uc5f4\uc5d0 \ub300\uaddc\ubaa8 \ubc31\ub85c\uadf8\uac00 \uc788\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\uc774\ub7ec\ud55c \uc0c1\ud669\uc744 \ud574\uacb0\ud558\ub294 \ubc29\ubc95\uc5d0\ub294 \ub450 \uac00\uc9c0\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uccb4 \uad00\ub9ac\ub97c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 \ub3d9\uc2dc \uace0\ub8e8\ud2f4\uc744 \ub298\ub9b4 \uc218 \uc788\uc9c0\ub9cc \uc774\ub294 KCM\uc5d0\uc11c \ub354 \ub9ce\uc740 \ub370\uc774\ud130\ub97c \ucc98\ub9ac\ud558\uc5ec etcd\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\ub978 \uc635\uc158\uc740 \ubc30\ud3ec\uc5d0\uc11c <code>.spec.revisionHistoryLimit</code>\uc744 \uc0ac\uc6a9\ud558\uc5ec replicaset \uac1c\uccb4 \uc218\ub97c \uc904\uc774\uace0 \ub864\ubc31\ud560 \uc218 \uc788\ub294 replicaset \uac1c\uccb4 \uc218\ub97c \uc904\uc5ec \ud574\ub2f9 \ucee8\ud2b8\ub864\ub7ec\uc5d0 \ub300\ud55c \ubd80\ub2f4\uc744 \uc904\uc774\ub294 \uac83\uc785\ub2c8\ub2e4.</p> <pre><code>spec:\n  revisionHistoryLimit: 2\n</code></pre> <p>\ub2e4\ub978 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ub2a5\uc744 \uc870\uc815\ud558\uac70\ub098 \ud574\uc81c\ud558\uc5ec \uc774\ud0c8\ub960\uc774 \ub192\uc740 \uc2dc\uc2a4\ud15c\uc758 \uc555\ub825\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \ud30c\ub4dc\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 k8s API\uc640 \uc9c1\uc811 \ud1b5\uc2e0\ud560 \ud544\uc694\uac00 \uc5c6\ub294 \uacbd\uc6b0 \ud574\ub2f9 \ud30c\ub4dc\uc5d0 \uc801\uc6a9\ub41c \uc2dc\ud06c\ub9bf\uc744 \ub044\uba74 ServiceAccountTokenSync\uc758 \ubd80\ud558\ub97c \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uac00\ub2a5\ud558\uba74 \uc774\ub7f0 \ubb38\uc81c\ub97c \ud574\uacb0\ud560 \uc218 \uc788\ub294 \ub354 \ubc14\ub78c\uc9c1\ud55c \ubc29\ubc95\uc785\ub2c8\ub2e4.</p> <pre><code>kind: Pod\nspec:\n  automountServiceAccountToken: false\n</code></pre> <p>\uc9c0\ud45c\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\ub294 \uc2dc\uc2a4\ud15c\uc5d0\uc11c\ub294 \ub85c\uadf8\ub97c \ub2e4\uc2dc \uac80\ud1a0\ud558\uc5ec \uacbd\ud569\uc744 \uac10\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud2b8\ub864\ub7ec\ub2f9 \ub610\ub294 \uc9d1\uacc4 \uc218\uc900\uc5d0\uc11c \ucc98\ub9ac\ub418\ub294 \uc694\uccad\uc758 \uc218\ub97c \ud655\uc778\ud558\ub824\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 CloudWatch Logs Insights \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uba74 \ub429\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/kcp_monitoring/#total-volume-processed-by-the-kcm","title":"Total Volume Processed by the KCM","text":"<pre><code># Query to count API qps coming from kube-controller-manager, split by controller type.\n# If you're seeing values close to 20/sec for any particular controller, it's most likely seeing client-side API throttling.\nfields @timestamp, @logStream, @message\n| filter @logStream like /kube-apiserver-audit/\n| filter userAgent like /kube-controller-manager/\n# Exclude lease-related calls (not counted under kcm qps)\n| filter requestURI not like \"apis/coordination.k8s.io/v1/namespaces/kube-system/leases/kube-controller-manager\"\n# Exclude API discovery calls (not counted under kcm qps)\n| filter requestURI not like \"?timeout=32s\"\n# Exclude watch calls (not counted under kcm qps)\n| filter verb != \"watch\"\n# If you want to get counts of API calls coming from a specific controller, uncomment the appropriate line below:\n# | filter user.username like \"system:serviceaccount:kube-system:job-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:cronjob-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:deployment-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:replicaset-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:horizontal-pod-autoscaler\"\n# | filter user.username like \"system:serviceaccount:kube-system:persistent-volume-binder\"\n# | filter user.username like \"system:serviceaccount:kube-system:endpointslice-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:endpoint-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:generic-garbage-controller\"\n| stats count(*) as count by user.username\n| sort count desc\n</code></pre> <p>\uc5ec\uae30\uc11c \uc911\uc694\ud55c \uc810\uc740 \ud655\uc7a5\uc131 \ubb38\uc81c\ub97c \uc870\uc0ac\ud560 \ub54c \uc790\uc138\ud55c \ubb38\uc81c \ud574\uacb0 \ub2e8\uacc4\ub85c \uc774\ub3d9\ud558\uae30 \uc804\uc5d0 \uacbd\ub85c\uc758 \ubaa8\ub4e0 \ub2e8\uacc4(API, \uc2a4\ucf00\uc904\ub7ec, KCM \ub4f1)\ub97c \uc0b4\ud3b4\ubcf4\ub294 \uac83\uc785\ub2c8\ub2e4. \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 \uc2dc\uc2a4\ud15c\uc774 \ucd5c\uace0\uc758 \uc131\ub2a5\uc73c\ub85c \uc791\ub3d9\ud560 \uc218 \uc788\ub3c4\ub85d \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \ub450 \ubd80\ubd84 \uc774\uc0c1\uc744 \uc870\uc815\ud574\uc57c \ud558\ub294 \uacbd\uc6b0\uac00 \uc885\uc885 \uc788\uc2b5\ub2c8\ub2e4. \ud6e8\uc52c \ub354 \ud070 \ubcd1\ubaa9 \ud604\uc0c1\uc758 \ub2e8\uc21c\ud55c \uc99d\uc0c1(\uc608: \ub178\ub4dc \uc2dc\uac04 \ucd08\uacfc)\uc744 \uc2e4\uc218\ub85c \ud574\uacb0\ud558\ub294 \uac83\uc740 \uc27d\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/kcp_monitoring/#etcd","title":"ETCD","text":"<p>etcd\ub294 \uba54\ubaa8\ub9ac \ub9e4\ud551 \ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud0a4 \uac12 \uc30d\uc744 \ud6a8\uc728\uc801\uc73c\ub85c \uc800\uc7a5\ud569\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c 2, 4, 8GB \uc81c\ud55c\uc73c\ub85c \uc124\uc815\ub41c \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uba54\ubaa8\ub9ac \uacf5\uac04\uc758 \ud06c\uae30\ub97c \uc124\uc815\ud558\ub294 \ubcf4\ud638 \uba54\ucee4\ub2c8\uc998\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc758 \uac1c\uccb4 \uc218\uac00 \uc801\ub2e4\ub294 \uac83\uc740 \uac1c\uccb4\uac00 \uc5c5\ub370\uc774\ud2b8\ub418\uace0 \uc774\uc804 \ubc84\uc804\uc744 \uc815\ub9ac\ud574\uc57c \ud560 \ub54c etcd\uc5d0\uc11c \uc218\ud589\ud574\uc57c \ud558\ub294 \uc815\ub9ac \uc791\uc5c5\uc774 \uc904\uc5b4\ub4e0\ub2e4\ub294 \uac83\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uac1d\uccb4\uc758 \uc774\uc804 \ubc84\uc804\uc744 \uc815\ub9ac\ud558\ub294 \uc774\ub7ec\ud55c \ud504\ub85c\uc138\uc2a4\ub97c \uc555\ucd95\uc774\ub77c\uace0 \ud569\ub2c8\ub2e4. \uc5ec\ub7ec \ubc88\uc758 \uc555\ucd95 \uc791\uc5c5 \ud6c4\uc5d0\ub294 \ud2b9\uc815 \uc784\uacc4\uac12 \uc774\uc0c1 \ub610\ub294 \uace0\uc815\ub41c \uc2dc\uac04 \uc77c\uc815\uc5d0 \ub530\ub77c \ubc1c\uc0dd\ud558\ub294 \uc870\uac01 \ubaa8\uc74c(defragging)\uc774\ub77c\ub294 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uacf5\uac04\uc744 \ubcf5\uad6c\ud558\ub294 \ud6c4\uc18d \ud504\ub85c\uc138\uc2a4\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uac1c\uccb4 \uc218\ub97c \uc81c\ud55c\ud558\uc5ec \uc555\ucd95 \ubc0f \uc870\uac01 \ubaa8\uc74c \ud504\ub85c\uc138\uc2a4\uc758 \uc601\ud5a5\uc744 \uc904\uc774\uae30 \uc704\ud574 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \uc0ac\uc6a9\uc790 \uad00\ub828 \ud56d\ubaa9\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 Helm\uc740 \ub192\uc740 <code>revisionHistoryLimit</code>\uc744 \uc720\uc9c0\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 ReplicaSet\uc640 \uac19\uc740 \uc774\uc804 \uac1c\uccb4\uac00 \uc2dc\uc2a4\ud15c\uc5d0 \uc720\uc9c0\ub418\uc5b4 \ub864\ubc31\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ub85d \uc81c\ud55c\uc744 2\ub85c \uc124\uc815\ud558\uba74 \uac1c\uccb4(\uc608: ReplicaSets) \uc218\ub97c 10\uc5d0\uc11c 2\ub85c \uc904\uc77c \uc218 \uc788\uc73c\uba70 \uacb0\uacfc\uc801\uc73c\ub85c \uc2dc\uc2a4\ud15c\uc5d0 \ub300\ud55c \ub85c\ub4dc\uac00 \uc904\uc5b4\ub4ed\ub2c8\ub2e4.</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nspec:\n  revisionHistoryLimit: 2\n</code></pre> <p>\ubaa8\ub2c8\ud130\ub9c1 \uad00\uc810\uc5d0\uc11c \uc2dc\uc2a4\ud15c \uc9c0\uc5f0 \uc2dc\uac04 \uae09\uc99d\uc774 \uc2dc\uac04 \ub2e8\uc704\ub85c \uad6c\ubd84\ub41c \uc124\uc815\ub41c \ud328\ud134\uc73c\ub85c \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0 \uc774 \uc870\uac01 \ubaa8\uc74c \ud504\ub85c\uc138\uc2a4\uac00 \uc6d0\uc778\uc778\uc9c0 \ud655\uc778\ud558\ub294 \uac83\uc774 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CloudWatch Logs\ub97c \uc0ac\uc6a9\ud558\uba74 \uc774\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc870\uac01 \ubaa8\uc74c\uc758 \uc2dc\uc791/\uc885\ub8cc \uc2dc\uac04\uc744 \ubcf4\ub824\uba74 \ub2e4\uc74c \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.</p> <pre><code>fields *@timestamp*, *@message*\n| filter *@logStream* like /etcd-manager/\n| filter *@message* like /defraging|defraged/\n| sort *@timestamp* asc\n</code></pre> <p></p>"},{"location":"ko/scalability/docs/node_efficiency/","title":"\ub178\ub4dc \ubc0f \uc6cc\ud06c\ub85c\ub4dc \ud6a8\uc728\uc131","text":"<p>\uc6cc\ud06c\ub85c\ub4dc\uc640 \ub178\ub4dc\ub97c \ud6a8\uc728\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\uba74 \ubcf5\uc7a1\uc131\uacfc \ube44\uc6a9\uc744 \uc904\uc774\ub294 \ub3d9\uc2dc\uc5d0 \uc131\ub2a5\uacfc \uaddc\ubaa8\ub97c \ub192\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \ud6a8\uc728\uc131\uc744 \uacc4\ud68d\ud560 \ub54c\ub294 \uc5ec\ub7ec \uac00\uc9c0 \uc694\uc18c\ub97c \uace0\ub824\ud574\uc57c \ud558\uba70, \uac01 \uae30\ub2a5\uc5d0 \ub300\ud55c \ud558\ub098\uc758 \ubaa8\ubc94 \uc0ac\ub840 \uc124\uc815\uacfc \uc808\ucda9\uc810\uc744 \uae30\uc900\uc73c\ub85c \uc0dd\uac01\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc27d\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \uc139\uc158\uc5d0\uc11c \uc774\ub7f0 \uc7a5\ub2e8\uc810\uc744 \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.       </p>"},{"location":"ko/scalability/docs/node_efficiency/#_2","title":"\ub178\ub4dc \uc120\ud0dd","text":"<p>\uc57d\uac04 \ud070 \ub178\ub4dc \ud06c\uae30(4-12xlarge) \ub97c \uc0ac\uc6a9\ud558\uba74 \uc2dc\uc2a4\ud15c \uad6c\uc131 \uc694\uc18c\uc758 \ub370\ubaac\uc14b(DaemonSets) \ubc0f Reserves\uc640 \uac19\uc740 \"\uc624\ubc84\ud5e4\ub4dc\"\uc5d0 \uc0ac\uc6a9\ub418\ub294 \ub178\ub4dc\uc758 \ube44\uc728\uc774 \uc904\uc5b4\ub4e4\uae30 \ub54c\ubb38\uc5d0 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uacf5\uac04\uc774 \ub298\uc5b4\ub0a9\ub2c8\ub2e4. \uc544\ub798 \ub2e4\uc774\uc5b4\uadf8\ub7a8\uc5d0\uc11c 2xlarge \uc2dc\uc2a4\ud15c\uc758 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uacf5\uac04\uacfc \uc801\ub2f9\ud55c \uc218\uc758 \ub370\ubaac\uc14b\uc744 \ud3ec\ud568\ud558\ub294 8xlarge \uc2dc\uc2a4\ud15c\uc758 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uacf5\uac04 \ucc28\uc774\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>Note</p> <p>K8s\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \uc218\ud3c9\uc73c\ub85c \ud655\uc7a5\ub418\ubbc0\ub85c \ub300\ubd80\ubd84\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c NUMA \ud06c\uae30 \ub178\ub4dc\uc758 \uc131\ub2a5 \uc601\ud5a5\uc744 \uace0\ub824\ud558\ub294 \uac83\uc774 \ud569\ub9ac\uc801\uc774\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ud574\ub2f9 \ub178\ub4dc \ud06c\uae30\ubcf4\ub2e4 \ub0ae\uc740 \ubc94\uc704\ub97c \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p> <p></p> <p>\ub178\ub4dc \ud06c\uae30\uac00 \ud06c\uba74 \ub178\ub4dc\ub2f9 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uacf5\uac04 \ube44\uc728\uc744 \ub192\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc774 \ubaa8\ub378\uc740 \ub178\ub4dc\ub97c \ub108\ubb34 \ub9ce\uc774 \ud30c\ub4dc\ub85c \uac00\ub4dd \ucc44\uc6cc \uc624\ub958\ub97c \uc77c\uc73c\ud0a4\uac70\ub098 \ub178\ub4dc\ub97c \ud3ec\ud654 \uc0c1\ud0dc\ub85c \ub9cc\ub4e4\uba74 \uadf9\ub2e8\uc801\uc778 \uc0c1\ud669\uae4c\uc9c0 \uac08 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub354 \ud070 \ub178\ub4dc \ud06c\uae30\ub97c \uc131\uacf5\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub824\uba74 \ub178\ub4dc \ud3ec\ud654 \uc0c1\ud0dc\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. </p> <p>\ub178\ub4dc \uc120\ud0dd\uc740 \ubaa8\ub4e0 \uacbd\uc6b0\uc5d0 \uc801\uc6a9\ub418\ub294 \uac83\uc740 \uc544\ub2d9\ub2c8\ub2e4. \uc774\ud0c8\ub960\uc774 \uadf9\uc801\uc73c\ub85c \ub2e4\ub978 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc11c\ub85c \ub2e4\ub978 \ub178\ub4dc \uadf8\ub8f9\uc73c\ub85c \ubd84\ud560\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc740 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \uc774\ud0c8\ub960\uc774 \ub192\uc740 \uc18c\uaddc\ubaa8 \ubc30\uce58 \uc6cc\ud06c\ub85c\ub4dc\uc5d0\ub294 4xlarge \uc778\uc2a4\ud134\uc2a4 \ud328\ubc00\ub9ac\uac00 \uac00\uc7a5 \uc801\ud569\ud558\uace0, 8vCPU\ub97c \uc0ac\uc6a9\ud558\uace0 \uc774\ud0c8\ub960\uc774 \ub0ae\uc740 Kafka\uc640 \uac19\uc740 \ub300\uaddc\ubaa8 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 12xlarge \uc81c\ud488\uad70\uc774 \ub354 \uc801\ud569\ud569\ub2c8\ub2e4.</p> <p></p> <p>Tip</p> <p>\ub178\ub4dc \ud06c\uae30\uac00 \ub9e4\uc6b0 \ud074 \uacbd\uc6b0 \uace0\ub824\ud574\uc57c \ud560 \ub610 \ub2e4\ub978 \uc694\uc18c\ub294 CGROUPS\uac00 \ucee8\ud14c\uc774\ub108\ud654\ub41c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c vCPU\uc758 \ucd1d \uc218\ub97c \uc228\uae30\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \ub3d9\uc801 \ub7f0\ud0c0\uc784\uc73c\ub85c \uc778\ud574 \uc758\ub3c4\ud558\uc9c0 \uc54a\uc740 \uc218\uc758 OS \uc2a4\ub808\ub4dc\uac00 \uc0dd\uc131\ub418\uc5b4 \uc9c0\uc5f0 \uc2dc\uac04\uc774 \ubc1c\uc0dd\ud558\uc5ec \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc5b4\ub824\uc6b4 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uacbd\uc6b0 CPU \ud53c\ub2dd(pinning)\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc8fc\uc81c\uc5d0 \ub300\ud574 \ub354 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\ub824\uba74 \ub2e4\uc74c \ube44\ub514\uc624\ub97c \ucc38\uace0\ud558\uc138\uc694. https://www.youtube.com/watch?v=NqtfDy_KAqg</p>"},{"location":"ko/scalability/docs/node_efficiency/#bin-packing","title":"\ub178\ub4dc \ube48\ud328\ud0b9(Bin-packing)","text":""},{"location":"ko/scalability/docs/node_efficiency/#vs","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 vs. \ub9ac\ub205\uc2a4 \uaddc\uce59","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc6cc\ud06c\ub85c\ub4dc\ub97c \ub2e4\ub8f0 \ub54c \uc5fc\ub450\uc5d0 \ub450\uc5b4\uc57c \ud560 \ub450 \uac00\uc9c0 \uaddc\uce59 \uc138\ud2b8\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc694\uccad \uac12\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\uc5d0\uc11c \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uc758 \uaddc\uce59\uacfc \ud30c\ub4dc\uac00 \uc2a4\ucf00\uc904\ub9c1\ub41c \ud6c4 \uc77c\uc5b4\ub098\ub294 \uc77c\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc544\ub2cc \ub9ac\ub205\uc2a4\uc758 \uc601\uc5ed\uc785\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uac00 \uc644\ub8cc\ub41c \ud6c4\uc5d0\ub294 \uc0c8\ub85c\uc6b4 \uaddc\uce59 \uc9d1\ud569\uc774 \uc778\uacc4\ub418\ub294\ub370, \uc774\ub294 \ub9ac\ub205\uc2a4 Completely Fair Scheduler (CFS)\uc785\ub2c8\ub2e4. \uc8fc\uc694 \ud3ec\uc778\ud2b8\ub294 \ub9ac\ub205\uc2a4 CFS\uac00 \ucf54\uc5b4\ub77c\ub294 \uac1c\ub150\uc744 \uac00\uc9c0\uace0 \uc788\uc9c0 \uc54a\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. \uc6b0\ub9ac\ub294 \ucf54\uc5b4\ub85c \uc0dd\uac01\ud558\ub294 \uac83\uc774 \uc2a4\ucf00\uc77c\uc5d0 \ucd5c\uc801\ud654\ub41c \uc791\uc5c5 \ubd80\ud558\ub97c \uc8fc\uc694 \ubb38\uc81c\ub85c \uc774\uc5b4\uc9c8 \uc218 \uc788\ub294 \uc774\uc720\uc5d0 \ub300\ud574 \ub17c\uc758\ud560 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/node_efficiency/#_3","title":"\ucf54\uc5b4\ub85c \uc0dd\uac01\ud558\uae30","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uac00 \ucf54\uc5b4\ub77c\ub294 \uac1c\ub150\uc744 \uac00\uc9c0\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \ud63c\ub780\uc774 \uc2dc\uc791\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec \uad00\uc810\uc5d0\uc11c \ucf54\uc5b4 \uc694\uccad\uc774 1\ub85c \uc124\uc815\ub41c 4\uac1c\uc758 NGINX \ud30c\ub4dc\uac00 \uc788\ub294 \ub178\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\uba74, \ub178\ub4dc\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \ubcf4\uc77c \uac83\uc785\ub2c8\ub2e4.</p> <p></p> <p>\uadf8\ub7ec\ub098, \ub9ac\ub205\uc2a4 CFS \uad00\uc810\uc5d0\uc11c \uc774\uac83\uc774 \uc5bc\ub9c8\ub098 \ub2e4\ub974\uac8c \ubcf4\uc774\ub294\uc9c0\uc5d0 \ub300\ud55c \uc0dd\uac01 \uc2e4\ud5d8\uc744 \ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \ub9ac\ub205\uc2a4 CFS \uc2dc\uc2a4\ud15c\uc744 \uc0ac\uc6a9\ud560 \ub54c \uae30\uc5b5\ud574\uc57c \ud560 \uac00\uc7a5 \uc911\uc694\ud55c \uac83\uc740 \ubc14\uc05c \ucee8\ud14c\uc774\ub108\ub4e4(CGROUPS)\ub9cc\uc774 \uacf5\uc720 \uc2dc\uc2a4\ud15c\uc5d0 \ud3ec\ud568\ub418\ub294 \uc720\uc77c\ud55c \ucee8\ud14c\uc774\ub108\ub4e4\uc774\ub77c\ub294 \uac83\uc785\ub2c8\ub2e4. \uc774 \uacbd\uc6b0, \uccab \ubc88\uc9f8 \ucee8\ud14c\uc774\ub108\ub9cc\uc774 \ubc14\uc058\ubbc0\ub85c \ub178\ub4dc\uc758 \ubaa8\ub4e0 4\uac1c\uc758 \ucf54\uc5b4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>\uc774\uac83\uc774 \uc65c \uc911\uc694\ud55c\uac00\uc694? \uac1c\ubc1c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc131\ub2a5 \ud14c\uc2a4\ud305\uc744 \uc2e4\ud589\ud558\uc600\uace0, NGINX \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ud574\ub2f9 \ub178\ub4dc\uc5d0\uc11c \uc720\uc77c\ud558\uac8c \ubc14\uc05c \ucee8\ud14c\uc774\ub108\uc600\ub2e4\uace0 \uac00\uc815\ud574\ubd05\uc2dc\ub2e4. \uc6b0\ub9ac\uac00 \uc571\uc744 \ud504\ub85c\ub355\uc158\uc73c\ub85c \uc62e\uae30\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \uc77c\uc774 \ubc1c\uc0dd\ud560 \uac83\uc785\ub2c8\ub2e4. NGINX \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 4 vCPU\uc758 \uc790\uc6d0\uc744 \uc6d0\ud558\uc9c0\ub9cc, \ub178\ub4dc\uc758 \ub2e4\ub978 \ubaa8\ub4e0 \ud30c\ub4dc\uac00 \ubc14\uc05c \uc0c1\ud0dc\uc774\uae30 \ub54c\ubb38\uc5d0 \uc571\uc758 \uc131\ub2a5\uc774 \uc81c\ud55c\ub429\ub2c8\ub2e4.</p> <p></p> <p>\uc774\ub7f0 \uc0c1\ud669\uc740 \uc6b0\ub9ac \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \"\uc2a4\uc704\ud2b8 \uc2a4\ud31f(sweet spot)\"\uae4c\uc9c0 \uc2a4\ucf00\uc77c\uc744 \ud5c8\uc6a9\ud558\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 \ubd88\ud544\uc694\ud558\uac8c \ub354 \ub9ce\uc740 \ucee8\ud14c\uc774\ub108\ub97c \ucd94\uac00\ud558\uac8c \ub420 \uac83\uc785\ub2c8\ub2e4. \uc774 \"\uc2a4\uc704\ud2b8 \uc2a4\ud31f\"\uc774\ub77c\ub294 \uc911\uc694\ud55c \uac1c\ub150\uc744 \uc880 \ub354 \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/node_efficiency/#_4","title":"\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc801\uc815 \ud06c\uae30","text":"<p>\uac01 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc5d0\ub294 \ub354 \uc774\uc0c1 \ud2b8\ub798\ud53d\uc744 \ucc98\ub9ac\ud560 \uc218 \uc5c6\ub294 \ud2b9\uc815 \uc9c0\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc9c0\uc810\uc744 \ucd08\uacfc\ud558\uba74 \ucc98\ub9ac \uc2dc\uac04\uc774 \ub298\uc5b4\ub098\uace0 \uc774 \uc2dc\uc810\uc744 \ud6e8\uc52c \ub118\uc73c\uba74 \ud2b8\ub798\ud53d\uc774 \uac10\uc18c\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ud3ec\ud654 \uc9c0\uc810\uc774\ub77c\uace0 \ud569\ub2c8\ub2e4. \ud06c\uae30 \uc870\uc815 \ubb38\uc81c\ub97c \ubc29\uc9c0\ud558\ub824\uba74 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc774 \ud3ec\ud654 \uc9c0\uc810\uc5d0 \ub3c4\ub2ec\ud558\uae30 \uc774\uc804\uc5d0 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \ud06c\uae30\ub97c \uc870\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774 \uc9c0\uc810\uc744 \uc2a4\uc704\ud2b8 \uc2a4\ud31f\uc774\ub77c\uace0 \ubd80\ub974\uaca0\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\uc2a4\uc704\ud2b8 \uc2a4\ud31f\uc744 \uc774\ud574\ud558\ub824\uba74 \uac01 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud14c\uc2a4\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4.\uc560\ud50c\ub9ac\ucf00\uc774\uc158\ub9c8\ub2e4 \ub2e4\ub974\uae30 \ub54c\ubb38\uc5d0 \uc5ec\uae30\uc11c\ub294 \ubcf4\ud3b8\uc801\uc778 \uc9c0\uce68\uc744 \uc81c\uacf5\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uc774 \ud14c\uc2a4\ud2b8\uc5d0\uc11c\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud3ec\ud654\uc810\uc744 \ubcf4\uc5ec\uc8fc\ub294 \ucd5c\uc0c1\uc758 \uc9c0\ud45c\ub97c \ud30c\uc545\ud558\uae30 \uc704\ud574 \ub178\ub825\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9\ub960 \uc9c0\ud45c\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ud3ec\ud654 \uc0c1\ud0dc\uc784\uc744 \ub098\ud0c0\ub0b4\ub294 \ub370 \uc0ac\uc6a9\ub418\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc9c0\ub9cc, \uc774\ub85c \uc778\ud574 \uaddc\ubaa8 \uc870\uc815 \ubb38\uc81c\uac00 \ube60\ub974\uac8c \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(\uc774 \uc8fc\uc81c\uc5d0 \ub300\ud574\uc11c\ub294 \uc774\ud6c4 \uc139\uc158\uc5d0\uc11c \uc790\uc138\ud788 \uc124\uba85\ud558\uaca0\uc2b5\ub2c8\ub2e4). \uc774 \"\uc2a4\uc704\ud2b8 \uc2a4\ud31f\"\uc744 \ud655\ubcf4\ud558\uba74 \uc774\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6cc\ud06c\ub85c\ub4dc\ub97c \ud6a8\uc728\uc801\uc73c\ub85c \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ubc18\ub300\ub85c, \uc2a4\uc704\ud2b8 \uc2a4\ud31f\ubcf4\ub2e4 \ud6e8\uc52c \uba3c\uc800 \uaddc\ubaa8\ub97c \ud655\uc7a5\ud558\uc5ec \ubd88\ud544\uc694\ud55c \ud30c\ub4dc\ub97c \ub9cc\ub4e4\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c\uc694?\ub2e4\uc74c \uc139\uc158\uc5d0\uc11c \uc0b4\ud3b4\ubcf4\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/node_efficiency/#pod","title":"Pod \ud655\uc0b0","text":"<p>\ubd88\ud544\uc694\ud55c \ud30c\ub4dc\ub97c \ub9cc\ub4e4\uba74 \uc5b4\ub5bb\uac8c \ube60\ub974\uac8c \uc81c\uc5b4\uac00 \ud798\ub4e4\uc5b4\uc9c8 \uc218 \uc788\ub294\uc9c0 \ubcf4\uae30 \uc704\ud574, \uc67c\ucabd\uc758 \uccab \ubc88\uc9f8 \uc608\uc81c\ub97c \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \uc774 \ucee8\ud14c\uc774\ub108\uc758 \uc62c\ubc14\ub978 \uc218\uc9c1 \uc2a4\ucf00\uc77c\uc740 \ucd08\ub2f9 100\uac1c\uc758 \uc694\uccad\uc744 \ucc98\ub9ac\ud560 \ub54c \uc57d 2\uac1c\uc758 vCPU \uc0ac\uc6a9\ub7c9\uc744 \ucc28\uc9c0\ud569\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc694\uccad\uc744 \ud558\ud504 \ucf54\uc5b4\ub85c \uc124\uc815\ud558\uc5ec \uc694\uccad \uac12\uc744 \uacfc\uc18c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub824\uba74 \uc774\uc81c \uc2e4\uc81c\ub85c \ud544\uc694\ud55c \ud30c\ub4dc \ud558\ub098\ub2f9 \ud30c\ub4dc 4\uac1c\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \ubb38\uc81c\ub97c \ub354\uc6b1 \uc545\ud654\uc2dc\ud0a4\ub294 \uac83\uc740 HPA\ub97c \uae30\ubcf8\uac12\uc778 50% CPU\ub85c \uc124\uc815\ud558\uba74 \ud574\ub2f9 \ud30c\ub4dc\uac00 \uc808\ubc18\ub9cc \ube44\uc5b4 \uc788\ub294 \uc0c1\ud0dc\ub85c \ud655\uc7a5\ub418\uc5b4 8:1 \ube44\uc728\uc774 \ub41c\ub2e4\ub294 \uc810\uc785\ub2c8\ub2e4. </p> <p></p> <p>\uc774 \ubb38\uc81c\ub97c \ud655\ub300\ud574\ubcf4\uba74 \uc774 \ubb38\uc81c\uac00 \uc5b4\ub5bb\uac8c \ud574\uacb0\ub420 \uc218 \uc788\ub294\uc9c0 \uae08\ubc29 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2a4\uc704\ud2b8 \uc2a4\ud31f\uc774 \uc798\ubabb \uc124\uc815\ub41c 10\uac1c\uc758 \ud30c\ub4dc\ub97c \ubc30\ud3ec\ud558\uba74 \ube60\ub974\uac8c 80\uac1c\uc758 \ud30c\ub4dc\ub85c \ub298\uc5b4\ub098\uace0 \uc774\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \ud544\uc694\ud55c \ucd94\uac00 \uc778\ud504\ub77c\uac00 \uc0dd\uae38 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ucd5c\uc801\uc758 \uc704\uce58\uc5d0\uc11c \uc791\ub3d9\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud558\ub294 \uac83\uc774 \ubbf8\uce58\ub294 \uc601\ud5a5\uc744 \uc774\ud574\ud588\uc73c\ub2c8 \uc774\uc81c \ub178\ub4dc \uc218\uc900\uc73c\ub85c \ub3cc\uc544\uac00\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uc640 \ub9ac\ub205\uc2a4 CFS \uac04\uc758 \uc774\ub7f0 \ucc28\uc774\uac00 \uc65c \uadf8\ub807\uac8c \uc911\uc694\ud55c\uc9c0 \ubb3c\uc5b4\ubcf4\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4.</p> <p>HPA\ub85c \uc2a4\ucf00\uc77c\ub9c1\uc744 \ud655\uc7a5\ud558\uace0 \ucd95\uc18c\ud560 \ub54c, \ub354 \ub9ce\uc740 \ud30c\ub4dc\ub97c \ud560\ub2f9\ud560 \ub9ce\uc740 \uacf5\uac04\uc774 \uc788\ub294 \uc2dc\ub098\ub9ac\uc624\uac00 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uac83\uc740 \uc88b\uc9c0 \uc54a\uc740 \uacb0\uc815\uc77c \uac83\uc785\ub2c8\ub2e4. \uc67c\ucabd\uc5d0 \uadf8\ub824\uc9c4 \ub178\ub4dc\ub294 \uc774\ubbf8 100% CPU \uc0ac\uc6a9\ub960\uc5d0 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \ud604\uc2e4\uc801\uc774\uc9c0\ub294 \uc54a\uc9c0\ub9cc \uc774\ub860\uc801\uc73c\ub85c \uac00\ub2a5\ud55c \uc2dc\ub098\ub9ac\uc624\uc5d0\uc11c\ub294 \uc6b0\ub9ac \ub178\ub4dc\uac00 \uc644\uc804\ud788 \uac00\ub4dd \ucc28 \uc788\uc9c0\ub9cc, CPU \uc0ac\uc6a9\ub960\uc740 0%\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p>"},{"location":"ko/scalability/docs/node_efficiency/#requests","title":"Requests \uc124\uc815","text":"<p>request \uac12\uc744 \ud574\ub2f9 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \"\uc2a4\uc704\ud2b8 \uc2a4\ud31f\" \uac12\uc73c\ub85c \uc124\uc815\ud558\uace0 \uc2f6\uc744 \uc218\ub3c4 \uc788\uc9c0\ub9cc, \uc774\ub807\uac8c \ud558\uba74 \uc544\ub798 \ub2e4\uc774\uc5b4\uadf8\ub7a8\uacfc \uac19\uc774 \ube44\ud6a8\uc728\uc131\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 \uc694\uccad \uac12\uc744 2vCPU\ub85c \uc124\uc815\ud588\uc9c0\ub9cc \uc774 \ud30c\ub4dc\ub4e4\uc758 \ud3c9\uade0 \uc0ac\uc6a9\ub960\uc740 \ub300\ubd80\ubd84\uc758 \uc2dc\uac04 \ub3d9\uc548 1 CPU\ub9cc \uc2e4\ud589\ub429\ub2c8\ub2e4. \uc774 \uc124\uc815\uc740 CPU \uc8fc\uae30\uc758 50%\ub97c \ub0ad\ube44\ud558\uac8c \ub418\uc5b4, \uc774\ub294 \ud5c8\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>\uc774\uac83\uc740 \ubb38\uc81c\uc5d0 \ub300\ud55c \ubcf5\uc7a1\ud55c \ub2f5\ubcc0\uc744 \uac00\uc838\uc635\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108 \ud65c\uc6a9\uc740 \uc9c4\uacf5 \uc0c1\ud0dc\uc5d0\uc11c\ub294 \uc0dd\uac01\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ub2e4\ub978 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4. \uc74c \uc608\uc5d0\uc11c\ub294 \uc131\uc9c8\uc0c1 \ubc84\uc2a4\ud2f0\ud55c \ucee8\ud14c\uc774\ub108\ub4e4\uc774 \uba54\ubaa8\ub9ac\uc5d0 \uc81c\uc57d\uc774 \uc788\uc744 \uc218 \uc788\ub294 \ub450 \uac1c\uc758 \ub0ae\uc740 CPU \uc0ac\uc6a9 \ucee8\ud14c\uc774\ub108\uc640 \uc11e\uc5ec \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ub178\ub4dc\uc5d0 \ubd80\ub2f4\uc744 \uc8fc\uc9c0 \uc54a\uace0\ub3c4 \ucee8\ud14c\uc774\ub108\uac00 \uc2a4\uc704\ud2b8 \uc2a4\ud31f\uc5d0 \ub3c4\ub2ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\uc774 \ubaa8\ub4e0 \uac83\uc5d0\uc11c \uc5bb\uc744 \uc218 \uc788\ub294 \uc911\uc694\ud55c \uac1c\ub150\uc740, \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108 \uc131\ub2a5\uc744 \uc774\ud574\ud558\uae30 \uc704\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uc758 \ucf54\uc5b4 \uac1c\ub150\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uadf8\ub4e4 \uc0ac\uc774\uc5d0 \uad00\ub828\uc774 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \uc798\ubabb\ub41c \uacb0\uc815\uc744 \ub0b4\ub9b4 \uc218 \uc788\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4.</p> <p>Tip</p> <p>\ub9ac\ub205\uc2a4 CFS\ub294 \uadf8 \uc790\uccb4\ub85c \uac15\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 I/O \uae30\ubc18 \uc791\uc5c5 \ubd80\ud558\uc5d0 \ub300\ud574 \ud2b9\ud788 \uadf8\ub807\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc0ac\uc774\ub4dc\uce74 \uc5c6\uc774 \uc804\uccb4 \ucf54\uc5b4\ub97c \uc0ac\uc6a9\ud558\uace0 I/O \uc694\uad6c\uc0ac\ud56d\uc774 \uc5c6\ub2e4\uba74, CPU \ud53c\ub2dd\uc740 \uc774 \uacfc\uc815\uc5d0\uc11c \ub9ce\uc740 \ubcf5\uc7a1\uc131\uc744 \uc81c\uac70\ud560 \uc218 \uc788\uc73c\uba70, \uadf8\ub7f0 \uc0ac\ud56d\ub4e4\ub85c \uc778\ud574 \uad8c\uc7a5\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/node_efficiency/#utilization-vs-saturation","title":"\uc774\uc6a9\ub960(Utilization) vs. \ud3ec\ud654\ub3c4(Saturation)","text":"<p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc2a4\ucf00\uc77c\ub9c1\uc5d0\uc11c \ud754\ud788 \ubc1c\uc0dd\ud558\ub294 \uc2e4\uc218\ub294 \uc2a4\ucf00\uc77c\ub9c1 \uc9c0\ud45c\uc5d0 CPU \uc0ac\uc6a9\ub960\ub9cc \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \ubcf5\uc7a1\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \uc774\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc2e4\uc81c\ub85c \uc694\uccad\uc73c\ub85c \uac00\ub4dd \ucc28 \uc788\ub2e4\ub294 \uc798\ubabb\ub41c \uc9c0\ud45c\uc778 \uacbd\uc6b0\uac00 \uac70\uc758 \ub300\ubd80\ubd84\uc785\ub2c8\ub2e4. \uc67c\ucabd \uc608\uc5d0\uc11c\ub294 \ubaa8\ub4e0 \uc694\uccad\uc774 \uc2e4\uc81c\ub85c \uc6f9 \uc11c\ubc84\uc5d0 \ub3c4\ub2ec\ud558\uace0 \uc788\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\uc73c\ubbc0\ub85c CPU \uc0ac\uc6a9\ub960\uc774 \ud3ec\ud654 \uc0c1\ud0dc\uc5d0\uc11c\ub3c4 \uc798 \ucd94\uc801\ub418\uace0 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\uc2e4\uc81c \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc5d0\uc11c\ub294 \uc774\ub7f0 \uc694\uccad \uc911 \uc77c\ubd80\uac00 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uacc4\uce35\uc774\ub098 \uc778\uc99d \uacc4\uce35 \ub4f1\uc5d0\uc11c \ucc98\ub9ac\ub420 \uac00\ub2a5\uc131\uc774 \ub192\uc9c0\ub9cc, \uc774 \ubcf4\ub2e4 \uc77c\ubc18\uc801\uc778 \uacbd\uc6b0\uc5d0\ub294 \ub2e4\ub978 \uc5d4\ud2f0\ud2f0\uc5d0\uc11c \uc694\uccad\uc744 \ucc98\ub9ac\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 CPU\uac00 \ud3ec\ud654 \uc0c1\ud0dc\ub85c \ucd94\uc801\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 CPU\ub294 \ud3ec\ud654\ub3c4\ub97c \uc81c\ub300\ub85c \ub098\ud0c0\ub0b4\uc9c0 \ubabb\ud569\ub2c8\ub2e4.</p> <p></p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ubd88\ud544\uc694\ud558\uace0 \uc608\uce21\ud560 \uc218 \uc5c6\ub294 \uc2a4\ucf00\uc77c\ub9c1\uc774 \ubc1c\uc0dd\ud558\ub294 \uac00\uc7a5 \ud070 \uc774\uc720\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc131\ub2a5\uc5d0\uc11c \uc798\ubabb\ub41c \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.\uc0ac\uc6a9 \uc911\uc778 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc720\ud615\uc5d0 \ub9de\ub294 \uc62c\ubc14\ub978 \ucc44\ub3c4 \uc9c0\ud45c\ub97c \uc120\ud0dd\ud560 \ub54c\ub294 \uac01\ubcc4\ud55c \uc8fc\uc758\ub97c \uae30\uc6b8\uc5ec\uc57c \ud569\ub2c8\ub2e4.\ud55c \uac00\uc9c0 \uc8fc\uc758\ud560 \uc810\uc740 \ubaa8\ub4e0 \uc0ac\ub78c\uc5d0\uac8c \ub9de\ub294 \ud55c \uac00\uc9c0 \uad8c\uc7a5 \uc0ac\ud56d\uc774 \uc5c6\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4.\uc0ac\uc6a9\ub418\ub294 \uc5b8\uc5b4\uc640 \ud574\ub2f9 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc720\ud615\uc5d0 \ub530\ub77c \ucc44\ub3c4\uc5d0 \ub300\ud55c \ub2e4\uc591\ud55c \uc9c0\ud45c\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774 \ubb38\uc81c\ub294 CPU \uc0ac\uc6a9\ub960\uc5d0\ub9cc \uad6d\ud55c\ub41c \uac83\uc73c\ub85c \uc0dd\uac01\ud560 \uc218\ub3c4 \uc788\uc9c0\ub9cc, \ucd08\ub2f9 \uc694\uccad \uc218\uc640 \uac19\uc740 \ub2e4\ub978 \uc77c\ubc18\uc801\uc778 \uc9c0\ud45c\ub3c4 \uc704\uc5d0\uc11c \uc124\uba85\ud55c \uac83\uacfc \ub611\uac19\uc740 \ubb38\uc81c\uc5d0 \ube60\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucc38\uace0\ub85c \uc694\uccad\uc740 \uc6f9 \uc11c\ubc84\uc5d0\uc11c \uc9c1\uc811 \ucc98\ub9ac\ub418\uc9c0 \uc54a\ub294 DB \uacc4\uce35, \uc778\uc99d \uacc4\uce35\uc5d0\ub3c4 \uc804\ub2ec\ub420 \uc218 \uc788\uc73c\ubbc0\ub85c \uc6f9 \uc11c\ubc84 \uc790\uccb4\uc758 \uc2e4\uc81c \ucc44\ub3c4\ub97c \ud3c9\uac00\ud558\ub294 \uc9c0\ud45c\ub85c\ub294 \ubd80\uc871\ud569\ub2c8\ub2e4.</p> <p></p> <p>\uc548\ud0c0\uae5d\uac8c\ub3c4 \uc62c\ubc14\ub978 \ucc44\ub3c4 \uce21\uc815\ubc95\uc744 \uc120\ud0dd\ud558\ub294 \ub370 \uc788\uc5b4 \uc26c\uc6b4 \ud574\ub2f5\uc740 \uc5c6\uc2b5\ub2c8\ub2e4. \uace0\ub824\ud574\uc57c \ud560 \uba87 \uac00\uc9c0 \uc9c0\uce68\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. </p> <ul> <li>\uc5b8\uc5b4 \ub7f0\ud0c0\uc784\uc744 \uc774\ud574\ud558\uc138\uc694. \uc5ec\ub7ec OS \uc2a4\ub808\ub4dc\uac00 \uc788\ub294 \uc5b8\uc5b4\ub294 \ub2e8\uc77c \uc2a4\ub808\ub4dc \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uacfc \ub2e4\ub974\uac8c \ubc18\uc751\ud558\ubbc0\ub85c \ub178\ub4dc\uc5d0 \ubbf8\uce58\ub294 \uc601\ud5a5\uc774 \ub2e4\ub985\ub2c8\ub2e4.</li> <li>\uc62c\ubc14\ub978 \uc218\uc9c1 \uc2a4\ucf00\uc77c\uc744 \uc774\ud574\ud558\uc138\uc694. \uc0c8 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc77c\ub9c1\ud558\uae30 \uc804\uc5d0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc218\uc9c1 \uc2a4\ucf00\uc77c\uc5d0 \uc5bc\ub9c8\ub098 \ub9ce\uc740 \ubc84\ud37c\ub97c \uc801\uc6a9\ud558\uae38 \uc6d0\ud558\uc2dc\ub098\uc694? </li> <li>\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ucc44\ub3c4\ub97c \uc2e4\uc81c\ub85c \ubc18\uc601\ud558\ub294 \uc9c0\ud45c\ub294 \ubb34\uc5c7\uc778\uac00\uc694? - Kafka Producer\uc758 \ud3ec\ud654 \uc9c0\ud45c\ub294 \ubcf5\uc7a1\ud55c \uc6f9 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc\ub294 \uc0c1\ub2f9\ud788 \ub2e4\ub985\ub2c8\ub2e4. </li> <li>\ub178\ub4dc\uc758 \ub2e4\ub978 \ubaa8\ub4e0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \uc11c\ub85c \uc5b4\ub5a4 \uc601\ud5a5\uc744 \ubbf8\uce58\ub098\uc694? - \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc131\ub2a5\uc740 \uc9c4\uacf5 \uc0c1\ud0dc\uc5d0\uc11c \uc774\ub8e8\uc5b4\uc9c0\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ub178\ub4dc\uc758 \ub2e4\ub978 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ud070 \uc601\ud5a5\uc744 \ubbf8\uce69\ub2c8\ub2e4.</li> </ul> <p>\uc774 \uc139\uc158\uc744 \ub9c8\ubb34\ub9ac\ud558\uba70, \uc704\uc758 \ub0b4\uc6a9\uc744 \uacfc\ub3c4\ud558\uac8c \ubcf5\uc7a1\ud558\uace0 \ubd88\ud544\uc694\ud558\ub2e4\uace0 \uc0dd\uac01\ud558\uae30 \uc27d\uc2b5\ub2c8\ub2e4. \uc885\uc885 \uc6b0\ub9ac\ub294 \ubb38\uc81c\ub97c \uacaa\uace0 \uc788\uc9c0\ub9cc, \uc798\ubabb\ub41c \uc9c0\ud45c\ub97c \ubcf4\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \ubb38\uc81c\uc758 \uc9c4\uc815\ud55c \uc131\uaca9\uc744 \ubaa8\ub974\uace0 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \uc139\uc158\uc5d0\uc11c\ub294 \uc5b4\ub5bb\uac8c \uc774\ub7f0 \uc77c\uc774 \uc77c\uc5b4\ub0a0 \uc218 \uc788\ub294\uc9c0 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/node_efficiency/#_5","title":"\ub178\ub4dc \ud3ec\ud654\ub3c4","text":"<p>\uc774\uc81c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud3ec\ud654\uc5d0 \ub300\ud574 \uc0b4\ud3b4\ubcf4\uc558\uc73c\ub2c8 \ub178\ub4dc \uad00\uc810\uc5d0\uc11c \uc774\uc640 \ub3d9\uc77c\ud55c \uac1c\ub150\uc744 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9\ub960\uc774 100% \uc778 \ub450 \uac1c\uc758 CPU\ub97c \uc608\ub85c \ub4e4\uc5b4 \uc0ac\uc6a9\ub960\uacfc \ud3ec\ud654\ub3c4 \uac04\uc758 \ucc28\uc774\ub97c \ud655\uc778\ud574 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. </p> <p>\uc67c\ucabd\uc758 vCPU\ub294 100% \uc0ac\uc6a9\ub418\uc9c0\ub9cc \uc774 vCPU\uc5d0\uc11c \uc2e4\ud589\ub418\uae30\ub97c \uae30\ub2e4\ub9ac\ub294 \ub2e4\ub978 \uc791\uc5c5\uc740 \uc5c6\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc21c\uc804\ud788 \uc774\ub860\uc801\uc778 \uc758\ubbf8\uc5d0\uc11c\ub294 \uc0c1\ub2f9\ud788 \ud6a8\uc728\uc801\uc785\ub2c8\ub2e4. \ud55c\ud3b8, \ub450 \ubc88\uc9f8 \uc608\uc5d0\uc11c\ub294 20\uac1c\uc758 \ub2e8\uc77c \uc2a4\ub808\ub4dc \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 vCPU\uc5d0\uc11c \ucc98\ub9ac\ub418\uae30\ub97c \uae30\ub2e4\ub9ac\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uc81c 20\uac1c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubaa8\ub450 vCPU\uc5d0\uc11c \uc21c\uc11c\uac00 \ucc98\ub9ac\ub418\uae30\ub97c \uae30\ub2e4\ub9ac\ub294 \ub3d9\uc548 \uc5b4\ub290 \uc815\ub3c4\uc758 \uc9c0\uc5f0 \uc2dc\uac04\uc774 \ubc1c\uc0dd\ud569\ub2c8\ub2e4. \uc989, \uc624\ub978\ucabd\uc5d0 \uc788\ub294 vCPU\uac00 \ud3ec\ud654 \uc0c1\ud0dc\uc785\ub2c8\ub2e4. </p> <p>\uc0ac\uc6a9\ub960\ub9cc \ubcf4\uba74 \uc774 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uc744 \ubfd0\ub9cc \uc544\ub2c8\ub77c \ub124\ud2b8\uc6cc\ud0b9\uacfc \uac19\uc774 \uad00\ub828\uc774 \uc5c6\ub294 \ubb38\uc81c\uac00 \uc9c0\uc5f0\ub418\uc5b4 \uc798\ubabb\ub41c \uae38\ub85c \uac00\uac8c \ub420 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\ud2b9\uc815 \uc2dc\uc810\uc5d0 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ucd1d \ud30c\ub4dc \uc218\ub97c \ub298\ub9b4 \ub54c\ub294 \uc0ac\uc6a9\ub960 \uc9c0\ud45c\ubfd0\ub9cc \uc544\ub2c8\ub77c \ud3ec\ud654 \uc9c0\ud45c\ub97c \ubcf4\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. \ub178\ub4dc\uac00 \uacfc\ud3ec\ud654 \uc0c1\ud0dc\ub77c\ub294 \uc0ac\uc2e4\uc744 \uc27d\uac8c \ub193\uce60 \uc218 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc774 \uc791\uc5c5\uc5d0\ub294 \uc544\ub798 \ucc28\ud2b8\uc5d0\uc11c \ubcfc \uc218 \uc788\ub294 \uac83\ucc98\ub7fc \uc555\ub825 \ud3ec\ud654 \uc815\ubcf4 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>PromQL - Stalled I/O</p> <pre><code>topk(3, ((irate(node_pressure_io_stalled_seconds_total[1m])) * 100))\n</code></pre> <p></p> <p>Note</p> <p>\uc555\ub825 \uc815\uccb4 \uc9c0\ud45c\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 https://facebookmicrosites.github.io/psi/docs/overview *\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>\uc774 \uce21\uc815\uce58\ub97c \ud1b5\ud574 \uc2a4\ub808\ub4dc\uac00 CPU\uc5d0\uc11c \ub300\uae30 \uc911\uc778\uc9c0, \uc544\ub2c8\uba74 \ubaa8\ub4e0 \uc2a4\ub808\ub4dc\uac00 \uba54\ubaa8\ub9ac \ub610\ub294 I/O\uc640 \uac19\uc740 \ub9ac\uc18c\uc2a4\ub97c \uae30\ub2e4\ub9ac\ub294 \ub3d9\uc548 \uc911\ub2e8\ub418\uc5c8\ub294\uc9c0\ub97c \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc778\uc2a4\ud134\uc2a4\uc758 \ubaa8\ub4e0 \uc2a4\ub808\ub4dc\uac00 1\ubd84 \ub3d9\uc548 I/O\ub97c \uae30\ub2e4\ub9ac\ub294 \ub3d9\uc548 \uc911\ub2e8\ub41c \ube44\uc728\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.  </p> <pre><code>topk(3, ((irate(node_pressure_io_stalled_seconds_total[1m])) * 100))\n</code></pre> <p>\uc774 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uba74 \uc704\uc758 \ucc28\ud2b8\uc5d0\uc11c \ubc15\uc2a4\uc0c1\uc758 \ubaa8\ub4e0 \uc2a4\ub808\ub4dc\uac00 \ud558\uc774 \uc6cc\ud130\ub9c8\ud06c\uc5d0\uc11c I/O\ub97c \uae30\ub2e4\ub9b4 \ub54c 45% \uc758 \uc2dc\uac04 \ub3d9\uc548 \uc911\ub2e8\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc989, 1\ubd84 \ub3d9\uc548 CPU \uc0ac\uc774\ud074\uc744 \ubaa8\ub450 \ub0ad\ube44\ud558\uace0 \uc788\ub2e4\ub294 \ub73b\uc785\ub2c8\ub2e4. \uc774\ub7f0 \uc77c\uc774 \uc77c\uc5b4\ub098\uace0 \uc788\ub2e4\ub294 \uac83\uc744 \uc774\ud574\ud558\uba74 \uc0c1\ub2f9\ud55c \uc591\uc758 vCPU \uc2dc\uac04\uc744 \ud68c\uc218\ud558\uc5ec \uc2a4\ucf00\uc77c\ub9c1\uc758 \ud6a8\uc728\uc131\uc744 \ub192\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/node_efficiency/#hpa-v2","title":"HPA V2","text":"<p>HPA API\uc758 autoscaling/v2 \ubc84\uc804\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\uc804 \ubc84\uc804\uc758 HPA API\ub294 \ud2b9\uc815 \uc5e3\uc9c0 \ucf00\uc774\uc2a4\uc5d0\uc11c \ud06c\uae30 \uc870\uc815\uc774 \uc911\ub2e8\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uac01 \ud655\uc7a5 \ub2e8\uacc4\uc5d0\uc11c \ud30c\ub4dc\uac00 \ub450 \ubc30\ub9cc \uc99d\uac00\ud558\ub294 \uac83\uc73c\ub85c \uc81c\ud55c\ub418\uc5c8\uc73c\ubbc0\ub85c \uc18c\uaddc\ubaa8 \ubc30\ud3ec\uc5d0\uc11c\ub294 \ube60\ub974\uac8c \ud655\uc7a5\ud574\uc57c \ud558\ub294 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. </p> <p>autoscaling/v2\ub97c \uc0ac\uc6a9\ud558\uba74 \uaddc\ubaa8\ub97c \ud655\ub300\ud558\uae30 \uc704\ud55c \uc5ec\ub7ec \uae30\uc900\uc744 \ub354 \uc720\uc5f0\ud558\uac8c \ud3ec\ud568\ud560 \uc218 \uc788\uc73c\uba70, \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ubc0f \uc678\ubd80 \uc9c0\ud45c (K8s \uc9c0\ud45c\uac00 \uc544\ub2d8) \uc744 \uc0ac\uc6a9\ud560 \ub54c \uc720\uc5f0\uc131\uc774 \ud06c\uac8c \ud5a5\uc0c1\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4 \uc138 \uac00\uc9c0 \uac12 \uc911 \uac00\uc7a5 \ub192\uc740 \uac12\uc744 \uae30\uc900\uc73c\ub85c \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(\uc544\ub798 \ucc38\uc870). \ubaa8\ub4e0 \ud30c\ub4dc\uc758 \ud3c9\uade0 \uc0ac\uc6a9\ub960\uc774 50% \ub97c \ub118\uac70\ub098, \ucee4\uc2a4\ud140 \uc9c0\ud45c\uc778 \uacbd\uc6b0 \uc778\uadf8\ub808\uc2a4 \ucd08\ub2f9 \ud328\ud0b7\uc774 \ud3c9\uade0 1,000\uac1c\ub97c \ucd08\uacfc\ud558\uac70\ub098, \uc778\uadf8\ub808\uc2a4 \uc624\ube0c\uc81d\ud2b8\uac00 \ucd08\ub2f9 \uc694\uccad 10,000\uac74\uc744 \ucd08\uacfc\ud560 \uacbd\uc6b0 \uaddc\ubaa8\ub97c \uc870\uc815\ud569\ub2c8\ub2e4.</p> <p>Note</p> <p>\uc774\ub294 Auto Scaling API\uc758 \uc720\uc5f0\uc131\uc744 \ubcf4\uc5ec\uc8fc\uae30 \uc704\ud55c \uac83\uc774\ubbc0\ub85c \ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0\uc11c \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc5b4\ub824\uc6b8 \uc218 \uc788\ub294 \uc9c0\ub098\uce58\uac8c \ubcf5\uc7a1\ud55c \uaddc\uce59\uc740 \ud53c\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. </p> <pre><code>apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: php-apache\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: php-apache\n  minReplicas: 1\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 50\n  - type: Pods\n    pods:\n      metric:\n        name: packets-per-second\n      target:\n        type: AverageValue\n        averageValue: 1k\n  - type: Object\n    object:\n      metric:\n        name: requests-per-second\n      describedObject:\n        apiVersion: networking.k8s.io/v1\n        kind: Ingress\n        name: main-route\n      target:\n        type: Value\n        value: 10k\n</code></pre> <p>\ud558\uc9c0\ub9cc \ubcf5\uc7a1\ud55c \uc6f9 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \uc774\ub7f0 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc704\ud5d8\ud558\ub2e4\ub294 \uac83\uc744 \uc54c\uac8c \ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ud3ec\ud654\ub3c4\uc640 \uc0ac\uc6a9\ub960\uc744 \uc815\ud655\ud558\uac8c \ubc18\uc601\ud558\ub294 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub610\ub294 \uc678\ubd80 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ub354 \ub098\uc740 \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. HPAV2\ub294 \ubaa8\ub4e0 \uc9c0\ud45c\uc5d0 \ub530\ub77c \ud655\uc7a5\ud560 \uc218 \uc788\uc5b4 \uc774\ub97c \uac00\ub2a5\ud558\uac8c \ud558\uc9c0\ub9cc, \uc0ac\uc6a9\ud558\ub824\uba74 \ud574\ub2f9 \uc9c0\ud45c\ub97c \ucc3e\uc544\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub85c \uc775\uc2a4\ud3ec\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4, Apache\uc5d0\uc11c \ud65c\uc131 \uc2a4\ub808\ub4dc \ub300\uae30\uc5f4 \uc218\ub97c \uc0b4\ud3b4\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc2a4\ucf00\uc77c\ub9c1 \ud504\ub85c\ud30c\uc77c\uc774 \"\ub354 \ub9e4\ub044\ub7fd\uac8c\" \ub9cc\ub4e4\uc5b4\uc9c0\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4(\uc774 \uc6a9\uc5b4\uc5d0 \ub300\ud574\uc11c\ub294 \uace7 \uc124\uba85\ud558\uaca0\uc2b5\ub2c8\ub2e4). \uc2a4\ub808\ub4dc\uac00 \ud65c\uc131 \uc0c1\ud0dc\uc774\uba74 \ud574\ub2f9 \uc2a4\ub808\ub4dc\uac00 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uacc4\uce35\uc5d0\uc11c \ub300\uae30 \uc911\uc774\ub4e0 \ub85c\uceec\uc5d0\uc11c \uc694\uccad\uc744 \ucc98\ub9ac\ud558\ub4e0 \uc0c1\uad00 \uc5c6\uc2b5\ub2c8\ub2e4. \ubaa8\ub4e0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc2a4\ub808\ub4dc\uac00 \uc0ac\uc6a9\ub418\uace0 \uc788\ub2e4\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ud3ec\ud654 \uc0c1\ud0dc\uc784\uc744 \ub098\ud0c0\ub0b4\ub294 \uc88b\uc740 \uc9c0\ud45c\uc785\ub2c8\ub2e4. </p> <p>\uc774 \uc2a4\ub808\ub4dc \uace0\uac08\uc744 \uc2e0\ud638\ub85c \uc0ac\uc6a9\ud558\uc5ec \uc644\uc804\ud788 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc2a4\ub808\ub4dc \ud480\uc744 \uac16\ucd98 \uc0c8 \ud30c\ub4dc\ub97c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \ud2b8\ub798\ud53d\uc774 \ub9ce\uc740 \uc2dc\uae30\uc5d0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \ud761\uc218\ud558\ub824\ub294 \ubc84\ud37c \ud06c\uae30\ub97c \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ucd1d \uc2a4\ub808\ub4dc \ud480\uc774 10\uac1c\uc778 \uacbd\uc6b0 \uc0ac\uc6a9\ub41c \uc2a4\ub808\ub4dc 4\uac1c\uc640 \uc0ac\uc6a9\ub41c \uc2a4\ub808\ub4dc 8\uac1c\ub85c \ud655\uc7a5\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud655\uc7a5\ud560 \ub54c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ubc84\ud37c\uc5d0 \ud070 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubd80\ud558\uac00 \uc2ec\ud55c \uc0c1\ud0dc\uc5d0\uc11c \ube60\ub974\uac8c \ud655\uc7a5\ud574\uc57c \ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\ub294 4\ub85c \uc124\uc815\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc2dc\uac04\uc774 \uc9c0\ub0a8\uc5d0 \ub530\ub77c \uc694\uccad \uc218\uac00 \ub290\ub9ac\uac8c \uc99d\uac00\ud558\ub294 \ub300\uc2e0 \uae09\uaca9\ud788 \uc99d\uac00\ud558\ubbc0\ub85c \ud655\uc7a5\ud560 \uc2dc\uac04\uc774 \ucda9\ubd84\ud558\ub2e4\uba74 8\ub85c \uc124\uc815\ud558\ub294 \uac83\uc774 \ub9ac\uc18c\uc2a4 \ud65c\uc6a9\uc5d0 \ub354 \ud6a8\uc728\uc801\uc785\ub2c8\ub2e4. </p> <p></p> <p>\uc2a4\ucf00\uc77c\ub9c1\uacfc \uad00\ub828\ud558\uc5ec \"\ub9e4\ub044\ub7fd\ub2e4\"\ub77c\ub294 \uc6a9\uc5b4\ub294 \ubb34\uc5c7\uc744 \uc758\ubbf8\ud560\uae4c\uc694? \uc544\ub798 \ucc28\ud2b8\ub97c \ubcf4\uba74 CPU\ub97c \uc9c0\ud45c\ub85c \uc0ac\uc6a9\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4 .\uc774 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ud30c\ub4dc \uc218\uac00 50\uac1c\uc5d0\uc11c \ucd5c\ub300 250\uac1c\uae4c\uc9c0 \uc9e7\uc740 \uae30\uac04\uc5d0 \uae09\uc99d\ud558\ub2e4\uac00 \ub2e4\uc2dc \uc989\uc2dc \ucd95\uc18c\ub429\ub2c8\ub2e4.\uc774\ub294 \ub9e4\uc6b0 \ube44\ud6a8\uc728\uc801\uc778 \uc2a4\ucf00\uc77c\ub9c1\uc774 \ud074\ub7ec\uc2a4\ud130 \uc774\ud0c8\uc758 \uc8fc\uc694 \uc6d0\uc778\uc774\ub77c\ub294 \uc810\uc785\ub2c8\ub2e4.</p> <p></p> <p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc62c\ubc14\ub978 \uc2a4\uc704\ud2b8 \uc2a4\ud31f(\ucc28\ud2b8 \uc911\uac04 \ubd80\ubd84)\uc744 \ubc18\uc601\ud558\ub294 \uc9c0\ud45c\ub85c \ubcc0\uacbd\ud55c \ud6c4 \uc6d0\ud65c\ud558\uac8c \ud655\uc7a5\ud560 \uc218 \uc788\ub2e4\ub294 \uc810\uc5d0 \uc8fc\ubaa9\ud558\uc138\uc694. \uc774\uc81c \uc2a4\ucf00\uc77c\ub9c1\uc774 \ud6a8\uc728\uc801\uc774\uc5c8\uc73c\uba70 \uc694\uccad \uc124\uc815\uc744 \uc870\uc815\ud558\uc5ec \uc81c\uacf5\ub41c \uc5ec\uc720 \uacf5\uac04\uc5d0 \ub9de\uac8c \ud30c\ub4dc\ub97c \uc644\uc804\ud788 \ud655\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uc804\uc5d0\ub294 \uc218\ubc31 \uac1c\uc758 \ud30c\ub4dc\uac00 \ud558\ub358 \uc791\uc5c5\uc744 \uc774\uc81c\ub294 \uc18c\uaddc\ubaa8 \ud30c\ub4dc \uadf8\ub8f9\uc774 \uc218\ud589\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc2e4\uc81c \ub370\uc774\ud130\uc5d0 \ub530\ub974\uba74 \uc774\uac83\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 \ud655\uc7a5\uc131\uc744 \uacb0\uc815\ud558\ub294 \uac00\uc7a5 \uc911\uc694\ud55c \uc694\uc18c\uc785\ub2c8\ub2e4. </p> <p></p> <p>\uc911\uc694\ud55c \uc810\uc740 CPU \uc0ac\uc6a9\ub960\uc774 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \ub178\ub4dc \uc131\ub2a5\uc758 \ud55c \ucc28\uc6d0\uc5d0 \ubd88\uacfc\ud558\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. CPU \uc0ac\uc6a9\ub960\uc744 \ub178\ub4dc\uc640 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc720\uc77c\ud55c \uc0c1\ud0dc \uc9c0\ud45c\ub85c \uc0ac\uc6a9\ud558\uba74 \ud655\uc7a5\uc131, \uc131\ub2a5 \ubc0f \ube44\uc6a9 \uce21\uba74\uc5d0\uc11c \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\ub294\ub370, \uc774\ub294 \ubaa8\ub450 \uae34\ubc00\ud558\uac8c \uc5f0\uacb0\ub41c \uac1c\ub150\uc785\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \ub178\ub4dc\uc758 \uc131\ub2a5\uc774 \ub192\uc744\uc218\ub85d \ud655\uc7a5\ud574\uc57c \ud558\ub294 \uc591\uc774 \uc904\uc5b4\ub4e4\uc5b4 \ube44\uc6a9\uc774 \uc808\uac10\ub429\ub2c8\ub2e4. </p> <p>\ub610\ud55c \ud2b9\uc815 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud655\uc7a5\ud558\uae30 \uc704\ud55c \uc62c\ubc14\ub978 \ud3ec\ud654\ub3c4 \uc9c0\ud45c\ub97c \ucc3e\uc544 \uc0ac\uc6a9\ud558\uba74 \ud574\ub2f9 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc2e4\uc81c \ubcd1\ubaa9 \ud604\uc0c1\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud558\uace0 \uacbd\ubcf4\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc911\uc694\ud55c \ub2e8\uacc4\ub97c \uac74\ub108\ub6f0\uba74 \uc131\ub2a5 \ubb38\uc81c\uc5d0 \ub300\ud55c \ubcf4\uace0\uc11c\ub97c \uc774\ud574\ud558\uae30\uac00 \ubd88\uac00\ub2a5\ud558\uc9c0\ub294 \uc54a\ub354\ub77c\ub3c4 \uc774\ud574\ud558\uae30 \uc5b4\ub824\uc6b8 \uac83\uc785\ub2c8\ub2e4.   </p>"},{"location":"ko/scalability/docs/node_efficiency/#cpu","title":"CPU \uc81c\ud55c \uc124\uc815","text":"<p>\uc798\ubabb \uc774\ud574\ub418\uace0 \uc788\ub294 \uc8fc\uc81c\uc5d0 \ub300\ud574 \uc774 \uc139\uc158\uc744 \ub9c8\ubb34\ub9ac\ud558\uae30 \uc704\ud574 CPU \uc81c\ud55c\uc5d0 \ub300\ud574 \uc124\uba85\ud558\uaca0\uc2b5\ub2c8\ub2e4. \uac04\ub2e8\ud788 \ub9d0\ud574 \ud55c\ub3c4\ub294 100ms\ub9c8\ub2e4 \uc7ac\uc124\uc815\ud558\ub294 \uce74\uc6b4\ud130\uac00 \uc788\ub294 \ucee8\ud14c\uc774\ub108\uc640 \uad00\ub828\ub41c \uba54\ud0c0\ub370\uc774\ud130\uc785\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 Linux\ub294 100ms \uae30\uac04 \ub3d9\uc548 \ud2b9\uc815 \ucee8\ud14c\uc774\ub108\uac00 \ub178\ub4dc \uc804\uccb4\uc5d0\uc11c \uc0ac\uc6a9\ud55c CPU \ub9ac\uc18c\uc2a4 \uc218\ub97c \ucd94\uc801\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\uc81c\ud55c\uc744 \uc124\uc815\ud560 \ub54c \ud754\ud55c \uc624\ub958\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ub2e8\uc77c \uc2a4\ub808\ub4dc\uc774\uba70 \ud560\ub2f9\ub41c vCPU\uc5d0\uc11c\ub9cc \uc2e4\ud589\ub41c\ub2e4\uace0 \uac00\uc815\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc704 \uc139\uc158\uc5d0\uc11c CFS\ub294 \ucf54\uc5b4\ub97c \ud560\ub2f9\ud558\uc9c0 \uc54a\uc73c\uba70, \uc2e4\uc81c\ub85c \ub300\uaddc\ubaa8 \uc2a4\ub808\ub4dc \ud480\uc744 \uc2e4\ud589\ud558\ub294 \ucee8\ud14c\uc774\ub108\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ubaa8\ub4e0 vCPU\ub97c \uc2a4\ucf00\uc904\ub9c1\ud55c\ub2e4\ub294 \uac83\uc744 \ubc30\uc6e0\uc2b5\ub2c8\ub2e4. </p> <p>64\uac1c\uc758 OS \uc2a4\ub808\ub4dc\uac00 64\uac1c\uc758 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ucf54\uc5b4(\ub9ac\ub205\uc2a4 \ub178\ub4dc \uad00\uc810\uc5d0\uc11c)\uc5d0\uc11c \uc2e4\ud589\ub418\uace0 \uc788\ub2e4\uba74, \uadf8 64\uac1c\uc758 \ucf54\uc5b4\uc5d0\uc11c \ubaa8\ub450 \uc2e4\ud589\ub41c \uc2dc\uac04\uc744 \ud569\ud55c \ud6c4 100ms \uae30\uac04 \ub3d9\uc548 \uc0ac\uc6a9\ub41c CPU \uc2dc\uac04\uc758 \ucd1d\uacc4\ub294 \uc0c1\ub2f9\ud788 \ud06c\uac8c \ub420 \uac83\uc785\ub2c8\ub2e4. \uc774\uac83\uc740 \uac00\ube44\uc9c0 \uc218\uc9d1 \ud504\ub85c\uc138\uc2a4 \uc911\uc5d0\ub9cc \ubc1c\uc0dd\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc774\ub7f0 \uac83\uc744 \ub193\uce58\uae30\uac00 \uc0c1\ub2f9\ud788 \uc27d\uc2b5\ub2c8\ub2e4. \uc774\uac83\uc774 \uc81c\ud55c\uc744 \uc124\uc815\ud558\uae30 \uc804\uc5d0 \uc2dc\uac04 \ub3d9\uc548 \uc62c\ubc14\ub978 \uc0ac\uc6a9\ub7c9\uc744 \ubcf4\uc7a5\ud558\uae30 \uc704\ud574 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud574\uc57c \ud558\ub294 \uc774\uc720\uc785\ub2c8\ub2e4.</p> <p>\ub2e4\ud589\ud788\ub3c4, \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ubaa8\ub4e0 \uc2a4\ub808\ub4dc\uc5d0\uc11c \uc5bc\ub9c8\ub098 \ub9ce\uc740 vCPU\uac00 \uc0ac\uc6a9\ub418\uace0 \uc788\ub294\uc9c0 \uc815\ud655\ud788 \uc54c \uc218 \uc788\ub294 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubaa9\uc801\uc73c\ub85c <code>container_cpu_usage_seconds_total</code> \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud560 \uac83\uc785\ub2c8\ub2e4.</p> <p>\uc2a4\ub85c\ud2c0\ub9c1 \ub85c\uc9c1\uc774 \ub9e4 100ms\ub9c8\ub2e4 \ubc1c\uc0dd\ud558\uace0 \uc774 \uc9c0\ud45c\uac00 \ucd08\ub2f9 \uc9c0\ud45c\uc774\ubbc0\ub85c, \uc774 100ms \uae30\uac04\uc5d0 \ub9de\uac8c PromQL\uc744 \uc0ac\uc6a9\ud560 \uac83\uc785\ub2c8\ub2e4. \uc774 PromQL \uba85\ub839\ubb38 \uc791\uc5c5\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\ub824\uba74 \ub2e4\uc74c \ube14\ub85c\uadf8\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>PromQL \ucffc\ub9ac: </p> <pre><code>topk(3, max by (pod, container)(rate(container_cpu_usage_seconds_total{image!=\"\", instance=\"$instance\"}[$__rate_interval]))) / 10\n</code></pre> <p></p> <p>\uc77c\ub2e8 \uc6b0\ub9ac\uac00 \uc62c\ubc14\ub978 \uac00\uce58\ub97c \uac00\uc9c0\uace0 \uc788\ub2e4\uace0 \uc0dd\uac01\ub418\uba74, \ud504\ub85c\ub355\uc158\uc5d0\uc11c \uc81c\ud55c\uc744 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c \uc608\uc0c1\uce58 \ubabb\ud55c \ubb38\uc81c\ub85c \uc778\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ubcd1\ubaa9 \ud604\uc0c1\uc744 \uacaa\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud574\uc57c \ud569\ub2c8\ub2e4 <code>container_cpu_throttled_seconds_total</code>\uc744 \uc0b4\ud3b4\ubcf4\uba74 \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>topk(3, max by (pod, container)(rate(container_cpu_cfs_throttled_seconds_total{image!=``\"\"``, instance=``\"$instance\"``}[$__rate_interval]))) / 10\n</code></pre> <p></p>"},{"location":"ko/scalability/docs/node_efficiency/#_6","title":"\uba54\ubaa8\ub9ac","text":"<p>\uba54\ubaa8\ub9ac \ud560\ub2f9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub9c1 \ub3d9\uc791\uacfc \ub9ac\ub205\uc2a4 CGroup \ub3d9\uc791\uc744 \ud63c\ub3d9\ud558\uae30 \uc26c\uc6b4 \ub610 \ub2e4\ub978 \uc608\uc785\ub2c8\ub2e4. CGroup v2\uac00 \ub9ac\ub205\uc2a4\uc5d0\uc11c \uba54\ubaa8\ub9ac\ub97c \ucc98\ub9ac\ud558\ub294 \ubc29\uc2dd\uc774 \ud06c\uac8c \ubcc0\uacbd\ub418\uc5c8\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uc774\ub97c \ubc18\uc601\ud558\uc5ec \uad6c\ubb38\uc744 \ubcc0\uacbd\ud588\uae30 \ub54c\ubb38\uc5d0 \uc774 \uc8fc\uc81c\ub294 \uc880 \ub354 \ubbf8\ubb18\ud55c \uc8fc\uc81c\uc785\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc774 \ube14\ub85c\uadf8\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>CPU \uc694\uccad\uacfc \ub2ec\ub9ac \uba54\ubaa8\ub9ac \uc694\uccad\uc740 \uc2a4\ucf00\uc904\ub9c1 \ud504\ub85c\uc138\uc2a4\uac00 \uc644\ub8cc\ub41c \ud6c4 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub294 CGroup v1\uc5d0\uc11c CPU\uc640 \uac19\uc740 \ubc29\uc2dd\uc73c\ub85c \uba54\ubaa8\ub9ac\ub97c \uc555\ucd95\ud560 \uc218 \uc5c6\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uadf8 \uacb0\uacfc \uc6b0\ub9ac\ub294 \uba54\ubaa8\ub9ac \uc81c\ud55c\ub9cc\uc744 \uac00\uc9c0\uac8c \ub418\uba70, \uc774\ub294 \uba54\ubaa8\ub9ac \ub204\uc218\uc5d0 \ub300\ud55c \uc2e4\ud328\ub85c\ubd80\ud130 \ud30c\ub4dc\ub97c \uc644\uc804\ud788 \uc885\ub8cc\uc2dc\ud0a4\ub294 \uac83\uc73c\ub85c \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc804\ubd80 \ub610\ub294 \uc544\ubb34\uac83\ub3c4 \uc5c6\ub294 \uc2a4\ud0c0\uc77c\uc758 \uc81c\uc548\uc774\uc9c0\ub9cc, \uc774 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud55c \uc0c8\ub85c\uc6b4 \ubc29\ubc95\uc774 \uc81c\uc2dc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <p>\uccab\uc9f8, \ucee8\ud14c\uc774\ub108\uc5d0 \uc62c\ubc14\ub978 \uc591\uc758 \uba54\ubaa8\ub9ac\ub97c \uc124\uc815\ud558\ub294 \uac83\uc740 \ubcf4\uc774\ub294 \uac83\ub9cc\ud07c \uac04\ub2e8\ud558\uc9c0 \uc54a\ub2e4\ub294 \uac83\uc744 \uc774\ud574\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. \ub9ac\ub205\uc2a4\uc758 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc740 \uc131\ub2a5 \ud5a5\uc0c1\uc744 \uc704\ud574 \uba54\ubaa8\ub9ac\ub97c \uce90\uc2dc\ub85c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc774 \uce90\uc2dc\ub294 \uc2dc\uac04\uc774 \uc9c0\ub0a8\uc5d0 \ub530\ub77c \uc131\uc7a5\ud558\uba70, \uc5bc\ub9c8\ub098 \ub9ce\uc740 \uba54\ubaa8\ub9ac\uac00 \uce90\uc2dc\uc5d0 \uc88b\uc9c0\ub9cc \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \uc131\ub2a5\uc5d0 \ud070 \uc601\ud5a5\uc744 \ubbf8\uce58\uc9c0 \uc54a\uace0 \ub418\ucc3e\uc744 \uc218 \uc788\ub294\uc9c0 \uc54c\uae30 \uc5b4\ub835\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc885\uc885 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc744 \uc798\ubabb \ud574\uc11d\ud558\ub294 \uacb0\uacfc\ub97c \uac00\uc838\uc635\ub2c8\ub2e4.</p> <p>\uba54\ubaa8\ub9ac\ub97c \"\uc555\ucd95\"\ud558\ub294 \ub2a5\ub825\uc744 \uac16\uac8c \ub418\uc5c8\ub358 \uac83\uc740 CGroup v2\uc758 \uc8fc\uc694 \ub3d9\uae30 \uc911 \ud558\ub098\uc600\uc2b5\ub2c8\ub2e4. CGroup V2\uac00 \ud544\uc694\ud588\ub358 \uc774\uc720\uc5d0 \ub300\ud55c \ub354 \ub9ce\uc740 \uc5ed\uc0ac\ub97c \uc54c\uace0 \uc2f6\ub2e4\uba74, LISA21\uc5d0\uc11c Chris Down\uc758 \ubc1c\ud45c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624. \uadf8\ub294 \ucd5c\uc18c \uba54\ubaa8\ub9ac\ub97c \uc62c\ubc14\ub974\uac8c \uc124\uc815\ud560 \uc218 \uc5c6\ub294 \ubb38\uc81c\uac00 CGroup v2\uc640 \uc555\ub825 \uc815\uccb4 \uc9c0\ud45c\ub97c \ub9cc\ub4dc\ub294 \ub370\uc5d0 \uc774\ub974\uac8c \ud55c \uc6d0\uc778 \uc911 \ud558\ub098\uc600\ub2e4\uace0 \uc124\uba85\ud569\ub2c8\ub2e4.</p> <p>\ub2e4\ud589\ud788 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc774\uc81c <code>requests.memory</code>\uc5d0\uc11c <code>memory.min</code>\uacfc <code>memory.high</code>\ub77c\ub294 \uac1c\ub150\uc744 \uac16\uac8c \ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uce90\uc2dc\ub41c \uba54\ubaa8\ub9ac\ub97c \uc801\uadf9\uc801\uc73c\ub85c \ud574\uc81c\ud558\uc5ec \ub2e4\ub978 \ucee8\ud14c\uc774\ub108\uac00 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\uac00 \uba54\ubaa8\ub9ac \uc0c1\ud55c\uc5d0 \ub3c4\ub2ec\ud558\uba74 \ucee4\ub110\uc740 \ud574\ub2f9 \ucee8\ud14c\uc774\ub108\uc758 \uba54\ubaa8\ub9ac\ub97c <code>memory.min</code>\uc73c\ub85c \uc124\uc815\ub41c \uac12\uae4c\uc9c0 \uc801\uadf9\uc801\uc73c\ub85c \ud68c\uc218\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c \ub178\ub4dc\uc5d0 \uba54\ubaa8\ub9ac \uc555\ub825\uc774 \uac00\ud574\uc9c8 \ub54c \uc720\uc5f0\uc131\uc774 \ud5a5\uc0c1\ub429\ub2c8\ub2e4.</p> <p>\ud575\uc2ec \uc9c8\ubb38\uc740 <code>memory.min</code>\uc744 \uc5b4\ub5a4 \uac12\uc73c\ub85c \uc124\uc815\ud574\uc57c \ud558\ub294\uac00\uc785\ub2c8\ub2e4. \uc5ec\uae30\uc11c \uba54\ubaa8\ub9ac \uc555\ub825 \uc815\uccb4 \uc9c0\ud45c\uac00 \uc791\uc6a9\ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108 \uc218\uc900\uc5d0\uc11c \uba54\ubaa8\ub9ac \"\uc2a4\ub798\uc2f1\"\uc744 \uac10\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\uba74 fbtax\uc640 \uac19\uc740 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774 \uba54\ubaa8\ub9ac \uc2a4\ub798\uc2f1\uc744 \ucc3e\uc544 <code>memory.min</code>\uc758 \uc62c\ubc14\ub978 \uac12\uc744 \ud0d0\uc9c0\ud558\uace0, <code>memory.min</code> \uac12\uc744 \ub3d9\uc801\uc73c\ub85c \uc774 \uc124\uc815\uc73c\ub85c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/node_efficiency/#_7","title":"\uc815\ub9ac\ud558\uae30","text":"<p>\uc774 \uc139\uc158\uc744 \uc694\uc57d\ud558\uba74, \ub2e4\uc74c\uacfc \uac19\uc740 \uac1c\ub150\uc744 \ud63c\ub3d9\ud558\uae30 \uc27d\uc2b5\ub2c8\ub2e4:</p> <ul> <li>\uc774\uc6a9\ub960(Utilization)\uc640 \ud3ec\ud654\ub3c4(Saturation)  </li> <li>\ub9ac\ub205\uc2a4 \uc131\ub2a5 \uaddc\uce59\uacfc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec \ub85c\uc9c1</li> </ul> <p>\uc774\ub7f0 \uac1c\ub150\ub4e4\uc744 \uad6c\ubd84\ud558\ub3c4\ub85d \ub9ce\uc740 \uc8fc\uc758\ub97c \uae30\uc6b8\uc5ec\uc57c \ud569\ub2c8\ub2e4. \uc131\ub2a5\uacfc \uc2a4\ucf00\uc77c\uc740 \uae4a\uc740 \uc218\uc900\uc5d0\uc11c \uc5f0\uacb0\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ubd88\ud544\uc694\ud55c \uc2a4\ucf00\uc77c\ub9c1\uc740 \uc131\ub2a5 \ubb38\uc81c\ub97c \uc77c\uc73c\ud0a4\uba70, \uadf8 \uacb0\uacfc \uc2a4\ucf00\uc77c\ub9c1 \ubb38\uc81c\ub97c \ucd08\ub798\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/scaling_theory/","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc77c\ub9c1 \uc774\ub860","text":""},{"location":"ko/scalability/docs/scaling_theory/#vs","title":"\ub178\ub4dc vs. \uc774\ud0c8\ub960","text":"<p>\ud754\ud788 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \ud655\uc7a5\uc131\uc744 \ub17c\uc758\ud560 \ub54c \uc6b0\ub9ac\ub294 \ub2e8\uc77c \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc788\ub294 \ub178\ub4dc \uc218\ub85c \uc774\uc57c\uae30\ud569\ub2c8\ub2e4. \ud765\ubbf8\ub86d\uac8c\ub3c4, \uc774\uac83\uc740 \ud655\uc7a5\uc131\uc744 \uc774\ud574\ud558\uae30 \uc704\ud55c \uac00\uc7a5 \uc720\uc6a9\ud55c \uc9c0\ud45c\ub294 \uc544\ub2d9\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \ub9ce\uc9c0\ub9cc \uace0\uc815\ub41c \uc218\uc758 \ud30c\ub4dc\uac00 \uc788\ub294 5,000\ub178\ub4dc \ud074\ub7ec\uc2a4\ud130\ub294 \ucd08\uae30 \uc124\uc815 \uc774\ud6c4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \ud070 \ubd80\ub2f4\uc744 \uc8fc\uc9c0 \uc54a\uc744 \uac83\uc785\ub2c8\ub2e4. \ud558\uc9c0\ub9cc 1,000\uac1c\uc758 \ub178\ub4dc \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec 1\ubd84 \uc774\ub0b4\uc5d0 \uc218\uba85\uc774 \uc9e7\uc740 \uc791\uc5c5 10,000\uac1c\ub97c \ub9cc\ub4e4\ub824\uace0 \uc2dc\ub3c4\ud55c\ub2e4\uba74 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \uc9c0\uc18d\uc801\uc778 \uc555\ubc15\uc744 \uac00\ud560 \uac83\uc785\ub2c8\ub2e4. </p> <p>\ub2e8\uc21c\ud788 \ub178\ub4dc \uc218\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2a4\ucf00\uc77c\ub9c1\uc744 \uc774\ud574\ud558\ub294 \uac83\uc740 \uc624\ud574\uc758 \uc18c\uc9c0\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ud2b9\uc815 \uae30\uac04 \ub0b4\uc5d0 \ubc1c\uc0dd\ud558\ub294 \ubcc0\ud654\uc728\uc758 \uad00\uc810\uc5d0\uc11c \uc0dd\uac01\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4(\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ucffc\ub9ac\uac00 \uc77c\ubc18\uc801\uc73c\ub85c \uae30\ubcf8\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub294 \uac04\uaca9\uc774\ubbc0\ub85c \uc5ec\uae30\uc11c\ub294 5\ubd84 \uac04\uaca9\uc744 \uc124\uba85\ud558\uaca0\uc2b5\ub2c8\ub2e4). \ubcc0\ud654\uc728\uc758 \uad00\uc810\uc5d0\uc11c \ubb38\uc81c\ub97c \uad6c\uc131\ud558\uba74 \uc6d0\ud558\ub294 \uaddc\ubaa8\uc5d0 \ub3c4\ub2ec\ud558\uae30 \uc704\ud574 \ubb34\uc5c7\uc744 \uc870\uc815\ud574\uc57c \ud560\uc9c0 \ub354 \uc798 \uc54c \uc218 \uc788\ub294 \uc774\uc720\ub97c \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/scaling_theory/#_2","title":"\ucd08\ub2f9 \ucffc\ub9ac \uc218 \uc0dd\uac01\ud558\uae30","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uccb4\uc778\uc758 \ub2e4\uc74c \ub9c1\ud06c\uc5d0 \uacfc\ubd80\ud558\uac00 \uac78\ub9ac\uc9c0 \uc54a\ub3c4\ub85d Kubelet, \uc2a4\ucf00\uc974\ub7ec, \ucee8\ud2b8\ub864\ub7ec \ub9e4\ub2c8\uc800, API \uc11c\ubc84 \ub4f1 \uac01 \uad6c\uc131 \uc694\uc18c\uc5d0 \ub300\ud574 \uc5ec\ub7ec \uac00\uc9c0 \ubcf4\ud638 \uba54\ucee4\ub2c8\uc998\uc744 \uac16\ucd94\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, Kubelet\uc5d0\ub294 API \uc11c\ubc84\uc5d0 \ub300\ud55c \ud638\ucd9c\uc744 \uc77c\uc815 \uc18d\ub3c4\ub85c \uc81c\ud55c\ud558\ub294 \ud50c\ub798\uadf8\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \ubcf4\ud638 \uba54\ucee4\ub2c8\uc998\uc740 \ud56d\uc0c1 \uadf8\ub7f0 \uac83\uc740 \uc544\ub2c8\uc9c0\ub9cc \uc77c\ubc18\uc801\uc73c\ub85c \ucd08\ub2f9 \ud5c8\uc6a9 \ucffc\ub9ac \ub610\ub294 QPS\ub85c \ud45c\ud604\ub429\ub2c8\ub2e4. </p> <p>\uc774\ub7f0 QPS \uc124\uc815\uc744 \ubcc0\uacbd\ud560 \ub54c\ub294 \uac01\ubcc4\ud55c \uc8fc\uc758\ub97c \uae30\uc6b8\uc5ec\uc57c \ud569\ub2c8\ub2e4. Kubelet\uc758 \ucd08\ub2f9 \ucffc\ub9ac\uc640 \uac19\uc740 \ud558\ub098\uc758 \ubcd1\ubaa9 \ud604\uc0c1\uc744 \uc81c\uac70\ud558\uba74 \ub2e4\ub978 \ub2e4\uc6b4\uc2a4\ud2b8\ub9bc \uad6c\uc131 \uc694\uc18c\uc5d0\ub3c4 \uc601\ud5a5\uc744 \ubbf8\uce69\ub2c8\ub2e4. \uc774\ub85c \uc778\ud574 \uc2dc\uc2a4\ud15c\uc774 \uc77c\uc815 \uc18d\ub3c4 \uc774\uc0c1\uc73c\ub85c \uacfc\ubd80\ud558\ub97c \uacaa\uc744 \uc218 \uc788\uace0 \ub610 \uadf8\ub807\uac8c \ub420 \uac83\uc774\ubbc0\ub85c, \uc11c\ube44\uc2a4 \uccb4\uc778\uc758 \uac01 \ubd80\ubd84\uc744 \uc774\ud574\ud558\uace0 \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \uac83\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc131\uacf5\uc801\uc73c\ub85c \ud655\uc7a5\ud558\ub294 \ub370 \uc911\uc694\ud569\ub2c8\ub2e4.</p> <p>Note</p> <p>API \uc11c\ubc84\ub294 API Priority \ubc0f Fairness \ub3c4\uc785\uc73c\ub85c \ub354 \ubcf5\uc7a1\ud55c \uc2dc\uc2a4\ud15c\uc744 \uac00\uc9c0\uace0 \uc788\uc73c\uba70, \uc774\uc5d0 \ub300\ud574 \ubcc4\ub3c4\ub85c \ub17c\uc758\ud560 \uac83\uc785\ub2c8\ub2e4.</p> <p>Note</p> <p>\uc8fc\uc758: \uc77c\ubd80 \uc9c0\ud45c\ub294 \uc801\ud569\ud55c \uac83\ucc98\ub7fc \ubcf4\uc774\uc9c0\ub9cc \uc0ac\uc2e4 \ub2e4\ub978 \uac83\uc744 \uce21\uc815\ud558\ub294 \uacbd\uc6b0\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 <code>kubelet_http_inflight_requests</code>\ub294 Kubelet\uc758 \uc9c0\ud45c \uc11c\ubc84\uc5d0\ub9cc \uad00\ub828\uc774 \uc788\uc73c\uba70, Kubelet\uc5d0\uc11c API \uc11c\ubc84 \uc694\uccad\uc758 \uc218\uac00 \uc544\ub2d9\ub2c8\ub2e4. \uc774\ub85c \uc778\ud574 Kubelet\uc758 QPS \ud50c\ub798\uadf8\ub97c \uc798\ubabb \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud2b9\uc815 Kubelet\uc5d0 \ub300\ud55c \uac10\uc0ac \ub85c\uadf8 \ucffc\ub9ac\uac00 \uc9c0\ud45c\ub97c \ud655\uc778\ud558\ub294 \ub354 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/scaling_theory/#_3","title":"\ubd84\uc0b0 \ucef4\ud3ec\ub10c\ud2b8 \uc2a4\ucf00\uc77c\ub9c1","text":"<p>EKS\ub294 \uad00\ub9ac\ud615 \uc11c\ube44\uc2a4\uc774\ubbc0\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uad6c\uc131 \uc694\uc18c\ub97c \ub450 \ubc94\uc8fc\ub85c \ub098\ub204\uaca0\uc2b5\ub2c8\ub2e4. \ud558\ub098\ub294 etcd, Kube \ucee8\ud2b8\ub864\ub7ec \ub9e4\ub2c8\uc800 \ubc0f \uc2a4\ucf00\uc974\ub7ec(\ub2e4\uc774\uc5b4\uadf8\ub7a8 \uc67c\ucabd \ubd80\ubd84)\ub97c \ud3ec\ud568\ud558\ub294 AWS \uad00\ub9ac\ud615 \uad6c\uc131 \uc694\uc18c\uc640 Kubelet, \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uacfc \uac19\uc740 \uace0\uac1d\uc774 \uad6c\uc131\ud560 \uc218 \uc788\ub294 \uad6c\uc131 \uc694\uc18c, \ub124\ud2b8\uc6cc\ud0b9 \ubc0f \uc2a4\ud1a0\ub9ac\uc9c0 \ub4dc\ub77c\uc774\ubc84\uc640 \uac19\uc774 AWS API\ub97c \ud638\ucd9c\ud558\ub294 \ub2e4\uc591\ud55c \uc624\ud37c\ub808\uc774\ud130(\ub2e4\uc774\uc5b4\uadf8\ub7a8 \uc624\ub978\ucabd)\uc785\ub2c8\ub2e4. API \uc6b0\uc120 \uc21c\uc704 \ubc0f \uacf5\uc815\uc131 \uc124\uc815\uc740 \uace0\uac1d\uc774 \uad6c\uc131\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c AWS\uc5d0\uc11c \uad00\ub9ac\ud558\ub354\ub77c\ub3c4 API \uc11c\ubc84\ub294 \uc911\uac04\uc5d0 \ub461\ub2c8\ub2e4. </p> <p></p>"},{"location":"ko/scalability/docs/scaling_theory/#_4","title":"\uc5c5\uc2a4\ud2b8\ub9bc \ubc0f \ub2e4\uc6b4\uc2a4\ud2b8\ub9bc \ubcd1\ubaa9 \ud604\uc0c1","text":"<p>\uac01 \uc11c\ube44\uc2a4\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud560 \ub54c\ub294 \uc9c0\ud45c\ub97c \uc591\ubc29\ud5a5\uc73c\ub85c \uac80\ud1a0\ud558\uc5ec \ubcd1\ubaa9 \ud604\uc0c1\uc744 \ucc3e\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. Kubelet\uc744 \uc608\ub85c \ub4e4\uc5b4 \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud558\ub294 \ubc29\ubc95\uc744 \uc54c\uc544\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. Kubelet\uc740 API \uc11c\ubc84\uc640 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784 \ubaa8\ub450\uc5d0 \ub300\ud574 \ud1b5\uc2e0\ud569\ub2c8\ub2e4. \uad6c\uc131 \uc694\uc18c \uc911 \ud558\ub098\uc5d0 \ubb38\uc81c\uac00 \uc788\ub294\uc9c0 \uc5ec\ubd80\ub97c \uac10\uc9c0\ud558\ub824\uba74 \uc5b4\ub5bb\uac8c, \ubb34\uc5c7\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud574\uc57c \ud560\uae4c\uc694?</p>"},{"location":"ko/scalability/docs/scaling_theory/#_5","title":"\ub178\ub4dc\ub2f9 \ud30c\ub4dc \uc218\ub294 \uba87 \uac1c\uc778\uac00\uc694?","text":"<p>\ud55c \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc \uc218\uc640 \uac19\uc740 \ud655\uc7a5 \uc218\uce58\ub97c \uc0b4\ud3b4\ubcf4\uba74 \uc5c5\uc2a4\ud2b8\ub9bc\uc774 \uc9c0\uc6d0\ud558\ub294 \ub178\ub4dc\ub2f9 110\uac1c\uc758 \ud30c\ub4dc\ub97c \uc561\uba74 \uadf8\ub300\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>Note</p> <p>https://kubernetes.io/docs/setup/best-practices/cluster-large/</p> <p>\ud558\uc9c0\ub9cc \uc6cc\ud06c\ub85c\ub4dc\ub294 \uc5c5\uc2a4\ud2b8\ub9bc\uc758 \ud655\uc7a5\uc131 \ud14c\uc2a4\ud2b8\uc5d0\uc11c \ud14c\uc2a4\ud2b8\ud55c \uac83\ubcf4\ub2e4 \ub354 \ubcf5\uc7a1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud504\ub85c\ub355\uc158\uc5d0\uc11c \uc2e4\ud589\ud558\ub824\ub294 \ud30c\ub4dc\uc758 \uac1c\uc218\ub9cc\ud07c \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud560 \uc218 \uc788\ub3c4\ub85d Kubelet\uc774 Containerd \ub7f0\ud0c0\uc784\uc744 \"\ub530\ub77c\uc7a1\uace0\" \uc788\ub294\uc9c0 \ud655\uc778\ud574\ubd05\ub2c8\ub2e4.</p> <p></p> <p>\uc9c0\ub098\uce58\uac8c \ub2e8\uc21c\ud654\ud558\uc790\uba74, Kubelet\uc740 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784 (\uc6b0\ub9ac\uc758 \uacbd\uc6b0 Containerd) \uc5d0\uc11c \ud30c\ub4dc\uc758 \uc0c1\ud0dc\ub97c \uac00\uc838\uc624\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uc0c1\ud0dc\ub97c \ub108\ubb34 \ube68\ub9ac \ubcc0\uacbd\ud558\ub294 \ud30c\ub4dc\uac00 \ub108\ubb34 \ub9ce\uc73c\uba74 \uc5b4\ub5bb\uac8c \ub420\uae4c\uc694? \ubcc0\uacbd\ub960\uc774 \ub108\ubb34 \ub192\uc73c\uba74 [\ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc5d0 \ub300\ud55c] \uc694\uccad\uc774 \ud0c0\uc784\uc544\uc6c3\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Note</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ub04a\uc784\uc5c6\uc774 \uc9c4\ud654\ud558\uace0 \uc788\uc73c\uba70, \uc774 \uc11c\ube0c \uc2dc\uc2a4\ud15c\uc740 \ud604\uc7ac \ubcc0\ud654\ub97c \uacaa\uace0 \uc788\uc2b5\ub2c8\ub2e4. https://github.com/kubernetes/enhancements/issues/3386</p> <p> </p> <p>\uc704 \uadf8\ub798\ud504\uc5d0\uc11c \ud30c\ub4dc \ub77c\uc774\ud504\uc0ac\uc774\ud074 \uc774\ubca4\ud2b8 \uc0dd\uc131 \uae30\uac04 \uc9c0\ud45c\uc758 \ud0c0\uc784\uc544\uc6c3 \uac12\uc5d0 \ub3c4\ub2ec\ud588\uc74c\uc744 \ub098\ud0c0\ub0b4\ub294 \ub0a9\uc791\ud55c \uc120\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uccb4 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc774\ub97c \ud655\uc778\ud558\ub824\uba74 \ub2e4\uc74c PromQL \uad6c\ubb38\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>increase(kubelet_pleg_relist_duration_seconds_bucket{instance=\"$instance\"}[$__rate_interval])\n</code></pre> <p>\uc774\ub7f0 \ud0c0\uc784\uc544\uc6c3 \ub3d9\uc791\uc744 \ubaa9\uaca9\ud558\uba74 \ub178\ub4dc\uac00 \uac00\ub2a5\ud55c \ud55c\ub3c4\ub97c \ucd08\uacfc\ud588\ub2e4\ub294 \uac83\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uacc4\uc18d \uc9c4\ud589\ud558\uae30 \uc804\uc5d0 \ud0c0\uc784\uc544\uc6c3\uc758 \uc6d0\uc778\uc744 \uc218\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub294 \ub178\ub4dc\ub2f9 \ud30c\ub4dc \uc218\ub97c \uc904\uc774\uac70\ub098 \ub9ce\uc740 \uc591\uc758 \uc7ac\uc2dc\ub3c4\ub97c \uc720\ubc1c\ud558\uc5ec \uc774\ud0c8\ub960\uc5d0 \uc601\ud5a5\uc744 \uc904 \uc218 \uc788\ub294 \uc624\ub958\ub97c \ucc3e\uc544\ub0c4\uc73c\ub85c\uc368 \ub2ec\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc911\uc694\ud55c \uc810\uc740 \ub178\ub4dc\uac00 \uace0\uc815\ub41c \uc218 \ub300\uc2e0 \ud560\ub2f9\ub41c \ud30c\ub4dc\uc758 \ud68c\uc804\uc728\uc744 \ucc98\ub9ac\ud560 \uc218 \uc788\ub294\uc9c0 \uc5ec\ubd80\ub97c \uc774\ud574\ud558\ub294 \uac00\uc7a5 \uc88b\uc740 \ubc29\ubc95\uc740 \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/scaling_theory/#_6","title":"\uc9c0\ud45c\ubcc4 \ud655\uc7a5","text":"<p>\uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2dc\uc2a4\ud15c\uc744 \ucd5c\uc801\ud654\ud55c\ub2e4\ub294 \uac1c\ub150\uc740 \uc624\ub798\ub418\uc5c8\uc9c0\ub9cc \uc0ac\ub78c\ub4e4\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc5ec\uc815\uc744 \uc2dc\uc791\ud558\uba74\uc11c \uac04\uacfc\ub418\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \ud2b9\uc815 \uc22b\uc790 (\uc608: \ub178\ub4dc\ub2f9 110\uac1c\uc758 \ud30c\ub4dc) \uc5d0 \ucd08\uc810\uc744 \ub9de\ucd94\ub294 \ub300\uc2e0 \uc2dc\uc2a4\ud15c\uc758 \ubcd1\ubaa9 \uc9c0\uc810\uc744 \ucc3e\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub418\ub294 \uc9c0\ud45c\ub97c \ucc3e\ub294 \ub370 \uc9d1\uc911\ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc9c0\ud45c\uc5d0 \ub300\ud55c \uc62c\ubc14\ub978 \uc784\uacc4\uac12\uc744 \uc774\ud574\ud558\uba74 \uc2dc\uc2a4\ud15c\uc774 \ucd5c\uc801\uc73c\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\ub2e4\ub294 \ud655\uc2e0\uc744 \uac00\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. </p>"},{"location":"ko/scalability/docs/scaling_theory/#_7","title":"\ubcc0\uacbd\uc73c\ub85c \uc778\ud55c \uc601\ud5a5","text":"<p>\ubb38\uc81c\ub97c \uc77c\uc73c\ud0ac \uc218 \uc788\ub294 \uc77c\ubc18\uc801\uc778 \ud328\ud134\uc740 \uc758\uc2ec\uc2a4\ub7ec\uc6cc \ubcf4\uc774\ub294 \uccab \ubc88\uc9f8 \uba54\ud2b8\ub9ad\uc774\ub098 \ub85c\uadf8 \uc624\ub958\uc5d0 \uc9d1\uc911\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. Kubelet\uc758 \uc804\uc1a1 \uc2dc\uac04\uc774 \ub354 \uc77c\ucc0d \ucd08\uacfc\ub41c \uac83\uc744 \ud655\uc778\ud588\uc744 \ub54c Kubelet\uc774 \uc804\uc1a1\ud560 \uc218 \uc788\ub294 \ucd08\ub2f9 \uc18d\ub3c4\ub97c \ub192\uc774\ub294 \ub4f1 \ubb34\uc791\uc704\ub85c \uc2dc\ub3c4\ud560 \uc218 \uc788\uc9c0\ub9cc, \uba3c\uc800 \ubc1c\uacac\ub41c \uc624\ub958\uc758 \ub2e4\uc6b4\uc2a4\ud2b8\ub9bc\uc5d0\uc11c \ubaa8\ub4e0 \uac83\uc744 \uc804\uccb4\uc801\uc73c\ub85c \uc0b4\ud3b4\ubcf4\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.\ubaa9\uc801\uc5d0 \ub9de\uac8c \ubcc0\uacbd\ud558\uace0 \ub370\uc774\ud130\ub97c \ubc14\ud0d5\uc73c\ub85c \ubcc0\uacbd\ud558\uc138\uc694.</p> <p>Kubelet\uc758 \ub2e4\uc6b4\uc2a4\ud2b8\ub9bc\uc740 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784 (\ud30c\ub4dc \uc624\ub958), EC2 API\uc640 \ud1b5\uc2e0\ud558\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \ub4dc\ub77c\uc774\ubc84(CSI), \ub124\ud2b8\uc6cc\ud06c \ub4dc\ub77c\uc774\ubc84(CNI) \uc640 \uac19\uc740 \ub370\ubaac\uc14b \ub4f1\uc785\ub2c8\ub2e4. </p> <p></p> <p>Kubelet\uc774 \ub7f0\ud0c0\uc784\uc744 \ub530\ub77c\uac00\uc9c0 \ubabb\ud558\ub294 \uc774\uc804 \uc608\ub97c \uacc4\uc18d\ud574 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \ub178\ub4dc\ub97c \ub108\ubb34 \uc870\ubc00\ud558\uac8c \ube48\ud329\ud558\uba74 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. </p> <p></p> <p>\uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc801\ud569\ud55c \ub178\ub4dc \ud06c\uae30\ub97c \uc124\uacc4\ud560 \ub54c \uc774\ub7f0 \uc2e0\ud638\ub294 \uc2dc\uc2a4\ud15c\uc5d0 \ubd88\ud544\uc694\ud55c \uc555\ub825\uc744 \uac00\ud558\uc5ec \uaddc\ubaa8\uc640 \uc131\ub2a5\uc744 \ubaa8\ub450 \uc81c\ud55c\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \uac04\uacfc\ud558\uae30 \uc26c\uc6b4 \uc2e0\ud638\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/scaling_theory/#_8","title":"\ubd88\ud544\uc694\ud55c \uc624\ub958\ub85c \uc778\ud55c \ube44\uc6a9","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864\ub7ec\ub294 \uc624\ub958 \uc0c1\ud669\uc774 \ubc1c\uc0dd\ud560 \ub54c \uc7ac\uc2dc\ub3c4\ud558\ub294 \ub370 \ud0c1\uc6d4\ud558\uc9c0\ub9cc, \uc5ec\uae30\uc5d0\ub294 \ube44\uc6a9\uc774 \ub530\ub985\ub2c8\ub2e4. \uc774\ub7f0 \uc7ac\uc2dc\ub3c4\ub294 Kube \ucee8\ud2b8\ub864\ub7ec \ub9e4\ub2c8\uc800\uc640 \uac19\uc740 \uad6c\uc131 \uc694\uc18c\uc5d0 \ub300\ud55c \uc555\ub825\uc744 \uac00\uc911\uc2dc\ud0ac \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uaddc\ubaa8 \ud14c\uc2a4\ud2b8\uc758 \uc911\uc694\ud55c \ubd80\ubd84\uc740 \uc774\ub7f0 \uc624\ub958\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p> <p>\ubc1c\uc0dd\ud558\ub294 \uc624\ub958\uac00 \uc801\uc744\uc218\ub85d \uc2dc\uc2a4\ud15c\uc5d0\uc11c \ubb38\uc81c\ub97c \ub354 \uc27d\uac8c \ucc3e\uc544\ub0bc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc8fc\uc694 \uc791\uc5c5 (\uc608: \uc5c5\uadf8\ub808\uc774\ub4dc) \uc804\uc5d0 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc624\ub958\uac00 \uc5c6\ub294\uc9c0 \uc815\uae30\uc801\uc73c\ub85c \ud655\uc778\ud568\uc73c\ub85c\uc368 \uc608\uc0c1\uce58 \ubabb\ud55c \uc774\ubca4\ud2b8 \ubc1c\uc0dd \uc2dc \ub85c\uadf8 \ubb38\uc81c \ud574\uacb0\uc744 \uac04\uc18c\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/scaling_theory/#_9","title":"\uc2dc\uc57c \ub113\ud788\uae30","text":"<p>1,000\uac1c\uc758 \ub178\ub4dc\uac00 \uc788\ub294 \ub300\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c\ub294 \ubcd1\ubaa9 \ud604\uc0c1\uc744 \uac1c\ubcc4\uc801\uc73c\ub85c \ucc3e\uc544\ubcf4\uace0 \uc2f6\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. PromQL\uc5d0\uc11c\ub294 topk\ub77c\ub294 \ud568\uc218\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub370\uc774\ud130 \uc9d1\ud569\uc5d0\uc11c \uac00\uc7a5 \ub192\uc740 \uac12\uc744 \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. K\ub294 \ubcc0\uc218\ub85c, \uc6d0\ud558\ub294 \ud56d\ubaa9 \uc218\ub97c \ubc30\uce58\ud569\ub2c8\ub2e4.\uc5ec\uae30\uc11c\ub294 \uc138 \uac1c\uc758 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc758 \ubaa8\ub4e0 Kubelet\uc774 \ud3ec\ud654 \uc0c1\ud0dc\uc778\uc9c0 \uc5ec\ubd80\ub97c \ud30c\uc545\ud569\ub2c8\ub2e4.\uc9c0\uae08\uae4c\uc9c0 \ub808\uc774\ud134\uc2dc\ub97c \uc0b4\ud3b4\ubcf4\uc558\ub294\ub370, \uc774\uc81c Kubelet\uc774 \uc774\ubca4\ud2b8\ub97c \uc0ad\uc81c\ud558\ub294\uc9c0 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4. </p> <pre><code>topk(3, increase(kubelet_pleg_discard_events{}[$__rate_interval]))\n</code></pre> <p>\uc774 \ubb38\uc7a5\uc744 \ubd84\ud574\ud574 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uadf8\ub77c\ud30c\ub098 \ubcc0\uc218 <code>$__rate_interval</code>\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud544\uc694\ud55c \ub124 \uac1c\uc758 \uc0d8\ud50c\uc744 \uc5bb\uc744 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ubcf5\uc7a1\ud55c \ubaa8\ub2c8\ud130\ub9c1 \uc8fc\uc81c\ub97c \uac04\ub2e8\ud55c \ubcc0\uc218\ub85c \ucc98\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li><code>topk</code>\ub294 \uc0c1\uc704 \uacb0\uacfc\ub9cc \ud45c\uc2dc\ud558\uba70 \uc22b\uc790 3\uc740 \uacb0\uacfc\ub97c \uc138 \uac1c\ub85c \uc81c\ud55c\ud569\ub2c8\ub2e4. \uc774\ub294 \ud074\ub7ec\uc2a4\ud130 \uc804\uccb4 \uc9c0\ud45c\uc5d0 \uc720\uc6a9\ud55c \ud568\uc218\uc785\ub2c8\ub2e4.</li> <li><code>{}</code>\ub294  \ud544\ud130\uac00 \uc5c6\uc74c\uc744 \ub098\ud0c0\ub0c5\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c \uc2a4\ud06c\ub798\ud551 \uaddc\uce59\uc758 \uc791\uc5c5 \uc774\ub984\uc744 \uc785\ub825\ud558\uaca0\uc9c0\ub9cc, \uc774\ub7f0 \uc774\ub984\uc774 \ub2e4\uc591\ud558\uae30 \ub54c\ubb38\uc5d0 \ube44\uc6cc\ub461\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/scalability/docs/scaling_theory/#_10","title":"\ubb38\uc81c\ub97c \ubc18\uc73c\ub85c \ub098\ub204\uae30","text":"<p>\uc2dc\uc2a4\ud15c\uc758 \ubcd1\ubaa9 \ud604\uc0c1\uc744 \ud574\uacb0\ud558\uae30 \uc704\ud574 \uc5c5\uc2a4\ud2b8\ub9bc \ub610\ub294 \ub2e4\uc6b4\uc2a4\ud2b8\ub9bc\uc5d0 \ubb38\uc81c\uac00 \uc788\uc74c\uc744 \ubcf4\uc5ec\uc8fc\ub294 \uc9c0\ud45c\ub97c \ucc3e\ub294 \uc811\uadfc \ubc29\uc2dd\uc744 \ucde8\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ubb38\uc81c\ub97c \ubc18\uc73c\ub85c \ub098\ub20c \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ub610\ud55c \uc774\ub294 \uc9c0\ud45c \ub370\uc774\ud130\ub97c \ud45c\uc2dc\ud558\ub294 \ubc29\uc2dd\uc758 \ud575\uc2ec \uc6d0\uce59\uc774\uae30\ub3c4 \ud569\ub2c8\ub2e4. </p> <p>\uc774 \ud504\ub85c\uc138\uc2a4\ubd80\ud130 \uc2dc\uc791\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. API \uc11c\ubc84\ub97c \uc0ac\uc6a9\ud558\uba74 \ud074\ub77c\uc774\uc5b8\ud2b8 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774\ub098 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \ubb38\uc81c\uac00 \uc788\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/","title":"\uc6cc\ud06c\ub85c\ub4dc","text":"<p>\uc6cc\ud06c\ub85c\ub4dc\ub294 \ud074\ub7ec\uc2a4\ud130\ub97c \ud655\uc7a5\ud560 \uc218 \uc788\ub294 \uaddc\ubaa8\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce69\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \ub9ce\uc774 \uc0ac\uc6a9\ud558\ub294 \uc6cc\ud06c\ub85c\ub4dc\ub294 \ub2e8\uc77c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ubcf4\uc720\ud560 \uc218 \uc788\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc758 \ucd1d\ub7c9\uc744 \uc81c\ud55c\ud558\uc9c0\ub9cc, \ubd80\ud558\ub97c \uc904\uc774\uae30 \uc704\ud574 \ubcc0\uacbd\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \uae30\ubcf8\uac12\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 \uc6cc\ud06c\ub85c\ub4dc\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc640 \ud1b5\ud569\ub418\ub294 \uae30\ub2a5(\uc608: Secrets \ubc0f ServiceAccount)\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc9c0\ub9cc, \uc774\ub7f0 \uae30\ub2a5\uc774 \ud56d\uc0c1 \ud544\uc694\ud55c \uac83\uc740 \uc544\ub2c8\ubbc0\ub85c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0 \ube44\ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4.\uc6cc\ud06c\ub85c\ub4dc \uc561\uc138\uc2a4\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \ub300\ud55c \uc885\uc18d\uc131\uc744 \uc81c\ud55c\ud558\uba74 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uc6cc\ud06c\ub85c\ub4dc \uc218\uac00 \uc99d\uac00\ud558\uace0 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub300\ud55c \ubd88\ud544\uc694\ud55c \uc561\uc138\uc2a4\ub97c \uc81c\uac70\ud558\uace0 \ucd5c\uc18c \uad8c\ud55c \uad00\ud589\uc744 \uad6c\ud604\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc758 \ubcf4\uc548\uc744 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840\ub97c \ucc38\uace0\ud558\uc138\uc694.</p>"},{"location":"ko/scalability/docs/workloads/#ipv6","title":"\ud30c\ub4dc \ub124\ud2b8\uc6cc\ud0b9\uc5d0 IPv6 \uc0ac\uc6a9\ud558\uae30","text":"<p>VPC\ub97c IPv4\uc5d0\uc11c IPv6\uc73c\ub85c \uc804\ud658\ud560 \uc218 \uc5c6\uc73c\ubbc0\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uae30 \uc804\uc5d0 IPv6\ub97c \ud65c\uc131\ud654\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. \ub2e4\ub9cc VPC\uc5d0\uc11c IPv6\ub97c \ud65c\uc131\ud654\ud55c\ub2e4\uace0 \ud574\uc11c \ubc18\ub4dc\uc2dc \uc0ac\uc6a9\ud574\uc57c \ud558\ub294 \uac83\uc740 \uc544\ub2c8\uba70, \ud30c\ub4dc \ubc0f \uc11c\ube44\uc2a4\uac00 IPv6\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0\uc5d0\ub3c4 IPv4 \uc8fc\uc18c\ub97c \uc624\uac00\ub294 \ud2b8\ub798\ud53d\uc744 \ub77c\uc6b0\ud305\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 EKS \ub124\ud2b8\uc6cc\ud0b9 \ubaa8\ubc94 \uc0ac\ub840\ub97c \ucc38\uace0\ud558\uc138\uc694.</p> <p>\ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c IPv6 \uc0ac\uc6a9\ud558\uae30 \ud29c\ud1a0\ub9ac\uc5bc\ub97c \uc0ac\uc6a9\ud558\uba74 \uac00\uc7a5 \uc77c\ubc18\uc801\uc778 \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc6cc\ud06c\ub85c\ub4dc \ud655\uc7a5 \uc81c\ud55c\uc744 \ud53c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. IPv6\ub294 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uc8fc\uc18c\uac00 \uc5c6\uc5b4 \ud30c\ub4dc\uc640 \ub178\ub4dc\ub97c \uc0dd\uc131\ud560 \uc218 \uc5c6\ub294 IP \uc8fc\uc18c \uace0\uac08\uc744 \ubc29\uc9c0\ud569\ub2c8\ub2e4. \ub610\ud55c \ub178\ub4dc\ub2f9 ENI \uc5b4\ud0dc\uce58\uba3c\ud2b8 \uc218\ub97c \uc904\uc5ec \ud30c\ub4dc\uac00 IP \uc8fc\uc18c\ub97c \ub354 \ube60\ub974\uac8c \uc218\uc2e0\ud558\ubbc0\ub85c \ub178\ub4dc\ub2f9 \uc131\ub2a5\ub3c4 \uac1c\uc120\ub418\uc5c8\uc2b5\ub2c8\ub2e4. VPC CNI\uc758 IPv4 Prefix \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc720\uc0ac\ud55c \ub178\ub4dc \uc131\ub2a5\uc744 \uc5bb\uc744 \uc218 \uc788\uc9c0\ub9cc, \uc5ec\uc804\ud788 VPC\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 IP \uc8fc\uc18c\uac00 \ucda9\ubd84\ud55c\uc9c0 \ud655\uc778\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/#_2","title":"\ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub2f9 \uc11c\ube44\uc2a4 \uc218 \uc81c\ud55c","text":"<p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ucd5c\ub300 \uc11c\ube44\uc2a4 \uc218\ub294 5,000\uac1c\uc774\uace0 \ud074\ub7ec\uc2a4\ud130\uc758 \ucd5c\ub300 \uc11c\ube44\uc2a4 \uc218\ub294 10,000\uac1c \uc785\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\uc640 \uc11c\ube44\uc2a4\ub97c \uad6c\uc131\ud558\uace0, \uc131\ub2a5\uc744 \ub192\uc774\uace0, \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ubc94\uc704 \ub9ac\uc18c\uc2a4\uac00 \uc5f0\uc1c4\uc801\uc73c\ub85c \uc601\ud5a5\uc744 \ubc1b\uc9c0 \uc54a\ub3c4\ub85d \ud558\ub824\uba74 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub2f9 \uc11c\ube44\uc2a4 \uc218\ub97c 500\uac1c\ub85c \uc81c\ud55c\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>kube-proxy\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\ub2f9 \uc0dd\uc131\ub418\ub294 IP \ud14c\uc774\ube14 \uaddc\uce59\uc758 \uc218\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \ucd1d \uc11c\ube44\uc2a4 \uc218\uc5d0 \ub530\ub77c \uc99d\uac00\ud569\ub2c8\ub2e4.\uc218\ucc9c \uac1c\uc758 IP \ud14c\uc774\ube14 \uaddc\uce59\uc744 \uc0dd\uc131\ud558\uace0 \uc774\ub7f0 \uaddc\uce59\uc744 \ud1b5\ud574 \ud328\ud0b7\uc744 \ub77c\uc6b0\ud305\ud558\uba74 \ub178\ub4dc\uc758 \uc131\ub2a5\uc774 \uc800\ud558\ub418\uace0 \ub124\ud2b8\uc6cc\ud06c \uc9c0\uc5f0 \uc2dc\uac04\uc774 \ub298\uc5b4\ub0a9\ub2c8\ub2e4.</p> <p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub2f9 \uc11c\ube44\uc2a4 \uc218\uac00 500\uac1c \ubbf8\ub9cc\uc778 \uacbd\uc6b0 \ub2e8\uc77c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud658\uacbd\uc744 \ud3ec\ud568\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624. \uc774\ub807\uac8c \ud558\uba74 \uc11c\ube44\uc2a4 \uac80\uc0c9 \uc81c\ud55c\uc744 \ud53c\ud560 \uc218 \uc788\uc744 \ub9cc\ud07c \uc11c\ube44\uc2a4 \uac80\uc0c9 \ud06c\uae30\uac00 \uc791\uc544\uc9c0\uace0 \uc11c\ube44\uc2a4 \uc774\ub984 \ucda9\ub3cc\uc744 \ubc29\uc9c0\ud558\ub294 \ub370\ub3c4 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud658\uacbd(\uc608: dev, test, prod) \uc740 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub300\uc2e0 \ubcc4\ub3c4\uc758 EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/#elastic-load-balancer","title":"Elastic Load Balancer \ud560\ub2f9\ub7c9 \uc774\ud574","text":"<p>\uc11c\ube44\uc2a4\ub97c \uc0dd\uc131\ud560 \ub54c \uc0ac\uc6a9\ud560 \ub85c\ub4dc \ubc38\ub7f0\uc2f1 \uc720\ud615(\uc608: \ub124\ud2b8\uc6cc\ud06c \ub85c\ub4dc\ubc38\ub7f0\uc11c (NLB) \ub610\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub85c\ub4dc\ubc38\ub7f0\uc11c (ALB)) \ub97c \uace0\ub824\ud558\uc138\uc694. \uac01 \ub85c\ub4dc\ubc38\ub7f0\uc11c \uc720\ud615\uc740 \uc11c\ub85c \ub2e4\ub978 \uae30\ub2a5\uc744 \uc81c\uacf5\ud558\uba70 \ud560\ub2f9\ub7c9\uc774 \ub2e4\ub985\ub2c8\ub2e4. \uae30\ubcf8 \ud560\ub2f9\ub7c9 \uc911 \uc77c\ubd80\ub294 \uc870\uc815\ud560 \uc218 \uc788\uc9c0\ub9cc \uc77c\ubd80 \ud560\ub2f9\ub7c9 \ucd5c\ub300\uac12\uc740 \ubcc0\uacbd\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uacc4\uc815 \ud560\ub2f9\ub7c9 \ubc0f \uc0ac\uc6a9\ub7c9\uc744 \ubcf4\ub824\uba74 AWS \ucf58\uc194\uc758 \uc11c\ube44\uc2a4 \ud560\ub2f9\ub7c9 \ub300\uc2dc\ubcf4\ub4dc\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>\uc608\ub97c \ub4e4\uc5b4, \uae30\ubcf8 ALB \ubaa9\ud45c\ub294 1000\uc785\ub2c8\ub2e4. \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uac00 1,000\uac1c\uac00 \ub118\ub294 \uc11c\ube44\uc2a4\uac00 \uc788\ub294 \uacbd\uc6b0 \ud560\ub2f9\ub7c9\uc744 \ub298\ub9ac\uac70\ub098 \uc11c\ube44\uc2a4\ub97c \uc5ec\ub7ec ALB\ub85c \ubd84\ud560\ud558\uac70\ub098 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc778\uadf8\ub808\uc2a4(Ingress)\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uae30\ubcf8 NLB \ub300\uc0c1\uc740 3000\uc774\uc9c0\ub9cc AZ\ub2f9 500\uac1c \ub300\uc0c1\uc73c\ub85c \uc81c\ud55c\ub429\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c NLB \uc11c\ube44\uc2a4\uc5d0 \ub300\ud574 500\uac1c \uc774\uc0c1\uc758 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 \uc5ec\ub7ec AZ\ub97c \uc0ac\uc6a9\ud558\uac70\ub098 \ud560\ub2f9\ub7c9 \ud55c\ub3c4 \uc99d\uac00\ub97c \uc694\uccad\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc11c\ube44\uc2a4\uc5d0 \uc5f0\uacb0\ub41c \ub85c\ub4dc\ubc38\ub7f0\uc11c\ub97c \uc0ac\uc6a9\ud558\ub294 \ub300\uc2e0 \uc778\uadf8\ub808\uc2a4 \ucee8\ud2b8\ub864\ub7ec \ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. AWS Load Balancer Controller\ub294 \uc218\uc2e0 \ub9ac\uc18c\uc2a4\uc6a9 ALB\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc9c0\ub9cc, \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc804\uc6a9 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc2e4\ud589\ud558\ub294 \uac83\ub3c4 \uace0\ub824\ud574 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ud074\ub7ec\uc2a4\ud130 \ub0b4 \uc218\uc2e0 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uba74 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc5ed\ubc29\ud5a5 \ud504\ub85d\uc2dc\ub97c \uc2e4\ud589\ud558\uc5ec \ub2e8\uc77c \ub85c\ub4dc\ubc38\ub7f0\uc11c\uc5d0\uc11c \uc5ec\ub7ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4\ub97c \ub178\ucd9c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud2b8\ub864\ub7ec\ub294 Gateway API \uc9c0\uc6d0\uacfc \uac19\uc740 \ub2e4\uc591\ud55c \uae30\ub2a5\uc744 \uc81c\uacf5\ud558\ubbc0\ub85c \uc6cc\ud06c\ub85c\ub4dc\uc758 \uc218\uc640 \uaddc\ubaa8\uc5d0 \ub530\ub77c \uc774\uc810\uc774 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/#route-53-global-accelerator-cloudfront","title":"Route 53, Global Accelerator, \ub610\ub294 CloudFront \uc0ac\uc6a9\ud558\uae30","text":"<p>\uc5ec\ub7ec \ub85c\ub4dc\ubc38\ub7f0\uc11c\ub97c \uc0ac\uc6a9\ud558\ub294 \uc11c\ube44\uc2a4\ub97c \ub2e8\uc77c \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub85c \uc0ac\uc6a9\ud558\ub824\uba74 Amazon CloudFront, AWS Global Accelerator \ub610\ub294 Amazon Route 53\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubaa8\ub4e0 \ub85c\ub4dc\ubc38\ub7f0\uc11c\ub97c \ub2e8\uc77c \uace0\uac1d \ub300\uc0c1 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub85c \ub178\ucd9c\ud574\uc57c \ud569\ub2c8\ub2e4. \uac01 \uc635\uc158\uc5d0\ub294 \uc11c\ub85c \ub2e4\ub978 \uc774\uc810\uc774 \uc788\uc73c\uba70 \ud544\uc694\uc5d0 \ub530\ub77c \uac1c\ubcc4\uc801\uc73c\ub85c \ub610\ub294 \ud568\uaed8 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Route 53\uc740 \uacf5\ud1b5 \uc774\ub984\uc73c\ub85c \uc5ec\ub7ec \ub85c\ub4dc\ubc38\ub7f0\uc11c\ub97c \ub178\ucd9c\ud560 \uc218 \uc788\uc73c\uba70 \ud560\ub2f9\ub41c \uac00\uc911\uce58\uc5d0 \ub530\ub77c \uac01 \ub85c\ub4dc\ubc38\ub7f0\uc11c\uc5d0 \ud2b8\ub798\ud53d\uc744 \uc804\uc1a1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. DNS \uac00\uc911\uce58\uc124\uba85\uc11c\uc5d0 \uc790\uc138\ud55c \ub0b4\uc6a9\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc73c\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc678\ubd80 DNS \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\ub97c \uad6c\ud604\ud558\ub294 \ubc29\ubc95\uc740 AWS Load Balancer Controller \uc124\uba85\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Global Accelerator\ud130\ub294 \uc694\uccad IP \uc8fc\uc18c\ub97c \uae30\ubc18\uc73c\ub85c \uac00\uc7a5 \uac00\uae4c\uc6b4 \uc9c0\uc5ed\uc73c\ub85c \uc6cc\ud06c\ub85c\ub4dc\ub97c \ub77c\uc6b0\ud305\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc5ec\ub7ec \uc9c0\uc5ed\uc5d0 \ubc30\ud3ec\ub418\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc720\uc6a9\ud560 \uc218 \uc788\uc9c0\ub9cc \ub2e8\uc77c \uc9c0\uc5ed\uc758 \ub2e8\uc77c \ud074\ub7ec\uc2a4\ud130\ub85c\uc758 \ub77c\uc6b0\ud305\uc744 \uac1c\uc120\ud558\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. Route 53\uc744 Global Accelerator\ud130\uc640 \ud568\uaed8 \uc0ac\uc6a9\ud558\uba74 \uac00\uc6a9\uc601\uc5ed\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0 \uc0c1\ud0dc \uc810\uac80 \ubc0f \uc790\ub3d9 \uc7a5\uc560 \uc870\uce58\uc640 \uac19\uc740 \ucd94\uac00\uc801\uc778 \uc774\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4. Route 53\uacfc \ud568\uaed8 Global Accelerator\ud130\ub97c \uc0ac\uc6a9\ud558\ub294 \uc608\ub294 \uc774 \ube14\ub85c\uadf8 \uac8c\uc2dc\ubb3c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>CloudFront\ub294 Route 53 \ubc0f Global Accelerator\uc640 \ud568\uaed8 \uc0ac\uc6a9\ud558\uac70\ub098 \ub2e8\ub3c5\uc73c\ub85c \ud2b8\ub798\ud53d\uc744 \uc5ec\ub7ec \ubaa9\uc801\uc9c0\ub85c \ub77c\uc6b0\ud305\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CloudFront\ub294 \uc624\ub9ac\uc9c4 \uc18c\uc2a4\uc5d0\uc11c \uc81c\uacf5\ub418\ub294 \uc790\uc0b0\uc744 \uce90\uc2dc\ud558\ubbc0\ub85c \uc81c\uacf5\ud558\ub294 \ub300\uc0c1\uc5d0 \ub530\ub77c \ub300\uc5ed\ud3ed \uc694\uad6c \uc0ac\ud56d\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/#endpoints-endpointslices","title":"\uc5d4\ub4dc\ud3ec\uc778\ud2b8(Endpoints) \ub300\uc2e0\uc5d0 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc2ac\ub77c\uc774\uc2a4(EndpointSlices) \uc0ac\uc6a9\ud558\uae30","text":"<p>\uc11c\ube44\uc2a4 \ub808\uc774\ube14\uacfc \uc77c\uce58\ud558\ub294 \ud30c\ub4dc\ub97c \ubc1c\uacac\ud560 \ub54c\ub294 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ub300\uc2e0 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc2ac\ub77c\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub294 \uc11c\ube44\uc2a4\ub97c \uc18c\uaddc\ubaa8\ub85c \ub178\ucd9c\ud560 \uc218 \uc788\ub294 \uac04\ub2e8\ud55c \ubc29\ubc95\uc774\uc5c8\uc9c0\ub9cc, \ub300\uaddc\ubaa8 \uc11c\ube44\uc2a4\uac00 \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ub418\uac70\ub098 \uc5c5\ub370\uc774\ud2b8\ub418\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0\uc11c \ub9ce\uc740 \ud2b8\ub798\ud53d\uc774 \ubc1c\uc0dd\ud569\ub2c8\ub2e4. \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc2ac\ub77c\uc774\uc2a4\uc5d0\ub294 \ud1a0\ud3f4\ub85c\uc9c0 \uc778\uc2dd \ud78c\ud2b8\uc640 \uac19\uc740 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc790\ub3d9 \uadf8\ub8f9\ud654 \uae30\ub2a5\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ubaa8\ub4e0 \ucee8\ud2b8\ub864\ub7ec\uac00 \uae30\ubcf8\uc801\uc73c\ub85c \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc2ac\ub77c\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc740 \uc544\ub2d9\ub2c8\ub2e4. \ucee8\ud2b8\ub864\ub7ec \uc124\uc815\uc744 \ud655\uc778\ud558\uace0 \ud544\uc694\ud55c \uacbd\uc6b0 \ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4. AWS Load Balancer Controller\uc758 \uacbd\uc6b0 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc2ac\ub77c\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 <code>--enable-endpoint-slices</code> \uc120\ud0dd\uc801 \ud50c\ub798\uadf8\ub97c \ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/#immutable-external","title":"\uac00\ub2a5\ud558\ub2e4\uba74 \ubcc0\uacbd \ubd88\uac00(immutable)\ud558\uace0 \uc678\ubd80(external) \uc2dc\ud06c\ub9bf \uc0ac\uc6a9\ud558\uae30","text":"<p>kubelet\uc740 \ud574\ub2f9 \ub178\ub4dc\uc758 \ud30c\ub4dc\uc5d0 \ub300\ud55c \ubcfc\ub968\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294 \uc2dc\ud06c\ub9bf\uc758 \ud604\uc7ac \ud0a4\uc640 \uac12\uc744 \uce90\uc2dc\uc5d0 \ubcf4\uad00\ud55c\ub2e4. kubelet\uc740 \uc2dc\ud06c\ub9bf\uc744 \uac10\uc2dc\ud558\uc5ec \ubcc0\uacbd \uc0ac\ud56d\uc744 \ud0d0\uc9c0\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uac00 \ud655\uc7a5\ub428\uc5d0 \ub530\ub77c \uc2dc\uacc4\uc758 \uc218\uac00 \uc99d\uac00\ud558\uba74 API \uc11c\ubc84 \uc131\ub2a5\uc5d0 \ubd80\uc815\uc801\uc778 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc2dc\ud06c\ub9bf\uc758 \uac10\uc2dc \uc218\ub97c \uc904\uc774\ub294 \ub450 \uac00\uc9c0 \uc804\ub7b5\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud560 \ud544\uc694\uac00 \uc5c6\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uacbd\uc6b0 AutoMountServiceAccountToken: false\ub97c \uc124\uc815\ud558\uc5ec \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uc2dc\ud06c\ub9bf \uc790\ub3d9 \ud0d1\uc7ac\ub97c \ube44\ud65c\uc131\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc554\ud638\uac00 \uc815\uc801\uc774\uc5b4\uc11c \ud5a5\ud6c4 \uc218\uc815\ub418\uc9c0 \uc54a\uc744 \uacbd\uc6b0 \uc554\ud638\ub97c \ubcc0\uacbd \ubd88\uac00\ub2a5\uc73c\ub85c \ud45c\uc2dc\ud558\uc2ed\uc2dc\uc624. kubelet\uc740 \ubcc0\uacbd \ubd88\uac00\ub2a5\ud55c \ube44\ubc00\uc5d0 \ub300\ud55c API \uac10\uc2dc \uae30\ub2a5\uc744 \uc720\uc9c0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</li> </ul> <p>\uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc744 \ud30c\ub4dc\uc5d0 \uc790\ub3d9\uc73c\ub85c \ub9c8\uc6b4\ud2b8\ud558\ub294 \uac83\uc744 \ube44\ud65c\uc131\ud654\ud558\ub824\uba74 \uc6cc\ud06c\ub85c\ub4dc\uc5d0\uc11c \ub2e4\uc74c \uc124\uc815\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud2b9\uc815 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 \uc774\ub7f0 \uc124\uc815\uc744 \uc7ac\uc815\uc758\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: app\nautomountServiceAccountToken: true\n</code></pre> <p>\ud074\ub7ec\uc2a4\ud130\uc758 \uc554\ud638 \uc218\uac00 \uc81c\ud55c\uc778 10,000\uac1c\ub97c \ucd08\uacfc\ud558\uae30 \uc804\uc5d0 \ubaa8\ub2c8\ud130\ub9c1\ud558\uc138\uc694. \ub2e4\uc74c \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc758 \ucd1d \uc554\ud638 \uc218\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \ubaa8\ub2c8\ud130\ub9c1 \ub3c4\uad6c\ub97c \ud1b5\ud574 \uc774 \ud55c\ub3c4\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>kubectl get secrets -A | wc -l\n</code></pre> <p>\uc774 \ud55c\ub3c4\uc5d0 \ub3c4\ub2ec\ud558\uae30 \uc804\uc5d0 \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\uc5d0\uac8c \uc54c\ub9ac\ub3c4\ub85d \ubaa8\ub2c8\ud130\ub9c1\uc744 \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4.Secrets Store CSI \ub4dc\ub77c\uc774\ubc84\uc640 \ud568\uaed8 AWS Key Management Service (AWS KMS) \ub610\ub294 Hashicorp Vault\uc640 \uac19\uc740 \uc678\ubd80 \ube44\ubc00 \uad00\ub9ac \uc635\uc158\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/scalability/docs/workloads/#_3","title":"\ubc30\ud3ec \uc774\ub825 \uc81c\ud55c","text":"<p>\ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc774\uc804 \uac1d\uccb4\uac00 \uacc4\uc18d \ucd94\uc801\ub418\ubbc0\ub85c \ud30c\ub4dc\ub97c \uc0dd\uc131, \uc5c5\ub370\uc774\ud2b8 \ub610\ub294 \uc0ad\uc81c\ud560 \ub54c \uc18d\ub3c4\uac00 \ub290\ub824\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 <code>therevisionHistoryLimit</code>\uc744 \uc904\uc774\uba74 \uad6c\ud615 \ub808\ud50c\ub9ac\uce74\uc14b\uc744 \uc815\ub9ac\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864\ub7ec \ub9e4\ub2c8\uc800\uac00 \ucd94\uc801\ud558\ub294 \uc624\ube0c\uc81d\ud2b8\uc758 \ucd1d\ub7c9\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \uae30\ubcf8 \uae30\ub85d \ud55c\ub3c4\ub294 10\uac1c\uc785\ub2c8\ub2e4.</p> <p>\ud074\ub7ec\uc2a4\ud130\uac00 CronJobs\ub098 \ub2e4\ub978 \uba54\ucee4\ub2c8\uc998\uc744 \ud1b5\ud574 \ub9ce\uc740 \uc218\uc758 \uc791\uc5c5 \uac1c\uccb4\ub97c \uc0dd\uc131\ud558\ub294 \uacbd\uc6b0, <code>TTLSecondsFinished</code> \uc124\uc815\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc758 \uc624\ub798\ub41c \ud30c\ub4dc\ub97c \uc790\ub3d9\uc73c\ub85c \uc815\ub9ac\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc9c0\uc815\ub41c \uc2dc\uac04\uc774 \uc9c0\ub098\uba74 \uc131\uacf5\uc801\uc73c\ub85c \uc2e4\ud589\ub41c \uc791\uc5c5\uc774 \uc791\uc5c5 \uae30\ub85d\uc5d0\uc11c \uc81c\uac70\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/#enableservicelinks","title":"enableServiceLinks\ub97c \uae30\ubcf8\uc73c\ub85c \ube44\ud65c\uc131\ud654\ud558\uae30","text":"<p>\ud30c\ub4dc\uac00 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub420 \ub54c, kubelet\uc740 \uac01 \ud65c\uc131 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \ud658\uacbd \ubcc0\uc218 \uc138\ud2b8\ub97c \ucd94\uac00\ud569\ub2c8\ub2e4. \ub9ac\ub205\uc2a4 \ud504\ub85c\uc138\uc2a4\uc5d0\ub294 \ud658\uacbd\uc5d0 \ub9de\ub294 \ucd5c\ub300 \ud06c\uae30\uac00 \uc788\uc73c\uba70 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \uc11c\ube44\uc2a4\uac00 \ub108\ubb34 \ub9ce\uc73c\uba74 \uc774 \ud06c\uae30\uc5d0 \ub3c4\ub2ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub2f9 \uc11c\ube44\uc2a4 \uc218\ub294 5,000\uac1c\ub97c \ucd08\uacfc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uadf8 \uc774\ud6c4\uc5d0\ub294 \uc11c\ube44\uc2a4 \ud658\uacbd \ubcc0\uc218 \uc218\uac00 \uc178 \ud55c\ub3c4\ub97c \ucd08\uacfc\ud558\uc5ec \uc2dc\uc791 \uc2dc \ud30c\ub4dc\uac00 \ud06c\ub798\uc2dc\ub97c \uc77c\uc73c\ud0a4\uac8c \ub429\ub2c8\ub2e4. </p> <p>\ud30c\ub4dc\uac00 \uc11c\ube44\uc2a4 \uac80\uc0c9\uc5d0 \uc11c\ube44\uc2a4 \ud658\uacbd \ubcc0\uc218\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc544\uc57c \ud558\ub294 \ub2e4\ub978 \uc774\uc720\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ud658\uacbd \ubcc0\uc218 \uc774\ub984 \ucda9\ub3cc, \uc11c\ube44\uc2a4 \uc774\ub984 \uc720\ucd9c, \uc804\uccb4 \ud658\uacbd \ud06c\uae30 \ub4f1\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uac80\uc0c9\ud558\ub824\uba74 CoreDNS\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/scalability/docs/workloads/#webhook","title":"\ub9ac\uc18c\uc2a4\ub2f9 \ub3d9\uc801 \uc5b4\ub4dc\ubbf8\uc158 \uc6f9\ud6c5(Webhook) \uc81c\ud55c\ud558\uae30","text":"<p>Dynamic Admission Webhooks\uc5d0\ub294 \uc5b4\ub4dc\ubbf8\uc158 \uc6f9\ud6c5\uacfc \ubba4\ud14c\uc774\ud305(Mutating) \uc6f9\ud6c5\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \uc18d\ud558\uc9c0 \uc54a\ub294 API \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub85c, \ub9ac\uc18c\uc2a4\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub85c \uc804\uc1a1\ub420 \ub54c \uc21c\uc11c\ub300\ub85c \ud638\ucd9c\ub429\ub2c8\ub2e4. \uac01 \uc6f9\ud6c5\uc758 \uae30\ubcf8 \uc81c\ud55c \uc2dc\uac04\uc740 10\ucd08\uc774\uba70, \uc6f9\ud6c5\uc774 \uc5ec\ub7ec \uac1c \uc788\uac70\ub098 \uc81c\ud55c \uc2dc\uac04\uc774 \ucd08\uacfc\ub41c \uacbd\uc6b0 API \uc694\uccad\uc5d0 \uac78\ub9ac\ub294 \uc2dc\uac04\uc774 \ub298\uc5b4\ub0a0 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud2b9\ud788 \uac00\uc6a9\uc601\uc5ed \uc7a5\uc560 \ubc1c\uc0dd \uc2dc \uc6f9\ud6c5\uc758 \uac00\uc6a9\uc131\uc774 \ub192\uc740\uc9c0 \ud655\uc778\ud558\uace0 FailurePolicy\uac00 \ub9ac\uc18c\uc2a4\ub97c \uac70\ubd80\ud558\uac70\ub098 \uc2e4\ud328\ub97c \ubb34\uc2dc\ud558\ub3c4\ub85d \uc801\uc808\ud558\uac8c \uc124\uc815\ub418\uc5b4 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uc138\uc694. --dry-run kubectl \uba85\ub839\uc774 \uc6f9\ud6c5\uc744 \uc6b0\ud68c\ud558\ub3c4\ub85d \ud5c8\uc6a9\ud558\uc5ec \ud544\uc694\ud558\uc9c0 \uc54a\uc744 \ub54c\ub294 \uc6f9\ud6c5\uc744 \ud638\ucd9c\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624.</p> <pre><code>apiVersion: admission.k8s.io/v1\nkind: AdmissionReview\nrequest:\n  dryRun: False\n</code></pre> <p>\uc6f9\ud6c5\ub97c \ubcc0\uacbd\ud558\uba74 \ub9ac\uc18c\uc2a4\ub97c \uc790\uc8fc \uc5f0\uc18d\uc801\uc73c\ub85c \uc218\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubba4\ud14c\uc774\ud305 \uc6f9\ud6c5\uc774 5\uac1c \uc788\uace0 \ub9ac\uc18c\uc2a4 50\uac1c\ub97c \ubc30\ud3ec\ud558\uba74 \uc218\uc815\ub41c \ub9ac\uc18c\uc2a4\uc758 \uc774\uc804 \ubc84\uc804\uc744 \uc81c\uac70\ud558\uae30 \uc704\ud574 5\ubd84\ub9c8\ub2e4 \ucef4\ud329\uc158\uc774 \uc2e4\ud589\ub420 \ub54c\uae4c\uc9c0 etcd\ub294 \uac01 \ub9ac\uc18c\uc2a4\uc758 \ubaa8\ub4e0 \ubc84\uc804\uc744 \uc800\uc7a5\ud569\ub2c8\ub2e4. \uc774 \uc2dc\ub098\ub9ac\uc624\uc5d0\uc11c etcd\uac00 \ub300\uccb4\ub41c \ub9ac\uc18c\uc2a4\ub97c \uc81c\uac70\ud558\uba74 etcd\uc5d0\uc11c 200\uac1c\uc758 \ub9ac\uc18c\uc2a4 \ubc84\uc804\uc774 \uc81c\uac70\ub418\uba70 \ub9ac\uc18c\uc2a4 \ud06c\uae30\uc5d0 \ub530\ub77c 15\ubd84\ub9c8\ub2e4 \uc870\uac01 \ubaa8\uc74c\uc774 \uc2e4\ud589\ub420 \ub54c\uae4c\uc9c0 etcd \ud638\uc2a4\ud2b8\uc5d0\uc11c \uc0c1\ub2f9\ud55c \uacf5\uac04\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774\ub7f0 \uc870\uac01 \ubaa8\uc74c(defragmentation)\uc73c\ub85c \uc778\ud574 etcd\uac00 \uc77c\uc2dc \uc911\uc9c0\ub418\uc5b4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \ubc0f \ucee8\ud2b8\ub864\ub7ec\uc5d0 \ub2e4\ub978 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub300\uaddc\ubaa8 \ub9ac\uc18c\uc2a4\ub97c \uc790\uc8fc \uc218\uc815\ud558\uac70\ub098 \uc218\ubc31 \uac1c\uc758 \ub9ac\uc18c\uc2a4\ub97c \uc21c\uc2dd\uac04\uc5d0 \uc5f0\uc18d\ud574\uc11c \uc218\uc815\ud558\ub294 \uac83\uc740 \ud53c\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/","title":"Amazon EKS \ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc","text":"<p>\uc774 \uac00\uc774\ub4dc\ub294 \uc704\ud5d8 \ud3c9\uac00 \ubc0f \uc644\ud654 \uc804\ub7b5\uc744 \ud1b5\ud574 \ube44\uc988\ub2c8\uc2a4 \uac00\uce58\ub97c \uc81c\uacf5\ud558\ub294 \ub3d9\uc2dc\uc5d0 EKS\uc5d0 \uc758\uc874\ud558\ub294 \uc815\ubcf4, \uc2dc\uc2a4\ud15c \ubc0f \uc790\uc0b0\uc744 \ubcf4\ud638\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc870\uc5b8\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc758 \uc9c0\uce68\uc740 \uace0\uac1d\uc774 \ubaa8\ubc94 \uc0ac\ub840\uc5d0 \ub530\ub77c EKS\ub97c \uad6c\ud604\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub418\ub3c4\ub85d AWS\uc5d0\uc11c \uac8c\uc2dc\ud558\ub294 \uc77c\ub828\uc758 \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc \uc911 \uc77c\ubd80\uc785\ub2c8\ub2e4. \uc131\ub2a5, \uc6b4\uc601 \uc6b0\uc218\uc131, \ube44\uc6a9 \ucd5c\uc801\ud654 \ubc0f \uc548\uc815\uc131\uc5d0 \ub300\ud55c \uac00\uc774\ub4dc\ub294 \uc55e\uc73c\ub85c \uba87 \uac1c\uc6d4 \ub0b4\uc5d0 \uc81c\uacf5\ub420 \uc608\uc815\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/#_1","title":"\uc774 \uac00\uc774\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95","text":"<p>\uc774 \uac00\uc774\ub4dc\ub294 EKS \ud074\ub7ec\uc2a4\ud130\uc640 \ud074\ub7ec\uc2a4\ud130\uac00 \uc9c0\uc6d0\ud558\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub300\ud55c \ubcf4\uc548 \uc81c\uc5b4\uc758 \ud6a8\uacfc\ub97c \uad6c\ud604\ud558\uace0 \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \ucc45\uc784\uc774 \uc788\ub294 \ubcf4\uc548 \uc2e4\ubb34\uc790\ub97c \ub300\uc0c1\uc73c\ub85c \ud569\ub2c8\ub2e4. \uac00\uc774\ub4dc\ub294 \ub354 \uc27d\uac8c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ub2e4\uc591\ud55c \uc8fc\uc81c \uc601\uc5ed\uc73c\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uac01 \uc8fc\uc81c\ub294 \uac04\ub7b5\ud55c \uac1c\uc694\ub85c \uc2dc\uc791\ud558\uc5ec EKS \ud074\ub7ec\uc2a4\ud130 \ubcf4\uc548\uc744 \uc704\ud55c \uad8c\uc7a5 \uc0ac\ud56d \ubc0f \ubaa8\ubc94 \uc0ac\ub840 \ubaa9\ub85d\uc774 \uc774\uc5b4\uc9d1\ub2c8\ub2e4. \uc8fc\uc81c\ub294 \ud2b9\uc815 \uc21c\uc11c\ub85c \uc77d\uc744 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/#_2","title":"\uacf5\ub3d9 \ucc45\uc784 \ubaa8\ub378\uc5d0 \ub300\ud55c \uc774\ud574","text":"<p>\ubcf4\uc548 \ubc0f \uaddc\uc815 \uc900\uc218\ub294 EKS\uc640 \uac19\uc740 \uad00\ub9ac\ud615 \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud560 \ub54c \uacf5\ub3d9 \ucc45\uc784\uc73c\ub85c \uac04\uc8fc\ub429\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c \ub9d0\ud574\uc11c AWS\ub294 \ud074\ub77c\uc6b0\ub4dc\"\uc758\" \ubcf4\uc548\uc744 \ucc45\uc784\uc9c0\uace0 \uace0\uac1d\uc740 \ud074\ub77c\uc6b0\ub4dc\"\uc5d0\uc11c\uc758\" \ubcf4\uc548\uc744 \ucc45\uc784\uc9d1\ub2c8\ub2e4. EKS\uc5d0\uc11c AWS\ub294 EKS \uad00\ub9ac\ud615 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uad00\ub9ac\ub97c \ub2f4\ub2f9\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc5d0\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9c8\uc2a4\ud130, ETCD \ub370\uc774\ud130\ubca0\uc774\uc2a4 \ubc0f AWS\uac00 \uc548\uc804\ud558\uace0 \uc548\uc815\uc801\uc778 \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud558\ub294 \ub370 \ud544\uc694\ud55c \uae30\ud0c0 \uc778\ud504\ub77c\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. EKS\uc758 \uc18c\ube44\uc790\ub294 IAM, \ud30c\ub4dc \ubcf4\uc548, \ub7f0\ud0c0\uc784 \ubcf4\uc548, \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548 \ub4f1\uacfc \uac19\uc740 \uc774 \uac00\uc774\ub4dc\uc758 \uc8fc\uc81c\uc5d0 \ub300\ud574 \uc8fc\ub85c \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc778\ud504\ub77c \ubcf4\uc548\uacfc \uad00\ub828\ud558\uc5ec AWS\ub294 \uc790\uccb4 \uad00\ub9ac \uc791\uc5c5\uc790\uc5d0\uc11c \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9, Fargate\ub85c \uc774\ub3d9\ud560 \ub54c \ucd94\uac00 \ucc45\uc784\uc744 \ub9e1\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 Fargate\ub97c \uc0ac\uc6a9\ud558\uba74 AWS\uac00 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \uc0ac\uc6a9\ub418\ub294 \uae30\ubcf8 \uc778\uc2a4\ud134\uc2a4/\ub7f0\ud0c0\uc784\uc744 \ubcf4\ud638\ud560 \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>AWS\ub294 \ub610\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud328\uce58 \ubc84\uc804 \ubc0f \ubcf4\uc548 \ud328\uce58\ub85c EKS \ucd5c\uc801\ud654 AMI\ub97c \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud560 \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\ub97c \uc0ac\uc6a9\ud558\ub294 \uace0\uac1d\uc740 EKS API, CLI, Cloudformation \ub610\ub294 AWS \ucf58\uc194\uc744 \ud1b5\ud574 \ub178\ub4dc \uadf8\ub8f9\uc744 \ucd5c\uc2e0 AMI\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc\ud560 \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c Fargate\uc640 \ub2ec\ub9ac \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 \uc778\ud504\ub77c/\ud074\ub7ec\uc2a4\ud130\ub97c \uc790\ub3d9\uc73c\ub85c \ud655\uc7a5\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub294 cluster-autoscaler \ub610\ub294 Karpenter, \ub124\uc774\ud2f0\ube0c AWS \uc624\ud1a0\uc2a4\ucf00\uc77c\ub9c1, SpotInst\uc758 Ocean \ub610\ub294 Atlassian\uc758 \uc5d0\uc2a4\uceec\ub808\uc774\ud130\uc640 \uac19\uc740 \ub2e4\ub978 \uae30\uc220\ub85c \ucc98\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.  </p> <p></p> <p>\uc2dc\uc2a4\ud15c\uc744 \uc124\uacc4\ud558\uae30 \uc804\uc5d0 \uadc0\ud558\uc758 \ucc45\uc784\uacfc \uc11c\ube44\uc2a4 \uacf5\uae09\uc790(AWS) \uc0ac\uc774\uc758 \uacbd\uacc4\uc120\uc774 \uc5b4\ub514\uc778\uc9c0 \uc544\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4.</p> <p>\uacf5\ub3d9 \ucc45\uc784 \ubaa8\ub378\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 AWS \uacf5\uc2dd \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc138\uc694.</p>"},{"location":"ko/security/docs/#_3","title":"\uc18c\uac1c","text":"<p>EKS\uc640 \uac19\uc740 \uad00\ub9ac\ud615 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud560 \ub54c \uad00\ub828\ub41c \uba87 \uac00\uc9c0 \ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840 \uc601\uc5ed\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>ID \ubc0f \uc561\uc138\uc2a4 \uad00\ub9ac</li> <li>\ud30c\ub4dc \ubcf4\uc548</li> <li>\ub7f0\ud0c0\uc784 \ubcf4\uc548</li> <li>\ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548</li> <li>\uba40\ud2f0\ud14c\ub10c\uc2dc</li> <li>\ud0d0\uc9c0 \uad00\ub9ac</li> <li>\uc778\ud504\ub77c \ubcf4\uc548</li> <li>\ub370\uc774\ud130 \uc554\ud638\ud654 \ubc0f \uc2dc\ud06c\ub9bf \uad00\ub9ac</li> <li>\uaddc\uc815 \ucef4\ud50c\ub77c\uc774\uc5b8\uc2a4</li> <li>\uc0ac\uace0 \ub300\uc751 \ubc0f \ubc95\uc758\ud559</li> <li>\uc774\ubbf8\uc9c0 \ubcf4\uc548</li> </ul> <p>\uc2dc\uc2a4\ud15c \uc124\uacc4\uc758 \uc77c\ubd80\ub85c \ubcf4\uc548 \uc0c1\ud0dc\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub294 \ubcf4\uc548 \uad00\ub828 \uc0ac\ud56d\uacfc \uad00\ud589\uc5d0 \ub300\ud574 \uc0dd\uac01\ud574\uc57c \ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ub9ac\uc18c\uc2a4 \uc9d1\ud569\uc5d0 \ub300\ud574 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc0ac\ub78c\uc744 \uc81c\uc5b4\ud574\uc57c \ud569\ub2c8\ub2e4. \ub610\ud55c \ubcf4\uc548 \uc0ac\uace0\ub97c \uc2e0\uc18d\ud558\uac8c \uc2dd\ubcc4\ud558\uace0 \ubb34\ub2e8 \uc561\uc138\uc2a4\ub85c\ubd80\ud130 \uc2dc\uc2a4\ud15c\uacfc \uc11c\ube44\uc2a4\ub97c \ubcf4\ud638\ud558\uba70 \ub370\uc774\ud130 \ubcf4\ud638\ub97c \ud1b5\ud574 \ub370\uc774\ud130\uc758 \uae30\ubc00\uc131\uacfc \ubb34\uacb0\uc131\uc744 \uc720\uc9c0\ud560 \uc218 \uc788\ub294 \ub2a5\ub825\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \ubcf4\uc548 \uc0ac\uace0\uc5d0 \ub300\uc751\ud558\uae30 \uc704\ud574 \uc798 \uc815\uc758\ub418\uace0 \uc5f0\uc2b5\ub41c \uc77c\ub828\uc758 \ud504\ub85c\uc138\uc2a4\ub97c \uac16\ucd94\uba74 \ubcf4\uc548 \ud0dc\uc138\ub3c4 \ud5a5\uc0c1\ub429\ub2c8\ub2e4. \uc774\ub7f0 \ub3c4\uad6c\uc640 \uae30\uc220\uc740 \uc7ac\uc815\uc801 \uc190\uc2e4 \ubc29\uc9c0 \ub610\ub294 \uaddc\uc81c \uc758\ubb34 \uc900\uc218\uc640 \uac19\uc740 \ubaa9\ud45c\ub97c \uc9c0\uc6d0\ud558\uae30 \ub54c\ubb38\uc5d0 \uc911\uc694\ud569\ub2c8\ub2e4.</p> <p>AWS\ub294 \ubcf4\uc548\uc5d0 \ubbfc\uac10\ud55c \ub2e4\uc591\ud55c \uace0\uac1d\uc758 \ud53c\ub4dc\ubc31\uc744 \uae30\ubc18\uc73c\ub85c \uc9c4\ud654\ud55c \ub2e4\uc591\ud55c \ubcf4\uc548 \uc11c\ube44\uc2a4 \uc138\ud2b8\ub97c \uc81c\uacf5\ud558\uc5ec \uc870\uc9c1\uc774 \ubcf4\uc548 \ubc0f \uaddc\uc815 \uc900\uc218 \ubaa9\ud45c\ub97c \ub2ec\uc131\ud560 \uc218 \uc788\ub3c4\ub85d \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \ub9e4\uc6b0 \uc548\uc804\ud55c \uae30\ubc18\uc744 \uc81c\uacf5\ud568\uc73c\ub85c\uc368 \uace0\uac1d\uc740 \"\ucc28\ubcc4\ud654\ub418\uc9c0 \uc54a\uc740 \ubb34\uac70\uc6b4 \uc791\uc5c5\"\uc5d0 \uc18c\uc694\ub418\ub294 \uc2dc\uac04\uc744 \uc904\uc774\uace0 \ube44\uc988\ub2c8\uc2a4 \ubaa9\ud45c\ub97c \ub2ec\uc131\ud558\ub294 \ub370 \ub354 \ub9ce\uc740 \uc2dc\uac04\uc744 \ud560\uc560\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/#_4","title":"\ud53c\ub4dc\ubc31","text":"<p>\uc774 \uac00\uc774\ub4dc\ub294 \uad11\ubc94\uc704\ud55c EKS/\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee4\ubba4\ub2c8\ud2f0\uc5d0\uc11c \uc9c1\uc811\uc801\uc778 \ud53c\ub4dc\ubc31\uacfc \uc81c\uc548\uc744 \uc218\uc9d1\ud558\uae30 \uc704\ud574 GitHub\uc5d0 \ub9b4\ub9ac\uc2a4\ub418\uace0 \uc788\uc2b5\ub2c8\ub2e4. \uac00\uc774\ub4dc\uc5d0 \ud3ec\ud568\ud574\uc57c \ud55c\ub2e4\uace0 \uc0dd\uac01\ud558\ub294 \ubaa8\ubc94 \uc0ac\ub840\uac00 \uc788\ub294 \uacbd\uc6b0 GitHub \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \uc774\uc288\ub97c \uc81c\ucd9c\ud558\uac70\ub098 PR\uc744 \uc81c\ucd9c\ud558\uc138\uc694. \uc6b0\ub9ac\uc758 \uc758\ub3c4\ub294 \uc11c\ube44\uc2a4\uc5d0 \uc0c8\ub85c\uc6b4 \uae30\ub2a5\uc774 \ucd94\uac00\ub418\uac70\ub098 \uc0c8\ub85c\uc6b4 \ubaa8\ubc94 \uc0ac\ub840\uac00 \ubc1c\uc804\ud560 \ub54c \uac00\uc774\ub4dc\ub97c \uc8fc\uae30\uc801\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/#_5","title":"\ub354 \uc77d\uc744 \uac70\ub9ac","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubcf4\uc548 \ubc31\uc11c, \ubcf4\uc548 \uac10\uc0ac \uc6cc\ud0b9 \uadf8\ub8f9\uc5d0\uc11c \uc791\uc131\ud55c \uc774 \ubc31\uc11c\ub294 \ubcf4\uc548 \uc2e4\ubb34\uc790\uac00 \uac74\uc804\ud55c \uc124\uacc4 \ubc0f \uad6c\ud604 \uacb0\uc815\uc744 \ub0b4\ub9ac\ub294 \ub370 \ub3c4\uc6c0\uc744 \uc8fc\uae30 \uc704\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uacf5\uaca9 \ud45c\uba74 \ubc0f \ubcf4\uc548 \uc544\ud0a4\ud14d\ucc98\uc758 \uc8fc\uc694 \uce21\uba74\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.</p> <p>CNCF \ub610\ud55c \ud074\ub77c\uc6b0\ub4dc \ubcf4\uc548\uc5d0 \ub300\ud55c \ubc31\uc11c\ub97c \ubc1c\ud589\ud558\uc600\uc2b5\ub2c8\ub2e4. \uc774 \ubc31\uc11c\uc5d0\uc11c\ub294 \uae30\uc220 \ud658\uacbd\uc774 \uc5b4\ub5bb\uac8c \ubc1c\uc804\ud588\ub294\uc9c0 \uc0b4\ud3b4\ubcf4\uace0, \uc774\ub7f0 \uae30\uc220 \ubc1c\uc804\uc5d0 \ub9de\ucd94\uc5b4 DevOps \ud504\ub85c\uc138\uc2a4 \ubc0f \uc560\uc790\uc77c \ubc29\ubc95\ub860 \ub4f1\uc5d0 \ub530\ub978 \ubcf4\uc548 \uc2e4\ucc9c\uc0ac\ud56d\uc744 \uc801\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/compliance/","title":"\ucef4\ud50c\ub77c\uc774\uc5b8\uc2a4","text":"<p>\ucef4\ud50c\ub77c\uc774\uc5b8\uc2a4\ub294 AWS\uc640 \ud574\ub2f9 \uc11c\ube44\uc2a4 \uc18c\ube44\uc790 \uac04\uc758 \uacf5\ub3d9 \ucc45\uc784\uc785\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c AWS\ub294 \"\ud074\ub77c\uc6b0\ub4dc\uc758 \ubcf4\uc548\"\uc744 \ucc45\uc784\uc9c0\uace0, \uc0ac\uc6a9\uc790\ub294 \"\ud074\ub77c\uc6b0\ub4dc\uc5d0\uc11c\uc758 \ubcf4\uc548\"\uc744 \ub2f4\ub2f9\ud569\ub2c8\ub2e4. AWS\uc640 \ud574\ub2f9 \uc0ac\uc6a9\uc790\uac00 \ucc45\uc784\uc838\uc57c \ud560 \ucc45\uc784\uc744 \uc124\uba85\ud558\ub294 \uc120\uc740 \uc11c\ube44\uc2a4\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9d1\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 Fargate\ub97c \ud1b5\ud574 AWS\ub294 \ub370\uc774\ud130 \uc13c\ud130, \ud558\ub4dc\uc6e8\uc5b4, \uac00\uc0c1 \uc778\ud504\ub77c(Amazon EC2) \ubc0f \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784(Docker)\uc758 \ubb3c\ub9ac\uc801 \ubcf4\uc548\uc744 \uad00\ub9ac\ud560 \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4. Fargate \uc0ac\uc6a9\uc790\ub294 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc640 \ud574\ub2f9 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ubcf4\ud638\ud560 \ucc45\uc784\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ucef4\ud50c\ub77c\uc774\uc5b8\uc2a4 \ud45c\uc900\uc744 \uc900\uc218\ud574\uc57c \ud558\ub294 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2e4\ud589\ud560 \ub54c \uace0\ub824\ud574\uc57c \ud560 \uc911\uc694\ud55c \uc0ac\ud56d\uc740 \ub204\uad6c\uc758 \ucc45\uc784\uc790\uc778\uc9c0 \ud30c\uc545\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \ud45c\ub294 \ub2e4\uc591\ud55c \ucee8\ud14c\uc774\ub108 \uc11c\ube44\uc2a4\uac00 \uc900\uc218\ud558\ub294 \uaddc\uc815 \uc900\uc218 \ud504\ub85c\uadf8\ub7a8\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4.</p> \ucef4\ud50c\ub77c\uc774\uc5b8\uc2a4 \ud504\ub85c\uadf8\ub7a8 Amazon ECS \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\ud130 Amazon EKS \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\ud130 ECS Fargete \uc544\ub9c8\uc874 ECR PCI DSS Level 1 1 1 1 1 HIPAA Eligible 1 1 1 1 SOC I 1 1 1 1 SOC II 1 1 1 1 SOC III 1 1 1 1 ISO 27001:2013 1 1 1 1 ISO 9001:2015 1 1 1 1 ISO 27017:2015 1 1 1 1 ISO 27018:2019 1 1 1 1 IRAP 1 1 1 1 FedRAMP Moderate (East/West) 1 1 0 1 FedRAMP High (GovCloud) 1 1 0 1 DOD CC SRG 1 DISA Review (IL5) 0 1 HIPAA BAA 1 1 1 1 MTCS 1 1 0 1 C5 1 1 0 1 K-ISMS 1 1 0 1 ENS High 1 1 0 1 OSPAR 1 1 0 1 HITRUST CSF 1 1 1 1 <p>\ucef4\ud50c\ub77c\uc774\uc5b8\uc2a4 \uc0c1\ud0dc\ub294 \uc2dc\uac04\uc774 \uc9c0\ub0a8\uc5d0 \ub530\ub77c \ubcc0\uacbd\ub429\ub2c8\ub2e4. \ucd5c\uc2e0 \uc0c1\ud0dc\ub294 \ud56d\uc0c1 https://aws.amazon.com/compliance/services-in-scope/\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>\ud074\ub77c\uc6b0\ub4dc \uc778\uc99d \ubaa8\ub378 \ubc0f \ubaa8\ubc94 \uc0ac\ub840\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 AWS \ubc31\uc11c\uc778 \uc548\uc804\ud55c \ud074\ub77c\uc6b0\ub4dc \ucc44\ud0dd\uc744 \uc704\ud55c \uc778\uc99d \ubaa8\ub378\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/compliance/#shift-left","title":"\uc2dc\ud504\ud2b8 \ub808\ud504\ud2b8(Shift Left)","text":"<p>\uc2dc\ud504\ud2b8 \ub808\ud504\ud2b8 \uac1c\ub150\uc740 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uac1c\ubc1c \uc218\uba85 \uc8fc\uae30 \ucd08\uae30\uc5d0 \uc815\ucc45 \uc704\ubc18 \ubc0f \uc624\ub958\ub97c \ud3ec\ucc29\ud558\ub294 \uac83\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4. \ubcf4\uc548 \uad00\uc810\uc5d0\uc11c \uc774\uac83\uc740 \ub9e4\uc6b0 \uc720\uc775\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uac1c\ubc1c\uc790\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ubc30\ud3ec\ud558\uae30 \uc804\uc5d0 \uad6c\uc131 \ubb38\uc81c\ub97c \uc218\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uc640 \uac19\uc740 \uc2e4\uc218\ub97c \uc870\uae30\uc5d0 \ud3ec\ucc29\ud558\uba74 \uc815\ucc45\uc744 \uc704\ubc18\ud558\ub294 \uad6c\uc131\uc774 \ubc30\ud3ec\ub418\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/compliance/#pac-policy-as-code","title":"\ucf54\ub4dc\ub85c\uc11c\uc758 \uc815\ucc45 (PaC, Policy as Code)","text":"<p>\uc815\ucc45\uc740 \ud589\ub3d9, \uc989 \ud5c8\uc6a9\ub41c \ud589\ub3d9 \ub610\ub294 \uae08\uc9c0\ub41c \ud589\ub3d9\uc744 \uaddc\uc81c\ud558\uae30 \uc704\ud55c \uc77c\ub828\uc758 \uaddc\uce59\uc73c\ub85c \uc0dd\uac01\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ubaa8\ub4e0 Dockerfile\uc5d0\ub294 \ucee8\ud14c\uc774\ub108\ub97c \ub8e8\ud2b8 \uc0ac\uc6a9\uc790\uac00 \uc544\ub2cc \uc0ac\uc6a9\uc790\ub85c \uc2e4\ud589\ud558\ub3c4\ub85d \ud558\ub294 USER \uc9c0\uc2dc\ubb38\uc774 \ud3ec\ud568\ub418\uc5b4\uc57c \ud55c\ub2e4\ub294 \uc815\ucc45\uc774 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubb38\uc11c\ub85c\uc11c \uc774\uc640 \uac19\uc740 \uc815\ucc45\uc740 \ubc1c\uacac\ud558\uace0 \uc801\uc6a9\ud558\uae30 \uc5b4\ub824\uc6b8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc694\uad6c \uc0ac\ud56d\uc774 \ubcc0\uacbd\ub428\uc5d0 \ub530\ub77c \uc774 \uc815\ucc45\uc774 \uc2dc\ub300\uc5d0 \ub4a4\ucc98\uc9c8 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. PaC \uc194\ub8e8\uc158\uc744 \uc0ac\uc6a9\ud558\uba74 \uc54c\ub824\uc9c4 \uc704\ud611\uacfc \uc9c0\uc18d\uc801\uc778 \uc704\ud611\uc744 \ud0d0\uc9c0, \uc608\ubc29, \uac10\uc18c \ubc0f \ub300\uc751\ud558\ub294 \ubcf4\uc548, \uaddc\uc815 \uc900\uc218 \ubc0f \uac1c\uc778 \uc815\ubcf4 \ubcf4\ud638 \uc81c\uc5b4\ub97c \uc790\ub3d9\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uc815\ucc45\uc744 \uccb4\uacc4\ud654\ud558\uace0 \ub2e4\ub978 \ucf54\ub4dc \uc544\ud2f0\ud329\ud2b8\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \uad00\ub9ac\ud560 \uc218 \uc788\ub294 \uba54\ucee4\ub2c8\uc998\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774 \uc811\uadfc \ubc29\uc2dd\uc758 \uc774\uc810\uc740 DevOps \ubc0f GitOps \uc804\ub7b5\uc744 \uc7ac\uc0ac\uc6a9\ud558\uc5ec Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc804\uccb4\uc5d0 \uc815\ucc45\uc744 \uad00\ub9ac\ud558\uace0 \uc77c\uad00\ub418\uac8c \uc801\uc6a9\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. PAC \uc635\uc158\uacfc PSP\uc758 \ubbf8\ub798\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ud30c\ub4dc \ubcf4\uc548\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/compliance/#pac","title":"\ud30c\uc774\ud504\ub77c\uc778\uc5d0\uc11c PaC \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubc30\ud3ec \uc804\uc5d0 \uc704\ubc18 \uac10\uc9c0","text":"<ul> <li>OPA\ub294 CNCF\uc758 \uc77c\ubd80\uc778 \uc624\ud508 \uc18c\uc2a4 \uc815\ucc45 \uc5d4\uc9c4\uc785\ub2c8\ub2e4. \uc815\ucc45 \uacb0\uc815\uc744 \ub0b4\ub9ac\ub294 \ub370 \uc0ac\uc6a9\ub418\uba70 \uc5b8\uc5b4 \ub77c\uc774\ube0c\ub7ec\ub9ac \ub610\ub294 \uc11c\ube44\uc2a4 \ub4f1 \ub2e4\uc591\ud55c \ubc29\uc2dd\uc73c\ub85c \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. OPA \uc815\ucc45\uc740 Rego\ub77c\ub294 \ub3c4\uba54\uc778 \ud2b9\uc815 \uc5b8\uc5b4(DSL)\ub85c \uc791\uc131\ub429\ub2c8\ub2e4. OPA\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub3d9\uc801 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\uc758 \uc77c\ubd80\ub85c Gatekeeper \ud504\ub85c\uc81d\ud2b8\ub85c \uc2e4\ud589\ub418\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc9c0\ub9cc, OPA\ub294 CI/CD \ud30c\uc774\ud504\ub77c\uc778\uc5d0 \ud1b5\ud569\ub420 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uac1c\ubc1c\uc790\ub294 \ub9b4\ub9ac\uc2a4 \uc8fc\uae30 \ucd08\uae30\uc5d0 \uad6c\uc131\uc5d0 \ub300\ud55c \ud53c\ub4dc\ubc31\uc744 \ubc1b\uc744 \uc218 \uc788\uc73c\uba70, \uc774\ub97c \ud1b5\ud574 \ud504\ub85c\ub355\uc158\uc5d0 \ub4e4\uc5b4\uac00\uae30 \uc804\uc5d0 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc778 OPA \uc815\ucc45 \ubaa8\uc74c\uc740 \uc774 \ud504\ub85c\uc81d\ud2b8\uc758 GitHub \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>Conftest\ub294 OPA\ub97c \uae30\ubc18\uc73c\ub85c \uad6c\ucd95\ub418\uc5c8\uc73c\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uad6c\uc131\uc744 \ud14c\uc2a4\ud2b8\ud558\uae30 \uc704\ud55c \uac1c\ubc1c\uc790 \uc911\uc2ec\uc758 \uacbd\ud5d8\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4.</li> <li>Kyverno\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc6a9\uc73c\ub85c \uc124\uacc4\ub41c \uc815\ucc45 \uc5d4\uc9c4\uc785\ub2c8\ub2e4.Kyverno\ub97c \uc0ac\uc6a9\ud558\uba74 \uc815\ucc45\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4\ub85c \uad00\ub9ac\ub418\ubbc0\ub85c \uc815\ucc45\uc744 \uc791\uc131\ud558\ub294 \ub370 \uc0c8\ub85c\uc6b4 \uc5b8\uc5b4\uac00 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 kubectl, git, kustomize\uc640 \uac19\uc740 \uce5c\uc219\ud55c \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc815\ucc45\uc744 \uad00\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Kyverno \uc815\ucc45\uc740 Kubernetes \ub9ac\uc18c\uc2a4\ub97c \uac80\uc99d, \ubcc0\uacbd \ubc0f \uc0dd\uc131\ud558\uace0 OCI \uc774\ubbf8\uc9c0 \uacf5\uae09\ub9dd \ubcf4\uc548\uc744 \ubcf4\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Kyverno CLI\ub294 CI/CD \ud30c\uc774\ud504\ub77c\uc778\uc758 \uc77c\ubd80\ub85c \uc815\ucc45\uc744 \ud14c\uc2a4\ud2b8\ud558\uace0 \ub9ac\uc18c\uc2a4\ub97c \uac80\uc99d\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubaa8\ub4e0 Kyverno \ucee4\ubba4\ub2c8\ud2f0 \uc815\ucc45\uc740 Kyverno \uc6f9 \uc0ac\uc774\ud2b8\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc73c\uba70, Kyverno CLI\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\uc774\ud504\ub77c\uc778\uc5d0\uc11c \ud14c\uc2a4\ud2b8\ub97c \uc791\uc131\ud558\ub294 \uc608\ub294 \uc815\ucc45 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</li> </ul>"},{"location":"ko/security/docs/compliance/#_2","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<ul> <li>Amazon EKS Security Immersion Workshop - Regulatory Compliance</li> <li>kube-bench</li> <li>docker-bench-security</li> <li>AWS Inspector</li> <li>Kubernetes Security Review \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804 1.13.4\uc5d0 \ub300\ud55c \uc11c\ub4dc\ud30c\ud2f0 \ubcf4\uc548 \ud3c9\uac00(2019)</li> </ul>"},{"location":"ko/security/docs/data/","title":"\ub370\uc774\ud130 \uc554\ud638\ud654 \ubc0f \uc2dc\ud06c\ub9bf \uad00\ub9ac","text":""},{"location":"ko/security/docs/data/#_2","title":"\uc800\uc7a5 \uc2dc \uc554\ud638\ud654","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \ud568\uaed8 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 AWS \ub124\uc774\ud2f0\ube0c \uc2a4\ud1a0\ub9ac\uc9c0 \uc635\uc158\uc740 EBS, EFS, FSx for Lustre\ub4f1 \uc138 \uac00\uc9c0\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc138 \uac00\uc9c0 \ubaa8\ub450 \uc11c\ube44\uc2a4 \uad00\ub9ac \ud0a4 \ub610\ub294 \uace0\uac1d \uad00\ub9ac \ud0a4 (CMK)\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc800\uc7a5 \uc2dc \uc554\ud638\ud654\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. EBS\uc758 \uacbd\uc6b0 \uc778\ud2b8\ub9ac \uc2a4\ud1a0\ub9ac\uc9c0 \ub4dc\ub77c\uc774\ubc84 \ub610\ub294 EBS CSI\ub4dc\ub77c\uc774\ubc84\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ub458 \ub2e4 \ubcfc\ub968 \uc554\ud638\ud654 \ubc0f CMK \uc81c\uacf5\uc744 \uc704\ud55c \ud30c\ub77c\ubbf8\ud130\ub97c \ud3ec\ud568\ud569\ub2c8\ub2e4. EFS\uc758 \uacbd\uc6b0 EFS CSI \ub4dc\ub77c\uc774\ubc84\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc9c0\ub9cc EBS\uc640 \ub2ec\ub9ac EFS CSI \ub4dc\ub77c\uc774\ubc84\ub294 \ub3d9\uc801 \ud504\ub85c\ube44\uc800\ub2dd\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. EKS\uc640 \ud568\uaed8 EFS\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 PV\ub97c \uc0dd\uc131\ud558\uae30 \uc804\uc5d0 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0 \ub300\ud55c \uc800\uc7a5 \uc911 \uc554\ud638\ud654\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uace0 \uad6c\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. EFS \ud30c\uc77c \uc554\ud638\ud654\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc800\uc7a5 \ub370\uc774\ud130 \uc554\ud638\ud654\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4. EFS\uc640 FSx for Lustre\uc5d0\ub294 \uc800\uc7a5 \uc2dc \uc554\ud638\ud654\ub97c \uc81c\uacf5\ud558\ub294 \uac83 \uc678\uc5d0\ub3c4 \uc804\uc1a1 \ub370\uc774\ud130\ub97c \uc554\ud638\ud654\ud558\ub294 \uc635\uc158\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. FSx for Luster\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. EFS\uc758 \uacbd\uc6b0 \ub2e4\uc74c \uc608\uc640 \uac19\uc774 PV\uc758 <code>MountOptions</code>\uc5d0 <code>tls</code> \ud30c\ub77c\ubbf8\ud130\ub97c \ucd94\uac00\ud558\uc5ec \uc804\uc1a1 \uc554\ud638\ud654\ub97c \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: efs-pv\nspec:\n  capacity:\n    storage: 5Gi\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: efs-sc\n  mountOptions:\n    - tls\n  csi:\n    driver: efs.csi.aws.com\n    volumeHandle: &lt;file_system_id&gt;\n</code></pre> <p>FSx CSI \ub4dc\ub77c\uc774\ubc84\ub294 Lustre \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc758 \ub3d9\uc801 \ud504\ub85c\ube44\uc800\ub2dd\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \uc11c\ube44\uc2a4 \uad00\ub9ac \ud0a4\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub370\uc774\ud130\ub97c \uc554\ud638\ud654\ud558\uc9c0\ub9cc, \ub2e4\uc74c \uc608\uc640 \uac19\uc774 \uc790\uccb4 CMK\ub97c \uc81c\uacf5\ud558\ub294 \uc635\uc158\uc774 \uc788\uc2b5\ub2c8\ub2e4:</p> <pre><code>kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: fsx-sc\nprovisioner: fsx.csi.aws.com\nparameters:\n  subnetId: subnet-056da83524edbe641\n  securityGroupIds: sg-086f61ea73388fb6b\n  deploymentType: PERSISTENT_1\n  kmsKeyId: &lt;kms_arn&gt;\n</code></pre> <p>Attention</p> <p>2020\ub144 5\uc6d4 28\uc77c\ubd80\ud130 EKS Fargate \ud30c\ub4dc\uc758 \uc784\uc2dc \ubcfc\ub968\uc5d0 \uae30\ub85d\ub418\ub294 \ubaa8\ub4e0 \ub370\uc774\ud130\ub294 \uc5c5\uacc4 \ud45c\uc900 AES-256 \uc554\ud638\ud654 \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud558\uc5ec \uae30\ubcf8\uc801\uc73c\ub85c \uc554\ud638\ud654\ub429\ub2c8\ub2e4. \uc11c\ube44\uc2a4\uc5d0\uc11c \uc554\ud638\ud654 \ubc0f \ubcf5\ud638\ud654\ub97c \uc6d0\ud65c\ud558\uac8c \ucc98\ub9ac\ud558\ubbc0\ub85c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc218\uc815\ud560 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/data/#_3","title":"\uc800\uc7a5\ub41c \ub370\uc774\ud130 \uc554\ud638\ud654","text":"<p>\uc800\uc7a5\ub41c \ub370\uc774\ud130\ub97c \uc554\ud638\ud654\ud558\ub294 \uac83\uc740 \ubaa8\ubc94 \uc0ac\ub840\ub85c \uac04\uc8fc\ub429\ub2c8\ub2e4. \uc554\ud638\ud654\uac00 \ud544\uc694\ud55c\uc9c0 \ud655\uc2e4\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \ub370\uc774\ud130\ub97c \uc554\ud638\ud654\ud558\uc138\uc694.</p>"},{"location":"ko/security/docs/data/#cmk","title":"CMK\ub97c \uc8fc\uae30\uc801\uc73c\ub85c \uad50\uccb4\ud558\uc138\uc694","text":"<p>CMK\ub97c \uc790\ub3d9\uc73c\ub85c \uad50\uccb4\ud558\ub3c4\ub85d KMS\ub97c \uad6c\uc131\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 1\ub144\uc5d0 \ud55c \ubc88 \ud0a4\uac00 \uad50\uccb4\ub418\uace0 \uc774\uc804 \ud0a4\ub294 \ubb34\uae30\ud55c \uc800\uc7a5\ub418\ubbc0\ub85c \ub370\uc774\ud130\ub97c \uacc4\uc18d \ud574\ub3c5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uace0\uac1d \ub9c8\uc2a4\ud130 \ud0a4 \uad50\uccb4 \ubb38\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/data/#efs","title":"EFS \uc561\uc138\uc2a4 \ud3ec\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uacf5\uc720 \ub370\uc774\ud130\uc138\ud2b8\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uac04\uc18c\ud654\ud569\ub2c8\ub2e4","text":"<p>\uc11c\ub85c \ub2e4\ub978 POSIX \ud30c\uc77c \uad8c\ud55c\uc73c\ub85c \ub370\uc774\ud130 \uc138\ud2b8\ub97c \uacf5\uc720\ud588\uac70\ub098 \ub2e4\ub978 \ub9c8\uc6b4\ud2b8 \uc9c0\uc810\uc744 \uc0dd\uc131\ud558\uc5ec \uacf5\uc720 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc758 \uc77c\ubd80\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud558\ub824\ub294 \uacbd\uc6b0 EFS \uc561\uc138\uc2a4 \ud3ec\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc561\uc138\uc2a4 \ud3ec\uc778\ud2b8 \uc0ac\uc6a9\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 AWS \ubb38\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4. \ud604\uc7ac \uc561\uc138\uc2a4 \ud3ec\uc778\ud2b8(AP)\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 PV\uc758 <code>VolumeHandle</code> \ud30c\ub77c\ubbf8\ud130\uc5d0\uc11c AP\ub97c \ucc38\uc870\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>Attention</p> <p>2021\ub144 3\uc6d4 23\uc77c\ubd80\ud130 EFS CSI \ub4dc\ub77c\uc774\ubc84\ub294 EFS \uc561\uc138\uc2a4 \ud3ec\uc778\ud2b8\uc758 \ub3d9\uc801 \ud504\ub85c\ube44\uc800\ub2dd\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc561\uc138\uc2a4 \ud3ec\uc778\ud2b8\ub294 \uc5ec\ub7ec \ud30c\ub4dc \uac04\uc5d0 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc744 \uc27d\uac8c \uacf5\uc720\ud560 \uc218 \uc788\uac8c \ud574\uc8fc\ub294 EFS \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubcc4 \uc9c4\uc785\uc810\uc785\ub2c8\ub2e4. \uac01 EFS \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0\ub294 \ucd5c\ub300 120\uac1c\uc758 PV\uac00 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Amazon EFS CSI \ub3d9\uc801 \ud504\ub85c\ube44\uc800\ub2dd \uc18c\uac1c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/data/#_4","title":"\uc2dc\ud06c\ub9bf \uad00\ub9ac","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf\uc740 \uc0ac\uc6a9\uc790 \uc778\uc99d\uc11c, \uc554\ud638 \ub610\ub294 API \ud0a4\uc640 \uac19\uc740 \ubbfc\uac10\ud55c \uc815\ubcf4\ub97c \uc800\uc7a5\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc774\ub4e4\uc740 etcd\uc5d0 base64\ub85c \uc778\ucf54\ub529\ub41c \ubb38\uc790\uc5f4\ub85c \uc720\uc9c0\ub429\ub2c8\ub2e4. EKS\uc5d0\uc11c\ub294 etcd \ub178\ub4dc\uc758 EBS \ubcfc\ub968\uc774 EBS \uc554\ud638\ud654\ub85c \uc554\ud638\ud654\ub429\ub2c8\ub2e4. \ud30c\ub4dc\ub294 <code>PodSpec</code>\uc758 \uc2dc\ud06c\ub9bf\uc744 \ucc38\uc870\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf \uac1d\uccb4\ub97c \uac80\uc0c9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc2dc\ud06c\ub9bf\uc740 \ud658\uacbd \ubcc0\uc218\uc5d0 \ub9e4\ud551\ud558\uac70\ub098 \ubcfc\ub968\uc73c\ub85c \ub9c8\uc6b4\ud2b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2dc\ud06c\ub9bf \uc0dd\uc131\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>Caution</p> <p>\ud2b9\uc815 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \uc2dc\ud06c\ub9bf\uc740 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\uc5d0\uc11c \ucc38\uc870\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Caution</p> <p>\ub178\ub4dc \uad8c\ud55c \ubd80\uc5ec\uc790\ub294 Kubelet\uc774 \ub178\ub4dc\uc5d0 \ub9c8\uc6b4\ud2b8\ub41c \ubaa8\ub4e0 \uc2dc\ud06c\ub9bf\uc744 \uc77d\uc744 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/data/#aws-kms","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf \ubd09\ud22c \uc554\ud638\ud654\uc5d0 AWS KMS \uc0ac\uc6a9","text":"<p>\uc774\ub97c \ud1b5\ud574 \uace0\uc720\ud55c DEK(\ub370\uc774\ud130 \uc554\ud638\ud654 \ud0a4)\uc73c\ub85c \uc2dc\ud06c\ub9bf\uc744 \uc554\ud638\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c DEK\ub294 AWS KMS\uc758 KEK (\ud0a4 \uc554\ud638\ud654 \ud0a4) \ub97c \uc0ac\uc6a9\ud558\uc5ec \uc554\ud638\ud654\ub418\uba70, \uc774 KEK (\ud0a4 \uc554\ud638\ud654 \ud0a4) \ub294 \ubc18\ubcf5 \uc77c\uc815\uc5d0 \ub530\ub77c \uc790\ub3d9\uc73c\ub85c \uad50\uccb4\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc6a9 KMS \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\uba74 \ubaa8\ub4e0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc554\ud638\uac00 \uc77c\ubc18 \ud14d\uc2a4\ud2b8 \ub300\uc2e0 \uc554\ud638\ubb38\uc758 etcd\uc5d0 \uc800\uc7a5\ub418\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\uc5d0\uc11c\ub9cc \ud574\ub3c5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc2ec\uce35 \ubc29\uc5b4\ub97c \uc704\ud55c EKS \uc554\ud638\ud654 \uacf5\uae09\uc790 \uc9c0\uc6d0 \uc0ac\uc6a9 \ube14\ub85c\uadf8\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/data/#_5","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf \uc0ac\uc6a9 \uac10\uc0ac","text":"<p>EKS\uc5d0\uc11c \uac10\uc0ac \ub85c\uae45\uc744 \ucf1c\uace0 CloudWatch \uc9c0\ud45c \ud544\ud130 \ubc0f \uc54c\ub78c\uc744 \uc0dd\uc131\ud558\uc5ec \uc2dc\ud06c\ub9bf\uc774 \uc0ac\uc6a9\ub420 \ub54c \uc54c\ub9bc\uc744 \ubcf4\ub0c5\ub2c8\ub2e4 (\uc120\ud0dd \uc0ac\ud56d). \ub2e4\uc74c\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac10\uc0ac \ub85c\uadf8\uc5d0 \ub300\ud55c \uba54\ud2b8\ub9ad \ud544\ud130\uc758 \uc608\uc2dc\uc785\ub2c8\ub2e4, <code>{($.verb=\"get\") &amp;&amp; ($.ObjectRef.resource=\"Secret\")}</code>. CloudWatch Log Insights\uc5d0\uc11c\ub294 \ub2e4\uc74c \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| stats count(*) by objectRef.name as secret\n| filter verb=\"get\" and objectRef.resource=\"secrets\"\n</code></pre> <p>\uc704 \ucffc\ub9ac\ub294 \ud2b9\uc815 \uae30\uac04 \ub0b4\uc5d0 \uc2dc\ud06c\ub9bf\uc5d0 \uc561\uc138\uc2a4\ud55c \ud69f\uc218\ub97c \ud45c\uc2dc\ud569\ub2c8\ub2e4.</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter verb=\"get\" and objectRef.resource=\"secrets\"\n| display objectRef.namespace, objectRef.name, user.username, responseStatus.code\n</code></pre> <p>\uc774 \ucffc\ub9ac\uc5d0\ub294 \uc2dc\ud06c\ub9bf\uc5d0 \uc561\uc138\uc2a4\ud558\ub824\uace0 \uc2dc\ub3c4\ud55c \uc0ac\uc6a9\uc790\uc758 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ubc0f \uc0ac\uc6a9\uc790 \uc774\ub984 \ubc0f \uc751\ub2f5 \ucf54\ub4dc\uc640 \ud568\uaed8 \uc2dc\ud06c\ub9bf\uc774 \ud45c\uc2dc\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/data/#_6","title":"\uc8fc\uae30\uc801\uc73c\ub85c \uc2dc\ud06c\ub9bf \uad50\uccb4\ud558\uae30","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc2dc\ud06c\ub9bf\uc744 \uc790\ub3d9\uc73c\ub85c \uad50\uccb4\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc554\ud638\ub97c \uad50\uccb4\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 Vault \ub610\ub294 AWS Secrets Manager\uc640 \uac19\uc740 \uc678\ubd80 \uc554\ud638 \uc800\uc7a5\uc18c\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/data/#_7","title":"\ub2e4\ub978 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc73c\ub85c\ubd80\ud130 \uc2dc\ud06c\ub9bf\uc744 \ubd84\ub9ac\ud558\ub294 \ubc29\ubc95\uc73c\ub85c \ubcc4\ub3c4\uc758 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624","text":"<p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uac04\uc5d0 \uacf5\uc720\ud560 \uc218 \uc5c6\ub294 \uc2dc\ud06c\ub9bf\uc774 \uc788\ub294 \uacbd\uc6b0 \ud574\ub2f9 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ub300\ud574 \ubcc4\ub3c4\uc758 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/data/#_8","title":"\ud658\uacbd \ubcc0\uc218 \ub300\uc2e0 \ubcfc\ub968 \ub9c8\uc6b4\ud2b8 \uc0ac\uc6a9","text":"<p>\ud658\uacbd \ubcc0\uc218 \uac12\uc774 \uc2e4\uc218\ub85c \ub85c\uadf8\uc5d0 \ub098\ud0c0\ub0a0 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcfc\ub968\uc73c\ub85c \ub9c8\uc6b4\ud2b8\ub41c \uc2dc\ud06c\ub9bf\uc740 tmpfs \ubcfc\ub968(RAM \ubc31\uc5c5 \ud30c\uc77c \uc2dc\uc2a4\ud15c)\uc73c\ub85c \uc778\uc2a4\ud134\uc2a4\ud654\ub418\uba70, \ud30c\ub4dc\uac00 \uc0ad\uc81c\ub418\uba74 \ub178\ub4dc\uc5d0\uc11c \uc790\ub3d9\uc73c\ub85c \uc81c\uac70\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/data/#_9","title":"\uc678\ubd80 \uc2dc\ud06c\ub9bf \uc81c\uacf5\uc790 \uc0ac\uc6a9","text":"<p>AWS Secret Manager\uc640 Hishcorp\uc758 Vault\ub97c \ud3ec\ud568\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \uc2e4\ud589 \uac00\ub2a5\ud55c \ub300\uc548\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc11c\ube44\uc2a4\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf\uc5d0\uc11c\ub294 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uc138\ubc00\ud55c \uc561\uc138\uc2a4 \uc81c\uc5b4, \uac15\ub825\ud55c \uc554\ud638\ud654, \uc554\ud638 \uc790\ub3d9 \uad50\uccb4 \ub4f1\uc758 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. Bitnami\uc758 Sealed Secrets\ub294 \ube44\ub300\uce6d \uc554\ud638\ud654\ub97c \uc0ac\uc6a9\ud558\uc5ec \"\ubd09\uc778\ub41c \uc2dc\ud06c\ub9bf\"\uc744 \uc0dd\uc131\ud558\ub294 \ub610 \ub2e4\ub978 \uc811\uadfc \ubc29\uc2dd\uc785\ub2c8\ub2e4. \uacf5\uac1c \ud0a4\ub294 \uc2dc\ud06c\ub9bf\uc744 \uc554\ud638\ud654\ud558\ub294 \ub370 \uc0ac\uc6a9\ub418\ub294 \ubc18\uba74 \uc554\ud638 \ud574\ub3c5\uc5d0 \uc0ac\uc6a9\ub41c \uac1c\uc778 \ud0a4\ub294 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0 \ubcf4\uad00\ub418\ubbc0\ub85c Git\uacfc \uac19\uc740 \uc18c\uc2a4 \uc81c\uc5b4 \uc2dc\uc2a4\ud15c\uc5d0 \ubd09\uc778\ub41c \uc2dc\ud06c\ub9bf\uc744 \uc548\uc804\ud558\uac8c \uc800\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc2e4\ub4dc \uc2dc\ud06c\ub9bf\uc744 \uc0ac\uc6a9\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uc2dc\ud06c\ub9bf \ubc30\ud3ec \uad00\ub9ac\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>\uc678\ubd80 \uc2dc\ud06c\ub9bf \uc2a4\ud1a0\uc5b4\uc758 \uc0ac\uc6a9\uc774 \uc99d\uac00\ud568\uc5d0 \ub530\ub77c \uc774\ub97c \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \ud1b5\ud569\ud574\uc57c \ud560 \ud544\uc694\uc131\ub3c4 \ucee4\uc84c\uc2b5\ub2c8\ub2e4. Secret Store CSI \ub4dc\ub77c\uc774\ubc84\ub294 CSI \ub4dc\ub77c\uc774\ubc84 \ubaa8\ub378\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc678\ubd80 \uc2dc\ud06c\ub9bf \uc2a4\ud1a0\uc5b4\ub85c\ubd80\ud130 \uc2dc\ud06c\ub9bf\uc744 \uac00\uc838\uc624\ub294 \ucee4\ubba4\ub2c8\ud2f0 \ud504\ub85c\uc81d\ud2b8\uc785\ub2c8\ub2e4. \ud604\uc7ac \uc774 \ub4dc\ub77c\uc774\ubc84\ub294 AWS Secret Manager, Azure, Vault \ubc0f GCP\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. AWS \uacf5\uae09\uc790\ub294 AWS \uc2dc\ud06c\ub9bf \uad00\ub9ac\uc790\uc640 AWS \ud30c\ub77c\ubbf8\ud130 \uc2a4\ud1a0\uc5b4\ub97c \ubaa8\ub450 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \ub610\ud55c \uc554\ud638\uac00 \ub9cc\ub8cc\ub418\uba74 \uc554\ud638\uac00 \uad50\uccb4\ub418\ub3c4\ub85d \uad6c\uc131\ud560 \uc218 \uc788\uc73c\uba70, AWS Secrets Manager \uc554\ud638\ub97c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc554\ud638\uc640 \ub3d9\uae30\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc554\ud638\uc758 \ub3d9\uae30\ud654\ub294 \ubcfc\ub968\uc5d0\uc11c \uc554\ud638\ub97c \uc77d\ub294 \ub300\uc2e0 \uc554\ud638\ub97c \ud658\uacbd \ubcc0\uc218\ub85c \ucc38\uc870\ud574\uc57c \ud560 \ub54c \uc720\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Note</p> <p>\uc2dc\ud06c\ub9bf \uc2a4\ud1a0\uc5b4 CSI \ub4dc\ub77c\uc774\ubc84\ub294 \uc2dc\ud06c\ub9bf\uc744 \uac00\uc838\uc640\uc57c \ud558\ub294 \uacbd\uc6b0 \uc2dc\ud06c\ub9bf\uc744 \ucc38\uc870\ud558\ub294 \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub41c IRSA \uc5ed\ud560\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc774 \uc791\uc5c5\uc758 \ucf54\ub4dc\ub294 Github\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>AWS \ubcf4\uc548 \ubc0f \uc124\uc815 \uacf5\uae09\uc790(ASCP) \uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 \ub2e4\uc74c \ub9ac\uc18c\uc2a4\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624:</p> <ul> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf \uc2a4\ud1a0\uc5b4 CSI \ub4dc\ub77c\uc774\ubc84\uc640 \ud568\uaed8 AWS \ubcf4\uc548 \ubc0f \uc124\uc815 \uacf5\uae09\uc790\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95</li> <li>Secret manager \uc2dc\ud06c\ub9bf\uc744 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\ud06c\ub9bf \uc2a4\ud1a0\uc5b4 CSI \ub4dc\ub77c\uc774\ubc84\uc640 \ud1b5\ud569</li> </ul> <p>external-secrets\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \ud568\uaed8 \uc678\ubd80 \uc2dc\ud06c\ub9bf \uc800\uc7a5\uc18c\ub97c \uc0ac\uc6a9\ud558\ub294 \ub610 \ub2e4\ub978 \ubc29\ubc95\uc785\ub2c8\ub2e4. CSI \ub4dc\ub77c\uc774\ubc84\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \uc678\ubd80 \uc2dc\ud06c\ub9bf\uc740 AWS Secrets Manager\ub97c \ube44\ub86f\ud55c \ub2e4\uc591\ud55c \ubc31\uc5d4\ub4dc\uc5d0\uc11c \uc791\ub3d9\ud569\ub2c8\ub2e4. \ucc28\uc774\uc810\uc740 \uc678\ubd80 \uc2dc\ud06c\ub9bf\uc774 \uc678\ubd80 \uc2dc\ud06c\ub9bf \uc2a4\ud1a0\uc5b4\uc5d0\uc11c \uc2dc\ud06c\ub9bf\uc744 \uac80\uc0c9\ud558\ub294 \ub300\uc2e0 \uc774\ub7f0 \ubc31\uc5d4\ub4dc\uc758 \uc2dc\ud06c\ub9bf\uc744 \uc2dc\ud06c\ub9bf\uc73c\ub85c Kubernetes\uc5d0 \ubcf5\uc0ac\ud55c\ub2e4\ub294 \uc810\uc785\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uc120\ud638\ud558\ub294 \uc2dc\ud06c\ub9bf \uc2a4\ud1a0\uc5b4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2dc\ud06c\ub9bf\uc744 \uad00\ub9ac\ud558\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\uc774\ud2f0\ube0c \ubc29\uc2dd\uc73c\ub85c \uc2dc\ud06c\ub9bf\uacfc \uc0c1\ud638\uc791\uc6a9\ud560 \uc218 \uc788\ub2e4.</p>"},{"location":"ko/security/docs/detective/","title":"\uac10\uc0ac(Audit) \ubc0f \ub85c\uae45","text":"<p>[\uac10\uc0ac] \ub85c\uadf8\ub97c \uc218\uc9d1\ud558\uace0 \ubd84\uc11d\ud558\ub294 \uac83\uc740 \uc5ec\ub7ec \uac00\uc9c0 \uc774\uc720\ub85c \uc720\uc6a9\ud569\ub2c8\ub2e4. \ub85c\uadf8\ub294 \uadfc\ubcf8 \uc6d0\uc778 \ubd84\uc11d(RCA) \ubc0f \ucc45\uc784 \ubd84\uc11d(\uc608: \ud2b9\uc815 \ubcc0\uacbd\uc5d0 \ub300\ud55c \uc0ac\uc6a9\uc790 \ucd94\uc801)\uc5d0 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub85c\uadf8\uac00 \ucda9\ubd84\ud788 \uc218\uc9d1\ub418\uba74 \uc774\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\uc0c1 \ud589\ub3d9\uc744 \ud0d0\uc9c0\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. EKS\uc5d0\uc11c\ub294 \uac10\uc0ac \ub85c\uadf8\uac00 Amazon Cloudwatch \ub85c\uadf8\ub85c \uc804\uc1a1\ub429\ub2c8\ub2e4. EKS\uc758 \uac10\uc0ac \uc815\ucc45\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: audit.k8s.io/v1beta1\nkind: Policy\nrules:\n  # Log aws-auth configmap changes\n  - level: RequestResponse\n    namespaces: [\"kube-system\"]\n    verbs: [\"update\", \"patch\", \"delete\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"configmaps\"]\n        resourceNames: [\"aws-auth\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: None\n    users: [\"system:kube-proxy\"]\n    verbs: [\"watch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"endpoints\", \"services\", \"services/status\"]\n  - level: None\n    users: [\"kubelet\"] # legacy kubelet identity\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes\", \"nodes/status\"]\n  - level: None\n    userGroups: [\"system:nodes\"]\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes\", \"nodes/status\"]\n  - level: None\n    users:\n      - system:kube-controller-manager\n      - system:kube-scheduler\n      - system:serviceaccount:kube-system:endpoint-controller\n    verbs: [\"get\", \"update\"]\n    namespaces: [\"kube-system\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"endpoints\"]\n  - level: None\n    users: [\"system:apiserver\"]\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"namespaces\", \"namespaces/status\", \"namespaces/finalize\"]\n  - level: None\n    users:\n      - system:kube-controller-manager\n    verbs: [\"get\", \"list\"]\n    resources:\n      - group: \"metrics.k8s.io\"\n  - level: None\n    nonResourceURLs:\n      - /healthz*\n      - /version\n      - /swagger*\n  - level: None\n    resources:\n      - group: \"\" # core\n        resources: [\"events\"]\n  - level: Request\n    users: [\"kubelet\", \"system:node-problem-detector\", \"system:serviceaccount:kube-system:node-problem-detector\"]\n    verbs: [\"update\",\"patch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes/status\", \"pods/status\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    userGroups: [\"system:nodes\"]\n    verbs: [\"update\",\"patch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes/status\", \"pods/status\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    users: [\"system:serviceaccount:kube-system:namespace-controller\"]\n    verbs: [\"deletecollection\"]\n    omitStages:\n      - \"RequestReceived\"\n  # Secrets, ConfigMaps, and TokenReviews can contain sensitive &amp; binary data,\n  # so only log at the Metadata level.\n  - level: Metadata\n    resources:\n      - group: \"\" # core\n        resources: [\"secrets\", \"configmaps\"]\n      - group: authentication.k8s.io\n        resources: [\"tokenreviews\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    resources:\n      - group: \"\"\n        resources: [\"serviceaccounts/token\"]\n  - level: Request\n    verbs: [\"get\", \"list\", \"watch\"]\n    resources: \n      - group: \"\" # core\n      - group: \"admissionregistration.k8s.io\"\n      - group: \"apiextensions.k8s.io\"\n      - group: \"apiregistration.k8s.io\"\n      - group: \"apps\"\n      - group: \"authentication.k8s.io\"\n      - group: \"authorization.k8s.io\"\n      - group: \"autoscaling\"\n      - group: \"batch\"\n      - group: \"certificates.k8s.io\"\n      - group: \"extensions\"\n      - group: \"metrics.k8s.io\"\n      - group: \"networking.k8s.io\"\n      - group: \"policy\"\n      - group: \"rbac.authorization.k8s.io\"\n      - group: \"scheduling.k8s.io\"\n      - group: \"settings.k8s.io\"\n      - group: \"storage.k8s.io\"\n    omitStages:\n      - \"RequestReceived\"\n  # Default level for known APIs\n  - level: RequestResponse\n    resources: \n      - group: \"\" # core\n      - group: \"admissionregistration.k8s.io\"\n      - group: \"apiextensions.k8s.io\"\n      - group: \"apiregistration.k8s.io\"\n      - group: \"apps\"\n      - group: \"authentication.k8s.io\"\n      - group: \"authorization.k8s.io\"\n      - group: \"autoscaling\"\n      - group: \"batch\"\n      - group: \"certificates.k8s.io\"\n      - group: \"extensions\"\n      - group: \"metrics.k8s.io\"\n      - group: \"networking.k8s.io\"\n      - group: \"policy\"\n      - group: \"rbac.authorization.k8s.io\"\n      - group: \"scheduling.k8s.io\"\n      - group: \"settings.k8s.io\"\n      - group: \"storage.k8s.io\"\n    omitStages:\n      - \"RequestReceived\"\n  # Default level for all other requests.\n  - level: Metadata\n    omitStages:\n      - \"RequestReceived\"\n</code></pre>"},{"location":"ko/security/docs/detective/#_1","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/detective/#_2","title":"\uac10\uc0ac \ub85c\uadf8 \ud65c\uc131\ud654","text":"<p>\uac10\uc0ac \ub85c\uadf8\ub294 EKS\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 EKS \uad00\ub9ac\ud615 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uadf8\uc758 \uc77c\ubd80\uc785\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84, \ucee8\ud2b8\ub864\ub7ec \uad00\ub9ac\uc790 \ubc0f \uc2a4\ucf00\uc904\ub7ec\uc5d0 \ub300\ud55c \ub85c\uadf8\uc640 \uac10\uc0ac \ub85c\uadf8\ub97c \ud3ec\ud568\ud558\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uadf8\uc758 \ud65c\uc131\ud654/\ube44\ud65c\uc131\ud654 \uc9c0\uce68\uc740 AWS \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Info</p> <p>\ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uae45\uc744 \ud65c\uc131\ud654\ud558\uba74 \ub85c\uadf8\ub97c CloudWatch\uc5d0 \uc800\uc7a5\ud558\ub294 \ub370 \ube44\uc6a9\uc774 \ubc1c\uc0dd\ud569\ub2c8\ub2e4. \uc774\ub85c \uc778\ud574 \uc9c0\uc18d\uc801\uc778 \ubcf4\uc548 \ube44\uc6a9\uc5d0 \ub300\ud55c \uad11\ubc94\uc704\ud55c \ubb38\uc81c\uac00 \uc81c\uae30\ub429\ub2c8\ub2e4. \uad81\uadf9\uc801\uc73c\ub85c \uc774\ub7f0 \ube44\uc6a9\uc744 \ubcf4\uc548 \uce68\ud574 \ube44\uc6a9 (\uc608: \uc7ac\uc815\uc801 \uc190\uc2e4, \ud3c9\ud310 \ud6fc\uc190 \ub4f1)\uacfc \ube44\uad50\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774 \uac00\uc774\ub4dc\uc758 \uad8c\uc7a5 \uc0ac\ud56d \uc911 \uc77c\ubd80\ub9cc \uad6c\ud604\ud558\uba74 \ud658\uacbd\uc744 \uc801\uc808\ud558\uac8c \ubcf4\ud638\ud560 \uc218 \uc788\uc744 \uac83\uc785\ub2c8\ub2e4.</p> <p>Warning</p> <p>\ud074\ub77c\uc6b0\ub4dc\uc6cc\uce58 \ub85c\uadf8 \ud56d\ubaa9\uc758 \ucd5c\ub300 \ud06c\uae30\ub294 256KB\uc778 \ubc18\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc694\uccad \ucd5c\ub300 \ud06c\uae30\ub294 1.5MiB\uc785\ub2c8\ub2e4. 256KB\ub97c \ucd08\uacfc\ud558\ub294 \ub85c\uadf8 \ud56d\ubaa9\uc740 \uc798\ub9ac\uac70\ub098 \uc694\uccad \uba54\ud0c0\ub370\uc774\ud130\ub9cc \ud3ec\ud568\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/detective/#_3","title":"\uac10\uc0ac \uba54\ud0c0\ub370\uc774\ud130 \ud65c\uc6a9","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac10\uc0ac \ub85c\uadf8\uc5d0\ub294 \uc694\uccad\uc774 \uc2b9\uc778\ub418\uc5c8\ub294\uc9c0 \uc5ec\ubd80\ub97c \ub098\ud0c0\ub0b4\ub294 <code>authorization.k8s.io/decision</code>\uc640 \uacb0\uc815\uc758 \uc774\uc720\ub97c \ub098\ud0c0\ub0b4\ub294 <code>authorization.k8s.io/reason</code>, \ub450 \uac1c\uc758 \uc5b4\ub178\ud14c\uc774\uc158\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc18d\uc131\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud2b9\uc815 API \ud638\ucd9c\uc774 \ud5c8\uc6a9\ub41c \uc774\uc720\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/detective/#_4","title":"\uc758\uc2ec\uc2a4\ub7ec\uc6b4 \uc774\ubca4\ud2b8\uc5d0 \ub300\ud55c \uc54c\ub78c \uc0dd\uc131","text":"<p>403 Forbidden \ubc0f 401 Unauthorized \uc751\ub2f5\uc774 \uc99d\uac00\ud558\ub294 \uc704\uce58\ub97c \uc790\ub3d9\uc73c\ub85c \uc54c\ub9ac\ub294 \uacbd\ubcf4\ub97c \uc0dd\uc131\ud55c \ub2e4\uc74c <code>host</code> , <code>sourceIPs</code> \ubc0f <code>k8s_user.username</code> \uacfc \uac19\uc740 \uc18d\uc131\uc744 \uc0ac\uc6a9 \ud558\uc5ec \uc774\ub7f0 \uc694\uccad\uc758 \ucd9c\ucc98\ub97c \ucc3e\uc544\ub0c5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/detective/#log-insights","title":"Log Insights\ub85c \ub85c\uadf8 \ubd84\uc11d","text":"<p>CloudWatch Log Insights\ub97c \uc0ac\uc6a9\ud558\uc5ec RBAC \uac1d\uccb4 (\uc608: \ub864, \ub864\ubc14\uc778\ub529, \ud074\ub7ec\uc2a4\ud130\ub864, \ud074\ub7ec\uc2a4\ud130 \ub864\ubc14\uc778\ub529) \uc5d0 \ub300\ud55c \ubcc0\uacbd \uc0ac\ud56d\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uba87 \uac00\uc9c0 \uc0d8\ud50c \ucffc\ub9ac\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <p><code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5 \uc5d0 \ub300\ud55c \uc5c5\ub370\uc774\ud2b8\ub97c \ub098\uc5f4\ud569\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| filter @logStream like \"kube-apiserver-audit\"\n| filter verb in [\"update\", \"patch\"]\n| filter objectRef.resource = \"configmaps\" and objectRef.name = \"aws-auth\" and objectRef.namespace = \"kube-system\"\n| sort @timestamp desc\n</code></pre> <p>Validation \uc6f9\ud6c5\uc5d0 \ub300\ud55c \uc0dd\uc131 \ub610\ub294 \ubcc0\uacbd \uc0ac\ud56d\uc744 \ub098\uc5f4\ud569\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| filter @logStream like \"kube-apiserver-audit\"\n| filter verb in [\"create\", \"update\", \"patch\"] and responseStatus.code = 201\n| filter objectRef.resource = \"validatingwebhookconfigurations\"\n| sort @timestamp desc\n</code></pre> <p>\ub864\uc5d0 \ub300\ud55c \uc0dd\uc131, \uc5c5\ub370\uc774\ud2b8, \uc0ad\uc81c \uc791\uc5c5\uc744 \ub098\uc5f4\ud569\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"roles\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\ub864\ubc14\uc778\ub529\uc5d0 \ub300\ud55c \uc0dd\uc131, \uc5c5\ub370\uc774\ud2b8, \uc0ad\uc81c \uc791\uc5c5\uc744 \ub098\uc5f4\ud569\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"rolebindings\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\ud074\ub7ec\uc2a4\ud130\ub864\uc5d0 \ub300\ud55c \uc0dd\uc131, \uc5c5\ub370\uc774\ud2b8, \uc0ad\uc81c \uc791\uc5c5\uc744 \ub098\uc5f4\ud569\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"clusterroles\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\ud074\ub7ec\uc2a4\ud130\ub864\ubc14\uc778\ub529\uc5d0 \ub300\ud55c \uc0dd\uc131, \uc5c5\ub370\uc774\ud2b8, \uc0ad\uc81c \uc791\uc5c5\uc744 \ub098\uc5f4\ud569\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"clusterrolebindings\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\uc2dc\ud06c\ub9bf\uc5d0 \ub300\ud55c \ubb34\ub2e8 \uc77d\uae30 \uc791\uc5c5\uc744 \ud45c\uc2dc\ud569\ub2c8\ub2e4:</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"secrets\" and verb in [\"get\", \"watch\", \"list\"] and responseStatus.code=\"401\"\n| stats count() by bin(1m)\n</code></pre> <p>\uc2e4\ud328\ud55c \uc775\uba85 \uc694\uccad \ubaa9\ub85d:</p> <pre><code>fields @timestamp, @message, sourceIPs.0\n| sort @timestamp desc\n| limit 100\n| filter user.username=\"system:anonymous\" and responseStatus.code in [\"401\", \"403\"]\n</code></pre>"},{"location":"ko/security/docs/detective/#cloudtrail","title":"CloudTrail \ub85c\uadf8 \uac10\uc0ac","text":"<p>IAM Roles for Service Account(IRSA)\uc744 \ud65c\uc6a9\ud558\ub294 \ud30c\ub4dc\uc5d0\uc11c \ud638\ucd9c\ud55c AWS API\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uc774\ub984\uacfc \ud568\uaed8 CloudTrail\uc5d0 \uc790\ub3d9\uc73c\ub85c \ub85c\uae45\ub429\ub2c8\ub2e4. API \ud638\ucd9c \uad8c\ud55c\uc774 \uba85\uc2dc\uc801\uc73c\ub85c \ubd80\uc5ec\ub418\uc9c0 \uc54a\uc740 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc758 \uc774\ub984\uc774 \ub85c\uadf8\uc5d0 \ud45c\uc2dc\ub418\uba74 IAM \uc5ed\ud560\uc758 \uc2e0\ub8b0 \uc815\ucc45\uc774 \uc798\ubabb \uad6c\uc131\ub418\uc5c8\ub2e4\ub294 \ud45c\uc2dc\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c Cloudtrail\uc740 AWS API \ud638\ucd9c\uc744 \ud2b9\uc815 IAM \ubcf4\uc548 \uc8fc\uccb4\uc5d0 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 \uc88b\uc740 \ubc29\ubc95\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/detective/#cloudtrail-insights","title":"CloudTrail Insights\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc758\uc2ec\uc2a4\ub7ec\uc6b4 \ud65c\ub3d9 \ubc1c\uacac","text":"<p>CloudTrail Insights\ub294 CloudTrail \ud2b8\ub808\uc77c\uc5d0\uc11c \uc4f0\uae30 \uad00\ub9ac \uc774\ubca4\ud2b8\ub97c \uc790\ub3d9\uc73c\ub85c \ubd84\uc11d\ud558\uace0 \ube44\uc815\uc0c1\uc801\uc778 \ud65c\ub3d9\uc774 \ubc1c\uc0dd\ud558\uba74 \uc54c\ub824\uc90d\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 IRSA \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uc5ec IAM \uc5ed\ud560\uc744 \ub9e1\ub294 \ud30c\ub4dc \ub4f1 AWS \uacc4\uc815\uc758 \uc4f0\uae30 API\uc5d0 \ub300\ud55c \ud638\ucd9c\ub7c9\uc774 \uc99d\uac00\ud558\ub294 \uc2dc\uae30\ub97c \ud30c\uc545\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 CloudTrail Insights \ubc1c\ud45c: \ube44\uc815\uc0c1\uc801\uc778 API \ud65c\ub3d9 \uc2dd\ubcc4 \ubc0f \ub300\uc751\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/detective/#_5","title":"\ucd94\uac00 \ub9ac\uc18c\uc2a4","text":"<p>\ub85c\uadf8\uc758 \uc591\uc774 \uc99d\uac00\ud558\uba74 Log Insights \ub610\ub294 \ub2e4\ub978 \ub85c\uadf8 \ubd84\uc11d \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub85c\uadf8\ub97c \ud30c\uc2f1\ud558\uace0 \ud544\ud130\ub9c1\ud558\ub294 \uac83\uc774 \ube44\ud6a8\uc728\uc801\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub300\uc548\uc73c\ub85c Sysdig Falco\uc640 ekscloudwatch\ub97c \uc2e4\ud589\ud558\ub294 \uac83\ub3c4 \uace0\ub824\ud574 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. Falco\ub294 \uac10\uc0ac \ub85c\uadf8\ub97c \ubd84\uc11d\ud558\uace0 \uc624\ub79c \uae30\uac04 \ub3d9\uc548 \uc774\uc0c1 \uc9d5\ud6c4\ub098 \uc545\uc6a9\uc5d0 \ub300\ud574 \ud50c\ub798\uadf8\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. ekscloudwatch \ud504\ub85c\uc81d\ud2b8\ub294 \ubd84\uc11d\uc744 \uc704\ud574 CloudWatch\uc758 \uac10\uc0ac \ub85c\uadf8 \uc774\ubca4\ud2b8\ub97c \ud314\ucf54\ub85c \uc804\ub2ec\ud569\ub2c8\ub2e4. \ud314\ucf54\ub294 \uc77c\ub828\uc758 \uae30\ubcf8 \uac10\uc0ac \uaddc\uce59\uacfc \ud568\uaed8 \uc790\uccb4 \uac10\uc0ac \uaddc\uce59\uc744 \ucd94\uac00\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4.</p> <p>\ub610 \ub2e4\ub978 \uc635\uc158\uc740 \uac10\uc0ac \ub85c\uadf8\ub97c S3\uc5d0 \uc800\uc7a5\ud558\uace0 SageMaker Random Cut Forest \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucd94\uac00 \uc870\uc0ac\uac00 \ud544\uc694\ud55c \uc774\uc0c1 \ub3d9\uc791\uc5d0 \uc0ac\uc6a9\ud558\ub294 \uac83\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/detective/#_6","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<p>\ub2e4\uc74c \uc0c1\uc6a9 \ubc0f \uc624\ud508 \uc18c\uc2a4 \ud504\ub85c\uc81d\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uac00 \ud655\ub9bd\ub41c \ubaa8\ubc94 \uc0ac\ub840\uc640 \uc77c\uce58\ud558\ub294\uc9c0 \ud3c9\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>kubeaudit</li> <li>kube-scan \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uacf5\ud1b5 \uad6c\uc131 \uc810\uc218 \uc0b0\uc815 \uc2dc\uc2a4\ud15c \ud504\ub808\uc784\uc6cc\ud06c\uc5d0 \ub530\ub77c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc704\ud5d8 \uc810\uc218\ub97c \ud560\ub2f9\ud569\ub2c8\ub2e4.</li> <li>kubesec.io</li> <li>polaris</li> <li>Starboard</li> <li>Snyk</li> <li>Kubescape Kubescape\ub294 \ud074\ub7ec\uc2a4\ud130, YAML \ud30c\uc77c \ubc0f \ud5ec\ub984 \ucc28\ud2b8\ub97c \uc2a4\uce94\ud558\ub294 \uc624\ud508 \uc18c\uc2a4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubcf4\uc548 \ub3c4\uad6c\uc785\ub2c8\ub2e4. \uc5ec\ub7ec \ud504\ub808\uc784\uc6cc\ud06c (NSA-CISA \ubc0f MITRE ATT&amp;CK\u00ae)\uc5d0 \ub530\ub77c \uc124\uc815 \uc624\ub958\ub97c \ud0d0\uc9c0\ud569\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/hosts/","title":"\uc778\ud504\ub77c(\ud638\uc2a4\ud2b8) \ubcf4\ud638","text":"<p>\ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \ubcf4\ud638\ud558\ub294 \uac83\ub3c4 \uc911\uc694\ud558\uc9c0\ub9cc \uc774\ubbf8\uc9c0\ub97c \uc2e4\ud589\ud558\ub294 \uc778\ud504\ub77c\ub97c \ubcf4\ud638\ud558\ub294 \uac83\ub3c4 \ub9c8\ucc2c\uac00\uc9c0\ub85c \uc911\uc694\ud569\ub2c8\ub2e4. \uc774 \uc139\uc158\uc5d0\uc11c\ub294 \ud638\uc2a4\ud2b8\ub97c \ub300\uc0c1\uc73c\ub85c \uc9c1\uc811 \uc2dc\uc791\ub41c \uacf5\uaca9\uc73c\ub85c \uc778\ud55c \uc704\ud5d8\uc744 \uc644\ud654\ud558\ub294 \ub2e4\uc591\ud55c \ubc29\ubc95\uc744 \uc0b4\ud3b4\ubd05\ub2c8\ub2e4. \uc774 \uc9c0\uce68\uc740 \ub7f0\ud0c0\uc784 \ubcf4\uc548 \uc139\uc158\uc5d0 \uc124\uba85\ub41c \uc9c0\uce68\uacfc \ud568\uaed8 \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#_2","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/hosts/#os","title":"\ucee8\ud14c\uc774\ub108 \uc2e4\ud589\uc5d0 \ucd5c\uc801\ud654\ub41c OS \uc0ac\uc6a9","text":"<p>Flatcar Linux, Project Atomic, RancherOS \ubc0f \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108 \uc2e4\ud589\uc744 \uc704\ud574 \uc124\uacc4\ub41c AWS\uc758 \ucee8\ud14c\uc774\ub108 \uc2e4\ud589 \ucd5c\uc801\ud654 OS\uc778 Bottlerocket\uc744 \uc0ac\uc6a9\ud574 \ubcf4\uc138\uc694. \uc774\uac83\uc740 \uacf5\uaca9 \ud45c\uba74 \uac10\uc18c, \ubd80\ud305 \uc2dc \uac80\uc99d\ub41c \ub514\uc2a4\ud06c \uc774\ubbf8\uc9c0, SELinux\ub97c \uc0ac\uc6a9\ud55c \uad8c\ud55c \uc81c\ud55c \ub4f1\uc774 \ud3ec\ud568\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub610\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 EKS \ucd5c\uc801\ud654 AMI\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. EKS \ucd5c\uc801\ud654 AMI\ub294 \uc815\uae30\uc801\uc73c\ub85c \ub9b4\ub9ac\uc2a4\ub418\uba70 \ucee8\ud14c\uc774\ub108\uc2dd \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \ud544\uc694\ud55c \ucd5c\uc18c\ud55c\uc758 OS \ud328\ud0a4\uc9c0 \ubc0f \ubc14\uc774\ub108\ub9ac \uc138\ud2b8\ub97c \ud3ec\ud568\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#os_1","title":"\uc6cc\ucee4 \ub178\ub4dc OS\ub97c \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0","text":"<p>Bottlerocket\uacfc \uac19\uc740 \ucee8\ud14c\uc774\ub108\uc5d0 \ucd5c\uc801\ud654\ub41c \ud638\uc2a4\ud2b8 OS\ub97c \uc0ac\uc6a9\ud558\uac70\ub098 EKS \ucd5c\uc801\ud654 AMI\uc640 \uac19\uc740 Amazon \uba38\uc2e0 \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud558\uace0 \ucd5c\uc2e0 \ubcf4\uc548 \ud328\uce58\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\ub7f0 \ud638\uc2a4\ud2b8 OS \uc774\ubbf8\uc9c0\ub97c \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>EKS \ucd5c\uc801\ud654 AMI\uc758 \uacbd\uc6b0 \ubcc0\uacbd \ub85c\uadf8 \ub610\ub294 \ub9b4\ub9ac\uc2a4 \ub178\ud2b8 \ucc44\ub110\ub97c \uc815\uae30\uc801\uc73c\ub85c \ud655\uc778\ud558\uace0 \uc5c5\ub370\uc774\ud2b8\ub41c \uc6cc\ucee4 \ub178\ub4dc \uc774\ubbf8\uc9c0\ub97c \ud074\ub7ec\uc2a4\ud130\ub85c \uc790\ub3d9 \ub864\uc544\uc6c3\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#_3","title":"\uc778\ud504\ub77c\ub97c \ubcc0\uacbd\ud560 \uc218 \uc5c6\ub294 \ub300\uc0c1\uc73c\ub85c \ubd84\ub958\ud558\uace0 \uc6cc\ucee4 \ub178\ub4dc \uad50\uccb4\ub97c \uc790\ub3d9\ud654\ud558\uc2ed\uc2dc\uc624","text":"<p>\uc804\uccb4 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc218\ud589\ud558\ub294 \ub300\uc2e0 \uc0c8 \ud328\uce58 \ub610\ub294 \uc5c5\ub370\uc774\ud2b8\uac00 \uc81c\uacf5\ub418\uba74 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uad50\uccb4\ud569\ub2c8\ub2e4. \uba87 \uac00\uc9c0 \ubc29\ubc95\uc73c\ub85c \uc774 \ubb38\uc81c\ub97c \ud574\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub8f9\uc758 \ubaa8\ub4e0 \ub178\ub4dc\uac00 \ucd5c\uc2e0 AMI\ub85c \uad50\uccb4\ub420 \ub54c\uae4c\uc9c0 \uc21c\ucc28\uc801\uc73c\ub85c \ub178\ub4dc\ub97c \ucc28\ub2e8\ud558\uace0 \ub4dc\ub808\uc774\ub2dd\ud558\ub294 \ucd5c\uc2e0 AMI\ub97c \uc0ac\uc6a9\ud558\uc5ec \uae30\uc874 \uc790\ub3d9 \ud655\uc7a5 \uadf8\ub8f9\uc5d0 \uc778\uc2a4\ud134\uc2a4\ub97c \ucd94\uac00\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ub294 \ubaa8\ub4e0 \ub178\ub4dc\uac00 \uad50\uccb4\ub420 \ub54c\uae4c\uc9c0 \uc774\uc804 \ub178\ub4dc \uadf8\ub8f9\uc5d0\uc11c \ub178\ub4dc\ub97c \uc21c\ucc28\uc801\uc73c\ub85c \ucc28\ub2e8\ud558\uace0 \uc81c\uac70\ud558\uba74\uc11c \uc0c8 \ub178\ub4dc \uadf8\ub8f9\uc5d0 \uc778\uc2a4\ud134\uc2a4\ub97c \ucd94\uac00\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. EKS \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 \uccab \ubc88\uc9f8 \uc811\uadfc \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uba70 \uc0c8 AMI\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ub418\uba74 \ucf58\uc194\uc5d0 \uc791\uc5c5\uc790\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\ub77c\ub294 \uba54\uc2dc\uc9c0\ub97c \ud45c\uc2dc\ud569\ub2c8\ub2e4. \ub610\ud55c 'eksctl'\uc5d0\ub294 \ucd5c\uc2e0 AMI\ub85c \ub178\ub4dc \uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\uace0 \uc778\uc2a4\ud134\uc2a4\uac00 \uc885\ub8cc\ub418\uae30 \uc804\uc5d0 \ub178\ub4dc \uadf8\ub8f9\uc5d0\uc11c \ud30c\ub4dc\ub97c \uc815\uc0c1\uc801\uc73c\ub85c \ucc28\ub2e8\ud558\uace0 \ub4dc\ub808\uc774\ub2dd\ud558\ub294 \uba54\ucee4\ub2c8\uc998\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc\ub97c \uad50\uccb4\ud558\ub294 \ub370 \ub2e4\ub978 \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud558\uae30\ub85c \uacb0\uc815\ud55c \uacbd\uc6b0, \uc0c8 \uc5c5\ub370\uc774\ud2b8/\ud328\uce58\uac00 \ub9b4\ub9ac\uc2a4\ub418\uace0 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc774 \uc5c5\uadf8\ub808\uc774\ub4dc\ub420 \ub54c \uc791\uc5c5\uc790\ub97c \uc815\uae30\uc801\uc73c\ub85c \uad50\uccb4\ud574\uc57c \ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \ud504\ub85c\uc138\uc2a4\ub97c \uc790\ub3d9\ud654\ud558\uc5ec \uc0ac\ub78c\uc758 \uac10\ub3c5\uc744 \ucd5c\uc18c\ud654\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>EKS Fargate\ub97c \uc0ac\uc6a9\ud558\uba74 AWS\ub294 \uc5c5\ub370\uc774\ud2b8\uac00 \uc81c\uacf5\ub418\ub294 \ub300\ub85c \uae30\ubcf8 \uc778\ud504\ub77c\ub97c \uc790\ub3d9\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud569\ub2c8\ub2e4.\uc774 \uc791\uc5c5\uc744 \uc6d0\ud65c\ud558\uac8c \uc218\ud589\ud560 \uc218 \uc788\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc9c0\ub9cc \uc5c5\ub370\uc774\ud2b8\ub85c \uc778\ud574 \ud30c\ub4dc \uc77c\uc815\uc774 \ubcc0\uacbd\ub418\ub294 \uacbd\uc6b0\uac00 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ub530\ub77c\uc11c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 Fargate \ud30c\ub4dc\ub85c \uc2e4\ud589\ud560 \ub54c\ub294 \uc5ec\ub7ec \ubcf5\uc81c\ubcf8\uc73c\ub85c \ubc30\ud3ec\ub97c \uc0dd\uc131\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#kube-bench-cis","title":"kube-bench\ub97c \uc8fc\uae30\uc801\uc73c\ub85c \uc2e4\ud589\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0 \ub300\ud55c CIS \ubca4\uce58\ub9c8\ud06c \uc900\uc218 \uc5ec\ubd80\ub97c \ud655\uc778\ud569\ub2c8\ub2e4","text":"<p>kube-bench\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 CIS \ubca4\uce58\ub9c8\ud06c\uc640 \ube44\uad50\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\ub97c \ud3c9\uac00\ud558\ub294 Aqua\uc758 \uc624\ud508 \uc18c\uc2a4 \ud504\ub85c\uc81d\ud2b8\uc785\ub2c8\ub2e4. \ubca4\uce58\ub9c8\ud06c\ub294 \uad00\ub9ac\ub418\uc9c0 \uc54a\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\ub97c \ubcf4\ud638\ud558\ub294 \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc124\uba85\ud569\ub2c8\ub2e4. CIS \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubca4\uce58\ub9c8\ud06c\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ub370\uc774\ud130 \ud50c\ub808\uc778\uc744 \ud3ec\ud568\ud569\ub2c8\ub2e4. Amazon EKS\ub294 \uc644\uc804 \uad00\ub9ac\ud615 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \uc81c\uacf5\ud558\ubbc0\ub85c CIS \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubca4\uce58\ub9c8\ud06c\uc758 \ubaa8\ub4e0 \uad8c\uc7a5 \uc0ac\ud56d\uc774 \uc801\uc6a9\ub418\ub294 \uac83\uc740 \uc544\ub2d9\ub2c8\ub2e4. \uc774 \ubc94\uc704\uc5d0 Amazon EKS \uad6c\ud604 \ubc29\uc2dd\uc774 \ubc18\uc601\ub418\ub3c4\ub85d AWS\ub294 CIS Amazon EKS \ubca4\uce58\ub9c8\ud06c\ub97c \ub9cc\ub4e4\uc5c8\uc2b5\ub2c8\ub2e4. EKS \ubca4\uce58\ub9c8\ud06c\ub294 CIS \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubca4\uce58\ub9c8\ud06c\ub97c \uacc4\uc2b9\ud558\uace0 EKS \ud074\ub7ec\uc2a4\ud130\uc758 \ud2b9\uc815 \uad6c\uc131 \uace0\ub824 \uc0ac\ud56d\uacfc \ud568\uaed8 \ucee4\ubba4\ub2c8\ud2f0\uc758 \ucd94\uac00 \uc758\uacac\uc744 \ubc18\uc601\ud569\ub2c8\ub2e4.</p> <p>EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud574 kube-bench\ub97c \uc2e4\ud589\ud560 \ub54c\ub294 \uc544\ucfe0\uc544 \uc2dc\ud050\ub9ac\ud2f0\uc758 \uc774 \uc9c0\uce68\uc744 \ub530\ub985\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 CIS Amazon EKS \ubca4\uce58\ub9c8\ud06c \uc18c\uac1c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#_4","title":"\uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \ucd5c\uc18c\ud654","text":"<p>\ud638\uc2a4\ud2b8\uc5d0 \uc6d0\uaca9\uc73c\ub85c \uc811\uc18d\ud574\uc57c \ud560 \ub54c\ub294 SSH \uc561\uc138\uc2a4\ub97c \ud65c\uc131\ud654\ud558\ub294 \ub300\uc2e0 SSM Session Manager\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ubd84\uc2e4, \ubcf5\uc0ac \ub610\ub294 \uacf5\uc720\ub420 \uc218 \uc788\ub294 SSH \ud0a4\uc640 \ub2ec\ub9ac \uc138\uc158 \uad00\ub9ac\uc790\uc5d0\uc11c\ub294 IAM\uc744 \uc0ac\uc6a9\ud558\uc5ec EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub41c \uba85\ub839\uc5d0 \ub300\ud55c \uac10\uc0ac \ucd94\uc801 \ubc0f \ub85c\uadf8\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4.</p> <p>2020\ub144 8\uc6d4 19\uc77c\ubd80\ud130 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 \uc0ac\uc6a9\uc790 \uc9c0\uc815 AMI\uc640 EC2 \uc2dc\uc791 \ud15c\ud50c\ub9bf(Launch Template)\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 SSM \uc5d0\uc774\uc804\ud2b8\ub97c AMI\uc5d0 \ub0b4\uc7a5\ud558\uac70\ub098 \uc6cc\ucee4 \ub178\ub4dc\uac00 \ubd80\ud2b8\uc2a4\ud2b8\ub7a9\ub420 \ub54c \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd5c\uc801\ud654\ub41c AMI \ub610\ub294 ASG\uc758 \uc2dc\uc791 \ud15c\ud50c\ub9bf\uc744 \uc218\uc815\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0, \uc774 \uc608\uc2dc\uc5d0\uc11c\ucc98\ub7fc \ub370\ubaac\uc14b\uc744 \uc0ac\uc6a9\ud558\uc5ec SSM \uc5d0\uc774\uc804\ud2b8\ub97c \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#ssm-ssh-iam","title":"SSM \uae30\ubc18 SSH \uc561\uc138\uc2a4\ub97c \uc704\ud55c \ucd5c\uc18c IAM \uc815\ucc45","text":"<p><code>AmazonSSMManagedInstanceCore</code> AWS \uad00\ub9ac\ud615 \uc815\ucc45\uc5d0\ub294 SSH \uc561\uc138\uc2a4\ub97c \ud53c\ud558\ub824\ub294 \uacbd\uc6b0 SSM Session Manager \ubc0f SSM RunCommand\uc5d0 \ud544\uc694\ud558\uc9c0 \uc54a\uc740 \uc5ec\ub7ec \uad8c\ud55c\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ud2b9\ud788 \uc6b0\ub824\ub418\ub294 \uac83\uc740 <code>SSM:GetParameter (s)</code>\uc5d0 \ub300\ud55c <code>*</code> \uad8c\ud55c\uc785\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ud574\ub2f9 \uc5ed\ud560\uc774 \ud30c\ub77c\ubbf8\ud130 \uc2a4\ud1a0\uc5b4\uc758 \ubaa8\ub4e0 \ud30c\ub77c\ubbf8\ud130(AWS \uad00\ub9ac\ud615 KMS \ud0a4\uac00 \uad6c\uc131\ub41c SecureString \ud3ec\ud568)\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uac8c \ub429\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c IAM \uc815\ucc45\uc5d0\ub294 SSM Systems Manager\ub97c \ud1b5\ud574 \ub178\ub4dc \uc561\uc138\uc2a4\ub97c \ud65c\uc131\ud654\ud558\uae30 \uc704\ud55c \ucd5c\uc18c \uad8c\ud55c \uc138\ud2b8\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"EnableAccessViaSSMSessionManager\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssmmessages:OpenDataChannel\",\n        \"ssmmessages:OpenControlChannel\",\n        \"ssmmessages:CreateDataChannel\",\n        \"ssmmessages:CreateControlChannel\",\n        \"ssm:UpdateInstanceInformation\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"EnableSSMRunCommand\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssm:UpdateInstanceInformation\",\n        \"ec2messages:SendReply\",\n        \"ec2messages:GetMessages\",\n        \"ec2messages:GetEndpoint\",\n        \"ec2messages:FailMessage\",\n        \"ec2messages:DeleteMessage\",\n        \"ec2messages:AcknowledgeMessage\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n</code></pre> <p>\uc774 \uc815\ucc45\uc744 \uc801\uc6a9\ud558\uace0 Session Manager \ud50c\ub7ec\uadf8\uc778\uc744 \uc124\uce58\ud558\uba74 \ub2e4\uc74c\uc744 \uc2e4\ud589\ud558\uc5ec \ub178\ub4dc\uc5d0 \uc811\uc18d\ud569\ub2c8\ub2e4.</p> <pre><code>aws ssm start-session --target [INSTANCE_ID_OF_EKS_NODE]\n</code></pre> <p>Note</p> <p>Session Manager \ub85c\uae45 \ud65c\uc131\ud654\uc5d0 \uad8c\ud55c\uc744 \ucd94\uac00\ud558\ub294 \uac83\ub3c4 \uace0\ub824\ud574 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#_5","title":"\ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0 \uc6cc\ucee4 \ub178\ub4dc \ubc30\ud3ec","text":"<p>\uc6cc\ucee4 \ub178\ub4dc\ub97c \ud504\ub77c\uc774\ube57 \uc11c\ube0c\ub137\uc5d0 \ubc30\uce58\ud558\uba74 \uacf5\uaca9\uc774 \uc790\uc8fc \ubc1c\uc0dd\ud558\ub294 \uc778\ud130\ub137\uc5d0 \ub300\ud55c \ub178\ucd9c\uc744 \ucd5c\uc18c\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. 2020\ub144 4\uc6d4 22\uc77c\ubd80\ud130 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc758 \ub178\ub4dc\uc5d0 \ub300\ud55c \ud37c\ube14\ub9ad IP \uc8fc\uc18c \ud560\ub2f9\uc740 \ud574\ub2f9 \ub178\ub4dc\uac00 \ubc30\ud3ec\ub418\ub294 \uc11c\ube0c\ub137\uc5d0 \uc758\ud574 \uc81c\uc5b4\ub429\ub2c8\ub2e4. \uc774\uc804\uc5d0\ub294 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc758 \ub178\ub4dc\uc5d0 \ud37c\ube14\ub9ad IP\uac00 \uc790\ub3d9\uc73c\ub85c \ud560\ub2f9\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc6cc\ucee4 \ub178\ub4dc\ub97c \ud37c\ube14\ub9ad \uc11c\ube0c\ub137\uc5d0 \ubc30\ud3ec\ud558\uae30\ub85c \uc120\ud0dd\ud55c \uacbd\uc6b0, \uc81c\ud55c\uc801\uc778 AWS \ubcf4\uc548 \uadf8\ub8f9 \uaddc\uce59\uc744 \uad6c\ud604\ud558\uc5ec \ub178\ucd9c\uc744 \uc81c\ud55c\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#amazon-inspector","title":"Amazon Inspector\ub97c \uc2e4\ud589\ud558\uc5ec \ud638\uc2a4\ud2b8\uc758 \ub178\ucd9c, \ucde8\uc57d\uc131 \ubc0f \ubaa8\ubc94 \uc0ac\ub840\uc640\uc758 \ud3b8\ucc28\ub97c \ud3c9\uac00\ud558\uc2ed\uc2dc\uc624","text":"<p>Amazon Inspector\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\uc5d0 \ub300\ud55c \uc758\ub3c4\ud558\uc9c0 \uc54a\uc740 \ub124\ud2b8\uc6cc\ud06c \uc561\uc138\uc2a4\uc640 \uae30\ubcf8 Amazon EC2 \uc778\uc2a4\ud134\uc2a4\uc758 \ucde8\uc57d\uc131\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Amazon Inspector\ub294 Amazon EC2 Systems Manager(SSM) \uc5d0\uc774\uc804\ud2b8\uac00 \uc124\uce58\ub418\uace0 \ud65c\uc131\ud654\ub41c \uacbd\uc6b0\uc5d0\ub9cc Amazon EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ub300\ud55c \uc77c\ubc18\uc801\uc778 \ucde8\uc57d\uc131 \ubc0f \ub178\ucd9c (CVE) \ub370\uc774\ud130\ub97c \uc81c\uacf5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc5d0\uc774\uc804\ud2b8\ub294 EKS \ucd5c\uc801\ud654 Amazon Linux AMI\ub97c \ube44\ub86f\ud55c \uc5ec\ub7ec Amazon \uba38\uc2e0 \uc774\ubbf8\uc9c0 (AMI)\uc5d0 \uc0ac\uc804 \uc124\uce58\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. SSM \uc5d0\uc774\uc804\ud2b8 \uc0c1\ud0dc\uc5d0 \uad00\uacc4\uc5c6\uc774 \ubaa8\ub4e0 Amazon EC2 \uc778\uc2a4\ud134\uc2a4\ub294 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \ubb38\uc81c \uc5ec\ubd80\ub97c \uac80\uc0ac\ud569\ub2c8\ub2e4.Amazon EC2\uc6a9 \uc2a4\uce94 \uad6c\uc131\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Amazon EC2 \uc778\uc2a4\ud134\uc2a4 \uc2a4\uce94\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>Attention</p> <p>Fargate \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \uc0ac\uc6a9\ub418\ub294 \uc778\ud504\ub77c\uc5d0\uc11c\ub294 Inspector\ub97c \uc2e4\ud589\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#_6","title":"\ub300\uc548\uc73c\ub85c \uc120\ud0dd \uac00\ub2a5\ud55c \uc635\uc158","text":""},{"location":"ko/security/docs/hosts/#selinux","title":"SELinux \uc2e4\ud589","text":"<p>Info</p> <p>RHEL(Red Hat Enterprise Linux), CentOS, Bottlerocket\uacfc Amazon Linux 2023 \uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5</p> <p>SELinux\ub294 \ucee8\ud14c\uc774\ub108\ub97c \uc11c\ub85c \uaca9\ub9ac\ud558\uace0 \ud638\uc2a4\ud2b8\ub85c\ubd80\ud130 \uaca9\ub9ac\ub41c \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud558\uae30 \uc704\ud55c \ucd94\uac00 \ubcf4\uc548 \uacc4\uce35\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. SELinux\ub97c \ud1b5\ud574 \uad00\ub9ac\uc790\ub294 \ubaa8\ub4e0 \uc0ac\uc6a9\uc790, \uc560\ud50c\ub9ac\ucf00\uc774\uc158, \ud504\ub85c\uc138\uc2a4 \ubc0f \ud30c\uc77c\uc5d0 \ub300\ud574 \ud544\uc218 \uc561\uc138\uc2a4 \uc81c\uc5b4(MAC)\ub97c \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub808\uc774\ube14 \uc9d1\ud569\uc744 \uae30\ubc18\uc73c\ub85c \ud2b9\uc815 \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud574 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc791\uc5c5\uc744 \uc81c\ud55c\ud558\ub294 \uc548\uc815\uc7a5\uce58\ub77c\uace0 \uc0dd\uac01\ud558\uba74 \ub429\ub2c8\ub2e4. EKS\uc5d0\uc11c\ub294 SELinux\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108\uac00 \uc11c\ub85c\uc758 \ub9ac\uc18c\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucee8\ud14c\uc774\ub108 SELinux \uc815\ucc45\uc740 container-selinux \ud328\ud0a4\uc9c0\uc5d0 \uc815\uc758\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. Docker CE\uc5d0\ub294 Docker(\ub610\ub294 \ub2e4\ub978 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784)\uc5d0\uc11c \uc0dd\uc131\ud55c \ud504\ub85c\uc138\uc2a4\uc640 \ud30c\uc77c\uc774 \uc81c\ud55c\ub41c \uc2dc\uc2a4\ud15c \uc561\uc138\uc2a4\ub85c \uc2e4\ud589\ub418\ub3c4\ub85d \ud558\ub824\uba74 \uc774 \ud328\ud0a4\uc9c0 (\uc885\uc18d \ud56d\ubaa9 \ud3ec\ud568)\uac00 \ud544\uc694\ud569\ub2c8\ub2e4.\ucee8\ud14c\uc774\ub108\ub294 <code>svirt_lxc_net_t</code>\uc758 \ubcc4\uce6d\uc778 <code>container_t</code> \ub808\uc774\ube14\uc744 \ud65c\uc6a9\ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc815\ucc45\uc740 \ucee8\ud14c\uc774\ub108\uac00 \ud638\uc2a4\ud2b8\uc758 \ud2b9\uc815 \uae30\ub2a5\uc5d0 \uc561\uc138\uc2a4\ud558\ub294 \uac83\uc744 \ud6a8\uacfc\uc801\uc73c\ub85c \ubc29\uc9c0\ud569\ub2c8\ub2e4.</p> <p>Docker\uc6a9 SELinux\ub97c \uad6c\uc131\ud558\uba74 Docker\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 <code>container_t</code> \ub808\uc774\ube14\ub9c1\ud558\uc5ec \ud0c0\uc785\uc73c\ub85c \uc790\ub3d9\uc73c\ub85c \uc778\uc2dd\ud558\uace0 \uac01 \ucee8\ud14c\uc774\ub108\uc5d0 \uace0\uc720\ud55c MCS \ub808\ubca8\uc744 \ubd80\uc5ec\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ucee8\ud14c\uc774\ub108\uac00 \uc11c\ub85c \uaca9\ub9ac\ub429\ub2c8\ub2e4. \ubcf4\ub2e4 \uc5c4\uaca9\ud55c \uc81c\ud55c\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 SELinux\uc5d0\uc11c \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc758 \ud2b9\uc815 \uc601\uc5ed\uc5d0 \ub300\ud55c \ucee8\ud14c\uc774\ub108 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud558\ub294 \uc790\uccb4 \ud504\ub85c\ud30c\uc77c\uc744 \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \ucee8\ud14c\uc774\ub108/\ud30c\ub4dc\ub9c8\ub2e4 \ub2e4\ub978 \ud504\ub85c\ud30c\uc77c\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\ub2e4\ub294 \uc810\uc5d0\uc11c PSP\uc640 \ube44\uc2b7\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \uc77c\ub828\uc758 \uc81c\ud55c\uc801\uc778 \uc81c\uc5b4\uac00 \ud3ec\ud568\ub41c \uc77c\ubc18 \uc6cc\ud06c\ub85c\ub4dc\uc6a9 \ud504\ub85c\ud30c\uc77c\uacfc \uad8c\ud55c \uc788\ub294 \uc561\uc138\uc2a4\uac00 \ud544\uc694\ud55c \ud56d\ubaa9\uc5d0 \ub300\ud55c \ud504\ub85c\ud30c\uc77c\uc744 \uac01\uac01 \uac00\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucee8\ud14c\uc774\ub108\uc6a9 SELinux\uc5d0\ub294 \uae30\ubcf8 \uc81c\ud55c\uc744 \uc218\uc815\ud558\ub3c4\ub85d \uad6c\uc131\ud560 \uc218 \uc788\ub294 \uc635\uc158 \uc138\ud2b8\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ud544\uc694\uc5d0 \ub530\ub77c \ub2e4\uc74c\uacfc \uac19\uc740 SELinux Booleans\ub97c \ud65c\uc131\ud654\ud558\uac70\ub098 \ube44\ud65c\uc131\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> Boolean Default Description <code>container_connect_any</code> <code>off</code> \ucee8\ud14c\uc774\ub108\uac00 \ud638\uc2a4\ud2b8\uc758 \uad8c\ud55c \uc788\ub294 \ud3ec\ud2b8\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ud638\uc2a4\ud2b8\uc758 443 \ub610\ub294 80\uc5d0 \ud3ec\ud2b8\ub97c \ub9e4\ud551\ud574\uc57c \ud558\ub294 \ucee8\ud14c\uc774\ub108\uac00 \uc788\ub294 \uacbd\uc6b0\ub97c \uc608\ub85c \ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>container_manage_cgroup</code> <code>off</code> \ucee8\ud14c\uc774\ub108\uac00 cgroup \uad6c\uc131\uc744 \uad00\ub9ac\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 systemd\ub97c \uc2e4\ud589\ud558\ub294 \ucee8\ud14c\uc774\ub108\ub294 \uc774 \uae30\ub2a5\uc744 \ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4. <code>container_use_cephfs</code> <code>off</code> \ucee8\ud14c\uc774\ub108\uac00 ceph \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. <p>\uae30\ubcf8\uc801\uc73c\ub85c \ucee8\ud14c\uc774\ub108\ub294 <code>/usr</code>\uc5d0\uc11c \uc77d\uace0 \uc2e4\ud589\ud560 \uc218 \uc788\uc73c\uba70 <code>/etc</code>\uc5d0\uc11c \ub300\ubd80\ubd84\uc758 \ucf58\ud150\uce20\ub97c \uc77d\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. <code>/var/lib/docker</code> \ubc0f <code>/var/lib/containers</code> \uc544\ub798\uc758 \ud30c\uc77c\uc5d0\ub294 <code>container_var_lib_t</code>\ub77c\ub294 \ub808\uc774\ube14\uc774 \ubd99\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8 \ub808\uc774\ube14\uc758 \uc804\uccb4 \ubaa9\ub85d\uc744 \ubcf4\ub824\uba74 container.fc \ud30c\uc77c\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <pre><code>docker container run -it \\\n  -v /var/lib/docker/image/overlay2/repositories.json:/host/repositories.json \\\n  centos:7 cat /host/repositories.json\n# cat: /host/repositories.json: Permission denied\n\ndocker container run -it \\\n  -v /etc/passwd:/host/etc/passwd \\\n  centos:7 cat /host/etc/passwd\n# cat: /host/etc/passwd: Permission denied\n</code></pre> <p><code>container_file_t</code>\ub85c \ub808\uc774\ube14\uc774 \uc9c0\uc815\ub41c \ud30c\uc77c\uc740 \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc4f8 \uc218 \uc788\ub294 \uc720\uc77c\ud55c \ud30c\uc77c\uc785\ub2c8\ub2e4. \ubcfc\ub968 \ub9c8\uc6b4\ud2b8\ub97c \uc4f0\uae30 \uac00\ub2a5\ud558\uac8c \ud558\ub824\uba74 \ub05d\uc5d0 <code>:z</code> \ub610\ub294 <code>:Z</code>\ub97c \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <ul> <li><code>:z</code> \ub294 \ucee8\ud14c\uc774\ub108\uac00 \uc77d\uace0 \uc4f8 \uc218 \uc788\ub3c4\ub85d \ud30c\uc77c\uc758 \ub808\uc774\ube14\uc744 \ub2e4\uc2dc \uc9c0\uc815\ud569\ub2c8\ub2e4.</li> <li><code>:Z</code> \ub294  \ucee8\ud14c\uc774\ub108\ub9cc \uc77d\uace0 \uc4f8 \uc218 \uc788\ub3c4\ub85d \ud30c\uc77c\uc5d0 \ub808\uc774\ube14\uc744 \ub2e4\uc2dc \uc9c0\uc815\ud569\ub2c8\ub2e4.</li> </ul> <pre><code>ls -Z /var/lib/misc\n# -rw-r--r--. root root system_u:object_r:var_lib_t:s0   postfix.aliasesdb-stamp\n\ndocker container run -it \\\n  -v /var/lib/misc:/host/var/lib/misc:z \\\n  centos:7 echo \"Relabeled!\"\n\nls -Z /var/lib/misc\n#-rw-r--r--. root root system_u:object_r:container_file_t:s0 postfix.aliasesdb-stamp\n</code></pre> <pre><code>docker container run -it \\\n  -v /var/log:/host/var/log:Z \\\n  fluentbit:latest\n</code></pre> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c\ub294 \ub808\uc774\ube14\uc744 \ub2e4\uc2dc \uc9c0\uc815\ud558\ub294 \ubc29\uc2dd\uc774 \uc57d\uac04 \ub2e4\ub985\ub2c8\ub2e4. Docker\uac00 \ud30c\uc77c\uc758 \ub808\uc774\ube14\uc744 \uc790\ub3d9\uc73c\ub85c \ub2e4\uc2dc \uc9c0\uc815\ud558\ub3c4\ub85d \ud558\ub294 \ub300\uc2e0 \uc0ac\uc6a9\uc790 \uc9c0\uc815 MCS \ub808\uc774\ube14\uc744 \uc9c0\uc815\ud558\uc5ec \ud30c\ub4dc\ub97c \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub808\uc774\ube14 \uc7ac\uc9c0\uc815\uc744 \uc9c0\uc6d0\ud558\ub294 \ubcfc\ub968\uc740 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \uc790\ub3d9\uc73c\ub85c \ub808\uc774\ube14\uc774 \ub2e4\uc2dc \uc9c0\uc815\ub429\ub2c8\ub2e4. MCS \ub808\uc774\ube14\uc774 \uc77c\uce58\ud558\ub294 \ud30c\ub4dc\ub294 \ud574\ub2f9 \ubcfc\ub968\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\ub2e4. \uc5c4\uaca9\ud55c \uaca9\ub9ac\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \uac01 \ud30c\ub4dc\uc5d0 \ub2e4\ub978 MCS \ub808\uc774\ube14\uc744 \uc124\uc815\ud558\uc138\uc694.</p> <pre><code>securityContext:\n  seLinuxOptions:\n    # Provide a unique MCS label per container\n    # You can specify user, role, and type also\n    # enforcement based on type and level (svert)\n    level: s0:c144:c154\n</code></pre> <p>\uc774 \uc608\uc81c\uc5d0\uc11c <code>s0:c144:c154</code>\ub294 \ucee8\ud14c\uc774\ub108\uc758 \uc561\uc138\uc2a4\uac00 \ud5c8\uc6a9\ub41c \ud30c\uc77c\uc5d0 \ud560\ub2f9\ub41c MCS \ub808\uc774\ube14\uc5d0 \ud574\ub2f9\ud569\ub2c8\ub2e4.</p> <p>EKS\uc5d0\uc11c\ub294 FluentD\uc640 \uac19\uc740 \uad8c\ud55c \uc788\ub294 \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uc815\ucc45\uc744 \uc0dd\uc131\ud558\uace0 \ud638\uc2a4\ud2b8 \ub514\ub809\ud130\ub9ac\uc5d0 \ub808\uc774\ube14\uc744 \ub2e4\uc2dc \uc9c0\uc815\ud560 \ud544\uc694 \uc5c6\uc774 \ud638\uc2a4\ud2b8\uc758 /var/log\uc5d0\uc11c \uc77d\uc744 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud558\ub294 SELinux \uc815\ucc45\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub808\uc774\ube14\uc774 \uac19\uc740 \ud30c\ub4dc\ub294 \ub3d9\uc77c\ud55c \ud638\uc2a4\ud2b8 \ubcfc\ub968\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>CentOS7 \ubc0f RHEL7\uc5d0 SELinux\uac00 \uad6c\uc131\ub41c Amazon EKS \uc0d8\ud50c AMI\ub97c \uad6c\ud604\ud588\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 AMI\ub294 STIG, CJIS, C2S\uc640 \uac19\uc774 \uaddc\uc81c\uac00 \uc5c4\uaca9\ud55c \uace0\uac1d\uc758 \uc694\uad6c \uc0ac\ud56d\uc744 \ucda9\uc871\ud558\ub294 \uc0d8\ud50c \uad6c\ud604\uc744 \uc2dc\uc5f0\ud558\uae30 \uc704\ud574 \uac1c\ubc1c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <p>Caution</p> <p>SELinux\ub294 \ud0c0\uc785\uc774 \uc81c\ud55c\ub418\uc9c0 \uc54a\uc740 \ucee8\ud14c\uc774\ub108\ub97c \ubb34\uc2dc\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/hosts/#_7","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<ul> <li>\uc628\ud504\ub808\ubbf8\uc2a4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc704\ud55c SELinux, \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC \ubc0f \ubcf4\uc548 \uc815\ucc45</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \ubc18\ubcf5\uc801 \ud558\ub4dc\ub2dd</li> <li>Audit2Allow</li> <li>SEAlert</li> <li>Udica\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c SELinux \uc815\ucc45 \uc0dd\uc131\uc740 Linux \uae30\ub2a5\uc5d0 \ub300\ud55c \ucee8\ud14c\uc774\ub108 \uc0ac\uc591 \ud30c\uc77c\uc744 \ud655\uc778\ud558\ub294 \ub3c4\uad6c\ub97c \uc124\uba85\ud569\ub2c8\ub2e4. \ud3ec\ud2b8, \ub9c8\uc6b4\ud2b8 \uc9c0\uc810, \ucee8\ud14c\uc774\ub108\uac00 \uc81c\ub300\ub85c \uc2e4\ud589\ub418\ub3c4\ub85d \ud558\ub294 \uc77c\ub828\uc758 SELinux \uaddc\uce59\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4.</li> <li>AMI Hardening\uc740 \ub2e4\uc591\ud55c \uaddc\uc81c \uc694\uad6c \uc0ac\ud56d\uc744 \ucda9\uc871\ud558\uae30 \uc704\ud574 OS\ub97c \uac15\ud654\ud558\uae30 \uc704\ud55c \ud50c\ub808\uc774\ubd81\uc785\ub2c8\ub2e4.</li> <li>Keiko Upgrade Manager\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc758 \ud68c\uc804\uc744 \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\uc158\ud558\ub294 Intuit\uc758 \uc624\ud508 \uc18c\uc2a4 \ud504\ub85c\uc81d\ud2b8\uc785\ub2c8\ub2e4.</li> <li>Sysdig Secure</li> <li>eksctl</li> </ul>"},{"location":"ko/security/docs/iam/","title":"\uc778\uc99d \ubc0f \uc811\uadfc \uad00\ub9ac","text":"<p>AWS IAM(Identity and Access Management)\uc740 \uc778\uc99d \ubc0f \uad8c\ud55c \ubd80\uc5ec\ub77c\ub294 \ub450 \uac00\uc9c0 \ud544\uc218 \uae30\ub2a5\uc744 \uc218\ud589\ud558\ub294 AWS \uc11c\ube44\uc2a4\uc785\ub2c8\ub2e4. \uc778\uc99d\uc5d0\ub294 \uc790\uaca9 \uc99d\uba85 \ud655\uc778\uc774 \ud3ec\ud568\ub418\ub294 \ubc18\uba74 \uad8c\ud55c \ubd80\uc5ec\ub294 AWS \ub9ac\uc18c\uc2a4\uc5d0\uc11c \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc791\uc5c5\uc744 \uad00\ub9ac\ud569\ub2c8\ub2e4. AWS \ub0b4\uc5d0\uc11c \ub9ac\uc18c\uc2a4\ub294 \ub2e4\ub978 AWS \uc11c\ube44\uc2a4(\uc608: EC2) \ub610\ub294 IAM \uc0ac\uc6a9\uc790 \ub610\ub294 IAM \uc5ed\ud560\uacfc \uac19\uc740 AWS \ubcf4\uc548 \uc8fc\uccb4\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub9ac\uc18c\uc2a4\uac00 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc791\uc5c5\uc744 \uad00\ub9ac\ud558\ub294 \uaddc\uce59\uc740 IAM \uc815\ucc45\uc73c\ub85c \ud45c\ud604\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#eks","title":"EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc811\uadfc \uc81c\uc5b4","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud504\ub85c\uc81d\ud2b8\ub294 \ubca0\uc5b4\ub7ec(Bearer) \ud1a0\ud070, X.509 \uc778\uc99d\uc11c, OIDC \ub4f1 kube-apiserver \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc694\uccad\uc744 \uc778\uc99d\ud558\uae30 \uc704\ud55c \ub2e4\uc591\ud55c \ubc29\uc2dd\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. EKS\ub294 \ud604\uc7ac \uc6f9\ud6c5(Webhook) \ud1a0\ud070 \uc778\uc99d, \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070 \ubc0f 2021\ub144 2\uc6d4 21\uc77c\ubd80\ud130 OIDC \uc778\uc99d\uc744 \uae30\ubcf8\uc801\uc73c\ub85c \uc9c0\uc6d0\ud569\ub2c8\ub2e4.  </p> <p>\uc6f9\ud6c5 \uc778\uc99d \ubc29\uc2dd\uc740 \ubca0\uc5b4\ub7ec \ud1a0\ud070\uc744 \ud655\uc778\ud558\ub294 \uc6f9\ud6c5\uc744 \ud638\ucd9c\ud569\ub2c8\ub2e4. EKS\uc5d0\uc11c \uc774\ub7f0 \ubca0\uc5b4\ub7ec \ud1a0\ud070\uc740 <code>kubectl</code> \uba85\ub839 \uc2e4\ud589 \uc2dc AWS CLI \ub610\ub294 aws-iam-authenticator \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \uc758\ud574 \uc0dd\uc131\ub429\ub2c8\ub2e4. \uba85\ub839\uc744 \uc2e4\ud589\ud558\uba74 \ud1a0\ud070\uc740 kube-apiserver\ub85c \uc804\ub2ec\ub418\uace0 \ub2e4\uc2dc \uc6f9\ud6c5\uc73c\ub85c \ud3ec\uc6cc\ub529\ub429\ub2c8\ub2e4. \uc694\uccad\uc774 \uc62c\ubc14\ub978 \ud615\uc2dd\uc774\uba74 \uc6f9\ud6c5\uc740 \ud1a0\ud070 \ubcf8\ubb38\uc5d0 \ud3ec\ud568\ub41c \ubbf8\ub9ac \uc11c\uba85\ub41c URL\uc744 \ud638\ucd9c\ud569\ub2c8\ub2e4. \uc774 URL\uc740 \uc694\uccad \uc11c\uba85\uc758 \uc720\ud6a8\uc131\uc744 \uac80\uc0ac\ud558\uace0 \uc0ac\uc6a9\uc790 \uc815\ubcf4(\uc0ac\uc6a9\uc790 \uc5b4\uce74\uc6b4\ud2b8, ARN \ubc0f \uc0ac\uc6a9\uc790 ID \ub4f1)\ub97c kube-apiserver\uc5d0 \ubc18\ud658\ud569\ub2c8\ub2e4.</p> <p>\uc778\uc99d \ud1a0\ud070\uc744 \uc218\ub3d9\uc73c\ub85c \uc0dd\uc131\ud558\ub824\uba74 \ud130\ubbf8\ub110 \ucc3d\uc5d0 \ub2e4\uc74c \uba85\ub839\uc744 \uc785\ub825\ud569\ub2c8\ub2e4.</p> <pre><code>aws eks get-token --cluster-name &lt;\ud074\ub7ec\uc2a4\ud130_\uc774\ub984&gt;\n</code></pre> <p>\ud504\ub85c\uadf8\ub798\ubc0d \ubc29\uc2dd\uc73c\ub85c \ud1a0\ud070\uc744 \uc5bb\uc744 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c\uc740 Go \uc5b8\uc5b4\ub85c \uc791\uc131\ub41c \uc608\uc785\ub2c8\ub2e4.</p> <pre><code>package main\n\nimport (\n \"fmt\"\n \"log\"\n \"sigs.k8s.io/aws-iam-authenticator/pkg/token\"\n)\n\nfunc main()  {\n g, _ := token.NewGenerator(false, false)\n tk, err := g.Get(\"&lt;cluster_name&gt;\")\n if err != nil {\n  log.Fatal(err)\n }\n fmt.Println(tk)\n}\n</code></pre> <p>\ucd9c\ub825 \uc751\ub2f5\uc740 \ub2e4\uc74c\uacfc \ud615\ud0dc\ub97c \uac00\uc9d1\ub2c8\ub2e4.</p> <pre><code>{\n  \"kind\": \"ExecCredential\", \n  \"apiVersion\": \"client.authentication.k8s.io/v1alpha1\", \n  \"spec\": {}, \n  \"status\": {\n    \"expirationTimestamp\": \"2020-02-19T16:08:27Z\", \n    \"token\": \"k8s-aws-v1.aHR0cHM6Ly9zdHMuYW1hem9uYXdzLmNvbS8_QWN0aW9uPUdldENhbGxlcklkZW50aXR5JlZlcnNpb249MjAxMS0wNi0xNSZYLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFKTkdSSUxLTlNSQzJXNVFBJTJGMjAyMDAyMTklMkZ1cy1lYXN0LTElMkZzdHMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDIwMDIxOVQxNTU0MjdaJlgtQW16LUV4cGlyZXM9NjAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JTNCeC1rOHMtYXdzLWlkJlgtQW16LVNpZ25hdHVyZT0yMjBmOGYzNTg1ZTMyMGRkYjVlNjgzYTVjOWE0MDUzMDFhZDc2NTQ2ZjI0ZjI4MTExZmRhZDA5Y2Y2NDhhMzkz\"\n  }\n}\n</code></pre> <p>\uac01 \ud1a0\ud070\uc740 <code>k8s-aws-v1.</code>\uc73c\ub85c \uc2dc\uc791\ud558\uace0 base64\ub85c \uc778\ucf54\ub529\ub41c \ubb38\uc790\uc5f4\uc774 \ub4a4\ub530\ub985\ub2c8\ub2e4. \ubb38\uc790\uc5f4\uc740 \ub514\ucf54\ub529\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \ud615\ud0dc\ub97c \uac00\uc9d1\ub2c8\ub2e4.</p> <pre><code>https://sts.amazonaws.com/?Action=GetCallerIdentity&amp;Version=2011-06-15&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=0KIAJPFRILKNSRC2W5QA%2F20200219%2F$REGION%2Fsts%2Faws4_request&amp;X-Amz-Date=20200219T155427Z&amp;X-Amz-Expires=60&amp;X-Amz-SignedHeaders=host%3Bx-k8s-aws-id&amp;X-Amz-Signature=BB0f8f3285e320ddb5e683a5c9a405301ad76546f24f28111fdad09cf648a393\n</code></pre> <p>\ud1a0\ud070\uc740 Amazon \uc790\uaca9 \uc99d\uba85 \ud06c\ub9ac\ub374\uc15c \ubc0f \uc11c\uba85\uc774 \ud3ec\ud568\ub41c \ubbf8\ub9ac \uc11c\uba85\ub41c URL\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 GetCallerIdentity API \ubb38\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p> <p>\ud1a0\ud070\uc740 15\ubd84\uc758 TTL \uc218\uba85\uc774 \uc788\uace0, \uc218\uba85 \uc885\ub958 \ud6c4\uc5d0\ub294 \uc0c8 \ud1a0\ud070\uc744 \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub294 <code>kubectl</code>\uacfc \uac19\uc740 \ud074\ub77c\uc774\uc5b8\ud2b8\ub97c \uc0ac\uc6a9\ud560 \ub54c \uc790\ub3d9\uc73c\ub85c \ucc98\ub9ac \ub418\uc9c0\ub9cc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub300\uc2dc\ubcf4\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ud1a0\ud070\uc774 \ub9cc\ub8cc\ub420 \ub54c\ub9c8\ub2e4 \uc0c8 \ud1a0\ud070\uc744 \uc0dd\uc131\ud558\uace0 \ub2e4\uc2dc \uc778\uc99d\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc0ac\uc6a9\uc790 ID\uac00 AWS IAM \uc11c\ube44\uc2a4\uc5d0 \uc758\ud574 \uc778\uc99d\ub418\uba74 kube-apiserver \ub294 'kube-system' \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c 'aws-auth' \ucee8\ud53c\uadf8\ub9f5\uc744 \uc77d\uc5b4 \uc0ac\uc6a9\uc790\uc640 \uc5f0\uacb0\ud560 RBAC \uadf8\ub8f9\uc744 \uacb0\uc815\ud569\ub2c8\ub2e4. <code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5 \uc740 IAM \ubcf4\uc548 \uc8fc\uccb4(\uc608: IAM \uc0ac\uc6a9\uc790 \ubc0f \uc5ed\ud560)\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC \uadf8\ub8f9 \uac04\uc758 \uc815\uc801 \ub9e4\ud551\uc744 \uc0dd\uc131\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. RBAC \uadf8\ub8f9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub864\ubc14\uc778\ub529 \ub610\ub294 \ud074\ub7ec\uc2a4\ud130\ub864\ubc14\uc778\ub529\uc5d0\uc11c \ucc38\uc870\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4(\uac1d\uccb4) \ubaa8\uc74c\uc5d0 \ub300\ud574 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc77c\ub828\uc758 \uc791\uc5c5(\ub3d9\uc0ac)\uc744 \uc815\uc758\ud55c\ub2e4\ub294 \uc810\uc5d0\uc11c IAM \uc5ed\ud560\uacfc \uc720\uc0ac\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_2","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/iam/#_3","title":"\uc778\uc99d\uc5d0 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070\uc744 \uc0ac\uc6a9\ud558\uc9c0 \ub9c8\uc138\uc694","text":"<p>\uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070\uc740 \uc218\uba85\uc774 \uae34 \uc815\uc801 \uc0ac\uc6a9\uc790 \uc778\uc99d \uc815\ubcf4\uc785\ub2c8\ub2e4. \uc190\uc0c1, \ubd84\uc2e4 \ub610\ub294 \ub3c4\ub09c\ub41c \uacbd\uc6b0 \uacf5\uaca9\uc790\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc774 \uc0ad\uc81c\ub420 \ub54c\uae4c\uc9c0 \ud574\ub2f9 \ud1a0\ud070\uacfc \uad00\ub828\ub41c \ubaa8\ub4e0 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uacbd\uc6b0\uc5d0 \ub530\ub77c \ud074\ub7ec\uc2a4\ud130 \uc678\ubd80\uc5d0\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \uc0ac\uc6a9\ud574\uc57c \ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158(\uc608: CI/CD \ud30c\uc774\ud504\ub77c\uc778 \uc560\ud50c\ub9ac\ucf00\uc774\uc158)\uc5d0 \ub300\ud55c \uc608\uc678\ub97c \ubd80\uc5ec\ud574\uc57c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 EC2 \uc778\uc2a4\ud134\uc2a4\uc640 \uac19\uc740 AWS \uc778\ud504\ub77c\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uacbd\uc6b0 \ub300\uc2e0 \uc778\uc2a4\ud134\uc2a4 \ud504\ub85c\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uace0 \uc774\ub97c 'aws-auth' \ucee8\ud53c\uadf8\ub9f5\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC \uc5ed\ud560\uc5d0 \ub9e4\ud551\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#aws","title":"AWS \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \ucd5c\uc18c \uad8c\ud55c \uc561\uc138\uc2a4 \uc0ac\uc6a9","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0 \uc561\uc138\uc2a4\ud558\uae30 \uc704\ud574 IAM \uc0ac\uc6a9\uc790\uc5d0\uac8c AWS \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \uad8c\ud55c\uc744 \ud560\ub2f9\ud560 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. IAM \uc0ac\uc6a9\uc790\uc5d0\uac8c EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \ud2b9\uc815 \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC \uadf8\ub8f9\uc5d0 \ub9e4\ud551\ub418\ub294 \ud574\ub2f9 \uc0ac\uc6a9\uc790 \uc758 'aws-auth' \ucee8\ud53c\uadf8\ub9f5\uc5d0 \ud56d\ubaa9\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#iam","title":"\uc5ec\ub7ec \uc0ac\uc6a9\uc790\uac00 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud574 \ub3d9\uc77c\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 IAM \uc5ed\ud560 \uc0ac\uc6a9","text":"<p>'aws-auth' \ucee8\ud53c\uadf8\ub9f5 \uc5d0\uc11c \uac01 \uac1c\ubcc4 IAM \uc0ac\uc6a9\uc790\uc5d0 \ub300\ud55c \ud56d\ubaa9\uc744 \uc0dd\uc131\ud558\ub294 \ub300\uc2e0 \ud574\ub2f9 \uc0ac\uc6a9\uc790\uac00 IAM \uc5ed\ud560\uc744 \uc218\uc784\ud558\uace0 \ud574\ub2f9 \uc5ed\ud560\uc744 \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC \uadf8\ub8f9\uc5d0 \ub9e4\ud551\ud558\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ud2b9\ud788 \uc561\uc138\uc2a4\uac00 \ud544\uc694\ud55c \uc0ac\uc6a9\uc790 \uc218\uac00 \uc99d\uac00\ud568\uc5d0 \ub530\ub77c \uc720\uc9c0 \uad00\ub9ac\uac00 \ub354 \uc26c\uc6cc\uc9d1\ub2c8\ub2e4.</p> <p>Attention</p> <p>aws-auth \ucee8\ud53c\uadf8\ub9f5\uc5d0 \uc758\ud574 \ub9e4\ud551\ub41c IAM \ubcf4\uc548 \uc8fc\uccb4\ub85c EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc561\uc138\uc2a4\ud560 \ub54c aws-auth \ucee8\ud53c\uadf8\ub9f5\uc5d0 \uc124\uba85\ub41c \uc0ac\uc6a9\uc790 \uc774\ub984\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac10\uc0ac \ub85c\uadf8\uc758 \uc0ac\uc6a9\uc790 \ud544\ub4dc\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4. IAM \uc5ed\ud560\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ud574\ub2f9 \uc5ed\ud560\uc744 \ub9e1\ub294 \uc2e4\uc81c \uc0ac\uc6a9\uc790\ub294 \uae30\ub85d\ub418\uc9c0 \uc54a\uc73c\uba70 \uac10\uc0ac\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</p> <p>aws-auth \ucee8\ud53c\uadf8\ub9f5\uc5d0\uc11c mapRoles\ub97c \uc0ac\uc6a9\ud558\uc5ec K8s RBAC \uad8c\ud55c\uc744 IAM \uc5ed\ud560\uc5d0 \ud560\ub2f9\ud560 \ub54c \uc0ac\uc6a9\uc790 \uc774\ub984\uc5d0 {{SessionName}}\uc744 \ud3ec\ud568\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uac10\uc0ac \ub85c\uadf8\uc5d0 \uc138\uc158 \uc774\ub984\uc774 \uae30\ub85d\ub418\ubbc0\ub85c CloudTrail \ub85c\uadf8\uc640 \ud568\uaed8 \uc774 \uc5ed\ud560\uc744 \ub9e1\uc740 \uc2e4\uc81c \uc0ac\uc6a9\uc790\ub97c \ucd94\uc801\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>- rolearn: arn:aws:iam::XXXXXXXXXXXX:role/testRole\n  username: testRole:{{SessionName}}\n  groups:\n    - system:masters\n</code></pre> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 1.20 \ub610\ub294 \uc774\ud6c4 \ubc84\uc804\uc5d0\uc11c\ub294 <code>User.Extra.sessionName.0</code>\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac10\uc0ac \ub85c\uadf8\uc5d0 \ucd94\uac00\ub418\uc5c8\uc73c\ubbc0\ub85c \uc774\ub7f0 \ubcc0\uacbd\uc774 \ub354 \uc774\uc0c1 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#rolebinding-clusterrolebinding","title":"\ub864\ubc14\uc778\ub529(RoleBinding) \ubc0f \ud074\ub7ec\uc2a4\ud130\ub864\ubc14\uc778\ub529(ClusterRoleBinding) \uc0dd\uc131 \uc2dc \ucd5c\uc18c \uad8c\ud55c \uc811\uadfc \ud5c8\uc6a9","text":"<p>AWS \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c \ubd80\uc5ec\uc5d0 \ub300\ud55c \uc774\uc804 \ud56d\ubaa9\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c \ub864\ubc14\uc778\ub529 \ubc0f \ud074\ub7ec\uc2a4\ud130\ub864\ubc14\uc778\ub529\uc5d0\ub294 \ud2b9\uc815 \uae30\ub2a5\uc744 \uc218\ud589\ud558\ub294 \ub370 \ud544\uc694\ud55c \uad8c\ud55c \uc9d1\ud569\ub9cc \ud3ec\ud568\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc808\ub300\uc801\uc73c\ub85c \ud544\uc694\ud55c \uacbd\uc6b0\uac00 \uc544\ub2c8\uba74 \ub864(Role) \ubc0f \ud074\ub7ec\uc2a4\ud130\ub864(ClusterRole)\uc5d0\uc11c <code>[\"*\"]</code> \ub97c \uc0ac\uc6a9\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624. \ud560\ub2f9\ud560 \uad8c\ud55c\uc774 \ud655\uc2e4\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 audit2rbac\uacfc \uac19\uc740 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac10\uc0ac \ub85c\uadf8\uc5d0\uc11c \uad00\ucc30\ub41c API \ud638\ucd9c\uc744 \uae30\ubc18\uc73c\ub85c \uc5ed\ud560 \ubc0f \ubc14\uc778\ub529\uc744 \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#eks_1","title":"EKS \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud504\ub77c\uc774\ube57\uc73c\ub85c \uc124\uc815","text":"<p>\uae30\ubcf8\uc801\uc73c\ub85c EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud560 \ub54c API \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub294 \ud37c\ube14\ub9ad\uc73c\ub85c \uc124\uc815\ub429\ub2c8\ub2e4. \uc989, \uc778\ud130\ub137\uc5d0\uc11c \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc778\ud130\ub137\uc5d0\uc11c \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc74c\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 \ubaa8\ub4e0 API \uc694\uccad\uc774 IAM\uc5d0 \uc758\ud574 \uc778\uc99d\ub418\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC\uc5d0 \uc758\ud574 \uc2b9\uc778\ub418\uc5b4\uc57c \ud558\uae30 \ub54c\ubb38\uc5d0 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub294 \uc5ec\uc804\ud788 \uc548\uc804\ud55c \uac83\uc73c\ub85c \uac04\uc8fc\ub429\ub2c8\ub2e4. \uc989, \ud68c\uc0ac \ubcf4\uc548 \uc815\ucc45\uc5d0 \ub530\ub77c \uc778\ud130\ub137\uc5d0\uc11c API\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud558\uac70\ub098 \ud074\ub7ec\uc2a4\ud130 VPC \uc678\ubd80\ub85c \ud2b8\ub798\ud53d\uc744 \ub77c\uc6b0\ud305\ud558\uc9c0 \ubabb\ud558\ub3c4\ub85d \ud558\ub294 \uacbd\uc6b0 \ub2e4\uc74c\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>EKS \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud504\ub77c\uc774\ube57\uc73c\ub85c \uad6c\uc131\ud569\ub2c8\ub2e4. \uc774 \uc8fc\uc81c\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc561\uc138\uc2a4 \uc218\uc815\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</li> <li>\ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud37c\ube14\ub9ad\uc73c\ub85c \ub450\uace0 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc640 \ud1b5\uc2e0\ud560 \uc218 \uc788\ub294 CIDR \ube14\ub85d\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. \ud574\ub2f9 \ube14\ub85d\uc740 \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ub41c \ud37c\ube14\ub9ad IP \uc8fc\uc18c \uc9d1\ud569\uc785\ub2c8\ub2e4.</li> <li>\ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub294 \uc811\uadfc\uc774 \ud5c8\uc6a9\ub41c \ud654\uc774\ud2b8\ub9ac\uc2a4\ud2b8 \uae30\ubc18\uc758 \uc77c\ubd80 CIDR \ube14\ub85d\uc5d0\ub9cc \ud5c8\uc6a9\ud558\uace0 \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud65c\uc131\ud654\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc774 \ud504\ub85c\ube44\uc800\ub2dd\ub420 \ub54c \ud074\ub7ec\uc2a4\ud130 VPC\uc5d0 \ud504\ub85c\ube44\uc800\ub2dd\ub418\ub294 \ud06c\ub85c\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 ENI\ub97c \ud1b5\ud574 kubelet\uacfc \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc0ac\uc774\uc758 \ubaa8\ub4e0 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d\uc744 \uac15\uc81c\ud558\ub294 \ub3d9\uc2dc\uc5d0 \ud2b9\uc815 \ud37c\ube14\ub9ad IP \ubc94\uc704\uc758 \ud37c\ube14\ub9ad \uc561\uc138\uc2a4\uac00 \ud5c8\uc6a9\ub429\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/iam/#iam_1","title":"\uc804\uc6a9 IAM \uc5ed\ud560\ub85c \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131","text":"<p>Amazon EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uba74 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\ub294 \uc5f0\ub3d9 \uc0ac\uc6a9\uc790\uc640 \uac19\uc740 IAM \uc5d4\ud130\ud2f0 \uc0ac\uc6a9\uc790 \ub610\ub294 \uc5ed\ud560\uc5d0 \ud074\ub7ec\uc2a4\ud130\uc758 RBAC \uad6c\uc131\uc5d0\uc11c <code>system:masters</code> \uad8c\ud55c\uc774 \uc790\ub3d9\uc73c\ub85c \ubd80\uc5ec\ub429\ub2c8\ub2e4. \uc774 \uc561\uc138\uc2a4\ub294 \uc81c\uac70\ud560 \uc218 \uc5c6\uc73c\uba70 <code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5\uc744 \ud1b5\ud574 \uad00\ub9ac\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc804\uc6a9 IAM \uc5ed\ud560\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uace0 \uc774 \uc5ed\ud560\uc744 \ub9e1\uc744 \uc218 \uc788\ub294 \uc0ac\ub78c\uc744 \uc815\uae30\uc801\uc73c\ub85c \uac10\uc0ac\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc774 \uc5ed\ud560\uc740 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc77c\uc0c1\uc801\uc778 \uc791\uc5c5\uc744 \uc218\ud589\ud558\ub294 \ub370 \uc0ac\uc6a9\ub418\uc5b4\uc11c\ub294 \uc548 \ub418\uba70, \ub300\uc2e0 \uc774\ub7f0 \ubaa9\uc801\uc744 \uc704\ud574 <code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5\uc744 \ud1b5\ud574 \ucd94\uac00 \uc0ac\uc6a9\uc790\uc5d0\uac8c \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud574\uc57c \ud569\ub2c8\ub2e4. <code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5\uc774 \uad6c\uc131\ub41c \uc774\ud6c4\uc5d0\ub294 \uc5ed\ud560\uc744 \uc0ad\uc81c\ud560 \uc218 \uc788\uc73c\uba70 <code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5\uc774 \uc190\uc0c1\ub418\uace0 \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc5c6\ub294 \uae34\uae09/\uc720\ub9ac \ud30c\uc190 \uc2dc\ub098\ub9ac\uc624\uc5d0\uc11c\ub9cc \ub2e4\uc2dc \uc0dd\uc131 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \uc9c1\uc811 \uc0ac\uc6a9\uc790 \uc561\uc138\uc2a4\uac00 \uad6c\uc131\ub418\uc9c0 \uc54a\uc740 \uc6b4\uc601 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud2b9\ud788 \uc720\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#aws-auth","title":"\ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec aws-auth \ucee8\ud53c\uadf8\ub9f5 \ubcc0\uacbd","text":"<p>\uc798\ubabb\ub41c \ud615\uc2dd\uc758 aws-auth \ucee8\ud53c\uadf8\ub9f5\uc73c\ub85c \uc778\ud574 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc811\uadfc \uad8c\ud55c\uc744 \uc783\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud53c\uadf8\ub9f5\uc744 \ubcc0\uacbd\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/iam/#eksctl","title":"eksctl","text":"<p><code>eksctl</code> CLI\uc5d0\ub294 aws-auth \ucee8\ud53c\uadf8\ub9f5\uc5d0 ID \ub9e4\ud551\uc744 \ucd94\uac00\ud558\uae30 \uc704\ud55c \uba85\ub839\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>CLI \ub3c4\uc6c0\ub9d0 \ubcf4\uae30:</p> <pre><code>eksctl create iamidentitymapping --help\n</code></pre> <p>IAM \uc5ed\ud560\uc744 \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\ub85c \uc9c0\uc815:</p> <pre><code> eksctl create iamidentitymapping --cluster  &lt;clusterName&gt; --region=&lt;region&gt; --arn arn:aws:iam::123456:role/testing --group system:masters --username admin\n</code></pre> <p>\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 <code>eksctl</code> \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>keikoproj\uc758 aws-auth</p> <p>keikoproj\uc758 <code>aws-auth</code> \uc5d0\ub294 cli \ubc0f go \ub77c\uc774\ube0c\ub7ec\ub9ac\uac00 \ubaa8\ub450 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>CLI \ub3c4\uc6c0\ub9d0 \ub2e4\uc6b4\ub85c\ub4dc \ubc0f \ubcf4\uae30:</p> <pre><code>go get github.com/keikoproj/aws-auth\naws-auth help\n</code></pre> <p>\ub610\ub294 kubectl\uc6a9 krew \ud50c\ub7ec\uadf8\uc778 \uad00\ub9ac\uc790\ub85c <code>aws-auth</code> \ub97c \uc124\uce58 \ud569\ub2c8\ub2e4.</p> <pre><code>kubectl krew install aws-auth\nkubectl aws-auth\n</code></pre> <p>go \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \ube44\ub86f\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 GitHub \ub0b4 aws-auth \ubb38\uc11c\ub97c \ud655\uc778\ud558\uc2ed\uc2dc\uc624.</p> <p>AWS IAM Authenticator CLI</p> <p><code>aws-iam-authenticator</code> \ud504\ub85c\uc81d\ud2b8\uc5d0\ub294 \ucee8\ud53c\uadf8\ub9f5\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\uae30 \uc704\ud55c CLI\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>GitHub\uc5d0\uc11c \ub9b4\ub9ac\uc2a4 \ub2e4\uc6b4\ub85c\ub4dc\ud558\uc138\uc694.</p> <p>IAM \uc5ed\ud560\uc5d0 \ud074\ub7ec\uc2a4\ud130 \uad8c\ud55c\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4:</p> <pre><code>./aws-iam-authenticator add role --rolearn arn:aws:iam::185309785115:role/lil-dev-role-cluster --username lil-dev-user --groups system:masters --kubeconfig ~/.kube/config\n</code></pre>"},{"location":"ko/security/docs/iam/#_4","title":"\ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uc811\uadfc\uc744 \uc815\uae30\uc801\uc73c\ub85c \uac10\uc0ac\ud569\ub2c8\ub2e4","text":"<p>\ud074\ub7ec\uc2a4\ud130\uc5d0 \uc811\uadfc\uc774 \ud544\uc694\ud55c \uc0ac\ub78c\uc740 \uc2dc\uac04\uc774 \uc9c0\ub0a8\uc5d0 \ub530\ub77c \ubcc0\uacbd\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc8fc\uae30\uc801\uc73c\ub85c <code>aws-auth</code> \ucee8\ud53c\uadf8\ub9f5\uc744 \uac10\uc0ac\ud558\uc5ec \uc811\uadfc \uad8c\ud55c\uc774 \ubd80\uc5ec\ub41c \uc0ac\ub78c\uacfc \ud560\ub2f9\ub41c \uad8c\ud55c\uc744 \ud655\uc778\ud558\uc2ed\uc2dc\uc624. \ud2b9\uc815 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8, \uc0ac\uc6a9\uc790 \ub610\ub294 \uadf8\ub8f9\uc5d0 \ubc14\uc778\ub529\ub41c \uc5ed\ud560\uc744 \uac80\uc0ac\ud558\uae30 \uc704\ud574 kubectl-who-can \ub610\ub294 rbac-lookup\uacfc \uac19\uc740 \uc624\ud508 \uc18c\uc2a4 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ud574\ub2f9 \uc8fc\uc81c\uc5d0 \ub300\ud574\uc11c\ub294 \uac10\uc0ac\uc139\uc158\uc5d0\uc11c \ub354 \uc790\uc138\ud788 \uc0b4\ud3b4 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4. \ucd94\uac00 \uc544\uc774\ub514\uc5b4\ub294 NCC Group\uc758 \uc774 \uae30\uc0ac\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_5","title":"\uc778\uc99d \ubc0f \uc561\uc138\uc2a4 \uad00\ub9ac\uc5d0 \ub300\ud55c \ub300\uccb4 \uc811\uadfc \ubc29\uc2dd","text":"<p>IAM\uc740 EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc561\uc138\uc2a4\ud574\uc57c \ud558\ub294 \uc0ac\uc6a9\uc790\ub97c \uc778\uc99d\ud558\ub294 \ub370 \uc120\ud638\ub418\ub294 \ubc29\ubc95\uc774\uc9c0\ub9cc, \uc778\uc99d \ud504\ub85d\uc2dc \ub610\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 impersonation\ub4f1\uc744 \uc0ac\uc6a9\ud558\ub294 GitHub\uc640 \uac19\uc740 OIDC ID \uacf5\uae09\uc790\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \ub450 \uac00\uc9c0 \uc194\ub8e8\uc158\uc5d0 \ub300\ud55c \uac8c\uc2dc\ubb3c\uc774 AWS \uc624\ud508 \uc18c\uc2a4 \ube14\ub85c\uadf8\uc5d0 \uac8c\uc2dc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <ul> <li>Teleport\uc640 \ud568\uaed8 GitHub \uc790\uaca9 \uc99d\uba85\uc744 \uc0ac\uc6a9\ud558\uc5ec EKS\uc5d0 \uc778\uc99d</li> <li>kube-oidc-proxy\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc5ec\ub7ec EKS \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc77c\uad00\ub41c OIDC \uc778\uc99d</li> </ul> <p>Attention</p> <p>EKS\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ud504\ub85d\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 OIDC \uc778\uc99d\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Amazon EKS\uc5d0 \ub300\ud55c OIDC \uc790\uaca9 \uc99d\uba85 \uacf5\uae09\uc790 \uc778\uc99d \uc18c\uac1c\ube14\ub85c\uadf8\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624. \ub2e4\uc591\ud55c \uc778\uc99d \ubc29\ubc95\uc5d0 \ub300\ud55c \ucee4\ub125\ud130\ub97c \uc81c\uacf5\ud558\ub294 \uc778\uae30 \uc788\ub294 \uc624\ud508 \uc18c\uc2a4 OIDC \uacf5\uae09\uc790\uc778 Dex\ub85c EKS\ub97c \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uc744 \ubcf4\uc5ec\uc8fc\ub294 \uc608\ub294 Dex \ubc0f dex-k8s-authenticator\ub97c \uc0ac\uc6a9\ud558\uc5ec Amazon EKS \uc778\uc99d \ube14\ub85c\uadf8\ub97c \ucc38\uc870\ud558\uc138\uc694. \ube14\ub85c\uadf8\uc5d0 \uc124\uba85\ub41c \ub300\ub85c OIDC \uacf5\uae09\uc790\uac00 \uc778\uc99d\ud55c \uc0ac\uc6a9\uc790 \uc774\ub984/\uc0ac\uc6a9\uc790 \uadf8\ub8f9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac10\uc0ac \ub85c\uadf8\uc5d0 \ub098\ud0c0\ub0a9\ub2c8\ub2e4.</p> <p>\ub610\ud55c AWS SSO\ub97c \uc0ac\uc6a9\ud558\uc5ec Azure AD\uc640 \uac19\uc740 \uc678\ubd80 \uc790\uaca9 \uc99d\uba85 \uacf5\uae09\uc790\uc640 AWS\ub97c \ud398\ub354\ub808\uc774\uc158\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \uc0ac\uc6a9\ud558\uae30\ub85c \uacb0\uc815\ud55c \uacbd\uc6b0 AWS CLI v2.0\uc5d0\ub294 SSO \uc138\uc158\uc744 \ud604\uc7ac CLI \uc138\uc158\uacfc \uc27d\uac8c \uc5f0\uacb0\ud558\uace0 IAM \uc5ed\ud560\uc744 \uc218\uc784\ud560 \uc218 \uc788\ub294 \uba85\uba85\ub41c \ud504\ub85c\ud30c\uc77c\uc744 \uc0dd\uc131\ud558\ub294 \uc635\uc158\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9\uc790\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC \uadf8\ub8f9\uc744 \uacb0\uc815\ud558\ub294 \ub370 IAM \uc5ed\ud560\uc774 \uc0ac\uc6a9\ub418\ubbc0\ub85c <code>kubectl</code> \uc744 \uc2e4\ud589\ud558\uae30 \"\uc804\" \uc5ed\ud560\uc744 \uc218\uc784(Assume)\ud558\uc5ec\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_6","title":"\ucd94\uac00 \ub9ac\uc18c\uc2a4","text":"<p>rbac.dev \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC\uc5d0 \ub300\ud55c \ube14\ub85c\uadf8 \ubc0f \ub3c4\uad6c\ub97c \ud3ec\ud568\ud55c \ucd94\uac00 \ub9ac\uc18c\uc2a4 \ubaa9\ub85d</p>"},{"location":"ko/security/docs/iam/#_7","title":"\ud30c\ub4dc \uc544\uc774\ub374\ud2f0\ud2f0","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud2b9\uc815 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \uc81c\ub300\ub85c \uc791\ub3d9\ud558\uae30 \uc704\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \ud638\ucd9c\ud560 \uc218 \uc788\ub294 \uad8c\ud55c\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 AWS \ub85c\ub4dc\ubc38\ub7f0\uc11c \ucee8\ud2b8\ub864\ub7ec\ub294 \uc11c\ube44\uc2a4\uc758 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ub098\uc5f4\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \ub610\ud55c \ucee8\ud2b8\ub864\ub7ec\ub294 ALB\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uace0 \uad6c\uc131\ud558\uae30 \uc704\ud574 AWS API\ub97c \ud638\ucd9c\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774 \uc139\uc158\uc5d0\uc11c\ub294 \ud30c\ub4dc\uc5d0 \uad8c\ud55c\uc744 \ud560\ub2f9\ud558\ub294 \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc0b4\ud3b4\ubd05\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_8","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8","text":"<p>\uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub294 \ud30c\ub4dc\uc5d0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC \uc5ed\ud560\uc744 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 \ud2b9\uc218\ud55c \uc720\ud615\uc758 \uac1c\uccb4\uc785\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc758 \uac01 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ub300\ud574 \uae30\ubcf8 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc774 \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ub429\ub2c8\ub2e4. \ud2b9\uc815 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc744 \ucc38\uc870\ud558\uc9c0 \uc54a\uace0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ud30c\ub4dc\ub97c \ubc30\ud3ec\ud558\uba74, \ud574\ub2f9 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \uae30\ubcf8 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc774 \uc790\ub3d9\uc73c\ub85c \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ub418\uace0 \uc2dc\ud06c\ub9bf, \uc989 \ud574\ub2f9 \uc11c\ube44\uc2a4 \uc544\uce74\uc6b4\ud2b8\uc758 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 (JWT) \ud1a0\ud070\uc740 <code>/var/run/secrets/kubernetes.io/serviceaccount</code>\uc5d0\uc11c \ubcfc\ub968\uc73c\ub85c \ud30c\ub4dc\uc5d0 \ub9c8\uc6b4\ud2b8\ub429\ub2c8\ub2e4. \ud574\ub2f9 \ub514\ub809\ud130\ub9ac\uc758 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070\uc744 \ub514\ucf54\ub529\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \uba54\ud0c0\ub370\uc774\ud130\uac00 \ub098\ud0c0\ub0a9\ub2c8\ub2e4.</p> <pre><code>{\n  \"iss\": \"kubernetes/serviceaccount\",\n  \"kubernetes.io/serviceaccount/namespace\": \"default\",\n  \"kubernetes.io/serviceaccount/secret.name\": \"default-token-5pv4z\",\n  \"kubernetes.io/serviceaccount/service-account.name\": \"default\",\n  \"kubernetes.io/serviceaccount/service-account.uid\": \"3b36ddb5-438c-11ea-9438-063a49b60fba\",\n  \"sub\": \"system:serviceaccount:default:default\"\n}\n</code></pre> <p>\uae30\ubcf8 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc5d0\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0 \ub300\ud55c \ub2e4\uc74c \uad8c\ud55c\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  creationTimestamp: \"2020-01-30T18:13:25Z\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:discovery\n  resourceVersion: \"43\"\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/system%3Adiscovery\n  uid: 350d2ab8-438c-11ea-9438-063a49b60fba\nrules:\n- nonResourceURLs:\n  - /api\n  - /api/*\n  - /apis\n  - /apis/*\n  - /healthz\n  - /openapi\n  - /openapi/*\n  - /version\n  - /version/\n  verbs:\n  - get\n</code></pre> <p>\uc774 \uc5ed\ud560\uc740 \uc778\uc99d\ub418\uc9c0 \uc54a\uc740 \uc0ac\uc6a9\uc790\uc640 \uc778\uc99d\ub41c \uc0ac\uc6a9\uc790\uac00 API \uc815\ubcf4\ub97c \uc77d\uc744 \uc218 \uc788\ub294 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud558\uba70 \uacf5\uac1c\uc801\uc73c\ub85c \uc561\uc138\uc2a4\ud574\ub3c4 \uc548\uc804\ud55c \uac83\uc73c\ub85c \uac04\uc8fc\ub429\ub2c8\ub2e4.</p> <p>\ud30c\ub4dc \ub0b4\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \ud638\ucd9c\ud560 \ub54c \ud574\ub2f9 API\ub97c \ud638\ucd9c\ud560 \uc218 \uc788\ub294 \uad8c\ud55c\uc744 \uba85\uc2dc\uc801\uc73c\ub85c \ubd80\uc5ec\ud558\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ud574\uc57c \ud569\ub2c8\ub2e4. \uc0ac\uc6a9\uc790 \uc811\uadfc\uc5d0 \ub300\ud55c \uc9c0\uce68\uacfc \uc720\uc0ac\ud558\uac8c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc5d0 \ubc14\uc778\ub529\ub41c Role \ub610\ub294 ClusterRole\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc791\ub3d9\ud558\ub294 \ub370 \ud544\uc694\ud55c API \ub9ac\uc18c\uc2a4 \ubc0f \uba54\uc11c\ub4dc\ub85c \uc81c\ud55c\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uae30\ubcf8\uc774 \uc544\ub2cc \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \ud30c\ub4dc\uc758 <code>spec.serviceAccountName</code> \ud544\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub824\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc758 \uc774\ub984\uc73c\ub85c \uc124\uc815\ud558\uae30\ub9cc \ud558\uba74 \ub429\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uc0dd\uc131\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 \ud574\ub2f9 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>Note</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 1.24 \uc774\uc804\uc5d0\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uac01 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc5d0 \ub300\ud55c \uc554\ud638\ub97c \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ud588\uc2b5\ub2c8\ub2e4. \uc774 \uc2dc\ud06c\ub9bf\uc740 \ud30c\ub4dc \ub0b4 /var/run/secrets/kubernetes.io/serviceaccount \uacbd\ub85c\ub85c \ub9c8\uc6b4\ud2b8\ub418\uc5c8\uc73c\uba70 \ud30c\ub4dc\uc5d0\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\ub97c \uc778\uc99d\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 1.24\uc5d0\uc11c\ub294 \ud30c\ub4dc\uac00 \uc2e4\ud589\ub420 \ub54c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070\uc774 \ub3d9\uc801\uc73c\ub85c \uc0dd\uc131\ub418\uba70 \uae30\ubcf8\uc801\uc73c\ub85c 1\uc2dc\uac04 \ub3d9\uc548\ub9cc \uc720\ud6a8\ud569\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc758 \uc2dc\ud06c\ub9bf\uc740 \uc0dd\uc131\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. Jenkins\uc640 \uac19\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0 \uc778\uc99d\ud574\uc57c \ud558\ub294 \ud074\ub7ec\uc2a4\ud130 \uc678\ubd80\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc788\ub294 \uacbd\uc6b0, <code>metadata.annotations.kubernetes.io/service-account.name: &lt;SERVICE_ACCOUNT_NAME&gt;</code>\uc640 \uac19\uc740 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \ucc38\uc870\ud558\ub294 \uc5b4\ub178\ud14c\uc774\uc158\uacfc \ud568\uaed8 <code>kubernetes.io/service-account-token</code> \uc720\ud615\uc758 \uc2dc\ud06c\ub9bf\uc744 \uc0dd\uc131\ud574\uc57c \ud55c\ub2e4. \uc774 \ubc29\ubc95\uc73c\ub85c \uc0dd\uc131\ub41c \uc2dc\ud06c\ub9bf\uc740 \ub9cc\ub8cc\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#iam-irsa","title":"\uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc6a9 IAM \uc5ed\ud560(IRSA)","text":"<p>IRSA\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc5d0 IAM \uc5ed\ud560\uc744 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc785\ub2c8\ub2e4. Service Account Token Volume Projection\uc774\ub77c\ub294  \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ub2a5\uc744 \ud65c\uc6a9\ud558\uc5ec \uc791\ub3d9\ud569\ub2c8\ub2e4. \ud30c\ub4dc\uac00 IAM \uc5ed\ud560\uc744 \ucc38\uc870\ud558\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc73c\ub85c \uad6c\uc131\ub41c \uacbd\uc6b0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\ub294 \uc2dc\uc791 \uc2dc \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uacf5\uac1c OIDC \uac80\uc0c9 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ud638\ucd9c\ud569\ub2c8\ub2e4. \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub294 Kubernetes\uc5d0\uc11c \ubc1c\ud589\ud55c OIDC \ud1a0\ud070\uc5d0 \uc554\ud638\ub85c \uc11c\uba85\ud558\uace0, \uc0dd\uc131\ub41c \ud1a0\ud070\uc740 \ubcfc\ub968\uc73c\ub85c \ub9c8\uc6b4\ud2b8\ub429\ub2c8\ub2e4. \uc774 \uc11c\uba85\ub41c \ud1a0\ud070\uc744 \ud1b5\ud574 \ud30c\ub4dc\ub294 IAM \uc5ed\ud560\uacfc \uc5f0\uacb0\ub41c AWS API\ub97c \ud638\ucd9c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. AWS API\uac00 \ud638\ucd9c\ub418\uba74 AWS SDK\ub294 <code>sts:AssumeRoleWithWebIdentity</code>\ub97c \ud638\ucd9c\ud569\ub2c8\ub2e4. \ud1a0\ud070\uc758 \uc11c\uba85\uc744 \ud655\uc778\ud55c \ud6c4 IAM\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ubc1c\ud589\ud55c \ud1a0\ud070\uc744 \uc784\uc2dc AWS \uc5ed\ud560 \uc790\uaca9 \uc99d\uba85\uc73c\ub85c \uad50\ud658\ud569\ub2c8\ub2e4.</p> <p>IRSA\uc5d0 \ub300\ud55c (JWT)\ud1a0\ud070\uc744 \ub514\ucf54\ub529\ud558\uba74 \uc544\ub798\uc5d0 \ud45c\uc2dc\ub41c \uc608\uc640 \uc720\uc0ac\ud55c \ucd9c\ub825\uc774 \uc0dd\uc131\ub429\ub2c8\ub2e4.</p> <pre><code>{\n  \"aud\": [\n    \"sts.amazonaws.com\"\n  ],\n  \"exp\": 1582306514,\n  \"iat\": 1582220114,\n  \"iss\": \"https://oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128\",\n  \"kubernetes.io\": {\n    \"namespace\": \"default\",\n    \"pod\": {\n      \"name\": \"alpine-57b5664646-rf966\",\n      \"uid\": \"5a20f883-5407-11ea-a85c-0e62b7a4a436\"\n    },\n    \"serviceaccount\": {\n      \"name\": \"s3-read-only\",\n      \"uid\": \"a720ba5c-5406-11ea-9438-063a49b60fba\"\n    }\n  },\n  \"nbf\": 1582220114,\n  \"sub\": \"system:serviceaccount:default:s3-read-only\"\n}\n</code></pre> <p>\uc774 \ud2b9\uc815 \ud1a0\ud070\uc740 \ud30c\ub4dc\uc5d0 S3 \ubcf4\uae30 \uc804\uc6a9 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud569\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 S3\uc5d0\uc11c \uc77d\uae30\ub97c \uc2dc\ub3c4\ud558\uba74 \ud1a0\ud070\uc774 \ub2e4\uc74c\uacfc \uc720\uc0ac\ud55c \uc784\uc2dc IAM \uc790\uaca9 \uc99d\uba85 \uc138\ud2b8\ub85c \uad50\ud658\ub429\ub2c8\ub2e4.</p> <pre><code>{\n    \"AssumedRoleUser\": {\n        \"AssumedRoleId\": \"AROA36C6WWEJULFUYMPB6:abc\", \n        \"Arn\": \"arn:aws:sts::123456789012:assumed-role/eksctl-winterfell-addon-iamserviceaccount-de-Role1-1D61LT75JH3MB/abc\"\n    }, \n    \"Audience\": \"sts.amazonaws.com\", \n    \"Provider\": \"arn:aws:iam::123456789012:oidc-provider/oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128\", \n    \"SubjectFromWebIdentityToken\": \"system:serviceaccount:default:s3-read-only\", \n    \"Credentials\": {\n        \"SecretAccessKey\": \"ORJ+8Adk+wW+nU8FETq7+mOqeA8Z6jlPihnV8hX1\", \n        \"SessionToken\": \"FwoGZXIvYXdzEGMaDMLxAZkuLpmSwYXShiL9A1S0X87VBC1mHCrRe/pB2oes+l1eXxUYnPJyC9ayOoXMvqXQsomq0xs6OqZ3vaa5Iw1HIyA4Cv1suLaOCoU3hNvOIJ6C94H1vU0siQYk7DIq9Av5RZe+uE2FnOctNBvYLd3i0IZo1ajjc00yRK3v24VRq9nQpoPLuqyH2jzlhCEjXuPScPbi5KEVs9fNcOTtgzbVf7IG2gNiwNs5aCpN4Bv/Zv2A6zp5xGz9cWj2f0aD9v66vX4bexOs5t/YYhwuwAvkkJPSIGvxja0xRThnceHyFHKtj0H+bi/PWAtlI8YJcDX69cM30JAHDdQH+ltm/4scFptW1hlvMaP+WReCAaCrsHrAT+yka7ttw5YlUyvZ8EPog+j6fwHlxmrXM9h1BqdikomyJU00gm1++FJelfP+1zAwcyrxCnbRl3ARFrAt8hIlrT6Vyu8WvWtLxcI8KcLcJQb/LgkW+sCTGlYcY8z3zkigJMbYn07ewTL5Ss7LazTJJa758I7PZan/v3xQHd5DEc5WBneiV3iOznDFgup0VAMkIviVjVCkszaPSVEdK2NU7jtrh6Jfm7bU/3P6ZG+CkyDLIa8MBn9KPXeJd/y+jTk5Ii+fIwO/+mDpGNUribg6TPxhzZ8b/XdZO1kS1gVgqjXyVC+M+BRBh6C4H21w/eMzjCtDIpoxt5rGKL6Nu/IFMipoC4fgx6LIIHwtGYMG7SWQi7OsMAkiwZRg0n68/RqWgLzBt/4pfjSRYuk=\", \n        \"Expiration\": \"2020-02-20T18:49:50Z\", \n        \"AccessKeyId\": \"0SIA12CFWWEJUMHACL7Z\"\n    }\n}\n</code></pre> <p>EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \uc77c\ubd80\ub85c \uc2e4\ud589\ub418\ub294 Mutating \uc6f9\ud6c5\uc740 AWS \uc5ed\ud560 ARN\uacfc \uc6f9 \uc790\uaca9 \uc99d\uba85 \ud1a0\ud070 \ud30c\uc77c\uc758 \uacbd\ub85c\ub97c \ud658\uacbd \ubcc0\uc218\ub85c \ud30c\ub4dc\uc5d0 \uc8fc\uc785\ud569\ub2c8\ub2e4. \uc774\ub7f0 \uac12\uc740 \uc218\ub3d9\uc73c\ub85c \uc81c\uacf5\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>AWS_ROLE_ARN=arn:aws:iam::AWS_ACCOUNT_ID:role/IAM_ROLE_NAME\nAWS_WEB_IDENTITY_TOKEN_FILE=/var/run/secrets/eks.amazonaws.com/serviceaccount/token\n</code></pre> <p>kubelet\uc740 \ucd1d TTL\uc758 80%\ubcf4\ub2e4 \uc624\ub798\ub418\uac70\ub098 24\uc2dc\uac04\uc774 \uc9c0\ub098\uba74 \ud504\ub85c\uc81d\uc158\ub41c \ud1a0\ud070\uc744 \uc790\ub3d9\uc73c\ub85c \uad50\uccb4\ud569\ub2c8\ub2e4. AWS SDK\ub294 \ud1a0\ud070\uc774 \ud68c\uc804\ud560 \ub54c \ud1a0\ud070\uc744 \ub2e4\uc2dc \ub85c\ub4dc\ud558\ub294 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4. IRSA\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 AWS \ubb38\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#id","title":"\ud3ec\ub4dc ID \uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/iam/#irsa-aws-node","title":"IRSA\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d aws-node \ub370\ubaac\uc14b \uc5c5\ub370\uc774\ud2b8","text":"<p>\ud604\uc7ac aws-node \ub370\ubaac\uc14b\uc740 EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ud560\ub2f9\ub41c \uc5ed\ud560\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\uc5d0 IP\ub97c \ud560\ub2f9\ud558\ub3c4\ub85d \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc5ed\ud560\uc5d0\ub294 AmazonEKS_CNI_Policy \ubc0f EC2ContainerRegistryReadOnly\uc640 \uac19\uc774 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ubaa8\ub4e0 \ud30c\ub4dc\uac00 ENI\ub97c \uc5f0\uacb0/\ubd84\ub9ac\ud558\uac70\ub098, IP \uc8fc\uc18c\ub97c \ud560\ub2f9/\ud560\ub2f9 \ud574\uc81c\ud558\uac70\ub098, ECR\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\ub3c4\ub85d \ud6a8\uacfc\uc801\uc73c\ub85c \ud5c8\uc6a9\ud558\ub294 \uba87 \uac00\uc9c0 AWS \uad00\ub9ac\ud615 \uc815\ucc45\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4. \uc774\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc704\ud5d8\uc744 \ucd08\ub798\ud558\ubbc0\ub85c IRSA\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d aws-node \ub370\ubaac\uc14b\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud558\uae30 \uc704\ud55c \uc2a4\ud06c\ub9bd\ud2b8\ub294 \uc774 \uac00\uc774\ub4dc\uc758 \ub9ac\ud30c\uc9c0\ud1a0\ub9ac\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_9","title":"\uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ud560\ub2f9\ub41c \uc778\uc2a4\ud134\uc2a4 \ud504\ub85c\ud30c\uc77c\uc5d0 \ub300\ud55c \uc811\uadfc \uc81c\ud55c","text":"<p>IRSA\ub97c \uc0ac\uc6a9\ud558\uba74 IRSA \ud1a0\ud070\uc744 \uc0ac\uc6a9\ud558\ub3c4\ub85d \ud30c\ub4dc\uc758 \uc790\uaca9 \uc99d\uba85 \uccb4\uc778\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0\ub9cc \ud30c\ub4dc\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ud560\ub2f9\ub41c \uc778\uc2a4\ud134\uc2a4 \ud504\ub85c\ud30c\uc77c\uc758 \uad8c\ud55c\uc744 \uacc4\uc18d \uc0c1\uc18d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. IRSA \uc0ac\uc6a9 \uc2dc \ud5c8\uc6a9\ub418\uc9c0 \uc54a\uc740 \uad8c\ud55c\uc758 \ubc94\uc704\ub97c \ucd5c\uc18c\ud654\ud558\uae30 \uc704\ud574 \uc778\uc2a4\ud134\uc2a4 \uba54\ud0c0\ub370\uc774\ud130 \uc561\uc138\uc2a4\ub97c \ucc28\ub2e8\ud558\ub294 \uac83\uc774 \uac15\ub825\ud558\uac8c \uad8c\uc7a5\ub429\ub2c8\ub2e4.</p> <p>Caution</p> <p>\uc778\uc2a4\ud134\uc2a4 \uba54\ud0c0\ub370\uc774\ud130\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \ucc28\ub2e8\ud558\uba74 IRSA\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \ud30c\ub4dc\uac00 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ud560\ub2f9\ub41c \uc5ed\ud560\uc744 \uc0c1\uc18d\ubc1b\uc9c0 \ubabb\ud569\ub2c8\ub2e4.</p> <p>\uc544\ub798 \uc608\uc640 \uac19\uc774 \uc778\uc2a4\ud134\uc2a4\uac00 IMDSv2\ub9cc \uc0ac\uc6a9\ud558\ub3c4\ub85d \ud558\uace0 \ud649 \uc81c\ud55c\uc744 1\ub85c \uc5c5\ub370\uc774\ud2b8\ud558\uc5ec \uc778\uc2a4\ud134\uc2a4 \uba54\ud0c0\ub370\uc774\ud130\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \ucc28\ub2e8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ub4dc \uadf8\ub8f9\uc758 \uc2dc\uc791 \ud15c\ud50c\ub9bf\uc5d0 \uc774\ub7f0 \uc124\uc815\uc744 \ud3ec\ud568\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4 \uba54\ud0c0\ub370\uc774\ud130\ub97c \ube44\ud65c\uc131\ud654 \ud558\uc9c0\ub9c8\uc138\uc694. \uc774\ub807\uac8c \ud558\uba74 \ub178\ub4dc \uc885\ub8cc \ud578\ub4e4\ub7ec\uc640 \uac19\uc740 \uad6c\uc131 \uc694\uc18c\uc640 \uc778\uc2a4\ud134\uc2a4 \uba54\ud0c0\ub370\uc774\ud130\uc5d0 \uc758\uc874\ud558\ub294 \uae30\ud0c0 \uc694\uc18c\uac00 \uc81c\ub300\ub85c \uc791\ub3d9\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <pre><code>aws ec2 modify-instance-metadata-options --instance-id &lt;value&gt; --http-tokens required --http-put-response-hop-limit 1\n</code></pre> <p>Terraform\uc744 \uc0ac\uc6a9\ud558\uc5ec \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uacfc \ud568\uaed8 \uc0ac\uc6a9\ud560 \uc2dc\uc791 \ud15c\ud50c\ub9bf\uc744 \ub9cc\ub4dc\ub294 \uacbd\uc6b0 \uba54\ud0c0\ub370\uc774\ud130 \ube14\ub85d\uc744 \ucd94\uac00\ud558\uc5ec \ub2e4\uc74c \ucf54\ub4dc \uc2a4\ub2c8\ud3ab\uc5d0 \ud45c\uc2dc\ub41c \ub300\ub85c \ud649 \uc218\ub97c \uad6c\uc131\ud558\uc2ed\uc2dc\uc624.</p> <pre><code>resource \"aws_launch_template\" \"foo\" {\n  name = \"foo\"\n  ...\n    metadata_options {\n    http_endpoint               = \"enabled\"\n    http_tokens                 = \"required\"\n    http_put_response_hop_limit = 1\n    instance_metadata_tags      = \"enabled\"\n  }\n  ...\n</code></pre> <p>\ub178\ub4dc\uc5d0\uc11c iptables\ub97c \uc870\uc791\ud558\uc5ec EC2 \uba54\ud0c0\ub370\uc774\ud130\uc5d0 \ub300\ud55c \ud30c\ub4dc\uc758 \uc561\uc138\uc2a4\ub97c \ucc28\ub2e8\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc778\uc2a4\ud134\uc2a4 \uba54\ud0c0\ub370\uc774\ud130 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uc81c\ud55c \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc138\uc694.</p> <p>IRSA\ub97c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 \uc774\uc804 \ubc84\uc804\uc758 AWS SDK\ub97c \uc0ac\uc6a9\ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc788\ub294 \uacbd\uc6b0 SDK \ubc84\uc804\uc744 \uc5c5\ub370\uc774\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#irsa-iam","title":"IRSA\uc5d0 \ub300\ud55c IAM \uc5ed\ud560 \uc2e0\ub8b0 \uc815\ucc45\uc758 \ubc94\uc704\ub97c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uc774\ub984\uc73c\ub85c \uc9c0\uc815\ud569\ub2c8\ub2e4","text":"<p>\uc2e0\ub8b0 \uc815\ucc45\uc740 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub610\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4\uc758 \ud2b9\uc815 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub85c \ubc94\uc704\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. IRSA\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uc774\ub984\uc744 \ud3ec\ud568\ud558\uc5ec \uc5ed\ud560 \uc2e0\ub8b0 \uc815\ucc45\uc744 \uac00\ub2a5\ud55c \ud55c \uba85\uc2dc\uc801\uc73c\ub85c \ub9cc\ub4dc\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ub3d9\uc77c\ud55c \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4\uc758 \ub2e4\ub978 \ud30c\ub4dc\uac00 \uc5ed\ud560\uc744 \ub9e1\ub294 \uac83\uc744 \ud6a8\uacfc\uc801\uc73c\ub85c \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CLI <code>eksctl</code> \uc740 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8/IAM \uc5ed\ud560\uc744 \uc0dd\uc131\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \ub54c \uc774 \uc791\uc5c5\uc744 \uc790\ub3d9\uc73c\ub85c \uc218\ud589\ud569\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 eksctl \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc138\uc694.</p>"},{"location":"ko/security/docs/iam/#imds-imdsv2-ec2-2","title":"\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 IMDS\uc5d0 \uc561\uc138\uc2a4\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 IMDSv2\ub97c \uc0ac\uc6a9\ud558\uace0 EC2 \uc778\uc2a4\ud134\uc2a4\uc758 \ud649 \uc81c\ud55c\uc744 2\ub85c \ub298\ub9ac\uc138\uc694","text":"<p>IMDSv2\uc5d0\uc11c\ub294 PUT \uc694\uccad\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc138\uc158 \ud1a0\ud070\uc744 \uac00\uc838\uc640\uc57c \ud569\ub2c8\ub2e4. \ucd08\uae30 PUT \uc694\uccad\uc5d0\ub294 \uc138\uc158 \ud1a0\ud070\uc5d0 \ub300\ud55c TTL\uc774 \ud3ec\ud568\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \ucd5c\uc2e0 \ubc84\uc804\uc758 AWS SDK\ub294 \uc774\ub97c \ucc98\ub9ac\ud558\uace0 \ud574\ub2f9 \ud1a0\ud070\uc758 \uac31\uc2e0\uc744 \uc790\ub3d9\uc73c\ub85c \ucc98\ub9ac\ud569\ub2c8\ub2e4. \ub610\ud55c IP \uc804\ub2ec\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud574 EC2 \uc778\uc2a4\ud134\uc2a4\uc758 \uae30\ubcf8 \ud649 \uc81c\ud55c\uc774 \uc758\ub3c4\uc801\uc73c\ub85c 1\ub85c \uc124\uc815\ub418\uc5b4 \uc788\ub2e4\ub294 \uc810\uc5d0 \uc720\uc758\ud574\uc57c \ud569\ub2c8\ub2e4. \uacb0\uacfc\uc801\uc73c\ub85c EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc138\uc158 \ud1a0\ud070\uc744 \uc694\uccad\ud558\ub294 \ud30c\ub4dc\ub294 \uacb0\uad6d \uc2dc\uac04 \ucd08\uacfc\ub418\uc5b4 IMDSv1 \ub370\uc774\ud130 \ud750\ub984\uc744 \uc0ac\uc6a9\ud558\ub3c4\ub85d \ub300\uccb4\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. EKS\ub294 v1\uacfc v2\ub97c \ubaa8\ub450 _\ud65c\uc131\ud654_\ud558\uace0 eksctl \ub610\ub294 \uacf5\uc2dd CloudFormation \ud15c\ud50c\ub9bf\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ub41c \ub178\ub4dc\uc5d0\uc11c \ud649 \uc81c\ud55c\uc744 2\ub85c \ubcc0\uacbd\ud558\uc5ec \uc9c0\uc6d0 IMDSv2\ub97c \ucd94\uac00\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_10","title":"\uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070 \uc790\ub3d9 \ub9c8\uc6b4\ud2b8 \ube44\ud65c\uc131\ud654","text":"<p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 Kubernetes API\ub97c \ud638\ucd9c\ud560 \ud544\uc694\uac00 \uc5c6\ub294 \uacbd\uc6b0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc758 PodSpec\uc5d0\uc11c <code>automountServiceAccountToken</code> \uc18d\uc131\uc744 <code>false</code>\ub85c \uc124\uc815\ud558\uac70\ub098 \uac01 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \uae30\ubcf8 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc744 \ud328\uce58\ud558\uc5ec \ub354 \uc774\uc0c1 \ud30c\ub4dc\uc5d0 \uc790\ub3d9\uc73c\ub85c \ub9c8\uc6b4\ud2b8\ub418\uc9c0 \uc54a\ub3c4\ub85d \ud569\ub2c8\ub2e4. \uc608:</p> <pre><code>kubectl patch serviceaccount default -p $'automountServiceAccountToken: false'\n</code></pre>"},{"location":"ko/security/docs/iam/#_11","title":"\uac01 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \uc804\uc6a9 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uc0ac\uc6a9","text":"<p>\uac01 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\ub294 \uace0\uc720\ud55c \uc804\uc6a9 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc774 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \ubc0f IRSA\uc758 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc5d0 \uc801\uc6a9\ub429\ub2c8\ub2e4.</p> <p>Attention</p> <p>\uc804\uccb4 \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc\ub97c \uc218\ud589\ud558\ub294 \ub300\uc2e0 \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc\uc5d0 \ube14\ub8e8/\uadf8\ub9b0 \uc811\uadfc \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uac01 IRSA IAM \uc5ed\ud560\uc758 \uc2e0\ub8b0 \uc815\ucc45\uc744 \uc0c8 \ud074\ub7ec\uc2a4\ud130\uc758 OIDC \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub85c \uc5c5\ub370\uc774\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4. \ube14\ub8e8/\uadf8\ub9b0 \ud074\ub7ec\uc2a4\ud130 \uc5c5\uadf8\ub808\uc774\ub4dc\ub294 \uc774\uc804 \ud074\ub7ec\uc2a4\ud130\uc640 \ud568\uaed8 \ucd5c\uc2e0 \ubc84\uc804\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc2e4\ud589\ud558\ub294 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uace0 \ub85c\ub4dc\ubc38\ub7f0\uc11c \ub610\ub294 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\uc804 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc11c\ube44\uc2a4\uc5d0\uc11c \uc0c8 \ud074\ub7ec\uc2a4\ud130\ub85c \ud2b8\ub798\ud53d\uc744 \uc6d0\ud65c\ud558\uac8c \uc774\ub3d9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_12","title":"\ub8e8\ud2b8\uac00 \uc544\ub2cc \uc0ac\uc6a9\uc790\ub85c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc2e4\ud589","text":"<p>\ucee8\ud14c\uc774\ub108\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ub8e8\ud2b8\ub85c \uc2e4\ud589\ub429\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc6f9 \uc790\uaca9 \uc99d\uba85 \ud1a0\ud070 \ud30c\uc77c\uc744 \uc77d\uc744 \uc218 \uc788\uc9c0\ub9cc \ucee8\ud14c\uc774\ub108\ub97c \ub8e8\ud2b8\ub85c \uc2e4\ud589\ud558\ub294 \uac83\uc740 \ubaa8\ubc94 \uc0ac\ub840\ub85c \uac04\uc8fc\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub610\ub294 PodSpec\uc5d0 <code>spec.securityContext.runAsUser</code> \uc18d\uc131\uc744 \ucd94\uac00\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. <code>runAsUser</code> \uc758 \uac12 \uc740 \uc784\uc758\uc758 \uac12\uc785\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uc608\uc81c\uc5d0\uc11c \ud30c\ub4dc \ub0b4\uc758 \ubaa8\ub4e0 \ud504\ub85c\uc138\uc2a4\ub294 <code>RunAsUser</code> \ud544\ub4dc\uc5d0 \uc9c0\uc815\ub41c \uc0ac\uc6a9\uc790 ID\ub85c \uc2e4\ud589\ub429\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: security-context-demo\nspec:\n  securityContext:\n    runAsUser: 1000\n    runAsGroup: 3000\n  containers:\n  - name: sec-ctx-demo\n    image: busybox\n    command: [ \"sh\", \"-c\", \"sleep 1h\" ]\n</code></pre> <p>\ub8e8\ud2b8\uac00 \uc544\ub2cc \uc0ac\uc6a9\uc790\ub85c \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud558\uba74 \uae30\ubcf8\uc801\uc73c\ub85c \ud1a0\ud070\uc5d0 0600 [Root] \uad8c\ud55c\uc774 \ud560\ub2f9\ub418\uae30 \ub54c\ubb38\uc5d0 \ucee8\ud14c\uc774\ub108\uac00 IRSA \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070\uc744 \uc77d\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. fsgroup=65534 [Nobody]\ub97c \ud3ec\ud568\ud558\ub3c4\ub85d \ucee8\ud14c\uc774\ub108\uc758 securityContext\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uba74 \ucee8\ud14c\uc774\ub108\uac00 \ud1a0\ud070\uc744 \uc77d\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>spec:\n  securityContext:\n    fsGroup: 65534\n</code></pre> <p>Kubernetes 1.19 \ubc0f \uc774\ud6c4 \ubc84\uc804\uc5d0\uc11c\ub294 \uc774 \ubcc0\uacbd\uc774 \ub354 \uc774\uc0c1 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_13","title":"\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ub300\ud55c \ucd5c\uc18c \uc811\uadfc \uad8c\ud55c \ubd80\uc5ec","text":"<p>Action Hero\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc81c\ub300\ub85c \uc791\ub3d9\ud558\ub294 \ub370 \ud544\uc694\ud55c AWS API \ud638\ucd9c \ubc0f \ud574\ub2f9 IAM \uad8c\ud55c\uc744 \uc2dd\ubcc4\ud558\uae30 \uc704\ud574 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \ud568\uaed8 \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uc720\ud2f8\ub9ac\ud2f0\uc785\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ud560\ub2f9\ub41c IAM \uc5ed\ud560\uc758 \ubc94\uc704\ub97c \uc810\uc9c4\uc801\uc73c\ub85c \uc81c\ud55c\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub41c\ub2e4\ub294 \uc810\uc5d0\uc11c IAM Access Advisor\uc640 \uc720\uc0ac\ud569\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 AWS \ub9ac\uc18c\uc2a4\uc5d0 \ucd5c\uc18c \uc811\uadfc \uad8c\ud55c \ubd80\uc5ec\uc5d0 \ub300\ud55c \uc124\uba85\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/iam/#_14","title":"\ubd88\ud544\uc694\ud55c \uc775\uba85 \uc811\uadfc \uac80\ud1a0 \ubc0f \ucca0\ud68c","text":"<p>\uc774\uc0c1\uc801\uc73c\ub85c\ub294 \ubaa8\ub4e0 API \uc791\uc5c5\uc5d0 \ub300\ud574 \uc775\uba85\uc758 \uc811\uadfc\uc744 \ube44\ud65c\uc131\ud654\ud558\uc5ec\uc57c \ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ubcf8 \uc81c\uacf5 \uc0ac\uc6a9\uc790 system:anonymous\uc5d0 \ub300\ud55c RoleBinding \ub610\ub294 ClusterRoleBinding\uc744 \uc0dd\uc131\ud558\uc5ec \uc775\uba85 \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud569\ub2c8\ub2e4. rbac-lookup \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec system:anonymous \uc0ac\uc6a9\uc790\uac00 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud574 \uac16\ub294 \uad8c\ud55c\uc744 \uc2dd\ubcc4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>./rbac-lookup | grep -P 'system:(anonymous)|(unauthenticated)'\nsystem:anonymous               cluster-wide        ClusterRole/system:discovery\nsystem:unauthenticated         cluster-wide        ClusterRole/system:discovery\nsystem:unauthenticated         cluster-wide        ClusterRole/system:public-info-viewer\n</code></pre> <p>system:public-info-viewer\uc678\uc758 ClusterRole \ub610\ub294 \ubaa8\ub4e0 \uc5ed\ud560\uc740 system:anonymous \uc0ac\uc6a9\uc790 \ub610\ub294 system:unauthenticated \uadf8\ub8f9\uc5d0 \ubc14\uc778\ub529\ub418\uc9c0 \uc54a\uc544\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ud2b9\uc815 API\uc5d0\uc11c \uc775\uba85 \uc561\uc138\uc2a4\ub97c \ud65c\uc131\ud654\ud574\uc57c \ud558\ub294 \uc815\ub2f9\ud55c \uc774\uc720\uac00 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc758 \uacbd\uc6b0 \uc775\uba85 \uc0ac\uc6a9\uc790\uac00 \ud2b9\uc815 API\ub9cc \uc561\uc138\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\uace0 \uc778\uc99d \uc5c6\uc774 \ud574\ub2f9 API\ub97c \ub178\ucd9c\ud574\ub3c4 \ud074\ub7ec\uc2a4\ud130\uac00 \ucde8\uc57d\ud574\uc9c0\uc9c0 \uc54a\ub3c4\ub85d \ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>Kubernetes/EKS \ubc84\uc804 1.14 \uc774\uc804\uc5d0\ub294 system:unauthenticated \uadf8\ub8f9\uc774 \uae30\ubcf8\uc801\uc73c\ub85c system:discovery \ubc0f system:basic-user \ud074\ub7ec\uc2a4\ud130 \uc5ed\ud560\uc5d0 \uc5f0\uacb0\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\ub97c \ubc84\uc804 1.14 \uc774\uc0c1\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ud588\ub354\ub77c\ub3c4 \ud074\ub7ec\uc2a4\ud130\ub97c \uc5c5\ub370\uc774\ud2b8\ud574\ub3c4 \uc774\ub7f0 \uad8c\ud55c\uc774 \ucde8\uc18c\ub418\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc774\ub7f0 \uad8c\ud55c\uc774 \uacc4\uc18d \ud65c\uc131\ud654\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. system:public-info-viewer\ub97c \uc81c\uc678\ud558\uace0 \uc5b4\ub5a4 ClusterRole\uc5d0 \"system:unauthenticated\"\uac00 \uc788\ub294\uc9c0 \ud655\uc778\ud558\ub824\uba74 \ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(jq \uc720\ud2f8\ub9ac\ud2f0\uac00 \ud544\uc694\ud569\ub2c8\ub2e4):</p> <pre><code>kubectl get ClusterRoleBinding -o json | jq -r '.items[] | select(.subjects[]?.name ==\"system:unauthenticated\") | select(.metadata.name != \"system:public-info-viewer\") | .metadata.name'\n</code></pre> <p>\uadf8\ub9ac\uace0 \"system:unauthenticated\"\ub294 \uc544\ub798 \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc5ec \"system:public-info-viewer\"\ub97c \uc81c\uc678\ud55c \ubaa8\ub4e0 \uc5ed\ud560\uc5d0\uc11c \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl get ClusterRoleBinding -o json | jq -r '.items[] | select(.subjects[]?.name ==\"system:unauthenticated\") | select(.metadata.name != \"system:public-info-viewer\") | del(.subjects[] | select(.name ==\"system:unauthenticated\"))' | kubectl apply -f -\n</code></pre> <p>\ub610\ub294 kubectl describe \ubc0f kubectl edit\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc218\ub3d9\uc73c\ub85c \ud655\uc778\ud558\uace0 \uc81c\uac70\ud560 \uc218 \uc788\ub2e4. system:unauthenticated \uadf8\ub8f9\uc5d0 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c system:discovery \uad8c\ud55c\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud558\ub824\uba74 \ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc2ed\uc2dc\uc624.</p> <pre><code>kubectl describe clusterrolebindings system:discovery\n\nName:         system:discovery\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate: true\nRole:\n  Kind:  ClusterRole\n  Name:  system:discovery\nSubjects:\n  Kind   Name                    Namespace\n  ----   ----                    ---------\n  Group  system:authenticated\n  Group  system:unauthenticated\n</code></pre> <p>system:unauthenticated \uadf8\ub8f9\uc5d0 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c system:basic-user \uad8c\ud55c\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud558\ub824\uba74 \ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4.</p> <pre><code>kubectl describe clusterrolebindings system:basic-user\n\nName:         system:basic-user\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate: true\nRole:\n  Kind:  ClusterRole\n  Name:  system:basic-user\nSubjects:\n  Kind   Name                    Namespace\n  ----   ----                    ---------\n  Group  system:authenticated\n  Group  system:unauthenticated\n</code></pre> <p>system:unauthenticated \uadf8\ub8f9\uc774 \ud074\ub7ec\uc2a4\ud130\uc758 system:discovery \ubc0f/\ub610\ub294 system:basic-user ClusterRoles\uc5d0 \ubc14\uc778\ub529\ub41c \uacbd\uc6b0 \uc774\ub7f0 \uc5ed\ud560\uc744 system:unauthenticated \uadf8\ub8f9\uc5d0\uc11c \ubd84\ub9ac\ud574\uc57c \ud569\ub2c8\ub2e4. \ub2e4\uc74c \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc5ec system:discovery ClusterRoleBinding\uc744 \ud3b8\uc9d1\ud569\ub2c8\ub2e4:</p> <pre><code>kubectl edit clusterrolebindings system:discovery\n</code></pre> <p>\uc704 \uba85\ub839\uc740 \uc544\ub798\uc640 \uac19\uc774 \ud3b8\uc9d1\uae30\uc5d0\uc11c system:discovery ClusterRoleBinding\uc758 \ud604\uc7ac \uc815\uc758\ub97c \uc5fd\ub2c8\ub2e4:</p> <pre><code># Please edit the object below. Lines beginning with a '#' will be ignored,\n# and an empty file will abort the edit. If an error occurs while saving this file will be\n# reopened with the relevant failures.\n#\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  creationTimestamp: \"2021-06-17T20:50:49Z\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:discovery\n  resourceVersion: \"24502985\"\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/system%3Adiscovery\n  uid: b7936268-5043-431a-a0e1-171a423abeb6\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:discovery\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:authenticated\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:unauthenticated\n</code></pre> <p>\uc704 \ud3b8\uc9d1\uae30 \ud654\uba74\uc758 \"Subjects\" \uc139\uc158\uc5d0\uc11c system:unauthenticated \uadf8\ub8f9 \ud56d\ubaa9\uc744 \uc0ad\uc81c\ud569\ub2c8\ub2e4.</p> <p>system:basic-user ClusterRoleBinding\uc5d0 \ub300\ud574 \ub3d9\uc77c\ud55c \ub2e8\uacc4\ub97c \ubc18\ubcf5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/iam/#_15","title":"\ub300\uccb4 \uc811\uadfc \ubc29\uc2dd","text":"<p>IRSA\ub294 \ud30c\ub4dc\uc5d0 AWS \"ID\"\ub97c \ud560\ub2f9\ud558\ub294 _\uc120\ud638 \ub418\ub294 \ubc29\ubc95_\uc774\uc9c0\ub9cc \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ucd5c\uc2e0 \ubc84\uc804\uc758 AWS SDK\ub97c \ud3ec\ud568\ud574\uc57c \ud569\ub2c8\ub2e4. \ud604\uc7ac IRSA\ub97c \uc9c0\uc6d0\ud558\ub294 SDK\uc758 \uc804\uccb4 \ubaa9\ub85d\uc740 AWS \ubb38\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4. IRSA \ud638\ud658 SDK\ub85c \uc989\uc2dc \uc5c5\ub370\uc774\ud2b8\ud560 \uc218 \uc5c6\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc788\ub294 \uacbd\uc6b0, kube2iam \ubc0f kiam \uc744 \ud3ec\ud568\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uc5d0 IAM \uc5ed\ud560\uc744 \ud560\ub2f9\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \ucee4\ubba4\ub2c8\ud2f0 \uad6c\ucd95 \uc194\ub8e8\uc158\uc774 \uc788\uc2b5\ub2c8\ub2e4. AWS\ub294 \uc774\ub7f0 \uc194\ub8e8\uc158\uc758 \uc0ac\uc6a9\uc744 \ubcf4\uc99d\ud558\uac70\ub098 \uc6a9\uc778\ud558\uc9c0 \uc54a\uc9c0\ub9cc IRSA\uc640 \uc720\uc0ac\ud55c \uacb0\uacfc\ub97c \uc5bb\uae30 \uc704\ud574 \ucee4\ubba4\ub2c8\ud2f0\uc5d0\uc11c \uc790\uc8fc \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/","title":"\uc774\ubbf8\uc9c0 \ubcf4\uc548","text":"<p>\ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub294 \uacf5\uaca9\uc5d0 \ub300\ud55c \uccab \ubc88\uc9f8 \ubc29\uc5b4\uc120\uc73c\ub85c \uace0\ub824\ud558\uc5ec\uc57c \ud569\ub2c8\ub2e4. \uc548\uc804\ud558\uc9c0 \uc54a\uace0 \uc798\ubabb \uad6c\uc131\ub41c \uc774\ubbf8\uc9c0\ub294 \uacf5\uaca9\uc790\ub294 \ucee8\ud14c\uc774\ub108\uc758 \uacbd\uacc4\ub97c \ubc97\uc5b4\ub098 \ud638\uc2a4\ud2b8\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ud638\uc2a4\ud2b8\uc5d0 \ub4e4\uc5b4\uac00\uba74 \uacf5\uaca9\uc790\ub294 \ubbfc\uac10\ud55c \uc815\ubcf4\uc5d0 \uc561\uc138\uc2a4\ud558\uac70\ub098 \ud074\ub7ec\uc2a4\ud130 \ub0b4 \ub610\ub294 AWS \uacc4\uc815 \ub0b4\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \ubaa8\ubc94 \uc0ac\ub840\ub294 \uc774\ub7f0 \uc0c1\ud669\uc774 \ubc1c\uc0dd\ud560 \uc704\ud5d8\uc744 \uc644\ud654\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#_2","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/image/#_3","title":"\ucd5c\uc18c \uc774\ubbf8\uc9c0 \uc0dd\uc131","text":"<p>\uba3c\uc800 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0\uc11c \ud544\uc694\uc5c6\ub294 \ubc14\uc774\ub108\ub9ac\ub97c \ubaa8\ub450 \uc81c\uac70\ud569\ub2c8\ub2e4. Dockerhub\ub85c\ubd80\ud130 \uac80\uc99d\ub418\uc9c0 \uc54a\uc740 \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uac01 \ucee8\ud14c\uc774\ub108 \ub808\uc774\uc5b4\uc758 \ub0b4\uc6a9\uc744 \ubcfc \uc218 \uc788\ub294 Dive\uc640 \uac19\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc774\ubbf8\uc9c0\ub97c \uac80\uc0ac\ud569\ub2c8\ub2e4. \uad8c\ud55c\uc744 \uc0c1\uc2b9\ud560 \uc218 \uc788\ub294 SETUID \ubc0f SETGID \ube44\ud2b8\uac00 \uc788\ub294 \ubaa8\ub4e0 \ubc14\uc774\ub108\ub9ac\ub97c \uc81c\uac70\ud558\uace0 nc\ub098 curl\uacfc \uac19\uc774 \uc545\uc758\uc801\uc778 \uc6a9\ub3c4\ub85c \uc0ac\uc6a9\ub420 \uc218 \uc788\ub294 \uc178\uacfc \uc720\ud2f8\ub9ac\ud2f0\ub97c \ubaa8\ub450 \uc81c\uac70\ud558\ub294 \uac83\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. \ub2e4\uc74c \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc5ec SETUID \ubc0f SETGID \ube44\ud2b8\uac00 \uc788\ub294 \ud30c\uc77c\uc744 \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>find / -perm /6000 -type f -exec ls -ld {} \\;\n</code></pre> <p>\uc774\ub7f0 \ud30c\uc77c\uc5d0\uc11c \ud2b9\uc218 \uad8c\ud55c\uc744 \uc81c\uac70\ud558\ub824\uba74 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0 \ub2e4\uc74c \uc9c0\uc2dc\ubb38\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4.</p> <pre><code>RUN find / -xdev -perm /6000 -type f -exec chmod a-s {} \\; || true\n</code></pre>"},{"location":"ko/security/docs/image/#_4","title":"\uba40\ud2f0 \uc2a4\ud14c\uc774\uc9c0 \ube4c\ub4dc \uc0ac\uc6a9","text":"<p>\uba40\ud2f0 \uc2a4\ud14c\uc774\uc9c0 \ube4c\ub4dc\ub97c \uc0ac\uc6a9\ud558\uba74 \ucd5c\uc18c\ud55c\uc758 \uc774\ubbf8\uc9c0\ub97c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc9c0\uc18d\uc801 \ud1b5\ud569 \uc8fc\uae30\uc758 \uc77c\ubd80\ub97c \uc790\ub3d9\ud654\ud558\ub294 \ub370 \uba40\ud2f0 \uc2a4\ud14c\uc774\uc9c0 \ube4c\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uba40\ud2f0 \uc2a4\ud14c\uc774\uc9c0 \ube4c\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc18c\uc2a4 \ucf54\ub4dc\ub97c \ub9b0\ud2b8\ud558\uac70\ub098 \uc815\uc801 \ucf54\ub4dc \ubd84\uc11d\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uac1c\ubc1c\uc790\ub294 \ud30c\uc774\ud504\ub77c\uc778 \uc2e4\ud589\uc744 \uae30\ub2e4\ub9b4 \ud544\uc694 \uc5c6\uc774 \uac70\uc758 \uc989\uac01\uc801\uc778 \ud53c\ub4dc\ubc31\uc744 \ubc1b\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uba40\ud2f0 \uc2a4\ud14c\uc774\uc9c0 \ube4c\ub4dc\ub294 \ucee8\ud14c\uc774\ub108 \ub808\uc9c0\uc2a4\ud2b8\ub9ac\ub85c \ud478\uc2dc\ub418\ub294 \ucd5c\uc885 \uc774\ubbf8\uc9c0\uc758 \ud06c\uae30\ub97c \ucd5c\uc18c\ud654\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \ubcf4\uc548 \uad00\uc810\uc5d0\uc11c \ub9e4\ub825\uc801\uc785\ub2c8\ub2e4. \ube4c\ub4dc \ub3c4\uad6c \ubc0f \uae30\ud0c0 \uad00\ub828 \uc5c6\ub294 \ubc14\uc774\ub108\ub9ac\uac00 \uc5c6\ub294 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub294 \uc774\ubbf8\uc9c0\uc758 \uacf5\uaca9 \ud45c\uba74\uc744 \uc904\uc5ec \ubcf4\uc548 \uc0c1\ud0dc\ub97c \uac1c\uc120\ud569\ub2c8\ub2e4. \uba40\ud2f0 \uc2a4\ud14c\uc774\uc9c0 \ube4c\ub4dc\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 \ubcf8 \ubb38\uc11c\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#sbom-software-bill-of-materials","title":"\ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uc704\ud55c \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc7ac\ub8cc \uba85\uc138\uc11c (SBOM, Software Bill of Materials) \uc0dd\uc131","text":"<p>SBOM\uc740 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uad6c\uc131\ud558\ub294 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc544\ud2f0\ud329\ud2b8\uc758 \uc911\ucca9\ub41c \uc778\ubca4\ud1a0\ub9ac\uc785\ub2c8\ub2e4. SBOM\uc740 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \ubcf4\uc548 \ubc0f \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uacf5\uae09\ub9dd \uc704\ud5d8 \uad00\ub9ac\uc758 \ud575\uc2ec \uad6c\uc131 \uc694\uc18c\uc785\ub2c8\ub2e4. SBOM\uc744 \uc0dd\uc131\ud558\uc5ec \uc911\uc559 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \uc800\uc7a5\ud558\uace0 SBOM\uc758 \ucde8\uc57d\uc131 \uac80\uc0ac\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4.</p> <ul> <li>\uac00\uc2dc\uc131: \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uad6c\uc131\ud558\ub294 \uad6c\uc131 \uc694\uc18c\ub97c \uc774\ud574\ud569\ub2c8\ub2e4. \uc911\uc559 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \uc800\uc7a5\ud558\uba74 \ubc30\ud3ec \uc774\ud6c4\uc5d0\ub3c4 \uc5b8\uc81c\ub4e0\uc9c0 SBOM\uc744 \uac10\uc0ac \ubc0f \uc2a4\uce94\ud558\uc5ec \uc81c\ub85c \ub370\uc774 \ucde8\uc57d\uc131\uacfc \uac19\uc740 \uc0c8\ub85c\uc6b4 \ucde8\uc57d\uc131\uc744 \ud0d0\uc9c0\ud558\uace0 \uc774\uc5d0 \ub300\uc751\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\ucd9c\ucc98 \uac80\uc99d: \uc544\ud2f0\ud329\ud2b8\uc758 \ucd9c\ucc98 \ubc0f \ucd9c\ucc98\uc5d0 \ub300\ud55c \uae30\uc874 \uac00\uc815\uc774 \uc0ac\uc2e4\uc774\uace0 \ube4c\ub4dc \ub610\ub294 \uc81c\uacf5 \ud504\ub85c\uc138\uc2a4 \uc911\uc5d0 \uc544\ud2f0\ud329\ud2b8 \ub610\ub294 \uad00\ub828 \uba54\ud0c0\ub370\uc774\ud130\uac00 \ubcc0\uc870\ub418\uc9c0 \uc54a\uc558\uc74c\uc744 \ubcf4\uc99d\ud569\ub2c8\ub2e4.</li> <li>\uc2e0\ub8b0\uc131: \ud2b9\uc815 \uc720\ubb3c\uacfc \uadf8 \ub0b4\uc6a9\ubb3c\uc774 \uc758\ub3c4\ud55c \uc791\uc5c5, \uc989 \ubaa9\uc801\uc5d0 \uc801\ud569\ud558\ub2e4\ub294 \uac83\uc744 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub2e4\ub294 \ubcf4\uc7a5. \uc5ec\uae30\uc5d0\ub294 \ucf54\ub4dc\ub97c \uc2e4\ud589\ud558\uae30\uc5d0 \uc548\uc804\ud55c\uc9c0 \ud310\ub2e8\ud558\uace0 \ucf54\ub4dc \uc2e4\ud589\uacfc \uad00\ub828\ub41c \uc704\ud5d8\uc5d0 \ub300\ud574 \uc815\ubcf4\uc5d0 \uc785\uac01\ud55c \uacb0\uc815\uc744 \ub0b4\ub9ac\ub294 \uac83\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4. \uc778\uc99d\ub41c SBOM \ubc0f \uc778\uc99d\ub41c CVE \uc2a4\uce94 \ubcf4\uace0\uc11c\uc640 \ud568\uaed8 \uac80\uc99d\ub41c \ud30c\uc774\ud504\ub77c\uc778 \uc2e4\ud589 \ubcf4\uace0\uc11c\ub97c \uc791\uc131\ud558\uc5ec \uc774\ubbf8\uc9c0 \uc18c\ube44\uc790\uc5d0\uac8c \uc774 \uc774\ubbf8\uc9c0\uac00 \uc2e4\uc81c\ub85c \ubcf4\uc548 \uad6c\uc131 \uc694\uc18c\ub97c \uac16\ucd98 \uc548\uc804\ud55c \uc218\ub2e8 (\ud30c\uc774\ud504\ub77c\uc778) \uc744 \ud1b5\ud574 \uc0dd\uc131\ub418\uc5c8\uc74c\uc744 \ud655\uc778\ud558\uba74 \uc2e0\ub8b0\uc131\uc774 \ubcf4\uc7a5\ub429\ub2c8\ub2e4.</li> <li>\uc885\uc18d\uc131 \uc2e0\ub8b0 \ud655\uc778: \uc544\ud2f0\ud329\ud2b8\uc758 \uc885\uc18d\uc131 \ud2b8\ub9ac\uac00 \uc0ac\uc6a9\ud558\ub294 \uc544\ud2f0\ud329\ud2b8\uc758 \uc2e0\ub8b0\uc131\uacfc \ucd9c\ucc98\ub97c \ubc18\ubcf5\uc801\uc73c\ub85c \uac80\uc0ac\ud569\ub2c8\ub2e4. SBOM\uc758 \ub4dc\ub9ac\ud504\ud2b8\ub294 \uc2e0\ub8b0\ud560 \uc218 \uc5c6\ub294 \ubb34\ub2e8 \uc885\uc18d\uc131, \uce68\uc785 \uc2dc\ub3c4 \ub4f1 \uc545\uc758\uc801\uc778 \ud65c\ub3d9\uc744 \ud0d0\uc9c0\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> </ul> <p>\ub2e4\uc74c \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec SBOM\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:</p> <ul> <li>Amazon Inspector\ub97c \uc0ac\uc6a9\ud558\uc5ec SBOM \uc0dd\uc131 \ubc0f \ub0b4\ubcf4\ub0b4\uae30\ub97c \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>Syft from Anchore \ub294 SBOM \uc0dd\uc131\uc5d0\ub3c4 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucde8\uc57d\uc131 \uc2a4\uce94\uc744 \ub354 \ube60\ub974\uac8c \ud558\uae30 \uc704\ud574 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0 \ub300\ud574 \uc0dd\uc131\ub41c SBOM\uc744 \uc2a4\uce94\uc744 \uc704\ud55c \uc785\ub825\uc73c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c \uac80\ud1a0 \ubc0f \uac10\uc0ac \ubaa9\uc801\uc73c\ub85c \uc774\ubbf8\uc9c0\ub97c Amazon ECR\uacfc \uac19\uc740 \uc911\uc559 OCI \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\ub85c \ud478\uc2dc\ud558\uae30 \uc804\uc5d0 SBOM \ubc0f \uc2a4\uce94 \ubcf4\uace0\uc11c\ub97c \uc774\ubbf8\uc9c0\uc5d0 \uc99d\uba85 \ubc0f \ucca8\ubd80\ud569\ub2c8\ub2e4.</li> </ul> <p>CNCF \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uacf5\uae09\ub9dd \ubaa8\ubc94 \uc0ac\ub840 \uac00\uc774\ub4dc\ub97c \uac80\ud1a0\ud558\uace0 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uacf5\uae09\ub9dd \ubcf4\uc548\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\uc138\uc694.</p>"},{"location":"ko/security/docs/image/#_5","title":"\ucde8\uc57d\uc810\uc774 \uc788\ub294\uc9c0 \uc774\ubbf8\uc9c0\ub97c \uc815\uae30\uc801\uc73c\ub85c \uc2a4\uce94","text":"<p>\uac00\uc0c1 \uba38\uc2e0\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0\ub294 \ucde8\uc57d\uc131\uc774 \uc788\ub294 \ubc14\uc774\ub108\ub9ac\uc640 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub77c\uc774\ube0c\ub7ec\ub9ac\uac00 \ud3ec\ud568\ub418\uac70\ub098 \uc2dc\uac04\uc774 \uc9c0\ub0a8\uc5d0 \ub530\ub77c \ucde8\uc57d\uc131\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc545\uc6a9\uc73c\ub85c\ubd80\ud130 \ubcf4\ud638\ud558\ub294 \uac00\uc7a5 \uc88b\uc740 \ubc29\ubc95\uc740 \uc774\ubbf8\uc9c0 \uc2a4\uce90\ub108\ub85c \uc774\ubbf8\uc9c0\ub97c \uc815\uae30\uc801\uc73c\ub85c \uc2a4\uce94\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. Amazon ECR\uc5d0 \uc800\uc7a5\ub41c \uc774\ubbf8\uc9c0\ub294 \ud478\uc2dc \ub610\ub294 \uc628\ub514\ub9e8\ub4dc\ub85c \uc2a4\uce94\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. (24\uc2dc\uac04 \ub3d9\uc548 \ud55c \ubc88) ECR\uc740 \ud604\uc7ac \ub450 \uac00\uc9c0 \uc720\ud615\uc758 \uc2a4\uce94 - \uae30\ubcf8 \ubc0f \uace0\uae09\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uae30\ubcf8 \uc2a4\uce94\uc740 Clair\uc758 \uc624\ud508 \uc18c\uc2a4 \uc774\ubbf8\uc9c0 \uc2a4\uce94 \uc194\ub8e8\uc158\uc744 \ubb34\ub8cc\ub85c \ud65c\uc6a9\ud569\ub2c8\ub2e4. \uace0\uae09 \uc2a4\uce94\uc740 \ucd94\uac00 \ube44\uc6a9\uc774 \uacfc\uae08\ub418\uba70 Amazon Inspector\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc790\ub3d9 \uc5f0\uc18d \uc2a4\uce94\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774\ubbf8\uc9c0\ub97c \uc2a4\uce94\ud55c \ud6c4 \uacb0\uacfc\ub294 EventBridge\uc758 ECR\uc6a9 \uc774\ubca4\ud2b8 \uc2a4\ud2b8\ub9bc\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4. ECR \ucf58\uc194 \ub0b4\uc5d0\uc11c \uc2a4\uce94 \uacb0\uacfc\ub97c \ubcfc \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc2ec\uac01\ud558\uac70\ub098 \uc2ec\uac01\ud55c \ucde8\uc57d\uc131\uc774 \uc788\ub294 \uc774\ubbf8\uc9c0\ub294 \uc0ad\uc81c\ud558\uac70\ub098 \ub2e4\uc2dc \ube4c\ub4dc\ud574\uc57c \ud569\ub2c8\ub2e4. \ubc30\ud3ec\ub41c \uc774\ubbf8\uc9c0\uc5d0\uc11c \ucde8\uc57d\uc810\uc774 \ubc1c\uacac\ub418\uba74 \uac00\ub2a5\ud55c \ud55c \ube68\ub9ac \uad50\uccb4\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ucde8\uc57d\uc131\uc774 \uc788\ub294 \uc774\ubbf8\uc9c0\uac00 \ubc30\ud3ec\ub41c \uc704\uce58\ub97c \uc544\ub294 \uac83\uc740 \ud658\uacbd\uc744 \uc548\uc804\ud558\uac8c \uc720\uc9c0\ud558\ub294 \ub370 \ud544\uc218\uc801\uc785\ub2c8\ub2e4. \uc774\ubbf8\uc9c0 \ucd94\uc801 \uc194\ub8e8\uc158\uc744 \uc9c1\uc811 \uad6c\ucd95\ud560 \uc218\ub3c4 \uc788\uc9c0\ub9cc, \ub2e4\uc74c\uacfc \uac19\uc774 \uc774 \uae30\ub2a5\uc744 \ube44\ub86f\ud55c \uae30\ud0c0 \uace0\uae09 \uae30\ub2a5\uc744 \uc989\uc2dc \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc0c1\uc6a9 \uc81c\ud488\uc774 \uc774\ubbf8 \uc5ec\ub7ec \uac1c \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>Grype</li> <li>Palo Alto - Prisma Cloud (twistcli)</li> <li>Aqua</li> <li>Kubei</li> <li>Trivy</li> <li>Snyk</li> </ul> <p>Kubernetes \uac80\uc99d \uc6f9\ud6c5\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc774\ubbf8\uc9c0\uc5d0 \uc2ec\uac01\ud55c \ucde8\uc57d\uc810\uc774 \uc5c6\ub294\uc9c0 \uac80\uc99d\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.\uac80\uc99d \uc6f9\ud6c5\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ubcf4\ub2e4 \uba3c\uc800 \ud638\ucd9c\ub429\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c \uc6f9\ud6c5\uc5d0 \uc815\uc758\ub41c \uac80\uc99d \uae30\uc900\uc744 \uc900\uc218\ud558\uc9c0 \uc54a\ub294 \uc694\uccad\uc744 \uac70\ubd80\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4.\uc774 \ube14\ub85c\uadf8\ub294 ECR DescribeImagesCanVinds API\ub97c \ud638\ucd9c\ud558\uc5ec \ud30c\ub4dc\uac00 \uc2ec\uac01\ud55c \ucde8\uc57d\uc131\uc774 \uc788\ub294 \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\ub294\uc9c0 \uc5ec\ubd80\ub97c \ud655\uc778\ud558\ub294 \uc11c\ubc84\ub9ac\uc2a4 \uc6f9\ud6c5\uc744 \uc18c\uac1c\ud569\ub2c8\ub2e4. \ucde8\uc57d\uc131\uc774 \ubc1c\uacac\ub418\uba74 \ud30c\ub4dc\uac00 \uac70\ubd80\ub418\uace0 CVE \ubaa9\ub85d\uc774 \ud3ec\ud568\ub41c \uba54\uc2dc\uc9c0\uac00 \uc774\ubca4\ud2b8\ub85c \ubc18\ud658\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#attestation","title":"\uc99d\uba85(Attestation)\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc544\ud2f0\ud329\ud2b8 \ubb34\uacb0\uc131 \uac80\uc99d","text":"<p>\uc99d\uba85\uc774\ub780 \ud2b9\uc815 \uc0ac\ubb3c (\uc608: \ud30c\uc774\ud504\ub77c\uc778 \uc2e4\ud589, SBOM) \ub610\ub294 \ucde8\uc57d\uc131 \uc2a4\uce94 \ubcf4\uace0\uc11c\uc640 \uac19\uc740 \ub2e4\ub978 \uc0ac\ubb3c\uc5d0 \ub300\ud55c \"\uc804\uc81c \uc870\uac74\" \ub610\ub294 \"\uc8fc\uc81c\", \uc989 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uc8fc\uc7a5\ud558\ub294 \uc554\ud638\ud654 \ubc29\uc2dd\uc73c\ub85c \uc11c\uba85\ub41c \"\uc9c4\uc220\"\uc785\ub2c8\ub2e4.</p> <p>\uc99d\uba85\uc744 \ud1b5\ud574 \uc0ac\uc6a9\uc790\ub294 \uc544\ud2f0\ud329\ud2b8\uac00 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uacf5\uae09\ub9dd\uc758 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \ucd9c\ucc98\uc5d0\uc11c \ub098\uc628 \uac83\uc778\uc9c0 \uac80\uc99d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uc608\ub97c \ub4e4\uc5b4 \uc774\ubbf8\uc9c0\uc5d0 \ud3ec\ud568\ub41c \ubaa8\ub4e0 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uad6c\uc131 \uc694\uc18c\ub098 \uc885\uc18d\uc131\uc744 \uc54c\uc9c0 \ubabb\ud55c \uc0c1\ud0dc\uc5d0\uc11c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \uc81c\uc791\uc790\uac00 \uc5b4\ub5a4 \uc18c\ud504\ud2b8\uc6e8\uc5b4\uac00 \uc874\uc7ac\ud558\ub294\uc9c0\uc5d0 \ub300\ud574 \ub9d0\ud558\ub294 \ub0b4\uc6a9\uc744 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub2e4\uba74 \uc81c\uc791\uc790\uc758 \uc99d\uba85\uc744 \uc774\uc6a9\ud574 \ud574\ub2f9 \uc544\ud2f0\ud329\ud2b8\ub97c \uc2e0\ub8b0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc989, \uc9c1\uc811 \ubd84\uc11d\uc744 \uc218\ud589\ud558\ub294 \ub300\uc2e0 \uc6cc\ud06c\ud50c\ub85c\uc6b0\uc5d0\uc11c \uc544\ud2f0\ud329\ud2b8\ub97c \uc548\uc804\ud558\uac8c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uc99d\uba85\uc740 AWS Signer \ub610\ub294 Sigstore cosign\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>Kyverno\uc640 \uac19\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc99d\uba85 \ud655\uc778\uc744 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0 \uc99d\uba85 \uc0dd\uc131 \ubc0f \ucca8\ubd80\ub97c \ud3ec\ud568\ud55c \uc8fc\uc81c\uc640 \ud568\uaed8 \uc624\ud508 \uc18c\uc2a4 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\ub294 AWS\uc758 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uacf5\uae09\ub9dd \uad00\ub9ac \ubaa8\ubc94 \uc0ac\ub840\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\ub824\uba74 \uc774 \uc6cc\ud06c\uc0f5\uc744\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/image/#ecr-iam","title":"ECR \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ub300\ud55c IAM \uc815\ucc45 \uc0dd\uc131","text":"<p>\uc870\uc9c1\uc5d0\uc11c \uacf5\uc720 AWS \uacc4\uc815 \ub0b4\uc5d0\uc11c \ub3c5\ub9bd\uc801\uc73c\ub85c \uc6b4\uc601\ub418\ub294 \uc5ec\ub7ec \uac1c\ubc1c \ud300\uc774 \uc788\ub294 \uacbd\uc6b0\uac00 \ub4dc\ubb3c\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \ud300\uc774 \uc790\uc0b0\uc744 \uacf5\uc720\ud560 \ud544\uc694\uac00 \uc5c6\ub294 \uacbd\uc6b0 \uac01 \ud300\uc774 \uc0c1\ud638 \uc791\uc6a9\ud560 \uc218 \uc788\ub294 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud558\ub294 IAM \uc815\ucc45 \uc138\ud2b8\ub97c \ub9cc\ub4dc\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\ub97c \uad6c\ud604\ud558\ub294 \uc88b\uc740 \ubc29\ubc95\uc740 ECR \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub294 \uc720\uc0ac\ud55c \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\ub97c \uadf8\ub8f9\ud654\ud558\ub294 \ubc29\ubc95\uc785\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ud300 A\uc758 \ubaa8\ub4e0 \ub808\uc9c0\uc2a4\ud2b8\ub9ac \uc55e\uc5d0 team-a/\ub97c \ubd99\uc774\uace0 \ud300 B\uc758 \ub808\uc9c0\uc2a4\ud2b8\ub9ac \uc55e\uc5d0\ub294 team-b/ \uc811\ub450\uc0ac\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud558\ub294 \uc815\ucc45\uc740 \ub2e4\uc74c\uacfc \uac19\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AllowPushPull\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ecr:GetDownloadUrlForLayer\",\n        \"ecr:BatchGetImage\",\n        \"ecr:BatchCheckLayerAvailability\",\n        \"ecr:PutImage\",\n        \"ecr:InitiateLayerUpload\",\n        \"ecr:UploadLayerPart\",\n        \"ecr:CompleteLayerUpload\"\n      ],\n      \"Resource\": [\n        \"arn:aws:ecr:&lt;region&gt;:&lt;account_id&gt;:repository/team-a/*\"\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"ko/security/docs/image/#ecr","title":"ECR \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc0ac\uc6a9 \uace0\ub824","text":"<p>ECR API\uc5d0\ub294 \ud37c\ube14\ub9ad \uc5d4\ub4dc\ud3ec\uc778\ud2b8\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c IAM\uc5d0\uc11c \uc694\uccad\uc744 \uc778\uc99d\ud558\uace0 \uc2b9\uc778\ud558\uae30\ub9cc \ud558\uba74 \uc778\ud130\ub137\uc5d0\uc11c ECR \ub808\uc9c0\uc2a4\ud2b8\ub9ac\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 VPC\uc5d0 IGW(\uc778\ud130\ub137 \uac8c\uc774\ud2b8\uc6e8\uc774)\uac00 \uc5c6\ub294 \uc0cc\ub4dc\ubc15\uc2a4 \ud658\uacbd\uc5d0\uc11c \uc6b4\uc601\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 ECR\uc6a9 \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud504\ub77c\uc774\ube57 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc0dd\uc131\ud558\uba74 \uc778\ud130\ub137\uc744 \ud1b5\ud574 \ud2b8\ub798\ud53d\uc744 \ub77c\uc6b0\ud305\ud558\ub294 \ub300\uc2e0 \ud504\ub77c\uc774\ube57 IP \uc8fc\uc18c\ub97c \ud1b5\ud574 ECR API\uc5d0 \ube44\uacf5\uac1c\ub85c \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc8fc\uc81c\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 Amazon ECR \uc778\ud130\ud398\uc774\uc2a4 VPC \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#ecr_1","title":"ECR \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc815\ucc45 \uad6c\ud604","text":"<p>\uae30\ubcf8 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc815\ucc45\uc740 \ub9ac\uc804 \ub0b4\uc758 \ubaa8\ub4e0 ECR \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \uc774\ub85c \uc778\ud574 \uacf5\uaca9\uc790/\ub0b4\ubd80\uc790\uac00 \ub370\uc774\ud130\ub97c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub85c \ud328\ud0a4\uc9d5\ud558\uace0 \ub2e4\ub978 AWS \uacc4\uc815\uc758 \ub808\uc9c0\uc2a4\ud2b8\ub9ac\ub85c \ud478\uc2dc\ud558\uc5ec \ub370\uc774\ud130\ub97c \uc720\ucd9c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc704\ud5d8\uc744 \uc644\ud654\ud558\ub824\uba74 ECR \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ub300\ud55c API \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud558\ub294 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc815\ucc45\uc744 \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ub2e4\uc74c \uc815\ucc45\uc740 \uacc4\uc815\uc758 \ubaa8\ub4e0 AWS \uc6d0\uce59\uc774 ECR \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ub300\ud574\uc11c\ub9cc \ubaa8\ub4e0 \uc791\uc5c5\uc744 \uc218\ud589\ud558\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4.</p> <pre><code>{\n  \"Statement\": [\n    {\n      \"Sid\": \"LimitECRAccess\",\n      \"Principal\": \"*\",\n      \"Action\": \"*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ecr:&lt;region&gt;:&lt;account_id&gt;:repository/*\"\n    }\n  ]\n}\n</code></pre> <p>AWS \uc870\uc9c1\uc5d0 \uc18d\ud558\uc9c0 \uc54a\uc740 IAM \uc6d0\uce59\uc5d0 \uc758\ud55c \uc774\ubbf8\uc9c0 \ud478\uc2dc/\ud480\ub9c1\uc744 \ubc29\uc9c0\ud558\ub294 \uc0c8\ub85c\uc6b4 <code>PrincipalOrGid</code> \uc18d\uc131\uc744 \uc0ac\uc6a9\ud558\ub294 \uc870\uac74\uc744 \uc124\uc815\ud558\uc5ec \uc774\ub97c \ub354\uc6b1 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 AWS:PrincipalorgID\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624. <code>com.amazonaws.&lt;region&gt;.ecr.dkr</code> \ubc0f <code>com.amazonaws.&lt;region&gt;.ecr.api</code> \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \ubaa8\ub450\uc5d0 \ub3d9\uc77c\ud55c \uc815\ucc45\uc744 \uc801\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4. EKS\ub294 ECR\uc5d0\uc11c kube-proxy, coredns \ubc0f aws-node\uc6a9 \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\ubbc0\ub85c, \ub808\uc9c0\uc2a4\ud2b8\ub9ac\uc758 \uacc4\uc815 ID (\uc608: <code>602401143452.dkr. ecr.us-west-2.amazonaws.com /*</code>)\ub97c \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc815\ucc45\uc758 \ub9ac\uc18c\uc2a4 \ubaa9\ub85d\uc5d0 \ucd94\uac00\ud558\uac70\ub098 \"*\"\uc5d0\uc11c \uac00\uc838\uc624\uae30\ub97c \ud5c8\uc6a9\ud558\uace0 \uacc4\uc815 ID\uc5d0 \ub300\ud55c \ud478\uc2dc\ub97c \uc81c\ud55c\ud558\ub3c4\ub85d \uc815\ucc45\uc744 \ubcc0\uacbd\ud574\uc57c \ud569\ub2c8\ub2e4. \uc544\ub798 \ud45c\ub294 EKS \uc774\ubbf8\uc9c0\ub97c \uc81c\uacf5\ud558\ub294 AWS \uacc4\uc815\uacfc \ud074\ub7ec\uc2a4\ud130 \uc9c0\uc5ed \uac04\uc758 \ub9e4\ud551\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4.</p> Account Number Region 602401143452 All commercial regions except for those listed below --- --- 800184023465 ap-east-1 - Asia Pacific (Hong Kong) 558608220178 me-south-1 - Middle East (Bahrain) 918309763551 cn-north-1 - China (Beijing) 961992271922 cn-northwest-1 - China (Ningxia) <p>\uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc815\ucc45 \uc0ac\uc6a9\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 VPC \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec Amazon ECR \uc561\uc138\uc2a4 \uc81c\uc5b4\ub97c \ucc38\uc870\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#ecr_2","title":"ECR\uc5d0 \ub300\ud55c \uc218\uba85 \uc8fc\uae30 \uc815\ucc45 \uad6c\ud604","text":"<p>NIST \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ucee8\ud14c\uc774\ub108 \ubcf4\uc548 \uac00\uc774\ub4dc \ub294 \"\ub808\uc9c0\uc2a4\ud2b8\ub9ac\uc758 \uc624\ub798\ub41c \uc774\ubbf8\uc9c0\"\uc758 \uc704\ud5d8\uc5d0 \ub300\ud574 \uacbd\uace0\ud558\uba70, \uc2dc\uac04\uc774 \uc9c0\ub098\uba74 \ucde8\uc57d\ud558\uace0 \uc624\ub798\ub41c \uc18c\ud504\ud2b8\uc6e8\uc5b4 \ud328\ud0a4\uc9c0\uac00 \ud3ec\ud568\ub41c \uc624\ub798\ub41c \uc774\ubbf8\uc9c0\ub97c \uc81c\uac70\ud558\uc5ec \uc6b0\ubc1c\uc801\uc778 \ubc30\ud3ec \ubc0f \ub178\ucd9c\uc744 \ubc29\uc9c0\ud574\uc57c \ud55c\ub2e4\uace0 \uc9c0\uc801\ud569\ub2c8\ub2e4. \uac01 ECR \uc800\uc7a5\uc18c\uc5d0\ub294 \uc774\ubbf8\uc9c0 \ub9cc\ub8cc \uc2dc\uae30\uc5d0 \ub300\ud55c \uaddc\uce59\uc744 \uc124\uc815\ud558\ub294 \uc218\uba85 \uc8fc\uae30 \uc815\ucc45\uc774 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. AWS \uacf5\uc2dd \ubb38\uc11c\uc5d0\ub294 \ud14c\uc2a4\ud2b8 \uaddc\uce59\uc744 \uc124\uc815\ud558\uace0 \ud3c9\uac00\ud55c \ub2e4\uc74c \uc801\uc6a9\ud558\ub294 \ubc29\ubc95\uc774 \uc124\uba85\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uacf5\uc2dd \ubb38\uc11c\uc5d0\ub294 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc758 \uc774\ubbf8\uc9c0\ub97c \ud544\ud130\ub9c1\ud558\ub294 \ub2e4\uc591\ud55c \ubc29\ubc95\uc744 \ubcf4\uc5ec\uc8fc\ub294 \uc5ec\ub7ec \uc218\uba85 \uc8fc\uae30 \uc815\ucc45 \uc608\uc81c\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\uc774\ubbf8\uc9c0 \uc0dd\uc131\uc2dc\uae30 \ub610\ub294 \uac1c\uc218\ub85c \ud544\ud130\ub9c1</li> <li>\ud0dc\uadf8 \ub610\ub294 \ud0dc\uadf8\uac00 \uc9c0\uc815\ub418\uc9c0 \uc54a\uc740 \uc774\ubbf8\uc9c0\ub85c \ud544\ud130\ub9c1</li> <li>\uc5ec\ub7ec \uaddc\uce59 \ub610\ub294 \ub2e8\uc77c \uaddc\uce59\uc5d0\uc11c \uc774\ubbf8\uc9c0 \ud0dc\uadf8\ub85c \ud544\ud130\ub9c1</li> </ul> \uacbd\uace0 <p>\uc7a5\uae30 \uc2e4\ud589 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc6a9 \uc774\ubbf8\uc9c0\ub97c ECR\uc5d0\uc11c \uc81c\uac70\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc7ac\ubc30\ud3ec\ud558\uac70\ub098 \uc218\ud3c9\uc73c\ub85c \ud655\uc7a5\ud560 \ub54c \uc774\ubbf8\uc9c0 \uac00\uc838\uc624\uae30 \uc624\ub958\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uc774\ubbf8\uc9c0 \uc218\uba85 \uc8fc\uae30 \uc815\ucc45\uc744 \uc0ac\uc6a9\ud560 \ub54c\ub294 \ubc30\ud3ec\uc640 \ud574\ub2f9 \ubc30\ud3ec\uc5d0\uc11c \ucc38\uc870\ud558\ub294 \uc774\ubbf8\uc9c0\ub97c \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud558\uace0 \ub9b4\ub9ac\uc2a4/\ubc30\ud3ec\uc758 \ube48\ub3c4\ub97c \uc124\uba85\ud558\ub294 [\uc774\ubbf8\uc9c0] \ub9cc\ub8cc \uaddc\uce59\uc744 \ud56d\uc0c1 \ub9cc\ub4e4 \uc218 \uc788\ub3c4\ub85d CI/CD \ubaa8\ubc94 \uc0ac\ub840\ub97c \ub9c8\ub828\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#_6","title":"\uc120\ubcc4\ub41c \uc774\ubbf8\uc9c0 \uc138\ud2b8 \ub9cc\ub4e4\uae30","text":"<p>\uac1c\ubc1c\uc790\uac00 \uc9c1\uc811 \uc774\ubbf8\uc9c0\ub97c \ub9cc\ub4e4\ub3c4\ub85d \ud5c8\uc6a9\ud558\ub294 \ub300\uc2e0 \uc870\uc9c1\uc758 \ub2e4\uc591\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc2a4\ud0dd\uc5d0 \ub300\ud574 \uac80\uc99d\ub41c \uc774\ubbf8\uc9c0 \uc138\ud2b8\ub97c \ub9cc\ub4dc\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc138\uc694. \uc774\ub807\uac8c \ud558\uba74 \uac1c\ubc1c\uc790\ub294 Dockerfile \uc791\uc131 \ubc29\ubc95\uc744 \ubc30\uc6b0\uc9c0 \uc54a\uace0 \ucf54\ub4dc \uc791\uc131\uc5d0 \uc9d1\uc911\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubcc0\uacbd \uc0ac\ud56d\uc774 Master\uc5d0 \ubcd1\ud569\ub418\uba74 CI/CD \ud30c\uc774\ud504\ub77c\uc778\uc740 \uc790\ub3d9\uc73c\ub85c \uc5d0\uc14b\uc744 \ucef4\ud30c\uc77c\ud558\uace0, \uc544\ud2f0\ud329\ud2b8 \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \uc800\uc7a5\ud558\uace0, \uc544\ud2f0\ud329\ud2b8\ub97c \uc801\uc808\ud55c \uc774\ubbf8\uc9c0\uc5d0 \ubcf5\uc0ac\ud55c \ub2e4\uc74c ECR\uacfc \uac19\uc740 Docker \ub808\uc9c0\uc2a4\ud2b8\ub9ac\ub85c \ud478\uc2dc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd5c\uc18c\ud55c \uac1c\ubc1c\uc790\uac00 \uc790\uccb4 Dockerfile\uc744 \ub9cc\ub4e4 \uc218 \uc788\ub294 \uae30\ubcf8 \uc774\ubbf8\uc9c0 \uc138\ud2b8\ub97c \ub9cc\ub4e4\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\uc0c1\uc801\uc73c\ub85c\ub294 Dockerhub\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\uc9c0 \uc54a\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. a) \uc774\ubbf8\uc9c0\uc5d0 \ubb34\uc5c7\uc774 \ub4e4\uc5b4 \uc788\ub294\uc9c0 \ud56d\uc0c1 \uc54c \uc218\ub294 \uc5c6\uace0 b) \uc0c1\uc704 1000\uac1c \uc774\ubbf8\uc9c0 \uc911 \uc57d 1/5\uc5d0\ub294 \ucde8\uc57d\uc810\uc774 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc774\ub7f0 \uc774\ubbf8\uc9c0 \ubc0f \ucde8\uc57d\uc131 \ubaa9\ub85d\uc740 \uc774 \uc0ac\uc774\ud2b8\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#dockerfile-user","title":"\ub8e8\ud2b8\uac00 \uc544\ub2cc \uc0ac\uc6a9\uc790\ub85c \uc2e4\ud589\ud558\ub824\uba74 Dockerfile\uc5d0 USER \uc9c0\uc2dc\ubb38\uc744 \ucd94\uac00","text":"<p>\ud30c\ub4dc \ubcf4\uc548 \uc139\uc158\uc5d0\uc11c \uc5b8\uae09\ud588\ub4ef\uc774 \ucee8\ud14c\uc774\ub108\ub97c \ub8e8\ud2b8\ub85c \uc2e4\ud589\ud558\ub294 \uac83\uc740 \ud53c\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub97c PodSpec\uc758 \uc77c\ubd80\ub85c \uad6c\uc131\ud560 \uc218 \uc788\uc9c0\ub9cc Dockerfile\uc5d0\ub294 <code>USER</code> \ub514\ub809\ud2f0\ube0c\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. <code>USER</code> \uc9c0\uc2dc\uc5b4\ub294 USER \uc9c0\uc2dc\ubb38 \ub4a4\uc5d0 \ub098\ud0c0\ub098\ub294 <code>RUN</code>, <code>ENTRYPOINT</code> \ub610\ub294 <code>CMD</code> \uba85\ub839\uc744 \uc2e4\ud589\ud560 \ub54c \uc0ac\uc6a9\ud560 UID\ub97c \uc124\uc815\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#dockerfile","title":"Dockerfile \ub9b0\ud2b8","text":"<p>Linting\uc744 \uc0ac\uc6a9\ud558\uc5ec Dockerfile\uc774 \uc0ac\uc804 \uc815\uc758\ub41c \uc9c0\uce68(\uc608: 'USER' \uc9c0\uce68 \ud3ec\ud568 \ub610\ub294 \ubaa8\ub4e0 \uc774\ubbf8\uc9c0\uc5d0 \ud0dc\uadf8\ub97c \uc9c0\uc815\ud574\uc57c \ud568)\uc744 \uc900\uc218\ud558\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. dockerfile_lint\ub294 \uc77c\ubc18\uc801\uc778 \ubaa8\ubc94 \uc0ac\ub840\ub97c \uac80\uc99d\ud558\uace0 \ub3c4\ucee4\ud30c\uc77c \ub9b0\ud2b8\ub97c \uc704\ud55c \uc790\uccb4 \uaddc\uce59\uc744 \uad6c\ucd95\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uaddc\uce59 \uc5d4\uc9c4\uc744 \ud3ec\ud568\ud558\ub294 RedHat\uc758 \uc624\ud508\uc18c\uc2a4 \ud504\ub85c\uc81d\ud2b8\uc785\ub2c8\ub2e4. \uaddc\uce59\uc744 \uc704\ubc18\ud558\ub294 Dockerfile\uc774 \ud3ec\ud568\ub41c \ube4c\ub4dc\ub294 \uc790\ub3d9\uc73c\ub85c \uc2e4\ud328\ud55c\ub2e4\ub294 \uc810\uc5d0\uc11c CI \ud30c\uc774\ud504\ub77c\uc778\uc5d0 \ud1b5\ud569\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#_7","title":"\uc2a4\ud06c\ub798\uce58\uc5d0\uc11c \uc774\ubbf8\uc9c0 \ube4c\ub4dc","text":"<p>\uc774\ubbf8\uc9c0\ub97c \uad6c\ucd95\ud560 \ub54c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc758 \uacf5\uaca9 \ud45c\uba74\uc744 \uc904\uc774\ub294 \uac83\uc774 \uc8fc\uc694 \ubaa9\ud45c\uac00 \ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\ub97c \uc704\ud55c \uc774\uc0c1\uc801\uc778 \ubc29\ubc95\uc740 \ucde8\uc57d\uc131\uc744 \uc545\uc6a9\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ubc14\uc774\ub108\ub9ac\uac00 \uc5c6\ub294 \ucd5c\uc18c\ud55c\uc758 \uc774\ubbf8\uc9c0\ub97c \ub9cc\ub4dc\ub294 \uac83\uc785\ub2c8\ub2e4. \ub2e4\ud589\ud788 \ub3c4\ucee4\uc5d0\ub294 <code>scratch</code>\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \uc0dd\uc131\ud558\ub294 \uba54\ucee4\ub2c8\uc998\uc774 \uc788\uc2b5\ub2c8\ub2e4. Go\uc640 \uac19\uc740 \uc5b8\uc5b4\ub97c \uc0ac\uc6a9\ud558\uba74 \ub2e4\uc74c \uc608\uc81c\uc640 \uac19\uc774 \uc815\uc801 \uc5f0\uacb0 \ubc14\uc774\ub108\ub9ac\ub97c \ub9cc\ub4e4\uc5b4 Dockerfile\uc5d0\uc11c \ucc38\uc870\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>############################\n# STEP 1 build executable binary\n############################\nFROM golang:alpine AS builder# Install git.\n# Git is required for fetching the dependencies.\nRUN apk update &amp;&amp; apk add --no-cache gitWORKDIR $GOPATH/src/mypackage/myapp/COPY . . # Fetch dependencies.\n# Using go get.\nRUN go get -d -v# Build the binary.\nRUN go build -o /go/bin/hello\n\n############################\n# STEP 2 build a small image\n############################\nFROM scratch# Copy our static executable.\nCOPY --from=builder /go/bin/hello /go/bin/hello# Run the hello binary.\nENTRYPOINT [\"/go/bin/hello\"]\n</code></pre> <p>\uc774\ub807\uac8c \ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc73c\ub85c\ub9cc \uad6c\uc131\ub41c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uac00 \uc0dd\uc131\ub418\uc5b4 \ub9e4\uc6b0 \uc548\uc804\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#ecr_3","title":"ECR\uacfc \ud568\uaed8 \ubd88\ubcc0 \ud0dc\uadf8 \uc0ac\uc6a9","text":"<p>\ubcc0\uacbd \ubd88\uac00\ub2a5\ud55c \ud0dc\uadf8\ub97c \uc0ac\uc6a9\ud558\uba74 \uc774\ubbf8\uc9c0 \uc800\uc7a5\uc18c\ub85c \ud478\uc2dc\ud560 \ub54c\ub9c8\ub2e4 \uc774\ubbf8\uc9c0 \ud0dc\uadf8\ub97c \uc5c5\ub370\uc774\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uacf5\uaca9\uc790\uac00 \uc774\ubbf8\uc9c0\uc758 \ud0dc\uadf8\ub97c \ubcc0\uacbd\ud558\uc9c0 \uc54a\uace0\ub3c4 \uc545\uc131 \ubc84\uc804\uc73c\ub85c \uc774\ubbf8\uc9c0\ub97c \ub36e\uc5b4\uc4f0\ub294 \uac83\uc744 \ub9c9\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c \uc774\ubbf8\uc9c0\ub97c \uc27d\uace0 \uace0\uc720\ud558\uac8c \uc2dd\ubcc4\ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#sbom","title":"\uc774\ubbf8\uc9c0, SBOM, \ud30c\uc774\ud504\ub77c\uc778 \uc2e4\ud589 \ubc0f \ucde8\uc57d\uc131 \ubcf4\uace0\uc11c\uc5d0 \uc11c\uba85","text":"<p>\ub3c4\ucee4\uac00 \ucc98\uc74c \ub3c4\uc785\ub418\uc5c8\uc744 \ub54c\ub294 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uac80\uc99d\ud558\uae30 \uc704\ud55c \uc554\ud638\ud654 \ubaa8\ub378\uc774 \uc5c6\uc5c8\uc2b5\ub2c8\ub2e4. v2\uc5d0\uc11c \ub3c4\ucee4\ub294 \uc774\ubbf8\uc9c0 \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0 \ub2e4\uc774\uc81c\uc2a4\ud2b8\ub97c \ucd94\uac00\ud588\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uc774\ubbf8\uc9c0 \uad6c\uc131\uc744 \ud574\uc2dc\ud558\uace0 \ud574\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774\ubbf8\uc9c0\uc758 ID\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4. \uc774\ubbf8\uc9c0 \uc11c\uba85\uc774 \ud65c\uc131\ud654\ub418\uba74 \ub3c4\ucee4 \uc5d4\uc9c4\uc740 \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc758 \uc11c\uba85\uc744 \ud655\uc778\ud558\uc5ec \ucf58\ud150\uce20\uac00 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \ucd9c\ucc98\uc5d0\uc11c \uc0dd\uc131\ub418\uc5c8\uc73c\uba70 \ubcc0\uc870\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uc558\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. \uac01 \uacc4\uce35\uc774 \ub2e4\uc6b4\ub85c\ub4dc\ub41c \ud6c4 \uc5d4\uc9c4\uc740 \uacc4\uce35\uc758 \ub2e4\uc774\uc81c\uc2a4\ud2b8\ub97c \ud655\uc778\ud558\uc5ec \ucf58\ud150\uce20\uac00 \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0 \uc9c0\uc815\ub41c \ucf58\ud150\uce20\uc640 \uc77c\uce58\ud558\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4. \uc774\ubbf8\uc9c0 \uc11c\uba85\uc744 \uc0ac\uc6a9\ud558\uba74 \uc774\ubbf8\uc9c0\uc640 \uad00\ub828\ub41c \ub514\uc9c0\ud138 \uc11c\uba85\uc744 \uac80\uc99d\ud558\uc5ec \uc548\uc804\ud55c \uacf5\uae09\ub9dd\uc744 \ud6a8\uacfc\uc801\uc73c\ub85c \uad6c\ucd95\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>AWS Signer \ub610\ub294 Sigstore Cosign\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0 \uc11c\uba85\ud558\uace0, SBOM\uc5d0 \ub300\ud55c \uc99d\uba85, \ucde8\uc57d\uc131 \uc2a4\uce94 \ubcf4\uace0\uc11c \ubc0f \ud30c\uc774\ud504\ub77c\uc778 \uc2e4\ud589 \ubcf4\uace0\uc11c\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc99d\uba85\uc740 \uc774\ubbf8\uc9c0\uc758 \uc2e0\ub8b0\uc131\uacfc \ubb34\uacb0\uc131\uc744 \ubcf4\uc7a5\ud558\uace0, \uc774\ubbf8\uc9c0\uac00 \uc2e4\uc81c\ub85c \uc5b4\ub5a0\ud55c \uac04\uc12d\uc774\ub098 \ubcc0\uc870 \uc5c6\uc774 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \ud30c\uc774\ud504\ub77c\uc778\uc5d0 \uc758\ud574 \uc0dd\uc131\ub418\uc5c8\uc73c\uba70, \uc774\ubbf8\uc9c0 \uac8c\uc2dc\uc790\uac00 \uac80\uc99d\ud558\uace0 \uc2e0\ub8b0\ud558\ub294 SBOM\uc5d0 \ubb38\uc11c\ud654\ub41c \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uad6c\uc131 \uc694\uc18c\ub9cc \ud3ec\ud568\ud55c\ub2e4\ub294 \uac83\uc744 \ubcf4\uc99d\ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc99d\uba85\uc744 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0 \ucca8\ubd80\ud558\uc5ec \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\ub85c \ud478\uc2dc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uc139\uc158\uc5d0\uc11c\ub294 \uac10\uc0ac \ubc0f \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec \uac80\uc99d\uc744 \uc704\ud574 \uc785\uc99d\ub41c \uc544\ud2f0\ud329\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc744 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/image/#_8","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud55c \uc774\ubbf8\uc9c0 \ubb34\uacb0\uc131 \uac80\uc99d","text":"<p>\ub3d9\uc801 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub300\uc0c1 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc774\ubbf8\uc9c0\ub97c \ubc30\ud3ec\ud558\uae30 \uc804\uc5d0 \uc790\ub3d9\ud654\ub41c \ubc29\uc2dd\uc73c\ub85c \uc774\ubbf8\uc9c0 \uc11c\uba85\uacfc \uc785\uc99d\ub41c \uc544\ud2f0\ud329\ud2b8\ub97c \ud655\uc778\ud558\uace0 \uc544\ud2f0\ud329\ud2b8\uc758 \ubcf4\uc548 \uba54\ud0c0\ub370\uc774\ud130\uac00 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec \uc815\ucc45\uc744 \uc900\uc218\ud558\ub294 \uacbd\uc6b0\uc5d0\ub9cc \ubc30\ud3ec\ub97c \uc2b9\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4 \uc774\ubbf8\uc9c0\uc758 \uc11c\uba85\uc744 \uc554\ud638\ub85c \ud655\uc778\ud558\ub294 \uc815\ucc45, \uc785\uc99d\ub41c SBOM, \uc785\uc99d\ub41c \ud30c\uc774\ud504\ub77c\uc778 \uc2e4\ud589 \ubcf4\uace0\uc11c \ub610\ub294 \uc785\uc99d\ub41c CVE \uc2a4\uce94 \ubcf4\uace0\uc11c\ub97c \uc791\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ubcf4\uace0\uc11c\uc5d0 \ub370\uc774\ud130\ub97c \ud655\uc778\ud558\uae30 \uc704\ud55c \uc870\uac74\uc744 \uc815\ucc45\uc5d0 \uc791\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, CVE \uc2a4\uce94\uc5d0\ub294 \uc911\uc694\ud55c CVE\uac00 \uc5c6\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc870\uac74\uc744 \ucda9\uc871\ud558\ub294 \uc774\ubbf8\uc9c0\uc5d0\ub9cc \ubc30\ud3ec\uac00 \ud5c8\uc6a9\ub418\uba70 \ub2e4\ub978 \ubaa8\ub4e0 \ubc30\ud3ec\ub294 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\uc5d0 \uc758\ud574 \uac70\ubd80\ub429\ub2c8\ub2e4.</p> <p>\uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\uc758 \uc608\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4:</p> <ul> <li>Kyverno</li> <li>OPA Gatekeeper</li> <li>Portieris</li> <li>Ratify</li> <li>Kritis</li> <li>Grafeas tutorial</li> <li>Voucher</li> </ul>"},{"location":"ko/security/docs/image/#_9","title":"\ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc758 \ud328\ud0a4\uc9c0 \uc5c5\ub370\uc774\ud2b8","text":"<p>\uc774\ubbf8\uc9c0\uc758 \ud328\ud0a4\uc9c0\ub97c \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\ub824\uba74 \ub3c4\ucee4\ud30c\uc77c\uc5d0 <code>apt-get update &amp;&amp; apt-get upgrade</code> \uc2e4\ud589\uc744 \ud3ec\ud568\ud574\uc57c \ud569\ub2c8\ub2e4. \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\ub824\uba74 \ub8e8\ud2b8\ub85c \uc2e4\ud589\ud574\uc57c \ud558\uc9c0\ub9cc \uc774\ub294 \uc774\ubbf8\uc9c0 \ube4c\ub4dc \ub2e8\uacc4\uc5d0\uc11c \ubc1c\uc0dd\ud569\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ub8e8\ud2b8\ub85c \uc2e4\ud589\ud560 \ud544\uc694\ub294 \uc5c6\uc2b5\ub2c8\ub2e4. \uc5c5\ub370\uc774\ud2b8\ub97c \uc124\uce58\ud55c \ub2e4\uc74c USER \uc9c0\uc2dc\ubb38\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub2e4\ub978 \uc0ac\uc6a9\uc790\ub85c \uc804\ud658\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8 \uc774\ubbf8\uc9c0\ub97c \ub8e8\ud2b8 \uc0ac\uc6a9\uc790\uac00 \uc544\ub2cc \uc0ac\uc6a9\uc790\ub85c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 \ub8e8\ud2b8 \uc0ac\uc6a9\uc790\ub85c \uc804\ud658\ud588\ub2e4\uac00 \ub2e4\uc2dc \uc2e4\ud589\ud558\uc138\uc694. \uae30\ubcf8 \uc774\ubbf8\uc9c0 \uad00\ub9ac\uc790\uc5d0\uac8c\ub9cc \uc758\uc874\ud558\uc5ec \ucd5c\uc2e0 \ubcf4\uc548 \uc5c5\ub370\uc774\ud2b8\ub97c \uc124\uce58\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624.</p> <p><code>apt-get clean</code>\uc744 \uc2e4\ud589\ud558\uc5ec <code>/var/cache/apt/archives/</code>\uc5d0\uc11c \uc124\uce58 \ud504\ub85c\uadf8\ub7a8 \ud30c\uc77c\uc744 \uc0ad\uc81c\ud569\ub2c8\ub2e4. \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud55c \ud6c4 <code>rm -rf /var/lib/apt/lists/*</code>\ub97c \uc2e4\ud589\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uc124\uce58\ud560 \uc218 \uc788\ub294 \uc778\ub371\uc2a4 \ud30c\uc77c\uc774\ub098 \ud328\ud0a4\uc9c0 \ubaa9\ub85d\uc774 \uc81c\uac70\ub429\ub2c8\ub2e4. \uc774\ub7f0 \uba85\ub839\uc740 \uac01 \ud328\ud0a4\uc9c0 \uad00\ub9ac\uc790\ub9c8\ub2e4 \ub2e4\ub97c \uc218 \uc788\ub2e4\ub294 \uc810\uc5d0 \uc720\uc758\ud558\uc2ed\uc2dc\uc624. \uc608\ub97c \ub4e4\uba74 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>RUN apt-get update &amp;&amp; apt-get install -y \\\n    curl \\\n    git \\\n    libsqlite3-dev \\\n    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre>"},{"location":"ko/security/docs/image/#_10","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<ul> <li>docker-slim\ub294 \uc548\uc804\ud55c \ucd5c\uc18c \uc774\ubbf8\uc9c0\ub97c \uad6c\ucd95\ud569\ub2c8\ub2e4.</li> <li>dockle\ub294 Dockerfile\uc774 \ubcf4\uc548 \uc774\ubbf8\uc9c0 \uc0dd\uc131 \ubaa8\ubc94 \uc0ac\ub840\uc640 \uc77c\uce58\ud558\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4.</li> <li>dockerfile-lint Rule based linter for Dockerfiles</li> <li>hadolint\ub294 \ub3c4\ucee4\ud30c\uc77c\uc6a9 \uaddc\uce59 \uae30\ubc18 \ub9b0\ud130\uc785\ub2c8\ub2e4.</li> <li>Gatekeeper and OPA\ub294 \uc815\ucc45 \uae30\ubc18 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\uc785\ub2c8\ub2e4.</li> <li>Kyverno\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\uc774\ud2f0\ube0c \uc815\ucc45 \uc5d4\uc9c4\uc785\ub2c8\ub2e4.</li> <li>in-toto\ub97c \ud1b5\ud574 \uacf5\uae09\ub9dd\uc758 \ud2b9\uc815 \ub2e8\uacc4\uac00 \uc218\ud589\ub420 \uc608\uc815\uc774\uc5c8\ub294\uc9c0, \ud574\ub2f9 \ub2e8\uacc4\uac00 \uc62c\ubc14\ub978 \ud589\uc704\uc790\uc5d0 \uc758\ud574 \uc218\ud589\ub418\uc5c8\ub294\uc9c0 \uc0ac\uc6a9\uc790\uac00 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>Notary\ub294 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \uc11c\uba85 \ud504\ub85c\uc81d\ud2b8\uc785\ub2c8\ub2e4.</li> <li>Notary v2</li> <li>Grafeas\ub294 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uacf5\uae09\ub9dd\uc744 \uac10\uc0ac \ubc0f \uad00\ub9ac\ud558\uae30 \uc704\ud55c \uac1c\ubc29\ud615 \uc544\ud2f0\ud329\ud2b8 \uba54\ud0c0\ub370\uc774\ud130 API\uc785\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/incidents/","title":"\uc0ac\uace0 \ub300\uc751 \ubc0f \ud3ec\ub80c\uc2dd","text":"<p>\uc0ac\uace0\uc5d0 \uc2e0\uc18d\ud558\uac8c \ub300\uc751\ud560 \uc218 \uc788\uc73c\uba74 \uce68\ud574\ub85c \uc778\ud55c \ud53c\ud574\ub97c \ucd5c\uc18c\ud654\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc758\uc2ec\uc2a4\ub7ec\uc6b4 \ud589\ub3d9\uc744 \uacbd\uace0\ud560 \uc218 \uc788\ub294 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \uacbd\uace0 \uc2dc\uc2a4\ud15c\uc744 \uac16\ucd94\ub294 \uac83\uc774 \uc62c\ubc14\ub978 \uc0ac\uace0 \ub300\uc751 \uacc4\ud68d\uc758 \uccab \ubc88\uc9f8 \ub2e8\uacc4\uc785\ub2c8\ub2e4. \uc0ac\uace0\uac00 \ubc1c\uc0dd\ud558\uba74 \uc601\ud5a5\uc744 \ubc1b\ub294 \ucee8\ud14c\uc774\ub108\ub97c \ud3d0\uae30\ud558\uc5ec \uad50\uccb4\ud560\uc9c0 \uc544\ub2c8\uba74 \ucee8\ud14c\uc774\ub108\ub97c \uaca9\ub9ac\ud558\uace0 \uac80\uc0ac\ud560\uc9c0 \uc2e0\uc18d\ud558\uac8c \uacb0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \ud3ec\ub80c\uc2dd \uc870\uc0ac \ubc0f \uadfc\ubcf8 \uc6d0\uc778 \ubd84\uc11d\uc758 \uc77c\ud658\uc73c\ub85c \ucee8\ud14c\uc774\ub108\ub97c \uaca9\ub9ac\ud558\uae30\ub85c \uc120\ud0dd\ud55c \uacbd\uc6b0 \ub2e4\uc74c\uacfc \uac19\uc740 \uc77c\ub828\uc758 \ud65c\ub3d9\uc744 \ub530\ub77c\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_2","title":"\uc0ac\uace0 \ub300\uc751 \uacc4\ud68d \uc608","text":""},{"location":"ko/security/docs/incidents/#_3","title":"\ubb38\uc81c\uac00 \ub418\ub294 \ud30c\ub4dc\uc640 \uc6cc\ucee4 \ub178\ub4dc \uc2dd\ubcc4","text":"<p>\uccab \ubc88\uc9f8 \uc870\uce58\ub294 \uce68\ud574\ub97c \uaca9\ub9ac\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uba3c\uc800 \uce68\ud574\uac00 \ubc1c\uc0dd\ud55c \uc704\uce58\ub97c \ud30c\uc545\ud558\uace0 \ud574\ub2f9 \ud30c\ub4dc\uc640 \ud574\ub2f9 \ub178\ub4dc\ub97c \uc778\ud504\ub77c\uc758 \ub098\uba38\uc9c0 \ubd80\ubd84\uc73c\ub85c\ubd80\ud130 \uaca9\ub9ac\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_4","title":"\uc6cc\ud06c\ub85c\ub4dc \uc774\ub984\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubb38\uc81c\uac00 \ub418\ub294 \ud30c\ub4dc\uc640 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc2dd\ubcc4","text":"<p>\ubb38\uc81c\uac00 \ub418\ub294 \ud30c\ub4dc\uc758 \uc774\ub984\uacfc \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc54c\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc2dd\ubcc4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl get pods &lt;name&gt; --namespace &lt;namespace&gt; -o=jsonpath='{.spec.nodeName}{\"\\n\"}'   \n</code></pre> <p>\ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc640 \uac19\uc740 \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\uac00 \uc190\uc0c1\ub41c \uacbd\uc6b0, \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\uc758 \uc77c\ubd80\uc778 \ubaa8\ub4e0 \ud30c\ub4dc\uac00 \uc190\uc0c1\ub420 \uac00\ub2a5\uc131\uc774 \uc788\ub2e4. \ub2e4\uc74c \uba85\ub839\uc5b4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\uc640 \ud574\ub2f9 \ud30c\ub4dc\uac00 \uc2e4\ud589 \uc911\uc778 \ub178\ub4dc\ub97c \ub098\uc5f4\ud558\uc138\uc694.</p> <pre><code>selector=$(kubectl get deployments &lt;name&gt; \\\n --namespace &lt;namespace&gt; -o json | jq -j \\\n'.spec.selector.matchLabels | to_entries | .[] | \"\\(.key)=\\(.value)\"')\n\nkubectl get pods --namespace &lt;namespace&gt; --selector=$selector \\\n-o json | jq -r '.items[] | \"\\(.metadata.name) \\(.spec.nodeName)\"'\n</code></pre> <p>\uc704\ub294 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \uc704\ud55c \uba85\ub839\uc785\ub2c8\ub2e4. \ub808\ud50c\ub9ac\uce74\uc14b, \uc2a4\ud14c\uc774\ud2b8\ud480\uc14b \ub4f1\uacfc \uac19\uc740 \ub2e4\ub978 \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud574\uc11c\ub3c4 \ub3d9\uc77c\ud55c \uba85\ub839\uc744 \uc2e4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_5","title":"\uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uc774\ub984\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubb38\uc81c\uac00 \ub418\ub294 \ud30c\ub4dc\uc640 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc2dd\ubcc4","text":"<p>\uacbd\uc6b0\uc5d0 \ub530\ub77c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uac00 \uc190\uc0c1\ub41c \uac83\uc73c\ub85c \ud655\uc778\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2dd\ubcc4\ub41c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \ud30c\ub4dc\uac00 \uc190\uc0c1\ub420 \uac00\ub2a5\uc131\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \uba85\ub839\uc5b4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ubc0f \uc2e4\ud589 \uc911\uc778 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubaa8\ub4e0 \ud30c\ub4dc\ub97c \uc2dd\ubcc4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl get pods -o json --namespace &lt;namespace&gt; | \\\n    jq -r '.items[] |\n    select(.spec.serviceAccount == \"&lt;service account name&gt;\") |\n    \"\\(.metadata.name) \\(.spec.nodeName)\"'\n</code></pre>"},{"location":"ko/security/docs/incidents/#_6","title":"\ucde8\uc57d\ud558\uac70\ub098 \uc190\uc0c1\ub41c \uc774\ubbf8\uc9c0\uc640 \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc788\ub294 \ud30c\ub4dc\ub97c \uc2dd\ubcc4","text":"<p>\uacbd\uc6b0\uc5d0 \ub530\ub77c \ud074\ub7ec\uc2a4\ud130\uc758 \ud30c\ub4dc\uc5d0\uc11c \uc0ac\uc6a9 \uc911\uc778 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uac00 \uc545\uc758\uc801\uc774\uac70\ub098 \uc190\uc0c1\ub41c \uac83\uc744 \ubc1c\uacac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub294 \uc545\uc758\uc801\uc774\uac70\ub098 \uc190\uc0c1\ub41c \uac83\uc785\ub2c8\ub2e4. \uba40\uc6e8\uc5b4\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\ub294 \uac83\uc73c\ub85c \ubc1d\ud600\uc9c4 \uacbd\uc6b0, \uc54c\ub824\uc9c4 \uc798\ubabb\ub41c \uc774\ubbf8\uc9c0 \ub610\ub294 \uc545\uc6a9\ub41c CVE\uac00 \uc788\ub294 \uacbd\uc6b0\uc785\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud558\ub294 \ubaa8\ub4e0 \ud30c\ub4dc\uac00 \uc190\uc0c1\ub41c \uac83\uc73c\ub85c \uac04\uc8fc\ud574\uc57c \ud569\ub2c8\ub2e4. \ub2e4\uc74c \uba85\ub839\uc5b4\ub85c \ud30c\ub4dc\uac00 \uc2e4\ud589 \uc911\uc778 \uc774\ubbf8\uc9c0\uc640 \ub178\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\ub97c \uc2dd\ubcc4\ud560 \uc218 \uc788\ub2e4.</p> <pre><code>IMAGE=&lt;Name of the malicious/compromised image&gt;\n\nkubectl get pods -o json --all-namespaces | \\\n    jq -r --arg image \"$IMAGE\" '.items[] | \n    select(.spec.containers[] | .image == $image) | \n    \"\\(.metadata.name) \\(.metadata.namespace) \\(.spec.nodeName)\"'\n</code></pre>"},{"location":"ko/security/docs/incidents/#_7","title":"\ud30c\ub4dc\uc5d0 \ub300\ud55c \ubaa8\ub4e0 \uc218\uc2e0 \ubc0f \uc1a1\uc2e0 \ud2b8\ub798\ud53d\uc744 \uac70\ubd80\ud558\ub294 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc0dd\uc131\ud558\uc5ec \ud30c\ub4dc\ub97c \uaca9\ub9ac","text":"<p>\ubaa8\ub4e0 \ud2b8\ub798\ud53d \uac70\ubd80 \uaddc\uce59\uc740 \ud30c\ub4dc\uc5d0 \ub300\ud55c \ubaa8\ub4e0 \uc5f0\uacb0\uc744 \ub04a\uc5b4 \uc774\ubbf8 \uc9c4\ud589 \uc911\uc778 \uacf5\uaca9\uc744 \uc911\uc9c0\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ub2e4\uc74c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ub808\uc774\ube14\uc774 <code>app=web</code>\uc778 \ud30c\ub4dc\uc5d0 \uc801\uc6a9\ub429\ub2c8\ub2e4.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\nspec:\n  podSelector:\n    matchLabels: \n      app: web\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre> <p>Attention</p> <p>\uacf5\uaca9\uc790\uac00 \uae30\ubcf8 \ud638\uc2a4\ud2b8\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \ud68d\ub4dd\ud55c \uacbd\uc6b0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc774 \ud6a8\uacfc\uac00 \uc5c6\ub294 \uac83\uc73c\ub85c \ud310\uba85\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7f0 \uc77c\uc774 \ubc1c\uc0dd\ud588\ub2e4\uace0 \uc758\uc2ec\ub418\ub294 \uacbd\uc6b0 AWS \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc190\uc0c1\ub41c \ud638\uc2a4\ud2b8\ub97c \ub2e4\ub978 \ud638\uc2a4\ud2b8\ub85c\ubd80\ud130 \uaca9\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ud638\uc2a4\ud2b8\uc758 \ubcf4\uc548 \uadf8\ub8f9\uc744 \ubcc0\uacbd\ud560 \ub54c\ub294 \ud574\ub2f9 \ud638\uc2a4\ud2b8\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce58\ubbc0\ub85c \uc8fc\uc758\ud558\uc2ed\uc2dc\uc624.  </p>"},{"location":"ko/security/docs/incidents/#_8","title":"\ud544\uc694\ud55c \uacbd\uc6b0 \ud30c\ub4dc \ub610\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ud560\ub2f9\ub41c \uc784\uc2dc \ubcf4\uc548 \uc790\uaca9 \uc99d\uba85\uc744 \ucde8\uc18c","text":"<p>\uc6cc\ucee4 \ub178\ub4dc\uc5d0 \ud30c\ub4dc\uac00 \ub2e4\ub978 AWS \ub9ac\uc18c\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud558\ub294 IAM \uc5ed\ud560\uc744 \ud560\ub2f9\ubc1b\uc740 \uacbd\uc6b0, \uacf5\uaca9\uc73c\ub85c \uc778\ud55c \ucd94\uac00 \ud53c\ud574\ub97c \ubc29\uc9c0\ud558\uae30 \uc704\ud574 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \ud574\ub2f9 \uc5ed\ud560\uc744 \uc81c\uac70\ud574\uc57c \ud569\ub2c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c, \ud30c\ub4dc\uc5d0 IAM \uc5ed\ud560\uc774 \ud560\ub2f9\ub41c \uacbd\uc6b0, \ub2e4\ub978 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uc73c\uba74\uc11c \uc5ed\ud560\uc5d0\uc11c IAM \uc815\ucc45\uc744 \uc548\uc804\ud558\uac8c \uc81c\uac70\ud560 \uc218 \uc788\ub294\uc9c0 \ud3c9\uac00\ud574 \ubcf4\uc138\uc694.</p>"},{"location":"ko/security/docs/incidents/#cordon","title":"\uc6cc\ucee4 \ub178\ub4dc \ucc28\ub2e8(cordon)","text":"<p>\uc601\ud5a5\uc744 \ubc1b\ub294 \uc6cc\ucee4 \ub178\ub4dc\ub97c \ucc28\ub2e8\ud568\uc73c\ub85c\uc368 \uc601\ud5a5\uc744 \ubc1b\ub294 \ub178\ub4dc\uc5d0 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud558\uc9c0 \uc54a\ub3c4\ub85d \uc2a4\ucf00\uc904\ub7ec\uc5d0 \uc54c\ub9ac\ub294 \uac83\uc785\ub2c8\ub2e4.\uc774\ub807\uac8c \ud558\uba74 \ub2e4\ub978 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uc73c\uba74\uc11c \ud3ec\ub80c\uc2dd \uc5f0\uad6c\ub97c \uc704\ud574 \ub178\ub4dc\ub97c \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Info</p> <p>\uc774 \uc9c0\uce68\uc740 \uac01 Fargate \ud30c\ub4dc\uac00 \uc790\uccb4 \uc0cc\ub4dc\ubc15\uc2a4 \ud658\uacbd\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 Fargate\uc5d0\ub294 \uc801\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ucc28\ub2e8\ud558\ub294 \ub300\uc2e0 \ubaa8\ub4e0 \uc218\uc2e0 \ubc0f \uc1a1\uc2e0 \ud2b8\ub798\ud53d\uc744 \uac70\ubd80\ud558\ub294 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc801\uc6a9\ud558\uc5ec \uc601\ud5a5\uc744 \ubc1b\ub294 Fargate \ud30c\ub4dc\ub97c \uaca9\ub9ac\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/incidents/#_9","title":"\uc601\ud5a5\uc744 \ubc1b\ub294 \uc6cc\ucee4 \ub178\ub4dc\uc5d0\uc11c \uc885\ub8cc \ubcf4\ud638 \ud65c\uc131\ud654","text":"<p>\uacf5\uaca9\uc790\ub294 \uc601\ud5a5\uc744 \ubc1b\uc740 \ub178\ub4dc\ub97c \uc885\ub8cc\ud558\uc5ec \uc790\uc2e0\uc758 \ud754\uc801\uc744 \uc9c0\uc6b0\ub824\uace0 \uc2dc\ub3c4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc885\ub8cc \ubc29\uc9c0 \uae30\ub2a5\uc744 \ud65c\uc131\ud654\ud558\uba74 \uc774\ub7f0 \uc77c\uc774 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4 \uc2a4\ucf00\uc77c-\uc778 \ubcf4\ud638\ub294 \uc2a4\ucf00\uc77c-\uc778 \uc774\ubca4\ud2b8\ub85c\ubd80\ud130 \ub178\ub4dc\ub97c \ubcf4\ud638\ud569\ub2c8\ub2e4.</p> <p>Warning</p> <p>\uc2a4\ud31f \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c\ub294 \uc885\ub8cc \ubc29\uc9c0 \uae30\ub2a5\uc744 \ud65c\uc131\ud654\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_10","title":"\ubb38\uc81c\uac00 \ub418\ub294 \ud30c\ub4dc/\ub178\ub4dc\uc5d0 \ud604\uc7ac \uc870\uc0ac \uc911\uc784\uc744 \ub098\ud0c0\ub0b4\ub294 \ub808\uc774\ube14\uc744 \uc9c0\uc815","text":"<p>\uc774\ub294 \uc870\uc0ac\uac00 \uc644\ub8cc\ub420 \ub54c\uae4c\uc9c0 \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\uc5d0\uac8c \uc601\ud5a5\uc744 \ubc1b\ub294 \ud30c\ub4dc/\ub178\ub4dc\ub97c \ubcc0\uacbd\ud558\uc9c0 \ub9d0\ub77c\ub294 \uacbd\uace0 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_11","title":"\uc6cc\ucee4 \ub178\ub4dc\uc5d0\uc11c \ud718\ubc1c\uc131 \uc544\ud2f0\ud329\ud2b8 \ucea1\ucc98","text":"<ul> <li>\uc6b4\uc601 \uccb4\uc81c \uba54\ubaa8\ub9ac \ucea1\ucc98. \uc774\ub294 \ub3c4\ucee4 \ub370\ubaac(\ub610\ub294 \ub2e4\ub978 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784)\uacfc \ucee8\ud14c\uc774\ub108\ubcc4 \ud558\uc704 \ud504\ub85c\uc138\uc2a4\uc758 \uba54\ubaa8\ub9ac\ub97c \ucea1\ucc98\ud569\ub2c8\ub2e4. \uc774\ub294 LiME \ubc0f Volatility\uc640 \uac19\uc740 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uac70\ub098, \uc774\ub97c \uae30\ubc18\uc73c\ub85c \uad6c\ucd95\ub418\ub294 Amazon EC2\uc6a9 \uc790\ub3d9 \ud3ec\ub80c\uc2dd \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\ud130\uc640 \uac19\uc740 \uc0c1\uc704 \uc218\uc900 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\uc2e4\ud589 \uc911\uc778 \ud504\ub85c\uc138\uc2a4\uc640 \uc5f4\ub9b0 \ud3ec\ud2b8\uc758 netstat \ud2b8\ub9ac \ub364\ud504\ub97c \uc218\ud589. \uc774\ub294 \ucee8\ud14c\uc774\ub108\ubcc4\ub85c \ub3c4\ucee4 \ub370\ubaac\uacfc \ud574\ub2f9 \ud558\uc704 \ud504\ub85c\uc138\uc2a4\uac00 \ucea1\ucc98\ub429\ub2c8\ub2e4.</li> <li>\uc0c1\ud0dc\uac00 \ubcc0\uacbd\ub418\uae30 \uc804\uc5d0 \ucee8\ud14c\uc774\ub108 \ub808\ubca8\uc758 \uc0c1\ud0dc\ub97c \uc800\uc7a5\ud558\ub294 \uba85\ub839\uc744 \uc2e4\ud589 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc758 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud604\uc7ac \uc2e4\ud589 \uc911\uc778 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c \uc815\ubcf4\ub97c \ucea1\ucc98\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 Docker\ub97c \uc0ac\uc6a9\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li><code>docker top CONTAINER</code> : \uc2e4\ud589 \uc911\uc778 \ud504\ub85c\uc138\uc2a4\ub97c \ud655\uc778</li> <li><code>docker logs CONTAINER</code> : \ub370\ubaac \ub808\ubca8 \ub85c\uadf8 \ud655\uc778</li> <li> <p><code>docker inspect CONTAINER</code> : \ucee8\ud14c\uc774\ub108\uc758 \ub2e4\uc591\ud55c \uc815\ubcf4 \ud655\uc778</p> <p>\ucee8\ud14c\uc774\ub108\uc5d0\uc11c '\ub3c4\ucee4' \ub300\uc2e0 nerdctl CLI\ub97c \uc0ac\uc6a9\ud558\uba74 \ub3d9\uc77c\ud55c \uacb0\uacfc\ub97c \uc5bb\uc744 \uc218 \uc788\ub2e4 (\uc608: <code>nerdctl inspect</code>). \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc5d0 \ub530\ub77c \uba87 \uac00\uc9c0 \ucd94\uac00 \uba85\ub839\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ub3c4\ucee4\uc5d0\ub294 \ucee8\ud14c\uc774\ub108 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc758 \ubcc0\uacbd \uc0ac\ud56d\uc744 \ud655\uc778\ud558\uae30 \uc704\ud55c <code>docker diff</code>\uc640 \ud718\ubc1c\uc131 \uba54\ubaa8\ub9ac(RAM)\ub97c \ud3ec\ud568\ud55c \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108 \uc0c1\ud0dc\ub97c \uc800\uc7a5\ud558\ub294 <code>docker checkpoint</code>\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\ub4dc \ub610\ub294 CRI-O \ub7f0\ud0c0\uc784\uc758 \uc720\uc0ac\ud55c \uae30\ub2a5\uc5d0 \ub300\ud55c \uc124\uba85\uc740 \uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ube14\ub85c\uadf8 \uac8c\uc2dc\ubb3c\uc744 \ucc38\uc870\ud569\ub2c8\ub2e4.</p> </li> <li> <p>\ud3ec\ub80c\uc2dd \ucea1\ucc98\ub97c \uc704\ud574 \ucee8\ud14c\uc774\ub108\ub97c \uc77c\uc2dc \uc911\uc9c0.</p> </li> <li>\uc778\uc2a4\ud134\uc2a4\uc758 EBS \ubcfc\ub968 \uc2a4\ub0c5\uc0f7\uc744 \uc0dd\uc131.</li> </ul>"},{"location":"ko/security/docs/incidents/#_12","title":"\uc190\uc0c1\ub41c \ud30c\ub4dc \ub610\ub294 \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4 \uc7ac\ubc30\ud3ec","text":"<p>\ud3ec\ub80c\uc2dd \ubd84\uc11d\uc744 \uc704\ud574 \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud55c \ud6c4\uc5d0\ub294 \uc190\uc0c1\ub41c \ud30c\ub4dc \ub610\ub294 \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\ub97c \uc7ac\ubc30\ud3ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uba3c\uc800 \uc190\uc0c1\ub41c \ucde8\uc57d\uc810\uc5d0 \ub300\ud55c \uc218\uc815 \uc0ac\ud56d\uc744 \ubc30\ud3ec\ud558\uace0 \uc0c8 \ub300\uccb4 \ud30c\ub4dc\ub97c \uc2dc\uc791\ud569\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \ucde8\uc57d\ud55c \ud30c\ub4dc\ub97c \uc0ad\uc81c\ud569\ub2c8\ub2e4.</p> <p>\ucde8\uc57d\ud55c \ud30c\ub4dc\ub97c \uc0c1\uc704 \uc218\uc900\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4(\uc608: \ub514\ud50c\ub85c\uc774\uba3c\ud2b8 \ub610\ub294 \ub370\ubaac\uc14b) \uc5d0\uc11c \uad00\ub9ac\ud558\ub294 \uacbd\uc6b0, \uc774\ub97c \uc0ad\uc81c\ud558\uba74 \uc0c8 \ud30c\ub4dc\uac00 \uc2a4\ucf00\uc904\ub9c1\ub41c\ub2e4. \ub530\ub77c\uc11c \ucde8\uc57d\ud55c \ud30c\ub4dc\uac00 \ub2e4\uc2dc \uc2e4\ud589\ub420 \uac83\uc785\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 \ucde8\uc57d\uc131\uc744 \uc218\uc815\ud55c \ud6c4 \uc0c8\ub85c\uc6b4 \ub300\uccb4 \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\ub97c \ubc30\ud3ec\ud574\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c \ucde8\uc57d\ud55c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc0ad\uc81c\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_13","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/incidents/#aws","title":"AWS \ubcf4\uc548 \uc0ac\uace0 \ub300\uc751 \ubc31\uc11c \uac80\ud1a0","text":"<p>\uc774 \uc139\uc158\uc5d0\uc11c\ub294 \uc758\uc2ec\ub418\ub294 \ubcf4\uc548 \uce68\ud574\ub97c \ucc98\ub9ac\ud558\uae30 \uc704\ud55c \uba87 \uac00\uc9c0 \uad8c\uc7a5 \uc0ac\ud56d\uacfc \ud568\uaed8 \uac04\ub7b5\ud55c \uac1c\uc694\ub97c \uc81c\uacf5\ud558\uc9c0\ub9cc, \uc774 \uc8fc\uc81c\ub294 AWS \ubcf4\uc548 \uc0ac\uace0 \ub300\uc751 \ubc31\uc11c\uc5d0\uc11c \uc790\uc138\ud788 \ub2e4\ub8f9\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_14","title":"\ubcf4\uc548 \uac8c\uc784 \ub370\uc774\ub97c \ud1b5\ud55c \ub300\uc751 \uc900\ube44","text":"<p>\ubcf4\uc548 \uc2e4\ubb34\uc790\ub97c \ub808\ub4dc\ud300\uacfc \ube14\ub8e8\ud300, \ub450 \ud300\uc73c\ub85c \ub098\ub215\ub2c8\ub2e4. \ub808\ub4dc \ud300\uc740 \uc5ec\ub7ec \uc2dc\uc2a4\ud15c\uc758 \ucde8\uc57d\uc810\uc744 \uc870\uc0ac\ud558\ub294 \ub370 \uc9d1\uc911\ud558\uace0 \ud30c\ub780\uc0c9 \ud300\uc740 \ucde8\uc57d\uc810\uc744 \ubc29\uc5b4\ud558\ub294 \ub370 \uc9d1\uc911\ud569\ub2c8\ub2e4. \ubcc4\ub3c4\uc758 \ud300\uc744 \ub9cc\ub4e4 \uc218 \uc788\ub294 \ubcf4\uc548 \uc2e4\ubb34\uc790\uac00 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc545\uc6a9\uc5d0 \ub300\ud55c \uc9c0\uc2dd\uc774 \uc788\ub294 \uc678\ubd80 \ubc95\uc778\uc744 \uace0\uc6a9\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624.</p> <p>Kubesploit\ub294 CyberArk\uc758 \uce68\ud22c \ud14c\uc2a4\ud2b8 \ud504\ub808\uc784\uc6cc\ud06c\ub85c, \uac8c\uc784 \ub370\uc774\ub97c \uc9c4\ud589\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ucde8\uc57d\uc810\uc744 \uac80\uc0ac\ud558\ub294 \ub2e4\ub978 \ub3c4\uad6c\uc640 \ub2ec\ub9ac kubesploit\ub294 \uc2e4\uc81c \uacf5\uaca9\uc744 \uc2dc\ubbac\ub808\uc774\uc158\ud569\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \ube14\ub8e8 \ud300\uc740 \uacf5\uaca9\uc5d0 \ub300\ud55c \ub300\uc751\uc744 \uc5f0\uc2b5\ud558\uace0 \uadf8 \ud6a8\uacfc\ub97c \uce21\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/incidents/#_15","title":"\ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uce68\ud22c \ud14c\uc2a4\ud2b8 \uc2e4\ud589","text":"<p>\uc790\uc2e0\uc758 \ud074\ub7ec\uc2a4\ud130\ub97c \uc8fc\uae30\uc801\uc73c\ub85c \uacf5\uaca9\ud558\uba74 \ucde8\uc57d\uc131\uacfc \uad6c\uc131 \uc624\ub958\ub97c \ubc1c\uacac\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc2dc\uc791\ud558\uae30 \uc804\uc5d0 \ud074\ub7ec\uc2a4\ud130\ub97c \ub300\uc0c1\uc73c\ub85c \ud14c\uc2a4\ud2b8\ub97c \uc218\ud589\ud558\uae30 \uc804\uc5d0 \uce68\ud22c \ud14c\uc2a4\ud2b8 \uc9c0\uce68\uc744 \ub530\ub974\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/incidents/#_16","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<ul> <li>kube-hunter, \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc704\ud55c \uce68\ud22c \ud14c\uc2a4\ud2b8 \ub3c4\uad6c</li> <li>Gremlin, \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubc0f \uc778\ud504\ub77c\uc5d0 \ub300\ud55c \uacf5\uaca9\uc744 \uc2dc\ubbac\ub808\uc774\uc158\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uce74\uc624\uc2a4 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1 \ud234\ud0b7</li> <li>Attacking and Defending Kubernetes Installations</li> <li>kubesploit</li> <li>\uc9c0\ub2a5\uc801\uc774\uace0 \uc9c0\uc18d\uc801\uc778 \uc704\ud611</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2e4\ubb34 \uacf5\uaca9 \ubc0f \ubc29\uc5b4</li> <li>RBAC \uad8c\ud55c\uc744 \uc545\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \uc190\uc0c1</li> </ul>"},{"location":"ko/security/docs/multitenancy/","title":"\ud14c\ub10c\ud2b8 \uaca9\ub9ac","text":"<p>\uba40\ud2f0\ud14c\ub10c\uc2dc\ub97c \uc0dd\uac01\ud560 \ub54c \uacf5\uc720 \uc778\ud504\ub77c\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ub2e4\ub978 \uc0ac\uc6a9\uc790\ub098 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc73c\ub85c\ubd80\ud130 \uc0ac\uc6a9\uc790\ub098 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ubd84\ub9ac\ud558\ub824\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ub2e8\uc77c \ud14c\ub10c\ud2b8 \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\ud130 \uc785\ub2c8\ub2e4. \uc989, \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \ub2e8\uc77c \uc778\uc2a4\ud134\uc2a4\uac00 \ud074\ub7ec\uc2a4\ud130 \ub0b4 \ubaa8\ub4e0 \ud14c\ub10c\ud2b8 \uac04\uc5d0 \uacf5\uc720\ub429\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uba40\ud2f0\ud14c\ub10c\uc2dc\uc640 \uc720\uc0ac\ud55c \ud615\ud0dc\ub97c \ub9cc\ub4dc\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ub2e4\uc591\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac1d\uccb4\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc640 \uc5ed\ud560 \uae30\ubc18 \uc811\uadfc \uc81c\uc5b4(RBAC) \ub97c \uad6c\ud604\ud558\uc5ec \ud14c\ub10c\ud2b8\ub97c \ub17c\ub9ac\uc801\uc73c\ub85c \uc11c\ub85c \uaca9\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c \ud560\ub2f9\ub7c9 \ubc0f \uc81c\ud55c \ubc94\uc704\ub97c \uc0ac\uc6a9\ud558\uc5ec \uac01 \ud14c\ub10c\ud2b8\uac00 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4\uc758 \uc591\uc744 \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ud074\ub7ec\uc2a4\ud130\ub294 \uac15\ub825\ud55c \ubcf4\uc548 \uacbd\uacc4\ub97c \uc81c\uacf5\ud558\ub294 \uc720\uc77c\ud55c \uad6c\uc870\uc785\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \ub0b4 \ud638\uc2a4\ud2b8\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \ud68d\ub4dd\ud55c \uacf5\uaca9\uc790\ub294 \ud574\ub2f9 \ud638\uc2a4\ud2b8\uc5d0 \ub9c8\uc6b4\ud2b8\ub41c \ubaa8\ub4e0 \uc2dc\ud06c\ub9bf, \ucee8\ud53c\uadf8\ub9f5, \ubcfc\ub968\uc744 \uac00\uc838\uc62c \uc218 \uc788\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \ub610\ud55c Kubelet\uc744 \uac00\uc7a5\ud558\uc5ec \ub178\ub4dc\uc758 \uc18d\uc131\uc744 \uc870\uc791\ud558\uac70\ub098 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc606\uc73c\ub85c \uc774\ub3d9\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uc139\uc158\uc5d0\uc11c\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \uac19\uc740 \ub2e8\uc77c \ud14c\ub10c\ud2b8 \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\ud130\ub97c \uc0ac\uc6a9\ud560 \ub54c \ubc1c\uc0dd\ud558\ub294 \uc704\ud5d8\uc744 \uc904\uc774\uba74\uc11c \ud14c\ub10c\ud2b8 \uaca9\ub9ac\ub97c \uad6c\ud604\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_2","title":"\uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc","text":"<p>\uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc\ub97c \uc0ac\uc6a9\ud558\uba74 \ub124\uc784\uc2a4\ud398\uc774\uc2a4, \uc5ed\ud560 \ubc0f \ub864\ubc14\uc778\ub529, \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc \uac19\uc740 \ub124\uc774\ud2f0\ube0c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uad6c\uc870\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud14c\ub10c\ud2b8\ub97c \ub17c\ub9ac\uc801\uc73c\ub85c \ubd84\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uc608\ub97c \ub4e4\uc5b4 RBAC\ub294 \ud14c\ub10c\ud2b8\uac00 \uc11c\ub85c\uc758 \ub9ac\uc18c\uc2a4\uc5d0 \uc561\uc138\uc2a4\ud558\uac70\ub098 \uc870\uc791\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucffc\ud130 \ubc0f \ub9ac\ubc0b \ubc94\uc704\ub294 \uac01 \ud14c\ub10c\ud2b8\uac00 \uc18c\ube44\ud560 \uc218 \uc788\ub294 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4\uc758 \uc591\uc744 \uc81c\uc5b4\ud558\ub294 \ubc18\uba74, \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \uc11c\ub85c \ub2e4\ub978 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ubc30\ud3ec\ub41c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc11c\ub85c \ud1b5\uc2e0\ud558\uc9c0 \ubabb\ud558\ub3c4\ub85d \ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uadf8\ub7ec\ub098 \uc774\ub7f0 \ucee8\ud2b8\ub864 \uc911 \uc5b4\ub290 \uac83\ub3c4 \ub2e4\ub978 \ud14c\ub10c\ud2b8\uc758 \ud30c\ub4dc\uac00 \ub178\ub4dc\ub97c \uacf5\uc720\ud558\ub294 \uac83\uc744 \ub9c9\uc9c0\ub294 \ubabb\ud569\ub2c8\ub2e4. \ub354 \uac15\ub825\ud55c \uaca9\ub9ac\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \ub178\ub4dc \uc140\ub809\ud130, \uc548\ud2f0-\uc5b4\ud53c\ub2c8\ud2f0 \uaddc\uce59 \ubc0f/\ub610\ub294 \ud14c\uc778\ud2b8 \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc11c\ub85c \ub2e4\ub978 \ud14c\ub10c\ud2b8\uc758 \ud30c\ub4dc\ub97c \ubcc4\ub3c4\uc758 \ub178\ub4dc\ub85c \uac15\uc81c\ub85c \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \uc885\uc885 \ub2e8\ub3c5 \ud14c\ub10c\ud2b8 \ub178\ub4dc \ub77c\uace0 \ud569\ub2c8\ub2e4. \ud14c\ub10c\ud2b8\uac00 \ub9ce\uc740 \ud658\uacbd\uc5d0\uc11c\ub294 \uc774 \uc791\uc5c5\uc774 \ub2e4\uc18c \ubcf5\uc7a1\ud558\uace0 \ube44\uc6a9\uc774 \ub9ce\uc774 \ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub294 \uc804\uc5ed\uc801\uc73c\ub85c \ubc94\uc704\uac00 \uc9c0\uc815\ub41c \uc720\ud615\uc774\ubbc0\ub85c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub85c \uad6c\ud604\ub41c \uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc\ub294 \ud544\ud130\ub9c1\ub41c \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ubaa9\ub85d\uc744 \ud14c\ub10c\ud2b8\uc5d0 \uc81c\uacf5\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ud14c\ub10c\ud2b8\uac00 \ud2b9\uc815 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \ubcfc \uc218 \uc788\ub294 \uacbd\uc6b0 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc758 \ubaa8\ub4e0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Warning</p> <p>\uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc\ub97c \uc0ac\uc6a9\ud558\uba74 \ud14c\ub10c\ud2b8\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ubaa8\ub4e0 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud574 CoreDNS\ub97c \ucffc\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uacf5\uaca9\uc790\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\uc5d0\uc11c <code>dig SRV *.*.svc.cluster.local</code>\uc744 \uc2e4\ud589\ud558\uc5ec \uc774\ub97c \uc545\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc11c\ube44\uc2a4\uc758 DNS \ub808\ucf54\ub4dc\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 CoreDNS\uc6a9 \ubc29\ud654\ubcbd \ub610\ub294 \uc815\ucc45 \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 https://github.com/coredns/policy#kubernetes-metadata-multi-tenancy-policy\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>Kiosk\ub294 \uc18c\ud504\ud2b8 \uba40\ud2f0 \ud14c\ub10c\uc2dc\uc758 \uad6c\ud604\uc744 \uc9c0\uc6d0\ud558\ub294 \uc624\ud508 \uc18c\uc2a4 \ud504\ub85c\uc81d\ud2b8\uc785\ub2c8\ub2e4. \ub2e4\uc74c \uae30\ub2a5\uc744 \uc81c\uacf5\ud558\ub294 \uc77c\ub828\uc758 CRD \ubc0f \ucee8\ud2b8\ub864\ub7ec\ub85c \uad6c\ud604\ub429\ub2c8\ub2e4.</p> <ul> <li>\uacf5\uc720 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud14c\ub10c\ud2b8\ub97c \ubd84\ub9ac\ud558\uae30 \uc704\ud55c \uacc4\uc815 \ubc0f \uacc4\uc815 \uc0ac\uc6a9\uc790</li> <li>\uacc4\uc815 \uc0ac\uc6a9\uc790\ub97c \uc704\ud55c \uc140\ud504 \uc11c\ube44\uc2a4 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ud504\ub85c\ube44\uc800\ub2dd</li> <li>\ud074\ub7ec\uc2a4\ud130 \uacf5\uc720 \uc2dc \uc11c\ube44\uc2a4 \ud488\uc9c8 \ubc0f \uacf5\uc815\uc131\uc744 \ubcf4\uc7a5\ud558\uae30 \uc704\ud55c \uacc4\uc815 \uc81c\ud55c</li> <li>\uc548\uc804\ud55c \ud14c\ub10c\ud2b8 \uaca9\ub9ac \ubc0f \uc140\ud504 \uc11c\ube44\uc2a4 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ucd08\uae30\ud654\ub97c \uc704\ud55c \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ud15c\ud50c\ub9bf</li> </ul> <p>Loft\ub294 \ub2e4\uc74c \uae30\ub2a5\uc744 \ucd94\uac00\ud558\ub294 Kiosk \ubc0f DevSpace\uc758 \uad00\ub9ac\uc790\uac00 \uc81c\uacf5\ud558\ub294 \uc0c1\uc6a9 \uc81c\ud488\uc785\ub2c8\ub2e4.</p> <ul> <li>\ub2e4\ub978 \ud074\ub7ec\uc2a4\ud130\uc758 \uacf5\uac04\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud558\uae30 \uc704\ud55c \uba40\ud2f0 \ud074\ub7ec\uc2a4\ud130 \uc561\uc138\uc2a4</li> <li>\uc808\uc804 \ubaa8\ub4dc \ub294 \ube44\ud65c\uc131 \uae30\uac04 \ub3d9\uc548 \uacf5\uac04\uc5d0\uc11c \ubc30\ud3ec\ub97c \ucd95\uc18c\ud569\ub2c8\ub2e4.</li> <li>GitHub\uc640 \uac19\uc740 OIDC \uc778\uc99d \uacf5\uae09\uc790\ub97c \uc0ac\uc6a9\ud55c \uc2f1\uae00 \uc0ac\uc778\uc628</li> </ul> <p>\uc18c\ud504\ud2b8 \uba40\ud2f0 \ud14c\ub10c\uc2dc\ub85c \ud574\uacb0\ud560 \uc218 \uc788\ub294 \uc138 \uac00\uc9c0 \uc8fc\uc694 \uc0ac\uc6a9 \uc0ac\ub840\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_3","title":"\uc5d4\ud130\ud504\ub77c\uc774\uc988 \uc124\uc815","text":"<p>\uccab \ubc88\uc9f8\ub294 \"\ud14c\ub10c\ud2b8\"\uac00 \uc9c1\uc6d0, \uacc4\uc57d\uc790 \ub610\ub294 \uc870\uc9c1\uc758 \uc2b9\uc778\uc744 \ubc1b\uc558\ub2e4\ub294 \uc810\uc5d0\uc11c \uc5b4\ub290\uc815\ub3c4 \uc2e0\ub8b0\uc744 \ubc1b\ub294 \uae30\uc5c5 \ud658\uacbd\uc785\ub2c8\ub2e4. \uac01 \ud14c\ub10c\ud2b8\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \ubd80\uc11c \ub610\ub294 \ud300\uacfc \uac19\uc740 \ud589\uc815 \ubd80\uc11c\uc5d0 \uc18c\uc18d\ub429\ub2c8\ub2e4.</p> <p>\uc774\ub7f0 \uc720\ud615\uc758 \uc124\uc815\uc5d0\uc11c\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\uac00 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc0dd\uc131 \ubc0f \uc815\ucc45 \uad00\ub9ac\ub97c \ub2f4\ub2f9\ud569\ub2c8\ub2e4. \ub610\ud55c \ud2b9\uc815 \uac1c\uc778\uc5d0\uac8c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uac10\ub3c5\ud558\ub294 \uc704\uc784 \uad00\ub9ac \ubaa8\ub378\uc744 \uad6c\ud604\ud558\uc5ec \ubc30\ud3ec, \uc11c\ube44\uc2a4, \ud30c\ub4dc, \uc791\uc5c5 \ub4f1\uacfc \uac19\uc774 \uc815\ucc45\uacfc \uad00\ub828\uc774 \uc5c6\ub294 \uac1c\uccb4\uc5d0 \ub300\ud574 CRUD \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\ub3c4\ub85d \ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \uaca9\ub9ac\ub294 \uc774 \uc124\uc815 \ub0b4\uc5d0\uc11c \ud5c8\uc6a9\ub420 \uc218\ub3c4 \uc788\uace0 \ud30c\ub4dc \ubcf4\uc548\uc744 \uc704\ud55c \ucd94\uac00 \uc81c\uc5b4 \uae30\ub2a5\uc73c\ub85c \ubcf4\uac15\ud574\uc57c \ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.\ub354 \uc5c4\uaca9\ud55c \uaca9\ub9ac\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \uc11c\ub85c \ub2e4\ub978 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \uc788\ub294 \uc11c\ube44\uc2a4 \uac04\uc758 \ud1b5\uc2e0\uc744 \uc81c\ud55c\ud574\uc57c \ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_4","title":"\uc11c\ube44\uc2a4\ub85c\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4","text":"<p>\ub300\uc870\uc801\uc73c\ub85c \uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc\ub294 Kuberenetes as a Service(KaaS) \uc0c1\ud669\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc124\uc815\uc785\ub2c8\ub2e4. KaaS\ub97c \uc0ac\uc6a9\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc77c\ub828\uc758 PaaS \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud558\ub294 \ucee8\ud2b8\ub864\ub7ec \ubc0f CRD \uceec\ub809\uc158\uacfc \ud568\uaed8 \uacf5\uc720 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud638\uc2a4\ud305\ub429\ub2c8\ub2e4. \ud14c\ub10c\ud2b8\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\uc640 \uc9c1\uc811 \uc0c1\ud638 \uc791\uc6a9\ud558\uba70 \ube44\uc815\ucc45 \uac1d\uccb4\uc5d0 \ub300\ud574 CRUD \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud14c\ub10c\ud2b8\uac00 \uc790\uccb4 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud558\uace0 \uad00\ub9ac\ud560 \uc218 \uc788\ub2e4\ub294 \uc810\uc5d0\uc11c \uc140\ud504 \uc11c\ube44\uc2a4\uc758 \uc694\uc18c\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc720\ud615\uc758 \ud658\uacbd\uc5d0\uc11c\ub294 \ud14c\ub10c\ud2b8\ub294 \uc2e0\ub8b0\ud560 \uc218 \uc5c6\ub294 \ucf54\ub4dc\ub3c4 \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uac83\uc73c\ub85c \uac04\uc8fc\ub429\ub2c8\ub2e4.</p> <p>\uc774\ub7f0 \uc720\ud615\uc758 \ud658\uacbd\uc5d0\uc11c \ud14c\ub10c\ud2b8\ub97c \uaca9\ub9ac\ud558\ub824\uba74 \uc5c4\uaca9\ud55c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc \ud30c\ub4dc \uc0cc\ub4dc\ubc15\uc2f1 \uc744 \uad6c\ud604\ud574\uc57c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc0cc\ub4dc\ubc15\uc2f1\uc740 Firecracker\uc640 \uac19\uc740 \ub9c8\uc774\ud06c\ub85c VM \ub0b4\uc5d0\uc11c \ub610\ub294 \uc0ac\uc6a9\uc790 \uacf5\uac04 \ucee4\ub110\uc5d0\uc11c \ud30c\ub4dc \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc774\uc81c EKS Fargate\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc0cc\ub4dc\ubc15\uc2a4\uac00 \uc801\uc6a9\ub41c \ud30c\ub4dc\ub97c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#saas","title":"\uc11c\ube44\uc2a4\ud615 \uc18c\ud504\ud2b8\uc6e8\uc5b4(SaaS)","text":"<p>\uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc\uc758 \ucd5c\uc885 \uc0ac\uc6a9 \uc0ac\ub840\ub294 \uc11c\ube44\uc2a4\ud615 \uc18c\ud504\ud2b8\uc6e8\uc5b4 (SaaS) \uc124\uc815\uc785\ub2c8\ub2e4.\uc774 \ud658\uacbd\uc5d0\uc11c \uac01 \ud14c\ub10c\ud2b8\ub294 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ud2b9\uc815 \uc778\uc2a4\ud134\uc2a4 \uc640 \uc5f0\uacb0\ub429\ub2c8\ub2e4.\uac01 \uc778\uc2a4\ud134\uc2a4\ub294 \uc885\uc885 \uc790\uccb4 \ub370\uc774\ud130\ub97c \uac16\uace0 \uc788\uc73c\uba70 \uc77c\ubc18\uc801\uc73c\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 RBAC\uc640 \ub3c5\ub9bd\uc801\uc778 \ubcc4\ub3c4\uc758 \uc561\uc138\uc2a4 \uc81c\uc5b4\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p> <p>\ub2e4\ub978 \uc0ac\uc6a9 \uc0ac\ub840\uc640 \ub2ec\ub9ac SaaS \uc124\uc815\uc758 \ud14c\ub10c\ud2b8\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc640 \uc9c1\uc811 \uc778\ud130\ud398\uc774\uc2a4\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub300\uc2e0 SaaS \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc640 \uc778\ud130\ud398\uc774\uc2a4\ud558\uc5ec \uac01 \ud14c\ub10c\ud2b8\ub97c \uc9c0\uc6d0\ud558\ub294 \ub370 \ud544\uc694\ud55c \uac1d\uccb4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_5","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uad6c\uc131","text":"<p>\uac01 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \ub2e4\uc74c \uad6c\uc870\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud14c\ub10c\ud2b8\ub97c \uc11c\ub85c \uaca9\ub9ac\ud569\ub2c8\ub2e4:</p>"},{"location":"ko/security/docs/multitenancy/#_6","title":"\ub124\uc784\uc2a4\ud398\uc774\uc2a4","text":"<p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub294 \uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc\ub97c \uad6c\ud604\ud558\ub294 \ub370 \ud544\uc218\uc801\uc785\ub2c8\ub2e4.\ud074\ub7ec\uc2a4\ud130\ub97c \ub17c\ub9ac\uc801 \ud30c\ud2f0\uc158\uc73c\ub85c \ub098\ub20c \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uba40\ud2f0\ud14c\ub10c\uc2dc\ub97c \uad6c\ud604\ud558\ub294 \ub370 \ud544\uc694\ud55c \ud560\ub2f9\ub7c9, \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45, \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ubc0f \uae30\ud0c0 \uac1c\uccb4\uc758 \ubc94\uc704\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub85c \uc9c0\uc815\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_7","title":"\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45","text":"<p>\uae30\ubcf8\uc801\uc73c\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\ub294 \uc11c\ub85c \ud1b5\uc2e0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ub3d9\uc791\uc740 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ub808\uc774\ube14 \ub610\ub294 IP \uc8fc\uc18c \ubc94\uc704\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc \uac04 \ud1b5\uc2e0\uc744 \uc81c\ud55c\ud569\ub2c8\ub2e4. \ud14c\ub10c\ud2b8 \uac04 \uc5c4\uaca9\ud55c \ub124\ud2b8\uc6cc\ud06c \uaca9\ub9ac\uac00 \ud544\uc694\ud55c \uba40\ud2f0 \ud14c\ub10c\ud2b8 \ud658\uacbd\uc5d0\uc11c\ub294 \ud30c\ub4dc \uac04 \ud1b5\uc2e0\uc744 \uac70\ubd80\ud558\ub294 \uae30\ubcf8 \uaddc\uce59\uacfc \ubaa8\ub4e0 \ud30c\ub4dc\uac00 DNS \uc11c\ubc84\uc5d0 \uc774\ub984 \ud655\uc778\uc744 \ucffc\ub9ac\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud558\ub294 \ub2e4\ub978 \uaddc\uce59\uc73c\ub85c \uc2dc\uc791\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4\uc5d0\uc11c \ud1b5\uc2e0\uc744 \ud5c8\uc6a9\ud558\ub294 \ub354 \ub9ce\uc740 \ud5c8\uc6a9 \uaddc\uce59\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud544\uc694\uc5d0 \ub530\ub77c \uc774\ub97c \ub354 \uc138\ubd84\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ud544\uc694\ud558\uc9c0\ub9cc \ucda9\ubd84\ud558\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc801\uc6a9\ud558\ub824\uba74 Calico \ub610\ub294 Cilium\uacfc \uac19\uc740 \uc815\ucc45 \uc5d4\uc9c4\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#rbac","title":"\uc5ed\ud560 \uae30\ubc18 \uc811\uadfc \uc81c\uc5b4(RBAC)","text":"<p>\uc5ed\ud560 \ubc0f \ub864\ubc14\uc778\ub529\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc5ed\ud560 \uae30\ubc18 \uc811\uadfc \uc81c\uc5b4 (RBAC) \ub97c \uc801\uc6a9\ud558\ub294 \ub370 \uc0ac\uc6a9\ub418\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc624\ube0c\uc81d\ud2b8\uc785\ub2c8\ub2e4. \uc5ed\ud560\uc5d0\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \uc624\ube0c\uc81d\ud2b8\uc5d0 \ub300\ud574 \uc218\ud589\ud560 \uc218 \uc788\ub294 \uc791\uc5c5 \ubaa9\ub85d\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ub864\ubc14\uc778\ub529\uc740 \uc5ed\ud560\uc774 \uc801\uc6a9\ub418\ub294 \uac1c\uc778 \ub610\ub294 \uadf8\ub8f9\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4. \uc5d4\ud130\ud504\ub77c\uc774\uc988 \ubc0f KaaS \uc124\uc815\uc5d0\uc11c RBAC\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc120\ud0dd\ud55c \uadf8\ub8f9 \ub610\ub294 \uac1c\uc778\uc774 \uac1c\uccb4\ub97c \uad00\ub9ac\ud560 \uc218 \uc788\ub3c4\ub85d \ud5c8\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_8","title":"\ucffc\ud130","text":"<p>\ucffc\ud130\uc740 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud638\uc2a4\ud305\ub418\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub300\ud55c \uc81c\ud55c\uc744 \uc815\uc758\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \ucffc\ud130\uc744 \uc0ac\uc6a9\ud558\uba74 \ud30c\ub4dc\uac00 \uc18c\ube44\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 CPU \ubc0f \uba54\ubaa8\ub9ac \uc591\uc744 \uc9c0\uc815\ud558\uac70\ub098 \ud074\ub7ec\uc2a4\ud130 \ub610\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ud560 \uc218 \uc788\ub294 \ub9ac\uc18c\uc2a4 \uc218\ub97c \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Limit Range\ub97c \uc0ac\uc6a9\ud558\uba74 \uac01 \uc81c\ud55c\uc758 \ucd5c\uc18c\uac12, \ucd5c\ub300\uac12 \ubc0f \uae30\ubcf8\uac12\uc744 \uc120\uc5b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uacf5\uc720 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ub9ac\uc18c\uc2a4\ub97c \uc624\ubc84\ucee4\ubc0b\ud558\uba74 \ub9ac\uc18c\uc2a4\ub97c \ucd5c\ub300\ud654\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \uc885\uc885 \uc720\uc6a9\ud569\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \ubb34\uc81c\ud55c \uc561\uc138\uc2a4\ub294 \ub9ac\uc18c\uc2a4 \ubd80\uc871\uc744 \ucd08\ub798\ud558\uc5ec \uc131\ub2a5 \uc800\ud558 \ubc0f \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uac00\uc6a9\uc131 \uc190\uc2e4\ub85c \uc774\uc5b4\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc\uc758 \uc694\uccad\uc774 \ub108\ubb34 \ub0ae\uac8c \uc124\uc815\ub418\uace0 \uc2e4\uc81c \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub7c9\uc774 \ub178\ub4dc\uc758 \uc6a9\ub7c9\uc744 \ucd08\uacfc\ud558\uba74 \ub178\ub4dc\uc5d0 CPU \ub610\ub294 \uba54\ubaa8\ub9ac \uc555\ub825\uc774 \ubc1c\uc0dd\ud558\uae30 \uc2dc\uc791\ud569\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 \ud30c\ub4dc\uac00 \uc7ac\uc2dc\uc791\ub418\uac70\ub098 \ub178\ub4dc\uc5d0\uc11c \uc81c\uac70\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774\ub97c \ubc29\uc9c0\ud558\ub824\uba74 \uba40\ud2f0 \ud14c\ub10c\ud2b8 \ud658\uacbd\uc5d0\uc11c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ub7c9\uc744 \ubd80\uacfc\ud558\uc5ec \ud14c\ub10c\ud2b8\uac00 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud30c\ub4dc\ub97c \uc608\uc57d\ud560 \ub54c \uc694\uccad \ubc0f \uc81c\ud55c\uc744 \uc9c0\uc815\ud558\ub3c4\ub85d \uacc4\ud68d\ud574\uc57c \ud569\ub2c8\ub2e4. \ub610\ud55c \ud30c\ub4dc\uac00 \uc18c\ube44\ud560 \uc218 \uc788\ub294 \ub9ac\uc18c\uc2a4\uc758 \uc591\uc744 \uc81c\ud55c\ud558\uc5ec \uc7a0\uc7ac\uc801\uc778 \uc11c\ube44\uc2a4 \uac70\ubd80\ub97c \uc644\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub610\ub294 \ucffc\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud14c\ub10c\ud2b8\uc758 \uc9c0\ucd9c\uc5d0 \ub9de\uac8c \ud074\ub7ec\uc2a4\ud130\uc758 \ub9ac\uc18c\uc2a4\ub97c \ud560\ub2f9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uc774\ub294 KaaS \uc2dc\ub098\ub9ac\uc624\uc5d0\uc11c \ud2b9\ud788 \uc720\uc6a9\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_9","title":"\ud30c\ub4dc \uc6b0\uc120\uc21c\uc704 \ubc0f \uc120\uc810","text":"<p>\ud30c\ub4dc \uc6b0\uc120\uc21c\uc704 \ubc0f \uc120\uc810\uc740 \ub2e4\ub978 \ud30c\ub4dc\uc5d0 \ube44\ud574 \ud30c\ub4dc\uc5d0 \ub354 \ub9ce\uc740 \uc911\uc694\uc131\uc744 \ubd80\uc5ec\ud558\uace0\uc790 \ud560 \ub54c \uc720\uc6a9\ud560 \uc218 \uc788\ub2e4.\uc608\ub97c \ub4e4\uc5b4 \ud30c\ub4dc \uc6b0\uc120 \uc21c\uc704\ub97c \uc0ac\uc6a9\ud558\uba74 \uace0\uac1d A\uc758 \ud30c\ub4dc\uac00 \uace0\uac1d B\ubcf4\ub2e4 \ub192\uc740 \uc6b0\uc120 \uc21c\uc704\ub85c \uc2e4\ud589\ub418\ub3c4\ub85d \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc6a9\ub7c9\uc774 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \uc2a4\ucf00\uc904\ub7ec\ub294 \uace0\uac1d B\uc758 \uc6b0\uc120 \uc21c\uc704\uac00 \ub0ae\uc740 \ud30c\ub4dc\ub97c \uc81c\uc678\ud558\uace0 \uace0\uac1d A\uc758 \uc6b0\uc120 \uc21c\uc704\uac00 \ub192\uc740 \ud30c\ub4dc\ub97c \uc218\uc6a9\ud569\ub2c8\ub2e4. \uc774\ub294 \ud504\ub9ac\ubbf8\uc5c4\uc744 \uc9c0\ubd88\ud558\ub824\ub294 \uace0\uac1d\uc774 \ub354 \ub192\uc740 \uc6b0\uc120 \uc21c\uc704\ub97c \ubc1b\ub294 SaaS \ud658\uacbd\uc5d0\uc11c \ud2b9\ud788 \uc720\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>\ud30c\ub4dc\uc758 \uc6b0\uc120\uc21c\uc704\ub294 \uc6b0\uc120\uc21c\uc704\uac00 \ub0ae\uc740 \ub2e4\ub978 \ud30c\ub4dc\uc5d0 \uc6d0\uce58 \uc54a\ub294 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \ub300\uc0c1 \ud30c\ub4dc\ub294 \uc815\uc0c1\uc801\uc73c\ub85c \uc885\ub8cc\ub418\uc9c0\ub9cc PodDisruptionBudget\uc740 \ubcf4\uc7a5\ub418\uc9c0 \uc54a\uc544 \ud30c\ub4dc \ucffc\ub7fc\uc5d0 \uc758\uc874\ud558\ub294 \uc6b0\uc120\uc21c\uc704\uac00 \ub0ae\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc911\ub2e8\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc120\uc810 \uc81c\ud55c\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/multitenancy/#_10","title":"\uc644\ud654 \uc81c\uc5b4","text":"<p>\uba40\ud2f0 \ud14c\ub10c\ud2b8 \ud658\uacbd \uad00\ub9ac\uc790\uc758 \uc8fc\ub41c \uad00\uc2ec\uc0ac\ub294 \uacf5\uaca9\uc790\uac00 \uae30\ubcf8 \ud638\uc2a4\ud2b8\uc5d0 \ub300\ud55c \uc811\uadfc \uad8c\ud55c\uc744 \uc5bb\uc9c0 \ubabb\ud558\ub3c4\ub85d \ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc774\ub7f0 \uc704\ud5d8\uc744 \uc644\ud654\ud558\ub824\uba74 \ub2e4\uc74c \uc81c\uc5b4 \ubc29\ubc95\uc744 \uace0\ub824\ud574\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_11","title":"\ucee8\ud14c\uc774\ub108\ub97c \uc704\ud55c \uc0cc\ub4dc\ubc15\uc2a4 \uc2e4\ud589 \ud658\uacbd","text":"<p>\uc0cc\ub4dc\ubc15\uc2f1\uc740 \uac01 \ucee8\ud14c\uc774\ub108\ub97c \uaca9\ub9ac\ub41c \uc790\uccb4 \uac00\uc0c1 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \uc2e4\ud589\ud558\ub294 \uae30\uc220\uc785\ub2c8\ub2e4. \ud30c\ub4dc \uc0cc\ub4dc\ubc15\uc2f1\uc744 \uc218\ud589\ud558\ub294 \uae30\uc220\ub85c\ub294 Firecracker, Weave\uc758 Firekube\ub4f1\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Firecracker\ub97c EKS \uc9c0\uc6d0 \ub7f0\ud0c0\uc784\uc73c\ub85c \ub9cc\ub4e4\uae30 \uc704\ud55c \ub178\ub825\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 \uc774 \uae00\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/multitenancy/#opa","title":"\uac1c\ubc29\ud615 \uc815\ucc45 \uc5d0\uc774\uc804\ud2b8(OPA) \ubc0f \uac8c\uc774\ud2b8\ud0a4\ud37c","text":"<p>Gatekeeper\ub294 OPA\ub85c \uc0dd\uc131\ub41c \uc815\ucc45\uc744 \uc2dc\ud589\ud558\ub294 Kubernetes \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\uc785\ub2c8\ub2e4. OPA\ub97c \uc0ac\uc6a9\ud558\uba74 \ubcc4\ub3c4\uc758 \uc778\uc2a4\ud134\uc2a4 \ub610\ub294 \ub2e4\ub978 \ud14c\ub10c\ud2b8\ubcf4\ub2e4 \ub354 \ub192\uc740 \uc6b0\uc120\uc21c\uc704\uc5d0\uc11c \ud14c\ub10c\ud2b8\uc758 \ud30c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \uc815\ucc45\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ud504\ub85c\uc81d\ud2b8\uc5d0 \ub300\ud55c \uc77c\ubc18\uc801\uc778 OPA \uc815\ucc45 \ubaa8\uc74c\uc740 GitHub \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>OPA\ub97c \uc0ac\uc6a9\ud558\uc5ec CoreDNS\uc5d0\uc11c \ubc18\ud658\ub418\ub294 \ub808\ucf54\ub4dc\ub97c \ud544\ud130\ub9c1/\uc81c\uc5b4\ud560 \uc218 \uc788\ub294 \uc2e4\ud5d8\uc801\uc778 CoreDNS\ub97c \uc704\ud55c OPA \ud50c\ub7ec\uadf8\uc778\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#kyverno","title":"Kyverno","text":"<p>Kyverno\ub294 \uc815\ucc45\uc744 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4\ub85c \uc0ac\uc6a9\ud558\uc5ec \uad6c\uc131\uc744 \uac80\uc99d, \ubcc0\uacbd \ubc0f \uc0dd\uc131\ud560 \uc218 \uc788\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ubcf8 \uc815\ucc45 \uc5d4\uc9c4\uc785\ub2c8\ub2e4. Kyverno\ub294 \uc720\ud6a8\uc131 \uac80\uc0ac\ub97c \uc704\ud574 Kustomize \uc2a4\ud0c0\uc77c \uc624\ubc84\ub808\uc774\ub97c \uc0ac\uc6a9\ud558\uace0 \ubcc0\ud615\uc744 \uc704\ud55c JSON \ud328\uce58 \ubc0f \uc804\ub7b5\uc801 \ubcd1\ud569 \ud328\uce58\ub97c \uc9c0\uc6d0\ud558\uba70 \uc720\uc5f0\ud55c \ud2b8\ub9ac\uac70\ub97c \uae30\ubc18\uc73c\ub85c \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uac04\uc5d0 \ub9ac\uc18c\uc2a4\ub97c \ubcf5\uc81c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Kyverno\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uaca9\ub9ac\ud558\uace0, \ud30c\ub4dc \ubcf4\uc548 \ubc0f \uae30\ud0c0 \ubaa8\ubc94 \uc0ac\ub840\ub97c \uc801\uc6a9\ud558\uace0, \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc \uac19\uc740 \uae30\ubcf8 \uad6c\uc131\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ud504\ub85c\uc81d\ud2b8\uc758 GitHub \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \uba87 \uac00\uc9c0 \uc608\uc81c\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\ub978 \ub9ce\uc740 \uac83\ub4e4\uc774 Kyverno \uc6f9\uc0ac\uc774\ud2b8 \ub0b4 \uc815\ucc45 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc5d0 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_12","title":"\ud14c\ub10c\ud2b8 \uc6cc\ud06c\ub85c\ub4dc\ub97c \ud2b9\uc815 \ub178\ub4dc\ub85c \uaca9\ub9ac","text":"<p>\ud14c\ub10c\ud2b8 \uc6cc\ud06c\ub85c\ub4dc\uac00 \ud2b9\uc815 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub3c4\ub85d \uc81c\ud55c\ud558\uba74 \uc18c\ud504\ud2b8 \uba40\ud2f0 \ud14c\ub10c\uc2dc \ubaa8\ub378\uc758 \uaca9\ub9ac\ub97c \ub192\uc774\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc811\uadfc \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uba74 \ud14c\ub10c\ud2b8\ubcc4 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uac01 \ud14c\ub10c\ud2b8\uc6a9\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ub41c \ub178\ub4dc\uc5d0\uc11c\ub9cc \uc2e4\ud589\ub429\ub2c8\ub2e4. \uc774\ub7f0 \uaca9\ub9ac\ub97c \ub2ec\uc131\ud558\uae30 \uc704\ud574 \ub124\uc774\ud2f0\ube0c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc18d\uc131(\ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0, \ud14c\uc778\ud2b8 \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158)\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud2b9\uc815 \ub178\ub4dc\ub97c \ud30c\ub4dc \uc2a4\ucf00\uc904\ub9c1 \ub300\uc0c1\uc73c\ub85c \uc9c0\uc815\ud558\uace0 \ub2e4\ub978 \ud14c\ub10c\ud2b8\uc758 \ud30c\ub4dc\uac00 \ud14c\ub10c\ud2b8\ubcc4 \ub178\ub4dc\uc5d0 \uc2a4\ucf00\uc904\ub9c1\ub418\uc9c0 \uc54a\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#1-","title":"\ud30c\ud2b8 1 - \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0\ub294 \ub178\ub4dc \ub808\uc774\ube14\uc744 \uae30\ubc18\uc73c\ub85c \ub178\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud560 \ub300\uc0c1\uc73c\ub85c \uc9c0\uc815\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0 \uaddc\uce59\uc744 \uc0ac\uc6a9\ud558\uba74 \uc140\ub809\ud130 \uc6a9\uc5b4\uc640 \uc77c\uce58\ud558\ub294 \ud2b9\uc815 \ub178\ub4dc\uc5d0 \ud30c\ub4dc\uac00 \ubab0\ub9ac\ub3c4\ub85d \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ud30c\ub4dc \uc0ac\uc591\uc5d0\uc11c\ub294 <code>requiredDuringSchedulingIgnoredDuringExecution</code> \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0\uac00 \uac01 \ud30c\ub4dc\uc5d0 \uc801\uc6a9\ub41c\ub2e4. \uacb0\uacfc\uc801\uc73c\ub85c \ud30c\ub4dc\ub294 <code>node-restriction.kubernetes.io/tenant: tenants-x</code>\uc640 \uac19\uc740 \ud0a4/\uac12\uc73c\ub85c \ub808\uc774\ube14\uc774 \uc9c0\uc815\ub41c \ub178\ub4dc\uc5d0 \ubc30\ud3ec\ub429\ub2c8\ub2e4.</p> <pre><code>...\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: node-restriction.kubernetes.io/tenant\n            operator: In\n            values:\n            - tenants-x\n...\n</code></pre> <p>\uc774 \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0\ub97c \uc0ac\uc6a9\ud558\uba74 \uc2a4\ucf00\uc904\ub9c1 \uc911\uc5d0 \ub808\uc774\ube14\uc774 \ud544\uc694\ud558\uc9c0\ub9cc \uc2e4\ud589 \uc911\uc5d0\ub294 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uae30\ubcf8 \ub178\ub4dc\uc758 \ub808\uc774\ube14\uc774 \ubcc0\uacbd\ub418\ub354\ub77c\ub3c4 \ud574\ub2f9 \ub808\uc774\ube14 \ubcc0\uacbd\uc73c\ub85c \uc778\ud574 \ud30c\ub4dc\uac00 \uc81c\uac70\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ud5a5\ud6c4 \uc2a4\ucf00\uc904\ub9c1\uc774 \uc601\ud5a5\uc744 \ubc1b\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Warning</p> <p><code>node-restriction.kubernetes.io/</code> \ub808\uc774\ube14 \uc811\ub450\uc0ac\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ud2b9\ubcc4\ud55c \uc758\ubbf8\ub97c \uac00\uc9d1\ub2c8\ub2e4. EKS \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 NodeRestriction\uc740 'kubelet'\uc774 \uc774 \uc811\ub450\uc0ac\ub97c \uac00\uc9c4 \ub808\uc774\ube14\uc744 \ucd94\uac00/\uc81c\uac70/\uc5c5\ub370\uc774\ud2b8\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud569\ub2c8\ub2e4. \uacf5\uaca9\uc790\ub294 <code>kubelet</code>\uc758 \ub808\uc774\ube14\uc744 \uc218\uc815\ud560 \uc218 \uc5c6\uc73c\ubbc0\ub85c, <code>kubelet</code>\uc758 \uc790\uaca9 \uc99d\uba85\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc \uac1c\uccb4\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uac70\ub098 \uc774\ub7f0 \ub808\uc774\ube14\uc744 <code>kubelet</code>\uc73c\ub85c \uc804\ub2ec\ud558\ub3c4\ub85d \uc2dc\uc2a4\ud15c \uc124\uc815\uc744 \uc218\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uc774 \uc811\ub450\uc0ac\ub97c \ubaa8\ub4e0 \ud30c\ub4dc\uc758 \ub178\ub4dc \uc2a4\ucf00\uc904\ub9c1\uc5d0 \uc0ac\uc6a9\ud558\uba74 \uacf5\uaca9\uc790\uac00 \ub178\ub4dc \ub808\uc774\ube14\uc744 \uc218\uc815\ud558\uc5ec \ub2e4\ub978 \uc6cc\ud06c\ub85c\ub4dc \uc138\ud2b8\ub97c \ub178\ub4dc\ub85c \ub04c\uc5b4\ub4e4\uc774\ub824\ub294 \uc2dc\ub098\ub9ac\uc624\ub97c \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Info</p> <p>\ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0 \ub300\uc2e0 \ub178\ub4dc \uc140\ub809\ud130\ub97c \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0\ub294 \ud45c\ud604\ubc29\uc2dd\uc774 \ub354 \ub2e4\uc591\ud558\uace0 \ud30c\ub4dc \uc2a4\ucf00\uc904\ub9c1 \uc911\uc5d0 \ub354 \ubcf5\uc7a1\ud55c \uc870\uac74\uc744 \uc815\uc758\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucc28\uc774\uc810\uacfc \uace0\uae09 \uc2a4\ucf00\uc904\ub9c1 \uc120\ud0dd\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 CNCF \ube14\ub85c\uadf8 \uac8c\uc2dc\ubb3c\uc778 \uace0\uae09 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uc758 \ub178\ub4dc \uc2a4\ucf00\uc904\ub9c1\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/multitenancy/#2-taint-toleration","title":"\ud30c\ud2b8 2 - \ud14c\uc778\ud2b8(Taint) \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158(Toleration)","text":"<p>\ud30c\ub4dc\ub97c \ub178\ub4dc\ub85c \ub04c\uc5b4\ub4e4\uc774\ub294 \uac83\uc740 \uc774 \uc138 \ubd80\ubd84\uc73c\ub85c \uad6c\uc131\ub41c \uc811\uadfc \ubc29\uc2dd\uc758 \uccab \ubc88\uc9f8 \ubd80\ubd84\uc5d0 \ubd88\uacfc\ud569\ub2c8\ub2e4. \uc774 \uc811\uadfc \ubc29\uc2dd\uc774 \uc81c\ub300\ub85c \uc791\ub3d9\ud558\ub824\uba74 \uad8c\ud55c\uc774 \ubd80\uc5ec\ub418\uc9c0 \uc54a\uc740 \ub178\ub4dc\uc5d0 \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud574\uc57c \ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc6d0\uce58 \uc54a\uac70\ub098 \uc2b9\uc778\ub418\uc9c0 \uc54a\uc740 \ud30c\ub4dc\ub97c \ucc28\ub2e8\ud558\uae30 \uc704\ud574 \ub178\ud2b8 \ud14c\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ud14c\uc778\ud2b8\ub294 \ud30c\ub4dc\uac00 \uc2a4\ucf00\uc904\ub9c1\ub418\uc9c0 \uc54a\ub3c4\ub85d \ub178\ub4dc\uc5d0 \uc870\uac74\uc744 \uc124\uc815\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc544\ub798 \ud14c\uc778\ud2b8\ub294 <code>tenant: tenants-x</code>\uc758 \ud0a4-\uac12 \uc30d\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p> <pre><code>...\n    taints:\n      - key: tenant\n        value: tenants-x\n        effect: NoSchedule\n...\n</code></pre> <p>\uc704\uc640 \uac19\uc774 \ub178\ub4dc <code>\ud14c\uc778\ud2b8</code>\uac00 \uc8fc\uc5b4\uc9c0\uba74, \ud14c\uc778\ud2b8\ub97c \ud5c8\uc6a9\ud558\ub294 \ud30c\ub4dc\ub9cc \ub178\ub4dc\uc5d0 \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc788\ub2e4. \uc2b9\uc778\ub41c \ud30c\ub4dc\ub97c \ub178\ub4dc\uc5d0 \uc2a4\ucf00\uc904\ub9c1\ud560 \uc218 \uc788\uc73c\ub824\uba74 \uc544\ub798\uc640 \uac19\uc774 \uac01 \ud30c\ub4dc \uc0ac\uc591\uc5d0 \ud14c\uc778\ud2b8\uc5d0 \ub300\ud55c <code>\ud1a8\ub7ec\ub808\uc774\uc158</code>\uc774 \ud3ec\ud568\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>...\n  tolerations:\n  - effect: NoSchedule\n    key: tenant\n    operator: Equal\n    value: tenants-x\n...\n</code></pre> <p>\uc704\uc758 <code>\ud1a8\ub7ec\ub808\uc774\uc158</code>\uc744 \uac00\uc9c4 \ud30c\ub4dc\ub294 \uc801\uc5b4\ub3c4 \uadf8 \ud2b9\uc815 \ud14c\uc778\ud2b8\ub85c \uc778\ud558\uc5ec \ud574\ub2f9 \ub178\ub4dc\ub85c \uc2a4\ucf00\uc904\ub9c1\uc774 \uc911\ub2e8\ub418\uc9c0\ub294 \uc54a\uc744 \uac83\uc774\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ub178\ub4dc \ub9ac\uc18c\uc2a4 \uc555\ubc15\uacfc \uac19\uc740 \ud2b9\uc815 \uc0c1\ud669\uc5d0\uc11c \ud30c\ub4dc \uc2a4\ucf00\uc904\ub9c1\uc744 \uc77c\uc2dc\uc801\uc73c\ub85c \uc911\ub2e8\ud558\uae30 \uc704\ud574 \ud14c\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud558\uae30\ub3c4 \ud569\ub2c8\ub2e4. \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0, \ud14c\uc778\ud2b8 \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uba74 \uc6d0\ud558\ub294 \ud30c\ub4dc\ub97c \ud2b9\uc815 \ub178\ub4dc\ub85c \ud6a8\uacfc\uc801\uc73c\ub85c \ubc30\ud3ec\ud558\uace0 \uc6d0\uce58 \uc54a\ub294 \ud30c\ub4dc\ub97c \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>\ud2b9\uc815 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\ub294 \ubaa8\ub4e0 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\ub7f0 \ud30c\ub4dc\ub294 \uc608\ub85c \ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4 (CNI) \ubc0f kube-proxy \ub370\ubaac\uc14b\ub4f1\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub97c \uc704\ud574 \uc774\ub7f0 \ud30c\ub4dc\uc758 \uc0ac\uc591\uc5d0\ub294 \ub2e4\uc591\ud55c \ud14c\uc778\ud2b8\uc744 \uacac\ub51c \uc218 \uc788\ub294 \ub9e4\uc6b0 \uad00\ub300\ud55c \ud1a8\ub7ec\ub808\uc774\uc158\uc774 \ud3ec\ud568\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\ub7f0 \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \ubcc0\uacbd\ud558\uc9c0 \uc54a\ub3c4\ub85d \uc8fc\uc758\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub7f0 \ud5c8\uc6a9\uce58\ub97c \ubcc0\uacbd\ud558\uba74 \ud074\ub7ec\uc2a4\ud130 \uc791\ub3d9\uc774 \uc798\ubabb\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c OPA/Gatekeeper \ubc0f Kyverno\uc640 \uac19\uc740 \uc815\ucc45 \uad00\ub9ac \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2b9\uc778\ub418\uc9c0 \uc54a\uc740 \ud30c\ub4dc\uac00 \uc774\ub7f0 \uad00\ub300\ud55c \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud558\ub3c4\ub85d \ud558\ub294 \uac80\uc99d \uc815\ucc45\ub3c4 \uc791\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#3-","title":"\ud30c\ud2b8 3 - \ub178\ub4dc \uc120\ud0dd\uc744 \uc704\ud55c \uc815\ucc45 \uae30\ubc18 \uad00\ub9ac","text":"<p>CICD \ud30c\uc774\ud504\ub77c\uc778\uc758 \uaddc\uce59 \uc801\uc6a9\uc744 \ud3ec\ud568\ud558\uc5ec \ud30c\ub4dc \uc0ac\uc591\uc758 \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0 \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158\uc744  \uad00\ub9ac\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc5ec\ub7ec \ub3c4\uad6c\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \uc218\uc900\uc5d0\uc11c\ub3c4 \uaca9\ub9ac\ub97c \uc801\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub97c \uc704\ud574 \uc815\ucc45 \uad00\ub9ac \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc694\uccad \ud398\uc774\ub85c\ub4dc\ub97c \uae30\ubc18\uc73c\ub85c \uc778\ubc14\uc6b4\ub4dc \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \uc694\uccad\uc744 \ubcc0\uacbd \ud558\uc5ec \uc704\uc5d0\uc11c \uc5b8\uae09\ud55c \uac01 \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0 \uaddc\uce59 \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4, tenants-x \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub85c \ud5a5\ud558\ub294 \ud30c\ub4dc\uc5d0 \uc62c\ubc14\ub978 \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0 \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \uc2a4\ud0ec\ud551_\ud558\uc5ec _tenants-x \ub178\ub4dc\uc5d0 \ub300\ud55c \uc2a4\ucf00\uc904\ub9c1\uc744 \ud5c8\uc6a9\ud560 \uc218 \uc788\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubba4\ud14c\uc774\ud305(Mutating) \uc5b4\ub4dc\ubbf8\uc158 \uc6f9\ud6c5\uc744 \uc0ac\uc6a9\ud558\uc5ec \uad6c\uc131\ub41c \uc815\ucc45 \uad00\ub9ac \ub3c4\uad6c\ub97c \ud65c\uc6a9\ud558\uba74 \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc778\ubc14\uc6b4\ub4dc \ud30c\ub4dc \uc0ac\uc591\uc744 \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubba4\ud14c\uc774\uc158\uc740 \uc6d0\ud558\ub294 \uc2a4\ucf00\uc904\ub9c1\uc774 \uac00\ub2a5\ud558\ub3c4\ub85d \ud544\uc694\ud55c \uc694\uc18c\ub97c \ucd94\uac00\ud569\ub2c8\ub2e4. \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0\ub97c \ucd94\uac00\ud558\ub294 OPA/\uac8c\uc774\ud2b8\ud0a4\ud37c \uc815\ucc45\uc758 \uc608\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: mutations.gatekeeper.sh/v1alpha1\nkind: Assign\nmetadata:\n  name: mutator-add-nodeaffinity-pod\n  annotations:\n    aws-eks-best-practices/description: &gt;-\n      Adds Node affinity - https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity\nspec:\n  applyTo:\n  - groups: [\"\"]\n    kinds: [\"Pod\"]\n    versions: [\"v1\"]\n  match:\n    namespaces: [\"tenants-x\"]\n  location: \"spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms\"\n  parameters:\n    assign:\n      value: \n        - matchExpressions:\n          - key: \"tenant\"\n            operator: In\n            values:\n            - \"tenants-x\"\n</code></pre> <p>\uc704\uc758 \uc815\ucc45\uc740 tenants-x \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ud30c\ub4dc\ub97c \uc801\uc6a9\ud558\uae30 \uc704\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \uc694\uccad\uc5d0 \uc801\uc6a9\ub429\ub2c8\ub2e4. \uc774 \uc815\ucc45\uc740 <code>requiredDuringSchedulingIgnoredDuringExecution</code> \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0 \uaddc\uce59\uc744 \ucd94\uac00\ud558\uc5ec, \ud30c\ub4dc\uac00 <code>tenant: tenants-x</code> \ub808\uc774\ube14\uc774 \ubd99\uc740 \ub178\ub4dc\uc5d0 \uc9d1\uc911\ub418\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p> <p>\uc544\ub798\uc5d0 \ub098\uc640 \uc788\ub294 \ub450 \ubc88\uc9f8 \uc815\ucc45\uc740 \ub300\uc0c1 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc640 \uadf8\ub8f9, \uc885\ub958, \ubc84\uc804\uc758 \ub3d9\uc77c\ud55c \uc77c\uce58 \uae30\uc900\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub3d9\uc77c\ud55c \ud30c\ub4dc \uc0ac\uc591\uc5d0 \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: mutations.gatekeeper.sh/v1alpha1\nkind: Assign\nmetadata:\n  name: mutator-add-toleration-pod\n  annotations:\n    aws-eks-best-practices/description: &gt;-\n      Adds toleration - https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\nspec:\n  applyTo:\n  - groups: [\"\"]\n    kinds: [\"Pod\"]\n    versions: [\"v1\"]\n  match:\n    namespaces: [\"tenants-x\"]\n  location: \"spec.tolerations\"\n  parameters:\n    assign:\n      value: \n      - key: \"tenant\"\n        operator: \"Equal\"\n        value: \"tenants-x\"\n        effect: \"NoSchedule\"\n</code></pre> <p>\uc704\uc758 \uc815\ucc45\uc740 \ud30c\ub4dc\uc5d0\ub9cc \ud574\ub2f9\ub41c\ub2e4. \uc774\ub294 \uc815\ucc45\uc758 <code>location</code> \uc694\uc18c\uc5d0 \uc788\ub294 \ubcc0\uacbd\ub418\ub294 \uc694\uc18c\uc5d0 \ub300\ud55c \uacbd\ub85c \ub54c\ubb38\uc785\ub2c8\ub2e4. \ub514\ud50c\ub85c\uc774\uba3c\ud2b8 \ubc0f \uc7a1 \ub9ac\uc18c\uc2a4\uc640 \uac19\uc774 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\ub294 \ub9ac\uc18c\uc2a4\ub97c \ucc98\ub9ac\ud558\uae30 \uc704\ud55c \ucd94\uac00 \uc815\ucc45\uc744 \uc791\uc131\ud560 \uc218 \uc788\ub2e4. \ub098\uc5f4\ub41c \uc815\ucc45 \ubc0f \uae30\ud0c0 \uc608\ub294 \uc774 \uac00\uc774\ub4dc\uc758 \ub3d9\ubc18 GitHub \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774 \ub450 \ubba4\ud14c\uc774\uc158\uc758 \uacb0\uacfc\ub294 \ud30c\ub4dc\uac00 \uc6d0\ud558\ub294 \ub178\ub4dc\uc5d0 \ub04c\ub9ac\ub294 \ub3d9\uc2dc\uc5d0 \ud2b9\uc815 \ub178\ub4dc \ud14c\uc778\ud2b8\uc5d0 \uc758\ud574 \ubc18\ubc1c\ub418\uc9c0 \uc54a\ub294\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. \uc774\ub97c \ud655\uc778\ud558\uae30 \uc704\ud574 <code>tenant=tenants-x</code> \ub85c \ub808\uc774\ube14\uc774 \uc9c0\uc815\ub41c \ub178\ub4dc\ub97c \uac00\uc838 \uc624\uace0 <code>tenants-x</code> \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc5d0\uc11c \ud30c\ub4dc\ub97c \uac00\uc838 \uc624\uae30 \uc704\ud574 \ub450 \uac1c\uc758 <code>kubectl</code> \ud638\ucd9c\uc5d0\uc11c \ucd9c\ub825 \uc2a4\ub2c8\ud3ab\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>kubectl get nodes -l tenant=tenants-x\nNAME                                        \nip-10-0-11-255...\nip-10-0-28-81...\nip-10-0-43-107...\n\nkubectl -n tenants-x get pods -owide\nNAME                                  READY   STATUS    RESTARTS   AGE   IP            NODE\ntenant-test-deploy-58b895ff87-2q7xw   1/1     Running   0          13s   10.0.42.143   ip-10-0-43-107...\ntenant-test-deploy-58b895ff87-9b6hg   1/1     Running   0          13s   10.0.18.145   ip-10-0-28-81...\ntenant-test-deploy-58b895ff87-nxvw5   1/1     Running   0          13s   10.0.30.117   ip-10-0-28-81...\ntenant-test-deploy-58b895ff87-vw796   1/1     Running   0          13s   10.0.3.113    ip-10-0-11-255...\ntenant-test-pod                       1/1     Running   0          13s   10.0.35.83    ip-10-0-43-107...\n</code></pre> <p>\uc704\uc758 \ucd9c\ub825\uc5d0\uc11c \ubcfc \uc218 \uc788\ub4ef\uc774 \ubaa8\ub4e0 \ud30c\ub4dc\ub294 <code>tenant=tenants-x</code>\ub85c \ud45c\uc2dc\ub41c \ub178\ub4dc\uc5d0 \uc2a4\ucf00\uc904\ub9c1\ub429\ub2c8\ub2e4. \uac04\ub2e8\ud788 \ub9d0\ud574, \ud30c\ub4dc\ub294 \uc6d0\ud558\ub294 \ub178\ub4dc\uc5d0\uc11c\ub9cc \uc2e4\ud589\ub418\uace0 \ub2e4\ub978 \ud30c\ub4dc(\ud544\uc218 \uc5b4\ud53c\ub2c8\ud2f0 \ubc0f \ud1a8\ub7ec\ub808\uc774\uc158 \uc81c\uc678)\ub294 \uc2e4\ud589\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ud14c\ub10c\ud2b8 \uc6cc\ud06c\ub85c\ub4dc\ub294 \ud6a8\uacfc\uc801\uc73c\ub85c \uaca9\ub9ac\ub429\ub2c8\ub2e4.</p> <p>\ubba4\ud14c\uc774\uc158\ub41c \ud30c\ub4dc \uc2a4\ud399\uc758 \uc608\ub294 \uc544\ub798\uc5d0 \ub098\uc640 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: tenant-test-pod\n  namespace: tenants-x\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: tenant\n            operator: In\n            values:\n            - tenants-x\n...\n  tolerations:\n  - effect: NoSchedule\n    key: tenant\n    operator: Equal\n    value: tenants-x\n...\n</code></pre> <p>Attention</p> <p>\ubba4\ud14c\uc774\ud305(mutating) \ubc0f \uac80\uc99d(validating) \uc5b4\ub4dc\ubbf8\uc158 \uc6f9\ud6c5\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \uc694\uccad \ud750\ub984\uc5d0 \ud1b5\ud569\ub41c \uc815\ucc45 \uad00\ub9ac \ub3c4\uad6c\ub294 \uc9c0\uc815\ub41c \uae30\uac04 \ub0b4\uc5d0 API \uc11c\ubc84\uc758 \uc694\uccad\uc5d0 \uc751\ub2f5\ud558\ub3c4\ub85d \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc774 \uc2dc\uac04\uc740 \ubcf4\ud1b5 3\ucd08 \uc774\ub0b4\uc785\ub2c8\ub2e4. \uc6f9\ud6c5 \ud638\ucd9c\uc774 \uad6c\uc131\ub41c \uc2dc\uac04 \ub0b4\uc5d0 \uc751\ub2f5\uc744 \ubc18\ud658\ud558\uc9c0 \ubabb\ud558\uba74 \uc778\ubc14\uc6b4\ub4dc API \uc11c\ubc84 \uc694\uccad\uc758 \ubcc0\uacbd \ubc0f/\ub610\ub294 \uac80\uc99d\uc774 \ubc1c\uc0dd\ud560 \uc218\ub3c4 \uc788\uace0 \uadf8\ub807\uc9c0 \uc54a\uc744 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ub3d9\uc791\uc740 \uc2b9\uc778 \uc6f9\ud6c5 \uad6c\uc131\uc774 Fail-Open \ub610\ub294 Fail-Closed\ub85c \uc124\uc815\ub418\uc5b4 \uc788\ub294\uc9c0 \uc5ec\ubd80\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9d1\ub2c8\ub2e4.</p> <p>\uc704 \uc608\uc2dc\uc5d0\uc11c\ub294 OPA/\uac8c\uc774\ud2b8\ud0a4\ud37c\uc6a9\uc73c\ub85c \uc791\uc131\ub41c \uc815\ucc45\uc744 \uc0ac\uc6a9\ud588\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ub178\ub4dc \uc120\ud0dd \uc0ac\uc6a9 \uc0ac\ub840\ub97c \ucc98\ub9ac\ud558\ub294 \ub2e4\ub978 \uc815\ucc45 \uad00\ub9ac \ub3c4\uad6c\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \uc774 Kyverno \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc \uc5b4\ud53c\ub2c8\ud2f0 \ubba4\ud14c\uc774\uc158\uc744 \ucc98\ub9ac\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Tip</p> <p>\uc81c\ub300\ub85c \uc791\ub3d9\ud558\ub294 \uacbd\uc6b0 \uc815\ucc45\uc744 \ubcc0\uacbd\ud558\uba74 \uc778\ubc14\uc6b4\ub4dc API \uc11c\ubc84 \uc694\uccad \ud398\uc774\ub85c\ub4dc\uc5d0 \ub300\ud55c \uc6d0\ud558\ub294 \ubcc0\uacbd \uc0ac\ud56d\uc774 \uc801\uc6a9\ub429\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ubcc0\uacbd \uc0ac\ud56d\uc774 \uacc4\uc18d \uc801\uc6a9\ub418\uae30 \uc804\uc5d0 \uc6d0\ud558\ub294 \ubcc0\uacbd \uc0ac\ud56d\uc774 \uc801\uc6a9\ub418\ub294\uc9c0 \ud655\uc778\ud558\ub294 \uac80\uc99d \uc815\ucc45\ub3c4 \ud3ec\ud568\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub294 \ud14c\ub10c\ud2b8-\ub178\ub4dc \uaca9\ub9ac\uc5d0 \uc774\ub7f0 \uc815\ucc45\uc744 \uc0ac\uc6a9\ud560 \ub54c \ud2b9\ud788 \uc911\uc694\ud569\ub2c8\ub2e4. \ub610\ud55c \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc6d0\uce58 \uc54a\ub294 \uad6c\uc131\uc774 \uc788\ub294\uc9c0 \uc815\uae30\uc801\uc73c\ub85c \uc810\uac80\ud560 \uc218 \uc788\ub3c4\ub85d \uac10\uc0ac \uc815\ucc45\uc744 \ud3ec\ud568\ud558\ub294 \uac83\ub3c4 \uc88b\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_13","title":"\ucc38\uc870","text":"<ul> <li> <p>k-rail\ub294 \ud2b9\uc815 \uc815\ucc45\uc758 \uc801\uc6a9\uc744 \ud1b5\ud574 \uba40\ud2f0\ud14c\ub10c\ud2b8 \ud658\uacbd\uc744 \ubcf4\ud638\ud560 \uc218 \uc788\ub3c4\ub85d \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> </li> <li> <p>Amazon EKS\ub97c \uc0ac\uc6a9\ud558\ub294 \uba40\ud2f0 \ud14c\ub10c\ud2b8 SaaS \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ub300\ud55c \ubcf4\uc548 \uc0ac\ub840</p> </li> </ul>"},{"location":"ko/security/docs/multitenancy/#_14","title":"\ud558\ub4dc \uba40\ud2f0\ud14c\ub10c\uc2dc","text":"<p>\uac01 \ud14c\ub10c\ud2b8\uc5d0 \ub300\ud574 \ubcc4\ub3c4\uc758 \ud074\ub7ec\uc2a4\ud130\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uc5ec \ud558\ub4dc \uba40\ud2f0\ud14c\ub10c\uc2dc\ub97c \uad6c\ud604\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ud14c\ub10c\ud2b8 \uac04\uc5d0 \ub9e4\uc6b0 \uac15\ub825\ud55c \uaca9\ub9ac\uac00 \uac00\ub2a5\ud558\uc9c0\ub9cc \uba87 \uac00\uc9c0 \ub2e8\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uccab\uc9f8, \ud14c\ub10c\ud2b8\uac00 \ub9ce\uc740 \uacbd\uc6b0 \uc774 \uc811\uadfc \ubc29\uc2dd\uc740 \ube44\uc6a9\uc774 \ub9ce\uc774 \ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uac01 \ud074\ub7ec\uc2a4\ud130\uc758 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ube44\uc6a9\uc744 \uc9c0\ubd88\ud574\uc57c \ud560 \ubfd0\ub9cc \uc544\ub2c8\ub77c \ud074\ub7ec\uc2a4\ud130 \uac04\uc5d0 \ucef4\ud4e8\ud305 \ub9ac\uc18c\uc2a4\ub97c \uacf5\uc720\ud560 \uc218 \uc5c6\uac8c \ub429\ub2c8\ub2e4. \uc774\ub85c \uc778\ud574 \uacb0\uad6d \ud074\ub7ec\uc2a4\ud130\uc758 \uc77c\ubd80\ub294 \ud65c\uc6a9\ub3c4\uac00 \ub0ae\uace0 \ub2e4\ub978 \ud074\ub7ec\uc2a4\ud130\ub294 \uacfc\ub3c4\ud558\uac8c \uc0ac\uc6a9\ub418\ub294 \ub2e8\ud3b8\ud654\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.</p> <p>\ub458\uc9f8, \uc774\ub7f0 \ud074\ub7ec\uc2a4\ud130\ub97c \ubaa8\ub450 \uad00\ub9ac\ud558\ub824\uba74 \ud2b9\uc218 \ub3c4\uad6c\ub97c \uad6c\uc785\ud558\uac70\ub098 \uad6c\ucd95\ud574\uc57c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\uc2dc\uac04\uc774 \uc9c0\ub098\uba74 \uc218\ubc31 \ub610\ub294 \uc218\ucc9c \uac1c\uc758 \ud074\ub7ec\uc2a4\ud130\ub97c \uad00\ub9ac\ud558\ub294 \uac83\uc774 \ub108\ubb34 \ubcf5\uc7a1\ud574\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub9c8\uc9c0\ub9c9\uc73c\ub85c \ud14c\ub10c\ud2b8\ubcc4\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\ub294 \uac83\uc740 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud558\ub294 \uac83\ubcf4\ub2e4 \ub290\ub9bd\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uaddc\uc81c\uac00 \uc5c4\uaca9\ud55c \uc0b0\uc5c5\uc774\ub098 \uac15\ub825\ud55c \uaca9\ub9ac\uac00 \ud544\uc694\ud55c SaaS \ud658\uacbd\uc5d0\uc11c\ub294 \ud558\ub4dc \ud14c\ub10c\uc2dc \uc811\uadfc \ubc29\uc2dd\uc774 \ud544\uc694\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_15","title":"\ud5a5\ud6c4 \ubc29\ud5a5","text":"<p>Kubernetes \ucee4\ubba4\ub2c8\ud2f0\ub294 \uc18c\ud504\ud2b8 \uba40\ud2f0\ud14c\ub10c\uc2dc\uc758 \ud604\uc7ac \ub2e8\uc810\uacfc \ud558\ub4dc \uba40\ud2f0\ud14c\ub10c\uc2dc\uc758 \ubb38\uc81c\uc810\uc744 \uc778\uc2dd\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.\uba40\ud2f0\ud14c\ub10c\uc2dc SIG \uadf8\ub8f9\uc740 \uacc4\uce35\uc801 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ucee8\ud2b8\ub864\ub7ec(HNC) \ubc0f \uac00\uc0c1 \ud074\ub7ec\uc2a4\ud130\ub97c \ube44\ub86f\ud55c \uc5ec\ub7ec \uc778\ud050\ubca0\uc774\uc158 \ud504\ub85c\uc81d\ud2b8\ub97c \ud1b5\ud574 \uc774\ub7f0 \ub2e8\uc810\uc744 \ud574\uacb0\ud558\ub824\uace0 \ub178\ub825\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>HNC \uc81c\uc548(KEP)\uc740 \ud14c\ub10c\ud2b8 \uad00\ub9ac\uc790\uac00 \ud558\uc704 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uacfc \ud568\uaed8 [policy] \uac1c\uccb4 \uc0c1\uc18d\uc744 \ud1b5\ud574 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uac04\uc758 \uc0c1\uc704-\ud558\uc704 \uad00\uacc4\ub97c \uc0dd\uc131\ud558\ub294 \ubc29\ubc95\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.</p> <p>\uac00\uc0c1 \ud074\ub7ec\uc2a4\ud130 \uc81c\uc548\uc11c\ub294 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc758 \uac01 \ud14c\ub10c\ud2b8(\"Kubernetes on Kubernetes\"\ub77c\uace0\ub3c4 \ud45c\ud604)\uc5d0 \ub300\ud574 API \uc11c\ubc84, \ucee8\ud2b8\ub864\ub7ec \uad00\ub9ac\uc790 \ubc0f \uc2a4\ucf00\uc904\ub7ec\ub97c \ud3ec\ud568\ud55c \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uc11c\ube44\uc2a4\uc758 \uac1c\ubcc4 \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\ud558\ub294 \uba54\ucee4\ub2c8\uc998\uc744 \uc124\uba85\ud569\ub2c8\ub2e4.</p> <p>\uba40\ud2f0\ud14c\ub10c\uc2dc \ubca4\uce58\ub9c8\ud06c \uc81c\uc548\uc11c\ub294 \uaca9\ub9ac \ubc0f \ubd84\ud560\uc744 \uc704\ud55c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\ub97c \uacf5\uc720\ud558\ub294 \uc9c0\uce68\uacfc \uc9c0\uce68 \uc900\uc218 \uc5ec\ubd80\ub97c \uac80\uc99d\ud558\uae30 \uc704\ud55c \uba85\ub839\uc904 \ub3c4\uad6c kubectl-mtb\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/multitenancy/#_16","title":"\uba40\ud2f0 \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac \ub9ac\uc18c\uc2a4","text":"<ul> <li>Banzai Cloud</li> <li>Kommander</li> <li>Lens</li> <li>Nirmata</li> <li>Rafay</li> <li>Rancher</li> <li>Weave Flux</li> </ul>"},{"location":"ko/security/docs/network/","title":"\ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548","text":"<p>\ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548\uc5d0\ub294 \uc5ec\ub7ec \uce21\uba74\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uccab \ubc88\uc9f8\ub294 \uc11c\ube44\uc2a4 \uac04\uc758 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d \ud750\ub984\uc744 \uc81c\ud55c\ud558\ub294 \uaddc\uce59 \uc801\uc6a9\uacfc \uad00\ub828\ub429\ub2c8\ub2e4. \ub450 \ubc88\uc9f8\ub294 \uc804\uc1a1 \uc911\uc778 \ud2b8\ub798\ud53d\uc758 \uc554\ud638\ud654\uc640 \uad00\ub828\uc774 \uc788\uc2b5\ub2c8\ub2e4. EKS\uc5d0\uc11c \uc774\ub7f0 \ubcf4\uc548 \uc870\uce58\ub97c \uad6c\ud604\ud558\ub294 \uba54\ucee4\ub2c8\uc998\uc740 \ub2e4\uc591\ud558\uc9c0\ub9cc \uc885\uc885 \ub2e4\uc74c \ud56d\ubaa9\uc744 \ud3ec\ud568\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_2","title":"\ud2b8\ub798\ud53d \uad00\ub9ac","text":"<ul> <li>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45</li> <li>\ubcf4\uc548 \uadf8\ub8f9</li> </ul>"},{"location":"ko/security/docs/network/#_3","title":"\ub124\ud2b8\uc6cc\ud06c \uc554\ud638\ud654","text":"<ul> <li>\uc11c\ube44\uc2a4 \uba54\uc2dc</li> <li>\ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4(CNI)</li> <li>\uc778\uadf8\ub808\uc2a4 \ucee8\ud2b8\ub864\ub7ec\uc640 \ub85c\ub4dc\ubc38\ub7f0\uc11c</li> <li>Nitro \uc778\uc2a4\ud134\uc2a4</li> <li>cert-manager\uc640 ACM Private CA</li> </ul>"},{"location":"ko/security/docs/network/#_4","title":"\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ubaa8\ub4e0 \ud30c\ub4dc\uc640 \ud30c\ub4dc \uac04\uc758 \ud1b5\uc2e0\uc774 \ud5c8\uc6a9\ub41c\ub2e4. \uc774\ub7ec\ud55c \uc720\uc5f0\uc131\uc740 \uc2e4\ud5d8\uc744 \ucd09\uc9c4\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\uc9c0\ub9cc \uc548\uc804\ud55c \uac83\uc73c\ub85c \uac04\uc8fc\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ud30c\ub4dc \uac04 \ud1b5\uc2e0(East/West \ud2b8\ub798\ud53d\uc774\ub77c\uace0\ub3c4 \ud568)\uacfc \ud30c\ub4dc\uc640 \uc678\ubd80 \uc11c\ube44\uc2a4 \uac04\uc758 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d\uc744 \uc81c\ud55c\ud558\ub294 \uba54\ucee4\ub2c8\uc998\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 OSI \ubaa8\ub378\uc758 \uacc4\uce35 3\uacfc 4\uc5d0\uc11c \uc791\ub3d9\ud569\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ud30c\ub4dc, \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc140\ub809\ud130 \ubc0f \ub808\uc774\ube14\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc18c\uc2a4 \ubc0f \ub300\uc0c1 \ud30c\ub4dc\ub97c \uc2dd\ubcc4\ud558\uc9c0\ub9cc IP \uc8fc\uc18c, \ud3ec\ud2b8 \ubc88\ud638, \ud504\ub85c\ud1a0\ucf5c \ub610\ub294 \uc774\ub4e4\uc758 \uc870\ud569\uc744 \ud3ec\ud568\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ud30c\ub4dc\uc5d0 \ub300\ud55c \uc778\ubc14\uc6b4\ub4dc \ub610\ub294 \uc544\uc6c3\ubc14\uc6b4\ub4dc \uc5f0\uacb0 \ubaa8\ub450\uc5d0 \uc801\uc6a9\ud560 \uc218 \uc788\uc73c\uba70, \uc774\ub97c \uc778\uadf8\ub808\uc2a4(ingress) \ubc0f \uc774\uadf8\ub808\uc2a4(egress) \uaddc\uce59\uc774\ub77c\uace0\ub3c4 \ud569\ub2c8\ub2e4.</p> <p>Amazon VPC CNI \ud50c\ub7ec\uadf8\uc778\uc758 \uae30\ubcf8 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc9c0\uc6d0\uc744 \ud1b5\ud574 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uad6c\ud604\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d\uc744 \ubcf4\ud638\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc5c5\uc2a4\ud2b8\ub9bc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 API\uc640 \ud1b5\ud569\ub418\uc5b4 \ud638\ud658\uc131\uacfc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud45c\uc900 \uc900\uc218\ub97c \ubcf4\uc7a5\ud569\ub2c8\ub2e4. \uc5c5\uc2a4\ud2b8\ub9bc API\uc5d0\uc11c \uc9c0\uc6d0\ud558\ub294 \ub2e4\uc591\ud55c \uc2dd\ubcc4\uc790\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc815\ucc45\uc744 \uc815\uc758\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \ubaa8\ub4e0 \uc218\uc2e0 \ubc0f \uc1a1\uc2e0 \ud2b8\ub798\ud53d\uc740 \ud30c\ub4dc\uc5d0 \ud5c8\uc6a9\ub429\ub2c8\ub2e4. PolicyType Ingress\uac00 \ud3ec\ud568\ub41c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc9c0\uc815\ud558\ub294 \uacbd\uc6b0 \ud30c\ub4dc \ub178\ub4dc\uc758 \uc5f0\uacb0\uacfc \uc778\uadf8\ub808\uc2a4 \uaddc\uce59\uc5d0\uc11c \ud5c8\uc6a9\ud558\ub294 \uc5f0\uacb0\ub9cc \ud30c\ub4dc\uc5d0 \ub300\ud55c \uc5f0\uacb0\ub9cc \ud5c8\uc6a9\ub429\ub2c8\ub2e4. \uc774\uadf8\ub808\uc2a4 \uaddc\uce59\uc5d0\ub3c4 \ub3d9\uc77c\ud558\uac8c \uc801\uc6a9\ub429\ub2c8\ub2e4. \uc5ec\ub7ec \uaddc\uce59\uc774 \uc815\uc758\ub41c \uacbd\uc6b0 \uacb0\uc815\uc744 \ub0b4\ub9b4 \ub54c \ubaa8\ub4e0 \uaddc\uce59\uc758 \ud1b5\ud569\uc744 \uace0\ub824\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \ud3c9\uac00 \uc21c\uc11c\ub294 \uc815\ucc45 \uacb0\uacfc\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce58\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ucc98\uc74c \ud504\ub85c\ube44\uc800\ub2dd\ud560 \ub54c VPC CNI \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uae30\ub2a5\uc740 \uae30\ubcf8\uc801\uc73c\ub85c \ud65c\uc131\ud654\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc9c0\uc6d0\ub418\ub294 VPC CNI \uc560\ub4dc\uc628 \ubc84\uc804\uc744 \ubc30\ud3ec\ud588\ub294\uc9c0 \ud655\uc778\ud558\uace0 vpc-cni \uc560\ub4dc\uc628\uc5d0\uc11c <code>ENABLE_NETWORK_POLICY</code> \ud50c\ub798\uadf8\ub97c <code>true</code>\ub85c \uc124\uc815\ud558\uc5ec \uc774\ub97c \ud65c\uc131\ud654\ud558\uc138\uc694. \uc790\uc138\ud55c \uc9c0\uce68\uc740 Amazon EKS \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/network/#_5","title":"\uad8c\uc7a5\uc0ac\ud56d","text":""},{"location":"ko/security/docs/network/#-","title":"\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc2dc\uc791\ud558\uae30 - \ucd5c\uc18c \uad8c\ud55c \uc6d0\uce59 \uc801\uc6a9","text":""},{"location":"ko/security/docs/network/#deny","title":"\ub514\ud3f4\ud2b8 \uac70\ubd80(deny) \uc815\ucc45 \ub9cc\ub4e4\uae30","text":"<p>RBAC \uc815\ucc45\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc5d0\uc11c\ub3c4 \ucd5c\uc18c \uad8c\ud55c \uc561\uc138\uc2a4 \uc6d0\uce59\uc744 \ub530\ub974\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uba3c\uc800 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4\uc5d0\uc11c \ubaa8\ub4e0 \uc778\ubc14\uc6b4\ub4dc \ubc0f \uc544\uc6c3\ubc14\uc6b4\ub4dc \ud2b8\ub798\ud53d\uc744 \uc81c\ud55c\ud558\ub294 '\ubaa8\ub450 \uac70\ubd80' \uc815\ucc45\uc744 \ub9cc\ub4dc\uc138\uc694.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\n  namespace: default\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre> <p></p> <p>Tip</p> <p>\uc704 \uc774\ubbf8\uc9c0\ub294 Tufin\uc758 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ubdf0\uc5b4\ub85c \uc0dd\uc131\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#dns","title":"DNS \ucffc\ub9ac\ub97c \ud5c8\uc6a9\ud558\ub294 \uaddc\uce59 \ub9cc\ub4e4\uae30","text":"<p>\uae30\ubcf8 \uac70\ubd80 \ubaa8\ub4e0 \uaddc\uce59\uc744 \uc801\uc6a9\ud55c \ud6c4\uc5d0\ub294 \ud30c\ub4dc\uac00 \uc774\ub984 \ud655\uc778\uc744 \uc704\ud574 CoreDNS\ub97c \ucffc\ub9ac\ud558\ub3c4\ub85d \ud5c8\uc6a9\ud558\ub294 \uc804\uc5ed \uaddc\uce59\uacfc \uac19\uc740 \ucd94\uac00 \uaddc\uce59\uc5d0 \uacc4\uce35\ud654\ub97c \uc2dc\uc791\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ub808\uc774\ube14\uc744 \uc9c0\uc815\ud558\uc5ec \uc2dc\uc791\ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-dns-access\n  namespace: default\nspec:\n  podSelector:\n    matchLabels: {}\n  policyTypes:\n  - Egress\n  egress:\n  - to:\n    - namespaceSelector:\n        matchLabels:\n          kubernetes.io/metadata.name: kube-system\n      podSelector:\n        matchLabels:\n          k8s-app: kube-dns\n    ports:\n    - protocol: UDP\n      port: 53\n</code></pre> <p></p>"},{"location":"ko/security/docs/network/#_6","title":"\ub124\uc784\uc2a4\ud398\uc774\uc2a4/\ud30c\ub4dc \uac04 \ud2b8\ub798\ud53d \ud750\ub984\uc744 \uc120\ud0dd\uc801\uc73c\ub85c \ud5c8\uc6a9\ud558\ub294 \uaddc\uce59\uc744 \uc810\uc9c4\uc801\uc73c\ub85c \ucd94\uac00","text":"<p>\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc694\uad6c \uc0ac\ud56d\uc744 \uc774\ud574\ud558\uace0 \ud544\uc694\uc5d0 \ub530\ub77c \uc138\ubd84\ud654\ub41c \uc218\uc2e0 \ubc0f \uc1a1\uc2e0 \uaddc\uce59\uc744 \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624. \uc544\ub798 \uc608\ub294 \ud3ec\ud2b8 80\uc758 \uc778\uadf8\ub808\uc2a4 \ud2b8\ub798\ud53d\uc744 <code>client-one</code>\uc5d0\uc11c <code>app-one</code>\uc73c\ub85c \uc81c\ud55c\ud558\ub294 \ubc29\ubc95\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \uacf5\uaca9 \ud45c\uba74\uc744 \ucd5c\uc18c\ud654\ud558\uace0 \uc778\uc99d\ub418\uc9c0 \uc54a\uc740 \uc811\uadfc\uc5d0 \ub300\ud55c \uc704\ud5d8\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-ingress-app-one\n  namespace: default\nspec:\n  podSelector:\n    matchLabels:\n      k8s-app: app-one\n  policyTypes:\n  - Ingress\n  ingress:\n  - from:\n    - podSelector:\n        matchLabels:\n          k8s-app: client-one\n    ports:\n    - protocol: TCP\n      port: 80\n</code></pre> <p></p>"},{"location":"ko/security/docs/network/#_7","title":"\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc801\uc6a9 \ubaa8\ub2c8\ud130\ub9c1","text":"<ul> <li>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ud3b8\uc9d1\uae30 \uc0ac\uc6a9</li> <li>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ud3b8\uc9d1\uae30\ub294 \ub124\ud2b8\uc6cc\ud06c \ud750\ub984 \ub85c\uadf8\uc758 \uc2dc\uac01\ud654, \ubcf4\uc548 \uc810\uc218, \uc790\ub3d9 \uc0dd\uc131\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4.</li> <li>\uc0c1\ud638\ud65c\ub3d9\uc801\uc73c\ub85c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uad6c\uc131\ud558\uc138\uc694.</li> <li>\ub85c\uadf8 \uac10\uc0ac</li> <li>EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uac10\uc0ac \ub85c\uadf8\ub97c \uc815\uae30\uc801\uc73c\ub85c \uac80\ud1a0\ud558\uc138\uc694.</li> <li>\uac10\uc0ac \ub85c\uadf8\ub294 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ubcc0\uacbd\uc744 \ud3ec\ud568\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc218\ud589\ub41c \uc791\uc5c5\uc5d0 \ub300\ud55c \ud48d\ubd80\ud55c \uc815\ubcf4\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4.</li> <li>\uc774 \uc815\ubcf4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2dc\uac04 \uacbd\uacfc\uc5d0 \ub530\ub978 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ubcc0\uacbd \uc0ac\ud56d\uc744 \ucd94\uc801\ud558\uace0 \uc2b9\uc778\ub418\uc9c0 \uc54a\uc558\uac70\ub098 \uc608\uc0c1\uce58 \ubabb\ud55c \ubcc0\uacbd\uc744 \uac10\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\ud14c\uc2a4\ud2b8 \uc790\ub3d9\ud654</li> <li>\uc6b4\uc601 \ud658\uacbd\uc744 \ubbf8\ub7ec\ub9c1\ud558\ub294 \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc744 \ub9cc\ub4e4\uace0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc704\ubc18\ud558\ub824\ub294 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc815\uae30\uc801\uc73c\ub85c \ubc30\ud3ec\ud558\uc5ec \uc790\ub3d9\ud654\ub41c \ud14c\uc2a4\ud2b8\ub97c \uad6c\ud604\ud558\uc2ed\uc2dc\uc624.</li> <li>\uba54\ud2b8\ub9ad \uc9c0\ud45c \ubaa8\ub2c8\ud130\ub9c1</li> <li>VPC CNI \ub178\ub4dc \uc5d0\uc774\uc804\ud2b8\uc5d0\uc11c \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \uba54\ud2b8\ub9ad\uc744 \uc218\uc9d1\ud558\ub3c4\ub85d \uc635\uc800\ubc84\ube4c\ub9ac\ud2f0 \uc5d0\uc774\uc804\ud2b8\ub97c \uad6c\uc131\ud558\uc5ec \uc5d0\uc774\uc804\ud2b8 \uc0c1\ud0dc \ubc0f SDK \uc624\ub958\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\uc815\uae30\uc801\uc73c\ub85c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uac10\uc0ac</li> <li>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc815\uae30\uc801\uc73c\ub85c \uac10\uc0ac\ud558\uc5ec \ud604\uc7ac \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc694\uad6c \uc0ac\ud56d\uc744 \ucda9\uc871\ud558\ub294\uc9c0 \ud655\uc778\ud558\uc2ed\uc2dc\uc624.\uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ubc1c\uc804\ud568\uc5d0 \ub530\ub77c \uac10\uc0ac\ub97c \ud1b5\ud574 \uc911\ubcf5\ub41c \uc778\uadf8\ub808\uc2a4, \uc774\uadf8\ub808\uc2a4 \uaddc\uce59\uc744 \uc81c\uac70\ud558\uace0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \uacfc\ub3c4\ud55c \uad8c\ud55c\uc774 \ubd80\uc5ec\ub418\uc9c0 \uc54a\ub3c4\ub85d \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>Open Policy Agent(OPA)\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc774 \uc874\uc7ac\ud558\ub294\uc9c0 \ud655\uc778</li> <li>\uc544\ub798\uc640 \uac19\uc740 OPA \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ud30c\ub4dc\ub97c \uc628\ubcf4\ub529\ud558\uae30 \uc804\uc5d0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc774 \ud56d\uc0c1 \uc874\uc7ac\ud558\ub294\uc9c0 \ud655\uc778\ud558\uc2ed\uc2dc\uc624. \uc774 \uc815\ucc45\uc740 \ud574\ub2f9 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc774 \uc5c6\ub294 \uacbd\uc6b0 <code>k8s-app: sample-app</code>\uc774\ub77c\ub294 \ub808\uc774\ube14\uc774 \ubd99\uc740 k8s \ud30c\ub4dc\uc758 \uc628\ubcf4\ub529\uc744 \uac70\ubd80\ud569\ub2c8\ub2e4.</li> </ul> <pre><code>package kubernetes.admission\nimport data.kubernetes.networkpolicies\n\ndeny[msg] {\n    input.request.kind.kind == \"Pod\"\n    pod_label_value := {v[\"k8s-app\"] | v := input.request.object.metadata.labels}\n    contains_label(pod_label_value, \"sample-app\")\n    np_label_value := {v[\"k8s-app\"] | v := networkpolicies[_].spec.podSelector.matchLabels}\n    not contains_label(np_label_value, \"sample-app\")\n    msg:= sprintf(\"The Pod %v could not be created because it is missing an associated Network Policy.\", [input.request.object.metadata.name])\n}\ncontains_label(arr, val) {\n    arr[_] == val\n}\n</code></pre>"},{"location":"ko/security/docs/network/#_8","title":"\ubb38\uc81c \ud574\uacb0 (\ud2b8\ub7ec\ube14\uc288\ud305)","text":""},{"location":"ko/security/docs/network/#vpc-network-policy-controller-node-agent","title":"vpc-network-policy-controller \ubc0f node-agent \ub85c\uadf8 \ubaa8\ub2c8\ud130\ub9c1","text":"<p>EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc758 \ucee8\ud2b8\ub864\ub7ec \ub9e4\ub2c8\uc800 \ub85c\uadf8\ub97c \ud65c\uc131\ud654\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uae30\ub2a5\uc744 \uc9c4\ub2e8\ud569\ub2c8\ub2e4. \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ub85c\uadf8\ub97c CloudWatch \ub85c\uadf8 \uadf8\ub8f9\uc73c\ub85c \uc2a4\ud2b8\ub9ac\ubc0d\ud558\uace0 CloudWatch Log Insights\ub97c \uc0ac\uc6a9\ud558\uc5ec \uace0\uae09 \ucffc\ub9ac\ub97c \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub85c\uadf8\uc5d0\uc11c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc73c\ub85c \ud655\uc778\ub41c \ud30c\ub4dc \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uac1d\uccb4, \uc815\ucc45\uc758 \uc870\uc815 \uc0c1\ud0dc\ub97c \ud655\uc778\ud558\uace0 \uc815\ucc45\uc774 \uc608\uc0c1\ub300\ub85c \uc791\ub3d9\ud558\ub294\uc9c0 \ub514\ubc84\uae45\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub610\ud55c Amazon VPC CNI\ub97c \uc0ac\uc6a9\ud558\uba74 EKS \uc6cc\ucee4 \ub178\ub4dc\uc5d0\uc11c \uc815\ucc45 \uc801\uc6a9 \ub85c\uadf8\ub97c \uc218\uc9d1\ud558\uace0 Amazon Cloudwatch \ub85c \ub0b4\ubcf4\ub0bc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud65c\uc131\ud654\ub418\uba74 CloudWatch Container Insights\ub97c \ud65c\uc6a9\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc \uad00\ub828\ub41c \uc0ac\uc6a9\uc5d0 \ub300\ud55c \ud1b5\ucc30\ub825\uc744 \uc81c\uacf5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub610\ud55c Amazon VPC CNI\ub294 \ub178\ub4dc \ub0b4 eBPF \ud504\ub85c\uadf8\ub7a8\uacfc \uc0c1\ud638 \uc791\uc6a9\ud560 \uc218 \uc788\ub294 \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc81c\uacf5\ud558\ub294 SDK\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. SDK\ub294 <code>aws-node</code>\uac00 \ub178\ub4dc\uc5d0 \ubc30\ud3ec\ub420 \ub54c \uc124\uce58\ub429\ub2c8\ub2e4. \ub178\ub4dc\uc758 <code>/opt/cni/bin</code> \ub514\ub809\ud130\ub9ac\uc5d0\uc11c \uc124\uce58\ub41c SDK \ubc14\uc774\ub108\ub9ac\ub97c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd9c\uc2dc \uc2dc SDK\ub294 eBPF \ud504\ub85c\uadf8\ub7a8 \ubc0f \ub9f5 \uac80\uc0ac\uc640 \uac19\uc740 \uae30\ubcf8 \uae30\ub2a5\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4.</p> <pre><code>sudo /opt/cni/bin/aws-eks-na-cli ebpf progs\n</code></pre>"},{"location":"ko/security/docs/network/#_9","title":"\ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d \uba54\ud0c0\ub370\uc774\ud130 \ub85c\uae45","text":"<p>AWS VPC Flow Logs\ub294 VPC\ub97c \ud1b5\uacfc\ud558\ub294 \ud2b8\ub798\ud53d\uc5d0 \ub300\ud55c \uba54\ud0c0\ub370\uc774\ud130(\uc608: \uc18c\uc2a4 \ubc0f \ub300\uc0c1 IP \uc8fc\uc18c, \ud3ec\ud2b8)\ub97c \ud5c8\uc6a9/\ub4dc\ub78d\ub41c \ud328\ud0b7\uacfc \ud568\uaed8 \ucea1\ucc98\ud569\ub2c8\ub2e4. \uc774 \uc815\ubcf4\ub97c \ubd84\uc11d\ud558\uc5ec VPC \ub0b4 \ub9ac\uc18c\uc2a4(\ud30c\ub4dc \ud3ec\ud568) \uac04\uc5d0 \uc758\uc2ec\uc2a4\ub7fd\uac70\ub098 \ud2b9\uc774\ud55c \ud65c\ub3d9\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ud30c\ub4dc\uc758 IP \uc8fc\uc18c\ub294 \uad50\uccb4\ub420 \ub54c \uc790\uc8fc \ubcc0\uacbd\ub418\ubbc0\ub85c \ud50c\ub85c\uc6b0 \ub85c\uadf8\ub9cc\uc73c\ub85c\ub294 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc744 \uc218 \uc788\ub2e4. Calico Enterprise\ub294 \ud30c\ub4dc \ub808\uc774\ube14 \ubc0f \uae30\ud0c0 \uba54\ud0c0\ub370\uc774\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud50c\ub85c\uc6b0 \ub85c\uadf8\ub97c \ud655\uc7a5\ud558\uc5ec \ud30c\ub4dc \uac04 \ud2b8\ub798\ud53d \ud750\ub984\uc744 \ub354 \uc27d\uac8c \ud574\ub3c5\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_10","title":"\ubcf4\uc548 \uadf8\ub8f9","text":"<p>EKS\ub294 AWS VPC \ubcf4\uc548 \uadf8\ub8f9(SG)\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ud074\ub7ec\uc2a4\ud130\uc758 \uc6cc\ucee4 \ub178\ub4dc \uc0ac\uc774\uc758 \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud569\ub2c8\ub2e4. \ubcf4\uc548 \uadf8\ub8f9\uc740 \uc6cc\ucee4 \ub178\ub4dc, \uae30\ud0c0 VPC \ub9ac\uc18c\uc2a4 \ubc0f \uc678\ubd80 IP \uc8fc\uc18c \uac04\uc758 \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud558\ub294 \ub370\uc5d0\ub3c4 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. EKS \ud074\ub7ec\uc2a4\ud130 (\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804 1.14-eks.3 \uc774\uc0c1)\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uba74 \ud074\ub7ec\uc2a4\ud130 \ubcf4\uc548 \uadf8\ub8f9\uc774 \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ub429\ub2c8\ub2e4. \uc774 \ubcf4\uc548 \uadf8\ub8f9\uc740 EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc758 \ub178\ub4dc \uac04\uc758 \uc790\uc720\ub85c\uc6b4 \ud1b5\uc2e0\uc744 \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ub2e8\uc21c\ud654\ub97c \uc704\ud574 \ube44\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc744 \ud3ec\ud568\ud55c \ubaa8\ub4e0 \ub178\ub4dc \uadf8\ub8f9\uc5d0 \ud074\ub7ec\uc2a4\ud130 SG\ub97c \ucd94\uac00\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc84\uc804 1.14 \ubc0f EKS \ubc84\uc804 eks.3 \uc774\uc804\uc5d0\ub294 EKS \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ubc0f \ub178\ub4dc \uadf8\ub8f9\uc5d0 \ub300\ud574 \ubcc4\ub3c4\uc758 \ubcf4\uc548 \uadf8\ub8f9\uc774 \uad6c\uc131\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ubc0f \ub178\ub4dc \uadf8\ub8f9 \ubcf4\uc548 \uadf8\ub8f9\uc5d0 \ub300\ud55c \ucd5c\uc18c \ubc0f \uad8c\uc7a5 \uaddc\uce59\uc740 AWS \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ubcf4\uc548 \uadf8\ub8f9 \uc758 \ucd5c\uc18c \uaddc\uce59\uc5d0 \ub530\ub77c \uc6cc\ucee4 \ub178\ub4dc \ubcf4\uc548\uadf8\ub8f9\uc5d0\uc11c \ud3ec\ud2b8 443\uc744 \uc778\ubc14\uc6b4\ub4dc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uaddc\uce59\uc740 kubelets\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\uc640 \ud1b5\uc2e0\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uaddc\uce59\uc785\ub2c8\ub2e4. \ub610\ud55c \uc6cc\ucee4 \ub178\ub4dc \ubcf4\uc548\uadf8\ub8f9\ub85c\uc758 \uc544\uc6c3\ubc14\uc6b4\ub4dc \ud2b8\ub798\ud53d\uc744 \uc704\ud55c \ud3ec\ud2b8 10250\ub3c4 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. 10250\uc740 kubelet\uc774 \uc218\uc2e0\ud558\ub294 \ud3ec\ud2b8\uc785\ub2c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c \ucd5c\uc18c \ub178\ub4dc \uadf8\ub8f9 \uaddc\uce59\uc740 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ubcf4\uc548\uadf8\ub8f9\uc5d0\uc11c \ud3ec\ud2b8 10250\uc744 \uc778\ubc14\uc6b4\ub4dc\ud558\uace0 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \ubcf4\uc548\uadf8\ub8f9\ub85c \uc544\uc6c3\ubc14\uc6b4\ub4dc\ud558\ub294 443\uc744 \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ub9c8\uc9c0\ub9c9\uc73c\ub85c \ub178\ub4dc \uadf8\ub8f9 \ub0b4 \ub178\ub4dc \uac04\uc758 \uc790\uc720\ub85c\uc6b4 \ud1b5\uc2e0\uc744 \ud5c8\uc6a9\ud558\ub294 \uaddc\uce59\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc11c\ube44\uc2a4\uc640 RDS \ub370\uc774\ud130\ubca0\uc774\uc2a4\uc640 \uac19\uc774 \ud074\ub7ec\uc2a4\ud130 \uc678\ubd80\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc11c\ube44\uc2a4 \uac04\uc758 \ud1b5\uc2e0\uc744 \uc81c\uc5b4\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uace0\ub824\ud574 \ubcf4\uc138\uc694. \ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\uba74 \ud30c\ub4dc \uceec\ub809\uc158\uc5d0 \uae30\uc874 \ubcf4\uc548 \uadf8\ub8f9\uc744 \ud560\ub2f9\ud560 \uc218 \uc788\ub2e4.</p> <p>Warning</p> <p>\ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\uae30 \uc804\uc5d0 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ubcf4\uc548 \uadf8\ub8f9\uc744 \ucc38\uc870\ud558\ub294 \uacbd\uc6b0, \ud30c\ub4dc\ub294 \uc2a4\ucf00\uc904\ub9c1\ub418\uc9c0 \uc54a\ub294\ub2e4.</p> <p><code>SecurityGroupPolicy</code> \uac1d\uccb4\ub97c \uc0dd\uc131\ud558\uace0 <code>PodSelector</code> \ub610\ub294 <code>ServiceAccountSelector</code>\ub97c \uc9c0\uc815\ud558\uc5ec \uc5b4\ub5a4 \ud30c\ub4dc\ub97c \ubcf4\uc548 \uadf8\ub8f9\uc5d0 \ud560\ub2f9\ud560\uc9c0 \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc140\ub809\ud130\ub97c <code>{}</code>\ub85c \uc124\uc815\ud558\uba74 <code>SecurityGroupPolicy</code>\uc5d0\uc11c \ucc38\uc870\ud558\ub294 \ubcf4\uc548\uadf8\ub8f9\uc774 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ubaa8\ub4e0 \ud30c\ub4dc \ub610\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ubaa8\ub4e0 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc5d0 \ud560\ub2f9\ub429\ub2c8\ub2e4. \ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uad6c\ud604\ud558\uae30 \uc804\uc5d0 \uace0\ub824 \uc0ac\ud56d\uc744 \ubaa8\ub450 \uc219\uc9c0\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc911\uc694</p> <p>\ud30c\ub4dc\uc5d0 \ubcf4\uc548\uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ud074\ub7ec\uc2a4\ud130 \ubcf4\uc548 \uadf8\ub8f9\uc5d0 \ud3ec\ud2b8 53\uc774 \uc544\uc6c3\ubc14\uc6b4\ub4dc\ub418\ub3c4\ub85d \ud5c8\uc6a9\ud558\ub294 \ubcf4\uc548\uadf8\ub8f9\uc744 \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c, \ud30c\ub4dc \ubcf4\uc548 \uadf8\ub8f9\uc758 \ud3ec\ud2b8 53 \uc778\ubc14\uc6b4\ub4dc \ud2b8\ub798\ud53d\uc744 \ud5c8\uc6a9\ud558\ub3c4\ub85d \ud074\ub7ec\uc2a4\ud130 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc5c5\ub370\uc774\ud2b8\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc911\uc694</p> <p>\ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud560 \ub54c\uc5d0\ub3c4 \ubcf4\uc548 \uadf8\ub8f9 \uc81c\ud55c\uc0ac\ud56d\uc774 \uc5ec\uc804\ud788 \uc801\uc6a9\ub418\ubbc0\ub85c \uc2e0\uc911\ud558\uac8c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc911\uc694</p> <p>\ud30c\ub4dc\uc5d0 \uad6c\uc131\ub41c \ubaa8\ub4e0 \ud504\ub85c\ube0c\uc5d0 \ub300\ud574 \ud074\ub7ec\uc2a4\ud130 \ubcf4\uc548 \uadf8\ub8f9 (kubelet)\uc758 \uc778\ubc14\uc6b4\ub4dc \ud2b8\ub798\ud53d\uc5d0 \ub300\ud55c \uaddc\uce59\uc744 \ud544\uc218 \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc911\uc694</p> <p>\ud30c\ub4dc\uc758 \ubcf4\uc548 \uadf8\ub8f9\uc740 EC2 \uc778\uc2a4\ud134\uc2a4\uc758 \uc5ec\ub7ec \uac1c\uc758 ENI\ub97c \ud560\ub2f9 \ud558\uae30 \uc704\ud574 ENI \ud2b8\ub801\ud0b9 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \ubcf4\uc548\uadf8\ub8f9\uc5d0 \ud560\ub2f9\ub418\uba74 VPC \ucee8\ud2b8\ub864\ub7ec\ub294 \ub178\ub4dc \uadf8\ub8f9\uc758 \ube0c\ub79c\uce58 ENI\ub97c \ud30c\ub4dc\uc640 \uc5f0\uacb0\ud569\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \uc608\uc57d\ub420 \ub54c \ub178\ub4dc\uadf8\ub8f9\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ube0c\ub79c\uce58 ENI\uac00 \ucda9\ubd84\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \ud30c\ub4dc\ub294 \ubcf4\ub958 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ub429\ub2c8\ub2e4. \uc778\uc2a4\ud134\uc2a4\uac00 \uc9c0\uc6d0\ud560 \uc218 \uc788\ub294 \ube0c\ub79c\uce58 ENI\uc758 \uc218\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615/\ud328\ubc00\ub9ac\uc5d0 \ub530\ub77c \ub2e4\ub985\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 AWS \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>\ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\uc740 \uc815\ucc45 \ub370\ubaac\uc758 \uc624\ubc84\ud5e4\ub4dc \uc5c6\uc774 \ud074\ub7ec\uc2a4\ud130 \ub0b4\ubd80 \ubc0f \uc678\ubd80\uc758 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud560 \uc218 \uc788\ub294 AWS \ub124\uc774\ud2f0\ube0c \ubc29\ubc95\uc744 \uc81c\uacf5\ud558\uc9c0\ub9cc \ub2e4\ub978 \uc635\uc158\ub3c4 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 Cilium \uc815\ucc45 \uc5d4\uc9c4\uc744 \uc0ac\uc6a9\ud558\uba74 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc5d0\uc11c DNS \uc774\ub984\uc744 \ucc38\uc870\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Calico Enterprise\uc5d0\ub294 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 AWS \ubcf4\uc548 \uadf8\ub8f9\uc5d0 \ub9e4\ud551\ud558\ub294 \uc635\uc158\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. Istio\uc640 \uac19\uc740 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uad6c\ud604\ud55c \uacbd\uc6b0, \uc774\uadf8\ub808\uc2a4 \uac8c\uc774\ud2b8\uc6e8\uc774\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc1a1\uc2e0\uc744 \uac80\uc99d\ub41c \ud2b9\uc815 \ub3c4\uba54\uc778 \ub610\ub294 IP \uc8fc\uc18c\ub85c \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc635\uc158\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Istio\uc758 \uc774\uadf8\ub808\uc2a4 \ud2b8\ub798\ud53d \uc81c\uc5b4\uc5d0 \ub300\ud55c 3\ubd80\uc791 \uc2dc\ub9ac\uc988\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/network/#_11","title":"\uc5b8\uc81c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc \ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud574\uc57c \ud560\uae4c\uc694?","text":""},{"location":"ko/security/docs/network/#_12","title":"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0","text":"<ul> <li>\ud30c\ub4dc-\ud30c\ub4dc \uac04 \ud2b8\ub798\ud53d \uc81c\uc5b4</li> <li>\ud074\ub7ec\uc2a4\ud130 \ub0b4 \ud30c\ub4dc \uac04 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d(\uc774\uc2a4\ud2b8-\uc6e8\uc2a4\ud2b8 \ud2b8\ub798\ud53d) \uc81c\uc5b4\uc5d0 \uc801\ud569</li> <li>IP \uc8fc\uc18c \ub610\ub294 \ud3ec\ud2b8 \uc218\uc900\uc5d0\uc11c \ud2b8\ub798\ud53d \uc81c\uc5b4 (OSI \uacc4\uce35 3 \ub610\ub294 4)</li> </ul>"},{"location":"ko/security/docs/network/#aws-sgp","title":"\ud30c\ub4dc\uc6a9 AWS \ubcf4\uc548 \uadf8\ub8f9(SGP) \uc744 \uc0ac\uc6a9\ud574\uc57c \ud558\ub294 \uacbd\uc6b0","text":"<ul> <li>\uae30\uc874 AWS \uad6c\uc131 \ud65c\uc6a9</li> <li>AWS \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uad00\ub9ac\ud558\ub294 \ubcf5\uc7a1\ud55c EC2 \ubcf4\uc548 \uadf8\ub8f9\uc774 \uc774\ubbf8 \uc788\uace0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c EKS\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\ub294 \uacbd\uc6b0 SGP\ub294 \ubcf4\uc548 \uadf8\ub8f9 \ub9ac\uc18c\uc2a4\ub97c \uc7ac\uc0ac\uc6a9\ud558\uace0 \uc774\ub97c \ud30c\ub4dc\uc5d0 \uc801\uc6a9\ud560 \uc218 \uc788\ub294 \ub9e4\uc6b0 \uc88b\uc740 \uc120\ud0dd\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>AWS \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc811\uadfc \uc81c\uc5b4</li> <li>EKS \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ub2e4\ub978 AWS \uc11c\ube44\uc2a4(RDS \ub370\uc774\ud130\ubca0\uc774\uc2a4)\uc640 \ud1b5\uc2e0\ud558\ub824\ub294 \uacbd\uc6b0 SGP\ub97c \ud6a8\uc728\uc801\uc778 \uba54\ucee4\ub2c8\uc998\uc73c\ub85c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\uc5d0\uc11c AWS \uc11c\ube44\uc2a4\ub85c\uc758 \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud569\ub2c8\ub2e4.</li> <li>\ud30c\ub4dc \ubc0f \ub178\ub4dc \ud2b8\ub798\ud53d \uaca9\ub9ac</li> <li>\ud30c\ub4dc \ud2b8\ub798\ud53d\uc744 \ub098\uba38\uc9c0 \ub178\ub4dc \ud2b8\ub798\ud53d\uacfc \uc644\uc804\ud788 \ubd84\ub9ac\ud558\ub824\uba74 <code>POD_SECURITY_GROUP_ENFORCING_MODE=strict</code> \ubaa8\ub4dc\uc5d0\uc11c SGP\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.</li> </ul>"},{"location":"ko/security/docs/network/#_13","title":"<code>\ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9</code> \ubc0f <code>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45</code> \ubaa8\ubc94 \uc0ac\ub840","text":"<ul> <li>\ub808\uc774\uc5b4\ubcc4 \ubcf4\uc548</li> <li>\uacc4\uce35\ud654\ub41c \ubcf4\uc548 \uc811\uadfc \ubc29\uc2dd\uc744 \uc704\ud574 SGP\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \ud568\uaed8 \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624.</li> <li>SGP\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc18d\ud558\uc9c0 \uc54a\uc740 AWS \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \ub124\ud2b8\uc6cc\ud06c \uc218\uc900 \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud558\ub294 \ubc18\uba74, \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ud074\ub7ec\uc2a4\ud130 \ub0b4 \ud30c\ub4dc \uac04 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d\uc744 \uc81c\ud55c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\ucd5c\uc18c \uad8c\ud55c \uc6d0\uce59</li> <li>\ud30c\ub4dc \ub610\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uac04\uc5d0 \ud544\uc694\ud55c \ud2b8\ub798\ud53d\ub9cc \ud5c8\uc6a9</li> <li>\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uaca9\ub9ac</li> <li>\uac00\ub2a5\ud55c \uacbd\uc6b0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc5d0 \ub530\ub77c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uad6c\ubd84\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc190\uc0c1\ub41c \uacbd\uc6b0 \uce68\ud574 \ubc94\uc704\ub97c \uc904\uc774\uc2ed\uc2dc\uc624.</li> <li>\uc815\ucc45\uc744 \ub2e8\uc21c\ud558\uace0 \uba85\ud655\ud558\uac8c \uc720\uc9c0</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \ub9e4\uc6b0 \uc138\ubc00\ud558\uace0 \ubcf5\uc7a1\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \uc798\ubabb\ub41c \uad6c\uc131\uc758 \uc704\ud5d8\uc744 \uc904\uc774\uace0 \uad00\ub9ac \uc624\ubc84\ud5e4\ub4dc\ub97c \uc904\uc774\ub824\uba74 \uac00\ub2a5\ud55c \ud55c \ub2e8\uc21c\ud558\uac8c \uc720\uc9c0\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4.</li> <li>\uacf5\uaca9 \ubc94\uc704 \ucd95\uc18c</li> <li>\uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub178\ucd9c\uc744 \uc81c\ud55c\ud558\uc5ec \uacf5\uaca9 \ud45c\uba74\uc744 \ucd5c\uc18c\ud654\ud569\ub2c8\ub2e4.</li> </ul> <p>Caution</p> <p>\ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\uc740 <code>strict</code>\uacfc <code>standard</code>\uc774\ub77c\ub294 \ub450 \uac00\uc9c0 \uc801\uc6a9 \ubaa8\ub4dc\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. EKS \ud074\ub7ec\uc2a4\ud130\uc758 \ud30c\ub4dc \uae30\ub2a5\uc5d0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc \ubcf4\uc548 \uadf8\ub8f9\uc744 \ubaa8\ub450 \uc0ac\uc6a9\ud560 \ub54c\ub294 <code>standard</code> \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548\uacfc \uad00\ub828\ud574\uc11c\ub294 \uacc4\uce35\ud654\ub41c \uc811\uadfc \ubc29\uc2dd\uc774 \uac00\uc7a5 \ud6a8\uacfc\uc801\uc778 \uc194\ub8e8\uc158\uc778 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc SGP\ub97c \ud568\uaed8 \uc0ac\uc6a9\ud558\uba74 EKS\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc704\ud55c \uac15\ub825\ud55c \uc2ec\uce35 \ubc29\uc5b4 \uc804\ub7b5\uc744 \uc81c\uacf5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_14","title":"\uc11c\ube44\uc2a4 \uba54\uc2dc \uc815\ucc45 \uc801\uc6a9 \ub610\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45","text":"<p>'\uc11c\ube44\uc2a4 \uba54\uc2dc'\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \ucd94\uac00\ud560 \uc218 \uc788\ub294 \uc804\uc6a9 \uc778\ud504\ub77c \uacc4\uce35\uc785\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uac00\uc2dc\uc131, \ud2b8\ub798\ud53d \uad00\ub9ac, \ubcf4\uc548 \ub4f1\uc758 \uae30\ub2a5\uc744 \uc790\uccb4 \ucf54\ub4dc\uc5d0 \ucd94\uac00\ud558\uc9c0 \uc54a\uace0\ub3c4 \ud22c\uba85\ud558\uac8c \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc11c\ube44\uc2a4 \uba54\uc2dc\ub294 OSI \ubaa8\ub378\uc758 \uacc4\uce35 7 (\uc560\ud50c\ub9ac\ucf00\uc774\uc158) \uc5d0\uc11c \uc815\ucc45\uc744 \uc801\uc6a9\ud558\ub294 \ubc18\uba74, \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \uacc4\uce35 3 (\ub124\ud2b8\uc6cc\ud06c) \ubc0f \uacc4\uce35 4 (\uc804\uc1a1) \uc5d0\uc11c \uc791\ub3d9\ud569\ub2c8\ub2e4.\uc774 \ubd84\uc57c\uc5d0\ub294 AWS AppMesh, Istio, Linkerd \ub4f1\uacfc \uac19\uc740 \ub2e4\uc591\ud55c \uc81c\ud488\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_15","title":"\uc815\ucc45 \uc2dc\ud589\uc5d0 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0","text":"<ul> <li>\uc11c\ube44\uc2a4 \uba54\uc26c\uac00 \uad6c\uc131\ub418\uc5b4 \uc788\ub294 \uacbd\uc6b0</li> <li>\ud2b8\ub798\ud53d \uad00\ub9ac, \uc635\uc800\ubc84\ube4c\ub9ac\ud2f0 \ubc0f \ubcf4\uc548\uacfc \uac19\uc740 \uace0\uae09 \uae30\ub2a5\uc774 \ud544\uc694\ud55c \uacbd\uc6b0</li> <li>\ud2b8\ub798\ud53d \uc81c\uc5b4, \ub85c\ub4dc \ubc38\ub7f0\uc2f1, \uc11c\ud0b7 \ube0c\ub808\uc774\ud0b9, \uc18d\ub3c4 \uc81c\ud55c, \ud0c0\uc784\uc544\uc6c3 \ub4f1</li> <li>\uc11c\ube44\uc2a4\uac00 \uc798 \ub3d9\uc791\ud558\ub294\uc9c0\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \uc778\uc0ac\uc774\ud2b8 (\ub808\uc774\ud134\uc2dc, \uc624\ub958\uc728, \ucd08\ub2f9 \uc694\uccad \uc218, \uc694\uccad\ub7c9 \ub4f1)</li> <li>mTLS\uacfc \uac19\uc740 \ubcf4\uc548 \uae30\ub2a5\uc744 \uc704\ud574 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uad6c\ud604\ud558\uace0 \ud65c\uc6a9\ud558\uace0\uc790 \ud569\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/network/#_16","title":"\ub354 \uac04\ub2e8\ud55c \uc0ac\uc6a9 \uc0ac\ub840\ub97c \uc704\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc120\ud0dd\ud558\uc138\uc694","text":"<ul> <li>\uc11c\ub85c \ud1b5\uc2e0\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc\ub97c \uc81c\ud55c\ud558\uc138\uc694.</li> <li>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc740 \uc11c\ube44\uc2a4 \uba54\uc2dc\ubcf4\ub2e4 \ud544\uc694\ud55c \ub9ac\uc18c\uc2a4\uac00 \uc801\uae30 \ub54c\ubb38\uc5d0 \ub2e8\uc21c\ud55c \uc0ac\uc6a9 \uc0ac\ub840\ub098 \uc11c\ube44\uc2a4 \uba54\uc2dc\uc758 \uc2e4\ud589 \ubc0f \uad00\ub9ac \uc624\ubc84\ud5e4\ub4dc\uac00 \uc815\ub2f9\ud558\uc9c0 \uc54a\uc744 \uc218 \uc788\ub294 \uc18c\uaddc\ubaa8 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc801\ud569\ud569\ub2c8\ub2e4.</li> </ul> <p>Tip</p> <p>\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uacfc \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \ud568\uaed8 \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc \uac04\uc5d0 \uae30\ubcf8 \uc218\uc900\uc758 \ubcf4\uc548 \ubc0f \uaca9\ub9ac\ub97c \uc81c\uacf5\ud55c \ub2e4\uc74c \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud2b8\ub798\ud53d \uad00\ub9ac, \uad00\ucc30 \uac00\ub2a5\uc131 \ubc0f \ubcf4\uc548\uacfc \uac19\uc740 \ucd94\uac00 \uae30\ub2a5\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_17","title":"\uc11c\ub4dc\ud30c\ud2f0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc5d4\uc9c4","text":"<p>\uae00\ub85c\ubc8c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45, DNS \ud638\uc2a4\ud2b8 \uc774\ub984 \uae30\ubc18 \uaddc\uce59 \uc9c0\uc6d0, \uacc4\uce35 7 \uaddc\uce59, \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \uae30\ubc18 \uaddc\uce59, \uba85\uc2dc\uc801 \uac70\ubd80/\ub85c\uadf8 \uc791\uc5c5 \ub4f1\uacfc \uac19\uc740 \uace0\uae09 \uc815\ucc45 \uc694\uad6c \uc0ac\ud56d\uc774 \uc788\ub294 \uacbd\uc6b0 \ud0c0\uc0ac \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc5d4\uc9c4\uc744 \uace0\ub824\ud574 \ubcf4\uc2ed\uc2dc\uc624. Calico\ub294 EKS\uc640 \uc798 \uc791\ub3d9\ud558\ub294 Tigera\uc758 \uc624\ud508 \uc18c\uc2a4 \uc815\ucc45 \uc5d4\uc9c4\uc785\ub2c8\ub2e4. Calico\ub294 Kubernetes \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uae30\ub2a5 \uc804\uccb4\ub97c \uad6c\ud604\ud558\ub294 \uac83 \uc678\uc5d0\ub3c4 Istio\uc640 \ud1b5\ud569\ub420 \uacbd\uc6b0 \uacc4\uce35 7 \uaddc\uce59 (\uc608: HTTP)\uc5d0 \ub300\ud55c \uc9c0\uc6d0\uc744 \ud3ec\ud568\ud558\uc5ec \ub354 \ub2e4\uc591\ud55c \uae30\ub2a5\uc744 \uac16\ucd98 \ud655\uc7a5 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc9c0\uc6d0\ud569\ub2c8\ub2e4. Calico \uc815\ucc45\uc758 \ubc94\uc704\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4, \ud30c\ub4dc, \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ub610\ub294 \uc804 \uc138\uacc4\ub85c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc815\ucc45 \ubc94\uc704\ub97c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc73c\ub85c \uc9c0\uc815\ud558\uba74 \uc218\uc2e0/\uc1a1\uc2e0 \uaddc\uce59 \uc9d1\ud569\uc774 \ud574\ub2f9 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uacfc \uc5f0\uacb0\ub429\ub2c8\ub2e4. \uc801\uc808\ud55c RBAC \uaddc\uce59\uc744 \uc801\uc6a9\ud558\uba74 \ud300\uc5d0\uc11c \uc774\ub7f0 \uaddc\uce59\uc744 \uc7ac\uc815\uc758\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uc5ec IT \ubcf4\uc548 \uc804\ubb38\uac00\uac00 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uad00\ub9ac\ub97c \uc548\uc804\ud558\uac8c \uc704\uc784\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c Cilium\uc758 \uad00\ub9ac\uc790\ub4e4\ub3c4 HTTP\uc640 \uac19\uc740 \uacc4\uce35 7 \uaddc\uce59\uc5d0 \ub300\ud55c \ubd80\ubd84\uc801 \uc9c0\uc6d0\uc744 \ud3ec\ud568\ud558\ub3c4\ub85d \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \ud655\uc7a5\ud588\uc2b5\ub2c8\ub2e4. \ub610\ud55c Cilium\uc740 DNS \ud638\uc2a4\ud2b8 \uc774\ub984\uc744 \uc9c0\uc6d0\ud558\ub294\ub370, \uc774\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc11c\ube44\uc2a4/\ud30c\ub4dc\uc640 VPC \ub0b4\ubd80 \ub610\ub294 \uc678\ubd80\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ub9ac\uc18c\uc2a4 \uac04\uc758 \ud2b8\ub798\ud53d\uc744 \uc81c\ud55c\ud558\ub294 \ub370 \uc720\uc6a9\ud560 \uc218 \uc788\ub2e4. \ubc18\ub300\ub85c Calico Enterprise\uc5d0\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 AWS \ubcf4\uc548 \uadf8\ub8f9\uacfc DNS \ud638\uc2a4\ud2b8 \uc774\ub984\uc5d0 \ub9e4\ud551\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774 Github \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c \uc77c\ubc18\uc801\uc778 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ubaa9\ub85d\uc744 \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Calico\uc5d0 \ub300\ud55c \uc720\uc0ac\ud55c \uaddc\uce59 \uc138\ud2b8\ub294 Calico \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#amazon-vpc-cni","title":"Amazon VPC CNI \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc5d4\uc9c4\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158","text":"<p>\uc77c\uad00\uc131\uc744 \uc720\uc9c0\ud558\uace0 \uc608\uc0c1\uce58 \ubabb\ud55c \ud30c\ub4dc \ud1b5\uc2e0 \ub3d9\uc791\uc744 \ubc29\uc9c0\ud558\ub824\uba74 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc5d4\uc9c4\uc744 \ud558\ub098\ub9cc \ubc30\ud3ec\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. 3P\uc5d0\uc11c VPC CNI \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc5d4\uc9c4\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\ub824\ub294 \uacbd\uc6b0 VPC CNI \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc9c0\uc6d0\uc744 \ud65c\uc131\ud654\ud558\uae30 \uc804\uc5d0 \uae30\uc874 3P \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 CRD\ub97c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ub9ac\uc18c\uc2a4\ub85c \ubcc0\ud658\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub610\ud55c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ub41c \uc815\ucc45\uc744 \ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0 \uc801\uc6a9\ud558\uae30 \uc804\uc5d0 \ubcc4\ub3c4\uc758 \ud14c\uc2a4\ud2b8 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ud14c\uc2a4\ud2b8\ud558\uc138\uc694. \uc774\ub97c \ud1b5\ud574 \ud30c\ub4dc \ud1b5\uc2e0 \ub3d9\uc791\uc758 \uc7a0\uc7ac\uc801 \ubb38\uc81c\ub098 \ubd88\uc77c\uce58\ub97c \uc2dd\ubcc4\ud558\uace0 \ud574\uacb0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_18","title":"\ub9c8\uc774\uadf8\ub808\uc774\uc158 \ub3c4\uad6c","text":"<p>\ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud504\ub85c\uc138\uc2a4\ub97c \uc9c0\uc6d0\ud558\uae30 \uc704\ud574 \uae30\uc874 Calico/Cilium \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 CRD\ub97c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\uc774\ud2f0\ube0c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc73c\ub85c \ubcc0\ud658\ud558\ub294 K8s Network Policy Migrator \ub3c4\uad6c\ub97c \uac1c\ubc1c\ud588\uc2b5\ub2c8\ub2e4. \ubcc0\ud658 \ud6c4\uc5d0\ub294 VPC CNI \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc2e4\ud589\ud558\ub294 \uc0c8 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \ubcc0\ud658\ub41c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc9c1\uc811 \ud14c\uc2a4\ud2b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ub3c4\uad6c\ub294 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud504\ub85c\uc138\uc2a4\ub97c \uac04\uc18c\ud654\ud558\uace0 \uc6d0\ud65c\ud55c \uc804\ud658\uc744 \ubcf4\uc7a5\ud558\ub3c4\ub85d \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <p>\uc911\uc694</p> <p>\ub9c8\uc774\uadf8\ub808\uc774\uc158 \ub3c4\uad6c\ub294 \ub124\uc774\ud2f0\ube0c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 API\uc640 \ud638\ud658\ub418\ub294 \uc11c\ub4dc\ud30c\ud2f0 \uc815\ucc45\ub9cc \ubcc0\ud658\ud569\ub2c8\ub2e4. \uc11c\ub4dc\ud30c\ud2f0 \ud50c\ub7ec\uadf8\uc778\uc774 \uc81c\uacf5\ud558\ub294 \uace0\uae09 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ub3c4\uad6c\ub294 \ud574\ub2f9 \uae30\ub2a5\uc744 \uac74\ub108\ub6f0\uace0 \ubcf4\uace0\ud569\ub2c8\ub2e4.</p> <p>\ucc38\uace0\ub85c, \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ub3c4\uad6c\ub294 \ud604\uc7ac AWS VPC CNI \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1 \ud300\uc5d0\uc11c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc73c\uba70, \uace0\uac1d\uc774 \ucd5c\uc120\uc758 \ub178\ub825\uc744 \uae30\uc6b8\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ub9cc\ub4e4\uc5b4\uc84c\uc2b5\ub2c8\ub2e4. \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud504\ub85c\uc138\uc2a4\ub97c \uc6d0\ud65c\ud558\uac8c \uc9c4\ud589\ud558\ub824\uba74 \uc774 \ub3c4\uad6c\ub97c \ud65c\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ub3c4\uad6c\uc5d0\uc11c \ubb38\uc81c\ub098 \ubc84\uadf8\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0 Github \uc774\uc288\ub97c \uc0dd\uc131\ud574 \uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4. \uc5ec\ub7ec\ubd84\uc758 \ud53c\ub4dc\ubc31\uc740 \uc6b0\ub9ac\uc5d0\uac8c \ub9e4\uc6b0 \uc18c\uc911\ud558\uba70 \uc11c\ube44\uc2a4\ub97c \uc9c0\uc18d\uc801\uc73c\ub85c \uac1c\uc120\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_19","title":"\ucd94\uac00 \ub9ac\uc18c\uc2a4","text":"<ul> <li>Kubernetes &amp; Tigera: \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45, \ubcf4\uc548 \ubc0f \uac10\uc0ac</li> <li>Calico Enterprise</li> <li>Cilium</li> <li>NetworkPolicy Editor Cilium\uc758 \ub300\ud654\ud615 \uc815\ucc45 \ud3b8\uc9d1\uc790</li> <li>Inspektor Gadget advise network-policy gadget\ub294 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d \ubd84\uc11d\uc744 \uae30\ubc18\uc73c\ub85c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc81c\uc548\ud569\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/network/#_20","title":"\uc804\uc1a1 \uc554\ud638\ud654","text":"<p>PCI, HIPAA \ub610\ub294 \uae30\ud0c0 \uaddc\uc815\uc744 \uc900\uc218\ud574\uc57c \ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc740 \uc804\uc1a1 \uc911\uc5d0 \ub370\uc774\ud130\ub97c \uc554\ud638\ud654\ud574\uc57c \ud569\ub2c8\ub2e4. \uc624\ub298\ub0a0 TLS\ub294 \uc720\uc120 \ud2b8\ub798\ud53d\uc744 \uc554\ud638\ud654\ud558\uae30 \uc704\ud55c \uc0ac\uc2e4\uc0c1 \ud45c\uc900 \ubc29\uc2dd\uc785\ub2c8\ub2e4. TLS\ub294 \uc774\uc804 SSL\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c \uc554\ud638\ud654 \ud504\ub85c\ud1a0\ucf5c\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c\ub97c \ud1b5\ud574 \ubcf4\uc548 \ud1b5\uc2e0\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. TLS\ub294 \uc138\uc158 \uc2dc\uc791 \uc2dc \ud611\uc0c1\ub418\ub294 \uacf5\uc720 \uc554\ud638\ub97c \uae30\ubc18\uc73c\ub85c \ub370\uc774\ud130\ub97c \uc554\ud638\ud654\ud558\ub294 \ud0a4\ub97c \uc0dd\uc131\ud558\ub294 \ub300\uce6d \uc554\ud638\ud654\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ub2e4\uc74c\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud658\uacbd\uc5d0\uc11c \ub370\uc774\ud130\ub97c \uc554\ud638\ud654\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \ubc29\ubc95\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#nitro","title":"Nitro \uc778\uc2a4\ud134\uc2a4","text":"<p>\ub2e4\uc74c Nitro \uc778\uc2a4\ud134\uc2a4 \uc720\ud615 (\uc608: C5n, G4, I3en, M5dn, M5n, P3dn, R5dn, R5n)\uac04\uc5d0 \uad50\ud658\ub418\ub294 \ud2b8\ub798\ud53d\uc740 \uae30\ubcf8\uc801\uc73c\ub85c \uc790\ub3d9 \uc554\ud638\ud654\ub429\ub2c8\ub2e4. Transit Gateway \ub610\ub294 \ub85c\ub4dc\ubc38\ub7f0\uc11c\uc640 \uac19\uc774 \uc911\uac04 \ud649\uc774 \uc788\ub294 \uacbd\uc6b0 \ud2b8\ub798\ud53d\uc740 \uc554\ud638\ud654\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc804\uc1a1 \uc911 \uc554\ud638\ud654\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uacfc \uae30\ubcf8\uc801\uc73c\ub85c \ub124\ud2b8\uc6cc\ud06c \uc554\ud638\ud654\ub97c \uc9c0\uc6d0\ud558\ub294 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc758 \uc804\uccb4 \ubaa9\ub85d\uc740 \uc804\uc1a1 \uc554\ud638\ud654 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/network/#cni","title":"\ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4(CNI)","text":"<p>WeAvenet\uc740 \uc2ac\ub9ac\ube0c \ud2b8\ub798\ud53d(\ub354 \ub290\ub9b0 \ud328\ud0b7 \ud3ec\uc6cc\ub529 \uc811\uadfc \ubc29\uc2dd)\uc5d0\ub294 NaCL \uc554\ud638\ud654\ub97c \uc0ac\uc6a9\ud558\uace0 \ube60\ub978 \ub370\uc774\ud130 \uacbd\ub85c \ud2b8\ub798\ud53d\uc5d0\ub294 IPsec ESP\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubaa8\ub4e0 \ud2b8\ub798\ud53d\uc744 \uc790\ub3d9\uc73c\ub85c \uc554\ud638\ud654\ud558\ub3c4\ub85d \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#_21","title":"\uc11c\ube44\uc2a4 \uba54\uc2dc","text":"<p>\uc804\uc1a1 \uc911 \uc554\ud638\ud654\ub294 AppMesh, Linkerd v2 \ubc0f Istio\uc640 \uac19\uc740 \uc11c\ube44\uc2a4 \uba54\uc2dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad6c\ud604\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. AppMesh\ub294 X.509 \uc778\uc99d\uc11c \ub610\ub294 Envoy\uc758 \ube44\ubc00 \uac80\uc0c9 \uc11c\ube44\uc2a4(SDS)\ub97c \uc0ac\uc6a9\ud558\ub294 mTLS\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. Linkerd\uc640 Istio \ubaa8\ub450 mTLS\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4.</p> <p>aws-app-mesh-examples GitHub \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\ub294 X.509 \uc778\uc99d\uc11c \ubc0f SPIRE\ub97c Envoy \ucee8\ud14c\uc774\ub108\uc640 \ud568\uaed8 SDS \uacf5\uae09\uc790\ub85c \uc0ac\uc6a9\ud558\uc5ec MTL\uc744 \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4:</p> <ul> <li>X.509 \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud558\uc5ec mTLS \uad6c\uc131</li> <li>SPIRE (SDS) \ub97c \uc0ac\uc6a9\ud558\uc5ec TLS \uad6c\uc131</li> </ul> <p>\ub610\ud55c App Mesh\ub294 AWS Certificate Manager(ACM)\uc5d0\uc11c \ubc1c\uae09\ud55c \uc0ac\uc124 \uc778\uc99d\uc11c \ub610\ub294 \uac00\uc0c1 \ub178\ub4dc\uc758 \ub85c\uceec \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0 \uc800\uc7a5\ub41c \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud558\uc5ec TLS \uc554\ud638\ud654\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4.</p> <ul> <li>aws-app-mesh-examples GitHub \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\ub294 ACM\uc5d0\uc11c \ubc1c\uae09\ud55c \uc778\uc99d\uc11c \ubc0f Envoy \ucee8\ud14c\uc774\ub108\uc640 \ud568\uaed8 \ud328\ud0a4\uc9d5\ub41c \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud558\uc5ec TLS\ub97c \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uc744 \uc548\ub0b4\ud569\ub2c8\ub2e4:</li> <li>\ud30c\uc77c \uc81c\uacf5 TLS \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud558\uc5ec TLS \uad6c\uc131</li> <li>AWS Certificate Manager\ub97c \uc0ac\uc6a9\ud558\uc5ec TLS \uad6c\uc131</li> </ul>"},{"location":"ko/security/docs/network/#_22","title":"\uc778\uadf8\ub808\uc2a4 \ucee8\ud2b8\ub864\ub7ec \ubc0f \ub85c\ub4dc\ubc38\ub7f0\uc11c","text":"<p>\uc778\uadf8\ub808\uc2a4 \ucee8\ud2b8\ub864\ub7ec\ub294 \ud074\ub7ec\uc2a4\ud130 \uc678\ubd80\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 HTTP/S \ud2b8\ub798\ud53d\uc744 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc11c\ube44\uc2a4\ub85c \uc9c0\ub2a5\uc801\uc73c\ub85c \ub77c\uc6b0\ud305\ud558\ub294 \ubc29\ubc95\uc785\ub2c8\ub2e4. \uc774\ub7f0 \uc778\uadf8\ub808\uc2a4 \uc55e\uc5d0 CLB(Classic Load Balancer) \ub610\ub294 NLB(Network Load Balancer)\uc640 \uac19\uc740 \ub808\uc774\uc5b4 4 \ub85c\ub4dc\ubc38\ub7f0\uc11c\uac00 \uc788\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc2b5\ub2c8\ub2e4. \uc554\ud638\ud654\ub41c \ud2b8\ub798\ud53d\uc740 \ub124\ud2b8\uc6cc\ud06c \ub0b4 \uc5ec\ub7ec \uc704\uce58 (\uc608: \ub85c\ub4dc\ubc38\ub7f0\uc11c, \uc778\uadf8\ub808\uc2a4 \ub9ac\uc18c\uc2a4, \ud30c\ub4dc) \uc5d0\uc11c \uc885\ub8cc\ub420 \uc218 \uc788\ub2e4. SSL \uc5f0\uacb0\uc744 \uc885\ub8cc\ud558\ub294 \ubc29\ubc95\uacfc \uc704\uce58\ub294 \uad81\uadf9\uc801\uc73c\ub85c \uc870\uc9c1\uc758 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548 \uc815\ucc45\uc5d0 \ub530\ub77c \uacb0\uc815\ub429\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 \uc5d4\ub4dc \ud22c \uc5d4\ub4dc \uc554\ud638\ud654\ub97c \uc694\uad6c\ud558\ub294 \uc815\ucc45\uc774 \uc788\ub294 \uacbd\uc6b0 Pod\uc5d0\uc11c \ud2b8\ub798\ud53d\uc744 \ud574\ub3c5\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub807\uac8c \ub418\uba74 \ud30c\ub4dc\uac00 \ucd08\uae30 \ud578\ub4dc\uc170\uc774\ud06c\ub97c \uc124\uc815\ud558\ub294 \ub370 \ub9ce\uc740 \uc2dc\uac04\uc744 \uc18c\ube44\ud574\uc57c \ud558\ubbc0\ub85c \ud30c\ub4dc\uc5d0 \ucd94\uac00\uc801\uc778 \ubd80\ub2f4\uc774 \uac00\uc911\ub429\ub2c8\ub2e4. \uc804\uccb4 SSL/TLS \ucc98\ub9ac\ub294 CPU \uc9d1\uc57d\ub3c4\uac00 \ub9e4\uc6b0 \ub192\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc720\uc5f0\uc131\uc774 \uc788\ub2e4\uba74 \uc778\uadf8\ub808\uc2a4 \ub610\ub294 \ub85c\ub4dc\ubc38\ub7f0\uc11c\uc5d0\uc11c SSL \uc624\ud504\ub85c\ub4dc\ub97c \uc218\ud589\ud574 \ubcf4\uc138\uc694.</p>"},{"location":"ko/security/docs/network/#aws-elastic","title":"AWS Elastic \ub85c\ub4dc\ubc38\ub7f0\uc11c\ub97c \ud1b5\ud55c \uc554\ud638\ud654 \uc0ac\uc6a9","text":"<p>AWS Application Load Balancer(ALB) \ubc0f Network Load Balancer(NLB) \ubaa8\ub450 \uc804\uc1a1 \uc554\ud638\ud654(SSL \ubc0f TLS)\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. ALB\uc5d0 \ub300\ud55c <code>alb.ingress.kubernetes.io/certificate-arn</code> \uc5b4\ub178\ud14c\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uba74 ALB\uc5d0 \ucd94\uac00\ud560 \uc778\uc99d\uc11c\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc5b4\ub178\ud14c\uc774\uc158\uc744 \uc0dd\ub7b5\ud558\uba74 \ucee8\ud2b8\ub864\ub7ec\ub294 \ud638\uc2a4\ud2b8 \ud544\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc0ac\uc6a9 \uac00\ub2a5\ud55c AWS Certificate Manager (ACM)\uc778\uc99d\uc11c\ub97c \uc77c\uce58\uc2dc\ucf1c \uc778\uc99d\uc11c\ub97c \ud544\uc694\ub85c \ud558\ub294 \ub9ac\uc2a4\ub108\uc5d0 \uc778\uc99d\uc11c\ub97c \ucd94\uac00\ud558\ub824\uace0 \uc2dc\ub3c4\ud569\ub2c8\ub2e4. EKS v1.15\ubd80\ud130 \uc544\ub798 \uc608\uc640 \uac19\uc774 NLB\uc640 \ud568\uaed8 <code>service.beta.kubernetes.io/aws-load-balancer-ssl-cert</code> \uc5b4\ub178\ud14c\uc774\uc158\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: demo-app\n  namespace: default\n  labels:\n    app: demo-app\n  annotations:\n     service.beta.kubernetes.io/aws-load-balancer-type: \"nlb\"\n     service.beta.kubernetes.io/aws-load-balancer-ssl-cert: \"&lt;certificate ARN&gt;\"\n     service.beta.kubernetes.io/aws-load-balancer-ssl-ports: \"443\"\n     service.beta.kubernetes.io/aws-load-balancer-backend-protocol: \"http\"\nspec:\n  type: LoadBalancer\n  ports:\n  - port: 443\n    targetPort: 80\n    protocol: TCP\n  selector:\n    app: demo-app\n---\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  name: nginx\n  namespace: default\n  labels:\n    app: demo-app\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: demo-app\n  template:\n    metadata:\n      labels:\n        app: demo-app\n    spec:\n      containers:\n        - name: nginx\n          image: nginx\n          ports:\n            - containerPort: 443\n              protocol: TCP\n            - containerPort: 80\n              protocol: TCP\n</code></pre> <p>\ub2e4\uc74c\uc740 SSL/TLS \uc885\ub8cc\uc5d0 \ub300\ud55c \ucd94\uac00 \uc608\uc785\ub2c8\ub2e4.</p> <ul> <li>Securing EKS Ingress With Contour And Let\u2019s Encrypt The GitOps Way</li> <li>How do I terminate HTTPS traffic on Amazon EKS workloads with ACM?</li> </ul> <p>Caution</p> <p>AWS LB \ucee8\ud2b8\ub864\ub7ec\uc640 \uac19\uc740 \uc77c\ubd80 \uc778\uadf8\ub808\uc2a4\ub294 \uc778\uadf8\ub808\uc2a4 \uc0ac\uc591\uc758 \uc77c\ubd80\uac00 \uc544\ub2cc \uc5b4\ub178\ud14c\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec SSL/TLS\ub97c \uad6c\ud604\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/network/#acm-private-ca-cert-manager","title":"ACM Private CA \uc5f0\ub3d9 (cert-manager)","text":"<p>\uc778\uc99d\uc11c\ub97c \ubc30\ud3ec, \uac31\uc2e0 \ubc0f \ucde8\uc18c\ud558\ub294 \uc778\uae30 \uc788\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc560\ub4dc\uc628\uc778 ACM Private Certificate Authority(CA) \ubc0f cert-manager\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc218\uc2e0, \ud30c\ub4dc, \ud30c\ub4dc \uac04\uc5d0 EKS \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc6cc\ud06c\ub85c\ub4dc\ub97c \ubcf4\ud638\ud558\ub3c4\ub85d TLS\uc640 mTLS\ub97c \ud65c\uc131\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. ACM Private CA\ub294 \uc790\uccb4 CA\ub97c \uad00\ub9ac\ud558\ub294 \ub370 \ub4dc\ub294 \uc120\uacb0\uc81c \ubc0f \uc720\uc9c0 \uad00\ub9ac \ube44\uc6a9\uc774 \uc5c6\ub294 \uac00\uc6a9\uc131\uc774 \ub192\uace0 \uc548\uc804\ud55c \uad00\ub9ac\ud615 CA\uc785\ub2c8\ub2e4. \uae30\ubcf8 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc778\uc99d \uae30\uad00\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 ACM Private CA\ub97c \ud1b5\ud574 \ubcf4\uc548\uc744 \uac1c\uc120\ud558\uace0 \uaddc\uc815 \uc900\uc218 \uc694\uad6c \uc0ac\ud56d\uc744 \ucda9\uc871\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. ACM Private CA\ub294 FIPS 140-2 \ub808\ubca8 3 \ud558\ub4dc\uc6e8\uc5b4 \ubcf4\uc548 \ubaa8\ub4c8\uc5d0\uc11c \ud504\ub77c\uc774\ube57 \ud0a4\ub97c \ubcf4\ud638\ud569\ub2c8\ub2e4(\ub9e4\uc6b0 \uc548\uc804\ud568). \uc774\ub294 \uba54\ubaa8\ub9ac\uc5d0 \uc778\ucf54\ub529\ub41c \ud0a4\ub97c \uc800\uc7a5\ud558\ub294 \uae30\ubcf8 CA (\ubcf4\uc548 \uc218\uc900\uc774 \ub0ae\uc74c)\uc640 \ube44\uad50\ud558\uba74 \ub9e4\uc6b0 \uc548\uc804\ud569\ub2c8\ub2e4. \ub610\ud55c \uc911\uc559 \uc9d1\uc911\uc2dd CA\ub97c \uc0ac\uc6a9\ud558\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud658\uacbd \ub0b4\ubd80 \ubc0f \uc678\ubd80\uc5d0\uc11c \uc0ac\uc124 \uc778\uc99d\uc11c\ub97c \ub354 \uc798 \uc81c\uc5b4\ud558\uace0 \uac10\uc0ac \uae30\ub2a5\uc744 \uac1c\uc120\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.  </p>"},{"location":"ko/security/docs/network/#tls-ca","title":"\uc6cc\ud06c\ub85c\ub4dc \uac04 \uc0c1\ud638 TLS\ub97c \uc704\ud55c \uc9e7\uc740 \uc218\uba85\uc758 CA \ubaa8\ub4dc","text":"<p>EKS \ud658\uacbd\uc5d0\uc11c\uc5d0\uc11c mTLS\uc6a9 ACM Private CA\ub97c \uc0ac\uc6a9\ud560 \ub54c\ub294 _\uc218\uba85\uc774 \uc9e7\uc740 CA \ubaa8\ub4dc_\uc640 \ud568\uaed8 \uc218\uba85\uc774 \uc9e7\uc740 \uc778\uc99d\uc11c\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \ubc94\uc6a9 CA \ubaa8\ub4dc\uc5d0\uc11c \uc218\uba85\uc774 \uc9e7\uc740 \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud560 \uc218 \uc788\uc9c0\ub9cc \uc0c8 \uc778\uc99d\uc11c\ub97c \uc790\uc8fc \ubc1c\uae09\ud574\uc57c \ud558\ub294 \uc0ac\uc6a9 \uc0ac\ub840\uc5d0\uc11c\ub294 \uc218\uba85\uc774 \uc9e7\uc740 CA \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ub354 \ube44\uc6a9 \ud6a8\uc728\uc801\uc785\ub2c8\ub2e4 (\uc77c\ubc18 \ubaa8\ub4dc\ubcf4\ub2e4 \ucd5c\ub300 75% \uc800\ub834). \uc774 \uc678\uc5d0\ub3c4 \uc0ac\uc124 \uc778\uc99d\uc11c\uc758 \uc720\ud6a8 \uae30\uac04\uc744 EKS \ud074\ub7ec\uc2a4\ud130\uc758 \ud30c\ub4dc \uc218\uba85\uc5d0 \ub9de\ucdb0 \uc870\uc815\ud574\uc57c \ud569\ub2c8\ub2e4 \uc5ec\uae30\uc5d0\uc11c ACM Private CA\uc640 \uadf8 \uc774\uc810\uc5d0 \ub300\ud574 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/network/#acm","title":"ACM \uad6c\uc131 \uac00\uc774\ub4dc","text":"<p>\uba3c\uc800 ACM Private CA \ubb38\uc11c\uc5d0 \uc81c\uacf5\ub41c \uc808\ucc28\uc5d0 \ub530\ub77c Private CA\ub97c \uc0dd\uc131\ud558\uc2ed\uc2dc\uc624. Private CA\ub97c \ub9cc\ub4e0 \ud6c4\uc5d0\ub294 cert-manager \uc124\uce58 \uac00\uc774\ub4dc \uc808\ucc28\uc5d0 \ub530\ub77c  cert-manager\ub97c \uc124\uce58\ud558\uc2ed\uc2dc\uc624. cert-manager\ub97c \uc124\uce58\ud55c \ud6c4 GitHub\uc758 \uc124\uc815 \uac00\uc774\ub4dc\uc5d0 \ub530\ub77c Private CA \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc778\uc99d\uc11c \uad00\ub9ac\uc790 \ud50c\ub7ec\uadf8\uc778\uc744 \uc124\uce58\ud569\ub2c8\ub2e4. \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\uba74 \uc778\uc99d\uc11c \uad00\ub9ac\uc790\uac00 ACM Private CA\uc5d0 \uc0ac\uc124 \uc778\uc99d\uc11c\ub97c \uc694\uccad\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc774\uc81c cert-manager\uc640 \ud50c\ub7ec\uadf8\uc778\uc774 \uc124\uce58\ub41c \uc0ac\uc124 CA\uc640 EKS \ud074\ub7ec\uc2a4\ud130\ub97c \ub9cc\ub4e4\uc5c8\uc73c\ub2c8, \uad8c\ud55c\uc744 \uc124\uc815\ud558\uace0 \ubc1c\uae09\uc790\ub97c \uc0dd\uc131\ud560 \ucc28\ub840\uc785\ub2c8\ub2e4. ACM \uc0ac\uc124 CA\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \ud5c8\uc6a9\ud558\ub3c4\ub85d EKS \ub178\ub4dc \uc5ed\ud560\uc758 IAM \uad8c\ud55c\uc744 \uc5c5\ub370\uc774\ud2b8\ud558\uc2ed\uc2dc\uc624. <code>&lt;CA_ARN&gt;</code>\ub97c \uc0ac\uc124 CA\uc758 \uac12\uc73c\ub85c \ubc14\uafb8\uc2ed\uc2dc\uc624.</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"awspcaissuer\",\n            \"Action\": [\n                \"acm-pca:DescribeCertificateAuthority\",\n                \"acm-pca:GetCertificate\",\n                \"acm-pca:IssueCertificate\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"&lt;CA_ARN&gt;\"\n        }\n    ]\n}\n</code></pre> <p>\uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc6a9 IAM \uc5ed\ud560(IRSA)\ub3c4 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc804\uccb4 \uc608\ub294 \uc544\ub798\uc758 \ucd94\uac00 \ub9ac\uc18c\uc2a4 \uc139\uc158\uc744 \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>\uc544\ub798 \uc608\uc81c\uc758 \ub0b4\uc6a9\uc744 \ud3ec\ud568\ud55c <code>cluster-issuer.yaml</code> CRD \ud30c\uc77c\uc744 \uc0dd\uc131\ud558\uace0 <code>&lt;CA_ARN&gt;</code> \ubc0f <code>&lt;Region&gt;</code> \uc601\uc5ed\uc744 Private CA \uc815\ubcf4\ub85c \ub300\uccb4\ud558\uc5ec Amazon EKS\uc5d0\uc11c \ubc1c\uae09\uc790\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: awspca.cert-manager.io/v1beta1\nkind: AWSPCAClusterIssuer\nmetadata:\n          name: demo-test-root-ca\nspec:\n          arn: &lt;CA_ARN&gt;\n          region: &lt;Region&gt;\n</code></pre> <p>Deploy the Issuer you created.</p> <pre><code>kubectl apply -f cluster-issuer.yaml\n</code></pre> <p>EKS \ud074\ub7ec\uc2a4\ud130\ub294 \uc0ac\uc124 CA\uc5d0\uc11c \uc778\uc99d\uc11c\ub97c \uc694\uccad\ud558\ub3c4\ub85d \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uc81c cert-manager\uc758 <code>Certificate</code> \ub9ac\uc18c\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc5ec <code>IssuerRef</code> \ud544\ub4dc \uac12\uc744 \uc704\uc5d0\uc11c \ub9cc\ub4e0 \uc0ac\uc124 CA \ubc1c\uae09\uc790\ub85c \ubcc0\uacbd\ud558\uc5ec \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc778\uc99d\uc11c \ub9ac\uc18c\uc2a4\ub97c \uc9c0\uc815\ud558\uace0 \uc694\uccad\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 cert-manager\uc758 \uc778\uc99d\uc11c \ub9ac\uc18c\uc2a4 \uac00\uc774\ub4dc\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624. \ub2e4\uc74c \uc608\uc81c\ub97c \ucc38\uc870\ud558\uc138\uc694..</p>"},{"location":"ko/security/docs/network/#acm-private-ca-istio-cert-manager","title":"ACM Private CA \uc5f0\ub3d9 (Istio \ubc0f cert-manager)","text":"<p>EKS \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c Istio\ub97c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 Istio \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 (\ud2b9\ud788 'istiod') \uc774 \ub8e8\ud2b8 \uc778\uc99d \uae30\uad00 (CA) \uc73c\ub85c \uc791\ub3d9\ud558\uc9c0 \uc54a\ub3c4\ub85d \uc124\uc815\ud558\uace0 ACM Private CA\ub97c \uc6cc\ud06c\ub85c\ub4dc \uac04 MTL\uc758 \ub8e8\ud2b8 CA\ub85c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud558\ub824\ub294 \uacbd\uc6b0 ACM Private CA\uc5d0\uc11c _\ub2e8\uae30 CA \ubaa8\ub4dc_\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc774\uc804 \uc139\uc158 \ubc0f \uc774 \ube14\ub85c\uadf8\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/network/#istio","title":"Istio\uc5d0\uc11c \uc778\uc99d\uc11c \uc11c\uba85 \uc791\ub3d9 \ubc29\uc2dd (\uae30\ubcf8\ubc29\uc2dd)","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uc6cc\ud06c\ub85c\ub4dc\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc2dd\ubcc4\ub429\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc9c0\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c \uc790\ub3d9\uc73c\ub85c \ud560\ub2f9\ud569\ub2c8\ub2e4. \ub610\ud55c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub294 \uad00\ub828 \ud1a0\ud070\uc744 \uc790\ub3d9\uc73c\ub85c \ub9c8\uc6b4\ud2b8\ud569\ub2c8\ub2e4. \uc774 \ud1a0\ud070\uc740 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uc5d0\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0 \ub300\ud55c \uc778\uc99d\uc744 \uc704\ud55c \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 ID\ub85c \ucda9\ubd84\ud560 \uc218 \uc788\uc9c0\ub9cc Istio\uc5d0\ub294 \uc790\uccb4 ID \uad00\ub9ac \uc2dc\uc2a4\ud15c\uacfc CA\uac00 \uc788\uc2b5\ub2c8\ub2e4. Envoy \uc0ac\uc774\ub4dc\uce74 \ud504\ub85d\uc2dc\ub85c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2dc\uc791\ud558\ub294 \uacbd\uc6b0 Istio\uc5d0\uc11c \ud560\ub2f9\ud55c ID\uac00 \uc788\uc5b4\uc57c \ud574\ub2f9 \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \uac83\uc73c\ub85c \uac04\uc8fc\ub418\uace0 \uba54\uc2dc\uc758 \ub2e4\ub978 \uc11c\ube44\uc2a4\uc640 \ud1b5\uc2e0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Istio\uc5d0\uc11c \uc774 ID\ub97c \uac00\uc838\uc624\uae30 \uc704\ud574 'istio-agent'\ub294 \uc778\uc99d\uc11c \uc11c\uba85 \uc694\uccad(\ub610\ub294 CSR) \uc774\ub77c\ub294 \uc694\uccad\uc744 Istio \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0 \ubcf4\ub0c5\ub2c8\ub2e4. \uc774 CSR\uc5d0\ub294 \ucc98\ub9ac \uc804\uc5d0 \uc6cc\ud06c\ub85c\ub4dc\uc758 ID\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub3c4\ub85d \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ud655\uc778 \ud504\ub85c\uc138\uc2a4\ub294 \ub4f1\ub85d \uae30\uad00(\ub610\ub294 RA)\uacfc CA \uc5ed\ud560\uc744 \ubaa8\ub450 \ud558\ub294 'istiod'\uc5d0 \uc758\ud574 \ucc98\ub9ac\ub429\ub2c8\ub2e4. RA\ub294 \uac80\uc99d\ub41c CSR\ub9cc CA\uc5d0 \uc804\ub2ec\ub418\ub3c4\ub85d \ud558\ub294 \uac8c\uc774\ud2b8\ud0a4\ud37c \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4. CSR\uc774 \ud655\uc778\ub418\uba74 CA\ub85c \uc804\ub2ec\ub418\uba70 CA\ub294 \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\uacfc \ud568\uaed8 SPIFFE ID\uac00 \ud3ec\ud568\ub41c \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud569\ub2c8\ub2e4. \uc774 \uc778\uc99d\uc11c\ub97c SPIFE \uac80\uc99d \uac00\ub2a5\ud55c ID \ubb38\uc11c(\ub610\ub294 SVID) \ub77c\uace0 \ud569\ub2c8\ub2e4. SVID\ub294 \uc694\uccad \uc11c\ube44\uc2a4\uc5d0 \ud560\ub2f9\ub418\uc5b4 \uc2dd\ubcc4\uc744 \ubaa9\uc801\uc73c\ub85c \ud558\uace0 \ud1b5\uc2e0 \uc11c\ube44\uc2a4 \uac04\uc5d0 \uc804\uc1a1\ub418\ub294 \ud2b8\ub798\ud53d\uc744 \uc554\ud638\ud654\ud569\ub2c8\ub2e4.</p> <p></p>"},{"location":"ko/security/docs/network/#acm-private-ca-istio","title":"ACM Private CA\ub97c \uc0ac\uc6a9\ud558\uc5ec Istio\uc5d0\uc11c \uc778\uc99d\uc11c \uc11c\uba85\uc774 \uc791\ub3d9\ud558\ub294 \ubc29\uc2dd","text":"<p>Istio \uc778\uc99d\uc11c \uc11c\uba85 \uc694\uccad \uc5d0\uc774\uc804\ud2b8 (istio-csr)\ub77c\ub294 \uc778\uc99d\uc11c \uad00\ub9ac \uc560\ub4dc\uc628\uc744 \uc0ac\uc6a9\ud558\uc5ec Istio\ub97c ACM \uc0ac\uc124 CA\uc640 \ud1b5\ud569\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc5d0\uc774\uc804\ud2b8\ub97c \uc0ac\uc6a9\ud558\uba74 \uc778\uc99d\uc11c \uad00\ub9ac\uc790 \ubc1c\uae09\uc790(\uc774 \uacbd\uc6b0 ACM Private CA)\ub97c \ud1b5\ud574 Istio \uc6cc\ud06c\ub85c\ub4dc\uc640 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778 \uad6c\uc131 \uc694\uc18c\ub97c \ubcf4\ud638\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. istio-csr \uc5d0\uc774\uc804\ud2b8\ub294 \uc218\uc2e0 CSR\uc744 \uac80\uc99d\ud558\ub294 \uae30\ubcf8 \uad6c\uc131\uc5d0\uc11c _istiod_\uac00 \uc81c\uacf5\ud558\ub294 \uac83\uacfc \ub3d9\uc77c\ud55c \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. \ub2e8, \ud655\uc778 \ud6c4\uc5d0\ub294 \uc694\uccad\uc744 \uc778\uc99d\uc11c \uad00\ub9ac\uc790\uac00 \uc9c0\uc6d0\ud558\ub294 \ub9ac\uc18c\uc2a4(\uc608: \uc678\ubd80 CA \ubc1c\uae09\uc790\uc640\uc758 \ud1b5\ud569)\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4.</p> <p>\uc6cc\ud06c\ub85c\ub4dc\uc5d0\uc11c CSR\uc774 \uc218\uc2e0\ub420 \ub54c\ub9c8\ub2e4 \ud574\ub2f9 CSR\uc740 _istio-csr_\ub85c \uc804\ub2ec\ub418\uba70, \uc774 CSR\uc740 ACM \uc0ac\uc124 CA\ub85c\ubd80\ud130 \uc778\uc99d\uc11c\ub97c \uc694\uccad\ud569\ub2c8\ub2e4. _istio-csr_\uc640 ACM Private CA \uac04\uc758 \uc774\ub7f0 \ud1b5\uc2e0\uc740 AWS Private CA \ubc1c\uae09\uc790 \ud50c\ub7ec\uadf8\uc778\uc744 \ud1b5\ud574 \ud65c\uc131\ud654\ub429\ub2c8\ub2e4. \uc778\uc99d\uc11c \uad00\ub9ac\uc790\ub294 \uc774 \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\uc5ec ACM \uc0ac\uc124 CA\uc5d0 TLS \uc778\uc99d\uc11c\ub97c \uc694\uccad\ud569\ub2c8\ub2e4. \ubc1c\uae09\uc790 \ud50c\ub7ec\uadf8\uc778\uc740 ACM \uc0ac\uc124 CA \uc11c\ube44\uc2a4\uc640 \ud1b5\uc2e0\ud558\uc5ec \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub300\ud55c \uc11c\uba85\ub41c \uc778\uc99d\uc11c\ub97c \uc694\uccad\ud569\ub2c8\ub2e4. \uc778\uc99d\uc11c\uac00 \uc11c\uba85\ub418\uba74 \uc774 \uc778\uc99d\uc11c\ub294 _istio-csr_\ub85c \ubc18\ud658\ub418\uba70, \uadf8\ub7ec\uba74 \uc11c\uba85\ub41c \uc694\uccad\uc744 \uc77d\uace0 CSR\uc744 \uc2dc\uc791\ud55c \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ud574\ub2f9 \uc694\uccad\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.</p> <p></p>"},{"location":"ko/security/docs/network/#ca-istio","title":"\uc0ac\uc124 CA\uac00 \ud3ec\ud568\ub41c Istio \uad6c\uc131 \uac00\uc774\ub4dc","text":"<ol> <li>\uba3c\uc800 \uc774 \uc139\uc158\uc758 \uc124\uc815 \uc9c0\uce68 \uc5d0 \ub530\ub77c \ub2e4\uc74c\uc744 \uc644\ub8cc\ud558\uc2ed\uc2dc\uc624.:</li> <li>\uc0ac\uc124 CA \uc0dd\uc131</li> <li>cert-manager \uc124\uce58</li> <li>\ubc1c\uae09\uc790 \ud50c\ub7ec\uadf8\uc778 \uc124\uce58</li> <li>\uad8c\ud55c\uc744 \uc124\uc815\ud558\uace0 \ubc1c\uae09\uc790\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. \ubc1c\uae09\uc790\ub294 CA\ub97c \ub098\ud0c0\ub0b4\uba70 'istiod' \ubc0f \uba54\uc2dc \uc6cc\ud06c\ub85c\ub4dc \uc778\uc99d\uc11c\uc5d0 \uc11c\uba85\ud558\ub294 \ub370 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. ACM \uc0ac\uc124 CA\uc640 \ud1b5\uc2e0\ud569\ub2c8\ub2e4.</li> <li>'Istio-system' \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc5d0 'istiod \uc778\uc99d\uc11c'\uc640 \uae30\ud0c0 Istio \ub9ac\uc18c\uc2a4\uac00 \ubc30\ud3ec\ub429\ub2c8\ub2e4.</li> <li> <p>AWS \uc0ac\uc124 CA \ubc1c\uae09\uc790 \ud50c\ub7ec\uadf8\uc778\uc73c\ub85c \uad6c\uc131\ub41c Istio CSR\uc744 \uc124\uce58\ud569\ub2c8\ub2e4.\uc6cc\ud06c\ub85c\ub4dc\uc5d0 \ub300\ud55c \uc778\uc99d\uc11c \uc11c\uba85 \uc694\uccad\uc744 \ubcf4\uc874\ud558\uc5ec \uc2b9\uc778 \ubc0f \uc11c\uba85 \uc5ec\ubd80\ub97c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4 (<code>PerveCertificateRequests=true</code>).</p> <pre><code>helm install -n cert-manager cert-manager-istio-csr jetstack/cert-manager-istio-csr \\\n  --set \"app.certmanager.issuer.group=awspca.cert-manager.io\" \\\n  --set \"app.certmanager.issuer.kind=AWSPCAClusterIssuer\" \\\n  --set \"app.certmanager.issuer.name=&lt;the-name-of-the-issuer-you-created&gt;\" \\\n  --set \"app.certmanager.preserveCertificateRequests=true\" \\\n  --set \"app.server.maxCertificateDuration=48h\" \\\n  --set \"app.tls.certificateDuration=24h\" \\\n  --set \"app.tls.istiodCertificateDuration=24h\" \\\n  --set \"app.tls.rootCAFile=/var/run/secrets/istio-csr/ca.pem\" \\\n  --set \"volumeMounts[0].name=root-ca\" \\\n  --set \"volumeMounts[0].mountPath=/var/run/secrets/istio-csr\" \\\n  --set \"volumes[0].name=root-ca\" \\\n  --set \"volumes[0].secret.secretName=istio-root-ca\"\n</code></pre> </li> <li> <p>'istiod'\ub97c 'cert-manager istio-csr'\ub85c \ubc14\uafbc \uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc124\uc815\uc73c\ub85c \uba54\uc2dc\uc758 \uc778\uc99d\uc11c \uacf5\uae09\uc790\ub85c Istio\ub97c \uc124\uce58\ud558\uc138\uc694. \uc774 \ud504\ub85c\uc138\uc2a4\ub294 Istio \uc624\ud37c\ub808\uc774\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nmetadata:\n  name: istio\n  namespace: istio-system\nspec:\n  profile: \"demo\"\n  hub: gcr.io/istio-release\n  values:\n  global:\n    # Change certificate provider to cert-manager istio agent for istio agent\n    caAddress: cert-manager-istio-csr.cert-manager.svc:443\n  components:\n    pilot:\n      k8s:\n        env:\n          # Disable istiod CA Sever functionality\n        - name: ENABLE_CA_SERVER\n          value: \"false\"\n        overlays:\n        - apiVersion: apps/v1\n          kind: Deployment\n          name: istiod\n          patches:\n\n            # Mount istiod serving and webhook certificate from Secret mount\n          - path: spec.template.spec.containers.[name:discovery].args[7]\n            value: \"--tlsCertFile=/etc/cert-manager/tls/tls.crt\"\n          - path: spec.template.spec.containers.[name:discovery].args[8]\n            value: \"--tlsKeyFile=/etc/cert-manager/tls/tls.key\"\n          - path: spec.template.spec.containers.[name:discovery].args[9]\n            value: \"--caCertFile=/etc/cert-manager/ca/root-cert.pem\"\n\n          - path: spec.template.spec.containers.[name:discovery].volumeMounts[6]\n            value:\n              name: cert-manager\n              mountPath: \"/etc/cert-manager/tls\"\n              readOnly: true\n          - path: spec.template.spec.containers.[name:discovery].volumeMounts[7]\n            value:\n              name: ca-root-cert\n              mountPath: \"/etc/cert-manager/ca\"\n              readOnly: true\n\n          - path: spec.template.spec.volumes[6]\n            value:\n              name: cert-manager\n              secret:\n                secretName: istiod-tls\n          - path: spec.template.spec.volumes[7]\n            value:\n              name: ca-root-cert\n              configMap:\n                defaultMode: 420\n                name: istio-ca-root-cert\n</code></pre> </li> <li> <p>\uc0dd\uc131\ud55c \uc704\uc758 \uc0ac\uc6a9\uc790 \uc9c0\uc815 \ub9ac\uc18c\uc2a4(CRD)\ub97c \ubc30\ud3ec\ud569\ub2c8\ub2e4.</p> <pre><code>istioctl operator init\nkubectl apply -f istio-custom-config.yaml\n</code></pre> </li> <li> <p>\uc774\uc81c EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uba54\uc2dc\uc5d0 \uc6cc\ud06c\ub85c\ub4dc\ub97c \ubc30\ud3ec\ud558\uace0 mTLS\ub97c \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> </li> </ol> <p></p>"},{"location":"ko/security/docs/network/#_23","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<ul> <li>cert-manager \ubc0f ACM Private CA \ud50c\ub7ec\uadf8\uc778\uc744 \uad6c\ud604\ud558\uc5ec EKS\uc5d0\uc11c TLS\ub97c \ud65c\uc131\ud654\ud558\ub294 \ubc29\ubc95.</li> <li>\uc0c8\ub85c\uc6b4 AWS Load Balancer Controller \ubc0f ACM Private CA\ub97c \uc0ac\uc6a9\ud558\uc5ec Amazon EKS\uc5d0\uc11c \uc5d4\ub4dc-\ud22c-\uc5d4\ub4dc TLS \uc554\ud638\ud654 \uc124\uc815.</li> <li>Private CA \ucfe0\ubc84\ub124\ud2f0\uc2a4 cert-manager \ud50c\ub7ec\uadf8\uc778 (Github).</li> <li>Private CA \ucfe0\ubc84\ub124\ud2f0\uc2a4 cert-manager \ud50c\ub7ec\uadf8\uc778 \uc0ac\uc6a9\uc790 \uac00\uc774\ub4dc.</li> <li>AWS Private Certificate Authority \ub2e8\uae30 \uc778\uc99d\uc11c \ubaa8\ub4dc \uc0ac\uc6a9 \ubc29\ubc95</li> <li>kniff \ubc0f Wireshark\ub97c \uc0ac\uc6a9\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uc11c\ube44\uc2a4 \uba54\uc2dc TLS \uac80\uc99d</li> <li>ksniff</li> <li>egress-operator \ud504\ub85c\ud1a0\ucf5c \uac80\uc0ac \uc5c6\uc774 \ud074\ub7ec\uc2a4\ud130\uc758 \uc1a1\uc2e0 \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud558\ub294 \uc624\ud37c\ub808\uc774\ud130 \ubc0f DNS \ud50c\ub7ec\uadf8\uc778</li> </ul>"},{"location":"ko/security/docs/pods/","title":"\ud30c\ub4dc \ubcf4\uc548","text":"<p>\ud30c\ub4dc \uc0ac\uc591\uc5d0\ub294 \uc804\ubc18\uc801\uc778 \ubcf4\uc548 \ud0dc\uc138\ub97c \uac15\ud654\ud558\uac70\ub098 \uc57d\ud654\uc2dc\ud0ac \uc218 \uc788\ub294 \ub2e4\uc591\ud55c \uc18d\uc131\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2e4\ubb34\uc790\ub85c\uc11c \uc8fc\uc694 \uad00\uc2ec\uc0ac\ub294 \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ud504\ub85c\uc138\uc2a4\uac00 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc758 \uaca9\ub9ac \uacbd\uacc4\ub97c \ubc97\uc5b4\ub098 \uae30\ubcf8 \ud638\uc2a4\ud2b8\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \uc5bb\uc9c0 \ubabb\ud558\ub3c4\ub85d \ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_2","title":"\ub9ac\ub205\uc2a4 \uae30\ub2a5","text":"<p>\ucee8\ud14c\uc774\ub108 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud504\ub85c\uc138\uc2a4\ub294 \uae30\ubcf8\uc801\uc73c\ub85c [Linux] \ub8e8\ud2b8 \uc0ac\uc6a9\uc790\uc758 \ucee8\ud14d\uc2a4\ud2b8\uc5d0\uc11c \uc2e4\ud589\ub429\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108 \ub0b4\uc758 \ub8e8\ud2b8 \uc791\uc5c5\uc740 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc774 \ucee8\ud14c\uc774\ub108\uc5d0 \ud560\ub2f9\ud558\ub294 \ub9ac\ub205\uc2a4 \uae30\ub2a5 \uc138\ud2b8\uc5d0 \uc758\ud574 \ubd80\ubd84\uc801\uc73c\ub85c \uc81c\ud55c\ub418\uc9c0\ub9cc \uc774\ub7f0 \uae30\ubcf8 \uad8c\ud55c\uc744 \ud1b5\ud574 \uacf5\uaca9\uc790\ub294 \uad8c\ud55c\uc744 \uc5d0\uc2a4\uceec\ub808\uc774\uc158\ud558\uac70\ub098 \ud638\uc2a4\ud2b8\uc5d0 \ubc14\uc778\ub529\ub41c \ubbfc\uac10\ud55c \uc815\ubcf4\uc5d0 \uc561\uc138\uc2a4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ube44\ubc00 \ubc0f \ucee8\ud53c\uadf8\ub9f5\uc744 \ud3ec\ud568\ud569\ub2c8\ub2e4. \ub2e4\uc74c\uc740 \ucee8\ud14c\uc774\ub108\uc5d0 \ud560\ub2f9\ub41c \uae30\ubcf8 \uae30\ub2a5 \ubaa9\ub85d\uc785\ub2c8\ub2e4. \uac01 \uae30\ub2a5\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 \ud574\ub2f9 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p><code>CAP_AUDIT_WRITE, CAP_CHOWN, CAP_DAC_OVERRIDE, CAP_FOWNER, CAP_FSETID, CAP_KILL, CAP_MKNOD, CAP_NET_BIND_SERVICE, CAP_NET_RAW, CAP_SETGID, CAP_SETUID, CAP_SETFCAP, CAP_SETPCAP, CAP_SYS_CHROOT</code></p> <p>Info</p> <p>EC2 \ubc0f Fargate \ud30c\ub4dc\uc5d0\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \uc55e\uc11c \uc5b8\uae09\ud55c \uae30\ub2a5\uc774 \ud560\ub2f9\ub429\ub2c8\ub2e4. \ub610\ud55c Linux \uae30\ub2a5\uc740 Fargate \ud30c\ub4dc\uc5d0\uc11c\ub9cc \uc0ad\uc81c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Privileged \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\ub294 \ud638\uc2a4\ud2b8\uc758 \ub8e8\ud2b8\uc640 \uc5f0\uacb0\ub41c Linux \uae30\ub2a5\uc758 \ubaa8\ub4e0 \uad8c\ud55c \uc744 \uc0c1\uc18d\ud569\ub2c8\ub2e4. \uac00\ub2a5\ud55c \ud574\ub2f9 \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\uc740 \uc9c0\uc591\ud558\uc5ec\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_3","title":"\ub178\ub4dc \uc2b9\uc778","text":"<p>\ubaa8\ub4e0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6cc\ucee4 \ub178\ub4dc\ub294 \ub178\ub4dc \uc778\uc99d\uc774\ub77c\ub294 \uad8c\ud55c \ubd80\uc5ec \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4.\ub178\ub4dc \uc778\uc99d\uc740 kubelet\uc5d0\uc11c \uc2dc\uc791\ub418\ub294 \ubaa8\ub4e0 API \uc694\uccad\uc744 \uc2b9\uc778\ud558\uace0 \ub178\ub4dc\uac00 \ub2e4\uc74c \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\ub3c4\ub85d \ud569\ub2c8\ub2e4.</p> <p>\uc77d\uae30 \uc791\uc5c5:</p> <ul> <li>\uc11c\ube44\uc2a4</li> <li>\uc5d4\ub4dc\ud3ec\uc778\ud2b8</li> <li>\ub178\ub4dc</li> <li>\ud30c\ub4dc</li> <li>kubelet\uc758 \ub178\ub4dc\uc5d0 \ubc14\uc778\ub529\ub41c \ud30c\ub4dc\uc640 \uad00\ub828\ub41c \uc2dc\ud06c\ub9bf, \ucee8\ud53c\uadf8\ub9f5, \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968 \ud074\ub808\uc784 \ubc0f \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968</li> </ul> <p>\uc4f0\uae30 \uc791\uc5c5:</p> <ul> <li>\ub178\ub4dc \ubc0f \ub178\ub4dc \uc0c1\ud0dc( <code>NodeRestriction</code> \uc5b4\ub4dc\ubbf8\uc158 \ud50c\ub7ec\uadf8\uc778\uc744 \ud65c\uc131\ud654\ud558\uc5ec kubelet\uc774 \uc790\uc2e0\uc758 \ub178\ub4dc\ub97c \uc218\uc815\ud558\ub3c4\ub85d \uc81c\ud55c)</li> <li>\ud30c\ub4dc \ubc0f \ud30c\ub4dc \uc0c1\ud0dc( <code>NodeRestriction</code> \uc5b4\ub4dc\ubbf8\uc158 \ud50c\ub7ec\uadf8\uc778\uc744 \ud65c\uc131\ud654\ud558\uc5ec kubelet\uc774 \uc790\uc2e0\uc5d0\uac8c \ubc14\uc778\ub529\ub41c pod\ub97c \uc218\uc815\ud558\ub3c4\ub85d \uc81c\ud55c)</li> <li>\uc774\ubca4\ud2b8</li> </ul> <p>\uc778\uc99d \uad00\ub828 \uc791\uc5c5:</p> <ul> <li>TLS \ubd80\ud2b8\uc2a4\ud2b8\ub798\ud551\uc744 \uc704\ud55c \uc778\uc99d\uc11c \uc11c\uba85 \uc694\uccad(CSR) API\uc5d0 \ub300\ud55c \uc77d\uae30/\uc4f0\uae30 \uad8c\ud55c</li> <li>\uc704\uc784 \uc778\uc99d/\uad8c\ud55c \ud655\uc778\uc744 \uc704\ud55c TokenReview \ubc0f SubjectAccessReview \uc0dd\uc131 \uad8c\ud55c</li> </ul> <p>EKS\ub294 \ub178\ub4dc \uc81c\ud55c \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\uac00 \uc81c\ud55c\ub41c \ub178\ub4dc \uc18d\uc131 \ubc0f \ud30c\ub4dc \uc138\ud2b8\ub9cc \uc218\uc815\ud558\ub3c4\ub85d \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ub178\ub4dc\uc5d0 \ubc14\uc778\ub529\ub41c \uac1c\uccb4\uc785\ub2c8\ub2e4. \uadf8\ub7fc\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 \ud638\uc2a4\ud2b8\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4\ub97c \uad00\ub9ac\ud558\ub294 \uacf5\uaca9\uc790\ub294 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\uc11c \uce21\uba74 \uc774\ub3d9\uc744 \ud5c8\uc6a9\ud560 \uc218 \uc788\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0\uc11c \ud658\uacbd\uc5d0 \ub300\ud55c \ubbfc\uac10\ud55c \uc815\ubcf4\ub97c \uc218\uc9d1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_4","title":"\ud30c\ub4dc \ubcf4\uc548 \uc194\ub8e8\uc158","text":""},{"location":"ko/security/docs/pods/#psp","title":"\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \ud3f4\ub9ac\uc2dc(PSP)","text":"<p>\uacfc\uac70\uc5d0\ub294 \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \ud3f4\ub9ac\uc2dc(PSP) \ub9ac\uc18c\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\uac00 \ucda9\uc871\ud574\uc57c \ud558\ub294 \uc77c\ub828\uc758 \uc694\uad6c \uc0ac\ud56d\uc744 \uc9c0\uc815\ud588\uc2b5\ub2c8\ub2e4. Kubernetes \ubc84\uc804 1.21\ubd80\ud130 PSP\ub294 \ub354 \uc774\uc0c1 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. Kubernetes \ubc84\uc804 1.25\uc5d0\uc11c \uc81c\uac70\ub420 \uc608\uc815\uc785\ub2c8\ub2e4.</p> <p>Attention</p> <p>Kubernetes \ubc84\uc804 1.21\ubd80\ud130 PSP\ub294 \ub354 \uc774\uc0c1 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. P2P\uac00 \ub354\uc774\uc0c1 \uc9c0\uc6d0\ub418\uc9c0 \uc54a\uc744 \ubc84\uc804 1.25\uae4c\uc9c0 \ub300\uc548 \uc194\ub8e8\uc158\uc73c\ub85c \uc804\ud658\ud558\ub294\ub370 \ub300\ub7b5 2\ub144\uc758 \uc2dc\uac04\uc774 \ub0a8\uc558\uc2b5\ub2c8\ub2e4. \uc774 \ubb38\uc11c\ub294 \uc774\ub7f0 \uc9c0\uc6d0 \uc911\ub2e8\uc758 \ub3d9\uae30\uc5d0 \ub300\ud558\uc5ec \uc124\uba85\ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_5","title":"\uc0c8\ub85c\uc6b4 \ud30c\ub4dc \ubcf4\uc548 \uc194\ub8e8\uc158\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158","text":"<p>PSP\ub294 \uc81c\uac70\ub420 \uc608\uc815\uc774\uba70 \ub354 \uc774\uc0c1 \ud65c\uc131 \uac1c\ubc1c \uc911\uc774 \uc544\ub2c8\ubbc0\ub85c \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\uc640 \uc6b4\uc601\uc790\ub294 \uc774\ub7f0 \ubcf4\uc548 \uc81c\uc5b4\ub97c \uad50\uccb4\ud574\uc57c \ud569\ub2c8\ub2e4. \ub450 \uac00\uc9c0 \uc194\ub8e8\uc158\uc73c\ub85c \uc774\ub7f0 \uc694\uad6c\ub97c \ucda9\uc871\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc5d0\ucf54\uc2dc\uc2a4\ud15c \ub0b4 PAC(Policy-as-code) \uc194\ub8e8\uc158</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS)</li> </ul> <p>PAC \ubc0f PSS \uc194\ub8e8\uc158\uc740 \ubaa8\ub450 PSP\uc640 \uacf5\uc874\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. PSP\uac00 \uc81c\uac70\ub418\uae30 \uc804\uc5d0 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c PSP\uc5d0\uc11c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud560 \ub54c \uc27d\uac8c \ucc44\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. PSP\uc5d0\uc11c PSS\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\uc744 \uace0\ub824\ud558\ub294 \uacbd\uc6b0 \uc774 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc138\uc694.</p> <p>\uc544\ub798\uc5d0 \uc124\uba85\ub41c PAC \uc194\ub8e8\uc158 \uc911 \ud558\ub098\uc778 Kyverno\ub294 PSP\uc5d0\uc11c \ud574\ub2f9 \uc194\ub8e8\uc158\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud560 \ub54c \uc720\uc0ac\ud55c \uc815\ucc45, \uae30\ub2a5 \ube44\uad50 \ubc0f \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc808\ucc28\ub97c \ud3ec\ud568\ud558\uc5ec \ud574\ub2f9 \ube14\ub85c\uadf8\uc5d0 \uad6c\uccb4\uc801\uc778 \uc9c0\uce68\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc5b4\ub4dc\ubbf8\uc158 (PSA)\uacfc \uad00\ub828\ub41c Kyverno\ub85c\uc758 \ub9c8\uc774\uadf8\ub808\uc774\uc158\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4 \ubc0f \uc9c0\uce68\uc740 AWS \ube14\ub85c\uadf8\uc5d0 \uac8c\uc2dc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#pac","title":"\ucf54\ub4dc\ub85c\uc11c\uc758 \uc815\ucc45(PAC)","text":"<p>PAC(Policy-as-code) \uc194\ub8e8\uc158\uc740 \uaddc\uc815\ub41c \uc790\ub3d9 \uc81c\uc5b4\ub97c \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130 \uc0ac\uc6a9\uc790\ub97c \uc548\ub0b4\ud558\uace0 \uc6d0\uce58 \uc54a\ub294 \ub3d9\uc791\uc744 \ubc29\uc9c0\ud558\ub294 \uac00\ub4dc\ub808\uc77c\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. PAC\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub3d9\uc801 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6f9\ud6c5 \ud638\ucd9c\uc744 \ud1b5\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84 \uc694\uccad \ud750\ub984\uc744 \uac00\ub85c\ucc44\uace0 \ubcc0\ud615 \ubc0f \uac80\uc99d\ud569\ub2c8\ub2e4. \ucf54\ub4dc\ub85c \uc791\uc131\ub418\uace0 \uc800\uc7a5\ub41c \uc815\ucc45\uc744 \uae30\ubc18\uc73c\ub85c \ud398\uc774\ub85c\ub4dc\ub97c \uc694\uccad\ud569\ub2c8\ub2e4. \ubcc0\ud615 \ubc0f \uc720\ud6a8\uc131 \uac80\uc0ac\ub294 API \uc11c\ubc84 \uc694\uccad\uc73c\ub85c \uc778\ud574 \ud074\ub7ec\uc2a4\ud130\uac00 \ubcc0\uacbd\ub418\uae30 \uc804\uc5d0 \ubc1c\uc0dd\ud569\ub2c8\ub2e4. PAC \uc194\ub8e8\uc158\uc740 \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubd84\ub958 \ubc0f \uac12\uc744 \uae30\ubc18\uc73c\ub85c API \uc11c\ubc84 \uc694\uccad \ud398\uc774\ub85c\ub4dc\ub97c \uc77c\uce58\uc2dc\ud0a4\uace0 \uc791\ub3d9\ud569\ub2c8\ub2e4.</p> <p>Kubernetes\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uba87 \uac00\uc9c0 \uc624\ud508 \uc18c\uc2a4 PAC \uc194\ub8e8\uc158\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc194\ub8e8\uc158\uc740 Kubernetes \ud504\ub85c\uc81d\ud2b8\uc758 \uc77c\ubd80\uac00 \uc544\ub2d9\ub2c8\ub2e4. Kubernetes \uc0dd\ud0dc\uacc4\uc5d0\uc11c \uc81c\uacf5\ub429\ub2c8\ub2e4. \uc77c\ubd80 PAC \uc194\ub8e8\uc158\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <ul> <li>OPA/\uac8c\uc774\ud2b8\ud0a4\ud37c</li> <li>\uc624\ud508 \uc815\ucc45 \uc5d0\uc774\uc804\ud2b8(OPA)</li> <li>\uce74\uc774\ubca0\ub974\ub178</li> <li>Kubewarden</li> <li>jsPolicy</li> </ul> <p>PAC \uc194\ub8e8\uc158\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uacfc \ud544\uc694\uc5d0 \ub9de\ub294 \uc801\uc808\ud55c \uc194\ub8e8\uc158\uc744 \uc120\ud0dd\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub418\ub294 \ubc29\ubc95\uc740 \uc544\ub798 \ub9c1\ud06c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <ul> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0 \ub300\ud55c \uc815\ucc45 \uae30\ubc18 \ub300\ucc45 - 1\ubd80</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc704\ud55c \uc815\ucc45 \uae30\ubc18 \ub300\ucc45 \u2013 2\ubd80</li> </ul>"},{"location":"ko/security/docs/pods/#pss-psa","title":"\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS) \ubc0f \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc5b4\ub4dc\ubbf8\uc158(PSA)","text":"<p>PSP \uc9c0\uc6d0 \uc911\ub2e8 \ubc0f \uc989\uc2dc \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ud30c\ub4dc \ubcf4\uc548\uc744 \uc81c\uc5b4\ud574\uc57c \ud558\ub294 \uc9c0\uc18d\uc801\uc778 \ud544\uc694\uc131\uc5d0 \ub300\uc751\ud558\uc5ec \ube4c\ud2b8\uc778 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc194\ub8e8\uc158\uc73c\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 Auth Special Interest Group\ub294 \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS) \ubc0f \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc5b4\ub4dc\ubbf8\uc158(PSA)\uc744 \ub9cc\ub4e4\uc5c8\uc2b5\ub2c8\ub2e4. PSA \uc5d0\ub294 PSS\uc5d0 \uc815\uc758\ub41c \uc81c\uc5b4\ub97c \uad6c\ud604\ud558\ub294 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec \uc6f9\ud6c5 \ud504\ub85c\uc81d\ud2b8\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. \uc774 \ud5c8\uc6a9 \ucee8\ud2b8\ub864\ub7ec \uc811\uadfc \ubc29\uc2dd\uc740 PAC \uc194\ub8e8\uc158\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294 \ubc29\uc2dd\uacfc \uc720\uc0ac\ud569\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c\uc5d0 \ub530\ub974\uba74 PSS\ub294 \"\ubcf4\uc548 \uc2a4\ud399\ud2b8\ub7fc\uc744 \uad11\ubc94\uc704\ud558\uac8c \ud3ec\uad04\ud558\ub294 \uc138 \uac00\uc9c0 \ub2e4\ub978 \uc815\ucc45\uc744 \uc815\uc758\ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc815\ucc45\uc740 \ub204\uc801\ub418\uba70 \ub9e4\uc6b0 \ud5c8\uc6a9\uc801\uc778 \uac83\ubd80\ud130 \ub9e4\uc6b0 \uc81c\ud55c\uc801\uc778 \uac83\uae4c\uc9c0 \ub2e4\uc591\ud569\ub2c8\ub2e4.\"</p> <p>\uc774\ub7f0 \uc815\ucc45\uc740 \ub2e4\uc74c\uacfc \uac19\uc774 \uc815\uc758\ub429\ub2c8\ub2e4:</p> <ul> <li> <p>Privileged: \uc81c\ud55c\ub418\uc9c0 \uc54a\uc740(\uc548\uc804\ud558\uc9c0 \uc54a\uc740) \uc815\ucc45\uc73c\ub85c \uac00\ub2a5\ud55c \uac00\uc7a5 \uad11\ubc94\uc704\ud55c \uc218\uc900\uc758 \uad8c\ud55c\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \uc774 \uc815\ucc45\uc740 \uc54c\ub824\uc9c4 \uad8c\ud55c \uc5d0\uc2a4\uceec\ub808\uc774\uc158\uc744 \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \uc815\ucc45\uc774 \uc5c6\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. \uc774\ub294 \ub85c\uae45 \uc5d0\uc774\uc804\ud2b8, CNI, \uc2a4\ud1a0\ub9ac\uc9c0 \ub4dc\ub77c\uc774\ubc84 \ubc0f \uad8c\ud55c \uc561\uc138\uc2a4\uac00 \ud544\uc694\ud55c \uae30\ud0c0 \uc2dc\uc2a4\ud15c \uc804\uccb4 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \uac19\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \uc801\ud569\ud569\ub2c8\ub2e4.</p> </li> <li> <p>Baseline: \uc54c\ub824\uc9c4 \uad8c\ud55c \uc5d0\uc2a4\uceec\ub808\uc774\uc158\uc744 \ubc29\uc9c0\ud558\ub294 \ucd5c\uc18c \uc81c\ud55c \uc815\ucc45\uc785\ub2c8\ub2e4. \uae30\ubcf8(\ucd5c\uc18c \uc9c0\uc815) \ud30c\ub4dc \uad6c\uc131\uc744 \ud5c8\uc6a9\ud569\ub2c8\ub2e4. \ubca0\uc774\uc2a4\ub77c\uc778 \uc815\ucc45\uc740 hostNetwork, hostPID, hostIPC, hostPath, hostPort\uc758 \uc0ac\uc6a9, Linux \uae30\ub2a5\uc744 \ucd94\uac00 \uc81c\ud55c \ub4f1\uacfc \uac19\uc740 \uae30\ud0c0 \uba87 \uac00\uc9c0 \uc81c\ud55c \uc0ac\ud56d\uc744 \ud3ec\ud568\ud569\ub2c8\ub2e4.</p> </li> <li> <p>Restricted: \ud604\uc7ac \ud30c\ub4dc \uac15\ud654 \ubaa8\ubc94 \uc0ac\ub840\uc5d0 \ub530\ub77c \uc5c4\uaca9\ud558\uac8c \uc81c\ud55c\ub41c \uc815\ucc45\uc785\ub2c8\ub2e4. \uc774 \uc815\ucc45\uc740 \uae30\uc900\uc120\uc5d0\uc11c \uc0c1\uc18d\ub418\uba70 \ub8e8\ud2b8 \ub610\ub294 \ub8e8\ud2b8 \uadf8\ub8f9\uc73c\ub85c \uc2e4\ud589\ud560 \uc218 \uc5c6\ub294 \uac83\uacfc \uac19\uc740 \ucd94\uac00 \uc81c\ud55c \uc0ac\ud56d\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4. \uc81c\ud55c\ub41c \uc815\ucc45\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uae30\ub2a5\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce60 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub4e4\uc740 \uc8fc\ub85c \ubcf4\uc548\uc5d0 \uc911\uc694\ud55c \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uc744 \uc2e4\ud589\ud558\ub294 \uac83\uc744 \ubaa9\ud45c\ub85c \ud569\ub2c8\ub2e4.</p> </li> </ul> <p>\uc774\ub7f0 \uc815\ucc45\uc740 \ud30c\ub4dc \uc2e4\ud589\uc744 \uc704\ud55c \ud504\ub85c\ud30c\uc77c\uc744 \uc815\uc758\ud558\uba70, \uc138 \uac00\uc9c0 \uc218\uc900\uc758 \ud2b9\uad8c(Priviledged) \uc561\uc138\uc2a4\uc5d0\uc11c\ubd80\ud130 \uc81c\ud55c\ub41c(Restricted) \uc561\uc138\uc2a4\ub85c \uc815\ub82c\ub429\ub2c8\ub2e4.</p> <p>PSS\uc5d0\uc11c \uc815\uc758\ud55c \ucee8\ud2b8\ub864\uc744 \uad6c\ud604\ud558\uae30 \uc704\ud574 PSA\ub294 \uc138 \uac00\uc9c0 \ubaa8\ub4dc\ub85c \uc791\ub3d9\ud569\ub2c8\ub2e4.</p> <ul> <li> <p>enforce: \uc815\ucc45\uc744 \uc704\ubc18\ud558\uba74 \ud30c\ub4dc\uac00 \uac70\ubd80\ub429\ub2c8\ub2e4.</p> </li> <li> <p>audit: \uc815\ucc45 \uc704\ubc18\uc740 \uac10\uc0ac \ub85c\uadf8\uc5d0 \uae30\ub85d\ub41c \uc774\ubca4\ud2b8\uc5d0 \ub300\ud55c \uac10\uc0ac \uc5b4\ub178\ud14c\uc774\uc158 \ucd94\uac00\ub97c \ud2b8\ub9ac\uac70\ud558\uc9c0\ub9cc \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 \ud5c8\uc6a9\ub429\ub2c8\ub2e4.</p> </li> <li> <p>warn: \uc815\ucc45\uc744 \uc704\ubc18\ud558\uba74 \uc0ac\uc6a9\uc790\uc5d0\uac8c \uacbd\uace0\uac00 \ud45c\uc2dc\ub418\uc9c0\ub9cc \uadf8\ub807\uc9c0 \uc54a\uc73c\uba74 \ud5c8\uc6a9\ub429\ub2c8\ub2e4.</p> </li> </ul> <p>\uc774\ub7f0 \ubaa8\ub4dc\uc640 \ud504\ub85c\ud30c\uc77c (\uc81c\ud55c) \uc218\uc900\uc740 \uc544\ub798 \uc608\uc640 \uac19\uc774 \ub808\uc774\ube14\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc218\uc900\uc5d0\uc11c \uad6c\uc131\ub429\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/enforce: restricted\n</code></pre> <p>\ub3c5\ub9bd\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc774\ub7f0 \uc791\ub3d9 \ubaa8\ub4dc\ub294 \ub2e4\ub978 \uc0ac\uc6a9\uc790 \uacbd\ud5d8\uc744 \uc81c\uacf5\ud558\ub294 \ub2e4\ub978 \uc751\ub2f5\uc744 \uac16\uc2b5\ub2c8\ub2e4. enforce \ubaa8\ub4dc\ub294 \uac01 podSpec\uc774 \uad6c\uc131\ub41c \uc81c\ud55c \uc218\uc900\uc744 \uc704\ubc18\ud558\ub294 \uacbd\uc6b0 \ud30c\ub4dc\uac00 \uc0dd\uc131\ub418\uc9c0 \uc54a\ub3c4\ub85d \ud569\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \uc774 \ubaa8\ub4dc\uc5d0\uc11c\ub294 PodSpec\uc774 \uc801\uc6a9\ub41c PSS\ub97c \uc704\ubc18\ud558\ub354\ub77c\ub3c4 \ubc30\ud3ec\uc640 \uac19\uc774 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\ub294 \ud30c\ub4dc\uac00 \uc544\ub2cc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac1c\uccb4\uac00 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc801\uc6a9\ub418\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc774 \uacbd\uc6b0 \ubc30\ud3ec\uac00 \uc801\uc6a9\ub418\uc9c0\ub9cc \ud30c\ub4dc\ub294 \uc801\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <p>\uc131\uacf5\uc801\uc73c\ub85c \uc801\uc6a9\ub41c \ub514\ud50c\ub85c\uc774\uba38\ud2b8 \uac1d\uccb4\ub294 \uac1d\uccb4 \ub0b4 \ud30c\ub4dc \uc0dd\uc131 \uc2e4\ud328\uc5d0 \uc18d\ud55c\ub2e4\ub294 \uc989\uac01\uc801\uc778 \ud45c\uc2dc\uac00 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \uc774\ub97c \uc778\uc9c0\ud558\uc9c0 \uc27d\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc704\ubc18 podSpec\uc740 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. <code>kubectl get deploy &lt;DEPLOYMENT_NAME&gt;-oyaml</code>\ub85c \ub514\ud50c\ub85c\uc774\uba3c\ud2b8 \ub9ac\uc18c\uc2a4\ub97c \uac80\uc0ac\ud558\uba74 \uc544\ub798\uc640 \uac19\uc774 \uc2e4\ud328\ud55c \ud30c\ub4dc <code>.status.conditions</code> \uc5d8\ub9ac\uba3c\ud2b8\uc758 \uba54\uc2dc\uc9c0\uac00 \ud45c\uc2dc\ub41c\ub2e4.</p> <pre><code>...\nstatus:\n  conditions:\n    - lastTransitionTime: \"2022-01-20T01:02:08Z\"\n      lastUpdateTime: \"2022-01-20T01:02:08Z\"\n      message: 'pods \"test-688f68dc87-tw587\" is forbidden: violates PodSecurity \"restricted:latest\":\n        allowPrivilegeEscalation != false (container \"test\" must set securityContext.allowPrivilegeEscalation=false),\n        unrestricted capabilities (container \"test\" must set securityContext.capabilities.drop=[\"ALL\"]),\n        runAsNonRoot != true (pod or container \"test\" must set securityContext.runAsNonRoot=true),\n        seccompProfile (pod or container \"test\" must set securityContext.seccompProfile.type\n        to \"RuntimeDefault\" or \"Localhost\")'\n      reason: FailedCreate\n      status: \"True\"\n      type: ReplicaFailure\n...\n</code></pre> <p>audit \ubc0f warn \ubaa8\ub4dc\uc5d0\uc11c \ud30c\ub4dc \uc81c\ud55c\uc740 \uc704\ubc18 \ud30c\ub4dc\uac00 \uc0dd\uc131\ub418\uace0 \uc2dc\uc791\ub418\ub294 \uac83\uc744 \ub9c9\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4 . \uadf8\ub7ec\ub098 \uc774\ub7f0 \ubaa8\ub4dc\uc5d0\uc11c\ub294 API \uc11c\ubc84 \uac10\uc0ac \ub85c\uadf8 \uc774\ubca4\ud2b8\uc5d0 \ub300\ud55c \uac10\uc0ac \uc8fc\uc11d \ubc0f API \uc11c\ubc84 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \ub300\ud55c \uacbd\uace0(\uc608: kubectl )\ub294 \ud30c\ub4dc\uc640 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\ub294 \uac1c\uccb4\uc5d0 \uc704\ubc18\uc774 \uc788\ub294 podSpec\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc744 \ub54c \uac01\uac01 \ud2b8\ub9ac\uac70\ub429\ub2c8\ub2e4. <code>kubectl</code> \uacbd\uace0 \uba54\uc2dc\uc9c0\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>Warning: would violate PodSecurity \"restricted:latest\": allowPrivilegeEscalation != false (container \"test\" must set securityContext.allowPrivilegeEscalation=false), unrestricted capabilities (container \"test\" must set securityContext.capabilities.drop=[\"ALL\"]), runAsNonRoot != true (pod or container \"test\" must set securityContext.runAsNonRoot=true), seccompProfile (pod or container \"test\" must set securityContext.seccompProfile.type to \"RuntimeDefault\" or \"Localhost\")\ndeployment.apps/test created\n</code></pre> <p>PSA audit \ubc0f warn \ubaa8\ub4dc\ub294 \ud074\ub7ec\uc2a4\ud130 \uc791\uc5c5\uc5d0 \ubd80\uc815\uc801\uc778 \uc601\ud5a5\uc744 \uc8fc\uc9c0 \uc54a\uace0 PSS\ub97c \ub3c4\uc785\ud560 \ub54c \uc720\uc6a9\ud569\ub2c8\ub2e4.</p> <p>PSA \uc791\ub3d9 \ubaa8\ub4dc\ub294 \uc0c1\ud638 \ubc30\ud0c0\uc801\uc774\uc9c0 \uc54a\uc73c\uba70 \ub204\uc801 \ubc29\uc2dd\uc73c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc544\ub798\uc5d0\uc11c \ubcfc \uc218 \uc788\ub4ef\uc774 \ub2e8\uc77c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0\uc11c \uc5ec\ub7ec \ubaa8\ub4dc\ub97c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/audit: restricted\n    pod-security.kubernetes.io/enforce: restricted\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>\uc704\uc758 \uc608\uc5d0\uc11c \ubc30\ud3ec\ub97c \uc801\uc6a9\ud560 \ub54c \uc0ac\uc6a9\uc790\uc5d0\uac8c \uce5c\uc219\ud55c \uacbd\uace0 \ubc0f \uac10\uc0ac \uc8fc\uc11d\uc774 \uc81c\uacf5\ub418\ub294 \ubc18\uba74 \uc704\ubc18 \uc801\uc6a9\ub3c4 \ud30c\ub4dc \uc218\uc900\uc5d0\uc11c \uc81c\uacf5\ub429\ub2c8\ub2e4. \uc2e4\uc81c\ub85c \uc5ec\ub7ec PSA \ub808\uc774\ube14\uc740 \uc544\ub798\uc640 \uac19\uc774 \uc11c\ub85c \ub2e4\ub978 \ud504\ub85c\ud30c\uc77c \uc218\uc900\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/enforce: baseline\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>\uc704\uc758 \uc608\uc5d0\uc11c PSA\ub294 baseline \ud504\ub85c\ud30c\uc77c \uc218\uc900\uc744 \ucda9\uc871\ud558\ub294 \ubaa8\ub4e0 \ud30c\ub4dc\uc758 \uc0dd\uc131\uc744 \ud5c8\uc6a9\ud55c \ub2e4\uc74c restricted \ud504\ub85c\ud30c\uc77c \uc218\uc900 \uc744 \uc704\ubc18\ud558\ub294 \ud30c\ub4dc(\ubc0f \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\ub294 \uac1c\uccb4)\ub294 \uacbd\uace0 \ud558\ub3c4\ub85d \uad6c\uc131\ub429\ub2c8\ub2e4. \uc774\ub294 baseline \uc5d0\uc11c restricted \ud504\ub85c\ud30c\uc77c\ub85c \ubcc0\uacbd\ud560 \ub54c \uac00\ub2a5\ud55c \uc601\ud5a5\uc744 \ud655\uc778\ud558\ub294 \ub370 \uc720\uc6a9\ud55c \uc811\uadfc \ubc29\uc2dd\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_6","title":"\uae30\uc874 \ud30c\ub4dc","text":"<p>\uae30\uc874 \ud30c\ub4dc\uac00 \uc788\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uac00 \ub354 \uc81c\ud55c\uc801\uc778 PSS \ud504\ub85c\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\ub3c4\ub85d \uc218\uc815\ub418\uba74 audit \ubc0f warn \ubaa8\ub4dc\uac00 \uc801\uc808\ud55c \uba54\uc2dc\uc9c0\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4. \uadf8\ub7ec\ub098 enforce \ubaa8\ub4dc\ub294 \ud30c\ub4dc\ub97c \uc0ad\uc81c\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uacbd\uace0 \uba54\uc2dc\uc9c0\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>Warning: existing pods in namespace \"policy-test\" violate the new PodSecurity enforce level \"restricted:latest\"\nWarning: test-688f68dc87-htm8x: allowPrivilegeEscalation != false, unrestricted capabilities, runAsNonRoot != true, seccompProfile\nnamespace/policy-test configured\n</code></pre>"},{"location":"ko/security/docs/pods/#exemptions","title":"\uc608\uc678 \ucc98\ub9ac (Exemptions)","text":"<p>PSA\ub294 Exemptions \ub97c \uc0ac\uc6a9\ud558\uc5ec \ub2ec\ub9ac \uc801\uc6a9\ub418\uc5c8\uc744 \ud30c\ub4dc\uc5d0 \ub300\ud55c \uc704\ubc18 \uc9d1\ud589\uc744 \uc81c\uc678\ud569\ub2c8\ub2e4. \uc774\ub7f0 \uba74\uc81c\ub294 \uc544\ub798\uc5d0 \ub098\uc5f4\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p> <ul> <li> <p>Usernames: \uc608\uc678 \ucc98\ub9ac\ub41c \uc778\uc99d(\ub610\ub294 \uc0ac\uce6d) \uc0ac\uc6a9\uc790 \uc774\ub984\uc744 \uac00\uc9c4 \uc0ac\uc6a9\uc790\uc758 \uc694\uccad\uc740 \ubb34\uc2dc\ub429\ub2c8\ub2e4.</p> </li> <li> <p>RuntimeClassNames: \uc608\uc678 \ucc98\ub9ac\ub41c \ub7f0\ud0c0\uc784 \ud074\ub798\uc2a4 \uc774\ub984\uc744 \uc9c0\uc815\ud558\ub294 \ud30c\ub4dc \ubc0f \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\ub294 \ubb34\uc2dc\ub429\ub2c8\ub2e4.</p> </li> <li> <p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4: \uc608\uc678 \ucc98\ub9ac\ub41c \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \ud30c\ub4dc \ubc0f \uc6cc\ud06c\ub85c\ub4dc \ub9ac\uc18c\uc2a4\ub294 \ubb34\uc2dc\ub429\ub2c8\ub2e4.</p> </li> </ul> <p>\uc774\ub7f0 \uc608\uc678 \ucc98\ub9ac\ub294 PSA \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec \uad6c\uc131\uc5d0\uc11c \ub2e4\uc74c\uacfc \uac19\uc774 API \uc11c\ubc84 \uad6c\uc131\uc758 \uc77c\ubd80\ub85c \uc815\uc801\uc73c\ub85c \uc801\uc6a9\ub429\ub2c8\ub2e4.</p> <p>Validating Webhook \uad6c\ud604\uc5d0\uc11c \uc608\uc678\ub294 pod-security-webhook \ucee8\ud14c\uc774\ub108 \ub0b4 \ubcfc\ub968\uc73c\ub85c \ub9c8\uc6b4\ud2b8\ub418\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud53c\uadf8\ub9f5 \ub9ac\uc18c\uc2a4 \ub0b4\uc5d0\uc11c \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: pod-security-webhook\n  namespace: pod-security-webhook\ndata:\n  podsecurityconfiguration.yaml: |\n    apiVersion: pod-security.admission.config.k8s.io/v1\n    kind: PodSecurityConfiguration\n    defaults:\n      enforce: \"restricted\"\n      enforce-version: \"latest\"\n      audit: \"restricted\"\n      audit-version: \"latest\"\n      warn: \"restricted\"\n      warn-version: \"latest\"\n    exemptions:\n      # Array of authenticated usernames to exempt.\n      usernames: []\n      # Array of runtime class names to exempt.\n      runtimeClasses: []\n      # Array of namespaces to exempt.\n      namespaces: [\"kube-system\",\"policy-test1\"]\n</code></pre> <p>\uc704\uc758 \ucee8\ud53c\uadf8\ub9f5 YAML\uc5d0\uc11c \ubcfc \uc218 \uc788\ub4ef\uc774 audit , enforce \ubc0f warn \uc640 \uac19\uc740 \ubaa8\ub4e0 PSA \ubaa8\ub4dc\uc5d0 \ub300\ud55c \ud074\ub7ec\uc2a4\ud130 \uc804\uccb4\uc758 \uae30\ubcf8 PSS \uc218\uc900\uc740  restricted \ub85c \uc124\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc774\ub294 \uc608\uc678\uc778 <code>namespaces: [\"kube-system\",\"policy-test1\"]</code> \uc744 \uc81c\uc678\ud55c \ubaa8\ub4e0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce69\ub2c8\ub2e4 . \ub610\ud55c \uc544\ub798\uc5d0 \ud45c\uc2dc\ub41c ValidatingWebhookConfiguration \ub9ac\uc18c\uc2a4\uc5d0\uc11c pod-security-webhook \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub3c4 \uad6c\uc131\ub41c PSS\uc5d0\uc11c \uc81c\uc678\ub429\ub2c8\ub2e4.</p> <pre><code>...\nwebhooks:\n  # Audit annotations will be prefixed with this name\n  - name: \"pod-security-webhook.kubernetes.io\"\n    # Fail-closed admission webhooks can present operational challenges.\n    # You may want to consider using a failure policy of Ignore, but should \n    # consider the security tradeoffs.\n    failurePolicy: Fail\n    namespaceSelector:\n      # Exempt the webhook itself to avoid a circular dependency.\n      matchExpressions:\n        - key: kubernetes.io/metadata.name\n          operator: NotIn\n          values: [\"pod-security-webhook\"]\n...\n</code></pre> <p>Attention</p> <p>\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc5b4\ub4dc\ubbf8\uc158\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 v1.25\uc5d0\uc11c \uc548\uc815 \ubc84\uc804\uc73c\ub85c \uc804\ud658\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc5b4\ub4dc\ubbf8\uc158 \uae30\ub2a5\uc774 \uae30\ubcf8\uc801\uc73c\ub85c \ud65c\uc131\ud654\ub418\uae30 \uc804\uc5d0 \uc0ac\uc6a9\ud558\ub824\uba74 \ub3d9\uc801 \uc5b4\ub4dc\ubbf8\uc158 \ucee8\ud2b8\ub864\ub7ec (\ubba4\ud14c\uc774\ud305 \uc6f9\ud6c5) \ub97c \uc124\uce58\ud574\uc57c \ud588\uc2b5\ub2c8\ub2e4. \uc6f9\ud6c5 \uc124\uce58 \ubc0f \uad6c\uc131 \uc9c0\uce68\uc740 \ubcf8 \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#pacpolicy-as-code-pss","title":"PAC(Policy-as-Code)\uacfc \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc \uc911\uc5d0\uc11c(PSS) \uc120\ud0dd","text":"<p>\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS)\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0 \ub0b4\uc7a5\ub418\uc5b4 \uc788\uace0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc5d0\ucf54\uc2dc\uc2a4\ud15c\uc758 \uc194\ub8e8\uc158\uc774 \ud544\uc694\ud558\uc9c0 \uc54a\uc740 \uc194\ub8e8\uc158\uc744 \uc81c\uacf5\ud568\uc73c\ub85c\uc368 \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \ud3f4\ub9ac\uc2dc(PSP)\uc744 \ub300\uccb4\ud558\uae30 \uc704\ud574 \uac1c\ubc1c\ub418\uc5c8\uc2b5\ub2c8\ub2e4. PAC(Policy-as-Code) \uc194\ub8e8\uc158\uc740 \ud6e8\uc52c \ub354 \uc720\uc5f0\ud569\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uc7a5\ub2e8\uc810 \ubaa9\ub85d\uc740 \ud30c\ub4dc \ubcf4\uc548 \uc194\ub8e8\uc158\uc5d0 \ub300\ud574 \uc815\ubcf4\uc5d0 \uc785\uac01\ud55c \uacb0\uc815\uc744 \ub0b4\ub9ac\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub418\ub3c4\ub85d \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#pac_1","title":"PAC (\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc\uacfc \ube44\uad50)","text":"<p>\uc7a5\uc810:</p> <ul> <li>\ubcf4\ub2e4 \uc720\uc5f0\ud558\uace0 \uc138\ubd84\ud654\ub428(\ud544\uc694\ud55c \uacbd\uc6b0 \ub9ac\uc18c\uc2a4 \uc18d\uc131\uae4c\uc9c0)</li> <li>\ud30c\ub4dc\uc5d0\ub9cc \uc9d1\uc911\ud558\ub294 \uac83\uc774 \uc544\ub2c8\ub77c \ub2e4\uc591\ud55c \ub9ac\uc18c\uc2a4 \ubc0f \uc561\uc158\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc74c</li> <li>\ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc218\uc900\uc5d0\uc11c\ub9cc \uc801\uc6a9\ub418\uc9c0 \uc54a\uc74c</li> <li>\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc\ubcf4\ub2e4 \ub354 \uc131\uc219\ud568</li> <li>\uc758\uc0ac\uacb0\uc815\uc740 \uae30\uc874 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4 \ubc0f \uc678\ubd80 \ub370\uc774\ud130(\uc194\ub8e8\uc158\uc5d0 \ub530\ub77c \ub2e4\ub984)\ubfd0\ub9cc \uc544\ub2c8\ub77c API \uc11c\ubc84 \uc694\uccad \ud398\uc774\ub85c\ub4dc\uc758 \ubaa8\ub4e0 \ud56d\ubaa9\uc744 \uae30\ubc18\uc73c\ub85c \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\uc720\ud6a8\uc131 \uac80\uc0ac \uc804\uc5d0 API \uc11c\ubc84 \uc694\uccad \ubcc0\uacbd \uc9c0\uc6d0(\uc194\ub8e8\uc158\uc5d0 \ub530\ub77c \ub2e4\ub984)</li> <li>\ubcf4\uc644 \uc815\ucc45 \ubc0f \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4 \uc0dd\uc131 \uac00\ub2a5 (\uc194\ub8e8\uc158\uc5d0 \ub530\ub77c \ub2e4\ub984 - Kyverno\ub294 \ud30c\ub4dc \uc815\ucc45\uc5d0\uc11c \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc640 \uac19\uc740 \uc0c1\uc704 \ub808\ubca8 \ucee8\ud2b8\ub864\ub7ec\uc5d0 \ub300\ud55c \uc815\ucc45\uc744 \uc790\ub3d9 \uc0dd\uc131\ud560 \uc218 \uc788\ub2e4. \ub610\ud55c Kyverno\ub294 Generate Rules \ub97c \uc0ac\uc6a9\ud558\uc5ec \"\uc0c8 \ub9ac\uc18c\uc2a4\uac00 \uc0dd\uc131\ub418\uac70\ub098 \uc18c\uc2a4\uac00 \uc5c5\ub370\uc774\ud2b8\ub420 \ub54c\" \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4\ub97c \ucd94\uac00\ub85c \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.)</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\ub97c \ud638\ucd9c\ud558\uae30 \uc804\uc5d0 CICD \ud30c\uc774\ud504\ub77c\uc778\uc0c1\uc5d0\uc11c \ubcf4\ub2e4 \ube60\ub974\uac8c \ubcf4\uc548\uc744 \ub3c4\uc785\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(\uc194\ub8e8\uc158\uc5d0 \ub530\ub77c \ub2e4\ub984).</li> <li>\ubaa8\ubc94 \uc0ac\ub840, \uc870\uc9c1 \ud45c\uc900 \ub4f1\uacfc \uac19\uc774 \ubc18\ub4dc\uc2dc \ubcf4\uc548\uacfc \uad00\ub828\ub418\uc9c0 \uc54a\uc740 \ub3d9\uc791\uc744 \uad6c\ud604\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc774\uc678\uc758 \uc0ac\uc6a9 \uc0ac\ub840\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5(\uc194\ub8e8\uc158\uc5d0 \ub530\ub77c \ub2e4\ub984)</li> <li>\uc720\uc5f0\uc131\uc73c\ub85c \uc778\ud574 \uc0ac\uc6a9\uc790 \uacbd\ud5d8\uc744 \uc0ac\uc6a9\uc790\uc758 \uc694\uad6c\uc5d0 \ub9de\uac8c \uc870\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> </ul> <p>\ub2e8\uc810:</p> <ul> <li>Kubernetes\uc5d0 \ube4c\ud2b8\uc778\uc73c\ub85c \uc81c\uacf5\ub418\uc9c0 \uc54a\uc74c</li> <li>\ud559\uc2b5, \uad6c\uc131 \ubc0f \uc9c0\uc6d0\uc774 \ub354 \ubcf5\uc7a1\ud568</li> <li>\uc815\ucc45 \uc791\uc131\uc5d0\ub294 \uc0c8\ub85c\uc6b4 \uae30\uc220/\uc5b8\uc5b4/\uae30\ub2a5\uc774 \ud544\uc694\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/pods/#pac_2","title":"\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc5b4\ub4dc\ubbf8\uc158(PAC\uacfc \ube44\uad50)","text":"<p>\uc7a5\uc810:</p> <ul> <li>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ube4c\ud2b8\uc778 \uc81c\uacf5</li> <li>\ub354 \uac04\ub2e8\ud55c \uad6c\uc131</li> <li>\uc0ac\uc6a9\ud560 \uc0c8\ub85c\uc6b4 \uc5b8\uc5b4\ub098 \uc791\uc131\ud560 \uc815\ucc45\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.</li> <li>\ud074\ub7ec\uc2a4\ud130 \uae30\ubcf8 \uc2b9\uc778 \uc218\uc900\uc774 privileged \ub85c \uad6c\uc131\ub41c \uacbd\uc6b0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub808\uc774\ube14\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc \ubcf4\uc548 \ud504\ub85c\ud30c\uc77c\uc5d0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc635\ud2b8\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> </ul> <p>\ub2e8\uc810:</p> <ul> <li>Policy-as-Code\ub9cc\ud07c \uc720\uc5f0\ud558\uac70\ub098 \uc138\ubd84\ud654\ub418\uc9c0 \uc54a\uc74c</li> <li>3\uac1c \ub2e8\uacc4\uc758 \uc81c\ud55c \ubc29\uc2dd \uc81c\uacf5</li> <li>\uc8fc\ub85c \ud30c\ub4dc\uc5d0 \uc9d1\uc911</li> </ul>"},{"location":"ko/security/docs/pods/#_7","title":"\uc694\uc57d","text":"<p>\ud604\uc7ac PSP \uc774\uc678\uc758 \ud30c\ub4dc \ubcf4\uc548 \uc194\ub8e8\uc158\uc774 \uc5c6\uace0 \ud544\uc694\ud55c \ud30c\ub4dc \ubcf4\uc548 \ud0dc\uc138\uac00 \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS) \uc5d0 \uc815\uc758\ub41c \ubaa8\ub378\uc5d0 \ub9de\ub294\ub2e4\uba74 PAC \uc194\ub8e8\uc158 \ub300\uc2e0 PSS\ub97c \ucc44\ud0dd\ud558\ub294 \uac83\uc774 \ub354 \uc26c\uc6b8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\ub098 \ud30c\ub4dc \ubcf4\uc548 \ud0dc\uc138\uac00 PSS \ubaa8\ub378\uc5d0 \ub9de\uc9c0 \uc54a\uac70\ub098 PSS\uc5d0\uc11c \uc815\uc758\ud55c \uac83 \uc678\uc5d0 \ucd94\uac00 \uc81c\uc5b4\ub97c \ucd94\uac00\ud560 \uacc4\ud68d\uc774\ub77c\uba74 PAC \uc194\ub8e8\uc158\uc774 \ub354 \uc801\ud569\ud574 \ubcf4\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_8","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/pods/#psa","title":"\ub354 \ub098\uc740 \uc0ac\uc6a9\uc790 \uacbd\ud5d8\uc744 \uc704\ud574 \uc5ec\ub7ec \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc5b4\ub4dc\ubbf8\uc158(PSA) \ubaa8\ub4dc \uc0ac\uc6a9","text":"<p>\uc55e\uc11c \uc5b8\uae09\ud588\ub4ef\uc774 PSA enforce \ubaa8\ub4dc\ub294 PSS \uc704\ubc18\uc774 \uc788\ub294 \ud30c\ub4dc\uac00 \uc801\uc6a9\ub418\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\uc9c0\ub9cc \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc640 \uac19\uc740 \uc0c1\uc704 \uc218\uc900 \ucee8\ud2b8\ub864\ub7ec\ub97c \uc911\uc9c0\ud558\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \uc2e4\uc81c\ub85c \ud30c\ub4dc \uc801\uc6a9\uc5d0 \uc2e4\ud328\ud588\ub2e4\ub294 \ud45c\uc2dc \uc5c6\uc774 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uac00 \uc131\uacf5\uc801\uc73c\ub85c \uc801\uc6a9\ub429\ub2c8\ub2e4. kubectl \uc744 \uc0ac\uc6a9 \ud558\uc5ec \ub514\ud50c\ub85c\uc774\uba3c\ud2b8 \uac1d\uccb4\ub97c \uac80\uc0ac\ud558\uace0 PSA\uc5d0\uc11c \uc2e4\ud328\ud55c \ud30c\ub4dc \uba54\uc2dc\uc9c0\ub97c \uac80\uc0c9\ud560 \uc218 \uc788\uc9c0\ub9cc \uc0ac\uc6a9\uc790 \uacbd\ud5d8\uc774 \ub354 \uc88b\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9\uc790 \uacbd\ud5d8\uc744 \uac1c\uc120\ud558\ub824\uba74 \uc5ec\ub7ec PSA \ubaa8\ub4dc(audit, enforce, warn)\ub97c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/audit: restricted\n    pod-security.kubernetes.io/enforce: restricted\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>\uc704\uc758 \uc608\uc5d0\uc11c enforce \ubaa8\ub4dc\uac00 \uc815\uc758\ub41c \uacbd\uc6b0 \uac01 podSpec\uc5d0\uc11c PSS \uc704\ubc18\uc774 \uc788\ub294 \ubc30\ud3ec \ub9e4\ub2c8\ud398\uc2a4\ud2b8\ub97c \ucfe0\ubc84\ub124\ud2f0\uc2a4 API \uc11c\ubc84\uc5d0 \uc801\uc6a9\ud558\ub824\uace0 \ud558\uba74 \ubc30\ud3ec\uac00 \uc131\uacf5\uc801\uc73c\ub85c \uc801\uc6a9\ub418\uc9c0\ub9cc \ud30c\ub4dc\ub294 \uc801\uc6a9\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uadf8\ub9ac\uace0 audit \ubc0f warn \ubaa8\ub4dc\ub3c4 \ud65c\uc131\ud654\ub418\uc5b4 \uc788\uc73c\ubbc0\ub85c API \uc11c\ubc84 \ud074\ub77c\uc774\uc5b8\ud2b8\ub294 \uacbd\uace0 \uba54\uc2dc\uc9c0\ub97c \uc218\uc2e0\ud558\uace0 API \uc11c\ubc84 \uac10\uc0ac \ub85c\uadf8 \uc774\ubca4\ud2b8\uc5d0\ub3c4 \uba54\uc2dc\uc9c0\uac00 \ud45c\uc2dc\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#previleged","title":"Previleged \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \ucee8\ud14c\uc774\ub108 \uc81c\ud55c","text":"<p>\uc5b8\uae09\ud55c \ubc14\uc640 \uac19\uc774 Previleged \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\ub418\ub294 \ucee8\ud14c\uc774\ub108\ub294 \ud638\uc2a4\ud2b8\uc758 \ub8e8\ud2b8\uc5d0 \ud560\ub2f9\ub41c \ubaa8\ub4e0 Linux \uae30\ub2a5\uc744 \uc0c1\uc18d\ud569\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\uac00 \uc81c\ub300\ub85c \uc791\ub3d9\ud558\uae30 \uc704\ud574 \uc774\ub7f0 \uc720\ud615\uc758 \uad8c\ud55c\uc774 \ud544\uc694\ud55c \uacbd\uc6b0\ub294 \uac70\uc758 \uc5c6\uc2b5\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\uc758 \uad8c\ud55c\uacfc \uae30\ub2a5\uc744 \uc81c\ud55c\ud558\ub294 \ub370 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc5ec\ub7ec \uac00\uc9c0 \ubc29\ubc95\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>Fargate\ub294 \ud30c\ub4dc\uc758 \ucee8\ud14c\uc774\ub108\uac00 AWS\uac00 \uad00\ub9ac\ud558\ub294 \uc778\ud504\ub77c\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \"\uc11c\ubc84\ub9ac\uc2a4\"\ud615\ud0dc\ub85c \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. Fargate\ub97c \uc0ac\uc6a9\ud558\uba74 Previleged \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud558\uac70\ub098 hostNetwork \ub610\ub294 hostPort\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d \ud30c\ub4dc\ub97c \uad6c\uc131\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_9","title":"\ucee8\ud14c\uc774\ub108\uc5d0\uc11c \ub8e8\ud2b8\ub85c \ud504\ub85c\uc138\uc2a4\ub97c \uc2e4\ud589\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624","text":"<p>\ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ub8e8\ud2b8\ub85c \uc2e4\ud589\ub429\ub2c8\ub2e4. \uc774\ub294 \uacf5\uaca9\uc790\uac00 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \ucde8\uc57d\uc131\uc744 \uc545\uc6a9\ud558\uace0 \uc2e4\ud589 \uc911\uc778 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c \uc178 \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \uc5bb\uc744 \uc218 \uc788\ub294 \uacbd\uc6b0 \ubb38\uc81c\uac00 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc591\ud55c \ubc29\ubc95\uc73c\ub85c \uc774 \uc704\ud5d8\uc744 \uc644\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uba3c\uc800 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc5d0\uc11c \uc178(Shell)\uc744 \uc81c\uac70\ud569\ub2c8\ub2e4. \ub458\uc9f8, Dockerfile\uc5d0 USER \uc9c0\uc2dc\ubb38\uc744 \ucd94\uac00\ud558\uac70\ub098 \ub8e8\ud2b8\uac00 \uc544\ub2cc \uc0ac\uc6a9\uc790\ub85c \ud30c\ub4dc\uc758 \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud569\ub2c8\ub2e4. Kubernetes podSpec\uc5d0\ub294 <code>spec.securityContext</code> \uc544\ub798\uc5d0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc2e4\ud589\ud560 \uc0ac\uc6a9\uc790 \ubc0f/\ub610\ub294 \uadf8\ub8f9\uc744 \uc9c0\uc815\ud560 \uc218 \uc788\ub294 \uc77c\ub828\uc758 \ud544\ub4dc\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \ud544\ub4dc\ub294 \uac01\uac01 <code>runAsUser</code> \ubc0f <code>runAsGroup</code> \uc785\ub2c8\ub2e4.</p> <p><code>spec.securityContext</code> \ubc0f \uad00\ub828 \uc694\uc18c \uc758 \uc0ac\uc6a9\uc744 \uac15\uc81c\ud558\uae30 \uc704\ud574 PAC \uc815\ucc45 \ub610\ub294 \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS)\ub97c \ud074\ub7ec\uc2a4\ud130\uc5d0 \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc194\ub8e8\uc158\uc744 \uc0ac\uc6a9\ud558\uba74 etcd\uc5d0 \uc720\uc9c0\ub418\uae30 \uc804\uc5d0 \uc778\ubc14\uc6b4\ub4dc Kubernetes API \uc11c\ubc84 \uc694\uccad \ud398\uc774\ub85c\ub4dc\ub97c \uac80\uc99d\ud560 \uc218 \uc788\ub294 \uc815\ucc45 \ub610\ub294 \ud504\ub85c\ud30c\uc77c\uc744 \uc791\uc131 \ubc0f/\ub610\ub294 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c PAC \uc194\ub8e8\uc158\uc740 \uc778\ubc14\uc6b4\ub4dc \uc694\uccad\uc744 \ubcc0\uacbd\ud558\uace0 \uacbd\uc6b0\uc5d0 \ub530\ub77c \uc0c8 \uc694\uccad\uc744 \uc0dd\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#docker-docker","title":"Docker\uc5d0\uc11c Docker\ub97c \uc2e4\ud589\ud558\uac70\ub098 \ucee8\ud14c\uc774\ub108\uc5d0 \uc18c\ucf13\uc744 \ub9c8\uc6b4\ud2b8\ud558\uc9c0 \ub9c8\uc2ed\uc2dc\uc624","text":"<p>\uc774\ub807\uac8c \ud558\uba74 \ud3b8\ub9ac\ud558\uac8c Docker \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc774\ubbf8\uc9c0\ub97c \ube4c\ub4dc/\uc2e4\ud589\ud560 \uc218 \uc788\uc9c0\ub9cc \uae30\ubcf8\uc801\uc73c\ub85c \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ud504\ub85c\uc138\uc2a4\uc5d0 \ub300\ud55c \ub178\ub4dc\uc758 \uc644\uc804\ud55c \uc81c\uc5b4\ub97c \uc591\ub3c4\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \ube4c\ub4dc\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 Kaniko, buildah, img \ub610\ub294 CodeBuild \uac19\uc740 \ube4c\ub4dc \uc11c\ube44\uc2a4 \ub97c \ub300\uc2e0 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Tip</p> <p>\ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \ube4c\ub4dc\uc640 \uac19\uc740 CICD \ucc98\ub9ac\uc5d0 \uc0ac\uc6a9\ub418\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\ub294 \ubcf4\ub2e4 \uc77c\ubc18\ud654\ub41c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2e4\ud589\ud558\ub294 \ud074\ub7ec\uc2a4\ud130\uc640 \uaca9\ub9ac\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#hostpath-hostpath","title":"hostPath \uc0ac\uc6a9\uc744 \uc81c\ud55c\ud558\uac70\ub098 hostPath\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc811\ub450\uc0ac\ub97c \uc81c\ud55c\ud558\uace0 \ubcfc\ub968\uc744 \uc77d\uae30 \uc804\uc6a9\uc73c\ub85c \uad6c\uc131\ud569\ub2c8\ub2e4","text":"<p><code>hostPath</code> \ub294 \ud638\uc2a4\ud2b8\uc5d0\uc11c \ucee8\ud14c\uc774\ub108\ub85c \uc9c1\uc811 \ub514\ub809\ud1a0\ub9ac\ub97c \ub9c8\uc6b4\ud2b8\ud558\ub294 \ubcfc\ub968\uc785\ub2c8\ub2e4. \ud30c\ub4dc\uc5d0 \uc774\ub7f0 \uc720\ud615\uc758 \uc561\uc138\uc2a4\uac00 \ud544\uc694\ud55c \uacbd\uc6b0\ub294 \uac70\uc758 \uc5c6\uc9c0\ub9cc \ud544\uc694\ud55c \uacbd\uc6b0 \uc704\ud5d8\uc744 \uc778\uc2dd\ud574\uc57c \ud569\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \ub8e8\ud2b8\ub85c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\ub294 hostPath\uc5d0 \uc758\ud574 \ub178\ucd9c\ub41c \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0 \ub300\ud55c \uc4f0\uae30 \uc561\uc138\uc2a4 \uad8c\ud55c\uc744 \uac16\uc2b5\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \uacf5\uaca9\uc790\ub294 kubelet \uc124\uc815\uc744 \uc218\uc815\ud558\uace0, /etc/shadow\uc640 \uac19\uc774 hostPath\uc5d0 \uc758\ud574 \uc9c1\uc811 \ub178\ucd9c\ub418\uc9c0 \uc54a\ub294 \ub514\ub809\ud1a0\ub9ac \ub610\ub294 \ud30c\uc77c\uc5d0 \ub300\ud55c \uc2ec\ubcfc\ub9ad \ub9c1\ud06c\ub97c \uc0dd\uc131\ud558\uace0, ssh \ud0a4\ub97c \uc124\uce58\ud558\uace0, \ud638\uc2a4\ud2b8\uc5d0 \ub9c8\uc6b4\ud2b8\ub41c \ube44\ubc00\uc744 \uc77d\uace0, \uae30\ud0c0 \uc545\uc758\uc801\uc778 \uac83\ub4e4\uc744 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. hostPath\uc758 \uc704\ud5d8\uc744 \uc644\ud654\ud558\ub824\uba74 <code>spec.containers.volumeMounts</code> \ub97c <code>readOnly</code> \ub85c \uad6c\uc131\ud558\uc2ed\uc2dc\uc624. \uc608\ub97c \ub4e4\uba74 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p> <pre><code>volumeMounts:\n- name: hostPath-volume\n    readOnly: true\n    mountPath: /host-path\n</code></pre> <p>\ub610\ud55c PAC \uc194\ub8e8\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec <code>hostPath</code> \ubcfc\ub968\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \ub514\ub809\ud1a0\ub9ac\ub97c \uc81c\ud55c\ud558\uac70\ub098 <code>hostPath</code> \uc0ac\uc6a9\uc744 \ubaa8\ub450 \ubc29\uc9c0\ud574\uc57c \ud569\ub2c8\ub2e4. \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc Baseline \ub610\ub294 Restricted \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec <code>hostPath</code> \uc0ac\uc6a9\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uad8c\ud55c \uc0c1\uc2b9\uc758 \uc704\ud5d8\uc131\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Seth Art\uc758 \ube14\ub85c\uadf8 Bad Pods: Kubernetes Pod Privilege Escalation\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/pods/#dos","title":"\ub9ac\uc18c\uc2a4 \uacbd\ud569 \ubc0f DoS \uacf5\uaca9\uc744 \ud53c\ud558\uae30 \uc704\ud574 \uac01 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c \uc694\uccad \ubc0f \uc81c\ud55c \uc124\uc815","text":"<p>\uc694\uccad\uc774\ub098 \uc81c\ud55c\uc774 \uc5c6\ub294 \ud30c\ub4dc\ub294 \uc774\ub860\uc801\uc73c\ub85c \ud638\uc2a4\ud2b8\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ubaa8\ub4e0 \ub9ac\uc18c\uc2a4\ub97c \uc18c\ube44\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd94\uac00 \ud30c\ub4dc\uac00 \ub178\ub4dc\uc5d0 \uc608\uc57d\ub418\uba74 \ub178\ub4dc\uc5d0\uc11c CPU \ub610\ub294 \uba54\ubaa8\ub9ac \uc555\ub825\uc774 \ubc1c\uc0dd\ud558\uc5ec Kubelet\uc774 \uc885\ub8cc\ub418\uac70\ub098 \ub178\ub4dc\uc5d0\uc11c \ud30c\ub4dc\uac00 \uc81c\uac70\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc77c\uc774 \ud568\uaed8 \ubc1c\uc0dd\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218\ub294 \uc5c6\uc9c0\ub9cc \uc694\uccad \ubc0f \uc81c\ud55c\uc744 \uc124\uc815\ud558\uba74 \ub9ac\uc18c\uc2a4 \uacbd\ud569\uc744 \ucd5c\uc18c\ud654\ud558\uace0 \ub9ac\uc18c\uc2a4\ub97c \uacfc\ub3c4\ud558\uac8c \uc18c\ube44\ud558\ub294 \uc798\ubabb \uc791\uc131\ub41c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc73c\ub85c \uc778\ud55c \uc704\ud5d8\uc744 \uc644\ud654\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub429\ub2c8\ub2e4.</p> <p><code>podSpec</code> \uc744 \uc0ac\uc6a9\ud558\uba74 CPU \ubc0f \uba54\ubaa8\ub9ac\uc5d0 \ub300\ud55c \uc694\uccad \ubc0f \uc81c\ud55c\uc744 \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CPU\ub294 \ucd08\uacfc \uc2e0\uccad\ub420 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc555\ucd95 \uac00\ub2a5\ud55c \ub9ac\uc18c\uc2a4\ub85c \uac04\uc8fc\ub429\ub2c8\ub2e4. \uba54\ubaa8\ub9ac\ub294 \uc555\ucd95\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uc989, \uc5ec\ub7ec \ucee8\ud14c\uc774\ub108 \uac04\uc5d0 \uacf5\uc720\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</p> <p>CPU \ub610\ub294 \uba54\ubaa8\ub9ac\uc5d0 \ub300\ud574 requests \ub97c \uc9c0\uc815\ud560 \ub54c \ubcf8\uc9c8\uc801\uc73c\ub85c \ucee8\ud14c\uc774\ub108\uac00 \ud655\ubcf4\ud560 \uc218 \uc788\ub294 memory \uc758 \uc591\uc744 \uc9c0\uc815\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. Kubernetes\ub294 \ud30c\ub4dc\uc5d0 \uc788\ub294 \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\uc758 \uc694\uccad\uc744 \uc9d1\uacc4\ud558\uc5ec \ud30c\ub4dc\ub97c \uc608\uc57d\ud560 \ub178\ub4dc\ub97c \uacb0\uc815\ud569\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\uac00 \uc694\uccad\ub41c \uba54\ubaa8\ub9ac \uc591\uc744 \ucd08\uacfc\ud558\uba74 \ub178\ub4dc\uc5d0 \uba54\ubaa8\ub9ac \uc555\ub825\uc774 \uc788\uc73c\uba74 \uc885\ub8cc\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Limits \ub294 \ucee8\ud14c\uc774\ub108\uac00 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 CPU \ubc0f \uba54\ubaa8\ub9ac \ub9ac\uc18c\uc2a4\uc758 \ucd5c\ub300\ub7c9\uc774\uba70 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud574 \uc0dd\uc131\ub41c cgroup \uc758 <code>memory.limit_in_bytes</code> \uac12\uc5d0 \uc9c1\uc811 \ud574\ub2f9\ud569\ub2c8\ub2e4. \uba54\ubaa8\ub9ac \uc81c\ud55c\uc744 \ucd08\uacfc\ud558\ub294 \ucee8\ud14c\uc774\ub108\ub294 OOM \uc885\ub8cc\ub429\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\uac00 CPU \uc81c\ud55c\uc744 \ucd08\uacfc\ud558\uba74 \uc81c\ud55c\ub429\ub2c8\ub2e4.</p> <p>Tip</p> <p>\ucee8\ud14c\uc774\ub108 <code>resources.limits</code>\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \ucee8\ud14c\uc774\ub108 \ub9ac\uc18c\uc2a4 \uc0ac\uc6a9\ub7c9(\ub9ac\uc18c\uc2a4 \ud48b\ud504\ub9b0\ud2b8\ub77c\uace0\ub3c4 \ud568)\uc740 \ubd80\ud558 \ud14c\uc2a4\ud2b8\ub97c \uae30\ubc18\uc73c\ub85c \ub370\uc774\ud130 \uae30\ubc18\uc774\uace0 \uc815\ud655\ud574\uc57c \ud569\ub2c8\ub2e4. \uc815\ud655\ud558\uace0 \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \ub9ac\uc18c\uc2a4 \uacf5\uac04\uc774 \uc5c6\uc73c\uba74 \ucee8\ud14c\uc774\ub108 'resources.limits'\ub97c \ucc44\uc6b8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 'resources.limits.memory'\ub294 \uc7a0\uc7ac\uc801\uc778 \uba54\ubaa8\ub9ac \ub9ac\uc18c\uc2a4 \uc81c\ud55c \ubd80\uc815\ud655\uc131\uc744 \uc124\uba85\ud558\uae30 \uc704\ud574 \uad00\ucc30 \uac00\ub2a5\ud55c \ucd5c\ub300\uac12\ubcf4\ub2e4 20-30% \ub192\uac8c \ud328\ub529\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Kubernetes\ub294 \uc138 \uac00\uc9c0 \uc11c\ube44\uc2a4 \ud488\uc9c8(QoS) \ud074\ub798\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc758 \uc6b0\uc120 \uc21c\uc704\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc5d0\ub294 \ub2e4\uc74c\uc774 \ud3ec\ud568\ub429\ub2c8\ub2e4.</p> <ul> <li>guaranteed</li> <li>burstable</li> <li>best-effort</li> </ul> <p>\uc81c\ud55c \ubc0f \uc694\uccad\uc774 \uc124\uc815\ub418\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \ud30c\ub4dc\ub294 best-effort (\uac00\uc7a5 \ub0ae\uc740 \uc6b0\uc120 \uc21c\uc704)\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. Best-effort \ud30c\ub4dc\ub294 \uba54\ubaa8\ub9ac\uac00 \ubd80\uc871\ud560 \ub54c \uac00\uc7a5 \uba3c\uc800 \uc885\ub8cc\ub429\ub2c8\ub2e4. \ud30c\ub4dc \ub0b4\uc758 all \ucee8\ud14c\uc774\ub108 \uc5d0 \uc81c\ud55c\uc774 \uc124\uc815 \ub418\uac70\ub098 \uc694\uccad \ubc0f \uc81c\ud55c\uc774 \ub3d9\uc77c\ud55c \uac12\uc73c\ub85c \uc124\uc815\ub418\uace0 0\uc774 \uc544\ub2cc \uacbd\uc6b0 \ud30c\ub4dc\ub294 guaranteed (\uac00\uc7a5 \ub192\uc740 \uc6b0\uc120 \uc21c\uc704)\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. \ubcf4\uc7a5\ub41c \ud30c\ub4dc\ub294 \uad6c\uc131\ub41c \uba54\ubaa8\ub9ac \uc81c\ud55c\uc744 \ucd08\uacfc\ud558\uc9c0 \uc54a\ub294 \ud55c \uc885\ub8cc\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc81c\ud55c \ubc0f \uc694\uccad\uc774 0\uc774 \uc544\ub2cc \ub2e4\ub978 \uac12\uc73c\ub85c \uad6c\uc131\ub418\uac70\ub098 \ud30c\ub4dc \ub0b4\uc758 \ud55c \ucee8\ud14c\uc774\ub108\uac00 \uc81c\ud55c\uc744 \uc124\uc815\ud558\uace0 \ub2e4\ub978 \ucee8\ud14c\uc774\ub108\ub294 \ub2e4\ub978 \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud574 \uc81c\ud55c\uc774 \uc124\uc815\ub418\uc9c0 \uc54a\uac70\ub098 \uc124\uc815\ub41c \uacbd\uc6b0 \ud30c\ub4dc\ub294 burstable (\uc911\uac04 \uc6b0\uc120 \uc21c\uc704)\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. \uc774\ub7f0 \ud30c\ub4dc\uc5d0\ub294 \uc77c\ubd80 \ub9ac\uc18c\uc2a4 \ubcf4\uc7a5\uc774 \uc788\uc9c0\ub9cc \uc694\uccad\ub41c \uba54\ubaa8\ub9ac\ub97c \ucd08\uacfc\ud558\uba74 \uc885\ub8cc\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>\uc694\uccad\uc740 \ucee8\ud14c\uc774\ub108 cgroup\uc758 <code>memory_limit_in_bytes</code> \uac12\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce58\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. cgroup \uc81c\ud55c\uc740 \ud638\uc2a4\ud2b8\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uba54\ubaa8\ub9ac \uc591\uc73c\ub85c \uc124\uc815\ub429\ub2c8\ub2e4. \uadf8\ub7fc\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 \uc694\uccad \uac12\uc744 \ub108\ubb34 \ub0ae\uac8c \uc124\uc815\ud558\uba74 \ub178\ub4dc\uac00 \uba54\ubaa8\ub9ac \uc555\ub825\uc744 \ubc1b\ub294 \uacbd\uc6b0 \ud30c\ub4dc\uac00 kubelet\uc5d0 \uc758\ud574 \uc885\ub8cc \ub300\uc0c1\uc774 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> \ud074\ub798\uc2a4 \uc6b0\uc120\uc21c\uc704 \uc870\uac74 \uc8fd\uc774\uae30 \uc870\uac74 Guaranteed \ucd5c\uace0 \uc81c\ud55c = \uc694\uccad != 0 \uba54\ubaa8\ub9ac \uc81c\ud55c\ub9cc \ucd08\uacfc Burstable \uc911\uac04 \uc81c\ud55c != \uc694\uccad != 0 \uc694\uccad \uba54\ubaa8\ub9ac\ub97c \ucd08\uacfc\ud558\uba74 \uc885\ub8cc\ub428 Best-Effort \ucd5c\uc800 \ud55c\ub3c4 \ubc0f \uc694\uccad\uc774 \uc124\uc815\ub418\uc9c0 \uc54a\uc74c \uba54\ubaa8\ub9ac\uac00 \ubd80\uc871\ud560 \ub54c \uac00\uc7a5 \uba3c\uc800 \uac15\uc81c \uc885\ub8cc\ub428 <p>\ub9ac\uc18c\uc2a4 QoS\uc5d0 \ub300\ud55c \ucd94\uac00 \uc815\ubcf4\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>\ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ub9ac\uc18c\uc2a4 \ud560\ub2f9\ub7c9\uc744 \uc124\uc815\ud558\uac70\ub098 \uc81c\ud55c \ubc94\uc704\ub97c \uc0dd\uc131\ud558\uc5ec \ub9ac\uc18c\uc2a4 \uc694\uccad(request) \ubc0f \ub9ac\uc18c\uc2a4 \uc81c\ud55c(limit)\uc744 \uac15\uc81c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub9ac\uc18c\uc2a4 \ud560\ub2f9\ub7c9\uc744 \uc0ac\uc6a9\ud558\uba74 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ub41c \ucd1d \ub9ac\uc18c\uc2a4 \uc591 (\uc608: CPU \ubc0f RAM)\uc744 \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \uc801\uc6a9\ud558\uba74 \ud574\ub2f9 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ubc30\ud3ec\ub41c \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c \ub9ac\uc18c\uc2a4 \uc694\uccad \ubc0f \ub9ac\uc18c\uc2a4 \uc81c\ud55c\uc744 \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \ubc18\ub300\ub85c \uc81c\ud55c \ubc94\uc704\ub97c \uc0ac\uc6a9\ud558\uba74 \ub9ac\uc18c\uc2a4 \ud560\ub2f9\uc744 \ub354 \uc138\ubc00\ud558\uac8c \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc81c\ud55c \ubc94\uc704\ub97c \uc0ac\uc6a9\ud558\uba74 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4 \ud30c\ub4dc \ub610\ub294 \ucee8\ud14c\uc774\ub108\ub2f9 CPU \ubc0f \uba54\ubaa8\ub9ac \ub9ac\uc18c\uc2a4\ub97c \ucd5c\uc18c/\ucd5c\ub300\ub85c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uae30\ubcf8 \ub9ac\uc18c\uc2a4 \uc694\uccad(request)/\ub9ac\uc18c\uc2a4 \uc81c\ud55c(limit) \uac12\uc774 \uc81c\uacf5\ub418\uc9c0 \uc54a\uc740 \uacbd\uc6b0 \uc774\ub97c \uc0ac\uc6a9\ud558\uc5ec \uae30\ubcf8 \uc694\uccad/\uc81c\ud55c \uac12\uc744 \uc124\uc815\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucf54\ub4dc\ud615 \uc815\ucc45(PAC) \uc194\ub8e8\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc694\uccad \ubc0f \uc81c\ud55c\uc744 \uc801\uc6a9\ud558\uac70\ub098 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \uc0dd\uc131\ud560 \ub54c \ub9ac\uc18c\uc2a4 \ud560\ub2f9\ub7c9 \ubc0f \uc81c\ud55c \ubc94\uc704\ub97c \ub9cc\ub4e4 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_10","title":"\ud2b9\uad8c \uc5d0\uc2a4\uceec\ub808\uc774\uc158\uc744 \ud5c8\uc6a9\ud558\uc9c0 \uc54a\uc74c","text":"<p>\ud2b9\uad8c \uc5d0\uc2a4\uceec\ub808\uc774\uc158\uc744 \ud1b5\ud574 \ud504\ub85c\uc138\uc2a4\ub294 \uc2e4\ud589 \uc911\uc778 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\ub97c \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Sudo\ub294 SUID \ub610\ub294 SGID \ube44\ud2b8\uac00 \uc788\ub294 \ubc14\uc774\ub108\ub9ac\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \uc774\uc5d0 \ub300\ud55c \uc88b\uc740 \uc608\uc785\ub2c8\ub2e4. \ud2b9\uad8c \uc5d0\uc2a4\uceec\ub808\uc774\uc158\uc740 \uae30\ubcf8\uc801\uc73c\ub85c \uc0ac\uc6a9\uc790\uac00 \ub2e4\ub978 \uc0ac\uc6a9\uc790 \ub610\ub294 \uadf8\ub8f9\uc758 \uad8c\ud55c\uc73c\ub85c \ud30c\uc77c\uc744 \uc2e4\ud589\ud558\ub294 \ubc29\ubc95\uc785\ub2c8\ub2e4. <code>allowPrivilegeEscalation</code> \uc744 <code>false</code>\ub85c \uc124\uc815\ud558\ub294 \uc815\ucc45 \ucf54\ub4dc \ubcc0\uacbd \uc815\ucc45\uc744 \uad6c\ud604\ud558\uac70\ub098 <code>podSpec</code>\uc5d0\uc11c <code>securityContext.allowPrivilegeEscalation</code>\uc744 \uc124\uc815\ud558\uc5ec \ucee8\ud14c\uc774\ub108\uac00 \uad8c\ud55c \uc788\ub294 \uc5d0\uc2a4\uceec\ub808\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud558\ub3c4\ub85d \ubc29\uc9c0 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4 . Policy-as-code \uc815\ucc45\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc798\ubabb\ub41c \uc124\uc815\uc774 \uac10\uc9c0\ub41c \uacbd\uc6b0 API \uc11c\ubc84 \uc694\uccad\uc774 \uc131\uacf5\ud558\uc9c0 \ubabb\ud558\ub3c4\ub85d \ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc\uac00 \uad8c\ud55c \uc5d0\uc2a4\uceec\ub808\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud558\ub3c4\ub85d \ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#serviceaccount","title":"ServiceAccount \ud1a0\ud070 \ud0d1\uc7ac \ube44\ud65c\uc131\ud654","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0 \uc561\uc138\uc2a4\ud560 \ud544\uc694\uac00 \uc5c6\ub294 \ud30c\ub4dc\uc758 \uacbd\uc6b0, \ud30c\ub4dc \uc2a4\ud399 \ub610\ub294 \ud2b9\uc815 \uc11c\ube44\uc2a4\uc5b4\uce74\uc6b4\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \ubaa8\ub4e0 \ud30c\ub4dc\uc5d0 \ub300\ud574 \uc11c\ube44\uc2a4\uc5b4\uce74\uc6b4\ud2b8 \ud1a0\ud070\uc758 \uc790\ub3d9 \ub9c8\uc6b4\ud2b8\ub97c \ube44\ud65c\uc131\ud654\ud560 \uc218 \uc788\ub2e4.</p> <p>Attention</p> <p>\uc11c\ube44\uc2a4\uc5b4\uce74\uc6b4\ud2b8 \ub9c8\uc6b4\ud2b8\ub97c \ube44\ud65c\uc131\ud654\ud574\ub3c4 \ud30c\ub4dc\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0 \ub124\ud2b8\uc6cc\ud06c\ub85c \uc561\uc138\uc2a4\ud558\ub294 \uac83\uc744 \ub9c9\uc744 \uc218\ub294 \uc5c6\uc2b5\ub2c8\ub2e4. \ud30c\ub4dc\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc5d0 \ub124\ud2b8\uc6cc\ud06c\ub85c \uc561\uc138\uc2a4\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud558\ub824\uba74 EKS \ud074\ub7ec\uc2a4\ud130 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uc561\uc138\uc2a4\ub97c \uc218\uc815\ud558\uace0 \ub124\ud2b8\uc6cc\ud06c\uc815\ucc45\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc \uc561\uc138\uc2a4\ub97c \ucc28\ub2e8\ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-no-automount\nspec:\n  automountServiceAccountToken: false\n</code></pre> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: sa-no-automount\nautomountServiceAccountToken: false\n</code></pre>"},{"location":"ko/security/docs/pods/#_11","title":"\uc11c\ube44\uc2a4 \uac80\uc0c9 \ube44\ud65c\uc131\ud654","text":"<p>\ud074\ub7ec\uc2a4\ud130 \ub0b4 \uc11c\ube44\uc2a4\ub97c \uc870\ud68c\ud558\uac70\ub098 \ud638\ucd9c\ud560 \ud544\uc694\uac00 \uc5c6\ub294 \ud30c\ub4dc\uc758 \uacbd\uc6b0 \ud30c\ub4dc\uc5d0 \uc81c\uacf5\ub418\ub294 \uc815\ubcf4\uc758 \uc591\uc744 \uc904\uc77c \uc218 \uc788\ub2e4. CoreDNS\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub3c4\ub85d Pod\uc758 DNS \uc815\ucc45\uc744 \uc124\uc815\ud558\uace0 \ud30c\ub4dc \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc758 \uc11c\ube44\uc2a4\ub97c \ud658\uacbd \ubcc0\uc218\ub85c \ub178\ucd9c\ud558\uc9c0 \uc54a\ub3c4\ub85d \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc11c\ube44\uc2a4 \ub9c1\ud06c\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ud658\uacbd \ubcc0\uc218\uc5d0 \uad00\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624. \ud30c\ub4dc DNS \uc815\ucc45\uc758 \uae30\ubcf8\uac12\uc740 \ud074\ub7ec\uc2a4\ud130 \ub0b4 DNS\ub97c \uc0ac\uc6a9\ud558\ub294 \"ClusterFirst\"\uc774\uace0, \uae30\ubcf8\uac12\uc774 \uc544\ub2cc \"Default\"\ub294 \uae30\ubcf8 \ub178\ub4dc\uc758 DNS \ud655\uc778\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ud30c\ub4dc DNS \uc815\ucc45\uc5d0 \uad00\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c \ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>Attention</p> <p>\uc11c\ube44\uc2a4 \ub9c1\ud06c\ub97c \ube44\ud65c\uc131\ud654\ud558\uace0 \ud30c\ub4dc\uc758 DNS \uc815\ucc45\uc744 \ubcc0\uacbd\ud574\ub3c4 \ud30c\ub4dc\uac00 \ud074\ub7ec\uc2a4\ud130 \ub0b4 DNS \uc11c\ube44\uc2a4\uc5d0 \ub124\ud2b8\uc6cc\ud06c\ub85c \uc561\uc138\uc2a4\ud558\ub294 \uac83\uc744 \ub9c9\uc744 \uc218\ub294 \uc5c6\uc2b5\ub2c8\ub2e4.   \uacf5\uaca9\uc790\ub294 \uc5ec\uc804\ud788 \ud074\ub7ec\uc2a4\ud130 \ub0b4 DNS \uc11c\ube44\uc2a4\uc5d0 \uc811\uc18d\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc758 \uc11c\ube44\uc2a4\ub97c \uc5f4\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.(\uc608: <code>dig SRV *.*.svc.cluster.local @$CLUSTER_DNS_IP</code>) \ud074\ub7ec\uc2a4\ud130 \ub0b4 \uc11c\ube44\uc2a4 \uac80\uc0c9\uc744 \ubc29\uc9c0\ud558\ub824\uba74 NetworkPolicy \ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc \uc561\uc138\uc2a4\ub97c \ucc28\ub2e8\ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-no-service-info\nspec:\n    dnsPolicy: Default # \"Default\" is not the true default value\n    enableServiceLinks: false\n</code></pre>"},{"location":"ko/security/docs/pods/#_12","title":"\uc77d\uae30 \uc804\uc6a9 \ub8e8\ud2b8 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc73c\ub85c \uc774\ubbf8\uc9c0 \uad6c\uc131","text":"<p>\uc77d\uae30 \uc804\uc6a9 \ub8e8\ud2b8 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc73c\ub85c \uc774\ubbf8\uc9c0\ub97c \uad6c\uc131\ud558\uba74 \uacf5\uaca9\uc790\uac00 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc758 \ubc14\uc774\ub108\ub9ac\ub97c \ub36e\uc5b4\uc4f0\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc5d0 \uae30\ub85d\ud574\uc57c \ud558\ub294 \uacbd\uc6b0 \uc784\uc2dc \ub514\ub809\ud130\ub9ac\uc5d0 \uc4f0\uac70\ub098 \ubcfc\ub968\uc744 \uc5f0\uacb0\ud558\uace0 \ub9c8\uc6b4\ud2b8\ud558\ub294 \uac83\uc744 \uace0\ub824\ud574 \ubcf4\uc138\uc694.\ub2e4\uc74c\uacfc \uac19\uc774 \ud30c\ub4dc\uc758 SecurityContext\ub97c \uc124\uc815\ud558\uc5ec \uc774\ub97c \uc801\uc6a9\ud560 \uc218 \uc788\ub2e4.</p> <pre><code>...\nsecurityContext:\n  readOnlyRootFilesystem: true\n...\n</code></pre> <p>\ucf54\ub4dc\ud615 \uc815\ucc45(PaC) \ubc0f \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774 \ub3d9\uc791\uc744 \uc2dc\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Info</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 Windows \ucee8\ud14c\uc774\ub108 \uc5d0 \ub530\ub974\uba74 Windows\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ucee8\ud14c\uc774\ub108\uc758 \uacbd\uc6b0 <code>SecurityContext.readOnlyRootFileSystem</code>\uc740 <code>true</code>\ub85c \uc124\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.   \ub808\uc9c0\uc2a4\ud2b8\ub9ac \ubc0f \uc2dc\uc2a4\ud15c \ud504\ub85c\uc138\uc2a4\ub97c \ucee8\ud14c\uc774\ub108 \ub0b4\uc5d0\uc11c \uc2e4\ud589\ud558\ub824\uba74 \uc4f0\uae30 \uad8c\ud55c\uc774 \ud544\uc694\ud558\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/pods/#_13","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<ul> <li>open-policy-agent/gatekeeper-library: OPA Gatekeeper \uc815\ucc45 \ub77c\uc774\ube0c\ub7ec\ub9ac PSP \ub300\uc2e0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 OPA/\uac8c\uc774\ud2b8\ud0a4\ud37c \uc815\ucc45 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc785\ub2c8\ub2e4.</li> <li>Kyverno \uc815\ucc45 \ub77c\uc774\ube0c\ub7ec\ub9ac</li> <li>EKS\ub97c \uc704\ud55c \uacf5\ud1b5 OPA \ubc0f Kyverno \uc815\ucc45 \ubaa8\uc74c\uc785\ub2c8\ub2e4.</li> <li>\uc815\ucc45 \uae30\ubc18 \ub300\ucc45: \ud30c\ud2b8 1</li> <li>\uc815\ucc45 \uae30\ubc18 \ub300\ucc45: \ud30c\ud2b8 2</li> <li>Pod Security Policy Migrator PSP\ub97c OPA/Gatekeeper, KubeWarden \ub610\ub294 Kyverno \uc815\ucc45\uc73c\ub85c \ubcc0\ud658\ud558\ub294 \ub3c4\uad6c\uc785\ub2c8\ub2e4.</li> </ul>"},{"location":"ko/security/docs/runtime/","title":"\ub7f0\ud0c0\uc784 \ubcf4\uc548","text":"<p>\ub7f0\ud0c0\uc784 \ubcf4\uc548\uc740 \ucee8\ud14c\uc774\ub108\uac00 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548 \ucee8\ud14c\uc774\ub108\ub97c \ub2a5\ub3d9\uc801\uc73c\ub85c \ubcf4\ud638\ud569\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108 \ub0b4\ubd80\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \uc545\uc758\uc801\uc778 \ud65c\ub3d9\uc744 \ud0d0\uc9c0 \ubc0f \ubc29\uc9c0\ud558\ub294 \uac83\uc774 \uad00\uac74\uc785\ub2c8\ub2e4. \uc774\ub294 \ub9ac\ub205\uc2a4 \uae30\ub2a5, \ubcf4\uc548 \ucef4\ud4e8\ud305 (seccomp), AppArmor \ub610\ub294 SELinux\uc640 \uac19\uc774 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \ud1b5\ud569\ub41c \ub9ac\ub205\uc2a4 \ucee4\ub110 \ub610\ub294 \ucee4\ub110 \uc775\uc2a4\ud150\uc158\uc758 \uc5ec\ub7ec \uba54\ucee4\ub2c8\uc998\uc744 \ud1b5\ud574 \ub2ec\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Amazon GuardDuty \ubc0f \ud0c0\uc0ac \ub3c4\uad6c\uc640 \uac19\uc740 \uc635\uc158\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uba74 Linux \ucee4\ub110 \uba54\ucee4\ub2c8\uc998\uc744 \uc218\ub3d9\uc73c\ub85c \uad6c\uc131\ud558\uc9c0 \uc54a\uace0\ub3c4 \uae30\uc900\uc744 \uc124\uc815\ud558\uace0 \uc774\uc0c1 \ud65c\ub3d9\uc744 \ud0d0\uc9c0\ud558\ub294 \ub370 \ub3c4\uc6c0\uc744 \uc904 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Attention</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud604\uc7ac seccomp, AppArmor \ub610\ub294 SELinux \ud504\ub85c\ud30c\uc77c\uc744 \ub178\ub4dc\uc5d0 \ub85c\ub4dc\ud558\uae30 \uc704\ud55c \ub124\uc774\ud2f0\ube0c \uba54\ucee4\ub2c8\uc998\uc744 \uc81c\uacf5\ud558\uc9c0 \uc54a\ub294\ub2e4. \uc218\ub3d9\uc73c\ub85c \ub85c\ub4dc\ud558\uac70\ub098 \ubd80\ud2b8\uc2a4\ud2b8\ub7a9\ud560 \ub54c \ub178\ub4dc\uc5d0 \uc124\uce58\ud574\uc57c \ud569\ub2c8\ub2e4. \uc2a4\ucf00\uc904\ub7ec\uac00 \uc5b4\ub5a4 \ub178\ub4dc\uc5d0 \ud504\ub85c\ud30c\uc77c\uc774 \uc788\ub294\uc9c0 \uc778\uc2dd\ud558\uc9c0 \ubabb\ud558\uae30 \ub54c\ubb38\uc5d0 \ud30c\ub4dc\uc5d0\uc11c \ucc38\uc870\ud558\uae30 \uc804\uc5d0 \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud574\uc57c \ud55c\ub2e4.Security Profiles Operator\uc640 \uac19\uc740 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud504\ub85c\ud30c\uc77c\uc744 \ub178\ub4dc\uc5d0 \uc790\ub3d9\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \ubc29\ubc95\uc744 \uc544\ub798\uc5d0\uc11c \ud655\uc778\ud558\uc138\uc694.</p>"},{"location":"ko/security/docs/runtime/#_2","title":"\ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8 \ubc0f \ube4c\ud2b8\uc778 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucee8\ud2b8\ub864","text":"<p>\ub9ce\uc740 \ub9ac\ub205\uc2a4 \ub7f0\ud0c0\uc784 \ubcf4\uc548 \uba54\ucee4\ub2c8\uc998\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \uae34\ubc00\ud558\uac8c \ud1b5\ud569\ub418\uc5b4 \uc788\uc73c\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\ub97c \ud1b5\ud574 \uad6c\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7ec\ud55c \uc635\uc158 \uc911 \ud558\ub098\ub294 <code>privileged</code> \ud50c\ub798\uadf8\uc778\ub370, \uc774 \ud50c\ub798\uadf8\ub294 \uae30\ubcf8\uc801\uc73c\ub85c <code>false</code>\uc774\uba70 \ud65c\uc131\ud654\ub418\uba74 \uae30\ubcf8\uc801\uc73c\ub85c \ud638\uc2a4\ud2b8\uc758 \ub8e8\ud2b8\uc640 \ub3d9\uc77c\ud569\ub2c8\ub2e4. \ud504\ub85c\ub355\uc158 \uc6cc\ud06c\ub85c\ub4dc\uc5d0\uc11c \uad8c\ud55c \ubaa8\ub4dc\ub97c \ud65c\uc131\ud654\ud558\ub294 \uac83\uc740 \uac70\uc758 \ud56d\uc0c1 \ubd80\uc801\uc808\ud558\uc9c0\ub9cc, \ucee8\ud14c\uc774\ub108\uc5d0 \uc801\uc808\ud55c \uad8c\ud55c\uc744 \ub354 \uc138\ubd80\uc801\uc73c\ub85c \uc81c\uacf5\ud560 \uc218 \uc788\ub294 \ucee8\ud2b8\ub864\uc740 \ud6e8\uc52c \ub354 \ub9ce\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/runtime/#_3","title":"\ub9ac\ub205\uc2a4 \uae30\ub2a5","text":"<p>Linux \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uba74 \ub8e8\ud2b8 \uc0ac\uc6a9\uc790\uc758 \ubaa8\ub4e0 \uae30\ub2a5\uc744 \uc81c\uacf5\ud558\uc9c0 \uc54a\uace0\ub3c4 \ud30c\ub4dc \ub610\ub294 \ucee8\ud14c\uc774\ub108\uc5d0 \ud2b9\uc815 \uae30\ub2a5\uc744 \ubd80\uc5ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4 \ub610\ub294 \ubc29\ud654\ubcbd\uc744 \uad6c\uc131\ud560 \uc218 \uc788\ub294 <code>CAP_NET_ADMIN</code>\uc774\ub098 \uc2dc\uc2a4\ud15c \ud074\ub7ed\uc744 \uc870\uc791\ud560 \uc218 \uc788\ub294 <code>CAP_SYS_TIME</code>\uc774 \uadf8\ub7f0 \uc608\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/runtime/#seccomp","title":"Seccomp","text":"<p>Seccomp\ub97c \uc0ac\uc6a9\ud558\uba74 \ucee8\ud14c\uc774\ub108\uc2dd \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uae30\ubcf8 \ud638\uc2a4\ud2b8 \uc6b4\uc601 \uccb4\uc81c\uc758 \ucee4\ub110\uc5d0 \ud2b9\uc815 \uc2dc\uc2a4\ud15c \ud638\ucd9c\uc744 \uc218\ud589\ud558\ub294 \uac83\uc744 \ubc29\uc9c0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Linux \uc6b4\uc601 \uccb4\uc81c\uc5d0\ub294 \uc218\ubc31 \uac1c\uc758 \uc2dc\uc2a4\ud15c \ud638\ucd9c\uc774 \uc788\uc9c0\ub9cc \uadf8 \uc911 \ub300\ubd80\ubd84\uc740 \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud558\ub294 \ub370 \ud544\uc694\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc0dd\uc131\ud560 \uc218 \uc788\ub294 \uc2dc\uc2a4\ud15c \ud638\ucd9c\uc744 \uc81c\ud55c\ud558\uba74 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uacf5\uaca9 \ubc94\uc704\ub97c \ud6a8\uacfc\uc801\uc73c\ub85c \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Seccomp\ub294 \uc2dc\uc2a4\ud15c \ud638\ucd9c\uc744 \uac00\ub85c\ucc44\uace0 \ud5c8\uc6a9 \ubaa9\ub85d\uc5d0 \uc788\ub294 \uc2dc\uc2a4\ud15c\ub9cc \ud1b5\uacfc\ud558\ub3c4\ub85d \ud558\ub294 \ubc29\uc2dd\uc73c\ub85c \uc791\ub3d9\ud569\ub2c8\ub2e4.Docker\uc5d0\ub294 \ub300\ubd80\ubd84\uc758 \ubc94\uc6a9 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc801\ud569\ud55c \ub514\ud3f4\ud2b8 seccomp \ud504\ub85c\ud30c\uc77c\uc774 \uc788\uc73c\uba70, containerd\uc640 \uac19\uc740 \ub2e4\ub978 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\ub3c4 \ube44\uc2b7\ud55c \ub514\ud3f4\ud2b8\uac12\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \ud30c\ub4dc \uc0ac\uc591\uc758 <code>SecurityContext</code> \uc139\uc158\uc5d0 \ub2e4\uc74c\uc744 \ucd94\uac00\ud558\uc5ec \ucee8\ud14c\uc774\ub108 \ub610\ub294 \ud30c\ub4dc\uac00 \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc758 \ub514\ud3f4\ud2b8 seccomp \ud504\ub85c\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\ub3c4\ub85d \uad6c\uc131\ud560 \uc218 \uc788\ub2e4.</p> <pre><code>securityContext:\n  seccompProfile:\n    type: RuntimeDefault\n</code></pre> <p>1.22 (Alpha, 1.27\ubd80\ud130 Stable)\ubd80\ud130, \uc704\uc758 '\ub7f0\ud0c0\uc784\ub514\ud3f4\ud2b8'\ub294 \ub2e8\uc77c kubelet \ud50c\ub798\uadf8, `--seccomp-default'\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc\uc758 \ubaa8\ub4e0 \ud30c\ub4dc\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4. \uadf8\ub7ec\uba74 'SecurityContext'\uc5d0 \uc9c0\uc815\ub41c \ud504\ub85c\ud30c\uc77c\uc740 \ub2e4\ub978 \ud504\ub85c\ud30c\uc77c\uc5d0\ub9cc \ud544\uc694\ud569\ub2c8\ub2e4.</p> <p>\ub610\ud55c \ucd94\uac00 \uad8c\ud55c\uc774 \ud544\uc694\ud55c \ud56d\ubaa9\uc5d0 \ub300\ud574 \ud504\ub85c\ud30c\uc77c\uc744 \uc9c1\uc811 \ub9cc\ub4e4 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uc218\ub3d9\uc73c\ub85c \uc791\uc5c5\ud558\uae30\uc5d0\ub294 \ub9e4\uc6b0 \uc9c0\ub8e8\ud560 \uc218 \uc788\uc9c0\ub9cc eBPF \ub610\ub294 logs\uc640 \uac19\uc740 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uae30\ubcf8 \uad8c\ud55c \uc694\uad6c \uc0ac\ud56d\uc744 seccomp \ud504\ub85c\ud30c\uc77c\ub85c \uae30\ub85d\ud558\ub294 \uac83\uc744 \uc9c0\uc6d0\ud558\ub294 Inspektor Gadget(\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uc0dd\uc131\uc744 \uc704\ud574 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548 \uc139\uc158 \ubb38\uc11c\uc5d0\uc11c\ub3c4 \uad8c\uc7a5) \ubc0f Security Profiles Operator\uc640 \uac19\uc740 \ub3c4\uad6c\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c Security Profiles Operator\ub97c \uc0ac\uc6a9\ud558\uba74 \uae30\ub85d\ub41c \ud504\ub85c\ud30c\uc77c\uc744 \ud30c\ub4dc\uc640 \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ub178\ub4dc\uc5d0 \ubc30\ud3ec\ud558\ub294 \uc791\uc5c5\uc744 \uc790\ub3d9\ud654\ud560 \uc218 \uc788\ub2e4.</p>"},{"location":"ko/security/docs/runtime/#apparmor-selinux","title":"AppArmor\uc640 SELinux","text":"<p>AppMor\uc640 SELinux\ub294 \ud544\uc218 \uc561\uc138\uc2a4 \uc81c\uc5b4(MAC \uc2dc\uc2a4\ud15c)\ub85c \uc54c\ub824\uc838 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub4e4\uc740 seccomp\uc640 \uac1c\ub150\uc801\uc73c\ub85c\ub294 \ube44\uc2b7\ud558\uc9c0\ub9cc API\uc640 \uae30\ub2a5\uc774 \ub2e4\ub974\uae30 \ub54c\ubb38\uc5d0 \ud2b9\uc815 \ud30c\uc77c \uc2dc\uc2a4\ud15c \uacbd\ub85c \ub610\ub294 \ub124\ud2b8\uc6cc\ud06c \ud3ec\ud2b8 \ub4f1\uc5d0 \ub300\ud55c \uc561\uc138\uc2a4 \uc81c\uc5b4\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4. \uc774\ub7ec\ud55c \ub3c4\uad6c\uc5d0 \ub300\ud55c \uc9c0\uc6d0\uc740 \ub9ac\ub205\uc2a4 \ubc30\ud3ec\ud310\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9c0\ub294\ub370, \ub370\ube44\uc548/\uc6b0\ubd84\ud22c\ub294 AppArmor\ub97c \uc9c0\uc6d0\ud558\uace0 RHEL/Centos/BottleRocket/Amazon Linux 2023\uc740 SELinux\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. SELinux\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc778\ud504\ub77c \ubcf4\uc548 \uc139\uc158\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>AppArmor\uc640 SELinux\ub294 \ubaa8\ub450 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc640 \ud1b5\ud569\ub418\uc5b4 \uc788\uc9c0\ub9cc, \ucfe0\ubc84\ub124\ud2f0\uc2a4 1.28\ubd80\ud130 AppArmor \ud504\ub85c\ud30c\uc77c\uc740 \uc5b4\ub178\ud14c\uc774\uc158 \uc744 \ud1b5\ud574 \uc9c0\uc815\ud574\uc57c \ud558\uba70, SELinux \ub808\uc774\ube14\uc740 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\uc758 SELinuxOptions \ud544\ub4dc\ub97c \ud1b5\ud574 \uc9c1\uc811 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>seccomp \ud504\ub85c\ud30c\uc77c\uacfc \ub9c8\ucc2c\uac00\uc9c0\ub85c \uc704\uc5d0\uc11c \uc5b8\uae09\ud55c \ubcf4\uc548 \ud504\ub85c\ud30c\uc77c \uc6b4\uc601\uc790\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \ub178\ub4dc\uc5d0 \ud504\ub85c\ud30c\uc77c\uc744 \ubc30\ud3ec\ud558\ub294 \ub370 \ub3c4\uc6c0\uc744 \uc904 \uc218 \uc788\uc2b5\ub2c8\ub2e4. (\ud5a5\ud6c4 \uc774 \ud504\ub85c\uc81d\ud2b8\ub294 seccomp\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c AppMor \ubc0f SELinux\uc6a9 \ud504\ub85c\ud30c\uc77c\ub3c4 \uc0dd\uc131\ud558\ub294 \uac83\uc744 \ubaa9\ud45c\ub85c \ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.)</p>"},{"location":"ko/security/docs/runtime/#_4","title":"\uad8c\uc7a5 \uc0ac\ud56d","text":""},{"location":"ko/security/docs/runtime/#amazon-guardduty-eks","title":"Amazon GuardDuty\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub7f0\ud0c0\uc784 \ubaa8\ub2c8\ud130\ub9c1 \ubc0f EKS \ud658\uacbd\uc5d0 \ub300\ud55c \uc704\ud611\uc744 \ud0d0\uc9c0\ud558\uc2ed\uc2dc\uc624","text":"<p>\ud604\uc7ac EKS \ub7f0\ud0c0\uc784\uc744 \uc9c0\uc18d\uc801\uc73c\ub85c \ubaa8\ub2c8\ud130\ub9c1\ud558\uace0, EKS \uac10\uc0ac \ub85c\uadf8\ub97c \ubd84\uc11d\ud558\uace0, \uba40\uc6e8\uc5b4 \ubc0f \uae30\ud0c0 \uc758\uc2ec\uc2a4\ub7ec\uc6b4 \ud65c\ub3d9\uc744 \uac80\uc0ac\ud560 \uc218 \uc788\ub294 \uc194\ub8e8\uc158\uc774 \uc5c6\ub294 \uacbd\uc6b0, Amazon\uc740 AWS \ud658\uacbd\uc744 \ubcf4\ud638\ud558\ub294 \uac04\ub2e8\ud558\uace0, \ube60\ub974\uace0, \uc548\uc804\ud558\uace0, \ud655\uc7a5 \uac00\ub2a5\ud558\uace0, \ube44\uc6a9 \ud6a8\uc728\uc801\uc778 \uc6d0\ud074\ub9ad \ubc29\ubc95\uc744 \uc6d0\ud558\ub294 \uace0\uac1d\uc5d0\uac8c Amazon GuardDuty\ub97c \uc0ac\uc6a9\ud560 \uac83\uc744 \uac15\ub825\ud788 \uad8c\uc7a5\ud569\ub2c8\ub2e4. Amazon GuardDuty\ub294 AWS CloudTrail \uad00\ub9ac \uc774\ubca4\ud2b8, AWS CloudTrail \uc774\ubca4\ud2b8 \ub85c\uadf8, VPC \ud50c\ub85c\uc6b0 \ub85c\uadf8(Amazon EC2 \uc778\uc2a4\ud134\uc2a4 \ud2b8\ub798\ud53d), \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac10\uc0ac \ub85c\uadf8 \ubc0f DNS \ub85c\uadf8\uc640 \uac19\uc740 \uae30\ubcf8 \ub370\uc774\ud130 \uc18c\uc2a4\ub97c \ubd84\uc11d\ud558\uace0 \ucc98\ub9ac\ud558\ub294 \ubcf4\uc548 \ubaa8\ub2c8\ud130\ub9c1 \uc11c\ube44\uc2a4\uc785\ub2c8\ub2e4. \ub610\ud55c EKS \ub7f0\ud0c0\uc784 \ubaa8\ub2c8\ud130\ub9c1\ub3c4 \ud3ec\ud568\ub429\ub2c8\ub2e4. \uc9c0\uc18d\uc801\uc73c\ub85c \uc5c5\ub370\uc774\ud2b8\ub418\ub294 \uc704\ud611 \uc778\ud154\ub9ac\uc804\uc2a4 \ud53c\ub4dc(\uc608: \uc545\uc131 IP \uc8fc\uc18c \ubc0f \ub3c4\uba54\uc778 \ubaa9\ub85d), \uae30\uacc4 \ud559\uc2b5\uc744 \uc0ac\uc6a9\ud558\uc5ec AWS \ud658\uacbd \ub0b4\uc5d0\uc11c \uc608\uc0c1\uce58 \ubabb\ud55c, \uc7a0\uc7ac\uc801\uc73c\ub85c \uc2b9\uc778\ub418\uc9c0 \uc54a\uc740 \uc545\uc758\uc801\uc778 \ud65c\ub3d9\uc744 \uc2dd\ubcc4\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc5d0\ub294 \uad8c\ud55c \uc0c1\uc2b9, \ub178\ucd9c\ub41c \uc790\uaca9 \uc99d\uba85 \uc0ac\uc6a9, \uc545\uc131 IP \uc8fc\uc18c, \ub3c4\uba54\uc778\uacfc\uc758 \ud1b5\uc2e0, Amazon EC2 \uc778\uc2a4\ud134\uc2a4 \ubc0f EKS \ucee8\ud14c\uc774\ub108 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 \uc545\uc131\ucf54\ub4dc\uac00 \uc874\uc7ac\ud558\uac70\ub098 \uc758\uc2ec\uc2a4\ub7ec\uc6b4 API \ud65c\ub3d9 \ubc1c\uacac\uacfc \uac19\uc740 \ubb38\uc81c\uac00 \ud3ec\ud568\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. GuardDuty\ub294 GuardDuty \ucf58\uc194\uc774\ub098 Amazon EventBridge\ub97c \ud1b5\ud574 \ud655\uc778\ud560 \uc218 \uc788\ub294 \ubcf4\uc548 \uc870\uc0ac \uacb0\uacfc\ub97c \uc0dd\uc131\ud558\uc5ec AWS \ud658\uacbd\uc758 \uc0c1\ud0dc\ub97c \uc54c\ub824\uc90d\ub2c8\ub2e4. \ub610\ud55c GuardDuty\ub294 \uc870\uc0ac \uacb0\uacfc\ub97c Amazon \uc2ec\ud50c \uc2a4\ud1a0\ub9ac\uc9c0 \uc11c\ube44\uc2a4 (S3) \ubc84\ud0b7\uc73c\ub85c \ub0b4\ubcf4\ub0b4\uace0 AWS Security Hub \ubc0f Detective\uacfc \uac19\uc740 \ub2e4\ub978 \uc11c\ube44\uc2a4\uc640 \ud1b5\ud569\ud560 \uc218 \uc788\ub3c4\ub85d \uc9c0\uc6d0\ud569\ub2c8\ub2e4.</p> <p>\uc704\uc640 \uad00\ub828\ub41c AWS \uc628\ub77c\uc778 \ud14c\ud06c \ud1a0\ud06c\uc778 \"Amazon GuardDuty\ub97c \ud1b5\ud55c Amazon EKS\uc758 \ud5a5\uc0c1\ub41c \uc704\ud611 \ud0d0\uc9c0 \u2014 AWS \uc628\ub77c\uc778 \ud14c\ud06c \ud1a0\ud06c\"\ub97c \uc2dc\uccad\ud558\uc5ec \uc774\ub7ec\ud55c \ucd94\uac00 EKS \ubcf4\uc548 \uae30\ub2a5\uc744 \uba87 \ubd84 \ub9cc\uc5d0 \ub2e8\uacc4\ubcc4\ub85c \ud65c\uc131\ud654\ud558\ub294 \ubc29\ubc95\uc744 \uc54c\uc544\ubcf4\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/runtime/#_5","title":"\ub7f0\ud0c0\uc784 \ubc29\uc5b4\ub97c \uc704\ud574 \ud0c0\uc0ac \uc194\ub8e8\uc158 \uc0ac\uc6a9","text":"<p>Linux \ubcf4\uc548\uc5d0 \uc775\uc219\ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 seccomp \ubc0f Apparmor \ud504\ub85c\ud30c\uc77c\uc744 \ub9cc\ub4e4\uace0 \uad00\ub9ac\ud558\uae30 \uc5b4\ub824\uc6b8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2a5\uc219\ud574\uc9c8 \uc2dc\uac04\uc774 \uc5c6\ub2e4\uba74 \uc0c1\uc6a9 \uc194\ub8e8\uc158 \uc0ac\uc6a9\uc744 \uace0\ub824\ud558\uc2ed\uc2dc\uc624. \uadf8\ub4e4 \uc911 \ub2e4\uc218\ub294 Apparmor \ubc0f seccomp\uc640 \uac19\uc740 \uc815\uc801 \ud504\ub85c\ud30c\uc77c\uc744 \ub118\uc5b4 \uae30\uacc4 \ud559\uc2b5\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc758\uc2ec\uc2a4\ub7ec\uc6b4 \ud65c\ub3d9\uc744 \ucc28\ub2e8\ud558\uac70\ub098 \uacbd\uace0\ud558\uae30 \uc2dc\uc791\ud588\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc194\ub8e8\uc158 \uc911 \uc77c\ubd80\ub294 \uc544\ub798\uc758 \ub3c4\uad6c \uc139\uc158\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucd94\uac00 \uc635\uc158\uc740 AWS Marketplace for Containers\uc5d0\uc11c \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/runtime/#seccomp-linux","title":"seccomp \uc815\ucc45\uc744 \uc791\uc131\ud558\uae30 \uc804\uc5d0 Linux \uae30\ub2a5 \ucd94\uac00/\uc0ad\uc81c \uace0\ub824","text":"<p>\uae30\ub2a5\uc5d0\ub294 \uc2dc\uc2a4\ud15c \ucf5c\uc774 \ub3c4\ub2ec\ud560 \uc218 \uc788\ub294 \ucee4\ub110 \uae30\ub2a5\uc758 \ub2e4\uc591\ud55c \uac80\uc0ac\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. \ud655\uc778\uc5d0 \uc2e4\ud328\ud558\uba74 \uc2dc\uc2a4\ud15c \ucf5c\uc740 \uc77c\ubc18\uc801\uc73c\ub85c \uc624\ub958\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. \ud655\uc778\uc740 \ud2b9\uc815 syscall\uc758 \uc2dc\uc791 \ubd80\ubd84\uc5d0\uc11c \ubc14\ub85c \uc218\ud589\ud558\uac70\ub098 \uc5ec\ub7ec \ub2e4\ub978 syscall\uc744 \ud1b5\ud574 \ub3c4\ub2ec\ud560 \uc218 \uc788\ub294 \ucee4\ub110\uc758 \ub354 \uae4a\uc740 \uc601\uc5ed(\uc608: \ud2b9\uc815 \ud2b9\uad8c \ud30c\uc77c\uc5d0 \uc4f0\uae30)\uc5d0\uc11c \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ubc18\uba74\uc5d0 Seccomp\ub294 \uc2e4\ud589\ub418\uae30 \uc804\uc5d0 \ubaa8\ub4e0 \uc2dc\uc2a4\ud15c \ucf5c\uc5d0 \uc801\uc6a9\ub418\ub294 \uc2dc\uc2a4\ud15c \ucf5c \ud544\ud130\uc785\ub2c8\ub2e4. \ud504\ub85c\uc138\uc2a4\ub294 \ud2b9\uc815 \uc2dc\uc2a4\ud15c \ucf5c \ub610\ub294 \ud2b9\uc815 \uc2dc\uc2a4\ud15c \ucf5c\uc5d0 \ub300\ud55c \ud2b9\uc815 \uc778\uc218\ub97c \uc2e4\ud589\ud560 \uad8c\ud55c\uc744 \ucde8\uc18c\ud560 \uc218 \uc788\ub294 \ud544\ud130\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>seccomp\ub97c \uc0ac\uc6a9\ud558\uae30 \uc804\uc5d0 Linux \uae30\ub2a5 \ucd94\uac00/\uc81c\uac70\uac00 \ud544\uc694\ud55c \uc81c\uc5b4 \uae30\ub2a5\uc744 \uc81c\uacf5\ud558\ub294\uc9c0 \uace0\ub824\ud558\uc2ed\uc2dc\uc624. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p>"},{"location":"ko/security/docs/runtime/#psp","title":"\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \ud3f4\ub9ac\uc2dc(PSP)\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubaa9\ud45c\ub97c \ub2ec\uc131\ud560 \uc218 \uc788\ub294\uc9c0 \ud655\uc778\ud558\uc2ed\uc2dc\uc624","text":"<p>PSP\ub294 \uacfc\ub3c4\ud55c \ubcf5\uc7a1\uc131\uc744 \uc720\ubc1c\ud558\uc9c0 \uc54a\uc73c\uba74\uc11c \ubcf4\uc548 \ud0dc\uc138\ub97c \uac1c\uc120\ud560 \uc218 \uc788\ub294 \ub2e4\uc591\ud55c \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. seccomp \ubc0f Apparmor \ud504\ub85c\ud30c\uc77c\uc744 \uad6c\ucd95\ud558\uae30 \uc804\uc5d0 PSP\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc635\uc158\uc744 \uc0b4\ud3b4\ubcf4\uc138\uc694.</p> <p>Warning</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 1.25\ubd80\ud130 PSP\uac00 \uc81c\uac70\ub418\uace0 Pod Security Admission \ucee8\ud2b8\ub864\ub7ec\ub85c \ub300\uccb4\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \ud604\uc7ac \uc874\uc7ac\ud558\ub294 \ud0c0\uc0ac \ub300\uc548\uc73c\ub85c\ub294 OPA/\uac8c\uc774\ud2b8\ud0a4\ud37c \ubc0f Kyverno\uac00 \uc788\uc2b5\ub2c8\ub2e4. PSP\uc5d0\uc11c \ud754\ud788 \ubcfc \uc218 \uc788\ub294 \uc815\ucc45\uc744 \uad6c\ud604\ud558\uae30 \uc704\ud55c \uac8c\uc774\ud2b8\ud0a4\ud37c \uc81c\uc57d \uc870\uac74 \ubc0f \uc81c\uc57d \uc870\uac74 \ud15c\ud50c\ub9bf \ubaa8\uc74c\uc740 GitHub\uc758 Gatekeeper \ub77c\uc774\ube0c\ub7ec\ub9ac \uc800\uc7a5\uc18c\uc5d0\uc11c \uac00\uc838\uc62c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c Kyverno \uc815\ucc45 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc5d0\uc11c \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS)\uc758  \uc804\uccb4 \uceec\ub809\uc158\uc744 \ud3ec\ud568\ud558\uc5ec PSP\ub97c \ub300\uccb4\ud560 \uc218 \uc788\ub294 \ub2e4\uc591\ud55c \uc81c\ud488\uc744 \ucc3e\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/security/docs/runtime/#_6","title":"\ub3c4\uad6c \ubc0f \ub9ac\uc18c\uc2a4","text":"<ul> <li>\uc2dc\uc791\ud558\uae30 \uc804\uc5d0 \uc54c\uc544\uc57c \ud560 7\uac00\uc9c0</li> <li>AppArmor Loader</li> <li>\ud504\ub85c\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub178\ub4dc \uc124\uc815</li> <li>Security Profiles Operator\ub294 \uc0ac\uc6a9\uc790\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c SELinux, seccomp \ubc0f AppArmor\ub97c \ub354 \uc27d\uac8c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uac83\uc744 \ubaa9\ud45c\ub85c \ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uac1c\uc120 \uc0ac\ud56d\uc785\ub2c8\ub2e4. \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2e4\ud589\ud558\uc5ec \ud504\ub85c\ud30c\uc77c\uc744 \uc0dd\uc131\ud558\uace0, \ud504\ub85c\ud30c\uc77c\uc744 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc\uc5d0 \ub85c\ub4dc\ud558\uc5ec \ud30c\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc744 \ubaa8\ub450 \uc81c\uacf5\ud55c\ub2e4.</li> <li>Inspektor Gadget\ub97c \uc0ac\uc6a9\ud558\uba74 seccomp \ud504\ub85c\ud30c\uc77c \uc0dd\uc131 \uc9c0\uc6d0\uc744 \ud3ec\ud568\ud558\uc5ec \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ub7f0\ud0c0\uc784 \ub3d9\uc791\uc758 \uc5ec\ub7ec \uce21\uba74\uc744 \uac80\uc0ac, \ucd94\uc801 \ubc0f \ud504\ub85c\ud30c\uc77c\ub9c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</li> <li>Aqua</li> <li>Qualys</li> <li>Stackrox</li> <li>Sysdig Secure</li> <li>Prisma</li> </ul>"},{"location":"ko/windows/docs/networking/","title":"\uc708\ub3c4\uc6b0 \ub124\ud2b8\uc6cc\ud06c","text":""},{"location":"ko/windows/docs/networking/#_2","title":"\uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \ub124\ud2b8\uc6cc\ud06c \uac1c\uc694","text":"<p>\uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\ub294 \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108\uc640 \uadfc\ubcf8\uc801\uc73c\ub85c \ub2e4\ub985\ub2c8\ub2e4. \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4, \uc720\ub2c8\uc628 \ud30c\uc77c \uc2dc\uc2a4\ud15c \uadf8\ub9ac\uace0 cgroup \ub4f1\uc758 \uad6c\uc131 \uc694\uc18c\ub85c \uc774\ub8e8\uc5b4\uc838 \uc788\uc2b5\ub2c8\ub2e4. \uc708\ub3c4\uc6b0\uc5d0\uc11c\ub294 \uc774\ub7f0 \uad6c\uc131 \uc694\uc18c\ub97c Host Compute Service (HCS)\uc5d0 \uc758\ud574 \ub3c4\ucf54\uc5d0\uc11c \ucd94\uc0c1\ud654 \ub429\ub2c8\ub2e4. HCS\ub294 \uc708\ub3c4\uc6b0\uc5d0\uc11c \ucee8\ud14c\uc774\ub108 \uad6c\ud604\uc744 \uc704\ud55c API \ub808\uc774\uc5b4 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4. \ub610\ud55c \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\ub294 \ub178\ub4dc\uc5d0\uc11c \ub124\ud2b8\uc6cc\ud06c \ud1a0\ud3f4\ub85c\uc9c0\ub97c \uc815\uc758\ud558\ub294\ub370 Host Network Service(HNS)\ub97c \ud65c\uc6a9\ud569\ub2c8\ub2e4.</p> <p></p> <p>\ub124\ud2b8\uc6cc\ud0b9 \uad00\uc810\uc5d0\uc11c \ubcf4\uba74 HCS\uc640 HNS\ub294 \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\uac00 \uac00\uc0c1 \uba38\uc2e0\ucc98\ub7fc \uc791\ub3d9\ud558\uac8c \ub9cc\ub4ed\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, \uc704 \ub2e4\uc774\uc5b4\uadf8\ub7a8\uc5d0 \ud45c\uc2dc\ub41c \uac83 \ucc98\ub7fc \uac01 \ucee8\ud14c\uc774\ub108\uc5d0\ub294 Hyper-V virtual switch(vSwitch)\uc5d0 \uc5f0\uacb0\ub41c \uac00\uc0c1 \ub124\ud2b8\uc6cc\ud06c \uc5b4\ub311\ud130(vNIC)\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/networking/#ip","title":"IP \uc8fc\uc18c \uad00\ub9ac","text":"<p>Amazon EKS\uc758 \ub178\ub4dc\ub294 Elastic Network Interface(ENI)\ub97c \uc0ac\uc6a9\ud558\uc5ec AWS VPC \ub124\ud2b8\uc6cc\ud06c\uc5d0 \uc5f0\uacb0\ud569\ub2c8\ub2e4. \ud604\uc7ac, \uc708\ub3c4\uc6b0 \uc6cc\ucee4 \ub178\ub4dc\ub2f9 \ub2e8\uc77c ENI\ub9cc \uc9c0\uc6d0 \ub429\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc758 IP \uc8fc\uc18c \uad00\ub9ac\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 VPC Resource Controller\uc5d0\uc11c \uc218\ud589\ub429\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc758 IP \uc8fc\uc18c \uad00\ub9ac \uc6cc\ud06c\ud50c\ub85c\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc5ec\uae30\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc708\ub3c4\uc6b0 \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc9c0\uc6d0\ud560 \uc218 \uc788\ub294 \ud30c\ub4dc \uc218\ub294 \ub178\ub4dc\uc758 \ud06c\uae30\uc640 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IPv4 \uac1c\uc218\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9d1\ub2c8\ub2e4. \ub178\ub4dc\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5\ud55c IPv4 \uac1c\uc218\ub294 \uc544\ub798\uc640 \uac19\uc774 \uacc4\uc0b0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4: - \uae30\ubcf8\uc801\uc73c\ub85c ENI\uc5d0\ub294 \ubcf4\uc870(Secondary) IPv4 \uc8fc\uc18c\ub9cc \ud560\ub2f9 \ub429\ub2c8\ub2e4. \ub2e4\uc74c\uacfc \uac19\uc740 \uacbd\uc6b0 -   <pre><code>\ud30c\ub4dc\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ucd1d IPv4 \uac1c\uc218 = \uc778\ud130\ud398\uc774\uc2a4\ub2f9 \uc9c0\uc6d0\ub418\ub294 IPv4 \uac1c\uc218 - 1\n</code></pre>   \ud558\ub098\uc758 IPv4 \uc8fc\uc18c\uac00 ENI\uc758 primary \uc8fc\uc18c\ub85c \uc0ac\uc6a9\ub418\ubbc0\ub85c \ud30c\ub4dc\uc5d0 \ud560\ub2f9\ud560 \uc218 \uc5c6\uc73c\ubbc0\ub85c \ucd1d \uac1c\uc218\uc5d0\uc11c 1\uc744 \ube8d\ub2c8\ub2e4. - \ub9cc\uc57d prefix delegation feature\uc744 \ud65c\uc131\ud654\ud558\uc5ec \ud30c\ub4dc\uc758 \ubc00\uc9d1\ub3c4\ub97c \ub192\uc774\ub3c4\ub85d \uad6c\uc131\ub41c \uacbd\uc6b0\uc5d0\ub294 -   <pre><code>\ud30c\ub4dc\uc5d0 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \ucd1d IPv4 \uac1c\uc218 = (\uc778\ud130\ud398\uc774\uc2a4\ub2f9 \uc9c0\uc6d0\ub418\ub294 IPv4 \uac1c\uc218 - 1) * 16\n</code></pre>   VPC Resource Controller\ub294 \ubcf4\uc870 IPv4 \uc8fc\uc18c\ub97c \ud560\ub2f9\ud558\ub294 \ub300\uc2e0 <code>/28 prefixes</code>\ub97c \ud560\ub2f9\ud558\ubbc0\ub85c \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc804\uccb4 IPv4 \uac1c\uc218\uac00 16\ubc30 \uc99d\uac00\ud569\ub2c8\ub2e4.</p> <p>\uc704 \uacf5\uc2dd\uc744 \uc0ac\uc6a9\ud558\uba74 \uc544\ub798\uc640 \uac19\uc774 m5.large \uc778\uc2a4\ud134\uc2a4\uc758 \ucd5c\ub300 \ud30c\ub4dc \uc218\ub97c \uacc4\uc0b0\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4- - \uae30\ubcf8\uc801\uc73c\ub85c \ubcf4\uc870 IP \ubaa8\ub4dc\uc5d0\uc11c \uc2e4\ud589\ud558\ub294 \uacbd\uc6b0 -   <pre><code>\uc778\ud130\ud398\uc774\uc2a4\ub2f9 10\uac1c \ubcf4\uc870 IPv4 \uac1c\uc218 - 1 = 9\uac1c \uc0ac\uc6a9 \uac00\ub2a5\ud55c IPv4 \uac1c\uc218\n</code></pre> - <code>prefix delegation</code>\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 -   <pre><code>(\uc778\ud130\ud398\uc774\uc2a4\ub2f9 10\uac1c \ubcf4\uc870 IPv4 \uac1c\uc218 - 1) * 16 = 144\uac1c \uc0ac\uc6a9 \uac00\ub2a5\ud55c IPv4 \uac1c\uc218\n</code></pre></p> <p>\uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc5d0 \ub530\ub978 \uc0ac\uc6a9 \uac00\ub2a5\ud55c IP \uac1c\uc218\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 IP addresses per network interface per instance type\ub97c \ucc38\uc870 \ubc14\ub78d\ub2c8\ub2e4.</p> <p>\ub610 \ub2e4\ub978 \uc8fc\uc694 \uace0\ub824 \uc0ac\ud56d\uc740 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d\uc758 \ud750\ub984\uc785\ub2c8\ub2e4. \uc708\ub3c4\uc6b0\ub97c \uc0ac\uc6a9\ud558\uba74 100\uac1c\uac00 \ub118\ub294 \uc11c\ube44\uc2a4\uac00 \uc788\ub294 \ub178\ub4dc\uc5d0\uc11c \ud3ec\ud2b8\uac00 \uace0\uac08 \ub420 \uc704\ud5d8\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc0c1\ud0dc\uac00 \ubc1c\uc0dd\ud558\uba74 \ub178\ub4dc\uc5d0\uc11c \ub2e4\uc74c \uba54\uc2dc\uc9c0\uc640 \ud568\uaed8 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uae30 \uc2dc\uc791\ud569\ub2c8\ub2e4:</p> <p>\"Policy creation failed: hcnCreateLoadBalancer failed in Win32: The specified port already exists.\"</p> <p>\uc774 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud574 Direct Server Return(DSR)\uc744 \ud65c\uc6a9\ud569\ub2c8\ub2e4. DSR\uc740 \ube44\ub300\uce6d \ub124\ud2b8\uc6cc\ud06c \ubd80\ud558 \ubd84\uc0b0\uc744 \uad6c\ud604\ud55c \uac83\uc785\ub2c8\ub2e4. \uc989, \uc694\uccad \ud2b8\ub798\ud53d\uacfc \uc751\ub2f5 \ud2b8\ub798\ud53d\uc740 \uc11c\ub85c \ub2e4\ub978 \ub124\ud2b8\uc6cc\ud06c \uacbd\ub85c\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc774 \uae30\ub2a5\uc740 Pod \uac04\uc758 \ud1b5\uc2e0 \uc18d\ub3c4\ub97c \ub192\uc774\uace0 \ud3ec\ud2b8 \uace0\uac08 \uc704\ud5d8\uc744 \uc904\uc785\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0\uc11c DSR\uc744 \ud65c\uc131\ud654 \ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>DSR\uc740 Windows Server SAC EKS Optimized AMIs\uc5d0\uc11c \uae30\ubcf8\uc801\uc73c\ub85c \ud65c\uc131\ud654 \ub429\ub2c8\ub2e4. Windows Server 2019 LTSC EKS Optimized AMI\uc758 \uacbd\uc6b0, \uc544\ub798 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud558\uace0 <code>eksctl</code> \ub178\ub4dc\uadf8\ub8f9\uc758 amiFamily\ub85c Windows Server 2019 Full \ub610\ub294 Core\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc778\uc2a4\ud134\uc2a4 \ud504\ub85c\ube44\uc800\ub2dd \uc911\uc5d0 \uc774\ub97c \ud65c\uc131\ud654\ud574\uc57c \ud569\ub2c8\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 eksctl custom AMI\ub97c \ucc38\uc870 \ubc14\ub78d\ub2c8\ub2e4.</p> <p><pre><code>nodeGroups:\n- name: windows-ng\n  instanceType: c5.xlarge\n  minSize: 1\n  volumeSize: 50\n  amiFamily: WindowsServer2019CoreContainer\n  ssh:\n    allow: false\n</code></pre> \uc708\ub3c4\uc6b0 \uc11c\ubc84 2019 \uc774\uc0c1\uc5d0\uc11c DSR\uc744 \ud65c\uc6a9\ud558\ub824\uba74 \uc778\uc2a4\ud134\uc2a4 \uc2dc\uc791 \uc2dc \ub2e4\uc74c\uacfc \uac19\uc740 kube-proxy \ud50c\ub798\uadf8\ub97c \uc9c0\uc815\ud574\uc57c \ud569\ub2c8\ub2e4. \uc790\uccb4 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 \uc2dc\uc791 \ud15c\ud50c\ub9bf\uacfc \uad00\ub828\ub41c \uc0ac\uc6a9\uc790 \ub370\uc774\ud130 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc870\uc815\ud558\uc5ec \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>&lt;powershell&gt;\n[string]$EKSBinDir = \"$env:ProgramFiles\\Amazon\\EKS\"\n[string]$EKSBootstrapScriptName = 'Start-EKSBootstrap.ps1'\n[string]$EKSBootstrapScriptFile = \"$EKSBinDir\\$EKSBootstrapScriptName\"\n(Get-Content $EKSBootstrapScriptFile).replace('\"--proxy-mode=kernelspace\",', '\"--proxy-mode=kernelspace\", \"--feature-gates WinDSR=true\", \"--enable-dsr\",') | Set-Content $EKSBootstrapScriptFile \n&amp; $EKSBootstrapScriptFile -EKSClusterName \"eks-windows\" -APIServerEndpoint \"https://&lt;REPLACE-EKS-CLUSTER-CONFIG-API-SERVER&gt;\" -Base64ClusterCA \"&lt;REPLACE-EKSCLUSTER-CONFIG-DETAILS-CA&gt;\" -DNSClusterIP \"172.20.0.10\" -KubeletExtraArgs \"--node-labels=alpha.eksctl.io/cluster-name=eks-windows,alpha.eksctl.io/nodegroup-name=windows-ng-ltsc2019 --register-with-taints=\" 3&gt;&amp;1 4&gt;&amp;1 5&gt;&amp;1 6&gt;&amp;1\n&lt;/powershell&gt;\n</code></pre> <p>DSR \ud65c\uc131\ud654 \uc808\ucc28\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 Microsoft \ub124\ud2b8\uc6cc\ud06c \ube14\ub85c\uadf8 \ubc0f AWS \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \uc6cc\ud06c\uc0f5\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p></p> <p>\uc774\uc804 \ubc84\uc804\uc758 \uc708\ub3c4\uc6b0\ub97c \uc0ac\uc6a9\ud558\uba74 DSR\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ud3ec\ud2b8\uac00 \uace0\uac08\ub420 \uc704\ud5d8\uc774 \ub192\uc544\uc9d1\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/networking/#container-network-interface-cni","title":"Container Network Interface (CNI) \uc635\uc158","text":"<p>AWS VPC CNI\ub294 \uc708\ub3c4\uc6b0 \ubc0f \ub9ac\ub205\uc2a4 \uc6cc\ucee4 \ub178\ub4dc\ub97c \uc704\ud55c \uc0ac\uc2e4\uc0c1 \ud45c\uc900(de facto)\uc758 CNI \ud50c\ub7ec\uadf8\uc778\uc785\ub2c8\ub2e4. AWS VPC CNI\ub294 \ub9ce\uc740 \uace0\uac1d\uc758 \uc694\uad6c\ub97c \ucda9\uc871\ud558\uc9c0\ub9cc, IP \uc8fc\uc18c \uace0\uac08\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud574 \uc624\ubc84\ub808\uc774 \ub124\ud2b8\uc6cc\ud06c\uc640 \uac19\uc740 \ub300\uc548\uc744 \uace0\ub824\ud574\uc57c \ud558\ub294 \uacbd\uc6b0\uac00 \uc788\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uacbd\uc6b0 AWS VPC CNI \ub300\uc2e0 Calico CNI\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. Project Calico\ub294 Tigera\uc5d0\uc11c \uac1c\ubc1c\ud55c \uc624\ud508 \uc18c\uc2a4 \uc18c\ud504\ud2b8\uc6e8\uc5b4\ub85c, EKS\uc640 \ud568\uaed8 \uc791\ub3d9\ud558\ub294 CNI\ub97c \ud3ec\ud568\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. EKS\uc5d0 Calico CNI\ub97c \uc124\uce58\ud558\ub294 \ubc29\ubc95\uc740 Project Calico EKS \uc124\uce58 \ud398\uc774\uc9c0\uc5d0\uc11c \ud655\uc778 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/networking/#_3","title":"\ub124\ud2b8\uc6cc\ud06c \uc815\ucc45","text":"<p>Kubernetes \ud074\ub7ec\uc2a4\ud130\uc758 \ud30c\ub4dc \uac04 \uac1c\ubc29\ud615 \ud1b5\uc2e0\uc758 \uae30\ubcf8 \ubaa8\ub4dc\uc5d0\uc11c \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uae30\ubc18\uc73c\ub85c \uc561\uc138\uc2a4\ub97c \uc81c\ud55c\ud558\ub294 \uac83\uc73c\ub85c \ubcc0\uacbd\ud558\ub294 \uac83\uc774 \ubaa8\ubc94 \uc0ac\ub840\ub85c \uac04\uc8fc\ub429\ub2c8\ub2e4. \uc624\ud508\uc18c\uc2a4 Project Calico\ub294 Linux\uc640 Windows \ub178\ub4dc \ubaa8\ub450\uc5d0\uc11c \uc791\ub3d9\ud558\ub294 \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45\uc744 \uac15\ub825\ud558\uac8c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \uc774 \uae30\ub2a5\uc740 \ubcc4\uac1c\uc774\uba70 Calico CNI \uc0ac\uc6a9\uc5d0 \uc758\uc874\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c Calico\ub97c \uc124\uce58\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc815\ucc45 \uad00\ub9ac\uc5d0 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>EKS\uc5d0 Calico\ub97c \uc124\uce58\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc740 Amazon EKS Calico \uc124\uce58\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub610\ud55c, \ubcf4\uc548 \ubaa8\ubc94 \uc0ac\ub840 - \ub124\ud2b8\uc6cc\ud06c \uc139\uc158\uc758 \ub0b4\uc6a9\uc740 Windows \uc6cc\ucee4 \ub178\ub4dc\uac00 \uc788\ub294 EKS \ud074\ub7ec\uc2a4\ud130\uc5d0\ub3c4 \ub3d9\uc77c\ud558\uac8c \uc801\uc6a9\ub418\uc9c0\ub9cc, \"\ud30c\ub4dc\uc6a9 \ubcf4\uc548 \uadf8\ub8f9\"\uacfc \uac19\uc740 \uc77c\ubd80 \uae30\ub2a5\uc740 \ud604\uc7ac Windows\uc5d0\uc11c \uc9c0\uc6d0\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/oom/","title":"OOM(Out of Memory) \uc5d0\ub7ec \ubc29\uc9c0","text":"<p>\uc708\ub3c4\uc6b0\uc5d0\ub294 Linux\ucc98\ub7fc OOM \ud504\ub85c\uc138\uc2a4 \ud0ac\ub7ec\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uc708\ub3c4\uc6b0\ub294 \ud56d\uc0c1 \ubaa8\ub4e0 \uc0ac\uc6a9\uc790 \ubaa8\ub4dc(user-mode) \uba54\ubaa8\ub9ac \ud560\ub2f9\uc744 \uac00\uc0c1\uc73c\ub85c \ucde8\uae09\ud558\uba70 pagefiles \uac00 \ud544\uc218\uc785\ub2c8\ub2e4. \uacb0\uacfc\uc801\uc73c\ub85c \uc708\ub3c4\uc6b0\ub294 Linux\uc640 \uac19\uc740 \ubc29\uc2dd\uc73c\ub85c OOM \uc0c1\ud0dc\uc5d0 \ub3c4\ub2ec\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ud504\ub85c\uc138\uc2a4\ub294 OOM\ub85c \uc885\ub8cc\ub418\ub294 \ub300\uc2e0 \ub514\uc2a4\ud06c\ub85c \ud398\uc774\uc9d5\ub429\ub2c8\ub2e4. \uba54\ubaa8\ub9ac\uac00 \uacfc\ub3c4\ud558\uac8c \ud504\ub85c\ube44\uc800\ub2dd\ub418\uace0 \ubb3c\ub9ac\uc801 \uba54\ubaa8\ub9ac\uac00 \ubaa8\ub450 \uc18c\uc9c4\ub418\uba74 \ud398\uc774\uc9d5\uc73c\ub85c \uc778\ud574 \uc131\ub2a5\uc774 \uc800\ud558\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/oom/#kubelet","title":"\uc2dc\uc2a4\ud15c \ubc0f kubelet \uba54\ubaa8\ub9ac \uc608\uc57d","text":"<p><code>--kubelet-reserve</code> \ub294 kubelet, \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784 \ub4f1\uacfc \uac19\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2dc\uc2a4\ud15c \ub370\ubaac\uc5d0 \ub300\ud55c \ub9ac\uc18c\uc2a4 \uc608\uc57d\uc744 \ucea1\ucc98\ud558\uace0 <code>--system-reserve</code> \ub294 sshd, udev \ub4f1\uacfc \uac19\uc740 OS \uc2dc\uc2a4\ud15c \ub370\ubaac\uc5d0 \ub300\ud55c \ub9ac\uc18c\uc2a4 \uc608\uc57d\uc744 \ucea1\ucc98\ud558\uace0 \uc124\uc815\ud558\ub294 \ub9ac\ub205\uc2a4\uc640\ub294 \ub2e4\ub985\ub2c8\ub2e4. \uc708\ub3c4\uc6b0\uc5d0\uc11c \uc774\ub7f0 \ud50c\ub798\uadf8\ub294 kubelet \ub610\ub294 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud504\ub85c\uc138\uc2a4\uc5d0 \ub300\ud55c \uba54\ubaa8\ub9ac \uc81c\ud55c\uc744 \ucea1\ucc98\ud558\uac70\ub098 \uc124\uc815\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.</p> <p>\ud558\uc9c0\ub9cc \uc774\ub7f0 \ud50c\ub798\uadf8\ub97c \uc870\ud569\ud558\uc5ec NodeAllocatable\uc744 \uad00\ub9ac\ud558\uc5ec \ud30c\ub4dc \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0 \uba54\ubaa8\ub9ac \ub9ac\uc18c\uc2a4 \ud55c\ub3c4(memory resource limit)\uac00 \uc788\ub294 \ub178\ub4dc\uc758 \uc6a9\ub7c9\uc744 \uc904\uc5ec \ud30c\ub4dc\ubcc4\ub85c \uba54\ubaa8\ub9ac \ud560\ub2f9\uc744 \uc81c\uc5b4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc804\ub7b5\uc744 \uc0ac\uc6a9\ud558\uba74 \uba54\ubaa8\ub9ac \ud560\ub2f9\uc744 \ub354 \uc798 \uc81c\uc5b4\ud560 \uc218 \uc788\uc744 \ubfd0\ub9cc \uc544\ub2c8\ub77c \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc758 OOM\uc744 \ucd5c\uc18c\ud654\ud558\ub294 \uba54\ucee4\ub2c8\uc998\ub3c4 \ud655\ubcf4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0\uc11c\ub294 OS \ubc0f \ud504\ub85c\uc138\uc2a4\uc5d0 \uc0ac\uc6a9\ud560 \ucd5c\uc18c 2GB\uc758 \uba54\ubaa8\ub9ac\ub97c \uc608\uc57d\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc88b\uc2b5\ub2c8\ub2e4. <code>--kubelet-reserve</code> \ub610\ub294 <code>--system-reserve</code>  \ud30c\ub77c\ubbf8\ud130\ub97c \ud65c\uc6a9\ud558\uc5ec NodeAllocatable\uc744 \uc904\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>Amazon EKS \uc790\uccb4 \uad00\ub9ac\ud615 \uc708\ub3c4\uc6b0 \ub178\ub4dc \uc124\uba85\uc5d0 \ub530\ub77c CloudFormation \ud15c\ud50c\ub9bf\uc744 \uc0ac\uc6a9\ud558\uc5ec kubelet \uad6c\uc131\uc744 \ucee4\uc2a4\ud130\ub9c8\uc774\uc81c\uc774\uc158 \ud558\uc5ec \uc0c8 \uc708\ub3c4\uc6b0 \ub178\ub4dc \uadf8\ub8f9\uc73c\ub85c \uc2dc\uc791\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. CloudFormation\uc5d0\ub294 <code>BootstraArguments</code>\ub77c\ub294 \uc694\uc18c\uac00 \uc788\ub294\ub370, \uc774\ub294 <code>KubeletExtraArgs</code>\uc640 \ub3d9\uc77c\ud569\ub2c8\ub2e4. \ub2e4\uc74c \ud50c\ub798\uadf8 \ubc0f \uac12\uacfc \ud568\uaed8 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <pre><code>--kube-reserved memory=0.5Gi,ephemeral-storage=1Gi --system-reserved memory=1.5Gi,ephemeral-storage=1Gi --eviction-hard memory.available&lt;200Mi,nodefs.available&lt;10%\"\n</code></pre> <p>eksctl\uc744 \ubc30\ud3ec \ub3c4\uad6c\ub85c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, \ub2e4\uc74c https://eksctl.io/usage/customizing-the-kubelet/ \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc5ec kublet\uc744 \ucee4\uc2a4\ud130\ub9c8\uc774\uc988 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/oom/#_1","title":"\uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \uba54\ubaa8\ub9ac \uc694\uad6c \uc0ac\ud56d","text":"<p>Microsoft \ubb38\uc11c\uc5d0 \ub530\ub974\uba74 NANO\uc6a9 Windows Server \ubca0\uc774\uc2a4 \uc774\ubbf8\uc9c0\uc5d0\ub294 \ucd5c\uc18c 30MB\uac00 \ud544\uc694\ud55c \ubc18\uba74 \uc708\ub3c4\uc6b0 Server Core \uc774\ubbf8\uc9c0\uc5d0\ub294 45MB\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \uc774 \uc218\uce58\ub294 .NET \ud504\ub808\uc784\uc6cc\ud06c, IIS \uc6f9 \uc11c\ube44\uc2a4 \ubc0f \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8\uacfc \uac19\uc740 \uc708\ub3c4\uc6b0 \uad6c\uc131 \uc694\uc18c\ub97c \ucd94\uac00\ud568\uc5d0 \ub530\ub77c \uc99d\uac00\ud569\ub2c8\ub2e4.</p> <p>\uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0(\uc608: \uae30\ubcf8 \uc774\ubbf8\uc9c0\uc640 \ud574\ub2f9 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \uacc4\uce35)\uc5d0 \ud544\uc694\ud55c \ucd5c\uc18c \uba54\ubaa8\ub9ac \uc591\uc744 \uc54c\uace0 \ud30c\ub4dc \uc2a4\ud399\uc5d0 \ucee8\ud14c\uc774\ub108\uc758 \ub9ac\uc18c\uc2a4 requests\ub97c \uc124\uc815\ud558\ub294 \uac83\uc774 \uc911\uc694\ud569\ub2c8\ub2e4. \ub610\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ubb38\uc81c \ubc1c\uc0dd \uc2dc \ud30c\ub4dc\uac00 \uac00\uc6a9 \ub178\ub4dc \uba54\ubaa8\ub9ac\ub97c \ubaa8\ub450 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub3c4\ub85d limit\uc744 \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\uc544\ub798 \uc608\uc81c\uc5d0\uc11c, \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ucf00\uc904\ub7ec\uac00 \ub178\ub4dc\uc5d0 \ud30c\ub4dc\ub97c \ubc30\uce58\ud558\ub824\uace0 \ud560 \ub54c, \ud30c\ub4dc\uc758 requests\uc744 \ud1b5\ud574 \ucda9\ubd84\ud55c \ub9ac\uc18c\uc2a4\uac00 \uc788\ub294 \ub178\ub4dc\ub97c \uacb0\uc815\ud558\ub294\ub370 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p> <pre><code> spec:\n  - name: iis\n    image: mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2019\n    resources:\n      limits:\n        cpu: 1\n        memory: 800Mi\n      requests:\n        cpu: .1\n        memory: 128Mi\n</code></pre>"},{"location":"ko/windows/docs/oom/#_2","title":"\uacb0\ub860","text":"<p>\uc704\uc640 \uac19\uc740 \uc811\uadfc \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud574\ub3c4 \uba54\ubaa8\ub9ac \uace0\uac08 \uc704\ud5d8\uc774 \ucd5c\uc18c\ud654\ub418\uc9c0\ub9cc \ubc1c\uc0dd \uc790\uccb4\ub97c \ubc29\uc9c0\ud560 \uc218\ub294 \uc5c6\uc2b5\ub2c8\ub2e4. Amazon CloudWatch \uba54\ud2b8\ub9ad \uc9c0\ud45c\ub97c \uc0ac\uc6a9\ud558\uba74 \uba54\ubaa8\ub9ac \uc18c\uc9c4\uc774 \ubc1c\uc0dd\ud560 \uacbd\uc6b0 \uc54c\ub9bc \ubc0f \ud574\uacb0 \ubc29\ubc95\uc744 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/patching/","title":"\uc708\ub3c4\uc6b0 \uc11c\ubc84 \ubc0f \ucee8\ud14c\uc774\ub108 \ud328\uce58","text":"<p>\uc708\ub3c4\uc6b0 \uc11c\ubc84 \ud328\uce58 \uc791\uc5c5\uc740 \uc708\ub3c4\uc6b0 \uad00\ub9ac\uc790\ub97c \uc704\ud55c \ud45c\uc900 \uad00\ub9ac \uc791\uc5c5\uc785\ub2c8\ub2e4. Amazon System Manager - Patch Manager, WSUS, System Center Configuration Manager \ub4f1\uacfc \uac19\uc740 \ub2e4\uc591\ud55c \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc Amazon EKS \ud074\ub7ec\uc2a4\ud130\uc758 \uc708\ub3c4\uc6b0 \ub178\ub4dc\ub97c \uc77c\ubc18 \uc708\ub3c4\uc6b0 \uc11c\ubc84\ub85c \ucde8\uae09\ud574\uc11c\ub294 \uc548 \ub429\ub2c8\ub2e4. \uc774\ub4e4\uc740 \ubcc0\uacbd\ud560 \uc218 \uc5c6\ub294 \uc11c\ubc84\ub85c \ucde8\uae09\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uac04\ub2e8\ud788 \ub9d0\ud574, \uae30\uc874 \ub178\ub4dc\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uc9c0 \ub9d0\uace0 \uc2dc\uc791 \ud15c\ud50c\ub9bf\uc5d0 \uc0c8\ub85c \uc5c5\ub370\uc774\ud2b8\ub41c AMI\ub97c \uae30\ubc18\uc73c\ub85c \uc0c8 \ub178\ub4dc\ub97c \uc2dc\uc791\ud558\uae30\ub9cc \ud558\uba74 \ub429\ub2c8\ub2e4.</p> <p>EC2 Image Builder\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub808\uc2dc\ud53c\ub97c \uc0dd\uc131\ud558\uace0 \uad6c\uc131 \uc694\uc18c\ub97c \ucd94\uac00\ud558\uc5ec AMI \ube4c\ub4dc\ub97c \uc790\ub3d9\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uc608\uc81c\ub294 \uad6c\uc131 \uc694\uc18c\ub97c \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \uad6c\uc131 \uc694\uc18c\ub294 AWS\uc5d0\uc11c \uad6c\ucd95\ud55c \uae30\uc874 \uad6c\uc131 \uc694\uc18c(Amazon-managed)\uc77c \uc218\ub3c4 \uc788\uace0 \uc0ac\uc6a9\uc790\uac00 \uc0dd\uc131\ud55c \uad6c\uc131 \uc694\uc18c(Owned by me)\uc77c \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. Amazon\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 update-windows\ub77c\ub294 \uad6c\uc131 \uc694\uc18c\uc5d0 \uc8fc\ubaa9\ud558\uc2ed\uc2dc\uc624. \uc774\ub807\uac8c \ud558\uba74 EC2 Image Builder \ud30c\uc774\ud504\ub77c\uc778\uc744 \ud1b5\ud574 AMI\ub97c \uc0dd\uc131\ud558\uae30 \uc804\uc5d0 \uc708\ub3c4\uc6b0 \uc11c\ubc84\uac00 \uc5c5\ub370\uc774\ud2b8\ub429\ub2c8\ub2e4.</p> <p></p> <p>EC2 Image Builder\ub97c \uc0ac\uc6a9\ud558\uba74 Amazon \uc81c\uacf5 \ud37c\ube14\ub9ad AMI\ub97c \uae30\ubc18\uc73c\ub85c AMI\ub97c \uad6c\ucd95\ud558\uace0 \ube44\uc988\ub2c8\uc2a4 \uc694\uad6c \uc0ac\ud56d\uc5d0 \ub9de\uac8c \ucee4\uc2a4\ud130\ub9c8\uc774\uc9d5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7f0 \ub2e4\uc74c \ud574\ub2f9 AMI\ub97c EKS \ub178\ub4dc \uadf8\ub8f9\uc5d0\uc11c \uc0dd\uc131\ud55c Auto Scaling \uadf8\ub8f9\uc758 \uc2dc\uc791 \ud15c\ud50c\ub9bf(Launch Template)\uc5d0 \uc5f0\uacb0 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \uc791\uc5c5\uc774 \uc644\ub8cc\ub418\uba74 \uae30\uc874 \uc708\ub3c4\uc6b0 \ub178\ub4dc\ub97c \uc885\ub8cc\ud560 \uc218 \uc788\uc73c\uba70 \uc0c8\ub85c \uc5c5\ub370\uc774\ud2b8\ub41c AMI\ub97c \uae30\ubc18\uc73c\ub85c \uc0c8 \uc708\ub3c4\uc6b0 \ub178\ub4dc\uac00 \uc2dc\uc791\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/patching/#pushing-pulling","title":"\uc708\ub3c4\uc6b0 \uc774\ubbf8\uc9c0 \ud478\uc2f1(Pushing)\uc640 \ud480\ub9c1(Pulling)","text":"<p>Amazon\uc740 2\uac1c\uc758 \uce90\uc2dc\ub41c \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \ud3ec\ud568\ud558\ub294 EKS \ucd5c\uc801\ud654 AMI\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4.</p> <pre><code>mcr.microsoft.com/windows/servercore\nmcr.microsoft.com/windows/nanoserver\n</code></pre> <p></p> <p>\uce90\uc2dc\ub41c \uc774\ubbf8\uc9c0\ub294 main OS \uc5c5\ub370\uc774\ud2b8\uc5d0 \ub530\ub77c \uc5c5\ub370\uc774\ud2b8 \ub429\ub2c8\ub2e4. Microsoft\uac00 \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \ubca0\uc774\uc2a4 \uc774\ubbf8\uc9c0\uc5d0 \uc9c1\uc811\uc801\uc778 \uc601\ud5a5\uc744 \ubbf8\uce58\ub294 \uc0c8\ub85c\uc6b4 \uc708\ub3c4\uc6b0 \uc5c5\ub370\uc774\ud2b8\ub97c \ucd9c\uc2dc\ud558\uba74 \ud574\ub2f9 \uc5c5\ub370\uc774\ud2b8\ub294 main OS\uc5d0\uc11c \uc77c\ubc18\uc801\uc778 \uc708\ub3c4\uc6b0 \uc5c5\ub370\uc774\ud2b8(ordinary Windows Update)\ub85c \uc2dc\uc791 \ub429\ub2c8\ub2e4. \ud658\uacbd\uc744 \ucd5c\uc2e0 \uc0c1\ud0dc\ub85c \uc720\uc9c0\ud558\uba74 \ub178\ub4dc \ubc0f \ucee8\ud14c\uc774\ub108 \uc218\uc900\uc5d0\uc11c \ubcf4\ub2e4 \uc548\uc804\ud55c \ud658\uacbd\uc774 \uc81c\uacf5\ub429\ub2c8\ub2e4.</p> <p>\uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\uc758 \ud06c\uae30\ub294 \ud478\uc2dc/\ud480 \uc218\ud589\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce58\ubbc0\ub85c \ucee8\ud14c\uc774\ub108 \uc2dc\uc791 \uc2dc\uac04(conatiner startup time)\uc774 \ub290\ub824\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \uce90\uc2f1\uc5d0 \ubc29\uc2dd\uc73c\ub85c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uce90\uc2f1\ud558\uba74 \ucee8\ud14c\uc774\ub108 \uc2dc\uc791 \ub300\uc2e0 AMI \ube4c\ub4dc \uc0dd\uc131\uc2dc \ube44\uc6a9\uc774 \ub9ce\uc774 \ub4dc\ub294 I/O \uc791\uc5c5(\ud30c\uc77c \ucd94\ucd9c)\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub530\ub77c\uc11c \ud544\uc694\ud55c \ubaa8\ub4e0 \uc774\ubbf8\uc9c0 \ub808\uc774\uc5b4\uac00 AMI\uc5d0\uc11c \ucd94\ucd9c\ub418\uc5b4 \ubc14\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ub418\ubbc0\ub85c \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\uac00 \uc2dc\uc791\ub418\uace0 \ud2b8\ub798\ud53d \uc218\uc2e0\uc744 \uc2dc\uc791\ud560 \uc218 \uc788\ub294 \uc2dc\uac04\uc774 \ub2e8\ucd95\ub429\ub2c8\ub2e4. \ud478\uc2dc \uc791\uc5c5 \uc911\uc5d0\ub294 \uc774\ubbf8\uc9c0\ub97c \uad6c\uc131\ud558\ub294 \ub808\uc774\uc5b4\ub9cc \uc800\uc7a5\uc18c\uc5d0 \uc5c5\ub85c\ub4dc\ub429\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uc608\uc81c\uc5d0\uc11c\ub294 Amazon ECR\uc5d0\uc11c fluentd-windows-sac2004 \uc774\ubbf8\uc9c0\uc758 \ud06c\uae30\uac00 390.18MB\uc5d0 \ubd88\uacfc\ud558\ub2e4\ub294 \uac83\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \ud478\uc2dc \uc791\uc5c5 \uc911\uc5d0 \ubc1c\uc0dd\ud55c \uc5c5\ub85c\ub4dc \uc591\uc785\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uc608\uc81c\uc5d0\uc11c\ub294 Amazon ECR \ub9ac\ud3ec\uc9c0\ud1a0\ub9ac\uc5d0 \ud478\uc2dc\ub41c fluentd Windows ltsc \uc774\ubbf8\uc9c0\ub97c \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. ECR\uc5d0 \uc800\uc7a5\ub418\ub294 \ub808\uc774\uc5b4\uc758 \ud06c\uae30\ub294 533.05MB\uc785\ub2c8\ub2e4.</p> <p></p> <p>\uc544\ub798 <code>docker image ls</code> \ucd9c\ub825\uc5d0\uc11c\ub294 fluentd v1.14-windows-ltsc2019-1\uc758 \ud06c\uae30\uac00 \ub514\uc2a4\ud06c\uc5d0\uc11c 6.96GB\uc774\uc9c0\ub9cc, \ud574\ub2f9 \uc591\uc758 \ub370\uc774\ud130\ub97c \ub2e4\uc6b4\ub85c\ub4dc\ud558\uace0 \ucd94\ucd9c\ud588\ub2e4\ub294 \uc758\ubbf8\ub294 \uc544\ub2d9\ub2c8\ub2e4.</p> <p>\uc2e4\uc81c\ub85c \ud480 \uc218\ud589\uc2dc\uc5d0\ub294 compressed 533.05MB\ub9cc \ub2e4\uc6b4\ub85c\ub4dc\ub418\uc5b4 \ucd94\ucd9c\ub429\ub2c8\ub2e4.</p> <pre><code>REPOSITORY                                                              TAG                        IMAGE ID       CREATED         SIZE\n111122223333.dkr.ecr.us-east-1.amazonaws.com/fluentd-windows-coreltsc   latest                     721afca2c725   7 weeks ago     6.96GB\nfluent/fluentd                                                          v1.14-windows-ltsc2019-1   721afca2c725   7 weeks ago     6.96GB\namazonaws.com/eks/pause-windows                                         latest                     6392f69ae6e7   10 months ago   255MB\n</code></pre> <p>size \uceec\ub7fc\uc5d0 \uc774\ubbf8\uc9c0\uc758 \uc804\uccb4 \ud06c\uae30\ub85c 6.96GB\uac00 \ud45c\uc2dc\ub429\ub2c8\ub2e4. \uc774\uc5d0 \ub300\ud55c \uc0c1\uc138\ud55c \ub0b4\uc5ed\uc785\ub2c8\ub2e4:</p> <ul> <li>Windows Server Core 2019 LTSC Base image = 5.74GB</li> <li>Fluentd Uncompressed Base Image = 6.96GB</li> <li>Difference on disk = 1.2GB</li> <li>Fluentd compressed final image ECR = 533.05MB</li> </ul> <p>\uae30\ubcf8 \uc774\ubbf8\uc9c0\uac00 \ub85c\uceec \ub514\uc2a4\ud06c\uc5d0 \uc774\ubbf8 \uc788\uc73c\ubbc0\ub85c \ub514\uc2a4\ud06c\uc758 \ucd1d \uc6a9\ub7c9\uc740 1.2GB\uac00 \ucd94\uac00\ub429\ub2c8\ub2e4. \ub2e4\uc74c\uc5d0 size \uceec\ub7fc\uc5d0 GB \uc6a9\ub7c9\uc774 \ud45c\uc2dc\ub418\ub354\ub77c\ub3c4 \ub108\ubb34 \uac71\uc815\ud560 \ud544\uc694 \uc5c6\uc2b5\ub2c8\ub2e4. \uc774\ubbf8 70% \uc774\uc0c1\uc774 \uce90\uc2dc\ub41c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub85c \ub514\uc2a4\ud06c\uc5d0 \uc800\uc7a5\ub418\uc5b4 \uc788\uc744 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/patching/#_2","title":"\ucc38\uace0 \uc790\ub8cc","text":"<p>EC2 Image builder \ubc0f \uc774\ubbf8\uc9c0 \uce90\uc2dc \uc804\ub7b5\uc73c\ub85c \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \uc2dc\uc791 \uc2dc\uac04 \ub2e8\ucd95</p>"},{"location":"ko/windows/docs/scheduling/","title":"\uc774\uae30\uc885 \uc6cc\ud06c\ub85c\ub4dc \uc2e4\ud589\u00b6","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ub3d9\uc77c\ud55c \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub9ac\ub205\uc2a4 \ubc0f \uc708\ub3c4\uc6b0 \ub178\ub4dc\ub97c \ud63c\ud569\ud558\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc774\uae30\uc885(Heterogeneous) \ud074\ub7ec\uc2a4\ud130\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4. \ud574\ub2f9 \ud074\ub7ec\uc2a4\ud130 \ub0b4\uc5d0\ub294 \ub9ac\ub205\uc2a4\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\uc640 \uc708\ub3c4\uc6b0\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ud30c\ub4dc\ub97c \ud63c\ud569\ud558\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub3d9\uc77c\ud55c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc5ec\ub7ec \ubc84\uc804\uc758 \uc708\ub3c4\uc6b0\ub97c \uc2e4\ud589\ud560 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc774 \uacb0\uc815\uc744 \ub0b4\ub9b4 \ub54c \uace0\ub824\ud574\uc57c \ud560 \uba87 \uac00\uc9c0 \uc694\uc18c(\uc544\ub798 \uc124\uba85 \ucc38\uc870)\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/scheduling/#_2","title":"\ub178\ub4dc \ub0b4 \ud30c\ub4dc \ud560\ub2f9 \ubaa8\ubc94 \uc0ac\ub840","text":"<p>\ub9ac\ub205\uc2a4 \ubc0f \uc708\ub3c4\uc6b0 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uac01\uac01\uc758 OS\ubcc4 \ub178\ub4dc\uc5d0 \uc720\uc9c0\ud558\ub824\uba74 \ub178\ub4dc \uc140\ub809\ud130(NodeSelector)\uc640 \ud14c\uc778\ud2b8(Taint)/\ud1a8\ub7ec\ub808\uc774\uc158(Toleration)\uc744 \uc870\ud569\ud558\uc5ec \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\uae30\uc885 \ud658\uacbd\uc5d0\uc11c \uc6cc\ud06c\ub85c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud558\ub294 \uc8fc\ub41c \ubaa9\uc801\uc740 \uae30\uc874 \ub9ac\ub205\uc2a4 \uc6cc\ud06c\ub85c\ub4dc\uc640\uc758 \ud638\ud658\uc131\uc774 \uae68\uc9c0\uc9c0 \uc54a\ub3c4\ub85d \ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/scheduling/#os","title":"\ud2b9\uc815 OS \uc6cc\ud06c\ub85c\ub4dc\uac00 \uc801\uc808\ud55c \ucee8\ud14c\uc774\ub108 \ub178\ub4dc\uc5d0\uc11c \uc2e4\ud589 \ubcf4\uc7a5","text":"<p>\uc0ac\uc6a9\uc790\ub294 \ub178\ub4dc\uc140\ub809\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\ub97c \uc801\uc808\ud55c \ud638\uc2a4\ud2b8\uc5d0\uc11c \uc2a4\ucf00\uc904\ub9c1 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud604\uc7ac \ubaa8\ub4e0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc\uc5d0\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 default labels \uc774 \uc788\uc2b5\ub2c8\ub2e4:</p> <pre><code>kubernetes.io/os = [windows|linux]\nkubernetes.io/arch = [amd64|arm64|...]\n</code></pre> <p>\ud30c\ub4dc \uc2a4\ud399\uc5d0 <code>\"kubernetes.io/os\": windows</code> \uc640 \uac19\uc740 \ub178\ub4dc\uc140\ub809\ud130\uac00 \ud3ec\ud568\ub418\uc9c0 \uc54a\ub294 \uacbd\uc6b0, \ud30c\ub4dc\ub294 \uc708\ub3c4\uc6b0 \ub610\ub294 \ub9ac\ub205\uc2a4 \uc5b4\ub290 \ud638\uc2a4\ud2b8\uc5d0\uc11c\ub098 \uc2a4\ucf00\uc904\ub9c1 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\ub294 \uc708\ub3c4\uc6b0\uc5d0\uc11c\ub9cc \uc2e4\ud589\ud560 \uc218 \uc788\uace0 \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108\ub294 \ub9ac\ub205\uc2a4\uc5d0\uc11c\ub9cc \uc2e4\ud589\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \ubb38\uc81c\uac00 \ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc5d4\ud130\ud504\ub77c\uc774\uc988 \ud658\uacbd\uc5d0\uc11c\ub294 \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c \uae30\uc874 \ubc30\ud3ec\uac00 \ub9ce\uc744 \ubfd0\ub9cc \uc544\ub2c8\ub77c \ud5ec\ub984 \ucc28\ud2b8\uc640 \uac19\uc740 \uae30\uc131 \uad6c\uc131 \uc5d0\ucf54\uc2dc\uc2a4\ud15c(off-the-shelf configurations)\uc744 \uac16\ub294 \uac83\uc774 \uc77c\ubc18\uc801\uc785\ub2c8\ub2e4. \uc774\ub7f0 \uc0c1\ud669\uc5d0\uc11c\ub294 \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\uc758 \ub178\ub4dc\uc140\ub809\ud130\ub97c \ubcc0\uacbd\ud558\ub294 \uac83\uc744 \uc8fc\uc800\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub300\uc548\uc740 \ud14c\uc778\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4: <code>--register-with-taints='os=windows:NoSchedule'</code></p> <p>EKS\ub97c \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0, eksctl\uc740 clusterConfig\ub97c \ud1b5\ud574 \ud14c\uc778\ud2b8\ub97c \uc801\uc6a9\ud558\ub294 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4:</p> <pre><code>NodeGroups:\n  - name: windows-ng\n    amiFamily: WindowsServer2022FullContainer\n    ...\n    labels:\n      nodeclass: windows2022\n    taints:\n      os: \"windows:NoSchedule\"\n</code></pre> <p>\ubaa8\ub4e0 \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0 \ud14c\uc778\ud2b8\ub97c \ucd94\uac00\ud558\ub294 \uacbd\uc6b0, \uc2a4\ucf00\uc904\ub7ec\ub294 \ud14c\uc778\ud2b8\ub97c \ud5c8\uc6a9\ud558\uc9c0 \uc54a\ub294 \ud55c \ud574\ub2f9 \ub178\ub4dc\uc5d0\uc11c \ud30c\ub4dc\ub97c \uc2a4\ucf00\uc904\ub9c1\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c\uc740 \ud30c\ub4dc \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc758 \uc608\uc2dc\uc785\ub2c8\ub2e4:</p> <pre><code>nodeSelector:\n    kubernetes.io/os: windows\ntolerations:\n    - key: \"os\"\n      operator: \"Equal\"\n      value: \"windows\"\n      effect: \"NoSchedule\"\n</code></pre>"},{"location":"ko/windows/docs/scheduling/#_3","title":"\ub3d9\uc77c\ud55c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc5ec\ub7ec \uc708\ub3c4\uc6b0 \ube4c\ub4dc \ucc98\ub9ac","text":"<p>\uac01 \ud30c\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108 \ubca0\uc774\uc2a4 \uc774\ubbf8\uc9c0\ub294 \ub178\ub4dc\uc640 \ub3d9\uc77c\ud55c \ucee4\ub110 \ube4c\ub4dc \ubc84\uc804\uacfc \uc77c\uce58\ud574\uc57c \ud569\ub2c8\ub2e4. \ub3d9\uc77c\ud55c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc5ec\ub7ec \uc708\ub3c4\uc6b0 Server \ube4c\ub4dc\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \ucd94\uac00 \ub178\ub4dc \ub808\uc774\ube14\uc778 \ub178\ub4dc\uc140\ub809\ud130\ub97c \uc124\uc815\ud558\uac70\ub098 windows-build \ub808\uc774\ube14\uc744 \ud65c\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 1.17 \ubc84\uc804\uc5d0\uc11c\ub294 node.kubernetes.io/windows-build \ub77c\ub294 \uc0c8\ub85c\uc6b4 \ub808\uc774\ube14\uc744 \uc790\ub3d9\uc73c\ub85c \ucd94\uac00\ud558\uc5ec \ub3d9\uc77c\ud55c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc5ec\ub7ec \uc708\ub3c4\uc6b0 \ube4c\ub4dc\uc758 \uad00\ub9ac\ub97c \ub2e8\uc21c\ud654 \ud569\ub2c8\ub2e4. \uc774\uc804 \ubc84\uc804\uc744 \uc2e4\ud589 \uc911\uc778 \uacbd\uc6b0 \uc774 \ub808\uc774\ube14\uc744 \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0 \uc218\ub3d9\uc73c\ub85c \ucd94\uac00\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4.</p> <p>\uc774 \ub808\uc774\ube14\uc5d0\ub294 \ud638\ud658\uc131\uc744 \uc704\ud574 \uc77c\uce58\ud574\uc57c \ud558\ub294 \uc708\ub3c4\uc6b0 \uba54\uc774\uc800, \ub9c8\uc774\ub108, \uadf8\ub9ac\uace0 \ube4c\ub4dc \ubc88\ud638\uac00 \ubc18\uc601\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c\uc740 \ud604\uc7ac \uac01 \uc708\ub3c4\uc6b0 \uc11c\ubc84 \ubc84\uc804\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uac12\uc785\ub2c8\ub2e4.</p> <p>\uc911\uc694\ud55c \uc810\uc740 \uc708\ub3c4\uc6b0 \uc11c\ubc84\uac00 \uc7a5\uae30 \uc11c\ube44\uc2a4 \ucc44\ub110(LTSC)\ub97c \uae30\ubcf8 \ub9b4\ub9ac\uc2a4 \ucc44\ub110\ub85c \uc774\ub3d9\ud558\uace0 \uc788\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \uc11c\ubc84 \ubc18\uae30 \ucc44\ub110(SAC)\uc740 2022\ub144 8\uc6d4 9\uc77c\uc5d0 \uc0ac\uc6a9 \uc911\uc9c0\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \uc11c\ubc84\uc758 \ud5a5\ud6c4 SAC \ub9b4\ub9ac\uc2a4\ub294 \uc5c6\uc2b5\ub2c8\ub2e4.</p> Product Name Build Number(s) Server full 2022 LTSC 10.0.20348 Server core 2019 LTSC 10.0.17763 <p>\ub2e4\uc74c \uba85\ub839\uc744 \ud1b5\ud574 OS \ube4c\ub4dc \ubc84\uc804\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:</p> <pre><code>kubectl get nodes -o wide\n</code></pre> <p>KERNEL-VERSION \ucd9c\ub825\uc740 \uc708\ub3c4\uc6b0 OS \ube4c\ub4dc \ubc84\uc804\uc744 \ub098\ud0c0\ub0c5\ub2c8\ub2e4.</p> <pre><code>NAME                          STATUS   ROLES    AGE   VERSION                INTERNAL-IP   EXTERNAL-IP     OS-IMAGE                         KERNEL-VERSION                  CONTAINER-RUNTIME\nip-10-10-2-235.ec2.internal   Ready    &lt;none&gt;   23m   v1.24.7-eks-fb459a0    10.10.2.235   3.236.30.157    Windows Server 2022 Datacenter   10.0.20348.1607                 containerd://1.6.6\nip-10-10-31-27.ec2.internal   Ready    &lt;none&gt;   23m   v1.24.7-eks-fb459a0    10.10.31.27   44.204.218.24   Windows Server 2019 Datacenter   10.0.17763.4131                 containerd://1.6.6\nip-10-10-7-54.ec2.internal    Ready    &lt;none&gt;   31m   v1.24.11-eks-a59e1f0   10.10.7.54    3.227.8.172     Amazon Linux 2                   5.10.173-154.642.amzn2.x86_64   containerd://1.6.19\n</code></pre> <p>\uc544\ub798 \uc608\uc81c\uc5d0\uc11c\ub294 \ub2e4\uc591\ud55c \uc708\ub3c4\uc6b0 \ub178\ub4dc \uadf8\ub8f9 OS \ubc84\uc804\uc744 \uc2e4\ud589\ud560 \ub54c \uc62c\ubc14\ub978 \uc708\ub3c4\uc6b0 \ube4c\ub4dc \ubc84\uc804\uc744 \uc77c\uce58\uc2dc\ud0a4\uae30 \uc704\ud574 \ucd94\uac00 \ub178\ub4dc\uc140\ub809\ud130\ub97c \ud30c\ub4dc \uc2a4\ud399\uc5d0 \uc801\uc6a9\ud569\ub2c8\ub2e4.</p> <pre><code>nodeSelector:\n    kubernetes.io/os: windows\n    node.kubernetes.io/windows-build: '10.0.20348'\ntolerations:\n    - key: \"os\"\n    operator: \"Equal\"\n    value: \"windows\"\n    effect: \"NoSchedule\"\n</code></pre>"},{"location":"ko/windows/docs/scheduling/#runtimeclass","title":"RuntimeClass\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud30c\ub4dc \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc758 \ub178\ub4dc\uc140\ub809\ud130\uc640 \ud1a8\ub7ec\ub808\uc774\uc158 \ub2e8\uc21c\ud654","text":"<p>RuntimeClass\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud14c\uc778\ud2b8\uc640 \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \uc0ac\uc6a9\ud558\ub294 \ud504\ub85c\uc138\uc2a4\ub97c \uac04\uc18c\ud654\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \ud14c\uc778\ud2b8\uc640 \ud1a8\ub7ec\ub808\uc774\uc158\uc744 \ucea1\uc290\ud654\ud558\ub294 RuntimeClass \uc624\ube0c\uc81d\ud2b8\ub97c \ub9cc\ub4e4\uc5b4 \uc774 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \ub9e4\ub2c8\ud398\uc2a4\ud2b8\ub97c \ud1b5\ud574 RuntimeClass\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4:</p> <pre><code>apiVersion: node.k8s.io/v1beta1\nkind: RuntimeClass\nmetadata:\n  name: windows-2022\nhandler: 'docker'\nscheduling:\n  nodeSelector:\n    kubernetes.io/os: 'windows'\n    kubernetes.io/arch: 'amd64'\n    node.kubernetes.io/windows-build: '10.0.20348'\n  tolerations:\n  - effect: NoSchedule\n    key: os\n    operator: Equal\n    value: \"windows\"\n</code></pre> <p>RuntimeClass\uac00 \uc0dd\uc131\ub418\uba74, \ud30c\ub4dc \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc758 \uc2a4\ud399\uc744 \ud1b5\ud574 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: iis-2022\n  labels:\n    app: iis-2022\nspec:\n  replicas: 1\n  template:\n    metadata:\n      name: iis-2022\n      labels:\n        app: iis-2022\n    spec:\n      runtimeClassName: windows-2022\n      containers:\n      - name: iis\n</code></pre>"},{"location":"ko/windows/docs/scheduling/#_4","title":"\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 \uc9c0\uc6d0","text":"<p>\uace0\uac1d\uc774 \uc708\ub3c4\uc6b0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ubcf4\ub2e4 \uac04\uc18c\ud654\ub41c \ubc29\uc2dd\uc73c\ub85c \uc2e4\ud589\ud560 \uc218 \uc788\ub3c4\ub85d AWS\uc5d0\uc11c\ub294 2022\ub144 12\uc6d4 15\uc77c\uc5d0 \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c EKS \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 (MNG) \uc9c0\uc6d0\uc744 \uc2dc\uc791 \ud588\uc2b5\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uc740 \ub9ac\ub205\uc2a4 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9\uacfc \ub3d9\uc77c\ud55c \uc6cc\ud06c\ud50c\ub85c\uc6b0\uc640 \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud65c\uc131\ud654\ub429\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \uc11c\ubc84 2019 \ubc0f 2022 \ud328\ubc00\ub9ac\uc758 Full, Core AMI(Amazon Machine Image)\uac00 \uc9c0\uc6d0 \ub429\ub2c8\ub2e4.</p> <p>\uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9(MNG)\uc5d0 \uc9c0\uc6d0\ub418\ub294 AMI \ud328\ubc00\ub9ac\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4:</p> AMI Family WINDOWS_CORE_2019_x86_64 WINDOWS_FULL_2019_x86_64 WINDOWS_CORE_2022_x86_64 WINDOWS_FULL_2022_x86_64"},{"location":"ko/windows/docs/scheduling/#_5","title":"\ucd94\uac00 \ubb38\uc11c","text":"<p>AWS \uacf5\uc2dd \ubb38\uc11c: https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html</p> <p>\ud30c\ub4dc \ub124\ud2b8\uc6cc\ud0b9(CNI)\uc758 \uc791\ub3d9 \ubc29\uc2dd\uc744 \ub354 \uc798 \uc774\ud574\ud558\ub824\uba74 \ub2e4\uc74c \ub9c1\ud06c\ub97c \ud655\uc778\ud558\uc2ed\uc2dc\uc624: https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html</p> <p>EKS \uae30\ubc18 \uc708\ub3c4\uc6b0\uc6a9 \uad00\ub9ac\ud615 \ub178\ub4dc \uadf8\ub8f9 \ubc30\ud3ec\uc5d0 \uad00\ud55c AWS \ube14\ub85c\uadf8: https://aws.amazon.com/blogs/containers/deploying-amazon-eks-windows-managed-node-groups/</p>"},{"location":"ko/windows/docs/security/","title":"\ud30c\ub4dc \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8","text":"<p>\ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \ud3f4\ub9ac\uc2dc(PSP) \uc640 \ud30c\ub4dc \uc2dc\ud050\ub9ac\ud2f0 \uc2a4\ud0e0\ub2e4\ub4dc(PSS)\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ubcf4\uc548\uc744 \uac15\ud654\ud558\ub294 \ub450 \uac00\uc9c0 \uc8fc\uc694 \ubc29\ubc95\uc785\ub2c8\ub2e4. PSP\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 v1.21\ubd80\ud130 \ub354 \uc774\uc0c1 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc73c\uba70 v1.25\uc5d0\uc11c \uc81c\uac70\ub420 \uc608\uc815\uc785\ub2c8\ub2e4. \ud5a5\ud6c4 \ubcf4\uc548\uc744 \uac15\ud654\ud558\uae30 \uc704\ud574 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \uad8c\uc7a5\ud558\ub294 \uc811\uadfc \ubc29\uc2dd\uc740 PSS\uc785\ub2c8\ub2e4.</p> <p>PSP\ub294 \ubcf4\uc548 \uc815\ucc45\uc744 \uad6c\ud604\ud558\uae30 \uc704\ud55c \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \ub124\uc774\ud2f0\ube0c \uc194\ub8e8\uc158\uc785\ub2c8\ub2e4. PSP\ub294 \ud30c\ub4dc \uc2a4\ud399\uc5d0\uc11c \uc815\uc758\ud558\uace0 \ubcf4\uc548\uc5d0 \ubbfc\uac10\ud55c \uce21\uba74\uc744 \uc81c\uc5b4\ud558\ub294 \ud074\ub7ec\uc2a4\ud130 \ub808\ubca8\uc758 \ub9ac\uc18c\uc2a4 \uc785\ub2c8\ub2e4. PSP\ub97c \uc0ac\uc6a9\ud558\uba74 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2b9\uc778 \ub418\uae30 \uc704\ud574 \ud30c\ub4dc\uac00 \ucda9\uc871\ud574\uc57c \ud558\ub294 \uc77c\ub828\uc758 \uc870\uac74\uc744 \uc815\uc758\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. PSP \uae30\ub2a5\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucd08\uae30\ubd80\ud130 \uc0ac\uc6a9 \uac00\ub2a5\ud588\uc73c\uba70 \ud2b9\uc815 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc798\ubabb \uad6c\uc131\ub41c \ud30c\ub4dc\uac00 \uc0dd\uc131\ub418\ub294 \uac83\uc744 \ucc28\ub2e8\ud558\ub3c4\ub85d \uc124\uacc4\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <p>PSP\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624. \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc9c0\uc6d0 \uc911\ub2e8 \uc815\ucc45\uc5d0 \ub530\ub77c \uc774\uc804 \ubc84\uc804\uc740 \uae30\ub2a5 \uc9c0\uc6d0 \uc911\ub2e8 \ud6c4 9\uac1c\uc6d4\uc774 \uc9c0\ub098\uba74 \uc9c0\uc6d0\uc774 \uc911\ub2e8\ub429\ub2c8\ub2e4.</p> <p>\ubc18\uba74, \uc77c\ubc18\uc801\uc73c\ub85c \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad6c\ud604\ub418\ub294 \uad8c\uc7a5 \ubcf4\uc548 \uc811\uadfc \ubc29\uc2dd\uc778 PSS\ub294 \ud30c\ub4dc \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0\uc11c \ud30c\ub4dc \ubc0f \ucee8\ud14c\uc774\ub108 \uc2a4\ud399\uc5d0 \uc815\uc758\ub429\ub2c8\ub2e4. PSS\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud504\ub85c\uc81d\ud2b8 \ud300\uc774 \ud30c\ub4dc\uc758 \ubcf4\uc548 \uad00\ub828 \ubaa8\ubc94 \uc0ac\ub840\ub97c \ub2e4\ub8e8\uae30 \uc704\ud574 \uc815\uc758\ud55c \uacf5\uc2dd \ud45c\uc900\uc785\ub2c8\ub2e4. baseline (\ucd5c\uc18c \uc81c\ud55c, \uae30\ubcf8\uac12), privileged (\ube44\uc81c\ud55c) \uadf8\ub9ac\uace0 restricted(\uac00\uc7a5 \uc81c\ud55c\uc801) \ub4f1\uc758 \uc815\ucc45\uc744 \uc815\uc758\ud569\ub2c8\ub2e4.</p> <p>baseline \ud504\ub85c\ud30c\uc77c\ubd80\ud130 \uc2dc\uc791\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. PSS baseline \ud504\ub85c\ud30c\uc77c\uc740 \ucd5c\uc18c\ud55c\uc758 \uc608\uc678 \ud56d\ubaa9\uc744 \ucc98\ub9ac\ud558\uace0 \ubcf4\uc548\uacfc \uc7a0\uc7ac\uc801 \uc694\uc18c \uc0ac\uc774\uc758 \uc801\uc808\ud55c \uade0\ud615\uc744 \uc81c\uacf5\ud558\uc5ec \uc6cc\ud06c\ub85c\ub4dc \ubcf4\uc548\uc744 \uc704\ud55c \uc88b\uc740 \ucd9c\ubc1c\uc810 \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4. \ud604\uc7ac PSP\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4\uba74 PSS\ub85c \uc804\ud658\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. PSS \uc815\ucc45\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uc815\ucc45\uc740 OPA\uc640 Kyverno \uac19\uc740 \ub3c4\uad6c\ub97c \ud3ec\ud568\ud55c \uc5ec\ub7ec \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud558\uc5ec \uac15\uc81c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4, Kyverno\ub294 \uc5ec\uae30\uc5d0\uc11c PSS \uc815\ucc45\uc758 \uc804\uccb4 \uceec\ub809\uc158\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4.</p> <p>\ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8 \uc124\uc815\uc744 \ud1b5\ud574 \ud504\ub85c\uc138\uc2a4\ub97c \uc120\ud0dd\ud560 \uc218 \uc788\ub294 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud558\uace0, \ud504\ub85c\uadf8\ub7a8 \ud504\ub85c\ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uc5ec \uac1c\ubcc4 \ud504\ub85c\uadf8\ub7a8\uc758 \uae30\ub2a5\uc744 \uc81c\ud55c\ud558\uace0, \uad8c\ud55c \uc0c1\uc2b9\uc744 \ud5c8\uc6a9\ud558\uace0, \uc2dc\uc2a4\ud15c \ucf5c\uc744 \ud544\ud130\ub9c1\ud558\ub294 \ub4f1\uc758 \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \uc708\ub3c4\uc6b0 \ud30c\ub4dc\uc5d0\ub294 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\uc640 \uad00\ub828\ud558\uc5ec \ud45c\uc900 \ub9ac\ub205\uc2a4 \uae30\ubc18 \uc6cc\ud06c\ub85c\ub4dc\uc640 \uba87 \uac00\uc9c0 \uc81c\ud55c \uc0ac\ud56d \ubc0f \ucc28\ubcc4\ud654 \uc694\uc18c\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc708\ub3c4\uc6b0\ub294 \uc2dc\uc2a4\ud15c \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ud544\ud130\uc640 \ud568\uaed8 \ucee8\ud14c\uc774\ub108\ub2f9 \uc791\uc5c5 \uac1c\uccb4\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108\uc758 \ubaa8\ub4e0 \ud504\ub85c\uc138\uc2a4\ub97c \ud3ec\ud568\ud558\uace0 \ud638\uc2a4\ud2b8\ub85c\ubd80\ud130 \ub17c\ub9ac\uc801 \uaca9\ub9ac\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ud544\ud130\ub9c1 \uc5c6\uc774 \uc708\ub3c4\uc6b0 \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud560 \uc218 \uc788\ub294 \ubc29\ubc95\uc740 \uc5c6\uc2b5\ub2c8\ub2e4. \uc774\ub294 \ud638\uc2a4\ud2b8\uc758 \ucee8\ud14d\uc2a4\ud2b8\uc5d0\uc11c \uc2dc\uc2a4\ud15c \uad8c\ud55c\uc744 \ucde8\ub4dd\ud560 \uc218 \uc5c6\uc73c\ubbc0\ub85c \uc708\ub3c4\uc6b0\uc5d0\uc11c\ub294 \uad8c\ud55c\uc774 \uc788\ub294 \ucee8\ud14c\uc774\ub108\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c <code>windowsOptions</code> \uc740 \ubb38\uc11c\ud654\ub41c \uc720\uc77c\ud55c Windows Security Context options\uc774\uace0, \ub098\uba38\uc9c0\ub294 \uc77c\ubc18\uc801\uc778 Security Context options \uc785\ub2c8\ub2e4.</p> <p>\uc708\ub3c4\uc6b0\uc640 \ub9ac\ub205\uc2a4\uc5d0\uc11c \uc9c0\uc6d0\ub418\ub294 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8 \uc18d\uc131 \ubaa9\ub85d\uc740 \uc5ec\uae30\uc758 \uacf5\uc2dd \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uc2ed\uc2dc\uc624.</p> <p>Pod\ubcc4 \uc124\uc815\uc740 \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\uc5d0 \uc801\uc6a9 \ub429\ub2c8\ub2e4. \uc9c0\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 PodSecurityContext\uc758 \uc635\uc158\uc774 \uc0ac\uc6a9\ub429\ub2c8\ub2e4. SecurityContext\uc640 PodSecurityContext\uac00 \ubaa8\ub450 \uc124\uc815\ub41c \uacbd\uc6b0 SecurityContext\uc5d0 \uc9c0\uc815\ub41c \uac12\uc774 \uc6b0\uc120 \uc801\uc6a9\ub429\ub2c8\ub2e4.</p> <p>\uc608\ub97c \ub4e4\uc5b4, \uc708\ub3c4\uc6b0 \uc635\uc158\uc778 \ud30c\ub4dc \ubc0f \ucee8\ud14c\uc774\ub108\uc5d0 \ub300\ud55c runAsUserName \uc124\uc815\uc740 \ub9ac\ub205\uc2a4 \uad00\ub828 runAsUser \uc124\uc815\uacfc \uac70\uc758 \ub3d9\uc77c\ud558\uba70 \ub2e4\uc74c \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0\uc11c\ub294 \ud30c\ub4dc \uad00\ub828 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\uac00 \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108\uc5d0 \uc801\uc6a9\ub429\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: run-as-username-pod-demo\nspec:\n  securityContext:\n    windowsOptions:\n      runAsUserName: \"ContainerUser\"\n  containers:\n  - name: run-as-username-demo\n    ...\n  nodeSelector:\n    kubernetes.io/os: windows\n</code></pre> <p>\ub2e4\uc74c\uc5d0\uc11c\ub294 \ucee8\ud14c\uc774\ub108 \uc218\uc900 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\uac00 \ud30c\ub4dc \uc218\uc900 \ubcf4\uc548 \ucee8\ud14d\uc2a4\ud2b8\ubcf4\ub2e4 \uc6b0\uc120 \uc801\uc6a9\ub429\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: run-as-username-container-demo\nspec:\n  securityContext:\n    windowsOptions:\n      runAsUserName: \"ContainerUser\"\n  containers:\n  - name: run-as-username-demo\n    ..\n    securityContext:\n        windowsOptions:\n            runAsUserName: \"ContainerAdministrator\"\n  nodeSelector:\n    kubernetes.io/os: windows\n</code></pre> <p>runAsUserName \ud544\ub4dc\uc5d0 \ud5c8\uc6a9\ub418\ub294 \uac12\uc758 \uc608: ContainerAdministrator, ContainerUser, NT AUTHORITY\\NETWORK SERVICE, NT AUTHORITY\\LOCAL SERVICE</p> <p>\uc77c\ubc18\uc801\uc73c\ub85c \uc708\ub3c4\uc6b0 \ud30c\ub4dc\uc6a9 ContainerUser\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108\ub97c \uc2e4\ud589\ud558\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4. \uc0ac\uc6a9\uc790\ub294 \ucee8\ud14c\uc774\ub108\uc640 \ud638\uc2a4\ud2b8 \uac04\uc5d0 \uacf5\uc720\ub418\uc9c0 \uc54a\uc9c0\ub9cc ContainerAdministrator\ub294 \ucee8\ud14c\uc774\ub108 \ub0b4\uc5d0\uc11c \ucd94\uac00 \uad8c\ud55c\uc744 \uac16\uc2b5\ub2c8\ub2e4. \uc8fc\uc758\ud574\uc57c \ud560 username\uc758 \uc81c\ud55c \uc0ac\ud56d\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>ContainerAdministrator\ub97c \uc0ac\uc6a9\ud558\ub294 \uc88b\uc740 \uc608\ub294 PATH\ub97c \uc124\uc815\ud558\ub294 \uac83 \uc785\ub2c8\ub2e4. USER \uc9c0\uc2dc\uc5b4\ub97c \uc0ac\uc6a9\ud55c\ub2e4\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:</p> <pre><code>USER ContainerAdministrator\nRUN setx /M PATH \"%PATH%;C:/your/path\"\nUSER ContainerUser\n</code></pre> <p>\ub610\ud55c secrets \ub294 \ub178\ub4dc \ubcfc\ub968\uc5d0 \uc77c\ubc18 \ud14d\uc2a4\ud2b8\ub85c \uae30\ub85d\ub429\ub2c8\ub2e4(Linux\uc758 tmpfs/in-memory\uc640 \ube44\uad50). \uc774\ub294 \ub450 \uac00\uc9c0 \uc791\uc5c5\uc744 \uc218\ud589\ud574\uc57c \ud568\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4.</p> <ul> <li>file ACL\uc744 \uc0ac\uc6a9\ud558\uc5ec secrets \ud30c\uc77c \uc704\uce58\ub97c \ubcf4\ud638</li> <li>BitLocker\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubcfc\ub968 \uc218\uc900 \uc554\ud638\ud654 \uc0ac\uc6a9</li> </ul>"},{"location":"ko/windows/docs/storage/","title":"\uc601\uad6c \uc2a4\ud1a0\ub9ac\uc9c0 \uc635\uc158","text":""},{"location":"ko/windows/docs/storage/#in-tree-out-of-tree","title":"In-tree\uc640 Out-of-tree \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778","text":"<p>\ucee8\ud14c\uc774\ub108 \uc2a4\ud1a0\ub9ac\uc9c0 \uc778\ud130\ud398\uc774\uc2a4(CSI)\uac00 \ub3c4\uc785\ub418\uae30 \uc804\uc5d0\ub294 \ubaa8\ub4e0 \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778\uc774 in-tree \uc600\uc2b5\ub2c8\ub2e4. \uc989, \ucf54\uc5b4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubc14\uc774\ub108\ub9ac\uc640 \ud568\uaed8 \ube4c\ub4dc, \uc5f0\uacb0, \ucef4\ud30c\uc77c \ubc0f \uc81c\uacf5\ub418\uace0 \ud575\uc2ec \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\ub97c \ud655\uc7a5\ud588\uc2b5\ub2c8\ub2e4. \uc774\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0 \uc0c8\ub85c\uc6b4 \uc2a4\ud1a0\ub9ac\uc9c0 \uc2dc\uc2a4\ud15c(\ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778)\uc744 \ucd94\uac00\ud558\ub824\uba74 \ud575\uc2ec \ucf54\uc5b4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucf54\ub4dc \uc800\uc7a5\uc18c\uc5d0 \ub300\ud55c \ucf54\ub4dc\ub97c \ud655\uc778\ud574\uc57c \ud558\ub294 \uac83\uc744 \uc758\ubbf8\ud588\uc2b5\ub2c8\ub2e4.</p> <p>Out-of-tree \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ucf54\ub4dc \ubca0\uc774\uc2a4\uc640 \ub3c5\ub9bd\uc801\uc73c\ub85c \uac1c\ubc1c\ub418\uba70 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ud655\uc7a5\uc73c\ub85c \ubc30\ud3ec(\ubc0f \uc124\uce58) \ub429\ub2c8\ub2e4. \uc774\ub97c \ud1b5\ud574 \ubca4\ub354\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9b4\ub9ac\uc2a4 \uc8fc\uae30\uc640 \ubcc4\ub3c4\ub85c \ub4dc\ub77c\uc774\ubc84\ub97c \uc5c5\ub370\uc774\ud2b8 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uac00 \ubca4\ub354\uc5d0 k8s\uc640 \uc778\ud130\ud398\uc774\uc2a4\ud558\ub294 \ud45c\uc900 \ubc29\ubc95\uc744 \uc81c\uacf5\ud558\ub294 \uc2a4\ud1a0\ub9ac\uc9c0 \uc778\ud130\ud398\uc774\uc2a4 \ud639\uc740 CSI\ub97c \ub9cc\ub4e4\uc5c8\uae30 \ub54c\ubb38\uc5d0 \uac00\ub2a5\ud569\ub2c8\ub2e4.</p> <p>Amazon Elastic Kubernetes Services (EKS) \uc2a4\ud1a0\ub9ac\uc9c0 \ud074\ub798\uc2a4 \ubc0f CSI \ub4dc\ub77c\uc774\ubc84\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc744 AWS \ubb38\uc11c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/storage/#in-tree","title":"\uc708\ub3c4\uc6b0\uc6a9 In-tree \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778","text":"<p>\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubcfc\ub968\uc744 \uc0ac\uc6a9\ud558\uba74 \ub370\uc774\ud130 \uc9c0\uc18d\uc131 \uc694\uad6c \uc0ac\ud56d\uc774 \uc788\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0 \ubc30\ud3ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968 \uad00\ub9ac\ub294 \ubcfc\ub968 \ud504\ub85c\ube44\uc800\ub2dd/\ud504\ub85c\ube44\uc800\ub2dd \ud574\uc81c/\ud06c\uae30 \uc870\uc815, \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc\uc5d0 \ubcfc\ub968 \uc5f0\uacb0/\ubd84\ub9ac, \ud30c\ub4dc\uc758 \uac1c\ubcc4 \ucee8\ud14c\uc774\ub108\uc5d0 \ubcfc\ub968 \ub9c8\uc6b4\ud2b8/\ub9c8\uc6b4\ud2b8 \ud574\uc81c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4. \ud2b9\uc815 \uc2a4\ud1a0\ub9ac\uc9c0 \ubc31\uc5d4\ub4dc \ub610\ub294 \ud504\ub85c\ud1a0\ucf5c\uc5d0 \ub300\ud574 \uc774\ub7f0 \ubcfc\ub968 \uad00\ub9ac \uc791\uc5c5\uc744 \uad6c\ud604\ud558\uae30 \uc704\ud55c \ucf54\ub4dc\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778 (In-tree \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778) \ud615\uc2dd\uc73c\ub85c \uc81c\uacf5\ub429\ub2c8\ub2e4. Amazon EKS\uc5d0\uc11c\ub294 \uc708\ub3c4\uc6b0\uc5d0\uc11c \ub2e4\uc74c\uacfc \uac19\uc740 \ud074\ub798\uc2a4\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778\uc774 \uc9c0\uc6d0\ub429\ub2c8\ub2e4:</p> <p>In-tree \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778: awsElasticBlockStore</p> <p>\uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0\uc11c In-tree \ubcfc\ub968 \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud558\uae30 \uc704\ud574\uc11c\ub294 NTFS\ub97c fsType \uc73c\ub85c \uc0ac\uc6a9\ud558\uae30 \uc704\ud55c \ucd94\uac00 StorageClass\ub97c \uc0dd\uc131\ud574\uc57c \ud569\ub2c8\ub2e4. EKS\uc5d0\uc11c \uae30\ubcf8 StorageClass\ub294 ext4\ub97c \uae30\ubcf8 fsType\uc73c\ub85c \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p> <p>StorageClass\ub294 \uad00\ub9ac\uc790\uac00 \uc81c\uacf5\ud558\ub294 \uc2a4\ud1a0\ub9ac\uc9c0\uc758 \"\ud074\ub798\uc2a4\"\ub97c \uc124\uba85\ud558\ub294 \ubc29\ubc95\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \ub2e4\uc591\ud55c \ud074\ub798\uc2a4\ub294 QoS \uc218\uc900, \ubc31\uc5c5 \uc815\ucc45 \ub610\ub294 \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\uac00 \uacb0\uc815\ud55c \uc784\uc758 \uc815\ucc45\uc5d0 \ub9e4\ud551\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub294 \ud074\ub798\uc2a4\uac00 \ubb34\uc5c7\uc744 \ub098\ud0c0\ub0b4\ub294\uc9c0\uc5d0 \ub300\ud574 \uc758\uacac\uc774 \uc5c6\uc2b5\ub2c8\ub2e4. \uc774 \uac1c\ub150\uc740 \ub2e4\ub978 \uc2a4\ud1a0\ub9ac\uc9c0 \uc2dc\uc2a4\ud15c\uc5d0\uc11c\ub294 \"\ud504\ub85c\ud30c\uc77c\" \uc774\ub77c\uace0 \ubd80\ub974\uae30\ub3c4 \ud569\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc5ec \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:</p> <pre><code>kubectl describe storageclass gp2\n</code></pre> <p>\ucd9c\ub825:</p> <pre><code>Name:            gp2\nIsDefaultClass:  Yes\nAnnotations:     kubectl.kubernetes.io/last-applied-configuration={\"apiVersion\":\"storage.k8s.io/v1\",\"kind\":\"StorageClas\n\",\"metadata\":{\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"},\"name\":\"gp2\"},\"parameters\":{\"fsType\"\n\"ext4\",\"type\":\"gp2\"},\"provisioner\":\"kubernetes.io/aws-ebs\",\"volumeBindingMode\":\"WaitForFirstConsumer\"}\n,storageclass.kubernetes.io/is-default-class=true\nProvisioner:           kubernetes.io/aws-ebs\nParameters:            fsType=ext4,type=gp2\nAllowVolumeExpansion:  &lt;unset&gt;\nMountOptions:          &lt;none&gt;\nReclaimPolicy:         Delete\nVolumeBindingMode:     WaitForFirstConsumer\nEvents:                &lt;none&gt;\n</code></pre> <p>NTFS\ub97c \uc9c0\uc6d0\ud558\ub294 \uc0c8 StorageClass\ub97c \uc0dd\uc131\ud558\ub824\uba74 \ub2e4\uc74c \ub9e4\ub2c8\ud398\uc2a4\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc2ed\uc2dc\uc624:</p> <pre><code>kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: gp2-windows\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp2\n  fsType: ntfs\nvolumeBindingMode: WaitForFirstConsumer\n</code></pre> <p>\ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc5ec StorageClass\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4:</p> <pre><code>kubectl apply -f NTFSStorageClass.yaml\n</code></pre> <p>\ub2e4\uc74c \ub2e8\uacc4\ub294 \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968 \ud074\ub808\uc784(PVC)\uc744 \uc0dd\uc131\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.</p> <p>\ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968(PV)\uc740 \uad00\ub9ac\uc790\uac00 \ud504\ub85c\ube44\uc800\ub2dd\ud588\uac70\ub098 PVC\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub3d9\uc801\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ub41c \ud074\ub7ec\uc2a4\ud130\uc758 \uc2a4\ud1a0\ub9ac\uc9c0\uc785\ub2c8\ub2e4. \ub178\ub4dc\uac00 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4\uc778 \uac83\ucc98\ub7fc \ud074\ub7ec\uc2a4\ud130\uc758 \ub9ac\uc18c\uc2a4\uc785\ub2c8\ub2e4. \uc774 API \uac1d\uccb4\ub294 NFS, iSCSI \ub610\ub294 \ud074\ub77c\uc6b0\ub4dc \uacf5\uae09\uc790\ubcc4 \uc2a4\ud1a0\ub9ac\uc9c0 \uc2dc\uc2a4\ud15c \ub4f1 \uc2a4\ud1a0\ub9ac\uc9c0 \uad6c\ud604\uc758 \uc138\ubd80 \uc815\ubcf4\ub97c \ucea1\ucc98\ud569\ub2c8\ub2e4.</p> <p>PVC\ub294 \uc0ac\uc6a9\uc790\uc758 \uc2a4\ud1a0\ub9ac\uc9c0 \uc694\uccad\uc785\ub2c8\ub2e4. \ud074\ub808\uc784\uc740 \ud2b9\uc815 \ud06c\uae30 \ubc0f \uc561\uc138\uc2a4 \ubaa8\ub4dc\ub97c \uc694\uccad\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4(\uc608: ReadWriteOnce, ReadOnlyMany \ub610\ub294 ReadWriteMan\ub85c \ub9c8\uc6b4\ud2b8\ub420 \uc218 \uc788\uc74c).</p> <p>\uc0ac\uc6a9\uc790\uc5d0\uac8c\ub294 \ub2e4\uc591\ud55c \uc720\uc988\ucf00\uc774\uc2a4\ub97c \uc704\ud574 \uc131\ub2a5\uacfc \uac19\uc740 \ub2e4\uc591\ud55c \uc18d\uc131\uc744 \uac00\uc9c4 PV\uac00 \ud544\uc694\ud569\ub2c8\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\ub294 \uc0ac\uc6a9\uc790\uc5d0\uac8c \ud574\ub2f9 \ubcfc\ub968\uc774 \uad6c\ud604\ub418\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc138\ubd80 \uc815\ubcf4\ub97c \ub178\ucd9c\uc2dc\ud0a4\uc9c0 \uc54a\uace0\ub3c4 \ud06c\uae30 \ubc0f \uc561\uc138\uc2a4 \ubaa8\ub4dc\ubcf4\ub2e4 \ub354 \ub2e4\uc591\ud55c \ubc29\uc2dd\uc73c\ub85c PV\ub97c \uc81c\uacf5\ud560 \uc218 \uc788\uc5b4\uc57c \ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc694\uad6c \uc0ac\ud56d\uc744 \ucda9\uc871\ud558\uae30 \uc704\ud574 StorageClass \ub9ac\uc18c\uc2a4\uac00 \uc788\uc2b5\ub2c8\ub2e4. </p> <p>\uc544\ub798 \uc608\uc81c\uc5d0\uc11c \uc708\ub3c4\uc6b0 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \ub0b4\uc5d0 PVC\uac00 \uc0dd\uc131\ub418\uc5c8\uc2b5\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: ebs-windows-pv-claim\n  namespace: windows\nspec: \n  accessModes:\n    - ReadWriteOnce\n  storageClassName: gp2-windows\n  resources: \n    requests:\n      storage: 1Gi\n</code></pre> <p>\ub2e4\uc74c \uba85\ub839\uc744 \uc2e4\ud589\ud558\uc5ec PVC\ub97c \ub9cc\ub4ed\ub2c8\ub2e4:</p> <pre><code>kubectl apply -f persistent-volume-claim.yaml\n</code></pre> <p>\ub2e4\uc74c \ub9e4\ub2c8\ud398\uc2a4\ud2b8\uc5d0\uc11c\ub294 \uc708\ub3c4\uc6b0 \ud30c\ub4dc\ub97c \uc0dd\uc131\ud558\uace0 VolumeMount\ub97c <code>C:\\Data</code>\ub85c \uc124\uc815\ud558\uace0 PVC\ub97c <code>C:\\Data</code>\uc5d0 \uc5f0\uacb0\ub41c \uc2a4\ud1a0\ub9ac\uc9c0\ub85c \uc0ac\uc6a9\ud569\ub2c8\ub2e4.</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: windows-server-ltsc2019\n  namespace: windows\nspec:\n  selector:\n    matchLabels:\n      app: windows-server-ltsc2019\n      tier: backend\n      track: stable\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: windows-server-ltsc2019\n        tier: backend\n        track: stable\n    spec:\n      containers:\n      - name: windows-server-ltsc2019\n        image: mcr.microsoft.com/windows/servercore:ltsc2019\n        ports:\n        - name: http\n          containerPort: 80\n        imagePullPolicy: IfNotPresent\n        volumeMounts:\n        - mountPath: \"C:\\\\data\"\n          name: test-volume\n      volumes:\n        - name: test-volume\n          persistentVolumeClaim:\n            claimName: ebs-windows-pv-claim\n      nodeSelector:\n        kubernetes.io/os: windows\n        node.kubernetes.io/windows-build: '10.0.17763'\n</code></pre> <p>PowerShell\uc744 \ud1b5\ud574 \uc708\ub3c4\uc6b0 \ud30c\ub4dc\uc5d0 \uc561\uc138\uc2a4\ud558\uc5ec \uacb0\uacfc\ub97c \ud14c\uc2a4\ud2b8\ud569\ub2c8\ub2e4:</p> <pre><code>kubectl exec -it podname powershell -n windows\n</code></pre> <p>\uc708\ub3c4\uc6b0 \ud30c\ub4dc \ub0b4\uc5d0\uc11c <code>ls</code>\ub97c \uc218\ud589\ud569\ub2c8\ub2e4:</p> <p>\ucd9c\ub825:</p> <pre><code>PS C:\\&gt; ls\n\n\n    Directory: C:\\\n\n\nMode                 LastWriteTime         Length Name\n----                 -------------         ------ ----\nd-----          3/8/2021   1:54 PM                data\nd-----          3/8/2021   3:37 PM                inetpub\nd-r---          1/9/2021   7:26 AM                Program Files\nd-----          1/9/2021   7:18 AM                Program Files (x86)\nd-r---          1/9/2021   7:28 AM                Users\nd-----          3/8/2021   3:36 PM                var\nd-----          3/8/2021   3:36 PM                Windows\n-a----         12/7/2019   4:20 AM           5510 License.txt\n</code></pre> <p>data directory \ub294 EBS \ubcfc\ub968\uc5d0 \uc758\ud574 \uc81c\uacf5\ub429\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/storage/#out-of-tree","title":"\uc708\ub3c4\uc6b0 Out-of-tree","text":"<p>CSI \ud50c\ub7ec\uadf8\uc778\uacfc \uc5f0\uacb0\ub41c \ucf54\ub4dc\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub85c \ubc30\ud3ec\ub418\uace0 \ub370\ubaac\uc14b(DaemonSet) \ubc0f \uc2a4\ud14c\uc774\ud2b8\ud480\uc14b(StatefulSet)\uacfc \uac19\uc740 \ud45c\uc900 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uad6c\uc131\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubc30\ud3ec\ub418\ub294 out-of-tree \uc2a4\ud06c\ub9bd\ud2b8 \ubc0f \ubc14\uc774\ub108\ub9ac\ub85c \uc81c\uacf5\ub429\ub2c8\ub2e4. CSI \ud50c\ub7ec\uadf8\uc778\uc740 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uad11\ubc94\uc704\ud55c \ubcfc\ub968 \uad00\ub9ac \uc791\uc5c5\uc744 \ucc98\ub9ac\ud569\ub2c8\ub2e4. CSI \ud50c\ub7ec\uadf8\uc778\uc740 \uc77c\ubc18\uc801\uc73c\ub85c \ub178\ub4dc \ud50c\ub7ec\uadf8\uc778(\uac01 \ub178\ub4dc\uc5d0\uc11c \ub370\ubaac\uc14b\uc73c\ub85c \uc2e4\ud589\ub428)\uacfc \ucee8\ud2b8\ub864\ub7ec \ud50c\ub7ec\uadf8\uc778\uc73c\ub85c \uad6c\uc131\ub429\ub2c8\ub2e4.</p> <p>CSI \ub178\ub4dc \ud50c\ub7ec\uadf8\uc778 (\ud2b9\ud788 \ube14\ub85d \uc7a5\uce58 \ub610\ub294 \uacf5\uc720 \ud30c\uc77c \uc2dc\uc2a4\ud15c\uc744 \ud1b5\ud574 \ub178\ucd9c\ub418\ub294 \ud37c\uc2dc\uc2a4\ud134\ud2b8 \ubcfc\ub968\uacfc \uad00\ub828\ub41c \ud50c\ub7ec\uadf8\uc778)\uc740 \ub514\uc2a4\ud06c \uc7a5\uce58 \uc2a4\uce94, \ud30c\uc77c \uc2dc\uc2a4\ud15c \ud0d1\uc7ac \ub4f1\uacfc \uac19\uc740 \ub2e4\uc591\ud55c \uad8c\ud55c \uc791\uc5c5\uc744 \uc218\ud589\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774\ub7f0 \uc791\uc5c5\uc740 \ud638\uc2a4\ud2b8 \uc6b4\uc601 \uccb4\uc81c\ub9c8\ub2e4 \ub2e4\ub985\ub2c8\ub2e4. \ub9ac\ub205\uc2a4 \uc6cc\ucee4 \ub178\ub4dc\uc758 \uacbd\uc6b0 \ucee8\ud14c\uc774\ub108\ud654\ub41c CSI \ub178\ub4dc \ud50c\ub7ec\uadf8\uc778\uc740 \uc77c\ubc18\uc801\uc73c\ub85c \uad8c\ud55c \uc788\ub294 \ucee8\ud14c\uc774\ub108\ub85c \ubc30\ud3ec\ub429\ub2c8\ub2e4. \uc708\ub3c4\uc6b0 \uc6cc\ucee4 \ub178\ub4dc\uc758 \uacbd\uc6b0 \uac01 \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc5d0 \uc0ac\uc804 \uc124\uce58\ud574\uc57c \ud558\ub294 \ucee4\ubba4\ub2c8\ud2f0 \uad00\ub9ac \ub3c5\ub9bd \uc2e4\ud589\ud615 \ubc14\uc774\ub108\ub9ac\uc778 csi-proxy \ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108\ud654\ub41c CSI \ub178\ub4dc \ud50c\ub7ec\uadf8\uc778\uc5d0 \ub300\ud55c \uad8c\ud55c \uc788\ub294 \uc791\uc5c5\uc774 \uc9c0\uc6d0\ub429\ub2c8\ub2e4. </p> <p>Amazon EKS \ucd5c\uc801\ud654 \uc708\ub3c4\uc6b0 AMI\uc5d0\uc11c\ub294 2022\ub144 4\uc6d4\ubd80\ud130 CSI-proxy\uac00 \ud3ec\ud568\ub429\ub2c8\ub2e4. \uace0\uac1d\uc740 \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc758 SMB CSI \ub4dc\ub77c\uc774\ubc84\ub97c \uc0ac\uc6a9\ud558\uc5ec Amazon FSx for Windows File Server, Amazon FSx for NetApp ONTAP SMB Shares, \ubc0f/\ub610\ub294 AWS Storage Gateway \u2013 File Gateway\uc5d0 \uc561\uc138\uc2a4 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\ub2e4\uc74c \ube14\ub85c\uadf8\uc5d0\uc11c\ub294 Amazon FSx for Windows File Server\ub97c \uc704\ub3c4\uc6b0 \ud30c\ub4dc\uc6a9 \uc601\uad6c \uc2a4\ud1a0\ub9ac\uc9c0\ub85c \uc0ac\uc6a9\ud558\ub3c4\ub85d SMB CSI \ub4dc\ub77c\uc774\ubc84\ub97c \uc124\uc815\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc138\ubd80 \uc815\ubcf4\uac00 \ub098\uc640 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"ko/windows/docs/storage/#amazon-fsx-for-windows-file-server","title":"Amazon FSx for Windows File Server","text":"<p>\ud55c \uac00\uc9c0 \uc635\uc158\uc740 SMB Global Mapping\uc774\ub77c\ub294 SMB \uae30\ub2a5\uc744 \ud1b5\ud574 Windows \ud30c\uc77c \uc11c\ubc84\uc6a9 Amazon FSx\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uc774 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uba74 \ud638\uc2a4\ud2b8\uc5d0 SMB \uacf5\uc720\ub97c \ub9c8\uc6b4\ud2b8\ud55c \ub2e4\uc74c \ud574\ub2f9 \uacf5\uc720\uc758 \ub514\ub809\ud130\ub9ac\ub97c \ucee8\ud14c\uc774\ub108\ub85c \uc804\ub2ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\ub97c \ud2b9\uc815 \uc11c\ubc84, \uacf5\uc720, \uc0ac\uc6a9\uc790 \uc774\ub984 \ub610\ub294 \uc554\ud638\ub85c \uad6c\uc131\ud560 \ud544\uc694\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \ub300\uc2e0 \ud638\uc2a4\ud2b8\uc5d0\uc11c \ubaa8\ub450 \ucc98\ub9ac\ub429\ub2c8\ub2e4. \ucee8\ud14c\uc774\ub108\ub294 \ub85c\uceec \uc2a4\ud1a0\ub9ac\uc9c0\uac00 \uc788\ub294 \uac83\ucc98\ub7fc \uc791\ub3d9\ud569\ub2c8\ub2e4.</p> <p>SMB Global Mapping\uc740 \uc624\ucf00\uc2a4\ud2b8\ub808\uc774\ud130\uc5d0\uac8c \ud22c\uba85\ud558\uac8c \uc804\ub2ec\ub418\uba70 HostPath\ub97c \ud1b5\ud574 \ub9c8\uc6b4\ud2b8\ub418\ubbc0\ub85c \ubcf4\uc548 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p> <p>\uc544\ub798 \uc608\uc81c\uc5d0\uc11c, <code>G:\\Directory\\app-state</code> \uacbd\ub85c\ub294 \uc708\ub3c4\uc6b0 \ub178\ub4dc\uc758 SMB \uacf5\uc720\uc785\ub2c8\ub2e4.</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-fsx\nspec:\n  containers:\n  - name: test-fsx\n    image: mcr.microsoft.com/windows/servercore:ltsc2019\n    command:\n      - powershell.exe\n      - -command\n      - \"Add-WindowsFeature Web-Server; Invoke-WebRequest -UseBasicParsing -Uri 'https://dotnetbinaries.blob.core.windows.net/servicemonitor/2.0.1.6/ServiceMonitor.exe' -OutFile 'C:\\\\ServiceMonitor.exe'; echo '&lt;html&gt;&lt;body&gt;&lt;br/&gt;&lt;br/&gt;&lt;marquee&gt;&lt;H1&gt;Hello EKS!!!&lt;H1&gt;&lt;marquee&gt;&lt;/body&gt;&lt;html&gt;' &gt; C:\\\\inetpub\\\\wwwroot\\\\default.html; C:\\\\ServiceMonitor.exe 'w3svc'; \"\n    volumeMounts:\n      - mountPath: C:\\dotnetapp\\app-state\n        name: test-mount\n  volumes:\n    - name: test-mount\n      hostPath: \n        path: G:\\Directory\\app-state\n        type: Directory\n  nodeSelector:\n      beta.kubernetes.io/os: windows\n      beta.kubernetes.io/arch: amd64\n</code></pre> <p>\ub2e4\uc74c \ube14\ub85c\uadf8 \uc5d0\uc11c\ub294 Amazon FSx for Windows File Server\ub97c \uc708\ub3c4\uc6b0 \ud30c\ub4dc\uc6a9 \uc601\uad6c \uc2a4\ud1a0\ub9ac\uc9c0\ub85c \uc124\uc815\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uc138\ubd80 \uc815\ubcf4\uac00 \ub098\uc640 \uc788\uc2b5\ub2c8\ub2e4.</p>"},{"location":"zh/","title":"\u4ecb\u7ecd","text":"<p>\u6b22\u8fce\u9605\u8bfb EKS \u6700\u4f73\u5b9e\u8df5\u6307\u5357\u3002\u672c\u9879\u76ee\u7684\u4e3b\u8981\u76ee\u6807\u662f\u4e3a Amazon EKS \u7684\u7b2c\u4e8c\u5929\u8fd0\u7ef4\u63d0\u4f9b\u4e00\u5957\u6700\u4f73\u5b9e\u8df5\u3002\u6211\u4eec\u9009\u62e9\u5c06\u6b64\u6307\u5357\u53d1\u5e03\u5230 GitHub \u4e0a\uff0c\u4ee5\u4fbf\u6211\u4eec\u80fd\u591f\u5feb\u901f\u8fed\u4ee3\u3001\u53ca\u65f6\u6709\u6548\u5730\u4e3a\u5404\u79cd\u95ee\u9898\u63d0\u4f9b\u5efa\u8bae\uff0c\u5e76\u8f7b\u677e\u5730\u7eb3\u5165\u66f4\u5e7f\u6cdb\u793e\u533a\u7684\u5efa\u8bae\u3002</p> <p>\u6211\u4eec\u76ee\u524d\u5df2\u53d1\u5e03\u4ee5\u4e0b\u4e3b\u9898\u7684\u6307\u5357\uff1a</p> <ul> <li>\u5b89\u5168\u6700\u4f73\u5b9e\u8df5</li> <li>\u53ef\u9760\u6027\u6700\u4f73\u5b9e\u8df5</li> <li>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u6700\u4f73\u5b9e\u8df5\uff1a karpenter\u3001cluster-autoscaler</li> <li>\u8fd0\u884c Windows \u5bb9\u5668\u7684\u6700\u4f73\u5b9e\u8df5</li> <li>\u7f51\u7edc\u6700\u4f73\u5b9e\u8df5</li> <li>\u53ef\u6269\u5c55\u6027\u6700\u4f73\u5b9e\u8df5</li> <li>\u96c6\u7fa4\u5347\u7ea7\u6700\u4f73\u5b9e\u8df5</li> <li>\u6210\u672c\u4f18\u5316\u6700\u4f73\u5b9e\u8df5</li> </ul> <p>\u6211\u4eec\u8fd8\u5f00\u6e90\u4e86\u4e00\u4e2a\u540d\u4e3a hardeneks \u7684\u57fa\u4e8e Python \u7684 CLI (\u547d\u4ee4\u884c\u754c\u9762)\uff0c\u7528\u4e8e\u68c0\u67e5\u672c\u6307\u5357\u4e2d\u7684\u4e00\u4e9b\u5efa\u8bae\u3002</p> <p>\u672a\u6765\u6211\u4eec\u5c06\u53d1\u5e03\u6709\u5173\u6027\u80fd\u3001\u6210\u672c\u4f18\u5316\u548c\u8fd0\u8425\u5353\u8d8a\u7684\u6700\u4f73\u5b9e\u8df5\u6307\u5357\u3002</p>"},{"location":"zh/#_2","title":"\u76f8\u5173\u6307\u5357","text":"<p>\u9664\u4e86 EKS \u7528\u6237\u6307\u5357\u4e4b\u5916\uff0cAWS \u8fd8\u53d1\u5e03\u4e86\u5176\u4ed6\u4e00\u4e9b\u6307\u5357\uff0c\u53ef\u80fd\u4f1a\u5e2e\u52a9\u60a8\u5b9e\u65bd EKS\u3002</p> <ul> <li>EMR Containers \u6700\u4f73\u5b9e\u8df5\u6307\u5357</li> <li>EKS \u4e0a\u7684\u6570\u636e</li> <li>AWS \u53ef\u89c2\u6d4b\u6027\u6700\u4f73\u5b9e\u8df5</li> <li>Amazon EKS Blueprints for Terraform</li> <li>Amazon EKS Blueprints \u5feb\u901f\u5165\u95e8</li> </ul>"},{"location":"zh/#_3","title":"\u8d21\u732e","text":"<p>\u6211\u4eec\u9f13\u52b1\u60a8\u4e3a\u8fd9\u4e9b\u6307\u5357\u505a\u51fa\u8d21\u732e\u3002\u5982\u679c\u60a8\u5df2\u5b9e\u65bd\u4e86\u4e00\u79cd\u88ab\u8bc1\u660e\u6709\u6548\u7684\u5b9e\u8df5\uff0c\u8bf7\u901a\u8fc7\u63d0\u51fa\u95ee\u9898\u6216\u62c9\u53d6\u8bf7\u6c42\u4e0e\u6211\u4eec\u5206\u4eab\u3002\u540c\u6837\uff0c\u5982\u679c\u60a8\u53d1\u73b0\u6211\u4eec\u5df2\u53d1\u5e03\u7684\u6307\u5357\u4e2d\u5b58\u5728\u9519\u8bef\u6216\u7f3a\u9677\uff0c\u8bf7\u63d0\u4ea4 PR \u52a0\u4ee5\u7ea0\u6b63\u3002\u63d0\u4ea4 PR \u7684\u6307\u5357\u53ef\u4ee5\u5728\u6211\u4eec\u7684\u8d21\u732e\u6307\u5357\u4e2d\u627e\u5230\u3002</p>"},{"location":"zh/cluster-autoscaling/","title":"Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668","text":""},{"location":"zh/cluster-autoscaling/#_1","title":"\u6982\u8ff0","text":"<p>Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u662f\u7531 SIG Autoscaling \u7ef4\u62a4\u7684\u4e00\u79cd\u6d41\u884c\u7684\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u89e3\u51b3\u65b9\u6848\u3002\u5b83\u8d1f\u8d23\u786e\u4fdd\u60a8\u7684\u96c6\u7fa4\u6709\u8db3\u591f\u7684\u8282\u70b9\u6765\u8c03\u5ea6\u60a8\u7684 Pod\uff0c\u800c\u4e0d\u4f1a\u6d6a\u8d39\u8d44\u6e90\u3002\u5b83\u4f1a\u76d1\u89c6\u65e0\u6cd5\u8c03\u5ea6\u7684 Pod \u548c\u5229\u7528\u7387\u8f83\u4f4e\u7684\u8282\u70b9\u3002\u7136\u540e\uff0c\u5b83\u4f1a\u6a21\u62df\u6dfb\u52a0\u6216\u5220\u9664\u8282\u70b9\uff0c\u7136\u540e\u518d\u5c06\u66f4\u6539\u5e94\u7528\u5230\u60a8\u7684\u96c6\u7fa4\u3002\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u4e2d\u7684 AWS \u4e91\u9a71\u52a8\u7a0b\u5e8f\u5b9e\u73b0\u63a7\u5236\u60a8\u7684 EC2 Auto Scaling \u7ec4\u7684 <code>.DesiredReplicas</code> \u5b57\u6bb5\u3002</p> <p></p> <p>\u672c\u6307\u5357\u5c06\u4e3a\u914d\u7f6e\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u548c\u9009\u62e9\u6700\u4f73\u7684\u6743\u8861\u96c6\u6765\u6ee1\u8db3\u60a8\u7ec4\u7ec7\u7684\u9700\u6c42\u63d0\u4f9b\u4e00\u4e2a\u601d\u7ef4\u6a21\u578b\u3002\u867d\u7136\u6ca1\u6709\u4e00\u79cd\u6700\u4f73\u914d\u7f6e\uff0c\u4f46\u6709\u4e00\u7ec4\u914d\u7f6e\u9009\u9879\u53ef\u4ee5\u8ba9\u60a8\u5728\u6027\u80fd\u3001\u53ef\u6269\u5c55\u6027\u3001\u6210\u672c\u548c\u53ef\u7528\u6027\u4e4b\u95f4\u8fdb\u884c\u6743\u8861\u3002\u6b64\u5916\uff0c\u672c\u6307\u5357\u8fd8\u5c06\u63d0\u4f9b\u5728 AWS \u4e0a\u4f18\u5316\u914d\u7f6e\u7684\u6280\u5de7\u548c\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"zh/cluster-autoscaling/#_2","title":"\u672f\u8bed\u8868","text":"<p>\u4ee5\u4e0b\u672f\u8bed\u5c06\u5728\u672c\u6587\u6863\u4e2d\u9891\u7e41\u4f7f\u7528\u3002\u8fd9\u4e9b\u672f\u8bed\u53ef\u80fd\u6709\u5e7f\u6cdb\u7684\u542b\u4e49\uff0c\u4f46\u5728\u672c\u6587\u6863\u4e2d\u4ec5\u9650\u4e8e\u4ee5\u4e0b\u5b9a\u4e49\u3002</p> <p>\u53ef\u6269\u5c55\u6027\u662f\u6307\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5728 Pod \u548c\u8282\u70b9\u6570\u91cf\u589e\u52a0\u65f6\u7684\u6027\u80fd\u8868\u73b0\u3002\u5f53\u8fbe\u5230\u53ef\u6269\u5c55\u6027\u9650\u5236\u65f6\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684\u6027\u80fd\u548c\u529f\u80fd\u5c06\u4f1a\u964d\u4f4e\u3002\u5f53\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u8d85\u51fa\u5176\u53ef\u6269\u5c55\u6027\u9650\u5236\u65f6\uff0c\u5b83\u53ef\u80fd\u65e0\u6cd5\u5728\u60a8\u7684\u96c6\u7fa4\u4e2d\u6dfb\u52a0\u6216\u5220\u9664\u8282\u70b9\u3002</p> <p>\u6027\u80fd\u662f\u6307\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u80fd\u591f\u505a\u51fa\u548c\u6267\u884c\u6269\u7f29\u51b3\u7b56\u7684\u901f\u5ea6\u3002\u4e00\u4e2a\u5b8c\u7f8e\u7684\u6027\u80fd\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5c06\u7acb\u5373\u505a\u51fa\u51b3\u7b56\u5e76\u89e6\u53d1\u6269\u7f29\u64cd\u4f5c\u4ee5\u54cd\u5e94\u523a\u6fc0\uff0c\u4f8b\u5982\u4e00\u4e2a Pod \u65e0\u6cd5\u8c03\u5ea6\u3002</p> <p>\u53ef\u7528\u6027\u610f\u5473\u7740 Pod \u53ef\u4ee5\u5feb\u901f\u8c03\u5ea6\u4e14\u4e0d\u4f1a\u4e2d\u65ad\u3002\u8fd9\u5305\u62ec\u65b0\u521b\u5efa\u7684 Pod \u9700\u8981\u88ab\u8c03\u5ea6\u4ee5\u53ca\u7f29\u51cf\u8282\u70b9\u7ec8\u6b62\u5176\u4e0a\u4efb\u4f55\u5269\u4f59\u8c03\u5ea6\u7684 Pod \u7684\u60c5\u51b5\u3002</p> <p>\u6210\u672c\u7531\u6269\u7f29\u4e8b\u4ef6\u80cc\u540e\u7684\u51b3\u7b56\u51b3\u5b9a\u3002\u5982\u679c\u73b0\u6709\u8282\u70b9\u5229\u7528\u7387\u8f83\u4f4e\u6216\u6dfb\u52a0\u7684\u65b0\u8282\u70b9\u5bf9\u4e8e\u5373\u5c06\u5230\u6765\u7684 Pod \u6765\u8bf4\u592a\u5927\uff0c\u8d44\u6e90\u5c31\u4f1a\u88ab\u6d6a\u8d39\u3002\u6839\u636e\u4f7f\u7528\u60c5\u51b5\uff0c\u7531\u4e8e\u8fc7\u4e8e\u79ef\u6781\u7684\u7f29\u51cf\u51b3\u7b56\u800c\u8fc7\u65e9\u7ec8\u6b62 Pod \u53ef\u80fd\u4f1a\u4ea7\u751f\u76f8\u5173\u6210\u672c\u3002</p> <p>\u8282\u70b9\u7ec4\u662f\u96c6\u7fa4\u4e2d\u8282\u70b9\u7ec4\u7684\u4e00\u4e2a\u62bd\u8c61 Kubernetes \u6982\u5ff5\u3002\u5b83\u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684 Kubernetes \u8d44\u6e90\uff0c\u800c\u662f\u5b58\u5728\u4e8e\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u3001\u96c6\u7fa4 API \u548c\u5176\u4ed6\u7ec4\u4ef6\u4e2d\u7684\u4e00\u4e2a\u62bd\u8c61\u6982\u5ff5\u3002\u540c\u4e00\u8282\u70b9\u7ec4\u4e2d\u7684\u8282\u70b9\u5171\u4eab\u5c5e\u6027\uff0c\u5982\u6807\u7b7e\u548c\u6c61\u70b9\uff0c\u4f46\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u53ef\u7528\u533a\u6216\u5b9e\u4f8b\u7c7b\u578b\u3002</p> <p>EC2 Auto Scaling \u7ec4\u53ef\u7528\u4f5c EC2 \u4e0a\u8282\u70b9\u7ec4\u7684\u4e00\u79cd\u5b9e\u73b0\u3002EC2 Auto Scaling \u7ec4\u88ab\u914d\u7f6e\u4e3a\u542f\u52a8\u5b9e\u4f8b\uff0c\u8fd9\u4e9b\u5b9e\u4f8b\u4f1a\u81ea\u52a8\u52a0\u5165\u5176 Kubernetes \u96c6\u7fa4\u5e76\u5c06\u6807\u7b7e\u548c\u6c61\u70b9\u5e94\u7528\u5230\u76f8\u5e94\u7684 Kubernetes API \u4e2d\u7684\u8282\u70b9\u8d44\u6e90\u3002</p> <p>EC2 \u6258\u7ba1\u8282\u70b9\u7ec4\u662f EC2 \u4e0a\u8282\u70b9\u7ec4\u7684\u53e6\u4e00\u79cd\u5b9e\u73b0\u3002\u5b83\u62bd\u8c61\u4e86\u624b\u52a8\u914d\u7f6e EC2 Auto Scaling \u7ec4\u7684\u590d\u6742\u6027\uff0c\u5e76\u63d0\u4f9b\u4e86\u5176\u4ed6\u7ba1\u7406\u529f\u80fd\uff0c\u5982\u8282\u70b9\u7248\u672c\u5347\u7ea7\u548c\u4f18\u96c5\u8282\u70b9\u7ec8\u6b62\u3002</p>"},{"location":"zh/cluster-autoscaling/#_3","title":"\u64cd\u4f5c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668","text":"<p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u901a\u5e38\u4f5c\u4e3aDeployment\u5b89\u88c5\u5728\u60a8\u7684\u96c6\u7fa4\u4e2d\u3002\u5b83\u4f7f\u7528\u9886\u5bfc\u8005\u9009\u4e3e\u6765\u786e\u4fdd\u9ad8\u53ef\u7528\u6027\uff0c\u4f46\u5de5\u4f5c\u7531\u5355\u4e2a\u526f\u672c\u4e00\u6b21\u5b8c\u6210\u3002\u5b83\u4e0d\u662f\u6c34\u5e73\u53ef\u6269\u5c55\u7684\u3002\u5bf9\u4e8e\u57fa\u672c\u8bbe\u7f6e\uff0c\u4f7f\u7528\u63d0\u4f9b\u7684\u5b89\u88c5\u8bf4\u660e,\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5e94\u8be5\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u4f46\u6709\u4e00\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u3002</p> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684\u7248\u672c\u4e0e\u96c6\u7fa4\u7684\u7248\u672c\u5339\u914d\u3002\u4e0d\u652f\u6301\u8de8\u7248\u672c\u517c\u5bb9\u6027\u4e0d\u7ecf\u6d4b\u8bd5\u6216\u652f\u6301\u3002</li> <li>\u542f\u7528\u4e86\u81ea\u52a8\u53d1\u73b0,\u9664\u975e\u60a8\u6709\u7279\u5b9a\u7684\u9ad8\u7ea7\u7528\u4f8b\u963b\u6b62\u4f7f\u7528\u6b64\u6a21\u5f0f\u3002</li> </ul>"},{"location":"zh/cluster-autoscaling/#iam","title":"\u4e3a IAM \u89d2\u8272\u91c7\u7528\u6700\u5c0f\u6743\u9650\u8bbf\u95ee","text":"<p>\u5f53\u4f7f\u7528\u81ea\u52a8\u53d1\u73b0\u65f6\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u91c7\u7528\u6700\u5c0f\u6743\u9650\u8bbf\u95ee\uff0c\u5c06 <code>autoscaling:SetDesiredCapacity</code> \u548c <code>autoscaling:TerminateInstanceInAutoScalingGroup</code> \u64cd\u4f5c\u9650\u5236\u5728\u4e0e\u5f53\u524d\u96c6\u7fa4\u76f8\u5173\u7684 Auto Scaling \u7ec4\u4e0a\u3002</p> <p>\u8fd9\u5c06\u9632\u6b62\u5728\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u4fee\u6539\u53e6\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u7ec4\uff0c\u5373\u4f7f <code>--node-group-auto-discovery</code> \u53c2\u6570\u6ca1\u6709\u4f7f\u7528\u6807\u7b7e (\u4f8b\u5982 <code>k8s.io/cluster-autoscaler/&lt;cluster-name&gt;</code>) \u5c06\u5176\u8303\u56f4\u7f29\u5c0f\u5230\u96c6\u7fa4\u7684\u8282\u70b9\u7ec4\u3002</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"autoscaling:SetDesiredCapacity\",\n                \"autoscaling:TerminateInstanceInAutoScalingGroup\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:ResourceTag/k8s.io/cluster-autoscaler/enabled\": \"true\",\n                    \"aws:ResourceTag/k8s.io/cluster-autoscaler/&lt;my-cluster&gt;\": \"owned\"\n                }\n            }\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"autoscaling:DescribeAutoScalingGroups\",\n                \"autoscaling:DescribeAutoScalingInstances\",\n                \"autoscaling:DescribeLaunchConfigurations\",\n                \"autoscaling:DescribeScalingActivities\",\n                \"autoscaling:DescribeTags\",\n                \"ec2:DescribeImages\",\n                \"ec2:DescribeInstanceTypes\",\n                \"ec2:DescribeLaunchTemplateVersions\",\n                \"ec2:GetInstanceTypesFromInstanceRequirements\",\n                \"eks:DescribeNodegroup\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n</code></pre>"},{"location":"zh/cluster-autoscaling/#_4","title":"\u914d\u7f6e\u60a8\u7684\u8282\u70b9\u7ec4","text":"<p>\u6709\u6548\u7684\u81ea\u52a8\u6269\u7f29\u4ece\u6b63\u786e\u914d\u7f6e\u4e00\u7ec4\u8282\u70b9\u7ec4\u5f00\u59cb\u3002\u9009\u62e9\u6b63\u786e\u7684\u8282\u70b9\u7ec4\u96c6\u5bf9\u4e8e\u6700\u5927\u5316\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u53ef\u7528\u6027\u548c\u964d\u4f4e\u6210\u672c\u81f3\u5173\u91cd\u8981\u3002AWS \u4f7f\u7528 EC2 Auto Scaling \u7ec4\u5b9e\u73b0\u8282\u70b9\u7ec4\uff0c\u8fd9\u4e9b\u7ec4\u5bf9\u4e8e\u5927\u91cf\u7528\u4f8b\u6765\u8bf4\u975e\u5e38\u7075\u6d3b\u3002\u4f46\u662f\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5bf9\u60a8\u7684\u8282\u70b9\u7ec4\u505a\u51fa\u4e86\u4e00\u4e9b\u5047\u8bbe\u3002\u4fdd\u6301\u60a8\u7684 EC2 Auto Scaling \u7ec4\u914d\u7f6e\u4e0e\u8fd9\u4e9b\u5047\u8bbe\u4e00\u81f4\u5c06\u6700\u5c0f\u5316\u610f\u5916\u884c\u4e3a\u3002</p> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u6bcf\u4e2a\u8282\u70b9\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u5177\u6709\u76f8\u540c\u7684\u8c03\u5ea6\u5c5e\u6027\uff0c\u5982\u6807\u7b7e\u3001\u6c61\u70b9\u548c\u8d44\u6e90\u3002</li> <li>\u5bf9\u4e8e MixedInstancePolicies\uff0c\u5b9e\u4f8b\u7c7b\u578b\u5fc5\u987b\u5177\u6709\u76f8\u540c\u7684 CPU\u3001\u5185\u5b58\u548c GPU \u5f62\u72b6</li> <li>\u5c06\u4f7f\u7528\u7b56\u7565\u4e2d\u6307\u5b9a\u7684\u7b2c\u4e00\u4e2a\u5b9e\u4f8b\u7c7b\u578b\u6765\u6a21\u62df\u8c03\u5ea6\u3002</li> <li>\u5982\u679c\u60a8\u7684\u7b56\u7565\u5305\u542b\u66f4\u591a\u8d44\u6e90\u7684\u5176\u4ed6\u5b9e\u4f8b\u7c7b\u578b\uff0c\u5728\u6269\u7f29\u540e\u8d44\u6e90\u53ef\u80fd\u4f1a\u88ab\u6d6a\u8d39\u3002</li> <li>\u5982\u679c\u60a8\u7684\u7b56\u7565\u5305\u542b\u8f83\u5c11\u8d44\u6e90\u7684\u5176\u4ed6\u5b9e\u4f8b\u7c7b\u578b\uff0c\u7531\u4e8e\u5bb9\u91cf\u4e0d\u8db3\uff0c\u60a8\u7684 Pod \u53ef\u80fd\u65e0\u6cd5\u5728\u65b0\u5b9e\u4f8b\u4e0a\u8c03\u5ea6\u3002</li> <li>\u76f8\u6bd4\u4e8e\u8bb8\u591a\u8282\u70b9\u8f83\u5c11\u7684\u8282\u70b9\u7ec4\uff0c\u66f4\u503e\u5411\u4e8e\u4f7f\u7528\u8282\u70b9\u8f83\u591a\u7684\u8282\u70b9\u7ec4\u3002\u8fd9\u5c06\u5bf9\u53ef\u6269\u5c55\u6027\u4ea7\u751f\u6700\u5927\u5f71\u54cd\u3002</li> <li>\u5728\u4e24\u4e2a\u7cfb\u7edf\u90fd\u63d0\u4f9b\u652f\u6301\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u53ef\u80fd\u4f18\u5148\u9009\u62e9 EC2 \u529f\u80fd (\u4f8b\u5982\u533a\u57df\u3001MixedInstancePolicy)</li> </ul> <p>\u6ce8\u610f\uff1a\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 EKS \u6258\u7ba1\u8282\u70b9\u7ec4\u3002\u6258\u7ba1\u8282\u70b9\u7ec4\u5e26\u6709\u5f3a\u5927\u7684\u7ba1\u7406\u529f\u80fd\uff0c\u5305\u62ec\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684\u529f\u80fd\uff0c\u5982\u81ea\u52a8 EC2 Auto Scaling \u7ec4\u53d1\u73b0\u548c\u4f18\u96c5\u8282\u70b9\u7ec8\u6b62\u3002</p>"},{"location":"zh/cluster-autoscaling/#_5","title":"\u4f18\u5316\u6027\u80fd\u548c\u53ef\u6269\u5c55\u6027","text":"<p>\u4e86\u89e3\u81ea\u52a8\u6269\u7f29\u7b97\u6cd5\u7684\u8fd0\u884c\u65f6\u590d\u6742\u5ea6\u5c06\u6709\u52a9\u4e8e\u60a8\u8c03\u6574\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\uff0c\u4ee5\u4fbf\u5728\u5927\u4e8e 1,000 \u4e2a\u8282\u70b9\u7684\u5927\u578b\u96c6\u7fa4\u4e2d\u7ee7\u7eed\u987a\u5229\u8fd0\u884c\u3002</p> <p>\u8c03\u6574\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u53ef\u6269\u5c55\u6027\u7684\u4e3b\u8981\u65cb\u94ae\u662f\u63d0\u4f9b\u7ed9\u8fdb\u7a0b\u7684\u8d44\u6e90\u3001\u7b97\u6cd5\u7684\u626b\u63cf\u95f4\u9694\u4ee5\u53ca\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u7ec4\u6570\u91cf\u3002\u8fd8\u6709\u5176\u4ed6\u56e0\u7d20\u6d89\u53ca\u5230\u8fd9\u4e2a\u7b97\u6cd5\u7684\u771f\u6b63\u8fd0\u884c\u65f6\u590d\u6742\u5ea6\uff0c\u4f8b\u5982\u8c03\u5ea6\u63d2\u4ef6\u7684\u590d\u6742\u6027\u548c Pod \u7684\u6570\u91cf\u3002\u8fd9\u4e9b\u88ab\u8ba4\u4e3a\u662f\u4e0d\u53ef\u914d\u7f6e\u7684\u53c2\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u662f\u96c6\u7fa4\u5de5\u4f5c\u8d1f\u8f7d\u7684\u81ea\u7136\u5c5e\u6027\uff0c\u65e0\u6cd5\u8f7b\u6613\u8c03\u6574\u3002</p> <p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5c06\u6574\u4e2a\u96c6\u7fa4\u7684\u72b6\u6001\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5305\u62ec Pod\u3001\u8282\u70b9\u548c\u8282\u70b9\u7ec4\u3002\u5728\u6bcf\u4e2a\u626b\u63cf\u95f4\u9694\uff0c\u7b97\u6cd5\u8bc6\u522b\u65e0\u6cd5\u8c03\u5ea6\u7684 Pod \u5e76\u4e3a\u6bcf\u4e2a\u8282\u70b9\u7ec4\u6a21\u62df\u8c03\u5ea6\u3002\u8c03\u6574\u8fd9\u4e9b\u56e0\u7d20\u4f1a\u5e26\u6765\u4e0d\u540c\u7684\u6743\u8861\uff0c\u5e94\u8be5\u6839\u636e\u60a8\u7684\u7528\u4f8b\u4ed4\u7ec6\u8003\u8651\u3002</p>"},{"location":"zh/cluster-autoscaling/#_6","title":"\u5782\u76f4\u81ea\u52a8\u6269\u7f29\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668","text":"<p>\u6269\u5927\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u4ee5\u652f\u6301\u66f4\u5927\u7684\u96c6\u7fa4\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u589e\u52a0\u5176\u90e8\u7f72\u7684\u8d44\u6e90\u8bf7\u6c42\u3002\u5bf9\u4e8e\u5927\u578b\u96c6\u7fa4\uff0c\u5185\u5b58\u548c CPU \u90fd\u5e94\u8be5\u589e\u52a0\uff0c\u5c3d\u7ba1\u8fd9\u56e0\u96c6\u7fa4\u5927\u5c0f\u800c\u6709\u5f88\u5927\u5dee\u5f02\u3002\u901a\u5e38\u9700\u8981\u624b\u52a8\u589e\u52a0\u8d44\u6e90\u3002\u5982\u679c\u60a8\u53d1\u73b0\u4e0d\u65ad\u8c03\u6574\u8d44\u6e90\u4f1a\u5e26\u6765\u8fd0\u8425\u8d1f\u62c5\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Addon Resizer \u6216 Vertical Pod Autoscaler\u3002</p>"},{"location":"zh/cluster-autoscaling/#_7","title":"\u51cf\u5c11\u8282\u70b9\u7ec4\u7684\u6570\u91cf","text":"<p>\u6700\u5c0f\u5316\u8282\u70b9\u7ec4\u7684\u6570\u91cf\u662f\u786e\u4fdd\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5728\u5927\u578b\u96c6\u7fa4\u4e0a\u7ee7\u7eed\u826f\u597d\u8fd0\u884c\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u5bf9\u4e8e\u4e00\u4e9b\u7ec4\u7ec7\u6765\u8bf4\uff0c\u8fd9\u53ef\u80fd\u662f\u4e00\u4e2a\u6311\u6218\uff0c\u56e0\u4e3a\u4ed6\u4eec\u6309\u56e2\u961f\u6216\u5e94\u7528\u7a0b\u5e8f\u6765\u6784\u9020\u8282\u70b9\u7ec4\u3002\u867d\u7136 Kubernetes API \u5b8c\u5168\u652f\u6301\u8fd9\u79cd\u505a\u6cd5\uff0c\u4f46\u8fd9\u88ab\u89c6\u4e3a\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684\u53cd\u6a21\u5f0f\uff0c\u4f1a\u5bf9\u53ef\u6269\u5c55\u6027\u4ea7\u751f\u5f71\u54cd\u3002\u6709\u8bb8\u591a\u4f7f\u7528\u591a\u4e2a\u8282\u70b9\u7ec4\u7684\u539f\u56e0 (\u4f8b\u5982 Spot \u6216 GPU)\uff0c\u4f46\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u6709\u66ff\u4ee3\u8bbe\u8ba1\u53ef\u4ee5\u5b9e\u73b0\u76f8\u540c\u7684\u6548\u679c\uff0c\u540c\u65f6\u4f7f\u7528\u8f83\u5c11\u7684\u7ec4\u3002</p> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u800c\u4e0d\u662f\u8282\u70b9\u7ec4\u6765\u5b9e\u73b0 Pod \u9694\u79bb\u3002</li> <li>\u5728\u4f4e\u4fe1\u4efb\u591a\u79df\u6237\u96c6\u7fa4\u4e2d\u53ef\u80fd\u65e0\u6cd5\u505a\u5230\u8fd9\u4e00\u70b9\u3002</li> <li>\u6b63\u786e\u8bbe\u7f6e Pod ResourceRequests \u548c ResourceLimits \u4ee5\u907f\u514d\u8d44\u6e90\u4e89\u7528\u3002</li> <li>\u66f4\u5927\u7684\u5b9e\u4f8b\u7c7b\u578b\u5c06\u5bfc\u81f4\u66f4\u4f18\u7684\u88c5\u7bb1\u548c\u51cf\u5c11\u7cfb\u7edf Pod \u5f00\u9500\u3002</li> <li>\u4f7f\u7528 NodeTaints \u6216 NodeSelectors \u6765\u8c03\u5ea6 Pod \u4f5c\u4e3a\u4f8b\u5916\u60c5\u51b5\uff0c\u800c\u4e0d\u662f\u5e38\u89c4\u60c5\u51b5\u3002</li> <li>\u5c06\u533a\u57df\u8d44\u6e90\u5b9a\u4e49\u4e3a\u5177\u6709\u591a\u4e2a\u53ef\u7528\u533a\u7684\u5355\u4e2a EC2 Auto Scaling \u7ec4\u3002</li> </ul>"},{"location":"zh/cluster-autoscaling/#_8","title":"\u51cf\u5c11\u626b\u63cf\u95f4\u9694","text":"<p>\u8f83\u4f4e\u7684\u626b\u63cf\u95f4\u9694 (\u4f8b\u5982 10 \u79d2) \u5c06\u786e\u4fdd\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5728 Pod \u65e0\u6cd5\u8c03\u5ea6\u65f6\u5c3d\u5feb\u505a\u51fa\u54cd\u5e94\u3002\u4f46\u662f\uff0c\u6bcf\u6b21\u626b\u63cf\u90fd\u4f1a\u5bfc\u81f4\u5bf9 Kubernetes API \u548c EC2 Auto Scaling \u7ec4\u6216 EKS \u6258\u7ba1\u8282\u70b9\u7ec4 API \u7684\u591a\u6b21 API \u8c03\u7528\u3002\u8fd9\u4e9b API \u8c03\u7528\u53ef\u80fd\u4f1a\u5bfc\u81f4\u901f\u7387\u9650\u5236\uff0c\u751a\u81f3\u5bfc\u81f4\u60a8\u7684 Kubernetes \u63a7\u5236\u5e73\u9762\u670d\u52a1\u4e0d\u53ef\u7528\u3002</p> <p>\u9ed8\u8ba4\u626b\u63cf\u95f4\u9694\u4e3a 10 \u79d2\uff0c\u4f46\u5728 AWS \u4e0a\uff0c\u542f\u52a8\u65b0\u8282\u70b9\u9700\u8981\u66f4\u957f\u7684\u65f6\u95f4\u6765\u542f\u52a8\u65b0\u5b9e\u4f8b\u3002\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u589e\u52a0\u95f4\u9694\u800c\u4e0d\u4f1a\u663e\u8457\u589e\u52a0\u6574\u4f53\u6269\u7f29\u65f6\u95f4\u3002\u4f8b\u5982\uff0c\u5982\u679c\u542f\u52a8\u4e00\u4e2a\u8282\u70b9\u9700\u8981 2 \u5206\u949f\uff0c\u5c06\u95f4\u9694\u66f4\u6539\u4e3a 1 \u5206\u949f\u5c06\u5bfc\u81f4 API \u8c03\u7528\u51cf\u5c11 6 \u500d\uff0c\u800c\u6269\u7f29\u901f\u5ea6\u4ec5\u6162 38%\u3002</p>"},{"location":"zh/cluster-autoscaling/#_9","title":"\u8de8\u8282\u70b9\u7ec4\u5206\u7247","text":"<p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u53ef\u4ee5\u914d\u7f6e\u4e3a\u4ec5\u5728\u7279\u5b9a\u7684\u8282\u70b9\u7ec4\u96c6\u4e0a\u8fd0\u884c\u3002\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u90e8\u7f72\u591a\u4e2a\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u914d\u7f6e\u4e3a\u5728\u4e0d\u540c\u7684\u8282\u70b9\u7ec4\u96c6\u4e0a\u8fd0\u884c\u3002\u8fd9\u79cd\u7b56\u7565\u4f7f\u60a8\u80fd\u591f\u4f7f\u7528\u4efb\u610f\u5927\u91cf\u7684\u8282\u70b9\u7ec4\uff0c\u4ee5\u53ef\u6269\u5c55\u6027\u4e3a\u4ee3\u4ef7\u3002\u6211\u4eec\u53ea\u5efa\u8bae\u5728\u6700\u540e\u4e00\u6b21\u5c1d\u8bd5\u63d0\u9ad8\u6027\u80fd\u65f6\u4f7f\u7528\u6b64\u914d\u7f6e\u3002</p> <p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u6700\u521d\u5e76\u975e\u4e3a\u6b64\u914d\u7f6e\u800c\u8bbe\u8ba1\uff0c\u56e0\u6b64\u4f1a\u4ea7\u751f\u4e00\u4e9b\u526f\u4f5c\u7528\u3002\u7531\u4e8e\u5206\u7247\u4e0d\u4f1a\u76f8\u4e92\u901a\u4fe1\uff0c\u56e0\u6b64\u6709\u53ef\u80fd\u591a\u4e2a\u81ea\u52a8\u6269\u7f29\u5668\u4f1a\u5c1d\u8bd5\u8c03\u5ea6\u65e0\u6cd5\u8c03\u5ea6\u7684 Pod\u3002\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u591a\u4e2a\u8282\u70b9\u7ec4\u4e0d\u5fc5\u8981\u5730\u6269\u7f29\u3002\u8fd9\u4e9b\u989d\u5916\u7684\u8282\u70b9\u5c06\u5728 <code>scale-down-delay</code> \u540e\u7f29\u51cf\u3002</p> <pre><code>metadata:\n  name: cluster-autoscaler\n  namespace: cluster-autoscaler-1\n\n...\n\n--nodes=1:10:k8s-worker-asg-1\n--nodes=1:10:k8s-worker-asg-2\n\n---\n\nmetadata:\n  name: cluster-autoscaler\n  namespace: cluster-autoscaler-2\n\n...\n\n--nodes=1:10:k8s-worker-asg-3\n--nodes=1:10:k8s-worker-asg-4\n</code></pre> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u6bcf\u4e2a\u5206\u7247\u90fd\u914d\u7f6e\u4e3a\u6307\u5411\u4e00\u7ec4\u552f\u4e00\u7684 EC2 Auto Scaling \u7ec4</li> <li>\u6bcf\u4e2a\u5206\u7247\u90fd\u90e8\u7f72\u5728\u5355\u72ec\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u4ee5\u907f\u514d\u9886\u5bfc\u8005\u9009\u4e3e\u51b2\u7a81</li> </ul>"},{"location":"zh/cluster-autoscaling/#_10","title":"\u4f18\u5316\u6210\u672c\u548c\u53ef\u7528\u6027","text":""},{"location":"zh/cluster-autoscaling/#spot","title":"Spot \u5b9e\u4f8b","text":"<p>\u60a8\u53ef\u4ee5\u5728\u8282\u70b9\u7ec4\u4e2d\u4f7f\u7528 Spot \u5b9e\u4f8b\uff0c\u8282\u7701\u9ad8\u8fbe 90% \u7684\u6309\u9700\u4ef7\u683c\uff0c\u4f46\u6743\u8861\u662f Spot \u5b9e\u4f8b\u53ef\u80fd\u4f1a\u5728 EC2 \u9700\u8981\u56de\u6536\u5bb9\u91cf\u65f6\u968f\u65f6\u4e2d\u65ad\u3002\u5f53\u60a8\u7684 EC2 Auto Scaling \u7ec4\u7531\u4e8e\u7f3a\u4e4f\u53ef\u7528\u5bb9\u91cf\u800c\u65e0\u6cd5\u6269\u7f29\u65f6\uff0c\u5c06\u53d1\u751f\u5bb9\u91cf\u4e0d\u8db3\u9519\u8bef\u3002\u901a\u8fc7\u9009\u62e9\u591a\u4e2a\u5b9e\u4f8b\u7cfb\u5217\u6765\u6700\u5927\u5316\u591a\u6837\u6027\uff0c\u53ef\u4ee5\u589e\u52a0\u60a8\u5b9e\u73b0\u6240\u9700\u6269\u7f29\u7684\u673a\u4f1a\uff0c\u5e76\u51cf\u5c11 Spot \u5b9e\u4f8b\u4e2d\u65ad\u5bf9\u96c6\u7fa4\u53ef\u7528\u6027\u7684\u5f71\u54cd\uff0c\u540c\u65f6\u5229\u7528\u591a\u4e2a Spot \u5bb9\u91cf\u6c60\u3002\u4f7f\u7528 Spot \u5b9e\u4f8b\u7684 Mixed Instance Policies \u662f\u589e\u52a0\u591a\u6837\u6027\u800c\u4e0d\u589e\u52a0\u8282\u70b9\u7ec4\u6570\u91cf\u7684\u597d\u65b9\u6cd5\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5982\u679c\u60a8\u9700\u8981\u4fdd\u8bc1\u8d44\u6e90\uff0c\u8bf7\u4f7f\u7528\u6309\u9700\u5b9e\u4f8b\u800c\u4e0d\u662f Spot \u5b9e\u4f8b\u3002</p> <p>\u5728\u914d\u7f6e Mixed Instance Policies \u65f6\uff0c\u786e\u4fdd\u6240\u6709\u5b9e\u4f8b\u7c7b\u578b\u90fd\u5177\u6709\u76f8\u4f3c\u7684\u8d44\u6e90\u5bb9\u91cf\u81f3\u5173\u91cd\u8981\u3002\u81ea\u52a8\u6269\u7f29\u5668\u7684\u8c03\u5ea6\u6a21\u62df\u5668\u4f7f\u7528 MixedInstancePolicy \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b9e\u4f8b\u7c7b\u578b\u3002\u5982\u679c\u540e\u7eed\u5b9e\u4f8b\u7c7b\u578b\u66f4\u5927\uff0c\u5728\u6269\u7f29\u540e\u8d44\u6e90\u53ef\u80fd\u4f1a\u88ab\u6d6a\u8d39\u3002\u5982\u679c\u66f4\u5c0f\uff0c\u7531\u4e8e\u5bb9\u91cf\u4e0d\u8db3\uff0c\u60a8\u7684 Pod \u53ef\u80fd\u65e0\u6cd5\u5728\u65b0\u5b9e\u4f8b\u4e0a\u8c03\u5ea6\u3002\u4f8b\u5982\uff0cM4\u3001M5\u3001M5a \u548c M5n \u5b9e\u4f8b\u90fd\u5177\u6709\u76f8\u4f3c\u7684 CPU \u548c\u5185\u5b58\u91cf\uff0c\u662f MixedInstancePolicy \u7684\u7edd\u4f73\u5019\u9009\u3002EC2 \u5b9e\u4f8b\u9009\u62e9\u5668\u5de5\u5177\u53ef\u4ee5\u5e2e\u52a9\u60a8\u8bc6\u522b\u76f8\u4f3c\u7684\u5b9e\u4f8b\u7c7b\u578b\u3002</p> <p></p> <p>\u5efa\u8bae\u5c06\u6309\u9700\u548c Spot \u5bb9\u91cf\u9694\u79bb\u5230\u5355\u72ec\u7684 EC2 Auto Scaling \u7ec4\u4e2d\u3002\u8fd9\u6bd4\u4f7f\u7528\u57fa\u672c\u5bb9\u91cf\u7b56\u7565\u66f4\u53ef\u53d6\uff0c\u56e0\u4e3a\u8c03\u5ea6\u5c5e\u6027\u6839\u672c\u4e0d\u540c\u3002\u7531\u4e8e Spot \u5b9e\u4f8b\u53ef\u80fd\u4f1a\u5728\u4efb\u4f55\u65f6\u5019\u4e2d\u65ad (\u5f53 EC2 \u9700\u8981\u56de\u6536\u5bb9\u91cf\u65f6)\uff0c\u7528\u6237\u901a\u5e38\u4f1a\u4e3a\u5176\u53ef\u62a2\u5360\u8282\u70b9\u6dfb\u52a0\u6c61\u70b9\uff0c\u9700\u8981\u663e\u5f0f\u7684 Pod \u5bb9\u5fcd\u8be5\u62a2\u5360\u884c\u4e3a\u3002\u8fd9\u4e9b\u6c61\u70b9\u5bfc\u81f4\u8282\u70b9\u7684\u8c03\u5ea6\u5c5e\u6027\u4e0d\u540c\uff0c\u56e0\u6b64\u5e94\u5c06\u5b83\u4eec\u5206\u79bb\u5230\u591a\u4e2a EC2 Auto Scaling \u7ec4\u4e2d\u3002</p> <p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u6709\u4e00\u4e2a\u6269\u5c55\u5668\u7684\u6982\u5ff5\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u7b56\u7565\u6765\u9009\u62e9\u8981\u6269\u7f29\u7684\u8282\u70b9\u7ec4\u3002<code>--expander=least-waste</code> \u7b56\u7565\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u901a\u7528\u9ed8\u8ba4\u503c\uff0c\u5982\u679c\u60a8\u8981\u4e3a Spot \u5b9e\u4f8b\u591a\u6837\u6027\u4f7f\u7528\u591a\u4e2a\u8282\u70b9\u7ec4 (\u5982\u4e0a\u56fe\u6240\u793a)\uff0c\u5b83\u53ef\u4ee5\u8fdb\u4e00\u6b65\u4f18\u5316\u8282\u70b9\u7ec4\u7684\u6210\u672c\uff0c\u901a\u8fc7\u6269\u7f29\u5728\u6269\u7f29\u6d3b\u52a8\u540e\u5229\u7528\u7387\u6700\u9ad8\u7684\u7ec4\u3002</p>"},{"location":"zh/cluster-autoscaling/#asg","title":"\u4f18\u5148\u6269\u7f29\u8282\u70b9\u7ec4/ASG","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 Priority \u6269\u5c55\u5668\u914d\u7f6e\u57fa\u4e8e\u4f18\u5148\u7ea7\u7684\u81ea\u52a8\u6269\u7f29\u3002<code>--expander=priority</code> \u4f7f\u60a8\u7684\u96c6\u7fa4\u80fd\u591f\u4f18\u5148\u6269\u7f29\u4e00\u4e2a\u8282\u70b9\u7ec4/ASG,\u5982\u679c\u7531\u4e8e\u4efb\u4f55\u539f\u56e0\u65e0\u6cd5\u6269\u7f29\uff0c\u5b83\u5c06\u9009\u62e9\u4f18\u5148\u7ea7\u5217\u8868\u4e2d\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\u7ec4\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5f88\u6709\u7528\uff0c\u4f8b\u5982\uff0c\u60a8\u5e0c\u671b\u4f7f\u7528 P3 \u5b9e\u4f8b\u7c7b\u578b\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684 GPU \u4e3a\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u4e86\u6700\u4f73\u6027\u80fd\uff0c\u4f46\u4f5c\u4e3a\u7b2c\u4e8c\u9009\u62e9\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528 P2 \u5b9e\u4f8b\u7c7b\u578b\u3002</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cluster-autoscaler-priority-expander\n  namespace: kube-system\ndata:\n  priorities: |-\n    10:\n      - .*p2-node-group.*\n    50:\n      - .*p3-node-group.*\n</code></pre> <p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5c06\u5c1d\u8bd5\u6269\u7f29\u4e0e\u540d\u79f0 p3-node-group \u5339\u914d\u7684 EC2 Auto Scaling \u7ec4\u3002\u5982\u679c\u5728 <code>--max-node-provision-time</code> \u5185\u6b64\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u5b83\u5c06\u5c1d\u8bd5\u6269\u7f29\u4e0e\u540d\u79f0 p2-node-group \u5339\u914d\u7684 EC2 Auto Scaling \u7ec4\u3002 \u6b64\u503c\u9ed8\u8ba4\u4e3a 15 \u5206\u949f\uff0c\u53ef\u4ee5\u7f29\u77ed\u4ee5\u83b7\u5f97\u66f4\u54cd\u5e94\u7684\u8282\u70b9\u7ec4\u9009\u62e9\uff0c\u4f46\u5982\u679c\u503c\u592a\u4f4e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e0d\u5fc5\u8981\u7684\u6269\u7f29\u3002</p>"},{"location":"zh/cluster-autoscaling/#_11","title":"\u8fc7\u5ea6\u914d\u7f6e","text":"<p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u901a\u8fc7\u786e\u4fdd\u53ea\u5728\u9700\u8981\u65f6\u624d\u5411\u96c6\u7fa4\u6dfb\u52a0\u8282\u70b9\uff0c\u5e76\u5728\u672a\u4f7f\u7528\u65f6\u5c06\u5176\u5220\u9664\uff0c\u4ece\u800c\u6700\u5c0f\u5316\u6210\u672c\u3002\u8fd9\u4e25\u91cd\u5f71\u54cd\u4e86\u90e8\u7f72\u5ef6\u8fdf\uff0c\u56e0\u4e3a\u8bb8\u591a Pod \u5c06\u88ab\u8feb\u7b49\u5f85\u8282\u70b9\u6269\u7f29\u624d\u80fd\u88ab\u8c03\u5ea6\u3002\u8282\u70b9\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f\u624d\u80fd\u53ef\u7528\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5c06 Pod \u8c03\u5ea6\u5ef6\u8fdf\u589e\u52a0\u4e00\u4e2a\u6570\u91cf\u7ea7\u3002</p> <p>\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u8fc7\u5ea6\u914d\u7f6e\u6765\u7f13\u89e3\uff0c\u4ee5\u6210\u672c\u6362\u53d6\u8c03\u5ea6\u5ef6\u8fdf\u3002\u8fc7\u5ea6\u914d\u7f6e\u662f\u4f7f\u7528\u5177\u6709\u8d1f\u4f18\u5148\u7ea7\u7684\u4e34\u65f6 Pod \u5b9e\u73b0\u7684\uff0c\u8fd9\u4e9b Pod \u5360\u7528\u96c6\u7fa4\u4e2d\u7684\u7a7a\u95f4\u3002\u5f53\u65b0\u521b\u5efa\u7684 Pod \u65e0\u6cd5\u8c03\u5ea6\u4e14\u5177\u6709\u66f4\u9ad8\u4f18\u5148\u7ea7\u65f6\uff0c\u4e34\u65f6 Pod \u5c06\u88ab\u62a2\u5360\u4ee5\u817e\u51fa\u7a7a\u95f4\u3002\u7136\u540e\uff0c\u8fd9\u4e9b\u4e34\u65f6 Pod \u5c06\u53d8\u4e3a\u65e0\u6cd5\u8c03\u5ea6\uff0c\u4ece\u800c\u89e6\u53d1\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u6269\u7f29\u65b0\u7684\u8fc7\u5ea6\u914d\u7f6e\u8282\u70b9\u3002</p> <p>\u8fc7\u5ea6\u914d\u7f6e\u8fd8\u6709\u5176\u4ed6\u4e0d\u592a\u660e\u663e\u7684\u597d\u5904\u3002\u5982\u679c\u6ca1\u6709\u8fc7\u5ea6\u914d\u7f6e\uff0c\u9ad8\u5ea6\u5229\u7528\u7684\u96c6\u7fa4\u7684\u4e00\u4e2a\u526f\u4f5c\u7528\u662f Pod \u5c06\u6839\u636e Pod \u6216\u8282\u70b9\u4eb2\u548c\u6027\u7684 <code>preferredDuringSchedulingIgnoredDuringExecution</code> \u89c4\u5219\u505a\u51fa\u4e0d\u592a\u7406\u60f3\u7684\u8c03\u5ea6\u51b3\u7b56\u3002\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u4f8b\u662f\u4f7f\u7528\u53cd\u4eb2\u548c\u6027\u5c06\u9ad8\u53ef\u7528\u5e94\u7528\u7a0b\u5e8f\u7684 Pod \u5206\u79bb\u5230\u4e0d\u540c\u7684\u53ef\u7528\u533a\u3002\u8fc7\u5ea6\u914d\u7f6e\u53ef\u4ee5\u663e\u8457\u589e\u52a0\u6b63\u786e\u533a\u57df\u7684\u8282\u70b9\u53ef\u7528\u7684\u673a\u4f1a\u3002</p> <p>\u60a8\u7ec4\u7ec7\u7684\u8fc7\u5ea6\u914d\u7f6e\u5bb9\u91cf\u91cf\u662f\u4e00\u4e2a\u8c28\u614e\u7684\u4e1a\u52a1\u51b3\u7b56\u3002\u4ece\u672c\u8d28\u4e0a\u8bb2\uff0c\u8fd9\u662f\u6027\u80fd\u548c\u6210\u672c\u4e4b\u95f4\u7684\u6743\u8861\u3002\u505a\u51fa\u8fd9\u4e2a\u51b3\u5b9a\u7684\u4e00\u79cd\u65b9\u5f0f\u662f\u786e\u5b9a\u60a8\u7684\u5e73\u5747\u6269\u7f29\u9891\u7387\uff0c\u7136\u540e\u9664\u4ee5\u6269\u7f29\u65b0\u8282\u70b9\u6240\u9700\u7684\u65f6\u95f4\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5e73\u5747\u6bcf 30 \u79d2\u9700\u8981\u4e00\u4e2a\u65b0\u8282\u70b9\uff0c\u800c EC2 \u9700\u8981 30 \u79d2\u6765\u914d\u7f6e\u4e00\u4e2a\u65b0\u8282\u70b9\uff0c\u5219\u5355\u4e2a\u8282\u70b9\u7684\u8fc7\u5ea6\u914d\u7f6e\u5c06\u786e\u4fdd\u603b\u6709\u4e00\u4e2a\u989d\u5916\u7684\u8282\u70b9\u53ef\u7528\uff0c\u4ece\u800c\u5c06\u8c03\u5ea6\u5ef6\u8fdf\u51cf\u5c11 30 \u79d2\uff0c\u4ee3\u4ef7\u662f\u4e00\u4e2a\u989d\u5916\u7684 EC2 \u5b9e\u4f8b\u3002\u4e3a\u4e86\u6539\u5584\u533a\u57df\u8c03\u5ea6\u51b3\u7b56\uff0c\u8bf7\u8fc7\u5ea6\u914d\u7f6e\u4e0e EC2 Auto Scaling \u7ec4\u4e2d\u53ef\u7528\u533a\u6570\u91cf\u76f8\u7b49\u7684\u8282\u70b9\u6570\uff0c\u4ee5\u786e\u4fdd\u8c03\u5ea6\u7a0b\u5e8f\u53ef\u4ee5\u4e3a\u4f20\u5165\u7684 Pod \u9009\u62e9\u6700\u4f73\u533a\u57df\u3002</p>"},{"location":"zh/cluster-autoscaling/#_12","title":"\u9632\u6b62\u7f29\u51cf\u9a71\u9010","text":"<p>\u67d0\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u9a71\u9010\u6210\u672c\u5f88\u9ad8\u3002\u5927\u6570\u636e\u5206\u6790\u3001\u673a\u5668\u5b66\u4e60\u4efb\u52a1\u548c\u6d4b\u8bd5\u8fd0\u884c\u5668\u6700\u7ec8\u4f1a\u5b8c\u6210\uff0c\u4f46\u5982\u679c\u4e2d\u65ad\uff0c\u5fc5\u987b\u91cd\u65b0\u542f\u52a8\u3002\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5c06\u5c1d\u8bd5\u7f29\u51cf\u5229\u7528\u7387\u4f4e\u4e8e <code>scale-down-utilization-threshold</code> \u7684\u4efb\u4f55\u8282\u70b9\uff0c\u8fd9\u5c06\u4e2d\u65ad\u8be5\u8282\u70b9\u4e0a\u7684\u4efb\u4f55\u5269\u4f59 Pod\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u786e\u4fdd\u6602\u8d35\u7684\u65e0\u6cd5\u9a71\u9010\u7684 Pod \u7531\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u8bc6\u522b\u7684\u6807\u7b7e\u4fdd\u62a4\u6765\u9632\u6b62\u3002</p> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u6602\u8d35\u7684\u65e0\u6cd5\u9a71\u9010\u7684 Pod \u5177\u6709\u6ce8\u89e3 <code>cluster-autoscaler.kubernetes.io/safe-to-evict=false</code></li> </ul>"},{"location":"zh/cluster-autoscaling/#_13","title":"\u9ad8\u7ea7\u7528\u4f8b","text":""},{"location":"zh/cluster-autoscaling/#ebs","title":"EBS \u5377","text":"<p>\u6301\u4e45\u5b58\u50a8\u5bf9\u4e8e\u6784\u5efa\u6709\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f (\u5982\u6570\u636e\u5e93\u6216\u5206\u5e03\u5f0f\u7f13\u5b58) \u81f3\u5173\u91cd\u8981\u3002EBS \u5377\u652f\u6301\u5728 Kubernetes \u4e0a\u5b9e\u73b0\u6b64\u7528\u4f8b\uff0c\u4f46\u53d7\u9650\u4e8e\u7279\u5b9a\u533a\u57df\u3002\u5982\u679c\u4f7f\u7528\u5355\u72ec\u7684 EBS \u5377\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u5206\u7247\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\uff0c\u5219\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027\u3002\u7136\u540e\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u53ef\u4ee5\u5e73\u8861 EC2 Auto Scaling \u7ec4\u7684\u6269\u7f29\u3002</p> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u901a\u8fc7\u8bbe\u7f6e <code>balance-similar-node-groups=true</code> \u542f\u7528\u8282\u70b9\u7ec4\u5e73\u8861\u3002</li> <li>\u9664\u4e86\u4e0d\u540c\u7684\u53ef\u7528\u533a\u548c EBS \u5377\u5916\uff0c\u8282\u70b9\u7ec4\u914d\u7f6e\u76f8\u540c\u3002</li> </ul>"},{"location":"zh/cluster-autoscaling/#_14","title":"\u534f\u540c\u8c03\u5ea6","text":"<p>\u673a\u5668\u5b66\u4e60\u5206\u5e03\u5f0f\u8bad\u7ec3\u4f5c\u4e1a\u53ef\u4ee5\u4ece\u540c\u533a\u57df\u8282\u70b9\u914d\u7f6e\u7684\u6700\u5c0f\u5316\u5ef6\u8fdf\u4e2d\u83b7\u5f97\u663e\u8457\u597d\u5904\u3002\u8fd9\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u5c06\u591a\u4e2a Pod \u90e8\u7f72\u5230\u7279\u5b9a\u533a\u57df\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4e3a\u6240\u6709\u534f\u540c\u8c03\u5ea6\u7684 Pod \u8bbe\u7f6e Pod \u4eb2\u548c\u6027\u6216\u4f7f\u7528 <code>topologyKey: failure-domain.beta.kubernetes.io/zone</code> \u7684\u8282\u70b9\u4eb2\u548c\u6027\u6765\u5b9e\u73b0\u3002\u7136\u540e\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5c06\u6269\u7f29\u7279\u5b9a\u533a\u57df\u4ee5\u6ee1\u8db3\u9700\u6c42\u3002\u60a8\u53ef\u80fd\u5e0c\u671b\u4e3a\u6bcf\u4e2a\u53ef\u7528\u533a\u5206\u914d\u591a\u4e2a EC2 Auto Scaling \u7ec4\uff0c\u4ee5\u5b9e\u73b0\u6574\u4e2a\u534f\u540c\u8c03\u5ea6\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6545\u969c\u8f6c\u79fb\u3002</p> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u901a\u8fc7\u8bbe\u7f6e <code>balance-similar-node-groups=false</code> \u7981\u7528\u8282\u70b9\u7ec4\u5e73\u8861</li> <li>\u5f53\u96c6\u7fa4\u5305\u542b\u533a\u57df\u548c\u533a\u57df\u8282\u70b9\u7ec4\u65f6\uff0c\u4f7f\u7528\u8282\u70b9\u4eb2\u548c\u6027\u548c/\u6216Pod\u62a2\u5360\u3002</li> <li>\u4f7f\u7528\u8282\u70b9\u4eb2\u548c\u6027\u5f3a\u5236\u6216\u9f13\u52b1\u533a\u57df Pod \u907f\u5f00\u533a\u57df\u8282\u70b9\u7ec4\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002</li> <li>\u5982\u679c\u533a\u57df Pod \u8c03\u5ea6\u5230\u533a\u57df\u8282\u70b9\u7ec4\uff0c\u8fd9\u5c06\u5bfc\u81f4\u60a8\u7684\u533a\u57df Pod \u5bb9\u91cf\u4e0d\u5e73\u8861\u3002</li> <li>\u5982\u679c\u60a8\u7684\u533a\u57df\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u4ee5\u5bb9\u5fcd\u4e2d\u65ad\u548c\u91cd\u65b0\u8c03\u5ea6\uff0c\u8bf7\u914d\u7f6ePod\u62a2\u5360,\u4ee5\u4f7f\u533a\u57df\u6269\u7f29\u7684 Pod \u80fd\u591f\u5f3a\u5236\u62a2\u5360\u548c\u91cd\u65b0\u8c03\u5ea6\u5230\u7ade\u4e89\u8f83\u5c11\u7684\u533a\u57df\u3002</li> </ul>"},{"location":"zh/cluster-autoscaling/#_15","title":"\u52a0\u901f\u5668","text":"<p>\u67d0\u4e9b\u96c6\u7fa4\u5229\u7528\u4e86\u8bf8\u5982 GPU \u4e4b\u7c7b\u7684\u4e13\u7528\u786c\u4ef6\u52a0\u901f\u5668\u3002\u5728\u6269\u7f29\u65f6\uff0c\u52a0\u901f\u5668\u8bbe\u5907\u63d2\u4ef6\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f\u624d\u80fd\u5411\u96c6\u7fa4\u516c\u5e03\u8d44\u6e90\u3002\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5df2\u6a21\u62df\u8be5\u8282\u70b9\u5c06\u5177\u6709\u52a0\u901f\u5668\uff0c\u4f46\u5728\u52a0\u901f\u5668\u51c6\u5907\u5c31\u7eea\u5e76\u66f4\u65b0\u8282\u70b9\u7684\u53ef\u7528\u8d44\u6e90\u4e4b\u524d\uff0c\u5f85\u5904\u7406\u7684 Pod \u65e0\u6cd5\u5728\u8be5\u8282\u70b9\u4e0a\u8c03\u5ea6\u3002\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u91cd\u590d\u4e0d\u5fc5\u8981\u7684\u6269\u7f29\u3002</p> <p>\u6b64\u5916\uff0c\u5373\u4f7f\u52a0\u901f\u5668\u672a\u88ab\u4f7f\u7528\uff0c\u5177\u6709\u52a0\u901f\u5668\u548c\u9ad8 CPU \u6216\u5185\u5b58\u5229\u7528\u7387\u7684\u8282\u70b9\u4e5f\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u7f29\u51cf\u5bf9\u8c61\u3002\u7531\u4e8e\u52a0\u901f\u5668\u7684\u76f8\u5bf9\u6210\u672c\uff0c\u8fd9\u79cd\u884c\u4e3a\u53ef\u80fd\u4f1a\u5f88\u6602\u8d35\u3002\u76f8\u53cd\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u53ef\u4ee5\u5e94\u7528\u7279\u6b8a\u89c4\u5219\uff0c\u5982\u679c\u52a0\u901f\u5668\u672a\u88ab\u5360\u7528\uff0c\u5219\u5c06\u8282\u70b9\u89c6\u4e3a\u7f29\u51cf\u5bf9\u8c61\u3002</p> <p>\u4e3a\u786e\u4fdd\u8fd9\u4e9b\u60c5\u51b5\u7684\u6b63\u786e\u884c\u4e3a\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u52a0\u901f\u5668\u8282\u70b9\u4e0a\u7684 kubelet \u5728\u52a0\u5165\u96c6\u7fa4\u4e4b\u524d\u6807\u8bb0\u8282\u70b9\u3002\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5c06\u4f7f\u7528\u6b64\u6807\u7b7e\u9009\u62e9\u5668\u89e6\u53d1\u52a0\u901f\u5668\u4f18\u5316\u884c\u4e3a\u3002</p> <p>\u786e\u4fdd\uff1a</p> <ul> <li>\u914d\u7f6e GPU \u8282\u70b9\u7684 Kubelet \u4f7f\u7528 <code>--node-labels k8s.amazonaws.com/accelerator=$ACCELERATOR_TYPE</code></li> <li>\u5177\u6709\u52a0\u901f\u5668\u7684\u8282\u70b9\u9075\u5b88\u4e0a\u8ff0\u76f8\u540c\u7684\u8c03\u5ea6\u5c5e\u6027\u89c4\u5219\u3002</li> </ul>"},{"location":"zh/cluster-autoscaling/#0","title":"\u4ece 0 \u6269\u7f29","text":"<p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u80fd\u591f\u5c06\u8282\u70b9\u7ec4\u6269\u7f29\u5230 0\uff0c\u4ece\u800c\u53ef\u4ee5\u8282\u7701\u5927\u91cf\u6210\u672c\u3002\u5b83\u901a\u8fc7\u68c0\u67e5 Auto Scaling \u7ec4\u7684 LaunchConfiguration \u6216 LaunchTemplate \u4e2d\u6307\u5b9a\u7684\u5b9e\u4f8b\u7c7b\u578b\u6765\u68c0\u6d4b CPU\u3001\u5185\u5b58\u548c GPU \u8d44\u6e90\u3002\u67d0\u4e9b Pod \u9700\u8981\u5176\u4ed6\u8d44\u6e90\uff0c\u5982 <code>WindowsENI</code> \u6216 <code>PrivateIPv4Address</code>,\u6216\u7279\u5b9a\u7684 NodeSelectors \u6216 Taints\uff0c\u8fd9\u4e9b\u8d44\u6e90\u65e0\u6cd5\u4ece LaunchConfiguration \u4e2d\u53d1\u73b0\u3002\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u53ef\u4ee5\u901a\u8fc7\u4ece EC2 Auto Scaling \u7ec4\u4e0a\u7684\u6807\u7b7e\u53d1\u73b0\u8fd9\u4e9b\u56e0\u7d20\u6765\u8003\u8651\u8fd9\u4e9b\u56e0\u7d20\u3002\u4f8b\u5982\uff1a</p> <pre><code>Key: k8s.io/cluster-autoscaler/node-template/resources/$RESOURCE_NAME\nValue: 5\nKey: k8s.io/cluster-autoscaler/node-template/label/$LABEL_KEY\nValue: $LABEL_VALUE\nKey: k8s.io/cluster-autoscaler/node-template/taint/$TAINT_KEY\nValue: NoSchedule\n</code></pre> <p>\u6ce8\u610f\uff1a\u8bf7\u8bb0\u4f4f\uff0c\u5f53\u6269\u7f29\u5230\u96f6\u65f6\uff0c\u60a8\u7684\u5bb9\u91cf\u5c06\u8fd4\u56de\u7ed9 EC2\uff0c\u5c06\u6765\u53ef\u80fd\u65e0\u6cd5\u4f7f\u7528\u3002</p>"},{"location":"zh/cluster-autoscaling/#_16","title":"\u5176\u4ed6\u53c2\u6570","text":"<p>\u6709\u8bb8\u591a\u914d\u7f6e\u9009\u9879\u53ef\u7528\u4e8e\u8c03\u6574\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684\u884c\u4e3a\u548c\u6027\u80fd\u3002 \u5b8c\u6574\u7684\u53c2\u6570\u5217\u8868\u53ef\u5728 GitHub \u4e0a\u627e\u5230\u3002</p> \u53c2\u6570 \u63cf\u8ff0 \u9ed8\u8ba4\u503c scan-interval \u96c6\u7fa4\u91cd\u65b0\u8bc4\u4f30\u6269\u7f29\u7684\u9891\u7387 10 \u79d2 max-empty-bulk-delete \u540c\u65f6\u53ef\u5220\u9664\u7684\u6700\u5927\u7a7a\u8282\u70b9\u6570 10 scale-down-delay-after-add \u6269\u7f29\u540e\u6062\u590d\u7f29\u51cf\u8bc4\u4f30\u7684\u65f6\u95f4 10 \u5206\u949f scale-down-delay-after-delete \u8282\u70b9\u5220\u9664\u540e\u6062\u590d\u7f29\u51cf\u8bc4\u4f30\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a\u626b\u63cf\u95f4\u9694 \u626b\u63cf\u95f4\u9694 scale-down-delay-after-failure \u7f29\u51cf\u5931\u8d25\u540e\u6062\u590d\u7f29\u51cf\u8bc4\u4f30\u7684\u65f6\u95f4 3 \u5206\u949f scale-down-unneeded-time \u8282\u70b9\u88ab\u89c6\u4e3a\u4e0d\u9700\u8981\u4e4b\u524d\u7684\u65f6\u95f4\uff0c\u624d\u6709\u8d44\u683c\u7f29\u51cf 10 \u5206\u949f scale-down-unready-time \u672a\u5c31\u7eea\u8282\u70b9\u88ab\u89c6\u4e3a\u4e0d\u9700\u8981\u4e4b\u524d\u7684\u65f6\u95f4\uff0c\u624d\u6709\u8d44\u683c\u7f29\u51cf 20 \u5206\u949f scale-down-utilization-threshold \u8282\u70b9\u5229\u7528\u7387\u7ea7\u522b\uff0c\u5b9a\u4e49\u4e3a\u8bf7\u6c42\u8d44\u6e90\u4e4b\u548c\u9664\u4ee5\u5bb9\u91cf\uff0c\u4f4e\u4e8e\u6b64\u503c\u7684\u8282\u70b9\u53ef\u88ab\u89c6\u4e3a\u7f29\u51cf\u5bf9\u8c61 0.5 scale-down-non-empty-candidates-count \u5728\u4e00\u6b21\u8fed\u4ee3\u4e2d\u4f5c\u4e3a\u7f29\u51cf\u5019\u9009\u5bf9\u8c61\u7684\u975e\u7a7a\u8282\u70b9\u7684\u6700\u5927\u6570\u91cf\u3002\u8f83\u4f4e\u7684\u503c\u610f\u5473\u7740\u66f4\u597d\u7684 CA \u54cd\u5e94\u80fd\u529b\uff0c\u4f46\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8f83\u6162\u7684\u7f29\u51cf\u5ef6\u8fdf\u3002\u5bf9\u4e8e\u5927\u578b\u96c6\u7fa4 (\u6570\u767e\u4e2a\u8282\u70b9)\uff0c\u8f83\u9ad8\u7684\u503c\u53ef\u80fd\u4f1a\u5f71\u54cd CA \u6027\u80fd\u3002\u5c06\u5176\u8bbe\u7f6e\u4e3a\u975e\u6b63\u503c\u4ee5\u5173\u95ed\u6b64\u542f\u53d1\u5f0f\u7b97\u6cd5 - CA \u5c06\u4e0d\u4f1a\u9650\u5236\u5b83\u8003\u8651\u7684\u8282\u70b9\u6570\u91cf\u3002\" 30 scale-down-candidates-pool-ratio \u5f53\u524d\u8fed\u4ee3\u4e2d\u67d0\u4e9b\u5019\u9009\u5bf9\u8c61\u4e0d\u518d\u6709\u6548\u65f6\uff0c\u4f5c\u4e3a\u989d\u5916\u975e\u7a7a\u7f29\u51cf\u5019\u9009\u5bf9\u8c61\u8003\u8651\u7684\u8282\u70b9\u6bd4\u7387\u3002\u8f83\u4f4e\u7684\u503c\u610f\u5473\u7740\u66f4\u597d\u7684 CA \u54cd\u5e94\u80fd\u529b\uff0c\u4f46\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8f83\u6162\u7684\u7f29\u51cf\u5ef6\u8fdf\u3002\u5bf9\u4e8e\u5927\u578b\u96c6\u7fa4 (\u6570\u767e\u4e2a\u8282\u70b9)\uff0c\u8f83\u9ad8\u7684\u503c\u53ef\u80fd\u4f1a\u5f71\u54cd CA \u6027\u80fd\u3002\u5c06\u5176\u8bbe\u7f6e\u4e3a 1.0 \u4ee5\u5173\u95ed\u6b64\u542f\u53d1\u5f0f\u7b97\u6cd5 - CA \u5c06\u628a\u6240\u6709\u8282\u70b9\u89c6\u4e3a\u989d\u5916\u5019\u9009\u5bf9\u8c61\u3002 0.1 scale-down-candidates-pool-min-count \u5f53\u524d\u8fed\u4ee3\u4e2d\u67d0\u4e9b\u5019\u9009\u5bf9\u8c61\u4e0d\u518d\u6709\u6548\u65f6\uff0c\u4f5c\u4e3a\u989d\u5916\u975e\u7a7a\u7f29\u51cf\u5019\u9009\u5bf9\u8c61\u8003\u8651\u7684\u6700\u5c0f\u8282\u70b9\u6570\u3002\u5728\u8ba1\u7b97\u989d\u5916\u5019\u9009\u5bf9\u8c61\u7684\u6c60\u5927\u5c0f\u65f6\uff0c\u6211\u4eec\u53d6 <code>max(#nodes * scale-down-candidates-pool-ratio, scale-down-candidates-pool-min-count)</code> 50"},{"location":"zh/cluster-autoscaling/#_17","title":"\u5176\u4ed6\u8d44\u6e90","text":"<p>\u672c\u9875\u9762\u5305\u542b\u4e86\u4e00\u7cfb\u5217\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u6f14\u793a\u6587\u7a3f\u548c\u6f14\u793a\u3002\u5982\u679c\u60a8\u60f3\u5728\u6b64\u5904\u6dfb\u52a0\u6f14\u793a\u6587\u7a3f\u6216\u6f14\u793a\uff0c\u8bf7\u53d1\u9001\u62c9\u53d6\u8bf7\u6c42\u3002</p> \u6f14\u793a\u6587\u7a3f/\u6f14\u793a \u6f14\u8bb2\u8005 Autoscaling and Cost Optimization on Kubernetes: From 0 to 100 Guy Templeton, Skyscanner &amp; Jiaxin Shan, Amazon SIG-Autoscaling Deep Dive Maciek Pytel &amp; Marcin Wielgus"},{"location":"zh/cluster-autoscaling/#_18","title":"\u53c2\u8003","text":"<ul> <li>https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md</li> <li>https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/aws/README.md</li> <li>https://github.com/aws/amazon-ec2-instance-selector</li> <li>https://github.com/aws/aws-node-termination-handler</li> </ul>"},{"location":"zh/cost_optimization/awareness/","title":"\u652f\u51fa\u610f\u8bc6","text":"<p>\u652f\u51fa\u610f\u8bc6\u662f\u4e86\u89e3\u5728\u60a8\u7684 EKS \u96c6\u7fa4\u4e2d\u8c01\u3001\u5728\u54ea\u91cc\u4ee5\u53ca\u4ec0\u4e48\u539f\u56e0\u5bfc\u81f4\u4e86\u652f\u51fa\u3002\u83b7\u5f97\u8fd9\u4e9b\u6570\u636e\u7684\u51c6\u786e\u60c5\u51b5\u5c06\u6709\u52a9\u4e8e\u63d0\u9ad8\u60a8\u5bf9\u652f\u51fa\u7684\u610f\u8bc6\uff0c\u5e76\u7a81\u51fa\u9700\u8981\u8865\u6551\u7684\u9886\u57df\u3002</p>"},{"location":"zh/cost_optimization/awareness/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/cost_optimization/awareness/#_3","title":"\u4f7f\u7528\u6210\u672c\u8d44\u6e90\u7ba1\u7406\u5668","text":"<p>AWS \u6210\u672c\u8d44\u6e90\u7ba1\u7406\u5668\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6613\u4e8e\u4f7f\u7528\u7684\u754c\u9762\uff0c\u8ba9\u60a8\u53ef\u4ee5\u968f\u65f6\u4e86\u89e3\u548c\u7ba1\u7406\u60a8\u7684 AWS \u6210\u672c\u548c\u4f7f\u7528\u60c5\u51b5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6210\u672c\u8d44\u6e90\u7ba1\u7406\u5668\u4e2d\u63d0\u4f9b\u7684\u8fc7\u6ee4\u5668\uff0c\u5728\u5404\u4e2a\u7ea7\u522b\u5206\u6790\u6210\u672c\u548c\u4f7f\u7528\u6570\u636e\u3002</p>"},{"location":"zh/cost_optimization/awareness/#eks-eks-fargate","title":"EKS \u63a7\u5236\u5e73\u9762\u548c EKS Fargate \u6210\u672c","text":"<p>\u4f7f\u7528\u8fc7\u6ee4\u5668\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u8be2\u5982\u4e0b\u56fe\u6240\u793a\u7684 EKS \u63a7\u5236\u5e73\u9762\u548c Fargate Pod \u4ea7\u751f\u7684\u6210\u672c\uff1a</p> <p></p> <p>\u4f7f\u7528\u8fc7\u6ee4\u5668\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u8be2\u5982\u4e0b\u56fe\u6240\u793a\u7684 EKS \u4e2d\u8de8\u533a\u57df Fargate Pod \u4ea7\u751f\u7684\u603b\u6210\u672c - \u5305\u62ec\u6bcf CPU \u7684 vCPU \u5c0f\u65f6\u548c GB \u5c0f\u65f6\uff1a</p> <p></p>"},{"location":"zh/cost_optimization/awareness/#_4","title":"\u8d44\u6e90\u6807\u8bb0","text":"<p>Amazon EKS \u652f\u6301\u4e3a Amazon EKS \u96c6\u7fa4\u6dfb\u52a0 AWS \u6807\u7b7e\u3002\u8fd9\u4f7f\u5f97\u63a7\u5236\u5bf9 EKS API \u7684\u8bbf\u95ee\u4ee5\u7ba1\u7406\u96c6\u7fa4\u53d8\u5f97\u5f88\u5bb9\u6613\u3002\u6dfb\u52a0\u5230 EKS \u96c6\u7fa4\u7684\u6807\u7b7e\u4ec5\u7279\u5b9a\u4e8e AWS EKS \u96c6\u7fa4\u8d44\u6e90\uff0c\u5b83\u4eec\u4e0d\u4f1a\u4f20\u64ad\u5230\u96c6\u7fa4\u4f7f\u7528\u7684\u5176\u4ed6 AWS \u8d44\u6e90\uff0c\u5982 EC2 \u5b9e\u4f8b\u6216\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u76ee\u524d\uff0c\u901a\u8fc7 AWS API\u3001\u63a7\u5236\u53f0\u548c SDK \u652f\u6301\u4e3a\u6240\u6709\u65b0\u7684\u548c\u73b0\u6709\u7684 EKS \u96c6\u7fa4\u6dfb\u52a0\u96c6\u7fa4\u6807\u8bb0\u3002</p> <p>AWS Fargate \u662f\u4e00\u79cd\u4e3a\u5bb9\u5668\u63d0\u4f9b\u6309\u9700\u3001\u5408\u9002\u5927\u5c0f\u7684\u8ba1\u7b97\u5bb9\u91cf\u7684\u6280\u672f\u3002\u5728\u60a8\u53ef\u4ee5\u5728\u96c6\u7fa4\u4e2d\u8c03\u5ea6 Fargate \u4e0a\u7684 Pod \u4e4b\u524d\uff0c\u60a8\u5fc5\u987b\u5b9a\u4e49\u81f3\u5c11\u4e00\u4e2a Fargate \u914d\u7f6e\u6587\u4ef6\uff0c\u8be5\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u5728\u542f\u52a8\u65f6\u54ea\u4e9b Pod \u5e94\u4f7f\u7528 Fargate\u3002</p> <p>\u5411 EKS \u96c6\u7fa4\u6dfb\u52a0\u548c\u5217\u51fa\u6807\u7b7e\uff1a <pre><code>$ aws eks tag-resource --resource-arn arn:aws:eks:us-west-2:xxx:cluster/ekscluster1 --tags team=devops,env=staging,bu=cio,costcenter=1234\n$ aws eks list-tags-for-resource --resource-arn arn:aws:eks:us-west-2:xxx:cluster/ekscluster1\n{\n    \"tags\": {\n        \"bu\": \"cio\",\n        \"env\": \"staging\",\n        \"costcenter\": \"1234\",\n        \"team\": \"devops\"\n    }\n}\n</code></pre> \u5728\u60a8\u5728 AWS \u6210\u672c\u8d44\u6e90\u7ba1\u7406\u5668\u4e2d\u6fc0\u6d3b\u6210\u672c\u5206\u914d\u6807\u7b7e\u540e\uff0cAWS \u4f1a\u4f7f\u7528\u6210\u672c\u5206\u914d\u6807\u7b7e\u6765\u7ec4\u7ec7\u60a8\u7684\u8d44\u6e90\u6210\u672c\uff0c\u4ee5\u4fbf\u60a8\u66f4\u5bb9\u6613\u5728\u6210\u672c\u5206\u914d\u62a5\u544a\u4e2d\u5bf9 AWS \u6210\u672c\u8fdb\u884c\u5206\u7c7b\u548c\u8ddf\u8e2a\u3002</p> <p>\u6807\u7b7e\u5bf9 Amazon EKS \u6ca1\u6709\u4efb\u4f55\u8bed\u4e49\u542b\u4e49\uff0c\u5e76\u88ab\u4e25\u683c\u89e3\u91ca\u4e3a\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4e3a Amazon EKS \u96c6\u7fa4\u5b9a\u4e49\u4e00\u7ec4\u6807\u7b7e\uff0c\u4ee5\u5e2e\u52a9\u60a8\u8ddf\u8e2a\u6bcf\u4e2a\u96c6\u7fa4\u7684\u6240\u6709\u8005\u548c\u5806\u6808\u7ea7\u522b\u3002</p>"},{"location":"zh/cost_optimization/awareness/#aws-trusted-advisor","title":"\u4f7f\u7528 AWS Trusted Advisor","text":"<p>AWS Trusted Advisor \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u6700\u4f73\u5b9e\u8df5\u68c0\u67e5\u548c\u5efa\u8bae\uff0c\u6db5\u76d6\u4e94\u4e2a\u7c7b\u522b\uff1a\u6210\u672c\u4f18\u5316\u3001\u5b89\u5168\u6027\u3001\u5bb9\u9519\u80fd\u529b\u3001\u6027\u80fd\u548c\u670d\u52a1\u9650\u5236\u3002</p> <p>\u5bf9\u4e8e\u6210\u672c\u4f18\u5316\uff0cTrusted Advisor \u6709\u52a9\u4e8e\u6d88\u9664\u672a\u4f7f\u7528\u548c\u7a7a\u95f2\u7684\u8d44\u6e90\uff0c\u5e76\u5efa\u8bae\u5bf9\u9884\u7559\u5bb9\u91cf\u8fdb\u884c\u627f\u8bfa\u3002\u5bf9\u4e8e Amazon EKS \u5c06\u6709\u52a9\u4e8e\u7684\u5173\u952e\u64cd\u4f5c\u9879\u5305\u62ec\u4f4e\u5229\u7528\u7387 EC2 \u5b9e\u4f8b\u3001\u672a\u5173\u8054\u7684\u5f39\u6027 IP \u5730\u5740\u3001\u7a7a\u95f2\u8d1f\u8f7d\u5747\u8861\u5668\u3001\u4f4e\u5229\u7528\u7387 EBS \u5377\u7b49\u3002\u5b8c\u6574\u7684\u68c0\u67e5\u5217\u8868\u53ef\u5728 https://aws.amazon.com/premiumsupport/technology/trusted-advisor/best-practice-checklist/ \u4e0a\u627e\u5230\u3002</p> <p>Trusted Advisor \u8fd8\u4e3a EC2 \u5b9e\u4f8b\u548c Fargate \u63d0\u4f9b\u4e86\u8282\u7701\u8ba1\u5212\u548c\u9884\u7559\u5b9e\u4f8b\u5efa\u8bae\uff0c\u5141\u8bb8\u60a8\u627f\u8bfa\u4e00\u81f4\u7684\u4f7f\u7528\u91cf\u4ee5\u6362\u53d6\u6298\u6263\u4ef7\u683c\u3002</p> <p>\u6ce8\u610f</p> <p>Trusted Advisor \u7684\u5efa\u8bae\u662f\u901a\u7528\u5efa\u8bae\uff0c\u800c\u4e0d\u662f\u9488\u5bf9 EKS \u7684\u7279\u5b9a\u5efa\u8bae\u3002</p>"},{"location":"zh/cost_optimization/awareness/#kubernetes","title":"\u4f7f\u7528 Kubernetes \u4eea\u8868\u677f","text":"<p>Kubernetes \u4eea\u8868\u677f</p> <p>Kubernetes \u4eea\u8868\u677f\u662f\u4e00\u4e2a\u901a\u7528\u7684\u57fa\u4e8e Web \u7684 Kubernetes \u96c6\u7fa4 UI\uff0c\u5b83\u63d0\u4f9b\u4e86\u6709\u5173 Kubernetes \u96c6\u7fa4\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u96c6\u7fa4\u3001\u8282\u70b9\u548c Pod \u7ea7\u522b\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u3002\u5728 Amazon EKS \u6587\u6863\u4e2d\u63cf\u8ff0\u4e86\u5728 Amazon EKS \u96c6\u7fa4\u4e0a\u90e8\u7f72 Kubernetes \u4eea\u8868\u677f\u3002</p> <p>\u4eea\u8868\u677f\u63d0\u4f9b\u4e86\u6bcf\u4e2a\u8282\u70b9\u548c Pod \u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7ec6\u5206\uff0c\u4ee5\u53ca\u6709\u5173 Pod\u3001\u670d\u52a1\u3001Deployment \u548c\u5176\u4ed6 Kubernetes \u5bf9\u8c61\u7684\u8be6\u7ec6\u5143\u6570\u636e\u3002\u8fd9\u4e9b\u7efc\u5408\u4fe1\u606f\u4e3a\u60a8\u7684 Kubernetes \u73af\u5883\u63d0\u4f9b\u4e86\u53ef\u89c1\u6027\u3002</p> <p></p> <p>kubectl top \u548c describe \u547d\u4ee4</p> <p>\u4f7f\u7528 kubectl top \u548c kubectl describe \u547d\u4ee4\u67e5\u770b\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u6307\u6807\u3002kubectl top \u5c06\u663e\u793a\u96c6\u7fa4\u4e2d Pod \u6216\u8282\u70b9\u7684\u5f53\u524d CPU \u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u6216\u7279\u5b9a Pod \u6216\u8282\u70b9\u7684\u4f7f\u7528\u60c5\u51b5\u3002kubectl describe \u547d\u4ee4\u5c06\u63d0\u4f9b\u6709\u5173\u7279\u5b9a\u8282\u70b9\u6216 Pod \u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002 <pre><code>$ kubectl top pods\n$ kubectl top nodes\n$ kubectl top pod pod-name --namespace mynamespace --containers\n</code></pre></p> <p>\u4f7f\u7528 top \u547d\u4ee4\uff0c\u8f93\u51fa\u5c06\u663e\u793a\u8282\u70b9\u6b63\u5728\u4f7f\u7528\u7684\u603b CPU \u91cf(\u4ee5\u6838\u5fc3\u4e3a\u5355\u4f4d)\u548c\u5185\u5b58\u91cf(\u4ee5 MiB \u4e3a\u5355\u4f4d)\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u6570\u5b57\u5360\u8282\u70b9\u53ef\u5206\u914d\u5bb9\u91cf\u7684\u767e\u5206\u6bd4\u3002\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0 --containers \u6807\u5fd7\u6df1\u5165\u5230\u4e0b\u4e00\u7ea7\uff0c\u5373 Pod \u5185\u7684\u5bb9\u5668\u7ea7\u522b\u3002</p> <pre><code>$ kubectl describe node &lt;node&gt;\n$ kubectl describe pod &lt;pod&gt;\n</code></pre> <p>kubectl describe \u8fd4\u56de\u6bcf\u4e2a\u8d44\u6e90\u8bf7\u6c42\u6216\u9650\u5236\u6240\u4ee3\u8868\u7684\u603b\u53ef\u7528\u5bb9\u91cf\u7684\u767e\u5206\u6bd4\u3002</p> <p>kubectl top \u548c describe \u8ddf\u8e2a CPU\u3001\u5185\u5b58\u548c\u5b58\u50a8\u7b49\u5173\u952e\u8d44\u6e90\u5728 Kubernetes Pod\u3001\u8282\u70b9\u548c\u5bb9\u5668\u4e2d\u7684\u5229\u7528\u7387\u548c\u53ef\u7528\u6027\u3002\u8fd9\u79cd\u610f\u8bc6\u5c06\u6709\u52a9\u4e8e\u4e86\u89e3\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff0c\u5e76\u6709\u52a9\u4e8e\u63a7\u5236\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/awareness/#cloudwatch","title":"\u4f7f\u7528 CloudWatch \u5bb9\u5668\u6d1e\u5bdf","text":"<p>\u4f7f\u7528 CloudWatch \u5bb9\u5668\u6d1e\u5bdf\u6536\u96c6\u3001\u805a\u5408\u548c\u6c47\u603b\u6765\u81ea\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u548c\u5fae\u670d\u52a1\u7684\u6307\u6807\u548c\u65e5\u5fd7\u3002\u5bb9\u5668\u6d1e\u5bdf\u53ef\u7528\u4e8e Amazon Elastic Kubernetes Service on EC2 \u548c Amazon EC2 \u4e0a\u7684 Kubernetes \u5e73\u53f0\u3002\u8fd9\u4e9b\u6307\u6807\u5305\u62ec CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u548c\u7f51\u7edc\u7b49\u8d44\u6e90\u7684\u5229\u7528\u7387\u3002</p> <p>\u6587\u6863\u4e2d\u7ed9\u51fa\u4e86\u6d1e\u5bdf\u7684\u5b89\u88c5\u65b9\u6cd5\u3002</p> <p>CloudWatch \u5728\u96c6\u7fa4\u3001\u8282\u70b9\u3001Pod\u3001\u4efb\u52a1\u548c\u670d\u52a1\u7ea7\u522b\u521b\u5efa\u805a\u5408\u6307\u6807\u4f5c\u4e3a CloudWatch \u6307\u6807\u3002</p> <p>\u4ee5\u4e0b\u67e5\u8be2\u663e\u793a\u4e86\u6309\u5e73\u5747\u8282\u70b9 CPU \u5229\u7528\u7387\u6392\u5e8f\u7684\u8282\u70b9\u5217\u8868 <pre><code>STATS avg(node_cpu_utilization) as avg_node_cpu_utilization by NodeName\n| SORT avg_node_cpu_utilization DESC\n</code></pre></p> <p>\u6309\u5bb9\u5668\u540d\u79f0\u67e5\u770b CPU \u4f7f\u7528\u60c5\u51b5 <pre><code>stats pct(container_cpu_usage_total, 50) as CPUPercMedian by kubernetes.container_name\n| filter Type=\"Container\"\n</code></pre> \u6309\u5bb9\u5668\u540d\u79f0\u67e5\u770b\u78c1\u76d8\u4f7f\u7528\u60c5\u51b5 <pre><code>stats floor(avg(container_filesystem_usage/1024)) as container_filesystem_usage_avg_kb by InstanceId, kubernetes.container_name, device\n| filter Type=\"ContainerFS\"\n| sort container_filesystem_usage_avg_kb desc\n</code></pre></p> <p>\u66f4\u591a\u793a\u4f8b\u67e5\u8be2\u53ef\u5728 \u5bb9\u5668\u6d1e\u5bdf\u6587\u6863\u4e2d\u627e\u5230\u3002</p> <p>\u8fd9\u79cd\u610f\u8bc6\u5c06\u6709\u52a9\u4e8e\u4e86\u89e3\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff0c\u5e76\u6709\u52a9\u4e8e\u63a7\u5236\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/awareness/#kubecost","title":"\u4f7f\u7528 KubeCost \u5b9e\u73b0\u652f\u51fa\u610f\u8bc6\u548c\u6307\u5bfc","text":"<p>\u50cf kubecost \u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u5de5\u5177\u4e5f\u53ef\u4ee5\u90e8\u7f72\u5728 Amazon EKS \u4e0a\uff0c\u4ee5\u83b7\u5f97\u8fd0\u884c Kubernetes \u96c6\u7fa4\u7684\u6210\u672c\u53ef\u89c1\u6027\u3002\u8bf7\u53c2\u9605\u6b64 AWS \u535a\u5ba2\u4ee5\u4e86\u89e3\u4f7f\u7528 Kubecost \u8ddf\u8e2a\u6210\u672c\u7684\u76f8\u5173\u4fe1\u606f\u3002</p> <p>\u4f7f\u7528 Helm 3 \u90e8\u7f72 kubecost\uff1a <pre><code>$ curl -sSL https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash\n$ helm version --short\nv3.2.1+gfe51cd1\n$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/\n$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/c^C\n$ kubectl create namespace kubecost\nnamespace/kubecost created\n$ helm repo add kubecost https://kubecost.github.io/cost-analyzer/\n\"kubecost\" has been added to your repositories\n\n$ helm install kubecost kubecost/cost-analyzer --namespace kubecost --set kubecostToken=\"aGRoZEBqc2pzLmNvbQ==xm343yadf98\"\nNAME: kubecost\nLAST DEPLOYED: Mon May 18 08:49:05 2020\nNAMESPACE: kubecost\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\n--------------------------------------------------Kubecost has been successfully installed. When pods are Ready, you can enable port-forwarding with the following command:\n\n    kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 9090\n\nNext, navigate to http://localhost:9090 in a web browser.\n$ kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 9090\n\n\u6ce8\u610f\uff1a \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Cloud 9 \u6216\u9700\u8981\u5c06\u5176\u8f6c\u53d1\u5230\u5176\u4ed6\u7aef\u53e3(\u5982 8080)\uff0c\u8bf7\u53d1\u51fa\u4ee5\u4e0b\u547d\u4ee4\n$ kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 8080:9090\n</code></pre> Kube Cost \u4eea\u8868\u677f - </p>"},{"location":"zh/cost_optimization/awareness/#kubernetes_1","title":"\u4f7f\u7528 Kubernetes \u6210\u672c\u5206\u914d\u548c\u5bb9\u91cf\u89c4\u5212\u5206\u6790\u5de5\u5177","text":"<p>Kubernetes Opex Analytics \u662f\u4e00\u4e2a\u5e2e\u52a9\u7ec4\u7ec7\u8ddf\u8e2a Kubernetes \u96c6\u7fa4\u6d88\u8017\u7684\u8d44\u6e90\u7684\u5de5\u5177\uff0c\u4ee5\u9632\u6b62\u652f\u4ed8\u8fc7\u591a\u8d39\u7528\u3002\u4e3a\u6b64\uff0c\u5b83\u751f\u6210\u77ed\u671f(7 \u5929)\u3001\u4e2d\u671f(14 \u5929)\u548c\u957f\u671f(12 \u4e2a\u6708)\u4f7f\u7528\u62a5\u544a\uff0c\u663e\u793a\u6bcf\u4e2a\u9879\u76ee\u968f\u65f6\u95f4\u7684\u76f8\u5173\u652f\u51fa\u60c5\u51b5\u3002</p> <p></p>"},{"location":"zh/cost_optimization/awareness/#magalix-kubeadvisor","title":"Magalix Kubeadvisor","text":"<p>KubeAdvisor \u6301\u7eed\u626b\u63cf\u60a8\u7684 Kubernetes \u96c6\u7fa4\uff0c\u5e76\u62a5\u544a\u5982\u4f55\u4fee\u590d\u95ee\u9898\u3001\u5e94\u7528\u6700\u4f73\u5b9e\u8df5\u4ee5\u53ca\u4f18\u5316\u96c6\u7fa4(\u5305\u62ec\u56f4\u7ed5\u6210\u672c\u6548\u7387\u7684 CPU/\u5185\u5b58\u8d44\u6e90\u5efa\u8bae)\u3002</p>"},{"location":"zh/cost_optimization/awareness/#spotio-spotinst","title":"Spot.io(\u4ee5\u524d\u79f0\u4e3a Spotinst)","text":"<p>Spotinst Ocean \u662f\u4e00\u79cd\u5e94\u7528\u7a0b\u5e8f\u6269\u7f29\u670d\u52a1\u3002\u4e0e Amazon Elastic Compute Cloud (Amazon EC2) \u81ea\u52a8\u6269\u7f29\u7ec4\u7c7b\u4f3c\uff0cSpotinst Ocean \u65e8\u5728\u901a\u8fc7\u5229\u7528 Spot \u5b9e\u4f8b\u7ed3\u5408\u6309\u9700\u5b9e\u4f8b\u548c\u9884\u7559\u5b9e\u4f8b\u6765\u4f18\u5316\u6027\u80fd\u548c\u6210\u672c\u3002\u4f7f\u7528\u81ea\u52a8\u5316 Spot \u5b9e\u4f8b\u7ba1\u7406\u548c\u5404\u79cd\u5b9e\u4f8b\u5927\u5c0f\u7684\u7ec4\u5408\uff0cOcean \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u6839\u636e Pod \u8d44\u6e90\u9700\u6c42\u8fdb\u884c\u6269\u7f29\u3002Spotinst Ocean \u8fd8\u5305\u62ec\u4e00\u79cd\u9884\u6d4b\u7b97\u6cd5\uff0c\u53ef\u4ee5\u63d0\u524d 15 \u5206\u949f\u9884\u6d4b Spot \u5b9e\u4f8b\u4e2d\u65ad\uff0c\u5e76\u5728\u4e0d\u540c\u7684 Spot \u5bb9\u91cf\u6c60\u4e2d\u542f\u52a8\u65b0\u8282\u70b9\u3002</p> <p>\u8fd9\u662f\u7531 Spotinst\uff0c Inc. \u4e0e AWS \u5408\u4f5c\u5f00\u53d1\u7684 AWS Quickstart\u3002</p> <p>EKS \u7814\u8ba8\u4f1a\u8fd8\u6709\u4e00\u4e2a\u5173\u4e8e \u4f7f\u7528 Ocean by Spot.io \u4f18\u5316 Amazon EKS \u4e0a\u7684\u5de5\u4f5c\u8282\u70b9\u7ba1\u7406\u7684\u6a21\u5757\uff0c\u5176\u4e2d\u5305\u62ec\u6210\u672c\u5206\u914d\u3001\u6b63\u786e\u8c03\u6574\u5927\u5c0f\u548c\u6269\u7f29\u7b56\u7565\u7b49\u90e8\u5206\u3002</p>"},{"location":"zh/cost_optimization/awareness/#yotascale","title":"Yotascale","text":"<p>Yotascale \u6709\u52a9\u4e8e\u51c6\u786e\u5206\u914d Kubernetes \u6210\u672c\u3002Yotascale Kubernetes \u6210\u672c\u5206\u914d\u529f\u80fd\u5229\u7528\u5b9e\u9645\u6210\u672c\u6570\u636e(\u5305\u62ec\u9884\u7559\u5b9e\u4f8b\u6298\u6263\u548c Spot \u5b9e\u4f8b\u5b9a\u4ef7)\uff0c\u800c\u4e0d\u662f\u901a\u7528\u7684\u5e02\u573a\u4ef7\u683c\u4f30\u7b97\uff0c\u6765\u901a\u77e5\u603b Kubernetes \u6210\u672c\u652f\u51fa\u3002</p> <p>\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u53ef\u5728 \u4ed6\u4eec\u7684\u7f51\u7ad9 \u4e0a\u627e\u5230\u3002</p>"},{"location":"zh/cost_optimization/awareness/#alcide-advisor","title":"Alcide Advisor","text":"<p>Alcide \u662f AWS \u5408\u4f5c\u4f19\u4f34\u7f51\u7edc (APN) \u7684\u9ad8\u7ea7\u6280\u672f\u5408\u4f5c\u4f19\u4f34\u3002Alcide Advisor \u6709\u52a9\u4e8e\u786e\u4fdd\u60a8\u7684 Amazon EKS \u96c6\u7fa4\u3001\u8282\u70b9\u548c Pod \u914d\u7f6e\u6839\u636e\u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u548c\u5185\u90e8\u6307\u5357\u8fdb\u884c\u8c03\u6574\u3002Alcide Advisor \u662f\u4e00\u79cd\u65e0\u4ee3\u7406\u7684 Kubernetes \u5ba1\u8ba1\u548c\u5408\u89c4\u6027\u670d\u52a1\uff0c\u65e8\u5728\u901a\u8fc7\u5728\u8f6c\u79fb\u5230\u751f\u4ea7\u73af\u5883\u4e4b\u524d\u52a0\u56fa\u5f00\u53d1\u9636\u6bb5\uff0c\u786e\u4fdd\u65e0\u6469\u64e6\u548c\u5b89\u5168\u7684 DevSecOps \u6d41\u7a0b\u3002</p> <p>\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u53ef\u5728\u6b64 \u535a\u5ba2\u6587\u7ae0\u4e2d\u627e\u5230\u3002</p>"},{"location":"zh/cost_optimization/awareness/#_5","title":"\u5176\u4ed6\u5de5\u5177","text":""},{"location":"zh/cost_optimization/awareness/#kubernetes_2","title":"Kubernetes \u5783\u573e\u6536\u96c6","text":"<p>Kubernetes \u5783\u573e\u6536\u96c6\u5668\u7684\u4f5c\u7528\u662f\u5220\u9664\u67d0\u4e9b\u66fe\u7ecf\u6709\u6240\u6709\u8005\u4f46\u73b0\u5728\u6ca1\u6709\u6240\u6709\u8005\u7684\u5bf9\u8c61\u3002</p>"},{"location":"zh/cost_optimization/awareness/#fargate-count","title":"Fargate count","text":"<p>Fargatecount \u662f\u4e00\u4e2a\u6709\u7528\u7684\u5de5\u5177\uff0c\u5b83\u5141\u8bb8 AWS \u5ba2\u6237\u4f7f\u7528\u81ea\u5b9a\u4e49 CloudWatch \u6307\u6807\u8ddf\u8e2a\u5728\u7279\u5b9a\u533a\u57df\u7684\u7279\u5b9a\u8d26\u6237\u4e2d\u90e8\u7f72\u5728 Fargate \u4e0a\u7684 EKS Pod \u603b\u6570\u3002\u8fd9\u6709\u52a9\u4e8e\u8ddf\u8e2a\u8de8 EKS \u96c6\u7fa4\u8fd0\u884c\u7684\u6240\u6709 Fargate Pod\u3002</p>"},{"location":"zh/cost_optimization/awareness/#kubernetes-ops-view","title":"Kubernetes Ops View","text":"<p>Kube Ops View \u662f\u4e00\u4e2a\u6709\u7528\u7684\u5de5\u5177\uff0c\u5b83\u4e3a\u591a\u4e2a Kubernetes \u96c6\u7fa4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u901a\u7528\u7684\u53ef\u89c6\u5316\u64cd\u4f5c\u56fe\u3002</p> <pre><code>git clone https://github.com/hjacobs/kube-ops-view\ncd kube-ops-view\nkubectl apply -k deploy/\n</code></pre> <p></p>"},{"location":"zh/cost_optimization/awareness/#popeye-kubernetes","title":"Popeye - \u4e00\u4e2a Kubernetes \u96c6\u7fa4\u6e05\u7406\u5de5\u5177","text":"<p>Popeye - \u4e00\u4e2a Kubernetes \u96c6\u7fa4\u6e05\u7406\u5de5\u5177\u662f\u4e00\u4e2a\u5b9e\u7528\u7a0b\u5e8f\uff0c\u5b83\u626b\u63cf\u5b9e\u65f6 Kubernetes \u96c6\u7fa4\u5e76\u62a5\u544a\u5df2\u90e8\u7f72\u8d44\u6e90\u548c\u914d\u7f6e\u4e2d\u7684\u6f5c\u5728\u95ee\u9898\u3002\u5b83\u6839\u636e\u90e8\u7f72\u7684\u5185\u5bb9\u800c\u4e0d\u662f\u78c1\u76d8\u4e0a\u7684\u5185\u5bb9\u6765\u6e05\u7406\u60a8\u7684\u96c6\u7fa4\u3002\u901a\u8fc7\u626b\u63cf\u60a8\u7684\u96c6\u7fa4\uff0c\u5b83\u53ef\u4ee5\u68c0\u6d4b\u5230\u9519\u8bef\u914d\u7f6e\uff0c\u5e76\u5e2e\u52a9\u60a8\u786e\u4fdd\u6700\u4f73\u5b9e\u8df5\u5f97\u5230\u843d\u5b9e\u3002</p>"},{"location":"zh/cost_optimization/awareness/#_6","title":"\u8d44\u6e90","text":"<p>\u53c2\u8003\u4ee5\u4e0b\u8d44\u6e90\uff0c\u4e86\u89e3\u6709\u5173\u6210\u672c\u4f18\u5316\u6700\u4f73\u5b9e\u8df5\u7684\u66f4\u591a\u4fe1\u606f\u3002</p> <p>\u6587\u6863\u548c\u535a\u5ba2 + Amazon EKS \u652f\u6301\u6807\u8bb0</p> <p>\u5de5\u5177 + \u4ec0\u4e48\u662f AWS Billing and Cost Management\uff1f + Amazon CloudWatch \u5bb9\u5668\u6d1e\u5bdf + \u5982\u4f55\u4f7f\u7528 Kubecost \u8ddf\u8e2a\u591a\u79df\u6237 Amazon EKS \u96c6\u7fa4\u4e2d\u7684\u6210\u672c + Kube Cost + Kube Opsview + Kube Janitor + Kubernetes Opex Analytics</p>"},{"location":"zh/cost_optimization/cfm_framework/","title":"\u6210\u672c\u4f18\u5316 - \u7b80\u4ecb","text":"<p>AWS \u4e91\u7ecf\u6d4e\u5b66\u662f\u4e00\u95e8\u5e2e\u52a9\u5ba2\u6237\u901a\u8fc7\u91c7\u7528\u50cf Amazon EKS \u8fd9\u6837\u7684\u73b0\u4ee3\u8ba1\u7b97\u6280\u672f\u6765\u63d0\u9ad8\u6548\u7387\u548c\u964d\u4f4e\u6210\u672c\u7684\u5b66\u79d1\u3002\u8be5\u5b66\u79d1\u5efa\u8bae\u9075\u5faa\u4e00\u79cd\u79f0\u4e3a\"\u4e91\u8d22\u52a1\u7ba1\u7406 (CFM) \u6846\u67b6\"\u7684\u65b9\u6cd5\u8bba\uff0c\u8be5\u6846\u67b6\u7531 4 \u4e2a\u652f\u67f1\u7ec4\u6210\uff1a</p> <p></p>"},{"location":"zh/cost_optimization/cfm_framework/#_1","title":"\u89c2\u5bdf\u652f\u67f1\uff1a\u6d4b\u91cf\u548c\u95ee\u8d23","text":"<p>\u89c2\u5bdf\u652f\u67f1\u662f\u4e00\u7ec4\u57fa\u7840\u6d3b\u52a8\u548c\u6280\u672f\uff0c\u7528\u4e8e\u5b9a\u4e49\u5982\u4f55\u6d4b\u91cf\u3001\u76d1\u63a7\u548c\u521b\u5efa\u4e91\u652f\u51fa\u7684\u95ee\u8d23\u5236\u3002\u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\"\u53ef\u89c2\u5bdf\u6027\"\u3001\"\u68c0\u6d4b\"\u6216\"\u9065\u6d4b\"\u3002\"\u53ef\u89c2\u5bdf\u6027\"\u57fa\u7840\u8bbe\u65bd\u7684\u529f\u80fd\u548c\u9650\u5236\u51b3\u5b9a\u4e86\u53ef\u4ee5\u4f18\u5316\u7684\u5185\u5bb9\u3002\u83b7\u5f97\u5bf9\u6210\u672c\u7684\u6e05\u6670\u4e86\u89e3\u662f\u6210\u672c\u4f18\u5316\u7684\u5173\u952e\u7b2c\u4e00\u6b65\uff0c\u56e0\u4e3a\u60a8\u9700\u8981\u77e5\u9053\u4ece\u54ea\u91cc\u5f00\u59cb\u3002\u8fd9\u79cd\u53ef\u89c1\u6027\u4e5f\u5c06\u6307\u5bfc\u60a8\u9700\u8981\u91c7\u53d6\u54ea\u4e9b\u6d3b\u52a8\u6765\u8fdb\u4e00\u6b65\u4f18\u5316\u60a8\u7684\u73af\u5883\u3002</p> <p>\u4ee5\u4e0b\u662f\u6211\u4eec\u5173\u4e8e\u89c2\u5bdf\u652f\u67f1\u7684\u6700\u4f73\u5b9e\u8df5\u6982\u8ff0\uff1a</p> <ul> <li>\u4e3a\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5b9a\u4e49\u548c\u7ef4\u62a4\u6807\u8bb0\u7b56\u7565\u3002<ul> <li>\u4f7f\u7528\u5b9e\u4f8b\u6807\u8bb0\uff0c\u4e3a EKS \u96c6\u7fa4\u6dfb\u52a0\u6807\u8bb0\u53ef\u8ba9\u60a8\u67e5\u770b\u5355\u4e2a\u96c6\u7fa4\u6210\u672c\u5e76\u5728\u6210\u672c\u548c\u4f7f\u7528\u60c5\u51b5\u62a5\u544a\u4e2d\u5206\u914d\u5b83\u4eec\u3002</li> </ul> </li> <li>\u901a\u8fc7\u4f7f\u7528\u8bf8\u5982 Kubecost \u7b49\u6280\u672f\u6765\u5efa\u7acb EKS \u4f7f\u7528\u60c5\u51b5\u7684\u62a5\u544a\u548c\u76d1\u63a7\u3002<ul> <li>\u542f\u7528\u4e91\u667a\u80fd\u4eea\u8868\u677f\uff0c\u901a\u8fc7\u6b63\u786e\u6807\u8bb0\u8d44\u6e90\u5e76\u4f7f\u7528\u53ef\u89c6\u5316\uff0c\u60a8\u53ef\u4ee5\u6d4b\u91cf\u548c\u4f30\u7b97\u6210\u672c\u3002</li> </ul> </li> <li>\u5c06\u4e91\u6210\u672c\u5206\u914d\u7ed9\u5e94\u7528\u7a0b\u5e8f\u3001\u4e1a\u52a1\u7ebf (LoBs) \u548c\u6536\u5165\u6765\u6e90\u3002</li> <li>\u5b9a\u4e49\u3001\u6d4b\u91cf\u5e76\u4e0e\u4e1a\u52a1\u5229\u76ca\u76f8\u5173\u8005\u4f20\u8fbe\u6548\u7387/\u4ef7\u503c\u5173\u952e\u7ee9\u6548\u6307\u6807\u3002\u4f8b\u5982\uff0c\u521b\u5efa\u4e00\u4e2a\"\u5355\u4f4d\u6307\u6807\"\u5173\u952e\u7ee9\u6548\u6307\u6807\uff0c\u7528\u4e8e\u6d4b\u91cf\u6bcf\u7b14\u4ea4\u6613\u7684\u6210\u672c\uff0c\u4f8b\u5982\u5171\u4eab\u4e58\u8f66\u670d\u52a1\u53ef\u80fd\u4f1a\u6709\u4e00\u4e2a\"\u6bcf\u6b21\u4e58\u8f66\u6210\u672c\"\u7684\u5173\u952e\u7ee9\u6548\u6307\u6807\u3002</li> </ul> <p>\u6709\u5173\u4e0e\u6b64\u652f\u67f1\u76f8\u5173\u7684\u63a8\u8350\u6280\u672f\u548c\u6d3b\u52a8\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u672c\u6307\u5357\u7684\u6210\u672c\u4f18\u5316 - \u53ef\u89c2\u5bdf\u6027\u90e8\u5206\u3002</p>"},{"location":"zh/cost_optimization/cfm_framework/#_2","title":"\u8282\u7701\u652f\u67f1\uff1a\u6210\u672c\u4f18\u5316","text":"<p>\u8be5\u652f\u67f1\u57fa\u4e8e\u5728\"\u89c2\u5bdf\"\u652f\u67f1\u4e2d\u5f00\u53d1\u7684\u6280\u672f\u548c\u529f\u80fd\u3002\u4ee5\u4e0b\u6d3b\u52a8\u901a\u5e38\u5c5e\u4e8e\u6b64\u652f\u67f1\uff1a</p> <ul> <li>\u8bc6\u522b\u5e76\u6d88\u9664\u73af\u5883\u4e2d\u7684\u6d6a\u8d39\u3002</li> <li>\u4e3a\u6210\u672c\u6548\u7387\u8bbe\u8ba1\u548c\u6784\u5efa\u3002</li> <li>\u9009\u62e9\u6700\u4f73\u8d2d\u4e70\u9009\u9879\uff0c\u4f8b\u5982\u6309\u9700\u5b9e\u4f8b\u4e0e Spot \u5b9e\u4f8b\u3002</li> <li>\u968f\u7740\u670d\u52a1\u7684\u53d1\u5c55\u800c\u9002\u5e94\uff1a\u968f\u7740 AWS \u670d\u52a1\u7684\u53d1\u5c55\uff0c\u6709\u6548\u4f7f\u7528\u8fd9\u4e9b\u670d\u52a1\u7684\u65b9\u5f0f\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\u3002\u8bf7\u4fdd\u6301\u4e50\u4e8e\u9002\u5e94\u8fd9\u4e9b\u53d8\u5316\u3002</li> </ul> <p>\u7531\u4e8e\u8fd9\u4e9b\u6d3b\u52a8\u662f\u64cd\u4f5c\u6027\u7684\uff0c\u5b83\u4eec\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u53d6\u51b3\u4e8e\u60a8\u73af\u5883\u7684\u7279\u5f81\u3002\u95ee\u95ee\u81ea\u5df1\uff0c\u6210\u672c\u7684\u4e3b\u8981\u9a71\u52a8\u56e0\u7d20\u662f\u4ec0\u4e48\uff1f\u4e0d\u540c\u73af\u5883\u63d0\u4f9b\u4e86\u4ec0\u4e48\u4e1a\u52a1\u4ef7\u503c\uff1f\u54ea\u4e9b\u8d2d\u4e70\u9009\u9879\u548c\u57fa\u7840\u8bbe\u65bd\u9009\u62e9(\u4f8b\u5982\u5b9e\u4f8b\u7cfb\u5217\u7c7b\u578b)\u6700\u9002\u5408\u6bcf\u4e2a\u73af\u5883\uff1f</p> <p>\u4ee5\u4e0b\u662f EKS \u96c6\u7fa4\u6700\u5e38\u89c1\u7684\u6210\u672c\u9a71\u52a8\u56e0\u7d20\u7684\u4f18\u5148\u7ea7\u5217\u8868\uff1a</p> <ol> <li>\u8ba1\u7b97\u6210\u672c\uff1a\u7ed3\u5408\u591a\u79cd\u5b9e\u4f8b\u7cfb\u5217\u7c7b\u578b\u3001\u8d2d\u4e70\u9009\u9879\u4ee5\u53ca\u5e73\u8861\u53ef\u6269\u5c55\u6027\u548c\u53ef\u7528\u6027\u9700\u8981\u4ed4\u7ec6\u8003\u8651\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u672c\u6307\u5357\u6210\u672c\u4f18\u5316 - \u8ba1\u7b97\u90e8\u5206\u4e2d\u7684\u5efa\u8bae\u3002</li> <li>\u7f51\u7edc\u6210\u672c\uff1a\u4e3a EKS \u96c6\u7fa4\u4f7f\u7528 3 \u4e2a\u53ef\u7528\u533a\u53ef\u80fd\u4f1a\u589e\u52a0\u8de8\u53ef\u7528\u533a\u6d41\u91cf\u6210\u672c\u3002\u6709\u5173\u5982\u4f55\u5e73\u8861\u9ad8\u53ef\u7528\u6027\u8981\u6c42\u548c\u964d\u4f4e\u7f51\u7edc\u6d41\u91cf\u6210\u672c\u7684\u5efa\u8bae\uff0c\u8bf7\u53c2\u9605\u672c\u6307\u5357\u7684\u6210\u672c\u4f18\u5316 - \u7f51\u7edc\u90e8\u5206\u3002</li> <li>\u5b58\u50a8\u6210\u672c\uff1a\u6839\u636e EKS \u96c6\u7fa4\u4e2d\u5de5\u4f5c\u8d1f\u8f7d\u7684\u65e0\u72b6\u6001/\u6709\u72b6\u6001\u6027\u8d28\uff0c\u4ee5\u53ca\u4e0d\u540c\u5b58\u50a8\u7c7b\u578b\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u5b58\u50a8\u53ef\u89c6\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4e00\u90e8\u5206\u3002\u6709\u5173 EKS \u5b58\u50a8\u6210\u672c\u7684\u6ce8\u610f\u4e8b\u9879\uff0c\u8bf7\u53c2\u9605\u672c\u6307\u5357\u7684\u6210\u672c\u4f18\u5316 - \u5b58\u50a8\u90e8\u5206\u3002</li> </ol>"},{"location":"zh/cost_optimization/cfm_framework/#_3","title":"\u89c4\u5212\u652f\u67f1\uff1a \u89c4\u5212\u548c\u9884\u6d4b","text":"<p>\u4e00\u65e6\u5b9e\u65bd\u4e86\u89c2\u5bdf\u652f\u67f1\u4e2d\u7684\u5efa\u8bae\uff0c\u96c6\u7fa4\u5c31\u4f1a\u6301\u7eed\u8fdb\u884c\u4f18\u5316\u3002\u968f\u7740\u5728\u9ad8\u6548\u8fd0\u8425\u96c6\u7fa4\u65b9\u9762\u79ef\u7d2f\u7ecf\u9a8c\uff0c\u89c4\u5212\u548c\u9884\u6d4b\u6d3b\u52a8\u53ef\u4ee5\u4e13\u6ce8\u4e8e\uff1a</p> <ul> <li>\u52a8\u6001\u9884\u7b97\u548c\u9884\u6d4b\u4e91\u6210\u672c\u3002</li> <li>\u91cf\u5316 EKS \u5bb9\u5668\u670d\u52a1\u6240\u63d0\u4f9b\u7684\u4e1a\u52a1\u4ef7\u503c\u3002</li> <li>\u5c06 EKS \u96c6\u7fa4\u6210\u672c\u7ba1\u7406\u4e0e IT \u8d22\u52a1\u7ba1\u7406\u89c4\u5212\u76f8\u7ed3\u5408\u3002</li> </ul>"},{"location":"zh/cost_optimization/cfm_framework/#_4","title":"\u8fd0\u884c\u652f\u67f1","text":"<p>\u6210\u672c\u4f18\u5316\u662f\u4e00\u4e2a\u6301\u7eed\u7684\u8fc7\u7a0b\uff0c\u6d89\u53ca\u4e00\u4e2a\u6e10\u8fdb\u5f0f\u6539\u8fdb\u7684\u98de\u8f6e\uff1a</p> <p></p> <p>\u4e3a\u8fd9\u4e9b\u7c7b\u578b\u7684\u6d3b\u52a8\u83b7\u5f97\u9ad8\u7ba1\u8d5e\u52a9\u662f\u81f3\u5173\u91cd\u8981\u7684\uff0c\u53ef\u5c06 EKS \u96c6\u7fa4\u4f18\u5316\u878d\u5165\u7ec4\u7ec7\u7684\"FinOps\"\u5de5\u4f5c\u4e2d\u3002\u5b83\u5141\u8bb8\u901a\u8fc7\u5bf9 EKS \u96c6\u7fa4\u6210\u672c\u7684\u5171\u540c\u7406\u89e3\u3001\u5b9e\u65bd EKS \u96c6\u7fa4\u6210\u672c\u9632\u62a4\u4ee5\u53ca\u786e\u4fdd\u5de5\u5177\u3001\u81ea\u52a8\u5316\u548c\u6d3b\u52a8\u968f\u7740\u7ec4\u7ec7\u9700\u6c42\u7684\u53d1\u5c55\u800c\u53d1\u5c55\u6765\u5b9e\u73b0\u5229\u76ca\u76f8\u5173\u8005\u7684\u4e00\u81f4\u6027\u3002</p>"},{"location":"zh/cost_optimization/cfm_framework/#_5","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>AWS \u4e91\u7ecf\u6d4e\u5b66\u3001\u4e91\u8d22\u52a1\u7ba1\u7406</li> </ul>"},{"location":"zh/cost_optimization/cost-effective/","title":"\u9ad8\u6027\u4ef7\u6bd4\u8d44\u6e90","text":"<p>\u9ad8\u6027\u4ef7\u6bd4\u8d44\u6e90\u610f\u5473\u7740\u4e3a\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u9002\u5f53\u7684\u670d\u52a1\u3001\u8d44\u6e90\u548c\u914d\u7f6e\uff0c\u8fd9\u5c06\u5e26\u6765\u6210\u672c\u8282\u7701\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/cost_optimization/cost-effective/#_3","title":"\u786e\u4fdd\u7528\u4e8e\u90e8\u7f72\u5bb9\u5668\u5316\u670d\u52a1\u7684\u57fa\u7840\u8bbe\u65bd\u4e0e\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\u548c\u6269\u5c55\u9700\u6c42\u76f8\u5339\u914d","text":"<p>Amazon EKS \u652f\u6301\u51e0\u79cd\u7c7b\u578b\u7684 Kubernetes \u81ea\u52a8\u6269\u7f29 - \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u3001\u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29\u5668 \u548c \u5782\u76f4 Pod \u81ea\u52a8\u6269\u7f29\u5668\u3002\u672c\u8282\u6db5\u76d6\u5176\u4e2d\u4e24\u4e2a\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u548c\u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29\u5668\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#kubernetes","title":"\u4f7f\u7528\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u6765\u8c03\u6574 Kubernetes \u96c6\u7fa4\u7684\u5927\u5c0f\u4ee5\u6ee1\u8db3\u5f53\u524d\u9700\u6c42","text":"<p>Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5728 Pod \u7531\u4e8e\u8d44\u6e90\u4e0d\u8db3\u800c\u65e0\u6cd5\u542f\u52a8\u6216\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u5229\u7528\u7387\u4e0d\u8db3\u4e14\u5176 Pod \u53ef\u4ee5\u91cd\u65b0\u8c03\u5ea6\u5230\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u8282\u70b9\u65f6\uff0c\u4f1a\u81ea\u52a8\u8c03\u6574 EKS \u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u6570\u91cf\u3002\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5728\u4efb\u4f55\u6307\u5b9a\u7684\u81ea\u52a8\u6269\u7f29\u7ec4\u4e2d\u6269\u7f29\u5de5\u4f5c\u8282\u70b9\uff0c\u5e76\u4f5c\u4e3a\u90e8\u7f72\u8fd0\u884c\u5728\u60a8\u7684 EKS \u96c6\u7fa4\u4e2d\u3002</p> <p>Amazon EKS \u4e0e EC2 \u6258\u7ba1\u8282\u70b9\u7ec4\u81ea\u52a8\u5316\u4e3a Amazon EKS Kubernetes \u96c6\u7fa4\u914d\u7f6e\u548c\u7ba1\u7406\u8282\u70b9(Amazon EC2 \u5b9e\u4f8b)\u7684\u751f\u547d\u5468\u671f\u3002\u6240\u6709\u6258\u7ba1\u8282\u70b9\u90fd\u4f5c\u4e3a Amazon EC2 \u81ea\u52a8\u6269\u7f29\u7ec4\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u914d\u7f6e\uff0c\u7531 Amazon EKS \u4e3a\u60a8\u7ba1\u7406\uff0c\u5305\u62ec Amazon EC2 \u5b9e\u4f8b\u548c\u81ea\u52a8\u6269\u7f29\u7ec4\u7684\u6240\u6709\u8d44\u6e90\u90fd\u5728\u60a8\u7684 AWS \u8d26\u6237\u4e2d\u8fd0\u884c\u3002Amazon EKS \u4e3a\u6258\u7ba1\u8282\u70b9\u7ec4\u8d44\u6e90\u6dfb\u52a0\u6807\u7b7e\uff0c\u4ee5\u4fbf Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u53ef\u4ee5\u53d1\u73b0\u5b83\u4eec\u3002</p> <p>https://docs.aws.amazon.com/eks/latest/userguide/cluster-autoscaler.html \u4e0a\u7684\u6587\u6863\u63d0\u4f9b\u4e86\u8bbe\u7f6e\u6258\u7ba1\u8282\u70b9\u7ec4\u7136\u540e\u90e8\u7f72 Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684\u8be6\u7ec6\u6307\u5bfc\u3002\u5982\u679c\u60a8\u5728\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u57df\u8fd0\u884c\u6709 Amazon EBS \u5377\u652f\u6301\u7684\u6709\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u4f7f\u7528 Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\uff0c\u60a8\u5e94\u8be5\u4e3a\u6bcf\u4e2a\u53ef\u7528\u533a\u57df\u914d\u7f6e\u4e00\u4e2a\u8282\u70b9\u7ec4\u3002</p> <p>EC2 \u5de5\u4f5c\u8282\u70b9\u7684\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u65e5\u5fd7 - </p> <p>\u5f53\u7531\u4e8e\u7f3a\u4e4f\u53ef\u7528\u8d44\u6e90\u800c\u65e0\u6cd5\u8c03\u5ea6 Pod \u65f6\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u4f1a\u786e\u5b9a\u96c6\u7fa4\u5fc5\u987b\u6269\u5c55\uff0c\u5e76\u589e\u52a0\u8282\u70b9\u7ec4\u7684\u5927\u5c0f\u3002\u5f53\u4f7f\u7528\u591a\u4e2a\u8282\u70b9\u7ec4\u65f6\uff0c\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u4f1a\u6839\u636e Expander \u914d\u7f6e\u9009\u62e9\u4e00\u4e2a\u3002\u76ee\u524d\uff0c\u5728 EKS \u4e2d\u652f\u6301\u4ee5\u4e0b\u7b56\u7565\uff1a + random - \u9ed8\u8ba4\u6269\u5c55\u5668\uff0c\u968f\u673a\u9009\u62e9\u5b9e\u4f8b\u7ec4 + most-pods - \u9009\u62e9\u53ef\u4ee5\u8c03\u5ea6\u6700\u591a Pod \u7684\u5b9e\u4f8b\u7ec4\u3002 + least-waste - \u9009\u62e9\u5728\u6269\u5c55\u540e\u5c06\u6709\u6700\u5c11\u7a7a\u95f2 CPU(\u5982\u679c\u76f8\u540c\uff0c\u5219\u4e3a\u672a\u4f7f\u7528\u5185\u5b58)\u7684\u8282\u70b9\u7ec4\u3002\u5f53\u60a8\u6709\u4e0d\u540c\u7c7b\u578b\u7684\u8282\u70b9\u65f6\uff0c\u4f8b\u5982\u9ad8 CPU \u6216\u9ad8\u5185\u5b58\u8282\u70b9\uff0c\u5e76\u4e14\u53ea\u60f3\u5728\u6709\u9700\u8981\u5927\u91cf\u8fd9\u4e9b\u8d44\u6e90\u7684\u5f85\u5904\u7406 Pod \u65f6\u624d\u6269\u5c55\u8fd9\u4e9b\u8282\u70b9\u65f6\uff0c\u8fd9\u5f88\u6709\u7528\u3002 + priority - \u9009\u62e9\u7528\u6237\u5206\u914d\u7684\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u8282\u70b9\u7ec4</p> <p>\u5982\u679c\u4f7f\u7528 EC2 Spot \u5b9e\u4f8b\u4f5c\u4e3a\u5de5\u4f5c\u8282\u70b9\uff0c\u60a8\u53ef\u4ee5\u4e3a\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684 Expander \u4f7f\u7528 random \u653e\u7f6e\u7b56\u7565\u3002\u8fd9\u662f\u9ed8\u8ba4\u7684\u6269\u5c55\u5668\uff0c\u5728\u96c6\u7fa4\u5fc5\u987b\u6269\u5c55\u65f6\u4efb\u610f\u9009\u62e9\u4e00\u4e2a\u8282\u70b9\u7ec4\u3002\u968f\u673a\u6269\u5c55\u5668\u6700\u5927\u9650\u5ea6\u5730\u5229\u7528\u4e86\u591a\u4e2a Spot \u5bb9\u91cf\u6c60\u3002</p> <p>Priority \u57fa\u4e8e\u6269\u5c55\u5668\u6839\u636e\u7528\u6237\u4e3a\u6269\u7f29\u7ec4\u5206\u914d\u7684\u4f18\u5148\u7ea7\u9009\u62e9\u6269\u5c55\u9009\u9879\u3002\u793a\u4f8b\u4f18\u5148\u7ea7\u53ef\u4ee5\u662f\u8ba9\u81ea\u52a8\u6269\u7f29\u5668\u9996\u5148\u5c1d\u8bd5\u6269\u5c55 Spot \u5b9e\u4f8b\u8282\u70b9\u7ec4\uff0c\u5982\u679c\u65e0\u6cd5\u6269\u5c55\uff0c\u5219\u56de\u9000\u5230\u6269\u5c55\u6309\u9700\u8282\u70b9\u7ec4\u3002</p> <p>most-pods \u57fa\u4e8e\u6269\u5c55\u5668\u5728\u60a8\u4f7f\u7528 nodeSelector \u786e\u4fdd\u67d0\u4e9b Pod \u843d\u5728\u7279\u5b9a\u8282\u70b9\u4e0a\u65f6\u5f88\u6709\u7528\u3002</p> <p>\u6839\u636e\u6587\u6863,\u4e3a\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u914d\u7f6e\u6307\u5b9a least-waste \u4f5c\u4e3a\u6269\u5c55\u5668\u7c7b\u578b\uff1a</p> <pre><code>    spec:\n      containers:\n      - command:\n        - ./cluster-autoscaler\n        - --v=4\n        - --stderrthreshold=info\n        - --cloud-provider=aws\n        - --skip-nodes-with-local-storage=false\n        - --expander=least-waste\n        - --node-group-auto-discovery=asg:tag=k8s.io/cluster-autoscaler/enabled,k8s.io/cluster-autoscaler/&lt;YOUR CLUSTER NAME&gt;\n        - --balance-similar-node-groups\n        - --skip-nodes-with-system-pods=false\n</code></pre>"},{"location":"zh/cost_optimization/cost-effective/#pod-cpu-pod","title":"\u90e8\u7f72\u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29\u5668\uff0c\u6839\u636e\u8d44\u6e90\u7684 CPU \u5229\u7528\u7387\u6216\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u76f8\u5173\u6307\u6807\u81ea\u52a8\u6269\u7f29\u90e8\u7f72\u3001\u590d\u5236\u63a7\u5236\u5668\u6216\u526f\u672c\u96c6\u4e2d\u7684 Pod \u6570\u91cf","text":"<p>Kubernetes \u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29\u5668\u6839\u636e CPU \u5229\u7528\u7387\u7b49\u8d44\u6e90\u6307\u6807\u6216\u901a\u8fc7\u81ea\u5b9a\u4e49\u6307\u6807\u652f\u6301\u7684\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684\u6307\u6807\uff0c\u81ea\u52a8\u6269\u7f29\u90e8\u7f72\u3001\u590d\u5236\u63a7\u5236\u5668\u6216\u526f\u672c\u96c6\u4e2d\u7684 Pod \u6570\u91cf\u3002\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6269\u5c55\u4ee5\u6ee1\u8db3\u589e\u52a0\u7684\u9700\u6c42\uff0c\u6216\u5728\u4e0d\u9700\u8981\u8d44\u6e90\u65f6\u7f29\u51cf\uff0c\u4ece\u800c\u4e3a\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u91ca\u653e\u5de5\u4f5c\u8282\u70b9\u3002\u5f53\u60a8\u8bbe\u7f6e\u76ee\u6807\u6307\u6807\u5229\u7528\u7387\u767e\u5206\u6bd4\u65f6\uff0c\u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29\u5668\u4f1a\u6269\u5c55\u6216\u7f29\u51cf\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee5\u5c1d\u8bd5\u6ee1\u8db3\u8be5\u76ee\u6807\u3002</p> <p>k8s-cloudwatch-adapter \u662f Kubernetes \u81ea\u5b9a\u4e49\u6307\u6807 API \u548c\u5916\u90e8\u6307\u6807 API \u7684\u5b9e\u73b0\uff0c\u4e0e CloudWatch \u6307\u6807\u96c6\u6210\u3002\u5b83\u5141\u8bb8\u60a8\u4f7f\u7528 CloudWatch \u6307\u6807\u901a\u8fc7\u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29\u5668 (HPA) \u6269\u7f29\u60a8\u7684 Kubernetes \u90e8\u7f72\u3002</p> <p>\u6709\u5173\u4f7f\u7528 CPU \u7b49\u8d44\u6e90\u6307\u6807\u8fdb\u884c\u6269\u7f29\u7684\u793a\u4f8b\uff0c\u8bf7\u6309\u7167 https://eksworkshop.com/beginner/080_scaling/test_hpa/ \u90e8\u7f72\u793a\u4f8b\u5e94\u7528\u7a0b\u5e8f\u3001\u6267\u884c\u7b80\u5355\u7684\u8d1f\u8f7d\u6d4b\u8bd5\u4ee5\u6d4b\u8bd5 Pod \u81ea\u52a8\u6269\u7f29\uff0c\u5e76\u6a21\u62df Pod \u81ea\u52a8\u6269\u7f29\u3002</p> <p>\u53c2\u8003\u6b64\u535a\u5ba2\u4e86\u89e3\u5e94\u7528\u7a0b\u5e8f\u81ea\u5b9a\u4e49\u6307\u6807\u7684\u793a\u4f8b\uff0c\u4ee5\u6839\u636e Amazon SQS (Simple Queue Service) \u961f\u5217\u4e2d\u7684\u6d88\u606f\u6570\u91cf\u8fdb\u884c\u6269\u7f29\u3002</p> <p>\u6765\u81ea\u535a\u5ba2\u7684 Amazon SQS \u5916\u90e8\u6307\u6807\u793a\u4f8b\uff1a</p> <pre><code>apiVersion: metrics.aws/v1alpha1\nkind: ExternalMetric:\n  metadata:\n    name: hello-queue-length\n  spec:\n    name: hello-queue-length\n    resource:\n      resource: \"deployment\"\n    queries:\n      - id: sqs_helloworld\n        metricStat:\n          metric:\n            namespace: \"AWS/SQS\"\n            metricName: \"ApproximateNumberOfMessagesVisible\"\n            dimensions:\n              - name: QueueName\n                value: \"helloworld\"\n          period: 300\n          stat: Average\n          unit: Count\n        returnData: true\n</code></pre> <p>\u5229\u7528\u6b64\u5916\u90e8\u6307\u6807\u7684 HPA \u793a\u4f8b\uff1a</p> <pre><code>kind: HorizontalPodAutoscaler\napiVersion: autoscaling/v2beta1\nmetadata:\n  name: sqs-consumer-scaler\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1beta1\n    kind: Deployment\n    name: sqs-consumer\n  minReplicas: 1\n  maxReplicas: 10\n  metrics:\n  - type: External\n    external:\n      metricName: hello-queue-length\n      targetAverageValue: 30\n</code></pre> <p>\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7528\u4e8e Kubernetes \u5de5\u4f5c\u8282\u70b9\uff0c\u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29\u5668\u7528\u4e8e Pod\uff0c\u5c06\u786e\u4fdd\u914d\u7f6e\u7684\u8d44\u6e90\u5c3d\u53ef\u80fd\u63a5\u8fd1\u5b9e\u9645\u5229\u7528\u7387\u3002</p> <p> (\u56fe\u7247\u6765\u6e90\uff1a https://aws.amazon.com/blogs/containers/cost-optimization-for-kubernetes-on-aws/)</p> <p>Amazon EKS with Fargate</p> <p>*\u6c34\u5e73 Pod \u81ea\u52a8\u6269\u7f29*</p> <p>\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u673a\u5236\u5b9e\u73b0 Fargate \u4e0a\u7684 EKS \u81ea\u52a8\u6269\u7f29\uff1a</p> <ol> <li>\u4f7f\u7528 Kubernetes \u6307\u6807\u670d\u52a1\u5668\u5e76\u57fa\u4e8e CPU \u548c/\u6216\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u914d\u7f6e\u81ea\u52a8\u6269\u7f29\u3002</li> <li>\u57fa\u4e8e HTTP \u6d41\u91cf\u7b49\u81ea\u5b9a\u4e49\u6307\u6807\u4f7f\u7528 Prometheus \u548c Prometheus \u6307\u6807\u9002\u914d\u5668\u914d\u7f6e\u81ea\u52a8\u6269\u7f29</li> <li>\u57fa\u4e8e App Mesh \u6d41\u91cf\u914d\u7f6e\u81ea\u52a8\u6269\u7f29</li> </ol> <p>\u4e0a\u8ff0\u573a\u666f\u5728\u4e00\u7bc7\u5173\u4e8e\"\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u6807\u81ea\u52a8\u6269\u7f29 EKS on Fargate\"\u7684\u5b9e\u8df5\u535a\u5ba2\u4e2d\u6709\u89e3\u91ca\u3002</p> <p>*\u5782\u76f4 Pod \u81ea\u52a8\u6269\u7f29*</p> <p>\u5bf9\u4e8e\u5728 Fargate \u4e0a\u8fd0\u884c\u7684 Pod\uff0c\u4f7f\u7528\u5782\u76f4 Pod \u81ea\u52a8\u6269\u7f29\u5668\u6765\u4f18\u5316\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7684 CPU \u548c\u5185\u5b58\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u66f4\u6539 Pod \u7684\u8d44\u6e90\u5206\u914d\u9700\u8981\u91cd\u65b0\u542f\u52a8 Pod\uff0c\u56e0\u6b64\u5fc5\u987b\u5c06 Pod \u66f4\u65b0\u7b56\u7565\u8bbe\u7f6e\u4e3a Auto \u6216 Recreate \u4ee5\u786e\u4fdd\u6b63\u786e\u529f\u80fd\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#_4","title":"\u5efa\u8bae","text":""},{"location":"zh/cost_optimization/cost-effective/#kubernetes-statefulset-horizontalpodautoscaler","title":"\u4f7f\u7528\u7f29\u51cf\u6765\u5728\u975e\u5de5\u4f5c\u65f6\u95f4\u7f29\u51cf Kubernetes \u90e8\u7f72\u3001StatefulSet \u548c/\u6216 HorizontalPodAutoscaler\u3002","text":"<p>\u4f5c\u4e3a\u63a7\u5236\u6210\u672c\u7684\u4e00\u90e8\u5206\uff0c\u7f29\u51cf\u672a\u4f7f\u7528\u7684\u8d44\u6e90\u4e5f\u53ef\u4ee5\u5bf9\u603b\u4f53\u6210\u672c\u4ea7\u751f\u5de8\u5927\u5f71\u54cd\u3002\u6709\u4e00\u4e9b\u5de5\u5177\uff0c\u5982 kube-downscaler \u548c Descheduler for Kubernetes\u3002</p> <p>Kube-descaler \u53ef\u7528\u4e8e\u5728\u5de5\u4f5c\u65f6\u95f4\u540e\u6216\u5728\u8bbe\u5b9a\u7684\u65f6\u95f4\u6bb5\u5185\u7f29\u51cf Kubernetes \u90e8\u7f72\u3002</p> <p>Descheduler for Kubernetes \u6839\u636e\u5176\u7b56\u7565\uff0c\u53ef\u4ee5\u627e\u5230\u53ef\u4ee5\u79fb\u52a8\u7684 Pod \u5e76\u5c06\u5176\u9a71\u9010\u3002\u5728\u5f53\u524d\u5b9e\u73b0\u4e2d\uff0ckubernetes descheduler \u4e0d\u4f1a\u91cd\u65b0\u8c03\u5ea6\u88ab\u9a71\u9010\u7684 Pod\uff0c\u800c\u662f\u4f9d\u8d56\u9ed8\u8ba4\u8c03\u5ea6\u5668\u3002</p> <p>Kube-descaler</p> <p>\u5b89\u88c5 kube-downscaler: <pre><code>git clone https://github.com/hjacobs/kube-downscaler\ncd kube-downscaler\nkubectl apply -k deploy/\n</code></pre></p> <p>\u793a\u4f8b\u914d\u7f6e\u4f7f\u7528 --dry-run \u4f5c\u4e3a\u5b89\u5168\u6807\u5fd7\u4ee5\u9632\u6b62\u7f29\u51cf --- \u901a\u8fc7\u7f16\u8f91\u90e8\u7f72\u6765\u5220\u9664\u5b83\u4ee5\u542f\u7528\u7f29\u51cf\u5668\uff1a <pre><code>$ kubectl edit deploy kube-downscaler\n</code></pre></p> <p>\u90e8\u7f72\u4e00\u4e2a nginx pod \u5e76\u5b89\u6392\u5b83\u5728\u65f6\u533a - \u5468\u4e00\u81f3\u5468\u4e94 09\uff1a00-17:00 Asia/Kolkata \u8fd0\u884c\uff1a <pre><code>$ kubectl run nginx1 --image=nginx\n$ kubectl annotate deploy nginx1 'downscaler/uptime=Mon-Fri 09:00-17:00 Asia/Kolkata'\n</code></pre></p> <p>Note</p> <p>\u9ed8\u8ba4 15 \u5206\u949f\u7684\u5bbd\u9650\u671f\u9002\u7528\u4e8e\u65b0\u7684 nginx \u90e8\u7f72\uff0c\u5373\u5982\u679c\u5f53\u524d\u65f6\u95f4\u4e0d\u5728\u5468\u4e00\u81f3\u5468\u4e94 9-17 (Asia/Kolkata \u65f6\u533a)\uff0c\u5b83\u5c06\u4e0d\u4f1a\u7acb\u5373\u7f29\u51cf\uff0c\u800c\u662f\u5728 15 \u5206\u949f\u540e\u7f29\u51cf\u3002</p> <p></p> <p>\u66f4\u9ad8\u7ea7\u7684\u7f29\u51cf\u90e8\u7f72\u573a\u666f\u53ef\u5728 kube-down-scaler github \u9879\u76ee\u4e2d\u627e\u5230\u3002</p> <p>Kubernetes descheduler</p> <p>Descheduler \u53ef\u4ee5\u4f5c\u4e3a\u4f5c\u4e1a\u6216 CronJob \u5728 k8s \u96c6\u7fa4\u5185\u8fd0\u884c\u3002Descheduler \u7684\u7b56\u7565\u662f\u53ef\u914d\u7f6e\u7684\uff0c\u5e76\u5305\u62ec\u53ef\u542f\u7528\u6216\u7981\u7528\u7684\u7b56\u7565\u3002\u76ee\u524d\u5df2\u5b9e\u73b0\u4e86\u4e03\u79cd\u7b56\u7565 RemoveDuplicates\u3001LowNodeUtilization\u3001RemovePodsViolatingInterPodAntiAffinity\u3001RemovePodsViolatingNodeAffinity\u3001RemovePodsViolatingNodeTaints\u3001RemovePodsHavingTooManyRestarts \u548c PodLifeTime\u3002\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u53ef\u5728\u5176\u6587\u6863\u4e2d\u627e\u5230\u3002</p> <p>\u4e00\u4e2a\u793a\u4f8b\u7b56\u7565\uff0c\u5176\u4e2d descheduler \u9488\u5bf9\u8282\u70b9\u7684\u4f4e CPU \u5229\u7528\u7387(\u6db5\u76d6\u4e86\u5229\u7528\u7387\u4e0d\u8db3\u548c\u8fc7\u9ad8\u7684\u573a\u666f)\u3001\u5220\u9664\u91cd\u542f\u8fc7\u591a\u7684 Pod \u7b49\u542f\u7528\uff1a</p> <pre><code>apiVersion: \"descheduler/v1alpha1\"\nkind: \"DeschedulerPolicy\"\nstrategies:\n  \"RemoveDuplicates\":\n     enabled: true\n  \"RemovePodsViolatingInterPodAntiAffinity\":\n     enabled: true\n  \"LowNodeUtilization\":\n     enabled: true\n     params:\n       nodeResourceUtilizationThresholds:\n         thresholds:\n           \"cpu\" : 20\n           \"memory\": 20\n           \"pods\": 20\n         targetThresholds:\n           \"cpu\" : 50\n           \"memory\": 50\n           \"pods\": 50\n  \"RemovePodsHavingTooManyRestarts\":\n     enabled: true\n     params:\n       podsHavingTooManyRestarts:\n         podRestartThresholds: 100\n         includingInitContainers: true\n</code></pre> <p>\u96c6\u7fa4\u5173\u95ed</p> <p>\u96c6\u7fa4\u5173\u95ed\u662f\u6839\u636e\u81ea\u5b9a\u4e49\u8ba1\u5212\u548c\u5173\u95ed\u6761\u4ef6\u81ea\u52a8\u7f29\u51cf\u548c\u6269\u5c55 Kubernetes \u96c6\u7fa4\u7684\u540e\u7aef\u8282\u70b9\u3002\u6b64\u529f\u80fd\u53ef\u7528\u4e8e\u5728\u95f2\u7f6e\u65f6\u95f4\u51cf\u5c11\u652f\u51fa\u548c/\u6216\u51cf\u5c11\u5b89\u5168\u98ce\u9669\u9762\u3002\u6700\u5e38\u89c1\u7684\u7528\u4f8b\u662f\u5728\u975e\u5de5\u4f5c\u65f6\u95f4\u5c06\u975e\u751f\u4ea7\u73af\u5883(\u4f8b\u5982\u5f00\u53d1\u96c6\u7fa4)\u7f29\u51cf\u4e3a\u96f6\u3002\u96c6\u7fa4\u5173\u95ed\u76ee\u524d\u5904\u4e8e ALPHA \u53d1\u5e03\u9636\u6bb5\u3002</p> <p>\u96c6\u7fa4\u5173\u95ed\u4f7f\u7528 Kubernetes \u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\u6765\u521b\u5efa\u8ba1\u5212\u3002\u4ee5\u4e0b\u8ba1\u5212\u5c06\u5728\u6307\u5b9a\u7684\u5f00\u59cb\u65e5\u671f\u65f6\u95f4\u521b\u5efa\u4e00\u4e2a\u8ba1\u5212\uff0c\u5e76\u5728\u6307\u5b9a\u7684\u7ed3\u675f\u65e5\u671f\u65f6\u95f4\u5173\u95ed(\u65f6\u95f4\u5e94\u4e3a RFC3339 \u683c\u5f0f\uff0c\u5373\u57fa\u4e8e\u4e0e UTC \u7684\u504f\u79fb\u7684\u65f6\u95f4)\u3002</p> <pre><code>apiVersion: kubecost.k8s.io/v1alpha1\nkind: TurndownSchedule\nmetadata:\n  name: example-schedule\n  finalizers:\n  - \"finalizer.kubecost.k8s.io\"\nspec:\n  start: 2020-03-12T00:00:00Z\n  end: 2020-03-12T12:00:00Z\n  repeat: daily\n</code></pre>"},{"location":"zh/cost_optimization/cost-effective/#limitranges-resourcequotas","title":"\u4f7f\u7528 LimitRanges \u548c ResourceQuotas \u6765\u5e2e\u52a9\u7ba1\u7406\u6210\u672c\uff0c\u9650\u5236\u5728\u547d\u540d\u7a7a\u95f4\u7ea7\u522b\u5206\u914d\u7684\u8d44\u6e90\u91cf","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bb9\u5668\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u8fd0\u884c\u65f6\u5177\u6709\u65e0\u9650\u5236\u7684\u8ba1\u7b97\u8d44\u6e90\u3002\u901a\u8fc7\u8d44\u6e90\u914d\u989d\uff0c\u96c6\u7fa4\u7ba1\u7406\u5458\u53ef\u4ee5\u9650\u5236\u57fa\u4e8e\u547d\u540d\u7a7a\u95f4\u7684\u8d44\u6e90\u6d88\u8017\u548c\u521b\u5efa\u3002\u5728\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\uff0cPod \u6216\u5bb9\u5668\u53ef\u4ee5\u6d88\u8017\u7531\u8be5\u547d\u540d\u7a7a\u95f4\u7684\u8d44\u6e90\u914d\u989d\u5b9a\u4e49\u7684 CPU \u548c\u5185\u5b58\u3002\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5373\u4e00\u4e2a Pod \u6216\u5bb9\u5668\u53ef\u80fd\u4f1a\u5784\u65ad\u6240\u6709\u53ef\u7528\u8d44\u6e90\u3002</p> <p>Kubernetes \u4f7f\u7528\u8d44\u6e90\u914d\u989d\u548c\u9650\u5236\u8303\u56f4\u6765\u63a7\u5236 CPU\u3001\u5185\u5b58\u3001PersistentVolumeClaims \u548c\u5176\u4ed6\u8d44\u6e90\u7684\u5206\u914d\u3002ResourceQuota \u5728\u547d\u540d\u7a7a\u95f4\u7ea7\u522b\uff0c\u800c LimitRange \u5728\u5bb9\u5668\u7ea7\u522b\u5e94\u7528\u3002</p> <p>\u9650\u5236\u8303\u56f4</p> <p>LimitRange \u662f\u4e00\u79cd\u7b56\u7565\uff0c\u7528\u4e8e\u7ea6\u675f\u547d\u540d\u7a7a\u95f4\u4e2d\u8d44\u6e90\u7684\u5206\u914d(\u5bf9 Pod \u6216\u5bb9\u5668)\u3002</p> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528\u9650\u5236\u8303\u56f4\u8bbe\u7f6e\u9ed8\u8ba4\u5185\u5b58\u8bf7\u6c42\u548c\u9ed8\u8ba4\u5185\u5b58\u9650\u5236\u7684\u793a\u4f8b\u3002</p> <pre><code>apiVersion: v1\nkind: LimitRange\nmetadata:\n  name: mem-limit-range\nspec:\n  limits:\n  - default:\n      memory: 512Mi\n    defaultRequest:\n      memory: 256Mi\n    type: Container\n</code></pre> <p>\u66f4\u591a\u793a\u4f8b\u53ef\u5728 Kubernetes \u6587\u6863\u4e2d\u627e\u5230\u3002</p> <p>\u8d44\u6e90\u914d\u989d</p> <p>\u5f53\u591a\u4e2a\u7528\u6237\u6216\u56e2\u961f\u5728\u5177\u6709\u56fa\u5b9a\u8282\u70b9\u6570\u7684\u96c6\u7fa4\u4e0a\u5171\u4eab\u65f6\uff0c\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5373\u4e00\u4e2a\u56e2\u961f\u53ef\u80fd\u4f1a\u4f7f\u7528\u8d85\u51fa\u5176\u516c\u5e73\u4efd\u989d\u7684\u8d44\u6e90\u3002\u8d44\u6e90\u914d\u989d\u662f\u7ba1\u7406\u5458\u89e3\u51b3\u6b64\u95ee\u9898\u7684\u4e00\u79cd\u5de5\u5177\u3002</p> <p>\u4ee5\u4e0b\u662f\u5982\u4f55\u5728 ResourceQuota \u5bf9\u8c61\u4e2d\u6307\u5b9a\u914d\u989d\u6765\u8bbe\u7f6e\u6240\u6709\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u8fd0\u884c\u7684\u5bb9\u5668\u53ef\u4ee5\u4f7f\u7528\u7684\u603b\u5185\u5b58\u548c CPU \u91cf\u7684\u793a\u4f8b\u3002\u8fd9\u6307\u5b9a\u5bb9\u5668\u5fc5\u987b\u6709\u5185\u5b58\u8bf7\u6c42\u3001\u5185\u5b58\u9650\u5236\u3001CPU \u8bf7\u6c42\u548c CPU \u9650\u5236\uff0c\u5e76\u4e14\u4e0d\u5e94\u8d85\u8fc7\u5728 ResourceQuota \u4e2d\u8bbe\u7f6e\u7684\u9608\u503c\u3002</p> <pre><code>apiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: mem-cpu-demo\nspec:\n  hard:\n    requests.cpu: \"1\"\n    requests.memory: 1Gi\n    limits.cpu: \"2\"\n    limits.memory: 2Gi\n</code></pre> <p>\u66f4\u591a\u793a\u4f8b\u53ef\u5728 Kubernetes \u6587\u6863\u4e2d\u627e\u5230\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#_5","title":"\u4f7f\u7528\u5b9a\u4ef7\u6a21\u578b\u5b9e\u73b0\u6709\u6548\u5229\u7528","text":"<p>Amazon EKS \u7684\u5b9a\u4ef7\u8be6\u60c5\u5728\u5b9a\u4ef7\u9875\u9762\u4e2d\u7ed9\u51fa\u3002\u65e0\u8bba\u662f Amazon EKS on Fargate \u8fd8\u662f EC2\uff0c\u63a7\u5236\u5e73\u9762\u6210\u672c\u90fd\u662f\u901a\u7528\u7684\u3002</p> <p>\u5982\u679c\u60a8\u4f7f\u7528 AWS Fargate\uff0c\u5b9a\u4ef7\u662f\u6839\u636e\u4ece\u5f00\u59cb\u4e0b\u8f7d\u5bb9\u5668\u6620\u50cf\u5230 Amazon EKS Pod \u7ec8\u6b62\u65f6\u4f7f\u7528\u7684 vCPU \u548c\u5185\u5b58\u8d44\u6e90\u8ba1\u7b97\u7684\uff0c\u7cbe\u786e\u5230\u6700\u8fd1\u7684\u79d2\u3002\u6700\u4f4e\u6536\u8d39\u4e3a 1 \u5206\u949f\u3002\u8bf7\u53c2\u9605 AWS Fargate \u5b9a\u4ef7\u9875\u9762\u4e0a\u7684\u8be6\u7ec6\u5b9a\u4ef7\u4fe1\u606f\u3002</p> <p>Amazon EKS on EC2:</p> <p>Amazon EC2 \u63d0\u4f9b\u4e86\u5404\u79cd\u5b9e\u4f8b\u7c7b\u578b,\u9488\u5bf9\u4e0d\u540c\u7528\u4f8b\u8fdb\u884c\u4e86\u4f18\u5316\u3002\u5b9e\u4f8b\u7c7b\u578b\u5305\u62ec\u4e0d\u540c\u7ec4\u5408\u7684 CPU\u3001\u5185\u5b58\u3001\u5b58\u50a8\u548c\u7f51\u7edc\u5bb9\u91cf\uff0c\u8ba9\u60a8\u53ef\u4ee5\u7075\u6d3b\u9009\u62e9\u9002\u5408\u76ee\u6807\u5de5\u4f5c\u8d1f\u8f7d\u7684\u9002\u5f53\u8d44\u6e90\u7ec4\u5408\u3002\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u5305\u62ec\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9e\u4f8b\u5927\u5c0f\uff0c\u5141\u8bb8\u60a8\u5c06\u8d44\u6e90\u6269\u5c55\u5230\u76ee\u6807\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8981\u6c42\u3002</p> <p>\u9664\u4e86 CPU \u6570\u91cf\u3001\u5185\u5b58\u3001\u5904\u7406\u5668\u7cfb\u5217\u7c7b\u578b\u4e4b\u5916\uff0c\u5b9e\u4f8b\u7c7b\u578b\u7684\u4e00\u4e2a\u5173\u952e\u51b3\u7b56\u53c2\u6570\u662f\u5f39\u6027\u7f51\u7edc\u63a5\u53e3(ENI)\u7684\u6570\u91cf,\u8fd9\u53cd\u8fc7\u6765\u4f1a\u5f71\u54cd\u60a8\u53ef\u4ee5\u5728\u8be5 EC2 \u5b9e\u4f8b\u4e0a\u8fd0\u884c\u7684\u6700\u5927 Pod \u6570\u91cf\u3002\u6bcf\u79cd EC2 \u5b9e\u4f8b\u7c7b\u578b\u7684\u6700\u5927 Pod \u6570\u91cf\u5217\u8868\u7ef4\u62a4\u5728 github \u4e0a\u3002</p> <p>*\u6309\u9700 EC2 \u5b9e\u4f8b\uff1a*</p> <p>\u4f7f\u7528\u6309\u9700\u5b9e\u4f8b,\u60a8\u53ef\u4ee5\u6309\u5c0f\u65f6\u6216\u79d2\u4ed8\u8d39\u4f7f\u7528\u8ba1\u7b97\u5bb9\u91cf\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u60a8\u8fd0\u884c\u7684\u5b9e\u4f8b\u3002\u4e0d\u9700\u8981\u957f\u671f\u627f\u8bfa\u6216\u9884\u4ed8\u8d39\u7528\u3002</p> <p>Amazon EC2 A1 \u5b9e\u4f8b\u63d0\u4f9b\u4e86\u663e\u8457\u7684\u6210\u672c\u8282\u7701\uff0c\u975e\u5e38\u9002\u5408\u7531\u5e7f\u6cdb\u7684 Arm \u751f\u6001\u7cfb\u7edf\u652f\u6301\u7684\u6269\u5c55\u548c\u57fa\u4e8e ARM \u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\u60a8\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 Amazon Elastic Container Service for Kubernetes (EKS) \u4f5c\u4e3a\u516c\u5f00\u5f00\u53d1\u8005\u9884\u89c8\u7248\u7684\u4e00\u90e8\u5206\u5728 Amazon EC2 A1 \u5b9e\u4f8b\u4e0a\u8fd0\u884c\u5bb9\u5668\u3002Amazon ECR \u73b0\u5728\u652f\u6301\u591a\u67b6\u6784\u5bb9\u5668\u6620\u50cf,\u8fd9\u7b80\u5316\u4e86\u4ece\u540c\u4e00\u6620\u50cf\u5b58\u50a8\u5e93\u90e8\u7f72\u4e0d\u540c\u67b6\u6784\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5bb9\u5668\u6620\u50cf\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 AWS \u7b80\u5355\u6708\u5ea6\u8ba1\u7b97\u5668\u6216\u65b0\u7684\u5b9a\u4ef7\u8ba1\u7b97\u5668\u83b7\u53d6 EKS \u5de5\u4f5c\u8282\u70b9\u7684\u6309\u9700 EC2 \u5b9e\u4f8b\u5b9a\u4ef7\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#spot-ec2","title":"\u4f7f\u7528 Spot EC2 \u5b9e\u4f8b\uff1a","text":"<p>Amazon EC2 Spot \u5b9e\u4f8b\u5141\u8bb8\u60a8\u4ee5\u9ad8\u8fbe\u6309\u9700\u4ef7\u683c\u7684 90% \u7684\u6298\u6263\u8bf7\u6c42 Amazon EC2 \u7684\u5907\u7528\u8ba1\u7b97\u80fd\u529b\u3002</p> <p>Spot \u5b9e\u4f8b\u901a\u5e38\u975e\u5e38\u9002\u5408\u65e0\u72b6\u6001\u7684\u5bb9\u5668\u5316\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u56e0\u4e3a\u5bb9\u5668\u548c Spot \u5b9e\u4f8b\u7684\u65b9\u6cd5\u7c7b\u4f3c;\u4e34\u65f6\u548c\u81ea\u52a8\u6269\u7f29\u5bb9\u91cf\u3002\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u90fd\u53ef\u4ee5\u6dfb\u52a0\u548c\u5220\u9664\uff0c\u540c\u65f6\u9075\u5b88 SLA \u5e76\u4e14\u4e0d\u4f1a\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\u6216\u53ef\u7528\u6027\u3002</p> <p>\u60a8\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u8282\u70b9\u7ec4\uff0c\u5176\u4e2d\u5305\u542b\u6309\u9700\u5b9e\u4f8b\u7c7b\u578b\u548c EC2 Spot \u5b9e\u4f8b\u7684\u6df7\u5408\uff0c\u4ee5\u5229\u7528\u8fd9\u4e24\u79cd\u5b9e\u4f8b\u7c7b\u578b\u4e4b\u95f4\u7684\u5b9a\u4ef7\u4f18\u52bf\u3002</p> <p> (\u56fe\u7247\u6765\u6e90\uff1a https://ec2spotworkshops.com/using_ec2_spot_instances_with_eks/spotworkers/workers_eksctl.html)</p> <p>\u4e0b\u9762\u662f\u4f7f\u7528 eksctl \u521b\u5efa EC2 Spot \u5b9e\u4f8b\u8282\u70b9\u7ec4\u7684\u793a\u4f8b yaml \u6587\u4ef6\u3002\u5728\u521b\u5efa\u8282\u70b9\u7ec4\u671f\u95f4\uff0c\u6211\u4eec\u914d\u7f6e\u4e86\u4e00\u4e2a\u8282\u70b9\u6807\u7b7e\uff0c\u4ee5\u4fbf kubernetes \u77e5\u9053\u6211\u4eec\u914d\u7f6e\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u8282\u70b9\u3002\u6211\u4eec\u5c06\u8282\u70b9\u7684\u751f\u547d\u5468\u671f\u8bbe\u7f6e\u4e3a Ec2Spot\u3002\u6211\u4eec\u8fd8\u4f7f\u7528 PreferNoSchedule \u8fdb\u884c\u4e86\u6c61\u70b9\uff0c\u4ee5\u4f18\u5148\u4e0d\u5c06 Pod \u8c03\u5ea6\u5230 Spot \u5b9e\u4f8b\u4e0a\u3002\u8fd9\u662f\u4e00\u79cd\"\u4f18\u5148\"\u6216\"\u8f6f\"\u7248\u672c\u7684 NoSchedule\uff0c\u5373\u7cfb\u7edf\u5c06\u5c1d\u8bd5\u907f\u514d\u5c06\u4e0d\u5bb9\u5fcd\u6c61\u70b9\u7684 Pod \u653e\u7f6e\u5728\u8282\u70b9\u4e0a\uff0c\u4f46\u8fd9\u4e0d\u662f\u5fc5\u9700\u7684\u3002\u6211\u4eec\u4f7f\u7528\u8fd9\u79cd\u6280\u672f\u6765\u786e\u4fdd\u53ea\u6709\u6b63\u786e\u7c7b\u578b\u7684\u5de5\u4f5c\u8d1f\u8f7d\u624d\u4f1a\u8c03\u5ea6\u5230 Spot \u5b9e\u4f8b\u4e0a\u3002</p> <p><pre><code>apiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\nmetadata:\n  name: my-cluster-testscaling\n  region: us-west-2\nnodeGroups:\n  - name: ng-spot\n    labels:\n      lifecycle: Ec2Spot\n    taints:\n      spotInstance: true:PreferNoSchedule\n    minSize: 2\n    maxSize: 5\n    instancesDistribution: # \u5e94\u81f3\u5c11\u6307\u5b9a\u4e24\u79cd\u5b9e\u4f8b\u7c7b\u578b\n      instanceTypes:\n        - m4.large\n        - c4.large\n        - c5.large\n      onDemandBaseCapacity: 0\n      onDemandPercentageAboveBaseCapacity: 0 # \u6240\u6709\u5b9e\u4f8b\u90fd\u5c06\u662f Spot \u5b9e\u4f8b\n      spotInstancePools: 2\n</code></pre> \u4f7f\u7528\u8282\u70b9\u6807\u7b7e\u6765\u8bc6\u522b\u8282\u70b9\u7684\u751f\u547d\u5468\u671f\u3002 <pre><code>$ kubectl get nodes --label-columns=lifecycle --selector=lifecycle=Ec2Spot\n</code></pre></p> <p>\u6211\u4eec\u8fd8\u5e94\u8be5\u5728\u6bcf\u4e2a Spot \u5b9e\u4f8b\u4e0a\u90e8\u7f72 AWS \u8282\u70b9\u7ec8\u6b62\u5904\u7406\u7a0b\u5e8f\u3002\u5b83\u5c06\u76d1\u89c6\u5b9e\u4f8b\u4e0a\u7684 EC2 \u5143\u6570\u636e\u670d\u52a1\u4ee5\u83b7\u53d6\u4e2d\u65ad\u901a\u77e5\u3002\u7ec8\u6b62\u5904\u7406\u7a0b\u5e8f\u7531 ServiceAccount\u3001ClusterRole\u3001ClusterRoleBinding \u548c DaemonSet \u7ec4\u6210\u3002AWS \u8282\u70b9\u7ec8\u6b62\u5904\u7406\u7a0b\u5e8f\u4e0d\u4ec5\u9002\u7528\u4e8e Spot \u5b9e\u4f8b\uff0c\u8fd8\u53ef\u4ee5\u6355\u83b7\u4e00\u822c EC2 \u7ef4\u62a4\u4e8b\u4ef6\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u96c6\u7fa4\u7684\u6240\u6709\u5de5\u4f5c\u8282\u70b9\u4e0a\u4f7f\u7528\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u4f7f\u7528\u4e86\u826f\u597d\u7684\u591a\u6837\u5316\u548c\u5bb9\u91cf\u4f18\u5316\u5206\u914d\u7b56\u7565\uff0cSpot \u5b9e\u4f8b\u5c06\u53ef\u7528\u3002\u60a8\u53ef\u4ee5\u5728\u6e05\u5355\u6587\u4ef6\u4e2d\u4f7f\u7528\u8282\u70b9\u4eb2\u548c\u529b\u6765\u8fdb\u884c\u914d\u7f6e\uff0c\u4ee5\u4f18\u5148\u4f7f\u7528 Spot \u5b9e\u4f8b\uff0c\u4f46\u4e0d\u662f\u5fc5\u9700\u7684\u3002\u8fd9\u5c06\u5141\u8bb8\u5728\u6ca1\u6709\u53ef\u7528\u6216\u6b63\u786e\u6807\u8bb0\u7684 Spot \u5b9e\u4f8b\u65f6\uff0c\u5c06 Pod \u8c03\u5ea6\u5230\u6309\u9700\u8282\u70b9\u4e0a\u3002</p> <pre><code>affinity:\nnodeAffinity:\n  preferredDuringSchedulingIgnoredDuringExecution:\n  - weight: 1\n    preference:\n      matchExpressions:\n      - key: lifecycle\n        operator: In\n        values:\n        - Ec2Spot\ntolerations:\n- key: \"spotInstance\"\noperator: \"Equal\"\nvalue: \"true\"\neffect: \"PreferNoSchedule\"\n</code></pre> <p>\u60a8\u53ef\u4ee5\u5728\u5728\u7ebf EC2 Spot \u7814\u8ba8\u4f1a\u4e0a\u5b8c\u6210\u6709\u5173 EC2 Spot \u5b9e\u4f8b\u7684\u5b8c\u6574\u7814\u8ba8\u4f1a\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#_6","title":"\u4f7f\u7528\u8ba1\u7b97\u8282\u7701\u8ba1\u5212","text":"<p>\u8ba1\u7b97\u8282\u7701\u8ba1\u5212\u662f\u4e00\u79cd\u7075\u6d3b\u7684\u6298\u6263\u6a21\u5f0f\uff0c\u5b83\u63d0\u4f9b\u4e0e\u9884\u7559\u5b9e\u4f8b\u76f8\u540c\u7684\u6298\u6263\uff0c\u4f5c\u4e3a\u5728\u4e00\u5e74\u6216\u4e09\u5e74\u671f\u5185\u4f7f\u7528\u7279\u5b9a\u91d1\u989d(\u4ee5\u7f8e\u5143/\u5c0f\u65f6\u8ba1)\u8ba1\u7b97\u80fd\u529b\u7684\u627f\u8bfa\u3002\u8be6\u7ec6\u4fe1\u606f\u5728\u8282\u7701\u8ba1\u5212\u53d1\u5e03\u5e38\u89c1\u95ee\u9898\u89e3\u7b54\u4e2d\u4ecb\u7ecd\u3002\u8fd9\u4e9b\u8ba1\u5212\u4f1a\u81ea\u52a8\u5e94\u7528\u4e8e\u4efb\u4f55 EC2 \u5de5\u4f5c\u8282\u70b9\uff0c\u65e0\u8bba\u533a\u57df\u3001\u5b9e\u4f8b\u7cfb\u5217\u3001\u64cd\u4f5c\u7cfb\u7edf\u6216\u79df\u8d41\uff0c\u5305\u62ec\u4f5c\u4e3a EKS \u96c6\u7fa4\u4e00\u90e8\u5206\u7684\u8282\u70b9\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4ece C4 \u5207\u6362\u5230 C5 \u5b9e\u4f8b\uff0c\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u4ece\u90fd\u67cf\u6797\u79fb\u81f3\u4f26\u6566\uff0c\u5728\u6b64\u8fc7\u7a0b\u4e2d\u4ecd\u53ef\u4eab\u53d7\u8282\u7701\u8ba1\u5212\u4ef7\u683c\uff0c\u800c\u65e0\u9700\u505a\u4efb\u4f55\u64cd\u4f5c\u3002</p> <p>AWS \u6210\u672c\u8d44\u6e90\u7ba1\u7406\u5668\u5c06\u5e2e\u52a9\u60a8\u9009\u62e9\u8282\u7701\u8ba1\u5212\uff0c\u5e76\u6307\u5bfc\u60a8\u5b8c\u6210\u8d2d\u4e70\u6d41\u7a0b\u3002 </p> <p>\u6ce8\u610f - \u8ba1\u7b97\u8282\u7701\u8ba1\u5212\u73b0\u5728\u4e5f\u9002\u7528\u4e8e AWS Fargate for AWS Elastic Kubernetes Service (EKS)\u3002</p> <p>\u6ce8\u610f - \u4e0a\u8ff0\u5b9a\u4ef7\u4e0d\u5305\u62ec Kubernetes \u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f7f\u7528\u7684\u5176\u4ed6 AWS \u670d\u52a1\uff0c\u5982\u6570\u636e\u4f20\u8f93\u8d39\u7528\u3001CloudWatch\u3001Elastic Load Balancer \u548c\u5176\u4ed6 AWS \u670d\u52a1\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#_7","title":"\u8d44\u6e90","text":"<p>\u53c2\u8003\u4ee5\u4e0b\u8d44\u6e90\uff0c\u4e86\u89e3\u6709\u5173\u6210\u672c\u4f18\u5316\u6700\u4f73\u5b9e\u8df5\u7684\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"zh/cost_optimization/cost-effective/#_8","title":"\u89c6\u9891","text":"<ul> <li>AWS re:Invent 2019: \u5728 Spot \u5b9e\u4f8b\u4e0a\u4ee5\u9ad8\u8fbe 90% \u7684\u6298\u6263\u8fd0\u884c\u751f\u4ea7\u5de5\u4f5c\u8d1f\u8f7d (CMP331-R1)</li> </ul>"},{"location":"zh/cost_optimization/cost-effective/#_9","title":"\u6587\u6863\u548c\u535a\u5ba2","text":"<ul> <li>AWS \u4e0a Kubernetes \u7684\u6210\u672c\u4f18\u5316</li> <li>\u4f7f\u7528 Spot \u5b9e\u4f8b\u4e3a EKS \u6784\u5efa\u6210\u672c\u4f18\u5316\u548c\u5f39\u6027</li> <li>\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u6807\u81ea\u52a8\u6269\u7f29 EKS on Fargate</li> <li>AWS Fargate \u6ce8\u610f\u4e8b\u9879</li> <li>\u5728 EKS \u4e2d\u4f7f\u7528 Spot \u5b9e\u4f8b</li> <li>\u6269\u5c55 EKS API\uff1a \u6258\u7ba1\u8282\u70b9\u7ec4</li> <li>Amazon EKS \u81ea\u52a8\u6269\u7f29</li> <li>Amazon EKS \u5b9a\u4ef7</li> <li>AWS Fargate \u5b9a\u4ef7</li> <li>\u8282\u7701\u8ba1\u5212</li> <li>\u5728 AWS \u4e0a\u4f7f\u7528 Kubernetes \u8282\u7701\u4e91\u6210\u672c</li> </ul>"},{"location":"zh/cost_optimization/cost-effective/#_10","title":"\u5de5\u5177","text":"<ul> <li>Kube downscaler</li> <li>Kubernetes Descheduler</li> <li>Cluster TurnDown</li> </ul>"},{"location":"zh/cost_optimization/cost_opt_compute/","title":"\u6210\u672c\u4f18\u5316 - \u8ba1\u7b97\u548c\u81ea\u52a8\u6269\u7f29","text":"<p>\u4f5c\u4e3a\u5f00\u53d1\u4eba\u5458\uff0c\u60a8\u5c06\u5bf9\u5e94\u7528\u7a0b\u5e8f\u7684\u8d44\u6e90\u9700\u6c42\uff08\u5982 CPU \u548c\u5185\u5b58\uff09\u505a\u51fa\u4f30\u8ba1\uff0c\u4f46\u5982\u679c\u60a8\u4e0d\u6301\u7eed\u8c03\u6574\u5b83\u4eec\uff0c\u5b83\u4eec\u53ef\u80fd\u4f1a\u8fc7\u65f6\uff0c\u4ece\u800c\u589e\u52a0\u6210\u672c\u5e76\u964d\u4f4e\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002\u6301\u7eed\u8c03\u6574\u5e94\u7528\u7a0b\u5e8f\u7684\u8d44\u6e90\u9700\u6c42\u6bd4\u4e00\u5f00\u59cb\u5c31\u8bbe\u7f6e\u6b63\u786e\u66f4\u4e3a\u91cd\u8981\u3002</p> <p>\u4e0b\u9762\u63d0\u5230\u7684\u6700\u4f73\u5b9e\u8df5\u5c06\u5e2e\u52a9\u60a8\u6784\u5efa\u548c\u8fd0\u884c\u6210\u672c\u610f\u8bc6\u578b\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5b9e\u73b0\u4e1a\u52a1\u76ee\u6807\u7684\u540c\u65f6\u6700\u5c0f\u5316\u6210\u672c\uff0c\u8ba9\u60a8\u7684\u7ec4\u7ec7\u6700\u5927\u9650\u5ea6\u5730\u83b7\u5f97\u6295\u8d44\u56de\u62a5\u3002\u4f18\u5316\u96c6\u7fa4\u8ba1\u7b97\u6210\u672c\u7684\u9ad8\u7ea7\u91cd\u8981\u987a\u5e8f\u662f\uff1a</p> <ol> <li>\u6b63\u786e\u8c03\u6574\u5de5\u4f5c\u8d1f\u8f7d\u5927\u5c0f</li> <li>\u51cf\u5c11\u672a\u4f7f\u7528\u7684\u5bb9\u91cf</li> <li>\u4f18\u5316\u8ba1\u7b97\u5bb9\u91cf\u7c7b\u578b(\u5982 Spot)\u548c\u52a0\u901f\u5668(\u5982 GPU)</li> </ol>"},{"location":"zh/cost_optimization/cost_opt_compute/#_1","title":"\u6b63\u786e\u8c03\u6574\u5de5\u4f5c\u8d1f\u8f7d\u5927\u5c0f","text":"<p>\u5728\u5927\u591a\u6570 EKS \u96c6\u7fa4\u4e2d\uff0c\u6210\u672c\u7684\u4e3b\u8981\u90e8\u5206\u6765\u81ea\u7528\u4e8e\u8fd0\u884c\u5bb9\u5668\u5316\u5de5\u4f5c\u8d1f\u8f7d\u7684 EC2 \u5b9e\u4f8b\u3002\u5982\u679c\u4e0d\u4e86\u89e3\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8981\u6c42\uff0c\u60a8\u5c06\u65e0\u6cd5\u6b63\u786e\u8c03\u6574\u8ba1\u7b97\u8d44\u6e90\u5927\u5c0f\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u4f7f\u7528\u9002\u5f53\u7684\u8bf7\u6c42\u548c\u9650\u5236\u5e76\u6839\u636e\u9700\u8981\u8c03\u6574\u8fd9\u4e9b\u8bbe\u7f6e\u975e\u5e38\u91cd\u8981\u3002\u6b64\u5916\uff0c\u4f9d\u8d56\u5173\u7cfb(\u5982\u5b9e\u4f8b\u5927\u5c0f\u548c\u5b58\u50a8\u9009\u62e9)\u53ef\u80fd\u4f1a\u5f71\u54cd\u5de5\u4f5c\u8d1f\u8f7d\u6027\u80fd\uff0c\u4ece\u800c\u5bf9\u6210\u672c\u548c\u53ef\u9760\u6027\u4ea7\u751f\u5404\u79cd\u610f\u5916\u540e\u679c\u3002</p> <p>\u8bf7\u6c42\u5e94\u4e0e\u5b9e\u9645\u5229\u7528\u7387\u76f8\u5339\u914d\u3002\u5982\u679c\u5bb9\u5668\u7684\u8bf7\u6c42\u8fc7\u9ad8\uff0c\u5c06\u4f1a\u4ea7\u751f\u672a\u4f7f\u7528\u7684\u5bb9\u91cf\uff0c\u8fd9\u662f\u603b\u96c6\u7fa4\u6210\u672c\u7684\u4e00\u4e2a\u91cd\u8981\u56e0\u7d20\u3002\u6bcf\u4e2a pod \u4e2d\u7684\u6bcf\u4e2a\u5bb9\u5668(\u5982\u5e94\u7528\u7a0b\u5e8f\u548c sidecar)\u90fd\u5e94\u8be5\u6709\u81ea\u5df1\u7684\u8bf7\u6c42\u548c\u9650\u5236\u8bbe\u7f6e\uff0c\u4ee5\u786e\u4fdd pod \u7684\u603b\u9650\u5236\u5c3d\u53ef\u80fd\u51c6\u786e\u3002</p> <p>\u4f7f\u7528\u8bf8\u5982 Goldilocks\u3001KRR \u548c Kubecost \u7b49\u5de5\u5177\u6765\u4f30\u8ba1\u5bb9\u5668\u7684\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236\u3002\u6839\u636e\u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u8d28\u3001\u6027\u80fd/\u6210\u672c\u8981\u6c42\u548c\u590d\u6742\u6027\uff0c\u60a8\u9700\u8981\u8bc4\u4f30\u6700\u9002\u5408\u6269\u5c55\u7684\u6307\u6807\u3001\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u5f00\u59cb\u4e0b\u964d\u7684\u70b9(\u9971\u548c\u70b9)\u4ee5\u53ca\u5982\u4f55\u76f8\u5e94\u8c03\u6574\u8bf7\u6c42\u548c\u9650\u5236\u3002\u6709\u5173\u6b64\u4e3b\u9898\u7684\u66f4\u591a\u6307\u5bfc\uff0c\u8bf7\u53c2\u9605\u5e94\u7528\u7a0b\u5e8f\u6b63\u786e\u8c03\u6574\u5927\u5c0f\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 Horizontal Pod Autoscaler (HPA) \u6765\u63a7\u5236\u5e94\u8be5\u8fd0\u884c\u591a\u5c11\u4e2a\u5e94\u7528\u7a0b\u5e8f\u526f\u672c\uff0c\u4f7f\u7528 Vertical Pod Autoscaler (VPA) \u6765\u8c03\u6574\u6bcf\u4e2a\u526f\u672c\u6240\u9700\u7684\u8bf7\u6c42\u548c\u9650\u5236\uff0c\u4ee5\u53ca\u4f7f\u7528 Karpenter \u6216 Cluster Autoscaler \u7b49\u8282\u70b9\u81ea\u52a8\u6269\u7f29\u5668\u6765\u6301\u7eed\u8c03\u6574\u96c6\u7fa4\u4e2d\u7684\u603b\u8282\u70b9\u6570\u3002\u4f7f\u7528 Karpenter \u548c Cluster Autoscaler \u7684\u6210\u672c\u4f18\u5316\u6280\u672f\u5728\u672c\u6587\u6863\u7684\u540e\u9762\u90e8\u5206\u6709\u8bb0\u5f55\u3002</p> <p>Vertical Pod Autoscaler \u53ef\u4ee5\u8c03\u6574\u5206\u914d\u7ed9\u5bb9\u5668\u7684\u8bf7\u6c42\u548c\u9650\u5236\uff0c\u4ee5\u4fbf\u5de5\u4f5c\u8d1f\u8f7d\u4ee5\u6700\u4f73\u65b9\u5f0f\u8fd0\u884c\u3002\u60a8\u5e94\u8be5\u5728\u5ba1\u8ba1\u6a21\u5f0f\u4e0b\u8fd0\u884c VPA\uff0c\u8fd9\u6837\u5b83\u5c31\u4e0d\u4f1a\u81ea\u52a8\u8fdb\u884c\u66f4\u6539\u548c\u91cd\u65b0\u542f\u52a8\u60a8\u7684 pod\u3002\u5b83\u5c06\u6839\u636e\u89c2\u5bdf\u5230\u7684\u6307\u6807\u5efa\u8bae\u8fdb\u884c\u66f4\u6539\u3002\u5bf9\u4e8e\u5f71\u54cd\u751f\u4ea7\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4efb\u4f55\u66f4\u6539\uff0c\u60a8\u90fd\u5e94\u8be5\u9996\u5148\u5728\u975e\u751f\u4ea7\u73af\u5883\u4e2d\u5ba1\u67e5\u548c\u6d4b\u8bd5\u8fd9\u4e9b\u66f4\u6539\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u66f4\u6539\u53ef\u80fd\u4f1a\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u9760\u6027\u548c\u6027\u80fd\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#_2","title":"\u51cf\u5c11\u6d88\u8017","text":"<p>\u8282\u7701\u8d44\u91d1\u7684\u6700\u4f73\u65b9\u5f0f\u662f\u914d\u7f6e\u66f4\u5c11\u7684\u8d44\u6e90\u3002\u4e00\u79cd\u65b9\u6cd5\u662f\u6839\u636e\u5f53\u524d\u9700\u6c42\u8c03\u6574\u5de5\u4f5c\u8d1f\u8f7d\u3002\u60a8\u5e94\u8be5\u4ece\u786e\u4fdd\u5de5\u4f5c\u8d1f\u8f7d\u5b9a\u4e49\u4e86\u5176\u9700\u6c42\u5e76\u52a8\u6001\u6269\u5c55\u5f00\u59cb\u4efb\u4f55\u6210\u672c\u4f18\u5316\u5de5\u4f5c\u3002\u8fd9\u5c06\u9700\u8981\u4ece\u5e94\u7528\u7a0b\u5e8f\u83b7\u53d6\u6307\u6807\u5e76\u8bbe\u7f6e\u914d\u7f6e\uff0c\u5982 <code>PodDisruptionBudgets</code> \u548c Pod Readiness Gates,\u4ee5\u786e\u4fdd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5b89\u5168\u5730\u52a8\u6001\u6269\u5c55\u548c\u7f29\u51cf\u3002</p> <p>Horizontal Pod Autoscaler \u662f\u4e00\u4e2a\u7075\u6d3b\u7684\u5de5\u4f5c\u8d1f\u8f7d\u81ea\u52a8\u6269\u7f29\u5668\uff0c\u53ef\u4ee5\u6839\u636e\u5404\u79cd\u6307\u6807(\u5982 CPU\u3001\u5185\u5b58\u6216\u81ea\u5b9a\u4e49\u6307\u6807\uff0c\u5982\u961f\u5217\u6df1\u5ea6\u3001\u4e0e pod \u7684\u8fde\u63a5\u6570\u7b49)\u6765\u8c03\u6574\u6ee1\u8db3\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u548c\u53ef\u9760\u6027\u8981\u6c42\u6240\u9700\u7684\u526f\u672c\u6570\u3002</p> <p>Kubernetes Metrics Server \u652f\u6301\u6839\u636e\u5185\u7f6e\u6307\u6807(\u5982 CPU \u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5)\u8fdb\u884c\u6269\u7f29\uff0c\u4f46\u5982\u679c\u60a8\u60f3\u6839\u636e\u5176\u4ed6\u6307\u6807(\u5982 Amazon CloudWatch \u6216 SQS \u961f\u5217\u6df1\u5ea6)\u8fdb\u884c\u6269\u7f29\uff0c\u60a8\u5e94\u8be5\u8003\u8651\u4f7f\u7528\u57fa\u4e8e\u4e8b\u4ef6\u7684\u81ea\u52a8\u6269\u7f29\u9879\u76ee\uff0c\u5982 KEDA\u3002\u8bf7\u53c2\u9605\u6b64\u535a\u5ba2\u6587\u7ae0\u4e86\u89e3\u5982\u4f55\u5c06 KEDA \u4e0e CloudWatch \u6307\u6807\u4e00\u8d77\u4f7f\u7528\u3002\u5982\u679c\u60a8\u4e0d\u786e\u5b9a\u8981\u76d1\u63a7\u548c\u57fa\u4e8e\u54ea\u4e9b\u6307\u6807\u8fdb\u884c\u6269\u7f29\uff0c\u8bf7\u67e5\u770b\u76d1\u63a7\u91cd\u8981\u6307\u6807\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p> <p>\u51cf\u5c11\u5de5\u4f5c\u8d1f\u8f7d\u6d88\u8017\u4f1a\u5728\u96c6\u7fa4\u4e2d\u4ea7\u751f\u8fc7\u5269\u5bb9\u91cf\uff0c\u5982\u679c\u914d\u7f6e\u4e86\u9002\u5f53\u7684\u81ea\u52a8\u6269\u7f29\uff0c\u5c31\u53ef\u4ee5\u81ea\u52a8\u7f29\u51cf\u8282\u70b9\u5e76\u51cf\u5c11\u603b\u652f\u51fa\u3002\u6211\u4eec\u5efa\u8bae\u60a8\u4e0d\u8981\u5c1d\u8bd5\u624b\u52a8\u4f18\u5316\u8ba1\u7b97\u5bb9\u91cf\u3002Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u548c\u8282\u70b9\u81ea\u52a8\u6269\u7f29\u5668\u5c31\u662f\u4e3a\u4e86\u4e3a\u60a8\u5904\u7406\u8fd9\u4e2a\u8fc7\u7a0b\u800c\u8bbe\u8ba1\u7684\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#_3","title":"\u51cf\u5c11\u672a\u4f7f\u7528\u7684\u5bb9\u91cf","text":"<p>\u5728\u786e\u5b9a\u4e86\u5e94\u7528\u7a0b\u5e8f\u7684\u6b63\u786e\u5927\u5c0f\u5e76\u51cf\u5c11\u4e86\u8fc7\u591a\u7684\u8bf7\u6c42\u540e\uff0c\u60a8\u53ef\u4ee5\u5f00\u59cb\u51cf\u5c11\u914d\u7f6e\u7684\u8ba1\u7b97\u5bb9\u91cf\u3002\u5982\u679c\u60a8\u82b1\u65f6\u95f4\u6b63\u786e\u8c03\u6574\u4e86\u5de5\u4f5c\u8d1f\u8f7d\u5927\u5c0f\uff0c\u5c31\u5e94\u8be5\u53ef\u4ee5\u52a8\u6001\u5730\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u5728 AWS \u4e2d\u4f7f\u7528 Kubernetes \u6709\u4e24\u4e2a\u4e3b\u8981\u7684\u8282\u70b9\u81ea\u52a8\u6269\u7f29\u5668\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#karpenter-cluster-autoscaler","title":"Karpenter \u548c Cluster Autoscaler","text":"<p>Karpenter \u548c Kubernetes Cluster Autoscaler \u90fd\u4f1a\u968f\u7740 pod \u7684\u521b\u5efa\u6216\u5220\u9664\u4ee5\u53ca\u8ba1\u7b97\u9700\u6c42\u7684\u53d8\u5316\u800c\u6269\u5c55\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u6570\u91cf\u3002\u4e24\u8005\u7684\u4e3b\u8981\u76ee\u6807\u662f\u76f8\u540c\u7684\uff0c\u4f46 Karpenter \u91c7\u7528\u4e86\u4e0d\u540c\u7684\u8282\u70b9\u7ba1\u7406\u914d\u7f6e\u548c\u53d6\u6d88\u914d\u7f6e\u65b9\u6cd5\uff0c\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u964d\u4f4e\u6210\u672c\u5e76\u4f18\u5316\u6574\u4e2a\u96c6\u7fa4\u7684\u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u968f\u7740\u96c6\u7fa4\u89c4\u6a21\u7684\u589e\u957f\u548c\u5de5\u4f5c\u8d1f\u8f7d\u79cd\u7c7b\u7684\u589e\u52a0\uff0c\u9884\u5148\u914d\u7f6e\u8282\u70b9\u7ec4\u548c\u5b9e\u4f8b\u53d8\u5f97\u8d8a\u6765\u8d8a\u56f0\u96be\u3002\u5c31\u50cf\u5de5\u4f5c\u8d1f\u8f7d\u8bf7\u6c42\u4e00\u6837\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u521d\u59cb\u57fa\u7ebf\u5e76\u6839\u636e\u9700\u8981\u4e0d\u65ad\u8c03\u6574\u975e\u5e38\u91cd\u8981\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#cluster-autoscaler","title":"Cluster Autoscaler \u4f18\u5148\u7ea7\u6269\u5c55\u5668","text":"<p>Kubernetes Cluster Autoscaler \u901a\u8fc7\u6269\u5c55\u8282\u70b9\u7ec4(\u79f0\u4e3a\u8282\u70b9\u7ec4)\u6765\u5b9e\u73b0\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6269\u5c55\u548c\u7f29\u51cf\u3002\u5982\u679c\u60a8\u6ca1\u6709\u52a8\u6001\u6269\u5c55\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u90a3\u4e48 Cluster Autoscaler \u5c06\u65e0\u6cd5\u5e2e\u52a9\u60a8\u8282\u7701\u8d44\u91d1\u3002Cluster Autoscaler \u9700\u8981\u96c6\u7fa4\u7ba1\u7406\u5458\u63d0\u524d\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u521b\u5efa\u8282\u70b9\u7ec4\u3002\u8282\u70b9\u7ec4\u9700\u8981\u914d\u7f6e\u4e3a\u4f7f\u7528\u5177\u6709\u76f8\u540c\"\u914d\u7f6e\u6587\u4ef6\"\u7684\u5b9e\u4f8b\uff0c\u5373\u5927\u81f4\u76f8\u540c\u7684 CPU \u548c\u5185\u5b58\u91cf\u3002</p> <p>\u60a8\u53ef\u4ee5\u62e5\u6709\u591a\u4e2a\u8282\u70b9\u7ec4\uff0c\u5e76\u4e14\u53ef\u4ee5\u914d\u7f6e Cluster Autoscaler \u8bbe\u7f6e\u4f18\u5148\u7ea7\u6269\u5c55\u7ea7\u522b\uff0c\u6bcf\u4e2a\u8282\u70b9\u7ec4\u53ef\u4ee5\u5305\u542b\u4e0d\u540c\u5927\u5c0f\u7684\u8282\u70b9\u3002\u8282\u70b9\u7ec4\u53ef\u4ee5\u5305\u542b\u4e0d\u540c\u7684\u5bb9\u91cf\u7c7b\u578b\uff0c\u4f18\u5148\u7ea7\u6269\u5c55\u5668\u53ef\u7528\u4e8e\u9996\u5148\u6269\u5c55\u8f83\u4fbf\u5b9c\u7684\u7ec4\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 <code>ConfigMap</code> \u4f18\u5148\u6269\u5c55\u4fdd\u7559\u5bb9\u91cf\u800c\u4e0d\u662f\u6309\u9700\u5b9e\u4f8b\u7684\u96c6\u7fa4\u914d\u7f6e\u7247\u6bb5\u793a\u4f8b\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u6280\u672f\u6765\u4f18\u5148\u6269\u5c55 Graviton \u6216 Spot \u5b9e\u4f8b\u800c\u4e0d\u662f\u5176\u4ed6\u7c7b\u578b\u3002</p> <pre><code>apiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\nmetadata:\n  name: my-cluster\nmanagedNodeGroups:\n  - name: managed-ondemand\n    minSize: 1\n    maxSize: 7\n    instanceType: m5.xlarge\n  - name: managed-reserved\n    minSize: 2\n    maxSize: 10\n    instanceType: c5.2xlarge\n</code></pre> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cluster-autoscaler-priority-expander\n  namespace: kube-system\ndata:\n  priorities: |-\n    10:\n      - .*ondemand.*\n    50:\n      - .*reserved.*\n</code></pre> <p>\u4f7f\u7528\u8282\u70b9\u7ec4\u53ef\u4ee5\u5e2e\u52a9\u5e95\u5c42\u8ba1\u7b97\u8d44\u6e90\u6309\u9884\u671f\u6267\u884c\u9ed8\u8ba4\u64cd\u4f5c\uff0c\u4f8b\u5982\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u57df\u5206\u5e03\u8282\u70b9\uff0c\u4f46\u5e76\u975e\u6240\u6709\u5de5\u4f5c\u8d1f\u8f7d\u90fd\u6709\u76f8\u540c\u7684\u8981\u6c42\u6216\u671f\u671b\uff0c\u56e0\u6b64\u6700\u597d\u8ba9\u5e94\u7528\u7a0b\u5e8f\u660e\u786e\u58f0\u660e\u5176\u8981\u6c42\u3002\u6709\u5173 Cluster Autoscaler \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6700\u4f73\u5b9e\u8df5\u90e8\u5206\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#descheduler","title":"Descheduler","text":"<p>Cluster Autoscaler \u53ef\u4ee5\u6839\u636e\u9700\u8981\u8c03\u5ea6\u65b0 pod \u6216\u8282\u70b9\u5229\u7528\u7387\u4e0d\u8db3\u800c\u4ece\u96c6\u7fa4\u4e2d\u6dfb\u52a0\u548c\u5220\u9664\u8282\u70b9\u5bb9\u91cf\u3002\u4f46\u5b83\u5e76\u4e0d\u4f1a\u5168\u9762\u8003\u8651 pod \u5728\u8c03\u5ea6\u5230\u8282\u70b9\u540e\u7684\u653e\u7f6e\u60c5\u51b5\u3002\u5982\u679c\u60a8\u4f7f\u7528 Cluster Autoscaler\uff0c\u60a8\u8fd8\u5e94\u8be5\u67e5\u770b Kubernetes descheduler,\u4ee5\u907f\u514d\u96c6\u7fa4\u4e2d\u51fa\u73b0\u6d6a\u8d39\u5bb9\u91cf\u7684\u60c5\u51b5\u3002</p> <p>\u5982\u679c\u96c6\u7fa4\u4e2d\u6709 10 \u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u5229\u7528\u7387\u4e3a 60%,\u90a3\u4e48\u60a8\u5c31\u6d6a\u8d39\u4e86\u96c6\u7fa4\u4e2d 40% \u7684\u914d\u7f6e\u5bb9\u91cf\u3002\u4f7f\u7528 Cluster Autoscaler\uff0c\u60a8\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u8282\u70b9\u8bbe\u7f6e 60% \u7684\u5229\u7528\u7387\u9608\u503c\uff0c\u4f46\u8fd9\u53ea\u4f1a\u5728\u5229\u7528\u7387\u4f4e\u4e8e 60% \u65f6\u5c1d\u8bd5\u7f29\u51cf\u5355\u4e2a\u8282\u70b9\u3002</p> <p>\u4f7f\u7528 descheduler\uff0c\u5b83\u53ef\u4ee5\u5728 pod \u88ab\u8c03\u5ea6\u6216\u8282\u70b9\u88ab\u6dfb\u52a0\u5230\u96c6\u7fa4\u540e\u67e5\u770b\u96c6\u7fa4\u5bb9\u91cf\u548c\u5229\u7528\u7387\u3002\u5b83\u4f1a\u5c1d\u8bd5\u4fdd\u6301\u96c6\u7fa4\u603b\u5bb9\u91cf\u9ad8\u4e8e\u6307\u5b9a\u7684\u9608\u503c\u3002\u5b83\u8fd8\u53ef\u4ee5\u6839\u636e\u8282\u70b9\u6c61\u70b9\u6216\u52a0\u5165\u96c6\u7fa4\u7684\u65b0\u8282\u70b9\u5220\u9664 pod\uff0c\u4ee5\u786e\u4fdd pod \u5728\u6700\u4f73\u8ba1\u7b97\u73af\u5883\u4e2d\u8fd0\u884c\u3002\u8bf7\u6ce8\u610f\uff0cdescheduler \u4e0d\u4f1a\u8c03\u5ea6\u88ab\u9a71\u9010 pod \u7684\u66ff\u6362\uff0c\u800c\u662f\u4f9d\u8d56\u9ed8\u8ba4\u8c03\u5ea6\u7a0b\u5e8f\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#karpenter","title":"Karpenter \u6574\u5408","text":"<p>Karpenter \u91c7\u7528\u4e86\"\u65e0\u7ec4\"\u7684\u8282\u70b9\u7ba1\u7406\u65b9\u6cd5\u3002\u4e0e\u9884\u5148\u5b9a\u4e49\u7ec4\u5e76\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u6269\u5c55\u6bcf\u4e2a\u7ec4\u76f8\u6bd4\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5bf9\u4e8e\u4e0d\u540c\u7c7b\u578b\u7684\u5de5\u4f5c\u8d1f\u8f7d\u66f4\u52a0\u7075\u6d3b\uff0c\u5bf9\u96c6\u7fa4\u7ba1\u7406\u5458\u7684\u524d\u671f\u914d\u7f6e\u8981\u6c42\u4e5f\u66f4\u4f4e\u3002\u76f8\u53cd\uff0c\u5b83\u4f7f\u7528 provisioner \u548c\u8282\u70b9\u6a21\u677f\u6765\u5e7f\u6cdb\u5b9a\u4e49\u53ef\u4ee5\u521b\u5efa\u7684 EC2 \u5b9e\u4f8b\u7c7b\u578b\u4ee5\u53ca\u5b9e\u4f8b\u521b\u5efa\u65f6\u7684\u8bbe\u7f6e\u3002</p> <p>Bin packing \u662f\u5229\u7528\u66f4\u591a\u5b9e\u4f8b\u8d44\u6e90\u7684\u505a\u6cd5\uff0c\u901a\u8fc7\u5c06\u66f4\u591a\u5de5\u4f5c\u8d1f\u8f7d\u6253\u5305\u5230\u66f4\u5c11\u7684\u3001\u5927\u5c0f\u6700\u4f73\u7684\u5b9e\u4f8b\u4e0a\u6765\u5b9e\u73b0\u3002\u867d\u7136\u8fd9\u6709\u52a9\u4e8e\u51cf\u5c11\u8ba1\u7b97\u6210\u672c\uff0c\u56e0\u4e3a\u60a8\u53ea\u9700\u914d\u7f6e\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u7684\u8d44\u6e90\uff0c\u4f46\u5b83\u4e5f\u6709\u6743\u8861\u3002\u5728\u5927\u89c4\u6a21\u6269\u5c55\u4e8b\u4ef6\u671f\u95f4\uff0c\u542f\u52a8\u65b0\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u80fd\u9700\u8981\u66f4\u957f\u65f6\u95f4\uff0c\u56e0\u4e3a\u5fc5\u987b\u5411\u96c6\u7fa4\u6dfb\u52a0\u5bb9\u91cf\uff0c\u5c24\u5176\u662f\u5728\u5927\u89c4\u6a21\u6269\u5c55\u4e8b\u4ef6\u671f\u95f4\u3002\u5728\u8bbe\u7f6e bin packing \u65f6\uff0c\u8bf7\u8003\u8651\u6210\u672c\u4f18\u5316\u3001\u6027\u80fd\u548c\u53ef\u7528\u6027\u4e4b\u95f4\u7684\u5e73\u8861\u3002</p> <p>Karpenter \u53ef\u4ee5\u6301\u7eed\u76d1\u63a7\u548c\u6574\u5408\u4ee5\u63d0\u9ad8\u5b9e\u4f8b\u8d44\u6e90\u5229\u7528\u7387\u5e76\u964d\u4f4e\u8ba1\u7b97\u6210\u672c\u3002Karpenter \u8fd8\u53ef\u4ee5\u4e3a\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9009\u62e9\u66f4\u5177\u6210\u672c\u6548\u76ca\u7684\u5de5\u4f5c\u8282\u70b9\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5c06 provisioner \u4e2d\u7684\"consolidation\"\u6807\u5fd7\u8bbe\u7f6e\u4e3a true \u6765\u5b9e\u73b0(\u793a\u4f8b\u4ee3\u7801\u7247\u6bb5\u5982\u4e0b)\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u663e\u793a\u4e86\u4e00\u4e2a\u542f\u7528\u4e86\u6574\u5408\u7684 provisioner\u3002\u5728\u7f16\u5199\u672c\u6307\u5357\u65f6\uff0cKarpenter \u4e0d\u4f1a\u7528\u66f4\u4fbf\u5b9c\u7684 Spot \u5b9e\u4f8b\u66ff\u6362\u6b63\u5728\u8fd0\u884c\u7684 Spot \u5b9e\u4f8b\u3002\u6709\u5173 Karpenter \u6574\u5408\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6b64\u535a\u5ba2\u3002</p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\n  name: enable-binpacking\nspec:\n  consolidation:\n    enabled: true\n</code></pre> <p>\u5bf9\u4e8e\u53ef\u80fd\u65e0\u6cd5\u4e2d\u65ad\u7684\u5de5\u4f5c\u8d1f\u8f7d(\u5982\u6ca1\u6709\u68c0\u67e5\u70b9\u7684\u957f\u671f\u8fd0\u884c\u6279\u5904\u7406\u4f5c\u4e1a)\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 <code>do-not-evict</code> \u6ce8\u89e3\u5bf9 pod \u8fdb\u884c\u6ce8\u89e3\u3002\u901a\u8fc7\u9009\u62e9\u4e0d\u9a71\u9010 pod\uff0c\u60a8\u662f\u5728\u544a\u8bc9 Karpenter \u4e0d\u5e94\u8be5\u81ea\u613f\u5220\u9664\u5305\u542b\u6b64 pod \u7684\u8282\u70b9\u3002\u4f46\u662f\uff0c\u5982\u679c\u5728\u8282\u70b9\u6b63\u5728\u6392\u7a7a\u65f6\u6dfb\u52a0\u4e86 <code>do-not-evict</code> pod,\u5176\u4f59 pod \u4ecd\u5c06\u88ab\u9a71\u9010\uff0c\u4f46\u8be5 pod \u5c06\u963b\u6b62\u7ec8\u6b62\uff0c\u76f4\u5230\u88ab\u5220\u9664\u3002\u65e0\u8bba\u54ea\u79cd\u60c5\u51b5\uff0c\u8282\u70b9\u90fd\u5c06\u88ab\u5c01\u9501\u4ee5\u9632\u6b62\u5728\u8be5\u8282\u70b9\u4e0a\u8c03\u5ea6\u989d\u5916\u7684\u5de5\u4f5c\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u8bbe\u7f6e\u6ce8\u89e3\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: label-demo\n  labels:\n    environment: production\n  annotations:  \n    \"karpenter.sh/do-not-evict\": \"true\"\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_compute/#cluster-autoscaler_1","title":"\u901a\u8fc7\u8c03\u6574 Cluster Autoscaler \u53c2\u6570\u5220\u9664\u5229\u7528\u7387\u4e0d\u8db3\u7684\u8282\u70b9","text":"<p>\u8282\u70b9\u5229\u7528\u7387\u5b9a\u4e49\u4e3a\u8bf7\u6c42\u8d44\u6e90\u4e4b\u548c\u9664\u4ee5\u5bb9\u91cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>scale-down-utilization-threshold</code> \u8bbe\u7f6e\u4e3a 50%\u3002\u6b64\u53c2\u6570\u53ef\u4e0e  <code>scale-down-unneeded-time</code> \u4e00\u8d77\u4f7f\u7528\uff0c\u540e\u8005\u786e\u5b9a\u8282\u70b9\u5728\u6709\u8d44\u683c\u7f29\u51cf\u4e4b\u524d\u5e94\u8be5\u5904\u4e8e\u672a\u4f7f\u7528\u72b6\u6001\u7684\u65f6\u95f4\u957f\u5ea6 - \u9ed8\u8ba4\u503c\u4e3a 10 \u5206\u949f\u3002\u4ecd\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 pod \u5c06\u7531 kube-scheduler \u8c03\u5ea6\u5230\u5176\u4ed6\u8282\u70b9\u3002\u8c03\u6574\u8fd9\u4e9b\u8bbe\u7f6e\u53ef\u4ee5\u5e2e\u52a9\u5220\u9664\u5229\u7528\u7387\u4e0d\u8db3\u7684\u8282\u70b9\uff0c\u4f46\u91cd\u8981\u7684\u662f\u60a8\u8981\u5148\u6d4b\u8bd5\u8fd9\u4e9b\u503c\uff0c\u4ee5\u514d\u96c6\u7fa4\u8fc7\u65e9\u7f29\u51cf\u3002</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u786e\u4fdd\u6602\u8d35\u7684 pod \u65e0\u6cd5\u88ab\u9a71\u9010\u6765\u9632\u6b62\u53d1\u751f\u7f29\u51cf\u3002\u4e3a\u6b64\uff0c\u8bf7\u786e\u4fdd\u6602\u8d35\u7684 pod \u5177\u6709 Cluster Autoscaler \u8bc6\u522b\u7684\u6ce8\u89e3 <code>cluster-autoscaler.kubernetes.io/safe-to-evict=false</code>\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u8bbe\u7f6e\u6ce8\u89e3\u7684\u793a\u4f8b yaml\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: label-demo\n  labels:\n    environment: production\n  annotations:  \n    \"cluster-autoscaler.kubernetes.io/safe-to-evict\": \"false\"\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_compute/#cluster-autoscaler-karpenter","title":"\u4e3a Cluster Autoscaler \u548c Karpenter \u6807\u8bb0\u8282\u70b9","text":"<p>AWS \u8d44\u6e90\u6807\u7b7e\u7528\u4e8e\u7ec4\u7ec7\u60a8\u7684\u8d44\u6e90\uff0c\u5e76\u5728\u8be6\u7ec6\u7ea7\u522b\u8ddf\u8e2a\u60a8\u7684 AWS \u6210\u672c\u3002\u5b83\u4eec\u4e0e Kubernetes \u6807\u7b7e\u65e0\u76f4\u63a5\u5173\u8054\uff0c\u65e0\u6cd5\u7528\u4e8e\u6210\u672c\u8ddf\u8e2a\u3002\u5efa\u8bae\u4ece Kubernetes \u8d44\u6e90\u6807\u7b7e\u5f00\u59cb\uff0c\u5e76\u5229\u7528\u8bf8\u5982 Kubecost \u7b49\u5de5\u5177\u83b7\u53d6\u57fa\u4e8e pod\u3001\u547d\u540d\u7a7a\u95f4\u7b49 Kubernetes \u6807\u7b7e\u7684\u57fa\u7840\u8bbe\u65bd\u6210\u672c\u62a5\u544a\u3002</p> <p>\u5de5\u4f5c\u8282\u70b9\u9700\u8981\u6709\u6807\u7b7e\u624d\u80fd\u5728 AWS Cost Explorer \u4e2d\u663e\u793a\u8ba1\u8d39\u4fe1\u606f\u3002\u5bf9\u4e8e Cluster Autoscaler\uff0c\u8bf7\u4f7f\u7528\u542f\u52a8\u6a21\u677f\u4e3a\u6258\u7ba1\u8282\u70b9\u7ec4\u4e2d\u7684\u5de5\u4f5c\u8282\u70b9\u6dfb\u52a0\u6807\u7b7e\u3002\u5bf9\u4e8e\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4\uff0c\u8bf7\u4f7f\u7528 EC2 \u81ea\u52a8\u6269\u7f29\u7ec4\u4e3a\u5b9e\u4f8b\u6dfb\u52a0\u6807\u7b7e\u3002\u5bf9\u4e8e\u7531 Karpenter \u914d\u7f6e\u7684\u5b9e\u4f8b\uff0c\u8bf7\u4f7f\u7528\u8282\u70b9\u6a21\u677f\u4e2d\u7684 spec.tags \u4e3a\u5b83\u4eec\u6dfb\u52a0\u6807\u7b7e\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#_4","title":"\u591a\u79df\u6237\u96c6\u7fa4","text":"<p>\u5728\u5904\u7406\u7531\u4e0d\u540c\u56e2\u961f\u5171\u4eab\u7684\u96c6\u7fa4\u65f6\uff0c\u60a8\u53ef\u80fd\u65e0\u6cd5\u4e86\u89e3\u5728\u540c\u4e00\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u3002\u867d\u7136\u8d44\u6e90\u8bf7\u6c42\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u9694\u79bb\"\u566a\u97f3\u90bb\u5c45\"\u95ee\u9898(\u5982 CPU \u5171\u4eab)\uff0c\u4f46\u5b83\u4eec\u53ef\u80fd\u65e0\u6cd5\u9694\u79bb\u6240\u6709\u8d44\u6e90\u8fb9\u754c\uff0c\u5982\u78c1\u76d8 I/O \u8017\u5c3d\u3002\u5e76\u975e\u5de5\u4f5c\u8d1f\u8f7d\u6d88\u8017\u7684\u6bcf\u79cd\u8d44\u6e90\u90fd\u53ef\u4ee5\u88ab\u9694\u79bb\u6216\u9650\u5236\u3002\u6d88\u8017\u5171\u4eab\u8d44\u6e90\u6bd4\u7387\u9ad8\u4e8e\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5e94\u901a\u8fc7\u8282\u70b9\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6\u8fdb\u884c\u9694\u79bb\u3002\u9488\u5bf9\u6b64\u7c7b\u5de5\u4f5c\u8d1f\u8f7d\u7684\u53e6\u4e00\u79cd\u9ad8\u7ea7\u6280\u672f\u662f CPU \u56fa\u5b9a,\u5b83\u53ef\u786e\u4fdd\u5bb9\u5668\u4f7f\u7528\u72ec\u5360 CPU \u800c\u4e0d\u662f\u5171\u4eab CPU\u3002</p> <p>\u5728\u8282\u70b9\u7ea7\u522b\u9694\u79bb\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u80fd\u4f1a\u66f4\u6602\u8d35\uff0c\u4f46\u60a8\u53ef\u4ee5\u8c03\u5ea6 BestEffort \u4f5c\u4e1a\u6216\u5229\u7528\u4f7f\u7528 Reserved Instances\u3001Graviton \u5904\u7406\u5668\u6216 Spot \u7684\u989d\u5916\u8282\u7701\u3002</p> <p>\u5171\u4eab\u96c6\u7fa4\u8fd8\u53ef\u80fd\u5b58\u5728\u96c6\u7fa4\u7ea7\u8d44\u6e90\u7ea6\u675f\uff0c\u5982 IP \u8017\u5c3d\u3001Kubernetes \u670d\u52a1\u9650\u5236\u6216 API \u6269\u7f29\u8bf7\u6c42\u3002\u60a8\u5e94\u8be5\u67e5\u770b\u53ef\u6269\u5c55\u6027\u6700\u4f73\u5b9e\u8df5\u6307\u5357,\u4ee5\u786e\u4fdd\u60a8\u7684\u96c6\u7fa4\u907f\u514d\u8fd9\u4e9b\u9650\u5236\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728\u547d\u540d\u7a7a\u95f4\u6216 Karpenter provisioner \u7ea7\u522b\u9694\u79bb\u8d44\u6e90\u3002\u8d44\u6e90\u914d\u989d\u63d0\u4f9b\u4e86\u4e00\u79cd\u9650\u5236\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u4ee5\u6d88\u8017\u591a\u5c11\u8d44\u6e90\u7684\u65b9\u5f0f\u3002\u8fd9\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5f88\u597d\u7684\u521d\u59cb\u9632\u62a4\u680f\uff0c\u4f46\u5e94\u8be5\u6301\u7eed\u8bc4\u4f30\uff0c\u4ee5\u786e\u4fdd\u5b83\u4e0d\u4f1a\u4eba\u4e3a\u5730\u9650\u5236\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6269\u5c55\u3002</p> <p>Karpenter provisioner \u53ef\u4ee5\u8bbe\u7f6e\u96c6\u7fa4\u4e2d\u67d0\u4e9b\u53ef\u6d88\u8017\u8d44\u6e90\u7684\u9650\u5236(\u5982 CPU\u3001GPU),\u4f46\u60a8\u9700\u8981\u914d\u7f6e\u79df\u6237\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u9002\u5f53\u7684 provisioner\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u5355\u4e2a provisioner \u5728\u96c6\u7fa4\u4e2d\u521b\u5efa\u592a\u591a\u8282\u70b9\uff0c\u4f46\u5e94\u8be5\u6301\u7eed\u8bc4\u4f30\uff0c\u4ee5\u786e\u4fdd\u9650\u5236\u6ca1\u6709\u8bbe\u7f6e\u5f97\u592a\u4f4e\u800c\u963b\u6b62\u5de5\u4f5c\u8d1f\u8f7d\u6269\u5c55\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#_5","title":"\u8ba1\u5212\u81ea\u52a8\u6269\u7f29","text":"<p>\u60a8\u53ef\u80fd\u9700\u8981\u5728\u5468\u672b\u548c\u975e\u5de5\u4f5c\u65f6\u95f4\u7f29\u51cf\u96c6\u7fa4\u3002\u8fd9\u5bf9\u4e8e\u6d4b\u8bd5\u548c\u975e\u751f\u4ea7\u96c6\u7fa4\u5c24\u5176\u91cd\u8981\uff0c\u56e0\u4e3a\u60a8\u5e0c\u671b\u5728\u4e0d\u4f7f\u7528\u65f6\u5c06\u5176\u7f29\u51cf\u4e3a\u96f6\u3002\u8bf8\u5982 cluster-turndown \u548c kube-downscaler \u7b49\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u6839\u636e cron \u8ba1\u5212\u5c06\u526f\u672c\u7f29\u51cf\u4e3a\u96f6\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#_6","title":"\u4f18\u5316\u8ba1\u7b97\u5bb9\u91cf\u7c7b\u578b","text":"<p>\u5728\u4f18\u5316\u96c6\u7fa4\u4e2d\u7684\u603b\u8ba1\u7b97\u5bb9\u91cf\u5e76\u5229\u7528 bin packing \u4e4b\u540e\uff0c\u60a8\u5e94\u8be5\u67e5\u770b\u914d\u7f6e\u5728\u96c6\u7fa4\u4e2d\u7684\u8ba1\u7b97\u7c7b\u578b\u4ee5\u53ca\u652f\u4ed8\u8fd9\u4e9b\u8d44\u6e90\u7684\u65b9\u5f0f\u3002AWS \u6709\u8ba1\u7b97\u8282\u7701\u8ba1\u5212,\u53ef\u4ee5\u964d\u4f4e\u60a8\u7684\u8ba1\u7b97\u6210\u672c\uff0c\u6211\u4eec\u5c06\u5176\u5206\u4e3a\u4ee5\u4e0b\u5bb9\u91cf\u7c7b\u578b\uff1a</p> <ul> <li>Spot</li> <li>\u8282\u7701\u8ba1\u5212</li> <li>\u6309\u9700</li> <li>Fargate</li> </ul> <p>\u6bcf\u79cd\u5bb9\u91cf\u7c7b\u578b\u90fd\u6709\u4e0d\u540c\u7684\u7ba1\u7406\u5f00\u9500\u3001\u53ef\u7528\u6027\u548c\u957f\u671f\u627f\u8bfa\u6743\u8861\uff0c\u60a8\u9700\u8981\u51b3\u5b9a\u54ea\u79cd\u9002\u5408\u60a8\u7684\u73af\u5883\u3002\u4efb\u4f55\u73af\u5883\u90fd\u4e0d\u5e94\u8be5\u4ec5\u4f9d\u8d56\u5355\u4e00\u5bb9\u91cf\u7c7b\u578b\uff0c\u60a8\u53ef\u4ee5\u5728\u5355\u4e2a\u96c6\u7fa4\u4e2d\u6df7\u5408\u591a\u79cd\u8fd0\u884c\u7c7b\u578b\uff0c\u4ee5\u4f18\u5316\u7279\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8981\u6c42\u548c\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#spot","title":"Spot","text":"<p>Spot \u5bb9\u91cf\u7c7b\u578b\u4ece\u53ef\u7528\u533a\u57df\u7684\u7a7a\u95f2\u5bb9\u91cf\u4e2d\u914d\u7f6e EC2 \u5b9e\u4f8b\u3002Spot \u63d0\u4f9b\u9ad8\u8fbe 90% \u7684\u6700\u5927\u6298\u6263\uff0c\u4f46\u8fd9\u4e9b\u5b9e\u4f8b\u53ef\u80fd\u4f1a\u5728\u9700\u8981\u65f6\u88ab\u4e2d\u65ad\u3002\u6b64\u5916\uff0c\u53ef\u80fd\u5e76\u4e0d\u603b\u662f\u6709\u5bb9\u91cf\u6765\u914d\u7f6e\u65b0\u7684 Spot \u5b9e\u4f8b\uff0c\u73b0\u6709\u7684 Spot \u5b9e\u4f8b\u4e5f\u53ef\u80fd\u4f1a\u57282 \u5206\u949f\u7684\u4e2d\u65ad\u901a\u77e5\u540e\u88ab\u56de\u6536\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6709\u8f83\u957f\u7684\u542f\u52a8\u6216\u5173\u95ed\u8fc7\u7a0b\uff0cSpot \u5b9e\u4f8b\u53ef\u80fd\u4e0d\u662f\u6700\u4f73\u9009\u62e9\u3002</p> <p>Spot \u8ba1\u7b97\u5e94\u4f7f\u7528\u5404\u79cd\u5b9e\u4f8b\u7c7b\u578b\uff0c\u4ee5\u964d\u4f4e\u65e0\u6cd5\u83b7\u5f97 Spot \u5bb9\u91cf\u7684\u53ef\u80fd\u6027\u3002\u9700\u8981\u5904\u7406\u5b9e\u4f8b\u4e2d\u65ad\u4ee5\u5b89\u5168\u5173\u95ed\u8282\u70b9\u3002\u7531 Karpenter \u6216\u6258\u7ba1\u8282\u70b9\u7ec4\u914d\u7f6e\u7684\u8282\u70b9\u81ea\u52a8\u652f\u6301\u5b9e\u4f8b\u4e2d\u65ad\u901a\u77e5\u3002\u5982\u679c\u60a8\u4f7f\u7528\u81ea\u7ba1\u7406\u8282\u70b9\uff0c\u60a8\u5c06\u9700\u8981\u5355\u72ec\u8fd0\u884c node termination handler \u4ee5\u6b63\u5e38\u5173\u95ed Spot \u5b9e\u4f8b\u3002</p> <p>\u5728\u5355\u4e2a\u96c6\u7fa4\u4e2d\u5e73\u8861 Spot \u548c\u6309\u9700\u5b9e\u4f8b\u662f\u53ef\u80fd\u7684\u3002\u4f7f\u7528 Karpenter\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u52a0\u6743 provisioner \u6765\u5b9e\u73b0\u4e0d\u540c\u5bb9\u91cf\u7c7b\u578b\u7684\u5e73\u8861\u3002\u4f7f\u7528 Cluster Autoscaler\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u5305\u542b Spot \u548c\u6309\u9700\u6216\u4fdd\u7559\u5b9e\u4f8b\u7684\u6df7\u5408\u8282\u70b9\u7ec4\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Karpenter \u4f18\u5148\u914d\u7f6e Spot \u5b9e\u4f8b\u800c\u4e0d\u662f\u6309\u9700\u5b9e\u4f8b\u3002\u5728\u521b\u5efa provisioner \u65f6\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a Spot\u3001\u6309\u9700\u6216\u4e24\u8005(\u5982\u4e0b\u6240\u793a)\u3002\u5f53\u60a8\u540c\u65f6\u6307\u5b9a\u4e24\u8005\u65f6\uff0c\u5982\u679c pod \u6ca1\u6709\u660e\u786e\u6307\u5b9a\u9700\u8981\u4f7f\u7528 Spot \u8fd8\u662f\u6309\u9700\uff0c\u90a3\u4e48 Karpenter \u4f1a\u4f18\u5148\u4f7f\u7528 price-capacity-optimization allocation strategy \u914d\u7f6e Spot \u5b9e\u4f8b\u3002</p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\n  name: spot-prioritized\nspec:\n  requirements:\n    - key: \"karpenter.sh/capacity-type\" \n      operator: In\n        values: [\"spot\", \"on-demand\"]\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_compute/#aws-edp","title":"\u8282\u7701\u8ba1\u5212\u3001\u4fdd\u7559\u5b9e\u4f8b\u548c AWS EDP","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u8ba1\u7b97\u8282\u7701\u8ba1\u5212\u6765\u964d\u4f4e\u8ba1\u7b97\u652f\u51fa\u3002\u8282\u7701\u8ba1\u5212\u4e3a 1 \u5e74\u6216 3 \u5e74\u7684\u8ba1\u7b97\u4f7f\u7528\u627f\u8bfa\u63d0\u4f9b\u4e86\u964d\u4f4e\u4ef7\u683c\u3002\u4f7f\u7528\u60c5\u51b5\u53ef\u4ee5\u5e94\u7528\u4e8e EKS \u96c6\u7fa4\u4e2d\u7684 EC2 \u5b9e\u4f8b\uff0c\u4f46\u4e5f\u9002\u7528\u4e8e Lambda \u548c Fargate \u7b49\u4efb\u4f55\u8ba1\u7b97\u4f7f\u7528\u3002\u4f7f\u7528\u8282\u7701\u8ba1\u5212\uff0c\u60a8\u53ef\u4ee5\u5728\u627f\u8bfa\u671f\u5185\u9009\u62e9\u4efb\u4f55 EC2 \u5b9e\u4f8b\u7c7b\u578b\u5e76\u964d\u4f4e\u6210\u672c\u3002</p> <p>\u8ba1\u7b97\u8282\u7701\u8ba1\u5212\u53ef\u4ee5\u5c06\u60a8\u7684 EC2 \u6210\u672c\u964d\u4f4e\u9ad8\u8fbe 66%,\u800c\u65e0\u9700\u627f\u8bfa\u4f7f\u7528\u54ea\u79cd\u5b9e\u4f8b\u7c7b\u578b\u3001\u7cfb\u5217\u6216\u533a\u57df\u3002\u5f53\u60a8\u4f7f\u7528\u5b9e\u4f8b\u65f6\uff0c\u8282\u7701\u5c06\u81ea\u52a8\u5e94\u7528\u3002</p> <p>EC2 \u5b9e\u4f8b\u8282\u7701\u8ba1\u5212\u4e3a\u5728\u7279\u5b9a\u533a\u57df\u548c EC2 \u7cfb\u5217(\u5982 C \u7cfb\u5217)\u7684\u4f7f\u7528\u63d0\u4f9b\u9ad8\u8fbe 72% \u7684\u8282\u7701\u3002\u60a8\u53ef\u4ee5\u5728\u8be5\u533a\u57df\u5185\u7684\u4efb\u4f55\u53ef\u7528\u533a\u57df\u4f7f\u7528\u4efb\u4f55\u5b9e\u4f8b\u7cfb\u5217(\u5982 c5 \u6216 c6)\u3001\u4efb\u4f55\u4ee3\u7684\u5b9e\u4f8b\u4ee5\u53ca\u8be5\u7cfb\u5217\u5185\u7684\u4efb\u4f55\u5b9e\u4f8b\u5927\u5c0f\u3002\u6298\u6263\u5c06\u81ea\u52a8\u5e94\u7528\u4e8e\u60a8\u8d26\u6237\u4e2d\u4e0e\u8282\u7701\u8ba1\u5212\u6761\u4ef6\u5339\u914d\u7684\u4efb\u4f55\u5b9e\u4f8b\u3002</p> <p>\u4fdd\u7559\u5b9e\u4f8b\u7c7b\u4f3c\u4e8e EC2 \u5b9e\u4f8b\u8282\u7701\u8ba1\u5212\uff0c\u4f46\u5b83\u4eec\u8fd8\u53ef\u4ee5\u5728\u53ef\u7528\u533a\u57df\u6216\u533a\u57df\u5185\u4fdd\u8bc1\u5bb9\u91cf\uff0c\u5e76\u4e14\u6bd4\u6309\u9700\u5b9e\u4f8b\u8282\u7701\u9ad8\u8fbe 72% \u7684\u6210\u672c\u3002\u4e00\u65e6\u60a8\u8ba1\u7b97\u51fa\u9700\u8981\u4fdd\u7559\u591a\u5c11\u5bb9\u91cf\uff0c\u60a8\u5c31\u53ef\u4ee5\u9009\u62e9\u4fdd\u7559\u7684\u65f6\u95f4\u957f\u5ea6(1 \u5e74\u6216 3 \u5e74)\u3002\u6298\u6263\u5c06\u81ea\u52a8\u5e94\u7528\u4e8e\u60a8\u5728\u8d26\u6237\u4e2d\u8fd0\u884c\u7684\u90a3\u4e9b EC2 \u5b9e\u4f8b\u3002</p> <p>\u5ba2\u6237\u8fd8\u53ef\u4ee5\u9009\u62e9\u4e0e AWS \u7b7e\u8ba2\u4f01\u4e1a\u534f\u8bae\u3002\u4f01\u4e1a\u534f\u8bae\u8ba9\u5ba2\u6237\u53ef\u4ee5\u91cf\u8eab\u5b9a\u5236\u6700\u9002\u5408\u5176\u9700\u6c42\u7684\u534f\u8bae\u3002\u5ba2\u6237\u53ef\u4ee5\u4eab\u53d7\u57fa\u4e8e AWS EDP (\u4f01\u4e1a\u6298\u6263\u8ba1\u5212)\u7684\u5b9a\u4ef7\u6298\u6263\u3002\u6709\u5173\u4f01\u4e1a\u534f\u8bae\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u4e0e\u60a8\u7684 AWS \u9500\u552e\u4ee3\u8868\u8054\u7cfb\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#_7","title":"\u6309\u9700","text":"<p>\u4e0e Spot \u76f8\u6bd4\uff0c\u6309\u9700 EC2 \u5b9e\u4f8b\u7684\u597d\u5904\u662f\u4e0d\u4f1a\u4e2d\u65ad\uff0c\u4e0e\u8282\u7701\u8ba1\u5212\u76f8\u6bd4\uff0c\u4e5f\u6ca1\u6709\u957f\u671f\u627f\u8bfa\u3002\u5982\u679c\u60a8\u5e0c\u671b\u5728\u96c6\u7fa4\u4e2d\u964d\u4f4e\u6210\u672c\uff0c\u60a8\u5e94\u8be5\u51cf\u5c11\u5bf9\u6309\u9700 EC2 \u5b9e\u4f8b\u7684\u4f7f\u7528\u3002</p> <p>\u5728\u4f18\u5316\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u540e\uff0c\u60a8\u5e94\u8be5\u80fd\u591f\u8ba1\u7b97\u51fa\u96c6\u7fa4\u7684\u6700\u5c0f\u548c\u6700\u5927\u5bb9\u91cf\u3002\u8fd9\u4e2a\u6570\u5b57\u53ef\u80fd\u4f1a\u968f\u65f6\u95f4\u53d8\u5316\uff0c\u4f46\u5f88\u5c11\u4f1a\u964d\u4f4e\u3002\u8003\u8651\u5bf9\u6700\u5c0f\u503c\u4ee5\u4e0b\u7684\u6240\u6709\u5185\u5bb9\u4f7f\u7528\u8282\u7701\u8ba1\u5212\uff0c\u5bf9\u4e0d\u4f1a\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u6027\u7684\u5bb9\u91cf\u4f7f\u7528 Spot\u3002\u4efb\u4f55\u5176\u4ed6\u53ef\u80fd\u4e0d\u4f1a\u6301\u7eed\u4f7f\u7528\u6216\u9700\u8981\u4fdd\u8bc1\u53ef\u7528\u6027\u7684\u5185\u5bb9\u90fd\u53ef\u4ee5\u4f7f\u7528\u6309\u9700\u3002</p> <p>\u5982\u672c\u8282\u6240\u8ff0\uff0c\u51cf\u5c11\u4f7f\u7528\u7684\u6700\u4f73\u65b9\u5f0f\u662f\u6d88\u8017\u66f4\u5c11\u7684\u8d44\u6e90\uff0c\u5e76\u5c3d\u53ef\u80fd\u5145\u5206\u5229\u7528\u60a8\u914d\u7f6e\u7684\u8d44\u6e90\u3002\u4f7f\u7528 Cluster Autoscaler\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 <code>scale-down-utilization-threshold</code> \u8bbe\u7f6e\u5220\u9664\u5229\u7528\u7387\u4e0d\u8db3\u7684\u8282\u70b9\u3002\u5bf9\u4e8e Karpenter\uff0c\u5efa\u8bae\u542f\u7528\u6574\u5408\u3002</p> <p>\u8981\u624b\u52a8\u8bc6\u522b\u53ef\u7528\u4e8e\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684 EC2 \u5b9e\u4f8b\u7c7b\u578b\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528 ec2-instance-selector,\u5b83\u53ef\u4ee5\u663e\u793a\u6bcf\u4e2a\u533a\u57df\u4e2d\u53ef\u7528\u7684\u5b9e\u4f8b\u4ee5\u53ca\u4e0e EKS \u517c\u5bb9\u7684\u5b9e\u4f8b\u3002\u793a\u4f8b\u7528\u6cd5\uff1a\u5728 us-east-1 \u533a\u57df\u4e2d\u5177\u6709 x86 \u5904\u7406\u5668\u67b6\u6784\u30014 Gb \u5185\u5b58\u30012 \u4e2a vCPU \u4e14\u53ef\u7528\u4e8e EKS \u7684\u5b9e\u4f8b\u3002</p> <pre><code>ec2-instance-selector --memory 4 --vcpus 2 --cpu-architecture x86_64 \\\n  -r us-east-1 --service eks\nc5.large\nc5a.large\nc5ad.large\nc5d.large\nc6a.large\nc6i.large\nt2.medium\nt3.medium\nt3a.medium\n</code></pre> <p>\u5bf9\u4e8e\u975e\u751f\u4ea7\u73af\u5883\uff0c\u60a8\u53ef\u4ee5\u5728\u591c\u95f4\u548c\u5468\u672b\u7b49\u672a\u4f7f\u7528\u65f6\u95f4\u81ea\u52a8\u7f29\u51cf\u96c6\u7fa4\u3002kubecost \u9879\u76ee cluster-turndown \u5c31\u662f\u4e00\u4e2a\u53ef\u4ee5\u6839\u636e\u8bbe\u7f6e\u7684\u65f6\u95f4\u8868\u81ea\u52a8\u7f29\u51cf\u96c6\u7fa4\u7684\u63a7\u5236\u5668\u793a\u4f8b\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#fargate","title":"Fargate \u8ba1\u7b97","text":"<p>Fargate \u8ba1\u7b97\u662f EKS \u96c6\u7fa4\u7684\u4e00\u79cd\u5b8c\u5168\u6258\u7ba1\u8ba1\u7b97\u9009\u9879\u3002\u5b83\u901a\u8fc7\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u4e3a\u6bcf\u4e2a pod \u8c03\u5ea6\u4e00\u4e2a\u8282\u70b9\u6765\u63d0\u4f9b pod \u9694\u79bb\u3002\u5b83\u5141\u8bb8\u60a8\u5c06\u8ba1\u7b97\u8282\u70b9\u7684\u5927\u5c0f\u8c03\u6574\u4e3a\u4e0e\u5de5\u4f5c\u8d1f\u8f7d\u7684 CPU \u548c RAM \u8981\u6c42\u76f8\u5339\u914d\uff0c\u4ece\u800c\u53ef\u4ee5\u7cbe\u786e\u63a7\u5236\u96c6\u7fa4\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u60c5\u51b5\u3002</p> <p>Fargate \u53ef\u4ee5\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u6269\u5c55\u5230\u6700\u5c0f 0.25 vCPU \u548c 0.5 GB \u5185\u5b58\uff0c\u6700\u5927 16 vCPU \u548c 120 GB \u5185\u5b58\u3002\u53ef\u7528\u7684pod \u5927\u5c0f\u53d8\u4f53\u6709\u9650\u5236\uff0c\u60a8\u9700\u8981\u4e86\u89e3\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6700\u9002\u5408\u54ea\u79cd Fargate \u914d\u7f6e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981 1 vCPU \u548c 0.5 GB \u5185\u5b58\uff0c\u6700\u5c0f\u7684 Fargate pod \u5c06\u662f 1 vCPU \u548c 2 GB \u5185\u5b58\u3002</p> <p>\u867d\u7136 Fargate \u6709\u8bb8\u591a\u597d\u5904\uff0c\u5982\u65e0\u9700\u7ba1\u7406 EC2 \u5b9e\u4f8b\u6216\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f46\u7531\u4e8e\u6bcf\u4e2a\u90e8\u7f72\u7684 pod \u90fd\u88ab\u9694\u79bb\u4e3a\u96c6\u7fa4\u4e2d\u7684\u5355\u72ec\u8282\u70b9\uff0c\u56e0\u6b64\u5b83\u53ef\u80fd\u9700\u8981\u6bd4\u4f20\u7edf EC2 \u5b9e\u4f8b\u66f4\u591a\u7684\u8ba1\u7b97\u5bb9\u91cf\u3002\u8fd9\u9700\u8981\u4e3a\u8bf8\u5982 Kubelet\u3001\u65e5\u5fd7\u4ee3\u7406\u548c\u60a8\u901a\u5e38\u4f1a\u90e8\u7f72\u5230\u8282\u70b9\u7684\u4efb\u4f55 DaemonSet \u7b49\u7ec4\u4ef6\u8fdb\u884c\u66f4\u591a\u590d\u5236\u3002Fargate \u4e0d\u652f\u6301 DaemonSet\uff0c\u5b83\u4eec\u9700\u8981\u8f6c\u6362\u4e3a\u4e0e\u5e94\u7528\u7a0b\u5e8f\u4e00\u8d77\u8fd0\u884c\u7684 pod \"sidecar\"\u3002</p> <p>Fargate \u65e0\u6cd5\u4ece bin packing \u6216 CPU \u8fc7\u91cf\u914d\u7f6e\u4e2d\u83b7\u76ca\uff0c\u56e0\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8fb9\u754c\u662f\u4e00\u4e2a\u8282\u70b9\uff0c\u800c\u4e0d\u662f\u53ef\u4ee5\u5728\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\u5171\u4eab\u7684\u53ef\u7a81\u53d1\u6216\u53ef\u5171\u4eab\u7684\u8282\u70b9\u3002Fargate \u5c06\u4e3a\u60a8\u8282\u7701 EC2 \u5b9e\u4f8b\u7ba1\u7406\u65f6\u95f4(\u8fd9\u672c\u8eab\u5c31\u662f\u4e00\u79cd\u6210\u672c)\uff0c\u4f46 CPU \u548c\u5185\u5b58\u6210\u672c\u53ef\u80fd\u6bd4\u5176\u4ed6 EC2 \u5bb9\u91cf\u7c7b\u578b\u66f4\u9ad8\u3002Fargate pod \u53ef\u4ee5\u5229\u7528\u8ba1\u7b97\u8282\u7701\u8ba1\u5212\u6765\u964d\u4f4e\u6309\u9700\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_compute/#_8","title":"\u4f18\u5316\u8ba1\u7b97\u4f7f\u7528","text":"<p>\u8282\u7701\u8ba1\u7b97\u57fa\u7840\u8bbe\u65bd\u8d39\u7528\u7684\u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u66f4\u9ad8\u6548\u7684\u8ba1\u7b97\u3002\u8fd9\u53ef\u4ee5\u6765\u81ea\u66f4\u9ad8\u6027\u80fd\u7684\u901a\u7528\u8ba1\u7b97\uff0c\u5982 Graviton \u5904\u7406\u5668,\u5b83\u6bd4 x86 \u4fbf\u5b9c 20% \u4e14\u80fd\u6548\u9ad8 60%,\u6216\u8005\u6765\u81ea\u8bf8\u5982 GPU \u548c FPGA \u7b49\u7279\u5b9a\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u7684\u52a0\u901f\u5668\u3002\u60a8\u9700\u8981\u6784\u5efa\u53ef\u4ee5\u5728 arm \u67b6\u6784\u4e0a\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u5e76\u8bbe\u7f6e\u5177\u6709\u9002\u5f53\u52a0\u901f\u5668\u7684\u8282\u70b9\uff0c\u4ee5\u6ee1\u8db3\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u3002</p> <p>EKS \u80fd\u591f\u8fd0\u884c\u5177\u6709\u6df7\u5408\u67b6\u6784(\u5982 amd64 \u548c arm64)\u7684\u96c6\u7fa4\uff0c\u5982\u679c\u60a8\u7684\u5bb9\u5668\u4e3a\u591a\u79cd\u67b6\u6784\u7f16\u8bd1\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 provisioner \u4e2d\u5141\u8bb8\u4e24\u79cd\u67b6\u6784\u6765\u5229\u7528 Karpenter \u7684 Graviton \u5904\u7406\u5668\u3002\u4f46\u662f\uff0c\u4e3a\u4e86\u4fdd\u6301\u4e00\u81f4\u7684\u6027\u80fd\uff0c\u5efa\u8bae\u60a8\u5c06\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u4fdd\u6301\u5728\u5355\u4e00\u8ba1\u7b97\u67b6\u6784\u4e0a\uff0c\u53ea\u6709\u5728\u6ca1\u6709\u5176\u4ed6\u53ef\u7528\u5bb9\u91cf\u65f6\u624d\u4f7f\u7528\u4e0d\u540c\u7684\u67b6\u6784\u3002</p> <p>Provisioner \u53ef\u4ee5\u914d\u7f6e\u4e3a\u652f\u6301\u591a\u79cd\u67b6\u6784\uff0c\u5de5\u4f5c\u8d1f\u8f7d\u4e5f\u53ef\u4ee5\u5728\u5176\u5de5\u4f5c\u8d1f\u8f7d\u89c4\u8303\u4e2d\u8bf7\u6c42\u7279\u5b9a\u67b6\u6784\u3002</p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\n  name: default\nspec:\n  requirements:\n  - key: \"kubernetes.io/arch\"\n    operator: In\n    values: [\"arm64\", \"amd64\"]\n</code></pre> <p>\u4f7f\u7528 Cluster Autoscaler\uff0c\u60a8\u5c06\u9700\u8981\u4e3a Graviton \u5b9e\u4f8b\u521b\u5efa\u4e00\u4e2a\u8282\u70b9\u7ec4\uff0c\u5e76\u5728\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4e0a\u8bbe\u7f6e\u8282\u70b9\u5bb9\u5fcd\u5ea6\u4ee5\u5229\u7528\u65b0\u7684\u5bb9\u91cf\u3002</p> <p>GPU \u548c FPGA \u53ef\u4ee5\u6781\u5927\u63d0\u9ad8\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6027\u80fd\uff0c\u4f46\u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981\u4f18\u5316\u4ee5\u4f7f\u7528\u52a0\u901f\u5668\u3002\u8bb8\u591a\u7528\u4e8e\u673a\u5668\u5b66\u4e60\u548c\u4eba\u5de5\u667a\u80fd\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\u90fd\u53ef\u4ee5\u4f7f\u7528 GPU \u8fdb\u884c\u8ba1\u7b97\uff0c\u5b9e\u4f8b\u53ef\u4ee5\u6dfb\u52a0\u5230\u96c6\u7fa4\u5e76\u901a\u8fc7\u8d44\u6e90\u8bf7\u6c42\u6302\u8f7d\u5230\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u3002</p> <pre><code>spec:\n  template:\n    spec:\n    - containers:\n      ...\n      resources:\n          limits:\n            nvidia.com/gpu: \"1\"\n</code></pre> <p>\u67d0\u4e9b GPU \u786c\u4ef6\u53ef\u4ee5\u5728\u591a\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\u5171\u4eab\uff0c\u56e0\u6b64\u5355\u4e2a GPU \u53ef\u4ee5\u88ab\u914d\u7f6e\u548c\u4f7f\u7528\u3002\u8981\u4e86\u89e3\u5982\u4f55\u914d\u7f6e\u5de5\u4f5c\u8d1f\u8f7d GPU \u5171\u4eab\uff0c\u8bf7\u53c2\u9605 virtual GPU device plugin \u4ee5\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002\u60a8\u8fd8\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u535a\u5ba2\uff1a</p> <ul> <li>GPU sharing on Amazon EKS with NVIDIA time-slicing and accelerated EC2 instances</li> <li>Maximizing GPU utilization with NVIDIA's Multi-Instance GPU (MIG) on Amazon EKS: Running more pods per GPU for enhanced performance</li> </ul>"},{"location":"zh/cost_optimization/cost_opt_networking/","title":"\u6210\u672c\u4f18\u5316 - \u7f51\u7edc","text":"<p>\u4e3a\u5b9e\u73b0\u5f39\u6027\u548c\u5bb9\u9519\u80fd\u529b\uff0c\u67b6\u6784\u9ad8\u53ef\u7528\u6027 (HA) \u7cfb\u7edf\u662f\u6700\u4f73\u5b9e\u8df5\u3002\u5728\u5b9e\u8df5\u4e2d\uff0c\u8fd9\u610f\u5473\u7740\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u548c\u5e95\u5c42\u57fa\u7840\u8bbe\u65bd\u5206\u5e03\u5728\u7ed9\u5b9a AWS \u533a\u57df\u7684\u591a\u4e2a\u53ef\u7528\u533a (AZ) \u4e2d\u3002\u786e\u4fdd\u8fd9\u4e9b\u7279\u6027\u5728\u60a8\u7684 Amazon EKS \u73af\u5883\u4e2d\u5f97\u5230\u5b9e\u73b0\uff0c\u5c06\u63d0\u9ad8\u6574\u4e2a\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u3002\u7ed3\u5408\u8fd9\u4e00\u70b9\uff0c\u60a8\u7684 EKS \u73af\u5883\u53ef\u80fd\u8fd8\u5305\u542b\u5404\u79cd\u6784\u9020 (\u5982 VPC)\u3001\u7ec4\u4ef6 (\u5982 ELB) \u548c\u96c6\u6210 (\u5982 ECR \u548c\u5176\u4ed6\u5bb9\u5668\u6ce8\u518c\u8868)\u3002</p> <p>\u9ad8\u53ef\u7528\u7cfb\u7edf\u548c\u5176\u4ed6\u7279\u5b9a\u4e8e\u7528\u4f8b\u7684\u7ec4\u4ef6\u7684\u7ec4\u5408\u53ef\u80fd\u4f1a\u5728\u6570\u636e\u4f20\u8f93\u548c\u5904\u7406\u65b9\u9762\u53d1\u6325\u91cd\u5927\u4f5c\u7528\u3002\u8fd9\u53cd\u8fc7\u6765\u4f1a\u5f71\u54cd\u7531\u6570\u636e\u4f20\u8f93\u548c\u5904\u7406\u800c\u4ea7\u751f\u7684\u6210\u672c\u3002</p> <p>\u4e0b\u9762\u8be6\u8ff0\u7684\u505a\u6cd5\u5c06\u5e2e\u52a9\u60a8\u8bbe\u8ba1\u548c\u4f18\u5316 EKS \u73af\u5883\uff0c\u4ee5\u5b9e\u73b0\u4e0d\u540c\u9886\u57df\u548c\u7528\u4f8b\u7684\u6210\u672c\u6548\u76ca\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_networking/#pod-pod","title":"Pod \u5230 Pod \u901a\u4fe1","text":"<p>\u6839\u636e\u60a8\u7684\u8bbe\u7f6e\u60c5\u51b5\uff0cPod \u4e4b\u95f4\u7684\u7f51\u7edc\u901a\u4fe1\u548c\u6570\u636e\u4f20\u8f93\u53ef\u80fd\u4f1a\u5bf9\u8fd0\u884c Amazon EKS \u5de5\u4f5c\u8d1f\u8f7d\u7684\u603b\u4f53\u6210\u672c\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\u3002\u672c\u8282\u5c06\u4ecb\u7ecd\u4e0d\u540c\u7684\u6982\u5ff5\u548c\u65b9\u6cd5\u6765\u51cf\u5c11\u4e0e Pod \u95f4\u901a\u4fe1\u76f8\u5173\u7684\u6210\u672c\uff0c\u540c\u65f6\u8003\u8651\u9ad8\u53ef\u7528 (HA) \u67b6\u6784\u3001\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u548c\u5f39\u6027\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_networking/#_1","title":"\u9650\u5236\u6d41\u91cf\u5728\u53ef\u7528\u533a\u5185","text":"<p>\u9891\u7e41\u7684\u8de8\u533a\u57df\u51fa\u53e3\u6d41\u91cf (\u5728 AZ \u4e4b\u95f4\u5206\u5e03\u7684\u6d41\u91cf) \u53ef\u80fd\u4f1a\u5bf9\u7f51\u7edc\u76f8\u5173\u6210\u672c\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u63a7\u5236 EKS \u96c6\u7fa4\u4e2d Pod \u4e4b\u95f4\u8de8\u533a\u57df\u6d41\u91cf\u91cf\u7684\u7b56\u7565\u3002</p> <p>\u5982\u679c\u60a8\u60f3\u4e86\u89e3 Pod \u4e4b\u95f4\u8de8\u533a\u57df\u6d41\u91cf\u7684\u6570\u636e\u91cf (\u5982\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u7684\u4f20\u8f93\u6570\u636e\u91cf)\uff0c\u8bf7\u53c2\u9605\u6b64\u6587\u7ae0\u3002</p> <p>\u4f7f\u7528\u62d3\u6251\u611f\u77e5\u8def\u7531 (\u524d\u79f0\u4e3a\u62d3\u6251\u611f\u77e5\u63d0\u793a)</p> <p></p> <p>\u4f7f\u7528\u62d3\u6251\u611f\u77e5\u8def\u7531\u65f6\uff0c\u4e86\u89e3 Service\u3001EndpointSlice \u548c <code>kube-proxy</code> \u5728\u8def\u7531\u6d41\u91cf\u65f6\u662f\u5982\u4f55\u534f\u540c\u5de5\u4f5c\u5f88\u91cd\u8981\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0cService \u662f\u63a5\u6536\u76ee\u6807\u4e3a\u60a8\u7684 Pod \u7684\u6d41\u91cf\u7684\u7a33\u5b9a\u7f51\u7edc\u62bd\u8c61\u5c42\u3002\u521b\u5efa Service \u65f6\uff0c\u4f1a\u521b\u5efa\u591a\u4e2a EndpointSlice\u3002\u6bcf\u4e2a EndpointSlice \u90fd\u6709\u4e00\u4e2a\u5305\u542b Pod \u5730\u5740\u5b50\u96c6\u7684\u7aef\u70b9\u5217\u8868\uff0c\u4ee5\u53ca\u5b83\u4eec\u6240\u5728\u7684\u8282\u70b9\u548c\u4efb\u4f55\u5176\u4ed6\u62d3\u6251\u4fe1\u606f\u3002<code>kube-proxy</code> \u662f\u5728\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 daemonset\uff0c\u4e5f\u627f\u62c5\u5185\u90e8\u8def\u7531\u7684\u89d2\u8272\uff0c\u4f46\u5b83\u7684\u8def\u7531\u662f\u57fa\u4e8e\u4ece\u521b\u5efa\u7684 EndpointSlice \u4e2d\u83b7\u53d6\u7684\u4fe1\u606f\u3002</p> <p>\u5f53\u62d3\u6251\u611f\u77e5\u8def\u7531 \u5728 Kubernetes Service \u4e0a\u542f\u7528\u5e76\u5b9e\u73b0\u65f6\uff0cEndpointSlice \u63a7\u5236\u5668\u5c06\u6309\u6bd4\u4f8b\u5c06\u7aef\u70b9\u5206\u914d\u5230\u96c6\u7fa4\u6240\u8de8\u8d8a\u7684\u4e0d\u540c\u533a\u57df\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u7aef\u70b9\uff0cEndpointSlice \u63a7\u5236\u5668\u8fd8\u4f1a\u8bbe\u7f6e\u4e00\u4e2a\u533a\u57df \u63d0\u793a\u3002\u63d0\u793a \u63cf\u8ff0\u4e86\u7aef\u70b9\u5e94\u8be5\u4e3a\u54ea\u4e2a\u533a\u57df\u63d0\u4f9b\u670d\u52a1\u3002\u7136\u540e <code>kube-proxy</code> \u5c06\u6839\u636e\u5e94\u7528\u7684 \u63d0\u793a \u5c06\u6d41\u91cf\u4ece\u4e00\u4e2a\u533a\u57df\u8def\u7531\u5230\u4e00\u4e2a\u7aef\u70b9\u3002</p> <p>\u4e0b\u56fe\u663e\u793a\u4e86 EndpointSlice \u5982\u4f55\u4ee5\u8fd9\u6837\u4e00\u79cd\u65b9\u5f0f\u7ec4\u7ec7\uff0c\u4f7f\u5f97 <code>kube-proxy</code> \u53ef\u4ee5\u6839\u636e\u6d41\u91cf\u7684\u533a\u57df\u8d77\u70b9\u77e5\u9053\u5e94\u8be5\u5c06\u5176\u8def\u7531\u5230\u54ea\u4e2a\u76ee\u7684\u5730\u3002\u5982\u679c\u6ca1\u6709\u63d0\u793a\uff0c\u5c31\u4e0d\u4f1a\u6709\u8fd9\u79cd\u5206\u914d\u6216\u7ec4\u7ec7\uff0c\u6d41\u91cf\u5c06\u88ab\u4ee3\u7406\u5230\u4e0d\u540c\u7684\u533a\u57df\u76ee\u7684\u5730\uff0c\u800c\u4e0d\u7ba1\u5b83\u6765\u81ea\u54ea\u91cc\u3002</p> <p></p> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0cEndpointSlice \u63a7\u5236\u5668\u53ef\u80fd\u4f1a\u4e3a\u4e0d\u540c\u533a\u57df\u5e94\u7528\u4e00\u4e2a \u63d0\u793a\uff0c\u8fd9\u610f\u5473\u7740\u8be5\u7aef\u70b9\u53ef\u80fd\u6700\u7ec8\u4f1a\u4e3a\u6765\u81ea\u4e0d\u540c\u533a\u57df\u7684\u6d41\u91cf\u63d0\u4f9b\u670d\u52a1\u3002\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\u5c1d\u8bd5\u5728\u4e0d\u540c\u533a\u57df\u4e4b\u95f4\u4fdd\u6301\u6d41\u91cf\u7684\u5747\u5300\u5206\u5e03\u3002</p> <p>\u4ee5\u4e0b\u662f\u542f\u7528 \u62d3\u6251\u611f\u77e5\u8def\u7531 \u7684 Service \u7684\u4ee3\u7801\u7247\u6bb5\u3002</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: orders-service\n  namespace: ecommerce\n    annotations:\n      service.kubernetes.io/topology-mode: Auto\nspec:\n  selector:\n    app: orders\n  type: ClusterIP\n  ports:\n  - protocol: TCP\n    port: 3003\n    targetPort: 3003\n</code></pre> <p>\u4e0b\u9762\u7684\u5c4f\u5e55\u622a\u56fe\u663e\u793a\u4e86 EndpointSlice \u63a7\u5236\u5668\u6210\u529f\u4e3a\u5728 AZ <code>eu-west-1a</code> \u4e2d\u8fd0\u884c\u7684 Pod \u526f\u672c\u7684\u7aef\u70b9\u5e94\u7528\u4e86\u4e00\u4e2a\u63d0\u793a\u3002</p> <p></p> <p>Note</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u62d3\u6251\u611f\u77e5\u8def\u7531\u4ecd\u5904\u4e8e beta \u9636\u6bb5\u3002\u6b64\u5916\uff0c\u5f53\u5de5\u4f5c\u8d1f\u8f7d\u5e7f\u6cdb\u4e14\u5747\u5300\u5730\u5206\u5e03\u5728\u96c6\u7fa4\u62d3\u6251\u4e2d\u65f6\uff0c\u6b64\u529f\u80fd\u7684\u53ef\u9884\u6d4b\u6027\u66f4\u9ad8\u3002\u56e0\u6b64\uff0c\u5f3a\u70c8\u5efa\u8bae\u5c06\u5176\u4e0e\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u6027\u7684\u8c03\u5ea6\u7ea6\u675f (\u5982 pod \u62d3\u6251\u5206\u5e03\u7ea6\u675f) \u7ed3\u5408\u4f7f\u7528\u3002</p> <p>\u4f7f\u7528\u81ea\u52a8\u7f29\u653e\u5668\uff1a \u5c06\u8282\u70b9\u4f9b\u5e94\u5230\u7279\u5b9a\u7684 AZ</p> <p>\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae \u5728\u591a\u4e2a AZ \u4e2d\u8fd0\u884c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u4ee5\u63d0\u9ad8\u73af\u5883\u7684\u9ad8\u53ef\u7528\u6027\u3002\u8fd9\u53ef\u4ee5\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u9760\u6027\uff0c\u7279\u522b\u662f\u5728\u67d0\u4e2a AZ \u51fa\u73b0\u95ee\u9898\u7684\u60c5\u51b5\u4e0b\u3002\u5982\u679c\u60a8\u613f\u610f\u727a\u7272\u53ef\u9760\u6027\u6765\u964d\u4f4e\u7f51\u7edc\u76f8\u5173\u6210\u672c\uff0c\u60a8\u53ef\u4ee5\u5c06\u8282\u70b9\u9650\u5236\u5728\u5355\u4e2a AZ \u4e2d\u3002</p> <p>\u8981\u5728\u540c\u4e00 AZ \u4e2d\u8fd0\u884c\u6240\u6709 Pod\uff0c\u53ef\u4ee5\u5728\u540c\u4e00 AZ \u4e2d\u4f9b\u5e94\u5de5\u4f5c\u8282\u70b9\uff0c\u6216\u8005\u5728\u540c\u4e00 AZ \u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod\u3002\u8981\u5728\u5355\u4e2a AZ \u4e2d\u4f9b\u5e94\u8282\u70b9\uff0c\u8bf7\u4f7f\u7528 Cluster Autoscaler (CA) \u5b9a\u4e49\u4e00\u4e2a\u5c5e\u4e8e\u540c\u4e00 AZ \u7684\u5b50\u7f51\u7684\u8282\u70b9\u7ec4\u3002\u5bf9\u4e8e Karpenter, \u4f7f\u7528 \"topology.kubernetes.io/zone\" \u5e76\u6307\u5b9a\u60a8\u5e0c\u671b\u521b\u5efa\u5de5\u4f5c\u8282\u70b9\u7684 AZ\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u7684 Karpenter \u4f9b\u5e94\u5668\u4ee3\u7801\u7247\u6bb5\u5c06\u5728 us-west-2a AZ \u4e2d\u4f9b\u5e94\u8282\u70b9\u3002</p> <p>Karpenter</p> <pre><code>apiVersion: karpenter.sh/v1alpha5\nkind: Provisioner\nmetadata:\nname: single-az\nspec:\n  requirements:\n  - key: \"topology.kubernetes.io/zone\"\n    operator: In\n    values: [\"us-west-2a\"]\n</code></pre> <p>Cluster Autoscaler (CA)</p> <pre><code>apiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\nmetadata:\n  name: my-ca-cluster\n  region: us-east-1\n  version: \"1.21\"\navailabilityZones:\n- us-east-1a\nmanagedNodeGroups:\n- name: managed-nodes\n  labels:\n    role: managed-nodes\n  instanceType: t3.medium\n  minSize: 1\n  maxSize: 10\n  desiredCapacity: 1\n...\n</code></pre> <p>\u4f7f\u7528 Pod \u5206\u914d\u548c\u8282\u70b9\u4eb2\u548c\u6027</p> <p>\u6216\u8005\uff0c\u5982\u679c\u60a8\u6709\u5728\u591a\u4e2a AZ \u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u6709\u6807\u7b7e topology.kubernetes.io/zone,\u5176\u503c\u4e3a\u5176\u6240\u5728\u7684 AZ (\u5982 us-west-2a \u6216 us-west-2b)\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>nodeSelector</code> \u6216 <code>nodeAffinity</code> \u5c06 Pod \u8c03\u5ea6\u5230\u5355\u4e2a AZ \u4e2d\u7684\u8282\u70b9\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u6e05\u5355\u6587\u4ef6\u5c06\u5728 AZ us-west-2a \u4e2d\u8fd0\u884c\u7684\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  labels:\n    env: test\nspec:\n  nodeSelector:\n    topology.kubernetes.io/zone: us-west-2a\n  containers:\n  - name: nginx\n    image: nginx \n    imagePullPolicy: IfNotPresent\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_networking/#_2","title":"\u9650\u5236\u6d41\u91cf\u5728\u8282\u70b9\u5185","text":"<p>\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4ec5\u5728\u533a\u57df\u7ea7\u522b\u9650\u5236\u6d41\u91cf\u662f\u4e0d\u591f\u7684\u3002\u9664\u4e86\u964d\u4f4e\u6210\u672c\u5916\uff0c\u60a8\u53ef\u80fd\u8fd8\u9700\u8981\u964d\u4f4e\u67d0\u4e9b\u9891\u7e41\u76f8\u4e92\u901a\u4fe1\u7684\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7684\u7f51\u7edc\u5ef6\u8fdf\u3002\u4e3a\u4e86\u5b9e\u73b0\u6700\u4f73\u7f51\u7edc\u6027\u80fd\u548c\u964d\u4f4e\u6210\u672c\uff0c\u60a8\u9700\u8981\u4e00\u79cd\u65b9\u5f0f\u6765\u9650\u5236\u6d41\u91cf\u5728\u7279\u5b9a\u8282\u70b9\u5185\u3002\u4f8b\u5982\uff0c\u5fae\u670d\u52a1 A \u5e94\u8be5\u59cb\u7ec8\u4e0e\u8282\u70b9 1 \u4e0a\u7684\u5fae\u670d\u52a1 B \u901a\u4fe1\uff0c\u5373\u4f7f\u5728\u9ad8\u53ef\u7528 (HA) \u8bbe\u7f6e\u4e2d\u4e5f\u662f\u5982\u6b64\u3002\u5982\u679c\u5fae\u670d\u52a1 A \u5728\u8282\u70b9 1 \u4e0a\u4e0e\u5fae\u670d\u52a1 B \u5728\u8282\u70b9 2 \u4e0a\u901a\u4fe1\uff0c\u53ef\u80fd\u4f1a\u5bf9\u8fd9\u79cd\u6027\u80fd\u8981\u6c42\u8f83\u9ad8\u7684\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\uff0c\u7279\u522b\u662f\u5982\u679c\u8282\u70b9 2 \u4f4d\u4e8e\u4e0d\u540c\u7684 AZ \u65f6\u3002</p> <p>\u4f7f\u7528 Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565</p> <p>\u4e3a\u4e86\u9650\u5236 Pod \u7f51\u7edc\u6d41\u91cf\u5728\u8282\u70b9\u5185\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53d1\u9001\u5230\u5de5\u4f5c\u8d1f\u8f7d Service \u7684\u6d41\u91cf\u5c06\u5728\u4e0d\u540c\u751f\u6210\u7684\u7aef\u70b9\u4e4b\u95f4\u968f\u673a\u5206\u5e03\u3002\u56e0\u6b64\uff0c\u5728\u9ad8\u53ef\u7528\u67b6\u6784\u4e2d\uff0c\u8fd9\u610f\u5473\u7740\u6765\u81ea\u5fae\u670d\u52a1 A \u7684\u6d41\u91cf\u53ef\u80fd\u4f1a\u8fdb\u5165\u4efb\u4f55\u4e00\u4e2a\u5fae\u670d\u52a1 B \u7684\u526f\u672c\uff0c\u65e0\u8bba\u5b83\u5728\u54ea\u4e2a\u8282\u70b9\u4e0a\u3002\u4f46\u662f\uff0c\u5982\u679c\u5c06 Service \u7684\u5185\u90e8\u6d41\u91cf\u7b56\u7565\u8bbe\u7f6e\u4e3a <code>Local</code>,\u6d41\u91cf\u5c06\u88ab\u9650\u5236\u5728\u6d41\u91cf\u8d77\u6e90\u8282\u70b9\u4e0a\u7684\u7aef\u70b9\u3002\u6b64\u7b56\u7565\u89c4\u5b9a\u4e86\u4e13\u95e8\u4f7f\u7528\u8282\u70b9\u672c\u5730\u7aef\u70b9\u3002\u8fd9\u610f\u5473\u7740\uff0c\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u7684\u7f51\u7edc\u6d41\u91cf\u76f8\u5173\u6210\u672c\u5c06\u4f4e\u4e8e\u5728\u6574\u4e2a\u96c6\u7fa4\u8303\u56f4\u5185\u5206\u5e03\u7684\u60c5\u51b5\u3002\u6b64\u5916\uff0c\u5ef6\u8fdf\u4e5f\u4f1a\u964d\u4f4e\uff0c\u4ece\u800c\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\u3002</p> <p>Note</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b64\u529f\u80fd\u65e0\u6cd5\u4e0e Kubernetes \u4e2d\u7684\u62d3\u6251\u611f\u77e5\u8def\u7531\u7ed3\u5408\u4f7f\u7528\u3002</p> <p></p> <p>\u4e0b\u9762\u662f\u8bbe\u7f6e Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565 \u7684\u4ee3\u7801\u7247\u6bb5\u3002</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: orders-service\n  namespace: ecommerce\nspec:\n  selector:\n    app: orders\n  type: ClusterIP\n  ports:\n  - protocol: TCP\n    port: 3003\n    targetPort: 3003\n  internalTrafficPolicy: Local\n</code></pre> <p>\u4e3a\u4e86\u907f\u514d\u7531\u4e8e\u6d41\u91cf\u4e22\u5f03\u800c\u5bfc\u81f4\u5e94\u7528\u7a0b\u5e8f\u51fa\u73b0\u610f\u5916\u884c\u4e3a\uff0c\u60a8\u5e94\u8be5\u8003\u8651\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p> <ul> <li>\u4e3a\u6bcf\u4e2a\u901a\u4fe1\u7684 Pod \u8fd0\u884c\u8db3\u591f\u7684\u526f\u672c</li> <li>\u4f7f\u7528 \u62d3\u6251\u5206\u5e03\u7ea6\u675f \u5b9e\u73b0 Pod \u7684\u76f8\u5bf9\u5747\u5300\u5206\u5e03</li> <li>\u4f7f\u7528 pod \u4eb2\u548c\u6027\u89c4\u5219 \u6765\u5b9e\u73b0\u901a\u4fe1 Pod \u7684\u5171\u5b58</li> </ul> <p>\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u60a8\u6709 2 \u4e2a\u5fae\u670d\u52a1 A \u7684\u526f\u672c\u548c 3 \u4e2a\u5fae\u670d\u52a1 B \u7684\u526f\u672c\u3002\u5982\u679c\u5fae\u670d\u52a1 A \u7684\u526f\u672c\u5206\u5e03\u5728\u8282\u70b9 1 \u548c 2 \u4e0a\uff0c\u800c\u5fae\u670d\u52a1 B \u7684\u6240\u6709 3 \u4e2a\u526f\u672c\u90fd\u5728\u8282\u70b9 3 \u4e0a\uff0c\u90a3\u4e48\u7531\u4e8e <code>Local</code> \u5185\u90e8\u6d41\u91cf\u7b56\u7565\uff0c\u5b83\u4eec\u5c06\u65e0\u6cd5\u901a\u4fe1\u3002\u5f53\u6ca1\u6709\u53ef\u7528\u7684\u8282\u70b9\u672c\u5730\u7aef\u70b9\u65f6\uff0c\u6d41\u91cf\u5c06\u88ab\u4e22\u5f03\u3002</p> <p></p> <p>\u5982\u679c\u5fae\u670d\u52a1 B \u5728\u8282\u70b9 1 \u548c 2 \u4e0a\u5404\u6709 2 \u4e2a\u526f\u672c\uff0c\u90a3\u4e48 <code>graphql</code> \u548c <code>orders</code> \u4e4b\u95f4\u5c31\u4f1a\u6709\u901a\u4fe1\u3002\u4f46\u60a8\u4ecd\u4f1a\u6709\u4e00\u4e2a\u5b64\u7acb\u7684\u5fae\u670d\u52a1 B \u526f\u672c\uff0c\u6ca1\u6709\u4efb\u4f55\u5bf9\u7b49\u526f\u672c\u53ef\u4ee5\u4e0e\u4e4b\u901a\u4fe1\u3002</p> <p></p> <p>Note</p> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e0a\u56fe\u6240\u793a\u7684\u5b64\u7acb\u526f\u672c\u53ef\u80fd\u4e0d\u4f1a\u5f15\u8d77\u5173\u6ce8\uff0c\u5982\u679c\u5b83\u4ecd\u7136\u53ef\u4ee5\u7528\u4e8e\u670d\u52a1\u5916\u90e8\u4f20\u5165\u7684\u8bf7\u6c42\u3002</p> <p>\u5c06 Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565\u4e0e\u62d3\u6251\u5206\u5e03\u7ea6\u675f\u7ed3\u5408\u4f7f\u7528</p> <p>\u5c06 \u5185\u90e8\u6d41\u91cf\u7b56\u7565 \u4e0e \u62d3\u6251\u5206\u5e03\u7ea6\u675f \u7ed3\u5408\u4f7f\u7528\u53ef\u4ee5\u786e\u4fdd\u5728\u4e0d\u540c\u8282\u70b9\u4e0a\u4e3a\u901a\u4fe1\u7684\u5fae\u670d\u52a1\u90e8\u7f72\u6b63\u786e\u6570\u91cf\u7684\u526f\u672c\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: express-test\nspec:\n  replicas: 6\n  selector:\n    matchLabels:\n      app: express-test\n  template:\n    metadata:\n      labels:\n        app: express-test\n        tier: backend\n    spec:\n      topologySpreadConstraints:\n      - maxSkew: 1\n        topologyKey: \"topology.kubernetes.io/zone\"\n        whenUnsatisfiable: ScheduleAnyway\n        labelSelector:\n          matchLabels:\n            app: express-test\n</code></pre> <p>\u5c06 Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565\u4e0e Pod \u4eb2\u548c\u6027\u89c4\u5219\u7ed3\u5408\u4f7f\u7528</p> <p>\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u5728\u4f7f\u7528 Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565\u65f6\u4f7f\u7528 Pod \u4eb2\u548c\u6027\u89c4\u5219\u3002\u901a\u8fc7 Pod \u4eb2\u548c\u6027\uff0c\u60a8\u53ef\u4ee5\u5f71\u54cd\u8c03\u5ea6\u5668\u5c06\u67d0\u4e9b\u9891\u7e41\u901a\u4fe1\u7684 Pod \u5171\u5b58\u3002\u901a\u8fc7\u5bf9\u67d0\u4e9b Pod \u5e94\u7528\u4e25\u683c\u7684\u8c03\u5ea6\u7ea6\u675f (<code>requiredDuringSchedulingIgnoredDuringExecution</code>),\u5728\u8c03\u5ea6\u5668\u5c06 Pod \u653e\u7f6e\u5728\u8282\u70b9\u4e0a\u65f6\uff0c\u8fd9\u5c06\u4e3a Pod \u5171\u5b58\u63d0\u4f9b\u66f4\u597d\u7684\u7ed3\u679c\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: graphql\n  namespace: ecommerce\n  labels:\n    app.kubernetes.io/version: \"0.1.6\"\n    ...\n    spec:\n      serviceAccountName: graphql-service-account\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n          - labelSelector:\n              matchExpressions:\n              - key: app\n                operator: In\n                values:\n                - orders\n            topologyKey: \"kubernetes.io/hostname\"\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_networking/#pod","title":"\u8d1f\u8f7d\u5747\u8861\u5668\u5230 Pod \u901a\u4fe1","text":"<p>EKS \u5de5\u4f5c\u8d1f\u8f7d\u901a\u5e38\u7531\u8d1f\u8f7d\u5747\u8861\u5668\u524d\u7f6e\uff0c\u8d1f\u8f7d\u5747\u8861\u5668\u5c06\u6d41\u91cf\u5206\u53d1\u5230 EKS \u96c6\u7fa4\u4e2d\u7684\u76f8\u5173 Pod\u3002\u60a8\u7684\u67b6\u6784\u53ef\u80fd\u5305\u62ec\u5185\u90e8\u548c/\u6216\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u6839\u636e\u60a8\u7684\u67b6\u6784\u548c\u7f51\u7edc\u6d41\u91cf\u914d\u7f6e\uff0c\u8d1f\u8f7d\u5747\u8861\u5668\u4e0e Pod \u4e4b\u95f4\u7684\u901a\u4fe1\u53ef\u80fd\u4f1a\u5bf9\u6570\u636e\u4f20\u8f93\u8d39\u7528\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 AWS Load Balancer Controller \u81ea\u52a8\u7ba1\u7406 ELB \u8d44\u6e90 (ALB \u548c NLB) \u7684\u521b\u5efa\u3002\u5728\u8fd9\u79cd\u8bbe\u7f6e\u4e2d\uff0c\u60a8\u4ea7\u751f\u7684\u6570\u636e\u4f20\u8f93\u8d39\u7528\u5c06\u53d6\u51b3\u4e8e\u7f51\u7edc\u6d41\u91cf\u7684\u8def\u5f84\u3002AWS Load Balancer Controller \u652f\u6301\u4e24\u79cd\u7f51\u7edc\u6d41\u91cf\u6a21\u5f0f\uff1a\u5b9e\u4f8b\u6a21\u5f0f \u548c ip \u6a21\u5f0f\u3002</p> <p>\u4f7f\u7528 \u5b9e\u4f8b\u6a21\u5f0f \u65f6\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u4f1a\u6253\u5f00\u4e00\u4e2a NodePort\u3002\u8d1f\u8f7d\u5747\u8861\u5668\u5c06\u5728\u8282\u70b9\u4e4b\u95f4\u5747\u5300\u4ee3\u7406\u6d41\u91cf\u3002\u5982\u679c\u76ee\u6807 Pod \u8fd0\u884c\u5728\u63a5\u6536\u6d41\u91cf\u7684\u8282\u70b9\u4e0a\uff0c\u5219\u4e0d\u4f1a\u4ea7\u751f\u6570\u636e\u4f20\u8f93\u6210\u672c\u3002\u4f46\u662f\uff0c\u5982\u679c\u76ee\u6807 Pod \u4f4d\u4e8e\u4e0d\u540c\u7684\u8282\u70b9\u5e76\u4e14\u5728\u4e0e\u63a5\u6536\u6d41\u91cf\u7684 NodePort \u4e0d\u540c\u7684 AZ \u4e2d\uff0c\u90a3\u4e48\u4ece kube-proxy \u5230\u76ee\u6807 Pod \u5c06\u4f1a\u6709\u989d\u5916\u7684\u7f51\u7edc\u8df3\u8dc3\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4ea7\u751f\u8de8 AZ \u6570\u636e\u4f20\u8f93\u8d39\u7528\u3002\u7531\u4e8e\u6d41\u91cf\u5728\u8282\u70b9\u4e4b\u95f4\u5747\u5300\u5206\u5e03\uff0c\u5f88\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e0e\u4ece kube-proxy \u5230\u76f8\u5173\u76ee\u6807 Pod \u7684\u8de8\u533a\u57df\u7f51\u7edc\u8df3\u8dc3\u76f8\u5173\u7684\u989d\u5916\u6570\u636e\u4f20\u8f93\u8d39\u7528\u3002</p> <p>\u4e0b\u56fe\u63cf\u7ed8\u4e86\u4e00\u4e2a\u7f51\u7edc\u8def\u5f84\uff0c\u6d41\u91cf\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u6d41\u5411 NodePort\uff0c\u968f\u540e\u4ece <code>kube-proxy</code> \u6d41\u5411\u4f4d\u4e8e\u4e0d\u540c AZ \u4e2d\u7684\u5355\u72ec\u8282\u70b9\u4e0a\u7684\u76ee\u6807 Pod\u3002\u8fd9\u662f \u5b9e\u4f8b\u6a21\u5f0f \u8bbe\u7f6e\u7684\u4e00\u4e2a\u793a\u4f8b\u3002</p> <p></p> <p>\u4f7f\u7528 ip \u6a21\u5f0f \u65f6\uff0c\u7f51\u7edc\u6d41\u91cf\u76f4\u63a5\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u4ee3\u7406\u5230\u76ee\u6807 Pod\u3002\u56e0\u6b64\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4f1a\u4ea7\u751f\u6570\u636e\u4f20\u8f93\u8d39\u7528\u3002</p> <p>Tip</p> <p>\u5efa\u8bae\u5c06\u60a8\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u8bbe\u7f6e\u4e3a ip \u6d41\u91cf\u6a21\u5f0f \u4ee5\u964d\u4f4e\u6570\u636e\u4f20\u8f93\u8d39\u7528\u3002\u5bf9\u4e8e\u8fd9\u79cd\u8bbe\u7f6e\uff0c\u8fd8\u9700\u8981\u786e\u4fdd\u60a8\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u90e8\u7f72\u5728 VPC \u4e2d\u7684\u6240\u6709\u5b50\u7f51\u4e0a\u3002</p> <p>\u4e0b\u56fe\u63cf\u7ed8\u4e86\u7f51\u7edc\u8def\u5f84\uff0c\u6d41\u91cf\u5728 ip \u6a21\u5f0f \u4e0b\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u6d41\u5411 Pod\u3002</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_networking/#_3","title":"\u4ece\u5bb9\u5668\u6ce8\u518c\u8868\u4f20\u8f93\u6570\u636e","text":""},{"location":"zh/cost_optimization/cost_opt_networking/#amazon-ecr","title":"Amazon ECR","text":"<p>\u4f20\u8f93\u5230 Amazon ECR \u79c1\u6709\u6ce8\u518c\u8868\u662f\u514d\u8d39\u7684\u3002\u533a\u57df\u5185\u6570\u636e\u4f20\u8f93\u4e0d\u6536\u8d39\uff0c\u4f46\u4f20\u8f93\u5230\u4e92\u8054\u7f51\u548c\u8de8\u533a\u57df\u7684\u6570\u636e\u4f20\u8f93\u5c06\u6309\u4e92\u8054\u7f51\u6570\u636e\u4f20\u8f93\u8d39\u7387\u5728\u4f20\u8f93\u7684\u4e24\u7aef\u6536\u8d39\u3002</p> <p>\u60a8\u5e94\u8be5\u5229\u7528 ECR \u5185\u7f6e\u7684 \u955c\u50cf\u590d\u5236\u529f\u80fd \u5c06\u76f8\u5173\u5bb9\u5668\u955c\u50cf\u590d\u5236\u5230\u4e0e\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u76f8\u540c\u7684\u533a\u57df\u3002\u8fd9\u6837\uff0c\u590d\u5236\u5c06\u88ab\u6536\u8d39\u4e00\u6b21\uff0c\u800c\u6240\u6709\u76f8\u540c\u533a\u57df (\u533a\u57df\u5185) \u7684\u955c\u50cf\u62c9\u53d6\u90fd\u5c06\u514d\u8d39\u3002</p> <p>\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7 \u4f7f\u7528 Interface VPC Endpoints \u8fde\u63a5\u5230\u533a\u57df\u5185\u7684 ECR \u5b58\u50a8\u5e93 \u6765\u8fdb\u4e00\u6b65\u964d\u4f4e\u4ece ECR \u62c9\u53d6\u955c\u50cf (\u6570\u636e\u4f20\u8f93\u51fa) \u76f8\u5173\u7684\u6570\u636e\u4f20\u8f93\u6210\u672c\u3002\u8fde\u63a5\u5230 ECR \u7684\u516c\u5171 AWS \u7aef\u70b9 (\u901a\u8fc7 NAT \u7f51\u5173\u548c\u4e92\u8054\u7f51\u7f51\u5173) \u7684\u66ff\u4ee3\u65b9\u6cd5\u5c06\u4ea7\u751f\u66f4\u9ad8\u7684\u6570\u636e\u5904\u7406\u548c\u4f20\u8f93\u6210\u672c\u3002\u4e0b\u4e00\u8282\u5c06\u66f4\u8be6\u7ec6\u5730\u4ecb\u7ecd\u964d\u4f4e\u5de5\u4f5c\u8d1f\u8f7d\u4e0e AWS \u670d\u52a1\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u6210\u672c\u3002</p> <p>\u5982\u679c\u60a8\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u7279\u522b\u5927\u7684\u955c\u50cf\uff0c\u60a8\u53ef\u4ee5\u6784\u5efa\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49 Amazon Machine Images (AMI)\uff0c\u5176\u4e2d\u9884\u5148\u7f13\u5b58\u4e86\u5bb9\u5668\u955c\u50cf\u3002\u8fd9\u53ef\u4ee5\u51cf\u5c11\u4ece\u5bb9\u5668\u6ce8\u518c\u8868\u5230 EKS \u5de5\u4f5c\u8282\u70b9\u7684\u521d\u59cb\u955c\u50cf\u62c9\u53d6\u65f6\u95f4\u548c\u6f5c\u5728\u6570\u636e\u4f20\u8f93\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_networking/#aws","title":"\u4f20\u8f93\u5230\u4e92\u8054\u7f51\u548c AWS \u670d\u52a1","text":"<p>\u5c06 Kubernetes \u5de5\u4f5c\u8d1f\u8f7d\u4e0e\u5176\u4ed6 AWS \u670d\u52a1\u6216\u7b2c\u4e09\u65b9\u5de5\u5177\u548c\u5e73\u53f0\u901a\u8fc7\u4e92\u8054\u7f51\u96c6\u6210\u662f\u4e00\u79cd\u5e38\u89c1\u505a\u6cd5\u3002\u7528\u4e8e\u8def\u7531\u6d41\u91cf\u5230\u76f8\u5173\u76ee\u7684\u5730\u7684\u5e95\u5c42\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\u53ef\u80fd\u4f1a\u5f71\u54cd\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_networking/#nat","title":"\u4f7f\u7528 NAT \u7f51\u5173","text":"<p>NAT \u7f51\u5173\u662f\u6267\u884c\u7f51\u7edc\u5730\u5740\u8f6c\u6362 (NAT) \u7684\u7f51\u7edc\u7ec4\u4ef6\u3002\u4e0b\u56fe\u63cf\u7ed8\u4e86 EKS \u96c6\u7fa4\u4e2d\u7684 Pod \u4e0e\u5176\u4ed6 AWS \u670d\u52a1 (Amazon ECR\u3001DynamoDB \u548c S3) \u4ee5\u53ca\u7b2c\u4e09\u65b9\u5e73\u53f0\u901a\u4fe1\u7684\u60c5\u51b5\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0cPod \u8fd0\u884c\u5728\u4e0d\u540c AZ \u7684\u79c1\u6709\u5b50\u7f51\u4e2d\u3002\u8981\u53d1\u9001\u548c\u63a5\u6536\u6765\u81ea\u4e92\u8054\u7f51\u7684\u6d41\u91cf\uff0c\u9700\u8981\u5728\u4e00\u4e2a AZ \u7684\u516c\u5171\u5b50\u7f51\u4e2d\u90e8\u7f72 NAT \u7f51\u5173\uff0c\u5141\u8bb8\u5177\u6709\u79c1\u6709 IP \u5730\u5740\u7684\u4efb\u4f55\u8d44\u6e90\u5171\u4eab\u4e00\u4e2a\u516c\u5171 IP \u5730\u5740\u6765\u8bbf\u95ee\u4e92\u8054\u7f51\u3002\u8fd9\u4e2a NAT \u7f51\u5173\u53cd\u8fc7\u6765\u4e0e\u4e92\u8054\u7f51\u7f51\u5173\u7ec4\u4ef6\u901a\u4fe1\uff0c\u5141\u8bb8\u6570\u636e\u5305\u88ab\u53d1\u9001\u5230\u6700\u7ec8\u76ee\u7684\u5730\u3002</p> <p></p> <p>\u5728\u4f7f\u7528 NAT \u7f51\u5173\u8fdb\u884c\u6b64\u7c7b\u7528\u4f8b\u65f6\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u6bcf\u4e2a AZ \u4e2d\u90e8\u7f72\u4e00\u4e2a NAT \u7f51\u5173\u6765\u6700\u5c0f\u5316\u6570\u636e\u4f20\u8f93\u6210\u672c\u3002\u8fd9\u6837\uff0c\u8def\u7531\u5230\u4e92\u8054\u7f51\u7684\u6d41\u91cf\u5c06\u901a\u8fc7\u540c\u4e00 AZ \u4e2d\u7684 NAT \u7f51\u5173\uff0c\u907f\u514d\u4e86\u8de8 AZ \u6570\u636e\u4f20\u8f93\u3002\u4f46\u662f\uff0c\u5373\u4f7f\u60a8\u53ef\u4ee5\u8282\u7701\u8de8 AZ \u6570\u636e\u4f20\u8f93\u7684\u6210\u672c\uff0c\u8fd9\u79cd\u8bbe\u7f6e\u7684\u542b\u4e49\u662f\u60a8\u7684\u67b6\u6784\u4e2d\u5c06\u589e\u52a0\u4e00\u4e2a NAT \u7f51\u5173\u7684\u6210\u672c\u3002</p> <p>\u4e0b\u56fe\u63cf\u7ed8\u4e86\u8fd9\u79cd\u63a8\u8350\u65b9\u6cd5\u3002</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_networking/#vpc","title":"\u4f7f\u7528 VPC \u7aef\u70b9","text":"<p>\u4e3a\u4e86\u8fdb\u4e00\u6b65\u964d\u4f4e\u6b64\u7c7b\u67b6\u6784\u7684\u6210\u672c\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528 VPC \u7aef\u70b9 \u5728\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4e0e AWS \u670d\u52a1\u4e4b\u95f4\u5efa\u7acb\u8fde\u63a5\u3002VPC \u7aef\u70b9\u5141\u8bb8\u60a8\u4ece VPC \u5185\u90e8\u8bbf\u95ee AWS \u670d\u52a1\uff0c\u800c\u65e0\u9700\u6570\u636e/\u7f51\u7edc\u6570\u636e\u5305\u7a7f\u8d8a\u4e92\u8054\u7f51\u3002\u6240\u6709\u6d41\u91cf\u90fd\u4fdd\u7559\u5728 AWS \u7f51\u7edc\u5185\u90e8\u3002\u6709\u4e24\u79cd\u7c7b\u578b\u7684 VPC \u7aef\u70b9\uff1aInterface VPC \u7aef\u70b9 (\u7531\u8bb8\u591a AWS \u670d\u52a1\u652f\u6301) \u548c Gateway VPC \u7aef\u70b9 (\u4ec5\u7531 S3 \u548c DynamoDB \u652f\u6301)\u3002</p> <p>Gateway VPC \u7aef\u70b9</p> <p>\u4f7f\u7528 Gateway VPC \u7aef\u70b9\u4e0d\u4f1a\u4ea7\u751f\u6bcf\u5c0f\u65f6\u6216\u6570\u636e\u4f20\u8f93\u8d39\u7528\u3002\u4f7f\u7528 Gateway VPC \u7aef\u70b9\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u5b83\u4eec\u65e0\u6cd5\u8de8 VPC \u8fb9\u754c\u6269\u5c55\u3002\u5b83\u4eec\u4e0d\u80fd\u5728 VPC \u5bf9\u7b49\u3001VPN \u7f51\u7edc\u6216\u901a\u8fc7 Direct Connect \u4e2d\u4f7f\u7528\u3002</p> <p>Interface VPC \u7aef\u70b9</p> <p>VPC \u7aef\u70b9\u6709 \u6bcf\u5c0f\u65f6\u8d39\u7528,\u5e76\u4e14\u6839\u636e AWS \u670d\u52a1\u7684\u4e0d\u540c\uff0c\u53ef\u80fd\u8fd8\u4f1a\u6709\u901a\u8fc7\u5e95\u5c42 ENI \u8fdb\u884c\u6570\u636e\u5904\u7406\u7684\u989d\u5916\u8d39\u7528\u3002\u4e3a\u4e86\u964d\u4f4e\u4e0e Interface VPC \u7aef\u70b9\u76f8\u5173\u7684\u8de8 AZ \u6570\u636e\u4f20\u8f93\u6210\u672c\uff0c\u60a8\u53ef\u4ee5\u5728\u6bcf\u4e2a AZ \u4e2d\u521b\u5efa\u4e00\u4e2a VPC \u7aef\u70b9\u3002\u60a8\u53ef\u4ee5\u5728\u540c\u4e00 VPC \u4e2d\u521b\u5efa\u591a\u4e2a\u6307\u5411\u540c\u4e00 AWS \u670d\u52a1\u7684 VPC \u7aef\u70b9\u3002</p> <p>\u4e0b\u56fe\u663e\u793a\u4e86 Pod \u901a\u8fc7 VPC \u7aef\u70b9\u4e0e AWS \u670d\u52a1\u901a\u4fe1\u3002</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_networking/#vpc_1","title":"VPC \u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u5728\u4e0d\u540c\u7684 VPC \u4e2d (\u4f4d\u4e8e\u540c\u4e00 AWS \u533a\u57df\u5185) \u6709\u9700\u8981\u76f8\u4e92\u901a\u4fe1\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5141\u8bb8\u6d41\u91cf\u7a7f\u8d8a\u516c\u5171\u4e92\u8054\u7f51\uff0c\u901a\u8fc7\u8fde\u63a5\u5230\u5404\u81ea VPC \u7684\u4e92\u8054\u7f51\u7f51\u5173\u6765\u5b9e\u73b0\u3002\u53ef\u4ee5\u901a\u8fc7\u5728\u516c\u5171\u5b50\u7f51\u4e2d\u90e8\u7f72\u57fa\u7840\u8bbe\u65bd\u7ec4\u4ef6 (\u5982 EC2 \u5b9e\u4f8b\u3001NAT \u7f51\u5173\u6216 NAT \u5b9e\u4f8b) \u6765\u542f\u7528\u6b64\u7c7b\u901a\u4fe1\u3002\u4f46\u662f\uff0c\u5305\u542b\u8fd9\u4e9b\u7ec4\u4ef6\u7684\u8bbe\u7f6e\u5c06\u4ea7\u751f\u5904\u7406/\u4f20\u8f93\u8fdb\u51fa VPC \u7684\u6570\u636e\u7684\u8d39\u7528\u3002\u5982\u679c\u6d41\u91cf\u5728\u4e0d\u540c VPC \u4e4b\u95f4\u79fb\u52a8\u65f6\u8de8\u8d8a\u4e86 AZ\uff0c\u90a3\u4e48\u8fd8\u4f1a\u4ea7\u751f\u989d\u5916\u7684\u6570\u636e\u4f20\u8f93\u8d39\u7528\u3002\u4e0b\u56fe\u63cf\u7ed8\u4e86\u4e00\u4e2a\u4f7f\u7528 NAT \u7f51\u5173\u548c\u4e92\u8054\u7f51\u7f51\u5173\u5728\u4e0d\u540c VPC \u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\u5efa\u7acb\u901a\u4fe1\u7684\u8bbe\u7f6e\u3002</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_networking/#vpc_2","title":"VPC \u5bf9\u7b49\u8fde\u63a5","text":"<p>\u4e3a\u4e86\u964d\u4f4e\u6b64\u7c7b\u7528\u4f8b\u7684\u6210\u672c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 VPC \u5bf9\u7b49\u3002\u4f7f\u7528 VPC \u5bf9\u7b49\u8fde\u63a5\uff0c\u5728\u540c\u4e00 AZ \u5185\u4fdd\u6301\u7684\u7f51\u7edc\u6d41\u91cf\u4e0d\u4f1a\u4ea7\u751f\u6570\u636e\u4f20\u8f93\u8d39\u7528\u3002\u5982\u679c\u6d41\u91cf\u8de8\u8d8a AZ\uff0c\u5c06\u4f1a\u4ea7\u751f\u8d39\u7528\u3002\u5c3d\u7ba1\u5982\u6b64\uff0cVPC \u5bf9\u7b49\u65b9\u6cd5\u4ecd\u88ab\u63a8\u8350\u7528\u4e8e\u5728\u540c\u4e00 AWS \u533a\u57df\u5185\u4e0d\u540c VPC \u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\u8fdb\u884c\u6210\u672c\u6548\u76ca\u8f83\u9ad8\u7684\u901a\u4fe1\u3002\u4f46\u662f\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cVPC \u5bf9\u7b49\u4e3b\u8981\u6709\u6548\u4e8e 1\uff1a1 VPC \u8fde\u63a5\uff0c\u56e0\u4e3a\u5b83\u4e0d\u5141\u8bb8\u4f20\u9012\u7f51\u7edc\u3002</p> <p>\u4e0b\u56fe\u662f\u5de5\u4f5c\u8d1f\u8f7d\u901a\u8fc7 VPC \u5bf9\u7b49\u8fde\u63a5\u8fdb\u884c\u901a\u4fe1\u7684\u9ad8\u7ea7\u8868\u793a\u3002</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_networking/#_4","title":"\u4f20\u9012\u7f51\u7edc\u8fde\u63a5","text":"<p>\u5982\u4e0a\u4e00\u8282\u6240\u8ff0\uff0cVPC \u5bf9\u7b49\u8fde\u63a5\u4e0d\u5141\u8bb8\u4f20\u9012\u7f51\u7edc\u8fde\u63a5\u3002\u5982\u679c\u60a8\u60f3\u8fde\u63a5 3 \u4e2a\u6216\u66f4\u591a VPC\uff0c\u5e76\u4e14\u9700\u8981\u4f20\u9012\u7f51\u7edc\uff0c\u90a3\u4e48\u60a8\u5e94\u8be5\u4f7f\u7528 Transit Gateway (TGW)\u3002\u8fd9\u5c06\u4f7f\u60a8\u80fd\u591f\u514b\u670d VPC \u5bf9\u7b49\u7684\u9650\u5236\u6216\u5728\u591a\u4e2a VPC \u4e4b\u95f4\u8fdb\u884c\u591a\u4e2a VPC \u5bf9\u7b49\u8fde\u63a5\u6240\u5e26\u6765\u7684\u8fd0\u8425\u5f00\u9500\u3002\u60a8\u9700\u8981\u6309\u5c0f\u65f6\u4ed8\u8d39\uff0c\u5e76\u4e3a\u53d1\u9001\u5230 TGW \u7684\u6570\u636e\u4ed8\u8d39\u3002\u901a\u8fc7 TGW \u6d41\u52a8\u7684\u8de8 AZ \u6d41\u91cf\u4e0d\u4f1a\u4ea7\u751f\u76ee\u7684\u5730\u8d39\u7528\u3002</p> <p>\u4e0b\u56fe\u663e\u793a\u4e86\u5728\u540c\u4e00 AWS \u533a\u57df\u5185\u4e0d\u540c VPC \u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\uff0c\u8de8 AZ \u6d41\u91cf\u6d41\u7ecf TGW\u3002</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_networking/#_5","title":"\u4f7f\u7528\u670d\u52a1\u7f51\u683c","text":"<p>\u670d\u52a1\u7f51\u683c\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u7f51\u7edc\u529f\u80fd\uff0c\u53ef\u7528\u4e8e\u964d\u4f4e EKS \u96c6\u7fa4\u73af\u5883\u4e2d\u7684\u7f51\u7edc\u76f8\u5173\u6210\u672c\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u91c7\u7528\u670d\u52a1\u7f51\u683c\uff0c\u60a8\u5e94\u8be5\u4ed4\u7ec6\u8003\u8651\u5b83\u5c06\u4e3a\u60a8\u7684\u73af\u5883\u5f15\u5165\u7684\u64cd\u4f5c\u4efb\u52a1\u548c\u590d\u6742\u6027\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_networking/#_6","title":"\u9650\u5236\u6d41\u91cf\u5728\u53ef\u7528\u533a\u5185","text":"<p>\u4f7f\u7528 Istio \u7684\u533a\u57df\u52a0\u6743\u5206\u5e03</p> <p>Istio \u5141\u8bb8\u60a8\u5728\u8def\u7531\u53d1\u751f\u540e\u5bf9\u6d41\u91cf\u5e94\u7528\u7f51\u7edc\u7b56\u7565\u3002\u8fd9\u662f\u4f7f\u7528 Destination Rules \u5982 locality weighted distribution \u5b9e\u73b0\u7684\u3002\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u63a7\u5236\u4ece\u67d0\u4e2a\u6765\u6e90\u5230\u67d0\u4e2a\u76ee\u7684\u5730\u7684\u6d41\u91cf\u6743\u91cd (\u4ee5\u767e\u5206\u6bd4\u8868\u793a)\u3002\u6b64\u6d41\u91cf\u7684\u6765\u6e90\u53ef\u4ee5\u662f\u5916\u90e8 (\u6216\u516c\u5171) \u8d1f\u8f7d\u5747\u8861\u5668\u6216\u96c6\u7fa4\u5185\u7684 Pod\u3002\u5f53\u6240\u6709 Pod \u7aef\u70b9\u90fd\u53ef\u7528\u65f6\uff0c\u533a\u57df\u5c06\u6839\u636e\u52a0\u6743\u8f6e\u8be2\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u8fdb\u884c\u9009\u62e9\u3002\u5982\u679c\u67d0\u4e9b\u7aef\u70b9\u4e0d\u5065\u5eb7\u6216\u4e0d\u53ef\u7528\uff0c\u533a\u57df\u6743\u91cd\u5c06\u81ea\u52a8\u8c03\u6574 \u4ee5\u53cd\u6620\u53ef\u7528\u7aef\u70b9\u7684\u53d8\u5316\u3002</p> <p>Note</p> <p>\u5728\u5b9e\u65bd\u533a\u57df\u52a0\u6743\u5206\u5e03\u4e4b\u524d\uff0c\u60a8\u5e94\u8be5\u5148\u4e86\u89e3\u60a8\u7684\u7f51\u7edc\u6d41\u91cf\u6a21\u5f0f\u4ee5\u53ca Destination Rule \u7b56\u7565\u53ef\u80fd\u5bf9\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u884c\u4e3a\u4ea7\u751f\u7684\u5f71\u54cd\u3002\u56e0\u6b64\uff0c\u62e5\u6709\u5206\u5e03\u5f0f\u8ddf\u8e2a\u673a\u5236 (\u5982 AWS X-Ray \u6216 Jaeger) \u975e\u5e38\u91cd\u8981\u3002</p> <p>\u4e0a\u8ff0 Istio Destination Rules \u4e5f\u53ef\u4ee5\u5e94\u7528\u4e8e\u7ba1\u7406\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u5230 EKS \u96c6\u7fa4\u4e2d\u7684 Pod \u7684\u6d41\u91cf\u3002\u53ef\u4ee5\u5c06\u533a\u57df\u52a0\u6743\u5206\u5e03\u89c4\u5219\u5e94\u7528\u4e8e\u4ece\u9ad8\u53ef\u7528\u8d1f\u8f7d\u5747\u8861\u5668 (\u7279\u522b\u662f Ingress Gateway) \u63a5\u6536\u6d41\u91cf\u7684 Service\u3002\u8fd9\u4e9b\u89c4\u5219\u5141\u8bb8\u60a8\u6839\u636e\u6d41\u91cf\u7684\u533a\u57df\u6765\u6e90 (\u5728\u672c\u4f8b\u4e2d\u4e3a\u8d1f\u8f7d\u5747\u8861\u5668) \u63a7\u5236\u6d41\u91cf\u6d41\u5411\u4f55\u5904\u7684\u6bd4\u4f8b\u3002\u5982\u679c\u914d\u7f6e\u6b63\u786e\uff0c\u4e0e\u8d1f\u8f7d\u5747\u8861\u5668\u5728\u4e0d\u540c AZ \u4e2d\u7684 Pod \u526f\u672c\u4e4b\u95f4\u5747\u5300\u6216\u968f\u673a\u5206\u53d1\u6d41\u91cf\u76f8\u6bd4\uff0c\u5c06\u4ea7\u751f\u66f4\u5c11\u7684\u51fa\u53e3\u8de8\u533a\u57df\u6d41\u91cf\u3002</p> <p>\u4e0b\u9762\u662f Istio \u4e2d Destination Rule \u8d44\u6e90\u7684\u4ee3\u7801\u5757\u793a\u4f8b\u3002\u5982\u4e0b\u6240\u793a\uff0c\u6b64\u8d44\u6e90\u4e3a\u6765\u81ea <code>eu-west-1</code> \u533a\u57df 3 \u4e2a\u4e0d\u540c AZ \u7684\u4f20\u5165\u6d41\u91cf\u6307\u5b9a\u4e86\u52a0\u6743\u914d\u7f6e\u3002\u8fd9\u4e9b\u914d\u7f6e\u58f0\u660e\uff0c\u4ece\u7ed9\u5b9a AZ \u4f20\u5165\u7684\u5927\u90e8\u5206\u6d41\u91cf (\u672c\u4f8b\u4e2d\u4e3a 70%) \u5e94\u8be5\u88ab\u4ee3\u7406\u5230\u4e0e\u5176\u6765\u6e90\u76f8\u540c\u7684 AZ \u4e2d\u7684\u76ee\u7684\u5730\u3002</p> <pre><code>apiVersion: networking.istio.io/v1beta1\nkind:  DestinationRule\nmetadata:\n  name: express-test-dr\nspec:\n  host: express-test.default.svc.cluster.local\n  trafficPolicy:\n    loadBalancer:                        \n      localityLbSetting:\n        distribute:\n        - from: eu-west-1/eu-west-1a/    \n          to:\n            \"eu-west-1/eu-west-1a/*\": 70 \n            \"eu-west-1/eu-west-1b/*\": 20\n            \"eu-west-1/eu-west-1c/*\": 10\n        - from: eu-west-1/eu-west-1b/*    \n          to:\n            \"eu-west-1/eu-west-1a/*\": 20 \n            \"eu-west-1/eu-west-1b/*\": 70\n            \"eu-west-1/eu-west-1c/*\": 10\n        - from: eu-west-1/eu-west-1c/*    \n          to:\n            \"eu-west-1/eu-west-1a/*\": 20 \n            \"eu-west-1/eu-west-1b/*\": 10\n            \"eu-west-1/eu-west-1c/*\": 70**\n    connectionPool:\n      http:\n        http2MaxRequests: 10\n        maxRequestsPerConnection: 10\n    outlierDetection:\n      consecutiveGatewayErrors: 1\n      interval: 1m\n      baseEjectionTime: 30s\n</code></pre> <p>Note</p> <p>\u53ef\u4ee5\u5206\u914d\u7ed9\u76ee\u7684\u5730\u7684\u6700\u5c0f\u6743\u91cd\u4e3a 1%\u3002\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\u4e3a\u4e86\u5728\u4e3b\u8981\u76ee\u7684\u5730\u7684\u7aef\u70b9\u4e0d\u5065\u5eb7\u6216\u4e0d\u53ef\u7528\u65f6\u4fdd\u6301\u6545\u969c\u8f6c\u79fb\u533a\u57df\u548c\u533a\u57df\u3002</p> <p>\u4e0b\u56fe\u63cf\u7ed8\u4e86\u4e00\u79cd\u60c5\u51b5\uff0c\u5176\u4e2d\u5728 eu-west-1 \u533a\u57df\u6709\u4e00\u4e2a\u9ad8\u53ef\u7528\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5e76\u5e94\u7528\u4e86\u533a\u57df\u52a0\u6743\u5206\u5e03\u3002Destination Rule \u7b56\u7565\u914d\u7f6e\u4e3a\u5c06\u6765\u81ea eu-west-1a \u7684 60% \u6d41\u91cf\u53d1\u9001\u5230\u540c\u4e00 AZ \u4e2d\u7684 Pod\uff0c\u800c\u5c06\u6765\u81ea eu-west-1a \u7684 40% \u6d41\u91cf\u53d1\u9001\u5230 eu-west-1b \u4e2d\u7684 Pod\u3002</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_networking/#_7","title":"\u9650\u5236\u6d41\u91cf\u5728\u53ef\u7528\u533a\u548c\u8282\u70b9\u5185","text":"<p>\u5c06 Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565\u4e0e Istio \u7ed3\u5408\u4f7f\u7528</p> <p>\u4e3a\u4e86\u51cf\u5c11\u4e0e \u5916\u90e8 \u4f20\u5165\u6d41\u91cf\u548c Pod \u4e4b\u95f4 \u5185\u90e8 \u6d41\u91cf\u76f8\u5173\u7684\u7f51\u7edc\u6210\u672c\uff0c\u60a8\u53ef\u4ee5\u5c06 Istio \u7684 Destination Rules \u4e0e Kubernetes Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565 \u7ed3\u5408\u4f7f\u7528\u3002\u5c06 Istio \u76ee\u6807\u89c4\u5219\u4e0e\u670d\u52a1\u5185\u90e8\u6d41\u91cf\u7b56\u7565\u76f8\u7ed3\u5408\u7684\u65b9\u5f0f\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u53d6\u51b3\u4e8e\u4ee5\u4e0b\u4e09\u4e2a\u56e0\u7d20\uff1a</p> <ul> <li>\u5fae\u670d\u52a1\u7684\u89d2\u8272</li> <li>\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u7f51\u7edc\u6d41\u91cf\u6a21\u5f0f</li> <li>\u5fae\u670d\u52a1\u5e94\u8be5\u5982\u4f55\u90e8\u7f72\u5728 Kubernetes \u96c6\u7fa4\u62d3\u6251\u4e2d</li> </ul> <p>\u4e0b\u56fe\u663e\u793a\u4e86\u5728\u5d4c\u5957\u8bf7\u6c42\u7684\u60c5\u51b5\u4e0b\u7f51\u7edc\u6d41\u91cf\u7684\u6d41\u5411\uff0c\u4ee5\u53ca\u4e0a\u8ff0\u7b56\u7565\u5982\u4f55\u63a7\u5236\u6d41\u91cf\u3002</p> <p></p> <ol> <li>\u6700\u7ec8\u7528\u6237\u5411 APP A \u53d1\u51fa\u8bf7\u6c42\uff0c\u540e\u8005\u53c8\u5411 APP C \u53d1\u51fa\u5d4c\u5957\u8bf7\u6c42\u3002\u6b64\u8bf7\u6c42\u9996\u5148\u53d1\u9001\u5230\u9ad8\u53ef\u7528\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u8be5\u8d1f\u8f7d\u5747\u8861\u5668\u5728 AZ 1 \u548c AZ 2 \u4e2d\u90fd\u6709\u5b9e\u4f8b\u3002</li> <li>\u5916\u90e8\u4f20\u5165\u8bf7\u6c42\u968f\u540e\u7531 Istio Virtual Service \u8def\u7531\u5230\u6b63\u786e\u7684\u76ee\u7684\u5730\u3002</li> <li>\u8bf7\u6c42\u8def\u7531\u540e\uff0cIstio Destination Rule \u6839\u636e\u6d41\u91cf\u6765\u6e90 (AZ 1 \u6216 AZ 2) \u63a7\u5236\u6d41\u91cf\u6d41\u5411\u5404\u4e2a AZ \u7684\u6bd4\u4f8b\u3002</li> <li>\u6d41\u91cf\u7136\u540e\u8fdb\u5165 APP A \u7684 Service\uff0c\u5e76\u88ab\u4ee3\u7406\u5230\u76f8\u5e94\u7684 Pod \u7aef\u70b9\u3002\u5982\u56fe\u6240\u793a\uff0c80% \u7684\u4f20\u5165\u6d41\u91cf\u88ab\u53d1\u9001\u5230 AZ 1 \u4e2d\u7684 Pod \u7aef\u70b9\uff0c20% \u7684\u4f20\u5165\u6d41\u91cf\u88ab\u53d1\u9001\u5230 AZ 2\u3002</li> <li>APP A \u968f\u540e\u5411 APP C \u53d1\u51fa\u5185\u90e8\u8bf7\u6c42\u3002APP C \u7684 Service \u542f\u7528\u4e86\u5185\u90e8\u6d41\u91cf\u7b56\u7565 (<code>internalTrafficPolicy``: Local</code>)\u3002</li> <li>\u4ece APP A (\u5728 NODE 1 \u4e0a) \u5230 APP C \u7684\u5185\u90e8\u8bf7\u6c42\u6210\u529f\uff0c\u56e0\u4e3a\u6709\u53ef\u7528\u7684 APP C \u8282\u70b9\u672c\u5730\u7aef\u70b9\u3002</li> <li>\u4ece APP A (\u5728 NODE 3 \u4e0a) \u5230 APP C \u7684\u5185\u90e8\u8bf7\u6c42\u5931\u8d25\uff0c\u56e0\u4e3a\u6ca1\u6709\u53ef\u7528\u7684 APP C \u8282\u70b9\u672c\u5730\u7aef\u70b9\u3002\u5982\u56fe\u6240\u793a\uff0cAPP C \u5728 NODE 3 \u4e0a\u6ca1\u6709\u526f\u672c\u3002****</li> </ol> <p>\u4e0b\u9762\u7684\u5c4f\u5e55\u622a\u56fe\u6765\u81ea\u4e8e\u6b64\u65b9\u6cd5\u7684\u5b9e\u65f6\u793a\u4f8b\u3002\u7b2c\u4e00\u7ec4\u5c4f\u5e55\u622a\u56fe\u6f14\u793a\u4e86\u5bf9 <code>graphql</code> \u7684\u6210\u529f\u5916\u90e8\u8bf7\u6c42\u4ee5\u53ca\u4ece <code>graphql</code> \u5230\u4f4d\u4e8e\u8282\u70b9 <code>ip-10-0-0-151.af-south-1.compute.internal</code> \u4e0a\u7684\u5171\u5b58 <code>orders</code> \u526f\u672c\u7684\u6210\u529f\u5d4c\u5957\u8bf7\u6c42\u3002</p> <p> </p> <p>\u4f7f\u7528 Istio\uff0c\u60a8\u53ef\u4ee5\u9a8c\u8bc1\u548c\u5bfc\u51fa\u4ee3\u7406\u6240\u77e5\u7684\u4efb\u4f55 upstream clusters \u548c\u7aef\u70b9\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u63d0\u4f9b\u7f51\u7edc\u6d41\u91cf\u7684\u56fe\u666f\u4ee5\u53ca\u5de5\u4f5c\u8d1f\u8f7d\u670d\u52a1\u4e4b\u95f4\u7684\u5206\u5e03\u4efd\u989d\u3002\u7ee7\u7eed\u4f7f\u7528\u76f8\u540c\u7684\u793a\u4f8b\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6 <code>graphql</code> \u4ee3\u7406\u6240\u77e5\u7684 <code>orders</code> \u7aef\u70b9\uff1a</p> <pre><code>kubectl exec -it deploy/graphql -n ecommerce -c istio-proxy -- curl localhost:15000/clusters | grep orders \n</code></pre> <pre><code>...\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_error::0**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_success::119**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_timeout::0**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**rq_total::119**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**health_flags::healthy**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**region::af-south-1**\norders-service.ecommerce.svc.cluster.local::10.0.1.33:3003::**zone::af-south-1b**\n...\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c<code>graphql</code> \u4ee3\u7406\u53ea\u77e5\u9053\u4e0e\u5b83\u5171\u4eab\u8282\u70b9\u7684 <code>orders</code> \u526f\u672c\u7684\u7aef\u70b9\u3002\u5982\u679c\u60a8\u4ece orders Service \u4e2d\u5220\u9664 <code>internalTrafficPolicy: Local</code> \u8bbe\u7f6e\uff0c\u5e76\u91cd\u65b0\u8fd0\u884c\u7c7b\u4f3c\u4e0a\u9762\u7684\u547d\u4ee4\uff0c\u90a3\u4e48\u7ed3\u679c\u5c06\u8fd4\u56de\u5206\u5e03\u5728\u4e0d\u540c\u8282\u70b9\u4e0a\u7684\u6240\u6709\u526f\u672c\u7684\u7aef\u70b9\u3002\u6b64\u5916\uff0c\u901a\u8fc7\u68c0\u67e5\u5404\u4e2a\u7aef\u70b9\u7684 <code>rq_total</code>,\u60a8\u4f1a\u6ce8\u610f\u5230\u7f51\u7edc\u5206\u5e03\u7684\u76f8\u5bf9\u5747\u5300\u3002\u56e0\u6b64\uff0c\u5982\u679c\u7aef\u70b9\u4e0e\u8fd0\u884c\u5728\u4e0d\u540c AZ \u4e2d\u7684\u4e0a\u6e38\u670d\u52a1\u76f8\u5173\u8054\uff0c\u90a3\u4e48\u8fd9\u79cd\u8de8\u533a\u57df\u7684\u7f51\u7edc\u5206\u5e03\u5c06\u5bfc\u81f4\u66f4\u9ad8\u7684\u6210\u672c\u3002</p> <p>\u5982\u524d\u9762\u4e00\u8282\u6240\u8ff0\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 pod \u4eb2\u548c\u6027\u6765\u5171\u5b58\u9891\u7e41\u901a\u4fe1\u7684 Pod\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: graphql\n  namespace: ecommerce\n  labels:\n    app.kubernetes.io/version: \"0.1.6\"\n    ...\n    spec:\n      serviceAccountName: graphql-service-account\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n          - labelSelector:\n              matchExpressions:\n              - key: app\n                operator: In\n                values:\n                - orders\n            topologyKey: \"kubernetes.io/hostname\"\n</code></pre> <p>\u5f53 <code>graphql</code> \u548c <code>orders</code> \u526f\u672c\u4e0d\u5728\u540c\u4e00\u8282\u70b9 (<code>ip-10-0-0-151.af-south-1.compute.internal</code>) \u4e0a\u65f6\uff0c\u7b2c\u4e00\u4e2a\u5bf9 <code>graphql</code> \u7684\u8bf7\u6c42\u6210\u529f\uff0c\u5982 Postman \u5c4f\u5e55\u622a\u56fe\u4e2d\u7684 <code>200 \u54cd\u5e94\u4ee3\u7801</code> \u6240\u793a\uff0c\u800c\u7b2c\u4e8c\u4e2a\u4ece <code>graphql</code> \u5230 <code>orders</code> \u7684\u5d4c\u5957\u8bf7\u6c42\u5931\u8d25\uff0c\u54cd\u5e94\u4ee3\u7801\u4e3a <code>503</code>\u3002</p> <p> </p>"},{"location":"zh/cost_optimization/cost_opt_networking/#_8","title":"\u5176\u4ed6\u8d44\u6e90","text":"<ul> <li>\u4f7f\u7528 Istio \u89e3\u51b3 EKS \u4e0a\u7684\u5ef6\u8fdf\u548c\u6570\u636e\u4f20\u8f93\u6210\u672c\u95ee\u9898</li> <li>\u63a2\u7d22\u62d3\u6251\u611f\u77e5\u63d0\u793a\u5bf9 Amazon Elastic Kubernetes Service \u4e2d\u7f51\u7edc\u6d41\u91cf\u7684\u5f71\u54cd</li> <li>\u4e86\u89e3\u60a8\u7684 Amazon EKS \u8de8 AZ Pod \u5230 Pod \u7f51\u7edc\u5b57\u8282</li> <li>\u4f7f\u7528 Istio \u4f18\u5316 AZ \u6d41\u91cf</li> <li>\u4f7f\u7528\u62d3\u6251\u611f\u77e5\u8def\u7531\u4f18\u5316 AZ \u6d41\u91cf</li> <li>\u4f7f\u7528 Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565\u4f18\u5316 Kubernetes \u6210\u672c\u548c\u6027\u80fd</li> <li>\u4f7f\u7528 Istio \u548c Service \u5185\u90e8\u6d41\u91cf\u7b56\u7565\u4f18\u5316 Kubernetes \u6210\u672c\u548c\u6027\u80fd</li> <li>\u5e38\u89c1\u67b6\u6784\u7684\u6570\u636e\u4f20\u8f93\u6210\u672c\u6982\u8ff0 </li> <li>\u4e86\u89e3 AWS \u5bb9\u5668\u670d\u52a1\u7684\u6570\u636e\u4f20\u8f93\u6210\u672c</li> </ul>"},{"location":"zh/cost_optimization/cost_opt_observability/","title":"\u6210\u672c\u4f18\u5316 - \u53ef\u89c2\u6d4b\u6027","text":""},{"location":"zh/cost_optimization/cost_opt_observability/#_1","title":"\u7b80\u4ecb","text":"<p>\u53ef\u89c2\u6d4b\u6027\u5de5\u5177\u53ef\u5e2e\u52a9\u60a8\u9ad8\u6548\u5730\u68c0\u6d4b\u3001\u4fee\u590d\u548c\u8c03\u67e5\u5de5\u4f5c\u8d1f\u8f7d\u3002\u968f\u7740\u60a8\u5bf9 EKS \u7684\u4f7f\u7528\u589e\u52a0\uff0c\u9065\u6d4b\u6570\u636e\u7684\u6210\u672c\u81ea\u7136\u4e5f\u4f1a\u589e\u52a0\u3002\u6709\u65f6\uff0c\u5728\u6ee1\u8db3\u8fd0\u8425\u9700\u6c42\u3001\u8861\u91cf\u5bf9\u4e1a\u52a1\u91cd\u8981\u7684\u6307\u6807\u5e76\u63a7\u5236\u53ef\u89c2\u6d4b\u6027\u6210\u672c\u4e4b\u95f4\uff0c\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u6311\u6218\u3002\u672c\u6307\u5357\u91cd\u70b9\u4ecb\u7ecd\u4e86\u53ef\u89c2\u6d4b\u6027\u4e09\u5927\u652f\u67f1\uff1a\u65e5\u5fd7\u3001\u6307\u6807\u548c\u8ddf\u8e2a\u7684\u6210\u672c\u4f18\u5316\u7b56\u7565\u3002\u8fd9\u4e9b\u6700\u4f73\u5b9e\u8df5\u4e2d\u7684\u6bcf\u4e00\u4e2a\u90fd\u53ef\u4ee5\u72ec\u7acb\u5e94\u7528\uff0c\u4ee5\u9002\u5e94\u60a8\u7ec4\u7ec7\u7684\u4f18\u5316\u76ee\u6807\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_2","title":"\u65e5\u5fd7\u8bb0\u5f55","text":"<p>\u65e5\u5fd7\u5728\u76d1\u63a7\u548c\u6392\u67e5\u96c6\u7fa4\u4e2d\u5e94\u7528\u7a0b\u5e8f\u7684\u95ee\u9898\u65f6\u8d77\u7740\u81f3\u5173\u91cd\u8981\u7684\u4f5c\u7528\u3002\u6709\u51e0\u79cd\u7b56\u7565\u53ef\u4ee5\u7528\u6765\u4f18\u5316\u65e5\u5fd7\u6210\u672c\u3002\u4e0b\u9762\u5217\u51fa\u7684\u6700\u4f73\u5b9e\u8df5\u7b56\u7565\u5305\u62ec\u68c0\u67e5\u60a8\u7684\u65e5\u5fd7\u4fdd\u7559\u7b56\u7565\uff0c\u4ee5\u5b9e\u73b0\u5bf9\u65e5\u5fd7\u6570\u636e\u4fdd\u7559\u65f6\u95f4\u7684\u7cbe\u7ec6\u63a7\u5236;\u6839\u636e\u91cd\u8981\u6027\u5c06\u65e5\u5fd7\u6570\u636e\u53d1\u9001\u5230\u4e0d\u540c\u7684\u5b58\u50a8\u9009\u9879;\u4ee5\u53ca\u5229\u7528\u65e5\u5fd7\u8fc7\u6ee4\u6765\u7f29\u5c0f\u5b58\u50a8\u7684\u65e5\u5fd7\u6d88\u606f\u7c7b\u578b\u3002\u9ad8\u6548\u7ba1\u7406\u65e5\u5fd7\u9065\u6d4b\u53ef\u4ee5\u4e3a\u60a8\u7684\u73af\u5883\u8282\u7701\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#eks","title":"EKS \u63a7\u5236\u5e73\u9762","text":""},{"location":"zh/cost_optimization/cost_opt_observability/#_3","title":"\u4f18\u5316\u60a8\u7684\u63a7\u5236\u5e73\u9762\u65e5\u5fd7","text":"<p>Kubernetes \u63a7\u5236\u5e73\u9762\u662f\u4e00\u7ec4\u7ec4\u4ef6,\u7528\u4e8e\u7ba1\u7406\u96c6\u7fa4\uff0c\u8fd9\u4e9b\u7ec4\u4ef6\u4f1a\u5c06\u4e0d\u540c\u7c7b\u578b\u7684\u4fe1\u606f\u4f5c\u4e3a\u65e5\u5fd7\u6d41\u53d1\u9001\u5230 Amazon CloudWatch \u4e2d\u7684\u4e00\u4e2a\u65e5\u5fd7\u7ec4\u3002\u867d\u7136\u542f\u7528\u6240\u6709\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u7c7b\u578b\u90fd\u6709\u597d\u5904\uff0c\u4f46\u60a8\u5e94\u8be5\u4e86\u89e3\u6bcf\u79cd\u65e5\u5fd7\u4e2d\u7684\u4fe1\u606f\u4ee5\u53ca\u5b58\u50a8\u6240\u6709\u65e5\u5fd7\u9065\u6d4b\u6570\u636e\u7684\u76f8\u5173\u6210\u672c\u3002\u60a8\u9700\u8981\u4e3a\u4ece\u96c6\u7fa4\u53d1\u9001\u5230 Amazon CloudWatch Logs \u7684\u65e5\u5fd7\u652f\u4ed8\u6807\u51c6\u7684 CloudWatch Logs \u6570\u636e\u5f15\u5165\u548c\u5b58\u50a8\u6210\u672c\u3002\u5728\u542f\u7528\u5b83\u4eec\u4e4b\u524d\uff0c\u8bf7\u8bc4\u4f30\u6bcf\u4e2a\u65e5\u5fd7\u6d41\u662f\u5426\u5fc5\u9700\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u975e\u751f\u4ea7\u96c6\u7fa4\u4e2d\uff0c\u53ea\u6709\u5728\u5206\u6790\u65f6\u624d\u9009\u62e9\u6027\u542f\u7528\u7279\u5b9a\u65e5\u5fd7\u7c7b\u578b\uff0c\u5982 API \u670d\u52a1\u5668\u65e5\u5fd7\uff0c\u4e4b\u540e\u518d\u5c06\u5176\u505c\u7528\u3002\u4f46\u5bf9\u4e8e\u751f\u4ea7\u96c6\u7fa4\uff0c\u60a8\u53ef\u80fd\u65e0\u6cd5\u91cd\u73b0\u4e8b\u4ef6\uff0c\u89e3\u51b3\u95ee\u9898\u9700\u8981\u66f4\u591a\u65e5\u5fd7\u4fe1\u606f\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u542f\u7528\u6240\u6709\u65e5\u5fd7\u7c7b\u578b\u3002\u8fdb\u4e00\u6b65\u7684\u63a7\u5236\u5e73\u9762\u6210\u672c\u4f18\u5316\u5b9e\u65bd\u7ec6\u8282\u5728\u8fd9\u7bc7\u535a\u5ba2\u6587\u7ae0\u4e2d\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#s3","title":"\u5c06\u65e5\u5fd7\u6d41\u5f0f\u4f20\u8f93\u5230 S3","text":"<p>\u53e6\u4e00\u79cd\u6210\u672c\u4f18\u5316\u6700\u4f73\u5b9e\u8df5\u662f\u901a\u8fc7 CloudWatch Logs \u8ba2\u9605\u5c06\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u6d41\u5f0f\u4f20\u8f93\u5230 S3\u3002\u5229\u7528 CloudWatch Logs \u8ba2\u9605\u5141\u8bb8\u60a8\u9009\u62e9\u6027\u5730\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 S3\uff0c\u4e0e\u65e0\u9650\u671f\u4fdd\u7559\u65e5\u5fd7\u5728 CloudWatch \u4e2d\u76f8\u6bd4\uff0c\u8fd9\u63d0\u4f9b\u4e86\u66f4\u52a0\u7ecf\u6d4e\u9ad8\u6548\u7684\u957f\u671f\u5b58\u50a8\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u751f\u4ea7\u96c6\u7fa4\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5173\u952e\u65e5\u5fd7\u7ec4\uff0c\u5e76\u5229\u7528\u8ba2\u9605\u5728 15 \u5929\u540e\u5c06\u8fd9\u4e9b\u65e5\u5fd7\u6d41\u5f0f\u4f20\u8f93\u5230 S3\u3002\u8fd9\u5c06\u786e\u4fdd\u60a8\u53ef\u4ee5\u5feb\u901f\u8bbf\u95ee\u65e5\u5fd7\u8fdb\u884c\u5206\u6790\uff0c\u540c\u65f6\u901a\u8fc7\u5c06\u65e5\u5fd7\u79fb\u52a8\u5230\u66f4\u52a0\u7ecf\u6d4e\u9ad8\u6548\u7684\u5b58\u50a8\u6765\u8282\u7701\u6210\u672c\u3002</p> <p>Attention</p> <p>\u622a\u81f3 2023 \u5e74 9 \u6708 5 \u65e5\uff0cEKS \u65e5\u5fd7\u5728 Amazon CloudWatch Logs \u4e2d\u88ab\u5f52\u7c7b\u4e3a Vended Logs\u3002Vended Logs \u662f AWS \u670d\u52a1\u4ee3\u8868\u5ba2\u6237\u672c\u5730\u53d1\u5e03\u7684\u7279\u5b9a AWS \u670d\u52a1\u65e5\u5fd7\uff0c\u53ef\u4eab\u53d7\u6279\u91cf\u6298\u6263\u5b9a\u4ef7\u3002\u8bf7\u8bbf\u95ee Amazon CloudWatch \u5b9a\u4ef7\u9875\u9762\u4e86\u89e3\u6709\u5173 Vended Logs \u5b9a\u4ef7\u7684\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#eks_1","title":"EKS \u6570\u636e\u5e73\u9762","text":""},{"location":"zh/cost_optimization/cost_opt_observability/#_4","title":"\u65e5\u5fd7\u4fdd\u7559","text":"<p>Amazon CloudWatch \u7684\u9ed8\u8ba4\u4fdd\u7559\u7b56\u7565\u662f\u6c38\u4e0d\u8fc7\u671f\uff0c\u6c38\u4e45\u4fdd\u7559\u65e5\u5fd7\uff0c\u5e76\u6839\u636e\u60a8\u7684 AWS \u533a\u57df\u6536\u53d6\u76f8\u5e94\u7684\u5b58\u50a8\u6210\u672c\u3002\u4e3a\u4e86\u51cf\u5c11\u5b58\u50a8\u6210\u672c\uff0c\u60a8\u53ef\u4ee5\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u8981\u6c42\u4e3a\u6bcf\u4e2a\u65e5\u5fd7\u7ec4\u81ea\u5b9a\u4e49\u4fdd\u7559\u7b56\u7565\u3002</p> <p>\u5728\u5f00\u53d1\u73af\u5883\u4e2d\uff0c\u53ef\u80fd\u4e0d\u9700\u8981\u957f\u671f\u4fdd\u7559\u3002\u4f46\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u60a8\u53ef\u4ee5\u8bbe\u7f6e\u66f4\u957f\u7684\u4fdd\u7559\u7b56\u7565\uff0c\u4ee5\u6ee1\u8db3\u6545\u969c\u6392\u67e5\u3001\u5408\u89c4\u6027\u548c\u5bb9\u91cf\u89c4\u5212\u8981\u6c42\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728\u8282\u65e5\u9ad8\u5cf0\u5b63\u8fd0\u884c\u7535\u5b50\u5546\u52a1\u5e94\u7528\u7a0b\u5e8f\uff0c\u7cfb\u7edf\u627f\u53d7\u66f4\u91cd\u7684\u8d1f\u8f7d\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\u5e76\u4e0d\u662f\u7acb\u5373\u53ef\u89c1\u7684\uff0c\u60a8\u5c06\u9700\u8981\u8bbe\u7f6e\u66f4\u957f\u7684\u65e5\u5fd7\u4fdd\u7559\u671f\uff0c\u4ee5\u4fbf\u8fdb\u884c\u8be6\u7ec6\u7684\u6545\u969c\u6392\u67e5\u548c\u4e8b\u540e\u5206\u6790\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728 AWS CloudWatch \u63a7\u5236\u53f0\u6216 AWS API \u4e2d\u914d\u7f6e\u4fdd\u7559\u671f,\u6301\u7eed\u65f6\u95f4\u4ece 1 \u5929\u5230 10 \u5e74\u4e0d\u7b49\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u6bcf\u4e2a\u65e5\u5fd7\u7ec4\u3002\u62e5\u6709\u7075\u6d3b\u7684\u4fdd\u7559\u671f\u53ef\u4ee5\u8282\u7701\u65e5\u5fd7\u5b58\u50a8\u6210\u672c\uff0c\u540c\u65f6\u4fdd\u7559\u5173\u952e\u65e5\u5fd7\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_5","title":"\u65e5\u5fd7\u5b58\u50a8\u9009\u9879","text":"<p>\u5b58\u50a8\u662f\u53ef\u89c2\u6d4b\u6027\u6210\u672c\u7684\u4e3b\u8981\u9a71\u52a8\u56e0\u7d20\uff0c\u56e0\u6b64\u4f18\u5316\u65e5\u5fd7\u5b58\u50a8\u7b56\u7565\u81f3\u5173\u91cd\u8981\u3002\u60a8\u7684\u7b56\u7565\u5e94\u4e0e\u5de5\u4f5c\u8d1f\u8f7d\u8981\u6c42\u4fdd\u6301\u4e00\u81f4\uff0c\u540c\u65f6\u4fdd\u6301\u6027\u80fd\u548c\u53ef\u6269\u5c55\u6027\u3002\u51cf\u5c11\u5b58\u50a8\u65e5\u5fd7\u6210\u672c\u7684\u4e00\u79cd\u7b56\u7565\u662f\u5229\u7528 AWS S3 \u5b58\u50a8\u6876\u53ca\u5176\u4e0d\u540c\u7684\u5b58\u50a8\u5c42\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#s3_1","title":"\u76f4\u63a5\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 S3","text":"<p>\u8003\u8651\u5c06\u4e0d\u592a\u91cd\u8981\u7684\u65e5\u5fd7(\u5982\u5f00\u53d1\u73af\u5883\u65e5\u5fd7)\u76f4\u63a5\u8f6c\u53d1\u5230 S3\uff0c\u800c\u4e0d\u662f Cloudwatch\u3002\u8fd9\u53ef\u4ee5\u7acb\u5373\u5f71\u54cd\u65e5\u5fd7\u5b58\u50a8\u6210\u672c\u3002\u4e00\u79cd\u9009\u62e9\u662f\u4f7f\u7528 Fluentbit \u76f4\u63a5\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 S3\u3002\u60a8\u53ef\u4ee5\u5728 <code>[OUTPUT]</code> \u90e8\u5206\u4e2d\u5b9a\u4e49\u8fd9\u4e00\u70b9\uff0c\u8be5\u90e8\u5206\u662f FluentBit \u4f20\u8f93\u5bb9\u5668\u65e5\u5fd7\u4ee5\u8fdb\u884c\u4fdd\u7559\u7684\u76ee\u6807\u4f4d\u7f6e\u3002\u8bf7\u5728\u6b64\u5904\u67e5\u770b\u5176\u4ed6\u914d\u7f6e\u53c2\u6570\u3002</p> <pre><code>[OUTPUT]\n        Name eks_to_s3\n        Match application.* \n        bucket $S3_BUCKET name\n        region us-east-2\n        store_dir /var/log/fluentbit\n        total_file_size 30M\n        upload_timeout 3m\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_observability/#cloudwatch","title":"\u4ec5\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 CloudWatch \u4ee5\u8fdb\u884c\u77ed\u671f\u5206\u6790","text":"<p>\u5bf9\u4e8e\u66f4\u5173\u952e\u7684\u65e5\u5fd7\uff0c\u5982\u751f\u4ea7\u73af\u5883\u65e5\u5fd7(\u60a8\u53ef\u80fd\u9700\u8981\u7acb\u5373\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u6790)\uff0c\u8bf7\u8003\u8651\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 CloudWatch\u3002\u60a8\u53ef\u4ee5\u5728 <code>[OUTPUT]</code> \u90e8\u5206\u4e2d\u5b9a\u4e49\u8fd9\u4e00\u70b9\uff0c\u8be5\u90e8\u5206\u662f FluentBit \u4f20\u8f93\u5bb9\u5668\u65e5\u5fd7\u4ee5\u8fdb\u884c\u4fdd\u7559\u7684\u76ee\u6807\u4f4d\u7f6e\u3002\u8bf7\u5728\u6b64\u5904\u67e5\u770b\u5176\u4ed6\u914d\u7f6e\u53c2\u6570\u3002</p> <pre><code>[OUTPUT]\n        Name eks_to_cloudwatch_logs\n        Match application.*\n        region us-east-2\n        log_group_name fluent-bit-cloudwatch\n        log_stream_prefix from-fluent-bit-\n        auto_create_group On\n</code></pre> <p>\u4f46\u662f\uff0c\u8fd9\u4e0d\u4f1a\u7acb\u5373\u4ea7\u751f\u6210\u672c\u8282\u7701\u6548\u679c\u3002\u4e3a\u4e86\u8fdb\u4e00\u6b65\u8282\u7701\uff0c\u60a8\u5fc5\u987b\u5c06\u8fd9\u4e9b\u65e5\u5fd7\u5bfc\u51fa\u5230 Amazon S3\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#cloudwatch-amazon-s3","title":"\u4ece CloudWatch \u5bfc\u51fa\u5230 Amazon S3","text":"<p>\u4e3a\u4e86\u957f\u671f\u5b58\u50a8 Amazon CloudWatch \u65e5\u5fd7\uff0c\u6211\u4eec\u5efa\u8bae\u5c06\u60a8\u7684 Amazon EKS CloudWatch \u65e5\u5fd7\u5bfc\u51fa\u5230 Amazon Simple Storage Service (Amazon S3)\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u63a7\u5236\u53f0\u6216 API \u4e2d\u521b\u5efa\u5bfc\u51fa\u4efb\u52a1\uff0c\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 Amazon S3 \u5b58\u50a8\u6876\u3002\u5b8c\u6210\u540e\uff0cAmazon S3 \u63d0\u4f9b\u4e86\u8bb8\u591a\u8fdb\u4e00\u6b65\u964d\u4f4e\u6210\u672c\u7684\u9009\u9879\u3002\u60a8\u53ef\u4ee5\u5b9a\u4e49\u81ea\u5df1\u7684 Amazon S3 \u751f\u547d\u5468\u671f\u89c4\u5219,\u5c06\u65e5\u5fd7\u79fb\u52a8\u5230\u7b26\u5408\u60a8\u9700\u6c42\u7684\u5b58\u50a8\u7c7b\uff0c\u6216\u8005\u5229\u7528 Amazon S3 \u667a\u80fd\u5206\u5c42\u5b58\u50a8\u5b58\u50a8\u7c7b\uff0c\u8ba9 AWS \u6839\u636e\u60a8\u7684\u4f7f\u7528\u6a21\u5f0f\u81ea\u52a8\u5c06\u6570\u636e\u79fb\u52a8\u5230\u957f\u671f\u5b58\u50a8\u3002\u8bf7\u53c2\u9605\u6b64\u535a\u5ba2\u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u60a8\u7684\u751f\u4ea7\u73af\u5883\u65e5\u5fd7\uff0c\u5982\u679c\u5728 CloudWatch \u4e2d\u4fdd\u7559\u8d85\u8fc7 30 \u5929\uff0c\u5219\u5bfc\u51fa\u5230 Amazon S3 \u5b58\u50a8\u6876\u3002\u5982\u679c\u60a8\u9700\u8981\u5728\u4ee5\u540e\u53c2\u8003\u65e5\u5fd7\uff0c\u53ef\u4ee5\u4f7f\u7528 Amazon Athena \u67e5\u8be2 Amazon S3 \u5b58\u50a8\u6876\u4e2d\u7684\u6570\u636e\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_6","title":"\u51cf\u5c11\u65e5\u5fd7\u7ea7\u522b","text":"<p>\u5bf9\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5b9e\u8df5\u9009\u62e9\u6027\u65e5\u5fd7\u8bb0\u5f55\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u548c\u8282\u70b9\u90fd\u4f1a\u8f93\u51fa\u65e5\u5fd7\u3002\u5bf9\u4e8e\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\uff0c\u8bf7\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u548c\u73af\u5883\u7684\u91cd\u8981\u6027\u8c03\u6574\u65e5\u5fd7\u7ea7\u522b\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u7684 java \u5e94\u7528\u7a0b\u5e8f\u6b63\u5728\u8f93\u51fa <code>INFO</code> \u7ea7\u522b\u7684\u65e5\u5fd7\uff0c\u8fd9\u662f\u5178\u578b\u7684\u9ed8\u8ba4\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\uff0c\u6839\u636e\u4ee3\u7801\u7684\u4e0d\u540c\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u5927\u91cf\u65e5\u5fd7\u6570\u636e\u3002</p> <pre><code>import org.apache.log4j.*;\n\npublic class LogClass {\n   private static org.apache.log4j.Logger log = Logger.getLogger(LogClass.class);\n\n   public static void main(String[] args) {\n      log.setLevel(Level.INFO);\n\n      log.debug(\"This is a DEBUG message, check this out!\");\n      log.info(\"This is an INFO message, nothing to see here!\");\n      log.warn(\"This is a WARN message, investigate this!\");\n      log.error(\"This is an ERROR message, check this out!\");\n      log.fatal(\"This is a FATAL message, investigate this!\");\n   }\n}\n</code></pre> <p>\u5728\u5f00\u53d1\u73af\u5883\u4e2d\uff0c\u5c06\u60a8\u7684\u65e5\u5fd7\u7ea7\u522b\u66f4\u6539\u4e3a <code>DEBUG</code>,\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u60a8\u8c03\u8bd5\u95ee\u9898\u6216\u5728\u95ee\u9898\u8fdb\u5165\u751f\u4ea7\u73af\u5883\u4e4b\u524d\u6355\u83b7\u6f5c\u5728\u95ee\u9898\u3002</p> <pre><code>      log.setLevel(Level.DEBUG);\n</code></pre> <p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u8bf7\u8003\u8651\u5c06\u65e5\u5fd7\u7ea7\u522b\u4fee\u6539\u4e3a <code>ERROR</code> \u6216 <code>FATAL</code>\u3002\u8fd9\u5c06\u4ec5\u5728\u5e94\u7528\u7a0b\u5e8f\u51fa\u73b0\u9519\u8bef\u65f6\u8f93\u51fa\u65e5\u5fd7\uff0c\u4ece\u800c\u51cf\u5c11\u65e5\u5fd7\u8f93\u51fa\uff0c\u5e76\u5e2e\u52a9\u60a8\u5173\u6ce8\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u7684\u91cd\u8981\u6570\u636e\u3002</p> <pre><code>      log.setLevel(Level.ERROR);\n</code></pre> <p>\u60a8\u53ef\u4ee5\u5fae\u8c03\u5404\u79cd Kubernetes \u7ec4\u4ef6\u7684\u65e5\u5fd7\u7ea7\u522b\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528 Bottlerocket \u4f5c\u4e3a EKS \u8282\u70b9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6709\u4e00\u4e9b\u914d\u7f6e\u8bbe\u7f6e\u53ef\u4ee5\u8ba9\u60a8\u8c03\u6574 kubelet \u8fdb\u7a0b\u7684\u65e5\u5fd7\u7ea7\u522b\u3002\u4e0b\u9762\u662f\u6b64\u914d\u7f6e\u8bbe\u7f6e\u7684\u4e00\u4e2a\u7247\u6bb5\u3002\u6ce8\u610f\u9ed8\u8ba4\u7684\u65e5\u5fd7\u7ea7\u522b\u4e3a 2,\u5b83\u8c03\u6574\u4e86 <code>kubelet</code> \u8fdb\u7a0b\u7684\u65e5\u5fd7\u8bb0\u5f55\u8be6\u7ec6\u7a0b\u5ea6\u3002</p> <pre><code>[settings.kubernetes]\nlog-level = \"2\"\nimage-gc-high-threshold-percent = \"85\"\nimage-gc-low-threshold-percent = \"80\"\n</code></pre> <p>\u5bf9\u4e8e\u5f00\u53d1\u73af\u5883\uff0c\u60a8\u53ef\u4ee5\u5c06\u65e5\u5fd7\u7ea7\u522b\u8bbe\u7f6e\u4e3a\u5927\u4e8e 2 \u7684\u503c\uff0c\u4ee5\u67e5\u770b\u66f4\u591a\u4e8b\u4ef6\uff0c\u8fd9\u6709\u52a9\u4e8e\u8c03\u8bd5\u3002\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u60a8\u53ef\u4ee5\u5c06\u7ea7\u522b\u8bbe\u7f6e\u4e3a 0,\u4ee5\u4ec5\u67e5\u770b\u5173\u952e\u4e8b\u4ef6\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_7","title":"\u5229\u7528\u8fc7\u6ee4\u5668","text":"<p>\u5f53\u4f7f\u7528\u9ed8\u8ba4\u7684 EKS Fluentbit \u914d\u7f6e\u5c06\u5bb9\u5668\u65e5\u5fd7\u53d1\u9001\u5230 Cloudwatch \u65f6\uff0cFluentBit \u4f1a\u6355\u83b7\u5e76\u5c06 \u6240\u6709 \u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u65e5\u5fd7(\u9644\u52a0\u4e86 Kubernetes \u5143\u6570\u636e)\u53d1\u9001\u5230 Cloudwatch\uff0c\u5982\u4e0b\u9762\u7684 <code>[INPUT]</code> \u914d\u7f6e\u5757\u6240\u793a\u3002</p> <pre><code>    [INPUT]\n        Name                tail\n        Tag                 application.*\n        Exclude_Path        /var/log/containers/cloudwatch-agent*, /var/log/containers/fluent-bit*, /var/log/containers/aws-node*, /var/log/containers/kube-proxy*\n        Path                /var/log/containers/*.log\n        Docker_Mode         On\n        Docker_Mode_Flush   5\n        Docker_Mode_Parser  container_firstline\n        Parser              docker\n        DB                  /var/fluent-bit/state/flb_container.db\n        Mem_Buf_Limit       50MB\n        Skip_Long_Lines     On\n        Refresh_Interval    10\n        Rotate_Wait         30\n        storage.type        filesystem\n        Read_from_Head      ${READ_FROM_HEAD}\n</code></pre> <p>\u4e0a\u9762\u7684 <code>[INPUT]</code> \u90e8\u5206\u6b63\u5728\u5f15\u5165\u6240\u6709\u5bb9\u5668\u65e5\u5fd7\u3002\u8fd9\u53ef\u80fd\u4f1a\u4ea7\u751f\u5927\u91cf\u4e0d\u5fc5\u8981\u7684\u6570\u636e\u3002\u8fc7\u6ee4\u6389\u8fd9\u4e9b\u6570\u636e\u53ef\u4ee5\u51cf\u5c11\u53d1\u9001\u5230 CloudWatch \u7684\u65e5\u5fd7\u6570\u636e\u91cf\uff0c\u4ece\u800c\u964d\u4f4e\u6210\u672c\u3002\u60a8\u53ef\u4ee5\u5728\u8f93\u51fa\u5230 CloudWatch \u4e4b\u524d\u5bf9\u65e5\u5fd7\u5e94\u7528\u8fc7\u6ee4\u5668\u3002Fluentbit \u5728 <code>[FILTER]</code> \u90e8\u5206\u4e2d\u5b9a\u4e49\u8fd9\u4e00\u70b9\u3002\u4f8b\u5982\uff0c\u8fc7\u6ee4\u6389\u9644\u52a0\u5230\u65e5\u5fd7\u4e8b\u4ef6\u7684 Kubernetes \u5143\u6570\u636e\u53ef\u4ee5\u51cf\u5c11\u65e5\u5fd7\u91cf\u3002</p> <pre><code>    [FILTER]\n        Name                nest\n        Match               application.*\n        Operation           lift\n        Nested_under        kubernetes\n        Add_prefix          Kube.\n\n    [FILTER]\n        Name                modify\n        Match               application.*\n        Remove              Kube.&lt;Metadata_1&gt;\n        Remove              Kube.&lt;Metadata_2&gt;\n        Remove              Kube.&lt;Metadata_3&gt;\n\n    [FILTER]\n        Name                nest\n        Match               application.*\n        Operation           nest\n        Wildcard            Kube.*\n        Nested_under        kubernetes\n        Remove_prefix       Kube.\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_observability/#_8","title":"\u6307\u6807","text":"<p>\u6307\u6807\u63d0\u4f9b\u4e86\u6709\u5173\u7cfb\u7edf\u6027\u80fd\u7684\u5b9d\u8d35\u4fe1\u606f\u3002\u901a\u8fc7\u5c06\u6240\u6709\u4e0e\u7cfb\u7edf\u76f8\u5173\u6216\u53ef\u7528\u8d44\u6e90\u6307\u6807\u5408\u5e76\u5230\u4e00\u4e2a\u4e2d\u5fc3\u4f4d\u7f6e\uff0c\u60a8\u5c31\u53ef\u4ee5\u6bd4\u8f83\u548c\u5206\u6790\u6027\u80fd\u6570\u636e\u3002\u8fd9\u79cd\u96c6\u4e2d\u5f0f\u65b9\u6cd5\u4f7f\u60a8\u80fd\u591f\u505a\u51fa\u66f4\u660e\u667a\u7684\u6218\u7565\u51b3\u7b56\uff0c\u4f8b\u5982\u6269\u5927\u6216\u7f29\u5c0f\u8d44\u6e90\u3002\u6b64\u5916\uff0c\u6307\u6807\u5728\u8bc4\u4f30\u8d44\u6e90\u5065\u5eb7\u72b6\u51b5\u65b9\u9762\u4e5f\u8d77\u7740\u81f3\u5173\u91cd\u8981\u7684\u4f5c\u7528\uff0c\u8ba9\u60a8\u53ef\u4ee5\u5728\u5fc5\u8981\u65f6\u91c7\u53d6\u4e3b\u52a8\u63aa\u65bd\u3002\u901a\u5e38\uff0c\u53ef\u89c2\u6d4b\u6027\u6210\u672c\u4f1a\u968f\u7740\u9065\u6d4b\u6570\u636e\u6536\u96c6\u548c\u4fdd\u7559\u800c\u589e\u52a0\u3002\u4ee5\u4e0b\u662f\u60a8\u53ef\u4ee5\u5b9e\u65bd\u7684\u4e00\u4e9b\u7b56\u7565\uff0c\u4ee5\u964d\u4f4e\u6307\u6807\u9065\u6d4b\u7684\u6210\u672c\uff1a\u4ec5\u6536\u96c6\u91cd\u8981\u7684\u6307\u6807\u3001\u51cf\u5c11\u9065\u6d4b\u6570\u636e\u7684\u57fa\u6570(cardinality)\u4ee5\u53ca\u5fae\u8c03\u9065\u6d4b\u6570\u636e\u6536\u96c6\u7684\u7c92\u5ea6\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_9","title":"\u76d1\u63a7\u91cd\u70b9\u5e76\u4ec5\u6536\u96c6\u6240\u9700\u5185\u5bb9","text":"<p>\u964d\u4f4e\u6210\u672c\u7684\u7b2c\u4e00\u4e2a\u7b56\u7565\u662f\u51cf\u5c11\u60a8\u6536\u96c6\u7684\u6307\u6807\u6570\u91cf\uff0c\u4ece\u800c\u964d\u4f4e\u4fdd\u7559\u6210\u672c\u3002</p> <ol> <li>\u9996\u5148\u4ece\u60a8\u548c/\u6216\u60a8\u7684\u5229\u76ca\u76f8\u5173\u8005\u7684\u8981\u6c42\u51fa\u53d1\uff0c\u786e\u5b9a\u6700\u91cd\u8981\u7684\u6307\u6807\u3002\u6bcf\u4e2a\u4eba\u7684\u6210\u529f\u6307\u6807\u90fd\u4e0d\u4e00\u6837!\u4e86\u89e3\u4ec0\u4e48\u662f\"\u826f\u597d\"\u72b6\u6001\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u8861\u91cf\u3002</li> <li>\u8003\u8651\u6df1\u5165\u7814\u7a76\u60a8\u6b63\u5728\u652f\u6301\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5e76\u786e\u5b9a\u5176\u5173\u952e\u6027\u80fd\u6307\u6807 (KPI)\uff0c\u4e5f\u79f0\u4e3a\"\u9ec4\u91d1\u4fe1\u53f7\"\u3002\u8fd9\u4e9b\u5e94\u8be5\u4e0e\u4e1a\u52a1\u548c\u5229\u76ca\u76f8\u5173\u8005\u7684\u8981\u6c42\u4fdd\u6301\u4e00\u81f4\u3002\u4f7f\u7528 Amazon CloudWatch \u548c Metric Math \u8ba1\u7b97 SLI\u3001SLO \u548c SLA \u5bf9\u4e8e\u7ba1\u7406\u670d\u52a1\u53ef\u9760\u6027\u81f3\u5173\u91cd\u8981\u3002\u8bf7\u9075\u5faa\u672c\u6307\u5357\u4e2d\u6982\u8ff0\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u6709\u6548\u76d1\u63a7\u548c\u7ef4\u62a4\u60a8\u7684 EKS \u73af\u5883\u7684\u6027\u80fd\u3002</li> <li>\u7136\u540e\u7ee7\u7eed\u6df1\u5165\u4e0d\u540c\u7684\u57fa\u7840\u8bbe\u65bd\u5c42\uff0c\u5c06 EKS \u96c6\u7fa4\u3001\u8282\u70b9\u548c\u5176\u4ed6\u57fa\u7840\u8bbe\u65bd\u6307\u6807\u4e0e\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d KPI \u76f8\u5173\u8054\u3002\u5c06\u60a8\u7684\u4e1a\u52a1\u6307\u6807\u548c\u8fd0\u8425\u6307\u6807\u5b58\u50a8\u5728\u4e00\u4e2a\u7cfb\u7edf\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5728\u5176\u4e2d\u5c06\u5b83\u4eec\u76f8\u4e92\u5173\u8054\u5e76\u6839\u636e\u89c2\u5bdf\u5230\u7684\u5f71\u54cd\u5f97\u51fa\u7ed3\u8bba\u3002</li> <li>EKS \u516c\u5f00\u4e86\u6765\u81ea\u63a7\u5236\u5e73\u9762\u3001\u96c6\u7fa4 kube-state-metrics\u3001Pod \u548c\u8282\u70b9\u7684\u6307\u6807\u3002\u6240\u6709\u8fd9\u4e9b\u6307\u6807\u7684\u76f8\u5173\u6027\u53d6\u51b3\u4e8e\u60a8\u7684\u9700\u6c42\uff0c\u4f46\u60a8\u53ef\u80fd\u4e0d\u9700\u8981\u8de8\u4e0d\u540c\u5c42\u7684\u6bcf\u4e2a\u6307\u6807\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a EKS \u57fa\u672c\u6307\u6807\u6307\u5357\u4f5c\u4e3a\u76d1\u63a7 EKS \u96c6\u7fa4\u548c\u5de5\u4f5c\u8d1f\u8f7d\u6574\u4f53\u5065\u5eb7\u72b6\u51b5\u7684\u57fa\u7ebf\u3002</li> </ol> <p>\u4e0b\u9762\u662f\u4e00\u4e2a prometheus \u6293\u53d6\u914d\u7f6e\u793a\u4f8b\uff0c\u6211\u4eec\u4f7f\u7528 <code>relabel_config</code> \u53ea\u4fdd\u7559 kubelet \u6307\u6807\uff0c\u5e76\u4f7f\u7528 <code>metric_relabel_config</code> \u5220\u9664\u6240\u6709\u5bb9\u5668\u6307\u6807\u3002</p> <pre><code>  kubernetes_sd_configs:\n  - role: endpoints\n    namespaces:\n      names:\n      - kube-system\n  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  tls_config:\n    insecure_skip_verify: true\n  relabel_configs:\n  - source_labels: [__meta_kubernetes_service_label_k8s_app]\n    regex: kubelet\n    action: keep\n\n  metric_relabel_configs:\n  - source_labels: [__name__]\n    regex: container_(network_tcp_usage_total|network_udp_usage_total|tasks_state|cpu_load_average_10s)\n    action: drop\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_observability/#_10","title":"\u5728\u9002\u7528\u7684\u60c5\u51b5\u4e0b\u51cf\u5c11\u57fa\u6570","text":"<p>\u57fa\u6570\u662f\u6307\u7279\u5b9a\u6307\u6807\u96c6\u4e2d\u6570\u636e\u503c\u53ca\u5176\u7ef4\u5ea6 (\u4f8b\u5982 prometheus \u6807\u7b7e) \u7684\u552f\u4e00\u6027\u3002\u9ad8\u57fa\u6570\u6307\u6807\u5177\u6709\u8bb8\u591a\u7ef4\u5ea6\uff0c\u6bcf\u4e2a\u7ef4\u5ea6\u6307\u6807\u7ec4\u5408\u7684\u552f\u4e00\u6027\u4e5f\u66f4\u9ad8\u3002\u66f4\u9ad8\u7684\u57fa\u6570\u4f1a\u5bfc\u81f4\u66f4\u5927\u7684\u6307\u6807\u9065\u6d4b\u6570\u636e\u5927\u5c0f\u548c\u5b58\u50a8\u9700\u6c42\uff0c\u4ece\u800c\u589e\u52a0\u6210\u672c\u3002</p> <p>\u5728\u4e0b\u9762\u7684\u9ad8\u57fa\u6570\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u770b\u5230\u6307\u6807 Latency \u5177\u6709\u7ef4\u5ea6 RequestID\u3001CustomerID \u548c Service\uff0c\u6bcf\u4e2a\u7ef4\u5ea6\u90fd\u6709\u8bb8\u591a\u552f\u4e00\u503c\u3002\u57fa\u6570\u662f\u6bcf\u4e2a\u7ef4\u5ea6\u53ef\u80fd\u503c\u6570\u91cf\u7684\u7ec4\u5408\u5ea6\u91cf\u3002\u5728 Prometheus \u4e2d\uff0c\u6bcf\u7ec4\u552f\u4e00\u7684\u7ef4\u5ea6/\u6807\u7b7e\u90fd\u88ab\u89c6\u4e3a\u4e00\u4e2a\u65b0\u7684\u6307\u6807\uff0c\u56e0\u6b64\u9ad8\u57fa\u6570\u610f\u5473\u7740\u66f4\u591a\u7684\u6307\u6807\u3002</p> <p></p> <p>\u5728\u5177\u6709\u8bb8\u591a\u6307\u6807\u548c\u6bcf\u4e2a\u6307\u6807\u7684\u7ef4\u5ea6/\u6807\u7b7e (\u96c6\u7fa4\u3001\u547d\u540d\u7a7a\u95f4\u3001\u670d\u52a1\u3001Pod\u3001\u5bb9\u5668\u7b49) \u7684 EKS \u73af\u5883\u4e2d\uff0c\u57fa\u6570\u5f80\u5f80\u4f1a\u589e\u957f\u3002\u4e3a\u4e86\u4f18\u5316\u6210\u672c\uff0c\u8bf7\u4ed4\u7ec6\u8003\u8651\u60a8\u6b63\u5728\u6536\u96c6\u7684\u6307\u6807\u7684\u57fa\u6570\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u6b63\u5728\u805a\u5408\u7279\u5b9a\u6307\u6807\u4ee5\u8fdb\u884c\u96c6\u7fa4\u7ea7\u522b\u7684\u53ef\u89c6\u5316\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u5220\u9664\u4f4e\u4e8e\u547d\u540d\u7a7a\u95f4\u7ea7\u522b\u7684\u5176\u4ed6\u6807\u7b7e\u3002</p> <p>\u8981\u5728 prometheus \u4e2d\u8bc6\u522b\u9ad8\u57fa\u6570\u6307\u6807\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b PROMQL \u67e5\u8be2\u6765\u786e\u5b9a\u54ea\u4e9b\u6293\u53d6\u76ee\u6807\u5177\u6709\u6700\u9ad8\u7684\u6307\u6807\u6570\u91cf (\u57fa\u6570)\uff1a</p> <pre><code>topk_max(5, max_over_time(scrape_samples_scraped[1h]))\n</code></pre> <p>\u4ee5\u4e0b PROMQL \u67e5\u8be2\u53ef\u5e2e\u52a9\u60a8\u786e\u5b9a\u54ea\u4e9b\u6293\u53d6\u76ee\u6807\u5177\u6709\u6700\u9ad8\u7684\u6307\u6807\u53d8\u5316\u7387 (\u5728\u7ed9\u5b9a\u7684\u6293\u53d6\u4e2d\u521b\u5efa\u4e86\u591a\u5c11\u65b0\u7684\u6307\u6807\u5e8f\u5217)\uff1a</p> <pre><code>topk_max(5, max_over_time(scrape_series_added[1h]))\n</code></pre> <p>\u5982\u679c\u60a8\u4f7f\u7528 grafana\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Grafana Lab \u7684 Mimirtool \u5206\u6790\u60a8\u7684 grafana \u4eea\u8868\u677f\u548c prometheus \u89c4\u5219\uff0c\u4ee5\u8bc6\u522b\u672a\u4f7f\u7528\u7684\u9ad8\u57fa\u6570\u6307\u6807\u3002\u8bf7\u6309\u7167\u6b64\u6307\u5357\u4e86\u89e3\u5982\u4f55\u4f7f\u7528 <code>mimirtool analyze</code> \u548c <code>mimirtool analyze prometheus</code> \u547d\u4ee4\u6765\u8bc6\u522b\u672a\u5728\u60a8\u7684\u4eea\u8868\u677f\u4e2d\u5f15\u7528\u7684\u6d3b\u52a8\u6307\u6807\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_11","title":"\u8003\u8651\u6307\u6807\u7c92\u5ea6","text":"<p>\u6bcf\u79d2\u800c\u4e0d\u662f\u6bcf\u5206\u949f\u6536\u96c6\u6307\u6807\u53ef\u80fd\u4f1a\u5bf9\u6536\u96c6\u548c\u5b58\u50a8\u7684\u9065\u6d4b\u6570\u636e\u91cf\u4ea7\u751f\u5f88\u5927\u5f71\u54cd\uff0c\u4ece\u800c\u589e\u52a0\u6210\u672c\u3002\u786e\u5b9a\u5408\u7406\u7684\u6293\u53d6\u6216\u6307\u6807\u6536\u96c6\u95f4\u9694\uff0c\u5728\u80fd\u591f\u770b\u5230\u77ac\u65f6\u95ee\u9898\u7684\u8db3\u591f\u7c92\u5ea6\u548c\u6210\u672c\u6548\u76ca\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861\u3002\u5bf9\u4e8e\u7528\u4e8e\u5bb9\u91cf\u89c4\u5212\u548c\u8f83\u5927\u65f6\u95f4\u7a97\u53e3\u5206\u6790\u7684\u6307\u6807\uff0c\u8bf7\u964d\u4f4e\u5176\u7c92\u5ea6\u3002</p> <p>\u4e0b\u9762\u662f AWS Distro for Opentelemetry (ADOT) EKS \u63d2\u4ef6 Collector \u7684\u9ed8\u8ba4\u914d\u7f6e\u7684\u4e00\u4e2a\u7247\u6bb5\u3002</p> <p>Attention</p> <p>\u5168\u5c40 prometheus \u6293\u53d6\u95f4\u9694\u8bbe\u7f6e\u4e3a 15 \u79d2\u3002\u53ef\u4ee5\u589e\u52a0\u6b64\u6293\u53d6\u95f4\u9694\uff0c\u4ece\u800c\u51cf\u5c11\u5728 prometheus \u4e2d\u6536\u96c6\u7684\u6307\u6807\u6570\u636e\u91cf\u3002</p> <pre><code>apiVersion: opentelemetry.io/v1alpha1\nkind: OpenTelemetryCollector\nmetadata:\n  name: my-collector-amp\n\n...\n\n  config: |\n    extensions:\n      sigv4auth:\n        region: \"&lt;YOUR_AWS_REGION&gt;\"\n        service: \"aps\"\n\n    receivers:\n      #\n      # Scrape configuration for the Prometheus Receiver\n      # This is the same configuration used when Prometheus is installed using the community Helm chart\n      # \n      prometheus:\n        config:\n          global:\n  scrape_interval: 15s\n            scrape_timeout: 10s\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_observability/#_12","title":"\u8ddf\u8e2a","text":"<p>\u8ddf\u8e2a\u7684\u4e3b\u8981\u6210\u672c\u6765\u81ea\u8ddf\u8e2a\u5b58\u50a8\u751f\u6210\u3002\u5bf9\u4e8e\u8ddf\u8e2a\uff0c\u76ee\u6807\u662f\u6536\u96c6\u8db3\u591f\u7684\u6570\u636e\u6765\u8bca\u65ad\u548c\u4e86\u89e3\u6027\u80fd\u65b9\u9762\u3002\u4f46\u662f\uff0c\u7531\u4e8e X-Ray \u8ddf\u8e2a\u6210\u672c\u662f\u57fa\u4e8e\u8f6c\u53d1\u5230 X-Ray \u7684\u6570\u636e\uff0c\u56e0\u6b64\u5220\u9664\u5df2\u8f6c\u53d1\u7684\u8ddf\u8e2a\u4e0d\u4f1a\u964d\u4f4e\u60a8\u7684\u6210\u672c\u3002\u8ba9\u6211\u4eec\u56de\u987e\u4e00\u4e0b\u964d\u4f4e\u8ddf\u8e2a\u6210\u672c\u7684\u65b9\u6cd5\uff0c\u540c\u65f6\u4fdd\u7559\u6570\u636e\u4ee5\u4fbf\u60a8\u8fdb\u884c\u9002\u5f53\u7684\u5206\u6790\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_13","title":"\u5e94\u7528\u91c7\u6837\u89c4\u5219","text":"<p>X-Ray \u91c7\u6837\u7387\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u4fdd\u5b88\u7684\u3002\u5b9a\u4e49\u91c7\u6837\u89c4\u5219\uff0c\u60a8\u53ef\u4ee5\u63a7\u5236\u6536\u96c6\u7684\u6570\u636e\u91cf\u3002\u8fd9\u5c06\u63d0\u9ad8\u6027\u80fd\u6548\u7387\uff0c\u540c\u65f6\u964d\u4f4e\u6210\u672c\u3002\u901a\u8fc7\u964d\u4f4e\u91c7\u6837\u7387,\u60a8\u53ef\u4ee5\u4ec5\u4ece\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6240\u9700\u7684\u8bf7\u6c42\u4e2d\u6536\u96c6\u8ddf\u8e2a\uff0c\u540c\u65f6\u4fdd\u6301\u8f83\u4f4e\u7684\u6210\u672c\u7ed3\u6784\u3002</p> <p>\u4f8b\u5982\uff0c\u60a8\u6709\u4e00\u4e2a java \u5e94\u7528\u7a0b\u5e8f\uff0c\u60a8\u60f3\u8c03\u8bd5\u6240\u6709\u8bf7\u6c42\u7684\u8ddf\u8e2a\uff0c\u9488\u5bf9 1 \u4e2a\u6709\u95ee\u9898\u7684\u8def\u7531\u3002</p> <p>\u901a\u8fc7 SDK \u914d\u7f6e\u4ece JSON \u6587\u6863\u52a0\u8f7d\u91c7\u6837\u89c4\u5219</p> <pre><code>{\n\"version\": 2,\n  \"rules\": [\n    {\n\"description\": \"debug-eks\",\n      \"host\": \"*\",\n      \"http_method\": \"PUT\",\n      \"url_path\": \"/history/*\",\n      \"fixed_target\": 0,\n      \"rate\": 1,\n      \"service_type\": \"debug-eks\"\n    }\n  ],\n  \"default\": {\n\"fixed_target\": 1,\n    \"rate\": 0.1\n  }\n}\n</code></pre> <p>\u901a\u8fc7\u63a7\u5236\u53f0</p> <p></p>"},{"location":"zh/cost_optimization/cost_opt_observability/#aws-distro-for-opentelemetry-adot","title":"\u5e94\u7528 AWS Distro for OpenTelemetry (ADOT) \u7684\u5c3e\u90e8\u91c7\u6837","text":"<p>ADOT \u5c3e\u90e8\u91c7\u6837\u5141\u8bb8\u60a8\u63a7\u5236\u5f15\u5165\u670d\u52a1\u7684\u8ddf\u8e2a\u91cf\u3002\u4f46\u662f\uff0c\u5c3e\u90e8\u91c7\u6837\u5141\u8bb8\u60a8\u5728\u8bf7\u6c42\u4e2d\u7684\u6240\u6709\u8de8\u5ea6\u5b8c\u6210\u540e\uff0c\u800c\u4e0d\u662f\u5728\u5f00\u59cb\u65f6\u5b9a\u4e49\u91c7\u6837\u7b56\u7565\u3002\u8fd9\u8fdb\u4e00\u6b65\u9650\u5236\u4e86\u8f6c\u79fb\u5230 CloudWatch \u7684\u539f\u59cb\u6570\u636e\u91cf\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u6210\u672c\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5bf9\u7740\u9646\u9875\u9762\u7684 1% \u6d41\u91cf\u8fdb\u884c\u91c7\u6837\uff0c\u5bf9\u4ed8\u6b3e\u9875\u9762\u7684 10% \u8bf7\u6c42\u8fdb\u884c\u91c7\u6837\uff0c\u5728 30 \u5206\u949f\u5185\uff0c\u60a8\u53ef\u80fd\u4f1a\u5f97\u5230 300 \u4e2a\u8ddf\u8e2a\u3002\u4f7f\u7528\u8fc7\u6ee4\u7279\u5b9a\u9519\u8bef\u7684 ADOT \u5c3e\u90e8\u91c7\u6837\u89c4\u5219\uff0c\u60a8\u53ef\u80fd\u53ea\u5269\u4e0b 200 \u4e2a\u8ddf\u8e2a\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u5b58\u50a8\u7684\u8ddf\u8e2a\u6570\u91cf\u3002</p> <pre><code>processors:\n  groupbytrace:\n    wait_duration: 10s\n    num_traces: 300 \n    tail_sampling:\n    decision_wait: 1s # This value should be smaller than wait_duration\n    policies:\n      - ..... # Applicable policies**\n  batch/tracesampling:\n    timeout: 0s # No need to wait more since this will happen in previous processors\n    send_batch_max_size: 8196 # This will still allow us to limit the size of the batches sent to subsequent exporters\n\nservice:\n  pipelines:\n    traces/tailsampling:\n      receivers: [otlp]\n      processors: [groupbytrace, tail_sampling, batch/tracesampling]\n      exporters: [awsxray]\n</code></pre>"},{"location":"zh/cost_optimization/cost_opt_observability/#amazon-s3","title":"\u5229\u7528 Amazon S3 \u5b58\u50a8\u9009\u9879","text":"<p>\u60a8\u5e94\u8be5\u5229\u7528 AWS S3 \u5b58\u50a8\u6876\u53ca\u5176\u4e0d\u540c\u7684\u5b58\u50a8\u7c7b\u6765\u5b58\u50a8\u8ddf\u8e2a\u3002\u5728\u4fdd\u7559\u671f\u5230\u671f\u4e4b\u524d\u5c06\u8ddf\u8e2a\u5bfc\u51fa\u5230 S3\u3002\u4f7f\u7528 Amazon S3 \u751f\u547d\u5468\u671f\u89c4\u5219\u5c06\u8ddf\u8e2a\u6570\u636e\u79fb\u52a8\u5230\u6ee1\u8db3\u60a8\u8981\u6c42\u7684\u5b58\u50a8\u7c7b\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u6709 90 \u5929\u7684\u65e7\u8ddf\u8e2a\uff0cAmazon S3 \u667a\u80fd\u5206\u5c42\u5b58\u50a8\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u4f7f\u7528\u6a21\u5f0f\u81ea\u52a8\u5c06\u6570\u636e\u79fb\u52a8\u5230\u957f\u671f\u5b58\u50a8\u3002\u5982\u679c\u60a8\u9700\u8981\u53c2\u8003\u8ddf\u8e2a\uff0c\u53ef\u4ee5\u4f7f\u7528 Amazon Athena \u67e5\u8be2 Amazon S3 \u4e2d\u7684\u6570\u636e\u3002\u8fd9\u53ef\u4ee5\u8fdb\u4e00\u6b65\u964d\u4f4e\u60a8\u7684\u5206\u5e03\u5f0f\u8ddf\u8e2a\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_observability/#_14","title":"\u5176\u4ed6\u8d44\u6e90\uff1a","text":"<ul> <li>\u53ef\u89c2\u6d4b\u6027\u6700\u4f73\u5b9e\u8df5\u6307\u5357</li> <li>\u6700\u4f73\u5b9e\u8df5\u6307\u6807\u6536\u96c6</li> <li>AWS re:Invent 2022 - \u4e9a\u9a6c\u900a\u7684\u53ef\u89c2\u6d4b\u6027\u6700\u4f73\u5b9e\u8df5 (COP343)</li> <li>AWS re:Invent 2022 - \u53ef\u89c2\u6d4b\u6027\uff1a\u73b0\u4ee3\u5e94\u7528\u7a0b\u5e8f\u7684\u6700\u4f73\u5b9e\u8df5 (COP344)</li> </ul>"},{"location":"zh/cost_optimization/cost_opt_storage/","title":"\u6210\u672c\u4f18\u5316 - \u5b58\u50a8","text":""},{"location":"zh/cost_optimization/cost_opt_storage/#_1","title":"\u6982\u8ff0","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u8fd0\u884c\u9700\u8981\u4fdd\u7559\u77ed\u671f\u6216\u957f\u671f\u6570\u636e\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5bf9\u4e8e\u8fd9\u79cd\u7528\u4f8b\uff0c\u53ef\u4ee5\u5b9a\u4e49\u5377\u5e76\u7531 Pod \u6302\u8f7d\uff0c\u4ee5\u4fbf\u5176\u5bb9\u5668\u53ef\u4ee5\u8bbf\u95ee\u4e0d\u540c\u7684\u5b58\u50a8\u673a\u5236\u3002Kubernetes \u652f\u6301\u4e0d\u540c\u7c7b\u578b\u7684\u5377\u7528\u4e8e\u4e34\u65f6\u548c\u6301\u4e45\u5b58\u50a8\u3002\u5b58\u50a8\u7684\u9009\u62e9\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u53d6\u51b3\u4e8e\u5e94\u7528\u7a0b\u5e8f\u9700\u6c42\u3002\u5bf9\u4e8e\u6bcf\u79cd\u65b9\u6cd5\uff0c\u90fd\u6709\u6210\u672c\u5f71\u54cd\uff0c\u4e0b\u9762\u8be6\u7ec6\u4ecb\u7ecd\u7684\u505a\u6cd5\u5c06\u5e2e\u52a9\u60a8\u5728 EKS \u73af\u5883\u4e2d\u4e3a\u9700\u8981\u67d0\u79cd\u5f62\u5f0f\u5b58\u50a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5b9e\u73b0\u6210\u672c\u6548\u7387\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_2","title":"\u4e34\u65f6\u5377","text":"<p>\u4e34\u65f6\u5377\u9002\u7528\u4e8e\u9700\u8981\u4e34\u65f6\u672c\u5730\u5377\u4f46\u4e0d\u9700\u8981\u5728\u91cd\u542f\u540e\u4fdd\u7559\u6570\u636e\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u5305\u62ec\u5bf9\u4e34\u65f6\u7a7a\u95f4\u3001\u7f13\u5b58\u548c\u53ea\u8bfb\u8f93\u5165\u6570\u636e(\u5982\u914d\u7f6e\u6570\u636e\u548c\u5bc6\u94a5)\u7684\u9700\u6c42\u3002\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u6709\u5173 Kubernetes \u4e34\u65f6\u5377\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002\u5927\u591a\u6570\u4e34\u65f6\u5377(\u4f8b\u5982 emptyDir\u3001configMap\u3001downwardAPI\u3001secret\u3001hostpath)\u90fd\u7531\u672c\u5730\u9644\u52a0\u7684\u53ef\u5199\u8bbe\u5907(\u901a\u5e38\u662f\u6839\u78c1\u76d8)\u6216 RAM \u652f\u6301\uff0c\u56e0\u6b64\u9009\u62e9\u6700\u5177\u6210\u672c\u6548\u7387\u548c\u6027\u80fd\u7684\u4e3b\u673a\u5377\u5f88\u91cd\u8981\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#ebs","title":"\u4f7f\u7528 EBS \u5377","text":"<p>\u6211\u4eec\u5efa\u8bae\u4ece gp3 \u4f5c\u4e3a\u4e3b\u673a\u6839\u5377\u5f00\u59cb\u3002 \u5b83\u662f\u4e9a\u9a6c\u900a EBS \u63d0\u4f9b\u7684\u6700\u65b0\u4e00\u4ee3\u901a\u7528 SSD \u5377\uff0c\u4e0e gp2 \u5377\u76f8\u6bd4\uff0c\u6bcf GB \u7684\u4ef7\u683c\u4e5f\u66f4\u4f4e(\u6700\u9ad8\u53ef\u964d\u4f4e 20%)\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#amazon-ec2","title":"\u4f7f\u7528 Amazon EC2 \u5b9e\u4f8b\u5b58\u50a8","text":"<p>Amazon EC2 \u5b9e\u4f8b\u5b58\u50a8\u4e3a\u60a8\u7684 EC2 \u5b9e\u4f8b\u63d0\u4f9b\u4e34\u65f6\u5757\u7ea7\u5b58\u50a8\u3002EC2 \u5b9e\u4f8b\u5b58\u50a8\u63d0\u4f9b\u7684\u5b58\u50a8\u53ef\u901a\u8fc7\u7269\u7406\u9644\u52a0\u5230\u4e3b\u673a\u7684\u78c1\u76d8\u8bbf\u95ee\u3002\u4e0e Amazon EBS \u4e0d\u540c\uff0c\u60a8\u53ea\u80fd\u5728\u542f\u52a8\u5b9e\u4f8b\u65f6\u9644\u52a0\u5b9e\u4f8b\u5b58\u50a8\u5377\uff0c\u5e76\u4e14\u8fd9\u4e9b\u5377\u53ea\u5728\u5b9e\u4f8b\u7684\u751f\u547d\u5468\u671f\u5185\u5b58\u5728\u3002\u5b83\u4eec\u65e0\u6cd5\u5206\u79bb\u5e76\u91cd\u65b0\u9644\u52a0\u5230\u5176\u4ed6\u5b9e\u4f8b\u3002\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u4e86\u89e3\u66f4\u591a\u5173\u4e8e Amazon EC2 \u5b9e\u4f8b\u5b58\u50a8\u7684\u4fe1\u606f\u3002\u4f7f\u7528\u5b9e\u4f8b\u5b58\u50a8\u5377\u4e0d\u9700\u8981\u989d\u5916\u8d39\u7528\u3002 \u8fd9\u4f7f\u5b83\u4eec(\u5b9e\u4f8b\u5b58\u50a8\u5377)\u6bd4\u5177\u6709\u5927\u578b EBS \u5377\u7684\u901a\u7528 EC2 \u5b9e\u4f8b\u66f4\u5177\u6210\u672c\u6548\u7387\u3002</p> <p>\u8981\u5728 Kubernetes \u4e2d\u4f7f\u7528\u672c\u5730\u5b58\u50a8\u5377\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528 Amazon EC2 \u7528\u6237\u6570\u636e\u5206\u533a\u3001\u914d\u7f6e\u548c\u683c\u5f0f\u5316\u78c1\u76d8\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u5c06\u5377\u4f5c\u4e3a HostPath \u5728 pod \u89c4\u8303\u4e2d\u6302\u8f7d\u3002\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5229\u7528 Local Persistent Volume Static Provisioner \u6765\u7b80\u5316\u672c\u5730\u5b58\u50a8\u7ba1\u7406\u3002\u672c\u5730\u6301\u4e45\u5377\u9759\u6001\u4f9b\u5e94\u5668\u5141\u8bb8\u60a8\u901a\u8fc7\u6807\u51c6\u7684 Kubernetes PersistentVolumeClaim (PVC) \u63a5\u53e3\u8bbf\u95ee\u672c\u5730\u5b9e\u4f8b\u5b58\u50a8\u5377\u3002\u6b64\u5916\uff0c\u5b83\u8fd8\u5c06\u63d0\u4f9b\u5305\u542b\u8282\u70b9\u4eb2\u548c\u6027\u4fe1\u606f\u7684 PersistentVolumes (PVs)\uff0c\u4ee5\u5c06 Pod \u8c03\u5ea6\u5230\u6b63\u786e\u7684\u8282\u70b9\u3002\u5c3d\u7ba1\u5b83\u4f7f\u7528 Kubernetes PersistentVolumes\uff0c\u4f46 EC2 \u5b9e\u4f8b\u5b58\u50a8\u5377\u672c\u8d28\u4e0a\u662f\u4e34\u65f6\u7684\u3002\u5199\u5165\u4e34\u65f6\u78c1\u76d8\u7684\u6570\u636e\u4ec5\u5728\u5b9e\u4f8b\u7684\u751f\u547d\u5468\u671f\u5185\u53ef\u7528\u3002\u5b9e\u4f8b\u7ec8\u6b62\u65f6\uff0c\u6570\u636e\u4e5f\u4f1a\u88ab\u5220\u9664\u3002\u8bf7\u53c2\u9605\u8fd9\u7bc7\u535a\u5ba2\u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u4f7f\u7528 Amazon EC2 \u5b9e\u4f8b\u5b58\u50a8\u5377\u65f6\uff0c\u603b IOPS \u9650\u5236\u4e0e\u4e3b\u673a\u5171\u4eab\uff0c\u5e76\u4e14\u5b83\u5c06 Pod \u7ed1\u5b9a\u5230\u7279\u5b9a\u4e3b\u673a\u3002\u5728\u91c7\u7528 Amazon EC2 \u5b9e\u4f8b\u5b58\u50a8\u5377\u4e4b\u524d\uff0c\u60a8\u5e94\u8be5\u5f7b\u5e95\u5ba1\u67e5\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_3","title":"\u6301\u4e45\u5377","text":"<p>Kubernetes \u901a\u5e38\u4e0e\u8fd0\u884c\u65e0\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f\u76f8\u5173\u8054\u3002\u4f46\u662f\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u8fd0\u884c\u9700\u8981\u5728\u4e00\u4e2a\u8bf7\u6c42\u5230\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u4e4b\u95f4\u4fdd\u7559\u6301\u4e45\u6570\u636e\u6216\u4fe1\u606f\u7684\u5fae\u670d\u52a1\u3002\u6570\u636e\u5e93\u5c31\u662f\u8fd9\u79cd\u7528\u4f8b\u7684\u5e38\u89c1\u793a\u4f8b\u3002\u4f46\u662f\uff0cPod \u53ca\u5176\u4e2d\u7684\u5bb9\u5668\u6216\u8fdb\u7a0b\u672c\u8d28\u4e0a\u662f\u4e34\u65f6\u7684\u3002\u8981\u5728 Pod \u751f\u547d\u5468\u671f\u4e4b\u5916\u6301\u4e45\u5316\u6570\u636e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 PV \u6765\u5b9a\u4e49\u5bf9\u72ec\u7acb\u4e8e Pod \u7684\u7279\u5b9a\u4f4d\u7f6e\u7684\u5b58\u50a8\u7684\u8bbf\u95ee\u3002\u4e0e PV \u76f8\u5173\u7684\u6210\u672c\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u53d6\u51b3\u4e8e\u6240\u4f7f\u7528\u7684\u5b58\u50a8\u7c7b\u578b\u4ee5\u53ca\u5e94\u7528\u7a0b\u5e8f\u5982\u4f55\u4f7f\u7528\u5b83\u3002</p> <p>\u5728 Amazon EKS \u4e0a\u652f\u6301 Kubernetes PV \u7684\u4e0d\u540c\u5b58\u50a8\u9009\u9879\u5217\u5728\u8fd9\u91cc\u3002\u4e0b\u9762\u4ecb\u7ecd\u7684\u5b58\u50a8\u9009\u9879\u5305\u62ec Amazon EBS\u3001Amazon EFS\u3001Amazon FSx for Lustre \u548c Amazon FSx for NetApp ONTAP\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#amazon-elastic-block-store-ebs","title":"Amazon Elastic Block Store (EBS) \u5377","text":"<p>Amazon EBS \u5377\u53ef\u4ee5\u4f5c\u4e3a Kubernetes PV \u4f7f\u7528\uff0c\u4ee5\u63d0\u4f9b\u5757\u7ea7\u5b58\u50a8\u5377\u3002\u8fd9\u4e9b\u975e\u5e38\u9002\u5408\u4f9d\u8d56\u968f\u673a\u8bfb\u5199\u548c\u541e\u5410\u91cf\u5bc6\u96c6\u578b\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u636e\u5e93\uff0c\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\u6267\u884c\u957f\u65f6\u95f4\u8fde\u7eed\u7684\u8bfb\u5199\u64cd\u4f5c\u3002Amazon Elastic Block Store Container Storage Interface (CSI) \u9a71\u52a8\u7a0b\u5e8f\u5141\u8bb8 Amazon EKS \u96c6\u7fa4\u7ba1\u7406 Amazon EBS \u5377\u7684\u751f\u547d\u5468\u671f\uff0c\u7528\u4f5c\u6301\u4e45\u5377\u3002\u5bb9\u5668\u5b58\u50a8\u63a5\u53e3 (CSI) \u542f\u7528\u5e76\u4fc3\u8fdb Kubernetes \u4e0e\u5b58\u50a8\u7cfb\u7edf\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002\u5f53 CSI \u9a71\u52a8\u7a0b\u5e8f\u90e8\u7f72\u5230\u60a8\u7684 EKS \u96c6\u7fa4\u65f6\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u672c\u673a Kubernetes \u5b58\u50a8\u8d44\u6e90(\u5982 Persistent Volumes (PVs)\u3001Persistent Volume Claims (PVCs) \u548c Storage Classes (SCs))\u8bbf\u95ee\u5176\u529f\u80fd\u3002\u8fd9\u4e2a\u94fe\u63a5\u63d0\u4f9b\u4e86\u5982\u4f55\u4e0e Amazon EBS CSI \u9a71\u52a8\u7a0b\u5e8f\u4ea4\u4e92\u4f7f\u7528 Amazon EBS \u5377\u7684\u5b9e\u9645\u793a\u4f8b\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_4","title":"\u9009\u62e9\u5408\u9002\u7684\u5377","text":"<p>\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u6700\u65b0\u4e00\u4ee3\u5757\u5b58\u50a8 (gp3)\uff0c\u56e0\u4e3a\u5b83\u5728\u4ef7\u683c\u548c\u6027\u80fd\u4e4b\u95f4\u63d0\u4f9b\u4e86\u5408\u9002\u7684\u5e73\u8861\u3002\u5b83\u8fd8\u5141\u8bb8\u60a8\u72ec\u7acb\u4e8e\u5377\u5927\u5c0f\u7f29\u653e\u5377 IOPS \u548c\u541e\u5410\u91cf\uff0c\u800c\u65e0\u9700\u9884\u7f6e\u989d\u5916\u7684\u5757\u5b58\u50a8\u5bb9\u91cf\u3002\u5982\u679c\u60a8\u5f53\u524d\u6b63\u5728\u4f7f\u7528 gp2 \u5377\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u8fc1\u79fb\u5230 gp3 \u5377\u3002\u8fd9\u7bc7\u535a\u5ba2\u89e3\u91ca\u4e86\u5982\u4f55\u5728 Amazon EKS \u96c6\u7fa4\u4e0a\u4ece gp2 \u8fc1\u79fb\u5230 gp3\u3002</p> <p>\u5f53\u60a8\u6709\u9700\u8981\u66f4\u9ad8\u6027\u80fd\u4e14\u9700\u8981\u6bd4\u5355\u4e2a gp3 \u5377\u652f\u6301\u7684\u66f4\u5927\u5377\u7684\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u60a8\u5e94\u8be5\u8003\u8651\u4f7f\u7528 io2 block express\u3002\u8fd9\u79cd\u5b58\u50a8\u975e\u5e38\u9002\u5408\u60a8\u6700\u5927\u3001I/O \u5bc6\u96c6\u578b\u548c\u5173\u952e\u4efb\u52a1\u90e8\u7f72\uff0c\u5982 SAP HANA \u6216\u5176\u4ed6\u5177\u6709\u4f4e\u5ef6\u8fdf\u8981\u6c42\u7684\u5927\u578b\u6570\u636e\u5e93\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5b9e\u4f8b\u7684 EBS \u6027\u80fd\u53d7\u5b9e\u4f8b\u6027\u80fd\u9650\u5236\u7684\u7ea6\u675f\uff0c\u56e0\u6b64\u5e76\u975e\u6240\u6709\u5b9e\u4f8b\u90fd\u652f\u6301 io2 block express \u5377\u3002\u60a8\u53ef\u4ee5\u5728\u6b64\u6587\u6863\u4e2d\u67e5\u770b\u652f\u6301\u7684\u5b9e\u4f8b\u7c7b\u578b\u548c\u5176\u4ed6\u6ce8\u610f\u4e8b\u9879\u3002</p> <p>\u5355\u4e2a gp3 \u5377\u6700\u591a\u53ef\u652f\u6301 16\uff0c000 IOPS\u30011,000 MiB/s \u6700\u5927\u541e\u5410\u91cf\u3001\u6700\u5927 16TiB\u3002\u6700\u65b0\u4e00\u4ee3 Provisioned IOPS SSD \u5377\u63d0\u4f9b\u9ad8\u8fbe 256\uff0c000 IOPS\u30014,000 MiB/s \u541e\u5410\u91cf\u548c 64TiB\u3002</p> <p>\u5728\u8fd9\u4e9b\u9009\u9879\u4e2d\uff0c\u60a8\u5e94\u8be5\u6839\u636e\u5e94\u7528\u7a0b\u5e8f\u7684\u9700\u6c42\u6765\u6700\u4f73\u5730\u8c03\u6574\u5b58\u50a8\u6027\u80fd\u548c\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_5","title":"\u76d1\u63a7\u5e76\u968f\u65f6\u95f4\u4f18\u5316","text":"<p>\u4e86\u89e3\u60a8\u5e94\u7528\u7a0b\u5e8f\u7684\u57fa\u7ebf\u6027\u80fd\u5e76\u76d1\u63a7\u6240\u9009\u5377\u4ee5\u68c0\u67e5\u5176\u662f\u5426\u6ee1\u8db3\u60a8\u7684\u8981\u6c42/\u671f\u671b\u6216\u662f\u5426\u8fc7\u5ea6\u4f9b\u5e94(\u4f8b\u5982\uff0c\u9884\u7f6e\u7684 IOPS \u672a\u88ab\u5145\u5206\u5229\u7528\u7684\u60c5\u51b5)\u5f88\u91cd\u8981\u3002</p> <p>\u60a8\u53ef\u4ee5\u968f\u7740\u6570\u636e\u7684\u79ef\u7d2f\u9010\u6b65\u589e\u52a0\u5377\u7684\u5927\u5c0f\uff0c\u800c\u4e0d\u662f\u4e00\u5f00\u59cb\u5c31\u5206\u914d\u5927\u5377\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Amazon Elastic Block Store CSI \u9a71\u52a8\u7a0b\u5e8f (aws-ebs-csi-driver) \u4e2d\u7684\u5377\u8c03\u6574\u5927\u5c0f\u529f\u80fd\u52a8\u6001\u8c03\u6574\u5377\u5927\u5c0f\u3002\u8bf7\u8bb0\u4f4f\uff0c\u60a8\u53ea\u80fd\u589e\u52a0 EBS \u5377\u7684\u5927\u5c0f\u3002</p> <p>\u8981\u8bc6\u522b\u548c\u5220\u9664\u4efb\u4f55\u60ac\u7a7a\u7684 EBS \u5377\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 AWS \u53ef\u4fe1\u8d56\u987e\u95ee\u7684\u6210\u672c\u4f18\u5316\u7c7b\u522b\u3002\u6b64\u529f\u80fd\u53ef\u5e2e\u52a9\u60a8\u8bc6\u522b\u672a\u9644\u52a0\u7684\u5377\u6216\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u5199\u5165\u6d3b\u52a8\u975e\u5e38\u4f4e\u7684\u5377\u3002\u6709\u4e00\u4e2a\u540d\u4e3a Popeye \u7684\u4e91\u539f\u751f\u5f00\u6e90\u53ea\u8bfb\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u626b\u63cf\u5b9e\u65f6 Kubernetes \u96c6\u7fa4\u5e76\u62a5\u544a\u5df2\u90e8\u7f72\u8d44\u6e90\u548c\u914d\u7f6e\u4e2d\u7684\u6f5c\u5728\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5b83\u53ef\u4ee5\u626b\u63cf\u672a\u4f7f\u7528\u7684 PV \u548c PVC\uff0c\u5e76\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u5df2\u7ed1\u5b9a\u6216\u662f\u5426\u5b58\u5728\u4efb\u4f55\u5377\u6302\u8f7d\u9519\u8bef\u3002</p> <p>\u6709\u5173\u76d1\u63a7\u7684\u6df1\u5165\u63a2\u8ba8\uff0c\u8bf7\u53c2\u9605 EKS \u6210\u672c\u4f18\u5316\u53ef\u89c2\u5bdf\u6027\u6307\u5357\u3002</p> <p>\u60a8\u53ef\u4ee5\u8003\u8651\u7684\u53e6\u4e00\u4e2a\u9009\u9879\u662f AWS Compute Optimizer Amazon EBS \u5377\u5efa\u8bae\u3002\u8be5\u5de5\u5177\u53ef\u4ee5\u81ea\u52a8\u8bc6\u522b\u6240\u9700\u7684\u6700\u4f73\u5377\u914d\u7f6e\u548c\u6b63\u786e\u7684\u6027\u80fd\u7ea7\u522b\u3002\u4f8b\u5982\uff0c\u5b83\u53ef\u7528\u4e8e\u57fa\u4e8e\u8fc7\u53bb 14 \u5929\u7684\u6700\u5927\u5229\u7528\u7387\u83b7\u53d6 EBS \u5377\u7684\u6700\u4f73\u8bbe\u7f6e\uff0c\u5305\u62ec\u9884\u7f6e IOPS\u3001\u5377\u5927\u5c0f\u548c EBS \u5377\u7c7b\u578b\u3002\u5b83\u8fd8\u91cf\u5316\u4e86\u5176\u5efa\u8bae\u6240\u5e26\u6765\u7684\u6f5c\u5728\u6bcf\u6708\u6210\u672c\u8282\u7701\u3002\u60a8\u53ef\u4ee5\u67e5\u770b\u8fd9\u7bc7\u535a\u5ba2\u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_6","title":"\u5907\u4efd\u4fdd\u7559\u7b56\u7565","text":"<p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u65f6\u95f4\u70b9\u5feb\u7167\u6765\u5907\u4efd Amazon EBS \u5377\u4e0a\u7684\u6570\u636e\u3002Amazon EBS CSI \u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u5377\u5feb\u7167\u3002\u60a8\u53ef\u4ee5\u6309\u7167\u8fd9\u91cc\u6982\u8ff0\u7684\u6b65\u9aa4\u4e86\u89e3\u5982\u4f55\u521b\u5efa\u5feb\u7167\u548c\u6062\u590d EBS PV\u3002</p> <p>\u540e\u7eed\u5feb\u7167\u662f\u589e\u91cf\u5907\u4efd\uff0c\u8fd9\u610f\u5473\u7740\u53ea\u4fdd\u5b58\u81ea\u4e0a\u6b21\u5feb\u7167\u540e\u8bbe\u5907\u4e0a\u5df2\u66f4\u6539\u7684\u5757\u3002\u8fd9\u6700\u5c0f\u5316\u4e86\u521b\u5efa\u5feb\u7167\u6240\u9700\u7684\u65f6\u95f4\uff0c\u5e76\u901a\u8fc7\u4e0d\u590d\u5236\u6570\u636e\u6765\u8282\u7701\u5b58\u50a8\u6210\u672c\u3002\u4f46\u662f\uff0c\u5728\u5927\u89c4\u6a21\u64cd\u4f5c\u65f6\uff0c\u65e7 EBS \u5feb\u7167\u6570\u91cf\u7684\u589e\u957f\u800c\u6ca1\u6709\u9002\u5f53\u7684\u4fdd\u7559\u7b56\u7565\u4f1a\u5bfc\u81f4\u610f\u5916\u6210\u672c\u3002\u5982\u679c\u60a8\u76f4\u63a5\u901a\u8fc7 AWS API \u5907\u4efd Amazon EBS \u5377\uff0c\u60a8\u53ef\u4ee5\u5229\u7528 Amazon Data Lifecycle Manager (DLM),\u5b83\u4e3a Amazon Elastic Block Store (EBS) \u5feb\u7167\u548c\u57fa\u4e8e EBS \u7684 Amazon Machine Images (AMIs) \u63d0\u4f9b\u4e86\u81ea\u52a8\u5316\u3001\u57fa\u4e8e\u7b56\u7565\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u3002\u63a7\u5236\u53f0\u4f7f\u81ea\u52a8\u521b\u5efa\u3001\u4fdd\u7559\u548c\u5220\u9664 EBS \u5feb\u7167\u548c AMI \u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002</p> <p>Note</p> <p>\u76ee\u524d\u65e0\u6cd5\u901a\u8fc7 Amazon EBS CSI \u9a71\u52a8\u7a0b\u5e8f\u4f7f\u7528 Amazon DLM\u3002</p> <p>\u5728 Kubernetes \u73af\u5883\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5229\u7528\u4e00\u4e2a\u540d\u4e3a Velero \u7684\u5f00\u6e90\u5de5\u5177\u6765\u5907\u4efd\u60a8\u7684 EBS \u6301\u4e45\u5377\u3002\u60a8\u53ef\u4ee5\u5728\u8c03\u5ea6\u4f5c\u4e1a\u65f6\u8bbe\u7f6e TTL \u6807\u5fd7\u6765\u4f7f\u5907\u4efd\u8fc7\u671f\u3002\u8fd9\u662f Velero \u63d0\u4f9b\u7684\u4e00\u4e2a\u6307\u5357\u793a\u4f8b\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#amazon-elastic-file-system-efs","title":"Amazon Elastic File System (EFS)","text":"<p>Amazon Elastic File System (EFS) \u662f\u4e00\u4e2a\u65e0\u670d\u52a1\u5668\u3001\u5b8c\u5168\u5f39\u6027\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5141\u8bb8\u60a8\u4f7f\u7528\u6807\u51c6\u6587\u4ef6\u7cfb\u7edf\u63a5\u53e3\u548c\u6587\u4ef6\u7cfb\u7edf\u8bed\u4e49\u5171\u4eab\u6587\u4ef6\u6570\u636e\uff0c\u9002\u7528\u4e8e\u5e7f\u6cdb\u7684\u5de5\u4f5c\u8d1f\u8f7d\u548c\u5e94\u7528\u7a0b\u5e8f\u3002\u5de5\u4f5c\u8d1f\u8f7d\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u793a\u4f8b\u5305\u62ec Wordpress \u548c Drupal\u3001\u5f00\u53d1\u4eba\u5458\u5de5\u5177(\u5982 JIRA \u548c Git)\u4ee5\u53ca\u5171\u4eab\u7b14\u8bb0\u672c\u7cfb\u7edf(\u5982 Jupyter)\u548c\u4e3b\u76ee\u5f55\u3002</p> <p>Amazon EFS \u7684\u4e00\u4e2a\u4e3b\u8981\u4f18\u70b9\u662f\u5b83\u53ef\u4ee5\u7531\u8de8\u591a\u4e2a\u8282\u70b9\u548c\u591a\u4e2a\u53ef\u7528\u533a\u57df\u7684\u591a\u4e2a\u5bb9\u5668\u6302\u8f7d\u3002\u53e6\u4e00\u4e2a\u597d\u5904\u662f\u60a8\u53ea\u9700\u4e3a\u4f7f\u7528\u7684\u5b58\u50a8\u4ed8\u8d39\u3002EFS \u6587\u4ef6\u7cfb\u7edf\u4f1a\u968f\u7740\u60a8\u6dfb\u52a0\u548c\u5220\u9664\u6587\u4ef6\u800c\u81ea\u52a8\u589e\u957f\u548c\u7f29\u5c0f\uff0c\u4ece\u800c\u6d88\u9664\u4e86\u5bb9\u91cf\u89c4\u5212\u7684\u9700\u8981\u3002</p> <p>\u8981\u5728 Kubernetes \u4e2d\u4f7f\u7528 Amazon EFS\uff0c\u60a8\u9700\u8981\u4f7f\u7528 Amazon Elastic File System Container Storage Interface (CSI) \u9a71\u52a8\u7a0b\u5e8f aws-efs-csi-driver\u3002\u76ee\u524d\uff0c\u8be5\u9a71\u52a8\u7a0b\u5e8f\u53ef\u4ee5\u52a8\u6001\u521b\u5efa\u8bbf\u95ee\u70b9\u3002\u4f46\u662f\uff0cAmazon EFS \u6587\u4ef6\u7cfb\u7edf\u5fc5\u987b\u5148\u88ab\u9884\u7f6e\uff0c\u5e76\u4f5c\u4e3a Kubernetes \u5b58\u50a8\u7c7b\u53c2\u6570\u7684\u8f93\u5165\u63d0\u4f9b\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#efs","title":"\u9009\u62e9\u5408\u9002\u7684 EFS \u5b58\u50a8\u7c7b","text":"<p>Amazon EFS \u63d0\u4f9b\u56db\u79cd\u5b58\u50a8\u7c7b\u3002</p> <p>\u4e24\u79cd\u6807\u51c6\u5b58\u50a8\u7c7b\uff1a</p> <ul> <li>Amazon EFS Standard</li> <li>Amazon EFS Standard-Infrequent Access (EFS Standard-IA)</li> </ul> <p>\u4e24\u79cd\u5355\u533a\u57df\u5b58\u50a8\u7c7b\uff1a</p> <ul> <li>Amazon EFS One Zone</li> <li>Amazon EFS One Zone-Infrequent Access (EFS One Zone-IA)</li> </ul> <p>\u4e0d\u7ecf\u5e38\u8bbf\u95ee (IA) \u5b58\u50a8\u7c7b\u9488\u5bf9\u4e0d\u7ecf\u5e38\u8bbf\u95ee\u7684\u6587\u4ef6\u8fdb\u884c\u4e86\u6210\u672c\u4f18\u5316\u3002\u901a\u8fc7 Amazon EFS \u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u60a8\u53ef\u4ee5\u5c06\u5728\u751f\u547d\u5468\u671f\u7b56\u7565\u6301\u7eed\u65f6\u95f4 (7\u300114\u300130\u300160 \u6216 90 \u5929) \u5185\u672a\u88ab\u8bbf\u95ee\u7684\u6587\u4ef6\u79fb\u52a8\u5230 IA \u5b58\u50a8\u7c7b\uff0c\u4e0e EFS Standard \u548c EFS One Zone \u5b58\u50a8\u7c7b\u76f8\u6bd4\uff0c\u53ef\u5c06\u5b58\u50a8\u6210\u672c\u964d\u4f4e\u9ad8\u8fbe 92%\u3002</p> <p>\u901a\u8fc7 EFS Intelligent-Tiering,\u751f\u547d\u5468\u671f\u7ba1\u7406\u53ef\u76d1\u63a7\u60a8\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u8bbf\u95ee\u6a21\u5f0f\uff0c\u5e76\u81ea\u52a8\u5c06\u6587\u4ef6\u79fb\u52a8\u5230\u6700\u4f73\u5b58\u50a8\u7c7b\u3002</p> <p>Note</p> <p>aws-efs-csi-driver \u76ee\u524d\u65e0\u6cd5\u63a7\u5236\u66f4\u6539\u5b58\u50a8\u7c7b\u3001\u751f\u547d\u5468\u671f\u7ba1\u7406\u6216\u667a\u80fd\u5206\u5c42\u3002\u8fd9\u4e9b\u5e94\u8be5\u5728 AWS \u63a7\u5236\u53f0\u6216\u901a\u8fc7 EFS API \u624b\u52a8\u8bbe\u7f6e\u3002</p> <p>Note</p> <p>aws-efs-csi-driver \u4e0e\u57fa\u4e8e Window \u7684\u5bb9\u5668\u6620\u50cf\u4e0d\u517c\u5bb9\u3002</p> <p>Note</p> <p>\u5f53\u542f\u7528 vol-metrics-opt-in (\u53d1\u51fa\u5377\u6307\u6807) \u65f6\uff0c\u5b58\u5728\u5df2\u77e5\u7684\u5185\u5b58\u95ee\u9898\uff0c\u8fd9\u662f\u7531\u4e8e DiskUsage \u51fd\u6570\u6d88\u8017\u7684\u5185\u5b58\u91cf\u4e0e\u60a8\u7684\u6587\u4ef6\u7cfb\u7edf\u5927\u5c0f\u6210\u6b63\u6bd4\u3002\u76ee\u524d\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u5927\u578b\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7981\u7528 <code>--vol-metrics-opt-in</code> \u9009\u9879\uff0c\u4ee5\u907f\u514d\u6d88\u8017\u8fc7\u591a\u5185\u5b58\u3002\u8fd9\u91cc\u662f\u4e00\u4e2a github \u95ee\u9898\u94fe\u63a5\u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#amazon-fsx-for-lustre","title":"Amazon FSx for Lustre","text":"<p>Lustre \u662f\u4e00\u79cd\u9ad8\u6027\u80fd\u5e76\u884c\u6587\u4ef6\u7cfb\u7edf\uff0c\u901a\u5e38\u7528\u4e8e\u9700\u8981\u9ad8\u8fbe\u6570\u767e GB/s \u7684\u541e\u5410\u91cf\u548c\u4e9a\u6beb\u79d2\u7ea7\u6bcf\u64cd\u4f5c\u5ef6\u8fdf\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\u5b83\u7528\u4e8e\u673a\u5668\u5b66\u4e60\u8bad\u7ec3\u3001\u91d1\u878d\u5efa\u6a21\u3001HPC \u548c\u89c6\u9891\u5904\u7406\u7b49\u573a\u666f\u3002Amazon FSx for Lustre \u63d0\u4f9b\u5b8c\u5168\u6258\u7ba1\u7684\u5171\u4eab\u5b58\u50a8\uff0c\u5177\u6709\u53ef\u6269\u5c55\u6027\u548c\u6027\u80fd\uff0c\u4e0e Amazon S3 \u65e0\u7f1d\u96c6\u6210\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u7531 FSx for Lustre \u652f\u6301\u7684 Kubernetes \u6301\u4e45\u5b58\u50a8\u5377\uff0c\u65e0\u8bba\u662f\u5728 Amazon EKS \u8fd8\u662f\u60a8\u5728 AWS \u4e0a\u7684\u81ea\u7ba1\u7406 Kubernetes \u96c6\u7fa4\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u548c\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605 Amazon EKS \u6587\u6863\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#amazon-s3","title":"\u94fe\u63a5\u5230 Amazon S3","text":"<p>\u5efa\u8bae\u5c06\u4f4d\u4e8e Amazon S3 \u4e0a\u7684\u9ad8\u6301\u4e45\u6027\u957f\u671f\u6570\u636e\u5b58\u50a8\u5e93\u4e0e\u60a8\u7684 FSx for Lustre \u6587\u4ef6\u7cfb\u7edf\u94fe\u63a5\u3002\u4e00\u65e6\u94fe\u63a5\uff0c\u5927\u578b\u6570\u636e\u96c6\u5c06\u6839\u636e\u9700\u8981\u4ece Amazon S3 \u5ef6\u8fdf\u52a0\u8f7d\u5230 FSx for Lustre \u6587\u4ef6\u7cfb\u7edf\u3002\u60a8\u8fd8\u53ef\u4ee5\u5c06\u5206\u6790\u7ed3\u679c\u8fd0\u884c\u56de S3\uff0c\u7136\u540e\u5220\u9664\u60a8\u7684 [Lustre] \u6587\u4ef6\u7cfb\u7edf\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_7","title":"\u9009\u62e9\u5408\u9002\u7684\u90e8\u7f72\u548c\u5b58\u50a8\u9009\u9879","text":"<p>FSx for Lustre \u63d0\u4f9b\u4e0d\u540c\u7684\u90e8\u7f72\u9009\u9879\u3002\u7b2c\u4e00\u4e2a\u9009\u9879\u79f0\u4e3a scratch,\u5b83\u4e0d\u590d\u5236\u6570\u636e\uff0c\u800c\u7b2c\u4e8c\u4e2a\u9009\u9879\u79f0\u4e3a persistent,\u987e\u540d\u601d\u4e49\uff0c\u5b83\u4f1a\u6301\u4e45\u5316\u6570\u636e\u3002</p> <p>\u7b2c\u4e00\u4e2a\u9009\u9879 (scratch) \u53ef\u7528\u4e8e\u51cf\u5c11\u4e34\u65f6\u8f83\u77ed\u671f\u6570\u636e\u5904\u7406\u7684\u6210\u672c\u3002 \u6301\u4e45\u90e8\u7f72\u9009\u9879 \u65e8\u5728\u957f\u671f\u5b58\u50a8\uff0c\u5b83\u4f1a\u81ea\u52a8\u5728 AWS \u53ef\u7528\u533a\u57df\u5185\u590d\u5236\u6570\u636e\u3002\u5b83\u8fd8\u652f\u6301 SSD \u548c HDD \u5b58\u50a8\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728 FSx for lustre \u6587\u4ef6\u7cfb\u7edf\u7684 Kubernetes StorageClass \u7684\u53c2\u6570\u4e2d\u914d\u7f6e\u6240\u9700\u7684\u90e8\u7f72\u7c7b\u578b\u3002\u8fd9\u91cc\u662f\u4e00\u4e2a\u94fe\u63a5\u63d0\u4f9b\u4e86\u793a\u4f8b\u6a21\u677f\u3002</p> <p>Note</p> <p>\u5bf9\u4e8e\u5ef6\u8fdf\u654f\u611f\u578b\u5de5\u4f5c\u8d1f\u8f7d\u6216\u9700\u8981\u6700\u9ad8 IOPS/\u541e\u5410\u91cf\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u60a8\u5e94\u8be5\u9009\u62e9 SSD \u5b58\u50a8\u3002\u5bf9\u4e8e\u4e0d\u592a\u5173\u6ce8\u5ef6\u8fdf\u4f46\u9700\u8981\u9ad8\u541e\u5410\u91cf\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u60a8\u5e94\u8be5\u9009\u62e9 HDD \u5b58\u50a8\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_8","title":"\u542f\u7528\u6570\u636e\u538b\u7f29","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5c06 \"Data Compression Type\" \u6307\u5b9a\u4e3a \"LZ4\" \u6765\u4e3a\u60a8\u7684\u6587\u4ef6\u7cfb\u7edf\u542f\u7528\u6570\u636e\u538b\u7f29\u3002\u4e00\u65e6\u542f\u7528\uff0c\u6240\u6709\u65b0\u5199\u5165\u7684\u6587\u4ef6\u5728\u5199\u5165\u78c1\u76d8\u4e4b\u524d\u90fd\u5c06\u5728 FSx for Lustre \u4e0a\u81ea\u52a8\u538b\u7f29\uff0c\u8bfb\u53d6\u65f6\u5c06\u89e3\u538b\u7f29\u3002LZ4 \u6570\u636e\u538b\u7f29\u7b97\u6cd5\u662f\u65e0\u635f\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u4ece\u538b\u7f29\u6570\u636e\u5b8c\u5168\u91cd\u6784\u539f\u59cb\u6570\u636e\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728 FSx for lustre \u6587\u4ef6\u7cfb\u7edf\u7684 Kubernetes StorageClass \u7684\u53c2\u6570\u4e2d\u5c06\u6570\u636e\u538b\u7f29\u7c7b\u578b\u914d\u7f6e\u4e3a LZ4\u3002\u5f53\u503c\u8bbe\u7f6e\u4e3a NONE (\u9ed8\u8ba4\u503c) \u65f6\uff0c\u538b\u7f29\u5c06\u88ab\u7981\u7528\u3002\u8fd9\u4e2a\u94fe\u63a5\u63d0\u4f9b\u4e86\u793a\u4f8b\u6a21\u677f\u3002</p> <p>Note</p> <p>Amazon FSx for Lustre \u4e0e\u57fa\u4e8e Window \u7684\u5bb9\u5668\u6620\u50cf\u4e0d\u517c\u5bb9\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#amazon-fsx-for-netapp-ontap","title":"Amazon FSx for NetApp ONTAP","text":"<p>Amazon FSx for NetApp ONTAP \u662f\u4e00\u4e2a\u5b8c\u5168\u6258\u7ba1\u7684\u5171\u4eab\u5b58\u50a8\uff0c\u57fa\u4e8e NetApp \u7684 ONTAP \u6587\u4ef6\u7cfb\u7edf\u6784\u5efa\u3002FSx for ONTAP \u63d0\u4f9b\u529f\u80fd\u4e30\u5bcc\u3001\u5feb\u901f\u4e14\u7075\u6d3b\u7684\u5171\u4eab\u6587\u4ef6\u5b58\u50a8\uff0c\u53ef\u5e7f\u6cdb\u8bbf\u95ee\u8fd0\u884c\u5728 AWS \u6216\u672c\u5730\u7684 Linux\u3001Windows \u548c macOS \u8ba1\u7b97\u5b9e\u4f8b\u3002</p> <p>Amazon FSx for NetApp ONTAP \u652f\u6301\u4e24\u5c42\u5b58\u50a8\uff1a 1/\u4e3b\u5c42 \u548c 2/\u5bb9\u91cf\u6c60\u5c42\u3002</p> <p>\u4e3b\u5c42\u662f\u4e00\u4e2a\u9884\u7f6e\u7684\u9ad8\u6027\u80fd SSD \u5c42\uff0c\u7528\u4e8e\u6d3b\u52a8\u7684\u5ef6\u8fdf\u654f\u611f\u6570\u636e\u3002\u5b8c\u5168\u5f39\u6027\u7684\u5bb9\u91cf\u6c60\u5c42\u9488\u5bf9\u4e0d\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u8fdb\u884c\u4e86\u6210\u672c\u4f18\u5316\uff0c\u968f\u7740\u6570\u636e\u5206\u5c42\u5230\u5b83\u4f1a\u81ea\u52a8\u6269\u5c55\uff0c\u5e76\u63d0\u4f9b\u4e86\u51e0\u4e4e\u65e0\u9650\u7684 PB \u7ea7\u5bb9\u91cf\u3002\u60a8\u53ef\u4ee5\u5728\u5bb9\u91cf\u6c60\u5b58\u50a8\u4e0a\u542f\u7528\u6570\u636e\u538b\u7f29\u548c\u91cd\u590d\u6570\u636e\u5220\u9664\uff0c\u8fdb\u4e00\u6b65\u51cf\u5c11\u6570\u636e\u5360\u7528\u7684\u5b58\u50a8\u5bb9\u91cf\u3002NetApp \u7684\u672c\u5730\u57fa\u4e8e\u7b56\u7565\u7684 FabricPool \u529f\u80fd\u6301\u7eed\u76d1\u63a7\u6570\u636e\u8bbf\u95ee\u6a21\u5f0f\uff0c\u81ea\u52a8\u5728\u5b58\u50a8\u5c42\u4e4b\u95f4\u53cc\u5411\u4f20\u8f93\u6570\u636e\uff0c\u4ee5\u4f18\u5316\u6027\u80fd\u548c\u6210\u672c\u3002</p> <p>NetApp \u7684 Astra Trident \u63d0\u4f9b\u4e86\u52a8\u6001\u5b58\u50a8\u7f16\u6392\uff0c\u4f7f\u7528 CSI \u9a71\u52a8\u7a0b\u5e8f\u5141\u8bb8 Amazon EKS \u96c6\u7fa4\u7ba1\u7406\u7531 Amazon FSx for NetApp ONTAP \u6587\u4ef6\u7cfb\u7edf\u652f\u6301\u7684\u6301\u4e45\u5377 PV \u7684\u751f\u547d\u5468\u671f\u3002\u8981\u5f00\u59cb\u4f7f\u7528\uff0c\u8bf7\u53c2\u9605 Astra Trident \u6587\u6863\u4e2d\u7684\u5c06 Astra Trident \u4e0e Amazon FSx for NetApp ONTAP \u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"zh/cost_optimization/cost_opt_storage/#_9","title":"\u5176\u4ed6\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"zh/cost_optimization/cost_opt_storage/#_10","title":"\u6700\u5c0f\u5316\u5bb9\u5668\u955c\u50cf\u5927\u5c0f","text":"<p>\u4e00\u65e6\u5bb9\u5668\u90e8\u7f72\uff0c\u5bb9\u5668\u955c\u50cf\u5c31\u4f1a\u4f5c\u4e3a\u591a\u4e2a\u5c42\u7f13\u5b58\u5728\u4e3b\u673a\u4e0a\u3002\u901a\u8fc7\u51cf\u5c0f\u955c\u50cf\u5927\u5c0f\uff0c\u53ef\u4ee5\u51cf\u5c11\u4e3b\u673a\u4e0a\u6240\u9700\u7684\u5b58\u50a8\u91cf\u3002</p> <p>\u4ece\u4e00\u5f00\u59cb\u5c31\u4f7f\u7528\u7cbe\u7b80\u7684\u57fa\u7840\u955c\u50cf\uff0c\u5982 scratch \u955c\u50cf\u6216 distroless \u5bb9\u5668\u955c\u50cf(\u53ea\u5305\u542b\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ca\u5176\u8fd0\u884c\u65f6\u4f9d\u8d56\u9879)\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u964d\u4f4e\u5b58\u50a8\u6210\u672c\uff0c\u8fd8\u53ef\u4ee5\u51cf\u5c0f\u653b\u51fb\u9762\u5e76\u7f29\u77ed\u955c\u50cf\u62c9\u53d6\u65f6\u95f4\u3002</p> <p>\u60a8\u8fd8\u5e94\u8be5\u8003\u8651\u4f7f\u7528\u5f00\u6e90\u5de5\u5177\uff0c\u5982 Slim.ai,\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u3001\u5b89\u5168\u7684\u65b9\u5f0f\u6765\u521b\u5efa\u6700\u5c0f\u5316\u955c\u50cf\u3002</p> <p>\u591a\u5c42\u8f6f\u4ef6\u5305\u3001\u5de5\u5177\u3001\u5e94\u7528\u7a0b\u5e8f\u4f9d\u8d56\u9879\u548c\u5e93\u5f88\u5bb9\u6613\u4f7f\u5bb9\u5668\u955c\u50cf\u5927\u5c0f\u81a8\u80c0\u3002\u901a\u8fc7\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u4ece\u4e00\u4e2a\u9636\u6bb5\u590d\u5236\u5de5\u4ef6\u5230\u53e6\u4e00\u4e2a\u9636\u6bb5\uff0c\u4ece\u6700\u7ec8\u955c\u50cf\u4e2d\u6392\u9664\u6240\u6709\u4e0d\u5fc5\u8981\u7684\u5185\u5bb9\u3002\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u67e5\u770b\u66f4\u591a\u955c\u50cf\u6784\u5efa\u6700\u4f73\u5b9e\u8df5\u3002</p> <p>\u53e6\u4e00\u4e2a\u9700\u8981\u8003\u8651\u7684\u662f\u8981\u6301\u4e45\u5316\u7f13\u5b58\u955c\u50cf\u7684\u65f6\u95f4\u957f\u5ea6\u3002\u5f53\u4f7f\u7528\u4e86\u4e00\u5b9a\u91cf\u7684\u78c1\u76d8\u7a7a\u95f4\u65f6\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u4ece\u955c\u50cf\u7f13\u5b58\u4e2d\u6e05\u7406\u9648\u65e7\u7684\u955c\u50cf\u3002\u8fd9\u6837\u505a\u6709\u52a9\u4e8e\u786e\u4fdd\u4e3b\u673a\u64cd\u4f5c\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckubelet \u6bcf\u4e94\u5206\u949f\u5bf9\u672a\u4f7f\u7528\u7684\u955c\u50cf\u6267\u884c\u5783\u573e\u6536\u96c6\uff0c\u6bcf\u5206\u949f\u5bf9\u672a\u4f7f\u7528\u7684\u5bb9\u5668\u6267\u884c\u5783\u573e\u6536\u96c6\u3002</p> <p>\u8981\u914d\u7f6e\u672a\u4f7f\u7528\u5bb9\u5668\u548c\u955c\u50cf\u5783\u573e\u6536\u96c6\u7684\u9009\u9879\uff0c\u8bf7\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u8c03\u6574 kubelet\uff0c\u5e76\u4f7f\u7528 <code>KubeletConfiguration</code> \u8d44\u6e90\u7c7b\u578b\u66f4\u6539\u4e0e\u5783\u573e\u6536\u96c6\u76f8\u5173\u7684\u53c2\u6570\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728 Kubernetes \u6587\u6863\u4e2d\u4e86\u89e3\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u3002</p>"},{"location":"zh/cost_optimization/cost_optimization_index/","title":"\u4e9a\u9a6c\u900a EKS \u6210\u672c\u4f18\u5316\u6700\u4f73\u5b9e\u8df5\u6307\u5357","text":"<p>\u6210\u672c\u4f18\u5316\u662f\u4ee5\u6700\u4f4e\u4ef7\u683c\u5b9e\u73b0\u60a8\u7684\u4e1a\u52a1\u76ee\u6807\u3002\u901a\u8fc7\u9075\u5faa\u672c\u6307\u5357\u4e2d\u7684\u6587\u6863\uff0c\u60a8\u5c06\u4f18\u5316\u60a8\u7684\u4e9a\u9a6c\u900a EKS \u5de5\u4f5c\u8d1f\u8f7d\u3002</p>"},{"location":"zh/cost_optimization/cost_optimization_index/#_1","title":"\u4e00\u822c\u6307\u5bfc\u539f\u5219","text":"<p>\u5728\u4e91\u4e2d\uff0c\u6709\u4e00\u4e9b\u4e00\u822c\u6307\u5bfc\u539f\u5219\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5b9e\u73b0\u5fae\u670d\u52a1\u7684\u6210\u672c\u4f18\u5316\uff1a + \u786e\u4fdd\u5728\u4e9a\u9a6c\u900a EKS \u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u72ec\u7acb\u4e8e\u7528\u4e8e\u8fd0\u884c\u5bb9\u5668\u7684\u7279\u5b9a\u57fa\u7840\u67b6\u6784\u7c7b\u578b\uff0c\u8fd9\u5c06\u4e3a\u5728\u6700\u4fbf\u5b9c\u7684\u57fa\u7840\u67b6\u6784\u7c7b\u578b\u4e0a\u8fd0\u884c\u5b83\u4eec\u63d0\u4f9b\u66f4\u5927\u7684\u7075\u6d3b\u6027\u3002\u867d\u7136\u4f7f\u7528\u4e9a\u9a6c\u900a EKS \u4e0e EC2\uff0c\u4f46\u5f53\u6211\u4eec\u6709\u9700\u8981\u7279\u5b9a\u7c7b\u578b EC2 \u5b9e\u4f8b\u7684\u5de5\u4f5c\u8d1f\u8f7d\u65f6\uff0c\u53ef\u80fd\u4f1a\u6709\u4f8b\u5916\uff0c\u5982\u9700\u8981 GPU \u6216\u5176\u4ed6\u5b9e\u4f8b\u7c7b\u578b\uff0c\u8fd9\u662f\u7531\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6027\u8d28\u6240\u81f4\u3002 + \u9009\u62e9\u6700\u4f73\u914d\u7f6e\u7684\u5bb9\u5668\u5b9e\u4f8b - \u4f7f\u7528\u8bf8\u5982 Amazon CloudWatch Container Insights for Amazon EKS \u6216 Kubernetes \u751f\u6001\u7cfb\u7edf\u4e2d\u53ef\u7528\u7684\u7b2c\u4e09\u65b9\u5de5\u5177\u7b49\u670d\u52a1\uff0c\u5bf9\u751f\u4ea7\u6216\u9884\u751f\u4ea7\u73af\u5883\u8fdb\u884c\u5206\u6790\u5e76\u76d1\u63a7\u5173\u952e\u6307\u6807\uff0c\u5982 CPU \u548c\u5185\u5b58\u3002\u8fd9\u5c06\u786e\u4fdd\u6211\u4eec\u53ef\u4ee5\u5206\u914d\u9002\u5f53\u7684\u8d44\u6e90\u5e76\u907f\u514d\u8d44\u6e90\u6d6a\u8d39\u3002 + \u5229\u7528 AWS \u4e2d\u53ef\u7528\u4e8e\u5728 EC2 \u4e0a\u8fd0\u884c EKS \u7684\u4e0d\u540c\u8d2d\u4e70\u9009\u9879\uff0c\u4f8b\u5982\u6309\u9700\u3001\u73b0\u8d27\u548c\u8282\u7701\u8ba1\u5212\u3002</p>"},{"location":"zh/cost_optimization/cost_optimization_index/#eks_1","title":"EKS \u6210\u672c\u4f18\u5316\u6700\u4f73\u5b9e\u8df5","text":"<p>\u5728\u4e91\u4e2d\u8fdb\u884c\u6210\u672c\u4f18\u5316\u6709\u4e09\u4e2a\u4e00\u822c\u6700\u4f73\u5b9e\u8df5\u9886\u57df\uff1a</p> <ul> <li>\u7ecf\u6d4e\u9ad8\u6548\u7684\u8d44\u6e90(\u81ea\u52a8\u7f29\u653e\u3001\u7f29\u51cf\u3001\u7b56\u7565\u548c\u8d2d\u4e70\u9009\u9879)</li> <li>\u652f\u51fa\u610f\u8bc6(\u4f7f\u7528 AWS \u548c\u7b2c\u4e09\u65b9\u5de5\u5177)</li> <li>\u968f\u65f6\u95f4\u4f18\u5316(\u6b63\u786e\u8c03\u6574\u5927\u5c0f)</li> </ul> <p>\u4e0e\u4efb\u4f55\u6307\u5bfc\u4e00\u6837\uff0c\u90fd\u5b58\u5728\u6743\u8861\u53d6\u820d\u3002\u8bf7\u4e0e\u60a8\u7684\u7ec4\u7ec7\u5408\u4f5c\uff0c\u4e86\u89e3\u6b64\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4f18\u5148\u7ea7\u4ee5\u53ca\u54ea\u4e9b\u6700\u4f73\u5b9e\u8df5\u6700\u4e3a\u91cd\u8981\u3002</p>"},{"location":"zh/cost_optimization/cost_optimization_index/#_2","title":"\u5982\u4f55\u4f7f\u7528\u672c\u6307\u5357","text":"<p>\u672c\u6307\u5357\u9762\u5411\u8d1f\u8d23\u5b9e\u65bd\u548c\u7ba1\u7406 EKS \u96c6\u7fa4\u53ca\u5176\u652f\u6301\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684 devops \u56e2\u961f\u3002\u672c\u6307\u5357\u6309\u4e0d\u540c\u7684\u6700\u4f73\u5b9e\u8df5\u9886\u57df\u7ec4\u7ec7\uff0c\u4ee5\u4fbf\u4e8e\u4f7f\u7528\u3002\u6bcf\u4e2a\u4e3b\u9898\u90fd\u5217\u51fa\u4e86\u5efa\u8bae\u3001\u5de5\u5177\u548c\u4f18\u5316 EKS \u96c6\u7fa4\u6210\u672c\u7684\u6700\u4f73\u5b9e\u8df5\u3002\u4e3b\u9898\u4e0d\u9700\u6309\u7279\u5b9a\u987a\u5e8f\u9605\u8bfb\u3002</p>"},{"location":"zh/cost_optimization/cost_optimization_index/#aws-kubernetes","title":"\u5173\u952e AWS \u670d\u52a1\u548c Kubernetes \u529f\u80fd","text":"<p>\u6210\u672c\u4f18\u5316\u7531\u4ee5\u4e0b AWS \u670d\u52a1\u548c\u529f\u80fd\u652f\u6301\uff1a + \u5177\u6709\u4e0d\u540c\u4ef7\u683c\u7684 EC2 \u5b9e\u4f8b\u7c7b\u578b\u3001\u8282\u7701\u8ba1\u5212(\u4ee5\u524d\u7684\u9884\u7559\u5b9e\u4f8b)\u548c\u73b0\u8d27\u5b9e\u4f8b\u3002 + \u81ea\u52a8\u7f29\u653e\u4ee5\u53ca Kubernetes \u539f\u751f\u81ea\u52a8\u7f29\u653e\u7b56\u7565\u3002\u5bf9\u4e8e\u53ef\u9884\u6d4b\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u8bf7\u8003\u8651\u8282\u7701\u8ba1\u5212(\u4ee5\u524d\u7684\u9884\u7559\u5b9e\u4f8b)\u3002\u4f7f\u7528\u6258\u7ba1\u6570\u636e\u5b58\u50a8(\u5982 EBS \u548c EFS)\uff0c\u4ee5\u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u6570\u636e\u7684\u5f39\u6027\u548c\u6301\u4e45\u6027\u3002 + \u8ba1\u8d39\u548c\u6210\u672c\u7ba1\u7406\u63a7\u5236\u53f0\u4eea\u8868\u677f\u4ee5\u53ca AWS \u6210\u672c\u8d44\u6e90\u7ba1\u7406\u5668\u63d0\u4f9b\u4e86\u60a8\u7684 AWS \u4f7f\u7528\u60c5\u51b5\u6982\u89c8\u3002\u4f7f\u7528 AWS Organizations \u83b7\u53d6\u8be6\u7ec6\u7684\u8ba1\u8d39\u660e\u7ec6\u3002\u8fd8\u5206\u4eab\u4e86\u4e00\u4e9b\u7b2c\u4e09\u65b9\u5de5\u5177\u7684\u8be6\u7ec6\u4fe1\u606f\u3002 + Amazon CloudWatch Container Metrics \u63d0\u4f9b\u4e86\u6709\u5173 EKS \u96c6\u7fa4\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7684\u6307\u6807\u3002\u9664\u4e86 Kubernetes \u4eea\u8868\u677f\u5916\uff0cKubernetes \u751f\u6001\u7cfb\u7edf\u4e2d\u8fd8\u6709\u4e00\u4e9b\u5de5\u5177\u53ef\u7528\u4e8e\u51cf\u5c11\u6d6a\u8d39\u3002</p> <p>\u672c\u6307\u5357\u5305\u542b\u4e86\u4e00\u7ec4\u5efa\u8bae\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u5efa\u8bae\u6765\u6539\u5584\u60a8\u7684\u4e9a\u9a6c\u900a EKS \u96c6\u7fa4\u7684\u6210\u672c\u4f18\u5316\u3002</p>"},{"location":"zh/cost_optimization/cost_optimization_index/#_3","title":"\u53cd\u9988","text":"<p>\u672c\u6307\u5357\u5728 GitHub \u4e0a\u53d1\u5e03\uff0c\u4ee5\u4fbf\u4ece\u66f4\u5e7f\u6cdb\u7684 EKS/Kubernetes \u793e\u533a\u6536\u96c6\u76f4\u63a5\u53cd\u9988\u548c\u5efa\u8bae\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u8ba4\u4e3a\u5e94\u8be5\u5305\u542b\u5728\u672c\u6307\u5357\u4e2d\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u8bf7\u5728 GitHub \u5b58\u50a8\u5e93\u4e2d\u63d0\u51fa\u95ee\u9898\u6216\u63d0\u4ea4 PR\u3002\u6211\u4eec\u7684\u76ee\u7684\u662f\u5728\u670d\u52a1\u6dfb\u52a0\u65b0\u529f\u80fd\u6216\u51fa\u73b0\u65b0\u7684\u6700\u4f73\u5b9e\u8df5\u65f6\uff0c\u5b9a\u671f\u66f4\u65b0\u672c\u6307\u5357\u3002</p>"},{"location":"zh/cost_optimization/optimizing/","title":"\u968f\u65f6\u95f4\u4f18\u5316 (\u5408\u7406\u8c03\u6574\u89c4\u6a21)","text":"<p>\u6839\u636e AWS \u67b6\u6784\u4f18\u5316\u767d\u76ae\u4e66\uff0c\u5408\u7406\u8c03\u6574\u89c4\u6a21\u662f\"...\u4f7f\u7528\u6ee1\u8db3\u7279\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u6280\u672f\u89c4\u8303\u7684\u6700\u4f4e\u6210\u672c\u8d44\u6e90\"\u3002</p> <p>\u5f53\u60a8\u4e3a Pod \u4e2d\u7684\u5bb9\u5668\u6307\u5b9a\u8d44\u6e90 <code>requests</code> \u65f6\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u4f1a\u4f7f\u7528\u6b64\u4fe1\u606f\u6765\u51b3\u5b9a\u5c06 Pod \u653e\u7f6e\u5728\u54ea\u4e2a\u8282\u70b9\u4e0a\u3002\u5f53\u60a8\u4e3a\u5bb9\u5668\u6307\u5b9a\u8d44\u6e90 <code>limits</code> \u65f6\uff0ckubelet \u4f1a\u5f3a\u5236\u6267\u884c\u8fd9\u4e9b\u9650\u5236\uff0c\u4ee5\u4fbf\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\u4e0d\u88ab\u5141\u8bb8\u4f7f\u7528\u8d85\u8fc7\u60a8\u8bbe\u7f6e\u7684\u8be5\u8d44\u6e90\u7684\u9650\u5236\u3002Kubernetes \u5982\u4f55\u7ba1\u7406\u5bb9\u5668\u8d44\u6e90\u7684\u8be6\u7ec6\u4fe1\u606f\u5728 \u6587\u6863 \u4e2d\u7ed9\u51fa\u3002</p> <p>\u5728 Kubernetes \u4e2d\uff0c\u8fd9\u610f\u5473\u7740\u8bbe\u7f6e\u6b63\u786e\u7684\u8ba1\u7b97\u8d44\u6e90 (CPU \u548c\u5185\u5b58\u7edf\u79f0\u4e3a\u8ba1\u7b97\u8d44\u6e90) - \u8bbe\u7f6e\u4e0e\u5b9e\u9645\u5229\u7528\u7387\u5c3d\u53ef\u80fd\u63a5\u8fd1\u7684\u8d44\u6e90 <code>requests</code>\u3002\u83b7\u53d6 Pod \u5b9e\u9645\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7684\u5de5\u5177\u5728\u4e0b\u9762\u7684\u5efa\u8bae\u90e8\u5206\u7ed9\u51fa\u3002</p> <p>AWS Fargate \u4e0a\u7684 Amazon EKS:\u5f53 Pod \u5728 Fargate \u4e0a\u8c03\u5ea6\u65f6\uff0cPod \u89c4\u8303\u4e2d\u7684 vCPU \u548c\u5185\u5b58\u9884\u7559\u51b3\u5b9a\u4e3a Pod \u9884\u7559\u591a\u5c11 CPU \u548c\u5185\u5b58\u3002\u5982\u679c\u60a8\u4e0d\u6307\u5b9a vCPU \u548c\u5185\u5b58\u7ec4\u5408\uff0c\u5219\u4f7f\u7528\u6700\u5c0f\u53ef\u7528\u7ec4\u5408 (0.25 vCPU \u548c 0.5 GB \u5185\u5b58)\u3002\u5728 Fargate \u4e0a\u8fd0\u884c\u7684 Pod \u53ef\u7528\u7684 vCPU \u548c\u5185\u5b58\u7ec4\u5408\u5217\u8868\u5728 Amazon EKS \u7528\u6237\u6307\u5357 \u4e2d\u5217\u51fa\u3002</p> <p>EC2 \u4e0a\u7684 Amazon EKS:\u5f53\u60a8\u521b\u5efa Pod \u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u5bb9\u5668\u9700\u8981\u591a\u5c11 CPU \u548c\u5185\u5b58\u7b49\u8d44\u6e90\u3002\u6211\u4eec\u4e0d\u80fd\u8fc7\u5ea6\u914d\u7f6e (\u4f1a\u5bfc\u81f4\u6d6a\u8d39) \u6216\u8005\u6b20\u914d\u7f6e (\u4f1a\u5bfc\u81f4\u8282\u6d41) \u5206\u914d\u7ed9\u5bb9\u5668\u7684\u8d44\u6e90\u662f\u5f88\u91cd\u8981\u7684\u3002</p>"},{"location":"zh/cost_optimization/optimizing/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/cost_optimization/optimizing/#_3","title":"\u4f7f\u7528\u5de5\u5177\u5e2e\u52a9\u60a8\u6839\u636e\u89c2\u5bdf\u5230\u7684\u6570\u636e\u5206\u914d\u8d44\u6e90","text":"<p>\u6709\u4e00\u4e9b\u5de5\u5177\uff0c\u5982 kube resource report\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5408\u7406\u8c03\u6574\u90e8\u7f72\u5728 Amazon EKS EC2 \u8282\u70b9\u4e0a\u7684 Pod \u7684\u89c4\u6a21\u3002</p> <p>kube resource report \u7684\u90e8\u7f72\u6b65\u9aa4\uff1a <pre><code>$ git clone https://github.com/hjacobs/kube-resource-report\n$ cd kube-resource-report\n$ helm install kube-resource-report ./unsupported/chart/kube-resource-report\n$ helm status kube-resource-report\n$ export POD_NAME=$(kubectl get pods --namespace default -l \"app.kubernetes.io/name=kube-resource-report,app.kubernetes.io/instance=kube-resource-report\" -o jsonpath=\"{.items[0].metadata.name}\")\n$ echo \"\u8bbf\u95ee http://127.0.0.1:8080 \u4ee5\u4f7f\u7528\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\"\n$ kubectl port-forward $POD_NAME 8080:8080\n</code></pre> \u6765\u81ea\u8be5\u5de5\u5177\u7684\u793a\u4f8b\u62a5\u544a\u7684\u5c4f\u5e55\u622a\u56fe\uff1a</p> <p></p> <p></p> <p></p> <p>FairwindsOps Goldilocks: FairwindsOps Goldilocks \u662f\u4e00\u4e2a\u4e3a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6bcf\u4e2a\u90e8\u7f72\u521b\u5efa\u5782\u76f4 Pod \u81ea\u52a8\u7f29\u653e\u5668 (VPA) \u5e76\u67e5\u8be2\u5b83\u4eec\u4ee5\u83b7\u53d6\u4fe1\u606f\u7684\u5de5\u5177\u3002\u4e00\u65e6 VPA \u5c31\u7eea\uff0c\u6211\u4eec\u5c31\u4f1a\u5728 Goldilocks \u4eea\u8868\u677f\u4e0a\u770b\u5230\u5efa\u8bae\u3002</p> <p>\u6839\u636e \u6587\u6863 \u90e8\u7f72\u5782\u76f4 Pod \u81ea\u52a8\u7f29\u653e\u5668\u3002</p> <p>\u542f\u7528\u547d\u540d\u7a7a\u95f4 - \u9009\u62e9\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u547d\u540d\u7a7a\u95f4\u5e76\u5bf9\u5176\u8fdb\u884c\u6807\u8bb0\uff0c\u4ee5\u4fbf\u67e5\u770b\u4e00\u4e9b\u6570\u636e\uff0c\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u6307\u5b9a\u4e86\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4\uff1a</p> <pre><code>$ kubectl label ns default goldilocks.fairwinds.com/enabled=true\n</code></pre> <p>\u67e5\u770b\u4eea\u8868\u677f - \u9ed8\u8ba4\u5b89\u88c5\u4e3a\u4eea\u8868\u677f\u521b\u5efa\u4e86\u4e00\u4e2a ClusterIP \u670d\u52a1\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u7aef\u53e3\u8f6c\u53d1\u8bbf\u95ee\uff1a</p> <pre><code>$ kubectl -n goldilocks port-forward svc/goldilocks-dashboard 8080:80\n</code></pre> <p>\u7136\u540e\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00 http://localhost:8080</p> <p></p>"},{"location":"zh/cost_optimization/optimizing/#amazon-cloudwatch-cloudwatch-container-insights-prometheus","title":"\u4f7f\u7528 Amazon CloudWatch \u4e2d\u7684 CloudWatch Container Insights \u548c Prometheus \u6307\u6807\u7b49\u5e94\u7528\u7a0b\u5e8f\u5206\u6790\u5de5\u5177","text":"<p>\u4f7f\u7528 CloudWatch Container Insights \u6765\u67e5\u770b\u5982\u4f55\u4f7f\u7528\u539f\u751f CloudWatch \u529f\u80fd\u6765\u76d1\u63a7\u60a8\u7684 EKS \u96c6\u7fa4\u6027\u80fd\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 CloudWatch Container Insights \u6765\u6536\u96c6\u3001\u805a\u5408\u548c\u6c47\u603b\u8fd0\u884c\u5728 Amazon Elastic Kubernetes Service \u4e0a\u7684\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u548c\u5fae\u670d\u52a1\u7684\u6307\u6807\u548c\u65e5\u5fd7\u3002\u8fd9\u4e9b\u6307\u6807\u5305\u62ec CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u548c\u7f51\u7edc\u7b49\u8d44\u6e90\u7684\u5229\u7528\u7387\uff0c\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u5408\u7406\u8c03\u6574 Pod \u7684\u89c4\u6a21\u5e76\u8282\u7701\u6210\u672c\u3002</p> <p>Container Insights Prometheus \u6307\u6807\u76d1\u63a7 \u76ee\u524d\uff0c\u5bf9 Prometheus \u6307\u6807\u7684\u652f\u6301\u4ecd\u5904\u4e8e\u6d4b\u8bd5\u9636\u6bb5\u3002CloudWatch Container Insights \u76d1\u63a7\u81ea\u52a8\u53d1\u73b0\u6765\u81ea\u5bb9\u5668\u5316\u7cfb\u7edf\u548c\u5de5\u4f5c\u8d1f\u8f7d\u7684 Prometheus \u6307\u6807\u3002Prometheus \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u7cfb\u7edf\u76d1\u63a7\u548c\u8b66\u62a5\u5de5\u5177\u5305\u3002\u6240\u6709 Prometheus \u6307\u6807\u90fd\u6536\u96c6\u5728 ContainerInsights/Prometheus \u547d\u540d\u7a7a\u95f4\u4e2d\u3002</p> <p>cAdvisor \u548c kube-state-metrics \u63d0\u4f9b\u7684\u6307\u6807\u53ef\u7528\u4e8e\u4f7f\u7528 Prometheus \u548c Grafana \u76d1\u63a7\u5728 AWS Fargate \u4e0a\u7684 Amazon EKS Pod\uff0c\u7136\u540e\u53ef\u7528\u4e8e\u5728\u60a8\u7684\u5bb9\u5668\u4e2d\u5b9e\u73b0 requests\u3002\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u9605 \u6b64\u535a\u5ba2\u3002</p> <p>Right Size Guide: right size guide (rsg) \u662f\u4e00\u4e2a\u7b80\u5355\u7684 CLI \u5de5\u5177\uff0c\u4e3a\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5185\u5b58\u548c CPU \u5efa\u8bae\u3002\u8be5\u5de5\u5177\u53ef\u8de8\u5bb9\u5668\u7f16\u6392\u5668\u5de5\u4f5c\uff0c\u5305\u62ec Kubernetes\uff0c\u5e76\u4e14\u6613\u4e8e\u90e8\u7f72\u3002</p> <p>\u901a\u8fc7\u4f7f\u7528 CloudWatch Container Insights\u3001Kube Resource Report\u3001Goldilocks \u548c\u5176\u4ed6\u5de5\u5177\uff0c\u53ef\u4ee5\u5408\u7406\u8c03\u6574\u8fd0\u884c\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u89c4\u6a21\uff0c\u4ece\u800c\u53ef\u80fd\u964d\u4f4e\u6210\u672c\u3002</p>"},{"location":"zh/cost_optimization/optimizing/#_4","title":"\u8d44\u6e90","text":"<p>\u53c2\u8003\u4ee5\u4e0b\u8d44\u6e90\uff0c\u4e86\u89e3\u6709\u5173\u6210\u672c\u4f18\u5316\u6700\u4f73\u5b9e\u8df5\u7684\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"zh/cost_optimization/optimizing/#_5","title":"\u6587\u6863\u548c\u535a\u5ba2","text":"<ul> <li>Amazon EKS \u7814\u8ba8\u4f1a - \u8bbe\u7f6e EKS CloudWatch Container Insights</li> <li>\u5728 Amazon CloudWatch \u4e2d\u4f7f\u7528 Prometheus \u6307\u6807</li> <li>\u4f7f\u7528 Prometheus \u548c Grafana \u76d1\u63a7\u5728 AWS Fargate \u4e0a\u7684 Amazon EKS</li> </ul>"},{"location":"zh/cost_optimization/optimizing/#_6","title":"\u5de5\u5177","text":"<ul> <li>Kube resource report</li> <li>Right size guide</li> <li>Fargate count</li> <li>FairwindsOps Goldilocks</li> <li>Choose Right Node Size</li> </ul>"},{"location":"zh/karpenter/","title":"Karpenter \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"zh/karpenter/#karpenter_1","title":"Karpenter","text":"<p>Karpenter \u662f\u4e00\u79cd\u5f00\u6e90\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\uff0c\u53ef\u81ea\u52a8\u4e3a\u65e0\u6cd5\u8c03\u5ea6\u7684 Pod \u9884\u914d\u65b0\u8282\u70b9\u3002Karpenter \u4f1a\u8bc4\u4f30\u5f85\u5904\u7406 Pod \u7684\u603b\u4f53\u8d44\u6e90\u9700\u6c42\uff0c\u5e76\u9009\u62e9\u6700\u4f73\u5b9e\u4f8b\u7c7b\u578b\u6765\u8fd0\u884c\u5b83\u4eec\u3002\u5b83\u8fd8\u4f1a\u81ea\u52a8\u7f29\u51cf\u6216\u7ec8\u6b62\u6ca1\u6709\u4efb\u4f55\u975e daemonset Pod \u7684\u5b9e\u4f8b\u4ee5\u51cf\u5c11\u6d6a\u8d39\u3002\u5b83\u8fd8\u652f\u6301\u4e00\u4e2a\u6574\u5408\u529f\u80fd\uff0c\u53ef\u4e3b\u52a8\u79fb\u52a8 Pod\uff0c\u5e76\u5220\u9664\u6216\u66ff\u6362\u4e3a\u66f4\u4fbf\u5b9c\u7684\u7248\u672c\u4ee5\u964d\u4f4e\u96c6\u7fa4\u6210\u672c\u3002</p> <p>\u4f7f\u7528 Karpenter \u7684\u539f\u56e0</p> <p>\u5728 Karpenter \u63a8\u51fa\u4e4b\u524d\uff0cKubernetes \u7528\u6237\u4e3b\u8981\u4f9d\u8d56\u4e8e Amazon EC2 Auto Scaling \u7ec4 \u548c Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668 (CAS) \u6765\u52a8\u6001\u8c03\u6574\u96c6\u7fa4\u7684\u8ba1\u7b97\u80fd\u529b\u3002\u4f7f\u7528 Karpenter\uff0c\u60a8\u4e0d\u9700\u8981\u521b\u5efa\u6570\u5341\u4e2a\u8282\u70b9\u7ec4\u5c31\u53ef\u4ee5\u83b7\u5f97\u4e0e Karpenter \u4e00\u6837\u7684\u7075\u6d3b\u6027\u548c\u591a\u6837\u6027\u3002\u6b64\u5916\uff0cKarpenter \u4e0e Kubernetes \u7248\u672c\u7684\u8026\u5408\u6027\u4e0d\u50cf CAS \u90a3\u6837\u7d27\u5bc6\uff0c\u4e5f\u4e0d\u9700\u8981\u60a8\u5728 AWS \u548c Kubernetes API \u4e4b\u95f4\u6765\u56de\u5207\u6362\u3002</p> <p>Karpenter \u5c06\u5b9e\u4f8b\u7f16\u6392\u804c\u8d23\u5408\u5e76\u5230\u4e00\u4e2a\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u66f4\u7b80\u5355\u3001\u66f4\u7a33\u5b9a\u4e14\u5bf9\u96c6\u7fa4\u6709\u610f\u8bc6\u3002Karpenter \u65e8\u5728\u901a\u8fc7\u63d0\u4f9b\u7b80\u5316\u7684\u65b9\u5f0f\u6765\u514b\u670d\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5e26\u6765\u7684\u4e00\u4e9b\u6311\u6218\uff1a</p> <ul> <li>\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u9884\u914d\u8282\u70b9\u3002</li> <li>\u4f7f\u7528\u7075\u6d3b\u7684 NodePool \u9009\u9879\u901a\u8fc7\u5b9e\u4f8b\u7c7b\u578b\u521b\u5efa\u4e0d\u540c\u7684\u8282\u70b9\u914d\u7f6e\u3002\u4e0e\u7ba1\u7406\u8bb8\u591a\u7279\u5b9a\u7684\u81ea\u5b9a\u4e49\u8282\u70b9\u7ec4\u4e0d\u540c\uff0cKarpenter \u53ef\u8ba9\u60a8\u4f7f\u7528\u5355\u4e2a\u7075\u6d3b\u7684 NodePool \u7ba1\u7406\u4e0d\u540c\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5bb9\u91cf\u3002</li> <li>\u901a\u8fc7\u5feb\u901f\u542f\u52a8\u8282\u70b9\u548c\u8c03\u5ea6 Pod \u6765\u5b9e\u73b0\u5927\u89c4\u6a21 Pod \u8c03\u5ea6\u7684\u6539\u8fdb\u3002</li> </ul> <p>\u6709\u5173\u4f7f\u7528 Karpenter \u7684\u4fe1\u606f\u548c\u6587\u6863\uff0c\u8bf7\u8bbf\u95ee karpenter.sh \u7f51\u7ad9\u3002</p>"},{"location":"zh/karpenter/#_1","title":"\u5efa\u8bae","text":"<p>\u6700\u4f73\u5b9e\u8df5\u5206\u4e3a\u5173\u4e8e Karpenter \u672c\u8eab\u3001NodePool \u548c Pod \u8c03\u5ea6\u7684\u51e0\u4e2a\u90e8\u5206\u3002</p>"},{"location":"zh/karpenter/#karpenter_2","title":"Karpenter \u6700\u4f73\u5b9e\u8df5","text":"<p>\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\u6db5\u76d6\u4e86\u4e0e Karpenter \u672c\u8eab\u76f8\u5173\u7684\u4e3b\u9898\u3002</p>"},{"location":"zh/karpenter/#karpenter_3","title":"\u5bf9\u4e8e\u5bb9\u91cf\u9700\u6c42\u4e0d\u65ad\u53d8\u5316\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528 Karpenter","text":"<p>\u4e0e Auto Scaling \u7ec4 (ASG) \u548c Managed Node \u7ec4 (MNG) \u76f8\u6bd4\uff0cKarpenter \u5c06\u6269\u7f29\u7ba1\u7406\u66f4\u63a5\u8fd1 Kubernetes \u539f\u751f API\u3002ASG \u548c MNG \u662f AWS \u539f\u751f\u62bd\u8c61\uff0c\u5176\u4e2d\u6269\u7f29\u662f\u57fa\u4e8e AWS \u7ea7\u522b\u7684\u6307\u6807(\u5982 EC2 CPU \u8d1f\u8f7d)\u89e6\u53d1\u7684\u3002\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668 \u5c06 Kubernetes \u62bd\u8c61\u6865\u63a5\u5230 AWS \u62bd\u8c61\uff0c\u4f46\u7531\u4e8e\u8fd9\u79cd\u65b9\u5f0f\u5931\u53bb\u4e86\u4e00\u4e9b\u7075\u6d3b\u6027\uff0c\u4f8b\u5982\u4e3a\u7279\u5b9a\u53ef\u7528\u533a\u57df\u8c03\u5ea6\u3002</p> <p>Karpenter \u6d88\u9664\u4e86\u4e00\u5c42 AWS \u62bd\u8c61\uff0c\u5c06\u4e00\u4e9b\u7075\u6d3b\u6027\u76f4\u63a5\u5f15\u5165 Kubernetes\u3002Karpenter \u6700\u9002\u5408\u7528\u4e8e\u9047\u5230\u9ad8\u5cf0\u671f\u6216\u5177\u6709\u4e0d\u540c\u8ba1\u7b97\u9700\u6c42\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u96c6\u7fa4\u3002MNG \u548c ASG \u66f4\u9002\u5408\u8fd0\u884c\u5de5\u4f5c\u8d1f\u8f7d\u76f8\u5bf9\u9759\u6001\u548c\u4e00\u81f4\u7684\u96c6\u7fa4\u3002\u6839\u636e\u60a8\u7684\u9700\u6c42\uff0c\u60a8\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528\u52a8\u6001\u548c\u9759\u6001\u7ba1\u7406\u7684\u8282\u70b9\u3002</p>"},{"location":"zh/karpenter/#_2","title":"\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u8003\u8651\u5176\u4ed6\u81ea\u52a8\u6269\u7f29\u9879\u76ee...","text":"<p>\u5982\u679c\u60a8\u9700\u8981 Karpenter \u4ecd\u5728\u5f00\u53d1\u7684\u529f\u80fd\u3002\u7531\u4e8e Karpenter \u662f\u4e00\u4e2a\u76f8\u5bf9\u8f83\u65b0\u7684\u9879\u76ee\uff0c\u5982\u679c\u60a8\u6682\u65f6\u9700\u8981 Karpenter \u5c1a\u672a\u5305\u542b\u7684\u529f\u80fd\uff0c\u8bf7\u8003\u8651\u4f7f\u7528\u5176\u4ed6\u81ea\u52a8\u6269\u7f29\u9879\u76ee\u3002</p>"},{"location":"zh/karpenter/#eks-fargate-karpenter","title":"\u5728 EKS Fargate \u4e0a\u6216\u5c5e\u4e8e\u8282\u70b9\u7ec4\u7684\u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c Karpenter \u63a7\u5236\u5668","text":"<p>Karpenter \u4f7f\u7528 Helm \u56fe\u8868 \u8fdb\u884c\u5b89\u88c5\u3002Helm \u56fe\u8868\u4f1a\u5b89\u88c5 Karpenter \u63a7\u5236\u5668\u548c\u4e00\u4e2a Webhook Pod \u4f5c\u4e3a Deployment\uff0c\u5728\u4f7f\u7528 Karpenter \u8fdb\u884c\u96c6\u7fa4\u6269\u7f29\u4e4b\u524d\uff0c\u8fd9\u4e9b Pod \u9700\u8981\u8fd0\u884c\u3002\u6211\u4eec\u5efa\u8bae\u81f3\u5c11\u6709\u4e00\u4e2a\u5c0f\u578b\u8282\u70b9\u7ec4\uff0c\u5176\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u5de5\u4f5c\u8282\u70b9\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e3a <code>karpenter</code> \u547d\u540d\u7a7a\u95f4\u521b\u5efa Fargate \u914d\u7f6e\u6587\u4ef6\uff0c\u5728 EKS Fargate \u4e0a\u8fd0\u884c\u8fd9\u4e9b Pod\u3002\u8fd9\u6837\u505a\u4f1a\u5bfc\u81f4\u90e8\u7f72\u5230\u6b64\u547d\u540d\u7a7a\u95f4\u7684\u6240\u6709 Pod \u90fd\u5728 EKS Fargate \u4e0a\u8fd0\u884c\u3002\u4e0d\u8981\u5728 Karpenter \u7ba1\u7406\u7684\u8282\u70b9\u4e0a\u8fd0\u884c Karpenter\u3002</p>"},{"location":"zh/karpenter/#karpenter_4","title":"\u907f\u514d\u4f7f\u7528\u81ea\u5b9a\u4e49\u542f\u52a8\u6a21\u677f\u4e0e Karpenter","text":"<p>Karpenter \u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u542f\u52a8\u6a21\u677f\u3002\u4f7f\u7528\u81ea\u5b9a\u4e49\u542f\u52a8\u6a21\u677f\u4f1a\u963b\u6b62\u591a\u67b6\u6784\u652f\u6301\u3001\u81ea\u52a8\u5347\u7ea7\u8282\u70b9\u7684\u80fd\u529b\u4ee5\u53ca securityGroup \u53d1\u73b0\u3002\u4f7f\u7528\u542f\u52a8\u6a21\u677f\u4e5f\u53ef\u80fd\u5bfc\u81f4\u6df7\u6dc6\uff0c\u56e0\u4e3a\u67d0\u4e9b\u5b57\u6bb5\u5728 Karpenter \u7684 NodePool \u4e2d\u662f\u91cd\u590d\u7684\uff0c\u800c\u5176\u4ed6\u5b57\u6bb5(\u5982\u5b50\u7f51\u548c\u5b9e\u4f8b\u7c7b\u578b)\u5219\u88ab Karpenter \u5ffd\u7565\u3002</p> <p>\u60a8\u901a\u5e38\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u81ea\u5b9a\u4e49\u7528\u6237\u6570\u636e\u548c/\u6216\u76f4\u63a5\u5728 AWS \u8282\u70b9\u6a21\u677f\u4e2d\u6307\u5b9a\u81ea\u5b9a\u4e49 AMI \u6765\u907f\u514d\u4f7f\u7528\u542f\u52a8\u6a21\u677f\u3002\u6709\u5173\u5982\u4f55\u6267\u884c\u6b64\u64cd\u4f5c\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 NodeClasses\u3002</p>"},{"location":"zh/karpenter/#_3","title":"\u6392\u9664\u4e0d\u9002\u5408\u60a8\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5b9e\u4f8b\u7c7b\u578b","text":"<p>\u5982\u679c\u60a8\u7684\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4e0d\u9700\u8981\u67d0\u4e9b\u5b9e\u4f8b\u7c7b\u578b\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 node.kubernetes.io/instance-type \u952e\u6392\u9664\u8fd9\u4e9b\u7279\u5b9a\u5b9e\u4f8b\u7c7b\u578b\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u4e86\u5982\u4f55\u907f\u514d\u9884\u914d\u5927\u578b Graviton \u5b9e\u4f8b\u3002</p> <pre><code>- key: node.kubernetes.io/instance-type\n  operator: NotIn\n  values:\n  - m6g.16xlarge\n  - m6gd.16xlarge\n  - r6g.16xlarge\n  - r6gd.16xlarge\n  - c6g.16xlarge\n</code></pre>"},{"location":"zh/karpenter/#spot","title":"\u542f\u7528\u4e2d\u65ad\u5904\u7406\u65f6\u4f7f\u7528 Spot","text":"<p>Karpenter \u652f\u6301\u901a\u8fc7 <code>--interruption-queue-name</code> CLI \u53c2\u6570\u548c SQS \u961f\u5217\u540d\u79f0\u542f\u7528\u539f\u751f\u4e2d\u65ad\u5904\u7406\u3002\u4e2d\u65ad\u5904\u7406\u4f1a\u76d1\u89c6\u5373\u5c06\u53d1\u751f\u7684\u53ef\u80fd\u5bfc\u81f4\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u65ad\u7684\u975e\u81ea\u613f\u4e2d\u65ad\u4e8b\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>Spot \u4e2d\u65ad\u8b66\u544a</li> <li>\u8ba1\u5212\u66f4\u6539\u8fd0\u884c\u72b6\u51b5\u4e8b\u4ef6(\u7ef4\u62a4\u4e8b\u4ef6)</li> <li>\u5b9e\u4f8b\u7ec8\u6b62\u4e8b\u4ef6</li> <li>\u5b9e\u4f8b\u505c\u6b62\u4e8b\u4ef6</li> </ul> <p>\u5f53 Karpenter \u68c0\u6d4b\u5230\u8fd9\u4e9b\u4e8b\u4ef6\u5c06\u53d1\u751f\u5728\u60a8\u7684\u8282\u70b9\u4e0a\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u5c01\u9501\u3001\u6392\u7a7a\u548c\u7ec8\u6b62\u8282\u70b9\uff0c\u4ee5\u5728\u4e2d\u65ad\u4e8b\u4ef6\u53d1\u751f\u524d\u63d0\u4f9b\u6700\u5927\u7684\u65f6\u95f4\u8fdb\u884c\u5de5\u4f5c\u8d1f\u8f7d\u6e05\u7406\u3002\u4e0d\u5efa\u8bae\u4e0e Karpenter \u4e00\u8d77\u4f7f\u7528 AWS Node Termination Handler\uff0c\u539f\u56e0\u5982\u6b64\u5904\u6240\u8ff0\u3002</p> <p>\u9700\u8981\u68c0\u67e5\u70b9\u6216\u5176\u4ed6\u5f62\u5f0f\u7684\u6b63\u5e38\u6392\u7a7a\u7684 Pod\uff0c\u5728\u5173\u95ed\u524d\u9700\u8981 2 \u5206\u949f\uff0c\u5e94\u5728\u5176\u96c6\u7fa4\u4e2d\u542f\u7528 Karpenter \u4e2d\u65ad\u5904\u7406\u3002</p>"},{"location":"zh/karpenter/#amazon-eks","title":"\u6ca1\u6709\u51fa\u7ad9\u4e92\u8054\u7f51\u8bbf\u95ee\u7684 Amazon EKS \u79c1\u6709\u96c6\u7fa4","text":"<p>\u5f53\u5728\u6ca1\u6709\u8def\u7531\u5230\u4e92\u8054\u7f51\u7684 VPC \u4e2d\u9884\u914d EKS \u96c6\u7fa4\u65f6\uff0c\u60a8\u5fc5\u987b\u786e\u4fdd\u5df2\u6839\u636e EKS \u6587\u6863\u4e2d\u51fa\u73b0\u7684\u79c1\u6709\u96c6\u7fa4\u8981\u6c42\u914d\u7f6e\u4e86\u73af\u5883\u3002\u6b64\u5916\uff0c\u60a8\u9700\u8981\u786e\u4fdd\u5df2\u5728 VPC \u4e2d\u521b\u5efa\u4e86 STS VPC \u533a\u57df\u7aef\u70b9\u3002\u5426\u5219\uff0c\u60a8\u5c06\u770b\u5230\u7c7b\u4f3c\u4e8e\u4e0b\u9762\u663e\u793a\u7684\u9519\u8bef\u3002</p> <pre><code>{\"level\":\"FATAL\",\"time\":\"2024-02-29T14:28:34.392Z\",\"logger\":\"controller\",\"message\":\"Checking EC2 API connectivity, WebIdentityErr: failed to retrieve credentials\\ncaused by: RequestError: send request failed\\ncaused by: Post \\\"https://sts.&lt;region&gt;.amazonaws.com/\\\": dial tcp 54.239.32.126:443: i/o timeout\",\"commit\":\"596ea97\"}\n</code></pre> <p>\u5728\u79c1\u6709\u96c6\u7fa4\u4e2d\u9700\u8981\u8fdb\u884c\u8fd9\u4e9b\u66f4\u6539\uff0c\u56e0\u4e3a Karpenter \u63a7\u5236\u5668\u4f7f\u7528\u670d\u52a1\u8d26\u6237\u7684 IAM \u89d2\u8272 (IRSA)\u3002\u914d\u7f6e\u4e86 IRSA \u7684 Pod \u901a\u8fc7\u8c03\u7528 AWS \u5b89\u5168\u4ee4\u724c\u670d\u52a1 (AWS STS) API \u6765\u83b7\u53d6\u51ed\u8bc1\u3002\u5982\u679c\u6ca1\u6709\u51fa\u7ad9\u4e92\u8054\u7f51\u8bbf\u95ee\uff0c\u60a8\u5fc5\u987b\u5728 VPC \u4e2d\u521b\u5efa\u548c\u4f7f\u7528 AWS STS VPC \u7aef\u70b9\u3002</p> <p>\u79c1\u6709\u96c6\u7fa4\u8fd8\u8981\u6c42\u60a8\u4e3a SSM \u521b\u5efa VPC \u7aef\u70b9\u3002\u5f53 Karpenter \u5c1d\u8bd5\u9884\u914d\u65b0\u8282\u70b9\u65f6\uff0c\u5b83\u4f1a\u67e5\u8be2\u542f\u52a8\u6a21\u677f\u914d\u7f6e\u548c SSM \u53c2\u6570\u3002\u5982\u679c\u60a8\u7684 VPC \u4e2d\u6ca1\u6709 SSM VPC \u7aef\u70b9\uff0c\u5b83\u5c06\u5bfc\u81f4\u4ee5\u4e0b\u9519\u8bef\uff1a</p> <pre><code>{\"level\":\"ERROR\",\"time\":\"2024-02-29T14:28:12.889Z\",\"logger\":\"controller\",\"message\":\"Unable to hydrate the AWS launch template cache, RequestCanceled: request context canceled\\ncaused by: context canceled\",\"commit\":\"596ea97\",\"tag-key\":\"karpenter.k8s.aws/cluster\",\"tag-value\":\"eks-workshop\"}\n...\n{\"level\":\"ERROR\",\"time\":\"2024-02-29T15:08:58.869Z\",\"logger\":\"controller.nodeclass\",\"message\":\"discovering amis from ssm, getting ssm parameter \\\"/aws/service/eks/optimized-ami/1.27/amazon-linux-2/recommended/image_id\\\", RequestError: send request failed\\ncaused by: Post \\\"https://ssm.&lt;region&gt;.amazonaws.com/\\\": dial tcp 67.220.228.252:443: i/o timeout\",\"commit\":\"596ea97\",\"ec2nodeclass\":\"default\",\"query\":\"/aws/service/eks/optimized-ami/1.27/amazon-linux-2/recommended/image_id\"}\n</code></pre> <p>\u6ca1\u6709 \u4ef7\u683c\u5217\u8868\u67e5\u8be2 API \u7684 VPC \u7aef\u70b9\u3002 \u56e0\u6b64\uff0c\u5b9a\u4ef7\u6570\u636e\u5c06\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u800c\u8fc7\u65f6\u3002 Karpenter \u901a\u8fc7\u5728\u5176\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u5305\u542b\u6309\u9700\u5b9a\u4ef7\u6570\u636e\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u53ea\u6709\u5728\u5347\u7ea7 Karpenter \u65f6\u624d\u4f1a\u66f4\u65b0\u8be5\u6570\u636e\u3002 \u83b7\u53d6\u5b9a\u4ef7\u6570\u636e\u7684\u5931\u8d25\u8bf7\u6c42\u5c06\u5bfc\u81f4\u4ee5\u4e0b\u9519\u8bef\u6d88\u606f\uff1a</p> <pre><code>{\"level\":\"ERROR\",\"time\":\"2024-02-29T15:08:58.522Z\",\"logger\":\"controller.pricing\",\"message\":\"retreiving on-demand pricing data, RequestError: send request failed\\ncaused by: Post \\\"https://api.pricing.&lt;region&gt;.amazonaws.com/\\\": dial tcp 18.196.224.8:443: i/o timeout; RequestError: send request failed\\ncaused by: Post \\\"https://api.pricing.&lt;region&gt;.amazonaws.com/\\\": dial tcp 18.185.143.117:443: i/o timeout\",\"commit\":\"596ea97\"}\n</code></pre> <p>\u603b\u4e4b\uff0c\u8981\u5728\u5b8c\u5168\u79c1\u6709\u7684 EKS \u96c6\u7fa4\u4e2d\u4f7f\u7528 Karpenter\uff0c\u60a8\u9700\u8981\u521b\u5efa\u4ee5\u4e0b VPC \u7aef\u70b9\uff1a</p> <pre><code>com.amazonaws.&lt;region&gt;.ec2\ncom.amazonaws.&lt;region&gt;.ecr.api\ncom.amazonaws.&lt;region&gt;.ecr.dkr\ncom.amazonaws.&lt;region&gt;.s3 \u2013 \u7528\u4e8e\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\ncom.amazonaws.&lt;region&gt;.sts \u2013 \u7528\u4e8e\u670d\u52a1\u8d26\u6237\u7684 IAM \u89d2\u8272\ncom.amazonaws.&lt;region&gt;.ssm - \u7528\u4e8e\u89e3\u6790\u9ed8\u8ba4 AMI\ncom.amazonaws.&lt;region&gt;.sqs - \u7528\u4e8e\u8bbf\u95ee SQS(\u5982\u679c\u4f7f\u7528\u4e2d\u65ad\u5904\u7406)\n</code></pre> <p>\u6ce8\u610f</p> <p>Karpenter (\u63a7\u5236\u5668\u548c Webhook \u90e8\u7f72)\u5bb9\u5668\u955c\u50cf\u5fc5\u987b\u5728 Amazon ECR \u79c1\u6709\u4e2d\u6216\u590d\u5236\u5230\u5176\u4ed6\u53ef\u4ece VPC \u5185\u90e8\u8bbf\u95ee\u7684\u79c1\u6709\u6ce8\u518c\u8868\u4e2d\u3002\u539f\u56e0\u662f Karpenter \u63a7\u5236\u5668\u548c Webhook Pod \u5f53\u524d\u4f7f\u7528\u516c\u5171 ECR \u955c\u50cf\u3002\u5982\u679c\u8fd9\u4e9b\u955c\u50cf\u5728 VPC \u5185\u90e8\u6216\u4e0e VPC \u5bf9\u7b49\u7684\u7f51\u7edc\u4e2d\u4e0d\u53ef\u7528\uff0c\u60a8\u5c06\u5728 Kubernetes \u5c1d\u8bd5\u4ece ECR \u516c\u5171\u62c9\u53d6\u8fd9\u4e9b\u955c\u50cf\u65f6\u83b7\u5f97\u955c\u50cf\u62c9\u53d6\u9519\u8bef\u3002</p> <p>\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Issue 988 \u548c Issue 1157\u3002</p>"},{"location":"zh/karpenter/#nodepool","title":"\u521b\u5efa NodePool","text":"<p>\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\u6db5\u76d6\u4e86\u4e0e\u521b\u5efa NodePool \u76f8\u5173\u7684\u4e3b\u9898\u3002</p>"},{"location":"zh/karpenter/#nodepool_1","title":"\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u521b\u5efa\u591a\u4e2a NodePool...","text":"<p>\u5f53\u4e0d\u540c\u56e2\u961f\u5171\u4eab\u96c6\u7fa4\u5e76\u9700\u8981\u5728\u4e0d\u540c\u7684\u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c\u4ed6\u4eec\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u6216\u8005\u6709\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u6216\u5b9e\u4f8b\u7c7b\u578b\u8981\u6c42\u65f6\uff0c\u8bf7\u521b\u5efa\u591a\u4e2a NodePool\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u56e2\u961f\u53ef\u80fd\u5e0c\u671b\u4f7f\u7528 Bottlerocket\uff0c\u800c\u53e6\u4e00\u4e2a\u56e2\u961f\u53ef\u80fd\u5e0c\u671b\u4f7f\u7528 Amazon Linux\u3002\u540c\u6837\uff0c\u4e00\u4e2a\u56e2\u961f\u53ef\u80fd\u53ef\u4ee5\u8bbf\u95ee\u6602\u8d35\u7684 GPU \u786c\u4ef6\uff0c\u800c\u53e6\u4e00\u4e2a\u56e2\u961f\u5219\u4e0d\u9700\u8981\u3002\u4f7f\u7528\u591a\u4e2a NodePool \u53ef\u786e\u4fdd\u6bcf\u4e2a\u56e2\u961f\u90fd\u53ef\u83b7\u5f97\u6700\u5408\u9002\u7684\u8d44\u6e90\u3002</p>"},{"location":"zh/karpenter/#nodepool_2","title":"\u521b\u5efa\u76f8\u4e92\u6392\u65a5\u6216\u52a0\u6743\u7684 NodePool","text":"<p>\u5efa\u8bae\u521b\u5efa\u76f8\u4e92\u6392\u65a5\u6216\u52a0\u6743\u7684 NodePool\uff0c\u4ee5\u63d0\u4f9b\u4e00\u81f4\u7684\u8c03\u5ea6\u884c\u4e3a\u3002\u5982\u679c\u5b83\u4eec\u4e0d\u662f\uff0c\u5e76\u4e14\u591a\u4e2a NodePool \u5339\u914d\uff0cKarpenter \u5c06\u968f\u673a\u9009\u62e9\u4f7f\u7528\u54ea\u4e00\u4e2a\uff0c\u4ece\u800c\u5bfc\u81f4\u610f\u5916\u7ed3\u679c\u3002\u521b\u5efa\u591a\u4e2a NodePool \u7684\u6709\u7528\u793a\u4f8b\u5305\u62ec\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <p>\u521b\u5efa\u4e00\u4e2a\u5e26\u6709 GPU \u7684 NodePool\uff0c\u5e76\u4e14\u53ea\u5141\u8bb8\u7279\u6b8a\u5de5\u4f5c\u8d1f\u8f7d\u5728\u8fd9\u4e9b(\u6602\u8d35\u7684)\u8282\u70b9\u4e0a\u8fd0\u884c\uff1a</p> <pre><code># NodePool for GPU Instances with Taints\napiVersion: karpenter.sh/v1beta1\nkind: NodePool\nmetadata:\n  name: gpu\nspec:\n  disruption: \n    consolidateAfter: 1m0s\n    consolidationPolicy: WhenEmpty\n    expireAfter: Never\n  template:\n    metadata: {}\n    spec:\n      nodeClassRef:\n        name: default\n      requirements:\n      - key: node.kubernetes.io/instance-type\n        operator: In\n        values:\n        - p3.8xlarge\n        - p3.16xlarge\n      - key: kubernetes.io/os\n        operator: In\n        values:\n        - linux\n      - key: kubernetes.io/arch\n        operator: In\n        values:\n        - amd64\n      - key: karpenter.sh/capacity-type\n        operator: In\n        values:\n        - on-demand\n      taints:\n      - effect: NoSchedule\n        key: nvidia.com/gpu\n        value: \"true\"\n</code></pre> <p>\u5e26\u6709\u5bb9\u5fcd\u6c61\u70b9\u7684\u90e8\u7f72\uff1a</p> <pre><code># Deployment of GPU Workload will have tolerations defined\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: inflate-gpu\nspec:\n  ...\n    spec:\n      tolerations:\n      - key: \"nvidia.com/gpu\"\n        operator: \"Exists\"\n        effect: \"NoSchedule\"\n</code></pre> <p>\u5bf9\u4e8e\u53e6\u4e00\u4e2a\u56e2\u961f\u7684\u4e00\u822c\u90e8\u7f72\uff0cNodePool \u89c4\u8303\u53ef\u4ee5\u5305\u62ec nodeAffinify\u3002\u7136\u540e\uff0cDeployment \u53ef\u4ee5\u4f7f\u7528 nodeSelectorTerms \u5339\u914d <code>billing-team</code>\u3002</p> <pre><code># NodePool for regular EC2 instances\napiVersion: karpenter.sh/v1beta1\nkind: NodePool\nmetadata:\n  name: generalcompute\nspec:\n  disruption:\n    expireAfter: Never\n  template:\n    metadata:\n      labels:\n        billing-team: my-team\n    spec:\n      nodeClassRef:\n        name: default\n      requirements:\n      - key: node.kubernetes.io/instance-type\n        operator: In\n        values:\n        - m5.large\n        - m5.xlarge\n        - m5.2xlarge\n        - c5.large\n        - c5.xlarge\n        - c5a.large\n        - c5a.xlarge\n        - r5.large\n        - r5.xlarge\n      - key: kubernetes.io/os\n        operator: In\n        values:\n        - linux\n      - key: kubernetes.io/arch\n        operator: In\n        values:\n        - amd64\n      - key: karpenter.sh/capacity-type\n        operator: In\n        values:\n        - on-demand\n</code></pre> <p>\u4f7f\u7528 nodeAffinity \u7684\u90e8\u7f72\uff1a</p> <pre><code># Deployment will have spec.affinity.nodeAffinity defined\nkind: Deployment\nmetadata:\n  name: workload-my-team\nspec:\n  replicas: 200\n  ...\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                - key: \"billing-team\"\n                  operator: \"In\"\n                  values: [\"my-team\"]\n</code></pre>"},{"location":"zh/karpenter/#ttl","title":"\u4f7f\u7528\u8ba1\u65f6\u5668 (TTL) \u81ea\u52a8\u4ece\u96c6\u7fa4\u4e2d\u5220\u9664\u8282\u70b9","text":"<p>\u60a8\u53ef\u4ee5\u5728\u9884\u914d\u7684\u8282\u70b9\u4e0a\u4f7f\u7528\u8ba1\u65f6\u5668\u6765\u8bbe\u7f6e\u4f55\u65f6\u5220\u9664\u6ca1\u6709\u5de5\u4f5c\u8d1f\u8f7d Pod \u6216\u5df2\u8fbe\u5230\u8fc7\u671f\u65f6\u95f4\u7684\u8282\u70b9\u3002\u8282\u70b9\u8fc7\u671f\u53ef\u7528\u4f5c\u5347\u7ea7\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4ee5\u4fbf\u6dd8\u6c70\u65e7\u8282\u70b9\u5e76\u7528\u66f4\u65b0\u7248\u672c\u66ff\u6362\u3002\u6709\u5173\u4f7f\u7528 <code>spec.disruption.expireAfter</code> \u914d\u7f6e\u8282\u70b9\u8fc7\u671f\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Karpenter \u6587\u6863\u4e2d\u7684 \u8fc7\u671f\u3002</p>"},{"location":"zh/karpenter/#karpenter-spot","title":"\u907f\u514d\u8fc7\u5ea6\u9650\u5236 Karpenter \u53ef\u4ee5\u9884\u914d\u7684\u5b9e\u4f8b\u7c7b\u578b\uff0c\u5c24\u5176\u662f\u5728\u4f7f\u7528 Spot \u65f6","text":"<p>\u4f7f\u7528 Spot \u65f6\uff0cKarpenter \u4f7f\u7528 \u4ef7\u683c\u5bb9\u91cf\u4f18\u5316 \u5206\u914d\u7b56\u7565\u6765\u9884\u914d EC2 \u5b9e\u4f8b\u3002\u8be5\u7b56\u7565\u6307\u793a EC2 \u4ece\u60a8\u8981\u542f\u52a8\u7684\u5b9e\u4f8b\u6570\u91cf\u4e2d\u6700\u6df1\u7684\u6c60\u4e2d\u9884\u914d\u5b9e\u4f8b\uff0c\u5e76\u4e14\u4e2d\u65ad\u98ce\u9669\u6700\u4f4e\u3002\u7136\u540e\uff0cEC2 Fleet \u4f1a\u4ece\u8fd9\u4e9b\u6c60\u4e2d\u4ef7\u683c\u6700\u4f4e\u7684\u6c60\u4e2d\u8bf7\u6c42 Spot \u5b9e\u4f8b\u3002\u60a8\u5141\u8bb8 Karpenter \u4f7f\u7528\u7684\u5b9e\u4f8b\u7c7b\u578b\u8d8a\u591a\uff0cEC2 \u5c31\u8d8a\u80fd\u4f18\u5316\u60a8\u7684 Spot \u5b9e\u4f8b\u7684\u8fd0\u884c\u65f6\u95f4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cKarpenter \u5c06\u4f7f\u7528 EC2 \u5728\u60a8\u7684\u96c6\u7fa4\u6240\u5728\u7684\u533a\u57df\u548c\u53ef\u7528\u533a\u57df\u4e2d\u63d0\u4f9b\u7684\u6240\u6709\u5b9e\u4f8b\u7c7b\u578b\u3002Karpenter \u6839\u636e\u5f85\u5904\u7406\u7684 Pod \u667a\u80fd\u5730\u4ece\u6240\u6709\u5b9e\u4f8b\u7c7b\u578b\u96c6\u5408\u4e2d\u8fdb\u884c\u9009\u62e9\uff0c\u4ee5\u786e\u4fdd\u60a8\u7684 Pod \u88ab\u8c03\u5ea6\u5230\u5408\u9002\u5927\u5c0f\u548c\u914d\u7f6e\u7684\u5b9e\u4f8b\u4e0a\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684 Pod \u4e0d\u9700\u8981 GPU\uff0cKarpenter \u5c31\u4e0d\u4f1a\u5c06\u60a8\u7684 Pod \u8c03\u5ea6\u5230\u652f\u6301 GPU \u7684 EC2 \u5b9e\u4f8b\u7c7b\u578b\u3002\u5f53\u60a8\u4e0d\u786e\u5b9a\u8981\u4f7f\u7528\u54ea\u4e9b\u5b9e\u4f8b\u7c7b\u578b\u65f6\uff0c\u53ef\u4ee5\u8fd0\u884c Amazon ec2-instance-selector \u6765\u751f\u6210\u4e0e\u60a8\u7684\u8ba1\u7b97\u8981\u6c42\u5339\u914d\u7684\u5b9e\u4f8b\u7c7b\u578b\u5217\u8868\u3002\u4f8b\u5982\uff0cCLI \u5c06\u5185\u5b58\u3001vCPU\u3001\u67b6\u6784\u548c\u533a\u57df\u4f5c\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u5e76\u4e3a\u60a8\u63d0\u4f9b\u6ee1\u8db3\u8fd9\u4e9b\u7ea6\u675f\u7684 EC2 \u5b9e\u4f8b\u5217\u8868\u3002</p> <pre><code>$ ec2-instance-selector --memory 4 --vcpus 2 --cpu-architecture x86_64 -r ap-southeast-1\nc5.large\nc5a.large\nc5ad.large\nc5d.large\nc6i.large\nt2.medium\nt3.medium\nt3a.medium\n</code></pre> <p>\u5728\u4f7f\u7528 Spot \u5b9e\u4f8b\u65f6\uff0c\u60a8\u4e0d\u5e94\u5bf9 Karpenter \u65bd\u52a0\u592a\u591a\u7ea6\u675f\uff0c\u56e0\u4e3a\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u7528\u6027\u3002\u4f8b\u5982\uff0c\u5982\u679c\u67d0\u79cd\u7279\u5b9a\u7c7b\u578b\u7684\u6240\u6709\u5b9e\u4f8b\u90fd\u88ab\u56de\u6536\uff0c\u800c\u6ca1\u6709\u5408\u9002\u7684\u66ff\u4ee3\u5b9e\u4f8b\u53ef\u7528\u4e8e\u66ff\u6362\uff0c\u60a8\u7684 Pod \u5c06\u4fdd\u6301\u5f85\u5904\u7406\u72b6\u6001\uff0c\u76f4\u5230\u4e3a\u914d\u7f6e\u7684\u5b9e\u4f8b\u7c7b\u578b\u91cd\u65b0\u8865\u5145 Spot \u5bb9\u91cf\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8de8\u4e0d\u540c\u53ef\u7528\u533a\u57df\u5206\u5e03\u5b9e\u4f8b\u6765\u964d\u4f4e\u5bb9\u91cf\u4e0d\u8db3\u9519\u8bef\u7684\u98ce\u9669\uff0c\u56e0\u4e3a\u4e0d\u540c\u53ef\u7528\u533a\u57df\u7684 Spot \u6c60\u662f\u4e0d\u540c\u7684\u3002\u4e0d\u8fc7\uff0c\u4e00\u822c\u6700\u4f73\u5b9e\u8df5\u662f\u5728\u4f7f\u7528 Spot \u65f6\u5141\u8bb8 Karpenter \u4f7f\u7528\u591a\u79cd\u5b9e\u4f8b\u7c7b\u578b\u3002</p>"},{"location":"zh/karpenter/#pod","title":"\u8c03\u5ea6 Pod","text":"<p>\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\u4e0e\u5728\u4f7f\u7528 Karpenter \u8fdb\u884c\u8282\u70b9\u9884\u914d\u7684\u96c6\u7fa4\u4e2d\u90e8\u7f72 Pod \u6709\u5173\u3002</p>"},{"location":"zh/karpenter/#eks","title":"\u9075\u5faa EKS \u9ad8\u53ef\u7528\u6027\u6700\u4f73\u5b9e\u8df5","text":"<p>\u5982\u679c\u60a8\u9700\u8981\u8fd0\u884c\u9ad8\u5ea6\u53ef\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u8bf7\u9075\u5faa\u4e00\u822c EKS \u6700\u4f73\u5b9e\u8df5\u5efa\u8bae\u3002\u6709\u5173\u5982\u4f55\u8de8\u8282\u70b9\u548c\u533a\u57df\u5206\u5e03 Pod \u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Karpenter \u6587\u6863\u4e2d\u7684 \u62d3\u6251\u5206\u5e03\u3002\u4f7f\u7528 \u4e2d\u65ad\u9884\u7b97 \u8bbe\u7f6e\u5728\u5c1d\u8bd5\u9a71\u9010\u6216\u5220\u9664 Pod \u65f6\u9700\u8981\u7ef4\u62a4\u7684\u6700\u5c0f\u53ef\u7528 Pod \u6570\u91cf\u3002</p>"},{"location":"zh/karpenter/#_4","title":"\u4f7f\u7528\u5206\u5c42\u7ea6\u675f\u6765\u7ea6\u675f\u6765\u81ea\u60a8\u7684\u4e91\u63d0\u4f9b\u5546\u7684\u8ba1\u7b97\u529f\u80fd","text":"<p>Karpenter \u7684\u5206\u5c42\u7ea6\u675f\u6a21\u578b\u5141\u8bb8\u60a8\u521b\u5efa\u4e00\u7ec4\u590d\u6742\u7684 NodePool \u548c Pod \u90e8\u7f72\u7ea6\u675f\uff0c\u4ee5\u83b7\u5f97 Pod \u8c03\u5ea6\u7684\u6700\u4f73\u5339\u914d\u3002Pod \u89c4\u8303\u53ef\u4ee5\u8bf7\u6c42\u7684\u7ea6\u675f\u793a\u4f8b\u5305\u62ec\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>\u9700\u8981\u5728\u7279\u5b9a\u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u7684\u53ef\u7528\u533a\u57df\u4e2d\u8fd0\u884c\u3002\u4f8b\u5982\uff0c\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a Pod \u9700\u8981\u4e0e\u5728\u7279\u5b9a\u53ef\u7528\u533a\u57df\u4e2d\u7684 EC2 \u5b9e\u4f8b\u4e0a\u8fd0\u884c\u7684\u53e6\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u901a\u4fe1\u3002\u5982\u679c\u60a8\u7684\u76ee\u6807\u662f\u51cf\u5c11 VPC \u4e2d\u7684\u8de8\u53ef\u7528\u533a\u57df\u6d41\u91cf\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5c06 Pod \u4e0e EC2 \u5b9e\u4f8b\u4f4d\u4e8e\u540c\u4e00\u53ef\u7528\u533a\u57df\u3002\u8fd9\u79cd\u5b9a\u4f4d\u901a\u5e38\u662f\u4f7f\u7528\u8282\u70b9\u9009\u62e9\u5668\u6765\u5b9e\u73b0\u7684\u3002\u6709\u5173 \u8282\u70b9\u9009\u62e9\u5668\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Kubernetes \u6587\u6863\u3002</li> <li>\u9700\u8981\u7279\u5b9a\u7c7b\u578b\u7684\u5904\u7406\u5668\u6216\u5176\u4ed6\u786c\u4ef6\u3002\u8bf7\u53c2\u9605 Karpenter \u6587\u6863\u4e2d\u7684 \u52a0\u901f\u5668 \u90e8\u5206\uff0c\u4e86\u89e3\u9700\u8981\u5728 GPU \u4e0a\u8fd0\u884c\u7684 Pod \u89c4\u8303\u793a\u4f8b\u3002</li> </ul>"},{"location":"zh/karpenter/#_5","title":"\u521b\u5efa\u8ba1\u8d39\u8b66\u62a5\u4ee5\u76d1\u63a7\u60a8\u7684\u8ba1\u7b97\u652f\u51fa","text":"<p>\u5f53\u60a8\u914d\u7f6e\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u65f6\uff0c\u60a8\u5e94\u521b\u5efa\u8ba1\u8d39\u8b66\u62a5\uff0c\u4ee5\u5728\u60a8\u7684\u652f\u51fa\u8d85\u8fc7\u9608\u503c\u65f6\u53d1\u51fa\u8b66\u544a\uff0c\u5e76\u5728 Karpenter \u914d\u7f6e\u4e2d\u6dfb\u52a0\u8d44\u6e90\u9650\u5236\u3002\u4f7f\u7528 Karpenter \u8bbe\u7f6e\u8d44\u6e90\u9650\u5236\u7c7b\u4f3c\u4e8e\u8bbe\u7f6e AWS \u81ea\u52a8\u6269\u7f29\u7ec4\u7684\u6700\u5927\u5bb9\u91cf\uff0c\u5b83\u8868\u793a Karpenter NodePool \u53ef\u4ee5\u9884\u914d\u7684\u6700\u5927\u8ba1\u7b97\u8d44\u6e90\u91cf\u3002</p> <p>\u6ce8\u610f</p> <p>\u65e0\u6cd5\u4e3a\u6574\u4e2a\u96c6\u7fa4\u8bbe\u7f6e\u5168\u5c40\u9650\u5236\u3002\u9650\u5236\u9002\u7528\u4e8e\u7279\u5b9a\u7684 NodePool\u3002</p> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u7247\u6bb5\u544a\u8bc9 Karpenter \u6700\u591a\u53ea\u9884\u914d 1000 \u4e2a CPU \u5185\u6838\u548c 1000Gi \u5185\u5b58\u3002\u53ea\u6709\u5728\u8fbe\u5230\u6216\u8d85\u8fc7\u9650\u5236\u65f6\uff0cKarpenter \u624d\u4f1a\u505c\u6b62\u6dfb\u52a0\u5bb9\u91cf\u3002\u5f53\u8d85\u8fc7\u9650\u5236\u65f6\uff0cKarpenter \u63a7\u5236\u5668\u5c06\u5728\u63a7\u5236\u5668\u7684\u65e5\u5fd7\u4e2d\u5199\u5165 <code>memory resource usage of 1001 exceeds limit of 1000</code> \u6216\u7c7b\u4f3c\u7684\u6d88\u606f\u3002\u5982\u679c\u60a8\u5c06\u5bb9\u5668\u65e5\u5fd7\u8def\u7531\u5230 CloudWatch \u65e5\u5fd7\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a \u6307\u6807\u8fc7\u6ee4\u5668 \u6765\u67e5\u627e\u65e5\u5fd7\u4e2d\u7684\u7279\u5b9a\u6a21\u5f0f\u6216\u672f\u8bed\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a CloudWatch \u8b66\u62a5 \u4ee5\u5728\u60a8\u914d\u7f6e\u7684\u6307\u6807\u9608\u503c\u88ab\u89e6\u53d1\u65f6\u53d1\u51fa\u8b66\u62a5\u3002</p> <p>\u6709\u5173\u5728 Karpenter \u4e2d\u4f7f\u7528\u9650\u5236\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Karpenter \u6587\u6863\u4e2d\u7684 \u8bbe\u7f6e\u8d44\u6e90\u9650\u5236\u3002</p> <pre><code>spec:\n  limits:\n    cpu: 1000\n    memory: 1000Gi\n</code></pre> <p>\u5982\u679c\u60a8\u4e0d\u4f7f\u7528\u9650\u5236\u6216\u9650\u5236 Karpenter \u53ef\u4ee5\u9884\u914d\u7684\u5b9e\u4f8b\u7c7b\u578b\uff0cKarpenter \u5c06\u7ee7\u7eed\u6839\u636e\u9700\u8981\u5411\u96c6\u7fa4\u6dfb\u52a0\u8ba1\u7b97\u5bb9\u91cf\u3002\u867d\u7136\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u914d\u7f6e Karpenter \u5141\u8bb8\u60a8\u7684\u96c6\u7fa4\u81ea\u7531\u6269\u7f29\uff0c\u4f46\u4e5f\u53ef\u80fd\u4f1a\u4ea7\u751f\u91cd\u5927\u7684\u6210\u672c\u5f71\u54cd\u3002\u8fd9\u5c31\u662f\u6211\u4eec\u5efa\u8bae\u914d\u7f6e\u8ba1\u8d39\u8b66\u62a5\u7684\u539f\u56e0\u3002\u8ba1\u8d39\u8b66\u62a5\u5141\u8bb8\u60a8\u5728\u60a8\u7684\u8d26\u6237\u4e2d\u7684\u4f30\u8ba1\u8d39\u7528\u8d85\u8fc7\u5b9a\u4e49\u7684\u9608\u503c\u65f6\u5f97\u5230\u4e3b\u52a8\u901a\u77e5\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u8bbe\u7f6e Amazon CloudWatch \u8ba1\u8d39\u8b66\u62a5\u4ee5\u4e3b\u52a8\u76d1\u63a7\u4f30\u8ba1\u8d39\u7528\u3002</p> <p>\u60a8\u8fd8\u53ef\u80fd\u5e0c\u671b\u542f\u7528\u6210\u672c\u5f02\u5e38\u68c0\u6d4b\uff0c\u8fd9\u662f\u4e00\u9879 AWS \u6210\u672c\u7ba1\u7406\u529f\u80fd\uff0c\u4f7f\u7528\u673a\u5668\u5b66\u4e60\u6301\u7eed\u76d1\u63a7\u60a8\u7684\u6210\u672c\u548c\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u68c0\u6d4b\u5f02\u5e38\u652f\u51fa\u3002\u66f4\u591a\u4fe1\u606f\u53ef\u4ee5\u5728 AWS \u6210\u672c\u5f02\u5e38\u68c0\u6d4b\u5165\u95e8 \u6307\u5357\u4e2d\u627e\u5230\u3002\u5982\u679c\u60a8\u5df2\u7ecf\u5728 AWS Budgets \u4e2d\u521b\u5efa\u4e86\u9884\u7b97\uff0c\u60a8\u8fd8\u53ef\u4ee5\u914d\u7f6e\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5728\u7279\u5b9a\u9608\u503c\u88ab\u89e6\u53d1\u65f6\u901a\u77e5\u60a8\u3002\u4f7f\u7528\u9884\u7b97\u64cd\u4f5c\uff0c\u60a8\u53ef\u4ee5\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3001\u53d1\u5e03\u6d88\u606f\u5230 SNS \u4e3b\u9898\u6216\u5411 Slack \u7b49\u804a\u5929\u673a\u5668\u4eba\u53d1\u9001\u6d88\u606f\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u914d\u7f6e AWS Budgets \u64cd\u4f5c\u3002</p>"},{"location":"zh/karpenter/#karpentershdo-not-disrupt-karpenter","title":"\u4f7f\u7528 karpenter.sh/do-not-disrupt \u6ce8\u89e3\u4ee5\u9632\u6b62 Karpenter \u53d6\u6d88\u9884\u914d\u8282\u70b9","text":"<p>\u5982\u679c\u60a8\u5728 Karpenter \u9884\u914d\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\u5173\u952e\u5e94\u7528\u7a0b\u5e8f(\u5982\u957f\u671f\u8fd0\u884c\u7684\u6279\u5904\u7406\u4f5c\u4e1a\u6216\u6709\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f)\uff0c\u5e76\u4e14\u8282\u70b9\u7684 TTL \u5df2\u8fc7\u671f\uff0c\u5219\u5f53\u5b9e\u4f8b\u7ec8\u6b62\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u88ab\u4e2d\u65ad\u3002\u901a\u8fc7\u5411 Pod \u6dfb\u52a0 <code>karpenter.sh/karpenter.sh/do-not-disrupt</code> \u6ce8\u89e3\uff0c\u60a8\u6b63\u5728\u6307\u793a Karpenter \u4fdd\u7559\u8be5\u8282\u70b9\uff0c\u76f4\u5230 Pod \u7ec8\u6b62\u6216\u5220\u9664 <code>karpenter.sh/do-not-disrupt</code> \u6ce8\u89e3\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4e2d\u65ad \u6587\u6863\u3002</p> <p>\u5982\u679c\u8282\u70b9\u4e0a\u5269\u4e0b\u7684\u552f\u4e00\u975e daemonset Pod \u4e0e\u4f5c\u4e1a\u76f8\u5173\u8054\uff0c\u53ea\u8981\u4f5c\u4e1a\u72b6\u6001\u4e3a succeed \u6216 failed\uff0cKarpenter \u5c31\u80fd\u591f\u5b9a\u4f4d\u548c\u7ec8\u6b62\u8fd9\u4e9b\u8282\u70b9\u3002</p>"},{"location":"zh/karpenter/#cpu-requestslimits","title":"\u5728\u4f7f\u7528\u6574\u5408\u65f6\u4e3a\u6240\u6709\u975e CPU \u8d44\u6e90\u914d\u7f6e requests=limits","text":"<p>\u6574\u5408\u548c\u8c03\u5ea6\u901a\u5e38\u901a\u8fc7\u6bd4\u8f83 Pod \u7684\u8d44\u6e90\u8bf7\u6c42\u4e0e\u8282\u70b9\u4e0a\u7684\u53ef\u5206\u914d\u8d44\u6e90\u91cf\u6765\u5de5\u4f5c\u3002\u4e0d\u8003\u8651\u8d44\u6e90\u9650\u5236\u3002\u4f8b\u5982\uff0c\u5185\u5b58\u9650\u5236\u5927\u4e8e\u5185\u5b58\u8bf7\u6c42\u7684 Pod \u53ef\u4ee5\u8d85\u8fc7\u8bf7\u6c42\u503c\u3002\u5982\u679c\u540c\u4e00\u8282\u70b9\u4e0a\u7684\u591a\u4e2a Pod \u540c\u65f6\u7a81\u589e\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u67d0\u4e9b Pod \u7531\u4e8e\u5185\u5b58\u4e0d\u8db3 (OOM) \u800c\u88ab\u7ec8\u6b62\u3002\u6574\u5408\u53ef\u80fd\u4f1a\u589e\u52a0\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u7684\u53ef\u80fd\u6027\uff0c\u56e0\u4e3a\u5b83\u53ea\u8003\u8651 Pod \u7684\u8bf7\u6c42\u6765\u5c06 Pod \u6253\u5305\u5230\u8282\u70b9\u4e0a\u3002</p>"},{"location":"zh/karpenter/#limitrange","title":"\u4f7f\u7528 LimitRange \u4e3a\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236\u914d\u7f6e\u9ed8\u8ba4\u503c","text":"<p>\u7531\u4e8e Kubernetes \u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u8bf7\u6c42\u6216\u9650\u5236\uff0c\u5bb9\u5668\u4ece\u5e95\u5c42\u4e3b\u673a\u6d88\u8017\u7684\u8d44\u6e90(CPU \u548c\u5185\u5b58)\u662f\u65e0\u9650\u5236\u7684\u3002Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u67e5\u770b Pod \u7684\u603b\u8bf7\u6c42(\u6765\u81ea Pod \u5bb9\u5668\u6216 Pod \u7684 Init \u5bb9\u5668\u7684\u603b\u8bf7\u6c42\u4e2d\u7684\u8f83\u9ad8\u503c)\u6765\u786e\u5b9a\u5c06 Pod \u8c03\u5ea6\u5230\u54ea\u4e2a\u5de5\u4f5c\u8282\u70b9\u3002\u540c\u6837\uff0cKarpenter \u4e5f\u8003\u8651 Pod \u7684\u8bf7\u6c42\u6765\u786e\u5b9a\u9884\u914d\u54ea\u79cd\u7c7b\u578b\u7684\u5b9e\u4f8b\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u9650\u5236\u8303\u56f4\u4e3a\u547d\u540d\u7a7a\u95f4\u5e94\u7528\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff0c\u4ee5\u9632\u67d0\u4e9b Pod \u672a\u6307\u5b9a\u8d44\u6e90\u8bf7\u6c42\u3002</p> <p>\u8bf7\u53c2\u9605 \u4e3a\u547d\u540d\u7a7a\u95f4\u914d\u7f6e\u9ed8\u8ba4\u5185\u5b58\u8bf7\u6c42\u548c\u9650\u5236</p>"},{"location":"zh/karpenter/#_6","title":"\u4e3a\u6240\u6709\u5de5\u4f5c\u8d1f\u8f7d\u5e94\u7528\u51c6\u786e\u7684\u8d44\u6e90\u8bf7\u6c42","text":"<p>\u5f53 Karpenter \u5bf9\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8981\u6c42\u7684\u4fe1\u606f\u51c6\u786e\u65f6\uff0c\u5b83\u5c31\u80fd\u591f\u542f\u52a8\u6700\u9002\u5408\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8282\u70b9\u3002\u5982\u679c\u4f7f\u7528 Karpenter \u7684\u6574\u5408\u529f\u80fd\uff0c\u8fd9\u4e00\u70b9\u5c24\u5176\u91cd\u8981\u3002</p> <p>\u8bf7\u53c2\u9605 \u4e3a\u6240\u6709\u5de5\u4f5c\u8d1f\u8f7d\u914d\u7f6e\u548c\u8c03\u6574\u8d44\u6e90\u8bf7\u6c42/\u9650\u5236</p>"},{"location":"zh/karpenter/#coredns","title":"CoreDNS \u5efa\u8bae","text":""},{"location":"zh/karpenter/#coredns_1","title":"\u66f4\u65b0 CoreDNS \u914d\u7f6e\u4ee5\u4fdd\u6301\u53ef\u9760\u6027","text":"<p>\u5728\u5c06 CoreDNS Pod \u90e8\u7f72\u5230\u7531 Karpenter \u7ba1\u7406\u7684\u8282\u70b9\u4e0a\u65f6\uff0c\u9274\u4e8e Karpenter \u52a8\u6001\u5730\u5feb\u901f\u7ec8\u6b62/\u521b\u5efa\u65b0\u8282\u70b9\u4ee5\u6ee1\u8db3\u9700\u6c42\uff0c\u5efa\u8bae\u9075\u5faa\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\uff1a</p> <p>CoreDNS lameduck \u6301\u7eed\u65f6\u95f4</p> <p>CoreDNS \u5c31\u7eea\u63a2\u9488</p> <p>\u8fd9\u5c06\u786e\u4fdd\u4e0d\u4f1a\u5c06 DNS \u67e5\u8be2\u5b9a\u5411\u5230\u5c1a\u672a\u5c31\u7eea\u6216\u5df2\u7ec8\u6b62\u7684 CoreDNS Pod\u3002</p>"},{"location":"zh/karpenter/#karpenter_5","title":"Karpenter \u84dd\u56fe","text":"<p>\u7531\u4e8e Karpenter \u91c7\u7528\u9762\u5411\u5e94\u7528\u7a0b\u5e8f\u7684\u65b9\u6cd5\u6765\u4e3a Kubernetes \u6570\u636e\u5e73\u9762\u9884\u914d\u8ba1\u7b97\u5bb9\u91cf\uff0c\u60a8\u53ef\u80fd\u60f3\u77e5\u9053\u5982\u4f55\u6b63\u786e\u914d\u7f6e\u4e00\u4e9b\u5e38\u89c1\u7684\u5de5\u4f5c\u8d1f\u8f7d\u573a\u666f\u3002Karpenter \u84dd\u56fe\u662f\u4e00\u4e2a\u5b58\u50a8\u5e93\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u9075\u5faa\u6b64\u5904\u63cf\u8ff0\u7684\u6700\u4f73\u5b9e\u8df5\u7684\u5e38\u89c1\u5de5\u4f5c\u8d1f\u8f7d\u573a\u666f\u5217\u8868\u3002\u60a8\u5c06\u62e5\u6709\u6240\u9700\u7684\u6240\u6709\u8d44\u6e90\uff0c\u751a\u81f3\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u4e86 Karpenter \u7684 EKS \u96c6\u7fa4\uff0c\u5e76\u6d4b\u8bd5\u5b58\u50a8\u5e93\u4e2d\u5305\u542b\u7684\u6bcf\u4e2a\u84dd\u56fe\u3002\u60a8\u53ef\u4ee5\u7ec4\u5408\u4e0d\u540c\u7684\u84dd\u56fe\u6765\u6700\u7ec8\u521b\u5efa\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6240\u9700\u7684\u84dd\u56fe\u3002</p>"},{"location":"zh/karpenter/#_7","title":"\u5176\u4ed6\u8d44\u6e90","text":"<ul> <li>Karpenter/Spot \u7814\u8ba8\u4f1a</li> <li>Karpenter \u8282\u70b9\u9884\u914d\u7a0b\u5e8f</li> <li>TGIK Karpenter</li> <li>Karpenter \u4e0e\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668</li> <li>Karpenter \u65e0\u7ec4\u81ea\u52a8\u6269\u7f29</li> <li>\u6559\u7a0b\uff1a\u4f7f\u7528 Amazon EC2 Spot \u548c Karpenter \u4ee5\u66f4\u4f4e\u6210\u672c\u8fd0\u884c Kubernetes \u96c6\u7fa4</li> </ul>"},{"location":"zh/networking/custom-networking/","title":"\u81ea\u5b9a\u4e49\u7f51\u7edc","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAmazon VPC CNI \u5c06\u4ece\u4e3b\u5b50\u7f51\u4e2d\u9009\u62e9\u4e00\u4e2a IP \u5730\u5740\u5206\u914d\u7ed9 Pod\u3002\u4e3b\u5b50\u7f51\u662f\u4e3b\u7f51\u7edc\u63a5\u53e3\u6240\u8fde\u63a5\u7684\u5b50\u7f51 CIDR\uff0c\u901a\u5e38\u662f\u8282\u70b9/\u4e3b\u673a\u6240\u5728\u7684\u5b50\u7f51\u3002</p> <p>\u5982\u679c\u5b50\u7f51 CIDR \u592a\u5c0f\uff0cCNI \u53ef\u80fd\u65e0\u6cd5\u83b7\u53d6\u8db3\u591f\u7684\u8f85\u52a9 IP \u5730\u5740\u5206\u914d\u7ed9 Pod\u3002\u8fd9\u662f EKS IPv4 \u96c6\u7fa4\u7684\u4e00\u4e2a\u5e38\u89c1\u6311\u6218\u3002</p> <p>\u81ea\u5b9a\u4e49\u7f51\u7edc\u662f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u81ea\u5b9a\u4e49\u7f51\u7edc\u901a\u8fc7\u4ece\u8f85\u52a9 VPC \u5730\u5740\u7a7a\u95f4 (CIDR) \u5206\u914d\u8282\u70b9\u548c Pod IP \u6765\u89e3\u51b3 IP \u8017\u5c3d\u95ee\u9898\u3002\u81ea\u5b9a\u4e49\u7f51\u7edc\u652f\u6301 ENIConfig \u81ea\u5b9a\u4e49\u8d44\u6e90\u3002ENIConfig \u5305\u62ec\u4e00\u4e2a\u5907\u7528\u5b50\u7f51 CIDR \u8303\u56f4 (\u4ece\u8f85\u52a9 VPC CIDR \u4e2d\u5212\u5206)\uff0c\u4ee5\u53ca Pod \u5c06\u5c5e\u4e8e\u7684\u5b89\u5168\u7ec4\u3002\u542f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u540e\uff0cVPC CNI \u5728 ENIConfig \u4e2d\u5b9a\u4e49\u7684\u5b50\u7f51\u4e2d\u521b\u5efa\u8f85\u52a9\u7f51\u7edc\u63a5\u53e3\u3002CNI \u4ece ENIConfig CRD \u4e2d\u5b9a\u4e49\u7684 CIDR \u8303\u56f4\u4e3a Pod \u5206\u914d IP \u5730\u5740\u3002</p> <p>\u7531\u4e8e\u4e3b\u7f51\u7edc\u63a5\u53e3\u4e0d\u88ab\u81ea\u5b9a\u4e49\u7f51\u7edc\u4f7f\u7528\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 Pod \u6570\u91cf\u4f1a\u964d\u4f4e\u3002\u4e3b\u673a\u7f51\u7edc Pod \u7ee7\u7eed\u4f7f\u7528\u5206\u914d\u7ed9\u4e3b\u7f51\u7edc\u63a5\u53e3\u7684 IP \u5730\u5740\u3002\u6b64\u5916\uff0c\u4e3b\u7f51\u7edc\u63a5\u53e3\u7528\u4e8e\u5904\u7406\u6e90\u7f51\u7edc\u8f6c\u6362\u5e76\u8def\u7531 Pod \u6d41\u91cf\u5230\u8282\u70b9\u5916\u90e8\u3002</p>"},{"location":"zh/networking/custom-networking/#_2","title":"\u793a\u4f8b\u914d\u7f6e","text":"<p>\u867d\u7136\u81ea\u5b9a\u4e49\u7f51\u7edc\u5c06\u63a5\u53d7\u6709\u6548\u7684 VPC \u8303\u56f4\u4f5c\u4e3a\u8f85\u52a9 CIDR \u8303\u56f4\uff0c\u4f46\u6211\u4eec\u5efa\u8bae\u60a8\u4f7f\u7528\u6765\u81ea CG-NAT \u7a7a\u95f4\u7684 CIDR (/16)\uff0c\u5373 100.64.0.0/10 \u6216 198.19.0.0/16\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u8303\u56f4\u5728\u4f01\u4e1a\u73af\u5883\u4e2d\u4e0d\u592a\u53ef\u80fd\u88ab\u4f7f\u7528\uff0c\u800c\u4e0d\u662f\u5176\u4ed6 RFC1918 \u8303\u56f4\u3002\u6709\u5173\u60a8\u53ef\u4ee5\u4e0e VPC \u4e00\u8d77\u4f7f\u7528\u7684\u5141\u8bb8\u548c\u9650\u5236\u7684 CIDR \u5757\u5173\u8054\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 VPC \u6587\u6863\u4e2d VPC \u548c\u5b50\u7f51\u5927\u5c0f\u8c03\u6574\u90e8\u5206\u7684 IPv4 CIDR \u5757\u5173\u8054\u9650\u5236\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5de5\u4f5c\u8282\u70b9\u7684\u4e3b\u5f39\u6027\u7f51\u7edc\u63a5\u53e3 (ENI) \u4ecd\u4f7f\u7528\u4e3b VPC CIDR \u8303\u56f4 (\u5728\u672c\u4f8b\u4e2d\u4e3a 10.0.0.0/16)\uff0c\u4f46\u8f85\u52a9\u7f51\u7edc\u63a5\u53e3\u4f7f\u7528\u8f85\u52a9 VPC CIDR \u8303\u56f4 (\u5728\u672c\u4f8b\u4e2d\u4e3a 100.64.0.0/16)\u3002\u73b0\u5728\uff0c\u4e3a\u4e86\u8ba9 Pod \u4f7f\u7528 100.64.0.0/16 CIDR \u8303\u56f4\uff0c\u60a8\u5fc5\u987b\u914d\u7f6e CNI \u63d2\u4ef6\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002\u60a8\u53ef\u4ee5\u6309\u7167\u6b64\u5904\u8bb0\u5f55\u7684\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p></p> <p>\u5982\u679c\u60a8\u5e0c\u671b CNI \u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\uff0c\u8bf7\u8bbe\u7f6e <code>AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG</code> \u73af\u5883\u53d8\u91cf\u4e3a <code>true</code>\u3002</p> <pre><code>kubectl set env daemonset aws-node -n kube-system AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true\n</code></pre> <p>\u5f53 <code>AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true</code> \u65f6\uff0cCNI \u5c06\u4ece <code>ENIConfig</code> \u4e2d\u5b9a\u4e49\u7684\u5b50\u7f51\u5206\u914d Pod IP \u5730\u5740\u3002<code>ENIConfig</code> \u81ea\u5b9a\u4e49\u8d44\u6e90\u7528\u4e8e\u5b9a\u4e49\u5c06\u8c03\u5ea6 Pod \u7684\u5b50\u7f51\u3002</p> <pre><code>apiVersion : crd.k8s.amazonaws.com/v1alpha1\nkind : ENIConfig\nmetadata:\n  name: us-west-2a\nspec: \n  securityGroups:\n    - sg-0dff111a1d11c1c11\n  subnet: subnet-011b111c1f11fdf11\n</code></pre> <p>\u521b\u5efa <code>ENIconfig</code> \u81ea\u5b9a\u4e49\u8d44\u6e90\u540e\uff0c\u60a8\u9700\u8981\u521b\u5efa\u65b0\u7684\u5de5\u4f5c\u8282\u70b9\u5e76\u6392\u7a7a\u73b0\u6709\u8282\u70b9\u3002\u73b0\u6709\u5de5\u4f5c\u8282\u70b9\u548c Pod \u5c06\u4e0d\u53d7\u5f71\u54cd\u3002</p>"},{"location":"zh/networking/custom-networking/#_3","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/custom-networking/#_4","title":"\u4f55\u65f6\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc","text":"<p>\u5982\u679c\u60a8\u6b63\u5728\u5904\u7406 IPv4 \u8017\u5c3d\u4e14\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528 IPv6\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u8003\u8651\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002Amazon EKS \u5bf9 RFC6598 \u7a7a\u95f4\u7684\u652f\u6301\u4f7f\u60a8\u80fd\u591f\u6269\u5c55 Pod \u4ee5\u8d85\u8d8a RFC1918 \u5730\u5740\u8017\u5c3d\u7684\u6311\u6218\u3002\u8bf7\u8003\u8651\u4e0e\u81ea\u5b9a\u4e49\u7f51\u7edc\u4e00\u8d77\u4f7f\u7528\u524d\u7f00\u59d4\u6d3e\u6765\u589e\u52a0\u8282\u70b9\u4e0a\u7684 Pod \u5bc6\u5ea6\u3002</p> <p>\u5982\u679c\u60a8\u6709\u5728\u4e0d\u540c\u7f51\u7edc\u4e0a\u8fd0\u884c Pod \u5e76\u5177\u6709\u4e0d\u540c\u5b89\u5168\u7ec4\u8981\u6c42\u7684\u5b89\u5168\u9700\u6c42\uff0c\u60a8\u53ef\u80fd\u4f1a\u8003\u8651\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002\u542f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u540e\uff0cPod \u4f7f\u7528\u7684\u5b50\u7f51\u6216\u5b89\u5168\u7ec4\u4e0e\u8282\u70b9\u7684\u4e3b\u7f51\u7edc\u63a5\u53e3\u4e0d\u540c\uff0c\u5982 ENIConfig \u4e2d\u6240\u5b9a\u4e49\u3002</p> <p>\u81ea\u5b9a\u4e49\u7f51\u7edc\u786e\u5b9e\u662f\u90e8\u7f72\u591a\u4e2a EKS \u96c6\u7fa4\u548c\u5e94\u7528\u7a0b\u5e8f\u4ee5\u8fde\u63a5\u672c\u5730\u6570\u636e\u4e2d\u5fc3\u670d\u52a1\u7684\u7406\u60f3\u9009\u62e9\u3002\u60a8\u53ef\u4ee5\u589e\u52a0 EKS \u5728 VPC \u4e2d\u53ef\u8bbf\u95ee\u7684\u79c1\u6709\u5730\u5740 (RFC1918) \u6570\u91cf\uff0c\u7528\u4e8e\u8bf8\u5982 Amazon Elastic Load Balancing \u548c NAT-GW \u7b49\u670d\u52a1\uff0c\u540c\u65f6\u5728\u591a\u4e2a\u96c6\u7fa4\u4e2d\u4f7f\u7528\u4e0d\u53ef\u8def\u7531\u7684 CG-NAT \u7a7a\u95f4\u6765\u90e8\u7f72\u60a8\u7684 Pod\u3002\u7ed3\u5408 Transit Gateway \u548c\u5171\u4eab\u670d\u52a1 VPC (\u5305\u62ec\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u7684 NAT \u7f51\u5173\u4ee5\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027)\u7684\u81ea\u5b9a\u4e49\u7f51\u7edc\uff0c\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u53ef\u6269\u5c55\u548c\u53ef\u9884\u6d4b\u7684\u6d41\u91cf\u6d41\u3002\u8fd9\u7bc7\u535a\u5ba2\u6587\u7ae0\u63cf\u8ff0\u4e86\u4e00\u79cd\u67b6\u6784\u6a21\u5f0f\uff0c\u8fd9\u662f\u5c06 EKS Pod \u8fde\u63a5\u5230\u6570\u636e\u4e2d\u5fc3\u7f51\u7edc\u7684\u6700\u63a8\u8350\u65b9\u5f0f\u4e4b\u4e00\u3002</p>"},{"location":"zh/networking/custom-networking/#_5","title":"\u4f55\u65f6\u907f\u514d\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc","text":""},{"location":"zh/networking/custom-networking/#ipv6","title":"\u51c6\u5907\u5b9e\u65bd IPv6","text":"<p>\u81ea\u5b9a\u4e49\u7f51\u7edc\u53ef\u4ee5\u7f13\u89e3 IP \u8017\u5c3d\u95ee\u9898\uff0c\u4f46\u9700\u8981\u989d\u5916\u7684\u64cd\u4f5c\u5f00\u9500\u3002\u5982\u679c\u60a8\u5f53\u524d\u6b63\u5728\u90e8\u7f72\u53cc\u6808 (IPv4/IPv6) VPC \u6216\u60a8\u7684\u8ba1\u5212\u5305\u62ec IPv6 \u652f\u6301\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u5b9e\u65bd IPv6 \u96c6\u7fa4\u3002\u60a8\u53ef\u4ee5\u8bbe\u7f6e IPv6 EKS \u96c6\u7fa4\u5e76\u8fc1\u79fb\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5728 IPv6 EKS \u96c6\u7fa4\u4e2d\uff0cKubernetes \u548c Pod \u90fd\u83b7\u5f97 IPv6 \u5730\u5740\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e0e IPv4 \u548c IPv6 \u7aef\u70b9\u8fdb\u884c\u901a\u4fe1\u3002\u8bf7\u67e5\u770b\u8fd0\u884c IPv6 EKS \u96c6\u7fa4\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"zh/networking/custom-networking/#cg-nat","title":"\u8017\u5c3d CG-NAT \u7a7a\u95f4","text":"<p>\u6b64\u5916\uff0c\u5982\u679c\u60a8\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u6765\u81ea CG-NAT \u7a7a\u95f4\u7684 CIDR \u6216\u65e0\u6cd5\u5c06\u8f85\u52a9 CIDR \u4e0e\u96c6\u7fa4 VPC \u5173\u8054\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u63a2\u7d22\u5176\u4ed6\u9009\u9879\uff0c\u4f8b\u5982\u4f7f\u7528\u66ff\u4ee3 CNI\u3002\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u83b7\u5f97\u5546\u4e1a\u652f\u6301\u6216\u62e5\u6709\u8c03\u8bd5\u548c\u5411\u5f00\u6e90 CNI \u63d2\u4ef6\u9879\u76ee\u63d0\u4ea4\u8865\u4e01\u7684\u5185\u90e8\u77e5\u8bc6\u3002\u8bf7\u53c2\u9605\u66ff\u4ee3 CNI \u63d2\u4ef6\u7528\u6237\u6307\u5357\u4ee5\u4e86\u89e3\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002</p>"},{"location":"zh/networking/custom-networking/#nat","title":"\u4f7f\u7528\u79c1\u6709 NAT \u7f51\u5173","text":"<p>Amazon VPC \u73b0\u5728\u63d0\u4f9b\u79c1\u6709 NAT \u7f51\u5173\u529f\u80fd\u3002Amazon \u7684\u79c1\u6709 NAT \u7f51\u5173\u4f7f\u79c1\u6709\u5b50\u7f51\u4e2d\u7684\u5b9e\u4f8b\u80fd\u591f\u8fde\u63a5\u5230\u5177\u6709\u91cd\u53e0 CIDR \u7684\u5176\u4ed6 VPC \u548c\u672c\u5730\u7f51\u7edc\u3002\u8003\u8651\u4f7f\u7528\u672c\u535a\u5ba2\u6587\u7ae0\u4e2d\u63cf\u8ff0\u7684\u65b9\u6cd5\u6765\u4f7f\u7528\u79c1\u6709 NAT \u7f51\u5173\u6765\u89e3\u51b3\u7531\u4e8e\u91cd\u53e0 CIDR \u800c\u5bfc\u81f4\u7684 EKS \u5de5\u4f5c\u8d1f\u8f7d\u901a\u4fe1\u95ee\u9898\uff0c\u8fd9\u662f\u6211\u4eec\u5ba2\u6237\u8868\u8fbe\u7684\u4e00\u4e2a\u91cd\u5927\u7591\u8651\u3002\u81ea\u5b9a\u4e49\u7f51\u7edc\u65e0\u6cd5\u5355\u72ec\u89e3\u51b3\u91cd\u53e0 CIDR \u7684\u56f0\u96be\uff0c\u5e76\u4e14\u589e\u52a0\u4e86\u914d\u7f6e\u6311\u6218\u3002</p> <p>\u6b64\u535a\u5ba2\u6587\u7ae0\u5b9e\u73b0\u4e2d\u4f7f\u7528\u7684\u7f51\u7edc\u67b6\u6784\u9075\u5faa Amazon VPC \u6587\u6863\u4e2d\u542f\u7528\u91cd\u53e0\u7f51\u7edc\u4e4b\u95f4\u7684\u901a\u4fe1\u4e0b\u7684\u5efa\u8bae\u3002\u5982\u672c\u535a\u5ba2\u6587\u7ae0\u6240\u793a\uff0c\u60a8\u53ef\u4ee5\u5c06\u79c1\u6709 NAT \u7f51\u5173\u7684\u4f7f\u7528\u4e0e RFC6598 \u5730\u5740\u7ed3\u5408\u8d77\u6765\uff0c\u4ee5\u7ba1\u7406\u5ba2\u6237\u7684\u79c1\u6709 IP \u8017\u5c3d\u95ee\u9898\u3002EKS \u96c6\u7fa4\u3001\u5de5\u4f5c\u8282\u70b9\u90e8\u7f72\u5728\u4e0d\u53ef\u8def\u7531\u7684 100.64.0.0/16 VPC \u8f85\u52a9 CIDR \u8303\u56f4\u5185\uff0c\u800c\u79c1\u6709 NAT \u7f51\u5173\u3001NAT \u7f51\u5173\u5219\u90e8\u7f72\u5728\u53ef\u8def\u7531\u7684 RFC1918 CIDR \u8303\u56f4\u5185\u3002\u8be5\u535a\u5ba2\u89e3\u91ca\u4e86\u5982\u4f55\u4f7f\u7528 Transit Gateway \u8fde\u63a5 VPC \u4ee5\u4fc3\u8fdb\u8de8\u5177\u6709\u91cd\u53e0\u4e0d\u53ef\u8def\u7531 CIDR \u8303\u56f4\u7684 VPC \u7684\u901a\u4fe1\u3002\u5bf9\u4e8e VPC \u4e2d\u4e0d\u53ef\u8def\u7531\u5730\u5740\u8303\u56f4\u5185\u7684 EKS \u8d44\u6e90\u9700\u8981\u4e0e\u6ca1\u6709\u91cd\u53e0\u5730\u5740\u8303\u56f4\u7684\u5176\u4ed6 VPC \u901a\u4fe1\u7684\u7528\u4f8b\uff0c\u5ba2\u6237\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 VPC \u5bf9\u7b49\u8fde\u63a5\u6765\u4e92\u8fde\u8fd9\u4e9b VPC\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ef\u80fd\u4f1a\u5e26\u6765\u6f5c\u5728\u7684\u6210\u672c\u8282\u7ea6\uff0c\u56e0\u4e3a\u6240\u6709\u5728\u53ef\u7528\u533a\u5185\u901a\u8fc7 VPC \u5bf9\u7b49\u8fde\u63a5\u4f20\u8f93\u7684\u6570\u636e\u73b0\u5728\u90fd\u662f\u514d\u8d39\u7684\u3002</p> <p></p>"},{"location":"zh/networking/custom-networking/#pod","title":"\u8282\u70b9\u548c Pod \u7684\u552f\u4e00\u7f51\u7edc","text":"<p>\u5982\u679c\u60a8\u9700\u8981\u5c06\u8282\u70b9\u548c Pod \u9694\u79bb\u5230\u7279\u5b9a\u7f51\u7edc\u4ee5\u6ee1\u8db3\u5b89\u5168\u9700\u6c42\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u5c06\u8282\u70b9\u548c Pod \u90e8\u7f72\u5230\u6765\u81ea\u8f83\u5927\u8f85\u52a9 CIDR \u5757 (\u4f8b\u5982 100.64.0.0/8) \u7684\u5b50\u7f51\u3002\u5728\u60a8\u7684 VPC \u4e2d\u5b89\u88c5\u65b0\u7684 CIDR \u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8f85\u52a9 CIDR \u90e8\u7f72\u53e6\u4e00\u4e2a\u8282\u70b9\u7ec4\uff0c\u5e76\u6392\u7a7a\u539f\u59cb\u8282\u70b9\u4ee5\u81ea\u52a8\u5c06 Pod \u91cd\u65b0\u90e8\u7f72\u5230\u65b0\u7684\u5de5\u4f5c\u8282\u70b9\u3002\u6709\u5173\u5982\u4f55\u5b9e\u65bd\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6b64\u535a\u5ba2\u6587\u7ae0\u3002</p> <p>\u4e0b\u56fe\u6240\u793a\u7684\u8bbe\u7f6e\u4e2d\u672a\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002\u76f8\u53cd\uff0cKubernetes \u5de5\u4f5c\u8282\u70b9\u90e8\u7f72\u5728\u6765\u81ea VPC \u8f85\u52a9 VPC CIDR \u8303\u56f4 (\u5982 100.64.0.0/10) \u7684\u5b50\u7f51\u4e0a\u3002\u60a8\u53ef\u4ee5\u4fdd\u6301 EKS \u96c6\u7fa4\u8fd0\u884c (\u63a7\u5236\u5e73\u9762\u5c06\u4fdd\u7559\u5728\u539f\u59cb\u5b50\u7f51/s \u4e0a)\uff0c\u4f46\u8282\u70b9\u548c Pod \u5c06\u88ab\u79fb\u52a8\u5230\u8f85\u52a9\u5b50\u7f51/s\u3002\u8fd9\u662f\u53e6\u4e00\u79cd\u7f13\u89e3 VPC \u4e2d IP \u8017\u5c3d\u98ce\u9669\u7684\u975e\u5e38\u89c4\u65b9\u6cd5\u3002\u6211\u4eec\u5efa\u8bae\u5728\u91cd\u65b0\u90e8\u7f72 Pod \u5230\u65b0\u5de5\u4f5c\u8282\u70b9\u4e4b\u524d\u6392\u7a7a\u65e7\u8282\u70b9\u3002</p> <p></p>"},{"location":"zh/networking/custom-networking/#_6","title":"\u4f7f\u7528\u53ef\u7528\u533a\u6807\u7b7e\u81ea\u52a8\u5316\u914d\u7f6e","text":"<p>\u60a8\u53ef\u4ee5\u4f7f Kubernetes \u81ea\u52a8\u5e94\u7528\u4e0e\u5de5\u4f5c\u8282\u70b9\u53ef\u7528\u533a (AZ) \u5bf9\u5e94\u7684 ENIConfig\u3002</p> <p>Kubernetes \u4f1a\u81ea\u52a8\u5c06\u6807\u7b7e <code>topology.kubernetes.io/zone</code> \u6dfb\u52a0\u5230\u60a8\u7684\u5de5\u4f5c\u8282\u70b9\u3002\u5f53\u60a8\u6bcf\u4e2a\u53ef\u7528\u533a\u53ea\u6709\u4e00\u4e2a\u8f85\u52a9\u5b50\u7f51 (\u5907\u7528 CIDR) \u65f6\uff0cAmazon EKS \u5efa\u8bae\u5c06\u53ef\u7528\u533a\u7528\u4f5c ENI \u914d\u7f6e\u540d\u79f0\u3002\u8bf7\u6ce8\u610f\uff0c\u6807\u7b7e <code>failure-domain.beta.kubernetes.io/zone</code> \u5df2\u88ab\u5f03\u7528\uff0c\u5e76\u88ab\u6807\u7b7e <code>topology.kubernetes.io/zone</code> \u53d6\u4ee3\u3002</p> <ol> <li>\u5c06 <code>name</code> \u5b57\u6bb5\u8bbe\u7f6e\u4e3a VPC \u7684\u53ef\u7528\u533a\u3002</li> <li>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u7528\u81ea\u52a8\u914d\u7f6e\uff1a</li> </ol> <pre><code>kubectl set env daemonset aws-node -n kube-system AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true\n</code></pre> <p>\u5982\u679c\u60a8\u6bcf\u4e2a\u53ef\u7528\u533a\u6709\u591a\u4e2a\u8f85\u52a9\u5b50\u7f51\uff0c\u60a8\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7279\u5b9a\u7684 <code>ENI_CONFIG_LABEL_DEF</code>\u3002\u60a8\u53ef\u4ee5\u8003\u8651\u5c06 <code>ENI_CONFIG_LABEL_DEF</code> \u914d\u7f6e\u4e3a <code>k8s.amazonaws.com/eniConfig</code>\uff0c\u5e76\u4f7f\u7528\u81ea\u5b9a\u4e49 eniConfig \u540d\u79f0\u6807\u8bb0\u8282\u70b9\uff0c\u4f8b\u5982 <code>k8s.amazonaws.com/eniConfig=us-west-2a-subnet-1</code> \u548c <code>k8s.amazonaws.com/eniConfig=us-west-2a-subnet-2</code>\u3002</p>"},{"location":"zh/networking/custom-networking/#pod_1","title":"\u914d\u7f6e\u8f85\u52a9\u7f51\u7edc\u65f6\u66ff\u6362 Pod","text":"<p>\u542f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u4e0d\u4f1a\u4fee\u6539\u73b0\u6709\u8282\u70b9\u3002\u81ea\u5b9a\u4e49\u7f51\u7edc\u662f\u4e00\u79cd\u7834\u574f\u6027\u64cd\u4f5c\u3002\u6211\u4eec\u5efa\u8bae\u5728\u542f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u540e\uff0c\u4e0d\u8981\u6eda\u52a8\u66ff\u6362\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u5de5\u4f5c\u8282\u70b9\uff0c\u800c\u662f\u66f4\u65b0 EKS \u5165\u95e8\u6307\u5357\u4e2d\u7684 AWS CloudFormation \u6a21\u677f\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u8be5\u8d44\u6e90\u8c03\u7528 Lambda \u51fd\u6570\u6765\u5728\u5de5\u4f5c\u8282\u70b9\u914d\u7f6e\u4e4b\u524d\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u66f4\u65b0 <code>aws-node</code> Daemonset \u4ee5\u542f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002</p> <p>\u5982\u679c\u60a8\u5728\u5207\u6362\u5230\u81ea\u5b9a\u4e49 CNI \u7f51\u7edc\u529f\u80fd\u4e4b\u524d\u96c6\u7fa4\u4e2d\u6709\u4efb\u4f55\u8282\u70b9\u6b63\u5728\u8fd0\u884c Pod\uff0c\u60a8\u5e94\u8be5\u9694\u79bb\u5e76\u6392\u7a7a\u8282\u70b9\u4ee5\u4f18\u96c5\u5730\u5173\u95ed Pod \u5e76\u7ec8\u6b62\u8282\u70b9\u3002\u53ea\u6709\u4e0e ENIConfig \u6807\u7b7e\u6216\u6ce8\u91ca\u5339\u914d\u7684\u65b0\u8282\u70b9\u624d\u4f1a\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\uff0c\u56e0\u6b64\u5728\u8fd9\u4e9b\u65b0\u8282\u70b9\u4e0a\u8c03\u5ea6\u7684 Pod \u624d\u80fd\u4ece\u8f85\u52a9 CIDR \u83b7\u53d6 IP \u5730\u5740\u3002</p>"},{"location":"zh/networking/custom-networking/#pod_2","title":"\u8ba1\u7b97\u6bcf\u4e2a\u8282\u70b9\u7684\u6700\u5927 Pod \u6570\u91cf","text":"<p>\u7531\u4e8e\u8282\u70b9\u7684\u4e3b\u7f51\u7edc\u63a5\u53e3\u4e0d\u518d\u7528\u4e8e\u5206\u914d Pod IP \u5730\u5740\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u7ed9\u5b9a EC2 \u5b9e\u4f8b\u7c7b\u578b\u4e0a\u8fd0\u884c\u7684 Pod \u6570\u91cf\u4f1a\u51cf\u5c11\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u9650\u5236\uff0c\u60a8\u53ef\u4ee5\u4e0e\u81ea\u5b9a\u4e49\u7f51\u7edc\u4e00\u8d77\u4f7f\u7528\u524d\u7f00\u5206\u914d\u3002\u4f7f\u7528\u524d\u7f00\u5206\u914d\u65f6\uff0c\u6bcf\u4e2a\u8f85\u52a9 IP \u5c06\u5728\u8f85\u52a9\u7f51\u7edc\u63a5\u53e3\u4e0a\u66ff\u6362\u4e3a /28 \u524d\u7f00\u3002</p> <p>\u8003\u8651\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u65f6 m5.large \u5b9e\u4f8b\u7684\u6700\u5927 Pod \u6570\u91cf\u3002</p> <p>\u5982\u679c\u4e0d\u4f7f\u7528\u524d\u7f00\u5206\u914d\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u7684\u6700\u5927 Pod \u6570\u91cf\u4e3a 29</p> <ul> <li>((3 \u4e2a\u7f51\u7edc\u63a5\u53e3 - 1) * (\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3 10 \u4e2a\u8f85\u52a9 IP - 1)) + 2 = 20</li> </ul> <p>\u542f\u7528\u524d\u7f00\u9644\u52a0\u4f1a\u5c06 Pod \u6570\u91cf\u589e\u52a0\u5230 290\u3002</p> <ul> <li>(((3 \u4e2a\u7f51\u7edc\u63a5\u53e3 - 1) * ((\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3 10 \u4e2a\u8f85\u52a9 IP - 1) * 16)) + 2 = 290</li> </ul> <p>\u4f46\u662f\uff0c\u6211\u4eec\u5efa\u8bae\u5c06 max-pods \u8bbe\u7f6e\u4e3a 110 \u800c\u4e0d\u662f 290\uff0c\u56e0\u4e3a\u8be5\u5b9e\u4f8b\u7684\u865a\u62df CPU \u6570\u91cf\u76f8\u5f53\u5c0f\u3002\u5bf9\u4e8e\u8f83\u5927\u7684\u5b9e\u4f8b\uff0cEKS \u5efa\u8bae\u5c06 max pods \u503c\u8bbe\u7f6e\u4e3a 250\u3002\u5f53\u4f7f\u7528\u8f83\u5c0f\u5b9e\u4f8b\u7c7b\u578b (\u4f8b\u5982 m5.large) \u7684\u524d\u7f00\u9644\u52a0\u65f6\uff0c\u60a8\u53ef\u80fd\u4f1a\u5728\u8017\u5c3d\u5b9e\u4f8b\u7684 CPU \u548c\u5185\u5b58\u8d44\u6e90\u4e4b\u524d\u5c31\u8017\u5c3d\u5176 IP \u5730\u5740\u3002</p> <p>Info</p> <p>\u5f53 CNI \u524d\u7f00\u4e3a\u7f51\u7edc\u63a5\u53e3\u5206\u914d /28 \u524d\u7f00\u65f6\uff0c\u5b83\u5fc5\u987b\u662f\u4e00\u4e2a\u8fde\u7eed\u7684 IP \u5730\u5740\u5757\u3002\u5982\u679c\u751f\u6210\u524d\u7f00\u7684\u5b50\u7f51\u9ad8\u5ea6\u5206\u7247\uff0c\u5219\u524d\u7f00\u9644\u52a0\u53ef\u80fd\u4f1a\u5931\u8d25\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e3a\u96c6\u7fa4\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4e13\u7528 VPC \u6216\u4e3a\u524d\u7f00\u9644\u52a0\u4fdd\u7559\u4e00\u7ec4\u4e13\u7528\u5b50\u7f51 CIDR \u6765\u7f13\u89e3\u8fd9\u79cd\u60c5\u51b5\u3002\u6709\u5173\u6b64\u4e3b\u9898\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u8bbf\u95ee\u5b50\u7f51 CIDR \u4fdd\u7559\u3002</p>"},{"location":"zh/networking/custom-networking/#cg-nat_1","title":"\u8bc6\u522b\u73b0\u6709 CG-NAT \u7a7a\u95f4\u4f7f\u7528\u60c5\u51b5","text":"<p>\u81ea\u5b9a\u4e49\u7f51\u7edc\u53ef\u4ee5\u7f13\u89e3 IP \u8017\u5c3d\u95ee\u9898\uff0c\u4f46\u65e0\u6cd5\u89e3\u51b3\u6240\u6709\u6311\u6218\u3002\u5982\u679c\u60a8\u5df2\u7ecf\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528 CG-NAT \u7a7a\u95f4\uff0c\u6216\u8005\u6839\u672c\u65e0\u6cd5\u5c06\u8f85\u52a9 CIDR \u4e0e\u96c6\u7fa4 VPC \u5173\u8054\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u63a2\u7d22\u5176\u4ed6\u9009\u9879\uff0c\u5982\u4f7f\u7528\u66ff\u4ee3 CNI \u6216\u8fc1\u79fb\u5230 IPv6 \u96c6\u7fa4\u3002</p>"},{"location":"zh/networking/index/","title":"Amazon EKS \u7f51\u7edc\u6700\u4f73\u5b9e\u8df5\u6307\u5357","text":"<p>\u4e86\u89e3 Kubernetes \u7f51\u7edc\u5bf9\u4e8e\u9ad8\u6548\u8fd0\u884c\u96c6\u7fa4\u548c\u5e94\u7528\u7a0b\u5e8f\u81f3\u5173\u91cd\u8981\u3002Pod \u7f51\u7edc(\u4e5f\u79f0\u4e3a\u96c6\u7fa4\u7f51\u7edc)\u662f Kubernetes \u7f51\u7edc\u7684\u6838\u5fc3\u3002Kubernetes \u652f\u6301 Container Network Interface (CNI) \u63d2\u4ef6\u7528\u4e8e\u96c6\u7fa4\u7f51\u7edc\u3002</p> <p>Amazon EKS \u5b98\u65b9\u652f\u6301 Amazon Virtual Private Cloud (VPC) CNI \u63d2\u4ef6\u6765\u5b9e\u73b0 Kubernetes Pod \u7f51\u7edc\u3002VPC CNI \u63d0\u4f9b\u4e0e AWS VPC \u7684\u672c\u5730\u96c6\u6210\uff0c\u5e76\u4ee5\u5e95\u5c42\u6a21\u5f0f\u5de5\u4f5c\u3002\u5728\u5e95\u5c42\u6a21\u5f0f\u4e0b\uff0cPod \u548c\u4e3b\u673a\u4f4d\u4e8e\u540c\u4e00\u7f51\u7edc\u5c42\uff0c\u5e76\u5171\u4eab\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u3002\u4ece\u96c6\u7fa4\u548c VPC \u7684\u89d2\u5ea6\u6765\u770b\uff0cPod \u7684 IP \u5730\u5740\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u672c\u6307\u5357\u4ecb\u7ecd\u4e86 Amazon VPC Container Network Interface(VPC CNI) \u5728 Kubernetes \u96c6\u7fa4\u7f51\u7edc\u7684\u4e0a\u4e0b\u6587\u4e2d\u3002VPC CNI \u662f EKS \u652f\u6301\u7684\u9ed8\u8ba4\u7f51\u7edc\u63d2\u4ef6\uff0c\u56e0\u6b64\u662f\u672c\u6307\u5357\u7684\u91cd\u70b9\u3002VPC CNI \u53ef\u9ad8\u5ea6\u914d\u7f6e\u4ee5\u652f\u6301\u4e0d\u540c\u7684\u7528\u4f8b\u3002\u672c\u6307\u5357\u8fd8\u5305\u62ec\u5173\u4e8e\u4e0d\u540c VPC CNI \u7528\u4f8b\u3001\u64cd\u4f5c\u6a21\u5f0f\u3001\u5b50\u7ec4\u4ef6\u7684\u4e13\u95e8\u90e8\u5206\uff0c\u4ee5\u53ca\u76f8\u5173\u5efa\u8bae\u3002</p> <p>Amazon EKS \u8fd0\u884c\u4e0a\u6e38 Kubernetes \u5e76\u901a\u8fc7\u4e86 Kubernetes \u4e00\u81f4\u6027\u8ba4\u8bc1\u3002\u5c3d\u7ba1\u60a8\u53ef\u4ee5\u4f7f\u7528\u66ff\u4ee3 CNI \u63d2\u4ef6\uff0c\u4f46\u672c\u6307\u5357\u4e0d\u63d0\u4f9b\u7ba1\u7406\u66ff\u4ee3 CNI \u7684\u5efa\u8bae\u3002\u8bf7\u67e5\u770b EKS \u66ff\u4ee3 CNI \u6587\u6863\uff0c\u4e86\u89e3\u5408\u4f5c\u4f19\u4f34\u5217\u8868\u548c\u6709\u6548\u7ba1\u7406\u66ff\u4ee3 CNI \u7684\u8d44\u6e90\u3002</p>"},{"location":"zh/networking/index/#kubernetes","title":"Kubernetes \u7f51\u7edc\u6a21\u578b","text":"<p>Kubernetes \u5bf9\u96c6\u7fa4\u7f51\u7edc\u63d0\u51fa\u4ee5\u4e0b\u8981\u6c42\uff1a</p> <ul> <li>\u5728\u540c\u4e00\u8282\u70b9\u4e0a\u8c03\u5ea6\u7684 Pod \u5fc5\u987b\u80fd\u591f\u5728\u4e0d\u4f7f\u7528 NAT (\u7f51\u7edc\u5730\u5740\u8f6c\u6362) \u7684\u60c5\u51b5\u4e0b\u4e0e\u5176\u4ed6 Pod \u901a\u4fe1\u3002</li> <li>\u8fd0\u884c\u5728\u7279\u5b9a\u8282\u70b9\u4e0a\u7684\u6240\u6709\u7cfb\u7edf\u5b88\u62a4\u8fdb\u7a0b (\u4f8b\u5982\u540e\u53f0\u8fdb\u7a0b kubelet) \u90fd\u53ef\u4ee5\u4e0e\u8fd0\u884c\u5728\u540c\u4e00\u8282\u70b9\u4e0a\u7684 Pod \u901a\u4fe1\u3002</li> <li>\u4f7f\u7528 host network \u7684 Pod \u5fc5\u987b\u80fd\u591f\u5728\u4e0d\u4f7f\u7528 NAT \u7684\u60c5\u51b5\u4e0b\u4e0e\u6240\u6709\u5176\u4ed6\u8282\u70b9\u4e0a\u7684\u6240\u6709\u5176\u4ed6 Pod \u8054\u7cfb\u3002</li> </ul> <p>\u6709\u5173 Kubernetes \u5bf9\u517c\u5bb9\u7f51\u7edc\u5b9e\u73b0\u7684\u671f\u671b\uff0c\u8bf7\u53c2\u9605 Kubernetes \u7f51\u7edc\u6a21\u578b\u3002\u4e0b\u56fe\u8bf4\u660e\u4e86 Pod \u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u4e0e\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p> <p></p>"},{"location":"zh/networking/index/#cni","title":"\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3 (CNI)","text":"<p>Kubernetes \u652f\u6301 CNI \u89c4\u8303\u548c\u63d2\u4ef6\u6765\u5b9e\u73b0 Kubernetes \u7f51\u7edc\u6a21\u578b\u3002CNI \u7531\u4e00\u4e2a \u89c4\u8303 (\u5f53\u524d\u7248\u672c\u4e3a 1.0.0) \u548c\u7528\u4e8e\u7f16\u5199\u63d2\u4ef6\u4ee5\u914d\u7f6e\u5bb9\u5668\u4e2d\u7f51\u7edc\u63a5\u53e3\u7684\u5e93\u7ec4\u6210\uff0c\u4ee5\u53ca\u8bb8\u591a\u53d7\u652f\u6301\u7684\u63d2\u4ef6\u3002CNI \u4ec5\u5173\u6ce8\u5bb9\u5668\u7684\u7f51\u7edc\u8fde\u63a5\u4ee5\u53ca\u5728\u5220\u9664\u5bb9\u5668\u65f6\u79fb\u9664\u5df2\u5206\u914d\u7684\u8d44\u6e90\u3002</p> <p>\u901a\u8fc7\u4f20\u9012 <code>--network-plugin=cni</code> \u547d\u4ee4\u884c\u9009\u9879\u542f\u7528 CNI \u63d2\u4ef6\u3002kubelet \u4ece <code>--cni-conf-dir</code> (\u9ed8\u8ba4\u4e3a /etc/cni/net.d) \u8bfb\u53d6\u6587\u4ef6\uff0c\u5e76\u4f7f\u7528\u8be5\u6587\u4ef6\u4e2d\u7684 CNI \u914d\u7f6e\u4e3a\u6bcf\u4e2a Pod \u8bbe\u7f6e\u7f51\u7edc\u3002CNI \u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u4e0e CNI \u89c4\u8303 (\u6700\u4f4e\u7248\u672c v0.4.0) \u5339\u914d\uff0c\u5e76\u4e14\u914d\u7f6e\u4e2d\u5f15\u7528\u7684\u4efb\u4f55\u6240\u9700 CNI \u63d2\u4ef6\u90fd\u5fc5\u987b\u5b58\u5728\u4e8e <code>--cni-bin-dir</code> \u76ee\u5f55 (\u9ed8\u8ba4\u4e3a /opt/cni/bin) \u4e2d\u3002\u5982\u679c\u76ee\u5f55\u4e2d\u6709\u591a\u4e2a CNI \u914d\u7f6e\u6587\u4ef6\uff0ckubelet \u5c06\u4f7f\u7528\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5217\u7684\u7b2c\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"zh/networking/index/#amazon-virtual-private-cloud-vpc-cni","title":"Amazon Virtual Private Cloud (VPC) CNI","text":"<p>AWS \u63d0\u4f9b\u7684 VPC CNI \u662f EKS \u96c6\u7fa4\u7684\u9ed8\u8ba4\u7f51\u7edc\u63d2\u4ef6\u3002\u5728\u914d\u7f6e EKS \u96c6\u7fa4\u65f6\uff0c\u9ed8\u8ba4\u5b89\u88c5 VPC CNI \u63d2\u4ef6\u3002VPC CNI \u5728 Kubernetes \u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c\u3002VPC CNI \u63d2\u4ef6\u7531 CNI \u4e8c\u8fdb\u5236\u6587\u4ef6\u548c IP \u5730\u5740\u7ba1\u7406 (ipamd) \u63d2\u4ef6\u7ec4\u6210\u3002CNI \u4ece VPC \u7f51\u7edc\u4e3a Pod \u5206\u914d\u4e00\u4e2a IP \u5730\u5740\u3002ipamd \u4e3a\u6bcf\u4e2a Kubernetes \u8282\u70b9\u7ba1\u7406 AWS Elastic Networking Interfaces (ENIs)\uff0c\u5e76\u7ef4\u62a4 IP \u7684\u9884\u70ed\u6c60\u3002VPC CNI \u63d0\u4f9b\u4e86\u9884\u5206\u914d ENI \u548c IP \u5730\u5740\u7684\u914d\u7f6e\u9009\u9879\uff0c\u4ee5\u5b9e\u73b0\u5feb\u901f\u7684 Pod \u542f\u52a8\u65f6\u95f4\u3002\u6709\u5173\u63a8\u8350\u7684\u63d2\u4ef6\u7ba1\u7406\u6700\u4f73\u5b9e\u8df5\uff0c\u8bf7\u53c2\u9605 Amazon VPC CNI\u3002</p> <p>\u5728\u521b\u5efa\u96c6\u7fa4\u65f6\uff0cAmazon EKS \u5efa\u8bae\u60a8\u81f3\u5c11\u5728\u4e24\u4e2a\u53ef\u7528\u533a\u4e2d\u6307\u5b9a\u5b50\u7f51\u3002Amazon VPC CNI \u4ece\u8282\u70b9\u5b50\u7f51\u4e3a Pod \u5206\u914d IP \u5730\u5740\u3002\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u68c0\u67e5\u5b50\u7f51\u4e2d\u53ef\u7528\u7684 IP \u5730\u5740\u3002\u5728\u90e8\u7f72 EKS \u96c6\u7fa4\u4e4b\u524d\uff0c\u8bf7\u8003\u8651 VPC \u548c\u5b50\u7f51 \u5efa\u8bae\u3002</p> <p>Amazon VPC CNI \u4ece\u9644\u52a0\u5230\u8282\u70b9\u4e3b ENI \u7684\u5b50\u7f51\u4e2d\u5206\u914d\u4e00\u4e2a\u9884\u70ed\u6c60\u7684 ENI \u548c\u8f85\u52a9 IP \u5730\u5740\u3002\u8fd9\u79cd VPC CNI \u6a21\u5f0f\u79f0\u4e3a \"\u8f85\u52a9 IP \u6a21\u5f0f\"\u3002Pod \u6570\u91cf (Pod \u5bc6\u5ea6) \u7531\u5b9e\u4f8b\u7c7b\u578b\u5b9a\u4e49\u7684 ENI \u6570\u91cf\u548c\u6bcf\u4e2a ENI \u7684 IP \u5730\u5740\u6570\u91cf (\u9650\u5236) \u51b3\u5b9a\u3002\u8f85\u52a9\u6a21\u5f0f\u662f\u9ed8\u8ba4\u6a21\u5f0f\uff0c\u9002\u7528\u4e8e\u8f83\u5c0f\u7684\u96c6\u7fa4\u548c\u8f83\u5c0f\u7684\u5b9e\u4f8b\u7c7b\u578b\u3002\u5982\u679c\u60a8\u9047\u5230 Pod \u5bc6\u5ea6\u6311\u6218\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 \u524d\u7f00\u6a21\u5f0f\u3002\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4e3a ENI \u5206\u914d\u524d\u7f00\u6765\u589e\u52a0\u8282\u70b9\u4e0a\u53ef\u7528\u4e8e Pod \u7684 IP \u5730\u5740\u6570\u91cf\u3002</p> <p>Amazon VPC CNI \u4e0e AWS VPC \u672c\u5730\u96c6\u6210\uff0c\u5141\u8bb8\u7528\u6237\u5c06\u73b0\u6709\u7684 AWS VPC \u7f51\u7edc\u548c\u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u5e94\u7528\u4e8e\u6784\u5efa Kubernetes \u96c6\u7fa4\u3002\u8fd9\u5305\u62ec\u80fd\u591f\u4f7f\u7528 VPC \u6d41\u65e5\u5fd7\u3001VPC \u8def\u7531\u7b56\u7565\u548c\u5b89\u5168\u7ec4\u6765\u9694\u79bb\u7f51\u7edc\u6d41\u91cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAmazon VPC CNI \u5c06\u4e0e\u8282\u70b9\u4e3b ENI \u5173\u8054\u7684\u5b89\u5168\u7ec4\u5e94\u7528\u4e8e Pod\u3002\u5f53\u60a8\u5e0c\u671b\u4e3a Pod \u5206\u914d\u4e0d\u540c\u7684\u7f51\u7edc\u89c4\u5219\u65f6\uff0c\u8bf7\u8003\u8651\u542f\u7528 Pod \u5b89\u5168\u7ec4\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cVPC CNI \u4ece\u5206\u914d\u7ed9\u8282\u70b9\u4e3b ENI \u7684\u5b50\u7f51\u4e3a Pod \u5206\u914d IP \u5730\u5740\u3002\u5728\u8fd0\u884c\u6570\u5343\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5927\u578b\u96c6\u7fa4\u65f6\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230 IPv4 \u5730\u5740\u77ed\u7f3a\u7684\u60c5\u51b5\u3002AWS VPC \u5141\u8bb8\u60a8\u901a\u8fc7 \u5206\u914d\u8f85\u52a9 CIDR \u6765\u6269\u5c55\u53ef\u7528\u7684 IP\uff0c\u4ece\u800c\u89e3\u51b3 IPv4 CIDR \u5757\u8017\u5c3d\u7684\u95ee\u9898\u3002AWS VPC CNI \u5141\u8bb8\u60a8\u4e3a Pod \u4f7f\u7528\u4e0d\u540c\u7684\u5b50\u7f51 CIDR \u8303\u56f4\u3002\u8fd9\u4e2a VPC CNI \u529f\u80fd\u79f0\u4e3a \u81ea\u5b9a\u4e49\u7f51\u7edc\u3002\u60a8\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u6765\u4e0e EKS \u4e00\u8d77\u4f7f\u7528 100.64.0.0/10 \u548c 198.19.0.0/16 CIDR (CG-NAT)\u3002\u8fd9\u6709\u6548\u5730\u5141\u8bb8\u60a8\u521b\u5efa\u4e00\u4e2a\u73af\u5883\uff0c\u5728\u8be5\u73af\u5883\u4e2d Pod \u4e0d\u518d\u6d88\u8017\u60a8 VPC \u4e2d\u7684\u4efb\u4f55 RFC1918 IP \u5730\u5740\u3002</p> <p>\u81ea\u5b9a\u4e49\u7f51\u7edc\u662f\u89e3\u51b3 IPv4 \u5730\u5740\u8017\u5c3d\u95ee\u9898\u7684\u4e00\u79cd\u9009\u62e9\uff0c\u4f46\u9700\u8981\u64cd\u4f5c\u5f00\u9500\u3002\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 IPv6 \u96c6\u7fa4\u800c\u4e0d\u662f\u81ea\u5b9a\u4e49\u7f51\u7edc\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u5177\u4f53\u800c\u8a00\uff0c\u5982\u679c\u60a8\u5df2\u5b8c\u5168\u8017\u5c3d\u4e86 VPC \u7684\u6240\u6709\u53ef\u7528 IPv4 \u5730\u5740\u7a7a\u95f4\uff0c\u6211\u4eec\u5efa\u8bae\u8fc1\u79fb\u5230 IPv6 \u96c6\u7fa4\u3002\u8bc4\u4f30\u60a8\u7ec4\u7ec7\u652f\u6301 IPv6 \u7684\u8ba1\u5212\uff0c\u5e76\u8003\u8651\u6295\u8d44 IPv6 \u662f\u5426\u53ef\u80fd\u5177\u6709\u66f4\u957f\u8fdc\u7684\u4ef7\u503c\u3002</p> <p>EKS \u5bf9 IPv6 \u7684\u652f\u6301\u91cd\u70b9\u89e3\u51b3\u4e86\u7531\u4e8e IPv4 \u5730\u5740\u7a7a\u95f4\u6709\u9650\u800c\u5bfc\u81f4\u7684 IP \u8017\u5c3d\u95ee\u9898\u3002\u4e3a\u4e86\u54cd\u5e94\u5ba2\u6237\u9047\u5230\u7684 IPv4 \u8017\u5c3d\u95ee\u9898\uff0cEKS \u4f18\u5148\u8003\u8651\u4e86 IPv6 \u4e13\u7528 Pod \u800c\u4e0d\u662f\u53cc\u6808 Pod\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cPod \u53ef\u80fd\u80fd\u591f\u8bbf\u95ee IPv4 \u8d44\u6e90\uff0c\u4f46\u5b83\u4eec\u4e0d\u4f1a\u4ece VPC CIDR \u8303\u56f4\u83b7\u5f97 IPv4 \u5730\u5740\u5206\u914d\u3002VPC CNI \u4ece AWS \u7ba1\u7406\u7684 VPC IPv6 CIDR \u5757\u4e3a Pod \u5206\u914d IPv6 \u5730\u5740\u3002</p>"},{"location":"zh/networking/index/#_1","title":"\u5b50\u7f51\u8ba1\u7b97\u5668","text":"<p>\u672c\u9879\u76ee\u5305\u62ec\u4e00\u4e2a \u5b50\u7f51\u8ba1\u7b97\u5668 Excel \u6587\u6863\u3002\u8be5\u8ba1\u7b97\u5668\u6587\u6863\u6839\u636e\u4e0d\u540c\u7684 ENI \u914d\u7f6e\u9009\u9879 (\u5982 <code>WARM_IP_TARGET</code> \u548c <code>WARM_ENI_TARGET</code>) \u6a21\u62df\u6307\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u7684 IP \u5730\u5740\u6d88\u8017\u60c5\u51b5\u3002\u8be5\u6587\u6863\u5305\u542b\u4e24\u4e2a\u5de5\u4f5c\u8868\uff0c\u7b2c\u4e00\u4e2a\u7528\u4e8e\u9884\u70ed ENI \u6a21\u5f0f\uff0c\u7b2c\u4e8c\u4e2a\u7528\u4e8e\u9884\u70ed IP \u6a21\u5f0f\u3002\u6709\u5173\u8fd9\u4e9b\u6a21\u5f0f\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b VPC CNI \u6307\u5357\u3002</p> <p>\u8f93\u5165\uff1a - \u5b50\u7f51 CIDR \u5927\u5c0f - \u9884\u70ed ENI \u76ee\u6807 \u6216 \u9884\u70ed IP \u76ee\u6807 - \u5b9e\u4f8b\u5217\u8868     - \u7c7b\u578b\u3001\u6570\u91cf\u4ee5\u53ca\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u8c03\u5ea6\u7684\u5de5\u4f5c\u8d1f\u8f7d Pod \u6570\u91cf</p> <p>\u8f93\u51fa\uff1a - \u6258\u7ba1\u7684\u603b Pod \u6570\u91cf - \u6d88\u8017\u7684\u5b50\u7f51 IP \u6570\u91cf - \u5269\u4f59\u7684\u5b50\u7f51 IP \u6570\u91cf - \u5b9e\u4f8b\u7ea7\u522b\u8be6\u7ec6\u4fe1\u606f     - \u6bcf\u4e2a\u5b9e\u4f8b\u7684\u9884\u70ed IP/ENI \u6570\u91cf     - \u6bcf\u4e2a\u5b9e\u4f8b\u7684\u6d3b\u52a8 IP/ENI \u6570\u91cf</p>"},{"location":"zh/networking/ip-optimization-strategies/","title":"\u4f18\u5316 IP \u5730\u5740\u5229\u7528\u7387","text":"<p>\u7531\u4e8e\u5e94\u7528\u7a0b\u5e8f\u73b0\u4ee3\u5316\uff0c\u5bb9\u5668\u5316\u73af\u5883\u7684\u89c4\u6a21\u6b63\u5728\u8fc5\u901f\u589e\u957f\u3002\u8fd9\u610f\u5473\u7740\u8d8a\u6765\u8d8a\u591a\u7684\u5de5\u4f5c\u8282\u70b9\u548c Pod \u88ab\u90e8\u7f72\u3002</p> <p>Amazon VPC CNI \u63d2\u4ef6\u4f1a\u4ece VPC \u7684 CIDR(s) \u4e3a\u6bcf\u4e2a Pod \u5206\u914d\u4e00\u4e2a IP \u5730\u5740\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982 VPC Flow Logs \u548c\u5176\u4ed6\u76d1\u63a7\u89e3\u51b3\u65b9\u6848\u7b49\u5de5\u5177\u6765\u5b8c\u5168\u67e5\u770b Pod \u5730\u5740\u3002\u6839\u636e\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf IP \u5730\u5740\u88ab Pod \u6d88\u8017\u3002</p> <p>\u5728\u8bbe\u8ba1\u60a8\u7684 AWS \u7f51\u7edc\u67b6\u6784\u65f6\uff0c\u4f18\u5316 Amazon EKS \u5728 VPC \u548c\u8282\u70b9\u7ea7\u522b\u7684 IP \u6d88\u8017\u975e\u5e38\u91cd\u8981\u3002\u8fd9\u5c06\u6709\u52a9\u4e8e\u60a8\u7f13\u89e3 IP \u8017\u5c3d\u95ee\u9898\u5e76\u63d0\u9ad8\u6bcf\u4e2a\u8282\u70b9\u7684 Pod \u5bc6\u5ea6\u3002</p> <p>\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c06\u8ba8\u8bba\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5b9e\u73b0\u8fd9\u4e9b\u76ee\u6807\u7684\u6280\u672f\u3002</p>"},{"location":"zh/networking/ip-optimization-strategies/#ip_1","title":"\u4f18\u5316\u8282\u70b9\u7ea7 IP \u6d88\u8017","text":"<p>\u524d\u7f00\u59d4\u6d3e\u662f Amazon Virtual Private Cloud (Amazon VPC) \u7684\u4e00\u9879\u529f\u80fd\uff0c\u5141\u8bb8\u60a8\u5c06 IPv4 \u6216 IPv6 \u524d\u7f00\u5206\u914d\u7ed9 Amazon Elastic Compute Cloud (Amazon EC2) \u5b9e\u4f8b\u3002\u5b83\u589e\u52a0\u4e86\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3 (ENI) \u7684 IP \u5730\u5740\u6570\u91cf\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u6bcf\u4e2a\u8282\u70b9\u7684 Pod \u5bc6\u5ea6\u5e76\u63d0\u9ad8\u4e86\u8ba1\u7b97\u6548\u7387\u3002\u524d\u7f00\u59d4\u6d3e\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002</p> <p>\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Linux \u8282\u70b9\u7684\u524d\u7f00\u59d4\u6d3e\u548c Windows \u8282\u70b9\u7684\u524d\u7f00\u59d4\u6d3e\u90e8\u5206\u3002</p>"},{"location":"zh/networking/ip-optimization-strategies/#ip_2","title":"\u7f13\u89e3 IP \u8017\u5c3d","text":"<p>\u4e3a\u4e86\u9632\u6b62\u60a8\u7684\u96c6\u7fa4\u6d88\u8017\u6240\u6709\u53ef\u7528\u7684 IP \u5730\u5740\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u5728\u8003\u8651\u589e\u957f\u7684\u60c5\u51b5\u4e0b\u8c03\u6574 VPC \u548c\u5b50\u7f51\u7684\u5927\u5c0f\u3002</p> <p>\u91c7\u7528 IPv6 \u662f\u4ece\u4e00\u5f00\u59cb\u5c31\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\u7684\u597d\u65b9\u6cd5\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u53ef\u6269\u5c55\u6027\u9700\u6c42\u8d85\u51fa\u4e86\u6700\u521d\u89c4\u5212\u4e14\u65e0\u6cd5\u91c7\u7528 IPv6 \u7684\u7ec4\u7ec7\uff0c\u6539\u8fdb VPC \u8bbe\u8ba1\u662f\u5e94\u5bf9 IP \u5730\u5740\u8017\u5c3d\u7684\u63a8\u8350\u505a\u6cd5\u3002\u5728 Amazon EKS \u5ba2\u6237\u4e2d\u6700\u5e38\u7528\u7684\u6280\u672f\u662f\u5411 VPC \u6dfb\u52a0\u4e0d\u53ef\u8def\u7531\u7684\u8f85\u52a9 CIDR\uff0c\u5e76\u914d\u7f6e VPC CNI \u5728\u4e3a Pod \u5206\u914d IP \u5730\u5740\u65f6\u4f7f\u7528\u8fd9\u4e2a\u989d\u5916\u7684 IP \u7a7a\u95f4\u3002\u8fd9\u901a\u5e38\u88ab\u79f0\u4e3a\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002</p> <p>\u6211\u4eec\u5c06\u4ecb\u7ecd\u60a8\u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9b Amazon VPC CNI \u53d8\u91cf\u6765\u4f18\u5316\u5206\u914d\u7ed9\u8282\u70b9\u7684 IP \u6696\u6c60\u3002\u6211\u4eec\u5c06\u5728\u672c\u8282\u7ed3\u5c3e\u4ecb\u7ecd\u4e00\u4e9b\u5176\u4ed6\u4e0d\u5c5e\u4e8e Amazon EKS \u672c\u8eab\u4f46\u53ef\u4ee5\u5e2e\u52a9\u7f13\u89e3 IP \u8017\u5c3d\u7684\u67b6\u6784\u6a21\u5f0f\u3002</p>"},{"location":"zh/networking/ip-optimization-strategies/#ipv6","title":"\u4f7f\u7528 IPv6 (\u63a8\u8350)","text":"<p>\u91c7\u7528 IPv6 \u662f\u89e3\u51b3 RFC1918 \u9650\u5236\u7684\u6700\u7b80\u5355\u65b9\u6cd5;\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5728\u9009\u62e9\u7f51\u7edc\u67b6\u6784\u65f6\u9996\u5148\u8003\u8651\u91c7\u7528 IPv6\u3002IPv6 \u63d0\u4f9b\u4e86\u66f4\u5927\u7684\u603b IP \u5730\u5740\u7a7a\u95f4\uff0c\u96c6\u7fa4\u7ba1\u7406\u5458\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u8fc1\u79fb\u548c\u6269\u5c55\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u4e0d\u5fc5\u82b1\u8d39\u7cbe\u529b\u6765\u89e3\u51b3 IPv4 \u9650\u5236\u3002</p> <p>Amazon EKS \u96c6\u7fa4\u652f\u6301 IPv4 \u548c IPv6\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cEKS \u96c6\u7fa4\u4f7f\u7528 IPv4 \u5730\u5740\u7a7a\u95f4\u3002\u5728\u521b\u5efa\u96c6\u7fa4\u65f6\u6307\u5b9a\u57fa\u4e8e IPv6 \u7684\u5730\u5740\u7a7a\u95f4\u5c06\u542f\u7528 IPv6 \u7684\u4f7f\u7528\u3002\u5728 IPv6 EKS \u96c6\u7fa4\u4e2d\uff0cPod \u548c\u670d\u52a1\u4f1a\u6536\u5230 IPv6 \u5730\u5740\uff0c\u540c\u65f6\u4fdd\u6301\u65e7\u7248 IPv4 \u7aef\u70b9\u8fde\u63a5\u5230\u8fd0\u884c\u5728 IPv6 \u96c6\u7fa4\u4e0a\u7684\u670d\u52a1\u4ee5\u53ca\u53cd\u5411\u8fde\u63a5\u7684\u80fd\u529b\u3002\u96c6\u7fa4\u5185\u7684\u6240\u6709 Pod \u5230 Pod \u901a\u4fe1\u59cb\u7ec8\u901a\u8fc7 IPv6 \u8fdb\u884c\u3002\u5728 VPC (/56) \u5185\uff0cIPv6 \u5b50\u7f51\u7684 IPv6 CIDR \u5757\u5927\u5c0f\u56fa\u5b9a\u4e3a /64\u3002\u8fd9\u63d0\u4f9b\u4e86\u5927\u7ea6 18 quintillion \u4e2a IPv6 \u5730\u5740\uff0c\u5141\u8bb8\u60a8\u5728 EKS \u4e0a\u6269\u5c55\u90e8\u7f72\u3002</p> <p>\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u8fd0\u884c IPv6 EKS \u96c6\u7fa4\u90e8\u5206\uff0c\u5982\u9700\u5b9e\u8df5\u4f53\u9a8c\uff0c\u8bf7\u53c2\u9605 \u4e86\u89e3 Amazon EKS \u4e0a\u7684 IPv6 \u90e8\u5206\u7684 IPv6 \u5b9e\u8df5\u7814\u8ba8\u4f1a\u3002</p> <p></p>"},{"location":"zh/networking/ip-optimization-strategies/#ipv4-ip","title":"\u4f18\u5316 IPv4 \u96c6\u7fa4\u4e2d\u7684 IP \u6d88\u8017","text":"<p>\u672c\u8282\u4e13\u95e8\u9488\u5bf9\u8fd0\u884c\u65e7\u7248\u5e94\u7528\u7a0b\u5e8f\u548c/\u6216\u5c1a\u672a\u51c6\u5907\u597d\u8fc1\u79fb\u5230 IPv6 \u7684\u5ba2\u6237\u3002\u867d\u7136\u6211\u4eec\u9f13\u52b1\u6240\u6709\u7ec4\u7ec7\u5c3d\u5feb\u8fc1\u79fb\u5230 IPv6\uff0c\u4f46\u6211\u4eec\u4e5f\u8ba4\u8bc6\u5230\uff0c\u6709\u4e9b\u7ec4\u7ec7\u53ef\u80fd\u4ecd\u9700\u8981\u5bfb\u627e\u5176\u4ed6\u65b9\u6cd5\u6765\u6269\u5c55\u5176\u4f7f\u7528 IPv4 \u7684\u5bb9\u5668\u5de5\u4f5c\u8d1f\u8f7d\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u8fd8\u5c06\u5f15\u5bfc\u60a8\u4e86\u89e3\u4f18\u5316 Amazon EKS \u96c6\u7fa4\u4e2d IPv4 (RFC1918) \u5730\u5740\u7a7a\u95f4\u6d88\u8017\u7684\u67b6\u6784\u6a21\u5f0f\u3002</p>"},{"location":"zh/networking/ip-optimization-strategies/#_1","title":"\u4e3a\u589e\u957f\u505a\u89c4\u5212","text":"<p>\u4f5c\u4e3a\u9632\u6b62 IP \u8017\u5c3d\u7684\u7b2c\u4e00\u9053\u9632\u7ebf\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u5728\u8003\u8651\u589e\u957f\u7684\u60c5\u51b5\u4e0b\u8c03\u6574 IPv4 VPC \u548c\u5b50\u7f51\u7684\u5927\u5c0f\uff0c\u4ee5\u9632\u6b62\u60a8\u7684\u96c6\u7fa4\u6d88\u8017\u6240\u6709\u53ef\u7528\u7684 IP \u5730\u5740\u3002\u5982\u679c\u5b50\u7f51\u6ca1\u6709\u8db3\u591f\u7684\u53ef\u7528 IP \u5730\u5740\uff0c\u60a8\u5c06\u65e0\u6cd5\u521b\u5efa\u65b0\u7684 Pod \u6216\u8282\u70b9\u3002</p> <p>\u5728\u6784\u5efa VPC \u548c\u5b50\u7f51\u4e4b\u524d\uff0c\u5efa\u8bae\u4ece\u6240\u9700\u7684\u5de5\u4f5c\u8d1f\u8f7d\u89c4\u6a21\u53cd\u5411\u63a8\u5bfc\u3002\u4f8b\u5982\uff0c\u5f53\u4f7f\u7528 eksctl (\u4e00\u4e2a\u7528\u4e8e\u5728 EKS \u4e0a\u521b\u5efa\u548c\u7ba1\u7406\u96c6\u7fa4\u7684\u7b80\u5355 CLI \u5de5\u5177) \u6784\u5efa\u96c6\u7fa4\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u521b\u5efa /19 \u5b50\u7f51\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\uff0c/19 \u7684\u5b50\u7f51\u63a9\u7801\u662f\u5408\u9002\u7684\uff0c\u5141\u8bb8\u5206\u914d\u8d85\u8fc7 8000 \u4e2a\u5730\u5740\u3002</p> <p>Attention</p> <p>\u5728\u8c03\u6574 VPC \u548c\u5b50\u7f51\u5927\u5c0f\u65f6\uff0c\u9664\u4e86 Pod \u548c\u8282\u70b9\u4e4b\u5916\uff0c\u53ef\u80fd\u8fd8\u6709\u5176\u4ed6\u5143\u7d20(\u5982\u8d1f\u8f7d\u5747\u8861\u5668\u3001RDS \u6570\u636e\u5e93\u548c\u5176\u4ed6 VPC \u5185\u670d\u52a1)\u4f1a\u6d88\u8017 IP \u5730\u5740\u3002</p> <p>\u6b64\u5916\uff0cAmazon EKS \u53ef\u4ee5\u521b\u5efa\u591a\u8fbe 4 \u4e2a\u5f39\u6027\u7f51\u7edc\u63a5\u53e3 (X-ENI),\u8fd9\u662f\u5141\u8bb8\u4e0e\u63a7\u5236\u5e73\u9762\u901a\u4fe1\u6240\u9700\u7684(\u66f4\u591a\u4fe1\u606f\u5728\u6b64)\u3002\u5728\u96c6\u7fa4\u5347\u7ea7\u671f\u95f4\uff0cAmazon EKS \u4f1a\u521b\u5efa\u65b0\u7684 X-ENI \u5e76\u5728\u5347\u7ea7\u6210\u529f\u65f6\u5220\u9664\u65e7\u7684 X-ENI\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5efa\u8bae\u4e0e EKS \u96c6\u7fa4\u5173\u8054\u7684\u5b50\u7f51\u81f3\u5c11\u4f7f\u7528 /28 (16 \u4e2a IP \u5730\u5740) \u7684\u5b50\u7f51\u63a9\u7801\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 EKS \u5b50\u7f51\u8ba1\u7b97\u5668\u793a\u4f8b\u7535\u5b50\u8868\u683c\u6765\u89c4\u5212\u60a8\u7684\u7f51\u7edc\u3002\u8be5\u7535\u5b50\u8868\u683c\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u548c VPC ENI \u914d\u7f6e\u8ba1\u7b97 IP \u4f7f\u7528\u60c5\u51b5\u3002IP \u4f7f\u7528\u60c5\u51b5\u4e0e IPv4 \u5b50\u7f51\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ee5\u786e\u5b9a\u914d\u7f6e\u548c\u5b50\u7f51\u5927\u5c0f\u662f\u5426\u8db3\u4ee5\u6ee1\u8db3\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5982\u679c\u60a8\u7684 VPC \u4e2d\u7684\u5b50\u7f51\u7528\u5c3d\u4e86\u53ef\u7528 IP \u5730\u5740\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 VPC \u7684\u539f\u59cb CIDR \u5757\u521b\u5efa\u65b0\u5b50\u7f51\u3002\u8bf7\u6ce8\u610f\uff0cAmazon EKS \u73b0\u5728\u5141\u8bb8\u4fee\u6539\u96c6\u7fa4\u5b50\u7f51\u548c\u5b89\u5168\u7ec4\u3002</p>"},{"location":"zh/networking/ip-optimization-strategies/#ip_3","title":"\u6269\u5c55 IP \u7a7a\u95f4","text":"<p>\u5982\u679c\u60a8\u5373\u5c06\u8017\u5c3d RFC1918 IP \u7a7a\u95f4\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 \u81ea\u5b9a\u4e49\u7f51\u7edc\u6a21\u5f0f\uff0c\u901a\u8fc7\u5728\u4e13\u7528\u7684\u989d\u5916\u5b50\u7f51\u5185\u8c03\u5ea6 Pod \u6765\u8282\u7701\u53ef\u8def\u7531 IP\u3002 \u867d\u7136\u81ea\u5b9a\u4e49\u7f51\u7edc\u5c06\u63a5\u53d7 VPC \u8303\u56f4\u5185\u7684\u6709\u6548\u8f85\u52a9 CIDR \u8303\u56f4\uff0c\u4f46\u6211\u4eec\u5efa\u8bae\u60a8\u4f7f\u7528 CG-NAT \u7a7a\u95f4\u4e2d\u7684 CIDR (/16),\u5373 <code>100.64.0.0/10</code> \u6216 <code>198.19.0.0/16</code>,\u56e0\u4e3a\u8fd9\u4e9b\u8303\u56f4\u4e0d\u592a\u53ef\u80fd\u5728\u4f01\u4e1a\u73af\u5883\u4e2d\u4f7f\u7528\uff0c\u800c\u4e0d\u662f RFC1918 \u8303\u56f4\u3002</p> <p>\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4e13\u95e8\u7684 \u81ea\u5b9a\u4e49\u7f51\u7edc\u90e8\u5206\u3002</p> <p></p>"},{"location":"zh/networking/ip-optimization-strategies/#ip_4","title":"\u4f18\u5316 IP \u6696\u6c60","text":"<p>\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff0cVPC CNI \u4f1a\u5728\u6696\u6c60\u4e2d\u4fdd\u7559\u6574\u4e2a ENI (\u53ca\u5176\u5173\u8054\u7684 IP)\u3002\u8fd9\u53ef\u80fd\u4f1a\u6d88\u8017\u5927\u91cf IP\uff0c\u5c24\u5176\u662f\u5728\u8f83\u5927\u7684\u5b9e\u4f8b\u7c7b\u578b\u4e0a\u3002</p> <p>\u5982\u679c\u60a8\u7684\u96c6\u7fa4\u5b50\u7f51\u53ea\u6709\u6709\u9650\u6570\u91cf\u7684\u53ef\u7528 IP \u5730\u5740\uff0c\u8bf7\u4ed4\u7ec6\u68c0\u67e5\u8fd9\u4e9b VPC CNI \u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff1a</p> <ul> <li><code>WARM_IP_TARGET</code></li> <li><code>MINIMUM_IP_TARGET</code></li> <li><code>WARM_ENI_TARGET</code></li> </ul> <p>\u60a8\u53ef\u4ee5\u5c06 <code>MINIMUM_IP_TARGET</code> \u7684\u503c\u914d\u7f6e\u4e3a\u4e0e\u60a8\u9884\u671f\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 Pod \u6570\u91cf\u76f8\u5339\u914d\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u5728\u521b\u5efa Pod \u65f6\uff0cCNI \u53ef\u4ee5\u4ece\u6696\u6c60\u5206\u914d IP \u5730\u5740\uff0c\u800c\u65e0\u9700\u8c03\u7528 EC2 API\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u5c06 <code>WARM_IP_TARGET</code> \u7684\u503c\u8bbe\u7f6e\u5f97\u592a\u4f4e\u4f1a\u5bfc\u81f4\u989d\u5916\u8c03\u7528 EC2 API\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8bf7\u6c42\u88ab\u9650\u5236\u3002\u5bf9\u4e8e\u5927\u578b\u96c6\u7fa4\uff0c\u8bf7\u4e0e <code>MINIMUM_IP_TARGET</code> \u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u907f\u514d\u8bf7\u6c42\u88ab\u9650\u5236\u3002</p> <p>\u8981\u914d\u7f6e\u8fd9\u4e9b\u9009\u9879\uff0c\u60a8\u53ef\u4ee5\u4e0b\u8f7d <code>aws-k8s-cni.yaml</code> \u6e05\u5355\u5e76\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002\u5728\u64b0\u5199\u672c\u6587\u65f6\uff0c\u6700\u65b0\u7248\u672c\u4f4d\u4e8e\u6b64\u5904\u3002\u8bf7\u68c0\u67e5\u914d\u7f6e\u503c\u7684\u7248\u672c\u662f\u5426\u4e0e\u5df2\u5b89\u88c5\u7684 VPC CNI \u7248\u672c\u5339\u914d\u3002</p> <p>Warning</p> <p>\u5f53\u60a8\u66f4\u65b0 CNI \u65f6\uff0c\u8fd9\u4e9b\u8bbe\u7f6e\u5c06\u91cd\u7f6e\u4e3a\u9ed8\u8ba4\u503c\u3002\u5728\u66f4\u65b0\u4e4b\u524d\uff0c\u8bf7\u5907\u4efd CNI\u3002\u5728\u66f4\u65b0\u6210\u529f\u540e\uff0c\u8bf7\u67e5\u770b\u914d\u7f6e\u8bbe\u7f6e\u4ee5\u786e\u5b9a\u662f\u5426\u9700\u8981\u91cd\u65b0\u5e94\u7528\u5b83\u4eec\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728\u4e0d\u4e2d\u65ad\u73b0\u6709\u5e94\u7528\u7a0b\u5e8f\u7684\u60c5\u51b5\u4e0b\u52a8\u6001\u8c03\u6574 CNI \u53c2\u6570\uff0c\u4f46\u60a8\u5e94\u8be5\u9009\u62e9\u80fd\u591f\u652f\u6301\u60a8\u7684\u53ef\u6269\u5c55\u6027\u9700\u6c42\u7684\u503c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528\u6279\u5904\u7406\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u6211\u4eec\u5efa\u8bae\u5c06\u9ed8\u8ba4\u7684 <code>WARM_ENI_TARGET</code> \u66f4\u65b0\u4e3a\u4e0e Pod \u89c4\u6a21\u9700\u6c42\u76f8\u5339\u914d\u3002\u5c06 <code>WARM_ENI_TARGET</code> \u8bbe\u7f6e\u4e3a\u8f83\u9ad8\u503c\u53ef\u59cb\u7ec8\u4fdd\u6301\u8fd0\u884c\u5927\u578b\u6279\u5904\u7406\u5de5\u4f5c\u8d1f\u8f7d\u6240\u9700\u7684\u6696 IP \u6c60\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u5904\u7406\u5ef6\u8fdf\u3002</p> <p>Warning</p> <p>\u6539\u8fdb\u60a8\u7684 VPC \u8bbe\u8ba1\u662f\u5e94\u5bf9 IP \u5730\u5740\u8017\u5c3d\u7684\u63a8\u8350\u505a\u6cd5\u3002\u8bf7\u8003\u8651\u8bf8\u5982 IPv6 \u548c\u8f85\u52a9 CIDR \u4e4b\u7c7b\u7684\u89e3\u51b3\u65b9\u6848\u3002\u8c03\u6574\u8fd9\u4e9b\u503c\u4ee5\u6700\u5c0f\u5316\u6696 IP \u7684\u6570\u91cf\u5e94\u8be5\u53ea\u662f\u5728\u6392\u9664\u5176\u4ed6\u9009\u9879\u540e\u7684\u4e34\u65f6\u89e3\u51b3\u65b9\u6848\u3002\u9519\u8bef\u914d\u7f6e\u8fd9\u4e9b\u503c\u53ef\u80fd\u4f1a\u5e72\u6270\u96c6\u7fa4\u64cd\u4f5c\u3002</p> <p>\u5728\u5bf9\u751f\u4ea7\u7cfb\u7edf\u8fdb\u884c\u4efb\u4f55\u66f4\u6539\u4e4b\u524d,\u8bf7\u52a1\u5fc5\u67e5\u770b\u6b64\u9875\u9762\u4e0a\u7684\u6ce8\u610f\u4e8b\u9879\u3002</p>"},{"location":"zh/networking/ip-optimization-strategies/#ip_5","title":"\u76d1\u63a7 IP \u5730\u5740\u5e93\u5b58","text":"<p>\u9664\u4e86\u4e0a\u8ff0\u89e3\u51b3\u65b9\u6848\u5916\uff0c\u62e5\u6709 IP \u5229\u7528\u7387\u7684\u53ef\u89c1\u6027\u4e5f\u5f88\u91cd\u8981\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 CNI Metrics Helper \u76d1\u63a7\u5b50\u7f51\u7684 IP \u5730\u5740\u5e93\u5b58\u3002\u4e00\u4e9b\u53ef\u7528\u7684\u6307\u6807\u5305\u62ec\uff1a</p> <ul> <li>\u96c6\u7fa4\u53ef\u4ee5\u652f\u6301\u7684\u6700\u5927 ENI \u6570\u91cf</li> <li>\u5df2\u5206\u914d\u7684 ENI \u6570\u91cf</li> <li>\u5f53\u524d\u5206\u914d\u7ed9 Pod \u7684 IP \u5730\u5740\u6570\u91cf</li> <li>\u53ef\u7528\u7684\u603b IP \u5730\u5740\u6570\u91cf\u548c\u6700\u5927\u6570\u91cf</li> </ul> <p>\u60a8\u8fd8\u53ef\u4ee5\u8bbe\u7f6e CloudWatch \u8b66\u62a5,\u4ee5\u5728\u5b50\u7f51\u5373\u5c06\u7528\u5c3d IP \u5730\u5740\u65f6\u83b7\u5f97\u901a\u77e5\u3002\u8bf7\u8bbf\u95ee EKS \u7528\u6237\u6307\u5357\u4e86\u89e3 CNI \u6307\u6807\u52a9\u624b\u7684\u5b89\u88c5\u8bf4\u660e\u3002</p> <p>Warning</p> <p>\u8bf7\u786e\u4fdd\u5c06 VPC CNI \u7684 <code>DISABLE_METRICS</code> \u53d8\u91cf\u8bbe\u7f6e\u4e3a false\u3002</p>"},{"location":"zh/networking/ip-optimization-strategies/#_2","title":"\u8fdb\u4e00\u6b65\u8003\u8651","text":"<p>\u8fd8\u6709\u4e00\u4e9b\u4e0d\u5c5e\u4e8e Amazon EKS \u672c\u8eab\u4f46\u53ef\u4ee5\u5e2e\u52a9\u7f13\u89e3 IP \u8017\u5c3d\u7684\u5176\u4ed6\u67b6\u6784\u6a21\u5f0f\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4f18\u5316\u8de8 VPC \u7684\u901a\u4fe1\u6216\u5728\u591a\u4e2a\u8d26\u6237\u4e4b\u95f4\u5171\u4eab VPC,\u4ee5\u9650\u5236 IPv4 \u5730\u5740\u5206\u914d\u3002</p> <p>\u5728\u6b64\u4e86\u89e3\u66f4\u591a\u6709\u5173\u8fd9\u4e9b\u6a21\u5f0f\u7684\u4fe1\u606f\uff1a</p> <ul> <li>\u8bbe\u8ba1\u8d85\u5927\u89c4\u6a21 Amazon VPC \u7f51\u7edc,</li> <li>\u4f7f\u7528 Amazon VPC Lattice \u6784\u5efa\u5b89\u5168\u7684\u591a\u8d26\u6237\u591a VPC \u8fde\u63a5\u3002</li> </ul>"},{"location":"zh/networking/ipv6/","title":"\u8fd0\u884c IPv6 EKS \u96c6\u7fa4","text":"<p>EKS \u5728 IPv6 \u6a21\u5f0f\u4e0b\u89e3\u51b3\u4e86\u5927\u89c4\u6a21 EKS \u96c6\u7fa4\u4e2d\u5e38\u89c1\u7684 IPv4 \u8017\u5c3d\u6311\u6218\u3002EKS \u5bf9 IPv6 \u7684\u652f\u6301\u91cd\u70b9\u89e3\u51b3 IPv4 \u5730\u5740\u7a7a\u95f4\u6709\u9650\u5bfc\u81f4\u7684 IPv4 \u8017\u5c3d\u95ee\u9898\u3002\u8fd9\u662f\u8bb8\u591a\u5ba2\u6237\u63d0\u51fa\u7684\u4e00\u4e2a\u91cd\u5927\u95ee\u9898\uff0c\u4e0e Kubernetes \u7684\"IPv4/IPv6 \u53cc\u6808\"\u529f\u80fd\u4e0d\u540c\u3002 EKS/IPv6 \u8fd8\u5c06\u63d0\u4f9b\u4f7f\u7528 IPv6 CIDR \u4e92\u8fde\u7f51\u7edc\u8fb9\u754c\u7684\u7075\u6d3b\u6027\uff0c\u4ece\u800c\u6700\u5c0f\u5316\u906d\u53d7 CIDR \u91cd\u53e0\u7684\u673a\u4f1a\uff0c\u56e0\u6b64\u89e3\u51b3\u4e86\u4e24\u4e2a\u95ee\u9898(\u96c6\u7fa4\u5185\u548c\u8de8\u96c6\u7fa4)\u3002 \u5728 IPv6 \u6a21\u5f0f(--ip-family ipv6)\u90e8\u7f72 EKS \u96c6\u7fa4\u65f6\uff0c\u6b64\u64cd\u4f5c\u662f\u4e0d\u53ef\u9006\u7684\u3002\u7b80\u5355\u6765\u8bf4\uff0cEKS IPv6 \u652f\u6301\u5c06\u5728\u6574\u4e2a\u96c6\u7fa4\u751f\u547d\u5468\u671f\u5185\u542f\u7528\u3002</p> <p>\u5728 IPv6 EKS \u96c6\u7fa4\u4e2d\uff0cPod \u548c\u670d\u52a1\u5c06\u6536\u5230 IPv6 \u5730\u5740\uff0c\u540c\u65f6\u4fdd\u6301\u4e0e\u9057\u7559 IPv4 \u7aef\u70b9\u7684\u517c\u5bb9\u6027\u3002\u8fd9\u5305\u62ec\u5916\u90e8 IPv4 \u7aef\u70b9\u8bbf\u95ee\u96c6\u7fa4\u5185\u670d\u52a1\u7684\u80fd\u529b\uff0c\u4ee5\u53ca Pod \u8bbf\u95ee\u5916\u90e8 IPv4 \u7aef\u70b9\u7684\u80fd\u529b\u3002</p> <p>Amazon EKS IPv6 \u652f\u6301\u5229\u7528\u4e86 VPC \u7684\u539f\u751f IPv6 \u529f\u80fd\u3002\u6bcf\u4e2a VPC \u90fd\u5206\u914d\u4e86\u4e00\u4e2a IPv4 \u5730\u5740\u524d\u7f00(CIDR \u5757\u5927\u5c0f\u53ef\u4ee5\u4ece /16 \u5230 /28)\u548c\u6765\u81ea Amazon \u7684 GUA(\u5168\u5c40\u5355\u64ad\u5730\u5740)\u7684\u552f\u4e00 /56 IPv6 \u5730\u5740\u524d\u7f00(\u56fa\u5b9a)\u3002\u4f60\u53ef\u4ee5\u4e3a VPC \u4e2d\u7684\u6bcf\u4e2a\u5b50\u7f51\u5206\u914d\u4e00\u4e2a /64 \u5730\u5740\u524d\u7f00\u3002IPv4 \u529f\u80fd\uff0c\u5982\u8def\u7531\u8868\u3001\u7f51\u7edc\u8bbf\u95ee\u63a7\u5236\u5217\u8868\u3001\u5bf9\u7b49\u548c DNS \u89e3\u6790\uff0c\u5728\u542f\u7528\u4e86 IPv6 \u7684 VPC \u4e2d\u7684\u5de5\u4f5c\u65b9\u5f0f\u4e0e\u4e4b\u524d\u76f8\u540c\u3002VPC \u968f\u540e\u88ab\u79f0\u4e3a\u53cc\u6808 VPC\uff0c\u5728\u53cc\u6808\u5b50\u7f51\u4e4b\u540e\uff0c\u4e0b\u56fe\u63cf\u7ed8\u4e86\u652f\u6301 EKS/IPv6 \u96c6\u7fa4\u7684 IPV4&amp;IPv6 VPC \u57fa\u7840\u6a21\u5f0f\uff1a</p> <p></p> <p>\u5728 IPv6 \u4e16\u754c\u4e2d\uff0c\u6bcf\u4e2a\u5730\u5740\u90fd\u662f\u53ef\u8def\u7531\u7684\u4e92\u8054\u7f51\u5730\u5740\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cVPC \u4ece\u516c\u5171 GUA \u8303\u56f4\u5206\u914d IPv6 CIDR\u3002VPC \u4e0d\u652f\u6301\u4ece RFC 4193(fd00\uff1a:/8 \u6216 fc00\uff1a:/8)\u5b9a\u4e49\u7684\u552f\u4e00\u672c\u5730\u5730\u5740(ULA)\u8303\u56f4\u5206\u914d\u79c1\u6709 IPv6 \u5730\u5740\uff0c\u5373\u4f7f\u4f60\u60f3\u5206\u914d\u81ea\u5df1\u62e5\u6709\u7684 IPv6 CIDR \u4e5f\u662f\u5982\u6b64\u3002\u4ece\u79c1\u6709\u5b50\u7f51\u51fa\u53e3\u5230\u4e92\u8054\u7f51\u662f\u901a\u8fc7\u5728 VPC \u4e2d\u5b9e\u73b0\u4ec5\u51fa\u53e3\u4e92\u8054\u7f51\u7f51\u5173(EIGW)\u6765\u652f\u6301\u7684\uff0c\u5141\u8bb8\u51fa\u7ad9\u6d41\u91cf\u800c\u963b\u6b62\u6240\u6709\u5165\u7ad9\u6d41\u91cf\u3002 \u4e0b\u56fe\u63cf\u7ed8\u4e86 EKS/IPv6 \u96c6\u7fa4\u5185\u79c1\u6709\u5b50\u7f51\u4e2d\u7684 Pod \u51fa\u53e3\u5230\u4e92\u8054\u7f51 IPv6 \u7aef\u70b9\u7684\u6d41\u7a0b\uff1a</p> <p></p> <p>\u5b9e\u65bd IPv6 \u5b50\u7f51\u7684\u6700\u4f73\u5b9e\u8df5\u53ef\u4ee5\u5728 VPC \u7528\u6237\u6307\u5357\u4e2d\u627e\u5230\u3002</p> <p>\u5728 IPv6 EKS \u96c6\u7fa4\u4e2d\uff0c\u8282\u70b9\u548c Pod \u6536\u5230\u516c\u5171 IPv6 \u5730\u5740\u3002EKS \u6839\u636e\u552f\u4e00\u672c\u5730 IPv6 \u5355\u64ad\u5730\u5740(ULA)\u4e3a\u670d\u52a1\u5206\u914d IPv6 \u5730\u5740\u3002IPv6 \u96c6\u7fa4\u7684 ULA \u670d\u52a1 CIDR \u5728\u96c6\u7fa4\u521b\u5efa\u9636\u6bb5\u81ea\u52a8\u5206\u914d\uff0c\u4e0d\u80fd\u50cf IPv4 \u90a3\u6837\u6307\u5b9a\u3002\u4e0b\u56fe\u63cf\u7ed8\u4e86\u57fa\u4e8e EKS/IPv6 \u7684\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762\u57fa\u7840\u6a21\u5f0f\uff1a</p> <p></p>"},{"location":"zh/networking/ipv6/#_1","title":"\u6982\u8ff0","text":"<p>EKS/IPv6 \u4ec5\u5728\u524d\u7f00\u6a21\u5f0f(VPC-CNI \u63d2\u4ef6 ENI IP \u5206\u914d\u6a21\u5f0f)\u4e0b\u53d7\u652f\u6301\u3002\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u524d\u7f00\u6a21\u5f0f\u7684\u4fe1\u606f\u3002</p> <p>\u524d\u7f00\u5206\u914d\u53ea\u9002\u7528\u4e8e\u57fa\u4e8e Nitro \u7684 EC2 \u5b9e\u4f8b\uff0c\u56e0\u6b64 EKS/IPv6 \u4ec5\u5728\u96c6\u7fa4\u6570\u636e\u5e73\u9762\u4f7f\u7528\u57fa\u4e8e Nitro \u7684 EC2 \u5b9e\u4f8b\u65f6\u53d7\u652f\u6301\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u6bcf\u4e2a\u5de5\u4f5c\u8282\u70b9\u7684 /80 IPv6 \u524d\u7f00\u5c06\u4ea7\u751f\u7ea6 10^14 \u4e2a IPv6 \u5730\u5740\uff0c\u9650\u5236\u56e0\u7d20\u5c06\u4e0d\u518d\u662f IP\uff0c\u800c\u662f Pod \u5bc6\u5ea6(\u8d44\u6e90\u65b9\u9762)\u3002</p> <p>IPv6 \u524d\u7f00\u5206\u914d\u4ec5\u5728 EKS \u5de5\u4f5c\u8282\u70b9\u5f15\u5bfc\u65f6\u53d1\u751f\u3002 \u8fd9\u79cd\u884c\u4e3a\u65e8\u5728\u7f13\u89e3 EKS/IPv4 \u96c6\u7fa4\u4e2d\u9ad8 Pod \u6d41\u8f6c\u7387\u5bfc\u81f4 Pod \u8c03\u5ea6\u5ef6\u8fdf\u7684\u60c5\u51b5\uff0c\u8fd9\u4e9b\u5ef6\u8fdf\u662f\u7531\u4e8e VPC CNI \u63d2\u4ef6(ipamd)\u751f\u6210\u7684\u65e8\u5728\u53ca\u65f6\u5206\u914d\u79c1\u6709 IPv4 \u5730\u5740\u7684\u8282\u6d41 API \u8c03\u7528\u3002\u5b83\u4e5f\u88ab\u8ba4\u4e3a\u53ef\u4ee5\u4f7f VPC-CNI \u63d2\u4ef6\u9ad8\u7ea7\u65cb\u94ae\u8c03\u4f18WARM_IP/ENI\u3001MINIMUM_IP\u53d8\u5f97\u4e0d\u5fc5\u8981\u3002</p> <p>\u4e0b\u56fe\u653e\u5927\u4e86 IPv6 \u5de5\u4f5c\u8282\u70b9\u5f39\u6027\u7f51\u7edc\u63a5\u53e3(ENI)\uff1a</p> <p></p> <p>\u6bcf\u4e2a EKS \u5de5\u4f5c\u8282\u70b9\u90fd\u88ab\u5206\u914d\u4e86 IPv4 \u548c IPv6 \u5730\u5740\uff0c\u4ee5\u53ca\u76f8\u5e94\u7684 DNS \u6761\u76ee\u3002\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u53ea\u6d88\u8017\u4e86\u53cc\u6808\u5b50\u7f51\u4e2d\u7684\u4e00\u4e2a IPv4 \u5730\u5740\u3002EKS \u5bf9 IPv6 \u7684\u652f\u6301\u4f7f\u4f60\u80fd\u591f\u901a\u8fc7\u9ad8\u5ea6\u56fa\u5b9a\u7684\u4ec5\u51fa\u53e3 IPv4 \u6a21\u578b\u4e0e IPv4 \u7aef\u70b9(AWS\u3001\u5185\u90e8\u3001\u4e92\u8054\u7f51)\u901a\u4fe1\u3002EKS \u5b9e\u73b0\u4e86\u4e00\u4e2a\u4e3b\u673a\u672c\u5730 CNI \u63d2\u4ef6\uff0c\u6b21\u4e8e VPC CNI \u63d2\u4ef6\uff0c\u7528\u4e8e\u4e3a Pod \u5206\u914d\u548c\u914d\u7f6e IPv4 \u5730\u5740\u3002CNI \u63d2\u4ef6\u4ece 169.254.172.0/22 \u8303\u56f4\u4e3a Pod \u914d\u7f6e\u4e00\u4e2a\u7279\u5b9a\u4e8e\u4e3b\u673a\u7684\u4e0d\u53ef\u8def\u7531 IPv4 \u5730\u5740\u3002\u5206\u914d\u7ed9 Pod \u7684 IPv4 \u5730\u5740\u5728\u5de5\u4f5c\u8282\u70b9\u5185\u662f\u552f\u4e00\u7684,\u5e76\u4e14\u4e0d\u4f1a\u5728\u5de5\u4f5c\u8282\u70b9\u4e4b\u5916\u4f20\u64ad\u3002169.254.172.0/22 \u63d0\u4f9b\u4e86\u591a\u8fbe 1024 \u4e2a\u552f\u4e00\u7684 IPv4 \u5730\u5740\uff0c\u53ef\u4ee5\u652f\u6301\u5927\u578b\u5b9e\u4f8b\u7c7b\u578b\u3002</p> <p>\u4e0b\u56fe\u63cf\u7ed8\u4e86 IPv6 Pod \u8fde\u63a5\u5230\u96c6\u7fa4\u8fb9\u754c\u4e4b\u5916\u7684 IPv4 \u7aef\u70b9(\u975e\u4e92\u8054\u7f51)\u7684\u6d41\u7a0b\uff1a</p> <p></p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0cPod \u5c06\u5bf9\u7aef\u70b9\u6267\u884c DNS \u67e5\u627e\uff0c\u5e76\u5728\u6536\u5230 IPv4 \"A\"\u54cd\u5e94\u65f6\uff0cPod \u7684\u4ec5\u8282\u70b9\u552f\u4e00 IPv4 \u5730\u5740\u5c06\u901a\u8fc7\u6e90\u7f51\u7edc\u5730\u5740\u8f6c\u6362(SNAT)\u8f6c\u6362\u4e3a\u8fde\u63a5\u5230 EC2 \u5de5\u4f5c\u8282\u70b9\u7684\u4e3b\u7f51\u7edc\u63a5\u53e3\u7684\u79c1\u6709 IPv4(VPC)\u5730\u5740\u3002</p> <p>EKS/IPv6 Pod \u8fd8\u9700\u8981\u901a\u8fc7\u516c\u5171 IPv4 \u5730\u5740\u8fde\u63a5\u5230\u4e92\u8054\u7f51\u4e0a\u7684 IPv4 \u7aef\u70b9\uff0c\u4e3a\u6b64\u5b58\u5728\u7c7b\u4f3c\u7684\u6d41\u7a0b\u3002 \u4e0b\u56fe\u63cf\u7ed8\u4e86 IPv6 Pod \u8fde\u63a5\u5230\u96c6\u7fa4\u8fb9\u754c\u4e4b\u5916\u7684 IPv4 \u7aef\u70b9(\u53ef\u8def\u7531\u5230\u4e92\u8054\u7f51)\u7684\u6d41\u7a0b\uff1a</p> <p></p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0cPod \u5c06\u5bf9\u7aef\u70b9\u6267\u884c DNS \u67e5\u627e\uff0c\u5e76\u5728\u6536\u5230 IPv4 \"A\"\u54cd\u5e94\u65f6\uff0cPod \u7684\u4ec5\u8282\u70b9\u552f\u4e00 IPv4 \u5730\u5740\u5c06\u901a\u8fc7\u6e90\u7f51\u7edc\u5730\u5740\u8f6c\u6362(SNAT)\u8f6c\u6362\u4e3a\u8fde\u63a5\u5230 EC2 \u5de5\u4f5c\u8282\u70b9\u7684\u4e3b\u7f51\u7edc\u63a5\u53e3\u7684\u79c1\u6709 IPv4(VPC)\u5730\u5740\u3002\u7136\u540e\uff0cPod IPv4 \u5730\u5740(\u6e90 IPv4\uff1aEC2 \u4e3b IP)\u5c06\u8def\u7531\u5230 IPv4 NAT \u7f51\u5173\uff0c\u5728\u90a3\u91cc EC2 \u4e3b IP \u5c06\u8f6c\u6362(SNAT)\u4e3a\u6709\u6548\u7684\u53ef\u8def\u7531\u5230\u4e92\u8054\u7f51\u7684 IPv4 \u516c\u5171 IP \u5730\u5740(NAT \u7f51\u5173\u5206\u914d\u7684\u516c\u5171 IP)\u3002</p> <p>\u4efb\u4f55\u8de8\u8282\u70b9\u7684 Pod \u5230 Pod \u901a\u4fe1\u90fd\u5c06\u4f7f\u7528 IPv6 \u5730\u5740\u3002VPC CNI \u914d\u7f6e iptables \u6765\u5904\u7406 IPv6\uff0c\u540c\u65f6\u963b\u6b62\u4efb\u4f55 IPv4 \u8fde\u63a5\u3002</p> <p>Kubernetes \u670d\u52a1\u5c06\u4ec5\u4ece\u552f\u4e00\u672c\u5730 IPv6 \u5355\u64ad\u5730\u5740(ULA)\u63a5\u6536 IPv6 \u5730\u5740(ClusterIP)\u3002IPv6 \u96c6\u7fa4\u7684 ULA \u670d\u52a1 CIDR \u5728 EKS \u96c6\u7fa4\u521b\u5efa\u9636\u6bb5\u81ea\u52a8\u5206\u914d\uff0c\u65e0\u6cd5\u4fee\u6539\u3002\u4e0b\u56fe\u63cf\u7ed8\u4e86 Pod \u5230 Kubernetes \u670d\u52a1\u7684\u6d41\u7a0b\uff1a</p> <p></p> <p>\u670d\u52a1\u901a\u8fc7 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u66b4\u9732\u5230\u4e92\u8054\u7f51\u3002\u8d1f\u8f7d\u5747\u8861\u5668\u63a5\u6536\u516c\u5171 IPv4 \u548c IPv6 \u5730\u5740\uff0c\u4e5f\u79f0\u4e3a\u53cc\u6808\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u5bf9\u4e8e\u8bbf\u95ee IPv6 \u96c6\u7fa4 kubernetes \u670d\u52a1\u7684 IPv4 \u5ba2\u6237\u7aef\uff0c\u8d1f\u8f7d\u5747\u8861\u5668\u6267\u884c IPv4 \u5230 IPv6 \u7684\u8f6c\u6362\u3002</p> <p>Amazon EKS \u5efa\u8bae\u5728\u79c1\u6709\u5b50\u7f51\u4e2d\u8fd0\u884c\u5de5\u4f5c\u8282\u70b9\u548c Pod\u3002\u4f60\u53ef\u4ee5\u5728\u516c\u5171\u5b50\u7f51\u4e2d\u521b\u5efa\u516c\u5171\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5c06\u6d41\u91cf\u8d1f\u8f7d\u5747\u8861\u5230\u8fd0\u884c\u5728\u79c1\u6709\u5b50\u7f51\u4e2d\u8282\u70b9\u4e0a\u7684 Pod\u3002 \u4e0b\u56fe\u63cf\u7ed8\u4e86\u4e92\u8054\u7f51 IPv4 \u7528\u6237\u8bbf\u95ee EKS/IPv6 Ingress \u670d\u52a1\u7684\u60c5\u51b5\uff1a</p> <p></p> <p>\u6ce8\u610f\uff1a\u4e0a\u8ff0\u6a21\u5f0f\u9700\u8981\u90e8\u7f72\u6700\u65b0\u7248\u672c\u7684 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668</p>"},{"location":"zh/networking/ipv6/#eks-","title":"EKS \u63a7\u5236\u5e73\u9762 &lt;-&gt; \u6570\u636e\u5e73\u9762\u901a\u4fe1","text":"<p>EKS \u5c06\u5728\u53cc\u6808\u6a21\u5f0f(IPv4/IPv6)\u4e0b\u4e3a\u8de8\u8d26\u6237 ENI(X-ENI)\u63d0\u4f9b\u8d44\u6e90\u3002Kubernetes \u8282\u70b9\u7ec4\u4ef6\u5982 kubelet \u548c kube-proxy \u88ab\u914d\u7f6e\u4e3a\u652f\u6301\u53cc\u6808\u3002kubelet \u548c kube-proxy \u5728 hostNetwork \u6a21\u5f0f\u4e0b\u8fd0\u884c\uff0c\u5e76\u7ed1\u5b9a\u5230\u8fde\u63a5\u5230\u8282\u70b9\u4e3b\u7f51\u7edc\u63a5\u53e3\u7684 IPv4 \u548c IPv6 \u5730\u5740\u3002Kubernetes api-server \u901a\u8fc7\u57fa\u4e8e IPv6 \u7684 X-ENI \u4e0e Pod \u548c\u8282\u70b9\u7ec4\u4ef6\u901a\u4fe1\u3002Pod \u901a\u8fc7 X-ENI \u4e0e api-server \u901a\u4fe1\uff0cPod \u5230 api-server \u7684\u901a\u4fe1\u59cb\u7ec8\u4f7f\u7528 IPv6 \u6a21\u5f0f\u3002</p> <p></p>"},{"location":"zh/networking/ipv6/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/ipv6/#ipv4-eks-api","title":"\u4fdd\u6301\u5bf9 IPv4 EKS API \u7684\u8bbf\u95ee","text":"<p>EKS API \u4ec5\u53ef\u901a\u8fc7 IPv4 \u8bbf\u95ee\u3002\u8fd9\u4e5f\u5305\u62ec\u96c6\u7fa4 API \u7aef\u70b9\u3002\u4f60\u5c06\u65e0\u6cd5\u4ece\u4ec5 IPv6 \u7f51\u7edc\u8bbf\u95ee\u96c6\u7fa4\u7aef\u70b9\u548c API\u3002\u4f60\u7684\u7f51\u7edc\u9700\u8981\u652f\u6301(1)NAT64/DNS64 \u7b49 IPv6 \u8fc7\u6e21\u673a\u5236\uff0c\u4ee5\u4fc3\u8fdb IPv6 \u548c IPv4 \u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4ee5\u53ca(2)\u652f\u6301 IPv4 \u7aef\u70b9\u8f6c\u6362\u7684 DNS \u670d\u52a1\u3002</p>"},{"location":"zh/networking/ipv6/#_3","title":"\u6839\u636e\u8ba1\u7b97\u8d44\u6e90\u8fdb\u884c\u8c03\u5ea6","text":"<p>\u5355\u4e2a IPv6 \u524d\u7f00\u5c31\u8db3\u4ee5\u5728\u5355\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u8bb8\u591a Pod\u3002\u8fd9\u4e5f\u6709\u6548\u5730\u6d88\u9664\u4e86 ENI \u548c IP \u5bf9\u8282\u70b9\u4e0a\u6700\u5927 Pod \u6570\u91cf\u7684\u9650\u5236\u3002\u5c3d\u7ba1 IPv6 \u6d88\u9664\u4e86\u5bf9\u6700\u5927 Pod \u6570\u91cf\u7684\u76f4\u63a5\u4f9d\u8d56\uff0c\u4f46\u5728\u4f7f\u7528\u8f83\u5c0f\u5b9e\u4f8b\u7c7b\u578b(\u5982 m5.large)\u7684\u524d\u7f00\u9644\u4ef6\u65f6\uff0c\u4f60\u53ef\u80fd\u4f1a\u5148\u8017\u5c3d\u5b9e\u4f8b\u7684 CPU \u548c\u5185\u5b58\u8d44\u6e90\uff0c\u800c\u4e0d\u662f IP \u5730\u5740\u3002\u5982\u679c\u4f60\u4f7f\u7528\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4\u6216\u5177\u6709\u81ea\u5b9a\u4e49 AMI ID \u7684\u6258\u7ba1\u8282\u70b9\u7ec4\uff0c\u5219\u5fc5\u987b\u624b\u52a8\u8bbe\u7f6e EKS \u63a8\u8350\u7684\u6700\u5927 Pod \u503c\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u516c\u5f0f\u6765\u786e\u5b9a\u5728 IPv6 EKS \u96c6\u7fa4\u7684\u8282\u70b9\u4e0a\u53ef\u4ee5\u90e8\u7f72\u7684\u6700\u5927 Pod \u6570\u91cf\u3002</p> <ul> <li> <p>((\u5b9e\u4f8b\u7c7b\u578b\u7684\u7f51\u7edc\u63a5\u53e3\u6570\u91cf(\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684\u524d\u7f00\u6570-1)* 16) + 2</p> </li> <li> <p>((3 \u4e2a ENI)((\u6bcf\u4e2a ENI 10 \u4e2a\u8f85\u52a9 IP-1) 16)) + 2 = 460(\u5b9e\u9645)</p> </li> </ul> <p>\u6258\u7ba1\u8282\u70b9\u7ec4\u4f1a\u81ea\u52a8\u8ba1\u7b97\u6700\u5927 Pod \u6570\u91cf\u3002\u907f\u514d\u66f4\u6539 EKS \u63a8\u8350\u7684\u6700\u5927 Pod \u6570\u91cf\u503c\uff0c\u4ee5\u514d\u7531\u4e8e\u8d44\u6e90\u9650\u5236\u800c\u5bfc\u81f4 Pod \u8c03\u5ea6\u5931\u8d25\u3002</p>"},{"location":"zh/networking/ipv6/#_4","title":"\u8bc4\u4f30\u73b0\u6709\u81ea\u5b9a\u4e49\u7f51\u7edc\u7684\u76ee\u7684","text":"<p>\u5982\u679c\u5f53\u524d\u542f\u7528\u4e86\u81ea\u5b9a\u4e49\u7f51\u7edc,Amazon EKS \u5efa\u8bae\u4f60\u91cd\u65b0\u8bc4\u4f30\u5728 IPv6 \u4e0b\u5bf9\u5b83\u7684\u9700\u6c42\u3002\u5982\u679c\u4f60\u9009\u62e9\u4f7f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u6765\u89e3\u51b3 IPv4 \u8017\u5c3d\u95ee\u9898\uff0c\u5728 IPv6 \u4e0b\u5c31\u4e0d\u518d\u9700\u8981\u4e86\u3002\u5982\u679c\u4f60\u6b63\u5728\u5229\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u6765\u6ee1\u8db3\u5b89\u5168\u8981\u6c42\uff0c\u4f8b\u5982\u4e3a\u8282\u70b9\u548c Pod \u63d0\u4f9b\u5355\u72ec\u7684\u7f51\u7edc\uff0c\u6211\u4eec\u9f13\u52b1\u4f60\u63d0\u4ea4 EKS \u8def\u7ebf\u56fe\u8bf7\u6c42\u3002</p>"},{"location":"zh/networking/ipv6/#eksipv6-fargate-pod","title":"EKS/IPv6 \u96c6\u7fa4\u4e2d\u7684 Fargate Pod","text":"<p>EKS \u652f\u6301\u5728 Fargate \u4e0a\u8fd0\u884c\u7684 Pod \u4f7f\u7528 IPv6\u3002\u5728 Fargate \u4e0a\u8fd0\u884c\u7684 Pod \u5c06\u6d88\u8017\u4ece VPC CI DR \u8303\u56f4(IPv4&amp;IPv6)\u5212\u5206\u7684 IPv6 \u548c VPC \u53ef\u8def\u7531\u79c1\u6709 IPv4 \u5730\u5740\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u4f60\u7684 EKS/Fargate Pod \u96c6\u7fa4\u8303\u56f4\u5185\u7684\u5bc6\u5ea6\u5c06\u53d7\u5230\u53ef\u7528 IPv4 \u548c IPv6 \u5730\u5740\u7684\u9650\u5236\u3002\u5efa\u8bae\u4e3a\u53cc\u6808\u5b50\u7f51/VPC CIDR \u89c4\u5212\u672a\u6765\u589e\u957f\u3002\u5982\u679c\u5e95\u5c42\u5b50\u7f51\u4e0d\u5305\u542b\u53ef\u7528\u7684 IPv4 \u5730\u5740\uff0c\u65e0\u8bba\u6709\u591a\u5c11\u53ef\u7528\u7684 IPv6 \u5730\u5740\uff0c\u4f60\u90fd\u5c06\u65e0\u6cd5\u8c03\u5ea6\u65b0\u7684 Fargate Pod\u3002</p>"},{"location":"zh/networking/ipv6/#aws-lbc","title":"\u90e8\u7f72 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668(LBC)","text":"<p>\u4e0a\u6e38\u5185\u7f6e\u7684 Kubernetes \u670d\u52a1\u63a7\u5236\u5668\u4e0d\u652f\u6301 IPv6\u3002\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u6700\u65b0\u7248\u672c\u7684 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\u9644\u52a0\u7ec4\u4ef6\u3002LBC \u53ea\u4f1a\u5728\u6d88\u8d39\u5e26\u6709 <code>\"alb.ingress.kubernetes.io/ip-address-type: dualstack\"</code> \u548c <code>\"alb.ingress.kubernetes.io/target-type: ip\"</code> \u6ce8\u89e3\u7684\u76f8\u5e94 kubernetes service/ingress \u5b9a\u4e49\u65f6\u90e8\u7f72\u53cc\u6808 NLB \u6216\u53cc\u6808 ALB\u3002</p> <p>AWS \u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668\u4e0d\u652f\u6301\u53cc\u6808 UDP \u534f\u8bae\u5730\u5740\u7c7b\u578b\u3002\u5982\u679c\u4f60\u5bf9\u4f4e\u5ef6\u8fdf\u3001\u5b9e\u65f6\u6d41\u5a92\u4f53\u3001\u5728\u7ebf\u6e38\u620f\u548c IoT \u6709\u5f3a\u70c8\u8981\u6c42\uff0c\u6211\u4eec\u5efa\u8bae\u8fd0\u884c IPv4 \u96c6\u7fa4\u3002\u8981\u4e86\u89e3\u5982\u4f55\u7ba1\u7406 UDP \u670d\u52a1\u7684\u5065\u5eb7\u68c0\u67e5\uff0c\u8bf7\u53c2\u9605\"\u5982\u4f55\u5c06 UDP \u6d41\u91cf\u8def\u7531\u5230 Kubernetes\"\u3002</p>"},{"location":"zh/networking/loadbalancing/loadbalancing/","title":"\u907f\u514d Kubernetes \u5e94\u7528\u7a0b\u5e8f\u548c AWS \u8d1f\u8f7d\u5747\u8861\u5668\u51fa\u73b0\u9519\u8bef\u548c\u8d85\u65f6","text":"<p>\u521b\u5efa\u5fc5\u9700\u7684 Kubernetes \u8d44\u6e90\uff08Service\u3001Deployment\u3001Ingress \u7b49\uff09\u540e\uff0c\u60a8\u7684 Pod \u5e94\u8be5\u80fd\u591f\u901a\u8fc7\u5f39\u6027\u8d1f\u8f7d\u5747\u8861\u5668\u4ece\u5ba2\u6237\u7aef\u63a5\u6536\u6d41\u91cf\u3002\u4f46\u662f\uff0c\u5f53\u60a8\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6216 Kubernetes \u73af\u5883\u8fdb\u884c\u66f4\u6539\u65f6\uff0c\u53ef\u80fd\u4f1a\u53d1\u73b0\u51fa\u73b0\u9519\u8bef\u3001\u8d85\u65f6\u6216\u8fde\u63a5\u91cd\u7f6e\u3002\u8fd9\u4e9b\u66f4\u6539\u53ef\u80fd\u4f1a\u89e6\u53d1\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u6216\u6269\u7f29\u5bb9\u64cd\u4f5c\uff08\u624b\u52a8\u6216\u81ea\u52a8\uff09\u3002</p> <p>\u4e0d\u5e78\u7684\u662f\uff0c\u5373\u4f7f\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8bb0\u5f55\u95ee\u9898\uff0c\u4e5f\u53ef\u80fd\u4f1a\u751f\u6210\u8fd9\u4e9b\u9519\u8bef\u3002\u8fd9\u662f\u56e0\u4e3a\u63a7\u5236\u96c6\u7fa4\u4e2d\u8d44\u6e90\u7684 Kubernetes \u7cfb\u7edf\u53ef\u80fd\u8fd0\u884c\u901f\u5ea6\u6bd4\u63a7\u5236\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u76ee\u6807\u6ce8\u518c\u548c\u8fd0\u884c\u72b6\u51b5\u7684 AWS \u7cfb\u7edf\u66f4\u5feb\u3002\u60a8\u7684 Pod \u4e5f\u53ef\u80fd\u5728\u5e94\u7528\u7a0b\u5e8f\u51c6\u5907\u597d\u63a5\u6536\u8bf7\u6c42\u4e4b\u524d\u5c31\u5f00\u59cb\u63a5\u6536\u6d41\u91cf\u3002</p> <p>\u8ba9\u6211\u4eec\u56de\u987e\u4e00\u4e0b Pod \u53d8\u4e3a\u5c31\u7eea\u72b6\u6001\u7684\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u5982\u4f55\u5c06\u6d41\u91cf\u8def\u7531\u5230 Pod\u3002</p>"},{"location":"zh/networking/loadbalancing/loadbalancing/#pod","title":"Pod \u5c31\u7eea\u72b6\u6001","text":"<p>\u8fd9\u5f20\u6765\u81ea 2019 \u5e74 Kubecon \u6f14\u8bb2\u7684\u56fe\u8868\u663e\u793a\u4e86 Pod \u53d8\u4e3a\u5c31\u7eea\u72b6\u6001\u5e76\u63a5\u6536 <code>LoadBalancer</code> \u670d\u52a1\u6d41\u91cf\u7684\u6b65\u9aa4\uff1a  Ready? A Deep Dive into Pod Readiness Gates for Service Health... - Minhan Xia &amp; Ping Zou \u5f53\u521b\u5efa\u4f5c\u4e3a NodePort \u670d\u52a1\u6210\u5458\u7684 Pod \u65f6\uff0cKubernetes \u5c06\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u5728 Kubernetes \u63a7\u5236\u5e73\u9762\u4e0a\u521b\u5efa Pod\uff08\u5373\u6765\u81ea <code>kubectl</code> \u547d\u4ee4\u6216\u6269\u7f29\u5bb9\u64cd\u4f5c\uff09\u3002</li> <li><code>kube-scheduler</code> \u5c06 Pod \u8c03\u5ea6\u5e76\u5206\u914d\u7ed9\u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\u3002</li> <li>\u5206\u914d\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 kubelet \u5c06\u6536\u5230\u66f4\u65b0\uff08\u901a\u8fc7 <code>watch</code>\uff09\uff0c\u5e76\u5c06\u4e0e\u5176\u672c\u5730\u5bb9\u5668\u8fd0\u884c\u65f6\u901a\u4fe1\u4ee5\u542f\u52a8 Pod \u4e2d\u6307\u5b9a\u7684\u5bb9\u5668\u3002<ol> <li>\u5f53\u5bb9\u5668\u542f\u52a8\u5e76\u8fd0\u884c\uff08\u5e76\u4e14\u53ef\u9009\u5730\u901a\u8fc7 <code>ReadinessProbes</code>\uff09\u65f6\uff0ckubelet \u5c06\u901a\u8fc7\u5411 <code>kube-apiserver</code> \u53d1\u9001\u66f4\u65b0\u6765\u66f4\u65b0 Pod \u72b6\u6001\u4e3a <code>Ready</code></li> </ol> </li> <li>Endpoint \u63a7\u5236\u5668\u5c06\u6536\u5230\u66f4\u65b0\uff08\u901a\u8fc7 <code>watch</code>\uff09\uff0c\u8868\u660e\u6709\u4e00\u4e2a\u65b0\u7684 Pod \u5df2\u51c6\u5907\u597d\u6dfb\u52a0\u5230\u670d\u52a1\u7684 Endpoints \u5217\u8868\u4e2d\uff0c\u5e76\u5c06\u6dfb\u52a0 Pod IP/\u7aef\u53e3\u5143\u7ec4\u5230\u76f8\u5e94\u7684 Endpoints \u6570\u7ec4\u3002</li> <li><code>kube-proxy</code> \u6536\u5230\u66f4\u65b0\uff08\u901a\u8fc7 <code>watch</code>\uff09\uff0c\u8868\u660e\u6709\u4e00\u4e2a\u65b0\u7684 IP/\u7aef\u53e3\u9700\u8981\u6dfb\u52a0\u5230\u670d\u52a1\u7684 iptables \u89c4\u5219\u4e2d\u3002<ol> <li>\u5de5\u4f5c\u8282\u70b9\u4e0a\u7684\u672c\u5730 iptables \u89c4\u5219\u5c06\u4f7f\u7528 NodePort \u670d\u52a1\u7684\u5176\u4ed6\u76ee\u6807 Pod \u8fdb\u884c\u66f4\u65b0\u3002</li> </ol> </li> </ol> <p>Note</p> <p>\u5f53\u4f7f\u7528 Ingress \u8d44\u6e90\u548c Ingress \u63a7\u5236\u5668\uff08\u5982 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\uff09\u65f6\uff0c\u6b65\u9aa4 5 \u7531\u76f8\u5173\u63a7\u5236\u5668\u800c\u4e0d\u662f <code>kube-proxy</code> \u5904\u7406\u3002\u7136\u540e\uff0c\u63a7\u5236\u5668\u5c06\u91c7\u53d6\u5fc5\u8981\u7684\u914d\u7f6e\u6b65\u9aa4\uff08\u5982\u5411\u8d1f\u8f7d\u5747\u8861\u5668\u6ce8\u518c/\u6ce8\u9500\u76ee\u6807\uff09\uff0c\u4ee5\u5141\u8bb8\u6d41\u91cf\u6309\u9884\u671f\u6d41\u52a8\u3002</p> <p>\u5f53 Pod \u7ec8\u6b62\u6216\u53d8\u4e3a\u975e\u5c31\u7eea\u72b6\u6001\u65f6\uff0c\u4f1a\u53d1\u751f\u7c7b\u4f3c\u7684\u8fc7\u7a0b\u3002API \u670d\u52a1\u5668\u5c06\u4ece\u63a7\u5236\u5668\u3001kubelet \u6216 kubectl \u5ba2\u6237\u7aef\u6536\u5230\u7ec8\u6b62 Pod \u7684\u66f4\u65b0\u3002\u6b65\u9aa4 3-5 \u5c06\u7ee7\u7eed\u8fdb\u884c\uff0c\u4f46\u4f1a\u4ece Endpoints \u5217\u8868\u548c iptables \u89c4\u5219\u4e2d\u5220\u9664 Pod IP/\u5143\u7ec4\uff0c\u800c\u4e0d\u662f\u63d2\u5165\u3002</p>"},{"location":"zh/networking/loadbalancing/loadbalancing/#_1","title":"\u5bf9\u90e8\u7f72\u7684\u5f71\u54cd","text":"<p>\u4e0b\u56fe\u663e\u793a\u4e86\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u89e6\u53d1\u66ff\u6362 Pod \u65f6\u91c7\u53d6\u7684\u6b65\u9aa4\uff1a  Ready? A Deep Dive into Pod Readiness Gates for Service Health... - Minhan Xia &amp; Ping Zou \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u7b2c\u4e8c\u4e2a Pod \u5c06\u4e0d\u4f1a\u90e8\u7f72\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a Pod \u8fbe\u5230\"\u5c31\u7eea\"\u72b6\u6001\u3002\u4e0a\u4e00\u8282\u4e2d\u7684\u6b65\u9aa4 4 \u548c 5 \u4e5f\u5c06\u4e0e\u4e0a\u8ff0\u90e8\u7f72\u64cd\u4f5c\u5e76\u884c\u6267\u884c\u3002</p> <p>\u8fd9\u610f\u5473\u7740\u4f20\u64ad\u65b0 Pod \u72b6\u6001\u7684\u64cd\u4f5c\u53ef\u80fd\u5728\u90e8\u7f72\u63a7\u5236\u5668\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2a Pod \u65f6\u4ecd\u5728\u8fdb\u884c\u4e2d\u3002\u7531\u4e8e\u6b64\u8fc7\u7a0b\u8fd8\u4f1a\u7ec8\u6b62\u65e7\u7248\u672c\u7684 Pod\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u5bfc\u81f4 Pod \u5df2\u8fbe\u5230\u5c31\u7eea\u72b6\u6001\uff0c\u4f46\u8fd9\u4e9b\u66f4\u6539\u4ecd\u5728\u4f20\u64ad\uff0c\u800c\u65e7\u7248\u672c\u7684 Pod \u5df2\u88ab\u7ec8\u6b62\u3002</p> <p>\u5f53\u4f7f\u7528 AWS \u7b49\u4e91\u63d0\u4f9b\u5546\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u65f6\uff0c\u8fd9\u4e2a\u95ee\u9898\u4f1a\u52a0\u5267\uff0c\u56e0\u4e3a\u4e0a\u8ff0 Kubernetes \u7cfb\u7edf\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u8003\u8651\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u6ce8\u518c\u65f6\u95f4\u6216\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u3002\u8fd9\u610f\u5473\u7740\u90e8\u7f72\u66f4\u65b0\u53ef\u80fd\u4f1a\u5b8c\u5168\u5faa\u73af\u901a\u8fc7 Pod\uff0c\u4f46\u8d1f\u8f7d\u5747\u8861\u5668\u5c1a\u672a\u5b8c\u6210\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u6216\u6ce8\u518c\u65b0 Pod\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e2d\u65ad\u3002</p> <p>\u5f53 Pod \u7ec8\u6b62\u65f6\u4e5f\u4f1a\u51fa\u73b0\u7c7b\u4f3c\u7684\u95ee\u9898\u3002\u6839\u636e\u8d1f\u8f7d\u5747\u8861\u5668\u914d\u7f6e\uff0cPod \u53ef\u80fd\u9700\u8981\u4e00\u4e24\u5206\u949f\u624d\u80fd\u6ce8\u9500\u5e76\u505c\u6b62\u63a5\u6536\u65b0\u8bf7\u6c42\u3002Kubernetes \u4e0d\u4f1a\u5ef6\u8fdf\u6eda\u52a8\u90e8\u7f72\u4ee5\u7b49\u5f85\u6ce8\u9500\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8d1f\u8f7d\u5747\u8861\u5668\u4ecd\u5728\u5411\u5df2\u7ec8\u6b62\u7684\u76ee\u6807 Pod \u7684 IP/\u7aef\u53e3\u53d1\u9001\u6d41\u91cf\u7684\u72b6\u6001\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u914d\u7f6e\uff0c\u4ee5\u786e\u4fdd Kubernetes \u7cfb\u7edf\u7684\u64cd\u4f5c\u66f4\u7b26\u5408 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u7684\u884c\u4e3a\u3002</p>"},{"location":"zh/networking/loadbalancing/loadbalancing/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/loadbalancing/loadbalancing/#ip","title":"\u4f7f\u7528 IP \u76ee\u6807\u7c7b\u578b\u8d1f\u8f7d\u5747\u8861\u5668","text":"<p>\u521b\u5efa <code>LoadBalancer</code> \u7c7b\u578b\u670d\u52a1\u65f6\uff0c\u6d41\u91cf\u5c06\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u901a\u8fc7\u5b9e\u4f8b\u76ee\u6807\u7c7b\u578b\u6ce8\u518c\u53d1\u9001\u5230\u96c6\u7fa4\u4e2d\u7684\u4efb\u4f55\u8282\u70b9\u3002\u7136\u540e\uff0c\u6bcf\u4e2a\u8282\u70b9\u5c06\u6d41\u91cf\u4ece <code>NodePort</code> \u91cd\u5b9a\u5411\u5230\u670d\u52a1\u7684 Endpoints \u6570\u7ec4\u4e2d\u7684 Pod/IP \u5143\u7ec4\uff0c\u8be5\u76ee\u6807\u53ef\u80fd\u5728\u53e6\u4e00\u4e2a\u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c</p> <p>Note</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u8be5\u6570\u7ec4\u5e94\u8be5\u53ea\u5305\u542b\"\u5c31\u7eea\"\u7684 Pod</p> <p></p> <p>\u8fd9\u589e\u52a0\u4e86\u8bf7\u6c42\u7684\u989d\u5916\u8df3\u8f6c\uff0c\u5e76\u589e\u52a0\u4e86\u8d1f\u8f7d\u5747\u8861\u5668\u914d\u7f6e\u7684\u590d\u6742\u6027\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e0a\u9762\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u914d\u7f6e\u4e86\u4f1a\u8bdd\u4eb2\u548c\u6027\uff0c\u90a3\u4e48\u8be5\u4eb2\u548c\u6027\u53ea\u80fd\u5728\u8d1f\u8f7d\u5747\u8861\u5668\u548c\u540e\u7aef\u8282\u70b9\u4e4b\u95f4\u4fdd\u6301\uff08\u53d6\u51b3\u4e8e\u4eb2\u548c\u6027\u914d\u7f6e\uff09\u3002</p> <p>\u7531\u4e8e\u8d1f\u8f7d\u5747\u8861\u5668\u4e0d\u76f4\u63a5\u4e0e\u540e\u7aef Pod \u901a\u4fe1\uff0c\u56e0\u6b64\u63a7\u5236\u4e0e Kubernetes \u7cfb\u7edf\u7684\u6d41\u91cf\u6d41\u548c\u65f6\u5e8f\u53d8\u5f97\u66f4\u52a0\u56f0\u96be\u3002</p> <p>\u5f53\u4f7f\u7528 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 IP \u76ee\u6807\u7c7b\u578b\u76f4\u63a5\u5c06 Pod IP/\u7aef\u53e3\u5143\u7ec4\u6ce8\u518c\u5230\u8d1f\u8f7d\u5747\u8861\u5668\uff1a  \u8fd9\u7b80\u5316\u4e86\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u5230\u76ee\u6807 Pod \u7684\u6d41\u91cf\u8def\u5f84\u3002\u8fd9\u610f\u5473\u7740\u5f53\u6ce8\u518c\u65b0\u76ee\u6807\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u4fdd\u8be5\u76ee\u6807\u662f\"\u5c31\u7eea\"Pod IP \u548c\u7aef\u53e3\uff0c\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u5c06\u76f4\u63a5\u547d\u4e2d Pod\uff0c\u5e76\u4e14\u5728\u67e5\u770b VPC \u6d41\u65e5\u5fd7\u6216\u76d1\u63a7\u5de5\u5177\u65f6\uff0c\u8d1f\u8f7d\u5747\u8861\u5668\u4e0e Pod \u4e4b\u95f4\u7684\u6d41\u91cf\u5c06\u6613\u4e8e\u8ddf\u8e2a\u3002</p> <p>\u4f7f\u7528 IP \u6ce8\u518c\u8fd8\u5141\u8bb8\u6211\u4eec\u76f4\u63a5\u9488\u5bf9\u540e\u7aef Pod \u63a7\u5236\u6d41\u91cf\u7684\u65f6\u5e8f\u548c\u914d\u7f6e\uff0c\u800c\u4e0d\u662f\u8bd5\u56fe\u901a\u8fc7 <code>NodePort</code> \u89c4\u5219\u6765\u7ba1\u7406\u8fde\u63a5\u3002</p>"},{"location":"zh/networking/loadbalancing/loadbalancing/#pod_1","title":"\u5229\u7528 Pod \u5c31\u7eea\u95e8\u63a7","text":"<p>Pod \u5c31\u7eea\u95e8\u63a7\u662f\u5728 Pod \u88ab\u5141\u8bb8\u8fbe\u5230\"\u5c31\u7eea\"\u72b6\u6001\u4e4b\u524d\u5fc5\u987b\u6ee1\u8db3\u7684\u5176\u4ed6\u8981\u6c42\u3002</p> <p>[...] AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\u53ef\u4ee5\u5728\u6784\u6210\u60a8\u7684 Ingress \u6216\u670d\u52a1\u540e\u7aef\u7684 Pod \u4e0a\u8bbe\u7f6e\u5c31\u7eea\u72b6\u6001\u6761\u4ef6\u3002\u53ea\u6709\u5f53 ALB/NLB \u76ee\u6807\u7ec4\u4e2d\u7684\u76f8\u5e94\u76ee\u6807\u663e\u793a\"\u5065\u5eb7\"\u72b6\u6001\u65f6\uff0cPod \u4e0a\u7684\u6761\u4ef6\u72b6\u6001\u624d\u4f1a\u8bbe\u7f6e\u4e3a <code>True</code>\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u90e8\u7f72\u7684\u6eda\u52a8\u66f4\u65b0\u5728\u65b0\u521b\u5efa\u7684 Pod \u5728 ALB/NLB \u76ee\u6807\u7ec4\u4e2d\"\u5065\u5eb7\"\u5e76\u51c6\u5907\u597d\u63a5\u6536\u6d41\u91cf\u4e4b\u524d\u7ec8\u6b62\u65e7 Pod\u3002</p> <p>\u5c31\u7eea\u95e8\u63a7\u53ef\u786e\u4fdd Kubernetes \u5728\u521b\u5efa\u65b0\u526f\u672c\u671f\u95f4\u4e0d\u4f1a\"\u79fb\u52a8\u592a\u5feb\"\uff0c\u4ece\u800c\u907f\u514d Kubernetes \u5df2\u5b8c\u6210\u90e8\u7f72\u4f46\u65b0 Pod \u5c1a\u672a\u5b8c\u6210\u6ce8\u518c\u7684\u60c5\u51b5\u3002</p> <p>\u8981\u542f\u7528\u8fd9\u4e9b\u529f\u80fd\uff0c\u60a8\u9700\u8981\uff1a</p> <ol> <li>\u90e8\u7f72\u6700\u65b0\u7248\u672c\u7684 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\uff08*\u5982\u679c\u5347\u7ea7\u65e7\u7248\u672c\uff0c\u8bf7\u53c2\u9605\u6587\u6863\uff09</li> <li>\u4e3a\u76ee\u6807 Pod \u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u6dfb\u52a0\u6807\u7b7e <code>elbv2.k8s.aws/pod-readiness-gate-inject: enabled</code>\uff0c\u4ee5\u81ea\u52a8\u6ce8\u5165 Pod \u5c31\u7eea\u95e8\u63a7\u3002</li> <li>\u8981\u786e\u4fdd\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709 Pod \u90fd\u83b7\u5f97\u5c31\u7eea\u95e8\u63a7\u914d\u7f6e\uff0c\u60a8\u9700\u8981\u5728\u521b\u5efa Pod \u4e4b\u524d\u521b\u5efa Ingress \u6216\u670d\u52a1\u5e76\u4e3a\u547d\u540d\u7a7a\u95f4\u6dfb\u52a0\u6807\u7b7e\u3002</li> </ol>"},{"location":"zh/networking/loadbalancing/loadbalancing/#pod_2","title":"\u786e\u4fdd\u5728\u7ec8\u6b62 Pod \u4e4b\u524d\u5c06\u5176\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u6ce8\u9500","text":"<p>\u5f53 Pod \u7ec8\u6b62\u65f6\uff0cPod \u5c31\u7eea\u72b6\u6001\u90e8\u5206\u4e2d\u7684\u6b65\u9aa4 4 \u548c 5 \u5c06\u4e0e\u5bb9\u5668\u8fdb\u7a0b\u63a5\u6536\u7ec8\u6b62\u4fe1\u53f7\u7684\u540c\u65f6\u53d1\u751f\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u60a8\u7684\u5bb9\u5668\u80fd\u591f\u5feb\u901f\u5173\u95ed\uff0c\u5b83\u53ef\u80fd\u4f1a\u6bd4\u8d1f\u8f7d\u5747\u8861\u5668\u6ce8\u9500\u76ee\u6807\u66f4\u5feb\u3002\u4e3a\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u8c03\u6574 Pod \u89c4\u8303\uff1a</p> <ol> <li>\u6dfb\u52a0 <code>preStop</code> \u751f\u547d\u5468\u671f\u94a9\u5b50\uff0c\u5141\u8bb8\u5e94\u7528\u7a0b\u5e8f\u6ce8\u9500\u5e76\u6b63\u5e38\u5173\u95ed\u8fde\u63a5\u3002\u6b64\u94a9\u5b50\u5728\u5bb9\u5668\u7531\u4e8e API \u8bf7\u6c42\u6216\u7ba1\u7406\u4e8b\u4ef6\uff08\u5982\u6d3b\u8dc3\u5ea6/\u542f\u52a8\u63a2\u9488\u5931\u8d25\u3001\u62a2\u5360\u3001\u8d44\u6e90\u4e89\u7528\u7b49\uff09\u800c\u7ec8\u6b62\u4e4b\u524d\u7acb\u5373\u88ab\u8c03\u7528\u3002\u5173\u952e\u662f\uff0c\u53ea\u8981\u5bbd\u9650\u671f\u8db3\u591f\u957f\u4ee5\u5bb9\u7eb3\u6267\u884c\uff0c\u6b64\u94a9\u5b50\u5c31\u4f1a\u88ab\u8c03\u7528\u5e76\u5141\u8bb8\u5b8c\u6210\u4e4b\u524d\u53d1\u9001\u7ec8\u6b62\u4fe1\u53f7\u3002</li> </ol> <pre><code>        lifecycle:\n          preStop:\n            exec:\n              command: [\"/bin/sh\", \"-c\", \"sleep 180\"] \n</code></pre> <p>\u50cf\u4e0a\u9762\u8fd9\u6837\u7684\u7b80\u5355\u7761\u7720\u547d\u4ee4\u53ef\u7528\u4e8e\u5728 Pod \u88ab\u6807\u8bb0\u4e3a <code>Terminating</code>\uff08\u5e76\u5f00\u59cb\u8d1f\u8f7d\u5747\u8861\u5668\u6ce8\u9500\uff09\u548c\u5411\u5bb9\u5668\u8fdb\u7a0b\u53d1\u9001\u7ec8\u6b62\u4fe1\u53f7\u4e4b\u95f4\u5f15\u5165\u77ed\u6682\u5ef6\u8fdf\u3002\u5982\u679c\u9700\u8981\uff0c\u6b64\u94a9\u5b50\u8fd8\u53ef\u7528\u4e8e\u66f4\u9ad8\u7ea7\u7684\u5e94\u7528\u7a0b\u5e8f\u7ec8\u6b62/\u5173\u95ed\u8fc7\u7a0b\u3002</p> <ol> <li>\u6269\u5c55 <code>terminationGracePeriodSeconds</code> \u4ee5\u5bb9\u7eb3\u6574\u4e2a <code>prestop</code> \u6267\u884c\u65f6\u95f4\uff0c\u4ee5\u53ca\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u54cd\u5e94\u7ec8\u6b62\u4fe1\u53f7\u6240\u9700\u7684\u65f6\u95f4\u3002\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5bbd\u9650\u671f\u5ef6\u957f\u5230 200 \u79d2\uff0c\u8fd9\u5141\u8bb8\u5b8c\u5168\u6267\u884c <code>sleep 180</code> \u547d\u4ee4\uff0c\u7136\u540e\u518d\u989d\u5916\u5ef6\u957f 20 \u79d2\uff0c\u4ee5\u786e\u4fdd\u6211\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u5173\u95ed\u3002</li> </ol> <pre><code>    spec:\n      terminationGracePeriodSeconds: 200\n      containers:\n      - name: webapp\n        image: webapp-st:v1.3\n        [...]\n        lifecycle:\n          preStop:\n            exec:\n              command: [\"/bin/sh\", \"-c\", \"sleep 180\"] \n</code></pre>"},{"location":"zh/networking/loadbalancing/loadbalancing/#pod_3","title":"\u786e\u4fdd Pod \u5177\u6709\u5c31\u7eea\u63a2\u9488","text":"<p>\u5728 Kubernetes \u4e2d\u521b\u5efa Pod \u65f6\uff0c\u9ed8\u8ba4\u5c31\u7eea\u72b6\u6001\u4e3a\"\u5c31\u7eea\"\uff0c\u4f46\u5927\u591a\u6570\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u4e00\u4e24\u79d2\u949f\u7684\u65f6\u95f4\u6765\u5b9e\u4f8b\u5316\u5e76\u51c6\u5907\u597d\u63a5\u6536\u8bf7\u6c42\u3002\u60a8\u53ef\u4ee5\u5728 Pod \u89c4\u8303\u4e2d\u5b9a\u4e49 <code>readinessProbe</code>\uff0c\u5176\u4e2d\u5305\u542b\u7528\u4e8e\u786e\u5b9a\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u5df2\u5b8c\u6210\u542f\u52a8\u5e76\u51c6\u5907\u597d\u63a5\u6536\u6d41\u91cf\u7684 exec \u547d\u4ee4\u6216\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p>\u5b9a\u4e49\u4e86 <code>readinessProbe</code> \u7684 Pod \u4ee5\"NotReady\"\u72b6\u6001\u542f\u52a8\uff0c\u5e76\u4e14\u53ea\u6709\u5728 <code>readinessProbe</code> \u6210\u529f\u65f6\u624d\u4f1a\u53d8\u4e3a\"\u5c31\u7eea\"\u72b6\u6001\u3002\u8fd9\u53ef\u786e\u4fdd\u5e94\u7528\u7a0b\u5e8f\u5728\u5b8c\u6210\u542f\u52a8\u4e4b\u524d\u4e0d\u4f1a\u88ab\u7f6e\u4e8e\"\u5728\u670d\u52a1\"\u72b6\u6001\u3002</p> <p>\u5efa\u8bae\u4f7f\u7528\u6d3b\u8dc3\u5ea6\u63a2\u9488\uff0c\u4ee5\u4fbf\u5728\u5e94\u7528\u7a0b\u5e8f\u8fdb\u5165\u635f\u574f\u72b6\u6001\uff08\u5982\u6b7b\u9501\uff09\u65f6\u91cd\u65b0\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\uff0c\u4f46\u5bf9\u4e8e\u6709\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e94\u8c28\u614e\u4f7f\u7528\u6d3b\u8dc3\u5ea6\u63a2\u9488\uff0c\u56e0\u4e3a\u6d3b\u8dc3\u5ea6\u5931\u8d25\u5c06\u89e6\u53d1\u5e94\u7528\u7a0b\u5e8f\u91cd\u65b0\u542f\u52a8\u3002\u4e5f\u53ef\u4ee5\u5229\u7528\u542f\u52a8\u63a2\u9488\u7528\u4e8e\u542f\u52a8\u7f13\u6162\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u4e0b\u9762\u7684\u63a2\u9488\u4f7f\u7528 HTTP \u63a2\u9488\u9488\u5bf9\u7aef\u53e3 80 \u68c0\u67e5 Web \u5e94\u7528\u7a0b\u5e8f\u4f55\u65f6\u5c31\u7eea\uff08\u540c\u6837\u7684\u63a2\u9488\u914d\u7f6e\u4e5f\u7528\u4e8e\u6d3b\u8dc3\u5ea6\u63a2\u9488\uff09\uff1a</p> <pre><code>        [...]\n        ports:\n        - containerPort: 80\n        livenessProbe:\n          httpGet:\n            path: /\n            port: 80\n          failureThreshold: 1\n          periodSeconds: 10\n          initialDelaySeconds: 5\n        readinessProbe:\n          httpGet:\n            path: /\n            port: 80\n          periodSeconds: 5\n        [...]\n</code></pre>"},{"location":"zh/networking/loadbalancing/loadbalancing/#pod_4","title":"\u914d\u7f6e Pod \u4e2d\u65ad\u9884\u7b97","text":"<p>Pod \u4e2d\u65ad\u9884\u7b97 (PDB) \u9650\u5236\u4e86\u5728\u81ea\u613f\u4e2d\u65ad\u671f\u95f4\u540c\u65f6\u505c\u6b62\u7684\u590d\u5236\u5e94\u7528\u7a0b\u5e8f Pod \u7684\u6570\u91cf\u3002\u4f8b\u5982\uff0c\u57fa\u4e8e\u4ef2\u88c1\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u5e0c\u671b\u786e\u4fdd\u8fd0\u884c\u7684\u526f\u672c\u6570\u91cf\u6c38\u8fdc\u4e0d\u4f1a\u4f4e\u4e8e\u4ef2\u88c1\u6240\u9700\u7684\u6570\u91cf\u3002Web \u524d\u7aef\u53ef\u80fd\u5e0c\u671b\u786e\u4fdd\u670d\u52a1\u8d1f\u8f7d\u7684\u526f\u672c\u6570\u91cf\u6c38\u8fdc\u4e0d\u4f1a\u4f4e\u4e8e\u603b\u6570\u7684\u67d0\u4e2a\u767e\u5206\u6bd4\u3002</p> <p>PDB \u5c06\u4fdd\u62a4\u5e94\u7528\u7a0b\u5e8f\u514d\u53d7\u8bf8\u5982\u8282\u70b9\u6392\u7a7a\u6216\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u7b49\u64cd\u4f5c\u7684\u5f71\u54cd\u3002PDB \u786e\u4fdd\u5728\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u65f6\u81f3\u5c11\u6709\u4e00\u5b9a\u6570\u91cf\u6216\u767e\u5206\u6bd4\u7684 Pod \u4fdd\u6301\u53ef\u7528\u3002</p> <p>Attention</p> <p>PDB \u4e0d\u4f1a\u4fdd\u62a4\u5e94\u7528\u7a0b\u5e8f\u514d\u53d7\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u6545\u969c\u6216\u7f51\u7edc\u8fde\u63a5\u4e2d\u65ad\u7b49\u975e\u81ea\u613f\u4e2d\u65ad\u7684\u5f71\u54cd\u3002</p> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u786e\u4fdd\u59cb\u7ec8\u81f3\u5c11\u6709\u4e00\u4e2a\u5e26\u6709\u6807\u7b7e <code>app: echoserver</code> \u7684 Pod \u53ef\u7528\u3002\u60a8\u53ef\u4ee5\u4e3a\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\u6b63\u786e\u7684\u526f\u672c\u6570\u91cf\u6216\u4f7f\u7528\u767e\u5206\u6bd4\uff1a</p> <pre><code>apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: echoserver-pdb\n  namespace: echoserver\nspec:\n  minAvailable: 1\n  selector:\n    matchLabels:\n      app: echoserver\n</code></pre>"},{"location":"zh/networking/loadbalancing/loadbalancing/#_3","title":"\u6b63\u5e38\u5904\u7406\u7ec8\u6b62\u4fe1\u53f7","text":"<p>\u5f53 Pod \u7ec8\u6b62\u65f6\uff0c\u5bb9\u5668\u5185\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u6536\u5230\u4e24\u4e2a\u4fe1\u53f7\u3002\u7b2c\u4e00\u4e2a\u662f <code>SIGTERM</code> \u4fe1\u53f7\uff0c\u8fd9\u662f\u4e00\u4e2a\"\u793c\u8c8c\"\u7684\u8bf7\u6c42\u8fdb\u7a0b\u505c\u6b62\u6267\u884c\u3002\u6b64\u4fe1\u53f7\u53ef\u4ee5\u88ab\u963b\u585e\u6216\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u7b80\u5355\u5730\u5ffd\u7565\u6b64\u4fe1\u53f7\uff0c\u56e0\u6b64\u5728 <code>terminationGracePeriodSeconds</code> \u8fc7\u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u6536\u5230 <code>SIGKILL</code> \u4fe1\u53f7\u3002<code>SIGKILL</code> \u7528\u4e8e\u5f3a\u5236\u505c\u6b62\u8fdb\u7a0b\uff0c\u5b83\u4e0d\u80fd\u88ab\u963b\u585e\u3001\u5904\u7406\u6216\u5ffd\u7565\uff0c\u56e0\u6b64\u603b\u662f\u81f4\u547d\u7684\u3002</p> <p>\u8fd9\u4e9b\u4fe1\u53f7\u7531\u5bb9\u5668\u8fd0\u884c\u65f6\u7528\u4e8e\u89e6\u53d1\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5173\u95ed\u3002<code>SIGTERM</code> \u4fe1\u53f7\u4e5f\u5c06\u5728 <code>preStop</code> \u94a9\u5b50\u6267\u884c\u540e\u53d1\u9001\u3002\u4f7f\u7528\u4e0a\u8ff0\u914d\u7f6e\uff0c<code>preStop</code> \u94a9\u5b50\u5c06\u786e\u4fdd Pod \u5df2\u4ece\u8d1f\u8f7d\u5747\u8861\u5668\u6ce8\u9500\uff0c\u56e0\u6b64\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5728\u6536\u5230 <code>SIGTERM</code> \u4fe1\u53f7\u65f6\u6b63\u5e38\u5173\u95ed\u4efb\u4f55\u5269\u4f59\u7684\u6253\u5f00\u8fde\u63a5\u3002</p> <p>Note</p> <p>\u5728\u5bb9\u5668\u73af\u5883\u4e2d\u5904\u7406\u4fe1\u53f7\u65f6\uff0c\u5982\u679c\u4f7f\u7528\"\u5305\u88c5\u811a\u672c\"\u4f5c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff0c\u60c5\u51b5\u53ef\u80fd\u4f1a\u53d8\u5f97\u590d\u6742\uff0c\u56e0\u4e3a\u811a\u672c\u5c06\u662f PID 1\uff0c\u5e76\u4e14\u53ef\u80fd\u4e0d\u4f1a\u5c06\u4fe1\u53f7\u8f6c\u53d1\u7ed9\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"zh/networking/loadbalancing/loadbalancing/#_4","title":"\u6ce8\u610f\u6ce8\u9500\u5ef6\u8fdf","text":"<p>\u5f39\u6027\u8d1f\u8f7d\u5747\u8861\u5668\u505c\u6b62\u5411\u6b63\u5728\u6ce8\u9500\u7684\u76ee\u6807\u53d1\u9001\u8bf7\u6c42\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f39\u6027\u8d1f\u8f7d\u5747\u8861\u5668\u5728\u5b8c\u6210\u6ce8\u9500\u8fc7\u7a0b\u4e4b\u524d\u7b49\u5f85 300 \u79d2\uff0c\u8fd9\u6709\u52a9\u4e8e\u5b8c\u6210\u5bf9\u76ee\u6807\u7684\u73b0\u6709\u8bf7\u6c42\u3002\u8981\u66f4\u6539\u5f39\u6027\u8d1f\u8f7d\u5747\u8861\u5668\u7b49\u5f85\u7684\u65f6\u95f4\uff0c\u8bf7\u66f4\u65b0\u6ce8\u9500\u5ef6\u8fdf\u503c\u3002 \u6b63\u5728\u6ce8\u9500\u7684\u76ee\u6807\u7684\u521d\u59cb\u72b6\u6001\u4e3a <code>draining</code>\u3002\u6ce8\u9500\u5ef6\u8fdf\u8fc7\u540e\uff0c\u6ce8\u9500\u8fc7\u7a0b\u5b8c\u6210\uff0c\u76ee\u6807\u7684\u72b6\u6001\u4e3a <code>unused</code>\u3002\u5982\u679c\u76ee\u6807\u662f\u81ea\u52a8\u6269\u7f29\u7ec4\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u53ef\u4ee5\u88ab\u7ec8\u6b62\u5e76\u66ff\u6362\u3002</p> <p>\u5982\u679c\u6b63\u5728\u6ce8\u9500\u7684\u76ee\u6807\u6ca1\u6709\u73b0\u6709\u8bf7\u6c42\u548c\u6d3b\u52a8\u8fde\u63a5\uff0c\u5f39\u6027\u8d1f\u8f7d\u5747\u8861\u5668\u5c06\u7acb\u5373\u5b8c\u6210\u6ce8\u9500\u8fc7\u7a0b\uff0c\u800c\u4e0d\u7b49\u5f85\u6ce8\u9500\u5ef6\u8fdf\u8fc7\u671f\u3002</p> <p>Attention</p> <p>\u5373\u4f7f\u76ee\u6807\u6ce8\u9500\u5df2\u5b8c\u6210\uff0c\u76ee\u6807\u7684\u72b6\u6001\u4ecd\u663e\u793a\u4e3a <code>draining</code>\uff0c\u76f4\u5230\u6ce8\u9500\u5ef6\u8fdf\u8d85\u65f6\u8fc7\u671f\u3002\u8d85\u65f6\u8fc7\u671f\u540e\uff0c\u76ee\u6807\u5c06\u8f6c\u6362\u4e3a <code>unused</code> \u72b6\u6001\u3002</p> <p>\u5982\u679c\u6b63\u5728\u6ce8\u9500\u7684\u76ee\u6807\u5728\u6ce8\u9500\u5ef6\u8fdf\u8fc7\u671f\u4e4b\u524d\u7ec8\u6b62\u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u5c06\u6536\u5230 500 \u7ea7\u9519\u8bef\u54cd\u5e94\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 Ingress \u8d44\u6e90\u4e0a\u7684 <code>alb.ingress.kubernetes.io/target-group-attributes</code> \u6ce8\u89e3\u8fdb\u884c\u914d\u7f6e\u3002\u793a\u4f8b\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: echoserver-ip\n  namespace: echoserver\n  annotations:\n    alb.ingress.kubernetes.io/scheme: internet-facing\n    alb.ingress.kubernetes.io/target-type: ip\n    alb.ingress.kubernetes.io/load-balancer-name: echoserver-ip\n    alb.ingress.kubernetes.io/target-group-attributes: deregistration_delay.timeout_seconds=30\nspec:\n  ingressClassName: alb\n  rules:\n    - host: echoserver.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Exact\n            backend:\n              service:\n                name: echoserver-service\n                port:\n                  number: 8080\n</code></pre>"},{"location":"zh/networking/monitoring/","title":"\u76d1\u63a7 EKS \u5de5\u4f5c\u8d1f\u8f7d\u7684\u7f51\u7edc\u6027\u80fd\u95ee\u9898","text":""},{"location":"zh/networking/monitoring/#coredns-dns","title":"\u76d1\u63a7 CoreDNS \u6d41\u91cf\u4ee5\u68c0\u6d4b DNS \u8282\u6d41\u95ee\u9898","text":"<p>\u8fd0\u884c DNS \u5bc6\u96c6\u578b\u5de5\u4f5c\u8d1f\u8f7d\u6709\u65f6\u4f1a\u7531\u4e8e DNS \u8282\u6d41\u800c\u9047\u5230\u95f4\u6b47\u6027\u7684 CoreDNS \u6545\u969c\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230\u5076\u5c14\u7684 UnknownHostException \u9519\u8bef\u3002</p> <p>CoreDNS \u7684 Deployment \u5177\u6709\u53cd\u4eb2\u548c\u6027\u7b56\u7565\uff0c\u8be5\u7b56\u7565\u6307\u793a Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u5728\u96c6\u7fa4\u4e2d\u7684\u4e0d\u540c\u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c CoreDNS \u5b9e\u4f8b\uff0c\u5373\u5b83\u5e94\u8be5\u907f\u514d\u5728\u540c\u4e00\u5de5\u4f5c\u8282\u70b9\u4e0a\u5171\u5b58\u526f\u672c\u3002\u8fd9\u6709\u6548\u5730\u51cf\u5c11\u4e86\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684 DNS \u67e5\u8be2\u6570\u91cf\uff0c\u56e0\u4e3a\u6765\u81ea\u6bcf\u4e2a\u526f\u672c\u7684\u6d41\u91cf\u90fd\u901a\u8fc7\u4e0d\u540c\u7684 ENI \u8def\u7531\u3002\u5982\u679c\u60a8\u6ce8\u610f\u5230\u7531\u4e8e\u6bcf\u79d2 1024 \u4e2a\u6570\u636e\u5305\u7684\u9650\u5236\u800c\u5bfc\u81f4 DNS \u67e5\u8be2\u88ab\u8282\u6d41\uff0c\u60a8\u53ef\u4ee5 1) \u5c1d\u8bd5\u589e\u52a0 CoreDNS \u526f\u672c\u7684\u6570\u91cf\u6216 2) \u5b9e\u73b0 NodeLocal DNSCache\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Monitor CoreDNS Metrics\u3002</p>"},{"location":"zh/networking/monitoring/#_1","title":"\u6311\u6218","text":"<ul> <li>\u6570\u636e\u5305\u4e22\u5f03\u53d1\u751f\u5728\u51e0\u79d2\u949f\u5185\uff0c\u5f88\u96be\u9002\u5f53\u76d1\u63a7\u8fd9\u4e9b\u6a21\u5f0f\u4ee5\u786e\u5b9a\u662f\u5426\u5b9e\u9645\u53d1\u751f\u4e86 DNS \u8282\u6d41\u3002</li> <li>DNS \u67e5\u8be2\u5728\u5f39\u6027\u7f51\u7edc\u63a5\u53e3\u7ea7\u522b\u88ab\u8282\u6d41\u3002\u56e0\u6b64\uff0c\u8282\u6d41\u7684\u67e5\u8be2\u4e0d\u4f1a\u51fa\u73b0\u5728\u67e5\u8be2\u65e5\u5fd7\u4e2d\u3002</li> <li>\u6d41\u65e5\u5fd7\u4e0d\u4f1a\u6355\u83b7\u6240\u6709 IP \u6d41\u91cf\u3002\u4f8b\u5982\uff0c\u5b9e\u4f8b\u8054\u7cfb Amazon DNS \u670d\u52a1\u5668\u65f6\u751f\u6210\u7684\u6d41\u91cf\u3002\u5982\u679c\u60a8\u4f7f\u7528\u81ea\u5df1\u7684 DNS \u670d\u52a1\u5668\uff0c\u5219\u4f1a\u8bb0\u5f55\u5230\u8be5 DNS \u670d\u52a1\u5668\u7684\u6240\u6709\u6d41\u91cf\u3002</li> </ul>"},{"location":"zh/networking/monitoring/#_2","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>\u8bc6\u522b\u5de5\u4f5c\u8282\u70b9\u4e2d DNS \u8282\u6d41\u95ee\u9898\u7684\u4e00\u79cd\u7b80\u5355\u65b9\u6cd5\u662f\u6355\u83b7 <code>linklocal_allowance_exceeded</code> \u6307\u6807\u3002linklocal_allowance_exceeded \u662f\u7531\u4e8e\u5230\u672c\u5730\u4ee3\u7406\u670d\u52a1\u7684\u6d41\u91cf\u7684 PPS \u8d85\u8fc7\u7f51\u7edc\u63a5\u53e3\u7684\u6700\u5927\u503c\u800c\u5bfc\u81f4\u7684\u4e22\u5f03\u6570\u636e\u5305\u6570\u91cf\u3002\u8fd9\u4f1a\u5f71\u54cd\u5230 DNS \u670d\u52a1\u3001\u5b9e\u4f8b\u5143\u6570\u636e\u670d\u52a1\u548c Amazon \u65f6\u95f4\u540c\u6b65\u670d\u52a1\u7684\u6d41\u91cf\u3002\u6211\u4eec\u4e0d\u4ec5\u53ef\u4ee5\u5b9e\u65f6\u8ddf\u8e2a\u6b64\u4e8b\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u5c06\u6b64\u6307\u6807\u6d41\u5f0f\u4f20\u8f93\u5230 Amazon Managed Service for Prometheus,\u5e76\u53ef\u4ee5\u5728 Amazon Managed Grafana \u4e2d\u5c06\u5176\u53ef\u89c6\u5316\u3002</p>"},{"location":"zh/networking/monitoring/#conntrack-dns","title":"\u4f7f\u7528 Conntrack \u6307\u6807\u76d1\u63a7 DNS \u67e5\u8be2\u5ef6\u8fdf","text":"<p>\u53e6\u4e00\u4e2a\u53ef\u4ee5\u5e2e\u52a9\u76d1\u63a7 CoreDNS \u8282\u6d41/\u67e5\u8be2\u5ef6\u8fdf\u7684\u6307\u6807\u662f <code>conntrack_allowance_available</code> \u548c <code>conntrack_allowance_exceeded</code>\u3002 \u7531\u4e8e\u8d85\u51fa\u8ddf\u8e2a\u8fde\u63a5\u7684\u5141\u8bb8\u503c\u800c\u5bfc\u81f4\u7684\u8fde\u63a5\u5931\u8d25\u53ef\u80fd\u4f1a\u6bd4\u7531\u4e8e\u8d85\u51fa\u5176\u4ed6\u5141\u8bb8\u503c\u800c\u5bfc\u81f4\u7684\u8fde\u63a5\u5931\u8d25\u4ea7\u751f\u66f4\u5927\u7684\u5f71\u54cd\u3002\u5f53\u4f9d\u8d56 TCP \u4f20\u8f93\u6570\u636e\u65f6\uff0c\u7531\u4e8e\u8d85\u51fa EC2 \u5b9e\u4f8b\u7f51\u7edc\u5141\u8bb8\u503c(\u5982\u5e26\u5bbd\u3001PPS \u7b49)\u800c\u5bfc\u81f4\u7684\u6392\u961f\u6216\u4e22\u5f03\u6570\u636e\u5305\u901a\u5e38\u4f1a\u7531\u4e8e TCP \u7684\u62e5\u585e\u63a7\u5236\u529f\u80fd\u800c\u5f97\u5230\u8f83\u597d\u7684\u5904\u7406\u3002\u53d7\u5f71\u54cd\u7684\u6d41\u91cf\u5c06\u51cf\u6162\u901f\u5ea6\uff0c\u5e76\u4e14\u4e22\u5931\u7684\u6570\u636e\u5305\u5c06\u88ab\u91cd\u65b0\u4f20\u8f93\u3002\u4f46\u662f\uff0c\u5f53\u5b9e\u4f8b\u8d85\u51fa\u5176\u8ddf\u8e2a\u8fde\u63a5\u7684\u5141\u8bb8\u503c\u65f6\uff0c\u5728\u5173\u95ed\u4e00\u4e9b\u73b0\u6709\u8fde\u63a5\u4ee5\u817e\u51fa\u7a7a\u95f4\u4f9b\u65b0\u8fde\u63a5\u4f7f\u7528\u4e4b\u524d\uff0c\u5c06\u65e0\u6cd5\u5efa\u7acb\u65b0\u8fde\u63a5\u3002</p> <p><code>conntrack_allowance_available</code> \u548c <code>conntrack_allowance_exceeded</code> \u53ef\u5e2e\u52a9\u5ba2\u6237\u76d1\u63a7\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u8ddf\u8e2a\u8fde\u63a5\u5141\u8bb8\u503c\u3002\u8fd9\u4e9b\u7f51\u7edc\u6027\u80fd\u6307\u6807\u8ba9\u5ba2\u6237\u4e86\u89e3\u5f53\u5b9e\u4f8b\u7684\u7f51\u7edc\u5141\u8bb8\u503c(\u5982\u7f51\u7edc\u5e26\u5bbd\u3001\u6bcf\u79d2\u6570\u636e\u5305\u6570 (PPS)\u3001\u8ddf\u8e2a\u8fde\u63a5\u548c\u94fe\u8def\u672c\u5730\u670d\u52a1\u8bbf\u95ee (Amazon DNS\u3001\u5b9e\u4f8b\u5143\u6570\u636e\u670d\u52a1\u3001Amazon \u65f6\u95f4\u540c\u6b65))\u88ab\u8d85\u51fa\u65f6\uff0c\u6392\u961f\u6216\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\u91cf\u3002</p> <p><code>conntrack_allowance_available</code> \u662f\u5b9e\u4f8b\u5728\u8fbe\u5230\u8be5\u5b9e\u4f8b\u7c7b\u578b\u7684\u8ddf\u8e2a\u8fde\u63a5\u5141\u8bb8\u503c\u4e4b\u524d\u53ef\u4ee5\u5efa\u7acb\u7684\u8ddf\u8e2a\u8fde\u63a5\u6570(\u4ec5\u652f\u6301\u57fa\u4e8e nitro \u7684\u5b9e\u4f8b)\u3002 <code>conntrack_allowance_exceeded</code> \u662f\u7531\u4e8e\u8fde\u63a5\u8ddf\u8e2a\u8d85\u8fc7\u6700\u5927\u503c\u800c\u5bfc\u81f4\u65e0\u6cd5\u5efa\u7acb\u65b0\u8fde\u63a5\u800c\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\u3002</p>"},{"location":"zh/networking/monitoring/#_3","title":"\u5176\u4ed6\u91cd\u8981\u7684\u7f51\u7edc\u6027\u80fd\u6307\u6807","text":"<p>\u5176\u4ed6\u91cd\u8981\u7684\u7f51\u7edc\u6027\u80fd\u6307\u6807\u5305\u62ec\uff1a</p> <p><code>bw_in_allowance_exceeded</code> (\u8be5\u6307\u6807\u7684\u7406\u60f3\u503c\u5e94\u4e3a\u96f6) \u662f\u7531\u4e8e\u5165\u7ad9\u603b\u5e26\u5bbd\u8d85\u8fc7\u5b9e\u4f8b\u7684\u6700\u5927\u503c\u800c\u5bfc\u81f4\u6392\u961f\u548c/\u6216\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\u3002</p> <p><code>bw_out_allowance_exceeded</code> (\u8be5\u6307\u6807\u7684\u7406\u60f3\u503c\u5e94\u4e3a\u96f6) \u662f\u7531\u4e8e\u51fa\u7ad9\u603b\u5e26\u5bbd\u8d85\u8fc7\u5b9e\u4f8b\u7684\u6700\u5927\u503c\u800c\u5bfc\u81f4\u6392\u961f\u548c/\u6216\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\u3002</p> <p><code>pps_allowance_exceeded</code> (\u8be5\u6307\u6807\u7684\u7406\u60f3\u503c\u5e94\u4e3a\u96f6) \u662f\u7531\u4e8e\u53cc\u5411 PPS \u8d85\u8fc7\u5b9e\u4f8b\u7684\u6700\u5927\u503c\u800c\u5bfc\u81f4\u6392\u961f\u548c/\u6216\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\u3002</p>"},{"location":"zh/networking/monitoring/#_4","title":"\u6355\u83b7\u6307\u6807\u4ee5\u76d1\u63a7\u5de5\u4f5c\u8d1f\u8f7d\u7684\u7f51\u7edc\u6027\u80fd\u95ee\u9898","text":"<p>Elastic Network Adapter (ENA) \u9a71\u52a8\u7a0b\u5e8f\u4f1a\u4ece\u542f\u7528\u4e86\u8be5\u9a71\u52a8\u7a0b\u5e8f\u7684\u5b9e\u4f8b\u4e2d\u53d1\u5e03\u4e0a\u8ff0\u7f51\u7edc\u6027\u80fd\u6307\u6807\u3002\u6240\u6709\u7f51\u7edc\u6027\u80fd\u6307\u6807\u90fd\u53ef\u4ee5\u4f7f\u7528 CloudWatch \u4ee3\u7406\u53d1\u5e03\u5230 CloudWatch\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u535a\u5ba2\u3002</p> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u6355\u83b7\u4e0a\u8ff0\u6307\u6807\uff0c\u5c06\u5b83\u4eec\u5b58\u50a8\u5728 Amazon Managed Service for Prometheus \u4e2d\uff0c\u5e76\u4f7f\u7528 Amazon Managed Grafana \u8fdb\u884c\u53ef\u89c6\u5316\u3002</p>"},{"location":"zh/networking/monitoring/#_5","title":"\u5148\u51b3\u6761\u4ef6","text":"<ul> <li>ethtool - \u786e\u4fdd\u5de5\u4f5c\u8282\u70b9\u5df2\u5b89\u88c5 ethtool</li> <li>\u5728\u60a8\u7684 AWS \u8d26\u6237\u4e2d\u914d\u7f6e\u4e86 AMP \u5de5\u4f5c\u533a\u3002\u6709\u5173\u8bf4\u660e\uff0c\u8bf7\u53c2\u9605 AMP \u7528\u6237\u6307\u5357\u4e2d\u7684\u521b\u5efa\u5de5\u4f5c\u533a\u3002</li> <li>Amazon Managed Grafana \u5de5\u4f5c\u533a</li> </ul>"},{"location":"zh/networking/monitoring/#prometheus-ethtool","title":"\u90e8\u7f72 Prometheus ethtool \u5bfc\u51fa\u5668","text":"<p>\u8be5\u90e8\u7f72\u5305\u542b\u4e00\u4e2a Python \u811a\u672c\uff0c\u4ece ethtool \u4e2d\u63d0\u53d6\u4fe1\u606f\u5e76\u4ee5 Prometheus \u683c\u5f0f\u53d1\u5e03\u3002</p> <pre><code>kubectl apply -f https://raw.githubusercontent.com/Showmax/prometheus-ethtool-exporter/master/deploy/k8s-daemonset.yaml\n</code></pre>"},{"location":"zh/networking/monitoring/#adot-ethtool-amazon-managed-service-for-prometheus","title":"\u90e8\u7f72 ADOT \u6536\u96c6\u5668\u4ee5\u6293\u53d6 ethtool \u6307\u6807\u5e76\u5c06\u5176\u5b58\u50a8\u5728 Amazon Managed Service for Prometheus \u5de5\u4f5c\u533a\u4e2d","text":"<p>\u60a8\u5728\u5176\u4e2d\u5b89\u88c5 AWS Distro for OpenTelemetry (ADOT) \u7684\u6bcf\u4e2a\u96c6\u7fa4\u90fd\u5fc5\u987b\u5177\u6709\u6b64\u89d2\u8272\uff0c\u4ee5\u6388\u4e88\u60a8\u7684 AWS \u670d\u52a1\u8d26\u6237\u5c06\u6307\u6807\u5b58\u50a8\u5230 Amazon Managed Service for Prometheus \u7684\u6743\u9650\u3002\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u4f7f\u7528 IRSA \u521b\u5efa\u5e76\u5c06\u60a8\u7684 IAM \u89d2\u8272\u5173\u8054\u5230\u60a8\u7684 Amazon EKS \u670d\u52a1\u8d26\u6237\uff1a</p> <pre><code>eksctl create iamserviceaccount --name adot-collector --namespace default --cluster &lt;CLUSTER_NAME&gt; --attach-policy-arn arn:aws:iam::aws:policy/AmazonPrometheusRemoteWriteAccess --attach-policy-arn arn:aws:iam::aws:policy/AWSXrayWriteOnlyAccess --attach-policy-arn arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy --region &lt;REGION&gt; --approve  --override-existing-serviceaccounts\n</code></pre> <p>\u8ba9\u6211\u4eec\u90e8\u7f72 ADOT \u6536\u96c6\u5668\u4ee5\u4ece Prometheus ethtool \u5bfc\u51fa\u5668\u6293\u53d6\u6307\u6807\u5e76\u5c06\u5176\u5b58\u50a8\u5728 Amazon Managed Service for Prometheus \u4e2d\u3002</p> <p>\u4ee5\u4e0b\u8fc7\u7a0b\u4f7f\u7528\u4e86\u4e00\u4e2a\u793a\u4f8b YAML \u6587\u4ef6\uff0c\u5176\u4e2d mode \u503c\u4e3a deployment\u3002\u8fd9\u662f\u9ed8\u8ba4\u6a21\u5f0f\uff0c\u5e76\u5c06 ADOT \u6536\u96c6\u5668\u7c7b\u4f3c\u4e8e\u72ec\u7acb\u5e94\u7528\u7a0b\u5e8f\u7684\u65b9\u5f0f\u90e8\u7f72\u3002\u6b64\u914d\u7f6e\u4ece\u793a\u4f8b\u5e94\u7528\u7a0b\u5e8f\u63a5\u6536 OTLP \u6307\u6807\uff0c\u5e76\u4ece\u96c6\u7fa4\u4e0a\u7684 pod \u6293\u53d6 Amazon Managed Service for Prometheus \u6307\u6807\u3002</p> <pre><code>curl -o collector-config-amp.yaml https://raw.githubusercontent.com/aws-observability/aws-otel-community/master/sample-configs/operator/collector-config-amp.yaml\n</code></pre> <p>\u5728 collector-config-amp.yaml \u4e2d\uff0c\u7528\u60a8\u81ea\u5df1\u7684\u503c\u66ff\u6362\u4ee5\u4e0b\u5185\u5bb9\uff1a * mode: deployment * serviceAccount: adot-collector * endpoint: \"\" * region: \"\" * name: adot-collector <pre><code>kubectl apply -f collector-config-amp.yaml \n</code></pre> <p>\u4e00\u65e6\u90e8\u7f72\u4e86 adot \u6536\u96c6\u5668\uff0c\u6307\u6807\u5c06\u6210\u529f\u5b58\u50a8\u5728 Amazon Prometheus \u4e2d\u3002</p>"},{"location":"zh/networking/monitoring/#amazon-managed-service-for-prometheus","title":"\u5728 Amazon Managed Service for Prometheus \u4e2d\u914d\u7f6e\u8b66\u62a5\u7ba1\u7406\u5668\u4ee5\u53d1\u9001\u901a\u77e5","text":"<p>\u8ba9\u6211\u4eec\u914d\u7f6e\u8bb0\u5f55\u89c4\u5219\u548c\u8b66\u62a5\u89c4\u5219\u4ee5\u68c0\u67e5\u5230\u76ee\u524d\u4e3a\u6b62\u8ba8\u8bba\u8fc7\u7684\u6307\u6807\u3002</p> <p>\u6211\u4eec\u5c06\u4f7f\u7528 ACK Controller for Amazon Managed Service for Prometheus \u6765\u8bbe\u7f6e\u8b66\u62a5\u548c\u8bb0\u5f55\u89c4\u5219\u3002</p> <p>\u8ba9\u6211\u4eec\u90e8\u7f72 Amazon Managed Service for Prometheus \u670d\u52a1\u7684 ACL \u63a7\u5236\u5668\uff1a</p> <pre><code>export SERVICE=prometheusservice\nexport RELEASE_VERSION=`curl -sL https://api.github.com/repos/aws-controllers-k8s/$SERVICE-controller/releases/latest | grep '\"tag_name\":' | cut -d'\"' -f4`\nexport ACK_SYSTEM_NAMESPACE=ack-system\nexport AWS_REGION=us-east-1\naws ecr-public get-login-password --region us-east-1 | helm registry login --username AWS --password-stdin public.ecr.aws\nhelm install --create-namespace -n $ACK_SYSTEM_NAMESPACE ack-$SERVICE-controller \\\noci://public.ecr.aws/aws-controllers-k8s/$SERVICE-chart --version=$RELEASE_VERSION --set=aws.region=$AWS_REGION\n</code></pre> <p>\u8fd0\u884c\u8be5\u547d\u4ee4\u540e\uff0c\u7247\u523b\u4e4b\u540e\u60a8\u5e94\u8be5\u4f1a\u770b\u5230\u4ee5\u4e0b\u6d88\u606f\uff1a</p> <pre><code>You are now able to create Amazon Managed Service for Prometheus (AMP) resources!\n\nThe controller is running in \"cluster\" mode.\n\nThe controller is configured to manage AWS resources in region: \"us-east-1\"\n\nThe ACK controller has been successfully installed and ACK can now be used to provision an Amazon Managed Service for Prometheus workspace.\n</code></pre> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u521b\u5efa\u4e00\u4e2a yaml \u6587\u4ef6\u6765\u8bbe\u7f6e\u8b66\u62a5\u7ba1\u7406\u5668\u5b9a\u4e49\u548c\u89c4\u5219\u7ec4\u3002 \u5c06\u4e0b\u9762\u7684\u5185\u5bb9\u4fdd\u5b58\u4e3a <code>rulegroup.yaml</code></p> <pre><code>apiVersion: prometheusservice.services.k8s.aws/v1alpha1\nkind: RuleGroupsNamespace\nmetadata:\n   name: default-rule\nspec:\n   workspaceID: &lt;Your WORKSPACE-ID&gt;\n   name: default-rule\n   configuration: |\n     groups:\n     - name: ppsallowance\n       rules:\n       - record: metric:pps_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"pps_allowance_exceeded\"}[30s])\n       - alert: PPSAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"pps_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"PPSAllowanceExceeded is greater than 0\"\n     - name: bw_in\n       rules:\n       - record: metric:bw_in_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_in_allowance_exceeded\"}[30s])\n       - alert: BWINAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_in_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"BWInAllowanceExceeded is greater than 0\"\n     - name: bw_out\n       rules:\n       - record: metric:bw_out_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_out_allowance_exceeded\"}[30s])\n       - alert: BWOutAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"bw_out_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"BWoutAllowanceExceeded is greater than 0\"            \n     - name: conntrack\n       rules:\n       - record: metric:conntrack_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"conntrack_allowance_exceeded\"}[30s])\n       - alert: ConntrackAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"conntrack_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Connections dropped due to total allowance exceeding for the  (instance {{ $labels.instance }})\n           description: \"ConnTrackAllowanceExceeded is greater than 0\"\n     - name: linklocal\n       rules:\n       - record: metric:linklocal_allowance_exceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"linklocal_allowance_exceeded\"}[30s])\n       - alert: LinkLocalAllowanceExceeded\n         expr: rate(node_net_ethtool{device=\"eth0\",type=\"linklocal_allowance_exceeded\"} [30s]) &gt; 0\n         labels:\n           severity: critical\n\n         annotations:\n           summary: Packets dropped due to PPS rate allowance exceeded for local services  (instance {{ $labels.instance }})\n           description: \"LinkLocalAllowanceExceeded is greater than 0\"\n</code></pre> <p>\u5c06 Your WORKSPACE-ID \u66ff\u6362\u4e3a\u60a8\u6b63\u5728\u4f7f\u7528\u7684\u5de5\u4f5c\u533a\u7684\u5de5\u4f5c\u533a ID\u3002</p> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u914d\u7f6e\u8b66\u62a5\u7ba1\u7406\u5668\u5b9a\u4e49\u3002\u5c06\u4e0b\u9762\u7684\u6587\u4ef6\u4fdd\u5b58\u4e3a <code>alertmanager.yaml</code></p> <pre><code>apiVersion: prometheusservice.services.k8s.aws/v1alpha1  \nkind: AlertManagerDefinition\nmetadata:\n  name: alert-manager\nspec:\n  workspaceID: &lt;Your WORKSPACE-ID &gt;\n  configuration: |\n    alertmanager_config: |\n      route:\n         receiver: default_receiver\n       receivers:\n       - name: default_receiver\n          sns_configs:\n          - topic_arn: TOPIC-ARN\n            sigv4:\n              region: REGION\n            message: |\n              alert_type: {{ .CommonLabels.alertname }}\n              event_type: {{ .CommonLabels.event_type }}     \n</code></pre> <p>\u5c06 You WORKSPACE-ID \u66ff\u6362\u4e3a\u65b0\u5de5\u4f5c\u533a\u7684\u5de5\u4f5c\u533a ID\uff0c\u5c06 TOPIC-ARN \u66ff\u6362\u4e3a\u60a8\u5e0c\u671b\u53d1\u9001\u8b66\u62a5\u7684 Amazon Simple Notification Service \u4e3b\u9898\u7684 ARN\uff0c\u5c06 REGION \u66ff\u6362\u4e3a\u5f53\u524d\u5de5\u4f5c\u8d1f\u8f7d\u6240\u5728\u7684\u533a\u57df\u3002\u786e\u4fdd\u60a8\u7684\u5de5\u4f5c\u533a\u6709\u6743\u9650\u5411 Amazon SNS \u53d1\u9001\u6d88\u606f\u3002</p>"},{"location":"zh/networking/monitoring/#amazon-managed-grafana-ethtool","title":"\u5728 Amazon Managed Grafana \u4e2d\u53ef\u89c6\u5316 ethtool \u6307\u6807","text":"<p>\u8ba9\u6211\u4eec\u5728 Amazon Managed Grafana \u4e2d\u53ef\u89c6\u5316\u6307\u6807\u5e76\u6784\u5efa\u4e00\u4e2a\u4eea\u8868\u677f\u3002\u6309\u7167\u8bf4\u660e\u5728 Amazon Managed Grafana \u63a7\u5236\u53f0\u4e2d\u5c06 Amazon Managed Service for Prometheus \u914d\u7f6e\u4e3a\u6570\u636e\u6e90\uff0c\u8bf7\u53c2\u9605\u5c06 Amazon Prometheus \u6dfb\u52a0\u4e3a\u6570\u636e\u6e90\u3002</p> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u5728 Amazon Managed Grafana \u4e2d\u63a2\u7d22\u6307\u6807\uff1a \u5355\u51fb\u63a2\u7d22\u6309\u94ae\uff0c\u641c\u7d22 ethtool\uff1a</p> <p></p> <p>\u8ba9\u6211\u4eec\u4f7f\u7528\u67e5\u8be2 <code>rate(node_net_ethtool{device=\"eth0\",type=\"linklocal_allowance_exceeded\"}[30s])</code> \u4e3a linklocal_allowance_exceeded \u6307\u6807\u6784\u5efa\u4e00\u4e2a\u4eea\u8868\u677f\u3002\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\u6ca1\u6709\u6570\u636e\u5305\u88ab\u4e22\u5f03\uff0c\u56e0\u4e3a\u8be5\u503c\u4e3a\u96f6\u3002</p> <p>\u8ba9\u6211\u4eec\u4f7f\u7528\u67e5\u8be2 <code>rate(node_net_ethtool{device=\"eth0\",type=\"conntrack_allowance_exceeded\"}[30s])</code> \u4e3a conntrack_allowance_exceeded \u6307\u6807\u6784\u5efa\u4e00\u4e2a\u4eea\u8868\u677f\u3002\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ea\u8981\u6309\u7167\u6b64\u5904\u6240\u8ff0\u8fd0\u884c cloudwatch \u4ee3\u7406\uff0c\u5c31\u53ef\u4ee5\u5728 CloudWatch \u4e2d\u53ef\u89c6\u5316 <code>conntrack_allowance_exceeded</code> \u6307\u6807\u3002\u5728 CloudWatch \u4e2d\u7684\u7ed3\u679c\u4eea\u8868\u677f\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\u6ca1\u6709\u6570\u636e\u5305\u88ab\u4e22\u5f03\uff0c\u56e0\u4e3a\u8be5\u503c\u4e3a\u96f6\u3002\u5982\u679c\u60a8\u4f7f\u7528\u57fa\u4e8e Nitro \u7684\u5b9e\u4f8b\uff0c\u60a8\u53ef\u4ee5\u4e3a <code>conntrack_allowance_available</code> \u521b\u5efa\u7c7b\u4f3c\u7684\u4eea\u8868\u677f\uff0c\u5e76\u4e3b\u52a8\u76d1\u63a7\u60a8\u7684 EC2 \u5b9e\u4f8b\u4e2d\u7684\u8fde\u63a5\u3002\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5728 Amazon Managed Grafana \u4e2d\u914d\u7f6e\u8b66\u62a5\u6765\u6269\u5c55\u6b64\u529f\u80fd\uff0c\u4ee5\u5411 Slack\u3001SNS\u3001Pagerduty \u7b49\u53d1\u9001\u901a\u77e5\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/","title":"\u7528\u4e8e Linux \u7684\u524d\u7f00\u6a21\u5f0f","text":"<p>Amazon VPC CNI \u4f1a\u4e3a Amazon EC2 \u7f51\u7edc\u63a5\u53e3\u5206\u914d\u7f51\u7edc\u524d\u7f00\uff0c\u4ee5\u589e\u52a0\u53ef\u5206\u914d\u7ed9\u8282\u70b9\u7684 IP \u5730\u5740\u6570\u91cf\uff0c\u5e76\u63d0\u9ad8\u6bcf\u4e2a\u8282\u70b9\u7684 Pod \u5bc6\u5ea6\u3002\u60a8\u53ef\u4ee5\u914d\u7f6e Amazon VPC CNI \u63d2\u4ef6\u7684 1.9.0 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u4ee5\u5206\u914d IPv4 \u548c IPv6 CIDR \u800c\u4e0d\u662f\u4e3a\u7f51\u7edc\u63a5\u53e3\u5206\u914d\u5355\u4e2a\u8f85\u52a9 IP \u5730\u5740\u3002</p> <p>\u524d\u7f00\u6a21\u5f0f\u5728 IPv6 \u96c6\u7fa4\u4e0a\u9ed8\u8ba4\u542f\u7528\uff0c\u5e76\u4e14\u662f\u552f\u4e00\u652f\u6301\u7684\u9009\u9879\u3002VPC CNI \u4f1a\u4e3a ENI \u4e0a\u7684\u4e00\u4e2a\u63d2\u69fd\u5206\u914d\u4e00\u4e2a /80 IPv6 \u524d\u7f00\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u672c\u6307\u5357\u7684 IPv6 \u90e8\u5206\u3002</p> <p>\u4f7f\u7528\u524d\u7f00\u5206\u914d\u6a21\u5f0f\u65f6\uff0c\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u7684\u6700\u5927\u5f39\u6027\u7f51\u7edc\u63a5\u53e3\u6570\u91cf\u4fdd\u6301\u4e0d\u53d8\uff0c\u4f46\u60a8\u73b0\u5728\u53ef\u4ee5\u914d\u7f6e Amazon VPC CNI \u4ee5\u5206\u914d /28 (16 \u4e2a IP \u5730\u5740) IPv4 \u5730\u5740\u524d\u7f00\uff0c\u800c\u4e0d\u662f\u4e3a\u7f51\u7edc\u63a5\u53e3\u4e0a\u7684\u63d2\u69fd\u5206\u914d\u5355\u4e2a IPv4 \u5730\u5740\u3002\u5f53 <code>ENABLE_PREFIX_DELEGATION</code> \u8bbe\u7f6e\u4e3a true \u65f6\uff0cVPC CNI \u4f1a\u4ece\u5206\u914d\u7ed9 ENI \u7684\u524d\u7f00\u4e2d\u4e3a Pod \u5206\u914d\u4e00\u4e2a IP \u5730\u5740\u3002\u8bf7\u6309\u7167 EKS \u7528\u6237\u6307\u5357\u4e2d\u7684\u8bf4\u660e\u542f\u7528\u524d\u7f00 IP \u6a21\u5f0f\u3002</p> <p></p> <p>\u53ef\u4ee5\u5206\u914d\u7ed9\u7f51\u7edc\u63a5\u53e3\u7684\u6700\u5927 IP \u5730\u5740\u6570\u91cf\u53d6\u51b3\u4e8e\u5b9e\u4f8b\u7c7b\u578b\u3002\u5206\u914d\u7ed9\u7f51\u7edc\u63a5\u53e3\u7684\u6bcf\u4e2a\u524d\u7f00\u90fd\u7b97\u4f5c\u4e00\u4e2a IP \u5730\u5740\u3002\u4f8b\u5982\uff0c<code>c5.large</code> \u5b9e\u4f8b\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684 IPv4 \u5730\u5740\u9650\u5236\u4e3a <code>10</code> \u4e2a\u3002\u6b64\u5b9e\u4f8b\u7684\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u90fd\u6709\u4e00\u4e2a\u4e3b IPv4 \u5730\u5740\u3002\u5982\u679c\u7f51\u7edc\u63a5\u53e3\u6ca1\u6709\u8f85\u52a9 IPv4 \u5730\u5740\uff0c\u60a8\u6700\u591a\u53ef\u4ee5\u4e3a\u8be5\u7f51\u7edc\u63a5\u53e3\u5206\u914d 9 \u4e2a\u524d\u7f00\u3002\u5bf9\u4e8e\u60a8\u4e3a\u7f51\u7edc\u63a5\u53e3\u5206\u914d\u7684\u6bcf\u4e2a\u989d\u5916 IPv4 \u5730\u5740\uff0c\u60a8\u53ef\u4ee5\u4e3a\u8be5\u7f51\u7edc\u63a5\u53e3\u5206\u914d\u4e00\u4e2a\u8f83\u5c11\u7684\u524d\u7f00\u3002\u8bf7\u67e5\u770b AWS EC2 \u6587\u6863\u4e2d\u5173\u4e8e \u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684 IP \u5730\u5740\u6570\u91cf\u548c\u4e3a\u7f51\u7edc\u63a5\u53e3\u5206\u914d\u524d\u7f00\u7684\u5185\u5bb9\u3002</p> <p>\u5728\u5de5\u4f5c\u8282\u70b9\u521d\u59cb\u5316\u671f\u95f4\uff0cVPC CNI \u4f1a\u4e3a\u4e3b ENI \u5206\u914d\u4e00\u4e2a\u6216\u591a\u4e2a\u524d\u7f00\u3002CNI \u901a\u8fc7\u7ef4\u62a4\u4e00\u4e2a\u70ed\u6c60\u6765\u9884\u5206\u914d\u4e00\u4e2a\u524d\u7f00\uff0c\u4ee5\u52a0\u5feb Pod \u542f\u52a8\u901f\u5ea6\u3002\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u6765\u63a7\u5236\u8981\u5728\u70ed\u6c60\u4e2d\u4fdd\u7559\u7684\u524d\u7f00\u6570\u91cf\u3002</p> <ul> <li><code>WARM_PREFIX_TARGET</code>,\u8d85\u51fa\u5f53\u524d\u9700\u6c42\u800c\u5206\u914d\u7684\u524d\u7f00\u6570\u91cf\u3002</li> <li><code>WARM_IP_TARGET</code>,\u8d85\u51fa\u5f53\u524d\u9700\u6c42\u800c\u5206\u914d\u7684 IP \u5730\u5740\u6570\u91cf\u3002</li> <li><code>MINIMUM_IP_TARGET</code>,\u4efb\u4f55\u65f6\u5019\u90fd\u5fc5\u987b\u53ef\u7528\u7684\u6700\u5c0f IP \u5730\u5740\u6570\u91cf\u3002</li> <li>\u5982\u679c\u8bbe\u7f6e\u4e86 <code>WARM_IP_TARGET</code> \u548c <code>MINIMUM_IP_TARGET</code>,\u5b83\u4eec\u5c06\u8986\u76d6 <code>WARM_PREFIX_TARGET</code>\u3002</li> </ul> <p>\u968f\u7740\u66f4\u591a Pod \u88ab\u8c03\u5ea6\uff0c\u5c06\u4e3a\u73b0\u6709 ENI \u8bf7\u6c42\u989d\u5916\u7684\u524d\u7f00\u3002\u9996\u5148\uff0cVPC CNI \u5c1d\u8bd5\u4e3a\u73b0\u6709 ENI \u5206\u914d\u4e00\u4e2a\u65b0\u524d\u7f00\u3002\u5982\u679c ENI \u5df2\u8fbe\u5230\u5bb9\u91cf\u4e0a\u9650\uff0cVPC CNI \u5c06\u5c1d\u8bd5\u4e3a\u8282\u70b9\u5206\u914d\u4e00\u4e2a\u65b0\u7684 ENI\u3002\u5c06\u7ee7\u7eed\u9644\u52a0\u65b0\u7684 ENI\uff0c\u76f4\u5230\u8fbe\u5230\u6700\u5927 ENI \u9650\u5236(\u7531\u5b9e\u4f8b\u7c7b\u578b\u5b9a\u4e49)\u3002\u5f53\u9644\u52a0\u65b0\u7684 ENI \u65f6\uff0cipamd \u5c06\u5206\u914d\u4e00\u4e2a\u6216\u591a\u4e2a\u524d\u7f00\uff0c\u4ee5\u7ef4\u6301 <code>WARM_PREFIX_TARGET</code>\u3001<code>WARM_IP_TARGET</code> \u548c <code>MINIMUM_IP_TARGET</code> \u8bbe\u7f6e\u3002</p> <p></p>"},{"location":"zh/networking/prefix-mode/index_linux/#_1","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/prefix-mode/index_linux/#_2","title":"\u4f55\u65f6\u4f7f\u7528\u524d\u7f00\u6a21\u5f0f","text":"<p>\u5982\u679c\u60a8\u5728\u5de5\u4f5c\u8282\u70b9\u4e0a\u9047\u5230 Pod \u5bc6\u5ea6\u95ee\u9898\uff0c\u8bf7\u4f7f\u7528\u524d\u7f00\u6a21\u5f0f\u3002\u4e3a\u907f\u514d VPC CNI \u9519\u8bef\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u8fc1\u79fb\u5230\u524d\u7f00\u6a21\u5f0f\u4e4b\u524d\u68c0\u67e5\u5b50\u7f51\u662f\u5426\u6709\u8fde\u7eed\u7684 /28 \u524d\u7f00\u5730\u5740\u5757\u3002\u6709\u5173\u5b50\u7f51\u4fdd\u7559\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\"\u4f7f\u7528\u5b50\u7f51\u4fdd\u7559\u907f\u514d\u5b50\u7f51\u788e\u7247\u5316(IPv4)\"\u90e8\u5206\u3002</p> <p>\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\uff0c\u5df2\u5c06 max-pods \u9650\u5236\u8bbe\u7f6e\u4e3a\u652f\u6301\u8f85\u52a9 IP \u6a21\u5f0f\u3002\u8981\u589e\u52a0 Pod \u5bc6\u5ea6\uff0c\u8bf7\u4e3a Kubelet \u6307\u5b9a <code>max-pods</code> \u503c\uff0c\u5e76\u5c06 <code>--use-max-pods=false</code> \u4f5c\u4e3a\u8282\u70b9\u7684\u7528\u6237\u6570\u636e\u3002\u60a8\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 max-pod-calculator.sh \u811a\u672c\u6765\u8ba1\u7b97 EKS \u4e3a\u7ed9\u5b9a\u5b9e\u4f8b\u7c7b\u578b\u63a8\u8350\u7684\u6700\u5927 Pod \u6570\u91cf\u3002\u6709\u5173\u793a\u4f8b\u7528\u6237\u6570\u636e\uff0c\u8bf7\u53c2\u9605 EKS \u7528\u6237\u6307\u5357\u3002</p> <pre><code>./max-pods-calculator.sh --instance-type m5.large --cni-version ``1.9``.0 --cni-prefix-delegation-enabled\n</code></pre> <p>\u5bf9\u4e8e\u4f7f\u7528 CNI \u81ea\u5b9a\u4e49\u7f51\u7edc\u7684\u7528\u6237\u800c\u8a00\uff0c\u524d\u7f00\u5206\u914d\u6a21\u5f0f\u5c24\u5176\u76f8\u5173\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e3b ENI \u4e0d\u7528\u4e8e Pod\u3002\u4f7f\u7528\u524d\u7f00\u5206\u914d\uff0c\u5373\u4f7f\u4e3b ENI \u672a\u7528\u4e8e Pod\uff0c\u60a8\u4ecd\u7136\u53ef\u4ee5\u5728\u51e0\u4e4e\u6240\u6709 Nitro \u5b9e\u4f8b\u7c7b\u578b\u4e0a\u9644\u52a0\u66f4\u591a IP\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/#_3","title":"\u4f55\u65f6\u907f\u514d\u4f7f\u7528\u524d\u7f00\u6a21\u5f0f","text":"<p>\u5982\u679c\u60a8\u7684\u5b50\u7f51\u975e\u5e38\u5206\u6563\uff0c\u6ca1\u6709\u8db3\u591f\u7684\u53ef\u7528 IP \u5730\u5740\u6765\u521b\u5efa /28 \u524d\u7f00\uff0c\u8bf7\u907f\u514d\u4f7f\u7528\u524d\u7f00\u6a21\u5f0f\u3002\u5982\u679c\u751f\u6210\u524d\u7f00\u7684\u5b50\u7f51\u5b58\u5728\u788e\u7247(\u4e00\u4e2a\u4f7f\u7528\u7387\u5f88\u9ad8\u4e14\u5206\u6563\u4e86\u8f85\u52a9 IP \u5730\u5740\u7684\u5b50\u7f51)\uff0c\u524d\u7f00\u9644\u52a0\u53ef\u80fd\u4f1a\u5931\u8d25\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b50\u7f51\u5e76\u4e3a\u5176\u4fdd\u7559\u524d\u7f00\u6765\u907f\u514d\u6b64\u95ee\u9898\u3002</p> <p>\u5728\u524d\u7f00\u6a21\u5f0f\u4e0b\uff0c\u5206\u914d\u7ed9\u5de5\u4f5c\u8282\u70b9\u7684\u5b89\u5168\u7ec4\u4e5f\u4f1a\u88ab Pod \u5171\u4eab\u3002\u5982\u679c\u60a8\u6709\u5b89\u5168\u8981\u6c42\u9700\u8981\u5728\u5171\u4eab\u8ba1\u7b97\u8d44\u6e90\u4e0a\u8fd0\u884c\u5177\u6709\u4e0d\u540c\u7f51\u7edc\u5b89\u5168\u8981\u6c42\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee5\u5b9e\u73b0\u5408\u89c4\u6027\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/#_4","title":"\u5728\u540c\u4e00\u8282\u70b9\u7ec4\u4e2d\u4f7f\u7528\u76f8\u4f3c\u7684\u5b9e\u4f8b\u7c7b\u578b","text":"<p>\u60a8\u7684\u8282\u70b9\u7ec4\u53ef\u80fd\u5305\u542b\u591a\u79cd\u7c7b\u578b\u7684\u5b9e\u4f8b\u3002\u5982\u679c\u67d0\u4e2a\u5b9e\u4f8b\u7684\u6700\u5927 Pod \u6570\u8f83\u4f4e\uff0c\u5219\u8be5\u503c\u5c06\u5e94\u7528\u4e8e\u8282\u70b9\u7ec4\u4e2d\u7684\u6240\u6709\u8282\u70b9\u3002\u8003\u8651\u5728\u4e00\u4e2a\u8282\u70b9\u7ec4\u4e2d\u4f7f\u7528\u76f8\u4f3c\u7684\u5b9e\u4f8b\u7c7b\u578b\uff0c\u4ee5\u6700\u5927\u5316\u8282\u70b9\u5229\u7528\u7387\u3002\u5982\u679c\u60a8\u4f7f\u7528 Karpenter \u8fdb\u884c\u81ea\u52a8\u8282\u70b9\u6269\u7f29\uff0c\u6211\u4eec\u5efa\u8bae\u5728 Provisioner API \u7684 requirements \u90e8\u5206\u914d\u7f6e node.kubernetes.io/instance-type\u3002</p> <p>Warning</p> <p>\u7279\u5b9a\u8282\u70b9\u7ec4\u4e2d\u6240\u6709\u8282\u70b9\u7684\u6700\u5927 Pod \u6570\u7531\u8be5\u8282\u70b9\u7ec4\u4e2d\u4efb\u4f55\u5355\u4e2a\u5b9e\u4f8b\u7c7b\u578b\u7684\u6700\u4f4e\u6700\u5927 Pod \u6570\u5b9a\u4e49\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/#warm_prefix_target-ipv4","title":"\u914d\u7f6e <code>WARM_PREFIX_TARGET</code> \u4ee5\u8282\u7701 IPv4 \u5730\u5740","text":"<p>\u5b89\u88c5\u6e05\u5355\u4e2d <code>WARM_PREFIX_TARGET</code> \u7684\u9ed8\u8ba4\u503c\u4e3a 1\u3002\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c<code>WARM_PREFIX_TARGET</code> \u7684\u63a8\u8350\u503c 1 \u5c06\u63d0\u4f9b\u5feb\u901f\u7684 Pod \u542f\u52a8\u65f6\u95f4\u548c\u6700\u5c0f\u672a\u4f7f\u7528\u7684\u5206\u914d\u7ed9\u5b9e\u4f8b\u7684 IP \u5730\u5740\u4e4b\u95f4\u7684\u826f\u597d\u5e73\u8861\u3002</p> <p>\u5982\u679c\u60a8\u9700\u8981\u8fdb\u4e00\u6b65\u8282\u7701\u6bcf\u4e2a\u8282\u70b9\u7684 IPv4 \u5730\u5740\uff0c\u8bf7\u4f7f\u7528 <code>WARM_IP_TARGET</code> \u548c <code>MINIMUM_IP_TARGET</code> \u8bbe\u7f6e\uff0c\u5b83\u4eec\u5728\u914d\u7f6e\u65f6\u5c06\u8986\u76d6 <code>WARM_PREFIX_TARGET</code>\u3002\u901a\u8fc7\u5c06 <code>WARM_IP_TARGET</code> \u8bbe\u7f6e\u4e3a\u5c0f\u4e8e 16 \u7684\u503c\uff0c\u60a8\u53ef\u4ee5\u9632\u6b62 CNI \u4fdd\u7559\u4e00\u4e2a\u6574\u4e2a\u591a\u4f59\u7684\u524d\u7f00\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/#eni","title":"\u4f18\u5148\u5206\u914d\u65b0\u524d\u7f00\u800c\u4e0d\u662f\u9644\u52a0\u65b0\u7684 ENI","text":"<p>\u4e3a\u73b0\u6709 ENI \u5206\u914d\u989d\u5916\u524d\u7f00\u662f\u4e00\u4e2a\u6bd4\u4e3a\u5b9e\u4f8b\u521b\u5efa\u548c\u9644\u52a0\u65b0 ENI \u66f4\u5feb\u7684 EC2 API \u64cd\u4f5c\u3002\u4f7f\u7528\u524d\u7f00\u53ef\u63d0\u9ad8\u6027\u80fd\uff0c\u540c\u65f6\u8282\u7701 IPv4 \u5730\u5740\u5206\u914d\u3002\u9644\u52a0\u524d\u7f00\u901a\u5e38\u5728\u4e00\u79d2\u949f\u5185\u5b8c\u6210\uff0c\u800c\u9644\u52a0\u65b0\u7684 ENI \u53ef\u80fd\u9700\u8981\u957f\u8fbe 10 \u79d2\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u7528\u4f8b\uff0c\u5728\u524d\u7f00\u6a21\u5f0f\u4e0b\u8fd0\u884c\u65f6\uff0cCNI \u6bcf\u4e2a\u5de5\u4f5c\u8282\u70b9\u53ea\u9700\u4e00\u4e2a ENI\u3002\u5982\u679c\u60a8\u53ef\u4ee5\u627f\u53d7(\u5728\u6700\u574f\u60c5\u51b5\u4e0b)\u6bcf\u4e2a\u8282\u70b9\u6700\u591a 15 \u4e2a\u672a\u4f7f\u7528\u7684 IP\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528\u8f83\u65b0\u7684\u524d\u7f00\u5206\u914d\u7f51\u7edc\u6a21\u5f0f\uff0c\u5e76\u5b9e\u73b0\u968f\u4e4b\u800c\u6765\u7684\u6027\u80fd\u548c\u6548\u7387\u63d0\u5347\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/#ipv4","title":"\u4f7f\u7528\u5b50\u7f51\u4fdd\u7559\u907f\u514d\u5b50\u7f51\u788e\u7247\u5316(IPv4)","text":"<p>\u5f53 EC2 \u4e3a ENI \u5206\u914d\u4e00\u4e2a /28 IPv4 \u524d\u7f00\u65f6\uff0c\u5b83\u5fc5\u987b\u662f\u6765\u81ea\u60a8\u5b50\u7f51\u7684\u4e00\u4e2a\u8fde\u7eed IP \u5730\u5740\u5757\u3002\u5982\u679c\u751f\u6210\u524d\u7f00\u7684\u5b50\u7f51\u5b58\u5728\u788e\u7247(\u4e00\u4e2a\u4f7f\u7528\u7387\u5f88\u9ad8\u4e14\u5206\u6563\u4e86\u8f85\u52a9 IP \u5730\u5740\u7684\u5b50\u7f51)\uff0c\u524d\u7f00\u9644\u52a0\u53ef\u80fd\u4f1a\u5931\u8d25\uff0c\u60a8\u5c06\u5728 VPC CNI \u65e5\u5fd7\u4e2d\u770b\u5230\u4ee5\u4e0b\u9519\u8bef\u6d88\u606f\uff1a</p> <pre><code>failed to allocate a private IP/Prefix address: InsufficientCidrBlocks: There are not enough free cidr blocks in the specified subnet to satisfy the request.\n</code></pre> <p>\u4e3a\u4e86\u907f\u514d\u788e\u7247\u5316\u5e76\u6709\u8db3\u591f\u7684\u8fde\u7eed\u7a7a\u95f4\u6765\u521b\u5efa\u524d\u7f00\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 VPC \u5b50\u7f51 CIDR \u4fdd\u7559\u5728\u5b50\u7f51\u5185\u4fdd\u7559 IP \u7a7a\u95f4\uff0c\u4e13\u95e8\u7528\u4e8e\u524d\u7f00\u3002\u521b\u5efa\u4fdd\u7559\u540e\uff0cVPC CNI \u63d2\u4ef6\u5c06\u8c03\u7528 EC2 API \u6765\u4ece\u4fdd\u7559\u7684\u7a7a\u95f4\u81ea\u52a8\u5206\u914d\u524d\u7f00\u3002</p> <p>\u5efa\u8bae\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b50\u7f51\uff0c\u4e3a\u524d\u7f00\u4fdd\u7559\u7a7a\u95f4\uff0c\u5e76\u4e3a\u5728\u8be5\u5b50\u7f51\u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8282\u70b9\u542f\u7528\u524d\u7f00\u5206\u914d\u548c VPC CNI\u3002\u5982\u679c\u65b0\u5b50\u7f51\u4ec5\u4e13\u7528\u4e8e\u5728\u60a8\u7684 EKS \u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684 Pod\uff0c\u5e76\u4e14\u5df2\u4e3a\u5176\u542f\u7528\u4e86 VPC CNI \u524d\u7f00\u5206\u914d\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u8df3\u8fc7\u524d\u7f00\u4fdd\u7559\u6b65\u9aa4\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/#vpc-cni","title":"\u907f\u514d\u964d\u7ea7 VPC CNI","text":"<p>\u524d\u7f00\u6a21\u5f0f\u9002\u7528\u4e8e VPC CNI 1.9.0 \u53ca\u66f4\u9ad8\u7248\u672c\u3002\u4e00\u65e6\u542f\u7528\u4e86\u524d\u7f00\u6a21\u5f0f\u5e76\u4e3a ENI \u5206\u914d\u4e86\u524d\u7f00\uff0c\u5c31\u5fc5\u987b\u907f\u514d\u5c06 Amazon VPC CNI \u63d2\u4ef6\u964d\u7ea7\u5230\u4f4e\u4e8e 1.9.0 \u7684\u7248\u672c\u3002\u5982\u679c\u60a8\u51b3\u5b9a\u964d\u7ea7 VPC CNI\uff0c\u5fc5\u987b\u5220\u9664\u5e76\u91cd\u65b0\u521b\u5efa\u8282\u70b9\u3002</p>"},{"location":"zh/networking/prefix-mode/index_linux/#_5","title":"\u5728\u8fc7\u6e21\u5230\u524d\u7f00\u59d4\u6d3e\u671f\u95f4\u66ff\u6362\u6240\u6709\u8282\u70b9","text":"<p>\u5f3a\u70c8\u5efa\u8bae\u60a8\u521b\u5efa\u65b0\u7684\u8282\u70b9\u7ec4\u6765\u589e\u52a0\u53ef\u7528 IP \u5730\u5740\u7684\u6570\u91cf\uff0c\u800c\u4e0d\u662f\u6eda\u52a8\u66ff\u6362\u73b0\u6709\u5de5\u4f5c\u8282\u70b9\u3002\u817e\u7a7a\u5e76\u6392\u7a7a\u6240\u6709\u73b0\u6709\u8282\u70b9\uff0c\u4ee5\u5b89\u5168\u5730\u9010\u51fa\u6240\u6709\u73b0\u6709 Pod\u3002\u4e3a\u9632\u6b62\u670d\u52a1\u4e2d\u65ad\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u751f\u4ea7\u96c6\u7fa4\u4e0a\u4e3a\u5173\u952e\u5de5\u4f5c\u8d1f\u8f7d\u5b9e\u65bd Pod \u4e2d\u65ad\u9884\u7b97\u3002\u5728\u65b0\u8282\u70b9\u4e0a\uff0cPod \u5c06\u4ece\u5206\u914d\u7ed9 ENI \u7684\u524d\u7f00\u4e2d\u83b7\u5f97\u4e00\u4e2a IP\u3002\u786e\u8ba4 Pod \u6b63\u5728\u8fd0\u884c\u540e\uff0c\u60a8\u53ef\u4ee5\u5220\u9664\u65e7\u8282\u70b9\u548c\u8282\u70b9\u7ec4\u3002\u5982\u679c\u60a8\u4f7f\u7528\u6258\u7ba1\u8282\u70b9\u7ec4\uff0c\u8bf7\u6309\u7167\u6b64\u5904\u6240\u8ff0\u6b65\u9aa4\u5b89\u5168 \u5220\u9664\u8282\u70b9\u7ec4\u3002</p>"},{"location":"zh/networking/prefix-mode/index_windows/","title":"Windows \u8282\u70b9\u7684\u524d\u7f00\u6a21\u5f0f","text":"<p>\u5728 Amazon EKS \u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd0\u884c\u5728 Windows \u4e3b\u673a\u4e0a\u7684\u6bcf\u4e2a Pod \u90fd\u4f1a\u88ab VPC \u8d44\u6e90\u63a7\u5236\u5668\u5206\u914d\u4e00\u4e2a\u8f85\u52a9 IP \u5730\u5740\u3002\u8fd9\u4e2a IP \u5730\u5740\u662f\u4e00\u4e2a\u53ef\u8def\u7531\u5230 VPC \u7684\u5730\u5740\uff0c\u4ece\u4e3b\u673a\u6240\u5728\u7684\u5b50\u7f51\u4e2d\u5206\u914d\u3002\u5728 Linux \u4e0a\uff0c\u6bcf\u4e2a\u9644\u52a0\u5230\u5b9e\u4f8b\u7684 ENI \u90fd\u6709\u591a\u4e2a\u63d2\u69fd\u53ef\u4ee5\u586b\u5145\u8f85\u52a9 IP \u5730\u5740\u6216 /28 CIDR\uff08\u524d\u7f00\uff09\u3002\u4f46\u662f\uff0cWindows \u4e3b\u673a\u53ea\u652f\u6301\u4e00\u4e2a ENI \u53ca\u5176\u53ef\u7528\u63d2\u69fd\u3002\u4ec5\u4f7f\u7528\u8f85\u52a9 IP \u5730\u5740\u53ef\u80fd\u4f1a\u4eba\u4e3a\u5730\u9650\u5236\u60a8\u5728 Windows \u4e3b\u673a\u4e0a\u53ef\u4ee5\u8fd0\u884c\u7684 Pod \u6570\u91cf\uff0c\u5373\u4f7f\u6709\u5927\u91cf\u53ef\u5206\u914d\u7684 IP \u5730\u5740\u3002</p> <p>\u4e3a\u4e86\u63d0\u9ad8 Windows \u4e3b\u673a\u4e0a\u7684 Pod \u5bc6\u5ea6\uff0c\u7279\u522b\u662f\u5728\u4f7f\u7528\u8f83\u5c0f\u5b9e\u4f8b\u7c7b\u578b\u65f6\uff0c\u60a8\u53ef\u4ee5\u4e3a Windows \u8282\u70b9\u542f\u7528\u524d\u7f00\u59d4\u6d3e\u3002\u542f\u7528\u524d\u7f00\u59d4\u6d3e\u540e\uff0c/28 IPv4 \u524d\u7f00\u5c06\u88ab\u5206\u914d\u5230 ENI \u63d2\u69fd\uff0c\u800c\u4e0d\u662f\u8f85\u52a9 IP \u5730\u5740\u3002\u53ef\u4ee5\u901a\u8fc7\u5728 <code>amazon-vpc-cni</code> \u914d\u7f6e\u6620\u5c04\u4e2d\u6dfb\u52a0 <code>enable-windows-prefix-delegation: \"true\"</code> \u6761\u76ee\u6765\u542f\u7528\u524d\u7f00\u59d4\u6d3e\u3002\u8fd9\u4e0e\u60a8\u9700\u8981\u8bbe\u7f6e <code>enable-windows-ipam: \"true\"</code> \u6761\u76ee\u4ee5\u542f\u7528 Windows \u652f\u6301\u7684\u914d\u7f6e\u6620\u5c04\u662f\u76f8\u540c\u7684\u3002</p> <p>\u8bf7\u6309\u7167 EKS \u7528\u6237\u6307\u5357\u4e2d\u63d0\u5230\u7684\u8bf4\u660e\u4e3a Windows \u8282\u70b9\u542f\u7528\u524d\u7f00\u59d4\u6d3e\u6a21\u5f0f\u3002</p> <p></p> <p>\u56fe\uff1a\u8f85\u52a9 IP \u6a21\u5f0f\u4e0e\u524d\u7f00\u59d4\u6d3e\u6a21\u5f0f\u7684\u6bd4\u8f83</p> <p>\u60a8\u53ef\u4ee5\u5206\u914d\u7ed9\u7f51\u7edc\u63a5\u53e3\u7684\u6700\u5927 IP \u5730\u5740\u6570\u91cf\u53d6\u51b3\u4e8e\u5b9e\u4f8b\u7c7b\u578b\u53ca\u5176\u5927\u5c0f\u3002\u5206\u914d\u7ed9\u7f51\u7edc\u63a5\u53e3\u7684\u6bcf\u4e2a\u524d\u7f00\u90fd\u4f1a\u6d88\u8017\u4e00\u4e2a\u53ef\u7528\u63d2\u69fd\u3002\u4f8b\u5982\uff0c<code>c5.large</code> \u5b9e\u4f8b\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684\u9650\u5236\u4e3a <code>10</code> \u4e2a\u63d2\u69fd\u3002\u7f51\u7edc\u63a5\u53e3\u4e0a\u7684\u7b2c\u4e00\u4e2a\u63d2\u69fd\u59cb\u7ec8\u7531\u63a5\u53e3\u7684\u4e3b IP \u5730\u5740\u5360\u7528\uff0c\u56e0\u6b64\u5269\u4e0b 9 \u4e2a\u63d2\u69fd\u53ef\u7528\u4e8e\u524d\u7f00\u548c/\u6216\u8f85\u52a9 IP \u5730\u5740\u3002\u5982\u679c\u8fd9\u4e9b\u63d2\u69fd\u88ab\u5206\u914d\u524d\u7f00\uff0c\u5219\u8282\u70b9\u53ef\u652f\u6301 (9 * 16) 144 \u4e2a IP \u5730\u5740\uff0c\u800c\u5982\u679c\u5206\u914d\u8f85\u52a9 IP \u5730\u5740\uff0c\u5219\u53ea\u80fd\u652f\u6301 9 \u4e2a IP \u5730\u5740\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684 IP \u5730\u5740\u6570\u91cf\u548c\u5c06\u524d\u7f00\u5206\u914d\u7ed9\u7f51\u7edc\u63a5\u53e3\u7684\u6587\u6863\u3002</p> <p>\u5728\u5de5\u4f5c\u8282\u70b9\u521d\u59cb\u5316\u671f\u95f4\uff0cVPC \u8d44\u6e90\u63a7\u5236\u5668\u4f1a\u901a\u8fc7\u7ef4\u62a4\u4e00\u4e2a\u9884\u70ed\u6c60\u6765\u4e3a\u4e3b ENI \u5206\u914d\u4e00\u4e2a\u6216\u591a\u4e2a\u524d\u7f00\uff0c\u4ee5\u52a0\u5feb Pod \u542f\u52a8\u901f\u5ea6\u3002\u53ef\u4ee5\u901a\u8fc7\u5728 <code>amazon-vpc-cni</code> \u914d\u7f6e\u6620\u5c04\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u914d\u7f6e\u53c2\u6570\u6765\u63a7\u5236\u9884\u70ed\u6c60\u4e2d\u8981\u4fdd\u7559\u7684\u524d\u7f00\u6570\u91cf\u3002</p> <ul> <li><code>warm-prefix-target</code>\uff0c\u8d85\u51fa\u5f53\u524d\u9700\u6c42\u800c\u5206\u914d\u7684\u524d\u7f00\u6570\u91cf\u3002</li> <li><code>warm-ip-target</code>\uff0c\u8d85\u51fa\u5f53\u524d\u9700\u6c42\u800c\u5206\u914d\u7684 IP \u5730\u5740\u6570\u91cf\u3002</li> <li><code>minimum-ip-target</code>\uff0c\u4efb\u4f55\u65f6\u5019\u90fd\u5fc5\u987b\u53ef\u7528\u7684\u6700\u5c0f IP \u5730\u5740\u6570\u91cf\u3002</li> <li>\u5982\u679c\u8bbe\u7f6e\u4e86 <code>warm-ip-target</code> \u548c/\u6216 <code>minimum-ip-target</code>\uff0c\u5b83\u4eec\u5c06\u8986\u76d6 <code>warm-prefix-target</code>\u3002</li> </ul> <p>\u5f53\u66f4\u591a Pod \u88ab\u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\u65f6\uff0c\u5c06\u4e3a\u73b0\u6709 ENI \u8bf7\u6c42\u989d\u5916\u7684\u524d\u7f00\u3002\u5f53 Pod \u88ab\u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\u65f6\uff0cVPC \u8d44\u6e90\u63a7\u5236\u5668\u9996\u5148\u4f1a\u5c1d\u8bd5\u4ece\u8282\u70b9\u4e0a\u73b0\u6709\u7684\u524d\u7f00\u4e2d\u5206\u914d\u4e00\u4e2a IPv4 \u5730\u5740\u3002\u5982\u679c\u8fd9\u4e0d\u53ef\u80fd\uff0c\u53ea\u8981\u5b50\u7f51\u6709\u6240\u9700\u7684\u5bb9\u91cf\uff0c\u5c31\u4f1a\u8bf7\u6c42\u4e00\u4e2a\u65b0\u7684 IPv4 \u524d\u7f00\u3002</p> <p></p> <p>\u56fe\uff1a\u4e3a Pod \u5206\u914d IPv4 \u5730\u5740\u7684\u5de5\u4f5c\u6d41\u7a0b</p>"},{"location":"zh/networking/prefix-mode/index_windows/#_1","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/prefix-mode/index_windows/#_2","title":"\u4f55\u65f6\u4f7f\u7528\u524d\u7f00\u59d4\u6d3e","text":"<p>\u5982\u679c\u60a8\u5728\u5de5\u4f5c\u8282\u70b9\u4e0a\u9047\u5230 Pod \u5bc6\u5ea6\u95ee\u9898\uff0c\u8bf7\u4f7f\u7528\u524d\u7f00\u59d4\u6d3e\u3002\u4e3a\u907f\u514d\u51fa\u9519\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u8fc1\u79fb\u5230\u524d\u7f00\u6a21\u5f0f\u4e4b\u524d\u68c0\u67e5\u5b50\u7f51\u662f\u5426\u6709 /28 \u524d\u7f00\u7684\u8fde\u7eed\u5730\u5740\u5757\u3002\u6709\u5173\u5b50\u7f51\u9884\u7559\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\"\u4f7f\u7528\u5b50\u7f51\u9884\u7559\u907f\u514d\u5b50\u7f51\u788e\u7247\u5316\uff08IPv4\uff09\"\u90e8\u5206\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cWindows \u8282\u70b9\u4e0a\u7684 <code>max-pods</code> \u8bbe\u7f6e\u4e3a <code>110</code>\u3002\u5bf9\u4e8e\u7edd\u5927\u591a\u6570\u5b9e\u4f8b\u7c7b\u578b\uff0c\u8fd9\u5e94\u8be5\u662f\u8db3\u591f\u7684\u3002\u5982\u679c\u60a8\u60f3\u589e\u52a0\u6216\u51cf\u5c11\u6b64\u9650\u5236\uff0c\u8bf7\u5728\u7528\u6237\u6570\u636e\u4e2d\u7684\u5f15\u5bfc\u547d\u4ee4\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a <pre><code>-KubeletExtraArgs '--max-pods=example-value'\n</code></pre> \u6709\u5173 Windows \u8282\u70b9\u7684\u5f15\u5bfc\u914d\u7f6e\u53c2\u6570\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u8bbf\u95ee\u6b64\u5904\u7684\u6587\u6863\u3002</p>"},{"location":"zh/networking/prefix-mode/index_windows/#_3","title":"\u4f55\u65f6\u907f\u514d\u4f7f\u7528\u524d\u7f00\u59d4\u6d3e","text":"<p>\u5982\u679c\u60a8\u7684\u5b50\u7f51\u975e\u5e38\u5206\u6563\u4e14\u6ca1\u6709\u8db3\u591f\u7684\u53ef\u7528 IP \u5730\u5740\u6765\u521b\u5efa /28 \u524d\u7f00\uff0c\u8bf7\u907f\u514d\u4f7f\u7528\u524d\u7f00\u6a21\u5f0f\u3002\u5982\u679c\u751f\u6210\u524d\u7f00\u7684\u5b50\u7f51\u5b58\u5728\u788e\u7247\u5316\uff08\u9ad8\u5ea6\u4f7f\u7528\u4e14\u5177\u6709\u5206\u6563\u7684\u8f85\u52a9 IP \u5730\u5740\u7684\u5b50\u7f51\uff09\uff0c\u5219\u524d\u7f00\u9644\u52a0\u53ef\u80fd\u4f1a\u5931\u8d25\u3002\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u65b0\u7684\u5b50\u7f51\u5e76\u9884\u7559\u524d\u7f00\u6765\u907f\u514d\u6b64\u95ee\u9898\u3002</p>"},{"location":"zh/networking/prefix-mode/index_windows/#ipv4","title":"\u914d\u7f6e\u524d\u7f00\u59d4\u6d3e\u53c2\u6570\u4ee5\u8282\u7701 IPv4 \u5730\u5740","text":"<p><code>warm-prefix-target</code>\u3001<code>warm-ip-target</code> \u548c <code>minimum-ip-target</code> \u53ef\u7528\u4e8e\u5fae\u8c03\u4f7f\u7528\u524d\u7f00\u8fdb\u884c\u9884\u6269\u5c55\u548c\u52a8\u6001\u6269\u5c55\u7684\u884c\u4e3a\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528\u4ee5\u4e0b\u503c\uff1a <pre><code>warm-ip-target: \"1\"\nminimum-ip-target: \"3\"\n</code></pre> \u901a\u8fc7\u5fae\u8c03\u8fd9\u4e9b\u914d\u7f6e\u53c2\u6570\uff0c\u60a8\u53ef\u4ee5\u5728\u8282\u7701 IP \u5730\u5740\u548c\u786e\u4fdd\u7531\u4e8e IP \u5730\u5740\u5206\u914d\u800c\u964d\u4f4e Pod \u5ef6\u8fdf\u4e4b\u95f4\u8fbe\u5230\u6700\u4f73\u5e73\u8861\u3002\u6709\u5173\u8fd9\u4e9b\u914d\u7f6e\u53c2\u6570\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u8bbf\u95ee\u6b64\u5904\u7684\u6587\u6863\u3002</p>"},{"location":"zh/networking/prefix-mode/index_windows/#ipv4_1","title":"\u4f7f\u7528\u5b50\u7f51\u9884\u7559\u907f\u514d\u5b50\u7f51\u788e\u7247\u5316\uff08IPv4\uff09","text":"<p>\u5f53 EC2 \u5c06 /28 IPv4 \u524d\u7f00\u5206\u914d\u7ed9 ENI \u65f6\uff0c\u5b83\u5fc5\u987b\u662f\u6765\u81ea\u60a8\u5b50\u7f51\u7684\u8fde\u7eed IP \u5730\u5740\u5757\u3002\u5982\u679c\u751f\u6210\u524d\u7f00\u7684\u5b50\u7f51\u5b58\u5728\u788e\u7247\u5316\uff08\u9ad8\u5ea6\u4f7f\u7528\u4e14\u5177\u6709\u5206\u6563\u7684\u8f85\u52a9 IP \u5730\u5740\u7684\u5b50\u7f51\uff09\uff0c\u5219\u524d\u7f00\u9644\u52a0\u53ef\u80fd\u4f1a\u5931\u8d25\uff0c\u60a8\u5c06\u770b\u5230\u4ee5\u4e0b\u8282\u70b9\u4e8b\u4ef6\uff1a <pre><code>InsufficientCidrBlocks: \u6307\u5b9a\u7684\u5b50\u7f51\u6ca1\u6709\u8db3\u591f\u7684\u53ef\u7528 CIDR \u5757\u6765\u6ee1\u8db3\u8bf7\u6c42\n</code></pre> \u4e3a\u4e86\u907f\u514d\u788e\u7247\u5316\u5e76\u6709\u8db3\u591f\u7684\u8fde\u7eed\u7a7a\u95f4\u6765\u521b\u5efa\u524d\u7f00\uff0c\u8bf7\u4f7f\u7528 VPC \u5b50\u7f51 CIDR \u9884\u7559\u5728\u5b50\u7f51\u5185\u9884\u7559 IP \u7a7a\u95f4\u4f9b\u524d\u7f00\u4e13\u7528\u4f7f\u7528\u3002\u521b\u5efa\u9884\u7559\u540e\uff0c\u9884\u7559\u5757\u4e2d\u7684 IP \u5730\u5740\u5c06\u4e0d\u4f1a\u5206\u914d\u7ed9\u5176\u4ed6\u8d44\u6e90\u3002\u8fd9\u6837\uff0cVPC \u8d44\u6e90\u63a7\u5236\u5668\u5c31\u80fd\u5728\u5411\u8282\u70b9 ENI \u5206\u914d\u65f6\u4ece\u53ef\u7528\u524d\u7f00\u4e2d\u83b7\u53d6\u3002</p> <p>\u5efa\u8bae\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b50\u7f51\uff0c\u4e3a\u524d\u7f00\u9884\u7559\u7a7a\u95f4\uff0c\u5e76\u4e3a\u5728\u8be5\u5b50\u7f51\u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8282\u70b9\u542f\u7528\u524d\u7f00\u5206\u914d\u3002\u5982\u679c\u65b0\u5b50\u7f51\u4ec5\u4e13\u7528\u4e8e\u5728\u60a8\u7684 EKS \u96c6\u7fa4\u4e2d\u8fd0\u884c\u542f\u7528\u4e86\u524d\u7f00\u59d4\u6d3e\u7684 Pod\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u8df3\u8fc7\u524d\u7f00\u9884\u7559\u6b65\u9aa4\u3002</p>"},{"location":"zh/networking/prefix-mode/index_windows/#ip","title":"\u4ece\u8f85\u52a9 IP \u6a21\u5f0f\u8fc1\u79fb\u5230\u524d\u7f00\u59d4\u6d3e\u6a21\u5f0f\u6216\u76f8\u53cd\u65f6\u66ff\u6362\u6240\u6709\u8282\u70b9","text":"<p>\u5f3a\u70c8\u5efa\u8bae\u60a8\u521b\u5efa\u65b0\u7684\u8282\u70b9\u7ec4\u4ee5\u589e\u52a0\u53ef\u7528 IP \u5730\u5740\u7684\u6570\u91cf\uff0c\u800c\u4e0d\u662f\u6eda\u52a8\u66ff\u6362\u73b0\u6709\u5de5\u4f5c\u8282\u70b9\u3002</p> <p>\u4f7f\u7528\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4\u65f6\uff0c\u8fc7\u6e21\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u589e\u52a0\u96c6\u7fa4\u5bb9\u91cf\uff0c\u4ee5\u4fbf\u65b0\u8282\u70b9\u80fd\u591f\u5bb9\u7eb3\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d</li> <li>\u4e3a Windows \u542f\u7528/\u7981\u7528\u524d\u7f00\u59d4\u6d3e\u529f\u80fd</li> <li>\u5c01\u9501\u5e76\u6392\u7a7a\u6240\u6709\u73b0\u6709\u8282\u70b9\u4ee5\u5b89\u5168\u5730\u9010\u51fa\u6240\u6709\u73b0\u6709 Pod\u3002\u4e3a\u9632\u6b62\u670d\u52a1\u4e2d\u65ad\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u751f\u4ea7\u96c6\u7fa4\u4e0a\u4e3a\u5173\u952e\u5de5\u4f5c\u8d1f\u8f7d\u5b9e\u65bd Pod \u4e2d\u65ad\u9884\u7b97\u3002</li> <li>\u786e\u8ba4 Pod \u5728\u8fd0\u884c\u540e\uff0c\u60a8\u53ef\u4ee5\u5220\u9664\u65e7\u8282\u70b9\u548c\u8282\u70b9\u7ec4\u3002\u65b0\u8282\u70b9\u4e0a\u7684 Pod \u5c06\u4ece\u5206\u914d\u7ed9\u8282\u70b9 ENI \u7684\u524d\u7f00\u4e2d\u83b7\u53d6 IPv4 \u5730\u5740\u3002</li> </ul> <p>\u4f7f\u7528\u6258\u7ba1\u8282\u70b9\u7ec4\u65f6\uff0c\u8fc7\u6e21\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u4e3a Windows \u542f\u7528/\u7981\u7528\u524d\u7f00\u59d4\u6d3e\u529f\u80fd</li> <li>\u6309\u7167\u6b64\u5904\u6240\u8ff0\u7684\u6b65\u9aa4\u66f4\u65b0\u8282\u70b9\u7ec4\u3002\u8fd9\u6267\u884c\u4e86\u7c7b\u4f3c\u4e8e\u4e0a\u8ff0\u6b65\u9aa4\uff0c\u4f46\u7531 EKS \u7ba1\u7406\u3002</li> </ul> <p>Warning</p> <p>\u5728\u540c\u4e00\u6a21\u5f0f\u4e0b\u8fd0\u884c\u8282\u70b9\u4e0a\u7684\u6240\u6709 Pod</p> <p>\u5bf9\u4e8e Windows\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u907f\u514d\u540c\u65f6\u4ee5\u8f85\u52a9 IP \u6a21\u5f0f\u548c\u524d\u7f00\u59d4\u6d3e\u6a21\u5f0f\u8fd0\u884c Pod\u3002\u5f53\u60a8\u4ece\u8f85\u52a9 IP \u6a21\u5f0f\u8fc1\u79fb\u5230\u524d\u7f00\u59d4\u6d3e\u6a21\u5f0f\u6216\u76f8\u53cd\u65f6\uff0c\u5982\u679c\u6709\u6b63\u5728\u8fd0\u884c\u7684 Windows \u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u3002</p> <p>\u867d\u7136\u8fd9\u4e0d\u4f1a\u5f71\u54cd\u60a8\u6b63\u5728\u8fd0\u884c\u7684 Pod\uff0c\u4f46\u8282\u70b9\u7684 IP \u5730\u5740\u5bb9\u91cf\u53ef\u80fd\u4f1a\u4e0d\u4e00\u81f4\u3002\u4f8b\u5982\uff0c\u8003\u8651\u4e00\u4e2a t3.xlarge \u8282\u70b9\uff0c\u5b83\u6709 14 \u4e2a\u63d2\u69fd\u7528\u4e8e\u8f85\u52a9 IPv4 \u5730\u5740\u3002\u5982\u679c\u60a8\u6b63\u5728\u8fd0\u884c 10 \u4e2a Pod\uff0c\u90a3\u4e48 ENI \u4e0a\u7684 10 \u4e2a\u63d2\u69fd\u5c06\u88ab\u8f85\u52a9 IP \u5730\u5740\u5360\u7528\u3002\u542f\u7528\u524d\u7f00\u59d4\u6d3e\u540e\uff0c\u5411 kube-api \u670d\u52a1\u5668\u516c\u5e03\u7684\u5bb9\u91cf\u5c06\u662f (14 \u4e2a\u63d2\u69fd * \u6bcf\u4e2a\u524d\u7f00 16 \u4e2a IP \u5730\u5740) 244\uff0c\u4f46\u5b9e\u9645\u5bb9\u91cf\u5728\u90a3\u4e00\u523b\u5c06\u662f (\u5269\u4f59 4 \u4e2a\u63d2\u69fd * \u6bcf\u4e2a\u524d\u7f00 16 \u4e2a\u5730\u5740) 64\u3002\u516c\u5e03\u7684\u5bb9\u91cf\u91cf\u4e0e\u5b9e\u9645\u5bb9\u91cf\u91cf\uff08\u5269\u4f59\u63d2\u69fd\uff09\u4e4b\u95f4\u7684\u8fd9\u79cd\u4e0d\u4e00\u81f4\u53ef\u80fd\u4f1a\u5bfc\u81f4\u95ee\u9898\uff0c\u5982\u679c\u60a8\u8fd0\u884c\u7684 Pod \u591a\u4e8e\u53ef\u7528\u4e8e\u5206\u914d\u7684 IP \u5730\u5740\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0a\u8ff0\u8fc1\u79fb\u7b56\u7565\u5b89\u5168\u5730\u5c06\u60a8\u7684 Pod \u4ece\u8f85\u52a9 IP \u5730\u5740\u8fc7\u6e21\u5230\u4ece\u524d\u7f00\u83b7\u53d6\u7684\u5730\u5740\u3002\u5728\u5207\u6362\u6a21\u5f0f\u65f6\uff0cPod \u5c06\u7ee7\u7eed\u6b63\u5e38\u8fd0\u884c\uff0c\u5e76\u4e14\uff1a</p> <ul> <li>\u4ece\u8f85\u52a9 IP \u6a21\u5f0f\u5207\u6362\u5230\u524d\u7f00\u59d4\u6d3e\u6a21\u5f0f\u65f6\uff0c\u5206\u914d\u7ed9\u6b63\u5728\u8fd0\u884c\u7684 Pod \u7684\u8f85\u52a9 IP \u5730\u5740\u4e0d\u4f1a\u88ab\u91ca\u653e\u3002\u524d\u7f00\u5c06\u88ab\u5206\u914d\u5230\u7a7a\u95f2\u63d2\u69fd\u3002\u4e00\u65e6 Pod \u7ec8\u6b62\uff0c\u5b83\u6240\u4f7f\u7528\u7684\u8f85\u52a9 IP \u548c\u63d2\u69fd\u5c06\u88ab\u91ca\u653e\u3002</li> <li>\u4ece\u524d\u7f00\u59d4\u6d3e\u6a21\u5f0f\u5207\u6362\u5230\u8f85\u52a9 IP \u6a21\u5f0f\u65f6\uff0c\u5f53\u5176\u8303\u56f4\u5185\u7684\u6240\u6709 IP \u90fd\u4e0d\u518d\u5206\u914d\u7ed9 Pod \u65f6\uff0c\u524d\u7f00\u5c06\u88ab\u91ca\u653e\u3002\u5982\u679c\u524d\u7f00\u4e2d\u7684\u4efb\u4f55 IP \u88ab\u5206\u914d\u7ed9 Pod\uff0c\u5219\u8be5\u524d\u7f00\u5c06\u88ab\u4fdd\u7559\uff0c\u76f4\u5230 Pod \u7ec8\u6b62\u3002</li> </ul>"},{"location":"zh/networking/prefix-mode/index_windows/#_4","title":"\u8c03\u8bd5\u524d\u7f00\u59d4\u6d3e\u95ee\u9898","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u6211\u4eec\u7684\u8c03\u8bd5\u6307\u5357\u6b64\u5904\u6df1\u5165\u4e86\u89e3\u60a8\u5728 Windows \u4e0a\u4f7f\u7528\u524d\u7f00\u59d4\u6d3e\u65f6\u9047\u5230\u7684\u95ee\u9898\u3002</p>"},{"location":"zh/networking/sgpp/","title":"\u6bcf\u4e2a Pod \u7684\u5b89\u5168\u7ec4","text":"<p>AWS \u5b89\u5168\u7ec4\u5145\u5f53 EC2 \u5b9e\u4f8b\u7684\u865a\u62df\u9632\u706b\u5899\uff0c\u7528\u4e8e\u63a7\u5236\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAmazon VPC CNI \u5c06\u4f7f\u7528\u4e0e\u8282\u70b9\u4e0a\u4e3b ENI \u5173\u8054\u7684\u5b89\u5168\u7ec4\u3002\u66f4\u5177\u4f53\u5730\u8bf4\uff0c\u4e0e\u5b9e\u4f8b\u5173\u8054\u7684\u6bcf\u4e2a ENI \u90fd\u5c06\u5177\u6709\u76f8\u540c\u7684 EC2 \u5b89\u5168\u7ec4\u3002\u56e0\u6b64\uff0c\u8282\u70b9\u4e0a\u7684\u6bcf\u4e2a Pod \u90fd\u5171\u4eab\u8be5\u8282\u70b9\u7684\u76f8\u540c\u5b89\u5168\u7ec4\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8fd0\u884c\u5728\u5de5\u4f5c\u8282\u70b9\u4e0a\u7684\u6240\u6709\u5e94\u7528\u7a0b\u5e8f Pod \u90fd\u5c06\u80fd\u591f\u8bbf\u95ee RDS \u6570\u636e\u5e93\u670d\u52a1(\u8003\u8651\u5230 RDS \u5165\u7ad9\u5141\u8bb8\u8282\u70b9\u5b89\u5168\u7ec4)\u3002\u5b89\u5168\u7ec4\u8fc7\u4e8e\u7c97\u7c92\u5ea6\uff0c\u56e0\u4e3a\u5b83\u4eec\u9002\u7528\u4e8e\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u6240\u6709 Pod\u3002Pod \u7684\u5b89\u5168\u7ec4\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u4e86\u7f51\u7edc\u9694\u79bb\uff0c\u8fd9\u662f\u826f\u597d\u7684\u6df1\u5ea6\u9632\u5fa1\u7b56\u7565\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002</p> <p></p> <p>\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u5171\u4eab\u8ba1\u7b97\u8d44\u6e90\u4e0a\u8fd0\u884c\u5177\u6709\u4e0d\u540c\u7f51\u7edc\u5b89\u5168\u8981\u6c42\u7684\u5e94\u7528\u7a0b\u5e8f\u6765\u63d0\u9ad8\u8ba1\u7b97\u6548\u7387\u3002\u53ef\u4ee5\u5728 EC2 \u5b89\u5168\u7ec4\u4e2d\u5b9a\u4e49\u591a\u79cd\u7c7b\u578b\u7684\u5b89\u5168\u89c4\u5219(\u5982 Pod \u5230 Pod \u548c Pod \u5230\u5916\u90e8 AWS \u670d\u52a1)\uff0c\u5e76\u4f7f\u7528 Kubernetes \u539f\u751f API \u5c06\u5176\u5e94\u7528\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u3002\u4e0b\u56fe\u663e\u793a\u4e86\u5728 Pod \u7ea7\u522b\u5e94\u7528\u7684\u5b89\u5168\u7ec4\uff0c\u4ee5\u53ca\u5b83\u4eec\u5982\u4f55\u7b80\u5316\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u548c\u8282\u70b9\u67b6\u6784\u3002Pod \u73b0\u5728\u53ef\u4ee5\u8bbf\u95ee Amazon RDS \u6570\u636e\u5e93\u3002</p> <p></p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e3a VPC CNI \u8bbe\u7f6e <code>ENABLE_POD_ENI=true</code> \u6765\u542f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u3002\u542f\u7528\u540e\uff0c\u8fd0\u884c\u5728\u63a7\u5236\u5e73\u9762(\u7531 EKS \u7ba1\u7406)\u4e0a\u7684 \"VPC \u8d44\u6e90\u63a7\u5236\u5668\"\u4f1a\u521b\u5efa\u5e76\u5c06\u4e00\u4e2a\u540d\u4e3a \"aws-k8s-trunk-eni\" \u7684\u4e3b\u5e72\u63a5\u53e3\u9644\u52a0\u5230\u8282\u70b9\u3002\u4e3b\u5e72\u63a5\u53e3\u5145\u5f53\u9644\u52a0\u5230\u5b9e\u4f8b\u7684\u6807\u51c6\u7f51\u7edc\u63a5\u53e3\u3002\u8981\u7ba1\u7406\u4e3b\u5e72\u63a5\u53e3\uff0c\u60a8\u5fc5\u987b\u5c06 <code>AmazonEKSVPCResourceController</code> \u6258\u7ba1\u7b56\u7565\u6dfb\u52a0\u5230\u4e0e\u60a8\u7684 Amazon EKS \u96c6\u7fa4\u76f8\u5173\u7684\u96c6\u7fa4\u89d2\u8272\u3002</p> <p>\u63a7\u5236\u5668\u8fd8\u4f1a\u521b\u5efa\u540d\u4e3a \"aws-k8s-branch-eni\" \u7684\u5206\u652f\u63a5\u53e3\uff0c\u5e76\u5c06\u5b83\u4eec\u4e0e\u4e3b\u5e72\u63a5\u53e3\u5173\u8054\u3002Pod \u4f7f\u7528 SecurityGroupPolicy \u81ea\u5b9a\u4e49\u8d44\u6e90\u5206\u914d\u5b89\u5168\u7ec4\uff0c\u5e76\u4e0e\u5206\u652f\u63a5\u53e3\u5173\u8054\u3002\u7531\u4e8e\u5b89\u5168\u7ec4\u662f\u4e0e\u7f51\u7edc\u63a5\u53e3\u6307\u5b9a\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u73b0\u5728\u80fd\u591f\u5728\u8fd9\u4e9b\u989d\u5916\u7684\u7f51\u7edc\u63a5\u53e3\u4e0a\u8c03\u5ea6\u9700\u8981\u7279\u5b9a\u5b89\u5168\u7ec4\u7684 Pod\u3002\u8bf7\u67e5\u770b EKS \u7528\u6237\u6307\u5357\u5173\u4e8e Pod \u7684\u5b89\u5168\u7ec4\u90e8\u5206,\u5305\u62ec\u90e8\u7f72\u5148\u51b3\u6761\u4ef6\u3002</p> <p></p> <p>\u5206\u652f\u63a5\u53e3\u5bb9\u91cf\u662f\u73b0\u6709\u5b9e\u4f8b\u7c7b\u578b\u9650\u5236\u7684\u9644\u52a0,\u7528\u4e8e\u8f85\u52a9 IP \u5730\u5740\u3002\u4f7f\u7528\u5b89\u5168\u7ec4\u7684 Pod \u4e0d\u8ba1\u5165 max-pods \u516c\u5f0f\u4e2d\uff0c\u5f53\u60a8\u4e3a Pod \u4f7f\u7528\u5b89\u5168\u7ec4\u65f6\uff0c\u60a8\u9700\u8981\u8003\u8651\u63d0\u9ad8 max-pods \u503c\u6216\u6ee1\u8db3\u4e8e\u8fd0\u884c\u6bd4\u8282\u70b9\u5b9e\u9645\u652f\u6301\u7684 Pod \u66f4\u5c11\u3002</p> <p>m5.large \u6700\u591a\u53ef\u4ee5\u6709 9 \u4e2a\u5206\u652f\u7f51\u7edc\u63a5\u53e3\uff0c\u5e76\u4e14\u6700\u591a\u53ef\u4ee5\u4e3a\u5176\u6807\u51c6\u7f51\u7edc\u63a5\u53e3\u5206\u914d 27 \u4e2a\u8f85\u52a9 IP \u5730\u5740\u3002\u5982\u4e0b\u4f8b\u6240\u793a\uff0cm5.large \u7684\u9ed8\u8ba4 max-pods \u4e3a 29\uff0cEKS \u5c06\u4f7f\u7528\u5b89\u5168\u7ec4\u7684 Pod \u8ba1\u5165\u6700\u5927 Pod \u6570\u3002\u8bf7\u53c2\u9605 EKS \u7528\u6237\u6307\u5357\u4e86\u89e3\u5982\u4f55\u66f4\u6539\u8282\u70b9\u7684 max-pods \u7684\u8bf4\u660e\u3002</p> <p>\u5f53 Pod \u7684\u5b89\u5168\u7ec4\u4e0e \u81ea\u5b9a\u4e49\u7f51\u7edc\u7ed3\u5408\u4f7f\u7528\u65f6\uff0c\u5c06\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u4e2d\u5b9a\u4e49\u7684\u5b89\u5168\u7ec4\uff0c\u800c\u4e0d\u662f ENIConfig \u4e2d\u6307\u5b9a\u7684\u5b89\u5168\u7ec4\u3002\u56e0\u6b64\uff0c\u542f\u7528\u81ea\u5b9a\u4e49\u7f51\u7edc\u65f6\uff0c\u5728\u4f7f\u7528\u6bcf\u4e2a Pod \u7684\u5b89\u5168\u7ec4\u65f6\uff0c\u8bf7\u4ed4\u7ec6\u8bc4\u4f30\u5b89\u5168\u7ec4\u6392\u5e8f\u3002</p>"},{"location":"zh/networking/sgpp/#_1","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/sgpp/#tcp","title":"\u7981\u7528 TCP \u65e9\u671f\u89e3\u590d\u7528\u4ee5\u8fdb\u884c\u6d3b\u8dc3\u5ea6\u63a2\u6d4b","text":"<p>\u5982\u679c\u60a8\u4f7f\u7528\u6d3b\u8dc3\u5ea6\u6216\u5c31\u7eea\u63a2\u6d4b\uff0c\u60a8\u8fd8\u9700\u8981\u7981\u7528 TCP \u65e9\u671f\u89e3\u590d\u7528\uff0c\u4ee5\u4fbf kubelet \u53ef\u4ee5\u901a\u8fc7 TCP \u8fde\u63a5\u5230\u5206\u652f\u7f51\u7edc\u63a5\u53e3\u4e0a\u7684 Pod\u3002\u8fd9\u4ec5\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\u9700\u8981\u3002\u8981\u6267\u884c\u6b64\u64cd\u4f5c\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>kubectl edit daemonset aws-node -n kube-system\n</code></pre> <p>\u5728 <code>initContainer</code> \u90e8\u5206\u4e0b\uff0c\u5c06 <code>DISABLE_TCP_EARLY_DEMUX</code> \u7684\u503c\u66f4\u6539\u4e3a <code>true</code>\u3002</p>"},{"location":"zh/networking/sgpp/#pod-aws","title":"\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u6765\u5229\u7528\u73b0\u6709\u7684 AWS \u914d\u7f6e\u6295\u8d44","text":"<p>\u5b89\u5168\u7ec4\u4f7f\u9650\u5236\u5bf9 VPC \u8d44\u6e90(\u5982 RDS \u6570\u636e\u5e93\u6216 EC2 \u5b9e\u4f8b)\u7684\u7f51\u7edc\u8bbf\u95ee\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002Pod \u7684\u5b89\u5168\u7ec4\u7684\u4e00\u4e2a\u660e\u663e\u4f18\u52bf\u662f\u53ef\u4ee5\u91cd\u7528\u73b0\u6709\u7684 AWS \u5b89\u5168\u7ec4\u8d44\u6e90\u3002 \u5982\u679c\u60a8\u4f7f\u7528\u5b89\u5168\u7ec4\u4f5c\u4e3a\u7f51\u7edc\u9632\u706b\u5899\u6765\u9650\u5236\u5bf9 AWS \u670d\u52a1\u7684\u8bbf\u95ee\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u5206\u652f ENI \u5c06\u5b89\u5168\u7ec4\u5e94\u7528\u4e8e Pod\u3002\u5982\u679c\u60a8\u8981\u5c06\u5e94\u7528\u7a0b\u5e8f\u4ece EC2 \u5b9e\u4f8b\u8f6c\u79fb\u5230 EKS\uff0c\u5e76\u4f7f\u7528\u5b89\u5168\u7ec4\u9650\u5236\u5bf9\u5176\u4ed6 AWS \u670d\u52a1\u7684\u8bbf\u95ee\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u3002</p>"},{"location":"zh/networking/sgpp/#pod_1","title":"\u914d\u7f6e Pod \u5b89\u5168\u7ec4\u5f3a\u5236\u6a21\u5f0f","text":"<p>Amazon VPC CNI \u63d2\u4ef6\u7248\u672c 1.11 \u6dfb\u52a0\u4e86\u4e00\u4e2a\u540d\u4e3a <code>POD_SECURITY_GROUP_ENFORCING_MODE</code>(\"\u5f3a\u5236\u6a21\u5f0f\")\u7684\u65b0\u8bbe\u7f6e\u3002\u5f3a\u5236\u6a21\u5f0f\u63a7\u5236\u5e94\u7528\u4e8e Pod \u7684\u5b89\u5168\u7ec4\u4ee5\u53ca\u662f\u5426\u542f\u7528\u6e90 NAT\u3002\u60a8\u53ef\u4ee5\u5c06\u5f3a\u5236\u6a21\u5f0f\u6307\u5b9a\u4e3a\u4e25\u683c\u6216\u6807\u51c6\u3002\u4e25\u683c\u662f\u9ed8\u8ba4\u503c\uff0c\u53cd\u6620\u4e86\u5728\u8bbe\u7f6e <code>ENABLE_POD_ENI</code> \u4e3a <code>true</code> \u65f6 VPC CNI \u7684\u4ee5\u524d\u884c\u4e3a\u3002</p> <p>\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\uff0c\u4ec5\u5f3a\u5236\u6267\u884c\u5206\u652f ENI \u5b89\u5168\u7ec4\u3002\u6e90 NAT \u4e5f\u88ab\u7981\u7528\u3002</p> <p>\u5728\u6807\u51c6\u6a21\u5f0f\u4e0b\uff0c\u5c06\u5e94\u7528\u4e0e\u4e3b ENI \u548c\u4e0e Pod \u5173\u8054\u7684\u5206\u652f ENI \u76f8\u5173\u8054\u7684\u5b89\u5168\u7ec4\u3002\u7f51\u7edc\u6d41\u91cf\u5fc5\u987b\u7b26\u5408\u8fd9\u4e24\u4e2a\u5b89\u5168\u7ec4\u3002</p> <p>\u8b66\u544a</p> <p>\u4efb\u4f55\u6a21\u5f0f\u66f4\u6539\u53ea\u4f1a\u5f71\u54cd\u65b0\u542f\u52a8\u7684 Pod\u3002\u73b0\u6709 Pod \u5c06\u4f7f\u7528\u521b\u5efa Pod \u65f6\u914d\u7f6e\u7684\u6a21\u5f0f\u3002\u5982\u679c\u5ba2\u6237\u60f3\u8981\u66f4\u6539\u6d41\u91cf\u884c\u4e3a\uff0c\u4ed6\u4eec\u9700\u8981\u91cd\u65b0\u542f\u52a8\u5177\u6709\u5b89\u5168\u7ec4\u7684\u73b0\u6709 Pod\u3002</p>"},{"location":"zh/networking/sgpp/#pod_2","title":"\u5f3a\u5236\u6a21\u5f0f\uff1a\u4f7f\u7528\u4e25\u683c\u6a21\u5f0f\u9694\u79bb Pod \u548c\u8282\u70b9\u6d41\u91cf\uff1a","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cPod \u7684\u5b89\u5168\u7ec4\u8bbe\u7f6e\u4e3a\"\u4e25\u683c\u6a21\u5f0f\"\u3002\u5982\u679c\u60a8\u5fc5\u987b\u5b8c\u5168\u5206\u79bb Pod \u6d41\u91cf\u548c\u8282\u70b9\u7684\u5176\u4f59\u6d41\u91cf\uff0c\u8bf7\u4f7f\u7528\u6b64\u8bbe\u7f6e\u3002\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\uff0c\u6e90 NAT \u88ab\u5173\u95ed\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u5206\u652f ENI \u51fa\u7ad9\u5b89\u5168\u7ec4\u3002</p> <p>\u8b66\u544a</p> <p>\u542f\u7528\u4e25\u683c\u6a21\u5f0f\u65f6\uff0cPod \u7684\u6240\u6709\u51fa\u7ad9\u6d41\u91cf\u90fd\u5c06\u79bb\u5f00\u8282\u70b9\u5e76\u8fdb\u5165 VPC \u7f51\u7edc\u3002\u540c\u4e00\u8282\u70b9\u4e0a\u7684 Pod \u4e4b\u95f4\u7684\u6d41\u91cf\u5c06\u901a\u8fc7 VPC\u3002\u8fd9\u4f1a\u589e\u52a0 VPC \u6d41\u91cf\uff0c\u5e76\u9650\u5236\u57fa\u4e8e\u8282\u70b9\u7684\u529f\u80fd\u3002NodeLocal DNSCache \u4e0d\u652f\u6301\u4e25\u683c\u6a21\u5f0f\u3002</p>"},{"location":"zh/networking/sgpp/#_2","title":"\u5f3a\u5236\u6a21\u5f0f\uff1a\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u4f7f\u7528\u6807\u51c6\u6a21\u5f0f","text":"<p>\u5ba2\u6237\u7aef\u6e90 IP \u5bf9 Pod \u4e2d\u7684\u5bb9\u5668\u53ef\u89c1</p> <p>\u5982\u679c\u60a8\u9700\u8981\u4fdd\u6301\u5ba2\u6237\u7aef\u6e90 IP \u5bf9 Pod \u4e2d\u7684\u5bb9\u5668\u53ef\u89c1\uff0c\u8bf7\u8003\u8651\u5c06 <code>POD_SECURITY_GROUP_ENFORCING_MODE</code> \u8bbe\u7f6e\u4e3a <code>standard</code>\u3002Kubernetes \u670d\u52a1\u652f\u6301 externalTrafficPolicy=local \u4ee5\u4fdd\u7559\u5ba2\u6237\u7aef\u6e90 IP(\u9ed8\u8ba4\u7c7b\u578b\u4e3a cluster)\u3002\u60a8\u73b0\u5728\u53ef\u4ee5\u5728\u6807\u51c6\u6a21\u5f0f\u4e0b\u4f7f\u7528 externalTrafficPolicy \u8bbe\u7f6e\u4e3a Local \u7684 NodePort \u548c LoadBalancer \u7c7b\u578b\u7684 Kubernetes \u670d\u52a1\u8fd0\u884c\u5b9e\u4f8b\u76ee\u6807\u3002<code>Local</code> \u4fdd\u7559\u5ba2\u6237\u7aef\u6e90 IP\uff0c\u5e76\u907f\u514d\u4e86 LoadBalancer \u548c NodePort \u7c7b\u578b\u670d\u52a1\u7684\u7b2c\u4e8c\u8df3\u3002</p> <p>\u90e8\u7f72 NodeLocal DNSCache</p> <p>\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u65f6\uff0c\u8bf7\u5c06\u6a21\u5f0f\u914d\u7f6e\u4e3a\u6807\u51c6\u4ee5\u652f\u6301\u4f7f\u7528 NodeLocal DNSCache\u7684 Pod\u3002NodeLocal DNSCache \u901a\u8fc7\u5728\u96c6\u7fa4\u8282\u70b9\u4e0a\u4f5c\u4e3a DaemonSet \u8fd0\u884c DNS \u7f13\u5b58\u4ee3\u7406\u6765\u63d0\u9ad8\u96c6\u7fa4 DNS \u6027\u80fd\u3002\u8fd9\u5c06\u6709\u52a9\u4e8e\u5177\u6709\u6700\u9ad8 DNS QPS \u8981\u6c42\u7684 Pod \u67e5\u8be2\u672c\u5730 kube-dns/CoreDNS,\u4ece\u800c\u63d0\u9ad8\u5ef6\u8fdf\u3002</p> <p>NodeLocal DNSCache \u4e0d\u652f\u6301\u4e25\u683c\u6a21\u5f0f\uff0c\u56e0\u4e3a\u6240\u6709\u7f51\u7edc\u6d41\u91cf(\u5373\u4f7f\u662f\u5230\u8282\u70b9\u7684\u6d41\u91cf)\u4e5f\u4f1a\u8fdb\u5165 VPC\u3002</p> <p>\u652f\u6301 Kubernetes \u7f51\u7edc\u7b56\u7565</p> <p>\u5728\u4f7f\u7528\u4e0e Pod \u5173\u8054\u7684\u5b89\u5168\u7ec4\u65f6\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u6807\u51c6\u5f3a\u5236\u6a21\u5f0f\u3002</p> <p>\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u5229\u7528 Pod \u7684\u5b89\u5168\u7ec4\u6765\u9650\u5236\u5bf9\u4e0d\u5c5e\u4e8e\u96c6\u7fa4\u7684 AWS \u670d\u52a1\u7684\u7f51\u7edc\u7ea7\u8bbf\u95ee\u3002\u8003\u8651\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u6765\u9650\u5236\u96c6\u7fa4\u5185\u90e8 Pod \u4e4b\u95f4\u7684\u7f51\u7edc\u6d41\u91cf\uff0c\u901a\u5e38\u79f0\u4e3a\u4e1c\u897f\u5411\u6d41\u91cf\u3002</p>"},{"location":"zh/networking/sgpp/#pod_3","title":"\u8bc6\u522b\u4e0e Pod \u7684\u5b89\u5168\u7ec4\u4e0d\u517c\u5bb9\u7684\u60c5\u51b5","text":"<p>\u57fa\u4e8e Windows \u548c\u975e nitro \u5b9e\u4f8b\u4e0d\u652f\u6301 Pod \u7684\u5b89\u5168\u7ec4\u3002\u8981\u5229\u7528 Pod \u7684\u5b89\u5168\u7ec4\uff0c\u5b9e\u4f8b\u5fc5\u987b\u6807\u8bb0\u4e3a isTrunkingEnabled\u3002\u5982\u679c\u60a8\u7684 Pod \u4e0d\u4f9d\u8d56\u4e8e VPC \u5185\u90e8\u6216\u5916\u90e8\u7684\u4efb\u4f55 AWS \u670d\u52a1\uff0c\u8bf7\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u800c\u4e0d\u662f\u5b89\u5168\u7ec4\u6765\u7ba1\u7406 Pod \u4e4b\u95f4\u7684\u8bbf\u95ee\u3002</p>"},{"location":"zh/networking/sgpp/#pod-aws_1","title":"\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u6709\u6548\u63a7\u5236\u5bf9 AWS \u670d\u52a1\u7684\u6d41\u91cf","text":"<p>\u5982\u679c\u5728 EKS \u96c6\u7fa4\u5185\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u4e0e VPC \u5185\u7684\u53e6\u4e00\u4e2a\u8d44\u6e90(\u4f8b\u5982 RDS \u6570\u636e\u5e93)\u901a\u4fe1\uff0c\u5219\u8bf7\u8003\u8651\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4\u3002\u867d\u7136\u6709\u4e00\u4e9b\u7b56\u7565\u5f15\u64ce\u5141\u8bb8\u60a8\u6307\u5b9a CIDR \u6216 DNS \u540d\u79f0\uff0c\u4f46\u5f53\u4e0e\u5177\u6709\u4f4d\u4e8e VPC \u5185\u7684\u7aef\u70b9\u7684 AWS \u670d\u52a1\u901a\u4fe1\u65f6\uff0c\u5b83\u4eec\u5e76\u4e0d\u662f\u6700\u4f73\u9009\u62e9\u3002</p> <p>\u76f8\u53cd\uff0cKubernetes \u7f51\u7edc\u7b56\u7565\u63d0\u4f9b\u4e86\u4e00\u79cd\u63a7\u5236\u96c6\u7fa4\u5185\u90e8\u548c\u5916\u90e8\u7684\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u7684\u673a\u5236\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5bf9\u5176\u4ed6 AWS \u670d\u52a1\u7684\u4f9d\u8d56\u6709\u9650\uff0c\u5e94\u8003\u8651 Kubernetes \u7f51\u7edc\u7b56\u7565\u3002\u60a8\u53ef\u4ee5\u914d\u7f6e\u57fa\u4e8e CIDR \u8303\u56f4\u7684\u7f51\u7edc\u7b56\u7565\u6765\u9650\u5236\u5bf9 AWS \u670d\u52a1\u7684\u8bbf\u95ee\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 AWS \u539f\u751f\u8bed\u4e49(\u5982\u5b89\u5168\u7ec4)\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Kubernetes \u7f51\u7edc\u7b56\u7565\u6765\u63a7\u5236 Pod \u4e4b\u95f4(\u901a\u5e38\u79f0\u4e3a\u4e1c\u897f\u5411\u6d41\u91cf)\u4ee5\u53ca Pod \u548c\u5916\u90e8\u670d\u52a1\u4e4b\u95f4\u7684\u7f51\u7edc\u6d41\u91cf\u3002Kubernetes \u7f51\u7edc\u7b56\u7565\u5728 OSI \u7b2c 3 \u5c42\u548c\u7b2c 4 \u5c42\u5b9e\u73b0\u3002</p> <p>Amazon EKS \u5141\u8bb8\u60a8\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u5f15\u64ce\uff0c\u5982 Calico \u548c Cilium\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u5b89\u88c5\u7f51\u7edc\u7b56\u7565\u5f15\u64ce\u3002\u8bf7\u67e5\u770b\u76f8\u5e94\u7684\u5b89\u88c5\u6307\u5357\u4ee5\u83b7\u53d6\u8bbe\u7f6e\u8bf4\u660e\u3002\u6709\u5173\u5982\u4f55\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 EKS \u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u3002DNS \u4e3b\u673a\u540d\u529f\u80fd\u5728\u7f51\u7edc\u7b56\u7565\u5f15\u64ce\u7684\u4f01\u4e1a\u7248\u672c\u4e2d\u53ef\u7528\uff0c\u8fd9\u5bf9\u4e8e\u63a7\u5236 Kubernetes \u670d\u52a1/Pod \u4e0e AWS \u4e4b\u5916\u8fd0\u884c\u7684\u8d44\u6e90\u4e4b\u95f4\u7684\u6d41\u91cf\u53ef\u80fd\u5f88\u6709\u7528\u3002\u6b64\u5916\uff0c\u5bf9\u4e8e\u9ed8\u8ba4\u4e0d\u652f\u6301\u5b89\u5168\u7ec4\u7684 AWS \u670d\u52a1\uff0c\u60a8\u4e5f\u53ef\u4ee5\u8003\u8651 DNS \u4e3b\u673a\u540d\u652f\u6301\u3002</p>"},{"location":"zh/networking/sgpp/#aws","title":"\u4e3a\u4f7f\u7528 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\u6807\u8bb0\u5355\u4e2a\u5b89\u5168\u7ec4","text":"<p>\u5f53\u4e3a Pod \u5206\u914d\u591a\u4e2a\u5b89\u5168\u7ec4\u65f6\uff0cAmazon EKS \u5efa\u8bae\u4f7f\u7528 <code>kubernetes.io/cluster/$name</code> \u5171\u4eab\u6216\u62e5\u6709\u7684\u6807\u7b7e\u6765\u6807\u8bb0\u5355\u4e2a\u5b89\u5168\u7ec4\u3002\u8be5\u6807\u7b7e\u5141\u8bb8 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\u66f4\u65b0\u5b89\u5168\u7ec4\u7684\u89c4\u5219\uff0c\u4ee5\u5c06\u6d41\u91cf\u8def\u7531\u5230 Pod\u3002\u5982\u679c\u53ea\u4e3a Pod \u5206\u914d\u4e86\u4e00\u4e2a\u5b89\u5168\u7ec4\uff0c\u5219\u6807\u8bb0\u662f\u53ef\u9009\u7684\u3002\u5b89\u5168\u7ec4\u4e2d\u8bbe\u7f6e\u7684\u6743\u9650\u662f\u7d2f\u52a0\u7684\uff0c\u56e0\u6b64\u6807\u8bb0\u5355\u4e2a\u5b89\u5168\u7ec4\u5c31\u8db3\u4ee5\u8ba9\u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\u5b9a\u4f4d\u548c\u534f\u8c03\u89c4\u5219\u3002\u5b83\u8fd8\u6709\u52a9\u4e8e\u9075\u5b88\u5b89\u5168\u7ec4\u5b9a\u4e49\u7684\u9ed8\u8ba4\u914d\u989d\u3002</p>"},{"location":"zh/networking/sgpp/#nat","title":"\u4e3a\u51fa\u7ad9\u6d41\u91cf\u914d\u7f6e NAT","text":"<p>\u7981\u7528\u4ece\u5206\u914d\u4e86\u5b89\u5168\u7ec4\u7684 Pod \u7684\u51fa\u7ad9\u6d41\u91cf\u7684\u6e90 NAT\u3002\u5bf9\u4e8e\u9700\u8981\u8bbf\u95ee\u4e92\u8054\u7f51\u7684\u4f7f\u7528\u5b89\u5168\u7ec4\u7684 Pod\uff0c\u8bf7\u5728\u914d\u7f6e\u4e86 NAT \u7f51\u5173\u6216\u5b9e\u4f8b\u7684\u79c1\u6709\u5b50\u7f51\u4e0a\u542f\u52a8\u5de5\u4f5c\u8282\u70b9\uff0c\u5e76\u5728 CNI \u4e2d\u542f\u7528 \u5916\u90e8 SNAT\u3002</p> <pre><code>kubectl set env daemonset -n kube-system aws-node AWS_VPC_K8S_CNI_EXTERNALSNAT=true\n</code></pre>"},{"location":"zh/networking/sgpp/#pod_4","title":"\u5c06\u5177\u6709\u5b89\u5168\u7ec4\u7684 Pod \u90e8\u7f72\u5230\u79c1\u6709\u5b50\u7f51","text":"<p>\u5206\u914d\u4e86\u5b89\u5168\u7ec4\u7684 Pod \u5fc5\u987b\u5728\u90e8\u7f72\u5230\u79c1\u6709\u5b50\u7f51\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\u3002\u8bf7\u6ce8\u610f\uff0c\u90e8\u7f72\u5230\u516c\u5171\u5b50\u7f51\u7684\u5206\u914d\u4e86\u5b89\u5168\u7ec4\u7684 Pod \u5c06\u65e0\u6cd5\u8bbf\u95ee\u4e92\u8054\u7f51\u3002</p>"},{"location":"zh/networking/sgpp/#pod-terminationgraceperiodseconds","title":"\u9a8c\u8bc1 Pod \u89c4\u8303\u6587\u4ef6\u4e2d\u7684 terminationGracePeriodSeconds","text":"<p>\u786e\u4fdd\u60a8\u7684 Pod \u89c4\u8303\u6587\u4ef6\u4e2d <code>terminationGracePeriodSeconds</code> \u4e3a\u975e\u96f6\u503c(\u9ed8\u8ba4\u4e3a 30 \u79d2)\u3002\u8fd9\u5bf9\u4e8e Amazon VPC CNI \u4ece\u5de5\u4f5c\u8282\u70b9\u5220\u9664 Pod \u7f51\u7edc\u81f3\u5173\u91cd\u8981\u3002\u5f53\u8bbe\u7f6e\u4e3a\u96f6\u65f6\uff0cCNI \u63d2\u4ef6\u4e0d\u4f1a\u4ece\u4e3b\u673a\u5220\u9664 Pod \u7f51\u7edc\uff0c\u5e76\u4e14\u5206\u652f ENI \u65e0\u6cd5\u6709\u6548\u6e05\u7406\u3002</p>"},{"location":"zh/networking/sgpp/#fargate-pod","title":"\u5728 Fargate \u4e0a\u4f7f\u7528 Pod \u7684\u5b89\u5168\u7ec4","text":"<p>\u5728 Fargate \u4e0a\u8fd0\u884c\u7684 Pod \u7684\u5b89\u5168\u7ec4\u4e0e\u5728 EC2 \u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 Pod \u7684\u5b89\u5168\u7ec4\u5de5\u4f5c\u65b9\u5f0f\u975e\u5e38\u76f8\u4f3c\u3002\u4f8b\u5982\uff0c\u60a8\u5fc5\u987b\u5148\u521b\u5efa\u5b89\u5168\u7ec4\uff0c\u7136\u540e\u5728\u4e0e Fargate Pod \u5173\u8054\u7684 SecurityGroupPolicy \u4e2d\u5f15\u7528\u5b83\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u96c6\u7fa4\u5b89\u5168\u7ec4\u4f1a\u5206\u914d\u7ed9\u6240\u6709\u672a\u660e\u786e\u5206\u914d SecurityGroupPolicy \u7684 Fargate Pod\u3002\u4e3a\u7b80\u5355\u8d77\u89c1\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5c06\u96c6\u7fa4\u5b89\u5168\u7ec4\u6dfb\u52a0\u5230 Fargate Pod \u7684 SecurityGroupPolicy \u4e2d\uff0c\u5426\u5219\u60a8\u5c06\u4e0d\u5f97\u4e0d\u5411\u5b89\u5168\u7ec4\u6dfb\u52a0\u6700\u5c0f\u5b89\u5168\u7ec4\u89c4\u5219\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 describe-cluster API \u627e\u5230\u96c6\u7fa4\u5b89\u5168\u7ec4\u3002</p> <pre><code> aws eks describe-cluster --name CLUSTER_NAME --query 'cluster.resourcesVpcConfig.clusterSecurityGroupId'\n</code></pre> <pre><code>cat &gt;my-fargate-sg-policy.yaml &lt;&lt;EOF\napiVersion: vpcresources.k8s.aws/v1beta1\nkind: SecurityGroupPolicy\nmetadata:\n  name: my-fargate-sg-policy\n  namespace: my-fargate-namespace\nspec:\n  podSelector: \n    matchLabels:\n      role: my-fargate-role\n  securityGroups:\n    groupIds:\n      - cluster_security_group_id\n      - my_fargate_pod_security_group_id\nEOF\n</code></pre> <p>\u6700\u5c0f\u5b89\u5168\u7ec4\u89c4\u5219\u5217\u5728\u8fd9\u91cc\u3002\u8fd9\u4e9b\u89c4\u5219\u5141\u8bb8 Fargate Pod \u4e0e\u96c6\u7fa4\u5185\u670d\u52a1(\u5982 kube-apiserver\u3001kubelet \u548c CoreDNS)\u901a\u4fe1\u3002\u60a8\u8fd8\u9700\u8981\u6dfb\u52a0\u89c4\u5219\u4ee5\u5141\u8bb8\u4e0e Fargate Pod \u7684\u5165\u7ad9\u548c\u51fa\u7ad9\u8fde\u63a5\uff0c\u4ee5\u53ca\u6765\u81ea\u60a8\u7684 VPC \u7684\u8fde\u63a5\u3002\u8fd9\u5c06\u5141\u8bb8\u60a8\u7684 Pod \u4e0e\u5176\u4ed6 Pod \u6216 VPC \u4e2d\u7684\u8d44\u6e90\u901a\u4fe1\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u9700\u8981\u5305\u542b\u89c4\u5219\uff0c\u4ee5\u4fbf Fargate \u53ef\u4ee5\u4ece Amazon ECR \u6216\u5176\u4ed6\u5bb9\u5668\u6ce8\u518c\u8868(\u5982 DockerHub)\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 AWS \u4e00\u822c\u53c2\u8003\u4e2d\u7684 AWS IP \u5730\u5740\u8303\u56f4\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u627e\u5230\u5e94\u7528\u4e8e Fargate Pod \u7684\u5b89\u5168\u7ec4\u3002</p> <pre><code>kubectl get pod FARGATE_POD -o jsonpath='{.metadata.annotations.vpc\\.amazonaws\\.com/pod-eni}{\"\\n\"}'\n</code></pre> <p>\u8bf7\u8bb0\u4e0b\u4e0a\u8ff0\u547d\u4ee4\u4e2d\u7684 eniId\u3002</p> <pre><code>aws ec2 describe-network-interfaces --network-interface-ids ENI_ID --query 'NetworkInterfaces[*].Groups[*]'\n</code></pre> <p>\u5fc5\u987b\u5220\u9664\u5e76\u91cd\u65b0\u521b\u5efa\u73b0\u6709\u7684 Fargate Pod\uff0c\u65b0\u7684\u5b89\u5168\u7ec4\u624d\u80fd\u5e94\u7528\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8\u4e86 example-app \u7684\u90e8\u7f72\u3002\u8981\u66f4\u65b0\u7279\u5b9a Pod\uff0c\u60a8\u53ef\u4ee5\u5728\u4e0b\u9762\u7684\u547d\u4ee4\u4e2d\u66f4\u6539\u547d\u540d\u7a7a\u95f4\u548c\u90e8\u7f72\u540d\u79f0\u3002</p> <pre><code>kubectl rollout restart -n example-ns deployment example-pod\n</code></pre>"},{"location":"zh/networking/subnets/","title":"VPC \u548c\u5b50\u7f51\u6ce8\u610f\u4e8b\u9879","text":"<p>\u8fd0\u884c EKS \u96c6\u7fa4\u9700\u8981\u4e86\u89e3 AWS VPC \u7f51\u7edc\uff0c\u4ee5\u53ca Kubernetes \u7f51\u7edc\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u60a8\u5728\u5f00\u59cb\u8bbe\u8ba1 VPC \u6216\u5c06\u96c6\u7fa4\u90e8\u7f72\u5230\u73b0\u6709 VPC \u4e4b\u524d\uff0c\u5148\u4e86\u89e3 EKS \u63a7\u5236\u5e73\u9762\u901a\u4fe1\u673a\u5236\u3002</p> <p>\u5728\u8bbe\u8ba1\u8981\u4e0e EKS \u4e00\u8d77\u4f7f\u7528\u7684 VPC \u548c\u5b50\u7f51\u65f6\uff0c\u8bf7\u53c2\u9605\u96c6\u7fa4 VPC \u6ce8\u610f\u4e8b\u9879\u548cAmazon EKS \u5b89\u5168\u7ec4\u6ce8\u610f\u4e8b\u9879\u3002</p>"},{"location":"zh/networking/subnets/#_1","title":"\u6982\u8ff0","text":""},{"location":"zh/networking/subnets/#eks","title":"EKS \u96c6\u7fa4\u67b6\u6784","text":"<p>EKS \u96c6\u7fa4\u7531\u4e24\u4e2a VPC \u7ec4\u6210\uff1a</p> <ul> <li>\u4e00\u4e2a\u7531 AWS \u7ba1\u7406\u7684 VPC\uff0c\u6258\u7ba1 Kubernetes \u63a7\u5236\u5e73\u9762\u3002\u8be5 VPC \u4e0d\u4f1a\u51fa\u73b0\u5728\u5ba2\u6237\u8d26\u6237\u4e2d\u3002</li> <li>\u4e00\u4e2a\u7531\u5ba2\u6237\u7ba1\u7406\u7684 VPC\uff0c\u6258\u7ba1 Kubernetes \u8282\u70b9\u3002\u5bb9\u5668\u8fd0\u884c\u5728\u8fd9\u91cc\uff0c\u4ee5\u53ca\u5176\u4ed6\u7531\u5ba2\u6237\u7ba1\u7406\u7684 AWS \u57fa\u7840\u8bbe\u65bd\uff0c\u5982\u96c6\u7fa4\u4f7f\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u8be5 VPC \u51fa\u73b0\u5728\u5ba2\u6237\u8d26\u6237\u4e2d\u3002\u5728\u521b\u5efa\u96c6\u7fa4\u4e4b\u524d\uff0c\u60a8\u9700\u8981\u521b\u5efa\u5ba2\u6237\u7ba1\u7406\u7684 VPC\u3002\u5982\u679c\u60a8\u6ca1\u6709\u63d0\u4f9b VPC\uff0ceksctl \u4f1a\u521b\u5efa\u4e00\u4e2a\u3002</li> </ul> <p>\u5ba2\u6237 VPC \u4e2d\u7684\u8282\u70b9\u9700\u8981\u80fd\u591f\u8fde\u63a5\u5230 AWS VPC \u4e2d\u7684\u6258\u7ba1 API \u670d\u52a1\u5668\u7aef\u70b9\u3002\u8fd9\u5141\u8bb8\u8282\u70b9\u5411 Kubernetes \u63a7\u5236\u5e73\u9762\u6ce8\u518c\u5e76\u63a5\u6536\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f Pod \u7684\u8bf7\u6c42\u3002</p> <p>\u8282\u70b9\u901a\u8fc7 (a) EKS \u516c\u5171\u7aef\u70b9\u6216 (b) EKS \u7ba1\u7406\u7684\u8de8\u8d26\u6237\u5f39\u6027\u7f51\u7edc\u63a5\u53e3 (X-ENI) \u8fde\u63a5\u5230 EKS \u63a7\u5236\u5e73\u9762\u3002\u5728\u521b\u5efa\u96c6\u7fa4\u65f6\uff0c\u60a8\u9700\u8981\u6307\u5b9a\u81f3\u5c11\u4e24\u4e2a VPC \u5b50\u7f51\u3002EKS \u4f1a\u5728\u6307\u5b9a\u7684\u6bcf\u4e2a\u5b50\u7f51\u4e2d\u653e\u7f6e\u4e00\u4e2a\u8de8\u8d26\u6237 ENI (\u4e5f\u79f0\u4e3a\u96c6\u7fa4\u5b50\u7f51)\u3002Kubernetes API \u670d\u52a1\u5668\u4f7f\u7528\u8fd9\u4e9b\u8de8\u8d26\u6237 ENI \u4e0e\u90e8\u7f72\u5728\u5ba2\u6237\u7ba1\u7406\u7684\u96c6\u7fa4 VPC \u5b50\u7f51\u4e0a\u7684\u8282\u70b9\u8fdb\u884c\u901a\u4fe1\u3002</p> <p></p> <p>\u5f53\u8282\u70b9\u542f\u52a8\u65f6\uff0cEKS \u5f15\u5bfc\u811a\u672c\u4f1a\u6267\u884c\u5e76\u5b89\u88c5 Kubernetes \u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u3002\u4f5c\u4e3a\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u542f\u52a8\u8fc7\u7a0b\u7684\u4e00\u90e8\u5206\uff0c\u5bb9\u5668\u8fd0\u884c\u65f6\u4ee3\u7406\u3001kubelet \u548c Kubernetes \u8282\u70b9\u4ee3\u7406\u4f1a\u542f\u52a8\u3002</p> <p>\u4e3a\u4e86\u6ce8\u518c\u8282\u70b9\uff0cKubelet \u4f1a\u8054\u7cfb Kubernetes \u96c6\u7fa4\u7aef\u70b9\u3002\u5b83\u4f1a\u901a\u8fc7\u516c\u5171\u7aef\u70b9\u6216 VPC \u5185\u7684\u79c1\u6709\u7aef\u70b9\u5efa\u7acb\u8fde\u63a5\u3002Kubelet \u4f1a\u5b9a\u671f\u63a5\u6536\u6765\u81ea\u7aef\u70b9\u7684 API \u6307\u4ee4\u5e76\u63d0\u4f9b\u72b6\u6001\u66f4\u65b0\u548c\u5fc3\u8df3\u3002</p>"},{"location":"zh/networking/subnets/#eks_1","title":"EKS \u63a7\u5236\u5e73\u9762\u901a\u4fe1","text":"<p>EKS \u6709\u4e24\u79cd\u65b9\u5f0f\u63a7\u5236\u5bf9\u96c6\u7fa4\u7aef\u70b9\u7684\u8bbf\u95ee\u3002\u7aef\u70b9\u8bbf\u95ee\u63a7\u5236\u5141\u8bb8\u60a8\u9009\u62e9\u7aef\u70b9\u662f\u5426\u53ef\u4ee5\u4ece\u516c\u5171\u4e92\u8054\u7f51\u8bbf\u95ee\u6216\u4ec5\u901a\u8fc7\u60a8\u7684 VPC \u8bbf\u95ee\u3002\u60a8\u53ef\u4ee5\u542f\u7528\u516c\u5171\u7aef\u70b9(\u8fd9\u662f\u9ed8\u8ba4\u8bbe\u7f6e)\u3001\u79c1\u6709\u7aef\u70b9\u6216\u540c\u65f6\u542f\u7528\u4e24\u8005(\u516c\u5171\u548c\u79c1\u6709)\u3002</p> <p>\u96c6\u7fa4 API \u7aef\u70b9\u7684\u914d\u7f6e\u51b3\u5b9a\u4e86\u8282\u70b9\u4e0e\u63a7\u5236\u5e73\u9762\u901a\u4fe1\u7684\u8def\u5f84\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9b\u7aef\u70b9\u8bbe\u7f6e\u53ef\u4ee5\u968f\u65f6\u901a\u8fc7 EKS \u63a7\u5236\u53f0\u6216 API \u8fdb\u884c\u66f4\u6539\u3002</p>"},{"location":"zh/networking/subnets/#_2","title":"\u516c\u5171\u7aef\u70b9","text":"<p>\u8fd9\u662f\u65b0 Amazon EKS \u96c6\u7fa4\u7684\u9ed8\u8ba4\u884c\u4e3a\u3002\u5f53\u4ec5\u542f\u7528\u96c6\u7fa4\u7684\u516c\u5171\u7aef\u70b9\u65f6\uff0c\u6e90\u81ea\u60a8\u96c6\u7fa4 VPC \u5185\u90e8(\u5982\u5de5\u4f5c\u8282\u70b9\u5230\u63a7\u5236\u5e73\u9762\u901a\u4fe1)\u7684 Kubernetes API \u8bf7\u6c42\u4f1a\u79bb\u5f00 VPC\uff0c\u4f46\u4e0d\u4f1a\u79bb\u5f00 Amazon \u7684\u7f51\u7edc\u3002\u4e3a\u4e86\u8ba9\u8282\u70b9\u8fde\u63a5\u5230\u63a7\u5236\u5e73\u9762\uff0c\u5b83\u4eec\u5fc5\u987b\u5177\u6709\u516c\u5171 IP \u5730\u5740\uff0c\u5e76\u4e14\u6709\u4e00\u6761\u901a\u5f80\u4e92\u8054\u7f51\u7f51\u5173\u6216 NAT \u7f51\u5173\u7684\u8def\u7531\uff0c\u4ee5\u4fbf\u5b83\u4eec\u53ef\u4ee5\u4f7f\u7528 NAT \u7f51\u5173\u7684\u516c\u5171 IP \u5730\u5740\u3002</p>"},{"location":"zh/networking/subnets/#_3","title":"\u516c\u5171\u548c\u79c1\u6709\u7aef\u70b9","text":"<p>\u5f53\u540c\u65f6\u542f\u7528\u516c\u5171\u548c\u79c1\u6709\u7aef\u70b9\u65f6\uff0c\u6765\u81ea VPC \u5185\u90e8\u7684 Kubernetes API \u8bf7\u6c42\u4f1a\u901a\u8fc7\u60a8 VPC \u5185\u7684 X-ENI \u4e0e\u63a7\u5236\u5e73\u9762\u901a\u4fe1\u3002\u60a8\u7684\u96c6\u7fa4 API \u670d\u52a1\u5668\u53ef\u4ee5\u4ece\u4e92\u8054\u7f51\u8bbf\u95ee\u3002</p>"},{"location":"zh/networking/subnets/#_4","title":"\u79c1\u6709\u7aef\u70b9","text":"<p>\u5f53\u4ec5\u542f\u7528\u79c1\u6709\u7aef\u70b9\u65f6\uff0c\u60a8\u7684 API \u670d\u52a1\u5668\u65e0\u6cd5\u4ece\u4e92\u8054\u7f51\u516c\u5f00\u8bbf\u95ee\u3002\u6240\u6709\u5230\u60a8\u7684\u96c6\u7fa4 API \u670d\u52a1\u5668\u7684\u6d41\u91cf\u5fc5\u987b\u6765\u81ea\u60a8\u96c6\u7fa4\u7684 VPC \u6216\u8fde\u63a5\u7684\u7f51\u7edc\u3002\u8282\u70b9\u901a\u8fc7\u60a8 VPC \u5185\u7684 X-ENI \u4e0e API \u670d\u52a1\u5668\u901a\u4fe1\u3002\u8bf7\u6ce8\u610f\uff0c\u96c6\u7fa4\u7ba1\u7406\u5de5\u5177\u5fc5\u987b\u80fd\u591f\u8bbf\u95ee\u79c1\u6709\u7aef\u70b9\u3002\u4e86\u89e3\u5982\u4f55\u4ece Amazon VPC \u5916\u90e8\u8fde\u63a5\u5230\u79c1\u6709 Amazon EKS \u96c6\u7fa4\u7aef\u70b9\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u96c6\u7fa4\u7684 API \u670d\u52a1\u5668\u7aef\u70b9\u7531\u516c\u5171 DNS \u670d\u52a1\u5668\u89e3\u6790\u4e3a\u6765\u81ea VPC \u7684\u79c1\u6709 IP \u5730\u5740\u3002\u8fc7\u53bb\uff0c\u8be5\u7aef\u70b9\u53ea\u80fd\u4ece VPC \u5185\u90e8\u89e3\u6790\u3002</p>"},{"location":"zh/networking/subnets/#vpc_1","title":"VPC \u914d\u7f6e","text":"<p>Amazon VPC \u652f\u6301 IPv4 \u548c IPv6 \u5bfb\u5740\u3002Amazon EKS \u9ed8\u8ba4\u652f\u6301 IPv4\u3002VPC \u5fc5\u987b\u4e0e\u4e4b\u5173\u8054\u4e00\u4e2a IPv4 CIDR \u5757\u3002\u60a8\u4e5f\u53ef\u4ee5\u9009\u62e9\u5c06\u591a\u4e2a IPv4 \u65e0\u7c7b\u522b\u57df\u95f4\u8def\u7531 (CIDR) \u5757\u548c\u591a\u4e2a IPv6 CIDR \u5757\u4e0e\u60a8\u7684 VPC \u5173\u8054\u3002\u521b\u5efa VPC \u65f6\uff0c\u60a8\u5fc5\u987b\u4ece RFC 1918 \u4e2d\u6307\u5b9a\u7684\u79c1\u6709 IPv4 \u5730\u5740\u8303\u56f4\u4e3a VPC \u6307\u5b9a\u4e00\u4e2a IPv4 CIDR \u5757\u3002\u5141\u8bb8\u7684\u5757\u5927\u5c0f\u4ecb\u4e8e /16 \u524d\u7f00(65\uff0c536 \u4e2a IP \u5730\u5740)\u548c /28 \u524d\u7f00(16 \u4e2a IP \u5730\u5740)\u4e4b\u95f4\u3002</p> <p>\u521b\u5efa\u65b0\u7684 VPC \u65f6\uff0c\u60a8\u53ef\u4ee5\u9644\u52a0\u4e00\u4e2a IPv6 CIDR \u5757\uff0c\u66f4\u6539\u73b0\u6709 VPC \u65f6\u6700\u591a\u53ef\u4ee5\u9644\u52a0\u4e94\u4e2a\u3002IPv6 CIDR \u5757\u5927\u5c0f\u7684\u524d\u7f00\u957f\u5ea6\u53ef\u4ee5\u5728 /44 \u548c /60 \u4e4b\u95f4\uff0c\u800c IPv6 \u5b50\u7f51\u53ef\u4ee5\u5728 /44 \u548c /64 \u4e4b\u95f4\u3002\u60a8\u53ef\u4ee5\u4ece Amazon \u7ef4\u62a4\u7684 IPv6 \u5730\u5740\u6c60\u4e2d\u8bf7\u6c42\u4e00\u4e2a IPv6 CIDR \u5757\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 VPC \u7528\u6237\u6307\u5357\u4e2d\u7684VPC CIDR \u5757\u90e8\u5206\u3002</p> <p>Amazon EKS \u96c6\u7fa4\u652f\u6301 IPv4 \u548c IPv6\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cEKS \u96c6\u7fa4\u4f7f\u7528 IPv4 IP\u3002\u5728\u96c6\u7fa4\u521b\u5efa\u65f6\u6307\u5b9a IPv6 \u5c06\u542f\u7528\u4f7f\u7528 IPv6 \u96c6\u7fa4\u3002IPv6 \u96c6\u7fa4\u9700\u8981\u53cc\u6808 VPC \u548c\u5b50\u7f51\u3002</p> <p>\u5728\u96c6\u7fa4\u521b\u5efa\u671f\u95f4\uff0cAmazon EKS \u5efa\u8bae\u60a8\u81f3\u5c11\u4f7f\u7528\u4e24\u4e2a\u4f4d\u4e8e\u4e0d\u540c\u53ef\u7528\u533a\u7684\u5b50\u7f51\u3002\u5728\u96c6\u7fa4\u521b\u5efa\u671f\u95f4\u4f20\u5165\u7684\u5b50\u7f51\u79f0\u4e3a\u96c6\u7fa4\u5b50\u7f51\u3002\u521b\u5efa\u96c6\u7fa4\u65f6\uff0cAmazon EKS \u4f1a\u5728\u60a8\u6307\u5b9a\u7684\u5b50\u7f51\u4e2d\u521b\u5efa\u6700\u591a 4 \u4e2a\u8de8\u8d26\u6237 (x-account \u6216 x-ENI) ENI\u3002\u8fd9\u4e9b x-ENI \u59cb\u7ec8\u4f1a\u90e8\u7f72\u5e76\u7528\u4e8e\u96c6\u7fa4\u7ba1\u7406\u6d41\u91cf\uff0c\u5982\u65e5\u5fd7\u4f20\u9001\u3001exec \u548c\u4ee3\u7406\u3002\u6709\u5173\u5b8c\u6574\u7684VPC \u548c\u5b50\u7f51\u8981\u6c42\u8be6\u60c5\uff0c\u8bf7\u53c2\u9605 EKS \u7528\u6237\u6307\u5357\u3002</p> <p>Kubernetes \u5de5\u4f5c\u8282\u70b9\u53ef\u4ee5\u8fd0\u884c\u5728\u96c6\u7fa4\u5b50\u7f51\u4e2d\uff0c\u4f46\u4e0d\u5efa\u8bae\u8fd9\u6837\u505a\u3002\u5728\u96c6\u7fa4\u5347\u7ea7\u671f\u95f4\uff0cAmazon EKS \u4f1a\u5728\u96c6\u7fa4\u5b50\u7f51\u4e2d\u914d\u7f6e\u989d\u5916\u7684 ENI\u3002\u5f53\u60a8\u7684\u96c6\u7fa4\u6269\u5c55\u65f6\uff0c\u5de5\u4f5c\u8282\u70b9\u548c Pod \u53ef\u80fd\u4f1a\u6d88\u8017\u96c6\u7fa4\u5b50\u7f51\u4e2d\u7684\u53ef\u7528 IP\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u786e\u4fdd\u6709\u8db3\u591f\u7684\u53ef\u7528 IP\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u8003\u8651\u4f7f\u7528\u4e13\u7528\u7684\u96c6\u7fa4\u5b50\u7f51\uff0c\u5176\u7f51\u7edc\u63a9\u7801\u4e3a /28\u3002</p> <p>Kubernetes \u5de5\u4f5c\u8282\u70b9\u53ef\u4ee5\u8fd0\u884c\u5728\u516c\u5171\u6216\u79c1\u6709\u5b50\u7f51\u4e2d\u3002\u5b50\u7f51\u662f\u516c\u5171\u8fd8\u662f\u79c1\u6709\u53d6\u51b3\u4e8e\u5b50\u7f51\u5185\u7684\u6d41\u91cf\u662f\u5426\u901a\u8fc7\u4e92\u8054\u7f51\u7f51\u5173\u8def\u7531\u3002\u516c\u5171\u5b50\u7f51\u7684\u8def\u7531\u8868\u4e2d\u6709\u4e00\u4e2a\u6761\u76ee\uff0c\u901a\u8fc7\u4e92\u8054\u7f51\u7f51\u5173\u8fde\u63a5\u4e92\u8054\u7f51\uff0c\u4f46\u79c1\u6709\u5b50\u7f51\u6ca1\u6709\u3002</p> <p>\u6e90\u81ea\u5176\u4ed6\u5730\u65b9\u5e76\u5230\u8fbe\u60a8\u8282\u70b9\u7684\u6d41\u91cf\u79f0\u4e3a\u5165\u7ad9\u6d41\u91cf\u3002\u6e90\u81ea\u8282\u70b9\u5e76\u79bb\u5f00\u7f51\u7edc\u7684\u6d41\u91cf\u79f0\u4e3a\u51fa\u7ad9\u6d41\u91cf\u3002\u5728\u914d\u7f6e\u4e86\u4e92\u8054\u7f51\u7f51\u5173\u7684\u5b50\u7f51\u4e2d\u5177\u6709\u516c\u5171\u6216\u5f39\u6027 IP \u5730\u5740 (EIP) \u7684\u8282\u70b9\u5141\u8bb8\u6765\u81ea VPC \u5916\u90e8\u7684\u5165\u7ad9\u6d41\u91cf\u3002\u79c1\u6709\u5b50\u7f51\u901a\u5e38\u5305\u62ec\u4e00\u4e2aNAT \u7f51\u5173,\u5b83\u53ea\u5141\u8bb8\u6765\u81ea VPC \u5185\u90e8\u7684\u5165\u7ad9\u6d41\u91cf\u5230\u8fbe\u8282\u70b9\uff0c\u540c\u65f6\u4ecd\u5141\u8bb8\u6765\u81ea\u8282\u70b9\u7684\u51fa\u7ad9\u6d41\u91cf\u79bb\u5f00 VPC\u3002</p> <p>\u5728 IPv6 \u4e16\u754c\u4e2d\uff0c\u6bcf\u4e2a\u5730\u5740\u90fd\u662f\u53ef\u8def\u7531\u7684\u4e92\u8054\u7f51\u5730\u5740\u3002\u4e0e\u8282\u70b9\u548c Pod \u5173\u8054\u7684 IPv6 \u5730\u5740\u662f\u516c\u5171\u7684\u3002\u901a\u8fc7\u5728 VPC \u4e2d\u5b9e\u73b0\u4ec5\u51fa\u7ad9\u4e92\u8054\u7f51\u7f51\u5173 (EIGW) \u6765\u652f\u6301\u79c1\u6709\u5b50\u7f51\uff0c\u5141\u8bb8\u51fa\u7ad9\u6d41\u91cf\u4f46\u963b\u6b62\u6240\u6709\u5165\u7ad9\u6d41\u91cf\u3002\u5b9e\u65bd IPv6 \u5b50\u7f51\u7684\u6700\u4f73\u5b9e\u8df5\u53ef\u4ee5\u5728 VPC \u7528\u6237\u6307\u5357\u4e2d\u627e\u5230\u3002</p>"},{"location":"zh/networking/subnets/#vpc_2","title":"\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e09\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u914d\u7f6e VPC \u548c\u5b50\u7f51\uff1a","text":""},{"location":"zh/networking/subnets/#_5","title":"\u4ec5\u4f7f\u7528\u516c\u5171\u5b50\u7f51","text":"<p>\u8282\u70b9\u548c\u5165\u7ad9\u8d44\u6e90(\u5982\u8d1f\u8f7d\u5747\u8861\u5668)\u90fd\u5728\u540c\u4e00\u4e2a\u516c\u5171\u5b50\u7f51\u4e2d\u521b\u5efa\u3002\u4f7f\u7528<code>kubernetes.io/role/elb</code>\u6807\u8bb0\u516c\u5171\u5b50\u7f51\u4ee5\u6784\u5efa\u9762\u5411\u4e92\u8054\u7f51\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u5728\u6b64\u914d\u7f6e\u4e2d\uff0c\u96c6\u7fa4\u7aef\u70b9\u53ef\u4ee5\u914d\u7f6e\u4e3a\u516c\u5171\u3001\u79c1\u6709\u6216\u4e24\u8005(\u516c\u5171\u548c\u79c1\u6709)\u3002</p>"},{"location":"zh/networking/subnets/#_6","title":"\u4f7f\u7528\u79c1\u6709\u548c\u516c\u5171\u5b50\u7f51","text":"<p>\u8282\u70b9\u5728\u79c1\u6709\u5b50\u7f51\u4e0a\u521b\u5efa\uff0c\u800c\u5165\u7ad9\u8d44\u6e90\u5728\u516c\u5171\u5b50\u7f51\u4e0a\u5b9e\u4f8b\u5316\u3002\u60a8\u53ef\u4ee5\u542f\u7528\u516c\u5171\u3001\u79c1\u6709\u6216\u4e24\u8005(\u516c\u5171\u548c\u79c1\u6709)\u8bbf\u95ee\u96c6\u7fa4\u7aef\u70b9\u3002\u6839\u636e\u96c6\u7fa4\u7aef\u70b9\u7684\u914d\u7f6e\uff0c\u8282\u70b9\u6d41\u91cf\u5c06\u901a\u8fc7 NAT \u7f51\u5173\u6216 ENI \u8fdb\u5165\u3002</p>"},{"location":"zh/networking/subnets/#_7","title":"\u4ec5\u4f7f\u7528\u79c1\u6709\u5b50\u7f51","text":"<p>\u8282\u70b9\u548c\u5165\u7ad9\u8d44\u6e90\u90fd\u5728\u79c1\u6709\u5b50\u7f51\u4e2d\u521b\u5efa\u3002\u4f7f\u7528<code>kubernetes.io/role/internal-elb</code>\u5b50\u7f51\u6807\u8bb0\u6765\u6784\u5efa\u5185\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u8bbf\u95ee\u60a8\u7684\u96c6\u7fa4\u7aef\u70b9\u9700\u8981 VPN \u8fde\u63a5\u3002\u60a8\u5fc5\u987b\u4e3a EC2 \u548c\u6240\u6709 Amazon ECR \u548c S3 \u5b58\u50a8\u5e93\u542f\u7528 AWS PrivateLink\u3002\u53ea\u5e94\u542f\u7528\u96c6\u7fa4\u7684\u79c1\u6709\u7aef\u70b9\u3002\u6211\u4eec\u5efa\u8bae\u5728\u914d\u7f6e\u79c1\u6709\u96c6\u7fa4\u4e4b\u524d\u5148\u901a\u8bfb EKS \u79c1\u6709\u96c6\u7fa4\u8981\u6c42\u3002</p>"},{"location":"zh/networking/subnets/#vpc_3","title":"\u8de8 VPC \u901a\u4fe1","text":"<p>\u5728\u8bb8\u591a\u573a\u666f\u4e2d\uff0c\u60a8\u9700\u8981\u591a\u4e2a VPC \u548c\u90e8\u7f72\u5728\u8fd9\u4e9b VPC \u4e2d\u7684\u5355\u72ec EKS \u96c6\u7fa4\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 Amazon VPC Lattice \u5728\u591a\u4e2a VPC \u548c\u8d26\u6237\u4e4b\u95f4\u4e00\u81f4\u4e14\u5b89\u5168\u5730\u8fde\u63a5\u670d\u52a1\uff0c\u800c\u65e0\u9700\u7531\u8bf8\u5982 VPC \u5bf9\u7b49\u3001AWS PrivateLink \u6216 AWS Transit Gateway \u4e4b\u7c7b\u7684\u670d\u52a1\u63d0\u4f9b\u989d\u5916\u7684\u8fde\u63a5\u3002\u5728\u6b64\u5904\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002</p> <p></p> <p>Amazon VPC Lattice \u5728 IPv4 \u548c IPv6 \u7684\u94fe\u8def\u672c\u5730\u5730\u5740\u7a7a\u95f4\u4e2d\u8fd0\u884c\uff0c\u4e3a\u53ef\u80fd\u5177\u6709\u91cd\u53e0 IPv4 \u5730\u5740\u7684\u670d\u52a1\u63d0\u4f9b\u8fde\u63a5\u3002\u4e3a\u4e86\u63d0\u9ad8\u8fd0\u8425\u6548\u7387\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u5c06 EKS \u96c6\u7fa4\u548c\u8282\u70b9\u90e8\u7f72\u5230\u4e0d\u91cd\u53e0\u7684 IP \u8303\u56f4\u3002\u5982\u679c\u60a8\u7684\u57fa\u7840\u8bbe\u65bd\u5305\u542b\u5177\u6709\u91cd\u53e0 IP \u8303\u56f4\u7684 VPC\uff0c\u60a8\u9700\u8981\u76f8\u5e94\u5730\u8bbe\u8ba1\u60a8\u7684\u7f51\u7edc\u3002\u6211\u4eec\u5efa\u8bae\u79c1\u6709 NAT \u7f51\u5173\u6216\u81ea\u5b9a\u4e49\u7f51\u7edc\u6a21\u5f0f\u4e0b\u7684 VPC CNI\uff0c\u7ed3\u5408\u4f20\u8f93\u7f51\u5173,\u5c06 EKS \u4e0a\u7684\u5de5\u4f5c\u8d1f\u8f7d\u96c6\u6210\u4ee5\u89e3\u51b3\u91cd\u53e0 CIDR \u7684\u6311\u6218\uff0c\u540c\u65f6\u4fdd\u7559\u53ef\u8def\u7531\u7684 RFC1918 IP \u5730\u5740\u3002</p> <p></p> <p>\u5982\u679c\u60a8\u662f\u670d\u52a1\u63d0\u4f9b\u5546\u5e76\u5e0c\u671b\u4e0e\u53e6\u4e00\u4e2a\u8d26\u6237\u4e2d\u7684\u5ba2\u6237 VPC \u5171\u4eab\u60a8\u7684 Kubernetes \u670d\u52a1\u548c\u5165\u53e3(ALB \u6216 NLB)\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 AWS PrivateLink,\u4e5f\u79f0\u4e3a\u7aef\u70b9\u670d\u52a1\u3002</p>"},{"location":"zh/networking/subnets/#vpc_4","title":"\u8de8\u591a\u4e2a\u8d26\u6237\u5171\u4eab VPC","text":"<p>\u8bb8\u591a\u4f01\u4e1a\u91c7\u7528\u5171\u4eab Amazon VPC \u4f5c\u4e3a\u8de8\u591a\u4e2a AWS \u8d26\u6237\u7b80\u5316\u7f51\u7edc\u7ba1\u7406\u3001\u964d\u4f4e\u6210\u672c\u548c\u63d0\u9ad8\u5b89\u5168\u6027\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u5728 AWS \u7ec4\u7ec7\u4e2d\u3002\u4ed6\u4eec\u5229\u7528 AWS Resource Access Manager (RAM) \u5b89\u5168\u5730\u4e0e\u5355\u4e2a AWS \u8d26\u6237\u3001\u7ec4\u7ec7\u5355\u4f4d (OU) \u6216\u6574\u4e2a AWS \u7ec4\u7ec7\u5171\u4eab\u652f\u6301\u7684 AWS \u8d44\u6e90\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 AWS RAM \u5728\u53e6\u4e00\u4e2a AWS \u8d26\u6237\u4e2d\u7684\u5171\u4eab VPC \u5b50\u7f51\u4e2d\u90e8\u7f72 Amazon EKS \u96c6\u7fa4\u3001\u6258\u7ba1\u8282\u70b9\u7ec4\u548c\u5176\u4ed6\u652f\u6301 AWS \u8d44\u6e90(\u5982\u8d1f\u8f7d\u5747\u8861\u5668\u3001\u5b89\u5168\u7ec4\u3001\u7aef\u70b9\u7b49)\u3002\u4e0b\u56fe\u63cf\u8ff0\u4e86\u4e00\u4e2a\u793a\u4f8b\u9ad8\u7ea7\u67b6\u6784\u3002\u8fd9\u5141\u8bb8\u4e2d\u592e\u7f51\u7edc\u56e2\u961f\u63a7\u5236\u7f51\u7edc\u6784\u9020(\u5982 VPC\u3001\u5b50\u7f51\u7b49)\uff0c\u540c\u65f6\u5141\u8bb8\u5e94\u7528\u7a0b\u5e8f\u6216\u5e73\u53f0\u56e2\u961f\u5728\u5404\u81ea\u7684 AWS \u8d26\u6237\u4e2d\u90e8\u7f72 Amazon EKS \u96c6\u7fa4\u3002\u6b64\u573a\u666f\u7684\u5b8c\u6574\u6f14\u7ec3\u53ef\u5728 github \u5b58\u50a8\u5e93\u4e2d\u627e\u5230\u3002</p> <p></p>"},{"location":"zh/networking/subnets/#_8","title":"\u4f7f\u7528\u5171\u4eab\u5b50\u7f51\u65f6\u7684\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li> <p>Amazon EKS \u96c6\u7fa4\u548c\u5de5\u4f5c\u8282\u70b9\u53ef\u4ee5\u5728\u540c\u4e00 VPC \u7684\u5171\u4eab\u5b50\u7f51\u4e2d\u521b\u5efa\u3002Amazon EKS \u4e0d\u652f\u6301\u8de8\u591a\u4e2a VPC \u521b\u5efa\u96c6\u7fa4\u3002</p> </li> <li> <p>Amazon EKS \u4f7f\u7528 AWS VPC \u5b89\u5168\u7ec4 (SG) \u6765\u63a7\u5236 Kubernetes \u63a7\u5236\u5e73\u9762\u4e0e\u96c6\u7fa4\u5de5\u4f5c\u8282\u70b9\u4e4b\u95f4\u7684\u6d41\u91cf\u3002\u5b89\u5168\u7ec4\u4e5f\u7528\u4e8e\u63a7\u5236\u5de5\u4f5c\u8282\u70b9\u4e0e\u5176\u4ed6 VPC \u8d44\u6e90\u548c\u5916\u90e8 IP \u5730\u5740\u4e4b\u95f4\u7684\u6d41\u91cf\u3002\u60a8\u5fc5\u987b\u5728\u5e94\u7528\u7a0b\u5e8f/\u53c2\u4e0e\u8005\u8d26\u6237\u4e2d\u521b\u5efa\u8fd9\u4e9b\u5b89\u5168\u7ec4\u3002\u786e\u4fdd\u60a8\u6253\u7b97\u4e3a Pod \u4f7f\u7528\u7684\u5b89\u5168\u7ec4\u4e5f\u4f4d\u4e8e\u53c2\u4e0e\u8005\u8d26\u6237\u4e2d\u3002\u60a8\u53ef\u4ee5\u914d\u7f6e\u5b89\u5168\u7ec4\u4e2d\u7684\u5165\u7ad9\u548c\u51fa\u7ad9\u89c4\u5219\uff0c\u4ee5\u5141\u8bb8\u4e0e\u4f4d\u4e8e\u4e2d\u592e VPC \u8d26\u6237\u4e2d\u7684\u5b89\u5168\u7ec4\u4e4b\u95f4\u7684\u5fc5\u8981\u6d41\u91cf\u3002</p> </li> <li> <p>\u5728 Amazon EKS \u96c6\u7fa4\u6240\u5728\u7684\u53c2\u4e0e\u8005\u8d26\u6237\u4e2d\u521b\u5efa IAM \u89d2\u8272\u548c\u5173\u8054\u7684\u7b56\u7565\u3002\u8fd9\u4e9b IAM \u89d2\u8272\u548c\u7b56\u7565\u5bf9\u4e8e\u6388\u4e88 Amazon EKS \u7ba1\u7406\u7684 Kubernetes \u96c6\u7fa4\u3001\u8282\u70b9\u548c\u5728 Fargate \u4e0a\u8fd0\u884c\u7684 Pod \u6240\u9700\u7684\u5fc5\u8981\u6743\u9650\u81f3\u5173\u91cd\u8981\u3002\u8fd9\u4e9b\u6743\u9650\u4f7f Amazon EKS \u80fd\u591f\u4ee3\u8868\u60a8\u8c03\u7528\u5176\u4ed6 AWS \u670d\u52a1\u3002</p> </li> <li> <p>\u60a8\u53ef\u4ee5\u9075\u5faa\u4ee5\u4e0b\u65b9\u6cd5\u4e4b\u4e00\uff0c\u5141\u8bb8 k8s Pod \u8de8\u8d26\u6237\u8bbf\u95ee AWS \u8d44\u6e90(\u5982 Amazon S3 \u5b58\u50a8\u6876\u3001DynamoDB \u8868\u7b49)\uff1a</p> <ul> <li> <p>\u57fa\u4e8e\u8d44\u6e90\u7684\u7b56\u7565\u65b9\u6cd5:\u5982\u679c AWS \u670d\u52a1\u652f\u6301\u8d44\u6e90\u7b56\u7565\uff0c\u60a8\u53ef\u4ee5\u6dfb\u52a0\u9002\u5f53\u7684\u8d44\u6e90\u7b56\u7565\uff0c\u5141\u8bb8\u8de8\u8d26\u6237\u8bbf\u95ee\u5206\u914d\u7ed9 kubernetes Pod \u7684 IAM \u89d2\u8272\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cOIDC \u63d0\u4f9b\u7a0b\u5e8f\u3001IAM \u89d2\u8272\u548c\u6743\u9650\u7b56\u7565\u5b58\u5728\u4e8e\u5e94\u7528\u7a0b\u5e8f\u8d26\u6237\u4e2d\u3002\u8981\u67e5\u627e\u652f\u6301\u8d44\u6e90\u7b56\u7565\u7684 AWS \u670d\u52a1\uff0c\u8bf7\u53c2\u9605 \u4e0e IAM \u534f\u4f5c\u7684 AWS \u670d\u52a1,\u5e76\u67e5\u770b Resource Based \u5217\u4e2d\u6807\u6709 Yes \u7684\u670d\u52a1\u3002</p> </li> <li> <p>OIDC \u63d0\u4f9b\u7a0b\u5e8f\u65b9\u6cd5:OIDC \u63d0\u4f9b\u7a0b\u5e8f\u3001IAM \u89d2\u8272\u3001\u6743\u9650\u548c\u4fe1\u4efb\u7b56\u7565\u7b49 IAM \u8d44\u6e90\u5c06\u5728\u5b58\u5728\u8d44\u6e90\u7684\u5176\u4ed6\u53c2\u4e0e\u8005 AWS \u8d26\u6237\u4e2d\u521b\u5efa\u3002\u8fd9\u4e9b\u89d2\u8272\u5c06\u5206\u914d\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8d26\u6237\u4e2d\u7684 Kubernetes Pod\uff0c\u4ee5\u4fbf\u5b83\u4eec\u53ef\u4ee5\u8bbf\u95ee\u8de8\u8d26\u6237\u8d44\u6e90\u3002\u8bf7\u53c2\u9605Kubernetes \u670d\u52a1\u8d26\u6237\u7684\u8de8\u8d26\u6237 IAM \u89d2\u8272\u535a\u5ba2\uff0c\u4e86\u89e3\u6b64\u65b9\u6cd5\u7684\u5b8c\u6574\u6f14\u7ec3\u3002</p> </li> </ul> </li> <li> <p>\u60a8\u53ef\u4ee5\u5728\u5e94\u7528\u7a0b\u5e8f\u6216\u4e2d\u592e\u7f51\u7edc\u8d26\u6237\u4e2d\u90e8\u7f72 Amazon Elastic Load Balancer (ELB) \u8d44\u6e90 (ALB \u6216 NLB)\uff0c\u4ee5\u8def\u7531\u5230 k8s Pod \u7684\u6d41\u91cf\u3002\u8bf7\u53c2\u9605\u901a\u8fc7\u8de8\u8d26\u6237\u8d1f\u8f7d\u5747\u8861\u5668\u516c\u5f00 Amazon EKS Pod \u6f14\u7ec3\uff0c\u4e86\u89e3\u5728\u4e2d\u592e\u7f51\u7edc\u8d26\u6237\u4e2d\u90e8\u7f72 ELB \u8d44\u6e90\u7684\u8be6\u7ec6\u8bf4\u660e\u3002\u6b64\u9009\u9879\u63d0\u4f9b\u4e86\u589e\u5f3a\u7684\u7075\u6d3b\u6027\uff0c\u56e0\u4e3a\u5b83\u4f7f\u4e2d\u592e\u7f51\u7edc\u8d26\u6237\u80fd\u591f\u5b8c\u5168\u63a7\u5236\u8d1f\u8f7d\u5747\u8861\u5668\u8d44\u6e90\u7684\u5b89\u5168\u914d\u7f6e\u3002</p> </li> <li> <p>\u4f7f\u7528 Amazon VPC CNI \u7684<code>\u81ea\u5b9a\u4e49\u7f51\u7edc\u529f\u80fd</code>\u65f6\uff0c\u60a8\u9700\u8981\u4f7f\u7528\u4e2d\u592e\u7f51\u7edc\u8d26\u6237\u4e2d\u5217\u51fa\u7684\u53ef\u7528\u533a (AZ) ID \u6620\u5c04\u6765\u521b\u5efa\u6bcf\u4e2a <code>ENIConfig</code>\u3002\u8fd9\u662f\u56e0\u4e3a\u6bcf\u4e2a AWS \u8d26\u6237\u4e2d\u7269\u7406 AZ \u4e0e AZ \u540d\u79f0\u7684\u6620\u5c04\u662f\u968f\u673a\u7684\u3002</p> </li> </ul>"},{"location":"zh/networking/subnets/#_9","title":"\u5b89\u5168\u7ec4","text":"<p>\u5b89\u5168\u7ec4\u63a7\u5236\u5141\u8bb8\u5230\u8fbe\u548c\u79bb\u5f00\u4e0e\u4e4b\u5173\u8054\u7684\u8d44\u6e90\u7684\u6d41\u91cf\u3002Amazon EKS \u4f7f\u7528\u5b89\u5168\u7ec4\u6765\u7ba1\u7406\u63a7\u5236\u5e73\u9762\u548c\u8282\u70b9\u4e4b\u95f4\u7684\u901a\u4fe1\u3002\u521b\u5efa\u96c6\u7fa4\u65f6\uff0cAmazon EKS \u4f1a\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <code>eks-cluster-sg-my-cluster-uniqueID</code> \u7684\u5b89\u5168\u7ec4\u3002EKS \u5c06\u8fd9\u4e9b\u5b89\u5168\u7ec4\u5173\u8054\u5230\u6258\u7ba1\u7684 ENI \u548c\u8282\u70b9\u3002\u9ed8\u8ba4\u89c4\u5219\u5141\u8bb8\u60a8\u7684\u96c6\u7fa4\u548c\u8282\u70b9\u4e4b\u95f4\u7684\u6240\u6709\u6d41\u91cf\u81ea\u7531\u6d41\u52a8\uff0c\u5e76\u5141\u8bb8\u6240\u6709\u51fa\u7ad9\u6d41\u91cf\u5230\u8fbe\u4efb\u4f55\u76ee\u7684\u5730\u3002</p> <p>\u521b\u5efa\u96c6\u7fa4\u65f6\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u81ea\u5df1\u7684\u5b89\u5168\u7ec4\u3002\u5728\u6307\u5b9a\u81ea\u5df1\u7684\u5b89\u5168\u7ec4\u65f6\uff0c\u8bf7\u53c2\u9605\u5b89\u5168\u7ec4\u5efa\u8bae\u3002</p>"},{"location":"zh/networking/subnets/#_10","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/subnets/#_11","title":"\u8003\u8651\u591a\u53ef\u7528\u533a\u90e8\u7f72","text":"<p>AWS \u533a\u57df\u63d0\u4f9b\u591a\u4e2a\u7269\u7406\u9694\u79bb\u7684\u53ef\u7528\u533a (AZ)\uff0c\u8fd9\u4e9b\u53ef\u7528\u533a\u901a\u8fc7\u4f4e\u5ef6\u8fdf\u3001\u9ad8\u541e\u5410\u91cf\u548c\u9ad8\u5ea6\u5197\u4f59\u7684\u7f51\u7edc\u8fde\u63a5\u3002\u901a\u8fc7\u53ef\u7528\u533a\uff0c\u60a8\u53ef\u4ee5\u8bbe\u8ba1\u548c\u8fd0\u884c\u80fd\u591f\u5728\u53ef\u7528\u533a\u4e4b\u95f4\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u800c\u4e0d\u4e2d\u65ad\u7684\u5e94\u7528\u7a0b\u5e8f\u3002Amazon EKS \u5f3a\u70c8\u5efa\u8bae\u5c06 EKS \u96c6\u7fa4\u90e8\u7f72\u5230\u591a\u4e2a\u53ef\u7528\u533a\u3002\u5728\u521b\u5efa\u96c6\u7fa4\u65f6\uff0c\u8bf7\u8003\u8651\u6307\u5b9a\u81f3\u5c11\u4e24\u4e2a\u53ef\u7528\u533a\u7684\u5b50\u7f51\u3002</p> <p>\u8fd0\u884c\u5728\u8282\u70b9\u4e0a\u7684 Kubelet \u4f1a\u81ea\u52a8\u5c06\u6807\u7b7e(\u5982 <code>topology.kubernetes.io/region=us-west-2</code> \u548c <code>topology.kubernetes.io/zone=us-west-2d</code>)\u6dfb\u52a0\u5230\u8282\u70b9\u5bf9\u8c61\u3002\u6211\u4eec\u5efa\u8bae\u7ed3\u5408\u4f7f\u7528\u8282\u70b9\u6807\u7b7e\u548cPod \u62d3\u6251\u5206\u5e03\u7ea6\u675f,\u4ee5\u63a7\u5236 Pod \u5728\u533a\u57df\u4e4b\u95f4\u7684\u5206\u5e03\u65b9\u5f0f\u3002\u8fd9\u4e9b\u63d0\u793a\u4f7f Kubernetes \u8c03\u5ea6\u5668\u80fd\u591f\u66f4\u597d\u5730\u653e\u7f6e Pod\uff0c\u4ee5\u63d0\u9ad8\u9884\u671f\u53ef\u7528\u6027\uff0c\u964d\u4f4e\u76f8\u5173\u6545\u969c\u5f71\u54cd\u6574\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u98ce\u9669\u3002\u8bf7\u53c2\u9605\u5c06\u8282\u70b9\u5206\u914d\u7ed9 Pod,\u4e86\u89e3\u8282\u70b9\u9009\u62e9\u5668\u548c AZ \u5206\u5e03\u7ea6\u675f\u7684\u793a\u4f8b\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728\u521b\u5efa\u8282\u70b9\u65f6\u5b9a\u4e49\u5b50\u7f51\u6216\u53ef\u7528\u533a\u3002\u5982\u679c\u672a\u914d\u7f6e\u5b50\u7f51\uff0c\u8282\u70b9\u5c06\u653e\u7f6e\u5728\u96c6\u7fa4\u5b50\u7f51\u4e2d\u3002EKS \u5bf9\u6258\u7ba1\u8282\u70b9\u7ec4\u7684\u652f\u6301\u4f1a\u81ea\u52a8\u5c06\u8282\u70b9\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u5206\u5e03\u5728\u53ef\u7528\u5bb9\u91cf\u4e0a\u3002Karpenter \u5c06\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u5b9a\u4e49\u7684\u62d3\u6251\u5206\u5e03\u9650\u5236\uff0c\u5728\u6307\u5b9a\u7684 AZ \u4e2d\u6269\u5c55\u8282\u70b9\u3002</p> <p>AWS Elastic Load Balancer \u7531 Kubernetes \u96c6\u7fa4\u7684 AWS Load Balancer Controller \u7ba1\u7406\u3002\u5b83\u4e3a Kubernetes \u5165\u53e3\u8d44\u6e90\u914d\u7f6e\u5e94\u7528\u7a0b\u5e8f\u8d1f\u8f7d\u5747\u8861\u5668 (ALB)\uff0c\u4e3a\u7c7b\u578b\u4e3a LoadBalancer \u7684 Kubernetes \u670d\u52a1\u914d\u7f6e\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668 (NLB)\u3002Elastic Load Balancer \u63a7\u5236\u5668\u4f7f\u7528\u6807\u7b7e\u6765\u53d1\u73b0\u5b50\u7f51\u3002ELB \u63a7\u5236\u5668\u9700\u8981\u81f3\u5c11\u4e24\u4e2a\u53ef\u7528\u533a (AZ) \u624d\u80fd\u6210\u529f\u914d\u7f6e\u5165\u53e3\u8d44\u6e90\u3002\u8bf7\u8003\u8651\u5728\u81f3\u5c11\u4e24\u4e2a AZ \u4e2d\u8bbe\u7f6e\u5b50\u7f51\uff0c\u4ee5\u5229\u7528\u5730\u7406\u5197\u4f59\u5e26\u6765\u7684\u5b89\u5168\u6027\u548c\u53ef\u9760\u6027\u3002</p>"},{"location":"zh/networking/subnets/#_12","title":"\u5c06\u8282\u70b9\u90e8\u7f72\u5230\u79c1\u6709\u5b50\u7f51","text":"<p>\u5305\u542b\u516c\u5171\u548c\u79c1\u6709\u5b50\u7f51\u7684 VPC \u662f\u90e8\u7f72 Kubernetes \u5de5\u4f5c\u8d1f\u8f7d\u5230 EKS \u7684\u7406\u60f3\u65b9\u6cd5\u3002\u8bf7\u8003\u8651\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u53ef\u7528\u533a\u4e2d\u8bbe\u7f6e\u81f3\u5c11\u4e24\u4e2a\u516c\u5171\u5b50\u7f51\u548c\u4e24\u4e2a\u79c1\u6709\u5b50\u7f51\u3002\u516c\u5171\u5b50\u7f51\u7684\u76f8\u5173\u8def\u7531\u8868\u5305\u542b\u4e00\u6761\u5230\u4e92\u8054\u7f51\u7f51\u5173\u7684\u8def\u7531\u3002Pod \u53ef\u4ee5\u901a\u8fc7 NAT \u7f51\u5173\u4e0e\u4e92\u8054\u7f51\u4ea4\u4e92\u3002\u5728 IPv6 \u73af\u5883\u4e2d\uff0c\u4ec5\u51fa\u7ad9\u4e92\u8054\u7f51\u7f51\u5173 (EIGW) \u652f\u6301\u79c1\u6709\u5b50\u7f51\u3002</p> <p>\u5c06\u8282\u70b9\u5b9e\u4f8b\u5316\u5230\u79c1\u6709\u5b50\u7f51\u63d0\u4f9b\u4e86\u5bf9\u8282\u70b9\u6d41\u91cf\u7684\u6700\u5927\u63a7\u5236\uff0c\u5e76\u9002\u7528\u4e8e\u7edd\u5927\u591a\u6570 Kubernetes \u5e94\u7528\u7a0b\u5e8f\u3002\u5165\u7ad9\u8d44\u6e90(\u5982\u8d1f\u8f7d\u5747\u8861\u5668)\u5728\u516c\u5171\u5b50\u7f51\u4e2d\u5b9e\u4f8b\u5316\uff0c\u5e76\u5c06\u6d41\u91cf\u8def\u7531\u5230\u8fd0\u884c\u5728\u79c1\u6709\u5b50\u7f51\u4e0a\u7684 Pod\u3002</p> <p>\u5982\u679c\u60a8\u9700\u8981\u4e25\u683c\u7684\u5b89\u5168\u6027\u548c\u7f51\u7edc\u9694\u79bb\uff0c\u8bf7\u8003\u8651\u4ec5\u79c1\u6709\u6a21\u5f0f\u3002\u5728\u6b64\u914d\u7f6e\u4e2d\uff0c\u5728 AWS \u533a\u57df\u7684 VPC \u4e2d\u7684\u4e09\u4e2a\u4e0d\u540c\u53ef\u7528\u533a\u5185\u90e8\u7f72\u4e09\u4e2a\u79c1\u6709\u5b50\u7f51\u3002\u90e8\u7f72\u5230\u5b50\u7f51\u4e2d\u7684\u8d44\u6e90\u65e0\u6cd5\u8bbf\u95ee\u4e92\u8054\u7f51\uff0c\u4e92\u8054\u7f51\u4e5f\u65e0\u6cd5\u8bbf\u95ee\u5b50\u7f51\u4e2d\u7684\u8d44\u6e90\u3002\u4e3a\u4e86\u8ba9\u60a8\u7684 Kubernetes \u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u5176\u4ed6 AWS \u670d\u52a1\uff0c\u60a8\u5fc5\u987b\u914d\u7f6e PrivateLink \u63a5\u53e3\u548c/\u6216\u7f51\u5173\u7aef\u70b9\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 AWS Load Balancer Controller \u8bbe\u7f6e\u5185\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5c06\u6d41\u91cf\u91cd\u5b9a\u5411\u5230 Pod\u3002\u79c1\u6709\u5b50\u7f51\u5fc5\u987b\u6807\u8bb0(<code>kubernetes.io/role/internal-elb: 1</code>),\u4ee5\u4fbf\u63a7\u5236\u5668\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u4e3a\u4e86\u8ba9\u8282\u70b9\u5411\u96c6\u7fa4\u6ce8\u518c\uff0c\u96c6\u7fa4\u7aef\u70b9\u5fc5\u987b\u8bbe\u7f6e\u4e3a\u79c1\u6709\u6a21\u5f0f\u3002\u8bf7\u8bbf\u95ee\u79c1\u6709\u96c6\u7fa4\u6307\u5357\u4e86\u89e3\u5b8c\u6574\u7684\u8981\u6c42\u548c\u6ce8\u610f\u4e8b\u9879\u3002</p>"},{"location":"zh/networking/subnets/#_13","title":"\u8003\u8651\u4e3a\u96c6\u7fa4\u7aef\u70b9\u914d\u7f6e\u516c\u5171\u548c\u79c1\u6709\u6a21\u5f0f","text":"<p>Amazon EKS \u63d0\u4f9b\u516c\u5171\u6a21\u5f0f\u3001\u516c\u5171\u548c\u79c1\u6709\u6a21\u5f0f\u4ee5\u53ca\u4ec5\u79c1\u6709\u6a21\u5f0f\u7684\u96c6\u7fa4\u7aef\u70b9\u3002\u9ed8\u8ba4\u6a21\u5f0f\u662f\u516c\u5171\u6a21\u5f0f\uff0c\u4f46\u6211\u4eec\u5efa\u8bae\u5c06\u96c6\u7fa4\u7aef\u70b9\u914d\u7f6e\u4e3a\u516c\u5171\u548c\u79c1\u6709\u6a21\u5f0f\u3002\u6b64\u9009\u9879\u5141\u8bb8\u60a8\u96c6\u7fa4 VPC \u5185\u90e8\u7684 Kubernetes API \u8c03\u7528(\u5982\u8282\u70b9\u5230\u63a7\u5236\u5e73\u9762\u7684\u901a\u4fe1)\u4f7f\u7528\u79c1\u6709 VPC \u7aef\u70b9\uff0c\u5e76\u4e14\u6d41\u91cf\u4fdd\u6301\u5728\u60a8\u96c6\u7fa4\u7684 VPC \u5185\u3002\u540c\u65f6\uff0c\u60a8\u7684\u96c6\u7fa4 API \u670d\u52a1\u5668\u53ef\u4ee5\u4ece\u4e92\u8054\u7f51\u8bbf\u95ee\u3002\u4f46\u662f\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u9650\u5236\u53ef\u4ee5\u4f7f\u7528\u516c\u5171\u7aef\u70b9\u7684 CIDR \u5757\u3002\u4e86\u89e3\u5982\u4f55\u914d\u7f6e\u516c\u5171\u548c\u79c1\u6709\u7aef\u70b9\u8bbf\u95ee\uff0c\u5305\u62ec\u9650\u5236 CIDR \u5757\u3002</p> <p>\u5f53\u60a8\u9700\u8981\u5b89\u5168\u6027\u548c\u7f51\u7edc\u9694\u79bb\u65f6\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u79c1\u6709\u7aef\u70b9\u3002\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 EKS \u7528\u6237\u6307\u5357\u4e2d\u5217\u51fa\u7684\u4efb\u4e00\u9009\u9879\u79c1\u4e0b\u8fde\u63a5\u5230 API \u670d\u52a1\u5668\u3002</p>"},{"location":"zh/networking/subnets/#_14","title":"\u4ed4\u7ec6\u914d\u7f6e\u5b89\u5168\u7ec4","text":"<p>Amazon EKS \u652f\u6301\u4f7f\u7528\u81ea\u5b9a\u4e49\u5b89\u5168\u7ec4\u3002\u4efb\u4f55\u81ea\u5b9a\u4e49\u5b89\u5168\u7ec4\u90fd\u5fc5\u987b\u5141\u8bb8\u8282\u70b9\u4e0e Kubernetes \u63a7\u5236\u5e73\u9762\u4e4b\u95f4\u7684\u901a\u4fe1\u3002\u8bf7\u68c0\u67e5\u7aef\u53e3\u8981\u6c42,\u5982\u679c\u60a8\u7684\u7ec4\u7ec7\u4e0d\u5141\u8bb8\u5f00\u653e\u901a\u4fe1\uff0c\u8bf7\u624b\u52a8\u914d\u7f6e\u89c4\u5219\u3002</p> <p>EKS \u5c06\u60a8\u5728\u96c6\u7fa4\u521b\u5efa\u671f\u95f4\u63d0\u4f9b\u7684\u81ea\u5b9a\u4e49\u5b89\u5168\u7ec4\u5e94\u7528\u4e8e\u6258\u7ba1\u63a5\u53e3 (X-ENI)\u3002\u4f46\u662f\uff0c\u5b83\u4e0d\u4f1a\u7acb\u5373\u5c06\u5b83\u4eec\u4e0e\u8282\u70b9\u5173\u8054\u3002\u5728\u521b\u5efa\u8282\u70b9\u7ec4\u65f6\uff0c\u5f3a\u70c8\u5efa\u8bae\u624b\u52a8\u5173\u8054\u81ea\u5b9a\u4e49\u5b89\u5168\u7ec4\u3002\u8bf7\u8003\u8651\u542f\u7528 securityGroupSelectorTerms,\u4ee5\u5141\u8bb8 Karpenter \u8282\u70b9\u6a21\u677f\u5728\u81ea\u52a8\u6269\u5c55\u8282\u70b9\u671f\u95f4\u53d1\u73b0\u81ea\u5b9a\u4e49\u5b89\u5168\u7ec4\u3002</p> <p>\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u521b\u5efa\u4e00\u4e2a\u5b89\u5168\u7ec4\uff0c\u4ee5\u5141\u8bb8\u6240\u6709\u8282\u70b9\u95f4\u901a\u4fe1\u6d41\u91cf\u3002\u5728\u5f15\u5bfc\u8fc7\u7a0b\u4e2d\uff0c\u8282\u70b9\u9700\u8981\u51fa\u7ad9\u4e92\u8054\u7f51\u8fde\u63a5\u624d\u80fd\u8bbf\u95ee\u96c6\u7fa4\u7aef\u70b9\u3002\u8bc4\u4f30\u51fa\u7ad9\u8bbf\u95ee\u8981\u6c42\uff0c\u5982\u672c\u5730\u8fde\u63a5\u548c\u5bb9\u5668\u6ce8\u518c\u8868\u8bbf\u95ee\uff0c\u5e76\u76f8\u5e94\u5730\u8bbe\u7f6e\u89c4\u5219\u3002\u5728\u6295\u5165\u751f\u4ea7\u4e4b\u524d\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u4ed4\u7ec6\u68c0\u67e5\u8fde\u63a5\u3002</p>"},{"location":"zh/networking/subnets/#nat","title":"\u5728\u6bcf\u4e2a\u53ef\u7528\u533a\u90e8\u7f72 NAT \u7f51\u5173","text":"<p>\u5982\u679c\u60a8\u5728\u79c1\u6709\u5b50\u7f51(IPv4 \u548c IPv6)\u4e2d\u90e8\u7f72\u8282\u70b9\uff0c\u8bf7\u8003\u8651\u5728\u6bcf\u4e2a\u53ef\u7528\u533a (AZ) \u521b\u5efa\u4e00\u4e2a NAT \u7f51\u5173\uff0c\u4ee5\u786e\u4fdd\u533a\u57df\u72ec\u7acb\u7684\u67b6\u6784\u5e76\u51cf\u5c11\u8de8 AZ \u652f\u51fa\u3002\u6bcf\u4e2a AZ \u4e2d\u7684 NAT \u7f51\u5173\u90fd\u5177\u6709\u5197\u4f59\u5b9e\u73b0\u3002</p>"},{"location":"zh/networking/subnets/#cloud9","title":"\u4f7f\u7528 Cloud9 \u8bbf\u95ee\u79c1\u6709\u96c6\u7fa4","text":"<p>AWS Cloud9 \u662f\u4e00\u4e2a\u53ef\u4ee5\u5728\u79c1\u6709\u5b50\u7f51\u4e2d\u5b89\u5168\u8fd0\u884c\u7684\u57fa\u4e8e Web \u7684 IDE\uff0c\u65e0\u9700\u5165\u7ad9\u8bbf\u95ee\uff0c\u4f7f\u7528 AWS Systems Manager\u3002\u4e5f\u53ef\u4ee5\u7981\u7528 Cloud9 \u5b9e\u4f8b\u7684\u51fa\u7ad9\u3002\u4e86\u89e3\u5982\u4f55\u4f7f\u7528 Cloud9 \u8bbf\u95ee\u79c1\u6709\u96c6\u7fa4\u548c\u5b50\u7f51\u3002</p> <p></p>"},{"location":"zh/networking/vpc-cni/","title":"Amazon VPC CNI","text":"<p>Amazon EKS \u901a\u8fc7 Amazon VPC \u5bb9\u5668\u7f51\u7edc\u63a5\u53e3(VPC CNI) \u63d2\u4ef6\u5b9e\u73b0\u96c6\u7fa4\u7f51\u7edc\u3002CNI \u63d2\u4ef6\u5141\u8bb8 Kubernetes Pod \u5728 VPC \u7f51\u7edc\u4e0a\u62e5\u6709\u76f8\u540c\u7684 IP \u5730\u5740\u3002\u66f4\u5177\u4f53\u5730\u8bf4\uff0cPod \u5185\u7684\u6240\u6709\u5bb9\u5668\u5171\u4eab\u4e00\u4e2a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff0c\u5b83\u4eec\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u7aef\u53e3\u76f8\u4e92\u901a\u4fe1\u3002</p> <p>Amazon VPC CNI \u6709\u4e24\u4e2a\u7ec4\u4ef6\uff1a</p> <ul> <li>CNI \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u7528\u4e8e\u8bbe\u7f6e Pod \u7f51\u7edc\u4ee5\u542f\u7528 Pod \u5230 Pod \u7684\u901a\u4fe1\u3002CNI \u4e8c\u8fdb\u5236\u6587\u4ef6\u8fd0\u884c\u5728\u8282\u70b9\u6839\u6587\u4ef6\u7cfb\u7edf\u4e0a\uff0c\u5e76\u7531 kubelet \u5728\u8282\u70b9\u4e0a\u6dfb\u52a0\u6216\u5220\u9664\u65b0 Pod \u65f6\u8c03\u7528\u3002</li> <li>ipamd,\u4e00\u4e2a\u957f\u671f\u8fd0\u884c\u7684\u8282\u70b9\u672c\u5730 IP \u5730\u5740\u7ba1\u7406(IPAM)\u5b88\u62a4\u8fdb\u7a0b\uff0c\u8d1f\u8d23\uff1a</li> <li>\u7ba1\u7406\u8282\u70b9\u4e0a\u7684 ENI\uff0c\u4ee5\u53ca</li> <li>\u7ef4\u62a4\u53ef\u7528 IP \u5730\u5740\u6216\u524d\u7f00\u7684\u70ed\u6c60</li> </ul> <p>\u5f53\u521b\u5efa\u5b9e\u4f8b\u65f6\uff0cEC2 \u4f1a\u521b\u5efa\u5e76\u9644\u52a0\u4e0e\u4e3b\u5b50\u7f51\u5173\u8054\u7684\u4e3b ENI\u3002\u4e3b\u5b50\u7f51\u53ef\u4ee5\u662f\u516c\u5171\u7684\u6216\u79c1\u6709\u7684\u3002\u5728 hostNetwork \u6a21\u5f0f\u4e0b\u8fd0\u884c\u7684 Pod \u4f7f\u7528\u5206\u914d\u7ed9\u8282\u70b9\u4e3b ENI \u7684\u4e3b IP \u5730\u5740\uff0c\u5e76\u4e0e\u4e3b\u673a\u5171\u4eab\u76f8\u540c\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u3002</p> <p>CNI \u63d2\u4ef6\u7ba1\u7406\u8282\u70b9\u4e0a\u7684\u5f39\u6027\u7f51\u7edc\u63a5\u53e3(ENI)\u3002\u5f53\u8282\u70b9\u88ab\u4f9b\u5e94\u65f6\uff0cCNI \u63d2\u4ef6\u4f1a\u81ea\u52a8\u4ece\u8282\u70b9\u7684\u5b50\u7f51\u4e2d\u4e3a\u4e3b ENI \u5206\u914d\u4e00\u4e2a\u63d2\u69fd\u6c60(IP \u6216\u524d\u7f00)\u3002\u8fd9\u4e2a\u6c60\u88ab\u79f0\u4e3a\u70ed\u6c60,\u5176\u5927\u5c0f\u7531\u8282\u70b9\u7684\u5b9e\u4f8b\u7c7b\u578b\u51b3\u5b9a\u3002\u6839\u636e CNI \u8bbe\u7f6e\uff0c\u4e00\u4e2a\u63d2\u69fd\u53ef\u4ee5\u662f IP \u5730\u5740\u6216\u524d\u7f00\u3002\u5f53 ENI \u4e0a\u7684\u4e00\u4e2a\u63d2\u69fd\u88ab\u5206\u914d\u540e\uff0cCNI \u53ef\u80fd\u4f1a\u5c06\u5e26\u6709\u70ed\u63d2\u69fd\u6c60\u7684\u5176\u4ed6 ENI \u9644\u52a0\u5230\u8282\u70b9\u4e0a\u3002\u8fd9\u4e9b\u989d\u5916\u7684 ENI \u88ab\u79f0\u4e3a\u8f85\u52a9 ENI\u3002\u6bcf\u4e2a ENI \u53ea\u80fd\u652f\u6301\u4e00\u5b9a\u6570\u91cf\u7684\u63d2\u69fd\uff0c\u8fd9\u53d6\u51b3\u4e8e\u5b9e\u4f8b\u7c7b\u578b\u3002CNI \u6839\u636e\u6240\u9700\u7684\u63d2\u69fd\u6570\u91cf(\u901a\u5e38\u5bf9\u5e94\u4e8e Pod \u6570\u91cf)\u5c06\u66f4\u591a\u7684 ENI \u9644\u52a0\u5230\u5b9e\u4f8b\u4e0a\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u76f4\u6301\u7eed\u5230\u8282\u70b9\u65e0\u6cd5\u652f\u6301\u989d\u5916\u7684 ENI \u4e3a\u6b62\u3002CNI \u8fd8\u4f1a\u9884\u5148\u5206\u914d\"\u70ed\"ENI \u548c\u63d2\u69fd\uff0c\u4ee5\u52a0\u5feb Pod \u542f\u52a8\u901f\u5ea6\u3002\u8bf7\u6ce8\u610f\uff0c\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u90fd\u6709\u53ef\u4ee5\u9644\u52a0\u7684\u6700\u5927 ENI \u6570\u91cf\u3002\u8fd9\u662f Pod \u5bc6\u5ea6(\u6bcf\u4e2a\u8282\u70b9\u7684 Pod \u6570\u91cf)\u7684\u4e00\u4e2a\u7ea6\u675f\uff0c\u9664\u4e86\u8ba1\u7b97\u8d44\u6e90\u4e4b\u5916\u3002</p> <p></p> <p>\u53ef\u4ee5\u4f7f\u7528\u7684\u6700\u5927\u7f51\u7edc\u63a5\u53e3\u6570\u548c\u6700\u5927\u63d2\u69fd\u6570\u56e0 EC2 \u5b9e\u4f8b\u7c7b\u578b\u800c\u5f02\u3002\u7531\u4e8e\u6bcf\u4e2a Pod \u90fd\u4f1a\u6d88\u8017\u4e00\u4e2a\u63d2\u69fd\u4e0a\u7684 IP \u5730\u5740\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u7279\u5b9a EC2 \u5b9e\u4f8b\u4e0a\u8fd0\u884c\u7684 Pod \u6570\u91cf\u53d6\u51b3\u4e8e\u53ef\u4ee5\u9644\u52a0\u5230\u5b83\u7684 ENI \u6570\u91cf\u4ee5\u53ca\u6bcf\u4e2a ENI \u652f\u6301\u7684 IP \u5730\u5740\u6570\u91cf\u3002\u6211\u4eec\u5efa\u8bae\u6309\u7167 EKS \u7528\u6237\u6307\u5357\u8bbe\u7f6e\u6bcf\u4e2a\u8282\u70b9\u7684\u6700\u5927 Pod \u6570\uff0c\u4ee5\u907f\u514d\u8017\u5c3d\u5b9e\u4f8b\u7684 CPU \u548c\u5185\u5b58\u8d44\u6e90\u3002\u4f7f\u7528 <code>hostNetwork</code> \u7684 Pod \u4e0d\u5305\u62ec\u5728\u6b64\u8ba1\u7b97\u4e2d\u3002\u60a8\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u4e00\u4e2a\u540d\u4e3a max-pod-calculator.sh \u7684\u811a\u672c\u6765\u8ba1\u7b97 EKS \u4e3a\u7ed9\u5b9a\u5b9e\u4f8b\u7c7b\u578b\u63a8\u8350\u7684\u6700\u5927 Pod \u6570\u3002</p>"},{"location":"zh/networking/vpc-cni/#_1","title":"\u6982\u8ff0","text":"<p>\u8f85\u52a9 IP \u6a21\u5f0f\u662f VPC CNI \u7684\u9ed8\u8ba4\u6a21\u5f0f\u3002\u672c\u6307\u5357\u63d0\u4f9b\u4e86\u5728\u542f\u7528\u8f85\u52a9 IP \u6a21\u5f0f\u65f6 VPC CNI \u884c\u4e3a\u7684\u901a\u7528\u6982\u8ff0\u3002ipamd(IP \u5730\u5740\u5206\u914d)\u7684\u529f\u80fd\u53ef\u80fd\u4f1a\u56e0 VPC CNI \u7684\u914d\u7f6e\u8bbe\u7f6e\u800c\u6709\u6240\u4e0d\u540c\uff0c\u4f8b\u5982 \u524d\u7f00\u6a21\u5f0f\u3001\u6bcf\u4e2a Pod \u7684\u5b89\u5168\u7ec4\u548c\u81ea\u5b9a\u4e49\u7f51\u7edc\u3002</p> <p>Amazon VPC CNI \u4f5c\u4e3a\u540d\u4e3a aws-node \u7684 Kubernetes Daemonset \u90e8\u7f72\u5728\u5de5\u4f5c\u8282\u70b9\u4e0a\u3002\u5f53\u4f9b\u5e94\u5de5\u4f5c\u8282\u70b9\u65f6\uff0c\u5b83\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684 ENI \u9644\u52a0\u5230\u5b83\u4e0a\u9762\uff0c\u79f0\u4e3a\u4e3b ENI\u3002CNI \u4ece\u9644\u52a0\u5230\u8282\u70b9\u4e3b ENI \u7684\u5b50\u7f51\u4e2d\u5206\u914d\u4e00\u4e2a\u70ed ENI \u6c60\u548c\u8f85\u52a9 IP \u5730\u5740\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cipamd \u4f1a\u5c1d\u8bd5\u4e3a\u8282\u70b9\u5206\u914d\u4e00\u4e2a\u989d\u5916\u7684 ENI\u3002\u5f53\u8c03\u5ea6\u5e76\u4e3a\u4e3b ENI \u5206\u914d\u4e00\u4e2a\u8f85\u52a9 IP \u5730\u5740\u7684\u5355\u4e2a Pod \u65f6\uff0cIPAMD \u4f1a\u5206\u914d\u989d\u5916\u7684 ENI\u3002\u8fd9\u4e2a\"\u70ed\"ENI \u53ef\u4ee5\u5b9e\u73b0\u66f4\u5feb\u7684 Pod \u7f51\u7edc\u3002\u968f\u7740\u8f85\u52a9 IP \u5730\u5740\u6c60\u8017\u5c3d\uff0cCNI \u4f1a\u6dfb\u52a0\u53e6\u4e00\u4e2a ENI \u4ee5\u5206\u914d\u66f4\u591a\u5730\u5740\u3002</p> <p>ENI \u548c\u6c60\u4e2d IP \u5730\u5740\u7684\u6570\u91cf\u901a\u8fc7\u540d\u4e3a WARM_ENI_TARGET\u3001WARM_IP_TARGET\u3001MINIMUM_IP_TARGET \u7684\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\u3002<code>aws-node</code> Daemonset \u4f1a\u5b9a\u671f\u68c0\u67e5\u662f\u5426\u9644\u52a0\u4e86\u8db3\u591f\u6570\u91cf\u7684 ENI\u3002\u5f53\u6ee1\u8db3\u6240\u6709 <code>WARM_ENI_TARGET</code> \u6216 <code>WARM_IP_TARGET</code> \u548c <code>MINIMUM_IP_TARGET</code> \u6761\u4ef6\u65f6\uff0c\u5c31\u8868\u793a\u9644\u52a0\u4e86\u8db3\u591f\u6570\u91cf\u7684 ENI\u3002\u5982\u679c\u9644\u52a0\u7684 ENI \u6570\u91cf\u4e0d\u8db3\uff0cCNI \u5c06\u5411 EC2 \u53d1\u51fa API \u8c03\u7528\u4ee5\u9644\u52a0\u66f4\u591a ENI\uff0c\u76f4\u5230\u8fbe\u5230 <code>MAX_ENI</code> \u9650\u5236\u4e3a\u6b62\u3002</p> <ul> <li><code>WARM_ENI_TARGET</code> - \u6574\u6570\uff0c\u503c&gt;0\u8868\u793a\u9700\u6c42\u5df2\u542f\u7528</li> <li>\u8981\u7ef4\u62a4\u7684\u70ed ENI \u6570\u91cf\u3002\u5f53 ENI \u4f5c\u4e3a\u8f85\u52a9 ENI \u9644\u52a0\u5230\u8282\u70b9\u4f46\u672a\u88ab\u4efb\u4f55 Pod \u4f7f\u7528\u65f6\uff0c\u5b83\u5c31\u662f\"\u70ed\"\u7684\u3002\u66f4\u5177\u4f53\u5730\u8bf4\uff0cENI \u7684 IP \u5730\u5740\u90fd\u6ca1\u6709\u4e0e\u4efb\u4f55 Pod \u5173\u8054\u3002</li> <li>\u793a\u4f8b\uff1a\u8003\u8651\u4e00\u4e2a\u5b9e\u4f8b\u6709 2 \u4e2a ENI\uff0c\u6bcf\u4e2a ENI \u652f\u6301 5 \u4e2a IP \u5730\u5740\u3002WARM_ENI_TARGET \u8bbe\u7f6e\u4e3a 1\u3002\u5982\u679c\u6b63\u597d\u6709 5 \u4e2a IP \u5730\u5740\u4e0e\u5b9e\u4f8b\u5173\u8054\uff0cCNI \u4f1a\u4e3a\u5b9e\u4f8b\u7ef4\u62a4 2 \u4e2a\u9644\u52a0\u7684 ENI\u3002\u7b2c\u4e00\u4e2a ENI \u6b63\u5728\u4f7f\u7528\u4e2d\uff0c\u5b83\u7684\u6240\u6709 5 \u4e2a\u53ef\u80fd\u7684 IP \u5730\u5740\u90fd\u5728\u4f7f\u7528\u3002\u7b2c\u4e8c\u4e2a ENI \u662f\"\u70ed\"\u7684\uff0c\u6709 5 \u4e2a IP \u5730\u5740\u5728\u6c60\u4e2d\u3002\u5982\u679c\u5728\u5b9e\u4f8b\u4e0a\u542f\u52a8\u53e6\u4e00\u4e2a Pod\uff0c\u5c31\u9700\u8981\u7b2c 6 \u4e2a IP \u5730\u5740\u3002CNI \u5c06\u4ece\u7b2c\u4e8c\u4e2a ENI \u7684\u6c60\u4e2d\u7684 5 \u4e2a IP \u5730\u5740\u4e2d\u4e3a\u8fd9\u7b2c 6 \u4e2a Pod \u5206\u914d\u4e00\u4e2a IP \u5730\u5740\u3002\u7b2c\u4e8c\u4e2a ENI \u73b0\u5728\u6b63\u5728\u4f7f\u7528\u4e2d\uff0c\u4e0d\u518d\u5904\u4e8e\"\u70ed\"\u72b6\u6001\u3002CNI \u5c06\u5206\u914d\u7b2c 3 \u4e2a ENI \u4ee5\u7ef4\u62a4\u81f3\u5c11 1 \u4e2a\u70ed ENI\u3002</li> </ul> <p>\u6ce8\u610f</p> <p>\u70ed ENI \u4ecd\u7136\u4f1a\u4ece VPC \u7684 CIDR \u4e2d\u6d88\u8017 IP \u5730\u5740\u3002IP \u5730\u5740\u5728\u4e0e\u5de5\u4f5c\u8d1f\u8f7d(\u5982 Pod)\u5173\u8054\u4e4b\u524d\u662f\"\u672a\u4f7f\u7528\"\u6216\"\u70ed\"\u7684\u3002</p> <ul> <li><code>WARM_IP_TARGET</code>,\u6574\u6570\uff0c\u503c&gt;0\u8868\u793a\u9700\u6c42\u5df2\u542f\u7528</li> <li>\u8981\u7ef4\u62a4\u7684\u70ed IP \u5730\u5740\u6570\u91cf\u3002\u70ed IP \u662f\u5728\u6d3b\u52a8\u9644\u52a0\u7684 ENI \u4e0a\u53ef\u7528\uff0c\u4f46\u5c1a\u672a\u5206\u914d\u7ed9 Pod\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u53ef\u7528\u7684\u70ed IP \u6570\u91cf\u5c31\u662f\u53ef\u4ee5\u5206\u914d\u7ed9 Pod \u800c\u4e0d\u9700\u8981\u989d\u5916 ENI \u7684 IP \u6570\u91cf\u3002</li> <li>\u793a\u4f8b\uff1a\u8003\u8651\u4e00\u4e2a\u5b9e\u4f8b\u6709 1 \u4e2a ENI\uff0c\u6bcf\u4e2a ENI \u652f\u6301 20 \u4e2a IP \u5730\u5740\u3002WARM_IP_TARGET \u8bbe\u7f6e\u4e3a 5\u3002WARM_ENI_TARGET \u8bbe\u7f6e\u4e3a 0\u3002\u53ea\u6709\u5728\u9700\u8981\u7b2c 16 \u4e2a IP \u5730\u5740\u65f6\uff0cCNI \u624d\u4f1a\u9644\u52a0\u7b2c\u4e8c\u4e2a ENI\uff0c\u4ece\u5b50\u7f51 CIDR \u4e2d\u6d88\u8017 20 \u4e2a\u53ef\u80fd\u7684\u5730\u5740\u3002</li> <li><code>MINIMUM_IP_TARGET</code>,\u6574\u6570\uff0c\u503c&gt;0\u8868\u793a\u9700\u6c42\u5df2\u542f\u7528</li> <li>\u4efb\u4f55\u65f6\u5019\u90fd\u8981\u5206\u914d\u7684\u6700\u5c0f IP \u5730\u5740\u6570\u91cf\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u5728\u5b9e\u4f8b\u542f\u52a8\u65f6\u9884\u5148\u5206\u914d\u591a\u4e2a ENI\u3002</li> <li>\u793a\u4f8b\uff1a\u8003\u8651\u4e00\u4e2a\u65b0\u542f\u52a8\u7684\u5b9e\u4f8b\u3002\u5b83\u6709 1 \u4e2a ENI\uff0c\u6bcf\u4e2a ENI \u652f\u6301 10 \u4e2a IP \u5730\u5740\u3002MINIMUM_IP_TARGET \u8bbe\u7f6e\u4e3a 100\u3002ENI \u4f1a\u7acb\u5373\u9644\u52a0 9 \u4e2a\u66f4\u591a\u7684 ENI\uff0c\u603b\u5171 100 \u4e2a\u5730\u5740\u3002\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u65f6\uff0c\u4e0d\u8003\u8651\u4efb\u4f55 WARM_IP_TARGET \u6216 WARM_ENI_TARGET \u503c\u3002</li> </ul> <p>\u672c\u9879\u76ee\u5305\u62ec\u4e00\u4e2a \u5b50\u7f51\u8ba1\u7b97\u5668 Excel \u6587\u6863\u3002\u8be5\u8ba1\u7b97\u5668\u6587\u6863\u6a21\u62df\u4e86\u5728\u4e0d\u540c ENI \u914d\u7f6e\u9009\u9879(\u5982 <code>WARM_IP_TARGET</code> \u548c <code>WARM_ENI_TARGET</code>)\u4e0b\u6307\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u7684 IP \u5730\u5740\u6d88\u8017\u60c5\u51b5\u3002</p> <p></p> <p>\u5f53 Kubelet \u6536\u5230\u6dfb\u52a0 Pod \u8bf7\u6c42\u65f6\uff0cCNI \u4e8c\u8fdb\u5236\u6587\u4ef6\u4f1a\u5411 ipamd \u67e5\u8be2\u53ef\u7528\u7684 IP \u5730\u5740\uff0cipamd \u968f\u540e\u4f1a\u5c06\u5176\u63d0\u4f9b\u7ed9 Pod\u3002CNI \u4e8c\u8fdb\u5236\u6587\u4ef6\u8fde\u63a5\u4e3b\u673a\u548c Pod \u7f51\u7edc\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u90e8\u7f72\u5728\u8282\u70b9\u4e0a\u7684 Pod \u4f1a\u88ab\u5206\u914d\u5230\u4e0e\u4e3b ENI \u76f8\u540c\u7684\u5b89\u5168\u7ec4\u3002\u6216\u8005\uff0c\u4e5f\u53ef\u4ee5\u4e3a Pod \u914d\u7f6e\u4e0d\u540c\u7684\u5b89\u5168\u7ec4\u3002</p> <p></p> <p>\u968f\u7740 IP \u5730\u5740\u6c60\u7684\u8017\u5c3d\uff0c\u63d2\u4ef6\u4f1a\u81ea\u52a8\u5c06\u53e6\u4e00\u4e2a\u5f39\u6027\u7f51\u7edc\u63a5\u53e3\u9644\u52a0\u5230\u5b9e\u4f8b\u4e0a\uff0c\u5e76\u4e3a\u8be5\u63a5\u53e3\u5206\u914d\u53e6\u4e00\u7ec4\u8f85\u52a9 IP \u5730\u5740\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u76f4\u6301\u7eed\u5230\u8282\u70b9\u65e0\u6cd5\u518d\u652f\u6301\u989d\u5916\u7684\u5f39\u6027\u7f51\u7edc\u63a5\u53e3\u4e3a\u6b62\u3002</p> <p></p> <p>\u5f53\u5220\u9664 Pod \u65f6\uff0cVPC CNI \u4f1a\u5c06 Pod \u7684 IP \u5730\u5740\u653e\u5165 30 \u79d2\u7684\u51b7\u5374\u7f13\u5b58\u4e2d\u3002\u51b7\u5374\u7f13\u5b58\u4e2d\u7684 IP \u4e0d\u4f1a\u88ab\u5206\u914d\u7ed9\u65b0\u7684 Pod\u3002\u51b7\u5374\u671f\u7ed3\u675f\u540e\uff0cVPC CNI \u4f1a\u5c06 Pod IP \u79fb\u56de\u70ed\u6c60\u3002\u51b7\u5374\u671f\u53ef\u9632\u6b62 Pod IP \u5730\u5740\u8fc7\u65e9\u88ab\u56de\u6536\uff0c\u5e76\u5141\u8bb8\u6240\u6709\u96c6\u7fa4\u8282\u70b9\u4e0a\u7684 kube-proxy \u5b8c\u6210\u66f4\u65b0 iptables \u89c4\u5219\u3002\u5f53 IP \u6216 ENI \u7684\u6570\u91cf\u8d85\u8fc7\u70ed\u6c60\u8bbe\u7f6e\u7684\u6570\u91cf\u65f6\uff0cipamd \u63d2\u4ef6\u4f1a\u5c06 IP \u548c ENI \u8fd4\u56de\u7ed9 VPC\u3002</p> <p>\u5982\u4e0a\u6240\u8ff0\uff0c\u5728\u8f85\u52a9 IP \u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e2a Pod \u90fd\u4f1a\u4ece\u9644\u52a0\u5230\u5b9e\u4f8b\u7684 ENI \u4e4b\u4e00\u83b7\u5f97\u4e00\u4e2a\u8f85\u52a9\u79c1\u6709 IP \u5730\u5740\u3002\u7531\u4e8e\u6bcf\u4e2a Pod \u90fd\u4f7f\u7528\u4e00\u4e2a IP \u5730\u5740\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u7279\u5b9a EC2 \u5b9e\u4f8b\u4e0a\u8fd0\u884c\u7684 Pod \u6570\u91cf\u53d6\u51b3\u4e8e\u53ef\u4ee5\u9644\u52a0\u5230\u5b83\u7684 ENI \u6570\u91cf\u4ee5\u53ca\u5b83\u652f\u6301\u7684 IP \u5730\u5740\u6570\u91cf\u3002VPC CNI \u4f1a\u68c0\u67e5 limits \u6587\u4ef6\uff0c\u4ee5\u627e\u51fa\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u5141\u8bb8\u7684 ENI \u548c IP \u5730\u5740\u6570\u91cf\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u516c\u5f0f\u6765\u786e\u5b9a\u53ef\u4ee5\u5728\u8282\u70b9\u4e0a\u90e8\u7f72\u7684\u6700\u5927 Pod \u6570\u91cf\u3002</p> <p><code>(\u5b9e\u4f8b\u7c7b\u578b\u7684\u7f51\u7edc\u63a5\u53e3\u6570\u91cf \u00d7 (\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684 IP \u5730\u5740\u6570\u91cf - 1)) + 2</code></p> <p>+2 \u8868\u793a\u9700\u8981\u4e3b\u673a\u7f51\u7edc\u7684 Pod\uff0c\u5982 kube-proxy \u548c VPC CNI\u3002Amazon EKS \u8981\u6c42\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c kube-proxy \u548c VPC CNI\uff0c\u5e76\u5c06\u8fd9\u4e9b\u8981\u6c42\u8ba1\u7b97\u5728\u6700\u5927 Pod \u503c\u4e2d\u3002\u5982\u679c\u60a8\u60f3\u8fd0\u884c\u66f4\u591a\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u7684 Pod\uff0c\u8bf7\u8003\u8651\u66f4\u65b0\u6700\u5927 Pod \u503c\u3002</p> <p>+2 \u8868\u793a\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u7684 Kubernetes Pod\uff0c\u5982 kube-proxy \u548c VPC CNI\u3002Amazon EKS \u8981\u6c42\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c kube-proxy \u548c VPC CNI\uff0c\u5e76\u5c06\u5b83\u4eec\u8ba1\u7b97\u5728\u6700\u5927 Pod \u503c\u4e2d\u3002\u5982\u679c\u60a8\u8ba1\u5212\u8fd0\u884c\u66f4\u591a\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u7684 Pod\uff0c\u8bf7\u8003\u8651\u66f4\u65b0\u6700\u5927 Pod \u503c\u3002\u60a8\u53ef\u4ee5\u5728\u542f\u52a8\u6a21\u677f\u7684\u7528\u6237\u6570\u636e\u4e2d\u6307\u5b9a <code>--kubelet-extra-args \"\u2014max-pods=110\"</code>\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u4e00\u4e2a\u6709 3 \u4e2a c5.large \u8282\u70b9(3 \u4e2a ENI \u548c\u6bcf\u4e2a ENI \u6700\u591a 10 \u4e2a IP)\u7684\u96c6\u7fa4\u4e2d\uff0c\u5f53\u96c6\u7fa4\u542f\u52a8\u5e76\u6709 2 \u4e2a CoreDNS Pod \u65f6\uff0cCNI \u5c06\u6d88\u8017 49 \u4e2a IP \u5730\u5740\u5e76\u5c06\u5b83\u4eec\u4fdd\u7559\u5728\u70ed\u6c60\u4e2d\u3002\u70ed\u6c60\u53ef\u4ee5\u5b9e\u73b0\u66f4\u5feb\u7684 Pod \u542f\u52a8\uff0c\u5f53\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u65f6\u3002</p> <p>\u8282\u70b9 1(\u5e26 CoreDNS Pod)\uff1a2 \u4e2a ENI\uff0c\u5206\u914d 20 \u4e2a IP</p> <p>\u8282\u70b9 2(\u5e26 CoreDNS Pod)\uff1a2 \u4e2a ENI\uff0c\u5206\u914d 20 \u4e2a IP</p> <p>\u8282\u70b9 3(\u65e0 Pod)\uff1a1 \u4e2a ENI\uff0c\u5206\u914d 10 \u4e2a IP</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u901a\u5e38\u4f5c\u4e3a DaemonSet \u8fd0\u884c\u7684\u57fa\u7840\u8bbe\u65bd Pod\uff0c\u6bcf\u4e2a\u90fd\u4f1a\u5360\u7528\u6700\u5927 Pod \u6570\u91cf\u3002\u8fd9\u4e9b\u53ef\u80fd\u5305\u62ec\uff1a</p> <ul> <li>CoreDNS</li> <li>Amazon \u5f39\u6027\u8d1f\u8f7d\u5747\u8861\u5668</li> <li>\u7528\u4e8e\u6307\u6807\u670d\u52a1\u5668\u7684\u64cd\u4f5c Pod</li> </ul> <p>\u6211\u4eec\u5efa\u8bae\u60a8\u901a\u8fc7\u7ec4\u5408\u8fd9\u4e9b Pod \u7684\u5bb9\u91cf\u6765\u89c4\u5212\u57fa\u7840\u8bbe\u65bd\u3002\u6709\u5173\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u652f\u6301\u7684\u6700\u5927 Pod \u6570\u91cf\u7684\u5217\u8868\uff0c\u8bf7\u53c2\u9605 GitHub \u4e0a\u7684 eni-max-Pods.txt\u3002</p> <p></p>"},{"location":"zh/networking/vpc-cni/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/networking/vpc-cni/#vpc-cni","title":"\u90e8\u7f72 VPC CNI \u6258\u7ba1\u63d2\u4ef6","text":"<p>\u5f53\u60a8\u4f9b\u5e94\u96c6\u7fa4\u65f6\uff0cAmazon EKS \u4f1a\u81ea\u52a8\u5b89\u88c5 VPC CNI\u3002\u4e0d\u8fc7\uff0cAmazon EKS \u652f\u6301\u6258\u7ba1\u63d2\u4ef6\uff0c\u4f7f\u96c6\u7fa4\u80fd\u591f\u4e0e\u5e95\u5c42 AWS \u8d44\u6e90(\u5982\u8ba1\u7b97\u3001\u5b58\u50a8\u548c\u7f51\u7edc)\u8fdb\u884c\u4ea4\u4e92\u3002\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u4f7f\u7528\u6258\u7ba1\u63d2\u4ef6(\u5305\u62ec VPC CNI)\u90e8\u7f72\u96c6\u7fa4\u3002</p> <p>Amazon EKS \u6258\u7ba1\u63d2\u4ef6\u4e3a Amazon EKS \u96c6\u7fa4\u63d0\u4f9b VPC CNI \u5b89\u88c5\u548c\u7ba1\u7406\u3002Amazon EKS \u63d2\u4ef6\u5305\u62ec\u6700\u65b0\u7684\u5b89\u5168\u8865\u4e01\u3001\u9519\u8bef\u4fee\u590d\uff0c\u5e76\u7ecf AWS \u9a8c\u8bc1\u53ef\u4e0e Amazon EKS \u4e00\u8d77\u4f7f\u7528\u3002VPC CNI \u63d2\u4ef6\u4f7f\u60a8\u80fd\u591f\u6301\u7eed\u786e\u4fdd Amazon EKS \u96c6\u7fa4\u7684\u5b89\u5168\u6027\u548c\u7a33\u5b9a\u6027\uff0c\u5e76\u51cf\u5c11\u5b89\u88c5\u3001\u914d\u7f6e\u548c\u66f4\u65b0\u63d2\u4ef6\u6240\u9700\u7684\u5de5\u4f5c\u91cf\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u901a\u8fc7 Amazon EKS API\u3001AWS \u7ba1\u7406\u63a7\u5236\u53f0\u3001AWS CLI \u548c eksctl \u6dfb\u52a0\u3001\u66f4\u65b0\u6216\u5220\u9664\u6258\u7ba1\u63d2\u4ef6\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>kubectl get</code> \u547d\u4ee4\u7684 <code>--show-managed-fields</code> \u6807\u5fd7\u67e5\u627e VPC CNI \u7684\u6258\u7ba1\u5b57\u6bb5\u3002</p> <pre><code>kubectl get daemonset aws-node --show-managed-fields -n kube-system -o yaml\n</code></pre> <p>\u6258\u7ba1\u63d2\u4ef6\u53ef\u4ee5\u9632\u6b62\u914d\u7f6e\u504f\u79fb\uff0c\u6bcf 15 \u5206\u949f\u81ea\u52a8\u8986\u76d6\u4e00\u6b21\u914d\u7f6e\u3002\u8fd9\u610f\u5473\u7740\u5728\u521b\u5efa\u63d2\u4ef6\u540e\u901a\u8fc7 Kubernetes API \u5bf9\u6258\u7ba1\u63d2\u4ef6\u6240\u505a\u7684\u4efb\u4f55\u66f4\u6539\u90fd\u5c06\u88ab\u81ea\u52a8\u8986\u76d6\uff0c\u5e76\u5728\u66f4\u65b0\u63d2\u4ef6\u65f6\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c\u3002</p> <p>\u7531 EKS \u7ba1\u7406\u7684\u5b57\u6bb5\u5217\u5728 managedFields \u4e0b\uff0cmanager \u4e3a EKS\u3002\u7531 EKS \u7ba1\u7406\u7684\u5b57\u6bb5\u5305\u62ec\u670d\u52a1\u8d26\u6237\u3001\u955c\u50cf\u3001\u955c\u50cf URL\u3001\u6d3b\u8dc3\u63a2\u9488\u3001\u5c31\u7eea\u63a2\u9488\u3001\u6807\u7b7e\u3001\u5377\u548c\u5377\u6302\u8f7d\u3002</p> <p>\u4fe1\u606f</p> <p>\u6700\u5e38\u7528\u7684\u5b57\u6bb5\uff0c\u5982 WARM_ENI_TARGET\u3001WARM_IP_TARGET \u548c MINIMUM_IP_TARGET \u90fd\u4e0d\u53d7\u7ba1\u7406\uff0c\u5728\u66f4\u65b0\u63d2\u4ef6\u65f6\u4e0d\u4f1a\u88ab\u91cd\u65b0\u534f\u8c03\u3002\u5bf9\u8fd9\u4e9b\u5b57\u6bb5\u7684\u66f4\u6539\u5c06\u5728\u66f4\u65b0\u63d2\u4ef6\u65f6\u5f97\u5230\u4fdd\u7559\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u60a8\u5728\u751f\u4ea7\u96c6\u7fa4\u4e4b\u524d\uff0c\u5148\u5728\u975e\u751f\u4ea7\u96c6\u7fa4\u4e2d\u6d4b\u8bd5\u7279\u5b9a\u914d\u7f6e\u7684\u63d2\u4ef6\u884c\u4e3a\u3002\u6b64\u5916\uff0c\u8bf7\u6309\u7167 EKS \u7528\u6237\u6307\u5357\u4e2d\u7684\u6b65\u9aa4\u8fdb\u884c\u63d2\u4ef6\u914d\u7f6e\u3002</p>"},{"location":"zh/networking/vpc-cni/#_3","title":"\u8fc1\u79fb\u5230\u6258\u7ba1\u63d2\u4ef6","text":"<p>\u60a8\u9700\u8981\u81ea\u884c\u7ba1\u7406\u81ea\u7ba1\u7406 VPC CNI \u7684\u7248\u672c\u517c\u5bb9\u6027\u548c\u5b89\u5168\u8865\u4e01\u66f4\u65b0\u3002\u8981\u66f4\u65b0\u81ea\u7ba1\u7406\u63d2\u4ef6\uff0c\u60a8\u5fc5\u987b\u4f7f\u7528 Kubernetes API \u548c EKS \u7528\u6237\u6307\u5357\u4e2d\u6982\u8ff0\u7684\u8bf4\u660e\u3002\u6211\u4eec\u5efa\u8bae\u5c06\u73b0\u6709 EKS \u96c6\u7fa4\u8fc1\u79fb\u5230\u6258\u7ba1\u63d2\u4ef6\uff0c\u5e76\u5f3a\u70c8\u5efa\u8bae\u5728\u8fc1\u79fb\u4e4b\u524d\u5907\u4efd\u5f53\u524d\u7684 CNI \u8bbe\u7f6e\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Amazon EKS API\u3001AWS \u7ba1\u7406\u63a7\u5236\u53f0\u6216 AWS \u547d\u4ee4\u884c\u754c\u9762\u6765\u914d\u7f6e\u6258\u7ba1\u63d2\u4ef6\u3002</p> <pre><code>kubectl apply view-last-applied daemonset aws-node -n kube-system &gt; aws-k8s-cni-old.yaml\n</code></pre> <p>\u5982\u679c\u67d0\u4e2a\u5b57\u6bb5\u88ab\u5217\u4e3a\u6258\u7ba1\u5b57\u6bb5\uff0cAmazon EKS \u5c06\u7528\u9ed8\u8ba4\u8bbe\u7f6e\u66ff\u6362 CNI \u914d\u7f6e\u8bbe\u7f6e\u3002\u6211\u4eec\u5efa\u8bae\u4e0d\u8981\u4fee\u6539\u6258\u7ba1\u5b57\u6bb5\u3002\u63d2\u4ef6\u4e0d\u4f1a\u91cd\u65b0\u534f\u8c03\u8bf8\u5982 warm \u73af\u5883\u53d8\u91cf\u548c CNI \u6a21\u5f0f\u4e4b\u7c7b\u7684\u914d\u7f6e\u5b57\u6bb5\u3002Pod \u548c\u5e94\u7528\u7a0b\u5e8f\u5728\u60a8\u8fc1\u79fb\u5230\u6258\u7ba1 CNI \u65f6\u5c06\u7ee7\u7eed\u8fd0\u884c\u3002</p>"},{"location":"zh/networking/vpc-cni/#cni","title":"\u5728\u66f4\u65b0\u4e4b\u524d\u5907\u4efd CNI \u8bbe\u7f6e","text":"<p>VPC CNI \u8fd0\u884c\u5728\u5ba2\u6237\u6570\u636e\u5e73\u9762(\u8282\u70b9)\u4e0a\uff0c\u56e0\u6b64 Amazon EKS \u4e0d\u4f1a\u5728\u53d1\u5e03\u65b0\u7248\u672c\u6216\u66f4\u65b0\u96c6\u7fa4\u5230\u65b0\u7684 Kubernetes \u6b21\u8981\u7248\u672c\u540e\u81ea\u52a8\u66f4\u65b0\u63d2\u4ef6(\u6258\u7ba1\u548c\u81ea\u7ba1\u7406)\u3002\u8981\u4e3a\u73b0\u6709\u96c6\u7fa4\u66f4\u65b0\u63d2\u4ef6\uff0c\u60a8\u5fc5\u987b\u901a\u8fc7 update-addon API \u6216\u5728 EKS \u63a7\u5236\u53f0\u4e2d\u5355\u51fb\"\u7acb\u5373\u66f4\u65b0\"\u94fe\u63a5\u6765\u89e6\u53d1\u66f4\u65b0\u3002\u5982\u679c\u60a8\u90e8\u7f72\u4e86\u81ea\u7ba1\u7406\u63d2\u4ef6\uff0c\u8bf7\u6309\u7167\u66f4\u65b0\u81ea\u7ba1\u7406 VPC CNI \u63d2\u4ef6\u4e2d\u7684\u6b65\u9aa4\u64cd\u4f5c\u3002</p> <p>\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u4e00\u6b21\u53ea\u66f4\u65b0\u4e00\u4e2a\u6b21\u8981\u7248\u672c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5f53\u524d\u7684\u6b21\u8981\u7248\u672c\u662f <code>1.9</code>,\u800c\u60a8\u60f3\u8981\u66f4\u65b0\u5230 <code>1.11</code>,\u60a8\u5e94\u8be5\u5148\u66f4\u65b0\u5230 <code>1.10</code> \u7684\u6700\u65b0\u8865\u4e01\u7248\u672c\uff0c\u7136\u540e\u518d\u66f4\u65b0\u5230 <code>1.11</code> \u7684\u6700\u65b0\u8865\u4e01\u7248\u672c\u3002</p> <p>\u5728\u66f4\u65b0 Amazon VPC CNI \u4e4b\u524d\uff0c\u8bf7\u68c0\u67e5 aws-node Daemonset\u3002\u5907\u4efd\u73b0\u6709\u8bbe\u7f6e\u3002\u5982\u679c\u4f7f\u7528\u6258\u7ba1\u63d2\u4ef6\uff0c\u8bf7\u786e\u8ba4\u60a8\u6ca1\u6709\u66f4\u65b0\u4efb\u4f55 Amazon EKS \u53ef\u80fd\u4f1a\u8986\u76d6\u7684\u8bbe\u7f6e\u3002\u6211\u4eec\u5efa\u8bae\u5728\u60a8\u7684\u81ea\u52a8\u5316\u5de5\u4f5c\u6d41\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u66f4\u65b0\u540e\u7684\u94a9\u5b50\uff0c\u6216\u8005\u5728\u63d2\u4ef6\u66f4\u65b0\u540e\u624b\u52a8\u5e94\u7528\u3002</p> <pre><code>kubectl apply view-last-applied daemonset aws-node -n kube-system &gt; aws-k8s-cni-old.yaml\n</code></pre> <p>\u5bf9\u4e8e\u81ea\u7ba1\u7406\u63d2\u4ef6\uff0c\u8bf7\u5c06\u5907\u4efd\u4e0e GitHub \u4e0a\u7684 <code>releases</code> \u8fdb\u884c\u6bd4\u8f83\uff0c\u67e5\u770b\u53ef\u7528\u7248\u672c\u5e76\u719f\u6089\u60a8\u8981\u66f4\u65b0\u5230\u7684\u7248\u672c\u4e2d\u7684\u66f4\u6539\u3002\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 Helm \u6765\u7ba1\u7406\u81ea\u7ba1\u7406\u63d2\u4ef6\uff0c\u5e76\u5229\u7528\u503c\u6587\u4ef6\u6765\u5e94\u7528\u8bbe\u7f6e\u3002\u4efb\u4f55\u6d89\u53ca Daemonset \u5220\u9664\u7684\u66f4\u65b0\u64cd\u4f5c\u90fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u7a0b\u5e8f\u505c\u673a\uff0c\u5fc5\u987b\u907f\u514d\u3002</p>"},{"location":"zh/networking/vpc-cni/#_4","title":"\u4e86\u89e3\u5b89\u5168\u4e0a\u4e0b\u6587","text":"<p>\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u4e86\u89e3\u4e3a\u6709\u6548\u7ba1\u7406 VPC CNI \u800c\u914d\u7f6e\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u3002Amazon VPC CNI \u6709\u4e24\u4e2a\u7ec4\u4ef6\uff1aCNI \u4e8c\u8fdb\u5236\u6587\u4ef6\u548c ipamd (aws-node) Daemonset\u3002CNI \u4f5c\u4e3a\u4e8c\u8fdb\u5236\u6587\u4ef6\u8fd0\u884c\u5728\u8282\u70b9\u4e0a\uff0c\u53ef\u4ee5\u8bbf\u95ee\u8282\u70b9\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u5177\u6709\u7279\u6743\u8bbf\u95ee\u6743\u9650\uff0c\u56e0\u4e3a\u5b83\u5904\u7406\u8282\u70b9\u7ea7\u522b\u7684 iptables\u3002\u5f53 Pod \u88ab\u6dfb\u52a0\u6216\u5220\u9664\u65f6\uff0ckubelet \u4f1a\u8c03\u7528 CNI \u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p> <p>aws-node Daemonset \u662f\u4e00\u4e2a\u957f\u671f\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u8d1f\u8d23\u8282\u70b9\u7ea7\u522b\u7684 IP \u5730\u5740\u7ba1\u7406\u3002aws-node \u5728 <code>hostNetwork</code> \u6a21\u5f0f\u4e0b\u8fd0\u884c\uff0c\u5141\u8bb8\u8bbf\u95ee\u56de\u73af\u8bbe\u5907\u548c\u540c\u4e00\u8282\u70b9\u4e0a\u5176\u4ed6 Pod \u7684\u7f51\u7edc\u6d3b\u52a8\u3002aws-node init \u5bb9\u5668\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\u5e76\u6302\u8f7d CRI \u5957\u63a5\u5b57\uff0c\u5141\u8bb8 Daemonset \u76d1\u63a7\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 Pod \u7684 IP \u4f7f\u7528\u60c5\u51b5\u3002Amazon EKS \u6b63\u5728\u52aa\u529b\u6d88\u9664 aws-node init \u5bb9\u5668\u7684\u7279\u6743\u8981\u6c42\u3002\u6b64\u5916\uff0caws-node \u9700\u8981\u66f4\u65b0 NAT \u6761\u76ee\u5e76\u52a0\u8f7d iptables \u6a21\u5757\uff0c\u56e0\u6b64\u4ee5 NET_ADMIN \u6743\u9650\u8fd0\u884c\u3002</p> <p>Amazon EKS \u5efa\u8bae\u90e8\u7f72 aws-node \u6e05\u5355\u4e2d\u5b9a\u4e49\u7684\u5b89\u5168\u7b56\u7565\uff0c\u7528\u4e8e Pod \u7684 IP \u7ba1\u7406\u548c\u7f51\u7edc\u8bbe\u7f6e\u3002\u8bf7\u8003\u8651\u66f4\u65b0\u5230\u6700\u65b0\u7248\u672c\u7684 VPC CNI\u3002\u6b64\u5916\uff0c\u5982\u679c\u60a8\u6709\u7279\u5b9a\u7684\u5b89\u5168\u8981\u6c42\uff0c\u8bf7\u8003\u8651\u5728 GitHub \u95ee\u9898\u4e2d\u63d0\u51fa\u3002</p>"},{"location":"zh/networking/vpc-cni/#cni-iam","title":"\u4e3a CNI \u4f7f\u7528\u5355\u72ec\u7684 IAM \u89d2\u8272","text":"<p>AWS VPC CNI \u9700\u8981 AWS Identity and Access Management (IAM) \u6743\u9650\u3002\u5728\u53ef\u4ee5\u4f7f\u7528 IAM \u89d2\u8272\u4e4b\u524d\uff0c\u9700\u8981\u8bbe\u7f6e CNI \u7b56\u7565\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>AmazonEKS_CNI_Policy</code>,\u8fd9\u662f\u4e00\u4e2a\u9002\u7528\u4e8e IPv4 \u96c6\u7fa4\u7684 AWS \u6258\u7ba1\u7b56\u7565\u3002AmazonEKS CNI \u6258\u7ba1\u7b56\u7565\u53ea\u6709 IPv4 \u96c6\u7fa4\u7684\u6743\u9650\u3002\u5bf9\u4e8e IPv6 \u96c6\u7fa4\uff0c\u60a8\u5fc5\u987b\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684 IAM \u7b56\u7565\uff0c\u5176\u4e2d\u5305\u542b\u6b64\u5904\u5217\u51fa\u7684\u6743\u9650\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cVPC CNI \u7ee7\u627f Amazon EKS \u8282\u70b9 IAM \u89d2\u8272(\u5305\u62ec\u6258\u7ba1\u548c\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4)\u3002</p> <p>\u5f3a\u70c8\u5efa\u8bae\u4e3a Amazon VPC CNI \u914d\u7f6e\u4e00\u4e2a\u5355\u72ec\u7684 IAM \u89d2\u8272\uff0c\u5e76\u9644\u52a0\u76f8\u5173\u7b56\u7565\u3002\u5426\u5219\uff0cAmazon VPC CNI \u7684 Pod \u5c06\u83b7\u5f97\u5206\u914d\u7ed9\u8282\u70b9\u7684\u5b9e\u4f8b\u914d\u7f6e\u6587\u4ef6\u7684\u6743\u9650\u3002</p> <p>VPC CNI \u63d2\u4ef6\u521b\u5efa\u5e76\u914d\u7f6e\u4e86\u4e00\u4e2a\u540d\u4e3a aws-node \u7684\u670d\u52a1\u8d26\u6237\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u670d\u52a1\u8d26\u6237\u7ed1\u5b9a\u5230\u9644\u52a0\u4e86 Amazon EKS CNI \u7b56\u7565\u7684 Amazon EKS \u8282\u70b9 IAM \u89d2\u8272\u3002\u8981\u4f7f\u7528\u5355\u72ec\u7684 IAM \u89d2\u8272\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u670d\u52a1\u8d26\u6237,\u5e76\u9644\u52a0 Amazon EKS CNI \u7b56\u7565\u3002\u8981\u4f7f\u7528\u65b0\u7684\u670d\u52a1\u8d26\u6237\uff0c\u60a8\u5fc5\u987b\u91cd\u65b0\u90e8\u7f72 CNI Pod\u3002\u5728\u521b\u5efa\u65b0\u96c6\u7fa4\u65f6\uff0c\u8bf7\u8003\u8651\u4e3a VPC CNI \u6258\u7ba1\u63d2\u4ef6\u6307\u5b9a <code>--service-account-role-arn</code>\u3002\u8bf7\u786e\u4fdd\u4ece Amazon EKS \u8282\u70b9\u89d2\u8272\u4e2d\u5220\u9664 Amazon EKS CNI \u7b56\u7565(\u5305\u62ec IPv4 \u548c IPv6)\u3002</p> <p>\u5efa\u8bae\u60a8\u963b\u6b62\u8bbf\u95ee\u5b9e\u4f8b\u5143\u6570\u636e,\u4ee5\u6700\u5c0f\u5316\u5b89\u5168\u6f0f\u6d1e\u7684\u5f71\u54cd\u8303\u56f4\u3002</p>"},{"location":"zh/networking/vpc-cni/#_5","title":"\u5904\u7406\u6d3b\u8dc3/\u5c31\u7eea\u63a2\u9488\u6545\u969c","text":"<p>\u6211\u4eec\u5efa\u8bae\u4e3a EKS 1.20 \u53ca\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa4\u589e\u52a0\u6d3b\u8dc3\u548c\u5c31\u7eea\u63a2\u9488\u8d85\u65f6\u503c(\u9ed8\u8ba4 <code>timeoutSeconds: 10</code>),\u4ee5\u9632\u6b62\u63a2\u9488\u6545\u969c\u5bfc\u81f4\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684 Pod \u9677\u5165 containerCreating \u72b6\u6001\u3002\u8fd9\u4e2a\u95ee\u9898\u5728\u6570\u636e\u5bc6\u96c6\u578b\u548c\u6279\u5904\u7406\u96c6\u7fa4\u4e2d\u5df2\u7ecf\u51fa\u73b0\u3002\u9ad8 CPU \u4f7f\u7528\u4f1a\u5bfc\u81f4 aws-node \u63a2\u9488\u5065\u5eb7\u72b6\u51b5\u5931\u8d25\uff0c\u8fdb\u800c\u5bfc\u81f4\u672a\u6ee1\u8db3 Pod CPU \u8bf7\u6c42\u3002\u6b64\u5916\uff0c\u8bf7\u786e\u4fdd\u4e3a aws-node \u6b63\u786e\u914d\u7f6e\u4e86 CPU \u8d44\u6e90\u8bf7\u6c42(\u9ed8\u8ba4 <code>CPU: 25m</code>)\u3002\u9664\u975e\u60a8\u7684\u8282\u70b9\u51fa\u73b0\u95ee\u9898\uff0c\u5426\u5219\u6211\u4eec\u4e0d\u5efa\u8bae\u66f4\u65b0\u8fd9\u4e9b\u8bbe\u7f6e\u3002</p> <p>\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5728\u8282\u70b9\u4e0a\u8fd0\u884c <code>sudo bash /opt/cni/bin/aws-cni-support.sh</code>,\u540c\u65f6\u4e0e Amazon EKS \u652f\u6301\u90e8\u95e8\u8054\u7cfb\u3002\u8be5\u811a\u672c\u5c06\u5e2e\u52a9\u8bc4\u4f30 kubelet \u65e5\u5fd7\u548c\u8282\u70b9\u4e0a\u7684\u5185\u5b58\u5229\u7528\u7387\u3002\u8bf7\u8003\u8651\u5728 Amazon EKS \u5de5\u4f5c\u8282\u70b9\u4e0a\u5b89\u88c5 SSM Agent \u4ee5\u8fd0\u884c\u8be5\u811a\u672c\u3002</p>"},{"location":"zh/networking/vpc-cni/#eks-ami-iptables","title":"\u5728\u975e EKS \u4f18\u5316 AMI \u5b9e\u4f8b\u4e0a\u914d\u7f6e IPTables \u8f6c\u53d1\u7b56\u7565","text":"<p>\u5982\u679c\u60a8\u4f7f\u7528\u81ea\u5b9a\u4e49 AMI\uff0c\u8bf7\u786e\u4fdd\u5728 kubelet.service \u4e0b\u5c06 iptables \u8f6c\u53d1\u7b56\u7565\u8bbe\u7f6e\u4e3a ACCEPT\u3002\u8bb8\u591a\u7cfb\u7edf\u5c06 iptables \u8f6c\u53d1\u7b56\u7565\u8bbe\u7f6e\u4e3a DROP\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 HashiCorp Packer \u548c\u6765\u81ea AWS GitHub \u4e0a\u7684 Amazon EKS AMI \u5b58\u50a8\u5e93\u7684\u8d44\u6e90\u548c\u914d\u7f6e\u811a\u672c\u7684\u6784\u5efa\u89c4\u8303\u6765\u6784\u5efa\u81ea\u5b9a\u4e49 AMI\u3002\u60a8\u53ef\u4ee5\u66f4\u65b0 kubelet.service,\u5e76\u6309\u7167\u6b64\u5904\u6307\u5b9a\u7684\u8bf4\u660e\u521b\u5efa\u81ea\u5b9a\u4e49 AMI\u3002</p>"},{"location":"zh/networking/vpc-cni/#cni_1","title":"\u5b9a\u671f\u5347\u7ea7 CNI \u7248\u672c","text":"<p>VPC CNI \u5411\u540e\u517c\u5bb9\u3002\u6700\u65b0\u7248\u672c\u9002\u7528\u4e8e\u6240\u6709 Amazon EKS \u652f\u6301\u7684 Kubernetes \u7248\u672c\u3002\u6b64\u5916\uff0cVPC CNI \u4f5c\u4e3a EKS \u63d2\u4ef6\u63d0\u4f9b(\u53c2\u89c1\u4e0a\u9762\u7684\"\u90e8\u7f72 VPC CNI \u6258\u7ba1\u63d2\u4ef6\")\u3002\u867d\u7136 EKS \u63d2\u4ef6\u534f\u8c03\u5347\u7ea7\u63d2\u4ef6\uff0c\u4f46\u5b83\u4e0d\u4f1a\u81ea\u52a8\u5347\u7ea7\u50cf CNI \u8fd9\u6837\u8fd0\u884c\u5728\u6570\u636e\u5e73\u9762\u4e0a\u7684\u63d2\u4ef6\u3002\u60a8\u6709\u8d23\u4efb\u5728\u6258\u7ba1\u548c\u81ea\u7ba1\u7406\u5de5\u4f5c\u8282\u70b9\u5347\u7ea7\u540e\u5347\u7ea7 VPC CNI \u63d2\u4ef6\u3002</p>"},{"location":"zh/performance/performance/","title":"\u6027\u80fd\u6548\u7387\u652f\u67f1","text":"<p>\u6027\u80fd\u6548\u7387\u652f\u67f1\u5173\u6ce8\u4e8e\u9ad8\u6548\u5229\u7528\u8ba1\u7b97\u8d44\u6e90\u4ee5\u6ee1\u8db3\u9700\u6c42\uff0c\u4ee5\u53ca\u5982\u4f55\u5728\u9700\u6c42\u53d8\u5316\u548c\u6280\u672f\u53d1\u5c55\u7684\u60c5\u51b5\u4e0b\u4fdd\u6301\u6548\u7387\u3002\u672c\u8282\u63d0\u4f9b\u4e86\u5728AWS\u4e0a\u6784\u5efa\u9ad8\u6027\u80fd\u6548\u7387\u67b6\u6784\u7684\u6df1\u5165\u6700\u4f73\u5b9e\u8df5\u6307\u5bfc\u3002</p>"},{"location":"zh/performance/performance/#_2","title":"\u5b9a\u4e49","text":"<p>\u4e3a\u786e\u4fdd\u9ad8\u6548\u5229\u7528EKS\u5bb9\u5668\u670d\u52a1\uff0c\u60a8\u5e94\u8be5\u6536\u96c6\u6709\u5173\u67b6\u6784\u5404\u4e2a\u65b9\u9762\u7684\u6570\u636e\uff0c\u4ece\u9ad8\u7ea7\u8bbe\u8ba1\u5230EKS\u8d44\u6e90\u7c7b\u578b\u7684\u9009\u62e9\u3002\u901a\u8fc7\u5b9a\u671f\u5ba1\u67e5\u60a8\u7684\u9009\u62e9\uff0c\u60a8\u53ef\u4ee5\u786e\u4fdd\u5229\u7528\u4e0d\u65ad\u53d1\u5c55\u7684Amazon EKS\u548c\u5bb9\u5668\u670d\u52a1\u3002\u76d1\u63a7\u5c06\u786e\u4fdd\u60a8\u4e86\u89e3\u4efb\u4f55\u504f\u79bb\u9884\u671f\u6027\u80fd\u7684\u60c5\u51b5\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u91c7\u53d6\u884c\u52a8\u3002</p> <p>EKS\u5bb9\u5668\u7684\u6027\u80fd\u6548\u7387\u7531\u4e09\u4e2a\u9886\u57df\u7ec4\u6210\uff1a</p> <ul> <li> <p>\u4f18\u5316\u60a8\u7684\u5bb9\u5668</p> </li> <li> <p>\u8d44\u6e90\u7ba1\u7406</p> </li> <li> <p>\u53ef\u6269\u5c55\u6027\u7ba1\u7406</p> </li> </ul>"},{"location":"zh/performance/performance/#_3","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"zh/performance/performance/#_4","title":"\u4f18\u5316\u60a8\u7684\u5bb9\u5668","text":"<p>\u60a8\u53ef\u4ee5\u5728Docker\u5bb9\u5668\u4e2d\u8fd0\u884c\u5927\u591a\u6570\u5e94\u7528\u7a0b\u5e8f\u800c\u4e0d\u4f1a\u9047\u5230\u592a\u591a\u9ebb\u70e6\u3002\u4f46\u662f\uff0c\u4e3a\u4e86\u786e\u4fdd\u5b83\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6709\u6548\u8fd0\u884c\uff0c\u5305\u62ec\u7b80\u5316\u6784\u5efa\u8fc7\u7a0b\uff0c\u60a8\u9700\u8981\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\u5c06\u5e2e\u52a9\u60a8\u5b9e\u73b0\u8fd9\u4e00\u76ee\u6807\u3002</p>"},{"location":"zh/performance/performance/#_5","title":"\u5efa\u8bae","text":"<ul> <li>\u4f7f\u60a8\u7684\u5bb9\u5668\u955c\u50cf\u65e0\u72b6\u6001\uff1a \u4f7f\u7528Docker\u955c\u50cf\u521b\u5efa\u7684\u5bb9\u5668\u5e94\u8be5\u662f\u4e34\u65f6\u7684\u548c\u4e0d\u53ef\u53d8\u7684\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5bb9\u5668\u5e94\u8be5\u662f\u53ef\u5904\u7406\u7684\u548c\u72ec\u7acb\u7684\uff0c\u5373\u53ef\u4ee5\u6784\u5efa\u548c\u653e\u7f6e\u4e00\u4e2a\u65b0\u7684\u5bb9\u5668\u800c\u65e0\u9700\u8fdb\u884c\u4efb\u4f55\u914d\u7f6e\u66f4\u6539\u3002\u8bbe\u8ba1\u65e0\u72b6\u6001\u5bb9\u5668\u3002\u5982\u679c\u60a8\u60f3\u4f7f\u7528\u6301\u4e45\u6570\u636e\uff0c\u8bf7\u4f7f\u7528\u5377\u3002\u5982\u679c\u60a8\u60f3\u5b58\u50a8\u673a\u5bc6\u6216\u670d\u52a1\u4f7f\u7528\u7684\u654f\u611f\u5e94\u7528\u7a0b\u5e8f\u6570\u636e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982AWS Systems ManagerParameter Store\u6216\u7b2c\u4e09\u65b9\u4ea7\u54c1\u6216\u5f00\u6e90\u89e3\u51b3\u65b9\u6848(\u5982HashiCorp Valut\u548cConsul)\u4e4b\u7c7b\u7684\u89e3\u51b3\u65b9\u6848\u8fdb\u884c\u8fd0\u884c\u65f6\u914d\u7f6e\u3002</li> <li>\u6700\u5c0f\u57fa\u7840\u955c\u50cf: \u4ece\u4e00\u4e2a\u5c0f\u7684\u57fa\u7840\u955c\u50cf\u5f00\u59cb\u3002Dockerfile\u4e2d\u7684\u6bcf\u4e2a\u5176\u4ed6\u6307\u4ee4\u90fd\u662f\u5728\u6b64\u955c\u50cf\u4e4b\u4e0a\u6784\u5efa\u7684\u3002\u57fa\u7840\u955c\u50cf\u8d8a\u5c0f\uff0c\u751f\u6210\u7684\u955c\u50cf\u5c31\u8d8a\u5c0f\uff0c\u4e0b\u8f7d\u901f\u5ea6\u5c31\u8d8a\u5feb\u3002\u4f8b\u5982\uff0calpine:3.7\u955c\u50cf\u6bd4centos:7\u955c\u50cf\u5c0f71 MB\u3002\u60a8\u751a\u81f3\u53ef\u4ee5\u4f7f\u7528scratch\u57fa\u7840\u955c\u50cf\uff0c\u8fd9\u662f\u4e00\u4e2a\u7a7a\u955c\u50cf\uff0c\u60a8\u53ef\u4ee5\u5728\u5176\u4e0a\u6784\u5efa\u81ea\u5df1\u7684\u8fd0\u884c\u65f6\u73af\u5883\u3002</li> <li>\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u5305\uff1a \u5728\u6784\u5efa\u5bb9\u5668\u955c\u50cf\u65f6\uff0c\u53ea\u5305\u542b\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u4f9d\u8d56\u9879\uff0c\u907f\u514d\u5b89\u88c5\u4e0d\u5fc5\u8981\u7684\u5305\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u9700\u8981SSH\u670d\u52a1\u5668\uff0c\u8bf7\u4e0d\u8981\u5305\u542b\u5b83\u3002\u8fd9\u5c06\u51cf\u5c11\u590d\u6742\u6027\u3001\u4f9d\u8d56\u9879\u3001\u6587\u4ef6\u5927\u5c0f\u548c\u6784\u5efa\u65f6\u95f4\u3002\u8981\u6392\u9664\u4e0e\u6784\u5efa\u65e0\u5173\u7684\u6587\u4ef6\uff0c\u8bf7\u4f7f\u7528.dockerignore\u6587\u4ef6\u3002</li> <li>\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa:\u591a\u9636\u6bb5\u6784\u5efa\u5141\u8bb8\u60a8\u5728\u7b2c\u4e00\u4e2a\"\u6784\u5efa\"\u5bb9\u5668\u4e2d\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u5728\u53e6\u4e00\u4e2a\u5bb9\u5668\u4e2d\u4f7f\u7528\u7ed3\u679c\uff0c\u540c\u65f6\u4f7f\u7528\u76f8\u540c\u7684Dockerfile\u3002\u7a0d\u5fae\u8be6\u7ec6\u8bf4\u660e\u4e00\u4e0b\uff0c\u5728\u591a\u9636\u6bb5\u6784\u5efa\u4e2d\uff0c\u60a8\u5728Dockerfile\u4e2d\u4f7f\u7528\u591a\u4e2aFROM\u8bed\u53e5\u3002\u6bcf\u4e2aFROM\u6307\u4ee4\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u57fa\u7840\uff0c\u6bcf\u4e2a\u6307\u4ee4\u90fd\u5f00\u59cb\u6784\u5efa\u7684\u65b0\u9636\u6bb5\u3002\u60a8\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u4ece\u4e00\u4e2a\u9636\u6bb5\u590d\u5236\u5de5\u4ef6\u5230\u53e6\u4e00\u4e2a\u9636\u6bb5\uff0c\u800c\u5c06\u60a8\u4e0d\u60f3\u5728\u6700\u7ec8\u955c\u50cf\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u90fd\u7559\u5728\u540e\u9762\u3002\u8fd9\u79cd\u65b9\u6cd5\u6781\u5927\u5730\u51cf\u5c0f\u4e86\u6700\u7ec8\u955c\u50cf\u7684\u5927\u5c0f\uff0c\u800c\u65e0\u9700\u52aa\u529b\u51cf\u5c11\u4e2d\u95f4\u5c42\u548c\u6587\u4ef6\u7684\u6570\u91cf\u3002</li> <li>\u6700\u5c0f\u5316\u5c42\u6570\uff1a Dockerfile\u4e2d\u7684\u6bcf\u4e2a\u6307\u4ee4\u90fd\u4f1a\u4e3aDocker\u955c\u50cf\u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684\u5c42\u3002\u6307\u4ee4\u548c\u5c42\u7684\u6570\u91cf\u5e94\u4fdd\u6301\u5728\u6700\u5c0f\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5f71\u54cd\u6784\u5efa\u6027\u80fd\u548c\u65f6\u95f4\u3002\u4f8b\u5982\uff0c\u7b2c\u4e00\u6761\u6307\u4ee4\u5c06\u521b\u5efa\u591a\u4e2a\u5c42\uff0c\u800c\u7b2c\u4e8c\u6761\u6307\u4ee4\u901a\u8fc7\u4f7f\u7528&amp;&amp;(\u94fe\u63a5)\u6211\u4eec\u51cf\u5c11\u4e86\u5c42\u7684\u6570\u91cf\uff0c\u8fd9\u5c06\u6709\u52a9\u4e8e\u63d0\u4f9b\u66f4\u597d\u7684\u6027\u80fd\u3002\u8fd9\u662f\u51cf\u5c11Dockerfile\u4e2d\u5c06\u521b\u5efa\u7684\u5c42\u6570\u7684\u6700\u4f73\u65b9\u5f0f\u3002</li> <li> <pre><code>        RUN apt-get -y update\n        RUN apt-get install -y python\n        RUN apt-get -y update &amp;&amp; apt-get install -y python\n</code></pre> </li> <li> <p>\u6b63\u786e\u6807\u8bb0\u60a8\u7684\u955c\u50cf\uff1a \u6784\u5efa\u955c\u50cf\u65f6\uff0c\u59cb\u7ec8\u4f7f\u7528\u6709\u7528\u548c\u6709\u610f\u4e49\u7684\u6807\u7b7e\u5bf9\u5b83\u4eec\u8fdb\u884c\u6807\u8bb0\u3002\u8fd9\u662f\u4e00\u79cd\u7ec4\u7ec7\u548c\u8bb0\u5f55\u63cf\u8ff0\u955c\u50cf\u7684\u5143\u6570\u636e\u7684\u597d\u65b9\u6cd5\uff0c\u4f8b\u5982\uff0c\u5305\u62ec\u6765\u81eaCI\u670d\u52a1\u5668(\u5982CodeBuild\u6216Jenkins)\u7684\u552f\u4e00\u8ba1\u6570\u5668(\u5982\u6784\u5efaID)\uff0c\u4ee5\u5e2e\u52a9\u8bc6\u522b\u6b63\u786e\u7684\u955c\u50cf\u3002\u5982\u679c\u60a8\u5728Docker\u547d\u4ee4\u4e2d\u6ca1\u6709\u63d0\u4f9b\u6807\u7b7e\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528latest\u6807\u7b7e\u3002\u6211\u4eec\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u81ea\u52a8\u521b\u5efa\u7684latest\u6807\u7b7e\uff0c\u56e0\u4e3a\u4f7f\u7528\u6b64\u6807\u7b7e\uff0c\u60a8\u5c06\u81ea\u52a8\u8fd0\u884c\u672a\u6765\u7684\u4e3b\u8981\u7248\u672c\uff0c\u5176\u4e2d\u53ef\u80fd\u5305\u542b\u5e94\u7528\u7a0b\u5e8f\u7684\u91cd\u5927\u66f4\u6539\u3002\u6700\u4f73\u5b9e\u8df5\u662f\u907f\u514d\u4f7f\u7528latest\u6807\u7b7e\uff0c\u800c\u662f\u4f7f\u7528\u7531CI\u670d\u52a1\u5668\u521b\u5efa\u7684\u552f\u4e00\u6458\u8981\u3002</p> </li> <li>\u4f7f\u7528 \u6784\u5efa\u7f13\u5b58 \u63d0\u9ad8\u6784\u5efa\u901f\u5ea6 : \u7f13\u5b58\u5141\u8bb8\u60a8\u5229\u7528\u73b0\u6709\u7684\u7f13\u5b58\u955c\u50cf\uff0c\u800c\u4e0d\u662f\u4ece\u5934\u5f00\u59cb\u6784\u5efa\u6bcf\u4e2a\u955c\u50cf\u3002\u4f8b\u5982\uff0c\u60a8\u5e94\u8be5\u5c3d\u53ef\u80fd\u665a\u5730\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u6e90\u4ee3\u7801\u6dfb\u52a0\u5230Dockerfile\u4e2d\uff0c\u8fd9\u6837\u57fa\u7840\u955c\u50cf\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u4f9d\u8d56\u9879\u5c31\u4f1a\u88ab\u7f13\u5b58\uff0c\u5e76\u4e14\u4e0d\u4f1a\u5728\u6bcf\u6b21\u6784\u5efa\u65f6\u90fd\u91cd\u65b0\u6784\u5efa\u3002\u8981\u91cd\u7528\u5df2\u7f13\u5b58\u7684\u955c\u50cf\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728Amazon EKS\u4e2d\uff0ckubelet\u5c06\u5c1d\u8bd5\u4ece\u6307\u5b9a\u7684\u6ce8\u518c\u8868\u4e2d\u62c9\u53d6\u6bcf\u4e2a\u955c\u50cf\u3002\u4f46\u662f\uff0c\u5982\u679c\u5bb9\u5668\u7684imagePullPolicy\u5c5e\u6027\u8bbe\u7f6e\u4e3aIfNotPresent\u6216Never\uff0c\u5219\u5c06\u4f7f\u7528\u672c\u5730\u955c\u50cf(\u4f18\u5148\u6216\u4e13\u7528)\u3002</li> <li> <p>\u955c\u50cf\u5b89\u5168\uff1a \u4f7f\u7528\u516c\u5171\u955c\u50cf\u53ef\u80fd\u662f\u5f00\u59cb\u4f7f\u7528\u5bb9\u5668\u548c\u5c06\u5176\u90e8\u7f72\u5230Kubernetes\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u65b9\u5f0f\u3002\u4f46\u662f\uff0c\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528\u5b83\u4eec\u53ef\u80fd\u4f1a\u5e26\u6765\u4e00\u7cfb\u5217\u6311\u6218\u3002\u7279\u522b\u662f\u5728\u5b89\u5168\u65b9\u9762\u3002\u786e\u4fdd\u9075\u5faa\u6253\u5305\u548c\u5206\u53d1\u5bb9\u5668/\u5e94\u7528\u7a0b\u5e8f\u7684\u6700\u4f73\u5b9e\u8df5\u3002\u4f8b\u5982\uff0c\u4e0d\u8981\u5728\u5bb9\u5668\u4e2d\u6784\u5efa\u5bc6\u7801\uff0c\u60a8\u53ef\u80fd\u8fd8\u9700\u8981\u63a7\u5236\u5b83\u4eec\u7684\u5185\u5bb9\u3002\u5efa\u8bae\u4f7f\u7528\u79c1\u6709\u5b58\u50a8\u5e93\uff0c\u5982Amazon ECR,\u5e76\u5229\u7528\u5185\u7f6e\u7684\u955c\u50cf\u626b\u63cf\u529f\u80fd\u6765\u8bc6\u522b\u5bb9\u5668\u955c\u50cf\u4e2d\u7684\u8f6f\u4ef6\u6f0f\u6d1e\u3002</p> </li> <li> <p>\u6b63\u786e\u8c03\u6574\u5bb9\u5668\u5927\u5c0f\uff1a \u5728\u5f00\u53d1\u548c\u8fd0\u884c\u5bb9\u5668\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u6709\u4e00\u4e9b\u5173\u952e\u9886\u57df\u9700\u8981\u8003\u8651\u3002\u60a8\u8c03\u6574\u5bb9\u5668\u5927\u5c0f\u548c\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u7684\u65b9\u5f0f\u53ef\u80fd\u4f1a\u5bf9\u60a8\u63d0\u4f9b\u7684\u670d\u52a1\u7684\u6700\u7ec8\u7528\u6237\u4f53\u9a8c\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\u3002\u4e3a\u4e86\u5e2e\u52a9\u60a8\u53d6\u5f97\u6210\u529f\uff0c\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\u5c06\u5e2e\u52a9\u60a8\u6b63\u786e\u8c03\u6574\u5bb9\u5668\u5927\u5c0f\u3002\u5728\u786e\u5b9a\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u8d44\u6e90\u6570\u91cf\u540e\uff0c\u60a8\u5e94\u8be5\u5728Kubernetes\u4e2d\u8bbe\u7f6e\u8bf7\u6c42\u548c\u9650\u5236\uff0c\u4ee5\u786e\u4fdd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u3002</p> </li> </ul> <p> (a) \u5bf9\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u6d4b\u8bd5: \u6536\u96c6\u5173\u952e\u7edf\u8ba1\u6570\u636e\u548c\u5176\u4ed6\u6027\u80fd\u6570\u636e\u3002\u6839\u636e\u8fd9\u4e9b\u6570\u636e\uff0c\u60a8\u53ef\u4ee5\u786e\u5b9a\u5bb9\u5668\u7684\u6700\u4f73\u914d\u7f6e\uff0c\u5373\u5185\u5b58\u548cCPU\u3002\u5173\u952e\u7edf\u8ba1\u6570\u636e\u5305\u62ec\uff1a CPU\u3001\u5ef6\u8fdf\u3001I/O\u3001\u5185\u5b58\u4f7f\u7528\u91cf\u3001\u7f51\u7edc \u3002\u901a\u8fc7\u5355\u72ec\u8fdb\u884c\u8d1f\u8f7d\u6d4b\u8bd5(\u5982\u6709\u5fc5\u8981)\uff0c\u786e\u5b9a\u9884\u671f\u3001\u5e73\u5747\u548c\u5cf0\u503c\u5bb9\u5668\u5185\u5b58\u548cCPU\u4f7f\u7528\u91cf\u3002\u8fd8\u8981\u8003\u8651\u53ef\u80fd\u5e76\u884c\u8fd0\u884c\u5728\u5bb9\u5668\u4e2d\u7684\u6240\u6709\u8fdb\u7a0b\u3002</p> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u5efa\u8bae\u4f7f\u7528CloudWatch Container insights\u6216\u5408\u4f5c\u4f19\u4f34\u4ea7\u54c1\uff0c\u5b83\u5c06\u4e3a\u60a8\u63d0\u4f9b\u6b63\u786e\u7684\u4fe1\u606f\u6765\u8c03\u6574\u5bb9\u5668\u548cWorker\u8282\u70b9\u7684\u5927\u5c0f\u3002</p> <p> (b)\u72ec\u7acb\u6d4b\u8bd5\u670d\u52a1\uff1a \u7531\u4e8e\u8bb8\u591a\u5e94\u7528\u7a0b\u5e8f\u5728\u771f\u6b63\u7684\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u76f8\u4e92\u4f9d\u8d56\uff0c\u60a8\u9700\u8981\u4ee5\u9ad8\u5ea6\u72ec\u7acb\u7684\u65b9\u5f0f\u5bf9\u5b83\u4eec\u8fdb\u884c\u6d4b\u8bd5\uff0c\u8fd9\u610f\u5473\u7740\u670d\u52a1\u80fd\u591f\u6b63\u786e\u72ec\u7acb\u8fd0\u884c\uff0c\u4e5f\u80fd\u4f5c\u4e3a\u4e00\u4e2a\u534f\u8c03\u7684\u7cfb\u7edf\u8fd0\u884c\u3002</p>"},{"location":"zh/performance/performance/#_6","title":"\u8d44\u6e90\u7ba1\u7406","text":"<p>\u5728\u91c7\u7528Kubernetes\u65f6\uff0c\u6700\u5e38\u89c1\u7684\u95ee\u9898\u4e4b\u4e00\u662f\"\u6211\u5e94\u8be5\u5728\u4e00\u4e2aPod\u4e2d\u653e\u4ec0\u4e48\uff1f\"\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u4e09\u5c42LAMP\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u3002\u6211\u4eec\u5e94\u8be5\u5c06\u6b64\u5e94\u7528\u7a0b\u5e8f\u4fdd\u7559\u5728\u540c\u4e00\u4e2apod\u4e2d\u5417\uff1f\u8fd9\u786e\u5b9e\u6709\u6548\u5730\u4f5c\u4e3a\u4e00\u4e2a\u5355\u4e00\u7684pod\u5de5\u4f5c\uff0c\u4f46\u8fd9\u662f\u4e00\u4e2aPod\u521b\u5efa\u7684\u53cd\u6a21\u5f0f\u793a\u4f8b\u3002\u6709\u4e24\u4e2a\u539f\u56e0</p> <p>(a) \u5982\u679c\u60a8\u5728\u540c\u4e00\u4e2aPod\u4e2d\u6709\u4e24\u4e2a\u5bb9\u5668\uff0c\u60a8\u5c06\u88ab\u8feb\u4f7f\u7528\u76f8\u540c\u7684\u6269\u5c55\u7b56\u7565\uff0c\u8fd9\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\u6765\u8bf4\u662f\u4e0d\u7406\u60f3\u7684\uff0c\u60a8\u4e5f\u65e0\u6cd5\u6839\u636e\u4f7f\u7528\u60c5\u51b5\u6709\u6548\u5730\u7ba1\u7406\u6216\u7ea6\u675f\u8d44\u6e90\u3002\u4f8b\u5982\uff1a \u60a8\u53ef\u80fd\u53ea\u9700\u8981\u6269\u5c55\u524d\u7aef\uff0c\u800c\u4e0d\u662f\u5c06\u524d\u7aef\u548c\u540e\u7aef(MySQL)\u4f5c\u4e3a\u4e00\u4e2a\u5355\u5143\u8fdb\u884c\u6269\u5c55\uff0c\u5982\u679c\u60a8\u60f3\u4ec5\u589e\u52a0\u4e13\u7528\u4e8e\u540e\u7aef\u7684\u8d44\u6e90\uff0c\u60a8\u4e5f\u65e0\u6cd5\u8fd9\u6837\u505a\u3002</p> <p>(b) \u5982\u679c\u60a8\u6709\u4e24\u4e2a\u5355\u72ec\u7684Pod\uff0c\u4e00\u4e2a\u7528\u4e8e\u524d\u7aef\uff0c\u53e6\u4e00\u4e2a\u7528\u4e8e\u540e\u7aef\u3002\u6269\u5c55\u5c06\u975e\u5e38\u5bb9\u6613\uff0c\u5e76\u4e14\u60a8\u5c06\u83b7\u5f97\u66f4\u597d\u7684\u53ef\u9760\u6027\u3002</p> <p>\u4e0a\u8ff0\u60c5\u51b5\u53ef\u80fd\u5e76\u4e0d\u9002\u7528\u4e8e\u6240\u6709\u7528\u4f8b\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u524d\u7aef\u548c\u540e\u7aef\u53ef\u80fd\u4f1a\u843d\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u5b83\u4eec\u5c06\u901a\u8fc7\u7f51\u7edc\u76f8\u4e92\u901a\u4fe1\uff0c\u56e0\u6b64\u60a8\u9700\u8981\u95ee\u8fd9\u4e2a\u95ee\u9898\uff1a\"\u5982\u679c\u5b83\u4eec\u88ab\u653e\u7f6e\u5e76\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u8fd0\u884c\uff0c\u6211\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u4f1a\u6b63\u5e38\u5de5\u4f5c\uff1f\"\u5982\u679c\u7b54\u6848\u662f\"\u5426\",\u53ef\u80fd\u662f\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u8bbe\u8ba1\u6216\u5176\u4ed6\u4e00\u4e9b\u6280\u672f\u539f\u56e0\uff0c\u90a3\u4e48\u5728\u5355\u4e2apod\u4e2d\u5bf9\u5bb9\u5668\u8fdb\u884c\u5206\u7ec4\u662f\u6709\u610f\u4e49\u7684\u3002\u5982\u679c\u7b54\u6848\u662f\"\u662f\",\u90a3\u4e48\u591a\u4e2aPod\u5c31\u662f\u6b63\u786e\u7684\u65b9\u6cd5\u3002</p>"},{"location":"zh/performance/performance/#_7","title":"\u5efa\u8bae","text":"<ul> <li> <p>\u6bcf\u4e2a\u5bb9\u5668\u6253\u5305\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff1a \u5bb9\u5668\u5728\u5176\u4e2d\u8fd0\u884c\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u65f6\u6548\u679c\u6700\u4f73\u3002\u8be5\u5e94\u7528\u7a0b\u5e8f\u5e94\u8be5\u6709\u4e00\u4e2a\u5355\u4e00\u7684\u7236\u8fdb\u7a0b\u3002\u4f8b\u5982\uff0c\u4e0d\u8981\u5728\u540c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u8fd0\u884cPHP\u548cMySQL\uff1a\u8fd9\u6837\u66f4\u96be\u8c03\u8bd5\uff0c\u800c\u4e14\u60a8\u65e0\u6cd5\u5355\u72ec\u6c34\u5e73\u6269\u5c55PHP\u5bb9\u5668\u3002\u8fd9\u79cd\u5206\u79bb\u5141\u8bb8\u60a8\u66f4\u597d\u5730\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u4e0e\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u76f8\u5173\u8054\u3002\u60a8\u7684\u5bb9\u5668\u5e94\u8be5\u662f\u65e0\u72b6\u6001\u548c\u4e0d\u53ef\u53d8\u7684\u3002\u65e0\u72b6\u6001\u610f\u5473\u7740\u4efb\u4f55\u72b6\u6001(\u4efb\u4f55\u7c7b\u578b\u7684\u6301\u4e45\u6570\u636e)\u90fd\u5b58\u50a8\u5728\u5bb9\u5668\u4e4b\u5916\uff0c\u4f8b\u5982\uff0c\u5982\u679c\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u5916\u90e8\u5b58\u50a8\uff0c\u5982\u6301\u4e45\u78c1\u76d8\u3001Amazon EBS\u548cAmazon EFS\uff0c\u6216\u6258\u7ba1\u6570\u636e\u5e93\uff0c\u5982Amazon RDS\u3002\u4e0d\u53ef\u53d8\u610f\u5473\u7740\u5bb9\u5668\u5728\u5176\u751f\u547d\u5468\u671f\u5185\u4e0d\u4f1a\u88ab\u4fee\u6539\uff1a\u6ca1\u6709\u66f4\u65b0\u3001\u8865\u4e01\u6216\u914d\u7f6e\u66f4\u6539\u3002\u8981\u66f4\u65b0\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u6216\u5e94\u7528\u8865\u4e01\uff0c\u60a8\u9700\u8981\u6784\u5efa\u4e00\u4e2a\u65b0\u955c\u50cf\u5e76\u90e8\u7f72\u5b83\u3002</p> </li> <li> <p>\u4e3aKubernetes\u5bf9\u8c61\u4f7f\u7528\u6807\u7b7e\uff1a \u6807\u7b7e\u5141\u8bb8\u6279\u91cf\u67e5\u8be2\u548c\u64cd\u4f5cKubernetes\u5bf9\u8c61\u3002\u5b83\u4eec\u8fd8\u53ef\u7528\u4e8e\u8bc6\u522b\u548c\u7ec4\u7ec7Kubernetes\u5bf9\u8c61\u5230\u7ec4\u4e2d\u3002\u56e0\u6b64\uff0c\u5b9a\u4e49\u6807\u7b7e\u5e94\u8be5\u662f\u4efb\u4f55Kubernetes\u6700\u4f73\u5b9e\u8df5\u5217\u8868\u7684\u9996\u8981\u4efb\u52a1\u3002</p> </li> <li> <p>\u8bbe\u7f6e\u8d44\u6e90\u8bf7\u6c42\u9650\u5236\uff1a \u8bbe\u7f6e\u8bf7\u6c42\u9650\u5236\u662f\u63a7\u5236\u5bb9\u5668\u53ef\u4ee5\u6d88\u8017\u7684\u7cfb\u7edf\u8d44\u6e90(\u5982CPU\u548c\u5185\u5b58)\u6570\u91cf\u7684\u673a\u5236\u3002\u8fd9\u4e9b\u8bbe\u7f6e\u662f\u5bb9\u5668\u542f\u52a8\u65f6\u4fdd\u8bc1\u83b7\u5f97\u7684\u8d44\u6e90\u3002\u5982\u679c\u5bb9\u5668\u8bf7\u6c42\u8d44\u6e90\uff0c\u5bb9\u5668\u7f16\u6392\u5668(\u5982Kubernetes)\u5c06\u53ea\u5728\u53ef\u4ee5\u63d0\u4f9b\u8be5\u8d44\u6e90\u7684\u8282\u70b9\u4e0a\u8c03\u5ea6\u5b83\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u9650\u5236\u786e\u4fdd\u5bb9\u5668\u6c38\u8fdc\u4e0d\u4f1a\u8d85\u8fc7\u67d0\u4e2a\u503c\u3002\u5bb9\u5668\u53ea\u5141\u8bb8\u8fbe\u5230\u9650\u5236\uff0c\u7136\u540e\u5c31\u4f1a\u53d7\u5230\u9650\u5236\u3002</p> </li> </ul> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u5728\u4e0b\u9762\u7684Pod\u6e05\u5355\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u6dfb\u52a0\u4e861.0 CPU\u548c256 MB\u5185\u5b58\u7684\u9650\u5236</p> <pre><code>        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: nginx-pod-webserver\n          labels:\n            name: nginx-pod\n        spec:\n          containers:\n          - name: nginx\n            image: nginx:latest\n            resources:\n              limits:\n                memory: \"256Mi\"\n                cpu: \"1000m\"\n              requests:\n                memory: \"128Mi\"\n                cpu: \"500m\"\n            ports:\n            - containerPort: 80\n</code></pre> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u5728pod\u5b9a\u4e49\u4e2d\u5b9a\u4e49\u8fd9\u4e9b\u8bf7\u6c42\u548c\u9650\u5236\u662f\u6700\u4f73\u5b9e\u8df5\u3002\u5982\u679c\u60a8\u4e0d\u5305\u542b\u8fd9\u4e9b\u503c\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u5c31\u65e0\u6cd5\u4e86\u89e3\u6240\u9700\u7684\u8d44\u6e90\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u4e9b\u4fe1\u606f\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u5c06pod\u8c03\u5ea6\u5230\u6ca1\u6709\u8db3\u591f\u8d44\u6e90\u63d0\u4f9b\u53ef\u63a5\u53d7\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u7684\u8282\u70b9\u4e0a\u3002</p> <ul> <li>\u9650\u5236\u5e76\u53d1\u4e2d\u65ad\u7684\u6570\u91cf\uff1a \u4f7f\u7528_PodDisruptionBudget_\uff0c\u6b64\u8bbe\u7f6e\u5141\u8bb8\u60a8\u5728\u81ea\u613f\u9a71\u9010\u4e8b\u4ef6\u671f\u95f4\u8bbe\u7f6e\u53ef\u7528\u548c\u4e0d\u53ef\u7528pod\u7684\u6700\u5c0f\u548c\u6700\u5927\u7b56\u7565\u3002\u9a71\u9010\u7684\u4e00\u4e2a\u793a\u4f8b\u662f\u5728\u5bf9\u8282\u70b9\u8fdb\u884c\u7ef4\u62a4\u6216\u6392\u7a7a\u8282\u70b9\u65f6\u3002</li> </ul> <p> \u793a\u4f8b\uff1a \u4e00\u4e2aWeb\u524d\u7aef\u53ef\u80fd\u5e0c\u671b\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u90fd\u67098\u4e2aPod\u53ef\u7528\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9a71\u9010\u53ef\u4ee5\u9a71\u9010\u4efb\u610f\u591a\u7684pod\uff0c\u53ea\u8981\u6709\u516b\u4e2a\u53ef\u7528\u5373\u53ef\u3002 <pre><code>apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: frontend-demo\nspec:\n  minAvailable: 8\n  selector:\n    matchLabels:\n      app: frontend\n</code></pre></p> <p> \u6ce8\u610f\uff1a \u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528maxAvailable\u6216maxUnavailable\u53c2\u6570\u4ee5\u767e\u5206\u6bd4\u7684\u5f62\u5f0f\u6307\u5b9apod\u4e2d\u65ad\u9884\u7b97\u3002</p> <ul> <li>\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\uff1a \u547d\u540d\u7a7a\u95f4\u5141\u8bb8\u591a\u4e2a\u56e2\u961f\u5171\u4eab\u4e00\u4e2a\u7269\u7406\u96c6\u7fa4\u3002\u547d\u540d\u7a7a\u95f4\u5141\u8bb8\u5c06\u521b\u5efa\u7684\u8d44\u6e90\u5212\u5206\u5230\u4e00\u4e2a\u903b\u8f91\u547d\u540d\u7ec4\u4e2d\u3002\u8fd9\u5141\u8bb8\u60a8\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u8bbe\u7f6e\u8d44\u6e90\u914d\u989d\u3001\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u7684\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236(RBAC)\u4ee5\u53ca\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u7684\u7f51\u7edc\u7b56\u7565\u3002\u5b83\u4e3a\u60a8\u63d0\u4f9b\u4e86\u8f6f\u591a\u79df\u6237\u529f\u80fd\u3002</li> </ul> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728\u5355\u4e2aAmazon EKS\u96c6\u7fa4\u4e0a\u8fd0\u884c\u4e09\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u7531\u4e09\u4e2a\u4e0d\u540c\u7684\u56e2\u961f\u8bbf\u95ee\uff0c\u6bcf\u4e2a\u56e2\u961f\u90fd\u9700\u8981\u591a\u4e2a\u8d44\u6e90\u7ea6\u675f\u548c\u4e0d\u540c\u7ea7\u522b\u7684QoS\uff0c\u60a8\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u56e2\u961f\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u56e2\u961f\u63d0\u4f9b\u53ef\u4ee5\u4f7f\u7528\u7684\u8d44\u6e90(\u5982CPU\u548c\u5185\u5b58)\u7684\u914d\u989d\u3002</p> <p>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u542f\u7528LimitRange\u51c6\u5165\u63a7\u5236\u5668\u5728Kubernetes\u547d\u540d\u7a7a\u95f4\u7ea7\u522b\u6307\u5b9a\u9ed8\u8ba4\u9650\u5236\u3002\u8fd9\u4e9b\u9ed8\u8ba4\u9650\u5236\u5c06\u7ea6\u675f\u7ed9\u5b9aPod\u53ef\u4ee5\u4f7f\u7528\u7684CPU\u6216\u5185\u5b58\u91cf\uff0c\u9664\u975ePod\u7684\u914d\u7f6e\u663e\u5f0f\u8986\u76d6\u4e86\u8fd9\u4e9b\u9ed8\u8ba4\u503c\u3002</p> <ul> <li> <p>\u7ba1\u7406\u8d44\u6e90\u914d\u989d\uff1a  \u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u90fd\u53ef\u4ee5\u5206\u914d\u8d44\u6e90\u914d\u989d\u3002\u6307\u5b9a\u914d\u989d\u5141\u8bb8\u9650\u5236\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u6240\u6709\u8d44\u6e90\u53ef\u4ee5\u6d88\u8017\u7684\u96c6\u7fa4\u8d44\u6e90\u91cf\u3002\u8d44\u6e90\u914d\u989d\u53ef\u4ee5\u7531ResourceQuota\u5bf9\u8c61\u5b9a\u4e49\u3002\u547d\u540d\u7a7a\u95f4\u4e2dResourceQuota\u5bf9\u8c61\u7684\u5b58\u5728\u786e\u4fdd\u4e86\u8d44\u6e90\u914d\u989d\u7684\u5b9e\u65bd\u3002</p> </li> <li> <p>\u4e3aPod\u914d\u7f6e\u5065\u5eb7\u68c0\u67e5\uff1a \u5065\u5eb7\u68c0\u67e5\u662f\u8ba9\u7cfb\u7edf\u77e5\u9053\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\u7684\u4e00\u79cd\u7b80\u5355\u65b9\u5f0f\u3002\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u4e0d\u5de5\u4f5c\uff0c\u5176\u4ed6\u670d\u52a1\u5c31\u4e0d\u5e94\u8be5\u8bbf\u95ee\u5b83\u6216\u5411\u5b83\u53d1\u9001\u8bf7\u6c42\u3002\u76f8\u53cd\uff0c\u5e94\u8be5\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u6b63\u5728\u5de5\u4f5c\u7684\u53e6\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u3002\u7cfb\u7edf\u8fd8\u5e94\u8be5\u5c06\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6062\u590d\u5230\u5065\u5eb7\u72b6\u6001\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684pod\u90fd\u5c06\u91cd\u542f\u7b56\u7565\u8bbe\u7f6e\u4e3aalways\uff0c\u8fd9\u610f\u5473\u7740\u8282\u70b9\u4e0a\u8fd0\u884c\u7684kubelet\u5c06\u5728\u5bb9\u5668\u9047\u5230\u9519\u8bef\u65f6\u81ea\u52a8\u91cd\u542fpod\u3002\u5065\u5eb7\u68c0\u67e5\u901a\u8fc7\u5bb9\u5668\u63a2\u9488\u7684\u6982\u5ff5\u6269\u5c55\u4e86kubelet\u7684\u8fd9\u4e00\u529f\u80fd\u3002</p> </li> </ul> <p>Kubernetes\u63d0\u4f9b\u4e24\u79cd\u5065\u5eb7\u68c0\u67e5:\u5c31\u7eea\u548c\u5b58\u6d3b\u63a2\u9488\u3002\u4f8b\u5982\uff0c\u8003\u8651\u4e00\u4e0b\uff0c\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u4f1a\u957f\u65f6\u95f4\u8fd0\u884c\uff0c\u4f46\u8f6c\u6362\u5230\u975e\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u4e14\u53ea\u80fd\u901a\u8fc7\u91cd\u65b0\u542f\u52a8\u6765\u6062\u590d\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b58\u6d3b\u63a2\u9488\u6765\u68c0\u6d4b\u548c\u8865\u6551\u6b64\u7c7b\u60c5\u51b5\u3002\u4f7f\u7528\u5065\u5eb7\u68c0\u67e5\u53ef\u4ee5\u4e3a\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u66f4\u597d\u7684\u53ef\u9760\u6027\u548c\u66f4\u9ad8\u7684\u6b63\u5e38\u8fd0\u884c\u65f6\u95f4\u3002</p> <ul> <li>\u9ad8\u7ea7\u8c03\u5ea6\u6280\u672f\uff1a \u901a\u5e38\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u786e\u4fdd\u53ea\u5c06pod\u653e\u7f6e\u5728\u6709\u8db3\u591f\u53ef\u7528\u8d44\u6e90\u7684\u8282\u70b9\u4e0a\uff0c\u5e76\u4e14\u5728\u8282\u70b9\u4e4b\u95f4\uff0c\u5b83\u4eec\u4f1a\u5c1d\u8bd5\u5e73\u8861\u8d44\u6e90\u5229\u7528\u7387\uff0c\u4f8b\u5982\u8282\u70b9\u3001\u90e8\u7f72\u3001\u526f\u672c\u7b49\u3002\u4f46\u6709\u65f6\u60a8\u5e0c\u671b\u63a7\u5236\u5982\u4f55\u8c03\u5ea6pod\u3002\u4f8b\u5982\uff0c\u4e5f\u8bb8\u60a8\u5e0c\u671b\u786e\u4fdd\u67d0\u4e9bpod\u53ea\u5728\u5177\u6709\u4e13\u7528\u786c\u4ef6(\u5982GPU\u673a\u5668)\u7684\u8282\u70b9\u4e0a\u8c03\u5ea6\uff0c\u4ee5\u7528\u4e8eML\u5de5\u4f5c\u8d1f\u8f7d\u3002\u6216\u8005\u60a8\u5e0c\u671b\u5c06\u9891\u7e41\u901a\u4fe1\u7684\u670d\u52a1\u653e\u5728\u4e00\u8d77\u3002</li> </ul> <p>Kubernetes\u63d0\u4f9b\u4e86\u8bb8\u591a\u9ad8\u7ea7\u8c03\u5ea6\u529f\u80fd\u548c\u591a\u4e2a\u8fc7\u6ee4\u5668/\u7ea6\u675f\uff0c\u4ee5\u4fbf\u5728\u6b63\u786e\u7684\u8282\u70b9\u4e0a\u8c03\u5ea6pod\u3002\u4f8b\u5982\uff0c\u5728\u4f7f\u7528Amazon EKS\u65f6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6\u6765\u9650\u5236\u54ea\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u4ee5\u5728\u7279\u5b9a\u8282\u70b9\u4e0a\u8fd0\u884c\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u8282\u70b9\u9009\u62e9\u5668\u548c\u4eb2\u548c\u6027\u548c\u53cd\u4eb2\u548c\u6027\u6784\u9020\u6765\u63a7\u5236pod\u8c03\u5ea6\uff0c\u751a\u81f3\u53ef\u4ee5\u4e3a\u6b64\u76ee\u7684\u6784\u5efa\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49\u8c03\u5ea6\u7a0b\u5e8f\u3002</p>"},{"location":"zh/performance/performance/#_8","title":"\u53ef\u6269\u5c55\u6027\u7ba1\u7406","text":"<p>\u5bb9\u5668\u662f\u65e0\u72b6\u6001\u7684\u3002\u5b83\u4eec\u51fa\u751f\u65f6\uff0c\u5f53\u5b83\u4eec\u6b7b\u4ea1\u65f6\uff0c\u5b83\u4eec\u4e0d\u4f1a\u590d\u6d3b\u3002\u60a8\u53ef\u4ee5\u5728Amazon EKS\u4e0a\u5229\u7528\u8bb8\u591a\u6280\u672f\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u6269\u5c55\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd8\u53ef\u4ee5\u6269\u5c55Kubernetes\u5de5\u4f5c\u8282\u70b9\u3002</p>"},{"location":"zh/performance/performance/#_9","title":"\u5efa\u8bae","text":"<ul> <li> <p>\u5728Amazon EKS\u4e0a\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6eHorizontal pod autoscaler,\u5b83\u6839\u636e\u89c2\u5bdf\u5230\u7684CPU\u5229\u7528\u7387(\u6216\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u6807\u57fa\u4e8e\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684\u6307\u6807)\u81ea\u52a8\u6269\u5c55\u590d\u5236\u63a7\u5236\u5668\u3001\u90e8\u7f72\u6216\u526f\u672c\u96c6\u4e2d\u7684pod\u6570\u91cf\u3002</p> </li> <li> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528Vertical Pod Autoscaler,\u5b83\u4f1a\u81ea\u52a8\u8c03\u6574pod\u7684CPU\u548c\u5185\u5b58\u9884\u7559\uff0c\u4ee5\u5e2e\u52a9\"\u6b63\u786e\u8c03\u6574\"\u5e94\u7528\u7a0b\u5e8f\u7684\u5927\u5c0f\u3002\u8fd9\u79cd\u8c03\u6574\u53ef\u4ee5\u63d0\u9ad8\u96c6\u7fa4\u8d44\u6e90\u5229\u7528\u7387\uff0c\u5e76\u4e3a\u5176\u4ed6pod\u91ca\u653eCPU\u548c\u5185\u5b58\u3002\u8fd9\u5728\u8bf8\u5982\u60a8\u7684\u751f\u4ea7\u6570\u636e\u5e93\"MongoDB\"\u4e0e\u65e0\u72b6\u6001\u5e94\u7528\u7a0b\u5e8f\u524d\u7aef\u4e0d\u540c\u65b9\u5f0f\u6269\u5c55\u7684\u60c5\u51b5\u4e0b\u5f88\u6709\u7528\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528VPA\u6765\u6269\u5c55MongoDB Pod\u3002</p> </li> <li> <p>\u8981\u542f\u7528VPA\uff0c\u60a8\u9700\u8981\u4f7f\u7528Kubernetes\u6307\u6807\u670d\u52a1\u5668\uff0c\u5b83\u662f\u96c6\u7fa4\u4e2d\u8d44\u6e90\u4f7f\u7528\u6570\u636e\u7684\u805a\u5408\u5668\u3002\u5b83\u6ca1\u6709\u9ed8\u8ba4\u90e8\u7f72\u5728Amazon EKS\u96c6\u7fa4\u4e2d\u3002\u5728\u914d\u7f6eVPA\u4e4b\u524d\uff0c\u60a8\u9700\u8981\u914d\u7f6e\u5b83\uff0c\u6216\u8005\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528Prometheus\u4e3aVertical Pod Autoscaler\u63d0\u4f9b\u6307\u6807\u3002</p> </li> <li> <p>\u867d\u7136HPA\u548cVPA\u53ef\u4ee5\u6269\u5c55\u90e8\u7f72\u548cpod\uff0c\u4f46Cluster Autoscaler\u5c06\u6269\u5c55\u548c\u7f29\u51cf\u5de5\u4f5c\u8282\u70b9\u6c60\u7684\u5927\u5c0f\u3002\u5b83\u6839\u636e\u5f53\u524d\u5229\u7528\u7387\u8c03\u6574Kubernetes\u96c6\u7fa4\u7684\u5927\u5c0f\u3002\u5f53\u6709pod\u7531\u4e8e\u8d44\u6e90\u4e0d\u8db3\u800c\u65e0\u6cd5\u5728\u4efb\u4f55\u5f53\u524d\u8282\u70b9\u4e0a\u8c03\u5ea6\uff0c\u6216\u8005\u6dfb\u52a0\u65b0\u8282\u70b9\u4f1a\u589e\u52a0\u96c6\u7fa4\u8d44\u6e90\u7684\u6574\u4f53\u53ef\u7528\u6027\u65f6\uff0cCluster Autoscaler\u4f1a\u589e\u52a0\u96c6\u7fa4\u7684\u5927\u5c0f\u3002\u8bf7\u6309\u7167\u6b64\u5206\u6b65\u6307\u5357\u8bbe\u7f6eCluster Autoscaler\u3002\u5982\u679c\u60a8\u5728AWS Fargate\u4e0a\u4f7f\u7528Amazon EKS\uff0cAWS\u5c06\u4e3a\u60a8\u7ba1\u7406\u63a7\u5236\u5e73\u9762\u3002</p> <p>\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b\u53ef\u9760\u6027\u652f\u67f1\u3002</p> </li> </ul>"},{"location":"zh/performance/performance/#_10","title":"\u76d1\u63a7","text":""},{"location":"zh/performance/performance/#_11","title":"\u90e8\u7f72\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"zh/performance/performance/#_12","title":"\u6743\u8861","text":""},{"location":"zh/reliability/docs/","title":"Amazon EKS \u53ef\u9760\u6027\u6700\u4f73\u5b9e\u8df5\u6307\u5357","text":"<p>\u672c\u8282\u63d0\u4f9b\u4e86\u6709\u5173\u4f7f EKS \u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5177\u6709\u5f39\u6027\u548c\u9ad8\u53ef\u7528\u6027\u7684\u6307\u5bfc\u3002</p>"},{"location":"zh/reliability/docs/#_1","title":"\u5982\u4f55\u4f7f\u7528\u672c\u6307\u5357","text":"<p>\u672c\u6307\u5357\u9762\u5411\u5e0c\u671b\u5728 EKS \u4e2d\u5f00\u53d1\u548c\u8fd0\u8425\u9ad8\u53ef\u7528\u4e14\u5bb9\u9519\u7684\u670d\u52a1\u7684\u5f00\u53d1\u4eba\u5458\u548c\u67b6\u6784\u5e08\u3002\u672c\u6307\u5357\u6309\u4e0d\u540c\u4e3b\u9898\u9886\u57df\u7ec4\u7ec7\uff0c\u4ee5\u4fbf\u4e8e\u9605\u8bfb\u3002\u6bcf\u4e2a\u4e3b\u9898\u90fd\u4ee5\u7b80\u8981\u6982\u8ff0\u5f00\u5934\uff0c\u7136\u540e\u5217\u51fa\u4e86\u786e\u4fdd\u60a8\u7684 EKS \u96c6\u7fa4\u53ef\u9760\u6027\u7684\u5efa\u8bae\u548c\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"zh/reliability/docs/#_2","title":"\u7b80\u4ecb","text":"<p>EKS \u7684\u53ef\u9760\u6027\u6700\u4f73\u5b9e\u8df5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u4e3b\u9898\uff1a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f</li> <li>\u63a7\u5236\u5e73\u9762</li> <li>\u6570\u636e\u5e73\u9762</li> </ul> <p>\u4ec0\u4e48\u4f7f\u4e00\u4e2a\u7cfb\u7edf\u53ef\u9760\uff1f\u5982\u679c\u4e00\u4e2a\u7cfb\u7edf\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u80fd\u591f\u6301\u7eed\u8fd0\u884c\u5e76\u6ee1\u8db3\u9700\u6c42\uff0c\u5373\u4f7f\u73af\u5883\u53d1\u751f\u53d8\u5316\uff0c\u5b83\u4e5f\u53ef\u4ee5\u88ab\u79f0\u4e3a\u53ef\u9760\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u70b9\uff0c\u7cfb\u7edf\u5fc5\u987b\u80fd\u591f\u68c0\u6d4b\u6545\u969c\u3001\u81ea\u52a8\u4fee\u590d\u81ea\u8eab\uff0c\u5e76\u5177\u6709\u6839\u636e\u9700\u6c42\u8fdb\u884c\u6269\u5c55\u7684\u80fd\u529b\u3002</p> <p>\u5ba2\u6237\u53ef\u4ee5\u4f7f\u7528 Kubernetes \u4f5c\u4e3a\u8fd0\u884c\u5173\u952e\u4efb\u52a1\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u7684\u53ef\u9760\u57fa\u7840\u3002\u4f46\u9664\u4e86\u91c7\u7528\u57fa\u4e8e\u5bb9\u5668\u7684\u5e94\u7528\u7a0b\u5e8f\u8bbe\u8ba1\u539f\u5219\u5916\uff0c\u53ef\u9760\u5730\u8fd0\u884c\u5de5\u4f5c\u8d1f\u8f7d\u8fd8\u9700\u8981\u53ef\u9760\u7684\u57fa\u7840\u8bbe\u65bd\u3002\u5728 Kubernetes \u4e2d\uff0c\u57fa\u7840\u8bbe\u65bd\u5305\u62ec\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762\u3002</p> <p>EKS \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7ecf\u8fc7\u751f\u4ea7\u7ea7\u522b\u8bbe\u8ba1\u7684\u9ad8\u53ef\u7528\u4e14\u5bb9\u9519\u7684 Kubernetes \u63a7\u5236\u5e73\u9762\u3002</p> <p>\u5728 EKS \u4e2d\uff0cAWS \u8d1f\u8d23 Kubernetes \u63a7\u5236\u5e73\u9762\u7684\u53ef\u9760\u6027\u3002EKS \u5728\u4e00\u4e2a AWS \u533a\u57df\u7684\u4e09\u4e2a\u53ef\u7528\u533a\u4e2d\u8fd0\u884c Kubernetes \u63a7\u5236\u5e73\u9762\u3002\u5b83\u81ea\u52a8\u7ba1\u7406 Kubernetes API \u670d\u52a1\u5668\u548c etcd \u96c6\u7fa4\u7684\u53ef\u7528\u6027\u548c\u53ef\u6269\u5c55\u6027\u3002</p> <p>\u6570\u636e\u5e73\u9762\u7684\u53ef\u9760\u6027\u8d23\u4efb\u5728\u60a8(\u5ba2\u6237)\u548c AWS \u4e4b\u95f4\u5171\u4eab\u3002EKS \u4e3a Kubernetes \u6570\u636e\u5e73\u9762\u63d0\u4f9b\u4e86\u4e09\u79cd\u9009\u62e9\u3002Fargate \u662f\u6700\u53d7\u7ba1\u7406\u7684\u9009\u9879\uff0c\u8d1f\u8d23\u6570\u636e\u5e73\u9762\u7684\u4f9b\u5e94\u548c\u6269\u5c55\u3002\u7b2c\u4e8c\u4e2a\u9009\u9879\u662f\u6258\u7ba1\u8282\u70b9\u7ec4\uff0c\u8d1f\u8d23\u6570\u636e\u5e73\u9762\u7684\u4f9b\u5e94\u548c\u66f4\u65b0\u3002\u6700\u540e\uff0c\u81ea\u7ba1\u7406\u8282\u70b9\u662f\u6570\u636e\u5e73\u9762\u6700\u4e0d\u53d7\u7ba1\u7406\u7684\u9009\u9879\u3002\u60a8\u4f7f\u7528\u7684 AWS \u7ba1\u7406\u6570\u636e\u5e73\u9762\u8d8a\u591a\uff0c\u60a8\u627f\u62c5\u7684\u8d23\u4efb\u5c31\u8d8a\u5c11\u3002</p> <p>\u6258\u7ba1\u8282\u70b9\u7ec4\u81ea\u52a8\u6267\u884c EC2 \u8282\u70b9\u7684\u4f9b\u5e94\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 EKS API (\u901a\u8fc7 EKS \u63a7\u5236\u53f0\u3001AWS API\u3001AWS CLI\u3001CloudFormation\u3001Terraform \u6216 <code>eksctl</code>)\u6765\u521b\u5efa\u3001\u6269\u5c55\u548c\u5347\u7ea7\u6258\u7ba1\u8282\u70b9\u3002\u6258\u7ba1\u8282\u70b9\u5728\u60a8\u7684\u8d26\u6237\u4e2d\u8fd0\u884c EKS \u4f18\u5316\u7684 Amazon Linux 2 EC2 \u5b9e\u4f8b\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u542f\u7528 SSH \u8bbf\u95ee\u6765\u5b89\u88c5\u81ea\u5b9a\u4e49\u8f6f\u4ef6\u5305\u3002\u5f53\u60a8\u4f9b\u5e94\u6258\u7ba1\u8282\u70b9\u65f6\uff0c\u5b83\u4eec\u5c06\u4f5c\u4e3a EKS \u7ba1\u7406\u7684 Auto Scaling \u7ec4\u7684\u4e00\u90e8\u5206\u8fd0\u884c\uff0c\u8be5\u7ec4\u53ef\u8de8\u591a\u4e2a\u53ef\u7528\u533a;\u60a8\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u6258\u7ba1\u8282\u70b9\u65f6\u63d0\u4f9b\u7684\u5b50\u7f51\u6765\u63a7\u5236\u8fd9\u4e00\u70b9\u3002EKS \u8fd8\u4f1a\u81ea\u52a8\u4e3a\u6258\u7ba1\u8282\u70b9\u6dfb\u52a0\u6807\u7b7e\uff0c\u4ee5\u4fbf\u4e0e\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u4e00\u8d77\u4f7f\u7528\u3002</p> <p>Amazon EKS \u9075\u5faa\u6258\u7ba1\u8282\u70b9\u7ec4\u7684 CVE \u548c\u5b89\u5168\u8865\u4e01\u7684\u5171\u4eab\u8d23\u4efb\u6a21\u578b\u3002\u7531\u4e8e\u6258\u7ba1\u8282\u70b9\u8fd0\u884c Amazon EKS \u4f18\u5316\u7684 AMI\uff0c\u56e0\u6b64\u5f53\u6709\u9519\u8bef\u4fee\u590d\u65f6\uff0cAmazon EKS \u8d1f\u8d23\u6784\u5efa\u8fd9\u4e9b AMI \u7684\u4fee\u8865\u7248\u672c\u3002\u4f46\u662f\uff0c\u60a8\u8d1f\u8d23\u5c06\u8fd9\u4e9b\u4fee\u8865\u540e\u7684 AMI \u7248\u672c\u90e8\u7f72\u5230\u60a8\u7684\u6258\u7ba1\u8282\u70b9\u7ec4\u3002</p> <p>EKS \u8fd8\u7ba1\u7406\u8282\u70b9\u7684\u66f4\u65b0,\u5c3d\u7ba1\u60a8\u5fc5\u987b\u542f\u52a8\u66f4\u65b0\u8fc7\u7a0b\u3002\u66f4\u65b0\u6258\u7ba1\u8282\u70b9\u7684\u8fc7\u7a0b\u5728 EKS \u6587\u6863\u4e2d\u6709\u89e3\u91ca\u3002</p> <p>\u5982\u679c\u60a8\u8fd0\u884c\u81ea\u7ba1\u7406\u8282\u70b9\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Amazon EKS \u4f18\u5316\u7684 Linux AMI \u6765\u521b\u5efa\u5de5\u4f5c\u8282\u70b9\u3002\u60a8\u8d1f\u8d23\u5bf9 AMI \u548c\u8282\u70b9\u8fdb\u884c\u4fee\u8865\u548c\u5347\u7ea7\u3002\u4f7f\u7528 <code>eksctl</code>\u3001CloudFormation \u6216\u57fa\u7840\u8bbe\u65bd\u4f5c\u4e3a\u4ee3\u7801\u5de5\u5177\u6765\u4f9b\u5e94\u81ea\u7ba1\u7406\u8282\u70b9\u662f\u6700\u4f73\u5b9e\u8df5\uff0c\u56e0\u4e3a\u8fd9\u5c06\u4f7f\u60a8\u66f4\u5bb9\u6613\u5347\u7ea7\u81ea\u7ba1\u7406\u8282\u70b9\u3002\u5728\u66f4\u65b0\u5de5\u4f5c\u8282\u70b9\u65f6\uff0c\u8bf7\u8003\u8651\u8fc1\u79fb\u5230\u65b0\u8282\u70b9,\u56e0\u4e3a\u8fc1\u79fb\u8fc7\u7a0b\u4f1a\u5728\u65b0\u5806\u6808\u51c6\u5907\u597d\u63a5\u53d7\u73b0\u6709 pod \u5de5\u4f5c\u8d1f\u8f7d\u540e\uff0c\u5c06\u65e7\u8282\u70b9\u7ec4\u6807\u8bb0\u4e3a <code>NoSchedule</code> \u5e76\u6392\u7a7a\u8282\u70b9\u3002\u4f46\u662f\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5bf9\u81ea\u7ba1\u7406\u8282\u70b9\u6267\u884c\u5c31\u5730\u5347\u7ea7\u3002</p> <p></p> <p></p> <p>\u672c\u6307\u5357\u5305\u542b\u4e86\u4e00\u7cfb\u5217\u5efa\u8bae\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u5efa\u8bae\u6765\u63d0\u9ad8 EKS \u6570\u636e\u5e73\u9762\u3001Kubernetes \u6838\u5fc3\u7ec4\u4ef6\u548c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u9760\u6027\u3002</p>"},{"location":"zh/reliability/docs/#_3","title":"\u53cd\u9988","text":"<p>\u672c\u6307\u5357\u5728 GitHub \u4e0a\u53d1\u5e03\uff0c\u65e8\u5728\u6536\u96c6\u6765\u81ea\u66f4\u5e7f\u6cdb\u7684 EKS/Kubernetes \u793e\u533a\u7684\u76f4\u63a5\u53cd\u9988\u548c\u5efa\u8bae\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u8ba4\u4e3a\u6211\u4eec\u5e94\u8be5\u5728\u6307\u5357\u4e2d\u5305\u542b\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u8bf7\u5728 GitHub \u5b58\u50a8\u5e93\u4e2d\u63d0\u51fa\u95ee\u9898\u6216\u63d0\u4ea4 PR\u3002\u6211\u4eec\u6253\u7b97\u5728\u670d\u52a1\u6dfb\u52a0\u65b0\u529f\u80fd\u6216\u51fa\u73b0\u65b0\u7684\u6700\u4f73\u5b9e\u8df5\u65f6\uff0c\u5b9a\u671f\u66f4\u65b0\u672c\u6307\u5357\u3002</p>"},{"location":"zh/reliability/docs/application/","title":"\u8fd0\u884c\u9ad8\u53ef\u7528\u6027\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u60a8\u7684\u5ba2\u6237\u671f\u671b\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u968f\u65f6\u53ef\u7528\uff0c\u5305\u62ec\u5728\u60a8\u8fdb\u884c\u66f4\u6539\u65f6\uff0c\u5c24\u5176\u662f\u5728\u6d41\u91cf\u9ad8\u5cf0\u671f\u95f4\u3002\u53ef\u6269\u5c55\u4e14\u6709\u5f39\u6027\u7684\u67b6\u6784\u53ef\u786e\u4fdd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u6301\u7eed\u8fd0\u884c\u800c\u4e0d\u4e2d\u65ad\uff0c\u4ece\u800c\u8ba9\u60a8\u7684\u7528\u6237\u6ee1\u610f\u3002\u53ef\u6269\u5c55\u7684\u57fa\u7840\u67b6\u6784\u53ef\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8fdb\u884c\u6269\u5c55\u548c\u7f29\u51cf\u3002\u6d88\u9664\u5355\u70b9\u6545\u969c\u662f\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u6027\u548c\u4f7f\u5176\u5177\u6709\u5f39\u6027\u7684\u5173\u952e\u4e00\u6b65\u3002</p> <p>\u901a\u8fc7Kubernetes\uff0c\u60a8\u53ef\u4ee5\u4ee5\u9ad8\u53ef\u7528\u4e14\u6709\u5f39\u6027\u7684\u65b9\u5f0f\u8fd0\u884c\u548c\u64cd\u4f5c\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u7684\u58f0\u660e\u5f0f\u7ba1\u7406\u53ef\u786e\u4fdd\u4e00\u65e6\u8bbe\u7f6e\u4e86\u5e94\u7528\u7a0b\u5e8f\uff0cKubernetes\u5c06\u4e0d\u65ad\u5c1d\u8bd5\u4f7f\u5f53\u524d\u72b6\u6001\u4e0e\u671f\u671b\u72b6\u6001\u76f8\u5339\u914d\u3002</p>"},{"location":"zh/reliability/docs/application/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/reliability/docs/application/#pod","title":"\u907f\u514d\u8fd0\u884c\u5355\u4e2aPod","text":"<p>\u5982\u679c\u60a8\u7684\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5728\u5355\u4e2aPod\u4e2d\u8fd0\u884c\uff0c\u90a3\u4e48\u5982\u679c\u8be5Pod\u88ab\u7ec8\u6b62\uff0c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u65e0\u6cd5\u4f7f\u7528\u3002\u4e0d\u8981\u4f7f\u7528\u5355\u4e2aPod\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u662f\u521b\u5efaDeployment\u3002\u5982\u679c\u7531Deployment\u521b\u5efa\u7684Pod\u5931\u8d25\u6216\u88ab\u7ec8\u6b62\uff0cDeployment \u63a7\u5236\u5668\u5c06\u542f\u52a8\u4e00\u4e2a\u65b0\u7684Pod\u4ee5\u786e\u4fdd\u6307\u5b9a\u6570\u91cf\u7684\u526f\u672cPod\u59cb\u7ec8\u8fd0\u884c\u3002</p>"},{"location":"zh/reliability/docs/application/#_3","title":"\u8fd0\u884c\u591a\u4e2a\u526f\u672c","text":"<p>\u4f7f\u7528Deployment\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u591a\u4e2a\u526f\u672cPod\u6709\u52a9\u4e8e\u4ee5\u9ad8\u53ef\u7528\u7684\u65b9\u5f0f\u8fd0\u884c\u3002\u5982\u679c\u4e00\u4e2a\u526f\u672c\u5931\u8d25\uff0c\u5176\u4f59\u526f\u672c\u4ecd\u5c06\u7ee7\u7eed\u8fd0\u884c\uff0c\u5c3d\u7ba1\u5bb9\u91cf\u4f1a\u964d\u4f4e\uff0c\u76f4\u5230Kubernetes\u521b\u5efa\u53e6\u4e00\u4e2aPod\u6765\u5f25\u8865\u635f\u5931\u3002\u6b64\u5916\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528Horizontal Pod Autoscaler\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u81ea\u52a8\u6269\u5c55\u526f\u672c\u3002</p>"},{"location":"zh/reliability/docs/application/#_4","title":"\u8de8\u8282\u70b9\u8c03\u5ea6\u526f\u672c","text":"<p>\u5982\u679c\u6240\u6709\u526f\u672c\u90fd\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u800c\u8be5\u8282\u70b9\u53d8\u5f97\u4e0d\u53ef\u7528\uff0c\u5219\u8fd0\u884c\u591a\u4e2a\u526f\u672c\u5c31\u6ca1\u6709\u592a\u5927\u7528\u5904\u3002\u8003\u8651\u4f7f\u7528Pod\u53cd\u4eb2\u548c\u6027\u6216Pod\u62d3\u6251\u6269\u5c55\u7ea6\u675f\u5c06Deployment\u7684\u526f\u672c\u5206\u5e03\u5728\u591a\u4e2a\u5de5\u4f5c\u8282\u70b9\u4e0a\u3002</p> <p>\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u8fd0\u884c\u6765\u8fdb\u4e00\u6b65\u63d0\u9ad8\u5178\u578b\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u9760\u6027\u3002</p>"},{"location":"zh/reliability/docs/application/#pod_1","title":"\u4f7f\u7528Pod\u53cd\u4eb2\u548c\u6027\u89c4\u5219","text":"<p>\u4e0b\u9762\u7684\u6e05\u5355\u544a\u8bc9Kubernetes\u8c03\u5ea6\u5668\u4f18\u5148\u5c06Pod\u653e\u7f6e\u5728\u4e0d\u540c\u7684\u8282\u70b9\u548c\u53ef\u7528\u533a\u4e0a\u3002\u5b83\u4e0d\u8981\u6c42\u4f7f\u7528\u4e0d\u540c\u7684\u8282\u70b9\u6216\u53ef\u7528\u533a\uff0c\u56e0\u4e3a\u5982\u679c\u8fd9\u6837\u505a\uff0c\u4e00\u65e6\u6bcf\u4e2a\u53ef\u7528\u533a\u90fd\u6709\u4e00\u4e2aPod\u5728\u8fd0\u884c\uff0cKubernetes\u5c31\u65e0\u6cd5\u518d\u8c03\u5ea6\u4efb\u4f55Pod\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u8981\u4e09\u4e2a\u526f\u672c\uff0c\u60a8\u53ef\u4ee5\u5bf9<code>topologyKey: topology.kubernetes.io/zone</code>\u4f7f\u7528<code>requiredDuringSchedulingIgnoredDuringExecution</code>,Kubernetes\u8c03\u5ea6\u5668\u5c06\u4e0d\u4f1a\u5728\u540c\u4e00\u4e2a\u53ef\u7528\u533a\u4e2d\u8c03\u5ea6\u4e24\u4e2aPod\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spread-host-az\n  labels:\n    app: web-server\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      affinity:\n        podAntiAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: topology.kubernetes.io/zone\n            weight: 100\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: kubernetes.io/hostname \n            weight: 99\n      containers:\n      - name: web-app\n        image: nginx:1.16-alpine\n</code></pre>"},{"location":"zh/reliability/docs/application/#pod_2","title":"\u4f7f\u7528Pod\u62d3\u6251\u6269\u5c55\u7ea6\u675f","text":"<p>\u4e0ePod\u53cd\u4eb2\u548c\u6027\u89c4\u5219\u7c7b\u4f3c\uff0cPod\u62d3\u6251\u6269\u5c55\u7ea6\u675f\u5141\u8bb8\u60a8\u4f7f\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u8de8\u4e0d\u540c\u7684\u6545\u969c(\u6216\u62d3\u6251)\u57df(\u5982\u4e3b\u673a\u6216\u53ef\u7528\u533a)\u53ef\u7528\u3002\u5f53\u60a8\u8bd5\u56fe\u786e\u4fdd\u5bb9\u9519\u4ee5\u53ca\u901a\u8fc7\u5728\u4e0d\u540c\u7684\u62d3\u6251\u57df\u4e2d\u62e5\u6709\u591a\u4e2a\u526f\u672c\u6765\u5b9e\u73b0\u53ef\u7528\u6027\u65f6\uff0c\u8fd9\u79cd\u65b9\u6cd5\u975e\u5e38\u6709\u6548\u3002\u53e6\u4e00\u65b9\u9762\uff0cPod\u53cd\u4eb2\u548c\u6027\u89c4\u5219\u5f88\u5bb9\u6613\u4ea7\u751f\u5728\u62d3\u6251\u57df\u4e2d\u53ea\u6709\u5355\u4e2a\u526f\u672c\u7684\u7ed3\u679c\uff0c\u56e0\u4e3a\u5177\u6709\u53cd\u4eb2\u548c\u6027\u7684Pod\u5f7c\u6b64\u5177\u6709\u6392\u65a5\u6548\u5e94\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e13\u7528\u8282\u70b9\u4e0a\u7684\u5355\u4e2a\u526f\u672c\u5bf9\u4e8e\u5bb9\u9519\u548c\u8d44\u6e90\u5229\u7528\u7387\u90fd\u4e0d\u7406\u60f3\u3002\u4f7f\u7528\u62d3\u6251\u6269\u5c55\u7ea6\u675f\uff0c\u60a8\u53ef\u4ee5\u66f4\u597d\u5730\u63a7\u5236\u8c03\u5ea6\u7a0b\u5e8f\u5e94\u8be5\u5c1d\u8bd5\u5728\u62d3\u6251\u57df\u4e2d\u5e94\u7528\u7684\u6269\u5c55\u6216\u5206\u5e03\u3002\u5728\u8fd9\u79cd\u65b9\u6cd5\u4e2d\uff0c\u4e00\u4e9b\u91cd\u8981\u7684\u5c5e\u6027\u5305\u62ec\uff1a 1. <code>maxSkew</code>\u7528\u4e8e\u63a7\u5236\u6216\u786e\u5b9a\u8de8\u62d3\u6251\u57df\u7684\u6700\u5927\u4e0d\u5747\u8861\u7a0b\u5ea6\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u670910\u4e2a\u526f\u672c\uff0c\u5e76\u90e8\u7f72\u57283\u4e2a\u53ef\u7528\u533a\u4e2d\uff0c\u60a8\u65e0\u6cd5\u83b7\u5f97\u5747\u5300\u7684\u5206\u5e03\uff0c\u4f46\u53ef\u4ee5\u5f71\u54cd\u5206\u5e03\u7684\u4e0d\u5747\u8861\u7a0b\u5ea6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c<code>maxSkew</code>\u53ef\u4ee5\u662f1\u523010\u4e4b\u95f4\u7684\u4efb\u4f55\u503c\u3002\u503c\u4e3a1\u610f\u5473\u7740\u60a8\u53ef\u80fd\u6700\u7ec8\u4f1a\u57283\u4e2a\u53ef\u7528\u533a\u4e2d\u83b7\u5f97\u8bf8\u5982<code>4,3,3</code>\u3001<code>3,4,3</code>\u6216<code>3,3,4</code>\u7684\u5206\u5e03\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u503c\u4e3a10\u610f\u5473\u7740\u60a8\u53ef\u80fd\u6700\u7ec8\u4f1a\u57283\u4e2a\u53ef\u7528\u533a\u4e2d\u83b7\u5f97\u8bf8\u5982<code>10,0,0</code>\u3001<code>0,10,0</code>\u6216<code>0,0,10</code>\u7684\u5206\u5e03\u3002 2. <code>topologyKey</code>\u662f\u8282\u70b9\u6807\u7b7e\u4e4b\u4e00\u7684\u952e\uff0c\u5b9a\u4e49\u4e86\u5e94\u8be5\u7528\u4e8ePod\u5206\u5e03\u7684\u62d3\u6251\u57df\u7c7b\u578b\u3002\u4f8b\u5982\uff0c\u533a\u57df\u5206\u5e03\u5c06\u5177\u6709\u4ee5\u4e0b\u952e\u503c\u5bf9\uff1a <pre><code>topologyKey: \"topology.kubernetes.io/zone\"\n</code></pre> 3. <code>whenUnsatisfiable</code>\u5c5e\u6027\u7528\u4e8e\u786e\u5b9a\u5982\u679c\u65e0\u6cd5\u6ee1\u8db3\u6240\u9700\u7ea6\u675f\u65f6\u60a8\u5e0c\u671b\u8c03\u5ea6\u7a0b\u5e8f\u5982\u4f55\u54cd\u5e94\u3002 4. <code>labelSelector</code>\u7528\u4e8e\u67e5\u627e\u5339\u914d\u7684Pod\uff0c\u4ee5\u4fbf\u8c03\u5ea6\u7a0b\u5e8f\u5728\u6839\u636e\u60a8\u6307\u5b9a\u7684\u7ea6\u675f\u51b3\u5b9a\u653e\u7f6ePod\u7684\u4f4d\u7f6e\u65f6\u53ef\u4ee5\u4e86\u89e3\u5b83\u4eec\u3002</p> <p>\u9664\u4e86\u4e0a\u8ff0\u5185\u5bb9\u4e4b\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5728Kubernetes\u6587\u6863\u4e2d\u8fdb\u4e00\u6b65\u9605\u8bfb\u5176\u4ed6\u5b57\u6bb5\u3002</p> <p></p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spread-host-az\n  labels:\n    app: web-server\nspec:\n  replicas: 10\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      topologySpreadConstraints:\n      - maxSkew: 1\n        topologyKey: \"topology.kubernetes.io/zone\"\n        whenUnsatisfiable: ScheduleAnyway\n        labelSelector:\n          matchLabels:\n            app: express-test\n      containers:\n      - name: web-app\n        image: nginx:1.16-alpine\n</code></pre>"},{"location":"zh/reliability/docs/application/#kubernetes-metrics-server","title":"\u8fd0\u884cKubernetes Metrics Server","text":"<p>\u5b89\u88c5Kubernetes metrics server\u4ee5\u5e2e\u52a9\u6269\u5c55\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002Kubernetes\u81ea\u52a8\u6269\u7f29\u5668\u63d2\u4ef6\u5982HPA\u548cVPA\u9700\u8981\u8ddf\u8e2a\u5e94\u7528\u7a0b\u5e8f\u6307\u6807\u4ee5\u5bf9\u5176\u8fdb\u884c\u6269\u7f29\u3002metrics-server\u4ecekubelet\u6536\u96c6\u8d44\u6e90\u6307\u6807\uff0c\u5e76\u4ee5Metrics API\u683c\u5f0f\u63d0\u4f9b\u670d\u52a1\u3002</p> <p>metrics-server\u4e0d\u4f1a\u4fdd\u7559\u4efb\u4f55\u6570\u636e\uff0c\u4e5f\u4e0d\u662f\u76d1\u63a7\u89e3\u51b3\u65b9\u6848\u3002\u5b83\u7684\u76ee\u7684\u662f\u5411\u5176\u4ed6\u7cfb\u7edf\u516c\u5f00CPU\u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u6307\u6807\u3002\u5982\u679c\u60a8\u60f3\u8ddf\u8e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\u968f\u65f6\u95f4\u7684\u53d8\u5316\uff0c\u60a8\u9700\u8981\u4e00\u4e2a\u76d1\u63a7\u5de5\u5177\uff0c\u5982Prometheus\u6216Amazon CloudWatch\u3002</p> <p>\u8bf7\u6309\u7167EKS\u6587\u6863\u5728\u60a8\u7684EKS\u96c6\u7fa4\u4e2d\u5b89\u88c5metrics-server\u3002</p>"},{"location":"zh/reliability/docs/application/#podhpa","title":"\u6c34\u5e73Pod\u81ea\u52a8\u7f29\u653e\u5668(HPA)","text":"<p>HPA\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u81ea\u52a8\u6269\u7f29\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e2e\u52a9\u60a8\u907f\u514d\u5728\u9ad8\u5cf0\u6d41\u91cf\u671f\u95f4\u5f71\u54cd\u5ba2\u6237\u3002\u5b83\u662fKubernetes\u4e2d\u7684\u4e00\u4e2a\u63a7\u5236\u5faa\u73af\uff0c\u5b9a\u671f\u4ece\u63d0\u4f9b\u8d44\u6e90\u6307\u6807\u7684API\u67e5\u8be2\u6307\u6807\u3002</p> <p>HPA\u53ef\u4ee5\u4ece\u4ee5\u4e0bAPI\u68c0\u7d22\u6307\u6807\uff1a 1. <code>metrics.k8s.io</code>,\u4e5f\u79f0\u4e3a\u8d44\u6e90\u6307\u6807API - \u63d0\u4f9bPod\u7684CPU\u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5 2. <code>custom.metrics.k8s.io</code> - \u4ece\u5176\u4ed6\u6307\u6807\u6536\u96c6\u5668(\u5982Prometheus)\u63d0\u4f9b\u6307\u6807;\u8fd9\u4e9b\u6307\u6807\u662f\u60a8\u7684Kubernetes\u96c6\u7fa4\u7684__\u5185\u90e8__\u6307\u6807\u3002 3. <code>external.metrics.k8s.io</code> - \u63d0\u4f9b\u60a8\u7684Kubernetes\u96c6\u7fa4__\u5916\u90e8__\u7684\u6307\u6807(\u4f8b\u5982\uff0cSQS\u961f\u5217\u6df1\u5ea6\u3001ELB\u5ef6\u8fdf)\u3002</p> <p>\u60a8\u5fc5\u987b\u4f7f\u7528\u8fd9\u4e09\u4e2aAPI\u4e2d\u7684\u4e00\u4e2a\u6765\u63d0\u4f9b\u6307\u6807\uff0c\u4ee5\u6269\u7f29\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"zh/reliability/docs/application/#_5","title":"\u57fa\u4e8e\u81ea\u5b9a\u4e49\u6216\u5916\u90e8\u6307\u6807\u6269\u7f29\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u6216\u5916\u90e8\u6307\u6807\u6839\u636eCPU\u6216\u5185\u5b58\u5229\u7528\u7387\u4ee5\u5916\u7684\u6307\u6807\u6269\u7f29\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u81ea\u5b9a\u4e49\u6307\u6807API\u670d\u52a1\u5668\u63d0\u4f9bHPA\u53ef\u7528\u4e8e\u81ea\u52a8\u6269\u7f29\u5e94\u7528\u7a0b\u5e8f\u7684<code>custom-metrics.k8s.io</code>API\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528Kubernetes\u6307\u6807API\u7684Prometheus Adapter\u4ecePrometheus\u6536\u96c6\u6307\u6807\u5e76\u4e0eHPA\u4e00\u8d77\u4f7f\u7528\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cPrometheus adapter\u5c06\u4ee5Metrics API\u683c\u5f0f\u516c\u5f00Prometheus\u6307\u6807\u3002</p> <p>\u4e00\u65e6\u90e8\u7f72\u4e86Prometheus Adapter\uff0c\u60a8\u5c31\u53ef\u4ee5\u4f7f\u7528kubectl\u67e5\u8be2\u81ea\u5b9a\u4e49\u6307\u6807\u3002 <code>kubectl get --raw /apis/custom.metrics.k8s.io/v1beta1/</code></p> <p>\u5916\u90e8\u6307\u6807\u987e\u540d\u601d\u4e49\uff0c\u4e3a\u6c34\u5e73Pod\u81ea\u52a8\u7f29\u653e\u5668\u63d0\u4f9b\u4e86\u6839\u636eKubernetes\u96c6\u7fa4\u5916\u90e8\u7684\u6307\u6807\u6269\u7f29Deployment\u7684\u80fd\u529b\u3002\u4f8b\u5982\uff0c\u5728\u6279\u5904\u7406\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\uff0c\u901a\u5e38\u9700\u8981\u6839\u636eSQS\u961f\u5217\u4e2d\u7684\u4f5c\u4e1a\u6570\u91cf\u6765\u6269\u7f29\u526f\u672c\u6570\u91cf\u3002</p> <p>\u8981\u57fa\u4e8eCloudWatch\u6307\u6807(\u4f8b\u5982\u57fa\u4e8eSQS\u961f\u5217\u6df1\u5ea6\u6269\u7f29\u6279\u5904\u7406\u5904\u7406\u5668\u5e94\u7528\u7a0b\u5e8f)\u81ea\u52a8\u6269\u7f29Deployment\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528<code>k8s-cloudwatch-adapter</code>\u3002<code>k8s-cloudwatch-adapter</code>\u662f\u4e00\u4e2a\u793e\u533a\u9879\u76ee\uff0c\u4e0d\u7531AWS\u7ef4\u62a4\u3002</p>"},{"location":"zh/reliability/docs/application/#podvpa","title":"\u5782\u76f4Pod\u81ea\u52a8\u7f29\u653e\u5668(VPA)","text":"<p>VPA\u53ef\u4ee5\u81ea\u52a8\u8c03\u6574Pod\u7684CPU\u548c\u5185\u5b58\u9884\u7559\uff0c\u5e2e\u52a9\u60a8\"\u6b63\u786e\u8c03\u6574\"\u5e94\u7528\u7a0b\u5e8f\u7684\u5927\u5c0f\u3002\u5bf9\u4e8e\u9700\u8981\u5782\u76f4\u6269\u7f29\u7684\u5e94\u7528\u7a0b\u5e8f(\u901a\u8fc7\u589e\u52a0\u8d44\u6e90\u5206\u914d\u6765\u5b9e\u73b0)\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528VPA\u81ea\u52a8\u6269\u7f29Pod\u526f\u672c\u6216\u63d0\u4f9b\u6269\u7f29\u5efa\u8bae\u3002</p> <p>\u5982\u679cVPA\u9700\u8981\u6269\u7f29\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528\uff0c\u56e0\u4e3aVPA\u5f53\u524d\u7684\u5b9e\u73b0\u4e0d\u4f1a\u5c31\u5730\u8c03\u6574Pod;\u76f8\u53cd\uff0c\u5b83\u5c06\u91cd\u65b0\u521b\u5efa\u9700\u8981\u6269\u7f29\u7684Pod\u3002</p> <p>EKS\u6587\u6863\u5305\u542b\u4e86\u8bbe\u7f6eVPA\u7684\u5206\u6b65\u6307\u5357\u3002</p> <p>Fairwinds Goldilocks\u9879\u76ee\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4eea\u8868\u677f\uff0c\u7528\u4e8e\u53ef\u89c6\u5316VPA\u5bf9CPU\u548c\u5185\u5b58\u8bf7\u6c42\u548c\u9650\u5236\u7684\u5efa\u8bae\u3002\u5b83\u7684VPA\u66f4\u65b0\u6a21\u5f0f\u5141\u8bb8\u60a8\u6839\u636eVPA\u5efa\u8bae\u81ea\u52a8\u6269\u7f29Pod\u3002</p>"},{"location":"zh/reliability/docs/application/#_6","title":"\u66f4\u65b0\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u73b0\u4ee3\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u5feb\u901f\u521b\u65b0\uff0c\u540c\u65f6\u5177\u6709\u9ad8\u5ea6\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u7528\u6027\u3002Kubernetes\u4e3a\u60a8\u63d0\u4f9b\u4e86\u5de5\u5177\uff0c\u53ef\u4ee5\u4e0d\u4e2d\u65ad\u5ba2\u6237\u7684\u60c5\u51b5\u4e0b\u6301\u7eed\u66f4\u65b0\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4e00\u4e9b\u6700\u4f73\u5b9e\u8df5\uff0c\u8fd9\u4e9b\u5b9e\u8df5\u4f7f\u60a8\u80fd\u591f\u5feb\u901f\u90e8\u7f72\u66f4\u6539\u800c\u4e0d\u727a\u7272\u53ef\u7528\u6027\u3002</p>"},{"location":"zh/reliability/docs/application/#_7","title":"\u62e5\u6709\u6267\u884c\u56de\u6eda\u7684\u673a\u5236","text":"<p>\u62e5\u6709\u4e00\u4e2a\u64a4\u9500\u6309\u94ae\u53ef\u4ee5\u907f\u514d\u707e\u96be\u3002\u5728\u66f4\u65b0\u751f\u4ea7\u96c6\u7fa4\u4e4b\u524d\uff0c\u5728\u5355\u72ec\u7684\u8f83\u4f4e\u73af\u5883(\u6d4b\u8bd5\u6216\u5f00\u53d1\u73af\u5883)\u4e2d\u6d4b\u8bd5\u90e8\u7f72\u662f\u4e00\u79cd\u6700\u4f73\u5b9e\u8df5\u3002\u4f7f\u7528CI/CD\u7ba1\u9053\u53ef\u4ee5\u5e2e\u52a9\u60a8\u81ea\u52a8\u5316\u548c\u6d4b\u8bd5\u90e8\u7f72\u3002\u901a\u8fc7\u6301\u7eed\u90e8\u7f72\u7ba1\u9053\uff0c\u5982\u679c\u5347\u7ea7\u51fa\u73b0\u7f3a\u9677\uff0c\u60a8\u53ef\u4ee5\u5feb\u901f\u56de\u6eda\u5230\u65e7\u7248\u672c\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528Deployment\u6765\u66f4\u65b0\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u901a\u5e38\u662f\u901a\u8fc7\u66f4\u65b0\u5bb9\u5668\u955c\u50cf\u6765\u5b8c\u6210\u7684\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528<code>kubectl</code>\u66f4\u65b0Deployment\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>kubectl --record deployment.apps/nginx-deployment set image nginx-deployment nginx=nginx:1.16.1\n</code></pre> <p><code>--record</code>\u53c2\u6570\u8bb0\u5f55\u5bf9Deployment\u7684\u66f4\u6539\uff0c\u5982\u679c\u60a8\u9700\u8981\u6267\u884c\u56de\u6eda\uff0c\u8fd9\u5c06\u5f88\u6709\u5e2e\u52a9\u3002<code>kubectl rollout history deployment</code>\u663e\u793a\u60a8\u96c6\u7fa4\u4e2d\u5bf9Deployment\u7684\u8bb0\u5f55\u66f4\u6539\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528<code>kubectl rollout undo deployment &lt;DEPLOYMENT_NAME&gt;</code>\u56de\u6eda\u66f4\u6539\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u60a8\u66f4\u65b0\u9700\u8981\u91cd\u65b0\u521b\u5efaPod\u7684Deployment\u65f6\uff0cDeployment\u5c06\u6267\u884c\u6eda\u52a8\u66f4\u65b0\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cKubernetes\u5c06\u53ea\u66f4\u65b0Deployment\u4e2d\u8fd0\u884c\u7684\u4e00\u90e8\u5206Pod\uff0c\u800c\u4e0d\u662f\u6240\u6709Pod\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7<code>RollingUpdateStrategy</code>\u5c5e\u6027\u63a7\u5236Kubernetes\u6267\u884c\u6eda\u52a8\u66f4\u65b0\u7684\u65b9\u5f0f\u3002</p> <p>\u5728\u6267\u884cDeployment\u7684\u6eda\u52a8\u66f4\u65b0\u65f6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528<code>Max Unavailable</code>\u5c5e\u6027\u6307\u5b9a\u5728\u66f4\u65b0\u671f\u95f4\u53ef\u4ee5\u4e0d\u53ef\u7528\u7684\u6700\u5927Pod\u6570\u91cf\u3002Deployment\u7684<code>Max Surge</code>\u5c5e\u6027\u5141\u8bb8\u60a8\u8bbe\u7f6e\u53ef\u4ee5\u8d85\u8fc7\u6240\u9700Pod\u6570\u91cf\u521b\u5efa\u7684\u6700\u5927Pod\u6570\u91cf\u3002</p> <p>\u8003\u8651\u8c03\u6574<code>max unavailable</code>\u4ee5\u786e\u4fdd\u6eda\u52a8\u66f4\u65b0\u4e0d\u4f1a\u4e2d\u65ad\u60a8\u7684\u5ba2\u6237\u3002\u4f8b\u5982\uff0cKubernetes\u9ed8\u8ba4\u8bbe\u7f6e25%\u7684<code>max unavailable</code>,\u8fd9\u610f\u5473\u7740\u5982\u679c\u60a8\u6709100\u4e2aPod\uff0c\u5728\u6eda\u52a8\u66f4\u65b0\u671f\u95f4\u53ef\u80fd\u53ea\u670975\u4e2aPod\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u81f3\u5c1180\u4e2aPod\uff0c\u8fd9\u79cd\u6eda\u52a8\u66f4\u65b0\u53ef\u80fd\u4f1a\u9020\u6210\u4e2d\u65ad\u3002\u76f8\u53cd\uff0c\u60a8\u53ef\u4ee5\u5c06<code>max unavailable</code>\u8bbe\u7f6e\u4e3a20%,\u4ee5\u786e\u4fdd\u5728\u6574\u4e2a\u6eda\u52a8\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u81f3\u5c11\u670980\u4e2a\u529f\u80fd\u6027Pod\u3002</p>"},{"location":"zh/reliability/docs/application/#_8","title":"\u4f7f\u7528\u84dd/\u7eff\u90e8\u7f72","text":"<p>\u66f4\u6539\u672c\u8eab\u662f\u6709\u98ce\u9669\u7684\uff0c\u4f46\u65e0\u6cd5\u64a4\u9500\u7684\u66f4\u6539\u53ef\u80fd\u662f\u707e\u96be\u6027\u7684\u3002\u5141\u8bb8\u60a8\u6709\u6548\u5730\u901a\u8fc7\u56de\u6eda\u6765\u64a4\u9500\u66f4\u6539\u7684\u66f4\u6539\u7a0b\u5e8f\u4f7f\u589e\u5f3a\u548c\u5b9e\u9a8c\u66f4\u52a0\u5b89\u5168\u3002\u84dd/\u7eff\u90e8\u7f72\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u79cd\u5feb\u901f\u64a4\u9500\u66f4\u6539\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u51fa\u73b0\u95ee\u9898\u3002\u5728\u8fd9\u79cd\u90e8\u7f72\u7b56\u7565\u4e2d\uff0c\u60a8\u4e3a\u65b0\u7248\u672c\u521b\u5efa\u4e00\u4e2a\u73af\u5883\u3002\u8fd9\u4e2a\u73af\u5883\u4e0e\u6b63\u5728\u66f4\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u5f53\u524d\u7248\u672c\u5b8c\u5168\u76f8\u540c\u3002\u4e00\u65e6\u65b0\u73af\u5883\u5df2\u51c6\u5907\u5c31\u7eea\uff0c\u6d41\u91cf\u5c31\u4f1a\u88ab\u8def\u7531\u5230\u65b0\u73af\u5883\u3002\u5982\u679c\u65b0\u7248\u672c\u4ea7\u751f\u4e86\u9884\u671f\u7684\u7ed3\u679c\u800c\u6ca1\u6709\u751f\u6210\u9519\u8bef\uff0c\u65e7\u73af\u5883\u5c31\u4f1a\u88ab\u7ec8\u6b62\u3002\u5426\u5219\uff0c\u6d41\u91cf\u5c06\u6062\u590d\u5230\u65e7\u7248\u672c\u3002</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u4e0e\u73b0\u6709\u7248\u672c\u7684Deployment\u5b8c\u5168\u76f8\u540c\u7684\u65b0Deployment\u6765\u6267\u884c\u84dd/\u7eff\u90e8\u7f72\u3002\u4e00\u65e6\u60a8\u9a8c\u8bc1\u65b0Deployment\u4e2d\u7684Pod\u6b63\u5728\u8fd0\u884c\u4e14\u6ca1\u6709\u9519\u8bef\uff0c\u60a8\u5c31\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u8def\u7531\u6d41\u91cf\u5230\u60a8\u5e94\u7528\u7a0b\u5e8fPod\u7684Service\u7684<code>selector</code>\u89c4\u8303\u5f00\u59cb\u5411\u65b0Deployment\u53d1\u9001\u6d41\u91cf\u3002</p> <p>\u8bb8\u591a\u6301\u7eed\u96c6\u6210\u5de5\u5177\uff0c\u5982Flux\u3001Jenkins\u548cSpinnaker\u90fd\u5141\u8bb8\u60a8\u81ea\u52a8\u5316\u84dd/\u7eff\u90e8\u7f72\u3002AWS Containers\u535a\u5ba2\u5305\u62ec\u4e86\u4e00\u4e2a\u4f7f\u7528AWS Load Balancer Controller\u7684\u6f14\u7ec3\uff1a\u4f7f\u7528AWS Load Balancer Controller\u8fdb\u884c\u84dd/\u7eff\u90e8\u7f72\u3001\u91d1\u4e1d\u96c0\u90e8\u7f72\u548cA/B\u6d4b\u8bd5</p>"},{"location":"zh/reliability/docs/application/#_9","title":"\u4f7f\u7528\u91d1\u4e1d\u96c0\u90e8\u7f72","text":"<p>\u91d1\u4e1d\u96c0\u90e8\u7f72\u662f\u84dd/\u7eff\u90e8\u7f72\u7684\u4e00\u79cd\u53d8\u4f53\uff0c\u53ef\u4ee5\u663e\u8457\u964d\u4f4e\u66f4\u6539\u7684\u98ce\u9669\u3002\u5728\u8fd9\u79cd\u90e8\u7f72\u7b56\u7565\u4e2d\uff0c\u60a8\u5728\u65e7Deployment\u65c1\u8fb9\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Deployment\uff0c\u5176\u4e2d\u5305\u542b\u8f83\u5c11\u7684Pod\uff0c\u5e76\u5c06\u5c11\u91cf\u6d41\u91cf\u5206\u6d41\u5230\u65b0\u7684Deployment\u3002\u5982\u679c\u6307\u6807\u663e\u793a\u65b0\u7248\u672c\u7684\u6027\u80fd\u4e0e\u73b0\u6709\u7248\u672c\u4e00\u6837\u597d\u6216\u66f4\u597d\uff0c\u60a8\u5c31\u53ef\u4ee5\u9010\u6b65\u589e\u52a0\u5230\u65b0Deployment\u7684\u6d41\u91cf\uff0c\u540c\u65f6\u6269\u5c55\u5b83\uff0c\u76f4\u5230\u6240\u6709\u6d41\u91cf\u90fd\u88ab\u5206\u6d41\u5230\u65b0Deployment\u3002\u5982\u679c\u51fa\u73b0\u95ee\u9898\uff0c\u60a8\u53ef\u4ee5\u5c06\u6240\u6709\u6d41\u91cf\u8def\u7531\u5230\u65e7Deployment\uff0c\u5e76\u505c\u6b62\u5411\u65b0Deployment\u53d1\u9001\u6d41\u91cf\u3002</p> <p>\u5c3d\u7ba1Kubernetes\u6ca1\u6709\u539f\u751f\u7684\u6267\u884c\u91d1\u4e1d\u96c0\u90e8\u7f72\u7684\u65b9\u5f0f\uff0c\u4f46\u60a8\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982Flagger\u4e0eIstio\u6216App Mesh\u4e4b\u7c7b\u7684\u5de5\u5177\u3002</p>"},{"location":"zh/reliability/docs/application/#_10","title":"\u5065\u5eb7\u68c0\u67e5\u548c\u81ea\u6211\u4fee\u590d","text":"<p>\u6ca1\u6709\u8f6f\u4ef6\u662f\u65e0bug\u7684\uff0c\u4f46Kubernetes\u53ef\u4ee5\u5e2e\u52a9\u60a8\u6700\u5c0f\u5316\u8f6f\u4ef6\u6545\u969c\u7684\u5f71\u54cd\u3002\u8fc7\u53bb\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5d29\u6e83\uff0c\u6709\u4eba\u5fc5\u987b\u624b\u52a8\u91cd\u65b0\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u6765\u89e3\u51b3\u8fd9\u79cd\u60c5\u51b5\u3002Kubernetes\u4e3a\u60a8\u63d0\u4f9b\u4e86\u68c0\u6d4bPod\u4e2d\u8f6f\u4ef6\u6545\u969c\u7684\u80fd\u529b\uff0c\u5e76\u81ea\u52a8\u7528\u65b0\u526f\u672c\u66ff\u6362\u5b83\u4eec\u3002\u901a\u8fc7Kubernetes\uff0c\u60a8\u53ef\u4ee5\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u72b6\u51b5\uff0c\u5e76\u81ea\u52a8\u66ff\u6362\u4e0d\u5065\u5eb7\u7684\u5b9e\u4f8b\u3002</p> <p>Kubernetes\u652f\u6301\u4e09\u79cd\u7c7b\u578b\u7684\u5065\u5eb7\u68c0\u67e5:</p> <ol> <li>\u5b58\u6d3b\u63a2\u9488</li> <li>\u542f\u52a8\u63a2\u9488(\u5728Kubernetes 1.16+\u7248\u672c\u4e2d\u652f\u6301)</li> <li>\u5c31\u7eea\u63a2\u9488</li> </ol> <p>Kubelet\u662fKubernetes\u4ee3\u7406\uff0c\u8d1f\u8d23\u8fd0\u884c\u6240\u6709\u4e0a\u8ff0\u68c0\u67e5\u3002Kubelet\u53ef\u4ee5\u901a\u8fc7\u4e09\u79cd\u65b9\u5f0f\u68c0\u67e5Pod\u7684\u8fd0\u884c\u72b6\u51b5\uff1akubelet\u53ef\u4ee5\u5728Pod\u7684\u5bb9\u5668\u5185\u8fd0\u884cshell\u547d\u4ee4\u3001\u5411\u5176\u5bb9\u5668\u53d1\u9001HTTP GET\u8bf7\u6c42\u6216\u5728\u6307\u5b9a\u7aef\u53e3\u6253\u5f00TCP\u5957\u63a5\u5b57\u3002</p> <p>\u5982\u679c\u60a8\u9009\u62e9\u57fa\u4e8e<code>exec</code>\u7684\u63a2\u9488(\u5728\u5bb9\u5668\u5185\u8fd0\u884cshell\u811a\u672c)\uff0c\u8bf7\u786e\u4fddshell\u547d\u4ee4\u5728<code>timeoutSeconds</code>\u503c\u8fc7\u671f\u4e4b\u524d\u9000\u51fa\u3002\u5426\u5219\uff0c\u60a8\u7684\u8282\u70b9\u5c06\u6709<code>&lt;defunct&gt;</code>\u8fdb\u7a0b\uff0c\u5bfc\u81f4\u8282\u70b9\u6545\u969c\u3002</p>"},{"location":"zh/reliability/docs/application/#_11","title":"\u5efa\u8bae","text":""},{"location":"zh/reliability/docs/application/#pod_3","title":"\u4f7f\u7528\u5b58\u6d3b\u63a2\u9488\u79fb\u9664\u4e0d\u5065\u5eb7\u7684Pod","text":"<p>\u5b58\u6d3b\u63a2\u9488\u53ef\u4ee5\u68c0\u6d4b\u6b7b\u9501\u60c5\u51b5\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8fdb\u7a0b\u7ee7\u7eed\u8fd0\u884c\uff0c\u4f46\u5e94\u7528\u7a0b\u5e8f\u53d8\u5f97\u65e0\u54cd\u5e94\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u6b63\u5728\u8fd0\u884c\u4e00\u4e2a\u5728\u7aef\u53e380\u4e0a\u4fa6\u542c\u7684Web\u670d\u52a1\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u4e00\u4e2a\u5b58\u6d3b\u63a2\u9488\u5411Pod\u7684\u7aef\u53e380\u53d1\u9001HTTP GET\u8bf7\u6c42\u3002Kubelet\u5c06\u5b9a\u671f\u5411Pod\u53d1\u9001GET\u8bf7\u6c42\u5e76\u671f\u671b\u54cd\u5e94;\u5982\u679cPod\u54cd\u5e94\u5728200-399\u4e4b\u95f4\uff0c\u5219kubelet\u8ba4\u4e3a\u8be5Pod\u662f\u5065\u5eb7\u7684;\u5426\u5219\uff0c\u8be5Pod\u5c06\u88ab\u6807\u8bb0\u4e3a\u4e0d\u5065\u5eb7\u3002\u5982\u679c\u4e00\u4e2aPod\u8fde\u7eed\u5931\u8d25\u5065\u5eb7\u68c0\u67e5\uff0ckubelet\u5c06\u7ec8\u6b62\u5b83\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528<code>initialDelaySeconds</code>\u6765\u5ef6\u8fdf\u7b2c\u4e00\u6b21\u63a2\u6d4b\u3002</p> <p>\u4f7f\u7528\u5b58\u6d3b\u63a2\u9488\u65f6\uff0c\u8bf7\u786e\u4fdd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u4f1a\u51fa\u73b0\u6240\u6709Pod\u540c\u65f6\u5931\u8d25\u5b58\u6d3b\u63a2\u9488\u7684\u60c5\u51b5\uff0c\u56e0\u4e3aKubernetes\u5c06\u5c1d\u8bd5\u66ff\u6362\u6240\u6709Pod\uff0c\u4ece\u800c\u4f7f\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u79bb\u7ebf\u3002\u6b64\u5916\uff0cKubernetes\u5c06\u7ee7\u7eed\u521b\u5efa\u65b0\u7684Pod\uff0c\u8fd9\u4e9bPod\u4e5f\u5c06\u5931\u8d25\u5b58\u6d3b\u63a2\u9488\uff0c\u4ece\u800c\u7ed9\u63a7\u5236\u5e73\u9762\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u538b\u529b\u3002\u907f\u514d\u5c06\u5b58\u6d3b\u63a2\u9488\u914d\u7f6e\u4e3a\u4f9d\u8d56\u4e8ePod\u5916\u90e8\u7684\u56e0\u7d20\uff0c\u4f8b\u5982\u5916\u90e8\u6570\u636e\u5e93\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u65e0\u54cd\u5e94\u7684\u5916\u90e8\u6570\u636e\u5e93\u4e0d\u5e94\u4f7f\u60a8\u7684Pod\u5931\u8d25\u5b58\u6d3b\u63a2\u9488\u3002</p> <p>Sandor Sz\u00fccs\u7684\u6587\u7ae0LIVENESS PROBES ARE DANGEROUS\u63cf\u8ff0\u4e86\u7531\u4e8e\u914d\u7f6e\u9519\u8bef\u7684\u63a2\u9488\u53ef\u80fd\u5bfc\u81f4\u7684\u95ee\u9898\u3002</p>"},{"location":"zh/reliability/docs/application/#_12","title":"\u5bf9\u4e8e\u542f\u52a8\u65f6\u95f4\u8f83\u957f\u7684\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u542f\u52a8\u63a2\u9488","text":"<p>\u5f53\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u989d\u5916\u7684\u65f6\u95f4\u6765\u542f\u52a8\u65f6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u542f\u52a8\u63a2\u9488\u6765\u5ef6\u8fdf\u5b58\u6d3b\u63a2\u9488\u548c\u5c31\u7eea\u63a2\u9488\u3002\u4f8b\u5982\uff0c\u9700\u8981\u4ece\u6570\u636e\u5e93\u4e2d\u52a0\u8f7d\u7f13\u5b58\u7684Java\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u9700\u8981\u957f\u8fbe\u4e24\u5206\u949f\u624d\u80fd\u5b8c\u5168\u542f\u52a8\u3002\u5728\u5b83\u5b8c\u5168\u542f\u52a8\u4e4b\u524d\uff0c\u4efb\u4f55\u5b58\u6d3b\u6216\u5c31\u7eea\u63a2\u9488\u90fd\u53ef\u80fd\u5931\u8d25\u3002\u914d\u7f6e\u542f\u52a8\u63a2\u9488\u5c06\u5141\u8bb8Java\u5e94\u7528\u7a0b\u5e8f\u5728\u5b58\u6d3b\u6216\u5c31\u7eea\u63a2\u9488\u6267\u884c\u4e4b\u524d\u53d8\u4e3a\u5065\u5eb7\u3002</p> <p>\u5728\u542f\u52a8\u63a2\u9488\u6210\u529f\u4e4b\u524d\uff0c\u6240\u6709\u5176\u4ed6\u63a2\u9488\u90fd\u5c06\u88ab\u7981\u7528\u3002\u60a8\u53ef\u4ee5\u5b9a\u4e49Kubernetes\u5e94\u8be5\u7b49\u5f85\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u7684\u6700\u957f\u65f6\u95f4\u3002\u5982\u679c\u5728\u914d\u7f6e\u7684\u6700\u957f\u65f6\u95f4\u540e\uff0cPod\u4ecd\u7136\u5931\u8d25\u542f\u52a8\u63a2\u9488\uff0c\u5b83\u5c06\u88ab\u7ec8\u6b62\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Pod\u3002</p> <p>\u542f\u52a8\u63a2\u9488\u7c7b\u4f3c\u4e8e\u5b58\u6d3b\u63a2\u9488 - \u5982\u679c\u5b83\u4eec\u5931\u8d25\uff0cPod\u5c06\u88ab\u91cd\u65b0\u521b\u5efa\u3002\u6b63\u5982Ricardo A.\u5728\u4ed6\u7684\u6587\u7ae0Fantastic Probes And How To Configure Them\u4e2d\u89e3\u91ca\u7684\u90a3\u6837\uff0c\u5f53\u5e94\u7528\u7a0b\u5e8f\u7684\u542f\u52a8\u65f6\u95f4\u662f\u4e0d\u53ef\u9884\u6d4b\u7684\u65f6\uff0c\u5e94\u8be5\u4f7f\u7528\u542f\u52a8\u63a2\u9488\u3002\u5982\u679c\u60a8\u77e5\u9053\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u898110\u79d2\u949f\u624d\u80fd\u542f\u52a8\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528\u5e26\u6709<code>initialDelaySeconds</code>\u7684\u5b58\u6d3b/\u5c31\u7eea\u63a2\u9488\u3002</p>"},{"location":"zh/reliability/docs/application/#_13","title":"\u4f7f\u7528\u5c31\u7eea\u63a2\u9488\u68c0\u6d4b\u90e8\u5206\u4e0d\u53ef\u7528","text":"<p>\u867d\u7136\u5b58\u6d3b\u63a2\u9488\u68c0\u6d4b\u5e94\u7528\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u901a\u8fc7\u7ec8\u6b62Pod(\u56e0\u6b64\uff0c\u91cd\u65b0\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f)\u6765\u89e3\u51b3\u7684\u6545\u969c\uff0c\u4f46\u5c31\u7eea\u63a2\u9488\u68c0\u6d4b\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u6682\u65f6\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\u3002\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u6682\u65f6\u65e0\u54cd\u5e94;\u4f46\u662f\uff0c\u4e00\u65e6\u6b64\u64cd\u4f5c\u5b8c\u6210\uff0c\u5b83\u5c31\u4f1a\u518d\u6b21\u53d8\u5f97\u5065\u5eb7\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u5bc6\u96c6\u7684\u78c1\u76d8I/O\u64cd\u4f5c\u671f\u95f4\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u6682\u65f6\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7ec8\u6b62\u5e94\u7528\u7a0b\u5e8f\u7684Pod\u5e76\u4e0d\u662f\u4e00\u79cd\u8865\u6551\u63aa\u65bd;\u540c\u65f6\uff0c\u53d1\u9001\u5230Pod\u7684\u4efb\u4f55\u5176\u4ed6\u8bf7\u6c42\u90fd\u53ef\u80fd\u5931\u8d25\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u5c31\u7eea\u63a2\u9488\u6765\u68c0\u6d4b\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u4e34\u65f6\u4e0d\u53ef\u7528\u60c5\u51b5\uff0c\u5e76\u505c\u6b62\u5411\u5176Pod\u53d1\u9001\u8bf7\u6c42\uff0c\u76f4\u5230\u5b83\u518d\u6b21\u53ef\u7528\u3002\u4e0e\u5b58\u6d3b\u63a2\u9488\u4e0d\u540c\uff0c\u5982\u679c\u5c31\u7eea\u63a2\u9488\u5931\u8d25\uff0cPod\u5c06\u4e0d\u4f1a\u4eceKubernetes Service\u63a5\u6536\u4efb\u4f55\u6d41\u91cf\u3002\u5f53\u5c31\u7eea\u63a2\u9488\u6210\u529f\u65f6\uff0cPod\u5c06\u6062\u590d\u4eceService\u63a5\u6536\u6d41\u91cf\u3002</p> <p>\u5c31\u50cf\u5b58\u6d3b\u63a2\u9488\u4e00\u6837\uff0c\u907f\u514d\u914d\u7f6e\u4f9d\u8d56\u4e8ePod\u5916\u90e8\u8d44\u6e90(\u5982\u6570\u636e\u5e93)\u7684\u5c31\u7eea\u63a2\u9488\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u573a\u666f\u8bf4\u660e\u4e86\u914d\u7f6e\u4e0d\u5f53\u7684\u5c31\u7eea\u63a2\u9488\u53ef\u80fd\u4f1a\u4f7f\u5e94\u7528\u7a0b\u5e8f\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c - \u5982\u679cPod\u7684\u5c31\u7eea\u63a2\u9488\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u636e\u5e93\u65e0\u6cd5\u8bbf\u95ee\u65f6\u5931\u8d25\uff0c\u5171\u4eab\u76f8\u540c\u5065\u5eb7\u68c0\u67e5\u6807\u51c6\u7684\u5176\u4ed6Pod\u526f\u672c\u4e5f\u5c06\u540c\u65f6\u5931\u8d25\u3002\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u8bbe\u7f6e\u63a2\u9488\u5c06\u786e\u4fdd\u6bcf\u5f53\u6570\u636e\u5e93\u4e0d\u53ef\u7528\u65f6\uff0cPod\u7684\u5c31\u7eea\u63a2\u9488\u5c06\u5931\u8d25\uff0c\u5e76\u4e14Kubernetes\u5c06\u505c\u6b62\u5411\u6240\u6709Pod\u53d1\u9001\u6d41\u91cf\u3002</p> <p>\u4f7f\u7528\u5c31\u7eea\u63a2\u9488\u7684\u4e00\u4e2a\u526f\u4f5c\u7528\u662f\uff0c\u5b83\u4eec\u53ef\u80fd\u4f1a\u589e\u52a0\u66f4\u65b0Deployment\u6240\u9700\u7684\u65f6\u95f4\u3002\u65b0\u526f\u672c\u5c06\u4e0d\u4f1a\u63a5\u6536\u6d41\u91cf\uff0c\u9664\u975e\u5c31\u7eea\u63a2\u9488\u6210\u529f;\u5728\u6b64\u4e4b\u524d\uff0c\u65e7\u526f\u672c\u5c06\u7ee7\u7eed\u63a5\u6536\u6d41\u91cf\u3002</p>"},{"location":"zh/reliability/docs/application/#_14","title":"\u5904\u7406\u4e2d\u65ad","text":"<p>Pod\u6709\u6709\u9650\u7684\u751f\u547d\u5468\u671f - \u5373\u4f7f\u60a8\u6709\u957f\u671f\u8fd0\u884c\u7684Pod\uff0c\u4e5f\u5e94\u786e\u4fddPod\u5728\u5230\u671f\u65f6\u6b63\u786e\u7ec8\u6b62\u3002\u6839\u636e\u60a8\u7684\u5347\u7ea7\u7b56\u7565\uff0cKubernetes\u96c6\u7fa4\u5347\u7ea7\u53ef\u80fd\u9700\u8981\u60a8\u521b\u5efa\u65b0\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u8fd9\u9700\u8981\u5728\u8f83\u65b0\u7684\u8282\u70b9\u4e0a\u91cd\u65b0\u521b\u5efa\u6240\u6709Pod\u3002\u6b63\u786e\u7684\u7ec8\u6b62\u5904\u7406\u548cPod\u4e2d\u65ad\u9884\u7b97\u53ef\u4ee5\u5e2e\u52a9\u60a8\u907f\u514d\u5728\u4ece\u65e7\u8282\u70b9\u79fb\u9664Pod\u5e76\u5728\u8f83\u65b0\u8282\u70b9\u4e0a\u91cd\u65b0\u521b\u5efa\u5b83\u4eec\u65f6\u51fa\u73b0\u670d\u52a1\u4e2d\u65ad\u3002</p> <p>\u5347\u7ea7\u5de5\u4f5c\u8282\u70b9\u7684\u9996\u9009\u65b9\u5f0f\u662f\u521b\u5efa\u65b0\u7684\u5de5\u4f5c\u8282\u70b9\u5e76\u7ec8\u6b62\u65e7\u8282\u70b9\u3002\u5728\u7ec8\u6b62\u5de5\u4f5c\u8282\u70b9\u4e4b\u524d\uff0c\u60a8\u5e94\u8be5<code>drain</code>\u5b83\u3002\u5f53\u5de5\u4f5c\u8282\u70b9\u88ab\u6392\u7a7a\u65f6\uff0c\u5b83\u4e0a\u9762\u7684\u6240\u6709Pod\u90fd\u4f1a\u88ab\u5b89\u5168\u5730\u9010\u51fa\u3002\u5b89\u5168\u662f\u4e00\u4e2a\u5173\u952e\u8bcd;\u5f53\u5de5\u4f5c\u8282\u70b9\u4e0a\u7684Pod\u88ab\u9010\u51fa\u65f6\uff0c\u5b83\u4eec\u4e0d\u4f1a\u7b80\u5355\u5730\u6536\u5230<code>SIGKILL</code>\u4fe1\u53f7\u3002\u76f8\u53cd\uff0c<code>SIGTERM</code>\u4fe1\u53f7\u5c06\u88ab\u53d1\u9001\u5230\u6bcf\u4e2a\u88ab\u9010\u51faPod\u4e2d\u5bb9\u5668\u7684\u4e3b\u8fdb\u7a0b(PID 1)\u3002\u53d1\u9001<code>SIGTERM</code>\u4fe1\u53f7\u540e\uff0cKubernetes\u5c06\u7ed9\u4e88\u8fdb\u7a0b\u4e00\u4e9b\u65f6\u95f4(\u5bbd\u9650\u671f)\uff0c\u7136\u540e\u518d\u53d1\u9001<code>SIGKILL</code>\u4fe1\u53f7\u3002\u9ed8\u8ba4\u7684\u5bbd\u9650\u671f\u4e3a30\u79d2;\u60a8\u53ef\u4ee5\u4f7f\u7528kubectl\u4e2d\u7684<code>grace-period</code>\u6807\u5fd7\u6216\u5728\u60a8\u7684Podspec\u4e2d\u58f0\u660e<code>terminationGracePeriodSeconds</code>\u6765\u8986\u76d6\u9ed8\u8ba4\u503c\u3002</p> <p><code>kubectl delete pod &lt;pod name&gt; --grace-period=&lt;seconds&gt;</code></p> <p>\u901a\u5e38\u4f1a\u6709\u5bb9\u5668\u7684\u4e3b\u8fdb\u7a0b\u4e0d\u662fPID 1\u7684\u60c5\u51b5\u3002\u8003\u8651\u8fd9\u4e2a\u57fa\u4e8ePython\u7684\u793a\u4f8b\u5bb9\u5668\uff1a</p> <pre><code>$ kubectl exec python-app -it ps\n PID USER TIME COMMAND\n 1   root 0:00 {script.sh} /bin/sh ./script.sh\n 5   root 0:00 python app.py\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cshell\u811a\u672c\u63a5\u6536\u5230<code>SIGTERM</code>,\u800c\u4e3b\u8fdb\u7a0b(\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u662f\u4e00\u4e2aPython\u5e94\u7528\u7a0b\u5e8f)\u6ca1\u6709\u6536\u5230<code>SIGTERM</code>\u4fe1\u53f7\u3002\u5f53Pod\u88ab\u7ec8\u6b62\u65f6\uff0cPython\u5e94\u7528\u7a0b\u5e8f\u5c06\u88ab\u7a81\u7136\u7ec8\u6b62\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u5bb9\u5668\u7684<code>ENTRYPOINT</code>\u6765\u542f\u52a8Python\u5e94\u7528\u7a0b\u5e8f\u6765\u89e3\u51b3\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u50cfdumb-init\u8fd9\u6837\u7684\u5de5\u5177\u6765\u786e\u4fdd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5904\u7406\u4fe1\u53f7\u3002</p> <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5bb9\u5668\u94a9\u5b50\u5728\u5bb9\u5668\u542f\u52a8\u6216\u505c\u6b62\u65f6\u6267\u884c\u811a\u672c\u6216HTTP\u8bf7\u6c42\u3002<code>PreStop</code>\u94a9\u5b50\u64cd\u4f5c\u5728\u5bb9\u5668\u6536\u5230<code>SIGTERM</code>\u4fe1\u53f7\u4e4b\u524d\u8fd0\u884c\uff0c\u5e76\u4e14\u5fc5\u987b\u5728\u53d1\u9001\u6b64\u4fe1\u53f7\u4e4b\u524d\u5b8c\u6210\u3002<code>terminationGracePeriodSeconds</code>\u503c\u9002\u7528\u4e8e<code>PreStop</code>\u94a9\u5b50\u64cd\u4f5c\u5f00\u59cb\u6267\u884c\u65f6\uff0c\u800c\u4e0d\u662f\u53d1\u9001<code>SIGTERM</code>\u4fe1\u53f7\u65f6\u3002</p>"},{"location":"zh/reliability/docs/application/#_15","title":"\u5efa\u8bae","text":""},{"location":"zh/reliability/docs/application/#pod_4","title":"\u4f7f\u7528Pod\u4e2d\u65ad\u9884\u7b97\u4fdd\u62a4\u5173\u952e\u5de5\u4f5c\u8d1f\u8f7d","text":"<p>Pod\u4e2d\u65ad\u9884\u7b97(PDB)\u53ef\u4ee5\u6682\u65f6\u6682\u505c\u9010\u51fa\u8fc7\u7a0b\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u7684\u526f\u672c\u6570\u91cf\u4f4e\u4e8e\u58f0\u660e\u7684\u9608\u503c\u3002\u4e00\u65e6\u53ef\u7528\u526f\u672c\u7684\u6570\u91cf\u8d85\u8fc7\u9608\u503c\uff0c\u9010\u51fa\u8fc7\u7a0b\u5c06\u7ee7\u7eed\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528PDB\u6765\u58f0\u660e<code>minAvailable</code>\u548c<code>maxUnavailable</code>\u526f\u672c\u6570\u91cf\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5e0c\u671b\u5e94\u7528\u7a0b\u5e8f\u81f3\u5c11\u6709\u4e09\u4e2a\u526f\u672c\u53ef\u7528\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aPDB\u3002</p> <pre><code>apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: my-svc-pdb\nspec:\n  minAvailable: 3\n  selector:\n    matchLabels:\n      app: my-svc\n</code></pre> <p>\u4e0a\u8ff0PDB\u7b56\u7565\u544a\u8bc9Kubernetes\u5728\u81f3\u5c11\u6709\u4e09\u4e2a\u6216\u66f4\u591a\u526f\u672c\u53ef\u7528\u4e4b\u524d\u6682\u505c\u9010\u51fa\u8fc7\u7a0b\u3002\u8282\u70b9\u6392\u7a7a\u9075\u5b88<code>PodDisruptionBudgets</code>\u3002\u5728EKS\u6258\u7ba1\u8282\u70b9\u7ec4\u5347\u7ea7\u671f\u95f4\uff0c\u8282\u70b9\u572815\u5206\u949f\u8d85\u65f6\u540e\u88ab\u6392\u7a7a\u300215\u5206\u949f\u540e\uff0c\u5982\u679c\u4e0d\u5f3a\u5236\u66f4\u65b0(\u5728EKS\u63a7\u5236\u53f0\u4e2d\u79f0\u4e3a\u6eda\u52a8\u66f4\u65b0)\uff0c\u66f4\u65b0\u5c06\u5931\u8d25\u3002\u5982\u679c\u5f3a\u5236\u66f4\u65b0\uff0cPod\u5c06\u88ab\u5220\u9664\u3002</p> <p>\u5bf9\u4e8e\u81ea\u7ba1\u7406\u8282\u70b9\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982AWS Node Termination Handler\u4e4b\u7c7b\u7684\u5de5\u5177\uff0c\u5b83\u53ef\u786e\u4fddKubernetes\u63a7\u5236\u5e73\u9762\u5bf9\u53ef\u80fd\u5bfc\u81f4\u60a8\u7684EC2\u5b9e\u4f8b\u53d8\u5f97\u4e0d\u53ef\u7528\u7684\u4e8b\u4ef6\u505a\u51fa\u9002\u5f53\u54cd\u5e94\uff0c\u4f8b\u5982EC2\u7ef4\u62a4\u4e8b\u4ef6\u548cEC2 Spot\u4e2d\u65ad\u3002\u5b83\u4f7f\u7528Kubernetes API\u6765cordon\u8282\u70b9\uff0c\u4ee5\u786e\u4fdd\u4e0d\u4f1a\u5728\u8be5\u8282\u70b9\u4e0a\u8c03\u5ea6\u65b0\u7684Pod\uff0c\u7136\u540e\u5c06\u5176\u6392\u7a7a\uff0c\u7ec8\u6b62\u4efb\u4f55\u6b63\u5728\u8fd0\u884c\u7684Pod\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528Pod\u53cd\u4eb2\u548c\u6027\u5728\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\u8c03\u5ea6Deployment\u7684Pod\uff0c\u5e76\u907f\u514d\u5728\u8282\u70b9\u5347\u7ea7\u671f\u95f4\u51fa\u73b0\u4e0ePDB\u76f8\u5173\u7684\u5ef6\u8fdf\u3002</p>"},{"location":"zh/reliability/docs/application/#_16","title":"\u5b9e\u8df5\u6df7\u6c8c\u5de5\u7a0b","text":"<p>\u6df7\u6c8c\u5de5\u7a0b\u662f\u4e00\u79cd\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0a\u8fdb\u884c\u5b9e\u9a8c\u7684\u5b66\u79d1\uff0c\u76ee\u7684\u662f\u5efa\u7acb\u5bf9\u7cfb\u7edf\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u627f\u53d7\u52a8\u8361\u6761\u4ef6\u7684\u80fd\u529b\u7684\u4fe1\u5fc3\u3002</p> <p>\u5728\u4ed6\u7684\u535a\u5ba2\u4e2d\uff0cDominik Tornow\u89e3\u91ca\u8bf4Kubernetes\u662f\u4e00\u4e2a\u58f0\u660e\u5f0f\u7cfb\u7edf,\"\u7528\u6237\u5411\u7cfb\u7edf\u63d0\u4f9b\u7cfb\u7edf\u6240\u9700\u72b6\u6001\u7684\u8868\u793a\u3002\u7136\u540e\uff0c\u7cfb\u7edf\u4f1a\u8003\u8651\u5f53\u524d\u72b6\u6001\u548c\u6240\u9700\u72b6\u6001\uff0c\u4ee5\u786e\u5b9a\u4ece\u5f53\u524d\u72b6\u6001\u8fc7\u6e21\u5230\u6240\u9700\u72b6\u6001\u7684\u547d\u4ee4\u5e8f\u5217\u3002\"\u8fd9\u610f\u5473\u7740Kubernetes\u59cb\u7ec8\u5b58\u50a8\u6240\u9700\u72b6\u6001,\u5982\u679c\u7cfb\u7edf\u504f\u79bb\uff0cKubernetes\u5c06\u91c7\u53d6\u884c\u52a8\u6062\u590d\u72b6\u6001\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5de5\u4f5c\u8282\u70b9\u53d8\u5f97\u4e0d\u53ef\u7528\uff0cKubernetes\u5c06\u5728\u53e6\u4e00\u4e2a\u5de5\u4f5c\u8282\u70b9\u4e0a\u91cd\u65b0\u8c03\u5ea6Pod\u3002\u540c\u6837\uff0c\u5982\u679c\u4e00\u4e2a<code>replica</code>\u5d29\u6e83\uff0cDeployment Contoller\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u7684<code>replica</code>\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cKubernetes\u63a7\u5236\u5668\u4f1a\u81ea\u52a8\u4fee\u590d\u6545\u969c\u3002</p> <p>\u50cfGremlin\u8fd9\u6837\u7684\u6df7\u6c8c\u5de5\u7a0b\u5de5\u5177\u53ef\u4ee5\u5e2e\u52a9\u60a8\u6d4b\u8bd5Kubernetes\u96c6\u7fa4\u7684\u5f39\u6027\uff0c\u5e76\u8bc6\u522b\u5355\u70b9\u6545\u969c\u3002\u5728\u53d7\u63a7\u73af\u5883\u4e2d\u5f15\u5165\u4eba\u4e3a\u6df7\u4e71\u7684\u5de5\u5177\u53ef\u4ee5\u63ed\u793a\u7cfb\u7edf\u6027\u5f31\u70b9\uff0c\u63d0\u4f9b\u4e00\u4e2a\u673a\u4f1a\u6765\u8bc6\u522b\u74f6\u9888\u548c\u9519\u8bef\u914d\u7f6e\uff0c\u5e76\u7ea0\u6b63\u95ee\u9898\u3002\u6df7\u6c8c\u5de5\u7a0b\u7406\u5ff5\u5021\u5bfc\u6709\u76ee\u7684\u5730\u7834\u574f\u4e8b\u7269\u5e76\u5bf9\u57fa\u7840\u8bbe\u65bd\u8fdb\u884c\u538b\u529b\u6d4b\u8bd5\uff0c\u4ee5\u6700\u5927\u7a0b\u5ea6\u5730\u51cf\u5c11\u610f\u5916\u505c\u673a\u65f6\u95f4\u3002</p>"},{"location":"zh/reliability/docs/application/#_17","title":"\u4f7f\u7528\u670d\u52a1\u7f51\u683c","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u6765\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u7684\u5f39\u6027\u3002\u670d\u52a1\u7f51\u683c\u652f\u6301\u670d\u52a1\u95f4\u901a\u4fe1\uff0c\u5e76\u589e\u52a0\u4e86\u5fae\u670d\u52a1\u7f51\u7edc\u7684\u53ef\u89c2\u5bdf\u6027\u3002\u5927\u591a\u6570\u670d\u52a1\u7f51\u683c\u4ea7\u54c1\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\u5728\u6bcf\u4e2a\u670d\u52a1\u65c1\u8fd0\u884c\u4e00\u4e2a\u5c0f\u578b\u7f51\u7edc\u4ee3\u7406\uff0c\u7528\u4e8e\u62e6\u622a\u548c\u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u7684\u7f51\u7edc\u6d41\u91cf\u3002\u60a8\u53ef\u4ee5\u5c06\u5e94\u7528\u7a0b\u5e8f\u653e\u5165\u7f51\u683c\u4e2d\uff0c\u800c\u65e0\u9700\u4fee\u6539\u5e94\u7528\u7a0b\u5e8f\u3002\u4f7f\u7528\u670d\u52a1\u4ee3\u7406\u7684\u5185\u7f6e\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u8ba9\u5b83\u751f\u6210\u7f51\u7edc\u7edf\u8ba1\u4fe1\u606f\u3001\u521b\u5efa\u8bbf\u95ee\u65e5\u5fd7\uff0c\u5e76\u4e3a\u5206\u5e03\u5f0f\u8ddf\u8e2a\u5411\u51fa\u7ad9\u8bf7\u6c42\u6dfb\u52a0HTTP\u5934\u3002</p> <p>\u670d\u52a1\u7f51\u683c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u901a\u8fc7\u81ea\u52a8\u91cd\u8bd5\u8bf7\u6c42\u3001\u8d85\u65f6\u3001\u65ad\u8def\u5668\u548c\u901f\u7387\u9650\u5236\u7b49\u529f\u80fd\u4f7f\u60a8\u7684\u5fae\u670d\u52a1\u66f4\u5177\u5f39\u6027\u3002</p> <p>\u5982\u679c\u60a8\u8fd0\u884c\u591a\u4e2a\u96c6\u7fa4\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u6765\u542f\u7528\u8de8\u96c6\u7fa4\u7684\u670d\u52a1\u95f4\u901a\u4fe1\u3002</p>"},{"location":"zh/reliability/docs/application/#_18","title":"\u670d\u52a1\u7f51\u683c","text":"<ul> <li>AWS App Mesh</li> <li>Istio</li> <li>LinkerD</li> <li>Consul</li> </ul>"},{"location":"zh/reliability/docs/application/#_19","title":"\u53ef\u89c2\u5bdf\u6027","text":"<p>\u53ef\u89c2\u5bdf\u6027\u662f\u4e00\u4e2a\u5305\u62ec\u76d1\u63a7\u3001\u65e5\u5fd7\u8bb0\u5f55\u548c\u8ddf\u8e2a\u5728\u5185\u7684\u603b\u62ec\u672f\u8bed\u3002\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u5e94\u7528\u7a0b\u5e8f\u672c\u8d28\u4e0a\u662f\u5206\u5e03\u5f0f\u7684\u3002\u4e0e\u53ea\u9700\u76d1\u63a7\u5355\u4e2a\u7cfb\u7edf\u7684\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u4e0d\u540c\uff0c\u5728\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u67b6\u6784\u4e2d\uff0c\u60a8\u9700\u8981\u76d1\u63a7\u6bcf\u4e2a\u7ec4\u4ef6\u7684\u6027\u80fd\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u96c6\u7fa4\u7ea7\u76d1\u63a7\u3001\u65e5\u5fd7\u8bb0\u5f55\u548c\u5206\u5e03\u5f0f\u8ddf\u8e2a\u7cfb\u7edf\u6765\u8bc6\u522b\u96c6\u7fa4\u4e2d\u7684\u95ee\u9898\uff0c\u4ece\u800c\u5728\u5b83\u4eec\u4e2d\u65ad\u5ba2\u6237\u4e4b\u524d\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002</p> <p>Kubernetes\u5185\u7f6e\u7684\u6545\u969c\u6392\u9664\u548c\u76d1\u63a7\u5de5\u5177\u6709\u9650\u3002metrics-server\u6536\u96c6\u8d44\u6e90\u6307\u6807\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u4f46\u4e0d\u4f1a\u6301\u4e45\u5316\u5b83\u4eec\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528kubectl\u67e5\u770bPod\u7684\u65e5\u5fd7\uff0c\u4f46Kubernetes\u4e0d\u4f1a\u81ea\u52a8\u4fdd\u7559\u65e5\u5fd7\u3002\u800c\u5206\u5e03\u5f0f\u8ddf\u8e2a\u7684\u5b9e\u73b0\u8981\u4e48\u5728\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u7ea7\u522b\u5b8c\u6210\uff0c\u8981\u4e48\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u3002</p> <p>Kubernetes\u7684\u53ef\u6269\u5c55\u6027\u5728\u8fd9\u91cc\u5c55\u73b0\u51fa\u6765\u3002Kubernetes\u5141\u8bb8\u60a8\u5f15\u5165\u9996\u9009\u7684\u96c6\u4e2d\u5f0f\u76d1\u63a7\u3001\u65e5\u5fd7\u8bb0\u5f55\u548c\u8ddf\u8e2a\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"zh/reliability/docs/application/#_20","title":"\u5efa\u8bae","text":""},{"location":"zh/reliability/docs/application/#_21","title":"\u76d1\u63a7\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u60a8\u9700\u8981\u5728\u73b0\u4ee3\u5e94\u7528\u7a0b\u5e8f\u4e2d\u76d1\u63a7\u7684\u6307\u6807\u6570\u91cf\u4e0d\u65ad\u589e\u52a0\u3002\u5982\u679c\u60a8\u6709\u4e00\u79cd\u81ea\u52a8\u8ddf\u8e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u65b9\u5f0f\uff0c\u90a3\u5c31\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u89e3\u51b3\u5ba2\u6237\u7684\u6311\u6218\u3002\u50cfPrometheus\u6216CloudWatch Container Insights\u8fd9\u6837\u7684\u96c6\u7fa4\u8303\u56f4\u76d1\u63a7\u5de5\u5177\u53ef\u4ee5\u76d1\u63a7\u60a8\u7684\u96c6\u7fa4\u548c\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5e76\u5728\u51fa\u73b0\u95ee\u9898\u6216\u66f4\u597d\u7684\u662f\u5728\u51fa\u73b0\u95ee\u9898\u4e4b\u524d\u5411\u60a8\u53d1\u51fa\u4fe1\u53f7\u3002</p> <p>\u76d1\u63a7\u5de5\u5177\u5141\u8bb8\u60a8\u521b\u5efa\u8b66\u62a5\uff0c\u60a8\u7684\u8fd0\u8425\u56e2\u961f\u53ef\u4ee5\u8ba2\u9605\u8fd9\u4e9b\u8b66\u62a5\u3002\u8003\u8651\u4e3a\u53ef\u80fd\u5bfc\u81f4\u4e2d\u65ad\u6216\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u7684\u4e8b\u4ef6\u6fc0\u6d3b\u8b66\u62a5\u7684\u89c4\u5219\u3002</p> <p>\u5982\u679c\u60a8\u4e0d\u786e\u5b9a\u5e94\u8be5\u76d1\u63a7\u54ea\u4e9b\u6307\u6807\uff0c\u60a8\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u65b9\u6cd5\u4e2d\u83b7\u53d6\u7075\u611f\uff1a</p> <ul> <li>RED\u65b9\u6cd5\u3002\u4ee3\u8868\u8bf7\u6c42\u3001\u9519\u8bef\u548c\u6301\u7eed\u65f6\u95f4\u3002</li> <li>USE\u65b9\u6cd5\u3002\u4ee3\u8868\u5229\u7528\u7387\u3001\u9971\u548c\u5ea6\u548c\u9519\u8bef\u3002</li> </ul> <p>Sysdig\u7684\u6587\u7ae0Best practices for alerting on Kubernetes\u5305\u542b\u4e86\u4e00\u4e2a\u53ef\u80fd\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u6027\u7684\u7ec4\u4ef6\u7684\u5168\u9762\u5217\u8868\u3002</p>"},{"location":"zh/reliability/docs/application/#prometheus","title":"\u4f7f\u7528Prometheus\u5ba2\u6237\u7aef\u5e93\u516c\u5f00\u5e94\u7528\u7a0b\u5e8f\u6307\u6807","text":"<p>\u9664\u4e86\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u548c\u805a\u5408\u6807\u51c6\u6307\u6807\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528Prometheus\u5ba2\u6237\u7aef\u5e93\u516c\u5f00\u5e94\u7528\u7a0b\u5e8f\u7279\u5b9a\u7684\u81ea\u5b9a\u4e49\u6307\u6807\uff0c\u4ee5\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u89c2\u5bdf\u6027\u3002</p>"},{"location":"zh/reliability/docs/application/#_22","title":"\u4f7f\u7528\u96c6\u4e2d\u5f0f\u65e5\u5fd7\u8bb0\u5f55\u5de5\u5177\u6536\u96c6\u548c\u6301\u4e45\u5316\u65e5\u5fd7","text":"<p>\u5728EKS\u4e2d\uff0c\u65e5\u5fd7\u8bb0\u5f55\u5206\u4e3a\u4e24\u7c7b\uff1a\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u548c\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u3002EKS\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u8bb0\u5f55\u76f4\u63a5\u4ece\u63a7\u5236\u5e73\u9762\u63d0\u4f9b\u5ba1\u8ba1\u548c\u8bca\u65ad\u65e5\u5fd7\u5230\u60a8\u8d26\u6237\u4e2d\u7684CloudWatch Logs\u3002\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u662fPod\u5728\u60a8\u7684\u96c6\u7fa4\u5185\u8fd0\u884c\u65f6\u4ea7\u751f\u7684\u65e5\u5fd7\u3002\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u5305\u62ec\u8fd0\u884c\u4e1a\u52a1\u903b\u8f91\u5e94\u7528\u7a0b\u5e8f\u7684Pod\u4ea7\u751f\u7684\u65e5\u5fd7\uff0c\u4ee5\u53caKubernetes\u7cfb\u7edf\u7ec4\u4ef6(\u5982CoreDNS\u3001Cluster Autoscaler\u3001Prometheus\u7b49)\u4ea7\u751f\u7684\u65e5\u5fd7\u3002</p> <p>EKS\u63d0\u4f9b\u4e94\u79cd\u7c7b\u578b\u7684\u63a7\u5236\u5e73\u9762\u65e5\u5fd7:</p> <ol> <li>Kubernetes API\u670d\u52a1\u5668\u7ec4\u4ef6\u65e5\u5fd7</li> <li>\u5ba1\u8ba1</li> <li>\u8eab\u4efd\u9a8c\u8bc1\u5668</li> <li>\u63a7\u5236\u5668\u7ba1\u7406\u5668</li> <li>\u8c03\u5ea6\u5668</li> </ol> <p>\u63a7\u5236\u5668\u7ba1\u7406\u5668\u548c\u8c03\u5ea6\u5668\u65e5\u5fd7\u53ef\u4ee5\u5e2e\u52a9\u8bca\u65ad\u63a7\u5236\u5e73\u9762\u95ee\u9898\uff0c\u5982\u74f6\u9888\u548c\u9519\u8bef\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cEKS\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u4e0d\u4f1a\u53d1\u9001\u5230CloudWatch Logs\u3002\u60a8\u53ef\u4ee5\u4e3a\u60a8\u8d26\u6237\u4e2d\u7684\u6bcf\u4e2a\u96c6\u7fa4\u542f\u7528\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5e76\u9009\u62e9\u8981\u6355\u83b7\u7684EKS\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u7c7b\u578b\u3002</p> <p>\u6536\u96c6\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u9700\u8981\u5728\u60a8\u7684\u96c6\u7fa4\u4e2d\u5b89\u88c5\u65e5\u5fd7\u805a\u5408\u5de5\u5177\uff0c\u5982Fluent Bit\u3001Fluentd\u6216CloudWatch Container Insights\u3002</p> <p>Kubernetes\u65e5\u5fd7\u805a\u5408\u5de5\u5177\u4f5c\u4e3aDaemonSet\u8fd0\u884c\uff0c\u4ece\u8282\u70b9\u4e2d\u6293\u53d6\u5bb9\u5668\u65e5\u5fd7\u3002\u7136\u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u88ab\u53d1\u9001\u5230\u96c6\u4e2d\u7684\u76ee\u7684\u5730\u8fdb\u884c\u5b58\u50a8\u3002\u4f8b\u5982\uff0cCloudWatch Container Insights\u53ef\u4ee5\u4f7f\u7528Fluent Bit\u6216Fluentd\u6536\u96c6\u65e5\u5fd7\u5e76\u5c06\u5b83\u4eec\u53d1\u9001\u5230CloudWatch Logs\u8fdb\u884c\u5b58\u50a8\u3002Fluent Bit\u548cFluentd\u652f\u6301\u8bb8\u591a\u6d41\u884c\u7684\u65e5\u5fd7\u5206\u6790\u7cfb\u7edf\uff0c\u5982Elasticsearch\u548cInfluxDB\uff0c\u8fd9\u4f7f\u60a8\u80fd\u591f\u901a\u8fc7\u4fee\u6539Fluent bit\u6216Fluentd\u7684\u65e5\u5fd7\u914d\u7f6e\u6765\u66f4\u6539\u65e5\u5fd7\u7684\u5b58\u50a8\u540e\u7aef\u3002</p>"},{"location":"zh/reliability/docs/application/#_23","title":"\u4f7f\u7528\u5206\u5e03\u5f0f\u8ddf\u8e2a\u7cfb\u7edf\u8bc6\u522b\u74f6\u9888","text":"<p>\u5178\u578b\u7684\u73b0\u4ee3\u5e94\u7528\u7a0b\u5e8f\u7684\u7ec4\u4ef6\u5206\u5e03\u5728\u7f51\u7edc\u4e0a\uff0c\u5176\u53ef\u9760\u6027\u53d6\u51b3\u4e8e\u6784\u6210\u5e94\u7528\u7a0b\u5e8f\u7684\u6bcf\u4e2a\u7ec4\u4ef6\u7684\u6b63\u5e38\u8fd0\u884c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5206\u5e03\u5f0f\u8ddf\u8e2a\u89e3\u51b3\u65b9\u6848\u6765\u4e86\u89e3\u8bf7\u6c42\u7684\u6d41\u5411\u4ee5\u53ca\u7cfb\u7edf\u5982\u4f55\u901a\u4fe1\u3002\u8ddf\u8e2a\u53ef\u4ee5\u5411\u60a8\u5c55\u793a\u5e94\u7528\u7a0b\u5e8f\u7f51\u7edc\u4e2d\u5b58\u5728\u74f6\u9888\u7684\u4f4d\u7f6e\uff0c\u5e76\u9632\u6b62\u53ef\u80fd\u5bfc\u81f4\u7ea7\u8054\u6545\u969c\u7684\u95ee\u9898\u3002</p> <p>\u60a8\u6709\u4e24\u79cd\u9009\u62e9\u6765\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5b9e\u73b0\u8ddf\u8e2a\uff1a\u60a8\u53ef\u4ee5\u5728\u4ee3\u7801\u7ea7\u522b\u4f7f\u7528\u5171\u4eab\u5e93\u5b9e\u73b0\u5206\u5e03\u5f0f\u8ddf\u8e2a\uff0c\u6216\u8005\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u3002</p> <p>\u5728\u4ee3\u7801\u7ea7\u522b\u5b9e\u73b0\u8ddf\u8e2a\u53ef\u80fd\u662f\u4e0d\u5229\u7684\u3002\u5728\u8fd9\u79cd\u65b9\u6cd5\u4e2d\uff0c\u60a8\u5fc5\u987b\u4fee\u6539\u4ee3\u7801\u3002\u5982\u679c\u60a8\u6709\u591a\u8bed\u8a00\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u5c31\u66f4\u52a0\u590d\u6742\u4e86\u3002\u60a8\u8fd8\u9700\u8981\u8d1f\u8d23\u7ef4\u62a4\u8de8\u670d\u52a1\u7684\u53e6\u4e00\u4e2a\u5e93\u3002</p> <p>\u50cfLinkerD\u3001Istio\u548cAWS App Mesh\u8fd9\u6837\u7684\u670d\u52a1\u7f51\u683c\u53ef\u4ee5\u7528\u4e8e\u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5b9e\u73b0\u5206\u5e03\u5f0f\u8ddf\u8e2a\uff0c\u800c\u53ea\u9700\u5bf9\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u884c\u6700\u5c0f\u7684\u66f4\u6539\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u6765\u6807\u51c6\u5316\u6307\u6807\u751f\u6210\u3001\u65e5\u5fd7\u8bb0\u5f55\u548c\u8ddf\u8e2a\u3002</p> <p>\u8ddf\u8e2a\u5de5\u5177\u5982AWS X-Ray\u548cJaeger\u652f\u6301\u5171\u4eab\u5e93\u548c\u670d\u52a1\u7f51\u683c\u5b9e\u73b0\u3002</p> <p>\u8003\u8651\u4f7f\u7528\u652f\u6301\u8fd9\u4e24\u79cd\u5b9e\u73b0\u7684\u8ddf\u8e2a\u5de5\u5177\uff0c\u5982AWS X-Ray\u6216Jaeger,\u8fd9\u6837\u5982\u679c\u60a8\u4ee5\u540e\u91c7\u7528\u670d\u52a1\u7f51\u683c\uff0c\u5c31\u4e0d\u5fc5\u5207\u6362\u5de5\u5177\u3002</p>"},{"location":"zh/reliability/docs/controlplane/","title":"EKS \u63a7\u5236\u5e73\u9762","text":"<p>Amazon Elastic Kubernetes Service (EKS) \u662f\u4e00\u9879\u6258\u7ba1\u7684 Kubernetes \u670d\u52a1\uff0c\u53ef\u8ba9\u60a8\u65e0\u9700\u5b89\u88c5\u3001\u64cd\u4f5c\u548c\u7ef4\u62a4\u81ea\u5df1\u7684 Kubernetes \u63a7\u5236\u5e73\u9762\u6216\u5de5\u4f5c\u8282\u70b9\uff0c\u5373\u53ef\u8f7b\u677e\u5728 AWS \u4e0a\u8fd0\u884c Kubernetes\u3002\u5b83\u8fd0\u884c\u4e0a\u6e38 Kubernetes \u5e76\u7ecf\u8fc7 Kubernetes \u4e00\u81f4\u6027\u8ba4\u8bc1\u3002\u8fd9\u79cd\u4e00\u81f4\u6027\u786e\u4fdd EKS \u652f\u6301\u4e0e\u60a8\u53ef\u4ee5\u5728 EC2 \u6216\u672c\u5730\u5b89\u88c5\u7684\u5f00\u6e90\u793e\u533a\u7248\u672c\u76f8\u540c\u7684 Kubernetes API\u3002\u5728\u4e0a\u6e38 Kubernetes \u4e0a\u8fd0\u884c\u7684\u73b0\u6709\u5e94\u7528\u7a0b\u5e8f\u4e0e Amazon EKS \u517c\u5bb9\u3002</p> <p>EKS \u81ea\u52a8\u7ba1\u7406 Kubernetes \u63a7\u5236\u5e73\u9762\u8282\u70b9\u7684\u53ef\u7528\u6027\u548c\u53ef\u4f38\u7f29\u6027\uff0c\u5e76\u81ea\u52a8\u66ff\u6362\u4e0d\u5065\u5eb7\u7684\u63a7\u5236\u5e73\u9762\u8282\u70b9\u3002</p>"},{"location":"zh/reliability/docs/controlplane/#eks_1","title":"EKS \u67b6\u6784","text":"<p>EKS \u67b6\u6784\u65e8\u5728\u6d88\u9664\u53ef\u80fd\u5f71\u54cd Kubernetes \u63a7\u5236\u5e73\u9762\u53ef\u7528\u6027\u548c\u6301\u4e45\u6027\u7684\u4efb\u4f55\u5355\u70b9\u6545\u969c\u3002</p> <p>\u7531 EKS \u7ba1\u7406\u7684 Kubernetes \u63a7\u5236\u5e73\u9762\u8fd0\u884c\u5728 EKS \u6258\u7ba1\u7684 VPC \u5185\u3002EKS \u63a7\u5236\u5e73\u9762\u5305\u62ec Kubernetes API \u670d\u52a1\u5668\u8282\u70b9\u3001etcd \u96c6\u7fa4\u3002\u8fd0\u884c API \u670d\u52a1\u5668\u3001\u8c03\u5ea6\u7a0b\u5e8f\u548c <code>kube-controller-manager</code> \u7b49\u7ec4\u4ef6\u7684 Kubernetes API \u670d\u52a1\u5668\u8282\u70b9\u5728\u4e00\u4e2a\u81ea\u52a8\u4f38\u7f29\u7ec4\u4e2d\u8fd0\u884c\u3002EKS \u5728 AWS \u533a\u57df\u5185\u7684\u4e0d\u540c\u53ef\u7528\u533a (AZ) \u4e2d\u81f3\u5c11\u8fd0\u884c\u4e24\u4e2a API \u670d\u52a1\u5668\u8282\u70b9\u3002\u540c\u6837\uff0c\u4e3a\u4e86\u6301\u4e45\u6027\uff0cetcd \u670d\u52a1\u5668\u8282\u70b9\u4e5f\u5728\u8de8\u8d8a\u4e09\u4e2a AZ \u7684\u81ea\u52a8\u4f38\u7f29\u7ec4\u4e2d\u8fd0\u884c\u3002EKS \u5728\u6bcf\u4e2a AZ \u4e2d\u8fd0\u884c\u4e00\u4e2a NAT \u7f51\u5173\uff0cAPI \u670d\u52a1\u5668\u548c etcd \u670d\u52a1\u5668\u8fd0\u884c\u5728\u79c1\u6709\u5b50\u7f51\u4e2d\u3002\u8fd9\u79cd\u67b6\u6784\u786e\u4fdd\u5355\u4e2a AZ \u4e2d\u7684\u4e8b\u4ef6\u4e0d\u4f1a\u5f71\u54cd EKS \u96c6\u7fa4\u7684\u53ef\u7528\u6027\u3002</p> <p>\u5f53\u60a8\u521b\u5efa\u65b0\u96c6\u7fa4\u65f6\uff0cAmazon EKS \u4f1a\u4e3a\u6258\u7ba1\u7684 Kubernetes API \u670d\u52a1\u5668\u521b\u5efa\u4e00\u4e2a\u9ad8\u53ef\u7528\u6027\u7aef\u70b9\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8be5\u7aef\u70b9\u4e0e\u96c6\u7fa4\u901a\u4fe1(\u4f7f\u7528\u8bf8\u5982 <code>kubectl</code> \u4e4b\u7c7b\u7684\u5de5\u5177)\u3002\u6258\u7ba1\u7aef\u70b9\u4f7f\u7528 NLB \u6765\u8d1f\u8f7d\u5747\u8861 Kubernetes API \u670d\u52a1\u5668\u3002EKS \u8fd8\u5728\u4e0d\u540c\u7684 AZ \u4e2d\u914d\u7f6e\u4e86\u4e24\u4e2a ENI,\u4ee5\u4fc3\u8fdb\u4e0e\u5de5\u4f5c\u8282\u70b9\u7684\u901a\u4fe1\u3002</p> <p></p> <p>\u60a8\u53ef\u4ee5\u914d\u7f6e Kubernetes \u96c6\u7fa4\u7684 API \u670d\u52a1\u5668\u662f\u5426\u53ef\u901a\u8fc7\u516c\u5171\u4e92\u8054\u7f51(\u4f7f\u7528\u516c\u5171\u7aef\u70b9)\u6216\u901a\u8fc7\u60a8\u7684 VPC (\u4f7f\u7528 EKS \u6258\u7ba1\u7684 ENI) \u6216\u4e24\u8005\u90fd\u53ef\u8bbf\u95ee\u3002</p> <p>\u65e0\u8bba\u7528\u6237\u548c\u5de5\u4f5c\u8282\u70b9\u662f\u4f7f\u7528\u516c\u5171\u7aef\u70b9\u8fd8\u662f EKS \u6258\u7ba1\u7684 ENI \u8fde\u63a5\u5230 API \u670d\u52a1\u5668\uff0c\u90fd\u6709\u5197\u4f59\u7684\u8fde\u63a5\u8def\u5f84\u3002</p>"},{"location":"zh/reliability/docs/controlplane/#_1","title":"\u5efa\u8bae","text":""},{"location":"zh/reliability/docs/controlplane/#_2","title":"\u76d1\u63a7\u63a7\u5236\u5e73\u9762\u6307\u6807","text":"<p>\u76d1\u63a7 Kubernetes API \u6307\u6807\u53ef\u4ee5\u8ba9\u60a8\u4e86\u89e3\u63a7\u5236\u5e73\u9762\u6027\u80fd\u5e76\u8bc6\u522b\u95ee\u9898\u3002\u4e0d\u5065\u5eb7\u7684\u63a7\u5236\u5e73\u9762\u53ef\u80fd\u4f1a\u5f71\u54cd\u96c6\u7fa4\u5185\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u53ef\u7528\u6027\u3002\u4f8b\u5982\uff0c\u7f16\u5199\u4e0d\u5f53\u7684\u63a7\u5236\u5668\u53ef\u80fd\u4f1a\u4f7f API \u670d\u52a1\u5668\u8fc7\u8f7d\uff0c\u4ece\u800c\u5f71\u54cd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u7528\u6027\u3002</p> <p>Kubernetes \u5728 <code>/metrics</code> \u7aef\u70b9\u516c\u5f00\u63a7\u5236\u5e73\u9762\u6307\u6807\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>kubectl</code> \u67e5\u770b\u516c\u5f00\u7684\u6307\u6807\uff1a</p> <pre><code>kubectl get --raw /metrics\n</code></pre> <p>\u8fd9\u4e9b\u6307\u6807\u4ee5 Prometheus \u6587\u672c\u683c\u5f0f\u8868\u793a\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 Prometheus \u6536\u96c6\u548c\u5b58\u50a8\u8fd9\u4e9b\u6307\u6807\u30022020 \u5e74 5 \u6708\uff0cCloudWatch \u589e\u52a0\u4e86\u5bf9 CloudWatch Container Insights \u4e2d Prometheus \u6307\u6807\u7684\u76d1\u63a7\u652f\u6301\u3002\u56e0\u6b64\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528 Amazon CloudWatch \u6765\u76d1\u63a7 EKS \u63a7\u5236\u5e73\u9762\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6559\u7a0b\uff1a\u6dfb\u52a0\u65b0\u7684 Prometheus \u6293\u53d6\u76ee\u6807\uff1aPrometheus KPI \u670d\u52a1\u5668\u6307\u6807\u6765\u6536\u96c6\u6307\u6807\u5e76\u521b\u5efa CloudWatch \u4eea\u8868\u677f\u4ee5\u76d1\u63a7\u60a8\u7684\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230 Kubernetes API \u670d\u52a1\u5668\u6307\u6807\u3002\u4f8b\u5982\uff0c<code>apiserver_request_duration_seconds</code> \u53ef\u4ee5\u6307\u793a API \u8bf7\u6c42\u8fd0\u884c\u6240\u9700\u7684\u65f6\u95f4\u3002</p> <p>\u8bf7\u8003\u8651\u76d1\u63a7\u4ee5\u4e0b\u63a7\u5236\u5e73\u9762\u6307\u6807\uff1a</p>"},{"location":"zh/reliability/docs/controlplane/#api","title":"API \u670d\u52a1\u5668","text":"\u6307\u6807 \u63cf\u8ff0 <code>apiserver_request_total</code> \u6309\u52a8\u8bcd\u3001dry run \u503c\u3001\u7ec4\u3001\u7248\u672c\u3001\u8d44\u6e90\u3001\u8303\u56f4\u3001\u7ec4\u4ef6\u548c HTTP \u54cd\u5e94\u4ee3\u7801\u5212\u5206\u7684 apiserver \u8bf7\u6c42\u8ba1\u6570\u5668\u3002 <code>apiserver_request_duration_seconds*</code> \u6309\u52a8\u8bcd\u3001dry run \u503c\u3001\u7ec4\u3001\u7248\u672c\u3001\u8d44\u6e90\u3001\u5b50\u8d44\u6e90\u3001\u8303\u56f4\u548c\u7ec4\u4ef6\u5212\u5206\u7684\u54cd\u5e94\u5ef6\u8fdf\u5206\u5e03(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 <code>apiserver_admission_controller_admission_duration_seconds</code> \u6309\u540d\u79f0\u8bc6\u522b\u7684\u51c6\u5165\u63a7\u5236\u5668\u5ef6\u8fdf\u76f4\u65b9\u56fe(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\uff0c\u5e76\u6309\u64cd\u4f5c\u548c API \u8d44\u6e90\u548c\u7c7b\u578b(\u9a8c\u8bc1\u6216\u51c6\u5165)\u5212\u5206\u3002 <code>apiserver_admission_webhook_rejection_count</code> \u51c6\u5165 Webhook \u62d2\u7edd\u8ba1\u6570\u3002\u6309\u540d\u79f0\u3001\u64cd\u4f5c\u3001\u62d2\u7edd\u4ee3\u7801\u3001\u7c7b\u578b(\u9a8c\u8bc1\u6216\u51c6\u5165)\u3001\u9519\u8bef\u7c7b\u578b(\u8c03\u7528 Webhook \u9519\u8bef\u3001apiserver \u5185\u90e8\u9519\u8bef\u3001\u65e0\u9519\u8bef)\u8bc6\u522b\u3002 <code>rest_client_request_duration_seconds</code> \u8bf7\u6c42\u5ef6\u8fdf(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002\u6309\u52a8\u8bcd\u548c URL \u5212\u5206\u3002 <code>rest_client_requests_total</code> HTTP \u8bf7\u6c42\u6570\u91cf\uff0c\u6309\u72b6\u6001\u4ee3\u7801\u3001\u65b9\u6cd5\u548c\u4e3b\u673a\u5212\u5206\u3002"},{"location":"zh/reliability/docs/controlplane/#etcd","title":"etcd","text":"\u6307\u6807 \u63cf\u8ff0 <code>etcd_request_duration_seconds</code> \u6bcf\u4e2a\u64cd\u4f5c\u548c\u5bf9\u8c61\u7c7b\u578b\u7684 etcd \u8bf7\u6c42\u5ef6\u8fdf(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 <code>etcd_db_total_size_in_bytes</code> \u6216 <code>apiserver_storage_db_total_size_in_bytes</code> (\u4ece EKS v1.26 \u5f00\u59cb) \u6216 <code>apiserver_storage_size_bytes</code> (\u4ece EKS v1.28 \u5f00\u59cb) Etcd \u6570\u636e\u5e93\u5927\u5c0f\u3002 <p>\u8bf7\u8003\u8651\u4f7f\u7528 Kubernetes \u76d1\u63a7\u6982\u89c8\u4eea\u8868\u677f\u6765\u53ef\u89c6\u5316\u548c\u76d1\u63a7 Kubernetes API \u670d\u52a1\u5668\u8bf7\u6c42\u548c\u5ef6\u8fdf\u4ee5\u53ca etcd \u5ef6\u8fdf\u6307\u6807\u3002</p> <p>\u4ee5\u4e0b Prometheus \u67e5\u8be2\u53ef\u7528\u4e8e\u76d1\u63a7 etcd \u7684\u5f53\u524d\u5927\u5c0f\u3002\u8be5\u67e5\u8be2\u5047\u8bbe\u6709\u4e00\u4e2a\u540d\u4e3a <code>kube-apiserver</code> \u7684\u4f5c\u4e1a\u7528\u4e8e\u4ece API \u6307\u6807\u7aef\u70b9\u6293\u53d6\u6307\u6807\uff0c\u5e76\u4e14 EKS \u7248\u672c\u4f4e\u4e8e v1.26\u3002</p> <pre><code>max(etcd_db_total_size_in_bytes{job=\"kube-apiserver\"} / (8 * 1024 * 1024 * 1024))\n</code></pre> <p>\u6ce8\u610f</p> <p>\u5f53\u6570\u636e\u5e93\u5927\u5c0f\u8d85\u8fc7\u9650\u5236\u65f6\uff0cetcd \u4f1a\u53d1\u51fa\u7a7a\u95f4\u4e0d\u8db3\u8b66\u62a5\u5e76\u505c\u6b62\u63a5\u53d7\u8fdb\u4e00\u6b65\u7684\u5199\u5165\u8bf7\u6c42\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u96c6\u7fa4\u53d8\u4e3a\u53ea\u8bfb\uff0c\u6240\u6709\u5bf9\u8c61\u7684\u53d8\u66f4\u8bf7\u6c42(\u5982\u521b\u5efa\u65b0 Pod\u3001\u6269\u7f29 Deployment \u7b49)\u90fd\u5c06\u88ab\u96c6\u7fa4\u7684 API \u670d\u52a1\u5668\u62d2\u7edd\u3002</p>"},{"location":"zh/reliability/docs/controlplane/#_3","title":"\u96c6\u7fa4\u8eab\u4efd\u9a8c\u8bc1","text":"<p>EKS \u5f53\u524d\u652f\u6301\u4e24\u79cd\u8eab\u4efd\u9a8c\u8bc1\u7c7b\u578b\uff1a\u6301\u6709\u8005/\u670d\u52a1\u5e10\u6237\u4ee4\u724c\u548c\u4f7f\u7528 Webhook \u4ee4\u724c\u8eab\u4efd\u9a8c\u8bc1\u7684 IAM \u8eab\u4efd\u9a8c\u8bc1\u3002\u5f53\u7528\u6237\u8c03\u7528 Kubernetes API \u65f6\uff0cWebhook \u4f1a\u5c06\u8bf7\u6c42\u4e2d\u5305\u542b\u7684\u8eab\u4efd\u9a8c\u8bc1\u4ee4\u724c\u4f20\u9012\u7ed9 IAM\u3002\u8be5\u4ee4\u724c\u662f\u7531 AWS \u547d\u4ee4\u884c\u754c\u9762 (AWS CLI) \u751f\u6210\u7684\u4e00\u4e2a base64 \u7b7e\u540d URL\u3002</p> <p>\u521b\u5efa EKS \u96c6\u7fa4\u7684 IAM \u7528\u6237\u6216\u89d2\u8272\u4f1a\u81ea\u52a8\u83b7\u5f97\u5bf9\u96c6\u7fa4\u7684\u5b8c\u5168\u8bbf\u95ee\u6743\u9650\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u7f16\u8f91 <code>aws-auth</code> configmap \u6765\u7ba1\u7406\u5bf9 EKS \u96c6\u7fa4\u7684\u8bbf\u95ee\u3002</p> <p>\u5982\u679c\u60a8\u9519\u8bef\u914d\u7f6e\u4e86 <code>aws-auth</code> configmap \u5e76\u4e22\u5931\u4e86\u5bf9\u96c6\u7fa4\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u60a8\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528\u96c6\u7fa4\u521b\u5efa\u8005\u7684\u7528\u6237\u6216\u89d2\u8272\u6765\u8bbf\u95ee\u60a8\u7684 EKS \u96c6\u7fa4\u3002</p> <p>\u5728\u6781\u5c11\u6570\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u60a8\u65e0\u6cd5\u5728 AWS \u533a\u57df\u4e2d\u4f7f\u7528 IAM \u670d\u52a1\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528 Kubernetes \u670d\u52a1\u5e10\u6237\u7684\u6301\u6709\u8005\u4ee4\u724c\u6765\u7ba1\u7406\u96c6\u7fa4\u3002</p> <p>\u521b\u5efa\u4e00\u4e2a\"\u8d85\u7ea7\u7ba1\u7406\u5458\"\u5e10\u6237\uff0c\u5141\u8bb8\u5728\u96c6\u7fa4\u4e2d\u6267\u884c\u6240\u6709\u64cd\u4f5c\uff1a</p> <pre><code>kubectl -n kube-system create serviceaccount super-admin\n</code></pre> <p>\u521b\u5efa\u4e00\u4e2a\u89d2\u8272\u7ed1\u5b9a\uff0c\u5c06 cluster-admin \u89d2\u8272\u6388\u4e88 super-admin:</p> <pre><code>kubectl create clusterrolebinding super-admin-rb --clusterrole=cluster-admin --serviceaccount=kube-system:super-admin\n</code></pre> <p>\u83b7\u53d6\u670d\u52a1\u5e10\u6237\u7684 secret\uff1a</p> <pre><code>SECRET_NAME=`kubectl -n kube-system get serviceaccount/super-admin -o jsonpath='{.secrets[0].name}'`\n</code></pre> <p>\u83b7\u53d6\u4e0e secret \u5173\u8054\u7684\u4ee4\u724c\uff1a</p> <pre><code>TOKEN=`kubectl -n kube-system get secret $SECRET_NAME -o jsonpath='{.data.token}'| base64 --decode`\n</code></pre> <p>\u5c06\u670d\u52a1\u5e10\u6237\u548c\u4ee4\u724c\u6dfb\u52a0\u5230 <code>kubeconfig</code>:</p> <pre><code>kubectl config set-credentials super-admin --token=$TOKEN\n</code></pre> <p>\u5728 <code>kubeconfig</code> \u4e2d\u8bbe\u7f6e\u5f53\u524d\u4e0a\u4e0b\u6587\u4ee5\u4f7f\u7528 super-admin \u5e10\u6237\uff1a</p> <pre><code>kubectl config set-context --current --user=super-admin\n</code></pre> <p>\u6700\u7ec8\u7684 <code>kubeconfig</code> \u5e94\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data:&lt;REDACTED&gt;\n    server: https://&lt;CLUSTER&gt;.gr7.us-west-2.eks.amazonaws.com\n  name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\ncontexts:\n- context:\n    cluster: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\n    user: super-admin\n  name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\ncurrent-context: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\nkind: Config\npreferences: {}\nusers:\n#- name: arn:aws:eks:us-west-2:&lt;account number&gt;:cluster/&lt;cluster name&gt;\n#  user:\n#    exec:\n#      apiVersion: client.authentication.k8s.io/v1alpha1\n#      args:\n#      - --region\n#      - us-west-2\n#      - eks\n#      - get-token\n#      - --cluster-name\n#      - &lt;&lt;cluster name&gt;&gt;\n#      command: aws\n#      env: null\n- name: super-admin\n  user:\n    token: &lt;&lt;super-admin sa's secret&gt;&gt;\n</code></pre>"},{"location":"zh/reliability/docs/controlplane/#webhook","title":"\u51c6\u5165 Webhook","text":"<p>Kubernetes \u6709\u4e24\u79cd\u7c7b\u578b\u7684\u51c6\u5165 Webhook\uff1a\u9a8c\u8bc1\u51c6\u5165 Webhook \u548c\u53d8\u66f4\u51c6\u5165 Webhook\u3002\u8fd9\u4e9b\u5141\u8bb8\u7528\u6237\u6269\u5c55 kubernetes API\uff0c\u5e76\u5728\u5bf9\u8c61\u88ab API \u63a5\u53d7\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u9a8c\u8bc1\u6216\u53d8\u66f4\u3002\u914d\u7f6e\u4e0d\u5f53\u7684\u8fd9\u4e9b Webhook \u53ef\u80fd\u4f1a\u901a\u8fc7\u963b\u6b62\u96c6\u7fa4\u5173\u952e\u64cd\u4f5c\u6765\u7834\u574f EKS \u63a7\u5236\u5e73\u9762\u7684\u7a33\u5b9a\u6027\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u5f71\u54cd\u96c6\u7fa4\u5173\u952e\u64cd\u4f5c\uff0c\u8bf7\u907f\u514d\u8bbe\u7f6e\"\u5168\u6355\u83b7\"Webhook,\u5982\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>- name: \"pod-policy.example.com\"\n  rules:\n  - apiGroups:   [\"*\"]\n    apiVersions: [\"*\"]\n    operations:  [\"*\"]\n    resources:   [\"*\"]\n    scope: \"*\"\n</code></pre> <p>\u6216\u8005\u786e\u4fdd Webhook \u5177\u6709\u5931\u6548\u5f00\u653e\u7b56\u7565\uff0c\u8d85\u65f6\u65f6\u95f4\u77ed\u4e8e 30 \u79d2\uff0c\u4ee5\u786e\u4fdd\u5982\u679c\u60a8\u7684 Webhook \u4e0d\u53ef\u7528\uff0c\u5b83\u4e0d\u4f1a\u635f\u5bb3\u96c6\u7fa4\u5173\u952e\u5de5\u4f5c\u8d1f\u8f7d\u3002</p>"},{"location":"zh/reliability/docs/controlplane/#sysctls-pod","title":"\u963b\u6b62\u5177\u6709\u4e0d\u5b89\u5168 <code>sysctls</code> \u7684 Pod","text":"<p><code>Sysctl</code> \u662f\u4e00\u4e2a Linux \u5b9e\u7528\u7a0b\u5e8f\uff0c\u5141\u8bb8\u7528\u6237\u5728\u8fd0\u884c\u65f6\u4fee\u6539\u5185\u6838\u53c2\u6570\u3002\u8fd9\u4e9b\u5185\u6838\u53c2\u6570\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\u884c\u4e3a\u7684\u5404\u4e2a\u65b9\u9762\uff0c\u5982\u7f51\u7edc\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u865a\u62df\u5185\u5b58\u548c\u8fdb\u7a0b\u7ba1\u7406\u3002</p> <p>Kubernetes \u5141\u8bb8\u4e3a Pod \u5206\u914d <code>sysctl</code> \u914d\u7f6e\u6587\u4ef6\u3002Kubernetes \u5c06 <code>sysctl</code> \u5206\u4e3a\u5b89\u5168\u548c\u4e0d\u5b89\u5168\u4e24\u7c7b\u3002\u5b89\u5168\u7684 <code>sysctl</code> \u5728\u5bb9\u5668\u6216 Pod \u4e2d\u662f\u547d\u540d\u7a7a\u95f4\u5316\u7684\uff0c\u8bbe\u7f6e\u5b83\u4eec\u4e0d\u4f1a\u5f71\u54cd\u8282\u70b9\u4e0a\u7684\u5176\u4ed6 Pod \u6216\u8282\u70b9\u672c\u8eab\u3002\u76f8\u53cd\uff0c\u4e0d\u5b89\u5168\u7684 sysctl \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ef\u80fd\u4f1a\u5e72\u6270\u5176\u4ed6 Pod \u6216\u4f7f\u8282\u70b9\u4e0d\u7a33\u5b9a\u3002</p> <p>\u7531\u4e8e\u4e0d\u5b89\u5168\u7684 <code>sysctl</code> \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0ckubelet \u5c06\u4e0d\u4f1a\u521b\u5efa\u5177\u6709\u4e0d\u5b89\u5168 <code>sysctl</code> \u914d\u7f6e\u6587\u4ef6\u7684 Pod\u3002\u5982\u679c\u60a8\u521b\u5efa\u8fd9\u6837\u7684 Pod\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u5c06\u53cd\u590d\u5c06\u6b64\u7c7b Pod \u5206\u914d\u7ed9\u8282\u70b9\uff0c\u800c\u8282\u70b9\u5c06\u65e0\u6cd5\u542f\u52a8\u5b83\u3002\u8fd9\u4e2a\u65e0\u9650\u5faa\u73af\u6700\u7ec8\u4f1a\u7ed9\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u5e26\u6765\u538b\u529b\uff0c\u4f7f\u96c6\u7fa4\u4e0d\u7a33\u5b9a\u3002</p> <p>\u8bf7\u8003\u8651\u4f7f\u7528 OPA Gatekeeper \u6216 Kyverno \u6765\u62d2\u7edd\u5177\u6709\u4e0d\u5b89\u5168 <code>sysctl</code> \u7684 Pod\u3002</p>"},{"location":"zh/reliability/docs/controlplane/#_4","title":"\u5904\u7406\u96c6\u7fa4\u5347\u7ea7","text":"<p>\u81ea 2021 \u5e74 4 \u6708\u8d77\uff0cKubernetes \u53d1\u5e03\u5468\u671f\u5df2\u4ece\u6bcf\u5e74\u56db\u6b21(\u6bcf\u5b63\u5ea6\u4e00\u6b21)\u66f4\u6539\u4e3a\u6bcf\u5e74\u4e09\u6b21\u3002\u65b0\u7684\u6b21\u8981\u7248\u672c(\u5982 1.21 \u6216 1.22)\u5927\u7ea6\u6bcf 15 \u5468\u53d1\u5e03\u4e00\u6b21\u3002\u4ece Kubernetes 1.19 \u5f00\u59cb\uff0c\u6bcf\u4e2a\u6b21\u8981\u7248\u672c\u5728\u9996\u6b21\u53d1\u5e03\u540e\u5927\u7ea6\u652f\u6301 12 \u4e2a\u6708\u3002\u968f\u7740 Kubernetes v1.28 \u7684\u63a8\u51fa\uff0c\u63a7\u5236\u5e73\u9762\u548c\u5de5\u4f5c\u8282\u70b9\u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u504f\u5dee\u5df2\u4ece n-2 \u6b21\u6b21\u8981\u7248\u672c\u6269\u5c55\u5230 n-3 \u6b21\u6b21\u8981\u7248\u672c\u3002\u8981\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u96c6\u7fa4\u5347\u7ea7\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"zh/reliability/docs/controlplane/#_5","title":"\u8fd0\u884c\u5927\u578b\u96c6\u7fa4","text":"<p>EKS \u4f1a\u4e3b\u52a8\u76d1\u63a7\u63a7\u5236\u5e73\u9762\u5b9e\u4f8b\u7684\u8d1f\u8f7d\uff0c\u5e76\u81ea\u52a8\u5bf9\u5176\u8fdb\u884c\u6269\u7f29\u4ee5\u786e\u4fdd\u9ad8\u6027\u80fd\u3002\u4f46\u662f\uff0c\u5728\u8fd0\u884c\u5927\u578b\u96c6\u7fa4\u65f6\uff0c\u60a8\u5e94\u8be5\u8003\u8651 Kubernetes \u5185\u90e8\u53ef\u80fd\u5b58\u5728\u7684\u6027\u80fd\u95ee\u9898\u548c\u9650\u5236\u4ee5\u53ca AWS \u670d\u52a1\u4e2d\u7684\u914d\u989d\u3002</p> <ul> <li>\u6839\u636e ProjectCalico \u56e2\u961f\u6267\u884c\u7684\u6d4b\u8bd5,\u5177\u6709 1000 \u591a\u4e2a\u670d\u52a1\u7684\u96c6\u7fa4\u5728\u4f7f\u7528 <code>iptables</code> \u6a21\u5f0f\u7684 <code>kube-proxy</code> \u65f6\u53ef\u80fd\u4f1a\u9047\u5230\u7f51\u7edc\u5ef6\u8fdf\u3002\u89e3\u51b3\u65b9\u6848\u662f\u5207\u6362\u5230\u4ee5 <code>ipvs</code> \u6a21\u5f0f\u8fd0\u884c <code>kube-proxy</code>\u3002</li> <li>\u5982\u679c CNI \u9700\u8981\u4e3a Pod \u8bf7\u6c42 IP \u5730\u5740\u6216\u8005\u60a8\u9700\u8981\u9891\u7e41\u521b\u5efa\u65b0\u7684 EC2 \u5b9e\u4f8b\uff0c\u60a8\u4e5f\u53ef\u80fd\u4f1a\u9047\u5230 EC2 API \u8bf7\u6c42\u9650\u5236\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e CNI \u6765\u7f13\u5b58 IP \u5730\u5740\u6765\u51cf\u5c11\u5bf9 EC2 API \u7684\u8c03\u7528\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u66f4\u5927\u7684 EC2 \u5b9e\u4f8b\u7c7b\u578b\u6765\u51cf\u5c11 EC2 \u6269\u7f29\u4e8b\u4ef6\u3002</li> </ul>"},{"location":"zh/reliability/docs/controlplane/#_6","title":"\u5176\u4ed6\u8d44\u6e90\uff1a","text":"<ul> <li>\u63ed\u5f00 Amazon EKS \u5de5\u4f5c\u8282\u70b9\u7684\u96c6\u7fa4\u7f51\u7edc\u795e\u79d8\u9762\u7eb1</li> <li>Amazon EKS \u96c6\u7fa4\u7aef\u70b9\u8bbf\u95ee\u63a7\u5236</li> <li>AWS re:Invent 2019: Amazon EKS \u5185\u90e8\u673a\u5236 (CON421-R1)</li> </ul>"},{"location":"zh/reliability/docs/dataplane/","title":"EKS \u6570\u636e\u5e73\u9762","text":"<p>\u8981\u8fd0\u884c\u9ad8\u53ef\u7528\u548c\u9ad8\u5f39\u6027\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u60a8\u9700\u8981\u4e00\u4e2a\u9ad8\u53ef\u7528\u548c\u9ad8\u5f39\u6027\u7684\u6570\u636e\u5e73\u9762\u3002\u5f39\u6027\u6570\u636e\u5e73\u9762\u53ef\u786e\u4fdd Kubernetes \u80fd\u591f\u81ea\u52a8\u6269\u5c55\u548c\u4fee\u590d\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u4e00\u4e2a\u9ad8\u5f39\u6027\u7684\u6570\u636e\u5e73\u9762\u7531\u4e24\u4e2a\u6216\u66f4\u591a\u5de5\u4f5c\u8282\u70b9\u7ec4\u6210\uff0c\u53ef\u4ee5\u968f\u5de5\u4f5c\u8d1f\u8f7d\u7684\u589e\u957f\u548c\u51cf\u5c11\u800c\u6269\u5c55\u548c\u6536\u7f29\uff0c\u5e76\u80fd\u591f\u81ea\u52a8\u4ece\u6545\u969c\u4e2d\u6062\u590d\u3002</p> <p>\u5728 EKS \u4e2d\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9 EC2 \u5b9e\u4f8b\u6216 Fargate \u4f5c\u4e3a\u5de5\u4f5c\u8282\u70b9\u3002\u5982\u679c\u9009\u62e9 EC2 \u5b9e\u4f8b\uff0c\u60a8\u53ef\u4ee5\u81ea\u884c\u7ba1\u7406\u5de5\u4f5c\u8282\u70b9\u6216\u4f7f\u7528 EKS \u6258\u7ba1\u8282\u70b9\u7ec4\u3002\u60a8\u53ef\u4ee5\u5728\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u6df7\u5408\u4f7f\u7528\u6258\u7ba1\u8282\u70b9\u3001\u81ea\u7ba1\u7406\u8282\u70b9\u548c Fargate\u3002</p> <p>EKS on Fargate \u63d0\u4f9b\u4e86\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u9ad8\u5f39\u6027\u7684\u6570\u636e\u5e73\u9762\u3002Fargate \u5728\u4e00\u4e2a\u9694\u79bb\u7684\u8ba1\u7b97\u73af\u5883\u4e2d\u8fd0\u884c\u6bcf\u4e2a Pod\u3002\u5728 Fargate \u4e0a\u8fd0\u884c\u7684\u6bcf\u4e2a Pod \u90fd\u6709\u81ea\u5df1\u7684\u5de5\u4f5c\u8282\u70b9\u3002Fargate \u4f1a\u968f\u7740 Kubernetes \u6269\u5c55 Pod \u800c\u81ea\u52a8\u6269\u5c55\u6570\u636e\u5e73\u9762\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 horizontal pod autoscaler \u6765\u540c\u65f6\u6269\u5c55\u6570\u636e\u5e73\u9762\u548c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p> <p>\u6269\u5c55 EC2 \u5de5\u4f5c\u8282\u70b9\u7684\u9996\u9009\u65b9\u5f0f\u662f\u4f7f\u7528 Kubernetes Cluster Autoscaler\u3001EC2 Auto Scaling \u7ec4\u6216\u793e\u533a\u9879\u76ee\u5982 Atlassian's Escalator\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#_1","title":"\u5efa\u8bae","text":""},{"location":"zh/reliability/docs/dataplane/#ec2-auto-scaling","title":"\u4f7f\u7528 EC2 Auto Scaling \u7ec4\u521b\u5efa\u5de5\u4f5c\u8282\u70b9","text":"<p>\u6700\u4f73\u5b9e\u8df5\u662f\u4f7f\u7528 EC2 Auto Scaling \u7ec4\u800c\u4e0d\u662f\u521b\u5efa\u5355\u4e2a EC2 \u5b9e\u4f8b\u5e76\u5c06\u5176\u52a0\u5165\u96c6\u7fa4\u6765\u521b\u5efa\u5de5\u4f5c\u8282\u70b9\u3002Auto Scaling \u7ec4\u4f1a\u81ea\u52a8\u66ff\u6362\u4efb\u4f55\u7ec8\u6b62\u6216\u5931\u8d25\u7684\u8282\u70b9\uff0c\u786e\u4fdd\u96c6\u7fa4\u59cb\u7ec8\u6709\u8db3\u591f\u7684\u5bb9\u91cf\u6765\u8fd0\u884c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#kubernetes-cluster-autoscaler","title":"\u4f7f\u7528 Kubernetes Cluster Autoscaler \u6269\u5c55\u8282\u70b9","text":"<p>\u5f53\u7531\u4e8e\u96c6\u7fa4\u8d44\u6e90\u4e0d\u8db3\u800c\u65e0\u6cd5\u8fd0\u884c Pod \u65f6\uff0cCluster Autoscaler \u4f1a\u8c03\u6574\u6570\u636e\u5e73\u9762\u7684\u5927\u5c0f\uff0c\u5e76\u4e14\u6dfb\u52a0\u53e6\u4e00\u4e2a\u5de5\u4f5c\u8282\u70b9\u4f1a\u6709\u6240\u5e2e\u52a9\u3002\u5c3d\u7ba1 Cluster Autoscaler \u662f\u4e00\u4e2a\u53cd\u5e94\u5f0f\u8fc7\u7a0b\uff0c\u4f46\u5b83\u4f1a\u7b49\u5230\u7531\u4e8e\u96c6\u7fa4\u5bb9\u91cf\u4e0d\u8db3\u800c\u5bfc\u81f4 Pod \u5904\u4e8e Pending \u72b6\u6001\u65f6\u624d\u4f1a\u6267\u884c\u3002\u5f53\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0c\u5b83\u4f1a\u5411\u96c6\u7fa4\u6dfb\u52a0 EC2 \u5b9e\u4f8b\u3002\u6bcf\u5f53\u96c6\u7fa4\u8d44\u6e90\u4e0d\u8db3\u65f6\uff0c\u65b0\u7684\u526f\u672c\u6216\u65b0\u7684 Pod \u90fd\u5c06\u65e0\u6cd5\u53ef\u7528(\u5904\u4e8e Pending \u72b6\u6001)\uff0c\u76f4\u5230\u6dfb\u52a0\u5de5\u4f5c\u8282\u70b9\u4e3a\u6b62\u3002\u5982\u679c\u6570\u636e\u5e73\u9762\u65e0\u6cd5\u8db3\u591f\u5feb\u5730\u6269\u5c55\u4ee5\u6ee1\u8db3\u5de5\u4f5c\u8d1f\u8f7d\u7684\u9700\u6c42\uff0c\u8fd9\u79cd\u5ef6\u8fdf\u53ef\u80fd\u4f1a\u5f71\u54cd\u60a8\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u9760\u6027\u3002\u5982\u679c\u4e00\u4e2a\u5de5\u4f5c\u8282\u70b9\u6301\u7eed\u5904\u4e8e\u4f4e\u5229\u7528\u7387\u72b6\u6001\uff0c\u5e76\u4e14\u5b83\u4e0a\u9762\u7684\u6240\u6709 Pod \u90fd\u53ef\u4ee5\u5728\u5176\u4ed6\u5de5\u4f5c\u8282\u70b9\u4e0a\u8c03\u5ea6\uff0cCluster Autoscaler \u4f1a\u7ec8\u6b62\u5b83\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#cluster-autoscaler","title":"\u4e3a Cluster Autoscaler \u914d\u7f6e\u8fc7\u5ea6\u914d\u7f6e","text":"<p>Cluster Autoscaler \u5728\u96c6\u7fa4\u4e2d\u7684 Pod \u5df2\u7ecf\u5904\u4e8e Pending \u72b6\u6001\u65f6\u624d\u4f1a\u89e6\u53d1\u6570\u636e\u5e73\u9762\u7684\u6269\u5c55\u3002\u56e0\u6b64\uff0c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u66f4\u591a\u526f\u672c\u548c\u5b9e\u9645\u83b7\u5f97\u66f4\u591a\u526f\u672c\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u5ef6\u8fdf\u3002\u89e3\u51b3\u8fd9\u79cd\u53ef\u80fd\u5ef6\u8fdf\u7684\u4e00\u79cd\u65b9\u6cd5\u662f\u6dfb\u52a0\u6bd4\u6240\u9700\u66f4\u591a\u7684\u526f\u672c\uff0c\u5373\u589e\u52a0\u5e94\u7528\u7a0b\u5e8f\u7684\u526f\u672c\u6570\u91cf\u3002</p> <p>Cluster Autoscaler \u63a8\u8350\u7684\u53e6\u4e00\u79cd\u6a21\u5f0f\u662f\u4f7f\u7528 pause Pod \u548c\u4f18\u5148\u7ea7\u62a2\u5360\u529f\u80fd\u3002pause Pod \u8fd0\u884c\u4e00\u4e2a pause \u5bb9\u5668\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff0c\u53ea\u662f\u4f5c\u4e3a\u96c6\u7fa4\u4e2d\u5176\u4ed6 Pod \u53ef\u4ee5\u4f7f\u7528\u7684\u8ba1\u7b97\u5bb9\u91cf\u7684\u5360\u4f4d\u7b26\u3002\u7531\u4e8e\u5b83\u8fd0\u884c\u65f6\u88ab\u5206\u914d\u4e86\u975e\u5e38\u4f4e\u7684\u4f18\u5148\u7ea7\uff0c\u5f53\u53e6\u4e00\u4e2a Pod \u9700\u8981\u88ab\u521b\u5efa\u4f46\u96c6\u7fa4\u6ca1\u6709\u53ef\u7528\u5bb9\u91cf\u65f6\uff0cpause Pod \u5c31\u4f1a\u4ece\u8282\u70b9\u4e0a\u88ab\u9a71\u9010\u3002Kubernetes \u8c03\u5ea6\u5668\u6ce8\u610f\u5230 pause Pod \u7684\u9a71\u9010\uff0c\u5e76\u5c1d\u8bd5\u91cd\u65b0\u8c03\u5ea6\u5b83\u3002\u4f46\u7531\u4e8e\u96c6\u7fa4\u6b63\u5728\u8fd0\u884c\u4e8e\u6ee1\u8d1f\u8377\u72b6\u6001\uff0cpause Pod \u4ecd\u5c06\u4fdd\u6301 Pending \u72b6\u6001\uff0c\u4e8e\u662f Cluster Autoscaler \u4f1a\u5bf9\u6b64\u4f5c\u51fa\u53cd\u5e94\uff0c\u6dfb\u52a0\u8282\u70b9\u3002</p> <p>\u6709\u4e00\u4e2a Helm \u56fe\u8868\u53ef\u7528\u4e8e\u5b89\u88c5 cluster overprovisioner\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#auto-scaling-cluster-autoscaler","title":"\u4f7f\u7528\u591a\u4e2a Auto Scaling \u7ec4\u8fd0\u884c Cluster Autoscaler","text":"<p>\u8fd0\u884c Cluster Autoscaler \u65f6\u542f\u7528 <code>--node-group-auto-discovery</code> \u6807\u5fd7\u3002\u8fd9\u6837\u505a\u5c06\u5141\u8bb8 Cluster Autoscaler \u627e\u5230\u5305\u542b\u7279\u5b9a\u5b9a\u4e49\u6807\u7b7e\u7684\u6240\u6709\u81ea\u52a8\u7f29\u653e\u7ec4\uff0c\u5e76\u9632\u6b62\u9700\u8981\u5728\u6e05\u5355\u4e2d\u5b9a\u4e49\u548c\u7ef4\u62a4\u6bcf\u4e2a\u81ea\u52a8\u7f29\u653e\u7ec4\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#cluster-autoscaler_1","title":"\u4f7f\u7528\u672c\u5730\u5b58\u50a8\u8fd0\u884c Cluster Autoscaler","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cCluster Autoscaler \u4e0d\u4f1a\u7f29\u51cf\u90e8\u7f72\u4e86\u5e26\u6709\u672c\u5730\u5b58\u50a8\u7684 Pod \u7684\u8282\u70b9\u3002\u5c06 <code>--skip-nodes-with-local-storage</code> \u6807\u5fd7\u8bbe\u7f6e\u4e3a false \u4ee5\u5141\u8bb8 Cluster Autoscaler \u7f29\u51cf\u8fd9\u4e9b\u8282\u70b9\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#_2","title":"\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u8fd0\u884c\u5de5\u4f5c\u8282\u70b9\u548c\u5de5\u4f5c\u8d1f\u8f7d","text":"<p>\u901a\u8fc7\u5728\u591a\u4e2a\u53ef\u7528\u533a\u8fd0\u884c\u5de5\u4f5c\u8282\u70b9\u548c Pod\uff0c\u60a8\u53ef\u4ee5\u4fdd\u62a4\u5de5\u4f5c\u8d1f\u8f7d\u514d\u53d7\u5355\u4e2a\u53ef\u7528\u533a\u6545\u969c\u7684\u5f71\u54cd\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u521b\u5efa\u8282\u70b9\u6240\u5728\u7684\u5b50\u7f51\u6765\u63a7\u5236\u5de5\u4f5c\u8282\u70b9\u521b\u5efa\u7684\u53ef\u7528\u533a\u3002</p> <p>\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Kubernetes 1.18 \u53ca\u66f4\u9ad8\u7248\u672c\uff0c\u8de8\u53ef\u7528\u533a\u5206\u5e03 Pod \u7684\u63a8\u8350\u65b9\u6cd5\u662f\u4f7f\u7528 Pod \u7684\u62d3\u6251\u5206\u5e03\u7ea6\u675f\u3002</p> <p>\u4e0b\u9762\u7684\u90e8\u7f72\u4f1a\u5c3d\u53ef\u80fd\u8de8\u53ef\u7528\u533a\u5206\u5e03 Pod\uff0c\u5982\u679c\u4e0d\u53ef\u80fd\u5219\u4ecd\u5141\u8bb8\u8fd9\u4e9b Pod \u8fd0\u884c\uff1a</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-server\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      topologySpreadConstraints:\n        - maxSkew: 1\n          whenUnsatisfiable: ScheduleAnyway\n          topologyKey: topology.kubernetes.io/zone\n          labelSelector:\n            matchLabels:\n              app: web-server\n      containers:\n      - name: web-app\n        image: nginx\n        resources:\n          requests:\n            cpu: 1\n</code></pre> <p>\u6ce8\u610f</p> <p><code>kube-scheduler</code> \u53ea\u901a\u8fc7\u5b58\u5728\u7684\u5e26\u6709\u8fd9\u4e9b\u6807\u7b7e\u7684\u8282\u70b9\u6765\u611f\u77e5\u62d3\u6251\u57df\u3002\u5982\u679c\u4e0a\u8ff0\u90e8\u7f72\u88ab\u90e8\u7f72\u5230\u53ea\u6709\u5355\u4e2a\u53ef\u7528\u533a\u7684\u8282\u70b9\u7684\u96c6\u7fa4\u4e2d\uff0c\u6240\u6709\u7684 Pod \u90fd\u5c06\u8c03\u5ea6\u5230\u8fd9\u4e9b\u8282\u70b9\u4e0a\uff0c\u56e0\u4e3a <code>kube-scheduler</code> \u4e0d\u77e5\u9053\u5176\u4ed6\u53ef\u7528\u533a\u3002\u8981\u4f7f\u6b64\u62d3\u6251\u5206\u5e03\u7ea6\u675f\u6309\u9884\u671f\u5728\u8c03\u5ea6\u5668\u4e2d\u5de5\u4f5c\uff0c\u5fc5\u987b\u5728\u6240\u6709\u53ef\u7528\u533a\u4e2d\u5df2\u7ecf\u5b58\u5728\u8282\u70b9\u3002\u8fd9\u4e2a\u95ee\u9898\u5c06\u5728 Kubernetes 1.24 \u4e2d\u901a\u8fc7\u6dfb\u52a0 <code>MinDomainsInPodToplogySpread</code> \u7279\u6027\u95e8\u63a7\u5f97\u5230\u89e3\u51b3\uff0c\u8be5\u7279\u6027\u95e8\u63a7\u5141\u8bb8\u6307\u5b9a <code>minDomains</code> \u5c5e\u6027\u6765\u901a\u77e5\u8c03\u5ea6\u5668\u6709\u8d44\u683c\u7684\u57df\u6570\u91cf\u3002</p> <p>\u8b66\u544a</p> <p>\u5982\u679c\u5c06 <code>whenUnsatisfiable</code> \u8bbe\u7f6e\u4e3a <code>DoNotSchedule</code>\uff0c\u5f53\u65e0\u6cd5\u6ee1\u8db3\u62d3\u6251\u5206\u5e03\u7ea6\u675f\u65f6\uff0cPod \u5c06\u65e0\u6cd5\u88ab\u8c03\u5ea6\u3002\u53ea\u6709\u5728 Pod \u4e0d\u8fd0\u884c\u6bd4\u8fdd\u53cd\u62d3\u6251\u5206\u5e03\u7ea6\u675f\u66f4\u53ef\u53d6\u7684\u60c5\u51b5\u4e0b\u624d\u5e94\u8be5\u8fd9\u6837\u8bbe\u7f6e\u3002</p> <p>\u5728\u8f83\u65e7\u7248\u672c\u7684 Kubernetes \u4e0a\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Pod \u53cd\u4eb2\u548c\u6027\u89c4\u5219\u6765\u8de8\u591a\u4e2a\u53ef\u7528\u533a\u8c03\u5ea6 Pod\u3002\u4e0b\u9762\u7684\u6e05\u5355\u901a\u77e5 Kubernetes \u8c03\u5ea6\u5668\u4f18\u5148\u5728\u4e0d\u540c\u7684\u53ef\u7528\u533a\u8c03\u5ea6 Pod\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-server\n  labels:\n    app: web-server\nspec:\n  replicas: 4\n  selector:\n    matchLabels:\n      app: web-server\n  template:\n    metadata:\n      labels:\n        app: web-server\n    spec:\n      affinity:\n        podAntiAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n          - podAffinityTerm:\n              labelSelector:\n                matchExpressions:\n                - key: app\n                  operator: In\n                  values:\n                  - web-server\n              topologyKey: failure-domain.beta.kubernetes.io/zone\n            weight: 100\n      containers:\n      - name: web-app\n        image: nginx\n</code></pre> <p>\u8b66\u544a</p> <p>\u4e0d\u8981\u8981\u6c42 Pod \u5fc5\u987b\u8de8\u4e0d\u540c\u7684\u53ef\u7528\u533a\u8c03\u5ea6\uff0c\u5426\u5219\u90e8\u7f72\u4e2d\u7684 Pod \u6570\u91cf\u6c38\u8fdc\u4e0d\u4f1a\u8d85\u8fc7\u53ef\u7528\u533a\u7684\u6570\u91cf\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#ebs","title":"\u786e\u4fdd\u5728\u4f7f\u7528 EBS \u5377\u65f6\u6bcf\u4e2a\u53ef\u7528\u533a\u90fd\u6709\u5bb9\u91cf","text":"<p>\u5982\u679c\u60a8\u4f7f\u7528 Amazon EBS \u6765\u63d0\u4f9b\u6301\u4e45\u5377\uff0c\u90a3\u4e48\u60a8\u9700\u8981\u786e\u4fdd Pod \u548c\u5173\u8054\u7684 EBS \u5377\u4f4d\u4e8e\u540c\u4e00\u4e2a\u53ef\u7528\u533a\u3002\u5728\u64b0\u5199\u672c\u6587\u65f6\uff0cEBS \u5377\u53ea\u5728\u5355\u4e2a\u53ef\u7528\u533a\u5185\u53ef\u7528\u3002Pod \u65e0\u6cd5\u8bbf\u95ee\u4f4d\u4e8e\u4e0d\u540c\u53ef\u7528\u533a\u7684 EBS \u652f\u6301\u7684\u6301\u4e45\u5377\u3002Kubernetes \u8c03\u5ea6\u5668\u77e5\u9053\u5de5\u4f5c\u8282\u70b9\u6240\u5728\u7684\u53ef\u7528\u533a\u3002Kubernetes \u5c06\u59cb\u7ec8\u5728\u4e0e\u5377\u6240\u5728\u7684\u540c\u4e00\u53ef\u7528\u533a\u8c03\u5ea6\u9700\u8981 EBS \u5377\u7684 Pod\u3002\u4f46\u662f\uff0c\u5982\u679c\u5728\u5377\u6240\u5728\u7684\u53ef\u7528\u533a\u6ca1\u6709\u53ef\u7528\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u5219\u65e0\u6cd5\u8c03\u5ea6\u8be5 Pod\u3002</p> <p>\u4e3a\u6bcf\u4e2a\u53ef\u7528\u533a\u521b\u5efa\u4e00\u4e2a Auto Scaling \u7ec4\uff0c\u5e76\u786e\u4fdd\u96c6\u7fa4\u59cb\u7ec8\u6709\u8db3\u591f\u7684\u5bb9\u91cf\u6765\u5728\u4e0e Pod \u6240\u9700\u7684 EBS \u5377\u76f8\u540c\u7684\u53ef\u7528\u533a\u8c03\u5ea6 Pod\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u5e94\u8be5\u4e3a Cluster Autoscaler \u542f\u7528 <code>--balance-similar-node-groups</code> \u529f\u80fd\u3002</p> <p>\u5982\u679c\u60a8\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528 EBS \u5377\u4f46\u6ca1\u6709\u9ad8\u53ef\u7528\u6027\u8981\u6c42\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u5c06\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\u9650\u5236\u5728\u5355\u4e2a\u53ef\u7528\u533a\u3002\u5728 EKS \u4e2d\uff0c\u5de5\u4f5c\u8282\u70b9\u4f1a\u81ea\u52a8\u6dfb\u52a0 <code>failure-domain.beta.kubernetes.io/zone</code> \u6807\u7b7e\uff0c\u5176\u4e2d\u5305\u542b\u53ef\u7528\u533a\u7684\u540d\u79f0\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c <code>kubectl get nodes --show-labels</code> \u6765\u67e5\u770b\u9644\u52a0\u5230\u8282\u70b9\u7684\u6807\u7b7e\u3002\u6709\u5173\u5185\u7f6e\u8282\u70b9\u6807\u7b7e\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u6b64\u5904\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u8282\u70b9\u9009\u62e9\u5668\u5728\u7279\u5b9a\u53ef\u7528\u533a\u8c03\u5ea6 Pod\u3002</p> <p>\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0cPod \u53ea\u4f1a\u88ab\u8c03\u5ea6\u5728 <code>us-west-2c</code> \u53ef\u7528\u533a\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: single-az-pod\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: failure-domain.beta.kubernetes.io/zone\n            operator: In\n            values:\n            - us-west-2c\n  containers:\n  - name: single-az-container\n    image: kubernetes/pause\n</code></pre> <p>\u6301\u4e45\u5377(\u7531 EBS \u652f\u6301)\u4e5f\u4f1a\u81ea\u52a8\u6807\u8bb0\u53ef\u7528\u533a\u7684\u540d\u79f0;\u60a8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c <code>kubectl get pv -L topology.ebs.csi.aws.com/zone</code> \u6765\u67e5\u770b\u60a8\u7684\u6301\u4e45\u5377\u6240\u5c5e\u7684\u53ef\u7528\u533a\u3002\u5f53\u521b\u5efa\u4e00\u4e2a Pod \u5e76\u58f0\u660e\u4e00\u4e2a\u5377\u65f6\uff0cKubernetes \u4f1a\u5c06\u8be5 Pod \u8c03\u5ea6\u5230\u4e0e\u8be5\u5377\u6240\u5728\u7684\u540c\u4e00\u53ef\u7528\u533a\u7684\u8282\u70b9\u4e0a\u3002</p> <p>\u8003\u8651\u8fd9\u79cd\u60c5\u51b5;\u60a8\u6709\u4e00\u4e2a EKS \u96c6\u7fa4\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u8282\u70b9\u7ec4\u3002\u8be5\u8282\u70b9\u7ec4\u5728\u4e09\u4e2a\u53ef\u7528\u533a\u4e2d\u5206\u5e03\u6709\u4e09\u4e2a\u5de5\u4f5c\u8282\u70b9\u3002\u60a8\u6709\u4e00\u4e2a\u4f7f\u7528 EBS \u652f\u6301\u7684\u6301\u4e45\u5377\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5f53\u60a8\u521b\u5efa\u6b64\u5e94\u7528\u7a0b\u5e8f\u53ca\u5176\u76f8\u5e94\u7684\u5377\u65f6\uff0c\u5b83\u7684 Pod \u4f1a\u5728\u8fd9\u4e09\u4e2a\u53ef\u7528\u533a\u4e2d\u7684\u7b2c\u4e00\u4e2a\u53ef\u7528\u533a\u521b\u5efa\u3002\u7136\u540e\uff0c\u8fd0\u884c\u8be5 Pod \u7684\u5de5\u4f5c\u8282\u70b9\u53d8\u4e3a\u4e0d\u5065\u5eb7\u5e76\u968f\u540e\u65e0\u6cd5\u4f7f\u7528\u3002Cluster Autoscaler \u4f1a\u7528\u4e00\u4e2a\u65b0\u7684\u5de5\u4f5c\u8282\u70b9\u66ff\u6362\u4e0d\u5065\u5eb7\u7684\u8282\u70b9;\u4f46\u662f\uff0c\u7531\u4e8e\u81ea\u52a8\u7f29\u653e\u7ec4\u8de8\u8d8a\u4e09\u4e2a\u53ef\u7528\u533a\uff0c\u65b0\u7684\u5de5\u4f5c\u8282\u70b9\u53ef\u80fd\u4f1a\u5728\u7b2c\u4e8c\u4e2a\u6216\u7b2c\u4e09\u4e2a\u53ef\u7528\u533a\u542f\u52a8\uff0c\u800c\u4e0d\u662f\u6309\u9700\u6c42\u5728\u7b2c\u4e00\u4e2a\u53ef\u7528\u533a\u542f\u52a8\u3002\u7531\u4e8e\u53d7\u53ef\u7528\u533a\u7ea6\u675f\u7684 EBS \u5377\u53ea\u5b58\u5728\u4e8e\u7b2c\u4e00\u4e2a\u53ef\u7528\u533a\uff0c\u4f46\u5728\u8be5\u53ef\u7528\u533a\u6ca1\u6709\u53ef\u7528\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u56e0\u6b64\u65e0\u6cd5\u8c03\u5ea6\u8be5 Pod\u3002\u56e0\u6b64\uff0c\u60a8\u5e94\u8be5\u5728\u6bcf\u4e2a\u53ef\u7528\u533a\u521b\u5efa\u4e00\u4e2a\u8282\u70b9\u7ec4\uff0c\u4ee5\u4fbf\u59cb\u7ec8\u6709\u8db3\u591f\u7684\u5bb9\u91cf\u6765\u8fd0\u884c\u65e0\u6cd5\u5728\u5176\u4ed6\u53ef\u7528\u533a\u8c03\u5ea6\u7684 Pod\u3002</p> <p>\u6216\u8005\uff0cEFS \u53ef\u4ee5\u7b80\u5316\u5728\u8fd0\u884c\u9700\u8981\u6301\u4e45\u5b58\u50a8\u7684\u5e94\u7528\u7a0b\u5e8f\u65f6\u8fdb\u884c\u96c6\u7fa4\u81ea\u52a8\u7f29\u653e\u3002\u5ba2\u6237\u7aef\u53ef\u4ee5\u4ece\u8be5\u533a\u57df\u7684\u6240\u6709\u53ef\u7528\u533a\u5e76\u53d1\u8bbf\u95ee EFS \u6587\u4ef6\u7cfb\u7edf\u3002\u5373\u4f7f\u4f7f\u7528 EFS \u652f\u6301\u7684\u6301\u4e45\u5377\u7684 Pod \u88ab\u7ec8\u6b62\u5e76\u5728\u4e0d\u540c\u7684\u53ef\u7528\u533a\u91cd\u65b0\u8c03\u5ea6\uff0c\u5b83\u4e5f\u80fd\u591f\u6302\u8f7d\u8be5\u5377\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#node-problem-detector","title":"\u8fd0\u884c node-problem-detector","text":"<p>\u5de5\u4f5c\u8282\u70b9\u7684\u6545\u969c\u53ef\u80fd\u4f1a\u5f71\u54cd\u60a8\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u7528\u6027\u3002node-problem-detector \u662f\u4e00\u4e2a Kubernetes \u63d2\u4ef6\uff0c\u60a8\u53ef\u4ee5\u5728\u96c6\u7fa4\u4e2d\u5b89\u88c5\u5b83\u6765\u68c0\u6d4b\u5de5\u4f5c\u8282\u70b9\u95ee\u9898\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 npd \u7684\u8865\u6551\u7cfb\u7edf\u81ea\u52a8\u6392\u7a7a\u548c\u7ec8\u6b62\u8282\u70b9\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#kubernetes","title":"\u4e3a\u7cfb\u7edf\u548c Kubernetes \u5b88\u62a4\u8fdb\u7a0b\u4fdd\u7559\u8d44\u6e90","text":"<p>\u901a\u8fc7\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u548c Kubernetes \u5b88\u62a4\u8fdb\u7a0b\u4fdd\u7559\u8ba1\u7b97\u5bb9\u91cf,\u60a8\u53ef\u4ee5\u63d0\u9ad8\u5de5\u4f5c\u8282\u70b9\u7684\u7a33\u5b9a\u6027\u3002Pod - \u7279\u522b\u662f\u90a3\u4e9b\u672a\u58f0\u660e <code>limits</code> \u7684 Pod - \u53ef\u80fd\u4f1a\u8017\u5c3d\u7cfb\u7edf\u8d44\u6e90\uff0c\u4f7f\u8282\u70b9\u5904\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b\u548c Kubernetes \u5b88\u62a4\u8fdb\u7a0b(<code>kubelet</code>\u3001\u5bb9\u5668\u8fd0\u884c\u65f6\u7b49)\u4e0e Pod \u7ade\u4e89\u7cfb\u7edf\u8d44\u6e90\u7684\u60c5\u51b5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>kubelet</code> \u6807\u5fd7 <code>--system-reserved</code> \u548c <code>--kube-reserved</code> \u5206\u522b\u4e3a\u7cfb\u7edf\u8fdb\u7a0b(<code>udev</code>\u3001<code>sshd</code> \u7b49)\u548c Kubernetes \u5b88\u62a4\u8fdb\u7a0b\u4fdd\u7559\u8d44\u6e90\u3002</p> <p>\u5982\u679c\u60a8\u4f7f\u7528 EKS \u4f18\u5316\u7684 Linux AMI,\u5219\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u4e3a\u7cfb\u7edf\u548c Kubernetes \u5b88\u62a4\u8fdb\u7a0b\u4fdd\u7559 CPU\u3001\u5185\u5b58\u548c\u5b58\u50a8\u3002\u5f53\u57fa\u4e8e\u6b64 AMI \u7684\u5de5\u4f5c\u8282\u70b9\u542f\u52a8\u65f6\uff0cEC2 \u7528\u6237\u6570\u636e\u4f1a\u88ab\u914d\u7f6e\u4e3a\u89e6\u53d1 <code>bootstrap.sh</code> \u811a\u672c\u3002\u8be5\u811a\u672c\u6839\u636e EC2 \u5b9e\u4f8b\u4e0a\u7684 CPU \u5185\u6838\u6570\u548c\u603b\u5185\u5b58\u8ba1\u7b97 CPU \u548c\u5185\u5b58\u9884\u7559\u3002\u8ba1\u7b97\u51fa\u7684\u503c\u5c06\u5199\u5165\u4f4d\u4e8e <code>/etc/kubernetes/kubelet/kubelet-config.json</code> \u7684 <code>KubeletConfiguration</code> \u6587\u4ef6\u3002</p> <p>\u5982\u679c\u60a8\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u81ea\u5b9a\u4e49\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4fdd\u7559\u7684 CPU \u548c\u5185\u5b58\u91cf\u4e0d\u8db3\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u589e\u52a0\u7cfb\u7edf\u8d44\u6e90\u9884\u7559\u3002</p> <p><code>eksctl</code> \u63d0\u4f9b\u4e86\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u6765\u81ea\u5b9a\u4e49\u7cfb\u7edf\u548c Kubernetes \u5b88\u62a4\u8fdb\u7a0b\u7684\u8d44\u6e90\u9884\u7559\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#qos","title":"\u5b9e\u65bd QoS","text":"<p>\u5bf9\u4e8e\u5173\u952e\u5e94\u7528\u7a0b\u5e8f\uff0c\u8bf7\u8003\u8651\u4e3a Pod \u4e2d\u7684\u5bb9\u5668\u5b9a\u4e49 <code>requests</code>=<code>limits</code>\u3002\u8fd9\u5c06\u786e\u4fdd\u5373\u4f7f\u53e6\u4e00\u4e2a Pod \u8bf7\u6c42\u8d44\u6e90\uff0c\u8be5\u5bb9\u5668\u4e5f\u4e0d\u4f1a\u88ab\u6740\u6b7b\u3002</p> <p>\u4e3a\u6240\u6709\u5bb9\u5668\u5b9e\u65bd CPU \u548c\u5185\u5b58\u9650\u5236\u662f\u6700\u4f73\u5b9e\u8df5\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u9632\u6b62\u5bb9\u5668\u65e0\u610f\u4e2d\u6d88\u8017\u7cfb\u7edf\u8d44\u6e90\uff0c\u4ece\u800c\u5f71\u54cd\u5171\u5b58\u8fdb\u7a0b\u7684\u53ef\u7528\u6027\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#_3","title":"\u4e3a\u6240\u6709\u5de5\u4f5c\u8d1f\u8f7d\u914d\u7f6e\u548c\u8c03\u6574\u8d44\u6e90\u8bf7\u6c42/\u9650\u5236","text":"<p>\u5bf9\u4e8e\u8c03\u6574\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236\uff0c\u53ef\u4ee5\u5e94\u7528\u4e00\u4e9b\u901a\u7528\u6307\u5bfc\u539f\u5219\uff1a</p> <ul> <li> <p>\u4e0d\u8981\u4e3a CPU \u6307\u5b9a\u8d44\u6e90\u9650\u5236\u3002\u5728\u6ca1\u6709\u9650\u5236\u7684\u60c5\u51b5\u4e0b\uff0c\u8bf7\u6c42\u5145\u5f53\u5bb9\u5668\u83b7\u5f97\u76f8\u5bf9 CPU \u65f6\u95f4\u7684\u6743\u91cd\u3002\u8fd9\u5141\u8bb8\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u5168\u90e8 CPU\uff0c\u800c\u4e0d\u4f1a\u53d7\u5230\u4eba\u4e3a\u9650\u5236\u6216\u8d44\u6e90\u9965\u997f\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u975e CPU \u8d44\u6e90\uff0c\u914d\u7f6e <code>requests</code>=<code>limits</code> \u53ef\u63d0\u4f9b\u6700\u53ef\u9884\u6d4b\u7684\u884c\u4e3a\u3002\u5982\u679c <code>requests</code>!=<code>limits</code>,\u5bb9\u5668\u7684 QOS \u4e5f\u4f1a\u4ece Guaranteed \u964d\u4f4e\u5230 Burstable\uff0c\u4ece\u800c\u66f4\u6709\u53ef\u80fd\u5728\u53d1\u751f\u8282\u70b9\u538b\u529b\u65f6\u88ab\u9a71\u9010\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u975e CPU \u8d44\u6e90\uff0c\u4e0d\u8981\u6307\u5b9a\u4e00\u4e2a\u8fdc\u5927\u4e8e\u8bf7\u6c42\u7684\u9650\u5236\u3002\u914d\u7f6e\u7684 <code>limits</code> \u76f8\u5bf9\u4e8e <code>requests</code> \u8d8a\u5927\uff0c\u8282\u70b9\u5c31\u8d8a\u6709\u53ef\u80fd\u8fc7\u5ea6\u4f7f\u7528\uff0c\u4ece\u800c\u5bfc\u81f4\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u65ad\u7684\u53ef\u80fd\u6027\u8d8a\u9ad8\u3002</p> </li> <li> <p>\u6b63\u786e\u8c03\u6574\u8bf7\u6c42\u5c3a\u5bf8\u5bf9\u4e8e\u4f7f\u7528\u8bf8\u5982 Karpenter \u6216 Cluster AutoScaler \u4e4b\u7c7b\u7684\u8282\u70b9\u81ea\u52a8\u7f29\u653e\u89e3\u51b3\u65b9\u6848\u5c24\u4e3a\u91cd\u8981\u3002\u8fd9\u4e9b\u5de5\u5177\u4f1a\u6839\u636e\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8bf7\u6c42\u6765\u786e\u5b9a\u8981\u914d\u7f6e\u7684\u8282\u70b9\u6570\u91cf\u548c\u5927\u5c0f\u3002\u5982\u679c\u60a8\u7684\u8bf7\u6c42\u8fc7\u5c0f\u800c\u9650\u5236\u8fc7\u5927\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u88ab\u9a71\u9010\u6216\u7531\u4e8e\u5185\u5b58\u4e0d\u8db3\u800c\u88ab\u6740\u6b7b\uff0c\u56e0\u4e3a\u5b83\u4eec\u88ab\u7d27\u5bc6\u5730\u6253\u5305\u5728\u4e00\u4e2a\u8282\u70b9\u4e0a\u3002</p> </li> </ul> <p>\u786e\u5b9a\u8d44\u6e90\u8bf7\u6c42\u53ef\u80fd\u5f88\u56f0\u96be\uff0c\u4f46\u50cf Vertical Pod Autoscaler \u8fd9\u6837\u7684\u5de5\u5177\u53ef\u4ee5\u901a\u8fc7\u5728\u8fd0\u884c\u65f6\u89c2\u5bdf\u5bb9\u5668\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u6765\u5e2e\u52a9\u60a8\"\u6b63\u786e\u8c03\u6574\"\u8bf7\u6c42\u3002\u5176\u4ed6\u53ef\u80fd\u6709\u7528\u7684\u786e\u5b9a\u8bf7\u6c42\u5927\u5c0f\u7684\u5de5\u5177\u5305\u62ec\uff1a</p> <ul> <li>Goldilocks</li> <li>Parca</li> <li>Prodfiler</li> <li>rsg</li> </ul>"},{"location":"zh/reliability/docs/dataplane/#_4","title":"\u4e3a\u547d\u540d\u7a7a\u95f4\u914d\u7f6e\u8d44\u6e90\u914d\u989d","text":"<p>\u547d\u540d\u7a7a\u95f4\u65e8\u5728\u7528\u4e8e\u8de8\u591a\u4e2a\u56e2\u961f\u6216\u9879\u76ee\u7684\u591a\u7528\u6237\u73af\u5883\u3002\u5b83\u4eec\u4e3a\u540d\u79f0\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u662f\u5728\u591a\u4e2a\u56e2\u961f\u3001\u9879\u76ee\u3001\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\u5212\u5206\u96c6\u7fa4\u8d44\u6e90\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u60a8\u53ef\u4ee5\u9650\u5236\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u805a\u5408\u8d44\u6e90\u6d88\u8017\u3002<code>ResourceQuota</code> \u5bf9\u8c61\u53ef\u4ee5\u6309\u7c7b\u578b\u9650\u5236\u53ef\u4ee5\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u521b\u5efa\u7684\u5bf9\u8c61\u7684\u6570\u91cf\uff0c\u4ee5\u53ca\u8be5\u9879\u76ee\u4e2d\u7684\u8d44\u6e90\u53ef\u4ee5\u6d88\u8017\u7684\u603b\u8ba1\u7b97\u8d44\u6e90\u91cf\u3002\u60a8\u53ef\u4ee5\u9650\u5236\u7ed9\u5b9a\u547d\u540d\u7a7a\u95f4\u4e2d\u53ef\u4ee5\u8bf7\u6c42\u7684\u5b58\u50a8\u548c/\u6216\u8ba1\u7b97(CPU \u548c\u5185\u5b58)\u8d44\u6e90\u7684\u603b\u548c\u3002</p> <p>\u5982\u679c\u4e3a\u547d\u540d\u7a7a\u95f4\u542f\u7528\u4e86\u8ba1\u7b97\u8d44\u6e90(\u5982 CPU \u548c\u5185\u5b58)\u7684\u8d44\u6e90\u914d\u989d\uff0c\u5219\u5fc5\u987b\u4e3a\u8be5\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6bcf\u4e2a\u5bb9\u5668\u6307\u5b9a\u8bf7\u6c42\u6216\u9650\u5236\u3002</p> <p>\u8003\u8651\u4e3a\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u914d\u7f6e\u914d\u989d\u3002\u8003\u8651\u4f7f\u7528 <code>LimitRanges</code> \u81ea\u52a8\u5c06\u9884\u914d\u7f6e\u7684\u9650\u5236\u5e94\u7528\u4e8e\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u5bb9\u5668\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#_5","title":"\u9650\u5236\u547d\u540d\u7a7a\u95f4\u5185\u7684\u5bb9\u5668\u8d44\u6e90\u4f7f\u7528","text":"<p>\u8d44\u6e90\u914d\u989d\u6709\u52a9\u4e8e\u9650\u5236\u547d\u540d\u7a7a\u95f4\u53ef\u4ee5\u4f7f\u7528\u7684\u8d44\u6e90\u91cf\u3002<code>LimitRange</code> \u5bf9\u8c61\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5b9e\u65bd\u5bb9\u5668\u53ef\u4ee5\u8bf7\u6c42\u7684\u6700\u5c0f\u548c\u6700\u5927\u8d44\u6e90\u3002\u4f7f\u7528 <code>LimitRange</code> \u60a8\u53ef\u4ee5\u4e3a\u5bb9\u5668\u8bbe\u7f6e\u9ed8\u8ba4\u8bf7\u6c42\u548c\u9650\u5236\uff0c\u5982\u679c\u5728\u60a8\u7684\u7ec4\u7ec7\u4e2d\u8bbe\u7f6e\u8ba1\u7b97\u8d44\u6e90\u9650\u5236\u4e0d\u662f\u6807\u51c6\u505a\u6cd5\uff0c\u8fd9\u5c06\u975e\u5e38\u6709\u7528\u3002\u987e\u540d\u601d\u4e49\uff0c<code>LimitRange</code> \u53ef\u4ee5\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u5f3a\u5236\u6bcf\u4e2a Pod \u6216\u5bb9\u5668\u7684\u6700\u5c0f\u548c\u6700\u5927\u8ba1\u7b97\u8d44\u6e90\u4f7f\u7528\uff0c\u4ee5\u53ca\u6bcf\u4e2a PersistentVolumeClaim \u7684\u6700\u5c0f\u548c\u6700\u5927\u5b58\u50a8\u8bf7\u6c42\u3002</p> <p>\u8003\u8651\u5c06 <code>LimitRange</code> \u4e0e <code>ResourceQuota</code> \u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u5728\u5bb9\u5668\u548c\u547d\u540d\u7a7a\u95f4\u7ea7\u522b\u5f3a\u5236\u6267\u884c\u9650\u5236\u3002\u8bbe\u7f6e\u8fd9\u4e9b\u9650\u5236\u5c06\u786e\u4fdd\u5bb9\u5668\u6216\u547d\u540d\u7a7a\u95f4\u4e0d\u4f1a\u4fb5\u5360\u96c6\u7fa4\u4e2d\u5176\u4ed6\u79df\u6237\u4f7f\u7528\u7684\u8d44\u6e90\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#coredns","title":"CoreDNS","text":"<p>CoreDNS \u5728 Kubernetes \u4e2d\u5c65\u884c\u540d\u79f0\u89e3\u6790\u548c\u670d\u52a1\u53d1\u73b0\u529f\u80fd\u3002\u5b83\u9ed8\u8ba4\u5b89\u88c5\u5728 EKS \u96c6\u7fa4\u4e0a\u3002\u4e3a\u4e86\u4e92\u64cd\u4f5c\u6027\uff0cCoreDNS \u7684 Kubernetes \u670d\u52a1\u4ecd\u88ab\u547d\u540d\u4e3a kube-dns\u3002CoreDNS Pod \u4f5c\u4e3a Deployment \u7684\u4e00\u90e8\u5206\u8fd0\u884c\u5728 <code>kube-system</code> \u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u5728 EKS \u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\u8fd0\u884c\u4e24\u4e2a\u526f\u672c\uff0c\u5e76\u58f0\u660e\u4e86\u8bf7\u6c42\u548c\u9650\u5236\u3002DNS \u67e5\u8be2\u88ab\u53d1\u9001\u5230\u8fd0\u884c\u5728 <code>kube-system</code> \u547d\u540d\u7a7a\u95f4\u4e2d\u7684 <code>kube-dns</code> \u670d\u52a1\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#_6","title":"\u5efa\u8bae","text":""},{"location":"zh/reliability/docs/dataplane/#coredns_1","title":"\u76d1\u63a7 CoreDNS \u6307\u6807","text":"<p>CoreDNS \u5185\u7f6e\u652f\u6301 Prometheus\u3002\u60a8\u5e94\u8be5\u7279\u522b\u8003\u8651\u76d1\u63a7 CoreDNS \u5ef6\u8fdf(<code>coredns_dns_request_duration_seconds_sum</code>,\u5728 1.7.0 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u8be5\u6307\u6807\u88ab\u79f0\u4e3a <code>core_dns_response_rcode_count_total</code>)\u3001\u9519\u8bef(<code>coredns_dns_responses_total</code>\u3001NXDOMAIN\u3001SERVFAIL\u3001FormErr)\u548c CoreDNS Pod \u7684\u5185\u5b58\u6d88\u8017\u3002</p> <p>\u4e3a\u4e86\u6545\u969c\u6392\u67e5\u76ee\u7684\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 kubectl \u67e5\u770b CoreDNS \u65e5\u5fd7\uff1a</p> <pre><code>for p in $(kubectl get pods -n kube-system -l k8s-app=kube-dns -o jsonpath='{.items[*].metadata.name}'); do kubectl logs $p -n kube-system; done\n</code></pre>"},{"location":"zh/reliability/docs/dataplane/#nodelocal-dnscache","title":"\u4f7f\u7528 NodeLocal DNSCache","text":"<p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c NodeLocal DNSCache \u6765\u63d0\u9ad8\u96c6\u7fa4 DNS \u6027\u80fd\u3002\u6b64\u529f\u80fd\u4ee5 DaemonSet \u7684\u5f62\u5f0f\u5728\u96c6\u7fa4\u8282\u70b9\u4e0a\u8fd0\u884c DNS \u7f13\u5b58\u4ee3\u7406\u3002\u6240\u6709 Pod \u90fd\u4f7f\u7528\u8fd0\u884c\u5728\u8282\u70b9\u4e0a\u7684 DNS \u7f13\u5b58\u4ee3\u7406\u8fdb\u884c\u540d\u79f0\u89e3\u6790\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 <code>kube-dns</code> \u670d\u52a1\u3002</p>"},{"location":"zh/reliability/docs/dataplane/#coredns-cluster-proportional-scaler","title":"\u4e3a CoreDNS \u914d\u7f6e cluster-proportional-scaler","text":"<p>\u63d0\u9ad8\u96c6\u7fa4 DNS \u6027\u80fd\u7684\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u6839\u636e\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u6570\u548c CPU \u5185\u6838\u6570\u81ea\u52a8\u6c34\u5e73\u6269\u5c55 CoreDNS Deployment\u3002Horizontal cluster-proportional-autoscaler \u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u5b83\u6839\u636e\u53ef\u8c03\u5ea6\u6570\u636e\u5e73\u9762\u7684\u5927\u5c0f\u6765\u8c03\u6574 Deployment \u7684\u526f\u672c\u6570\u3002</p> <p>\u8282\u70b9\u548c\u8282\u70b9\u4e2d\u7684 CPU \u5185\u6838\u603b\u6570\u662f\u60a8\u53ef\u4ee5\u7528\u6765\u6269\u5c55 CoreDNS \u7684\u4e24\u4e2a\u6307\u6807\u3002\u60a8\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u8fd9\u4e24\u4e2a\u6307\u6807\u3002\u5982\u679c\u60a8\u4f7f\u7528\u8f83\u5927\u7684\u8282\u70b9\uff0cCoreDNS \u7684\u6269\u5c55\u5c06\u57fa\u4e8e CPU \u5185\u6838\u6570\u3002\u800c\u5982\u679c\u60a8\u4f7f\u7528\u8f83\u5c0f\u7684\u8282\u70b9\uff0cCoreDNS \u526f\u672c\u7684\u6570\u91cf\u5c06\u53d6\u51b3\u4e8e\u6570\u636e\u5e73\u9762\u4e2d\u7684 CPU \u5185\u6838\u6570\u3002\u6bd4\u4f8b\u81ea\u52a8\u7f29\u653e\u5668\u914d\u7f6e\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>linear: '{\"coresPerReplica\":256,\"min\":1,\"nodesPerReplica\":16}'\n</code></pre>"},{"location":"zh/reliability/docs/dataplane/#ami","title":"\u4e3a\u8282\u70b9\u7ec4\u9009\u62e9 AMI","text":"<p>EKS \u4e3a\u6bcf\u4e2a\u652f\u6301\u7684 Kubernetes \u7248\u672c\u5728\u6bcf\u4e2a\u533a\u57df\u63d0\u4f9b\u4f18\u5316\u7684 EC2 AMI\uff0c\u5ba2\u6237\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b AMI \u521b\u5efa\u81ea\u7ba1\u7406\u548c\u6258\u7ba1\u7684\u8282\u70b9\u7ec4\u3002\u5f53\u53d1\u73b0\u4efb\u4f55 CVE \u6216 Bug \u65f6\uff0cEKS \u4f1a\u5c06\u8fd9\u4e9b AMI \u6807\u8bb0\u4e3a\u5df2\u5f03\u7528\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u5728\u4e3a\u8282\u70b9\u7ec4\u9009\u62e9 AMI \u65f6\u4e0d\u8981\u4f7f\u7528\u5df2\u5f03\u7528\u7684 AMI\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 Ec2 describe-images api \u548c\u4ee5\u4e0b\u547d\u4ee4\u8fc7\u6ee4\u6389\u5df2\u5f03\u7528\u7684 AMI\uff1a</p> <pre><code>aws ec2 describe-images --image-id ami-0d551c4f633e7679c --no-include-deprecated\n</code></pre> <p>\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7\u9a8c\u8bc1 describe-image \u8f93\u51fa\u662f\u5426\u5305\u542b DeprecationTime \u4f5c\u4e3a\u5b57\u6bb5\u6765\u8bc6\u522b\u5df2\u5f03\u7528\u7684 AMI\u3002\u4f8b\u5982\uff1a</p> <pre><code>aws ec2 describe-images --image-id ami-xxx --no-include-deprecated\n{\n    \"Images\": [\n        {\n            \"Architecture\": \"x86_64\",\n            \"CreationDate\": \"2022-07-13T15:54:06.000Z\",\n            \"ImageId\": \"ami-xxx\",\n            \"ImageLocation\": \"123456789012/eks_xxx\",\n            \"ImageType\": \"machine\",\n            \"Public\": false,\n            \"OwnerId\": \"123456789012\",\n            \"PlatformDetails\": \"Linux/UNIX\",\n            \"UsageOperation\": \"RunInstances\",\n            \"State\": \"available\",\n            \"BlockDeviceMappings\": [\n                {\n                    \"DeviceName\": \"/dev/xvda\",\n                    \"Ebs\": {\n                        \"DeleteOnTermination\": true,\n                        \"SnapshotId\": \"snap-0993a2fc4bbf4f7f4\",\n                        \"VolumeSize\": 20,\n                        \"VolumeType\": \"gp2\",\n                        \"Encrypted\": false\n                    }\n                }\n            ],\n            \"Description\": \"EKS Kubernetes Worker AMI with AmazonLinux2 image, (k8s: 1.19.15, docker: 20.10.13-2.amzn2, containerd: 1.4.13-3.amzn2)\",\n            \"EnaSupport\": true,\n            \"Hypervisor\": \"xen\",\n            \"Name\": \"aws_eks_optimized_xxx\",\n            \"RootDeviceName\": \"/dev/xvda\",\n            \"RootDeviceType\": \"ebs\",\n            \"SriovNetSupport\": \"simple\",\n            \"VirtualizationType\": \"hvm\",\n            \"DeprecationTime\": \"2023-02-09T19:41:00.000Z\"\n        }\n    ]\n}\n</code></pre>"},{"location":"zh/scalability/docs/","title":"EKS \u53ef\u6269\u5c55\u6027\u6700\u4f73\u5b9e\u8df5","text":"<p>\u672c\u6307\u5357\u63d0\u4f9b\u4e86\u6709\u5173\u6269\u5c55 EKS \u96c6\u7fa4\u7684\u5efa\u8bae\u3002\u6269\u5c55 EKS \u96c6\u7fa4\u7684\u76ee\u6807\u662f\u6700\u5927\u5316\u5355\u4e2a\u96c6\u7fa4\u53ef\u4ee5\u6267\u884c\u7684\u5de5\u4f5c\u91cf\u3002\u4f7f\u7528\u5355\u4e2a\u5927\u578b EKS \u96c6\u7fa4\u53ef\u4ee5\u51cf\u5c11\u4e0e\u4f7f\u7528\u591a\u4e2a\u96c6\u7fa4\u76f8\u6bd4\u7684\u64cd\u4f5c\u8d1f\u8f7d\uff0c\u4f46\u5728\u591a\u533a\u57df\u90e8\u7f72\u3001\u79df\u6237\u9694\u79bb\u548c\u96c6\u7fa4\u5347\u7ea7\u7b49\u65b9\u9762\u5b58\u5728\u6743\u8861\u3002\u5728\u672c\u6587\u6863\u4e2d\uff0c\u6211\u4eec\u5c06\u91cd\u70b9\u4ecb\u7ecd\u5982\u4f55\u5b9e\u73b0\u5355\u4e2a\u96c6\u7fa4\u7684\u6700\u5927\u53ef\u6269\u5c55\u6027\u3002</p>"},{"location":"zh/scalability/docs/#_1","title":"\u5982\u4f55\u4f7f\u7528\u672c\u6307\u5357","text":"<p>\u672c\u6307\u5357\u9762\u5411\u5728 AWS \u4e2d\u8d1f\u8d23\u521b\u5efa\u548c\u7ba1\u7406 EKS \u96c6\u7fa4\u7684\u5f00\u53d1\u4eba\u5458\u548c\u7ba1\u7406\u5458\u3002\u5b83\u7740\u91cd\u4e8e\u4e00\u4e9b\u901a\u7528\u7684 Kubernetes \u6269\u5c55\u5b9e\u8df5\uff0c\u4f46\u5e76\u672a\u6d89\u53ca\u81ea\u7ba1\u7406 Kubernetes \u96c6\u7fa4\u6216\u5728 AWS \u533a\u57df\u4e4b\u5916\u8fd0\u884c\u7684\u96c6\u7fa4\u7684\u5177\u4f53\u60c5\u51b5\uff0c\u4f8b\u5982\u4f7f\u7528 EKS Anywhere\u3002</p> <p>\u6bcf\u4e2a\u4e3b\u9898\u90fd\u6709\u4e00\u4e2a\u7b80\u77ed\u7684\u6982\u8ff0\uff0c\u540e\u9762\u662f\u6709\u5173\u5927\u89c4\u6a21\u8fd0\u884c EKS \u96c6\u7fa4\u7684\u5efa\u8bae\u548c\u6700\u4f73\u5b9e\u8df5\u3002\u4e3b\u9898\u4e0d\u9700\u8981\u6309\u7279\u5b9a\u987a\u5e8f\u9605\u8bfb\uff0c\u5e76\u4e14\u5728\u6d4b\u8bd5\u548c\u9a8c\u8bc1\u5efa\u8bae\u5728\u60a8\u7684\u96c6\u7fa4\u4e2d\u6709\u6548\u4e4b\u524d\uff0c\u4e0d\u5e94\u5e94\u7528\u8fd9\u4e9b\u5efa\u8bae\u3002</p>"},{"location":"zh/scalability/docs/#_2","title":"\u4e86\u89e3\u6269\u5c55\u7ef4\u5ea6","text":"<p>\u53ef\u6269\u5c55\u6027\u4e0e\u6027\u80fd\u548c\u53ef\u9760\u6027\u4e0d\u540c\uff0c\u5728\u89c4\u5212\u96c6\u7fa4\u548c\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u65f6\u5e94\u8003\u8651\u8fd9\u4e09\u4e2a\u65b9\u9762\u3002\u968f\u7740\u96c6\u7fa4\u7684\u6269\u5c55\uff0c\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\uff0c\u4f46\u672c\u6307\u5357\u4e0d\u4f1a\u6db5\u76d6\u76d1\u63a7\u6700\u4f73\u5b9e\u8df5\u3002EKS \u53ef\u4ee5\u6269\u5c55\u5230\u5f88\u5927\u7684\u89c4\u6a21\uff0c\u4f46\u60a8\u9700\u8981\u89c4\u5212\u5982\u4f55\u5c06\u96c6\u7fa4\u6269\u5c55\u8d85\u8fc7 300 \u4e2a\u8282\u70b9\u6216 5000 \u4e2a Pod\u3002\u8fd9\u4e9b\u5e76\u975e\u7edd\u5bf9\u6570\u5b57\uff0c\u800c\u662f\u901a\u8fc7\u4e0e\u591a\u4e2a\u7528\u6237\u3001\u5de5\u7a0b\u5e08\u548c\u652f\u6301\u4e13\u4e1a\u4eba\u5458\u5408\u4f5c\u5236\u5b9a\u672c\u6307\u5357\u65f6\u5f97\u51fa\u7684\u7ed3\u679c\u3002</p> <p>Kubernetes \u4e2d\u7684\u6269\u5c55\u662f\u591a\u7ef4\u7684\uff0c\u6ca1\u6709\u7279\u5b9a\u7684\u8bbe\u7f6e\u6216\u5efa\u8bae\u9002\u7528\u4e8e\u6bcf\u79cd\u60c5\u51b5\u3002\u6211\u4eec\u53ef\u4ee5\u5c31\u4ee5\u4e0b\u4e3b\u8981\u9886\u57df\u63d0\u4f9b\u6269\u5c55\u6307\u5bfc\uff1a</p> <ul> <li>Kubernetes \u63a7\u5236\u5e73\u9762</li> <li>Kubernetes \u6570\u636e\u5e73\u9762</li> <li>\u96c6\u7fa4\u670d\u52a1</li> <li>\u5de5\u4f5c\u8d1f\u8f7d</li> </ul> <p>Kubernetes \u63a7\u5236\u5e73\u9762\u5728 EKS \u96c6\u7fa4\u4e2d\u5305\u62ec AWS \u4e3a\u60a8\u81ea\u52a8\u8fd0\u884c\u548c\u6269\u5c55\u7684\u6240\u6709\u670d\u52a1(\u4f8b\u5982 Kubernetes API \u670d\u52a1\u5668)\u3002\u6269\u5c55\u63a7\u5236\u5e73\u9762\u662f AWS \u7684\u8d23\u4efb\uff0c\u4f46\u8d1f\u8d23\u4efb\u5730\u4f7f\u7528\u63a7\u5236\u5e73\u9762\u662f\u60a8\u7684\u8d23\u4efb\u3002</p> <p>Kubernetes \u6570\u636e\u5e73\u9762\u6269\u5c55\u6d89\u53ca\u96c6\u7fa4\u548c\u5de5\u4f5c\u8d1f\u8f7d\u6240\u9700\u7684 AWS \u8d44\u6e90\uff0c\u4f46\u5b83\u4eec\u4f4d\u4e8e EKS \u63a7\u5236\u5e73\u9762\u4e4b\u5916\u3002\u968f\u7740\u96c6\u7fa4\u7684\u6269\u5c55\uff0c\u9700\u8981\u6269\u5c55 EC2 \u5b9e\u4f8b\u3001kubelet \u548c\u5b58\u50a8\u7b49\u8d44\u6e90\u3002</p> <p>\u96c6\u7fa4\u670d\u52a1\u662f\u5728\u96c6\u7fa4\u5185\u8fd0\u884c\u5e76\u4e3a\u96c6\u7fa4\u548c\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u529f\u80fd\u7684 Kubernetes \u63a7\u5236\u5668\u548c\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u4e9b\u53ef\u4ee5\u662f EKS \u63d2\u4ef6\u4ee5\u53ca\u60a8\u4e3a\u5408\u89c4\u6027\u548c\u96c6\u6210\u800c\u5b89\u88c5\u7684\u5176\u4ed6\u670d\u52a1\u6216 Helm \u56fe\u8868\u3002\u8fd9\u4e9b\u670d\u52a1\u901a\u5e38\u7531\u5de5\u4f5c\u8d1f\u8f7d\u4f9d\u8d56\uff0c\u968f\u7740\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6269\u5c55\uff0c\u60a8\u7684\u96c6\u7fa4\u670d\u52a1\u4e5f\u9700\u8981\u76f8\u5e94\u6269\u5c55\u3002</p> <p>\u5de5\u4f5c\u8d1f\u8f7d\u662f\u60a8\u62e5\u6709\u96c6\u7fa4\u7684\u539f\u56e0\uff0c\u5e94\u8be5\u4e0e\u96c6\u7fa4\u4e00\u8d77\u6c34\u5e73\u6269\u5c55\u3002\u5de5\u4f5c\u8d1f\u8f7d\u5728 Kubernetes \u4e2d\u6709\u4e00\u4e9b\u96c6\u6210\u548c\u8bbe\u7f6e\u53ef\u4ee5\u5e2e\u52a9\u96c6\u7fa4\u6269\u5c55\u3002\u5728 Kubernetes \u62bd\u8c61\u6982\u5ff5(\u5982\u547d\u540d\u7a7a\u95f4\u548c\u670d\u52a1)\u65b9\u9762\u4e5f\u6709\u4e00\u4e9b\u67b6\u6784\u8003\u8651\u56e0\u7d20\u3002</p>"},{"location":"zh/scalability/docs/#_3","title":"\u8d85\u5927\u89c4\u6a21\u6269\u5c55","text":"<p>\u5982\u679c\u60a8\u8981\u5c06\u5355\u4e2a\u96c6\u7fa4\u6269\u5c55\u8d85\u8fc7 1000 \u4e2a\u8282\u70b9\u6216 50\uff0c000 \u4e2a Pod\uff0c\u6211\u4eec\u5f88\u4e50\u610f\u4e0e\u60a8\u4ea4\u8c08\u3002\u6211\u4eec\u5efa\u8bae\u4e0e\u60a8\u7684\u652f\u6301\u56e2\u961f\u6216\u6280\u672f\u8d26\u6237\u7ecf\u7406\u8054\u7cfb\uff0c\u4ee5\u4e0e\u4e13\u5bb6\u53d6\u5f97\u8054\u7cfb\uff0c\u4ed6\u4eec\u53ef\u4ee5\u5e2e\u52a9\u60a8\u89c4\u5212\u548c\u6269\u5c55\u8d85\u51fa\u672c\u6307\u5357\u63d0\u4f9b\u7684\u4fe1\u606f\u3002</p>"},{"location":"zh/scalability/docs/cluster-services/","title":"\u96c6\u7fa4\u670d\u52a1","text":"<p>\u96c6\u7fa4\u670d\u52a1\u8fd0\u884c\u5728 EKS \u96c6\u7fa4\u5185\u90e8\uff0c\u4f46\u5b83\u4eec\u4e0d\u662f\u7528\u6237\u5de5\u4f5c\u8d1f\u8f7d\u3002\u5982\u679c\u4f60\u6709\u4e00\u53f0 Linux \u670d\u52a1\u5668\uff0c\u4f60\u901a\u5e38\u9700\u8981\u8fd0\u884c\u8bf8\u5982 NTP\u3001syslog \u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u7b49\u670d\u52a1\u6765\u652f\u6301\u4f60\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\u96c6\u7fa4\u670d\u52a1\u7c7b\u4f3c\uff0c\u652f\u6301\u5e2e\u52a9\u4f60\u81ea\u52a8\u5316\u548c\u64cd\u4f5c\u96c6\u7fa4\u7684\u670d\u52a1\u3002\u5728 Kubernetes \u4e2d\uff0c\u8fd9\u4e9b\u901a\u5e38\u8fd0\u884c\u5728 kube-system \u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u6709\u4e9b\u4f5c\u4e3a DaemonSets \u8fd0\u884c\u3002</p> <p>\u96c6\u7fa4\u670d\u52a1\u5e94\u8be5\u6709\u5f88\u9ad8\u7684\u6b63\u5e38\u8fd0\u884c\u65f6\u95f4\uff0c\u5728\u53d1\u751f\u6545\u969c\u548c\u6545\u969c\u6392\u67e5\u65f6\u901a\u5e38\u81f3\u5173\u91cd\u8981\u3002\u5982\u679c\u4e00\u4e2a\u6838\u5fc3\u96c6\u7fa4\u670d\u52a1\u4e0d\u53ef\u7528\uff0c\u4f60\u53ef\u80fd\u4f1a\u5931\u53bb\u8bbf\u95ee\u53ef\u4ee5\u5e2e\u52a9\u6062\u590d\u6216\u9884\u9632\u6545\u969c\u7684\u6570\u636e(\u4f8b\u5982\u9ad8\u78c1\u76d8\u5229\u7528\u7387)\u3002\u5b83\u4eec\u5e94\u8be5\u8fd0\u884c\u5728\u4e13\u7528\u8ba1\u7b97\u5b9e\u4f8b\u4e0a\uff0c\u4f8b\u5982\u5355\u72ec\u7684\u8282\u70b9\u7ec4\u6216 AWS Fargate\u3002\u8fd9\u5c06\u786e\u4fdd\u96c6\u7fa4\u670d\u52a1\u4e0d\u4f1a\u53d7\u5230\u5171\u4eab\u5b9e\u4f8b\u4e0a\u53ef\u80fd\u6269\u5c55\u6216\u4f7f\u7528\u66f4\u591a\u8d44\u6e90\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5f71\u54cd\u3002</p>"},{"location":"zh/scalability/docs/cluster-services/#coredns","title":"\u6269\u5c55 CoreDNS","text":"<p>\u6269\u5c55 CoreDNS \u6709\u4e24\u4e2a\u4e3b\u8981\u673a\u5236\u3002\u51cf\u5c11\u5bf9 CoreDNS \u670d\u52a1\u7684\u8c03\u7528\u6b21\u6570\u548c\u589e\u52a0\u526f\u672c\u6570\u91cf\u3002</p>"},{"location":"zh/scalability/docs/cluster-services/#ndots","title":"\u901a\u8fc7\u964d\u4f4e ndots \u51cf\u5c11\u5916\u90e8\u67e5\u8be2","text":"<p>ndots \u8bbe\u7f6e\u6307\u5b9a\u5728\u57df\u540d\u4e2d\u88ab\u8ba4\u4e3a\u8db3\u4ee5\u907f\u514d\u67e5\u8be2 DNS \u7684\u70b9\u6570\u3002\u5982\u679c\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u7684 ndots \u8bbe\u7f6e\u4e3a 5(\u9ed8\u8ba4\u503c)\uff0c\u5e76\u4e14\u4f60\u4ece\u5916\u90e8\u57df(\u5982 api.example.com,2 \u4e2a\u70b9)\u8bf7\u6c42\u8d44\u6e90\uff0c\u90a3\u4e48 CoreDNS \u5c06\u4e3a /etc/resolv.conf \u4e2d\u5b9a\u4e49\u7684\u6bcf\u4e2a\u641c\u7d22\u57df\u67e5\u8be2\u4e00\u4e2a\u66f4\u5177\u4f53\u7684\u57df\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5c06\u641c\u7d22\u4ee5\u4e0b\u57df\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5916\u90e8\u8bf7\u6c42\u3002</p> <pre><code>api.example.&lt;namespace&gt;.svc.cluster.local\napi.example.svc.cluster.local\napi.example.cluster.local\napi.example.&lt;region&gt;.compute.internal\n</code></pre> <p><code>namespace</code> \u548c <code>region</code> \u503c\u5c06\u88ab\u66ff\u6362\u4e3a\u4f60\u7684\u5de5\u4f5c\u8d1f\u8f7d\u547d\u540d\u7a7a\u95f4\u548c\u8ba1\u7b97\u533a\u57df\u3002\u6839\u636e\u4f60\u7684\u96c6\u7fa4\u8bbe\u7f6e\uff0c\u4f60\u53ef\u80fd\u8fd8\u6709\u5176\u4ed6\u641c\u7d22\u57df\u3002</p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u964d\u4f4e\u5de5\u4f5c\u8d1f\u8f7d\u7684 ndots \u9009\u9879\u6216\u5728\u57df\u8bf7\u6c42\u4e2d\u5305\u542b\u5c3e\u968f . \u6765\u5b8c\u5168\u9650\u5b9a\u57df(\u4f8b\u5982 <code>api.example.com.</code>)\u6765\u51cf\u5c11\u5bf9 CoreDNS \u7684\u8bf7\u6c42\u6b21\u6570\u3002\u5982\u679c\u4f60\u7684\u5de5\u4f5c\u8d1f\u8f7d\u901a\u8fc7 DNS \u8fde\u63a5\u5230\u5916\u90e8\u670d\u52a1\uff0c\u6211\u4eec\u5efa\u8bae\u5c06 ndots \u8bbe\u7f6e\u4e3a 2\uff0c\u4ee5\u4fbf\u5de5\u4f5c\u8d1f\u8f7d\u4e0d\u4f1a\u5728\u96c6\u7fa4\u5185\u90e8\u8fdb\u884c\u4e0d\u5fc5\u8981\u7684\u96c6\u7fa4 DNS \u67e5\u8be2\u3002\u5982\u679c\u5de5\u4f5c\u8d1f\u8f7d\u4e0d\u9700\u8981\u8bbf\u95ee\u96c6\u7fa4\u5185\u90e8\u7684\u670d\u52a1\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u4e0d\u540c\u7684 DNS \u670d\u52a1\u5668\u548c\u641c\u7d22\u57df\u3002</p> <pre><code>spec:\n  dnsPolicy: \"None\"\n  dnsConfig:\n    options:\n      - name: ndots\n        value: \"2\"\n      - name: edns0\n</code></pre> <p>\u5982\u679c\u4f60\u5c06 ndots \u964d\u4f4e\u5230\u4e00\u4e2a\u592a\u4f4e\u7684\u503c\uff0c\u6216\u8005\u4f60\u6b63\u5728\u8fde\u63a5\u7684\u57df\u6ca1\u6709\u5305\u542b\u8db3\u591f\u7684\u7279\u5f02\u6027(\u5305\u62ec\u5c3e\u968f .),\u90a3\u4e48 DNS \u67e5\u627e\u53ef\u80fd\u4f1a\u5931\u8d25\u3002\u8bf7\u786e\u4fdd\u6d4b\u8bd5\u6b64\u8bbe\u7f6e\u5c06\u5982\u4f55\u5f71\u54cd\u4f60\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p>"},{"location":"zh/scalability/docs/cluster-services/#coredns_1","title":"\u6c34\u5e73\u6269\u5c55 CoreDNS","text":"<p>CoreDNS \u5b9e\u4f8b\u53ef\u4ee5\u901a\u8fc7\u5411\u90e8\u7f72\u6dfb\u52a0\u66f4\u591a\u526f\u672c\u6765\u6269\u5c55\u3002\u5efa\u8bae\u4f60\u4f7f\u7528 NodeLocal DNS \u6216 cluster proportional autoscaler \u6765\u6269\u5c55 CoreDNS\u3002</p> <p>NodeLocal DNS \u9700\u8981\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a\u5b9e\u4f8b - \u4f5c\u4e3a DaemonSet - \u8fd9\u9700\u8981\u96c6\u7fa4\u4e2d\u66f4\u591a\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u4f46\u5b83\u5c06\u907f\u514d DNS \u8bf7\u6c42\u5931\u8d25\u5e76\u51cf\u5c11\u96c6\u7fa4\u5185 DNS \u67e5\u8be2\u7684\u54cd\u5e94\u65f6\u95f4\u3002cluster proportional autoscaler \u5c06\u6839\u636e\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u6570\u6216\u6838\u5fc3\u6570\u6765\u6269\u5c55 CoreDNS\u3002\u8fd9\u4e0e\u8bf7\u6c42\u67e5\u8be2\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\uff0c\u4f46\u6839\u636e\u4f60\u7684\u5de5\u4f5c\u8d1f\u8f7d\u548c\u96c6\u7fa4\u5927\u5c0f\u53ef\u80fd\u4f1a\u6709\u7528\u3002\u9ed8\u8ba4\u7684\u6bd4\u4f8b\u6269\u5c55\u662f\u6bcf 256 \u4e2a\u6838\u5fc3\u6216 16 \u4e2a\u8282\u70b9(\u4ee5\u5148\u53d1\u751f\u7684\u4e3a\u51c6)\u6dfb\u52a0\u4e00\u4e2a\u526f\u672c\u3002</p>"},{"location":"zh/scalability/docs/cluster-services/#kubernetes-metrics-server","title":"\u5782\u76f4\u6269\u5c55 Kubernetes Metrics Server","text":"<p>Kubernetes Metrics Server \u652f\u6301\u6c34\u5e73\u548c\u5782\u76f4\u6269\u5c55\u3002\u901a\u8fc7\u6c34\u5e73\u6269\u5c55 Metrics Server\uff0c\u5b83\u5c06\u662f\u9ad8\u53ef\u7528\u7684\uff0c\u4f46\u4e0d\u4f1a\u6c34\u5e73\u6269\u5c55\u6765\u5904\u7406\u66f4\u591a\u7684\u96c6\u7fa4\u6307\u6807\u3002\u968f\u7740\u8282\u70b9\u548c\u6536\u96c6\u7684\u6307\u6807\u88ab\u6dfb\u52a0\u5230\u96c6\u7fa4\u4e2d\uff0c\u4f60\u5c06\u9700\u8981\u6839\u636e\u4ed6\u4eec\u7684\u5efa\u8bae\u6765\u5782\u76f4\u6269\u5c55 Metrics Server\u3002</p> <p>Metrics Server \u5c06\u5b83\u6536\u96c6\u3001\u805a\u5408\u548c\u670d\u52a1\u7684\u6570\u636e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u968f\u7740\u96c6\u7fa4\u7684\u589e\u957f\uff0cMetrics Server \u5b58\u50a8\u7684\u6570\u636e\u91cf\u4e5f\u4f1a\u589e\u52a0\u3002\u5728\u5927\u578b\u96c6\u7fa4\u4e2d\uff0cMetrics Server \u5c06\u9700\u8981\u6bd4\u9ed8\u8ba4\u5b89\u88c5\u4e2d\u6307\u5b9a\u7684\u5185\u5b58\u548c CPU \u9884\u7559\u66f4\u591a\u7684\u8ba1\u7b97\u8d44\u6e90\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 Vertical Pod Autoscaler (VPA) \u6216 Addon Resizer \u6765\u6269\u5c55 Metrics Server\u3002Addon Resizer \u6839\u636e\u5de5\u4f5c\u8282\u70b9\u7684\u6570\u91cf\u6309\u6bd4\u4f8b\u5782\u76f4\u6269\u5c55\uff0c\u800c VPA \u6839\u636e CPU \u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u8fdb\u884c\u6269\u5c55\u3002</p>"},{"location":"zh/scalability/docs/cluster-services/#coredns-lameduck","title":"CoreDNS lameduck \u6301\u7eed\u65f6\u95f4","text":"<p>Pod \u4f7f\u7528 <code>kube-dns</code> \u670d\u52a1\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u3002Kubernetes \u4f7f\u7528\u76ee\u6807 NAT (DNAT) \u5c06 <code>kube-dns</code> \u6d41\u91cf\u4ece\u8282\u70b9\u91cd\u5b9a\u5411\u5230 CoreDNS \u540e\u7aef Pod\u3002\u5f53\u4f60\u6269\u5c55 CoreDNS \u90e8\u7f72\u65f6\uff0c<code>kube-proxy</code> \u4f1a\u66f4\u65b0\u8282\u70b9\u4e0a\u7684 iptables \u89c4\u5219\u548c\u94fe\uff0c\u4ee5\u5c06 DNS \u6d41\u91cf\u91cd\u5b9a\u5411\u5230 CoreDNS Pod\u3002\u6839\u636e\u96c6\u7fa4\u7684\u5927\u5c0f\uff0c\u4f20\u64ad\u65b0\u7684\u7aef\u70b9(\u6269\u5c55\u65f6)\u548c\u5220\u9664\u89c4\u5219(\u7f29\u51cf CoreDNS \u65f6)\u53ef\u80fd\u9700\u8981 1 \u5230 10 \u79d2\u3002</p> <p>\u8fd9\u79cd\u4f20\u64ad\u5ef6\u8fdf\u53ef\u80fd\u4f1a\u5bfc\u81f4 DNS \u67e5\u627e\u5931\u8d25\uff0c\u56e0\u4e3a CoreDNS Pod \u88ab\u7ec8\u6b62\uff0c\u4f46\u8282\u70b9\u7684 iptables \u89c4\u5219\u5c1a\u672a\u66f4\u65b0\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8282\u70b9\u53ef\u80fd\u4f1a\u7ee7\u7eed\u5411\u5df2\u7ec8\u6b62\u7684 CoreDNS Pod \u53d1\u9001 DNS \u67e5\u8be2\u3002</p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728 CoreDNS Pod \u4e2d\u8bbe\u7f6e lameduck \u6301\u7eed\u65f6\u95f4\u6765\u51cf\u5c11 DNS \u67e5\u627e\u5931\u8d25\u3002\u5728 lameduck \u6a21\u5f0f\u4e0b\uff0cCoreDNS \u5c06\u7ee7\u7eed\u54cd\u5e94\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u3002\u8bbe\u7f6e lameduck \u6301\u7eed\u65f6\u95f4\u5c06\u5ef6\u8fdf CoreDNS \u5173\u95ed\u8fc7\u7a0b\uff0c\u8ba9\u8282\u70b9\u6709\u65f6\u95f4\u66f4\u65b0\u5176 iptables \u89c4\u5219\u548c\u94fe\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u5c06 CoreDNS lameduck \u6301\u7eed\u65f6\u95f4\u8bbe\u7f6e\u4e3a 30 \u79d2\u3002</p>"},{"location":"zh/scalability/docs/cluster-services/#coredns_2","title":"CoreDNS \u5c31\u7eea\u63a2\u9488","text":"<p>\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 <code>/ready</code> \u800c\u4e0d\u662f <code>/health</code> \u4f5c\u4e3a CoreDNS \u7684\u5c31\u7eea\u63a2\u9488\u3002</p> <p>\u4e0e\u4e4b\u524d\u5efa\u8bae\u5c06 lameduck \u6301\u7eed\u65f6\u95f4\u8bbe\u7f6e\u4e3a 30 \u79d2\u76f8\u4e00\u81f4\uff0c\u5728 Pod \u7ec8\u6b62\u4e4b\u524d\u63d0\u4f9b\u8db3\u591f\u7684\u65f6\u95f4\u8ba9\u8282\u70b9\u7684 iptables \u89c4\u5219\u5f97\u5230\u66f4\u65b0\uff0c\u4f7f\u7528 <code>/ready</code> \u800c\u4e0d\u662f <code>/health</code> \u4f5c\u4e3a CoreDNS \u5c31\u7eea\u63a2\u9488\u53ef\u786e\u4fdd CoreDNS Pod \u5728\u542f\u52a8\u65f6\u5c31\u5b8c\u5168\u51c6\u5907\u597d\u53ca\u65f6\u54cd\u5e94 DNS \u8bf7\u6c42\u3002</p> <pre><code>readinessProbe:\n  httpGet:\n    path: /ready\n    port: 8181\n    scheme: HTTP\n</code></pre> <p>\u6709\u5173 CoreDNS Ready \u63d2\u4ef6\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://coredns.io/plugins/ready/</p>"},{"location":"zh/scalability/docs/cluster-services/#_2","title":"\u65e5\u5fd7\u548c\u76d1\u63a7\u4ee3\u7406","text":"<p>\u65e5\u5fd7\u548c\u76d1\u63a7\u4ee3\u7406\u53ef\u80fd\u4f1a\u7ed9\u4f60\u7684\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u5e26\u6765\u5927\u91cf\u8d1f\u8f7d\uff0c\u56e0\u4e3a\u4ee3\u7406\u4f1a\u67e5\u8be2 API \u670d\u52a1\u5668\u4ee5\u4e30\u5bcc\u65e5\u5fd7\u548c\u6307\u6807\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5143\u6570\u636e\u3002\u8282\u70b9\u4e0a\u7684\u4ee3\u7406\u53ea\u80fd\u8bbf\u95ee\u672c\u5730\u8282\u70b9\u8d44\u6e90\uff0c\u770b\u5230\u8bf8\u5982\u5bb9\u5668\u548c\u8fdb\u7a0b\u540d\u79f0\u4e4b\u7c7b\u7684\u5185\u5bb9\u3002\u67e5\u8be2 API \u670d\u52a1\u5668\u53ef\u4ee5\u6dfb\u52a0\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u5982 Kubernetes \u90e8\u7f72\u540d\u79f0\u548c\u6807\u7b7e\u3002\u8fd9\u5bf9\u4e8e\u6545\u969c\u6392\u67e5\u975e\u5e38\u6709\u5e2e\u52a9\uff0c\u4f46\u5bf9\u4e8e\u6269\u5c55\u6765\u8bf4\u662f\u6709\u5bb3\u7684\u3002</p> <p>\u7531\u4e8e\u65e5\u5fd7\u548c\u76d1\u63a7\u7684\u9009\u9879\u6709\u5f88\u591a\u79cd\uff0c\u6211\u4eec\u65e0\u6cd5\u4e3a\u6bcf\u4e2a\u63d0\u4f9b\u5546\u5c55\u793a\u793a\u4f8b\u3002\u5bf9\u4e8e fluentbit,\u6211\u4eec\u5efa\u8bae\u542f\u7528 Use_Kubelet \u4ece\u672c\u5730 kubelet \u800c\u4e0d\u662f Kubernetes API \u670d\u52a1\u5668\u83b7\u53d6\u5143\u6570\u636e\uff0c\u5e76\u5c06 <code>Kube_Meta_Cache_TTL</code> \u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u4ee5\u51cf\u5c11\u91cd\u590d\u8c03\u7528\u65f6\u53ef\u4ee5\u7f13\u5b58\u6570\u636e(\u4f8b\u5982 60)\u3002</p> <p>\u6269\u5c55\u76d1\u63a7\u548c\u65e5\u5fd7\u6709\u4e24\u4e2a\u901a\u7528\u9009\u9879\uff1a</p> <ul> <li>\u7981\u7528\u96c6\u6210</li> <li>\u91c7\u6837\u548c\u8fc7\u6ee4</li> </ul> <p>\u7981\u7528\u96c6\u6210\u901a\u5e38\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u56e0\u4e3a\u4f60\u4f1a\u4e22\u5931\u65e5\u5fd7\u5143\u6570\u636e\u3002\u8fd9\u5c06\u6d88\u9664 API \u6269\u5c55\u95ee\u9898\uff0c\u4f46\u4f1a\u5f15\u5165\u5176\u4ed6\u95ee\u9898\uff0c\u56e0\u4e3a\u5728\u9700\u8981\u65f6\u6ca1\u6709\u6240\u9700\u7684\u5143\u6570\u636e\u3002</p> <p>\u91c7\u6837\u548c\u8fc7\u6ee4\u53ef\u4ee5\u51cf\u5c11\u6536\u96c6\u7684\u6307\u6807\u548c\u65e5\u5fd7\u7684\u6570\u91cf\u3002\u8fd9\u5c06\u964d\u4f4e\u5bf9 Kubernetes API \u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u5e76\u51cf\u5c11\u5b58\u50a8\u6536\u96c6\u7684\u6307\u6807\u548c\u65e5\u5fd7\u6240\u9700\u7684\u7a7a\u95f4\u3002\u51cf\u5c11\u5b58\u50a8\u6210\u672c\u5c06\u964d\u4f4e\u6574\u4e2a\u7cfb\u7edf\u7684\u6210\u672c\u3002</p> <p>\u914d\u7f6e\u91c7\u6837\u7684\u80fd\u529b\u53d6\u51b3\u4e8e\u4ee3\u7406\u8f6f\u4ef6\uff0c\u53ef\u4ee5\u5728\u5f15\u5165\u7684\u4e0d\u540c\u70b9\u5b9e\u73b0\u3002\u5c3d\u53ef\u80fd\u9760\u8fd1\u4ee3\u7406\u6dfb\u52a0\u91c7\u6837\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a API \u670d\u52a1\u5668\u8c03\u7528\u53ef\u80fd\u53d1\u751f\u5728\u90a3\u91cc\u3002\u8bf7\u8054\u7cfb\u4f60\u7684\u63d0\u4f9b\u5546\u4ee5\u4e86\u89e3\u6709\u5173\u91c7\u6837\u652f\u6301\u7684\u66f4\u591a\u4fe1\u606f\u3002</p> <p>\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 CloudWatch \u548c CloudWatch Logs\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u6587\u6863\u4e2d\u63cf\u8ff0\u7684\u6a21\u5f0f\u6dfb\u52a0\u4ee3\u7406\u8fc7\u6ee4\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u4e22\u5931\u65e5\u5fd7\u548c\u6307\u6807\uff0c\u4f60\u5e94\u8be5\u5c06\u6570\u636e\u53d1\u9001\u5230\u4e00\u4e2a\u53ef\u4ee5\u5728\u63a5\u6536\u7aef\u53d1\u751f\u6545\u969c\u65f6\u7f13\u51b2\u6570\u636e\u7684\u7cfb\u7edf\u3002\u4f7f\u7528 fluentbit\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Amazon Kinesis Data Firehose \u6682\u65f6\u4fdd\u7559\u6570\u636e\uff0c\u8fd9\u53ef\u4ee5\u51cf\u5c11\u8fc7\u8f7d\u6700\u7ec8\u6570\u636e\u5b58\u50a8\u4f4d\u7f6e\u7684\u673a\u4f1a\u3002</p>"},{"location":"zh/scalability/docs/control-plane/","title":"Kubernetes \u63a7\u5236\u5e73\u9762","text":"<p>Kubernetes \u63a7\u5236\u5e73\u9762\u7531 Kubernetes API \u670d\u52a1\u5668\u3001Kubernetes \u63a7\u5236\u5668\u7ba1\u7406\u5668\u3001\u8c03\u5ea6\u5668\u548c Kubernetes \u6b63\u5e38\u8fd0\u884c\u6240\u9700\u7684\u5176\u4ed6\u7ec4\u4ef6\u7ec4\u6210\u3002\u8fd9\u4e9b\u7ec4\u4ef6\u7684\u53ef\u6269\u5c55\u6027\u9650\u5236\u56e0\u60a8\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5185\u5bb9\u800c\u6709\u6240\u4e0d\u540c\uff0c\u4f46\u5bf9\u6269\u5c55\u5f71\u54cd\u6700\u5927\u7684\u9886\u57df\u5305\u62ec Kubernetes \u7248\u672c\u3001\u5229\u7528\u7387\u548c\u5355\u4e2a\u8282\u70b9\u6269\u5c55\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#eks-124","title":"\u4f7f\u7528 EKS 1.24 \u6216\u66f4\u9ad8\u7248\u672c","text":"<p>EKS 1.24 \u5f15\u5165\u4e86\u8bb8\u591a\u66f4\u6539\uff0c\u5e76\u5c06\u5bb9\u5668\u8fd0\u884c\u65f6\u5207\u6362\u4e3a containerd \u800c\u4e0d\u662f docker\u3002containerd \u901a\u8fc7\u9650\u5236\u5bb9\u5668\u8fd0\u884c\u65f6\u529f\u80fd\u4ee5\u7d27\u5bc6\u5bf9\u5e94 Kubernetes \u7684\u9700\u6c42\u6765\u63d0\u9ad8\u5355\u4e2a\u8282\u70b9\u6027\u80fd\uff0c\u4ece\u800c\u5e2e\u52a9\u96c6\u7fa4\u6269\u5c55\u3002containerd \u5728\u6bcf\u4e2a\u53d7\u652f\u6301\u7684 EKS \u7248\u672c\u4e2d\u90fd\u53ef\u7528\uff0c\u5982\u679c\u60a8\u5e0c\u671b\u5728 1.24 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\u5207\u6362\u5230 containerd\uff0c\u8bf7\u4f7f\u7528 <code>--container-runtime</code> \u5f15\u5bfc\u6807\u5fd7\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#_1","title":"\u9650\u5236\u5de5\u4f5c\u8d1f\u8f7d\u548c\u8282\u70b9\u7a81\u53d1","text":"<p>\u6ce8\u610f</p> <p>\u4e3a\u4e86\u907f\u514d\u8fbe\u5230\u63a7\u5236\u5e73\u9762\u7684 API \u9650\u5236\uff0c\u60a8\u5e94\u8be5\u9650\u5236\u4e00\u6b21\u589e\u52a0\u96c6\u7fa4\u5927\u5c0f\u4e24\u4f4d\u6570\u767e\u5206\u6bd4\u7684\u6269\u5c55\u5cf0\u503c(\u4f8b\u5982\uff0c\u4ece 1000 \u4e2a\u8282\u70b9\u5230 1100 \u4e2a\u8282\u70b9\u6216\u4e00\u6b21\u4ece 4000 \u4e2a pod \u5230 4500 \u4e2a pod)\u3002</p> <p>\u5f53\u60a8\u7684\u96c6\u7fa4\u589e\u957f\u65f6\uff0cEKS \u63a7\u5236\u5e73\u9762\u5c06\u81ea\u52a8\u6269\u5c55\uff0c\u4f46\u5bf9\u4e8e\u5b83\u5c06\u6269\u5c55\u7684\u901f\u5ea6\u6709\u9650\u5236\u3002\u5f53\u60a8\u9996\u6b21\u521b\u5efa EKS \u96c6\u7fa4\u65f6\uff0c\u63a7\u5236\u5e73\u9762\u4e0d\u4f1a\u7acb\u5373\u80fd\u591f\u6269\u5c55\u5230\u6570\u767e\u4e2a\u8282\u70b9\u6216\u6570\u5343\u4e2a pod\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e EKS \u5982\u4f55\u8fdb\u884c\u6269\u5c55\u6539\u8fdb\uff0c\u8bf7\u9605\u8bfb\u6b64\u535a\u5ba2\u6587\u7ae0\u3002</p> <p>\u5927\u578b\u5e94\u7528\u7a0b\u5e8f\u7684\u6269\u5c55\u9700\u8981\u57fa\u7840\u8bbe\u65bd\u9002\u5e94\u4ee5\u5b8c\u5168\u5c31\u7eea(\u4f8b\u5982\u9884\u70ed\u8d1f\u8f7d\u5747\u8861\u5668)\u3002\u4e3a\u4e86\u63a7\u5236\u6269\u5c55\u901f\u5ea6\uff0c\u8bf7\u786e\u4fdd\u60a8\u6839\u636e\u5e94\u7528\u7a0b\u5e8f\u7684\u6b63\u786e\u6307\u6807\u8fdb\u884c\u6269\u5c55\u3002CPU \u548c\u5185\u5b58\u6269\u5c55\u53ef\u80fd\u65e0\u6cd5\u51c6\u786e\u9884\u6d4b\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7ea6\u675f\uff0c\u5728 Kubernetes \u6c34\u5e73 Pod \u81ea\u52a8\u7f29\u653e\u5668 (HPA) \u4e2d\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u6807(\u4f8b\u5982\u6bcf\u79d2\u8bf7\u6c42\u6570)\u53ef\u80fd\u662f\u66f4\u597d\u7684\u6269\u5c55\u9009\u62e9\u3002</p> <p>\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u6807\uff0c\u8bf7\u53c2\u9605 Kubernetes \u6587\u6863\u4e2d\u7684\u793a\u4f8b\u3002\u5982\u679c\u60a8\u6709\u66f4\u9ad8\u7ea7\u7684\u6269\u5c55\u9700\u6c42\u6216\u9700\u8981\u6839\u636e\u5916\u90e8\u6e90(\u4f8b\u5982 AWS SQS \u961f\u5217)\u8fdb\u884c\u6269\u5c55\uff0c\u5219\u4f7f\u7528 KEDA \u8fdb\u884c\u57fa\u4e8e\u4e8b\u4ef6\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6269\u5c55\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#pod","title":"\u5b89\u5168\u5730\u7f29\u51cf\u8282\u70b9\u548c pod","text":""},{"location":"zh/scalability/docs/control-plane/#_2","title":"\u66ff\u6362\u957f\u671f\u8fd0\u884c\u7684\u5b9e\u4f8b","text":"<p>\u5b9a\u671f\u66ff\u6362\u8282\u70b9\u53ef\u4ee5\u901a\u8fc7\u907f\u514d\u914d\u7f6e\u6f02\u79fb\u548c\u4ec5\u5728\u957f\u65f6\u95f4\u8fd0\u884c\u540e\u624d\u4f1a\u53d1\u751f\u7684\u95ee\u9898(\u4f8b\u5982\u7f13\u6162\u5185\u5b58\u6cc4\u6f0f)\u6765\u4fdd\u6301\u96c6\u7fa4\u5065\u5eb7\u3002\u81ea\u52a8\u5316\u66ff\u6362\u5c06\u4e3a\u60a8\u63d0\u4f9b\u826f\u597d\u7684\u6d41\u7a0b\u548c\u5b9e\u8df5\uff0c\u7528\u4e8e\u8282\u70b9\u5347\u7ea7\u548c\u5b89\u5168\u8865\u4e01\u3002\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u5b9a\u671f\u66ff\u6362\uff0c\u90a3\u4e48\u7ef4\u62a4\u5355\u72ec\u7684\u6d41\u7a0b\u8fdb\u884c\u6301\u7eed\u7ef4\u62a4\u6240\u9700\u7684\u5de5\u4f5c\u91cf\u5c31\u4f1a\u51cf\u5c11\u3002</p> <p>\u4f7f\u7528 Karpenter \u7684\u751f\u5b58\u65f6\u95f4 (TTL) \u8bbe\u7f6e\u5728\u5b9e\u4f8b\u8fd0\u884c\u6307\u5b9a\u65f6\u95f4\u540e\u8fdb\u884c\u66ff\u6362\u3002\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4\u53ef\u4ee5\u4f7f\u7528 <code>max-instance-lifetime</code> \u8bbe\u7f6e\u81ea\u52a8\u5faa\u73af\u8282\u70b9\u3002\u6258\u7ba1\u8282\u70b9\u7ec4\u5f53\u524d\u6ca1\u6709\u6b64\u529f\u80fd\uff0c\u4f46\u60a8\u53ef\u4ee5\u5728 GitHub \u4e0a\u8ddf\u8e2a\u6b64\u8bf7\u6c42\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#_3","title":"\u5220\u9664\u5229\u7528\u7387\u4f4e\u7684\u8282\u70b9","text":"<p>\u5f53\u8282\u70b9\u6ca1\u6709\u6b63\u5728\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u65f6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Kubernetes \u96c6\u7fa4\u81ea\u52a8\u7f29\u653e\u5668\u4e2d\u7684 <code>--scale-down-utilization-threshold</code> \u6216\u5728 Karpenter \u4e2d\u4f7f\u7528 <code>ttlSecondsAfterEmpty</code> \u914d\u7f6e\u7a0b\u5e8f\u8bbe\u7f6e\u6765\u5220\u9664\u8282\u70b9\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#pod_1","title":"\u4f7f\u7528 Pod \u4e2d\u65ad\u9884\u7b97\u548c\u5b89\u5168\u8282\u70b9\u5173\u95ed","text":"<p>\u4ece Kubernetes \u96c6\u7fa4\u4e2d\u5220\u9664 pod \u548c\u8282\u70b9\u9700\u8981\u63a7\u5236\u5668\u5bf9\u591a\u4e2a\u8d44\u6e90(\u4f8b\u5982 EndpointSlices)\u8fdb\u884c\u66f4\u65b0\u3002\u5982\u679c\u9891\u7e41\u6216\u8fc7\u4e8e\u5feb\u901f\u5730\u6267\u884c\u6b64\u64cd\u4f5c\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4 API \u670d\u52a1\u5668\u9650\u5236\u548c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u65ad\uff0c\u56e0\u4e3a\u66f4\u6539\u4f1a\u4f20\u64ad\u5230\u63a7\u5236\u5668\u3002Pod \u4e2d\u65ad\u9884\u7b97\u662f\u4e00\u79cd\u6700\u4f73\u5b9e\u8df5\uff0c\u53ef\u4ee5\u51cf\u6162\u96c6\u7fa4\u4e2d\u5220\u9664\u6216\u91cd\u65b0\u8c03\u5ea6\u8282\u70b9\u65f6\u7684\u53d8\u66f4\u901f\u5ea6\uff0c\u4ece\u800c\u4fdd\u62a4\u5de5\u4f5c\u8d1f\u8f7d\u7684\u53ef\u7528\u6027\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#kubectl","title":"\u8fd0\u884c Kubectl \u65f6\u4f7f\u7528\u5ba2\u6237\u7aef\u7f13\u5b58","text":"<p>\u5982\u679c\u4f7f\u7528 kubectl \u547d\u4ee4\u6548\u7387\u4f4e\u4e0b\uff0c\u53ef\u80fd\u4f1a\u7ed9 Kubernetes API \u670d\u52a1\u5668\u589e\u52a0\u989d\u5916\u8d1f\u8f7d\u3002\u60a8\u5e94\u8be5\u907f\u514d\u8fd0\u884c\u91cd\u590d\u4f7f\u7528 kubectl \u7684\u811a\u672c\u6216\u81ea\u52a8\u5316(\u4f8b\u5982\u5728 for \u5faa\u73af\u4e2d)\u6216\u5728\u6ca1\u6709\u672c\u5730\u7f13\u5b58\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\u547d\u4ee4\u3002</p> <p><code>kubectl</code> \u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u7f13\u5b58\uff0c\u53ef\u4ee5\u7f13\u5b58\u6765\u81ea\u96c6\u7fa4\u7684\u53d1\u73b0\u4fe1\u606f\uff0c\u4ece\u800c\u51cf\u5c11\u6240\u9700\u7684 API \u8c03\u7528\u6b21\u6570\u3002\u7f13\u5b58\u9ed8\u8ba4\u542f\u7528\uff0c\u6bcf 10 \u5206\u949f\u5237\u65b0\u4e00\u6b21\u3002</p> <p>\u5982\u679c\u60a8\u4ece\u5bb9\u5668\u8fd0\u884c kubectl \u6216\u6ca1\u6709\u5ba2\u6237\u7aef\u7f13\u5b58\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230 API \u9650\u5236\u95ee\u9898\u3002\u5efa\u8bae\u4fdd\u7559\u60a8\u7684\u96c6\u7fa4\u7f13\u5b58\uff0c\u65b9\u6cd5\u662f\u6302\u8f7d <code>--cache-dir</code> \u4ee5\u907f\u514d\u8fdb\u884c\u4e0d\u5fc5\u8981\u7684 API \u8c03\u7528\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#kubectl_1","title":"\u7981\u7528 kubectl \u538b\u7f29","text":"<p>\u5728\u60a8\u7684 kubeconfig \u6587\u4ef6\u4e2d\u7981\u7528 kubectl \u538b\u7f29\u53ef\u4ee5\u51cf\u5c11 API \u548c\u5ba2\u6237\u7aef CPU \u4f7f\u7528\u7387\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u5668\u4f1a\u538b\u7f29\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u6570\u636e\u4ee5\u4f18\u5316\u7f51\u7edc\u5e26\u5bbd\u3002\u8fd9\u4f1a\u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e0a\u4e3a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u589e\u52a0 CPU \u8d1f\u8f7d\uff0c\u7981\u7528\u538b\u7f29\u53ef\u4ee5\u51cf\u5c11\u5f00\u9500\u548c\u5ef6\u8fdf\uff0c\u524d\u63d0\u662f\u60a8\u6709\u8db3\u591f\u7684\u5e26\u5bbd\u3002\u8981\u7981\u7528\u538b\u7f29\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>--disable-compression=true</code> \u6807\u5fd7\u6216\u5728 kubeconfig \u6587\u4ef6\u4e2d\u8bbe\u7f6e <code>disable-compression: true</code>\u3002</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    server: serverURL\n    disable-compression: true\n  name: cluster\n</code></pre>"},{"location":"zh/scalability/docs/control-plane/#_4","title":"\u5206\u7247\u96c6\u7fa4\u81ea\u52a8\u7f29\u653e\u5668","text":"<p>Kubernetes \u96c6\u7fa4\u81ea\u52a8\u7f29\u653e\u5668\u5df2\u7ecf\u8fc7\u6d4b\u8bd5,\u53ef\u4ee5\u6269\u5c55\u5230 1000 \u4e2a\u8282\u70b9\u3002\u5728\u8d85\u8fc7 1000 \u4e2a\u8282\u70b9\u7684\u5927\u578b\u96c6\u7fa4\u4e0a\uff0c\u5efa\u8bae\u4ee5\u5206\u7247\u6a21\u5f0f\u8fd0\u884c\u591a\u4e2a\u96c6\u7fa4\u81ea\u52a8\u7f29\u653e\u5668\u5b9e\u4f8b\u3002\u6bcf\u4e2a\u96c6\u7fa4\u81ea\u52a8\u7f29\u653e\u5668\u5b9e\u4f8b\u90fd\u914d\u7f6e\u4e3a\u6269\u5c55\u4e00\u7ec4\u8282\u70b9\u7ec4\u3002\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u4e86\u4e24\u4e2a\u96c6\u7fa4\u81ea\u52a8\u7f29\u653e\u914d\u7f6e\uff0c\u6bcf\u4e2a\u914d\u7f6e\u90fd\u914d\u7f6e\u4e3a\u6269\u5c55 4 \u4e2a\u8282\u70b9\u7ec4\u3002</p> <p>ClusterAutoscaler-1</p> <pre><code>autoscalingGroups:\n- name: eks-core-node-grp-20220823190924690000000011-80c1660e-030d-476d-cb0d-d04d585a8fcb\n  maxSize: 50\n  minSize: 2\n- name: eks-data_m1-20220824130553925600000011-5ec167fa-ca93-8ca4-53a5-003e1ed8d306\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m2-20220824130733258600000015-aac167fb-8bf7-429d-d032-e195af4e25f5\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m3-20220824130553914900000003-18c167fa-ca7f-23c9-0fea-f9edefbda002\n  maxSize: 450\n  minSize: 2\n</code></pre> <p>ClusterAutoscaler-2</p> <pre><code>autoscalingGroups:\n- name: eks-data_m4-2022082413055392550000000f-5ec167fa-ca86-6b83-ae9d-1e07ade3e7c4\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m5-20220824130744542100000017-02c167fb-a1f7-3d9e-a583-43b4975c050c\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m6-2022082413055392430000000d-9cc167fa-ca94-132a-04ad-e43166cef41f\n  maxSize: 450\n  minSize: 2\n- name: eks-data_m7-20220824130553921000000009-96c167fa-ca91-d767-0427-91c879ddf5af\n  maxSize: 450\n  minSize: 2\n</code></pre>"},{"location":"zh/scalability/docs/control-plane/#api","title":"API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027","text":""},{"location":"zh/scalability/docs/control-plane/#_5","title":"\u6982\u8ff0","text":"<p>\u4e3a\u4e86\u5728\u8bf7\u6c42\u589e\u52a0\u671f\u95f4\u4fdd\u62a4\u81ea\u8eab\u514d\u53d7\u8fc7\u8f7d\uff0cAPI \u670d\u52a1\u5668\u4f1a\u9650\u5236\u5b83\u5728\u7ed9\u5b9a\u65f6\u95f4\u53ef\u4ee5\u5904\u7406\u7684\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u6570\u91cf\u3002\u4e00\u65e6\u8d85\u8fc7\u6b64\u9650\u5236\uff0cAPI \u670d\u52a1\u5668\u5c06\u5f00\u59cb\u62d2\u7edd\u8bf7\u6c42\uff0c\u5e76\u5411\u5ba2\u6237\u7aef\u8fd4\u56de 429 HTTP \u54cd\u5e94\u4ee3\u7801\"Too Many Requests\"\u3002\u670d\u52a1\u5668\u4e22\u5f03\u8bf7\u6c42\u5e76\u8ba9\u5ba2\u6237\u7aef\u7a0d\u540e\u91cd\u8bd5\u6bd4\u6ca1\u6709\u670d\u52a1\u5668\u7aef\u9650\u5236\u8bf7\u6c42\u6570\u91cf\u7684\u9650\u5236\u5e76\u8fc7\u8f7d\u63a7\u5236\u5e73\u9762(\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u6216\u4e0d\u53ef\u7528)\u8981\u597d\u3002</p> <p>Kubernetes \u7528\u4e8e\u914d\u7f6e\u5982\u4f55\u5728\u4e0d\u540c\u8bf7\u6c42\u7c7b\u578b\u4e4b\u95f4\u5212\u5206\u8fd9\u4e9b\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u7684\u673a\u5236\u79f0\u4e3a API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027\u3002API \u670d\u52a1\u5668\u901a\u8fc7\u5c06 <code>--max-requests-inflight</code> \u548c <code>--max-mutating-requests-inflight</code> \u6807\u5fd7\u7684\u503c\u76f8\u52a0\u6765\u914d\u7f6e\u5b83\u53ef\u4ee5\u63a5\u53d7\u7684\u603b\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u6570\u3002EKS \u4f7f\u7528\u8fd9\u4e9b\u6807\u5fd7\u7684\u9ed8\u8ba4\u503c 400 \u548c 200 \u4e2a\u8bf7\u6c42\uff0c\u5141\u8bb8\u4e00\u6b21\u5206\u6d3e\u603b\u5171 600 \u4e2a\u8bf7\u6c42\u3002\u4f46\u662f\uff0c\u968f\u7740\u5b83\u54cd\u5e94\u5229\u7528\u7387\u548c\u5de5\u4f5c\u8d1f\u8f7d\u53d8\u5316\u7684\u589e\u52a0\u800c\u6269\u5c55\u63a7\u5236\u5e73\u9762\uff0c\u5b83\u4e5f\u76f8\u5e94\u5730\u5c06\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u914d\u989d\u589e\u52a0\u5230 2000(\u53ef\u80fd\u4f1a\u66f4\u6539)\u3002APF \u6307\u5b9a\u5982\u4f55\u8fdb\u4e00\u6b65\u5728\u4e0d\u540c\u8bf7\u6c42\u7c7b\u578b\u4e4b\u95f4\u7ec6\u5206\u8fd9\u4e2a\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u914d\u989d\u3002\u8bf7\u6ce8\u610f\uff0cEKS \u63a7\u5236\u5e73\u9762\u662f\u9ad8\u53ef\u7528\u7684\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u81f3\u5c11\u6ce8\u518c\u4e86 2 \u4e2a API \u670d\u52a1\u5668\u3002\u8fd9\u610f\u5473\u7740\u60a8\u7684\u96c6\u7fa4\u53ef\u4ee5\u5904\u7406\u7684\u603b\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u6570\u662f\u6bcf\u4e2a kube-apiserver \u8bbe\u7f6e\u7684\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u914d\u989d\u7684\u4e24\u500d\u6216\u66f4\u9ad8(\u5982\u679c\u8fdb\u4e00\u6b65\u6c34\u5e73\u6269\u5c55)\u3002\u8fd9\u76f8\u5f53\u4e8e\u6700\u5927\u7684 EKS \u96c6\u7fa4\u6bcf\u79d2\u53ef\u5904\u7406\u6570\u5343\u4e2a\u8bf7\u6c42\u3002</p> <p>\u4e24\u79cd Kubernetes \u5bf9\u8c61\uff0c\u79f0\u4e3a PriorityLevelConfigurations \u548c FlowSchemas\uff0c\u914d\u7f6e\u4e86\u5982\u4f55\u5728\u4e0d\u540c\u8bf7\u6c42\u7c7b\u578b\u4e4b\u95f4\u5212\u5206\u603b\u8bf7\u6c42\u6570\u3002\u8fd9\u4e9b\u5bf9\u8c61\u7531 API \u670d\u52a1\u5668\u81ea\u52a8\u7ef4\u62a4\uff0cEKS \u4f7f\u7528\u7ed9\u5b9a Kubernetes \u6b21\u8981\u7248\u672c\u7684\u9ed8\u8ba4\u914d\u7f6e\u3002PriorityLevelConfigurations \u8868\u793a\u5141\u8bb8\u8bf7\u6c42\u603b\u6570\u7684\u4e00\u90e8\u5206\u3002\u4f8b\u5982\uff0cworkload-high PriorityLevelConfiguration \u88ab\u5206\u914d\u4e86\u603b\u5171 600 \u4e2a\u8bf7\u6c42\u4e2d\u7684 98 \u4e2a\u3002\u5206\u914d\u7ed9\u6240\u6709 PriorityLevelConfigurations \u7684\u8bf7\u6c42\u603b\u548c\u5c06\u7b49\u4e8e 600(\u6216\u7565\u9ad8\u4e8e 600\uff0c\u56e0\u4e3a\u5982\u679c\u7ed9\u5b9a\u7ea7\u522b\u88ab\u6388\u4e88\u4e00\u4e2a\u8bf7\u6c42\u7684\u4e00\u5c0f\u90e8\u5206\uff0cAPI \u670d\u52a1\u5668\u5c06\u5411\u4e0a\u820d\u5165)\u3002\u8981\u68c0\u67e5\u96c6\u7fa4\u4e2d\u7684 PriorityLevelConfigurations \u4ee5\u53ca\u5206\u914d\u7ed9\u6bcf\u4e2a\u914d\u7f6e\u7684\u8bf7\u6c42\u6570\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\u8fd9\u662f EKS 1.24 \u4e0a\u7684\u9ed8\u8ba4\u503c\uff1a</p> <pre><code>$ kubectl get --raw /metrics | grep apiserver_flowcontrol_request_concurrency_limit\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"catch-all\"} 13\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"global-default\"} 49\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"leader-election\"} 25\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"node-high\"} 98\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"system\"} 74\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-high\"} 98\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-low\"} 245\n</code></pre> <p>\u7b2c\u4e8c\u79cd\u5bf9\u8c61\u7c7b\u578b\u662f FlowSchemas\u3002\u5177\u6709\u7ed9\u5b9a\u4e00\u7ec4\u5c5e\u6027\u7684 API \u670d\u52a1\u5668\u8bf7\u6c42\u5c06\u88ab\u5f52\u7c7b\u4e3a\u540c\u4e00 FlowSchema\u3002\u8fd9\u4e9b\u5c5e\u6027\u5305\u62ec\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u6216\u8bf7\u6c42\u7684\u5c5e\u6027\uff0c\u4f8b\u5982 API \u7ec4\u3001\u547d\u540d\u7a7a\u95f4\u6216\u8d44\u6e90\u3002FlowSchema \u8fd8\u6307\u5b9a\u6b64\u7c7b\u8bf7\u6c42\u5e94\u6620\u5c04\u5230\u54ea\u4e2a PriorityLevelConfiguration\u3002\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u4e00\u8d77\u8bf4\u660e\uff0c\"\u6211\u5e0c\u671b\u8fd9\u79cd\u7c7b\u578b\u7684\u8bf7\u6c42\u8ba1\u5165\u8fd9\u90e8\u5206\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u3002\"\u5f53\u8bf7\u6c42\u5230\u8fbe API \u670d\u52a1\u5668\u65f6\uff0c\u5b83\u5c06\u68c0\u67e5\u6bcf\u4e2a FlowSchema\uff0c\u76f4\u5230\u627e\u5230\u4e00\u4e2a\u4e0e\u6240\u6709\u6240\u9700\u5c5e\u6027\u5339\u914d\u7684 FlowSchema\u3002\u5982\u679c\u591a\u4e2a FlowSchemas \u5339\u914d\u4e00\u4e2a\u8bf7\u6c42\uff0cAPI \u670d\u52a1\u5668\u5c06\u9009\u62e9\u5177\u6709\u6700\u5c0f\u5339\u914d\u4f18\u5148\u7ea7\u7684 FlowSchema\uff0c\u8be5\u4f18\u5148\u7ea7\u5728\u5bf9\u8c61\u4e2d\u6307\u5b9a\u4e3a\u5c5e\u6027\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b FlowSchemas \u5230 PriorityLevelConfigurations \u7684\u6620\u5c04\uff1a</p> <pre><code>$ kubectl get flowschemas\nNAME                           PRIORITYLEVEL     MATCHINGPRECEDENCE   DISTINGUIS HERMETHOD   AGE     MISSINGPL\nexempt                         exempt            1                    &lt;none&gt;                7h19m   False\neks-exempt                     exempt            2                    &lt;none&gt;                7h19m   False\nprobes                         exempt            2                    &lt;none&gt;                7h19m   False\nsystem-leader-election         leader-election   100                  ByUser                7h19m   False\nendpoint-controller            workload-high     150                  ByUser                7h19m   False\nworkload-leader-election       leader-election   200                  ByUser                7h19m   False\nsystem-node-high               node-high         400                  ByUser                7h19m   False\nsystem-nodes                   system            500                  ByUser                7h19m   False\nkube-controller-manager        workload-high     800                  ByNamespace           7h19m   False\nkube-scheduler                 workload-high     800                  ByNamespace           7h19m   False\nkube-system-service-accounts   workload-high     900                  ByNamespace           7h19m   False\neks-workload-high              workload-high     1000                 ByUser                7h14m   False\nservice-accounts               workload-low      9000                 ByUser                7h19m   False\nglobal-default                 global-default    9900                 ByUser                7h19m   False\ncatch-all                      catch-all         10000                ByUser                7h19m   False\n</code></pre> <p>PriorityLevelConfigurations \u53ef\u4ee5\u662f Queue\u3001Reject \u6216 Exempt \u7c7b\u578b\u3002\u5bf9\u4e8e Queue \u548c Reject \u7c7b\u578b\uff0c\u5c06\u5bf9\u8be5\u4f18\u5148\u7ea7\u7ea7\u522b\u7684\u6700\u5927\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u6570\u65bd\u52a0\u9650\u5236\uff0c\u4f46\u662f\u5f53\u8fbe\u5230\u8be5\u9650\u5236\u65f6\uff0c\u884c\u4e3a\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u4f8b\u5982\uff0cworkload-high PriorityLevelConfiguration \u4f7f\u7528 Queue \u7c7b\u578b\uff0c\u5e76\u4e3a\u63a7\u5236\u5668\u7ba1\u7406\u5668\u3001\u7aef\u70b9\u63a7\u5236\u5668\u3001\u8c03\u5ea6\u5668\u3001eks \u76f8\u5173\u63a7\u5236\u5668\u548c\u5728 kube-system \u547d\u540d\u7a7a\u95f4\u4e2d\u8fd0\u884c\u7684 pod \u63d0\u4f9b 98 \u4e2a\u53ef\u7528\u8bf7\u6c42\u3002\u7531\u4e8e\u4f7f\u7528\u4e86 Queue \u7c7b\u578b\uff0cAPI \u670d\u52a1\u5668\u5c06\u5c1d\u8bd5\u5728\u5185\u5b58\u4e2d\u4fdd\u7559\u8bf7\u6c42\uff0c\u5e76\u5e0c\u671b\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u6570\u5728\u8fd9\u4e9b\u8bf7\u6c42\u8d85\u65f6\u4e4b\u524d\u4f4e\u4e8e 98\u3002\u5982\u679c\u7ed9\u5b9a\u8bf7\u6c42\u5728\u961f\u5217\u4e2d\u8d85\u65f6\u6216\u8005\u5982\u679c\u5df2\u7ecf\u6392\u961f\u4e86\u592a\u591a\u8bf7\u6c42\uff0cAPI \u670d\u52a1\u5668\u522b\u65e0\u9009\u62e9\uff0c\u53ea\u80fd\u4e22\u5f03\u8be5\u8bf7\u6c42\u5e76\u5411\u5ba2\u6237\u7aef\u8fd4\u56de 429\u3002\u8bf7\u6ce8\u610f\uff0c\u6392\u961f\u53ef\u80fd\u4f1a\u963b\u6b62\u8bf7\u6c42\u6536\u5230 429\uff0c\u4f46\u4ee3\u4ef7\u662f\u8bf7\u6c42\u7684\u7aef\u5230\u7aef\u5ef6\u8fdf\u589e\u52a0\u3002</p> <p>\u73b0\u5728\u8003\u8651\u6620\u5c04\u5230 Reject \u7c7b\u578b\u7684 catch-all PriorityLevelConfiguration \u7684 catch-all FlowSchema\u3002\u5982\u679c\u5ba2\u6237\u7aef\u8fbe\u5230 13 \u4e2a\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u7684\u9650\u5236\uff0cAPI \u670d\u52a1\u5668\u5c06\u4e0d\u4f1a\u8fdb\u884c\u6392\u961f\uff0c\u800c\u662f\u7acb\u5373\u4e22\u5f03\u8bf7\u6c42\u5e76\u8fd4\u56de 429 \u54cd\u5e94\u4ee3\u7801\u3002\u6700\u540e\uff0c\u6620\u5c04\u5230 Exempt \u7c7b\u578b\u7684 PriorityLevelConfiguration \u7684\u8bf7\u6c42\u5c06\u6c38\u8fdc\u4e0d\u4f1a\u6536\u5230 429\uff0c\u5e76\u5c06\u7acb\u5373\u5206\u6d3e\u3002\u8fd9\u7528\u4e8e\u9ad8\u4f18\u5148\u7ea7\u8bf7\u6c42\uff0c\u5982 healthz \u8bf7\u6c42\u6216\u6765\u81ea system\uff1amasters \u7ec4\u7684\u8bf7\u6c42\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#apf","title":"\u76d1\u63a7 APF \u548c\u4e22\u5f03\u7684\u8bf7\u6c42","text":"<p>\u8981\u786e\u8ba4\u662f\u5426\u6709\u4efb\u4f55\u8bf7\u6c42\u7531\u4e8e APF \u800c\u88ab\u4e22\u5f03\uff0c\u53ef\u4ee5\u76d1\u63a7 API \u670d\u52a1\u5668\u6307\u6807 <code>apiserver_flowcontrol_rejected_requests_total</code> \u4ee5\u68c0\u67e5\u53d7\u5f71\u54cd\u7684 FlowSchemas \u548c PriorityLevelConfigurations\u3002\u4f8b\u5982\uff0c\u6b64\u6307\u6807\u663e\u793a\u7531\u4e8e\u8bf7\u6c42\u5728 workload-low \u961f\u5217\u4e2d\u8d85\u65f6\uff0c\u6765\u81ea service-accounts FlowSchema \u7684 100 \u4e2a\u8bf7\u6c42\u88ab\u4e22\u5f03\uff1a</p> <pre><code>% kubectl get --raw /metrics | grep apiserver_flowcontrol_rejected_requests_total\napiserver_flowcontrol_rejected_requests_total{flow_schema=\"service-accounts\",priority_level=\"workload-low\",reason=\"time-out\"} 100\n</code></pre> <p>\u8981\u68c0\u67e5\u7ed9\u5b9a PriorityLevelConfiguration \u79bb\u63a5\u6536 429 \u6216\u7531\u4e8e\u6392\u961f\u800c\u5bfc\u81f4\u5ef6\u8fdf\u589e\u52a0\u6709\u591a\u8fd1\uff0c\u60a8\u53ef\u4ee5\u6bd4\u8f83\u5e76\u53d1\u9650\u5236\u548c\u5e76\u53d1\u4f7f\u7528\u91cf\u4e4b\u95f4\u7684\u5dee\u5f02\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u6709 100 \u4e2a\u8bf7\u6c42\u7684\u7f13\u51b2\u533a\u3002</p> <pre><code>% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_request_concurrency_limit.*workload-low'\napiserver_flowcontrol_request_concurrency_limit{priority_level=\"workload-low\"} 245\n\n% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_request_concurrency_in_use.*workload-low'\napiserver_flowcontrol_request_concurrency_in_use{flow_schema=\"service-accounts\",priority_level=\"workload-low\"} 145\n</code></pre> <p>\u8981\u68c0\u67e5\u7ed9\u5b9a PriorityLevelConfiguration \u662f\u5426\u6b63\u5728\u6392\u961f\u4f46\u5c1a\u672a\u4e22\u5f03\u8bf7\u6c42\uff0c\u53ef\u4ee5\u53c2\u8003\u6307\u6807 <code>apiserver_flowcontrol_current_inqueue_requests</code>:</p> <pre><code>% kubectl get --raw /metrics | grep 'apiserver_flowcontrol_current_inqueue_requests.*workload-low'\napiserver_flowcontrol_current_inqueue_requests{flow_schema=\"service-accounts\",priority_level=\"workload-low\"} 10\n</code></pre> <p>\u5176\u4ed6\u6709\u7528\u7684 Prometheus \u6307\u6807\u5305\u62ec\uff1a</p> <ul> <li>apiserver_flowcontrol_dispatched_requests_total</li> <li>apiserver_flowcontrol_request_execution_seconds</li> <li>apiserver_flowcontrol_request_wait_duration_seconds</li> </ul> <p>\u6709\u5173\u5b8c\u6574\u7684 APF \u6307\u6807\u5217\u8868\uff0c\u8bf7\u53c2\u9605\u4e0a\u6e38\u6587\u6863\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#_6","title":"\u9632\u6b62\u8bf7\u6c42\u88ab\u4e22\u5f03","text":""},{"location":"zh/scalability/docs/control-plane/#429","title":"\u901a\u8fc7\u66f4\u6539\u5de5\u4f5c\u8d1f\u8f7d\u6765\u9632\u6b62 429","text":"<p>\u5f53 APF \u7531\u4e8e\u7ed9\u5b9a PriorityLevelConfiguration \u8d85\u8fc7\u5176\u5141\u8bb8\u7684\u6700\u5927\u6b63\u5728\u8fdb\u884c\u8bf7\u6c42\u6570\u800c\u4e22\u5f03\u8bf7\u6c42\u65f6\uff0c\u53d7\u5f71\u54cd FlowSchemas \u4e2d\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u51cf\u5c11\u7ed9\u5b9a\u65f6\u95f4\u5185\u6b63\u5728\u6267\u884c\u7684\u8bf7\u6c42\u6570\u91cf\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u51cf\u5c11\u5728\u51fa\u73b0 429 \u671f\u95f4\u53d1\u51fa\u7684\u603b\u8bf7\u6c42\u6570\u91cf\u6765\u5b9e\u73b0\u3002\u8bf7\u6ce8\u610f\uff0c\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u8bf7\u6c42(\u5982\u6602\u8d35\u7684\u5217\u8868\u8c03\u7528)\u7279\u522b\u6210\u95ee\u9898\uff0c\u56e0\u4e3a\u5b83\u4eec\u5728\u6574\u4e2a\u6267\u884c\u671f\u95f4\u90fd\u88ab\u89c6\u4e3a\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u3002\u51cf\u5c11\u8fd9\u4e9b\u6602\u8d35\u8bf7\u6c42\u7684\u6570\u91cf\u6216\u4f18\u5316\u8fd9\u4e9b\u5217\u8868\u8c03\u7528\u7684\u5ef6\u8fdf(\u4f8b\u5982\uff0c\u901a\u8fc7\u51cf\u5c11\u6bcf\u4e2a\u8bf7\u6c42\u83b7\u53d6\u7684\u5bf9\u8c61\u6570\u91cf\u6216\u5207\u6362\u5230\u4f7f\u7528 watch \u8bf7\u6c42)\u53ef\u4ee5\u5e2e\u52a9\u51cf\u5c11\u7ed9\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u6240\u9700\u7684\u603b\u5e76\u53d1\u91cf\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#apf-429","title":"\u901a\u8fc7\u66f4\u6539 APF \u8bbe\u7f6e\u6765\u9632\u6b62 429","text":"<p>\u8b66\u544a</p> <p>\u53ea\u6709\u5728\u60a8\u786e\u5207\u77e5\u9053\u81ea\u5df1\u5728\u505a\u4ec0\u4e48\u7684\u60c5\u51b5\u4e0b\u624d\u80fd\u66f4\u6539\u9ed8\u8ba4\u7684 APF \u8bbe\u7f6e\u3002\u9519\u8bef\u914d\u7f6e\u7684 APF \u8bbe\u7f6e\u53ef\u80fd\u4f1a\u5bfc\u81f4 API \u670d\u52a1\u5668\u8bf7\u6c42\u88ab\u4e22\u5f03\u548c\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u65ad\u4e25\u91cd\u3002</p> <p>\u9632\u6b62\u8bf7\u6c42\u88ab\u4e22\u5f03\u7684\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u66f4\u6539 EKS \u96c6\u7fa4\u4e0a\u5b89\u88c5\u7684\u9ed8\u8ba4 FlowSchemas \u6216 PriorityLevelConfigurations\u3002EKS \u4e3a\u7ed9\u5b9a Kubernetes \u6b21\u8981\u7248\u672c\u5b89\u88c5\u4e0a\u6e38\u9ed8\u8ba4\u7684 FlowSchemas \u548c PriorityLevelConfigurations \u8bbe\u7f6e\u3002\u9664\u975e\u5728\u5bf9\u8c61\u4e0a\u8bbe\u7f6e\u4e86\u4ee5\u4e0b\u6ce8\u91ca\u4e3a false\uff0c\u5426\u5219 API \u670d\u52a1\u5668\u5c06\u81ea\u52a8\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u4e0e\u5176\u9ed8\u8ba4\u503c\u534f\u8c03\u4e00\u81f4\uff1a</p> <pre><code>  metadata:\n    annotations:\n      apf.kubernetes.io/autoupdate-spec: \"false\"\n</code></pre> <p>\u603b\u7684\u6765\u8bf4\uff0cAPF \u8bbe\u7f6e\u53ef\u4ee5\u4fee\u6539\u4e3a\uff1a</p> <ul> <li>\u4e3a\u60a8\u5173\u5fc3\u7684\u8bf7\u6c42\u5206\u914d\u66f4\u591a\u6b63\u5728\u8fdb\u884c\u7684\u5bb9\u91cf\u3002</li> <li>\u9694\u79bb\u975e\u5fc5\u9700\u6216\u6602\u8d35\u7684\u8bf7\u6c42\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u53ef\u80fd\u4f1a\u8017\u5c3d\u5176\u4ed6\u8bf7\u6c42\u7c7b\u578b\u7684\u5bb9\u91cf\u3002</li> </ul> <p>\u8fd9\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u9ed8\u8ba4\u7684 FlowSchemas \u548c PriorityLevelConfigurations \u6216\u521b\u5efa\u8fd9\u4e9b\u7c7b\u578b\u7684\u65b0\u5bf9\u8c61\u6765\u5b9e\u73b0\u3002\u64cd\u4f5c\u5458\u53ef\u4ee5\u589e\u52a0\u76f8\u5173 PriorityLevelConfigurations \u5bf9\u8c61\u7684 assuredConcurrencyShares \u503c\uff0c\u4ee5\u589e\u52a0\u5206\u914d\u7ed9\u5b83\u4eec\u7684\u6b63\u5728\u8fdb\u884c\u8bf7\u6c42\u7684\u6bd4\u4f8b\u3002\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u589e\u52a0\u4e00\u6b21\u53ef\u4ee5\u6392\u961f\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5904\u7406\u7531\u8bf7\u6c42\u6392\u961f\u800c\u5bfc\u81f4\u7684\u989d\u5916\u5ef6\u8fdf\u3002</p> <p>\u6216\u8005\uff0c\u53ef\u4ee5\u521b\u5efa\u7279\u5b9a\u4e8e\u5ba2\u6237\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u65b0 FlowSchema \u548c PriorityLevelConfigurations \u5bf9\u8c61\u3002\u8bf7\u6ce8\u610f\uff0c\u65e0\u8bba\u662f\u4e3a\u73b0\u6709 PriorityLevelConfigurations \u8fd8\u662f\u4e3a\u65b0 PriorityLevelConfigurations \u5206\u914d\u66f4\u591a assuredConcurrencyShares\uff0c\u90fd\u4f1a\u5bfc\u81f4\u5176\u4ed6\u5b58\u50a8\u6876\u53ef\u4ee5\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\u51cf\u5c11\uff0c\u56e0\u4e3a\u603b\u4f53\u9650\u5236\u5c06\u4fdd\u6301\u5728\u6bcf\u4e2a API \u670d\u52a1\u5668 600 \u4e2a\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u3002</p> <p>\u5728\u5bf9 APF \u9ed8\u8ba4\u503c\u8fdb\u884c\u66f4\u6539\u65f6\uff0c\u5e94\u5728\u975e\u751f\u4ea7\u96c6\u7fa4\u4e0a\u76d1\u63a7\u8fd9\u4e9b\u6307\u6807\uff0c\u4ee5\u786e\u4fdd\u66f4\u6539\u8bbe\u7f6e\u4e0d\u4f1a\u5bfc\u81f4\u610f\u5916\u7684 429\uff1a</p> <ol> <li>\u5e94\u76d1\u63a7\u6240\u6709 FlowSchemas \u7684 <code>apiserver_flowcontrol_rejected_requests_total</code> \u6307\u6807\uff0c\u4ee5\u786e\u4fdd\u6ca1\u6709\u5b58\u50a8\u6876\u5f00\u59cb\u4e22\u5f03\u8bf7\u6c42\u3002</li> <li>\u5e94\u6bd4\u8f83 <code>apiserver_flowcontrol_request_concurrency_limit</code> \u548c <code>apiserver_flowcontrol_request_concurrency_in_use</code> \u7684\u503c\uff0c\u4ee5\u786e\u4fdd\u6b63\u5728\u4f7f\u7528\u7684\u5e76\u53d1\u91cf\u4e0d\u4f1a\u6709\u8fdd\u53cd\u8be5\u4f18\u5148\u7ea7\u7ea7\u522b\u7684\u9650\u5236\u7684\u98ce\u9669\u3002</li> </ol> <p>\u5b9a\u4e49\u65b0 FlowSchema \u548c PriorityLevelConfiguration \u7684\u4e00\u4e2a\u5e38\u89c1\u7528\u4f8b\u662f\u9694\u79bb\u3002\u5047\u8bbe\u6211\u4eec\u5e0c\u671b\u5c06\u6765\u81ea pod \u7684\u957f\u65f6\u95f4\u8fd0\u884c\u5217\u8868\u4e8b\u4ef6\u8c03\u7528\u4e0e\u5176\u4ed6\u8bf7\u6c42\u9694\u79bb\u5230\u5b83\u4eec\u81ea\u5df1\u7684\u8bf7\u6c42\u4efd\u989d\u4e2d\u3002\u8fd9\u5c06\u9632\u6b62\u4f7f\u7528\u73b0\u6709 service-accounts FlowSchema \u7684 pod \u4e2d\u7684\u91cd\u8981\u8bf7\u6c42\u6536\u5230 429 \u5e76\u88ab\u5265\u593a\u8bf7\u6c42\u5bb9\u91cf\u3002\u8bf7\u56de\u60f3\u4e00\u4e0b\uff0c\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u603b\u6570\u662f\u6709\u9650\u7684\uff0c\u4f46\u662f\u6b64\u793a\u4f8b\u663e\u793a APF \u8bbe\u7f6e\u53ef\u4ee5\u4fee\u6539\u4e3a\u66f4\u597d\u5730\u5212\u5206\u7ed9\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8bf7\u6c42\u5bb9\u91cf\uff1a</p> <p>\u9694\u79bb\u5217\u8868\u4e8b\u4ef6\u8bf7\u6c42\u7684\u793a\u4f8b FlowSchema \u5bf9\u8c61\uff1a</p> <pre><code>apiVersion: flowcontrol.apiserver.k8s.io/v1beta1\nkind: FlowSchema\nmetadata:\n  name: list-events-default-service-accounts\nspec:\n  distinguisherMethod:\n    type: ByUser\n  matchingPrecedence: 8000\n  priorityLevelConfiguration:\n    name: catch-all\n  rules:\n  - resourceRules:\n    - apiGroups:\n      - '*'\n      namespaces:\n      - default\n      resources:\n      - events\n      verbs:\n      - list\n    subjects:\n    - kind: ServiceAccount\n      serviceAccount:\n        name: default\n        namespace: default\n</code></pre> <ul> <li>\u6b64 FlowSchema \u6355\u83b7\u6765\u81ea\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4\u4e2d\u670d\u52a1\u5e10\u6237\u7684\u6240\u6709\u5217\u8868\u4e8b\u4ef6\u8c03\u7528\u3002</li> <li>\u5339\u914d\u4f18\u5148\u7ea7 8000 \u4f4e\u4e8e\u73b0\u6709 service-accounts FlowSchema \u4f7f\u7528\u7684 9000 \u503c\uff0c\u56e0\u6b64\u8fd9\u4e9b\u5217\u8868\u4e8b\u4ef6\u8c03\u7528\u5c06\u5339\u914d list-events-default-service-accounts \u800c\u4e0d\u662f service-accounts\u3002</li> <li>\u6211\u4eec\u4f7f\u7528 catch-all PriorityLevelConfiguration \u6765\u9694\u79bb\u8fd9\u4e9b\u8bf7\u6c42\u3002\u8fd9\u4e2a\u5b58\u50a8\u6876\u53ea\u5141\u8bb8\u8fd9\u4e9b\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u5217\u8868\u4e8b\u4ef6\u8c03\u7528\u4f7f\u7528 13 \u4e2a\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u3002\u4e00\u65e6 pod \u5c1d\u8bd5\u540c\u65f6\u53d1\u51fa\u8d85\u8fc7 13 \u4e2a\u6b64\u7c7b\u8bf7\u6c42\uff0c\u5b83\u4eec\u5c31\u4f1a\u5f00\u59cb\u6536\u5230 429\u3002</li> </ul>"},{"location":"zh/scalability/docs/control-plane/#api_1","title":"\u4ece API \u670d\u52a1\u5668\u68c0\u7d22\u8d44\u6e90","text":"<p>\u4ece API \u670d\u52a1\u5668\u83b7\u53d6\u4fe1\u606f\u662f\u4efb\u4f55\u89c4\u6a21\u96c6\u7fa4\u7684\u9884\u671f\u884c\u4e3a\u3002\u968f\u7740\u96c6\u7fa4\u4e2d\u8d44\u6e90\u6570\u91cf\u7684\u589e\u52a0\uff0c\u8bf7\u6c42\u9891\u7387\u548c\u6570\u636e\u91cf\u53ef\u80fd\u5f88\u5feb\u4f1a\u6210\u4e3a\u63a7\u5236\u5e73\u9762\u7684\u74f6\u9888\uff0c\u5e76\u5c06\u5bfc\u81f4 API \u5ef6\u8fdf\u548c\u7f13\u6162\u3002\u6839\u636e\u5ef6\u8fdf\u7684\u4e25\u91cd\u7a0b\u5ea6\uff0c\u5982\u679c\u4e0d\u5c0f\u5fc3\u7684\u8bdd\uff0c\u5b83\u53ef\u80fd\u4f1a\u5bfc\u81f4\u610f\u5916\u7684\u505c\u673a\u3002</p> <p>\u4e86\u89e3\u60a8\u6b63\u5728\u8bf7\u6c42\u4ec0\u4e48\u4ee5\u53ca\u8bf7\u6c42\u7684\u9891\u7387\u662f\u907f\u514d\u6b64\u7c7b\u95ee\u9898\u7684\u7b2c\u4e00\u6b65\u3002\u6839\u636e\u6269\u5c55\u6700\u4f73\u5b9e\u8df5\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e86\u9650\u5236\u67e5\u8be2\u91cf\u7684\u6307\u5bfc\u3002\u672c\u8282\u4e2d\u7684\u5efa\u8bae\u6309\u7167\u5df2\u77e5\u7684\u6700\u4f73\u6269\u5c55\u987a\u5e8f\u63d0\u4f9b\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#_7","title":"\u4f7f\u7528\u5171\u4eab\u4fe1\u606f\u5668","text":"<p>\u5728\u6784\u5efa\u4e0e Kubernetes API \u96c6\u6210\u7684\u63a7\u5236\u5668\u548c\u81ea\u52a8\u5316\u65f6\uff0c\u60a8\u901a\u5e38\u9700\u8981\u4ece Kubernetes \u8d44\u6e90\u83b7\u53d6\u4fe1\u606f\u3002\u5982\u679c\u60a8\u5b9a\u671f\u8f6e\u8be2\u8fd9\u4e9b\u8d44\u6e90\uff0c\u53ef\u80fd\u4f1a\u7ed9 API \u670d\u52a1\u5668\u5e26\u6765\u5927\u91cf\u8d1f\u8f7d\u3002</p> <p>\u4f7f\u7528 client-go \u5e93\u4e2d\u7684 informer \u5c06\u4f7f\u60a8\u80fd\u591f\u6839\u636e\u4e8b\u4ef6\u800c\u4e0d\u662f\u8f6e\u8be2\u6765\u76d1\u89c6\u8d44\u6e90\u7684\u53d8\u5316\u3002\u4fe1\u606f\u5668\u901a\u8fc7\u4e3a\u4e8b\u4ef6\u548c\u66f4\u6539\u4f7f\u7528\u5171\u4eab\u7f13\u5b58\u8fdb\u4e00\u6b65\u51cf\u5c11\u8d1f\u8f7d\uff0c\u56e0\u6b64\u76d1\u89c6\u76f8\u540c\u8d44\u6e90\u7684\u591a\u4e2a\u63a7\u5236\u5668\u4e0d\u4f1a\u589e\u52a0\u989d\u5916\u8d1f\u8f7d\u3002</p> <p>\u63a7\u5236\u5668\u5e94\u907f\u514d\u5728\u5927\u578b\u96c6\u7fa4\u4e2d\u8f6e\u8be2\u6ca1\u6709\u6807\u7b7e\u548c\u5b57\u6bb5\u9009\u62e9\u5668\u7684\u96c6\u7fa4\u8303\u56f4\u8d44\u6e90\u3002\u6bcf\u4e2a\u672a\u8fc7\u6ee4\u7684\u8f6e\u8be2\u90fd\u9700\u8981\u5927\u91cf\u4e0d\u5fc5\u8981\u7684\u6570\u636e\u4ece etcd \u901a\u8fc7 API \u670d\u52a1\u5668\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u8fdb\u884c\u8fc7\u6ee4\u3002\u901a\u8fc7\u57fa\u4e8e\u6807\u7b7e\u548c\u547d\u540d\u7a7a\u95f4\u8fdb\u884c\u8fc7\u6ee4\uff0c\u60a8\u53ef\u4ee5\u51cf\u5c11 API \u670d\u52a1\u5668\u9700\u8981\u6267\u884c\u4ee5\u6ee1\u8db3\u8bf7\u6c42\u7684\u5de5\u4f5c\u91cf\u4ee5\u53ca\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u6570\u636e\u91cf\u3002</p>"},{"location":"zh/scalability/docs/control-plane/#kubernetes-api","title":"\u4f18\u5316 Kubernetes API \u4f7f\u7528","text":"<p>\u5728\u4f7f\u7528\u81ea\u5b9a\u4e49\u63a7\u5236\u5668\u6216\u81ea\u52a8\u5316\u8c03\u7528 Kubernetes API \u65f6\uff0c\u91cd\u8981\u7684\u662f\u60a8\u53ea\u9650\u5236\u5bf9\u6240\u9700\u8d44\u6e90\u7684\u8c03\u7528\u3002\u5982\u679c\u6ca1\u6709\u9650\u5236\uff0c\u60a8\u53ef\u80fd\u4f1a\u7ed9 API \u670d\u52a1\u5668\u548c etcd \u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u8d1f\u8f7d\u3002</p> <p>\u5efa\u8bae\u60a8\u5c3d\u53ef\u80fd\u4f7f\u7528 watch \u53c2\u6570\u3002\u5982\u679c\u4e0d\u4f7f\u7528\u4efb\u4f55\u53c2\u6570\uff0c\u9ed8\u8ba4\u884c\u4e3a\u662f\u5217\u51fa\u5bf9\u8c61\u3002\u8981\u4f7f\u7528 watch \u800c\u4e0d\u662f list\uff0c\u60a8\u53ef\u4ee5\u5728 API \u8bf7\u6c42\u7684\u672b\u5c3e\u9644\u52a0 <code>?watch=true</code>\u3002\u4f8b\u5982\uff0c\u8981\u4f7f\u7528 watch \u83b7\u53d6\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709 pod\uff0c\u8bf7\u4f7f\u7528\uff1a</p> <pre><code>/api/v1/namespaces/default/pods?watch=true\n</code></pre> <p>\u5982\u679c\u60a8\u6b63\u5728\u5217\u51fa\u5bf9\u8c61\uff0c\u60a8\u5e94\u8be5\u9650\u5236\u5217\u51fa\u8303\u56f4\u548c\u8fd4\u56de\u7684\u6570\u636e\u91cf\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u8bf7\u6c42\u4e2d\u6dfb\u52a0 <code>limit=500</code> \u53c2\u6570\u6765\u9650\u5236\u8fd4\u56de\u7684\u6570\u636e\u3002<code>fieldSelector</code> \u53c2\u6570\u548c <code>/namespace/</code> \u8def\u5f84\u53ef\u7528\u4e8e\u786e\u4fdd\u60a8\u7684\u5217\u8868\u8303\u56f4\u5c3d\u53ef\u80fd\u5c0f\u3002\u4f8b\u5982\uff0c\u8981\u4ec5\u5217\u51fa\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4\u4e2d\u6b63\u5728\u8fd0\u884c\u7684 pod\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b API \u8def\u5f84\u548c\u53c2\u6570\u3002</p> <pre><code>/api/v1/namespaces/default/pods?fieldSelector=status.phase=Running&amp;limit=500\n</code></pre> <p>\u6216\u5217\u51fa\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684 pod\uff1a</p> <pre><code>/api/v1/pods?fieldSelector=status.phase=Running&amp;limit=500\n</code></pre> <p>\u9650\u5236 watch \u8c03\u7528\u6216\u5217\u51fa\u5bf9\u8c61\u7684\u53e6\u4e00\u4e2a\u9009\u9879\u662f\u4f7f\u7528 <code>resourceVersions</code>,\u60a8\u53ef\u4ee5\u5728 Kubernetes \u6587\u6863\u4e2d\u9605\u8bfb\u76f8\u5173\u5185\u5bb9\u3002\u5982\u679c\u4e0d\u4f7f\u7528 <code>resourceVersion</code> \u53c2\u6570\uff0c\u60a8\u5c06\u6536\u5230\u6700\u65b0\u53ef\u7528\u7684\u7248\u672c\uff0c\u8fd9\u9700\u8981 etcd \u4ef2\u88c1\u8bfb\u53d6\uff0c\u8fd9\u662f\u6570\u636e\u5e93\u4e2d\u6700\u6602\u8d35\u548c\u6700\u6162\u7684\u8bfb\u53d6\u3002resourceVersion \u53d6\u51b3\u4e8e\u60a8\u5c1d\u8bd5\u67e5\u8be2\u7684\u8d44\u6e90\uff0c\u53ef\u4ee5\u5728 <code>metadata.resourseVersion</code> \u5b57\u6bb5\u4e2d\u627e\u5230\u3002\u5982\u679c\u4e0d\u4ec5\u4f7f\u7528\u5217\u8868\u8c03\u7528\uff0c\u8fd8\u4f7f\u7528 watch \u8c03\u7528\uff0c\u4e5f\u5efa\u8bae\u8fd9\u6837\u505a</p> <p>\u6709\u4e00\u4e2a\u7279\u6b8a\u7684 <code>resourceVersion=0</code> \u53ef\u7528\uff0c\u5b83\u5c06\u4ece API \u670d\u52a1\u5668\u7f13\u5b58\u8fd4\u56de\u7ed3\u679c\u3002\u8fd9\u53ef\u4ee5\u51cf\u5c11 etcd \u8d1f\u8f7d\uff0c\u4f46\u4e0d\u652f\u6301\u5206\u9875\u3002</p> <p><pre><code>/api/v1/namespaces/default/pods?resourceVersion=0\n</code></pre> \u5efa\u8bae\u4f7f\u7528 watch \u548c\u8bbe\u7f6e\u4e3a\u4ece\u524d\u4e00\u4e2a\u5217\u8868\u6216 watch \u63a5\u6536\u7684\u6700\u65b0\u5df2\u77e5\u503c\u7684 resourceVersion\u3002\u8fd9\u5728 client-go \u4e2d\u662f\u81ea\u52a8\u5904\u7406\u7684\u3002\u4f46\u5982\u679c\u60a8\u4f7f\u7528\u5176\u4ed6\u8bed\u8a00\u7684 k8s \u5ba2\u6237\u7aef\uff0c\u5efa\u8bae\u60a8\u4ed4\u7ec6\u68c0\u67e5\u3002</p> <p><pre><code>/api/v1/namespaces/default/pods?watch=true&amp;resourceVersion=362812295\n</code></pre> \u5982\u679c\u60a8\u5728\u4e0d\u4f7f\u7528\u4efb\u4f55\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8c03\u7528 API\uff0c\u8fd9\u5c06\u5bf9 API \u670d\u52a1\u5668\u548c etcd \u9020\u6210\u6700\u5927\u7684\u8d44\u6e90\u5f71\u54cd\u3002\u6b64\u8c03\u7528\u5c06\u83b7\u53d6\u6240\u6709\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709 pod\uff0c\u800c\u4e0d\u8fdb\u884c\u5206\u9875\u6216\u9650\u5236\u8303\u56f4\uff0c\u5e76\u9700\u8981\u4ece etcd \u8fdb\u884c\u4ef2\u88c1\u8bfb\u53d6\u3002</p> <pre><code>/api/v1/pods\n</code></pre>"},{"location":"zh/scalability/docs/data-plane/","title":"Kubernetes \u6570\u636e\u5e73\u9762","text":"<p>Kubernetes \u6570\u636e\u5e73\u9762\u5305\u62ec EC2 \u5b9e\u4f8b\u3001\u8d1f\u8f7d\u5747\u8861\u5668\u3001\u5b58\u50a8\u548c\u5176\u4ed6\u7531 Kubernetes \u63a7\u5236\u5e73\u9762\u4f7f\u7528\u7684 API\u3002\u4e3a\u4e86\u7ec4\u7ec7\u76ee\u7684\uff0c\u6211\u4eec\u5c06\u96c6\u7fa4\u670d\u52a1\u5206\u7ec4\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u9875\u9762\u4e2d\uff0c\u800c\u8d1f\u8f7d\u5747\u8861\u5668\u6269\u7f29\u53ef\u4ee5\u5728\u5de5\u4f5c\u8d1f\u8f7d\u90e8\u5206\u4e2d\u627e\u5230\u3002\u672c\u8282\u5c06\u91cd\u70b9\u4ecb\u7ecd\u8ba1\u7b97\u8d44\u6e90\u7684\u6269\u7f29\u3002</p> <p>\u9009\u62e9 EC2 \u5b9e\u4f8b\u7c7b\u578b\u53ef\u80fd\u662f\u5ba2\u6237\u9762\u4e34\u7684\u6700\u56f0\u96be\u7684\u51b3\u7b56\u4e4b\u4e00\uff0c\u56e0\u4e3a\u5728\u5177\u6709\u591a\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u96c6\u7fa4\u4e2d\u6ca1\u6709\u4e00\u5200\u5207\u7684\u89e3\u51b3\u65b9\u6848\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u63d0\u793a\uff0c\u53ef\u5e2e\u52a9\u60a8\u907f\u514d\u5728\u6269\u7f29\u8ba1\u7b97\u65f6\u9047\u5230\u5e38\u89c1\u7684\u9677\u9631\u3002</p>"},{"location":"zh/scalability/docs/data-plane/#_1","title":"\u81ea\u52a8\u8282\u70b9\u81ea\u52a8\u6269\u7f29","text":"<p>\u6211\u4eec\u5efa\u8bae\u60a8\u4f7f\u7528\u8282\u70b9\u81ea\u52a8\u6269\u7f29\u529f\u80fd\uff0c\u4ee5\u51cf\u5c11\u5de5\u4f5c\u91cf\u5e76\u6df1\u5ea6\u96c6\u6210\u5230 Kubernetes \u4e2d\u3002\u6258\u7ba1\u8282\u70b9\u7ec4\u548c Karpenter \u662f\u5927\u89c4\u6a21\u96c6\u7fa4\u7684\u63a8\u8350\u9009\u62e9\u3002</p> <p>\u6258\u7ba1\u8282\u70b9\u7ec4\u5c06\u4e3a\u60a8\u63d0\u4f9b Amazon EC2 Auto Scaling \u7ec4\u7684\u7075\u6d3b\u6027\uff0c\u540c\u65f6\u8fd8\u5177\u6709\u6258\u7ba1\u5347\u7ea7\u548c\u914d\u7f6e\u7684\u989d\u5916\u4f18\u52bf\u3002\u5b83\u53ef\u4ee5\u4e0e Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u4e00\u8d77\u6269\u7f29\uff0c\u5e76\u4e14\u662f\u5177\u6709\u5404\u79cd\u8ba1\u7b97\u9700\u6c42\u7684\u96c6\u7fa4\u7684\u5e38\u89c1\u9009\u62e9\u3002</p> <p>Karpenter \u662f\u7531 AWS \u521b\u5efa\u7684\u5f00\u6e90\u3001\u9762\u5411\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8282\u70b9\u81ea\u52a8\u6269\u7f29\u5668\u3002\u5b83\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u5bf9\u8d44\u6e90\uff08\u5982 GPU\uff09\u548c\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6\uff08\u5982\u533a\u57df\u5206\u5e03\uff09\u7684\u8981\u6c42\u6765\u6269\u7f29\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\uff0c\u800c\u65e0\u9700\u7ba1\u7406\u8282\u70b9\u7ec4\u3002\u8282\u70b9\u662f\u76f4\u63a5\u4ece EC2 \u521b\u5efa\u7684\uff0c\u8fd9\u907f\u514d\u4e86\u9ed8\u8ba4\u8282\u70b9\u7ec4\u914d\u989d\uff08\u6bcf\u7ec4 450 \u4e2a\u8282\u70b9\uff09\u7684\u9650\u5236\uff0c\u5e76\u63d0\u4f9b\u4e86\u66f4\u5927\u7684\u5b9e\u4f8b\u9009\u62e9\u7075\u6d3b\u6027\u548c\u66f4\u5c11\u7684\u64cd\u4f5c\u5f00\u9500\u3002\u6211\u4eec\u5efa\u8bae\u5ba2\u6237\u5c3d\u53ef\u80fd\u4f7f\u7528 Karpenter\u3002</p>"},{"location":"zh/scalability/docs/data-plane/#ec2","title":"\u4f7f\u7528\u591a\u79cd\u4e0d\u540c\u7684 EC2 \u5b9e\u4f8b\u7c7b\u578b","text":"<p>\u6bcf\u4e2a AWS \u533a\u57df\u5bf9\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u7684\u53ef\u7528\u5b9e\u4f8b\u6570\u91cf\u90fd\u6709\u9650\u5236\u3002\u5982\u679c\u60a8\u521b\u5efa\u4e86\u4e00\u4e2a\u4ec5\u4f7f\u7528\u4e00\u79cd\u5b9e\u4f8b\u7c7b\u578b\u7684\u96c6\u7fa4\uff0c\u5e76\u5c06\u8282\u70b9\u6570\u91cf\u6269\u7f29\u8d85\u51fa\u8be5\u533a\u57df\u7684\u5bb9\u91cf\uff0c\u60a8\u5c06\u6536\u5230\u4e00\u4e2a\u9519\u8bef\uff0c\u6307\u51fa\u6ca1\u6709\u53ef\u7528\u7684\u5b9e\u4f8b\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u60a8\u4e0d\u5e94\u8be5\u4efb\u610f\u9650\u5236\u96c6\u7fa4\u4e2d\u53ef\u4ee5\u4f7f\u7528\u7684\u5b9e\u4f8b\u7c7b\u578b\u3002</p> <p>Karpenter \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u4f7f\u7528\u5e7f\u6cdb\u7684\u517c\u5bb9\u5b9e\u4f8b\u7c7b\u578b\uff0c\u5e76\u5c06\u6839\u636e\u5f85\u5904\u7406\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8981\u6c42\u3001\u53ef\u7528\u6027\u548c\u6210\u672c\u5728\u4f9b\u5e94\u65f6\u9009\u62e9\u5b9e\u4f8b\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7 NodePools \u4e2d\u7684 <code>karpenter.k8s.aws/instance-category</code> \u952e\u6765\u6269\u5927\u6240\u4f7f\u7528\u7684\u5b9e\u4f8b\u7c7b\u578b\u5217\u8868\u3002</p> <p>Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u8981\u6c42\u8282\u70b9\u7ec4\u7684\u5927\u5c0f\u76f8\u4f3c\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u4e00\u81f4\u5730\u6269\u7f29\u5b83\u4eec\u3002\u60a8\u5e94\u8be5\u6839\u636e CPU \u548c\u5185\u5b58\u5927\u5c0f\u521b\u5efa\u591a\u4e2a\u7ec4\uff0c\u5e76\u72ec\u7acb\u6269\u7f29\u5b83\u4eec\u3002\u4f7f\u7528 ec2-instance-selector \u6765\u8bc6\u522b\u4e0e\u60a8\u7684\u8282\u70b9\u7ec4\u5927\u5c0f\u76f8\u4f3c\u7684\u5b9e\u4f8b\u3002</p> <pre><code>ec2-instance-selector --service eks --vcpus-min 8 --memory-min 16\na1.2xlarge\na1.4xlarge\na1.metal\nc4.4xlarge\nc4.8xlarge\nc5.12xlarge\nc5.18xlarge\nc5.24xlarge\nc5.2xlarge\nc5.4xlarge\nc5.9xlarge\nc5.metal\n</code></pre>"},{"location":"zh/scalability/docs/data-plane/#api","title":"\u66f4\u504f\u5411\u4e8e\u4f7f\u7528\u8f83\u5927\u7684\u8282\u70b9\u4ee5\u51cf\u5c11 API \u670d\u52a1\u5668\u8d1f\u8f7d","text":"<p>\u5728\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e9b\u5b9e\u4f8b\u7c7b\u578b\u65f6\uff0c\u8f83\u5c11\u7684\u5927\u578b\u8282\u70b9\u4f1a\u7ed9 Kubernetes \u63a7\u5236\u5e73\u9762\u5e26\u6765\u8f83\u5c0f\u7684\u8d1f\u8f7d\uff0c\u56e0\u4e3a\u8fd0\u884c\u7684 kubelet \u548c DaemonSet \u4f1a\u66f4\u5c11\u3002\u4f46\u662f\uff0c\u5927\u578b\u8282\u70b9\u53ef\u80fd\u65e0\u6cd5\u50cf\u8f83\u5c0f\u7684\u8282\u70b9\u90a3\u6837\u5f97\u5230\u5145\u5206\u5229\u7528\u3002\u8282\u70b9\u5927\u5c0f\u5e94\u6839\u636e\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u7528\u6027\u548c\u6269\u7f29\u8981\u6c42\u8fdb\u884c\u8bc4\u4f30\u3002</p> <p>\u4e00\u4e2a\u7531\u4e09\u4e2a u-24tb1.metal \u5b9e\u4f8b\uff0824 TB \u5185\u5b58\u548c 448 \u4e2a\u5185\u6838\uff09\u7ec4\u6210\u7684\u96c6\u7fa4\u6709 3 \u4e2a kubelet\uff0c\u5e76\u4e14\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6bcf\u4e2a\u8282\u70b9\u7684 Pod \u6570\u91cf\u5c06\u88ab\u9650\u5236\u4e3a 110 \u4e2a\u3002\u5982\u679c\u60a8\u7684 Pod \u6bcf\u4e2a\u4f7f\u7528 4 \u4e2a\u5185\u6838\uff0c\u90a3\u4e48\u8fd9\u53ef\u80fd\u662f\u9884\u671f\u7684\u7ed3\u679c\uff084 \u4e2a\u5185\u6838 x 110 = \u6bcf\u4e2a\u8282\u70b9 440 \u4e2a\u5185\u6838\uff09\u3002\u5bf9\u4e8e\u4e00\u4e2a 3 \u8282\u70b9\u96c6\u7fa4\uff0c\u5982\u679c\u53d1\u751f\u5b9e\u4f8b\u6545\u969c\uff0c\u60a8\u5904\u7406\u8be5\u6545\u969c\u7684\u80fd\u529b\u4f1a\u5f88\u4f4e\uff0c\u56e0\u4e3a 1 \u4e2a\u5b9e\u4f8b\u6545\u969c\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230\u6574\u4e2a\u96c6\u7fa4\u7684 1/3\u3002\u60a8\u5e94\u8be5\u5728\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u6307\u5b9a\u8282\u70b9\u8981\u6c42\u548c Pod \u5206\u5e03\uff0c\u4ee5\u4fbf Kubernetes \u8c03\u5ea6\u5668\u53ef\u4ee5\u6b63\u786e\u5730\u653e\u7f6e\u5de5\u4f5c\u8d1f\u8f7d\u3002</p> <p>\u5de5\u4f5c\u8d1f\u8f7d\u5e94\u8be5\u5b9a\u4e49\u5b83\u4eec\u6240\u9700\u7684\u8d44\u6e90\u4ee5\u53ca\u901a\u8fc7\u6c61\u70b9\u3001\u5bb9\u5fcd\u5ea6\u548c PodTopologySpread \u6240\u9700\u7684\u53ef\u7528\u6027\u3002\u5b83\u4eec\u5e94\u8be5\u66f4\u504f\u5411\u4e8e\u4f7f\u7528\u53ef\u4ee5\u5145\u5206\u5229\u7528\u5e76\u6ee1\u8db3\u53ef\u7528\u6027\u76ee\u6807\u7684\u6700\u5927\u8282\u70b9\uff0c\u4ee5\u51cf\u5c11\u63a7\u5236\u5e73\u9762\u8d1f\u8f7d\u3001\u964d\u4f4e\u64cd\u4f5c\u5f00\u9500\u5e76\u964d\u4f4e\u6210\u672c\u3002</p> <p>\u5982\u679c\u6709\u53ef\u7528\u8d44\u6e90\uff0cKubernetes \u8c03\u5ea6\u5668\u5c06\u81ea\u52a8\u5c1d\u8bd5\u8de8\u53ef\u7528\u533a\u57df\u548c\u4e3b\u673a\u5206\u5e03\u5de5\u4f5c\u8d1f\u8f7d\u3002\u5982\u679c\u6ca1\u6709\u53ef\u7528\u5bb9\u91cf\uff0cKubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u5c06\u5c1d\u8bd5\u5728\u6bcf\u4e2a\u53ef\u7528\u533a\u57df\u5747\u5300\u5730\u6dfb\u52a0\u8282\u70b9\u3002Karpenter \u5c06\u5c3d\u53ef\u80fd\u5feb\u901f\u548c\u7ecf\u6d4e\u5730\u6dfb\u52a0\u8282\u70b9\uff0c\u9664\u975e\u5de5\u4f5c\u8d1f\u8f7d\u6307\u5b9a\u4e86\u5176\u4ed6\u8981\u6c42\u3002</p> <p>\u8981\u5f3a\u5236\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u8c03\u5ea6\u5668\u5206\u5e03\u5e76\u5728\u53ef\u7528\u533a\u57df\u4e2d\u521b\u5efa\u65b0\u8282\u70b9\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528 topologySpreadConstraints\uff1a</p> <pre><code>spec:\n  topologySpreadConstraints:\n    - maxSkew: 3\n      topologyKey: \"topology.kubernetes.io/zone\"\n      whenUnsatisfiable: ScheduleAnyway\n      labelSelector:\n        matchLabels:\n          dev: my-deployment\n    - maxSkew: 2\n      topologyKey: \"kubernetes.io/hostname\"\n      whenUnsatisfiable: ScheduleAnyway\n      labelSelector:\n        matchLabels:\n          dev: my-deployment\n</code></pre>"},{"location":"zh/scalability/docs/data-plane/#_2","title":"\u4f7f\u7528\u76f8\u4f3c\u5927\u5c0f\u7684\u8282\u70b9\u4ee5\u83b7\u5f97\u4e00\u81f4\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6027\u80fd","text":"<p>\u5de5\u4f5c\u8d1f\u8f7d\u5e94\u8be5\u5b9a\u4e49\u5b83\u4eec\u9700\u8981\u5728\u54ea\u79cd\u5927\u5c0f\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u4ee5\u5141\u8bb8\u4e00\u81f4\u7684\u6027\u80fd\u548c\u53ef\u9884\u6d4b\u7684\u6269\u7f29\u3002\u8bf7\u6c42 500m CPU \u7684\u5de5\u4f5c\u8d1f\u8f7d\u5728\u5177\u6709 4 \u4e2a\u5185\u6838\u7684\u5b9e\u4f8b\u4e0a\u4e0e\u5728\u5177\u6709 16 \u4e2a\u5185\u6838\u7684\u5b9e\u4f8b\u4e0a\u7684\u8868\u73b0\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u907f\u514d\u4f7f\u7528 T \u7cfb\u5217\u7b49\u4f7f\u7528\u53ef\u7a81\u53d1 CPU \u7684\u5b9e\u4f8b\u7c7b\u578b\u3002</p> <p>\u4e3a\u4e86\u786e\u4fdd\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u83b7\u5f97\u4e00\u81f4\u7684\u6027\u80fd\uff0c\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u4ee5\u4f7f\u7528 Karpenter \u652f\u6301\u7684\u6807\u7b7e\u6765\u5b9a\u4f4d\u7279\u5b9a\u7684\u5b9e\u4f8b\u5927\u5c0f\u3002</p> <pre><code>kind: deployment\n...\nspec:\n  template:\n    spec:\n    containers:\n    nodeSelector:\n      karpenter.k8s.aws/instance-size: 8xlarge\n</code></pre> <p>\u5728\u4f7f\u7528 Kubernetes \u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u7684\u96c6\u7fa4\u4e2d\u8c03\u5ea6\u5de5\u4f5c\u8d1f\u8f7d\u65f6\uff0c\u5e94\u8be5\u5c06\u8282\u70b9\u9009\u62e9\u5668\u4e0e\u57fa\u4e8e\u6807\u7b7e\u5339\u914d\u7684\u8282\u70b9\u7ec4\u76f8\u5339\u914d\u3002</p> <pre><code>spec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: eks.amazonaws.com/nodegroup\n            operator: In\n            values:\n            - 8-core-node-group    # \u5339\u914d\u60a8\u7684\u8282\u70b9\u7ec4\u540d\u79f0\n</code></pre>"},{"location":"zh/scalability/docs/data-plane/#_3","title":"\u9ad8\u6548\u5229\u7528\u8ba1\u7b97\u8d44\u6e90","text":"<p>\u8ba1\u7b97\u8d44\u6e90\u5305\u62ec EC2 \u5b9e\u4f8b\u548c\u53ef\u7528\u533a\u57df\u3002\u6709\u6548\u5229\u7528\u8ba1\u7b97\u8d44\u6e90\u5c06\u63d0\u9ad8\u60a8\u7684\u53ef\u6269\u5c55\u6027\u3001\u53ef\u7528\u6027\u3001\u6027\u80fd\uff0c\u5e76\u964d\u4f4e\u603b\u4f53\u6210\u672c\u3002\u5728\u5177\u6709\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u81ea\u52a8\u6269\u7f29\u73af\u5883\u4e2d\uff0c\u5f88\u96be\u9884\u6d4b\u6709\u6548\u5229\u7528\u8d44\u6e90\u3002Karpenter \u5c31\u662f\u4e3a\u4e86\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u6309\u9700\u4f9b\u5e94\u5b9e\u4f8b\uff0c\u4ee5\u6700\u5927\u9650\u5ea6\u5730\u63d0\u9ad8\u5229\u7528\u7387\u548c\u7075\u6d3b\u6027\u800c\u521b\u5efa\u7684\u3002</p> <p>Karpenter \u5141\u8bb8\u5de5\u4f5c\u8d1f\u8f7d\u58f0\u660e\u5b83\u9700\u8981\u54ea\u79cd\u7c7b\u578b\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u800c\u65e0\u9700\u5148\u521b\u5efa\u8282\u70b9\u7ec4\u6216\u4e3a\u7279\u5b9a\u8282\u70b9\u914d\u7f6e\u6807\u7b7e\u6c61\u70b9\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Karpenter \u6700\u4f73\u5b9e\u8df5\u3002\u8003\u8651\u5728\u60a8\u7684 Karpenter \u4f9b\u5e94\u5668\u4e2d\u542f\u7528\u5408\u5e76\uff0c\u4ee5\u66ff\u6362\u5229\u7528\u7387\u8f83\u4f4e\u7684\u8282\u70b9\u3002</p>"},{"location":"zh/scalability/docs/data-plane/#amazon-machine-image-ami","title":"\u81ea\u52a8\u66f4\u65b0 Amazon Machine Image (AMI)","text":"<p>\u4fdd\u6301\u5de5\u4f5c\u8282\u70b9\u7ec4\u4ef6\u7684\u6700\u65b0\u72b6\u6001\u53ef\u786e\u4fdd\u60a8\u62e5\u6709\u6700\u65b0\u7684\u5b89\u5168\u8865\u4e01\u548c\u4e0e Kubernetes API \u517c\u5bb9\u7684\u529f\u80fd\u3002\u66f4\u65b0 kubelet \u662f Kubernetes \u529f\u80fd\u6700\u91cd\u8981\u7684\u7ec4\u4ef6\uff0c\u4f46\u81ea\u52a8\u5316\u64cd\u4f5c\u7cfb\u7edf\u3001\u5185\u6838\u548c\u672c\u5730\u5b89\u88c5\u7684\u5e94\u7528\u7a0b\u5e8f\u8865\u4e01\u4e5f\u5c06\u51cf\u5c11\u60a8\u5728\u6269\u7f29\u65f6\u7684\u7ef4\u62a4\u5de5\u4f5c\u3002</p> <p>\u5efa\u8bae\u60a8\u4f7f\u7528\u6700\u65b0\u7684 Amazon EKS \u4f18\u5316\u7684 Amazon Linux 2 \u6216 Amazon EKS \u4f18\u5316\u7684 Bottlerocket AMI \u4f5c\u4e3a\u60a8\u7684\u8282\u70b9\u6620\u50cf\u3002Karpenter \u5c06\u81ea\u52a8\u4f7f\u7528\u6700\u65b0\u53ef\u7528\u7684 AMI \u5728\u96c6\u7fa4\u4e2d\u4f9b\u5e94\u65b0\u8282\u70b9\u3002\u6258\u7ba1\u8282\u70b9\u7ec4\u5c06\u5728\u8282\u70b9\u7ec4\u66f4\u65b0\u671f\u95f4\u66f4\u65b0 AMI\uff0c\u4f46\u4e0d\u4f1a\u5728\u8282\u70b9\u4f9b\u5e94\u65f6\u66f4\u65b0 AMI ID\u3002</p> <p>\u5bf9\u4e8e\u6258\u7ba1\u8282\u70b9\u7ec4\uff0c\u60a8\u9700\u8981\u5728\u6709\u65b0\u7684 AMI ID \u53ef\u7528\u65f6\uff0c\u4f7f\u7528\u65b0\u7684 AMI ID \u66f4\u65b0 Auto Scaling \u7ec4 (ASG) \u542f\u52a8\u6a21\u677f\u3002EKS \u63a7\u5236\u53f0\u548c API \u4e2d\u5c06\u63d0\u4f9b AMI \u6b21\u8981\u7248\u672c\uff08\u4f8b\u5982\u4ece 1.23.5 \u5230 1.24.3\uff09\u4f5c\u4e3a\u8282\u70b9\u7ec4\u7684\u5347\u7ea7\u3002\u8865\u4e01\u7248\u672c\uff08\u4f8b\u5982\u4ece 1.23.5 \u5230 1.23.6\uff09\u5c06\u4e0d\u4f1a\u4f5c\u4e3a\u8282\u70b9\u7ec4\u7684\u5347\u7ea7\u63d0\u4f9b\u3002\u5982\u679c\u60a8\u5e0c\u671b\u4fdd\u6301\u8282\u70b9\u7ec4\u4e0e AMI \u8865\u4e01\u7248\u672c\u540c\u6b65\uff0c\u60a8\u9700\u8981\u521b\u5efa\u65b0\u7684\u542f\u52a8\u6a21\u677f\u7248\u672c\uff0c\u5e76\u8ba9\u8282\u70b9\u7ec4\u4f7f\u7528\u65b0\u7684 AMI \u7248\u672c\u66ff\u6362\u5b9e\u4f8b\u3002</p> <p>\u60a8\u53ef\u4ee5\u4ece\u6b64\u9875\u9762\u6216\u4f7f\u7528 AWS CLI \u627e\u5230\u6700\u65b0\u53ef\u7528\u7684 AMI\u3002</p> <pre><code>aws ssm get-parameter \\\n  --name /aws/service/eks/optimized-ami/1.24/amazon-linux-2/recommended/image_id \\\n  --query \"Parameter.Value\" \\\n  --output text\n</code></pre>"},{"location":"zh/scalability/docs/data-plane/#ebs","title":"\u4e3a\u5bb9\u5668\u4f7f\u7528\u591a\u4e2a EBS \u5377","text":"<p>EBS \u5377\u7684\u8f93\u5165/\u8f93\u51fa (I/O) \u914d\u989d\u53d6\u51b3\u4e8e\u5377\u7684\u7c7b\u578b\uff08\u5982 gp3\uff09\u548c\u78c1\u76d8\u5927\u5c0f\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0e\u4e3b\u673a\u5171\u4eab\u5355\u4e2a EBS \u6839\u5377\uff0c\u8fd9\u53ef\u80fd\u4f1a\u8017\u5c3d\u6574\u4e2a\u4e3b\u673a\u7684\u78c1\u76d8\u914d\u989d\uff0c\u4ece\u800c\u5bfc\u81f4\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u7b49\u5f85\u53ef\u7528\u5bb9\u91cf\u3002\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5c06\u6587\u4ef6\u5199\u5165\u5176\u8986\u76d6\u5206\u533a\u3001\u4ece\u4e3b\u673a\u6302\u8f7d\u672c\u5730\u5377\u4ee5\u53ca\u5728\u5c06\u65e5\u5fd7\u5199\u5165\u6807\u51c6\u8f93\u51fa (STDOUT) \u65f6\uff08\u5177\u4f53\u53d6\u51b3\u4e8e\u6240\u4f7f\u7528\u7684\u65e5\u5fd7\u4ee3\u7406\uff09\uff0c\u5b83\u4eec\u5c31\u4f1a\u5199\u5165\u78c1\u76d8\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u78c1\u76d8 I/O \u8017\u5c3d\uff0c\u60a8\u5e94\u8be5\u4e3a\u5bb9\u5668\u72b6\u6001\u6587\u4ef6\u5939\uff08\u5982 /run/containerd\uff09\u6302\u8f7d\u7b2c\u4e8c\u4e2a\u5377\u3001\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u5b58\u50a8\u4f7f\u7528\u5355\u72ec\u7684 EBS \u5377\uff0c\u5e76\u7981\u7528\u4e0d\u5fc5\u8981\u7684\u672c\u5730\u65e5\u5fd7\u8bb0\u5f55\u3002</p> <p>\u8981\u4f7f\u7528 eksctl \u4e3a\u60a8\u7684 EC2 \u5b9e\u4f8b\u6302\u8f7d\u7b2c\u4e8c\u4e2a\u5377\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5177\u6709\u4ee5\u4e0b\u914d\u7f6e\u7684\u8282\u70b9\u7ec4\uff1a</p> <pre><code>managedNodeGroups:\n  - name: al2-workers\n    amiFamily: AmazonLinux2\n    desiredCapacity: 2\n    volumeSize: 80\n    additionalVolumes:\n      - volumeName: '/dev/sdz'\n        volumeSize: 100\n    preBootstrapCommands:\n    - |\n      \"systemctl stop containerd\"\n      \"mkfs -t ext4 /dev/nvme1n1\"\n      \"rm -rf /var/lib/containerd/*\"\n      \"mount /dev/nvme1n1 /var/lib/containerd/\"\n      \"systemctl start containerd\"\n</code></pre> <p>\u5982\u679c\u60a8\u4f7f\u7528 Terraform \u6765\u4f9b\u5e94\u8282\u70b9\u7ec4\uff0c\u8bf7\u53c2\u9605 EKS Blueprints for Terraform \u4e2d\u7684\u793a\u4f8b\u3002\u5982\u679c\u60a8\u4f7f\u7528 Karpenter \u6765\u4f9b\u5e94\u8282\u70b9\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>blockDeviceMappings</code> \u548c\u8282\u70b9\u7528\u6237\u6570\u636e\u6765\u6dfb\u52a0\u989d\u5916\u7684\u5377\u3002</p> <p>\u8981\u76f4\u63a5\u5c06 EBS \u5377\u6302\u8f7d\u5230\u60a8\u7684 Pod\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528 AWS EBS CSI \u9a71\u52a8\u7a0b\u5e8f\u5e76\u4f7f\u7528\u5b58\u50a8\u7c7b\u6d88\u8d39\u4e00\u4e2a\u5377\u3002</p> <pre><code>---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: ebs-sc\nprovisioner: ebs.csi.aws.com\nvolumeBindingMode: WaitForFirstConsumer\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: ebs-claim\nspec:\n  accessModes:\n    - ReadWriteOnce\n  storageClassName: ebs-sc\n  resources:\n    requests:\n      storage: 4Gi\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: app\nspec:\n  containers:\n  - name: app\n    image: public.ecr.aws/docker/library/nginx\n    volumeMounts:\n    - name: persistent-storage\n      mountPath: /data\n  volumes:\n  - name: persistent-storage\n    persistentVolumeClaim:\n      claimName: ebs-claim\n</code></pre>"},{"location":"zh/scalability/docs/data-plane/#ebs-ebs","title":"\u907f\u514d\u4f7f\u7528 EBS \u9644\u52a0\u9650\u5236\u8f83\u4f4e\u7684\u5b9e\u4f8b\uff08\u5982\u679c\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528 EBS \u5377\uff09","text":"<p>EBS \u662f\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u6301\u4e45\u5b58\u50a8\u7684\u6700\u7b80\u5355\u65b9\u5f0f\u4e4b\u4e00\uff0c\u4f46\u5b83\u4e5f\u6709\u53ef\u6269\u5c55\u6027\u9650\u5236\u3002\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u90fd\u6709\u53ef\u4ee5\u9644\u52a0\u7684 EBS \u5377\u7684\u6700\u5927\u6570\u91cf\u3002\u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981\u58f0\u660e\u5b83\u4eec\u5e94\u8be5\u5728\u54ea\u4e9b\u5b9e\u4f8b\u7c7b\u578b\u4e0a\u8fd0\u884c\uff0c\u5e76\u4f7f\u7528 Kubernetes \u6c61\u70b9\u9650\u5236\u5728\u5355\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u526f\u672c\u6570\u91cf\u3002</p>"},{"location":"zh/scalability/docs/data-plane/#_4","title":"\u7981\u7528\u4e0d\u5fc5\u8981\u7684\u78c1\u76d8\u65e5\u5fd7\u8bb0\u5f55","text":"<p>\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u672c\u5730\u65e5\u5fd7\u8bb0\u5f55\uff0c\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4ee5\u8c03\u8bd5\u65e5\u5fd7\u8fd0\u884c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u7981\u7528\u9891\u7e41\u8bfb\u5199\u78c1\u76d8\u7684\u65e5\u5fd7\u8bb0\u5f55\u3002Journald \u662f\u672c\u5730\u65e5\u5fd7\u8bb0\u5f55\u670d\u52a1\uff0c\u5b83\u5728\u5185\u5b58\u4e2d\u4fdd\u7559\u65e5\u5fd7\u7f13\u51b2\u533a\u5e76\u5b9a\u671f\u5237\u65b0\u5230\u78c1\u76d8\u3002Journald \u4f18\u4e8e syslog\uff0c\u540e\u8005\u4f1a\u7acb\u5373\u5c06\u6bcf\u4e00\u884c\u65e5\u5fd7\u5199\u5165\u78c1\u76d8\u3002\u7981\u7528 syslog \u8fd8\u53ef\u964d\u4f4e\u60a8\u9700\u8981\u7684\u603b\u5b58\u50a8\u91cf\uff0c\u5e76\u907f\u514d\u9700\u8981\u590d\u6742\u7684\u65e5\u5fd7\u8f6e\u8f6c\u89c4\u5219\u3002\u8981\u7981\u7528 syslog\uff0c\u60a8\u53ef\u4ee5\u5c06\u4ee5\u4e0b\u4ee3\u7801\u6bb5\u6dfb\u52a0\u5230\u60a8\u7684 cloud-init \u914d\u7f6e\u4e2d\uff1a</p> <pre><code>runcmd:\n  - [ systemctl, disable, --now, syslog.service ]\n</code></pre>"},{"location":"zh/scalability/docs/data-plane/#_5","title":"\u5728\u64cd\u4f5c\u7cfb\u7edf\u66f4\u65b0\u901f\u5ea6\u662f\u5fc5\u9700\u65f6\u5c31\u5730\u4fee\u8865\u5b9e\u4f8b","text":"<p>\u6ce8\u610f</p> <p>\u53ea\u6709\u5728\u5fc5\u8981\u65f6\u624d\u5e94\u8be5\u5c31\u5730\u4fee\u8865\u5b9e\u4f8b\u3002Amazon \u5efa\u8bae\u5c06\u57fa\u7840\u8bbe\u65bd\u89c6\u4e3a\u4e0d\u53ef\u53d8\u7684\uff0c\u5e76\u50cf\u5e94\u7528\u7a0b\u5e8f\u4e00\u6837\u5f7b\u5e95\u6d4b\u8bd5\u5347\u7ea7\u5230\u8f83\u4f4e\u73af\u5883\u4e2d\u7684\u66f4\u65b0\u3002\u672c\u8282\u9002\u7528\u4e8e\u65e0\u6cd5\u6267\u884c\u6b64\u64cd\u4f5c\u7684\u60c5\u51b5\u3002</p> <p>\u5728\u73b0\u6709 Linux \u4e3b\u673a\u4e0a\u5b89\u88c5\u8f6f\u4ef6\u5305\u53ea\u9700\u51e0\u79d2\u949f\uff0c\u800c\u4e0d\u4f1a\u4e2d\u65ad\u5bb9\u5668\u5316\u5de5\u4f5c\u8d1f\u8f7d\u3002\u53ef\u4ee5\u5b89\u88c5\u5e76\u9a8c\u8bc1\u8f6f\u4ef6\u5305\uff0c\u800c\u65e0\u9700\u9694\u79bb\u3001\u6392\u7a7a\u6216\u66ff\u6362\u5b9e\u4f8b\u3002</p> <p>\u8981\u66ff\u6362\u5b9e\u4f8b\uff0c\u60a8\u9996\u5148\u9700\u8981\u521b\u5efa\u3001\u9a8c\u8bc1\u548c\u5206\u53d1\u65b0\u7684 AMI\u3002\u9700\u8981\u4e3a\u5b9e\u4f8b\u521b\u5efa\u66ff\u6362\u5b9e\u4f8b\uff0c\u5e76\u9694\u79bb\u548c\u6392\u7a7a\u65e7\u5b9e\u4f8b\u3002\u7136\u540e\u9700\u8981\u5728\u65b0\u5b9e\u4f8b\u4e0a\u521b\u5efa\u5de5\u4f5c\u8d1f\u8f7d\u3001\u8fdb\u884c\u9a8c\u8bc1\uff0c\u5e76\u5bf9\u9700\u8981\u4fee\u8865\u7684\u6240\u6709\u5b9e\u4f8b\u91cd\u590d\u6b64\u8fc7\u7a0b\u3002\u5728\u4e0d\u4e2d\u65ad\u5de5\u4f5c\u8d1f\u8f7d\u7684\u60c5\u51b5\u4e0b\u5b89\u5168\u5730\u66ff\u6362\u5b9e\u4f8b\u9700\u8981\u6570\u5c0f\u65f6\u3001\u6570\u5929\u6216\u6570\u5468\u7684\u65f6\u95f4\u3002</p> <p>Amazon \u5efa\u8bae\u4f7f\u7528\u53ef\u4ee5\u4ece\u81ea\u52a8\u5316\u3001\u58f0\u660e\u5f0f\u7cfb\u7edf\u6784\u5efa\u3001\u6d4b\u8bd5\u548c\u5347\u7ea7\u7684\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd\uff0c\u4f46\u5982\u679c\u60a8\u9700\u8981\u5feb\u901f\u4fee\u8865\u7cfb\u7edf\uff0c\u5219\u9700\u8981\u5c31\u5730\u4fee\u8865\u7cfb\u7edf\u5e76\u5728\u65b0\u7684 AMI \u53ef\u7528\u65f6\u66ff\u6362\u5b83\u4eec\u3002\u7531\u4e8e\u4fee\u8865\u7cfb\u7edf\u548c\u66ff\u6362\u7cfb\u7edf\u4e4b\u95f4\u5b58\u5728\u5de8\u5927\u7684\u65f6\u95f4\u5dee\u5f02\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u9700\u8981\u65f6\u4f7f\u7528 AWS Systems Manager Patch Manager \u6765\u81ea\u52a8\u4fee\u8865\u8282\u70b9\u3002</p> <p>\u4fee\u8865\u8282\u70b9\u5c06\u5141\u8bb8\u60a8\u5feb\u901f\u63a8\u51fa\u5b89\u5168\u66f4\u65b0\uff0c\u5e76\u5728\u60a8\u7684 AMI \u66f4\u65b0\u540e\u5b9a\u671f\u66ff\u6362\u5b9e\u4f8b\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u5177\u6709\u53ea\u8bfb\u6839\u6587\u4ef6\u7cfb\u7edf\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5982 Flatcar Container Linux \u6216 Bottlerocket OS\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u4e0e\u8fd9\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u914d\u5408\u4f7f\u7528\u7684\u66f4\u65b0\u64cd\u4f5c\u7b26\u3002Flatcar Linux \u66f4\u65b0\u64cd\u4f5c\u7b26\u548c Bottlerocket \u66f4\u65b0\u64cd\u4f5c\u7b26\u5c06\u81ea\u52a8\u91cd\u542f\u5b9e\u4f8b\u4ee5\u4fdd\u6301\u8282\u70b9\u7684\u6700\u65b0\u72b6\u6001\u3002</p>"},{"location":"zh/scalability/docs/kcp_monitoring/","title":"\u63a7\u5236\u5e73\u9762\u76d1\u63a7","text":""},{"location":"zh/scalability/docs/kcp_monitoring/#api","title":"API \u670d\u52a1\u5668","text":"<p>\u5728\u67e5\u770b\u6211\u4eec\u7684 API \u670d\u52a1\u5668\u65f6\uff0c\u91cd\u8981\u7684\u662f\u8981\u8bb0\u4f4f\u5b83\u7684\u4e00\u4e2a\u529f\u80fd\u662f\u9650\u5236\u4f20\u5165\u7684\u8bf7\u6c42\uff0c\u4ee5\u9632\u6b62\u63a7\u5236\u5e73\u9762\u8fc7\u8f7d\u3002\u770b\u8d77\u6765\u50cf\u662f API \u670d\u52a1\u5668\u7ea7\u522b\u7684\u74f6\u9888\u5b9e\u9645\u4e0a\u53ef\u80fd\u662f\u5728\u4fdd\u62a4\u5b83\u514d\u53d7\u66f4\u4e25\u91cd\u95ee\u9898\u7684\u5f71\u54cd\u3002\u6211\u4eec\u9700\u8981\u6743\u8861\u589e\u52a0\u901a\u8fc7\u7cfb\u7edf\u7684\u8bf7\u6c42\u91cf\u7684\u5229\u5f0a\u3002\u4e3a\u4e86\u786e\u5b9a\u662f\u5426\u5e94\u8be5\u589e\u52a0 API \u670d\u52a1\u5668\u7684\u503c\uff0c\u4ee5\u4e0b\u662f\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u4e00\u5c0f\u90e8\u5206\u4e8b\u9879\uff1a</p> <ol> <li>\u8bf7\u6c42\u901a\u8fc7\u7cfb\u7edf\u7684\u5ef6\u8fdf\u662f\u591a\u5c11\uff1f</li> <li>\u8fd9\u79cd\u5ef6\u8fdf\u662f API \u670d\u52a1\u5668\u672c\u8eab\u9020\u6210\u7684\uff0c\u8fd8\u662f\"\u4e0b\u6e38\"\u7684\u4e1c\u897f\uff0c\u6bd4\u5982 etcd\uff1f</li> <li>API \u670d\u52a1\u5668\u961f\u5217\u6df1\u5ea6\u662f\u5426\u662f\u8fd9\u79cd\u5ef6\u8fdf\u7684\u56e0\u7d20\uff1f</li> <li>API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027 (APF) \u961f\u5217\u662f\u5426\u6839\u636e\u6211\u4eec\u60f3\u8981\u7684 API \u8c03\u7528\u6a21\u5f0f\u6b63\u786e\u8bbe\u7f6e\uff1f</li> </ol>"},{"location":"zh/scalability/docs/kcp_monitoring/#_2","title":"\u95ee\u9898\u51fa\u5728\u54ea\u91cc\uff1f","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 API \u5ef6\u8fdf\u7684\u6307\u6807\u6765\u4e86\u89e3 API \u670d\u52a1\u5668\u4e3a\u8bf7\u6c42\u670d\u52a1\u6240\u9700\u7684\u65f6\u95f4\u3002\u8ba9\u6211\u4eec\u4f7f\u7528\u4e0b\u9762\u7684 PromQL \u548c Grafana \u70ed\u56fe\u6765\u663e\u793a\u8fd9\u4e9b\u6570\u636e\u3002</p> <pre><code>max(increase(apiserver_request_duration_seconds_bucket{subresource!=\"status\",subresource!=\"token\",subresource!=\"scale\",subresource!=\"/healthz\",subresource!=\"binding\",subresource!=\"proxy\",verb!=\"WATCH\"}[$__rate_interval])) by (le)\n</code></pre> <p>Tip</p> <p>\u6709\u5173\u5982\u4f55\u4f7f\u7528\u672c\u6587\u4e2d\u4f7f\u7528\u7684 API \u4eea\u8868\u677f\u76d1\u63a7 API \u670d\u52a1\u5668\u7684\u6df1\u5165\u5199\u4f5c\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b\u535a\u5ba2</p> <p></p> <p>\u6240\u6709\u8fd9\u4e9b\u8bf7\u6c42\u90fd\u5728\u4e00\u79d2\u949f\u4ee5\u5185\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u8ff9\u8c61\uff0c\u8868\u660e\u63a7\u5236\u5e73\u9762\u6b63\u5728\u53ca\u65f6\u5904\u7406\u8bf7\u6c42\u3002\u4f46\u662f\uff0c\u5982\u679c\u60c5\u51b5\u5e76\u975e\u5982\u6b64\u5462\uff1f</p> <p>\u6211\u4eec\u5728\u4e0a\u9762\u4f7f\u7528\u7684 API \u8bf7\u6c42\u6301\u7eed\u65f6\u95f4\u7684\u683c\u5f0f\u662f\u70ed\u56fe\u3002\u70ed\u56fe\u683c\u5f0f\u7684\u597d\u5904\u662f\uff0c\u5b83\u9ed8\u8ba4\u4f1a\u544a\u8bc9\u6211\u4eec API \u7684\u8d85\u65f6\u503c (60 \u79d2)\u3002\u4f46\u662f\uff0c\u6211\u4eec\u771f\u6b63\u9700\u8981\u77e5\u9053\u7684\u662f\uff0c\u5728\u8fbe\u5230\u8d85\u65f6\u9608\u503c\u4e4b\u524d\uff0c\u4ec0\u4e48\u9608\u503c\u5e94\u8be5\u5f15\u8d77\u5173\u6ce8\u3002\u4f5c\u4e3a\u53ef\u63a5\u53d7\u9608\u503c\u7684\u7c97\u7565\u6307\u5357\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0a\u6e38 Kubernetes SLO\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230</p> <p>Tip</p> <p>\u6ce8\u610f\u8fd9\u4e2a\u8bed\u53e5\u4e0a\u7684 max \u51fd\u6570\u5417\uff1f\u5f53\u4f7f\u7528\u805a\u5408\u591a\u4e2a\u670d\u52a1\u5668\u7684\u6307\u6807\u65f6 (\u9ed8\u8ba4\u60c5\u51b5\u4e0b EKS \u4e0a\u6709\u4e24\u4e2a API \u670d\u52a1\u5668)\uff0c\u91cd\u8981\u7684\u662f\u4e0d\u8981\u5c06\u8fd9\u4e9b\u670d\u52a1\u5668\u5e73\u5747\u5728\u4e00\u8d77\u3002</p>"},{"location":"zh/scalability/docs/kcp_monitoring/#_3","title":"\u4e0d\u5bf9\u79f0\u6d41\u91cf\u6a21\u5f0f","text":"<p>\u5982\u679c\u4e00\u4e2a API \u670d\u52a1\u5668 [pod] \u8d1f\u8f7d\u5f88\u8f7b\uff0c\u800c\u53e6\u4e00\u4e2a\u8d1f\u8f7d\u5f88\u91cd\u600e\u4e48\u529e\uff1f\u5982\u679c\u6211\u4eec\u5c06\u8fd9\u4e24\u4e2a\u6570\u5b57\u5e73\u5747\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u8bef\u89e3\u6b63\u5728\u53d1\u751f\u7684\u60c5\u51b5\u3002\u4f8b\u5982\uff0c\u8fd9\u91cc\u6211\u4eec\u6709\u4e09\u4e2a API \u670d\u52a1\u5668\uff0c\u4f46\u6240\u6709\u8d1f\u8f7d\u90fd\u5728\u5176\u4e2d\u4e00\u4e2a\u4e0a\u3002\u4f5c\u4e3a\u4e00\u4e2a\u89c4\u5219\uff0c\u4efb\u4f55\u5177\u6709\u591a\u4e2a\u670d\u52a1\u5668\u7684\u4e1c\u897f\uff0c\u5982 etcd \u548c API \u670d\u52a1\u5668\uff0c\u5728\u8c03\u67e5\u89c4\u6a21\u548c\u6027\u80fd\u95ee\u9898\u65f6\u90fd\u5e94\u8be5\u88ab\u5206\u89e3\u3002</p> <p></p> <p>\u968f\u7740 API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027\u7684\u5f15\u5165\uff0c\u7cfb\u7edf\u4e0a\u7684\u603b\u8bf7\u6c42\u6570\u53ea\u662f\u68c0\u67e5 API \u670d\u52a1\u5668\u662f\u5426\u8fc7\u8f7d\u7684\u4e00\u4e2a\u56e0\u7d20\u3002\u7531\u4e8e\u7cfb\u7edf\u73b0\u5728\u57fa\u4e8e\u4e00\u7cfb\u5217\u961f\u5217\u5de5\u4f5c\uff0c\u6211\u4eec\u5fc5\u987b\u67e5\u770b\u662f\u5426\u6709\u4efb\u4f55\u961f\u5217\u5df2\u6ee1\uff0c\u4ee5\u53ca\u8be5\u961f\u5217\u7684\u6d41\u91cf\u662f\u5426\u88ab\u4e22\u5f03\u3002</p> <p>\u8ba9\u6211\u4eec\u4f7f\u7528\u4ee5\u4e0b\u67e5\u8be2\u6765\u67e5\u770b\u8fd9\u4e9b\u961f\u5217\uff1a</p> <pre><code>max without(instance)(apiserver_flowcontrol_request_concurrency_limit{})\n</code></pre> <p>Note</p> <p>\u6709\u5173 API A&amp;F \u5de5\u4f5c\u539f\u7406\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\u6307\u5357</p> <p>\u8fd9\u91cc\u6211\u4eec\u770b\u5230\u4e86\u96c6\u7fa4\u9ed8\u8ba4\u7684\u4e03\u4e2a\u4e0d\u540c\u4f18\u5148\u7ea7\u7ec4</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u60f3\u770b\u770b\u8be5\u4f18\u5148\u7ea7\u7ec4\u7684\u4f7f\u7528\u767e\u5206\u6bd4\uff0c\u4ee5\u4fbf\u6211\u4eec\u53ef\u4ee5\u4e86\u89e3\u662f\u5426\u6709\u67d0\u4e2a\u4f18\u5148\u7ea7\u7ea7\u522b\u5df2\u7ecf\u9971\u548c\u3002\u5728\u5de5\u4f5c\u8d1f\u8f7d\u4f4e\u7ea7\u522b\u9650\u5236\u8bf7\u6c42\u53ef\u80fd\u662f\u53ef\u53d6\u7684\uff0c\u4f46\u5728\u9886\u5bfc\u9009\u4e3e\u7ea7\u522b\u4e22\u5f03\u5219\u4e0d\u53ef\u53d6\u3002</p> <p>API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027 (APF) \u7cfb\u7edf\u6709\u8bb8\u591a\u590d\u6742\u7684\u9009\u9879\uff0c\u5176\u4e2d\u4e00\u4e9b\u9009\u9879\u53ef\u80fd\u4f1a\u4ea7\u751f\u610f\u5916\u7684\u540e\u679c\u3002\u6211\u4eec\u5728\u73b0\u573a\u770b\u5230\u7684\u4e00\u4e2a\u5e38\u89c1\u95ee\u9898\u662f\uff0c\u589e\u52a0\u961f\u5217\u6df1\u5ea6\u5230\u4e00\u4e2a\u7a0b\u5ea6\uff0c\u4ee5\u81f3\u4e8e\u5b83\u5f00\u59cb\u589e\u52a0\u4e0d\u5fc5\u8981\u7684\u5ef6\u8fdf\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>apiserver_flowcontrol_current_inqueue_request</code> \u6307\u6807\u6765\u76d1\u63a7\u8fd9\u4e2a\u95ee\u9898\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>apiserver_flowcontrol_rejected_requests_total</code> \u6765\u68c0\u67e5\u4e22\u5f03\u3002\u5982\u679c\u4efb\u4f55\u5b58\u50a8\u6876\u8d85\u8fc7\u5176\u5e76\u53d1\u6027\uff0c\u8fd9\u4e9b\u6307\u6807\u5c06\u662f\u975e\u96f6\u503c\u3002</p> <p></p> <p>\u589e\u52a0\u961f\u5217\u6df1\u5ea6\u53ef\u80fd\u4f1a\u4f7f API \u670d\u52a1\u5668\u6210\u4e3a\u5ef6\u8fdf\u7684\u91cd\u8981\u6765\u6e90\uff0c\u56e0\u6b64\u5e94\u8c28\u614e\u64cd\u4f5c\u3002\u6211\u4eec\u5efa\u8bae\u8c28\u614e\u521b\u5efa\u961f\u5217\u7684\u6570\u91cf\u3002\u4f8b\u5982\uff0cEKS \u7cfb\u7edf\u4e0a\u7684\u4efd\u989d\u6570\u662f 600\uff0c\u5982\u679c\u6211\u4eec\u521b\u5efa\u592a\u591a\u961f\u5217\uff0c\u8fd9\u53ef\u80fd\u4f1a\u51cf\u5c11\u9700\u8981\u541e\u5410\u91cf\u7684\u91cd\u8981\u961f\u5217\u4e2d\u7684\u4efd\u989d\uff0c\u5982\u9886\u5bfc\u9009\u4e3e\u961f\u5217\u6216\u7cfb\u7edf\u961f\u5217\u3002\u521b\u5efa\u592a\u591a\u989d\u5916\u7684\u961f\u5217\u53ef\u80fd\u4f1a\u4f7f\u6b63\u786e\u8c03\u6574\u8fd9\u4e9b\u961f\u5217\u7684\u5927\u5c0f\u53d8\u5f97\u66f4\u52a0\u56f0\u96be\u3002</p> <p>\u8981\u4e13\u6ce8\u4e8e\u60a8\u53ef\u4ee5\u5728 APF \u4e2d\u8fdb\u884c\u7684\u7b80\u5355\u6709\u5f71\u54cd\u7684\u66f4\u6539\uff0c\u60a8\u53ea\u9700\u4ece\u672a\u5145\u5206\u5229\u7528\u7684\u5b58\u50a8\u6876\u4e2d\u83b7\u53d6\u4efd\u989d\uff0c\u5e76\u589e\u52a0\u4f7f\u7528\u7387\u8fbe\u5230\u6700\u5927\u503c\u7684\u5b58\u50a8\u6876\u7684\u5927\u5c0f\u3002\u901a\u8fc7\u667a\u80fd\u5730\u5728\u8fd9\u4e9b\u5b58\u50a8\u6876\u4e4b\u95f4\u91cd\u65b0\u5206\u914d\u4efd\u989d\uff0c\u60a8\u53ef\u4ee5\u51cf\u5c11\u4e22\u5f03\u7684\u53ef\u80fd\u6027\u3002</p> <p>\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u8bbf\u95ee EKS \u6700\u4f73\u5b9e\u8df5\u6307\u5357\u4e2d\u7684API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027\u8bbe\u7f6e\u3002</p>"},{"location":"zh/scalability/docs/kcp_monitoring/#api-etcd","title":"API \u4e0e etcd \u5ef6\u8fdf","text":"<p>\u6211\u4eec\u5982\u4f55\u5229\u7528 API \u670d\u52a1\u5668\u7684\u6307\u6807/\u65e5\u5fd7\u6765\u786e\u5b9a\u662f API \u670d\u52a1\u5668\u5b58\u5728\u95ee\u9898\uff0c\u8fd8\u662f API \u670d\u52a1\u5668\u4e0a\u6e38/\u4e0b\u6e38\u5b58\u5728\u95ee\u9898\uff0c\u6216\u8005\u4e24\u8005\u90fd\u5b58\u5728\u95ee\u9898\u3002\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3\u8fd9\u4e00\u70b9\uff0c\u8ba9\u6211\u4eec\u770b\u770b API \u670d\u52a1\u5668\u548c etcd \u662f\u5982\u4f55\u76f8\u5173\u7684\uff0c\u4ee5\u53ca\u5982\u4f55\u5bb9\u6613\u5bf9\u9519\u8bef\u7684\u7cfb\u7edf\u8fdb\u884c\u6545\u969c\u6392\u67e5\u3002</p> <p>\u5728\u4e0b\u56fe\u4e2d\uff0c\u6211\u4eec\u770b\u5230 API \u670d\u52a1\u5668\u5ef6\u8fdf\uff0c\u4f46\u6211\u4eec\u4e5f\u770b\u5230\u8fd9\u79cd\u5ef6\u8fdf\u5f88\u5927\u7a0b\u5ea6\u4e0a\u4e0e etcd \u670d\u52a1\u5668\u76f8\u5173\uff0c\u56e0\u4e3a\u56fe\u4e2d\u7684\u6761\u5f62\u56fe\u663e\u793a\u5927\u90e8\u5206\u5ef6\u8fdf\u53d1\u751f\u5728 etcd \u7ea7\u522b\u3002\u5982\u679c\u5728 API \u670d\u52a1\u5668\u5ef6\u8fdf 20 \u79d2\u7684\u540c\u65f6 etcd \u5ef6\u8fdf 15 \u79d2\uff0c\u90a3\u4e48\u5927\u90e8\u5206\u5ef6\u8fdf\u5b9e\u9645\u4e0a\u53d1\u751f\u5728 etcd \u7ea7\u522b\u3002</p> <p>\u901a\u8fc7\u67e5\u770b\u6574\u4e2a\u6d41\u7a0b\uff0c\u6211\u4eec\u770b\u5230\u4e0d\u4ec5\u4ec5\u5173\u6ce8 API \u670d\u52a1\u5668\u662f\u660e\u667a\u7684\uff0c\u8fd8\u8981\u5bfb\u627e\u8868\u660e etcd \u5904\u4e8e\u56f0\u5883\u7684\u4fe1\u53f7 (\u5373\u6162\u901f\u5e94\u7528\u8ba1\u6570\u5668\u589e\u52a0)\u3002\u80fd\u591f\u4ec5\u901a\u8fc7\u4e00\u77a5\u5c31\u5feb\u901f\u627e\u5230\u6b63\u786e\u7684\u95ee\u9898\u533a\u57df\uff0c\u8fd9\u5c31\u662f\u4eea\u8868\u677f\u5f3a\u5927\u7684\u539f\u56e0\u3002</p> <p>Tip</p> <p>\u672c\u8282\u4e2d\u7684\u4eea\u8868\u677f\u53ef\u5728 https://github.com/RiskyAdventure/Troubleshooting-Dashboards/blob/main/api-troubleshooter.json \u627e\u5230</p> <p></p>"},{"location":"zh/scalability/docs/kcp_monitoring/#_4","title":"\u63a7\u5236\u5e73\u9762\u4e0e\u5ba2\u6237\u7aef\u95ee\u9898","text":"<p>\u5728\u8fd9\u5f20\u56fe\u4e2d\uff0c\u6211\u4eec\u6b63\u5728\u5bfb\u627e\u5728\u8be5\u65f6\u95f4\u6bb5\u5185\u5b8c\u6210\u65f6\u95f4\u6700\u957f\u7684 API \u8c03\u7528\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u770b\u5230\u4e00\u4e2a\u81ea\u5b9a\u4e49\u8d44\u6e90 (CRD) \u5728 05\uff1a40 \u65f6\u95f4\u6bb5\u5185\u8c03\u7528\u4e86\u6700\u9ad8\u5ef6\u8fdf\u7684 APPLY \u51fd\u6570\u3002</p> <p></p> <p>\u6709\u4e86\u8fd9\u4e9b\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Ad-Hoc PromQL \u6216 CloudWatch Insights \u67e5\u8be2\u4ece\u5ba1\u8ba1\u65e5\u5fd7\u4e2d\u63d0\u53d6\u8be5\u65f6\u95f4\u6bb5\u5185\u7684 LIST \u8bf7\u6c42\uff0c\u4ee5\u67e5\u770b\u8fd9\u53ef\u80fd\u662f\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"zh/scalability/docs/kcp_monitoring/#cloudwatch","title":"\u4f7f\u7528 CloudWatch \u67e5\u627e\u6e90","text":"<p>\u6307\u6807\u6700\u597d\u7528\u4e8e\u627e\u5230\u6211\u4eec\u60f3\u8981\u67e5\u770b\u7684\u95ee\u9898\u533a\u57df\uff0c\u5e76\u7f29\u5c0f\u95ee\u9898\u7684\u65f6\u95f4\u8303\u56f4\u548c\u641c\u7d22\u53c2\u6570\u3002\u4e00\u65e6\u6211\u4eec\u6709\u4e86\u8fd9\u4e9b\u6570\u636e\uff0c\u6211\u4eec\u5c31\u5e0c\u671b\u8f6c\u5411\u65e5\u5fd7\u4ee5\u83b7\u5f97\u66f4\u8be6\u7ec6\u7684\u65f6\u95f4\u548c\u9519\u8bef\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 CloudWatch Logs Insights \u5c06\u65e5\u5fd7\u8f6c\u6362\u4e3a\u6307\u6807\u3002</p> <p>\u4f8b\u5982\uff0c\u8981\u8c03\u67e5\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4ee5\u4e0b CloudWatch Logs Insights \u67e5\u8be2\u6765\u63d0\u53d6 userAgent \u548c requestURI\uff0c\u4ee5\u4fbf\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u662f\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5bfc\u81f4\u4e86\u8fd9\u79cd\u5ef6\u8fdf\u3002</p> <p>Tip</p> <p>\u9700\u8981\u4f7f\u7528\u9002\u5f53\u7684 Count\uff0c\u4ee5\u907f\u514d\u62c9\u53d6 Watch \u4e0a\u7684\u6b63\u5e38 List/Resync \u884c\u4e3a\u3002</p> <pre><code>fields *@timestamp*, *@message*\n| filter *@logStream* like \"kube-apiserver-audit\"\n| filter ispresent(requestURI)\n| filter verb = \"list\"\n| parse requestReceivedTimestamp /\\d+-\\d+-(?&lt;StartDay&gt;\\d+)T(?&lt;StartHour&gt;\\d+):(?&lt;StartMinute&gt;\\d+):(?&lt;StartSec&gt;\\d+).(?&lt;StartMsec&gt;\\d+)Z/\n| parse stageTimestamp /\\d+-\\d+-(?&lt;EndDay&gt;\\d+)T(?&lt;EndHour&gt;\\d+):(?&lt;EndMinute&gt;\\d+):(?&lt;EndSec&gt;\\d+).(?&lt;EndMsec&gt;\\d+)Z/\n| fields (StartHour * 3600 + StartMinute * 60 + StartSec + StartMsec / 1000000) as StartTime, (EndHour * 3600 + EndMinute * 60 + EndSec + EndMsec / 1000000) as EndTime, (EndTime - StartTime) as DeltaTime\n| stats avg(DeltaTime) as AverageDeltaTime, count(*) as CountTime by requestURI, userAgent\n| filter CountTime &gt;=50\n| sort AverageDeltaTime desc\n</code></pre> <p>\u4f7f\u7528\u6b64\u67e5\u8be2\uff0c\u6211\u4eec\u53d1\u73b0\u6709\u4e24\u4e2a\u4e0d\u540c\u7684\u4ee3\u7406\u8fd0\u884c\u5927\u91cf\u9ad8\u5ef6\u8fdf\u7684 list \u64cd\u4f5c\u3002Splunk \u548c CloudWatch \u4ee3\u7406\u3002\u6709\u4e86\u8fd9\u4e9b\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u51b3\u5b9a\u5220\u9664\u3001\u66f4\u65b0\u6216\u7528\u53e6\u4e00\u4e2a\u9879\u76ee\u66ff\u6362\u6b64\u63a7\u5236\u5668\u3002</p> <p></p> <p>Tip</p> <p>\u6709\u5173\u6b64\u4e3b\u9898\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b\u535a\u5ba2</p>"},{"location":"zh/scalability/docs/kcp_monitoring/#_5","title":"\u8c03\u5ea6\u5668","text":"<p>\u7531\u4e8e EKS \u63a7\u5236\u5e73\u9762\u5b9e\u4f8b\u8fd0\u884c\u5728\u5355\u72ec\u7684 AWS \u8d26\u6237\u4e2d\uff0c\u6211\u4eec\u5c06\u65e0\u6cd5\u4e3a\u8fd9\u4e9b\u7ec4\u4ef6\u6293\u53d6\u6307\u6807 (API \u670d\u52a1\u5668\u9664\u5916)\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u6211\u4eec\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e9b\u7ec4\u4ef6\u7684\u5ba1\u8ba1\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u65e5\u5fd7\u8f6c\u6362\u4e3a\u6307\u6807\uff0c\u4ee5\u67e5\u770b\u662f\u5426\u6709\u4efb\u4f55\u5b50\u7cfb\u7edf\u5bfc\u81f4\u4e86\u6269\u5c55\u74f6\u9888\u3002\u8ba9\u6211\u4eec\u4f7f\u7528 CloudWatch Logs Insights \u6765\u67e5\u770b\u8c03\u5ea6\u5668\u961f\u5217\u4e2d\u6709\u591a\u5c11\u672a\u8c03\u5ea6\u7684 pod\u3002</p>"},{"location":"zh/scalability/docs/kcp_monitoring/#pod","title":"\u8c03\u5ea6\u5668\u65e5\u5fd7\u4e2d\u7684\u672a\u8c03\u5ea6 pod","text":"<p>\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u81ea\u7ba1\u7406\u7684 Kubernetes (\u5982 Kops) \u4e0a\u6293\u53d6\u8c03\u5ea6\u5668\u6307\u6807\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4ee5\u4e0b PromQL \u6765\u4e86\u89e3\u8c03\u5ea6\u5668\u79ef\u538b\u60c5\u51b5\u3002</p> <pre><code>max without(instance)(scheduler_pending_pods)\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u65e0\u6cd5\u5728 EKS \u4e2d\u8bbf\u95ee\u4e0a\u8ff0\u6307\u6807\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4e0b\u9762\u7684 CloudWatch Logs Insights \u67e5\u8be2\uff0c\u901a\u8fc7\u68c0\u67e5\u5728\u7279\u5b9a\u65f6\u95f4\u6bb5\u5185\u6709\u591a\u5c11 pod \u65e0\u6cd5\u8c03\u5ea6\u6765\u67e5\u770b\u79ef\u538b\u60c5\u51b5\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u6df1\u5165\u7814\u7a76\u5cf0\u503c\u65f6\u95f4\u6bb5\u7684\u6d88\u606f\uff0c\u4ee5\u4e86\u89e3\u74f6\u9888\u7684\u6027\u8d28\u3002\u4f8b\u5982\uff0c\u8282\u70b9\u65e0\u6cd5\u5feb\u901f\u542f\u52a8\uff0c\u6216\u8005\u8c03\u5ea6\u5668\u672c\u8eab\u7684\u901f\u7387\u9650\u5236\u5668\u3002</p> <pre><code>fields timestamp, pod, err, *@message*\n| filter *@logStream* like \"scheduler\"\n| filter *@message* like \"Unable to schedule pod\"\n| parse *@message*  /^.(?&lt;date&gt;\\d{4})\\s+(?&lt;timestamp&gt;\\d+:\\d+:\\d+\\.\\d+)\\s+\\S*\\s+\\S+\\]\\s\\\"(.*?)\\\"\\s+pod=(?&lt;pod&gt;\\\"(.*?)\\\")\\s+err=(?&lt;err&gt;\\\"(.*?)\\\")/\n| count(*) as count by pod, err\n| sort count desc\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u770b\u5230\u8c03\u5ea6\u5668\u7684\u9519\u8bef\u8bf4 pod \u672a\u90e8\u7f72\u662f\u56e0\u4e3a\u5b58\u50a8 PVC \u4e0d\u53ef\u7528\u3002</p> <p></p> <p>Note</p> <p>\u5fc5\u987b\u5728\u63a7\u5236\u5e73\u9762\u4e0a\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7\u8bb0\u5f55\u624d\u80fd\u542f\u7528\u6b64\u529f\u80fd\u3002\u9650\u5236\u65e5\u5fd7\u4fdd\u7559\u671f\u4e5f\u662f\u4e00\u79cd\u6700\u4f73\u5b9e\u8df5\uff0c\u4ee5\u514d\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u4ea7\u751f\u4e0d\u5fc5\u8981\u7684\u6210\u672c\u3002\u4ee5\u4e0b\u662f\u4f7f\u7528 EKSCTL \u5de5\u5177\u542f\u7528\u6240\u6709\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd\u7684\u793a\u4f8b\u3002</p> <pre><code>cloudWatch:\n  clusterLogging:\n    enableTypes: [\"*\"]\n    logRetentionInDays: 10\n</code></pre>"},{"location":"zh/scalability/docs/kcp_monitoring/#kube","title":"Kube \u63a7\u5236\u5668\u7ba1\u7406\u5668","text":"<p>\u4e0e\u6240\u6709\u5176\u4ed6\u63a7\u5236\u5668\u4e00\u6837\uff0cKube \u63a7\u5236\u5668\u7ba1\u7406\u5668\u4e5f\u6709\u9650\u5236\u5b83\u4e00\u6b21\u53ef\u4ee5\u6267\u884c\u591a\u5c11\u64cd\u4f5c\u7684\u9650\u5236\u3002\u8ba9\u6211\u4eec\u901a\u8fc7\u67e5\u770b KOPS \u914d\u7f6e\u6765\u67e5\u770b\u4e00\u4e9b\u8fd9\u4e9b\u6807\u5fd7\uff0c\u5728 KOPS \u914d\u7f6e\u4e2d\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u8fd9\u4e9b\u53c2\u6570\u3002</p> <pre><code>  kubeControllerManager:\n    concurrentEndpointSyncs: 5\n    concurrentReplicasetSyncs: 5\n    concurrentNamespaceSyncs: 10\n    concurrentServiceaccountTokenSyncs: 5\n    concurrentServiceSyncs: 5\n    concurrentResourceQuot aSyncs: 5\n    concurrentGcSyncs: 20\n    kubeAPIBurst: 20\n    kubeAPIQPS: \"30\"\n</code></pre> <p>\u8fd9\u4e9b\u63a7\u5236\u5668\u5728\u96c6\u7fa4\u9ad8\u5ea6\u53d8\u5316\u7684\u65f6\u5019\u4f1a\u6709\u961f\u5217\u586b\u6ee1\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u770b\u5230 replicaset \u63a7\u5236\u5668\u5728\u5176\u961f\u5217\u4e2d\u6709\u5927\u91cf\u79ef\u538b\u3002</p> <p></p> <p>\u6211\u4eec\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u79cd\u60c5\u51b5\u3002\u5982\u679c\u8fd0\u884c\u81ea\u7ba1\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u5730\u589e\u52a0\u5e76\u53d1 goroutine\uff0c\u4f46\u8fd9\u5c06\u5bf9 etcd \u4ea7\u751f\u5f71\u54cd\uff0c\u56e0\u4e3a KCM \u5c06\u5904\u7406\u66f4\u591a\u6570\u636e\u3002\u53e6\u4e00\u79cd\u9009\u62e9\u662f\u4f7f\u7528\u90e8\u7f72\u4e0a\u7684 <code>.spec.revisionHistoryLimit</code> \u51cf\u5c11 replicaset \u5bf9\u8c61\u7684\u6570\u91cf\uff0c\u4ece\u800c\u51cf\u5c11\u5bf9\u8be5\u63a7\u5236\u5668\u7684\u538b\u529b\u3002</p> <pre><code>spec:\n  revisionHistoryLimit: 2\n</code></pre> <p>\u5176\u4ed6 Kubernetes \u529f\u80fd\u53ef\u4ee5\u8fdb\u884c\u8c03\u6574\u6216\u5173\u95ed\uff0c\u4ee5\u51cf\u5c11\u9ad8\u53d8\u66f4\u7387\u7cfb\u7edf\u4e2d\u7684\u538b\u529b\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u7684 pod \u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u9700\u8981\u76f4\u63a5\u4e0e k8s API \u901a\u4fe1\uff0c\u90a3\u4e48\u5173\u95ed\u5c06\u6295\u5f71\u673a\u5bc6\u6295\u5c04\u5230\u8fd9\u4e9b pod \u4e2d\u5c06\u51cf\u5c11\u5bf9 ServiceaccountTokenSyncs \u7684\u8d1f\u8f7d\u3002\u5982\u679c\u53ef\u80fd\u7684\u8bdd\uff0c\u8fd9\u662f\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u7684\u66f4\u53ef\u53d6\u7684\u65b9\u5f0f\u3002</p> <pre><code>kind: Pod\nspec:\n  automountServiceAccountToken: false\n</code></pre> <p>\u5728\u6211\u4eec\u65e0\u6cd5\u8bbf\u95ee\u6307\u6807\u7684\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u6b21\u67e5\u770b\u65e5\u5fd7\u4ee5\u68c0\u6d4b\u4e89\u7528\u60c5\u51b5\u3002\u5982\u679c\u6211\u4eec\u60f3\u67e5\u770b\u5728\u6bcf\u4e2a\u63a7\u5236\u5668\u6216\u805a\u5408\u7ea7\u522b\u4e0a\u6b63\u5728\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4ee5\u4e0b CloudWatch Logs Insights \u67e5\u8be2\u3002</p>"},{"location":"zh/scalability/docs/kcp_monitoring/#kcm","title":"KCM \u5904\u7406\u7684\u603b\u4f53\u91cf","text":"<pre><code># \u67e5\u8be2\u6765\u8ba1\u7b97\u6765\u81ea kube-controller-manager \u7684 API qps\uff0c\u6309\u63a7\u5236\u5668\u7c7b\u578b\u5206\u5272\u3002\n# \u5982\u679c\u60a8\u770b\u5230\u4efb\u4f55\u7279\u5b9a\u63a7\u5236\u5668\u7684\u503c\u63a5\u8fd1 20/\u79d2\uff0c\u5b83\u5f88\u53ef\u80fd\u770b\u5230\u4e86\u5ba2\u6237\u7aef API \u9650\u5236\u3002\nfields @timestamp, @logStream, @message\n| filter @logStream like /kube-apiserver-audit/\n| filter userAgent like /kube-controller-manager/\n# \u6392\u9664\u4e0e\u79df\u7ea6\u76f8\u5173\u7684\u8c03\u7528 (\u4e0d\u8ba1\u5165 kcm qps)\n| filter requestURI not like \"apis/coordination.k8s.io/v1/namespaces/kube-system/leases/kube-controller-manager\"\n# \u6392\u9664 API \u53d1\u73b0\u8c03\u7528 (\u4e0d\u8ba1\u5165 kcm qps)\n| filter requestURI not like \"?timeout=32s\"\n# \u6392\u9664 watch \u8c03\u7528 (\u4e0d\u8ba1\u5165 kcm qps)\n| filter verb != \"watch\"\n# \u5982\u679c\u60a8\u60f3\u83b7\u53d6\u6765\u81ea\u7279\u5b9a\u63a7\u5236\u5668\u7684 API \u8c03\u7528\u8ba1\u6570\uff0c\u8bf7\u53d6\u6d88\u6ce8\u91ca\u4e0b\u9762\u7684\u9002\u5f53\u884c\uff1a\n# | filter user.username like \"system:serviceaccount:kube-system:job-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:cronjob-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:deployment-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:replicaset-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:horizontal-pod-autoscaler\"\n# | filter user.username like \"system:serviceaccount:kube-system:persistent-volume-binder\"\n# | filter user.username like \"system:serviceaccount:kube-system:endpointslice-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:endpoint-controller\"\n# | filter user.username like \"system:serviceaccount:kube-system:generic-garbage-controller\"\n| stats count(*) as count by user.username\n| sort count desc\n</code></pre> <p>\u5173\u952e\u8981\u70b9\u662f\uff0c\u5728\u7814\u7a76\u53ef\u6269\u5c55\u6027\u95ee\u9898\u65f6\uff0c\u8981\u67e5\u770b\u8def\u5f84\u4e2d\u7684\u6bcf\u4e00\u6b65 (API\u3001\u8c03\u5ea6\u5668\u3001KCM\u3001etcd),\u7136\u540e\u518d\u8fdb\u5165\u8be6\u7ec6\u7684\u6545\u969c\u6392\u67e5\u9636\u6bb5\u3002\u901a\u5e38\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u60a8\u4f1a\u53d1\u73b0\u9700\u8981\u5bf9 Kubernetes \u7684\u591a\u4e2a\u90e8\u5206\u8fdb\u884c\u8c03\u6574\uff0c\u624d\u80fd\u4f7f\u7cfb\u7edf\u53d1\u6325\u6700\u4f73\u6027\u80fd\u3002\u5f88\u5bb9\u6613\u65e0\u610f\u4e2d\u5bf9\u75c7\u72b6 (\u5982\u8282\u70b9\u8d85\u65f6) \u8fdb\u884c\u6545\u969c\u6392\u67e5\uff0c\u800c\u4e0d\u662f\u66f4\u5927\u7684\u74f6\u9888\u3002</p>"},{"location":"zh/scalability/docs/kcp_monitoring/#etcd","title":"ETCD","text":"<p>etcd \u4f7f\u7528\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u6765\u6709\u6548\u5730\u5b58\u50a8\u952e\u503c\u5bf9\u3002\u6709\u4e00\u79cd\u4fdd\u62a4\u673a\u5236\u53ef\u4ee5\u8bbe\u7f6e\u53ef\u7528\u5185\u5b58\u7a7a\u95f4\u7684\u5927\u5c0f\uff0c\u901a\u5e38\u8bbe\u7f6e\u4e3a 2\u30014 \u548c 8GB \u9650\u5236\u3002\u6570\u636e\u5e93\u4e2d\u7684\u5bf9\u8c61\u8d8a\u5c11\uff0cetcd \u5728\u5bf9\u8c61\u66f4\u65b0\u65f6\u9700\u8981\u6e05\u7406\u65e7\u7248\u672c\u65f6\u5c31\u9700\u8981\u505a\u7684\u6e05\u7406\u5de5\u4f5c\u5c31\u8d8a\u5c11\u3002\u6e05\u7406\u5bf9\u8c61\u65e7\u7248\u672c\u7684\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u538b\u7f29\u3002\u5728\u8fdb\u884c\u4e86\u591a\u6b21\u538b\u7f29\u64cd\u4f5c\u4e4b\u540e\uff0c\u4f1a\u6709\u4e00\u4e2a\u540e\u7eed\u7684\u8fc7\u7a0b\u6765\u6062\u590d\u53ef\u7528\u7a7a\u95f4\uff0c\u79f0\u4e3a\u788e\u7247\u6574\u7406\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u5728\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u6216\u56fa\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u540e\u53d1\u751f\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e9b\u4e0e\u7528\u6237\u76f8\u5173\u7684\u4e8b\u60c5\u6765\u9650\u5236 Kubernetes \u4e2d\u7684\u5bf9\u8c61\u6570\u91cf\uff0c\u4ece\u800c\u51cf\u5c11\u538b\u7f29\u548c\u788e\u7247\u6574\u7406\u8fc7\u7a0b\u7684\u5f71\u54cd\u3002\u4f8b\u5982\uff0cHelm \u4fdd\u7559\u4e86\u8f83\u9ad8\u7684 <code>revisionHistoryLimit</code>\u3002\u8fd9\u4f1a\u5728\u7cfb\u7edf\u4e0a\u4fdd\u7559\u65e7\u5bf9\u8c61\uff0c\u5982 ReplicaSets\uff0c\u4ee5\u4fbf\u80fd\u591f\u6267\u884c\u56de\u6eda\u3002\u901a\u8fc7\u5c06\u5386\u53f2\u8bb0\u5f55\u9650\u5236\u8bbe\u7f6e\u4e3a 2\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5bf9\u8c61\u6570\u91cf (\u5982 ReplicaSets) \u4ece\u5341\u4e2a\u51cf\u5c11\u5230\u4e24\u4e2a\uff0c\u4ece\u800c\u51cf\u5c11\u7cfb\u7edf\u7684\u8d1f\u8f7d\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nspec:\n  revisionHistoryLimit: 2\n</code></pre> <p>\u4ece\u76d1\u63a7\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5982\u679c\u7cfb\u7edf\u5ef6\u8fdf\u4ee5\u4e00\u5b9a\u6a21\u5f0f\u51fa\u73b0\u5cf0\u503c\uff0c\u5e76\u4e14\u95f4\u9694\u51e0\u4e2a\u5c0f\u65f6\uff0c\u68c0\u67e5\u8fd9\u4e2a\u788e\u7247\u6574\u7406\u8fc7\u7a0b\u662f\u5426\u662f\u6e90\u5934\u4f1a\u5f88\u6709\u5e2e\u52a9\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 CloudWatch Logs \u6765\u67e5\u770b\u8fd9\u4e00\u70b9\u3002</p> <p>\u5982\u679c\u60a8\u60f3\u67e5\u770b\u788e\u7247\u6574\u7406\u7684\u5f00\u59cb/\u7ed3\u675f\u65f6\u95f4\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u67e5\u8be2\uff1a</p> <pre><code>fields *@timestamp*, *@message*\n| filter *@logStream* like /etcd-manager/\n| filter *@message* like /defraging|defraged/\n| sort *@timestamp* asc\n</code></pre> <p></p>"},{"location":"zh/scalability/docs/kubernetes_slos/","title":"Kubernetes\u4e0a\u6e38SLO","text":"<p>Amazon EKS\u8fd0\u884c\u4e0e\u4e0a\u6e38Kubernetes\u7248\u672c\u76f8\u540c\u7684\u4ee3\u7801\uff0c\u5e76\u786e\u4fddEKS\u96c6\u7fa4\u5728Kubernetes\u793e\u533a\u5b9a\u4e49\u7684SLO\u8303\u56f4\u5185\u8fd0\u884c\u3002Kubernetes\u53ef\u6269\u5c55\u6027\u7279\u522b\u5174\u8da3\u5c0f\u7ec4(SIG)\u5b9a\u4e49\u4e86\u53ef\u6269\u5c55\u6027\u76ee\u6807\uff0c\u5e76\u901a\u8fc7SLI\u548cSLO\u8c03\u67e5\u6027\u80fd\u74f6\u9888\u3002</p> <p>SLI\u662f\u6211\u4eec\u8861\u91cf\u7cfb\u7edf\u7684\u65b9\u5f0f\uff0c\u5982\u6307\u6807\u6216\u53ef\u7528\u4e8e\u786e\u5b9a\u7cfb\u7edf\u8fd0\u884c\"\u826f\u597d\"\u7a0b\u5ea6\u7684\u5ea6\u91cf\uff0c\u4f8b\u5982\u8bf7\u6c42\u5ef6\u8fdf\u6216\u8ba1\u6570\u3002SLO\u5b9a\u4e49\u4e86\u7cfb\u7edf\u8fd0\u884c\"\u826f\u597d\"\u65f6\u7684\u9884\u671f\u503c\uff0c\u4f8b\u5982\u8bf7\u6c42\u5ef6\u8fdf\u4fdd\u6301\u57283\u79d2\u4ee5\u4e0b\u3002Kubernetes SLO\u548cSLI\u4e13\u6ce8\u4e8eKubernetes\u7ec4\u4ef6\u7684\u6027\u80fd\uff0c\u4e0e\u5173\u6ce8EKS\u96c6\u7fa4\u7aef\u70b9\u53ef\u7528\u6027\u7684Amazon EKS\u670d\u52a1SLA\u5b8c\u5168\u65e0\u5173\u3002</p> <p>Kubernetes\u6709\u8bb8\u591a\u529f\u80fd\u5141\u8bb8\u7528\u6237\u4f7f\u7528\u81ea\u5b9a\u4e49\u63d2\u4ef6\u6216\u9a71\u52a8\u7a0b\u5e8f\u6269\u5c55\u7cfb\u7edf\uff0c\u5982CSI\u9a71\u52a8\u7a0b\u5e8f\u3001\u51c6\u5165Webhook\u548c\u81ea\u52a8\u6269\u7f29\u5668\u3002\u8fd9\u4e9b\u6269\u5c55\u53ef\u80fd\u4f1a\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u6781\u5927\u5f71\u54cdKubernetes\u96c6\u7fa4\u7684\u6027\u80fd\uff0c\u5373\u5982\u679cWebhook\u76ee\u6807\u4e0d\u53ef\u7528\uff0c\u5177\u6709<code>failurePolicy=Ignore</code>\u7684\u51c6\u5165Webhook\u53ef\u80fd\u4f1a\u589e\u52a0K8s API\u8bf7\u6c42\u7684\u5ef6\u8fdf\u3002Kubernetes\u53ef\u6269\u5c55\u6027SIG\u4f7f\u7528\"\u4f60\u627f\u8bfa\uff0c\u6211\u4eec\u627f\u8bfa\"\u6846\u67b6\u5b9a\u4e49\u53ef\u6269\u5c55\u6027\uff1a</p> <p>\u5982\u679c\u4f60\u627f\u8bfa\uff1a     - \u6b63\u786e\u914d\u7f6e\u96c6\u7fa4     - \u5408\u7406\u4f7f\u7528\u53ef\u6269\u5c55\u6027\u529f\u80fd     - \u5c06\u96c6\u7fa4\u8d1f\u8f7d\u4fdd\u6301\u5728\u63a8\u8350\u9650\u5236\u5185</p> <p>\u90a3\u4e48\u6211\u4eec\u627f\u8bfa\u96c6\u7fa4\u53ef\u6269\u5c55\uff0c\u5373\uff1a     - \u6ee1\u8db3\u6240\u6709SLO</p>"},{"location":"zh/scalability/docs/kubernetes_slos/#kubernetes-slo","title":"Kubernetes SLO","text":"<p>Kubernetes SLO\u4e0d\u8003\u8651\u53ef\u80fd\u5f71\u54cd\u96c6\u7fa4\u7684\u6240\u6709\u63d2\u4ef6\u548c\u5916\u90e8\u9650\u5236\uff0c\u5982\u5de5\u4f5c\u8282\u70b9\u6269\u7f29\u6216\u51c6\u5165Webhook\u3002\u8fd9\u4e9bSLO\u4e13\u6ce8\u4e8eKubernetes\u7ec4\u4ef6,\u5e76\u786e\u4fddKubernetes\u64cd\u4f5c\u548c\u8d44\u6e90\u5728\u9884\u671f\u8303\u56f4\u5185\u8fd0\u884c\u3002SLO\u5e2e\u52a9Kubernetes\u5f00\u53d1\u4eba\u5458\u786e\u4fdd\u5bf9Kubernetes\u4ee3\u7801\u7684\u66f4\u6539\u4e0d\u4f1a\u964d\u4f4e\u6574\u4e2a\u7cfb\u7edf\u7684\u6027\u80fd\u3002</p> <p>Kuberntes\u53ef\u6269\u5c55\u6027SIG\u5b9a\u4e49\u4e86\u4ee5\u4e0b\u5b98\u65b9SLO/SLI\u3002Amazon EKS\u56e2\u961f\u5b9a\u671f\u5728EKS\u96c6\u7fa4\u4e0a\u8fd0\u884c\u8fd9\u4e9bSLO/SLI\u7684\u53ef\u6269\u5c55\u6027\u6d4b\u8bd5\uff0c\u4ee5\u76d1\u63a7\u968f\u7740\u66f4\u6539\u548c\u65b0\u7248\u672c\u53d1\u5e03\u800c\u53ef\u80fd\u51fa\u73b0\u7684\u6027\u80fd\u4e0b\u964d\u3002</p> \u76ee\u6807 \u5b9a\u4e49 SLO API\u8bf7\u6c42\u5ef6\u8fdf(\u53d8\u66f4) \u5bf9\u6bcf\u4e2a(\u8d44\u6e90\u3001\u52a8\u8bcd)\u5bf9\u7684\u5355\u4e2a\u5bf9\u8c61\u8fdb\u884c\u53d8\u66f4API\u8c03\u7528\u7684\u5904\u7406\u5ef6\u8fdf\uff0c\u4ee5\u8fc7\u53bb5\u5206\u949f\u768499\u767e\u5206\u4f4d\u6570\u8861\u91cf \u5728\u9ed8\u8ba4Kubernetes\u5b89\u88c5\u4e2d\uff0c\u5bf9\u4e8e\u6bcf\u4e2a(\u8d44\u6e90\u3001\u52a8\u8bcd)\u5bf9\uff0c\u4e0d\u5305\u62ec\u865a\u62df\u548c\u805a\u5408\u8d44\u6e90\u4ee5\u53ca\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\uff0c\u6bcf\u96c6\u7fa4\u65e599\u767e\u5206\u4f4d\u6570&lt;=1\u79d2 API\u8bf7\u6c42\u5ef6\u8fdf(\u53ea\u8bfb) \u5bf9\u6bcf\u4e2a(\u8d44\u6e90\u3001\u8303\u56f4)\u5bf9\u8fdb\u884c\u975e\u6d41\u5f0f\u53ea\u8bfbAPI\u8c03\u7528\u7684\u5904\u7406\u5ef6\u8fdf\uff0c\u4ee5\u8fc7\u53bb5\u5206\u949f\u768499\u767e\u5206\u4f4d\u6570\u8861\u91cf \u5728\u9ed8\u8ba4Kubernetes\u5b89\u88c5\u4e2d\uff0c\u5bf9\u4e8e\u6bcf\u4e2a(\u8d44\u6e90\u3001\u8303\u56f4)\u5bf9\uff0c\u4e0d\u5305\u62ec\u865a\u62df\u548c\u805a\u5408\u8d44\u6e90\u4ee5\u53ca\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\uff0c\u6bcf\u96c6\u7fa4\u65e599\u767e\u5206\u4f4d\u6570\uff1a(a)\u5982\u679c<code>scope=resource</code>\u5219&lt;=1\u79d2(b)\u5426\u5219(\u5982\u679c<code>scope=namespace</code>\u6216<code>scope=cluster</code>)&lt;=30\u79d2 Pod\u542f\u52a8\u5ef6\u8fdf \u53ef\u8c03\u5ea6\u65e0\u72b6\u6001Pod\u7684\u542f\u52a8\u5ef6\u8fdf\uff0c\u4e0d\u5305\u62ec\u62c9\u53d6\u955c\u50cf\u548c\u8fd0\u884c\u521d\u59cb\u5316\u5bb9\u5668\u7684\u65f6\u95f4\uff0c\u4ecePod\u521b\u5efa\u65f6\u95f4\u6233\u5230\u901a\u8fc7\u76d1\u89c6\u89c2\u5bdf\u5230\u6240\u6709\u5bb9\u5668\u62a5\u544a\u5df2\u542f\u52a8\u4e3a\u6b62\uff0c\u4ee5\u8fc7\u53bb5\u5206\u949f\u768499\u767e\u5206\u4f4d\u6570\u8861\u91cf \u5728\u9ed8\u8ba4Kubernetes\u5b89\u88c5\u4e2d\uff0c\u6bcf\u96c6\u7fa4\u65e599\u767e\u5206\u4f4d\u6570&lt;=5\u79d2"},{"location":"zh/scalability/docs/kubernetes_slos/#api","title":"API\u8bf7\u6c42\u5ef6\u8fdf","text":"<p><code>kube-apiserver</code>\u9ed8\u8ba4\u5c06<code>--request-timeout</code>\u5b9a\u4e49\u4e3a<code>1m0s</code>,\u8fd9\u610f\u5473\u7740\u8bf7\u6c42\u5728\u88ab\u8d85\u65f6\u548c\u53d6\u6d88\u4e4b\u524d\u6700\u591a\u53ef\u4ee5\u8fd0\u884c\u4e00\u5206\u949f(60\u79d2)\u3002\u5ef6\u8fdf\u7684\u5b9a\u4e49SLO\u6839\u636e\u8bf7\u6c42\u7684\u7c7b\u578b(\u53d8\u66f4\u6216\u53ea\u8bfb)\u8fdb\u884c\u4e86\u7ec6\u5206\uff1a</p>"},{"location":"zh/scalability/docs/kubernetes_slos/#_1","title":"\u53d8\u66f4","text":"<p>Kubernetes\u4e2d\u7684\u53d8\u66f4\u8bf7\u6c42\u4f1a\u5bf9\u8d44\u6e90\u8fdb\u884c\u66f4\u6539\uff0c\u5982\u521b\u5efa\u3001\u5220\u9664\u6216\u66f4\u65b0\u3002\u8fd9\u4e9b\u8bf7\u6c42\u4ee3\u4ef7\u5f88\u9ad8\uff0c\u56e0\u4e3a\u5728\u8fd4\u56de\u66f4\u65b0\u540e\u7684\u5bf9\u8c61\u4e4b\u524d\uff0c\u8fd9\u4e9b\u66f4\u6539\u5fc5\u987b\u5199\u5165etcd\u540e\u7aef\u3002Etcd\u662f\u7528\u4e8e\u6240\u6709Kubernetes\u96c6\u7fa4\u6570\u636e\u7684\u5206\u5e03\u5f0f\u952e\u503c\u5b58\u50a8\u3002</p> <p>\u8be5\u5ef6\u8fdf\u4ee5Kubernetes\u8d44\u6e90(\u8d44\u6e90\u3001\u52a8\u8bcd)\u5bf9\u7684\u8fc7\u53bb5\u5206\u949f\u768499\u767e\u5206\u4f4d\u6570\u8861\u91cf\uff0c\u4f8b\u5982\uff0c\u5b83\u5c06\u6d4b\u91cf\u521b\u5efaPod\u8bf7\u6c42\u548c\u66f4\u65b0\u8282\u70b9\u8bf7\u6c42\u7684\u5ef6\u8fdf\u3002\u4e3a\u6ee1\u8db3SLO\uff0c\u8bf7\u6c42\u5ef6\u8fdf\u5fc5\u987b&lt;=1\u79d2\u3002</p>"},{"location":"zh/scalability/docs/kubernetes_slos/#_2","title":"\u53ea\u8bfb","text":"<p>\u53ea\u8bfb\u8bf7\u6c42\u68c0\u7d22\u5355\u4e2a\u8d44\u6e90(\u5982\u83b7\u53d6Pod X)\u6216\u96c6\u5408(\u5982\"\u4ece\u547d\u540d\u7a7a\u95f4X\u83b7\u53d6\u6240\u6709Pod\")\u3002<code>kube-apiserver</code>\u7ef4\u62a4\u5bf9\u8c61\u7684\u7f13\u5b58\uff0c\u56e0\u6b64\u8bf7\u6c42\u7684\u8d44\u6e90\u53ef\u80fd\u6765\u81ea\u7f13\u5b58\uff0c\u4e5f\u53ef\u80fd\u9700\u8981\u5148\u4eceetcd\u68c0\u7d22\u3002 \u8fd9\u4e9b\u5ef6\u8fdf\u4e5f\u662f\u4ee55\u5206\u949f\u768499\u767e\u5206\u4f4d\u6570\u8861\u91cf\uff0c\u4f46\u53ea\u8bfb\u8bf7\u6c42\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u8303\u56f4\u3002SLO\u5b9a\u4e49\u4e86\u4e24\u4e2a\u4e0d\u540c\u7684\u76ee\u6807\uff1a</p> <ul> <li>\u5bf9\u4e8e\u9488\u5bf9\u5355\u4e2a\u8d44\u6e90\u7684\u8bf7\u6c42(\u5373<code>kubectl get pod -n mynamespace my-controller-xxx</code>)\u7684\u8bf7\u6c42\u5ef6\u8fdf\u5e94\u4fdd\u6301\u5728&lt;=1\u79d2\u3002</li> <li>\u5bf9\u4e8e\u9488\u5bf9\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u6216\u6574\u4e2a\u96c6\u7fa4\u4e2d\u591a\u4e2a\u8d44\u6e90\u7684\u8bf7\u6c42(\u4f8b\u5982<code>kubectl get pods -A</code>),\u5ef6\u8fdf\u5e94\u4fdd\u6301\u5728&lt;=30\u79d2</li> </ul> <p>SLO\u5bf9\u4e0d\u540c\u8bf7\u6c42\u8303\u56f4\u6709\u4e0d\u540c\u7684\u76ee\u6807\u503c\uff0c\u56e0\u4e3a\u5bf9Kubernetes\u8d44\u6e90\u96c6\u5408\u7684\u8bf7\u6c42\u671f\u671b\u5728SLO\u5185\u8fd4\u56de\u8bf7\u6c42\u4e2d\u6240\u6709\u5bf9\u8c61\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u5728\u5927\u578b\u96c6\u7fa4\u6216\u5927\u578b\u8d44\u6e90\u96c6\u5408\u4e2d\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8f83\u5927\u7684\u54cd\u5e94\u5927\u5c0f\uff0c\u4ece\u800c\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u624d\u80fd\u8fd4\u56de\u3002\u4f8b\u5982\uff0c\u5728\u8fd0\u884c\u6570\u4e07\u4e2aPod\u7684\u96c6\u7fa4\u4e2d\uff0c\u6bcf\u4e2aPod\u5728\u7f16\u7801\u4e3aJSON\u65f6\u5927\u7ea6\u4e3a1KiB\uff0c\u8fd4\u56de\u96c6\u7fa4\u4e2d\u6240\u6709Pod\u5c06\u5305\u542b10MB\u6216\u66f4\u591a\u6570\u636e\u3002Kubernetes\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528APIListChunking\u4ee5\u5757\u7684\u5f62\u5f0f\u68c0\u7d22\u5927\u578b\u8d44\u6e90\u96c6\u5408,\u4ece\u800c\u51cf\u5c0f\u54cd\u5e94\u5927\u5c0f\u3002</p>"},{"location":"zh/scalability/docs/kubernetes_slos/#pod","title":"Pod\u542f\u52a8\u5ef6\u8fdf","text":"<p>\u6b64SLO\u4e3b\u8981\u5173\u6ce8\u4ecePod\u521b\u5efa\u5230\u8be5Pod\u4e2d\u7684\u5bb9\u5668\u5b9e\u9645\u5f00\u59cb\u6267\u884c\u6240\u9700\u7684\u65f6\u95f4\u3002\u4e3a\u4e86\u6d4b\u91cf\u8fd9\u4e00\u70b9\uff0c\u8ba1\u7b97\u4ece\u8bb0\u5f55\u5728Pod\u4e0a\u7684\u521b\u5efa\u65f6\u95f4\u6233\u5230\u5bf9\u8be5Pod\u8fdb\u884cWATCH\u62a5\u544a\u5bb9\u5668\u5df2\u542f\u52a8\u65f6\u7684\u65f6\u95f4\u5dee(\u4e0d\u5305\u62ec\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\u548c\u8fd0\u884c\u521d\u59cb\u5316\u5bb9\u5668\u7684\u65f6\u95f4)\u3002\u4e3a\u6ee1\u8db3SLO\uff0c\u6bcf\u96c6\u7fa4\u65e5Pod\u542f\u52a8\u5ef6\u8fdf\u768499\u767e\u5206\u4f4d\u6570\u5fc5\u987b\u4fdd\u6301\u5728&lt;=5\u79d2\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u6b64SLO\u5047\u8bbe\u5de5\u4f5c\u8282\u70b9\u5df2\u5728\u8be5\u96c6\u7fa4\u4e2d\u5b58\u5728\u5e76\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\uff0c\u4ee5\u4fbf\u8c03\u5ea6Pod\u3002\u6b64SLO\u4e0d\u8003\u8651\u955c\u50cf\u62c9\u53d6\u6216\u521d\u59cb\u5316\u5bb9\u5668\u6267\u884c\uff0c\u5e76\u4e14\u8fd8\u5c06\u6d4b\u8bd5\u9650\u5236\u4e3a\u4e0d\u4f7f\u7528\u6301\u4e45\u5b58\u50a8\u63d2\u4ef6\u7684\"\u65e0\u72b6\u6001Pod\"\u3002</p>"},{"location":"zh/scalability/docs/kubernetes_slos/#kubernetes-sli","title":"Kubernetes SLI\u6307\u6807","text":"<p>Kubernetes\u8fd8\u901a\u8fc7\u5411Kubernetes\u7ec4\u4ef6\u6dfb\u52a0Prometheus\u6307\u6807\u6765\u8ddf\u8e2a\u8fd9\u4e9bSLI\u968f\u65f6\u95f4\u7684\u53d8\u5316\uff0c\u4ece\u800c\u6539\u5584\u4e86\u5bf9SLI\u7684\u53ef\u89c2\u5bdf\u6027\u3002\u4f7f\u7528Prometheus\u67e5\u8be2\u8bed\u8a00(PromQL),\u6211\u4eec\u53ef\u4ee5\u6784\u5efa\u67e5\u8be2\uff0c\u5728Prometheus\u6216Grafana\u4eea\u8868\u677f\u7b49\u5de5\u5177\u4e2d\u663e\u793aSLI\u6027\u80fd\u968f\u65f6\u95f4\u7684\u53d8\u5316\uff0c\u4e0b\u9762\u662f\u4e0a\u8ff0SLO\u7684\u4e00\u4e9b\u793a\u4f8b\u3002</p>"},{"location":"zh/scalability/docs/kubernetes_slos/#api_1","title":"API\u670d\u52a1\u5668\u8bf7\u6c42\u5ef6\u8fdf","text":"\u6307\u6807 \u5b9a\u4e49 apiserver_request_sli_duration_seconds \u9488\u5bf9\u6bcf\u4e2a\u52a8\u8bcd\u3001\u7ec4\u3001\u7248\u672c\u3001\u8d44\u6e90\u3001\u5b50\u8d44\u6e90\u3001\u8303\u56f4\u548c\u7ec4\u4ef6\u7684\u54cd\u5e94\u5ef6\u8fdf\u5206\u5e03(\u4e0d\u5305\u62ecWebhook\u6301\u7eed\u65f6\u95f4\u548c\u4f18\u5148\u7ea7\u53ca\u516c\u5e73\u961f\u5217\u7b49\u5f85\u65f6\u95f4)\uff0c\u5355\u4f4d\u4e3a\u79d2 apiserver_request_duration_seconds \u9488\u5bf9\u6bcf\u4e2a\u52a8\u8bcd\u3001dry run\u503c\u3001\u7ec4\u3001\u7248\u672c\u3001\u8d44\u6e90\u3001\u5b50\u8d44\u6e90\u3001\u8303\u56f4\u548c\u7ec4\u4ef6\u7684\u54cd\u5e94\u5ef6\u8fdf\u5206\u5e03\uff0c\u5355\u4f4d\u4e3a\u79d2 <p>\u6ce8\u610f\uff1a\u4eceKubernetes 1.27\u5f00\u59cb\u63d0\u4f9b<code>apiserver_request_sli_duration_seconds</code>\u6307\u6807\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u6307\u6807\u6765\u8c03\u67e5API\u670d\u52a1\u5668\u54cd\u5e94\u65f6\u95f4\uff0c\u4ee5\u53caKubernetes\u7ec4\u4ef6\u6216\u5176\u4ed6\u63d2\u4ef6/\u7ec4\u4ef6\u4e2d\u662f\u5426\u5b58\u5728\u74f6\u9888\u3002\u4e0b\u9762\u7684\u67e5\u8be2\u57fa\u4e8e\u793e\u533aSLO\u4eea\u8868\u677f\u3002</p> <p>API\u8bf7\u6c42\u5ef6\u8fdfSLI(\u53d8\u66f4) - \u6b64\u65f6\u95f4\u4e0d\u5305\u62ecWebhook\u6267\u884c\u6216\u961f\u5217\u7b49\u5f85\u65f6\u95f4\u3002 <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"CREATE|DELETE|PATCH|POST|PUT\", subresource!~\"proxy|attach|log|exec|portforward\"}[5m])) by (resource, subresource, verb, scope, le)) &gt; 0</code></p> <p>API\u8bf7\u6c42\u5ef6\u8fdf\u603b\u65f6\u95f4(\u53d8\u66f4) - \u8fd9\u662f\u8bf7\u6c42\u5728API\u670d\u52a1\u5668\u4e0a\u82b1\u8d39\u7684\u603b\u65f6\u95f4\uff0c\u6b64\u65f6\u95f4\u53ef\u80fd\u6bd4SLI\u65f6\u95f4\u957f\uff0c\u56e0\u4e3a\u5b83\u5305\u62ecWebhook\u6267\u884c\u548cAPI\u4f18\u5148\u7ea7\u548c\u516c\u5e73\u7b49\u5f85\u65f6\u95f4\u3002 <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"CREATE|DELETE|PATCH|POST|PUT\", subresource!~\"proxy|attach|log|exec|portforward\"}[5m])) by (resource, subresource, verb, scope, le)) &gt; 0</code></p> <p>\u5728\u8fd9\u4e9b\u67e5\u8be2\u4e2d\uff0c\u6211\u4eec\u6392\u9664\u4e86\u4e0d\u7acb\u5373\u8fd4\u56de\u7684\u6d41\u5f0fAPI\u8bf7\u6c42\uff0c\u5982<code>kubectl port-forward</code>\u6216<code>kubectl exec</code>\u8bf7\u6c42(<code>subresource!~\"proxy|attach|log|exec|portforward\"</code>),\u5e76\u4e14\u6211\u4eec\u53ea\u8fc7\u6ee4\u4fee\u6539\u5bf9\u8c61\u7684Kubernetes\u52a8\u8bcd(<code>verb=~\"CREATE|DELETE|PATCH|POST|PUT\"</code>),\u7136\u540e\u8ba1\u7b97\u8fc7\u53bb5\u5206\u949f\u768499\u767e\u5206\u4f4d\u5ef6\u8fdf\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u7684\u67e5\u8be2\u6765\u67e5\u770b\u53ea\u8bfbAPI\u8bf7\u6c42\uff0c\u53ea\u9700\u4fee\u6539\u6211\u4eec\u8fc7\u6ee4\u7684\u52a8\u8bcd\u4ee5\u5305\u542b\u53ea\u8bfb\u64cd\u4f5c<code>LIST</code>\u548c<code>GET</code>\u5373\u53ef\u3002\u6839\u636e\u8bf7\u6c42\u7684\u8303\u56f4(\u5373\u83b7\u53d6\u5355\u4e2a\u8d44\u6e90\u6216\u5217\u51fa\u591a\u4e2a\u8d44\u6e90)\uff0cSLO\u9608\u503c\u4e5f\u6709\u6240\u4e0d\u540c\u3002</p> <p>API\u8bf7\u6c42\u5ef6\u8fdfSLI(\u53ea\u8bfb) - \u6b64\u65f6\u95f4\u4e0d\u5305\u62ecWebhook\u6267\u884c\u6216\u961f\u5217\u7b49\u5f85\u65f6\u95f4\u3002 \u5bf9\u4e8e\u5355\u4e2a\u8d44\u6e90(scope=resource,\u9608\u503c=1\u79d2) <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"GET\", scope=~\"resource\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>\u5bf9\u4e8e\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u8d44\u6e90\u96c6\u5408(scope=namespace,\u9608\u503c=5\u79d2) <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"LIST\", scope=~\"namespace\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>\u5bf9\u4e8e\u6574\u4e2a\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\u96c6\u5408(scope=cluster,\u9608\u503c=30\u79d2) <code>histogram_quantile(0.99, sum(rate(apiserver_request_sli_duration_seconds_bucket{verb=~\"LIST\", scope=~\"cluster\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>API\u8bf7\u6c42\u5ef6\u8fdf\u603b\u65f6\u95f4(\u53ea\u8bfb) - \u8fd9\u662f\u8bf7\u6c42\u5728API\u670d\u52a1\u5668\u4e0a\u82b1\u8d39\u7684\u603b\u65f6\u95f4\uff0c\u6b64\u65f6\u95f4\u53ef\u80fd\u6bd4SLI\u65f6\u95f4\u957f\uff0c\u56e0\u4e3a\u5b83\u5305\u62ecWebhook\u6267\u884c\u548c\u7b49\u5f85\u65f6\u95f4\u3002 \u5bf9\u4e8e\u5355\u4e2a\u8d44\u6e90(scope=resource,\u9608\u503c=1\u79d2) <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"GET\", scope=~\"resource\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>\u5bf9\u4e8e\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u8d44\u6e90\u96c6\u5408(scope=namespace,\u9608\u503c=5\u79d2) <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"LIST\", scope=~\"namespace\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>\u5bf9\u4e8e\u6574\u4e2a\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\u96c6\u5408(scope=cluster,\u9608\u503c=30\u79d2) <code>histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{verb=~\"LIST\", scope=~\"cluster\"}[5m])) by (resource, subresource, verb, scope, le))</code></p> <p>SLI\u6307\u6807\u63d0\u4f9b\u4e86\u5bf9Kubernetes\u7ec4\u4ef6\u6027\u80fd\u7684\u6d1e\u89c1\uff0c\u56e0\u4e3a\u5b83\u4eec\u6392\u9664\u4e86\u8bf7\u6c42\u5728API\u4f18\u5148\u7ea7\u548c\u516c\u5e73\u961f\u5217\u3001\u901a\u8fc7\u51c6\u5165Webhook\u6216\u5176\u4ed6Kubernetes\u6269\u5c55\u65f6\u82b1\u8d39\u7684\u65f6\u95f4\u3002\u603b\u4f53\u6307\u6807\u63d0\u4f9b\u4e86\u66f4\u5168\u9762\u7684\u89c6\u89d2\uff0c\u56e0\u4e3a\u5b83\u53cd\u6620\u4e86\u5e94\u7528\u7a0b\u5e8f\u7b49\u5f85API\u670d\u52a1\u5668\u54cd\u5e94\u7684\u65f6\u95f4\u3002\u6bd4\u8f83\u8fd9\u4e9b\u6307\u6807\u53ef\u4ee5\u63d0\u4f9b\u8bf7\u6c42\u5904\u7406\u5ef6\u8fdf\u5f15\u5165\u7684\u89c1\u89e3\u3002</p>"},{"location":"zh/scalability/docs/kubernetes_slos/#pod_1","title":"Pod\u542f\u52a8\u5ef6\u8fdf","text":"\u6307\u6807 \u5b9a\u4e49 kubelet_pod_start_sli_duration_seconds \u542f\u52a8Pod\u6240\u9700\u7684\u65f6\u95f4(\u79d2)\uff0c\u4e0d\u5305\u62ec\u62c9\u53d6\u955c\u50cf\u548c\u8fd0\u884c\u521d\u59cb\u5316\u5bb9\u5668\u7684\u65f6\u95f4\uff0c\u4ecePod\u521b\u5efa\u65f6\u95f4\u6233\u5230\u901a\u8fc7\u76d1\u89c6\u89c2\u5bdf\u5230\u6240\u6709\u5bb9\u5668\u5df2\u542f\u52a8\u4e3a\u6b62 kubelet_pod_start_duration_seconds \u4ecekubelet\u7b2c\u4e00\u6b21\u770b\u5230Pod\u5230Pod\u5f00\u59cb\u8fd0\u884c\u6240\u9700\u7684\u65f6\u95f4(\u79d2)\u3002\u8fd9\u4e0d\u5305\u62ec\u8c03\u5ea6Pod\u6216\u6269\u5c55\u5de5\u4f5c\u8282\u70b9\u5bb9\u91cf\u6240\u9700\u7684\u65f6\u95f4\u3002 <p>\u6ce8\u610f\uff1a<code>kubelet_pod_start_sli_duration_seconds</code>\u4eceKubernetes 1.27\u5f00\u59cb\u63d0\u4f9b\u3002</p> <p>\u4e0e\u4e0a\u9762\u7684\u67e5\u8be2\u7c7b\u4f3c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u6307\u6807\u6765\u4e86\u89e3\u8282\u70b9\u6269\u7f29\u3001\u955c\u50cf\u62c9\u53d6\u548c\u521d\u59cb\u5316\u5bb9\u5668\u6267\u884c\u5ef6\u8fdfPod\u542f\u52a8\u7684\u7a0b\u5ea6\uff0c\u4e0eKubelet\u64cd\u4f5c\u76f8\u6bd4\u3002</p> <p>Pod\u542f\u52a8\u5ef6\u8fdfSLI - \u8fd9\u662f\u4ecePod\u521b\u5efa\u5230\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u62a5\u544a\u4e3a\u8fd0\u884c\u6240\u9700\u7684\u65f6\u95f4\u3002\u8fd9\u5305\u62ec\u5de5\u4f5c\u8282\u70b9\u5bb9\u91cf\u53ef\u7528\u548cPod\u88ab\u8c03\u5ea6\u6240\u9700\u7684\u65f6\u95f4\uff0c\u4f46\u4e0d\u5305\u62ec\u62c9\u53d6\u955c\u50cf\u6216\u521d\u59cb\u5316\u5bb9\u5668\u8fd0\u884c\u6240\u9700\u7684\u65f6\u95f4\u3002 <code>histogram_quantile(0.99, sum(rate(kubelet_pod_start_sli_duration_seconds_bucket[5m])) by (le))</code></p> <p>Pod\u542f\u52a8\u5ef6\u8fdf\u603b\u65f6\u95f4 - \u8fd9\u662fkubelet\u542f\u52a8Pod\u6240\u9700\u7684\u65f6\u95f4\u3002\u8fd9\u662f\u4ecekubelet\u901a\u8fc7WATCH\u63a5\u6536Pod\u5f00\u59cb\u6d4b\u91cf\u7684\uff0c\u4e0d\u5305\u62ec\u8282\u70b9\u6269\u7f29\u6216\u8c03\u5ea6\u6240\u9700\u7684\u65f6\u95f4\u3002\u8fd9\u5305\u62ec\u62c9\u53d6\u955c\u50cf\u548c\u521d\u59cb\u5316\u5bb9\u5668\u8fd0\u884c\u6240\u9700\u7684\u65f6\u95f4\u3002 <code>histogram_quantile(0.99, sum(rate(kubelet_pod_start_duration_seconds_bucket[5m])) by (le))</code></p>"},{"location":"zh/scalability/docs/kubernetes_slos/#slo","title":"\u96c6\u7fa4\u4e0a\u7684SLO","text":"<p>\u5982\u679c\u60a8\u6b63\u5728\u4eceEKS\u96c6\u7fa4\u4e2d\u7684Kubernetes\u8d44\u6e90\u6536\u96c6Prometheus\u6307\u6807\uff0c\u60a8\u53ef\u4ee5\u66f4\u6df1\u5165\u5730\u4e86\u89e3Kubernetes\u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\u7684\u6027\u80fd\u3002</p> <p>perf-tests\u4ed3\u5e93\u5305\u62ecGrafana\u4eea\u8868\u677f\uff0c\u7528\u4e8e\u663e\u793a\u6d4b\u8bd5\u671f\u95f4\u96c6\u7fa4\u7684\u5ef6\u8fdf\u548c\u5173\u952e\u6027\u80fd\u6307\u6807\u3002perf-tests\u914d\u7f6e\u5229\u7528\u4e86kube-prometheus-stack,\u8fd9\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u9884\u914d\u7f6e\u4e3a\u6536\u96c6Kubernetes\u6307\u6807\uff0c\u4f46\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528Amazon Managed Prometheus\u548cAmazon Managed Grafana\u3002</p> <p>\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f<code>kube-prometheus-stack</code>\u6216\u7c7b\u4f3c\u7684Prometheus\u89e3\u51b3\u65b9\u6848\uff0c\u60a8\u53ef\u4ee5\u5b89\u88c5\u76f8\u540c\u7684\u4eea\u8868\u677f\u6765\u5b9e\u65f6\u89c2\u5bdf\u96c6\u7fa4\u4e0a\u7684SLO\u3002</p> <ol> <li>\u60a8\u9996\u5148\u9700\u8981\u4f7f\u7528<code>kubectl apply -f prometheus-rules.yaml</code>\u5b89\u88c5\u4eea\u8868\u677f\u4e2d\u4f7f\u7528\u7684Prometheus\u89c4\u5219\u3002\u60a8\u53ef\u4ee5\u4ece\u8fd9\u91cc\u4e0b\u8f7d\u89c4\u5219\u526f\u672c\uff1ahttps://github.com/kubernetes/perf-tests/blob/master/clusterloader2/pkg/prometheus/manifests/prometheus-rules.yaml<ol> <li>\u786e\u4fdd\u6587\u4ef6\u4e2d\u7684\u547d\u540d\u7a7a\u95f4\u4e0e\u60a8\u7684\u73af\u5883\u5339\u914d</li> <li>\u5982\u679c\u60a8\u4f7f\u7528<code>kube-prometheus-stack</code>,\u8bf7\u9a8c\u8bc1\u6807\u7b7e\u662f\u5426\u4e0e<code>prometheus.prometheusSpec.ruleSelector</code>helm\u503c\u5339\u914d</li> </ol> </li> <li>\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5728Grafana\u4e2d\u5b89\u88c5\u4eea\u8868\u677f\u3002json\u4eea\u8868\u677f\u548c\u751f\u6210\u5b83\u4eec\u7684python\u811a\u672c\u53ef\u5728\u6b64\u5904\u83b7\u5f97\uff1ahttps://github.com/kubernetes/perf-tests/tree/master/clusterloader2/pkg/prometheus/manifests/dashboards<ol> <li><code>slo.json</code>\u4eea\u8868\u677f\u663e\u793a\u4e86\u96c6\u7fa4\u76f8\u5bf9\u4e8eKubernetes SLO\u7684\u6027\u80fd</li> </ol> </li> </ol> <p>\u8bf7\u8003\u8651SLO\u4e13\u6ce8\u4e8e\u96c6\u7fa4\u4e2dKubernetes\u7ec4\u4ef6\u7684\u6027\u80fd\uff0c\u4f46\u60a8\u8fd8\u53ef\u4ee5\u67e5\u770b\u5176\u4ed6\u6307\u6807\uff0c\u8fd9\u4e9b\u6307\u6807\u53ef\u4ee5\u63d0\u4f9b\u4e0d\u540c\u7684\u89c6\u89d2\u6216\u5bf9\u96c6\u7fa4\u7684\u89c1\u89e3\u3002\u50cfKube-state-metrics\u8fd9\u6837\u7684Kubernetes\u793e\u533a\u9879\u76ee\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5feb\u901f\u5206\u6790\u96c6\u7fa4\u4e2d\u7684\u8d8b\u52bf\u3002\u6765\u81eaKubernetes\u793e\u533a\u7684\u5927\u591a\u6570\u5e38\u89c1\u63d2\u4ef6\u548c\u9a71\u52a8\u7a0b\u5e8f\u4e5f\u4f1a\u53d1\u51faPrometheus\u6307\u6807\uff0c\u5141\u8bb8\u60a8\u8c03\u67e5\u81ea\u52a8\u6269\u7f29\u5668\u6216\u81ea\u5b9a\u4e49\u8c03\u5ea6\u7a0b\u5e8f\u7b49\u5185\u5bb9\u3002</p> <p>\u53ef\u89c2\u5bdf\u6027\u6700\u4f73\u5b9e\u8df5\u6307\u5357\u63d0\u4f9b\u4e86\u60a8\u53ef\u4ee5\u4f7f\u7528\u7684\u5176\u4ed6Kubernetes\u6307\u6807\u793a\u4f8b\uff0c\u4ee5\u83b7\u5f97\u66f4\u6df1\u5165\u7684\u89c1\u89e3\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/","title":"\u8282\u70b9\u548c\u5de5\u4f5c\u8d1f\u8f7d\u6548\u7387","text":"<p>\u63d0\u9ad8\u5de5\u4f5c\u8d1f\u8f7d\u548c\u8282\u70b9\u7684\u6548\u7387\u53ef\u4ee5\u964d\u4f4e\u590d\u6742\u6027/\u6210\u672c\uff0c\u540c\u65f6\u63d0\u9ad8\u6027\u80fd\u548c\u6269\u5c55\u80fd\u529b\u3002\u5728\u89c4\u5212\u8fd9\u79cd\u6548\u7387\u65f6\uff0c\u9700\u8981\u8003\u8651\u8bb8\u591a\u56e0\u7d20\uff0c\u5c06\u5176\u89c6\u4e3a\u6743\u8861\u53d6\u820d\u800c\u975e\u6bcf\u4e2a\u7279\u6027\u7684\u6700\u4f73\u5b9e\u8df5\u8bbe\u7f6e\u4f1a\u66f4\u5bb9\u6613\u7406\u89e3\u3002\u8ba9\u6211\u4eec\u5728\u4e0b\u4e00\u8282\u6df1\u5165\u63a2\u8ba8\u8fd9\u4e9b\u6743\u8861\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#_2","title":"\u8282\u70b9\u9009\u62e9","text":"<p>\u4f7f\u7528\u7a0d\u5927\u7684\u8282\u70b9\u5927\u5c0f(4-12xlarge)\u4f1a\u589e\u52a0\u53ef\u7528\u4e8e\u8fd0\u884c Pod \u7684\u7a7a\u95f4\uff0c\u56e0\u4e3a\u5b83\u51cf\u5c11\u4e86\u7528\u4e8e\"\u5f00\u9500\"\u7684\u8282\u70b9\u767e\u5206\u6bd4\uff0c\u4f8b\u5982 DaemonSets \u548c\u4e3a\u7cfb\u7edf\u7ec4\u4ef6\u4fdd\u7559\u7684 Reserves\u3002\u5728\u4e0b\u56fe\u4e2d\uff0c\u6211\u4eec\u770b\u5230\u4e86\u5728\u53ea\u6709\u9002\u5ea6\u6570\u91cf DaemonSets \u7684\u60c5\u51b5\u4e0b\uff0c2xlarge \u4e0e 8xlarge \u7cfb\u7edf\u7684\u53ef\u7528\u7a7a\u95f4\u4e4b\u95f4\u7684\u5dee\u5f02\u3002</p> <p>Note</p> <p>\u7531\u4e8e k8s \u901a\u5e38\u662f\u6c34\u5e73\u6269\u5c55\uff0c\u56e0\u6b64\u5bf9\u4e8e\u5927\u591a\u6570\u5e94\u7528\u7a0b\u5e8f\uff0c\u91c7\u7528 NUMA \u5927\u5c0f\u8282\u70b9\u4f1a\u5e26\u6765\u6027\u80fd\u5f71\u54cd\uff0c\u56e0\u6b64\u4e0b\u9762\u7684\u5efa\u8bae\u8303\u56f4\u4f4e\u4e8e\u8be5\u8282\u70b9\u5927\u5c0f\u3002</p> <p></p> <p>\u8f83\u5927\u7684\u8282\u70b9\u5927\u5c0f\u4f7f\u6211\u4eec\u80fd\u591f\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u62e5\u6709\u66f4\u9ad8\u767e\u5206\u6bd4\u7684\u53ef\u7528\u7a7a\u95f4\u3002\u4f46\u662f\uff0c\u5982\u679c\u5c06\u8282\u70b9\u586b\u6ee1\u592a\u591a Pod \u5bfc\u81f4\u9519\u8bef\u6216\u4f7f\u8282\u70b9\u9971\u548c\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4e5f\u53ef\u80fd\u8d70\u5411\u6781\u7aef\u3002\u76d1\u63a7\u8282\u70b9\u9971\u548c\u662f\u6210\u529f\u4f7f\u7528\u8f83\u5927\u8282\u70b9\u5927\u5c0f\u7684\u5173\u952e\u3002</p> <p>\u8282\u70b9\u9009\u62e9\u5f88\u5c11\u662f\u4e00\u5200\u5207\u7684\u3002\u901a\u5e38\u6700\u597d\u5c06\u5468\u8f6c\u7387\u6781\u7aef\u4e0d\u540c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5206\u5272\u5230\u4e0d\u540c\u7684\u8282\u70b9\u7ec4\u3002\u5177\u6709\u9ad8\u5468\u8f6c\u7387\u7684\u5c0f\u6279\u91cf\u5de5\u4f5c\u8d1f\u8f7d\u6700\u9002\u5408 4xlarge \u7cfb\u5217\u5b9e\u4f8b\uff0c\u800c\u50cf Kafka \u8fd9\u6837\u5927\u89c4\u6a21\u5e94\u7528\u7a0b\u5e8f\u5360\u7528 8 vCPU \u4e14\u5468\u8f6c\u7387\u4f4e\uff0c\u5219\u66f4\u9002\u5408 12xlarge \u7cfb\u5217\u3002</p> <p></p> <p>Tip</p> <p>\u5bf9\u4e8e\u975e\u5e38\u5927\u7684\u8282\u70b9\u5927\u5c0f\uff0c\u53e6\u4e00\u4e2a\u9700\u8981\u8003\u8651\u7684\u56e0\u7d20\u662f\uff0c\u7531\u4e8e CGROUPS \u4e0d\u4f1a\u9690\u85cf\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u7684\u603b vCPU \u6570\u91cf\uff0c\u52a8\u6001\u8fd0\u884c\u65f6\u53ef\u80fd\u4f1a\u4ea7\u751f\u610f\u5916\u6570\u91cf\u7684\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u4ece\u800c\u5bfc\u81f4\u96be\u4ee5\u6392\u67e5\u7684\u5ef6\u8fdf\u3002\u5bf9\u4e8e\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\uff0c\u5efa\u8bae CPU \u7ed1\u5b9a\u3002\u8981\u6df1\u5165\u63a2\u8ba8\u6b64\u4e3b\u9898\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b\u89c6\u9891 https://www.youtube.com/watch?v=NqtfDy_KAqg</p>"},{"location":"zh/scalability/docs/node_efficiency/#_3","title":"\u8282\u70b9\u88c5\u7bb1","text":""},{"location":"zh/scalability/docs/node_efficiency/#kubernetes-linux","title":"Kubernetes \u4e0e Linux \u89c4\u5219","text":"<p>\u5728\u5904\u7406 Kubernetes \u4e0a\u7684\u5de5\u4f5c\u8d1f\u8f7d\u65f6\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u4e24\u7ec4\u89c4\u5219\u3002Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u4f7f\u7528\u8bf7\u6c42\u503c\u6765\u5728\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod \u7684\u89c4\u5219\uff0c\u4ee5\u53ca Pod \u8c03\u5ea6\u540e\u53d1\u751f\u7684\u60c5\u51b5\uff0c\u8fd9\u5c5e\u4e8e Linux \u800c\u975e Kubernetes \u7684\u8303\u7574\u3002</p> <p>\u5728 Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u5b8c\u6210\u540e\uff0c\u4e00\u7ec4\u65b0\u7684\u89c4\u5219\u5f00\u59cb\u751f\u6548\uff0c\u5373 Linux \u5b8c\u5168\u516c\u5e73\u8c03\u5ea6\u7a0b\u5e8f (CFS)\u3002\u5173\u952e\u70b9\u662f Linux CFS \u6ca1\u6709\u6838\u5fc3\u7684\u6982\u5ff5\u3002\u6211\u4eec\u5c06\u8ba8\u8bba\u4e3a\u4ec0\u4e48\u4ee5\u6838\u5fc3\u601d\u8003\u4f1a\u5bfc\u81f4\u4f18\u5316\u5de5\u4f5c\u8d1f\u8f7d\u6269\u5c55\u80fd\u529b\u7684\u91cd\u5927\u95ee\u9898\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#_4","title":"\u4ee5\u6838\u5fc3\u601d\u8003","text":"<p>\u6df7\u6dc6\u7684\u8d77\u6e90\u5728\u4e8e Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u786e\u5b9e\u6709\u6838\u5fc3\u7684\u6982\u5ff5\u3002\u4ece Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5982\u679c\u6211\u4eec\u67e5\u770b\u4e00\u4e2a\u8282\u70b9\u4e0a\u6709 4 \u4e2a NGINX Pod\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u4e00\u4e2a\u6838\u5fc3\uff0c\u8282\u70b9\u770b\u8d77\u6765\u5c31\u50cf\u8fd9\u6837\u3002</p> <p></p> <p>\u4f46\u662f\uff0c\u8ba9\u6211\u4eec\u4ece Linux CFS \u7684\u89d2\u5ea6\u8fdb\u884c\u601d\u8003\u5b9e\u9a8c\u3002\u4f7f\u7528 Linux CFS \u7cfb\u7edf\u65f6\u6700\u91cd\u8981\u7684\u662f\uff1a\u53ea\u6709\u7e41\u5fd9\u7684\u5bb9\u5668 (CGROUPS) \u624d\u4f1a\u8ba1\u5165\u5171\u4eab\u7cfb\u7edf\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u5bb9\u5668\u7e41\u5fd9\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u4f7f\u7528\u8282\u70b9\u4e0a\u7684\u6240\u6709 4 \u4e2a\u6838\u5fc3\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u5f88\u91cd\u8981\uff1f\u5047\u8bbe\u6211\u4eec\u5728\u5f00\u53d1\u96c6\u7fa4\u4e2d\u8fd0\u884c\u6027\u80fd\u6d4b\u8bd5\uff0c\u5728\u8be5\u96c6\u7fa4\u4e2d NGINX \u5e94\u7528\u7a0b\u5e8f\u662f\u8be5\u8282\u70b9\u4e0a\u552f\u4e00\u7e41\u5fd9\u7684\u5bb9\u5668\u3002\u5f53\u6211\u4eec\u5c06\u5e94\u7528\u7a0b\u5e8f\u79fb\u81f3\u751f\u4ea7\u73af\u5883\u65f6\uff0c\u4f1a\u53d1\u751f\u4ee5\u4e0b\u60c5\u51b5\uff1aNGINX \u5e94\u7528\u7a0b\u5e8f\u9700\u8981 4 \u4e2a vCPU \u8d44\u6e90\uff0c\u4f46\u7531\u4e8e\u8282\u70b9\u4e0a\u7684\u6240\u6709\u5176\u4ed6 Pod \u90fd\u5f88\u7e41\u5fd9\uff0c\u56e0\u6b64\u6211\u4eec\u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\u53d7\u5230\u9650\u5236\u3002</p> <p></p> <p>\u8fd9\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4\u6211\u4eec\u4e0d\u5fc5\u8981\u5730\u6dfb\u52a0\u66f4\u591a\u5bb9\u5668\uff0c\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u8ba9\u5e94\u7528\u7a0b\u5e8f\u6269\u5c55\u5230\u5176\"\u6700\u4f73\u70b9\"\u3002\u8ba9\u6211\u4eec\u66f4\u8be6\u7ec6\u5730\u63a2\u8ba8\u8fd9\u4e2a\u91cd\u8981\u7684\"\u6700\u4f73\u70b9\"\u6982\u5ff5\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#_5","title":"\u5e94\u7528\u7a0b\u5e8f\u9002\u5f53\u8c03\u6574\u5927\u5c0f","text":"<p>\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u90fd\u6709\u4e00\u4e2a\u65e0\u6cd5\u518d\u5904\u7406\u66f4\u591a\u6d41\u91cf\u7684\u70b9\u3002\u8d85\u8fc7\u8fd9\u4e2a\u70b9\u4f1a\u589e\u52a0\u5904\u7406\u65f6\u95f4\uff0c\u751a\u81f3\u5728\u8fdc\u8fdc\u8d85\u8fc7\u8fd9\u4e2a\u70b9\u65f6\u4f1a\u4e22\u5f03\u6d41\u91cf\u3002\u8fd9\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u7684\u9971\u548c\u70b9\u3002\u4e3a\u4e86\u907f\u514d\u6269\u5c55\u95ee\u9898\uff0c\u6211\u4eec\u5e94\u8be5\u5c1d\u8bd5\u5728\u5e94\u7528\u7a0b\u5e8f\u8fbe\u5230\u9971\u548c\u70b9\u4e4b\u524d\u8fdb\u884c\u6269\u5c55\u3002\u8ba9\u6211\u4eec\u79f0\u8fd9\u4e2a\u70b9\u4e3a\u6700\u4f73\u70b9\u3002</p> <p></p> <p>\u6211\u4eec\u9700\u8981\u6d4b\u8bd5\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4ee5\u4e86\u89e3\u5176\u6700\u4f73\u70b9\u3002\u8fd9\u91cc\u6ca1\u6709\u901a\u7528\u6307\u5bfc\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u90fd\u4e0d\u540c\u3002\u5728\u6b64\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u8bd5\u56fe\u4e86\u89e3\u6700\u80fd\u663e\u793a\u5e94\u7528\u7a0b\u5e8f\u9971\u548c\u70b9\u7684\u6700\u4f73\u6307\u6807\u3002\u901a\u5e38\uff0c\u5229\u7528\u7387\u6307\u6807\u7528\u4e8e\u6307\u793a\u5e94\u7528\u7a0b\u5e8f\u9971\u548c\uff0c\u4f46\u8fd9\u53ef\u80fd\u5f88\u5feb\u5bfc\u81f4\u6269\u5c55\u95ee\u9898(\u6211\u4eec\u5c06\u5728\u540e\u9762\u7684\u90e8\u5206\u8be6\u7ec6\u63a2\u8ba8\u8fd9\u4e2a\u4e3b\u9898)\u3002\u4e00\u65e6\u786e\u5b9a\u4e86\u8fd9\u4e2a\"\u6700\u4f73\u70b9\",\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u6709\u6548\u6269\u5c55\u5de5\u4f5c\u8d1f\u8f7d\u3002</p> <p>\u76f8\u53cd\uff0c\u5982\u679c\u6211\u4eec\u5728\u6700\u4f73\u70b9\u4e4b\u524d\u5c31\u5927\u89c4\u6a21\u6269\u5c55\u5e76\u521b\u5efa\u4e86\u4e0d\u5fc5\u8981\u7684 Pod\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u8ba9\u6211\u4eec\u5728\u4e0b\u4e00\u8282\u63a2\u8ba8\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#pod","title":"Pod \u6269\u6563","text":"<p>\u4e3a\u4e86\u4e86\u89e3\u521b\u5efa\u4e0d\u5fc5\u8981\u7684 Pod \u5982\u4f55\u8fc5\u901f\u5931\u63a7\uff0c\u8ba9\u6211\u4eec\u770b\u5de6\u8fb9\u7684\u7b2c\u4e00\u4e2a\u793a\u4f8b\u3002\u5f53\u5904\u7406\u6bcf\u79d2 100 \u4e2a\u8bf7\u6c42\u65f6\uff0c\u6b64\u5bb9\u5668\u7684\u6b63\u786e\u5782\u76f4\u6269\u5c55\u5927\u7ea6\u5360\u7528\u4e24\u4e2a vCPU \u7684\u5229\u7528\u7387\u3002\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u5c06\u8bf7\u6c42\u503c\u8bbe\u7f6e\u4e3a\u534a\u4e2a\u6838\u5fc3\u800c\u4f4e\u4f30\u4e86\uff0c\u6211\u4eec\u73b0\u5728\u9700\u8981\u4e3a\u6bcf\u4e2a\u5b9e\u9645\u9700\u8981\u7684 Pod \u521b\u5efa 4 \u4e2a Pod\u3002\u8fdb\u4e00\u6b65\u52a0\u5267\u8fd9\u4e2a\u95ee\u9898\u7684\u662f\uff0c\u5982\u679c\u6211\u4eec\u7684 HPA \u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u7684 50% CPU,\u90a3\u4e9b Pod \u5c06\u4ee5\u4e00\u534a\u7684\u7a7a\u95f2\u72b6\u6001\u8fdb\u884c\u6269\u5c55\uff0c\u4ece\u800c\u521b\u5efa 8\uff1a1 \u7684\u6bd4\u7387\u3002</p> <p></p> <p>\u6269\u5927\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5f88\u5feb\u5c31\u4f1a\u770b\u5230\u5b83\u662f\u5982\u4f55\u5931\u63a7\u7684\u3002\u5982\u679c\u5341\u4e2a Pod \u7684\u90e8\u7f72\u7684\u6700\u4f73\u70b9\u8bbe\u7f6e\u4e0d\u6b63\u786e\uff0c\u5f88\u5feb\u5c31\u4f1a\u6fc0\u589e\u5230 80 \u4e2a Pod \u4ee5\u53ca\u8fd0\u884c\u5b83\u4eec\u6240\u9700\u7684\u989d\u5916\u57fa\u7840\u8bbe\u65bd\u3002</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u4e86\u89e3\u4e86\u4e0d\u8ba9\u5e94\u7528\u7a0b\u5e8f\u5728\u5176\u6700\u4f73\u70b9\u8fd0\u884c\u7684\u5f71\u54cd\uff0c\u8ba9\u6211\u4eec\u56de\u5230\u8282\u70b9\u7ea7\u522b\uff0c\u95ee\u4e00\u95ee\u4e3a\u4ec0\u4e48 Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u548c Linux CFS \u4e4b\u95f4\u7684\u8fd9\u79cd\u5dee\u5f02\u5982\u6b64\u91cd\u8981\uff1f</p> <p>\u5728\u4f7f\u7528 HPA \u8fdb\u884c\u6269\u5c55\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9047\u5230\u6709\u5927\u91cf\u7a7a\u95f4\u53ef\u4ee5\u5206\u914d\u66f4\u591a Pod \u7684\u60c5\u51b5\u3002\u8fd9\u5c06\u662f\u4e00\u4e2a\u7cdf\u7cd5\u7684\u51b3\u5b9a\uff0c\u56e0\u4e3a\u5de6\u4fa7\u6240\u793a\u7684\u8282\u70b9\u5df2\u7ecf\u8fbe\u5230 100% CPU \u5229\u7528\u7387\u3002\u5728\u4e00\u79cd\u4e0d\u5207\u5b9e\u9645\u4f46\u7406\u8bba\u4e0a\u53ef\u80fd\u7684\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9047\u5230\u53e6\u4e00\u79cd\u6781\u7aef\u60c5\u51b5\uff0c\u5373\u6211\u4eec\u7684\u8282\u70b9\u5b8c\u5168\u6ee1\u8f7d\uff0c\u4f46 CPU \u5229\u7528\u7387\u4e3a\u96f6\u3002</p> <p></p>"},{"location":"zh/scalability/docs/node_efficiency/#_6","title":"\u8bbe\u7f6e\u8bf7\u6c42","text":"<p>\u5f88\u5bb9\u6613\u5c06\u8bf7\u6c42\u503c\u8bbe\u7f6e\u4e3a\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\"\u6700\u4f73\u70b9\"\u503c\uff0c\u4f46\u8fd9\u4f1a\u5bfc\u81f4\u4e0b\u56fe\u6240\u793a\u7684\u6548\u7387\u4f4e\u4e0b\u3002\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u8bf7\u6c42\u503c\u8bbe\u7f6e\u4e3a 2 \u4e2a vCPU\uff0c\u4f46\u8fd9\u4e9b Pod \u7684\u5e73\u5747\u5229\u7528\u7387\u5927\u591a\u6570\u65f6\u5019\u53ea\u6709 1 \u4e2a CPU\u3002\u8fd9\u79cd\u8bbe\u7f6e\u4f1a\u5bfc\u81f4\u6211\u4eec\u6d6a\u8d39 50% \u7684 CPU \u5468\u671f\uff0c\u8fd9\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\u3002</p> <p></p> <p>\u8fd9\u5c31\u5f15\u51fa\u4e86\u8fd9\u4e2a\u95ee\u9898\u7684\u590d\u6742\u7b54\u6848\u3002\u5bb9\u5668\u5229\u7528\u7387\u4e0d\u80fd\u88ab\u5b64\u7acb\u5730\u8003\u8651;\u5fc5\u987b\u5c06\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u8003\u8651\u5728\u5185\u3002\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u7a81\u53d1\u6027 CPU \u5229\u7528\u7387\u8f83\u9ad8\u7684\u5bb9\u5668\u4e0e\u4e24\u4e2a CPU \u5229\u7528\u7387\u8f83\u4f4e\u4f46\u53ef\u80fd\u53d7\u5185\u5b58\u9650\u5236\u7684\u5bb9\u5668\u6df7\u5408\u5728\u4e00\u8d77\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5141\u8bb8\u5bb9\u5668\u8fbe\u5230\u5176\u6700\u4f73\u70b9\uff0c\u800c\u4e0d\u4f1a\u4f7f\u8282\u70b9\u8fc7\u8f7d\u3002</p> <p></p> <p>\u9700\u8981\u7262\u8bb0\u7684\u91cd\u8981\u6982\u5ff5\u662f\uff0c\u4f7f\u7528 Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u7684\u6838\u5fc3\u6982\u5ff5\u6765\u7406\u89e3 Linux \u5bb9\u5668\u6027\u80fd\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9519\u8bef\u7684\u51b3\u7b56\uff0c\u56e0\u4e3a\u5b83\u4eec\u5e76\u4e0d\u76f8\u5173\u3002</p> <p>Tip</p> <p>Linux CFS \u6709\u5176\u5f3a\u5927\u4e4b\u5904\uff0c\u5c24\u5176\u662f\u5bf9\u4e8e I/O \u5bc6\u96c6\u578b\u5de5\u4f5c\u8d1f\u8f7d\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u5168\u6838\u5fc3\u800c\u6ca1\u6709 sidecar\uff0c\u5e76\u4e14\u6ca1\u6709 I/O \u8981\u6c42\uff0cCPU \u7ed1\u5b9a\u53ef\u4ee5\u5927\u5927\u7b80\u5316\u6b64\u8fc7\u7a0b\uff0c\u5e76\u4e14\u5728\u6709\u8fd9\u4e9b\u8b66\u544a\u7684\u60c5\u51b5\u4e0b\u662f\u9f13\u52b1\u7684\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#_7","title":"\u5229\u7528\u7387\u4e0e\u9971\u548c\u5ea6","text":"<p>\u5e94\u7528\u7a0b\u5e8f\u6269\u5c55\u4e2d\u7684\u4e00\u4e2a\u5e38\u89c1\u9519\u8bef\u662f\u4ec5\u4f7f\u7528 CPU \u5229\u7528\u7387\u4f5c\u4e3a\u6269\u5c55\u6307\u6807\u3002\u5728\u590d\u6742\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u8fd9\u51e0\u4e4e\u603b\u662f\u4e00\u4e2a\u7cdf\u7cd5\u7684\u6307\u6807\uff0c\u65e0\u6cd5\u51c6\u786e\u53cd\u6620\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u771f\u6b63\u8fbe\u5230\u4e86\u8bf7\u6c42\u9971\u548c\u3002\u5728\u5de6\u4fa7\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u770b\u5230\u6240\u6709\u8bf7\u6c42\u5b9e\u9645\u4e0a\u90fd\u51fb\u4e2d\u4e86 Web \u670d\u52a1\u5668\uff0c\u56e0\u6b64 CPU \u5229\u7528\u7387\u4e0e\u9971\u548c\u5ea6\u4e00\u81f4\u3002</p> <p>\u5728\u73b0\u5b9e\u4e16\u754c\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u5f88\u53ef\u80fd\u6709\u4e00\u4e9b\u8bf7\u6c42\u5c06\u7531\u6570\u636e\u5e93\u5c42\u6216\u8eab\u4efd\u9a8c\u8bc1\u5c42\u7b49\u670d\u52a1\u3002\u5728\u8fd9\u79cd\u66f4\u5e38\u89c1\u7684\u60c5\u51b5\u4e0b\uff0c\u8bf7\u6ce8\u610f CPU \u5e76\u672a\u4e0e\u9971\u548c\u5ea6\u4fdd\u6301\u4e00\u81f4\uff0c\u56e0\u4e3a\u8bf7\u6c42\u6b63\u5728\u7531\u5176\u4ed6\u5b9e\u4f53\u670d\u52a1\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cCPU \u662f\u4e00\u4e2a\u975e\u5e38\u7cdf\u7cd5\u7684\u9971\u548c\u5ea6\u6307\u6807\u3002</p> <p></p> <p>\u5728\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u4e2d\u4f7f\u7528\u9519\u8bef\u7684\u6307\u6807\u662f Kubernetes \u4e2d\u4e0d\u5fc5\u8981\u548c\u4e0d\u53ef\u9884\u6d4b\u6269\u5c55\u7684\u9996\u8981\u539f\u56e0\u3002\u5728\u9009\u62e9\u6b63\u786e\u7684\u9971\u548c\u5ea6\u6307\u6807\u65b9\u9762\u5fc5\u987b\u975e\u5e38\u5c0f\u5fc3\u3002\u91cd\u8981\u7684\u662f\u8981\u6ce8\u610f\uff0c\u6211\u4eec\u65e0\u6cd5\u7ed9\u51fa\u4e00\u5200\u5207\u7684\u5efa\u8bae\u3002\u6839\u636e\u6240\u4f7f\u7528\u7684\u8bed\u8a00\u548c\u5e94\u7528\u7a0b\u5e8f\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u9971\u548c\u5ea6\u6307\u6807\u5404\u4e0d\u76f8\u540c\u3002</p> <p>\u6211\u4eec\u53ef\u80fd\u8ba4\u4e3a\u8fd9\u4e2a\u95ee\u9898\u53ea\u5b58\u5728\u4e8e CPU \u5229\u7528\u7387\uff0c\u4f46\u5176\u4ed6\u5e38\u89c1\u6307\u6807\u5982\u6bcf\u79d2\u8bf7\u6c42\u6570\u4e5f\u53ef\u80fd\u9047\u5230\u5b8c\u5168\u76f8\u540c\u7684\u95ee\u9898\u3002\u8bf7\u6ce8\u610f\uff0c\u8bf7\u6c42\u4e5f\u53ef\u80fd\u4f1a\u8fdb\u5165\u6570\u636e\u5e93\u5c42\u3001\u8eab\u4efd\u9a8c\u8bc1\u5c42\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u7531\u6211\u4eec\u7684 Web \u670d\u52a1\u5668\u670d\u52a1\uff0c\u56e0\u6b64\u5b83\u662f Web \u670d\u52a1\u5668\u672c\u8eab\u771f\u6b63\u9971\u548c\u5ea6\u7684\u4e00\u4e2a\u7cdf\u7cd5\u6307\u6807\u3002</p> <p></p> <p>\u4e0d\u5e78\u7684\u662f\uff0c\u5728\u9009\u62e9\u6b63\u786e\u7684\u9971\u548c\u5ea6\u6307\u6807\u65f6\u6ca1\u6709\u7b80\u5355\u7684\u7b54\u6848\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u9700\u8981\u8003\u8651\u7684\u6307\u5bfc\u539f\u5219\uff1a</p> <ul> <li>\u4e86\u89e3\u60a8\u7684\u8bed\u8a00\u8fd0\u884c\u65f6 - \u5177\u6709\u591a\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u7684\u8bed\u8a00\u4e0e\u5355\u7ebf\u7a0b\u5e94\u7528\u7a0b\u5e8f\u7684\u53cd\u5e94\u4e0d\u540c\uff0c\u56e0\u6b64\u5bf9\u8282\u70b9\u7684\u5f71\u54cd\u4e5f\u4e0d\u540c\u3002</li> <li>\u4e86\u89e3\u6b63\u786e\u7684\u5782\u76f4\u6269\u5c55 - \u5728\u6269\u5c55\u65b0 Pod \u4e4b\u524d\uff0c\u60a8\u5e0c\u671b\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u5782\u76f4\u6269\u5c55\u4e2d\u4fdd\u7559\u591a\u5c11\u7f13\u51b2\u533a\uff1f</li> <li>\u54ea\u4e9b\u6307\u6807\u771f\u6b63\u53cd\u6620\u4e86\u60a8\u5e94\u7528\u7a0b\u5e8f\u7684\u9971\u548c\u5ea6 - Kafka \u751f\u4ea7\u8005\u7684\u9971\u548c\u5ea6\u6307\u6807\u4e0e\u590d\u6742 Web \u5e94\u7528\u7a0b\u5e8f\u7684\u6307\u6807\u4f1a\u6709\u5f88\u5927\u4e0d\u540c\u3002</li> <li>\u8282\u70b9\u4e0a\u7684\u6240\u6709\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u5982\u4f55\u76f8\u4e92\u5f71\u54cd - \u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u4e0d\u662f\u5728\u771f\u7a7a\u4e2d\u8fdb\u884c\u7684\uff0c\u8282\u70b9\u4e0a\u7684\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u4f1a\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\u3002</li> </ul> <p>\u7ed3\u675f\u672c\u8282\u65f6\uff0c\u5f88\u5bb9\u6613\u8ba4\u4e3a\u4e0a\u8ff0\u5185\u5bb9\u8fc7\u4e8e\u590d\u6742\u548c\u4e0d\u5fc5\u8981\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9047\u5230\u95ee\u9898\uff0c\u4f46\u7531\u4e8e\u67e5\u770b\u7684\u6307\u6807\u9519\u8bef\uff0c\u6211\u4eec\u65e0\u6cd5\u4e86\u89e3\u95ee\u9898\u7684\u771f\u6b63\u672c\u8d28\u3002\u5728\u4e0b\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5c06\u770b\u5230\u8fd9\u53ef\u80fd\u4f1a\u53d1\u751f\u4ec0\u4e48\u60c5\u51b5\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#_8","title":"\u8282\u70b9\u9971\u548c\u5ea6","text":"<p>\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u63a2\u8ba8\u4e86\u5e94\u7528\u7a0b\u5e8f\u9971\u548c\u5ea6\uff0c\u8ba9\u6211\u4eec\u4ece\u8282\u70b9\u7684\u89d2\u5ea6\u6765\u770b\u8fd9\u4e2a\u6982\u5ff5\u3002\u8ba9\u6211\u4eec\u770b\u770b\u4e24\u4e2a 100% \u5229\u7528\u7684 vCPU \u5728\u5229\u7528\u7387\u4e0e\u9971\u548c\u5ea6\u65b9\u9762\u7684\u533a\u522b\u3002</p> <p>\u5de6\u4fa7\u7684 vCPU 100% \u5229\u7528\uff0c\u4f46\u6ca1\u6709\u5176\u4ed6\u4efb\u52a1\u7b49\u5f85\u5728\u8be5 vCPU \u4e0a\u8fd0\u884c\uff0c\u56e0\u6b64\u4ece\u7eaf\u7406\u8bba\u4e0a\u8bb2\uff0c\u8fd9\u662f\u76f8\u5f53\u9ad8\u6548\u7684\u3002\u540c\u65f6\uff0c\u5728\u7b2c\u4e8c\u4e2a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u6709 20 \u4e2a\u5355\u7ebf\u7a0b\u5e94\u7528\u7a0b\u5e8f\u7b49\u5f85\u7531 vCPU \u5904\u7406\u3002\u73b0\u5728\u6240\u6709 20 \u4e2a\u5e94\u7528\u7a0b\u5e8f\u5728\u7b49\u5f85\u8f6e\u5230\u7531 vCPU \u5904\u7406\u65f6\u90fd\u4f1a\u7ecf\u5386\u67d0\u79cd\u5ef6\u8fdf\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u53f3\u4fa7\u7684 vCPU \u5df2\u7ecf\u9971\u548c\u3002</p> <p>\u5982\u679c\u6211\u4eec\u53ea\u67e5\u770b\u5229\u7528\u7387\uff0c\u6211\u4eec\u4e0d\u4ec5\u65e0\u6cd5\u770b\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u800c\u4e14\u53ef\u80fd\u4f1a\u5c06\u8fd9\u79cd\u5ef6\u8fdf\u5f52\u56e0\u4e8e\u4e0e\u7f51\u7edc\u65e0\u5173\u7684\u5176\u4ed6\u539f\u56e0\uff0c\u4ece\u800c\u5bfc\u81f4\u6211\u4eec\u8d70\u9519\u65b9\u5411\u3002</p> <p></p> <p>\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u589e\u52a0\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 Pod \u603b\u6570\u65f6\uff0c\u67e5\u770b\u9971\u548c\u5ea6\u6307\u6807\u800c\u4e0d\u4ec5\u4ec5\u662f\u5229\u7528\u7387\u6307\u6807\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u6211\u4eec\u5f88\u5bb9\u6613\u5ffd\u89c6\u5df2\u7ecf\u8fc7\u5ea6\u9971\u548c\u8282\u70b9\u7684\u4e8b\u5b9e\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u538b\u529b\u505c\u6ede\u4fe1\u606f\u6307\u6807\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p>PromQL - \u505c\u6ede\u7684 I/O</p> <pre><code>topk(3, ((irate(node_pressure_io_stalled_seconds_total[1m])) * 100))\n</code></pre> <p></p> <p>Note</p> <p>\u6709\u5173\u538b\u529b\u505c\u6ede\u6307\u6807\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://facebookmicrosites.github.io/psi/docs/overview*</p> <p>\u4f7f\u7528\u8fd9\u4e9b\u6307\u6807\uff0c\u6211\u4eec\u53ef\u4ee5\u4e86\u89e3\u5b9e\u4f8b\u4e0a\u6240\u6709\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85 CPU \u6216\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5728\u7b49\u5f85\u8bf8\u5982\u5185\u5b58\u6216 I/O \u4e4b\u7c7b\u7684\u8d44\u6e90\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728 1 \u5206\u949f\u7684\u65f6\u95f4\u5185\uff0c\u5b9e\u4f8b\u4e0a\u6bcf\u4e2a\u7ebf\u7a0b\u505c\u6ede\u7b49\u5f85 I/O \u7684\u767e\u5206\u6bd4\u3002</p> <pre><code>topk(3, ((irate(node_pressure_io_stalled_seconds_total[1m])) * 100))\n</code></pre> <p>\u4f7f\u7528\u6b64\u6307\u6807\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e0a\u56fe\u4e2d\u770b\u5230\uff0c\u5728\u9ad8\u5cf0\u65f6\u671f\uff0c\u5b9e\u4f8b\u4e0a\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709 45% \u7684\u65f6\u95f4\u5728\u7b49\u5f85 I/O,\u8fd9\u610f\u5473\u7740\u6211\u4eec\u5728\u90a3\u4e00\u5206\u949f\u5185\u6d6a\u8d39\u4e86\u6240\u6709\u8fd9\u4e9b CPU \u5468\u671f\u3002\u4e86\u89e3\u8fd9\u4e00\u70b9\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u91cd\u65b0\u5229\u7528\u5927\u91cf vCPU \u65f6\u95f4\uff0c\u4ece\u800c\u4f7f\u6269\u5c55\u66f4\u52a0\u9ad8\u6548\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#hpa-v2","title":"HPA V2","text":"<p>\u5efa\u8bae\u4f7f\u7528 autoscaling/v2 \u7248\u672c\u7684 HPA API\u3002\u65e7\u7248\u672c\u7684 HPA API \u5728\u67d0\u4e9b\u8fb9\u7f18\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u9677\u5165\u6269\u5c55\u56f0\u5883\u3002\u5b83\u8fd8\u9650\u5236\u4e86 Pod \u5728\u6bcf\u4e2a\u6269\u5c55\u6b65\u9aa4\u4e2d\u6700\u591a\u53ea\u80fd\u52a0\u500d\uff0c\u8fd9\u4e3a\u9700\u8981\u5feb\u901f\u6269\u5c55\u7684\u5c0f\u578b\u90e8\u7f72\u5e26\u6765\u4e86\u95ee\u9898\u3002</p> <p>Autoscaling/v2 \u5141\u8bb8\u6211\u4eec\u66f4\u7075\u6d3b\u5730\u5305\u542b\u591a\u4e2a\u6269\u5c55\u6807\u51c6\uff0c\u5e76\u5728\u4f7f\u7528\u81ea\u5b9a\u4e49\u548c\u5916\u90e8\u6307\u6807(\u975e K8s \u6307\u6807)\u65f6\u63d0\u4f9b\u66f4\u5927\u7684\u7075\u6d3b\u6027\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u4e09\u4e2a\u503c\u4e2d\u7684\u6700\u9ad8\u503c\u8fdb\u884c\u6269\u5c55(\u89c1\u4e0b\u6587)\u3002\u5982\u679c\u6240\u6709 Pod \u7684\u5e73\u5747\u5229\u7528\u7387\u8d85\u8fc7 50%,\u6216\u8005\u81ea\u5b9a\u4e49\u6307\u6807\u7684\u5165\u53e3\u6bcf\u79d2\u6570\u636e\u5305\u8d85\u8fc7\u5e73\u5747 1\uff0c000 \u4e2a\uff0c\u6216\u8005\u5165\u53e3\u5bf9\u8c61\u8d85\u8fc7\u6bcf\u79d2 10K \u4e2a\u8bf7\u6c42\uff0c\u6211\u4eec\u5c31\u4f1a\u8fdb\u884c\u6269\u5c55\u3002</p> <p>Note</p> <p>\u8fd9\u53ea\u662f\u4e3a\u4e86\u5c55\u793a\u81ea\u52a8\u6269\u5c55 API \u7684\u7075\u6d3b\u6027\uff0c\u6211\u4eec\u4e0d\u5efa\u8bae\u4f7f\u7528\u8fc7\u4e8e\u590d\u6742\u7684\u89c4\u5219\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u89c4\u5219\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5f88\u96be\u6392\u67e5\u6545\u969c\u3002</p> <pre><code>apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: php-apache\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: php-apache\n  minReplicas: 1\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 50\n  - type: Pods\n    pods:\n      metric:\n        name: packets-per-second\n      target:\n        type: AverageValue\n        averageValue: 1k\n  - type: Object\n    object:\n      metric:\n        name: requests-per-second\n      describedObject:\n        apiVersion: networking.k8s.io/v1\n        kind: Ingress\n        name: main-route\n      target:\n        type: Value\n        value: 10k\n</code></pre> <p>\u4f46\u662f\uff0c\u6211\u4eec\u4e86\u89e3\u5230\u5bf9\u4e8e\u590d\u6742\u7684 Web \u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u8fd9\u79cd\u6307\u6807\u7684\u5371\u9669\u6027\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u6700\u597d\u4f7f\u7528\u51c6\u786e\u53cd\u6620\u5e94\u7528\u7a0b\u5e8f\u9971\u548c\u5ea6\u800c\u975e\u5229\u7528\u7387\u7684\u81ea\u5b9a\u4e49\u6216\u5916\u90e8\u6307\u6807\u3002HPAv2 \u901a\u8fc7\u80fd\u591f\u6839\u636e\u4efb\u4f55\u6307\u6807\u8fdb\u884c\u6269\u5c55\u6765\u652f\u6301\u8fd9\u4e00\u70b9\uff0c\u4f46\u6211\u4eec\u4ecd\u9700\u8981\u627e\u5230\u5e76\u5c06\u8be5\u6307\u6807\u5bfc\u51fa\u5230 Kubernetes \u4f9b\u4f7f\u7528\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u770b Apache \u4e2d\u7684\u6d3b\u52a8\u7ebf\u7a0b\u961f\u5217\u8ba1\u6570\u3002\u8fd9\u901a\u5e38\u4f1a\u521b\u5efa\u4e00\u4e2a\"\u66f4\u5e73\u6ed1\"\u7684\u6269\u5c55\u914d\u7f6e\u6587\u4ef6(\u7a0d\u540e\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u8fd9\u4e2a\u672f\u8bed)\u3002\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\uff0c\u65e0\u8bba\u8be5\u7ebf\u7a0b\u662f\u5728\u7b49\u5f85\u6570\u636e\u5e93\u5c42\u8fd8\u662f\u5728\u672c\u5730\u670d\u52a1\u8bf7\u6c42\uff0c\u53ea\u8981\u5e94\u7528\u7a0b\u5e8f\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u5728\u4f7f\u7528\uff0c\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u9971\u548c\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u6307\u793a\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u7ebf\u7a0b\u8017\u5c3d\u4f5c\u4e3a\u521b\u5efa\u65b0 Pod \u7684\u4fe1\u53f7\uff0c\u65b0 Pod \u5177\u6709\u5b8c\u5168\u53ef\u7528\u7684\u7ebf\u7a0b\u6c60\u3002\u8fd9\u4e5f\u4f7f\u6211\u4eec\u80fd\u591f\u63a7\u5236\u5728\u6269\u5c55\u5e94\u7528\u7a0b\u5e8f\u65f6\u5e0c\u671b\u4fdd\u7559\u591a\u5927\u7684\u7f13\u51b2\u533a\u6765\u5438\u6536\u9ad8\u6d41\u91cf\u671f\u95f4\u7684\u6d41\u91cf\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u7684\u603b\u7ebf\u7a0b\u6c60\u4e3a 10\uff0c\u5728 4 \u4e2a\u7ebf\u7a0b\u4f7f\u7528\u65f6\u6269\u5c55\u4e0e\u5728 8 \u4e2a\u7ebf\u7a0b\u4f7f\u7528\u65f6\u6269\u5c55\u4f1a\u5bf9\u6211\u4eec\u5728\u6269\u5c55\u5e94\u7528\u7a0b\u5e8f\u65f6\u53ef\u7528\u7684\u7f13\u51b2\u533a\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\u3002\u8bbe\u7f6e\u4e3a 4 \u5c06\u9002\u5408\u9700\u8981\u5728\u9ad8\u8d1f\u8f7d\u4e0b\u5feb\u901f\u6269\u5c55\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u8bbe\u7f6e\u4e3a 8 \u5219\u66f4\u9002\u5408\u5728\u8bf7\u6c42\u6570\u91cf\u7f13\u6162\u800c\u975e\u6025\u5267\u589e\u52a0\u7684\u60c5\u51b5\u4e0b\uff0c\u4ee5\u66f4\u9ad8\u6548\u5730\u5229\u7528\u6211\u4eec\u7684\u8d44\u6e90\u3002</p> <p></p> <p>\u6211\u4eec\u6240\u8bf4\u7684\"\u5e73\u6ed1\"\u6269\u5c55\u662f\u4ec0\u4e48\u610f\u601d\uff1f\u8bf7\u6ce8\u610f\u4e0b\u56fe\uff0c\u6211\u4eec\u4f7f\u7528 CPU \u4f5c\u4e3a\u6307\u6807\u3002\u6b64\u90e8\u7f72\u4e2d\u7684 Pod \u5728\u77ed\u65f6\u95f4\u5185\u4ece 50 \u4e2a\u4e00\u76f4\u6fc0\u589e\u5230 250 \u4e2a\uff0c\u7136\u540e\u7acb\u5373\u518d\u6b21\u7f29\u51cf\u3002\u8fd9\u79cd\u6269\u5c55\u975e\u5e38\u4f4e\u6548\uff0c\u662f\u96c6\u7fa4\u5468\u8f6c\u7684\u4e3b\u8981\u539f\u56e0\u3002</p> <p></p> <p>\u8bf7\u6ce8\u610f\uff0c\u5728\u6211\u4eec\u5c06\u6307\u6807\u66f4\u6539\u4e3a\u53cd\u6620\u5e94\u7528\u7a0b\u5e8f\u6b63\u786e\u6700\u4f73\u70b9\u540e(\u56fe\u8868\u4e2d\u90e8)\uff0c\u6211\u4eec\u80fd\u591f\u5e73\u6ed1\u6269\u5c55\u3002\u6211\u4eec\u7684\u6269\u5c55\u73b0\u5728\u662f\u9ad8\u6548\u7684\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u6574\u8bf7\u6c42\u8bbe\u7f6e\u5141\u8bb8 Pod \u5b8c\u5168\u6269\u5c55\uff0c\u5e76\u63d0\u4f9b\u4e86\u4f59\u91cf\u3002\u73b0\u5728\uff0c\u4e00\u5c0f\u7ec4 Pod \u6b63\u5728\u5b8c\u6210\u4e4b\u524d\u6570\u767e\u4e2a Pod \u6240\u505a\u7684\u5de5\u4f5c\u3002\u5b9e\u9645\u6570\u636e\u8868\u660e\uff0c\u8fd9\u662f Kubernetes \u96c6\u7fa4\u53ef\u6269\u5c55\u6027\u7684\u5173\u952e\u56e0\u7d20\u3002</p> <p></p> <p>\u5173\u952e\u8981\u70b9\u662f CPU \u5229\u7528\u7387\u53ea\u662f\u5e94\u7528\u7a0b\u5e8f\u548c\u8282\u70b9\u6027\u80fd\u7684\u4e00\u4e2a\u7ef4\u5ea6\u3002\u4ec5\u4f7f\u7528 CPU \u5229\u7528\u7387\u4f5c\u4e3a\u8282\u70b9\u548c\u5e94\u7528\u7a0b\u5e8f\u5065\u5eb7\u72b6\u51b5\u7684\u6307\u6807\u4f1a\u5728\u6269\u5c55\u3001\u6027\u80fd\u548c\u6210\u672c\u65b9\u9762\u9020\u6210\u95ee\u9898\uff0c\u800c\u8fd9\u4e09\u4e2a\u6982\u5ff5\u662f\u5bc6\u5207\u76f8\u5173\u7684\u3002\u5e94\u7528\u7a0b\u5e8f\u548c\u8282\u70b9\u7684\u6027\u80fd\u8d8a\u9ad8\uff0c\u9700\u8981\u6269\u5c55\u7684\u7a0b\u5ea6\u5c31\u8d8a\u4f4e\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u6210\u672c\u3002</p> <p>\u627e\u5230\u5e76\u4f7f\u7528\u6b63\u786e\u7684\u9971\u548c\u5ea6\u6307\u6807\u6765\u6269\u5c55\u7279\u5b9a\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd8\u5141\u8bb8\u60a8\u76d1\u63a7\u548c\u62a5\u8b66\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\u771f\u6b63\u74f6\u9888\u3002\u5982\u679c\u8df3\u8fc7\u8fd9\u4e00\u5173\u952e\u6b65\u9aa4\uff0c\u5c31\u5f88\u96be\u751a\u81f3\u4e0d\u53ef\u80fd\u7406\u89e3\u6027\u80fd\u95ee\u9898\u7684\u62a5\u544a\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#cpu","title":"\u8bbe\u7f6e CPU \u9650\u5236","text":"<p>\u4e3a\u4e86\u603b\u7ed3\u672c\u8282\u5173\u4e8e\u88ab\u8bef\u89e3\u7684\u4e3b\u9898\uff0c\u6211\u4eec\u5c06\u4ecb\u7ecd CPU \u9650\u5236\u3002\u7b80\u800c\u8a00\u4e4b\uff0c\u9650\u5236\u662f\u4e0e\u5bb9\u5668\u5173\u8054\u7684\u5143\u6570\u636e\uff0c\u5b83\u6709\u4e00\u4e2a\u6bcf 100 \u6beb\u79d2\u91cd\u7f6e\u4e00\u6b21\u7684\u8ba1\u6570\u5668\u3002\u8fd9\u6709\u52a9\u4e8e Linux \u8ddf\u8e2a\u7279\u5b9a\u5bb9\u5668\u5728 100 \u6beb\u79d2\u65f6\u95f4\u6bb5\u5185\u5728\u8282\u70b9\u8303\u56f4\u5185\u4f7f\u7528\u4e86\u591a\u5c11 CPU \u8d44\u6e90\u3002</p> <p></p> <p>\u8bbe\u7f6e\u9650\u5236\u65f6\u7684\u4e00\u4e2a\u5e38\u89c1\u9519\u8bef\u662f\u5047\u8bbe\u5e94\u7528\u7a0b\u5e8f\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u5e76\u4e14\u53ea\u5728\u5176\"\u5206\u914d\u7684\" vCPU \u4e0a\u8fd0\u884c\u3002\u5728\u4e0a\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u4e86\u89e3\u5230 CFS \u4e0d\u4f1a\u5206\u914d\u6838\u5fc3\uff0c\u5b9e\u9645\u4e0a\uff0c\u8fd0\u884c\u5927\u578b\u7ebf\u7a0b\u6c60\u7684\u5bb9\u5668\u4f1a\u5728\u76d2\u5b50\u4e0a\u7684\u6240\u6709\u53ef\u7528 vCPU \u4e0a\u8c03\u5ea6\u3002</p> <p>\u5982\u679c 64 \u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u8de8 64 \u4e2a\u53ef\u7528\u6838\u5fc3(\u4ece Linux \u8282\u70b9\u7684\u89d2\u5ea6)\u8fd0\u884c\uff0c\u6211\u4eec\u5c06\u5728 100 \u6beb\u79d2\u65f6\u95f4\u6bb5\u5185\u7d2f\u8ba1\u76f8\u5f53\u5927\u7684\u5df2\u7528 CPU \u65f6\u95f4\u603b\u91cf\uff0c\u56e0\u4e3a\u5728\u6240\u6709\u8fd9 64 \u4e2a\u6838\u5fc3\u4e0a\u8fd0\u884c\u7684\u65f6\u95f4\u90fd\u4f1a\u7d2f\u52a0\u3002\u7531\u4e8e\u8fd9\u53ef\u80fd\u53ea\u4f1a\u5728\u5783\u573e\u56de\u6536\u8fc7\u7a0b\u4e2d\u53d1\u751f\uff0c\u56e0\u6b64\u5f88\u5bb9\u6613\u9519\u8fc7\u8fd9\u79cd\u60c5\u51b5\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u5728\u5c1d\u8bd5\u8bbe\u7f6e\u9650\u5236\u4e4b\u524d\uff0c\u4f7f\u7528\u6307\u6807\u786e\u4fdd\u6211\u4eec\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u6709\u6b63\u786e\u7684\u4f7f\u7528\u60c5\u51b5\u662f\u5fc5\u8981\u7684\u3002</p> <p>\u5e78\u8fd0\u7684\u662f\uff0c\u6211\u4eec\u6709\u4e00\u79cd\u65b9\u6cd5\u53ef\u4ee5\u51c6\u786e\u67e5\u770b\u5e94\u7528\u7a0b\u5e8f\u4e2d\u6240\u6709\u7ebf\u7a0b\u6b63\u5728\u4f7f\u7528\u591a\u5c11 vCPU\u3002\u6211\u4eec\u5c06\u4f7f\u7528\u6307\u6807 <code>container_cpu_usage_seconds_total</code> \u6765\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002</p> <p>\u7531\u4e8e\u8282\u6d41\u903b\u8f91\u6bcf 100 \u6beb\u79d2\u53d1\u751f\u4e00\u6b21\uff0c\u800c\u8fd9\u4e2a\u6307\u6807\u662f\u6bcf\u79d2\u6307\u6807\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 PromQL \u6765\u5339\u914d\u8fd9\u4e2a 100 \u6beb\u79d2\u7684\u65f6\u95f4\u6bb5\u3002\u5982\u679c\u60a8\u60f3\u6df1\u5165\u4e86\u89e3\u8fd9\u4e2a PromQL \u8bed\u53e5\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b \u535a\u5ba2\u3002</p> <p>PromQL \u67e5\u8be2\uff1a</p> <pre><code>topk(3, max by (pod, container)(rate(container_cpu_usage_seconds_total{image!=\"\", instance=\"$instance\"}[$__rate_interval]))) / 10\n</code></pre> <p></p> <p>\u4e00\u65e6\u6211\u4eec\u89c9\u5f97\u6709\u4e86\u6b63\u786e\u7684\u503c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8bbe\u7f6e\u9650\u5236\u3002\u7136\u540e\uff0c\u6709\u5fc5\u8981\u67e5\u770b\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u7531\u4e8e\u67d0\u4e9b\u610f\u5916\u539f\u56e0\u800c\u53d7\u5230\u8282\u6d41\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b <code>container_cpu_throttled_seconds_total</code> \u6765\u505a\u5230\u8fd9\u4e00\u70b9</p> <pre><code>topk(3, max by (pod, container)(rate(container_cpu_cfs_throttled_seconds_total{image!=``\"\"``, instance=``\"$instance\"``}[$__rate_interval]))) / 10\n</code></pre> <p></p>"},{"location":"zh/scalability/docs/node_efficiency/#_9","title":"\u5185\u5b58","text":"<p>\u5185\u5b58\u5206\u914d\u662f\u53e6\u4e00\u4e2a\u5bb9\u6613\u5c06 Kubernetes \u8c03\u5ea6\u884c\u4e3a\u4e0e Linux CGroup \u884c\u4e3a\u6df7\u6dc6\u7684\u793a\u4f8b\u3002\u8fd9\u662f\u4e00\u4e2a\u66f4\u5fae\u5999\u7684\u4e3b\u9898\uff0c\u56e0\u4e3a Linux \u4e2d\u7684 CGroup v2 \u5728\u5904\u7406\u5185\u5b58\u65b9\u9762\u53d1\u751f\u4e86\u91cd\u5927\u53d8\u5316\uff0cKubernetes \u4e5f\u76f8\u5e94\u5730\u66f4\u6539\u4e86\u5176\u8bed\u6cd5;\u8bf7\u9605\u8bfb\u8fd9\u7bc7 \u535a\u5ba2 \u4ee5\u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002</p> <p>\u4e0e CPU \u8bf7\u6c42\u4e0d\u540c\uff0c\u5185\u5b58\u8bf7\u6c42\u5728\u8c03\u5ea6\u8fc7\u7a0b\u5b8c\u6210\u540e\u5c31\u4e0d\u518d\u4f7f\u7528\u3002\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u65e0\u6cd5\u50cf CPU \u90a3\u6837\u5728 CGroup v1 \u4e2d\u538b\u7f29\u5185\u5b58\u3002\u8fd9\u5c31\u53ea\u5269\u4e0b\u5185\u5b58\u9650\u5236\uff0c\u5b83\u65e8\u5728\u901a\u8fc7\u7ec8\u6b62 Pod \u6765\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\uff0c\u8fd9\u662f\u4e00\u79cd\u5168\u6709\u6216\u5168\u65e0\u7684\u65b9\u5f0f\uff0c\u4f46\u73b0\u5728\u6211\u4eec\u6709\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u65b0\u65b9\u6cd5\u3002</p> <p>\u9996\u5148\uff0c\u91cd\u8981\u7684\u662f\u8981\u7406\u89e3\u4e3a\u5bb9\u5668\u8bbe\u7f6e\u6b63\u786e\u7684\u5185\u5b58\u91cf\u5e76\u4e0d\u50cf\u770b\u4e0a\u53bb\u90a3\u4e48\u7b80\u5355\u3002Linux \u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u4f1a\u5c06\u5185\u5b58\u7528\u4f5c\u7f13\u5b58\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\u8fd9\u4e2a\u7f13\u5b58\u4f1a\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u800c\u589e\u957f\uff0c\u5f88\u96be\u77e5\u9053\u591a\u5c11\u5185\u5b58\u53ea\u662f\u4e3a\u4e86\u7f13\u5b58\u800c\u5f88\u597d\uff0c\u4f46\u53ef\u4ee5\u5728\u4e0d\u663e\u8457\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u7684\u60c5\u51b5\u4e0b\u56de\u6536\u3002\u8fd9\u5f80\u5f80\u4f1a\u5bfc\u81f4\u8bef\u89e3\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u80fd\u591f\"\u538b\u7f29\"\u5185\u5b58\u662f\u63a8\u52a8 CGroup v2 \u8bde\u751f\u7684\u4e3b\u8981\u539f\u56e0\u4e4b\u4e00\u3002\u6709\u5173\u4e3a\u4ec0\u4e48\u9700\u8981 CGroup V2 \u7684\u66f4\u591a\u5386\u53f2\u80cc\u666f\uff0c\u8bf7\u53c2\u9605 Chris Down \u5728 LISA21 \u4e0a\u7684 \u6f14\u8bb2,\u4ed6\u5728\u5176\u4e2d\u8bb2\u8ff0\u4e86\u65e0\u6cd5\u6b63\u786e\u8bbe\u7f6e\u6700\u5c0f\u5185\u5b58\u662f\u4fc3\u4f7f\u4ed6\u521b\u5efa CGroup v2 \u548c\u538b\u529b\u505c\u6ede\u6307\u6807\u7684\u539f\u56e0\u4e4b\u4e00\u3002</p> <p>\u5e78\u8fd0\u7684\u662f\uff0cKubernetes \u73b0\u5728\u6709\u4e86 <code>memory.min</code> \u548c <code>memory.high</code> \u7684\u6982\u5ff5\uff0c\u4f4d\u4e8e <code>requests.memory</code> \u4e0b\u3002\u8fd9\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u79ef\u6781\u91ca\u653e\u6b64\u7f13\u5b58\u5185\u5b58\u4ee5\u4f9b\u5176\u4ed6\u5bb9\u5668\u4f7f\u7528\u7684\u9009\u9879\u3002\u4e00\u65e6\u5bb9\u5668\u8fbe\u5230\u5185\u5b58\u9ad8\u9650\u5236\uff0c\u5185\u6838\u5c31\u53ef\u4ee5\u79ef\u6781\u56de\u6536\u8be5\u5bb9\u5668\u7684\u5185\u5b58\uff0c\u76f4\u5230\u8fbe\u5230\u8bbe\u7f6e\u7684 <code>memory.min</code> \u503c\u3002\u56e0\u6b64\uff0c\u5f53\u8282\u70b9\u5185\u5b58\u538b\u529b\u8f83\u5927\u65f6\uff0c\u6211\u4eec\u6709\u4e86\u66f4\u591a\u7684\u7075\u6d3b\u6027\u3002</p> <p>\u5173\u952e\u95ee\u9898\u662f\u5c06 <code>memory.min</code> \u8bbe\u7f6e\u4e3a\u4ec0\u4e48\u503c\uff1f\u8fd9\u5c31\u662f\u5185\u5b58\u538b\u529b\u505c\u6ede\u6307\u6807\u53d1\u6325\u4f5c\u7528\u7684\u5730\u65b9\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u6307\u6807\u6765\u68c0\u6d4b\u5bb9\u5668\u7ea7\u522b\u7684\u5185\u5b58\"\u6296\u52a8\"\u3002\u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982 fbtax \u4e4b\u7c7b\u7684\u63a7\u5236\u5668\uff0c\u901a\u8fc7\u67e5\u770b\u8fd9\u79cd\u5185\u5b58\u6296\u52a8\u6765\u68c0\u6d4b <code>memory.min</code> \u7684\u6b63\u786e\u503c\uff0c\u5e76\u52a8\u6001\u8bbe\u7f6e <code>memory.min</code> \u503c\u4e3a\u6b64\u8bbe\u7f6e\u3002</p>"},{"location":"zh/scalability/docs/node_efficiency/#_10","title":"\u603b\u7ed3","text":"<p>\u603b\u800c\u8a00\u4e4b\uff0c\u5f88\u5bb9\u6613\u6df7\u6dc6\u4ee5\u4e0b\u6982\u5ff5\uff1a</p> <ul> <li>\u5229\u7528\u7387\u548c\u9971\u548c\u5ea6</li> <li>Linux \u6027\u80fd\u89c4\u5219\u4e0e Kubernetes \u8c03\u5ea6\u7a0b\u5e8f\u903b\u8f91</li> </ul> <p>\u5fc5\u987b\u975e\u5e38\u5c0f\u5fc3\u5730\u533a\u5206\u8fd9\u4e9b\u6982\u5ff5\u3002\u6027\u80fd\u548c\u89c4\u6a21\u5728\u6df1\u5c42\u6b21\u4e0a\u662f\u76f8\u4e92\u5173\u8054\u7684\u3002\u4e0d\u5fc5\u8981\u7684\u6269\u5c55\u4f1a\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\uff0c\u800c\u6027\u80fd\u95ee\u9898\u53c8\u4f1a\u5bfc\u81f4\u6269\u5c55\u95ee\u9898\u3002</p>"},{"location":"zh/scalability/docs/quotas/","title":"\u5df2\u77e5\u9650\u5236\u548c\u670d\u52a1\u914d\u989d","text":"<p>Amazon EKS \u53ef\u7528\u4e8e\u5404\u79cd\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e0e\u5e7f\u6cdb\u7684 AWS \u670d\u52a1\u8fdb\u884c\u4ea4\u4e92\uff0c\u6211\u4eec\u5df2\u7ecf\u770b\u5230\u5ba2\u6237\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9047\u5230\u4e86\u7c7b\u4f3c\u8303\u56f4\u7684 AWS \u670d\u52a1\u914d\u989d\u548c\u5176\u4ed6\u963b\u788d\u53ef\u6269\u5c55\u6027\u7684\u95ee\u9898\u3002</p> <p>\u60a8\u7684 AWS \u8d26\u6237\u6709\u9ed8\u8ba4\u914d\u989d(\u60a8\u7684\u56e2\u961f\u53ef\u4ee5\u8bf7\u6c42\u7684\u6bcf\u79cd AWS \u8d44\u6e90\u7684\u4e0a\u9650\u6570\u91cf)\u3002\u6bcf\u4e2a AWS \u670d\u52a1\u90fd\u5b9a\u4e49\u4e86\u81ea\u5df1\u7684\u914d\u989d\uff0c\u5e76\u4e14\u914d\u989d\u901a\u5e38\u662f\u7279\u5b9a\u4e8e\u533a\u57df\u7684\u3002\u60a8\u53ef\u4ee5\u8bf7\u6c42\u589e\u52a0\u67d0\u4e9b\u914d\u989d(\u8f6f\u9650\u5236)\uff0c\u800c\u5176\u4ed6\u914d\u989d\u5219\u65e0\u6cd5\u589e\u52a0(\u786c\u9650\u5236)\u3002\u5728\u8bbe\u8ba1\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u60a8\u5e94\u8be5\u8003\u8651\u8fd9\u4e9b\u503c\u3002\u8003\u8651\u5b9a\u671f\u5ba1\u67e5\u8fd9\u4e9b\u670d\u52a1\u9650\u5236\uff0c\u5e76\u5728\u5e94\u7528\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\u52a0\u4ee5\u8003\u8651\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728 AWS \u670d\u52a1\u914d\u989d\u63a7\u5236\u53f0\u4e2d\u67e5\u770b\u60a8\u8d26\u6237\u7684\u4f7f\u7528\u60c5\u51b5\u5e76\u6253\u5f00\u914d\u989d\u589e\u52a0\u8bf7\u6c42\uff0c\u6216\u4f7f\u7528 AWS CLI\u3002\u6709\u5173\u670d\u52a1\u914d\u989d\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u4ee5\u53ca\u4efb\u4f55\u8fdb\u4e00\u6b65\u7684\u9650\u5236\u6216\u589e\u52a0\u901a\u77e5\uff0c\u8bf7\u53c2\u9605\u5404\u4e2a AWS \u670d\u52a1\u7684 AWS \u6587\u6863\u3002</p> <p>Note</p> <p>Amazon EKS \u670d\u52a1\u914d\u989d\u5217\u51fa\u4e86\u670d\u52a1\u914d\u989d\uff0c\u5e76\u63d0\u4f9b\u4e86\u53ef\u7528\u4e8e\u8bf7\u6c42\u589e\u52a0\u914d\u989d\u7684\u94fe\u63a5\u3002</p>"},{"location":"zh/scalability/docs/quotas/#aws","title":"\u5176\u4ed6 AWS \u670d\u52a1\u914d\u989d","text":"<p>\u6211\u4eec\u5df2\u7ecf\u770b\u5230 EKS \u5ba2\u6237\u53d7\u5230\u4e86\u4e0b\u5217\u5176\u4ed6 AWS \u670d\u52a1\u7684\u914d\u989d\u5f71\u54cd\u3002\u5176\u4e2d\u4e00\u4e9b\u53ef\u80fd\u4ec5\u9002\u7528\u4e8e\u7279\u5b9a\u7684\u7528\u4f8b\u6216\u914d\u7f6e\uff0c\u4f46\u662f\u60a8\u53ef\u80fd\u9700\u8981\u8003\u8651\u60a8\u7684\u89e3\u51b3\u65b9\u6848\u5728\u6269\u5c55\u65f6\u662f\u5426\u4f1a\u9047\u5230\u8fd9\u4e9b\u914d\u989d\u3002\u914d\u989d\u6309\u670d\u52a1\u7ec4\u7ec7\uff0c\u6bcf\u4e2a\u914d\u989d\u90fd\u6709\u4e00\u4e2a\u683c\u5f0f\u4e3a L-XXXXXXXX \u7684 ID\uff0c\u60a8\u53ef\u4ee5\u5728 AWS \u670d\u52a1\u914d\u989d\u63a7\u5236\u53f0\u4e2d\u67e5\u627e\u3002</p> \u670d\u52a1 \u914d\u989d (L-xxxxx) \u5f71\u54cd ID (L-xxxxx) \u9ed8\u8ba4\u503c IAM \u6bcf\u4e2a\u8d26\u6237\u7684\u89d2\u8272\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u8d26\u6237\u4e2d\u7684\u96c6\u7fa4\u6216 IRSA \u89d2\u8272\u6570\u91cf\u3002 L-FE177D64 1,000 IAM \u6bcf\u4e2a\u8d26\u6237\u7684 OpenId Connect \u63d0\u4f9b\u7a0b\u5e8f\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u6bcf\u4e2a\u8d26\u6237\u7684\u96c6\u7fa4\u6570\u91cf\uff0cIRSA \u4f7f\u7528\u4e86 OpenID Connect\u3002 L-858F3967 100 IAM \u89d2\u8272\u4fe1\u4efb\u7b56\u7565\u957f\u5ea6 \u53ef\u80fd\u4f1a\u9650\u5236\u4e00\u4e2a IAM \u89d2\u8272\u4e0e IRSA \u5173\u8054\u7684\u96c6\u7fa4\u6570\u91cf\u3002 L-C07B4B0D 2,048 VPC \u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684\u5b89\u5168\u7ec4\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\u3002 L-2AFB9258 5 VPC \u6bcf\u4e2a VPC \u7684 IPv4 CIDR \u5757\u6570 \u53ef\u80fd\u4f1a\u9650\u5236 EKS Worker \u8282\u70b9\u7684\u6570\u91cf\u3002 L-83CA0A9D 5 VPC \u6bcf\u4e2a\u8def\u7531\u8868\u7684\u8def\u7531\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\u3002 L-93826ACB 50 VPC \u6bcf\u4e2a VPC \u7684\u6d3b\u52a8 VPC \u5bf9\u7b49\u8fde\u63a5\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\u3002 L-7E9ECCDB 50 VPC \u6bcf\u4e2a\u5b89\u5168\u7ec4\u7684\u5165\u7ad9\u6216\u51fa\u7ad9\u89c4\u5219\u6570\u3002 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\uff0cEKS \u4e2d\u7684\u4e00\u4e9b\u63a7\u5236\u5668\u4f1a\u521b\u5efa\u65b0\u89c4\u5219\u3002 L-0EA8095F 50 VPC \u6bcf\u4e2a\u533a\u57df\u7684 VPC \u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u6bcf\u4e2a\u8d26\u6237\u7684\u96c6\u7fa4\u6570\u91cf\u6216\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\u3002 L-F678F1CE 5 VPC \u6bcf\u4e2a\u533a\u57df\u7684\u4e92\u8054\u7f51\u7f51\u5173\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u6bcf\u4e2a\u8d26\u6237\u7684\u96c6\u7fa4\u6570\u91cf\u6216\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\u3002 L-A4707A72 5 VPC \u6bcf\u4e2a\u533a\u57df\u7684\u7f51\u7edc\u63a5\u53e3\u6570 \u53ef\u80fd\u4f1a\u9650\u5236 EKS Worker \u8282\u70b9\u7684\u6570\u91cf\uff0c\u6216\u5f71\u54cd EKS \u63a7\u5236\u5e73\u9762\u7684\u6269\u5c55/\u66f4\u65b0\u6d3b\u52a8\u3002 L-DF5E4CA3 5,000 VPC \u7f51\u7edc\u5730\u5740\u4f7f\u7528\u60c5\u51b5 \u53ef\u80fd\u4f1a\u9650\u5236\u6bcf\u4e2a\u8d26\u6237\u7684\u96c6\u7fa4\u6570\u91cf\u6216\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\u3002 L-BB24F6E5 64,000 VPC \u5bf9\u7b49\u7f51\u7edc\u5730\u5740\u4f7f\u7528\u60c5\u51b5 \u53ef\u80fd\u4f1a\u9650\u5236\u6bcf\u4e2a\u8d26\u6237\u7684\u96c6\u7fa4\u6570\u91cf\u6216\u96c6\u7fa4\u7f51\u7edc\u7684\u63a7\u5236\u6216\u8fde\u63a5\u3002 L-CD17FD4B 128,000 ELB \u6bcf\u4e2a\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u76d1\u542c\u5668\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-57A373D6 50 ELB \u6bcf\u4e2a\u533a\u57df\u7684\u76ee\u6807\u7ec4\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-B22855CB 3,000 ELB \u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u76ee\u6807\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-7E6692B2 1,000 ELB \u6bcf\u4e2a\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u76ee\u6807\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-EEF1AD04 3,000 ELB \u6bcf\u4e2a\u53ef\u7528\u533a\u57df\u6bcf\u4e2a\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u76ee\u6807\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-B211E961 500 ELB \u6bcf\u4e2a\u533a\u57df\u6bcf\u4e2a\u76ee\u6807\u7ec4\u7684\u76ee\u6807\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-A0D0B863 1,000 ELB \u6bcf\u4e2a\u533a\u57df\u7684\u5e94\u7528\u7a0b\u5e8f\u8d1f\u8f7d\u5747\u8861\u5668\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-53DA6B97 50 ELB \u6bcf\u4e2a\u533a\u57df\u7684\u7ecf\u5178\u8d1f\u8f7d\u5747\u8861\u5668\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-E9E9831D 20 ELB \u6bcf\u4e2a\u533a\u57df\u7684\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u5165\u53e3\u6d41\u91cf\u7684\u63a7\u5236\u3002 L-69A177A2 50 EC2 \u6b63\u5728\u8fd0\u884c\u7684\u6309\u9700\u6807\u51c6 (A\u3001C\u3001D\u3001H\u3001I\u3001M\u3001R\u3001T\u3001Z) \u5b9e\u4f8b (\u4ee5\u6700\u5927 vCPU \u8ba1\u6570) \u53ef\u80fd\u4f1a\u9650\u5236 EKS Worker \u8282\u70b9\u7684\u6570\u91cf\u3002 L-1216C47A 5 EC2 \u6240\u6709\u6807\u51c6 (A\u3001C\u3001D\u3001H\u3001I\u3001M\u3001R\u3001T\u3001Z) Spot \u5b9e\u4f8b\u8bf7\u6c42 (\u4ee5\u6700\u5927 vCPU \u8ba1\u6570) \u53ef\u80fd\u4f1a\u9650\u5236 EKS Worker \u8282\u70b9\u7684\u6570\u91cf\u3002 L-34B43A08 5 EC2 EC2-VPC \u5f39\u6027 IP \u53ef\u80fd\u4f1a\u9650\u5236 NAT \u7f51\u5173\u7684\u6570\u91cf(\u4ece\u800c\u9650\u5236 VPC \u7684\u6570\u91cf)\uff0c\u8fd9\u53ef\u80fd\u4f1a\u9650\u5236\u4e00\u4e2a\u533a\u57df\u4e2d\u7684\u96c6\u7fa4\u6570\u91cf\u3002 L-0263D0A3 5 EBS \u6bcf\u4e2a\u533a\u57df\u7684\u5feb\u7167\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u6709\u72b6\u6001\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5907\u4efd\u7b56\u7565\u3002 L-309BACF6 100,000 EBS \u901a\u7528 SSD (gp3) \u5377\u7684\u5b58\u50a8\u91cf\uff0c\u4ee5 TiB \u4e3a\u5355\u4f4d \u53ef\u80fd\u4f1a\u9650\u5236 EKS Worker \u8282\u70b9\u7684\u6570\u91cf\u6216 PersistentVolume \u5b58\u50a8\u3002 L-7A658B76 50 EBS \u901a\u7528 SSD (gp2) \u5377\u7684\u5b58\u50a8\u91cf\uff0c\u4ee5 TiB \u4e3a\u5355\u4f4d \u53ef\u80fd\u4f1a\u9650\u5236 EKS Worker \u8282\u70b9\u7684\u6570\u91cf\u6216 PersistentVolume \u5b58\u50a8\u3002 L-D18FCD1D 50 ECR \u5df2\u6ce8\u518c\u7684\u5b58\u50a8\u5e93\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6570\u91cf\u3002 L-CFEB8E8D 10,000 ECR \u6bcf\u4e2a\u5b58\u50a8\u5e93\u7684\u955c\u50cf\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6570\u91cf\u3002 L-03A36CE1 10,000 SecretsManager \u6bcf\u4e2a\u533a\u57df\u7684\u5bc6\u94a5\u6570 \u53ef\u80fd\u4f1a\u9650\u5236\u96c6\u7fa4\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6570\u91cf\u3002 L-2F66C23C 500,000"},{"location":"zh/scalability/docs/quotas/#aws_1","title":"AWS \u8bf7\u6c42\u8282\u6d41","text":"<p>AWS \u670d\u52a1\u8fd8\u5b9e\u73b0\u4e86\u8bf7\u6c42\u8282\u6d41\uff0c\u4ee5\u786e\u4fdd\u5b83\u4eec\u5bf9\u6240\u6709\u5ba2\u6237\u4fdd\u6301\u9ad8\u6027\u80fd\u548c\u53ef\u7528\u6027\u3002\u4e0e\u670d\u52a1\u914d\u989d\u7c7b\u4f3c\uff0c\u6bcf\u4e2a AWS \u670d\u52a1\u90fd\u7ef4\u62a4\u81ea\u5df1\u7684\u8bf7\u6c42\u8282\u6d41\u9608\u503c\u3002\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981\u5feb\u901f\u53d1\u51fa\u5927\u91cf API \u8c03\u7528\u6216\u8005\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u51fa\u73b0\u8bf7\u6c42\u8282\u6d41\u9519\u8bef\uff0c\u8bf7\u8003\u8651\u67e5\u770b\u76f8\u5e94\u7684 AWS \u670d\u52a1\u6587\u6863\u3002</p> <p>\u5728\u5927\u578b\u96c6\u7fa4\u4e2d\u6216\u96c6\u7fa4\u5927\u5e45\u6269\u5c55\u65f6\uff0c\u56f4\u7ed5\u914d\u7f6e EC2 \u7f51\u7edc\u63a5\u53e3\u6216 IP \u5730\u5740\u7684 EC2 API \u8bf7\u6c42\u53ef\u80fd\u4f1a\u9047\u5230\u8bf7\u6c42\u8282\u6d41\u3002\u4e0b\u8868\u663e\u793a\u4e86\u6211\u4eec\u770b\u5230\u5ba2\u6237\u9047\u5230\u8bf7\u6c42\u8282\u6d41\u7684\u4e00\u4e9b API \u64cd\u4f5c\u3002 \u60a8\u53ef\u4ee5\u5728 EC2 \u6587\u6863\u5173\u4e8e\u901f\u7387\u9650\u5236\u4e2d\u67e5\u770b EC2 \u901f\u7387\u9650\u5236\u9ed8\u8ba4\u503c\u548c\u8bf7\u6c42\u589e\u52a0\u901f\u7387\u9650\u5236\u7684\u6b65\u9aa4\u3002</p> \u53ef\u53d8\u64cd\u4f5c \u53ea\u8bfb\u64cd\u4f5c AssignPrivateIpAddresses DescribeDhcpOptions AttachNetworkInterface DescribeInstances CreateNetworkInterface DescribeNetworkInterfaces DeleteNetworkInterface DescribeSecurityGroups DeleteTags DescribeTags DetachNetworkInterface DescribeVpcs ModifyNetworkInterfaceAttribute DescribeVolumes UnassignPrivateIpAddresses"},{"location":"zh/scalability/docs/quotas/#_2","title":"\u5176\u4ed6\u5df2\u77e5\u9650\u5236","text":"<ul> <li> <p>Route 53 DNS \u89e3\u6790\u5668\u9650\u5236\u4e3a \u6bcf\u79d2 1024 \u4e2a\u6570\u636e\u5305\u3002\u5f53\u6765\u81ea\u5927\u578b\u96c6\u7fa4\u7684 DNS \u6d41\u91cf\u901a\u8fc7\u5c11\u91cf CoreDNS Pod \u526f\u672c\u65f6\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u6b64\u9650\u5236\u3002\u6269\u5c55 CoreDNS \u548c\u4f18\u5316 DNS \u884c\u4e3a\u53ef\u4ee5\u907f\u514d DNS \u67e5\u627e\u8d85\u65f6\u3002</p> <ul> <li>Route 53 \u5bf9 Route 53 API \u7684\u901f\u7387\u9650\u5236\u4e5f\u76f8\u5f53\u4f4e\uff0c\u4e3a\u6bcf\u79d2 5 \u4e2a\u8bf7\u6c42\u3002\u5982\u679c\u60a8\u6709\u5927\u91cf\u57df\u9700\u8981\u4f7f\u7528 External DNS \u7b49\u9879\u76ee\u8fdb\u884c\u66f4\u65b0\uff0c\u60a8\u53ef\u80fd\u4f1a\u770b\u5230\u901f\u7387\u9650\u5236\u548c\u5ef6\u8fdf\u66f4\u65b0\u57df\u3002</li> </ul> </li> <li> <p>\u4e00\u4e9b Nitro \u5b9e\u4f8b\u7c7b\u578b\u7684\u5377\u9644\u52a0\u9650\u5236\u4e3a 28,\u8fd9\u4e2a\u9650\u5236\u5728 Amazon EBS \u5377\u3001\u7f51\u7edc\u63a5\u53e3\u548c NVMe \u5b9e\u4f8b\u5b58\u50a8\u5377\u4e4b\u95f4\u5171\u4eab\u3002\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6302\u8f7d\u4e86\u5927\u91cf EBS \u5377\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230\u8fd9\u4e9b\u5b9e\u4f8b\u7c7b\u578b\u7684 Pod \u5bc6\u5ea6\u9650\u5236\u3002</p> </li> <li> <p>\u6bcf\u4e2a Ec2 \u5b9e\u4f8b\u53ef\u4ee5\u8ddf\u8e2a\u7684\u8fde\u63a5\u6570\u6709\u6700\u5927\u503c\u3002\u5982\u679c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5904\u7406\u5927\u91cf\u8fde\u63a5\uff0c\u60a8\u53ef\u80fd\u4f1a\u770b\u5230\u901a\u4fe1\u5931\u8d25\u6216\u9519\u8bef\uff0c\u56e0\u4e3a\u5df2\u8fbe\u5230\u6b64\u6700\u5927\u503c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>conntrack_allowance_available</code> \u548c <code>conntrack_allowance_exceeded</code> \u7f51\u7edc\u6027\u80fd\u6307\u6807\u6765\u76d1\u63a7 EKS worker \u8282\u70b9\u4e0a\u7684\u8ddf\u8e2a\u8fde\u63a5\u6570\u3002</p> </li> <li> <p>\u5728 EKS \u73af\u5883\u4e2d\uff0cetcd \u5b58\u50a8\u9650\u5236\u4e3a 8 GiB,\u8fd9\u7b26\u5408 \u4e0a\u6e38\u6307\u5bfc\u3002\u8bf7\u76d1\u63a7\u6307\u6807 <code>etcd_db_total_size_in_bytes</code> \u4ee5\u8ddf\u8e2a etcd \u6570\u636e\u5e93\u5927\u5c0f\u3002\u60a8\u53ef\u4ee5\u53c2\u8003 \u8b66\u62a5\u89c4\u5219 <code>etcdBackend QuotaLowSpace</code> \u548c <code>etcdExcessiveDatabaseGrowth</code> \u6765\u8bbe\u7f6e\u6b64\u76d1\u63a7\u3002</p> </li> </ul>"},{"location":"zh/scalability/docs/scaling_theory/","title":"Kubernetes \u6269\u5c55\u7406\u8bba","text":""},{"location":"zh/scalability/docs/scaling_theory/#_1","title":"\u8282\u70b9\u4e0e\u53d8\u66f4\u7387","text":"<p>\u901a\u5e38\u5728\u8ba8\u8bba Kubernetes \u7684\u53ef\u6269\u5c55\u6027\u65f6\uff0c\u6211\u4eec\u4f1a\u4ee5\u5355\u4e2a\u96c6\u7fa4\u4e2d\u8282\u70b9\u7684\u6570\u91cf\u6765\u8861\u91cf\u3002\u6709\u8da3\u7684\u662f\uff0c\u8fd9\u5f88\u5c11\u662f\u7406\u89e3\u53ef\u6269\u5c55\u6027\u7684\u6700\u6709\u7528\u6307\u6807\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u62e5\u6709 5\uff0c000 \u4e2a\u8282\u70b9\u4f46 Pod \u6570\u91cf\u8f83\u5927\u4f46\u56fa\u5b9a\u7684\u96c6\u7fa4\uff0c\u5728\u521d\u59cb\u8bbe\u7f6e\u4e4b\u540e\u4e0d\u4f1a\u7ed9\u63a7\u5236\u5e73\u9762\u5e26\u6765\u592a\u5927\u538b\u529b\u3002\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u5728\u4e0d\u5230\u4e00\u5206\u949f\u7684\u65f6\u95f4\u5185\u5c1d\u8bd5\u5728 1\uff0c000 \u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\u4e2d\u521b\u5efa 10\uff0c000 \u4e2a\u77ed\u6682\u7684\u4f5c\u4e1a\uff0c\u90a3\u5c06\u7ed9\u63a7\u5236\u5e73\u9762\u5e26\u6765\u5de8\u5927\u7684\u6301\u7eed\u538b\u529b\u3002</p> <p>\u4ec5\u4f7f\u7528\u8282\u70b9\u6570\u91cf\u6765\u7406\u89e3\u6269\u5c55\u53ef\u80fd\u4f1a\u4ea7\u751f\u8bef\u5bfc\u3002\u6700\u597d\u4ee5\u7279\u5b9a\u65f6\u95f4\u6bb5\u5185\u53d1\u751f\u7684\u53d8\u5316\u7387(\u8ba9\u6211\u4eec\u5728\u6b64\u8ba8\u8bba\u4e2d\u4f7f\u7528 5 \u5206\u949f\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u56e0\u4e3a\u8fd9\u662f Prometheus \u67e5\u8be2\u9ed8\u8ba4\u4f7f\u7528\u7684\u65f6\u95f4\u95f4\u9694)\u6765\u601d\u8003\u3002\u8ba9\u6211\u4eec\u63a2\u8ba8\u4e00\u4e0b\uff0c\u4ee5\u53d8\u5316\u7387\u7684\u89d2\u5ea6\u6765\u6846\u5b9a\u95ee\u9898\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u8ba9\u6211\u4eec\u66f4\u597d\u5730\u4e86\u89e3\u9700\u8981\u8c03\u6574\u54ea\u4e9b\u53c2\u6570\u624d\u80fd\u5b9e\u73b0\u6240\u9700\u7684\u89c4\u6a21\u3002</p>"},{"location":"zh/scalability/docs/scaling_theory/#_2","title":"\u4ee5\u6bcf\u79d2\u67e5\u8be2\u6570\u601d\u8003","text":"<p>Kubernetes \u4e3a\u6bcf\u4e2a\u7ec4\u4ef6 - Kubelet\u3001\u8c03\u5ea6\u5668\u3001Kube \u63a7\u5236\u5668\u7ba1\u7406\u5668\u548c API \u670d\u52a1\u5668 - \u90fd\u6709\u4e00\u4e9b\u4fdd\u62a4\u673a\u5236\uff0c\u4ee5\u9632\u6b62\u538b\u57ae Kubernetes \u94fe\u6761\u4e2d\u7684\u4e0b\u4e00\u4e2a\u73af\u8282\u3002\u4f8b\u5982\uff0cKubelet \u6709\u4e00\u4e2a\u6807\u5fd7\u53ef\u4ee5\u4ee5\u4e00\u5b9a\u7684\u901f\u7387\u9650\u5236\u5bf9 API \u670d\u52a1\u5668\u7684\u8c03\u7528\u3002\u8fd9\u4e9b\u4fdd\u62a4\u673a\u5236\u901a\u5e38(\u4f46\u4e0d\u603b\u662f)\u4ee5\u6bcf\u79d2\u5141\u8bb8\u7684\u67e5\u8be2\u6570\u6216 QPS \u6765\u8868\u793a\u3002</p> <p>\u5728\u66f4\u6539\u8fd9\u4e9b QPS \u8bbe\u7f6e\u65f6\u5fc5\u987b\u683c\u5916\u5c0f\u5fc3\u3002\u6d88\u9664\u4e00\u4e2a\u74f6\u9888\uff0c\u4f8b\u5982 Kubelet \u4e0a\u7684\u6bcf\u79d2\u67e5\u8be2\u6570\uff0c\u5c06\u4f1a\u5f71\u54cd\u4e0b\u6e38\u7684\u5176\u4ed6\u7ec4\u4ef6\u3002\u8fd9\u53ef\u80fd\u5e76\u4e14\u786e\u5b9e\u4f1a\u5728\u4e00\u5b9a\u901f\u7387\u4ee5\u4e0a\u538b\u57ae\u6574\u4e2a\u7cfb\u7edf\uff0c\u56e0\u6b64\u4e86\u89e3\u548c\u76d1\u63a7\u670d\u52a1\u94fe\u6761\u7684\u6bcf\u4e2a\u90e8\u5206\u5bf9\u4e8e\u6210\u529f\u6269\u5c55 Kubernetes \u4e0a\u7684\u5de5\u4f5c\u8d1f\u8f7d\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u6ce8\u610f</p> <p>API \u670d\u52a1\u5668\u6709\u4e00\u4e2a\u66f4\u590d\u6742\u7684\u7cfb\u7edf\uff0c\u5f15\u5165\u4e86 API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027\uff0c\u6211\u4eec\u5c06\u5355\u72ec\u8ba8\u8bba\u3002</p> <p>\u6ce8\u610f</p> <p>\u5f53\u5fc3\uff0c\u6709\u4e9b\u6307\u6807\u770b\u8d77\u6765\u5f88\u5408\u9002\uff0c\u4f46\u5b9e\u9645\u4e0a\u5728\u6d4b\u91cf\u5176\u4ed6\u4e1c\u897f\u3002\u4f8b\u5982\uff0c<code>kubelet_http_inflight_requests</code> \u4ec5\u4e0e Kubelet \u4e2d\u7684\u6307\u6807\u670d\u52a1\u5668\u6709\u5173\uff0c\u800c\u4e0d\u662f Kubelet \u5230 apiserver \u7684\u8bf7\u6c42\u6570\u91cf\u3002\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6211\u4eec\u9519\u8bef\u5730\u914d\u7f6e Kubelet \u4e0a\u7684 QPS \u6807\u5fd7\u3002\u67e5\u8be2\u7279\u5b9a Kubelet \u7684\u5ba1\u8ba1\u65e5\u5fd7\u4f1a\u662f\u68c0\u67e5\u6307\u6807\u7684\u66f4\u53ef\u9760\u65b9\u5f0f\u3002</p>"},{"location":"zh/scalability/docs/scaling_theory/#_3","title":"\u6269\u5c55\u5206\u5e03\u5f0f\u7ec4\u4ef6","text":"<p>\u7531\u4e8e EKS \u662f\u4e00\u79cd\u6258\u7ba1\u670d\u52a1\uff0c\u8ba9\u6211\u4eec\u5c06 Kubernetes \u7ec4\u4ef6\u5206\u4e3a\u4e24\u7c7b\uff1aAWS \u6258\u7ba1\u7684\u7ec4\u4ef6\uff0c\u5305\u62ec etcd\u3001Kube \u63a7\u5236\u5668\u7ba1\u7406\u5668\u548c\u8c03\u5ea6\u5668(\u5728\u56fe\u7684\u5de6\u4fa7\u90e8\u5206)\uff0c\u4ee5\u53ca\u5ba2\u6237\u53ef\u914d\u7f6e\u7684\u7ec4\u4ef6\uff0c\u5982 Kubelet\u3001\u5bb9\u5668\u8fd0\u884c\u65f6\u548c\u8c03\u7528 AWS API \u7684\u5404\u79cd\u64cd\u4f5c\u7b26\uff0c\u5982\u7f51\u7edc\u548c\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f(\u5728\u56fe\u7684\u53f3\u4fa7\u90e8\u5206)\u3002\u6211\u4eec\u5c06 API \u670d\u52a1\u5668\u653e\u5728\u4e2d\u95f4\uff0c\u5c3d\u7ba1\u5b83\u662f\u7531 AWS \u7ba1\u7406\u7684\uff0c\u4f46\u5ba2\u6237\u53ef\u4ee5\u914d\u7f6e API \u4f18\u5148\u7ea7\u548c\u516c\u5e73\u6027\u7684\u8bbe\u7f6e\u3002</p> <p></p>"},{"location":"zh/scalability/docs/scaling_theory/#_4","title":"\u4e0a\u6e38\u548c\u4e0b\u6e38\u74f6\u9888","text":"<p>\u5728\u76d1\u63a7\u6bcf\u4e2a\u670d\u52a1\u65f6\uff0c\u67e5\u770b\u53cc\u5411\u6307\u6807\u4ee5\u5bfb\u627e\u74f6\u9888\u975e\u5e38\u91cd\u8981\u3002\u8ba9\u6211\u4eec\u4ee5 Kubelet \u4e3a\u4f8b\uff0c\u5b66\u4e60\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u3002Kubelet \u4e0e API \u670d\u52a1\u5668\u548c\u5bb9\u5668\u8fd0\u884c\u65f6\u8fdb\u884c\u901a\u4fe1;\u6211\u4eec\u9700\u8981\u76d1\u63a7\u4ec0\u4e48\uff0c\u4ee5\u68c0\u6d4b\u4efb\u4f55\u4e00\u4e2a\u7ec4\u4ef6\u662f\u5426\u51fa\u73b0\u95ee\u9898\uff1f</p>"},{"location":"zh/scalability/docs/scaling_theory/#pod","title":"\u6bcf\u4e2a\u8282\u70b9\u7684 Pod \u6570\u91cf","text":"<p>\u5f53\u6211\u4eec\u67e5\u770b\u6269\u5c55\u6570\u5b57\u65f6\uff0c\u4f8b\u5982\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u8fd0\u884c\u591a\u5c11\u4e2a Pod\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u91c7\u7528\u4e0a\u6e38\u652f\u6301\u7684 110 \u4e2a Pod \u6bcf\u8282\u70b9\u7684\u6570\u5b57\u3002</p> <p>\u6ce8\u610f</p> <p>https://kubernetes.io/docs/setup/best-practices/cluster-large/</p> <p>\u4f46\u662f\uff0c\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u80fd\u6bd4\u5728\u4e0a\u6e38\u8fdb\u884c\u7684\u53ef\u6269\u5c55\u6027\u6d4b\u8bd5\u4e2d\u66f4\u52a0\u590d\u6742\u3002\u4e3a\u4e86\u786e\u4fdd\u6211\u4eec\u53ef\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fd0\u884c\u6240\u9700\u6570\u91cf\u7684 Pod\uff0c\u8ba9\u6211\u4eec\u786e\u4fdd Kubelet \u80fd\u591f\"\u8ddf\u4e0a\"Containerd \u8fd0\u884c\u65f6\u7684\u6b65\u4f10\u3002</p> <p></p> <p>\u8fc7\u4e8e\u7b80\u5355\u5316\uff0cKubelet \u6b63\u5728\u4ece\u5bb9\u5668\u8fd0\u884c\u65f6(\u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\u662f Containerd)\u83b7\u53d6 Pod \u7684\u72b6\u6001\u3002\u5982\u679c Pod \u72b6\u6001\u53d8\u5316\u7684\u901f\u7387\u8fc7\u9ad8\uff0c\u90a3\u4e48[\u5bf9\u5bb9\u5668\u8fd0\u884c\u65f6\u7684]\u8bf7\u6c42\u53ef\u80fd\u4f1a\u8d85\u65f6\u3002</p> <p>\u6ce8\u610f</p> <p>Kubernetes \u5728\u4e0d\u65ad\u53d1\u5c55\uff0c\u8fd9\u4e2a\u5b50\u7cfb\u7edf\u76ee\u524d\u6b63\u5728\u8fdb\u884c\u53d8\u5316\u3002https://github.com/kubernetes/enhancements/issues/3386</p> <p> </p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u770b\u5230\u4e00\u6761\u5e73\u5766\u7684\u7ebf\uff0c\u8868\u793a\u6211\u4eec\u521a\u521a\u8fbe\u5230\u4e86 Pod \u751f\u547d\u5468\u671f\u4e8b\u4ef6\u751f\u6210\u6301\u7eed\u65f6\u95f4\u6307\u6807\u7684\u8d85\u65f6\u503c\u3002\u5982\u679c\u60a8\u60f3\u5728\u81ea\u5df1\u7684\u96c6\u7fa4\u4e2d\u67e5\u770b\u8fd9\u4e00\u70b9\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b PromQL \u8bed\u6cd5\u3002</p> <pre><code>increase(kubelet_pleg_relist_duration_seconds_bucket{instance=\"$instance\"}[$__rate_interval])\n</code></pre> <p>\u5982\u679c\u6211\u4eec\u76ee\u7779\u4e86\u8fd9\u79cd\u8d85\u65f6\u884c\u4e3a\uff0c\u5c31\u77e5\u9053\u6211\u4eec\u5df2\u7ecf\u8d85\u51fa\u4e86\u8282\u70b9\u6240\u80fd\u627f\u53d7\u7684\u9650\u5ea6\u3002\u5728\u7ee7\u7eed\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u89e3\u51b3\u5bfc\u81f4\u8d85\u65f6\u7684\u539f\u56e0\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u51cf\u5c11\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684 Pod \u6570\u91cf\uff0c\u6216\u8005\u5bfb\u627e\u53ef\u80fd\u5bfc\u81f4\u5927\u91cf\u91cd\u8bd5(\u4ece\u800c\u5f71\u54cd\u53d8\u66f4\u7387)\u7684\u9519\u8bef\u6765\u5b9e\u73b0\u3002\u91cd\u8981\u7684\u662f\u8981\u8bb0\u4f4f\uff0c\u6307\u6807\u662f\u4e86\u89e3\u8282\u70b9\u662f\u5426\u80fd\u591f\u5904\u7406\u5206\u914d\u7684 Pod \u7684\u53d8\u66f4\u7387\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u56fa\u5b9a\u6570\u5b57\u7684\u6700\u4f73\u65b9\u5f0f\u3002</p>"},{"location":"zh/scalability/docs/scaling_theory/#_5","title":"\u901a\u8fc7\u6307\u6807\u8fdb\u884c\u6269\u5c55","text":"<p>\u867d\u7136\u4f7f\u7528\u6307\u6807\u6765\u4f18\u5316\u7cfb\u7edf\u7684\u6982\u5ff5\u5df2\u7ecf\u5b58\u5728\u5f88\u957f\u65f6\u95f4\uff0c\u4f46\u5728\u4eba\u4eec\u5f00\u59cb\u4f7f\u7528 Kubernetes \u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd9\u4e00\u70b9\u5f80\u5f80\u88ab\u5ffd\u89c6\u4e86\u3002\u6211\u4eec\u4e0d\u518d\u5173\u6ce8\u7279\u5b9a\u7684\u6570\u5b57(\u4f8b\u5982\u6bcf\u4e2a\u8282\u70b9 110 \u4e2a Pod)\uff0c\u800c\u662f\u5c06\u7cbe\u529b\u96c6\u4e2d\u5728\u5bfb\u627e\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u53d1\u73b0\u7cfb\u7edf\u74f6\u9888\u7684\u6307\u6807\u4e0a\u3002\u4e86\u89e3\u8fd9\u4e9b\u6307\u6807\u7684\u6b63\u786e\u9608\u503c\u53ef\u4ee5\u8ba9\u6211\u4eec\u5bf9\u7cfb\u7edf\u662f\u5426\u7ecf\u8fc7\u4e86\u6700\u4f73\u914d\u7f6e\u6709\u5f88\u9ad8\u7684\u4fe1\u5fc3\u3002</p>"},{"location":"zh/scalability/docs/scaling_theory/#_6","title":"\u53d8\u66f4\u7684\u5f71\u54cd","text":"<p>\u4e00\u79cd\u53ef\u80fd\u4f1a\u8ba9\u6211\u4eec\u9677\u5165\u56f0\u5883\u7684\u5e38\u89c1\u6a21\u5f0f\u662f\uff0c\u4e13\u6ce8\u4e8e\u770b\u8d77\u6765\u53ef\u7591\u7684\u7b2c\u4e00\u4e2a\u6307\u6807\u6216\u65e5\u5fd7\u9519\u8bef\u3002\u5f53\u6211\u4eec\u4e4b\u524d\u770b\u5230 Kubelet \u8d85\u65f6\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u968f\u673a\u505a\u4e00\u4e9b\u4e8b\u60c5\uff0c\u6bd4\u5982\u589e\u52a0 Kubelet \u88ab\u5141\u8bb8\u53d1\u9001\u7684\u6bcf\u79d2\u901f\u7387\u7b49\u3002\u4f46\u662f\uff0c\u5728\u67e5\u770b\u6211\u4eec\u53d1\u73b0\u7684\u9519\u8bef\u4e0b\u6e38\u7684\u6574\u4e2a\u60c5\u51b5\u4e4b\u524d\uff0c\u6700\u597d\u5148\u4e0d\u8981\u91c7\u53d6\u4efb\u4f55\u884c\u52a8\u3002\u6bcf\u6b21\u66f4\u6539\u90fd\u8981\u6709\u76ee\u7684\uff0c\u5e76\u6709\u6570\u636e\u652f\u6301\u3002</p> <p>Kubelet \u4e0b\u6e38\u662f Containerd \u8fd0\u884c\u65f6(Pod \u9519\u8bef)\u3001\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f(CSI)\u548c\u7f51\u7edc\u9a71\u52a8\u7a0b\u5e8f(CNI)\u7b49 DaemonSet\uff0c\u5b83\u4eec\u4f1a\u8c03\u7528 EC2 API\u3002</p> <p></p> <p>\u8ba9\u6211\u4eec\u7ee7\u7eed\u4e4b\u524d\u7684\u793a\u4f8b\uff0c\u5373 Kubelet \u65e0\u6cd5\u8ddf\u4e0a\u8fd0\u884c\u65f6\u3002\u6709\u8bb8\u591a\u70b9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8282\u70b9\u88ab\u5bc6\u96c6\u6253\u5305\u5230\u89e6\u53d1\u9519\u8bef\u7684\u7a0b\u5ea6\u3002</p> <p></p> <p>\u5728\u4e3a\u6211\u4eec\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8bbe\u8ba1\u6b63\u786e\u7684\u8282\u70b9\u5927\u5c0f\u65f6\uff0c\u8fd9\u4e9b\u5f88\u5bb9\u6613\u88ab\u5ffd\u89c6\u7684\u4fe1\u53f7\u53ef\u80fd\u4f1a\u7ed9\u7cfb\u7edf\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u538b\u529b\uff0c\u4ece\u800c\u9650\u5236\u4e86\u6211\u4eec\u7684\u6269\u5c55\u548c\u6027\u80fd\u3002</p>"},{"location":"zh/scalability/docs/scaling_theory/#_7","title":"\u4e0d\u5fc5\u8981\u9519\u8bef\u7684\u4ee3\u4ef7","text":"<p>Kubernetes \u63a7\u5236\u5668\u5728\u51fa\u73b0\u9519\u8bef\u6761\u4ef6\u65f6\u64c5\u957f\u91cd\u8bd5\uff0c\u4f46\u8fd9\u662f\u6709\u4ee3\u4ef7\u7684\u3002\u8fd9\u4e9b\u91cd\u8bd5\u53ef\u80fd\u4f1a\u589e\u52a0\u5bf9 Kube \u63a7\u5236\u5668\u7ba1\u7406\u5668\u7b49\u7ec4\u4ef6\u7684\u538b\u529b\u3002\u5728\u6269\u5c55\u6d4b\u8bd5\u4e2d\u76d1\u63a7\u6b64\u7c7b\u9519\u8bef\u662f\u4e00\u4e2a\u91cd\u8981\u539f\u5219\u3002</p> <p>\u5f53\u51fa\u73b0\u8f83\u5c11\u9519\u8bef\u65f6\uff0c\u66f4\u5bb9\u6613\u53d1\u73b0\u7cfb\u7edf\u4e2d\u7684\u95ee\u9898\u3002\u901a\u8fc7\u5728\u91cd\u5927\u64cd\u4f5c(\u5982\u5347\u7ea7)\u4e4b\u524d\u5b9a\u671f\u786e\u4fdd\u6211\u4eec\u7684\u96c6\u7fa4\u6ca1\u6709\u9519\u8bef\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5316\u5728\u53d1\u751f\u610f\u5916\u4e8b\u4ef6\u65f6\u5bf9\u65e5\u5fd7\u7684\u6545\u969c\u6392\u67e5\u3002</p>"},{"location":"zh/scalability/docs/scaling_theory/#_8","title":"\u6269\u5c55\u6211\u4eec\u7684\u89c6\u91ce","text":"<p>\u5728\u62e5\u6709\u6570\u5343\u4e2a\u8282\u70b9\u7684\u5927\u89c4\u6a21\u96c6\u7fa4\u4e2d\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u9010\u4e2a\u67e5\u627e\u74f6\u9888\u3002\u5728 PromQL \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u540d\u4e3a topk \u7684\u51fd\u6570\u5728\u6570\u636e\u96c6\u4e2d\u627e\u5230\u6700\u9ad8\u503c;K \u662f\u6211\u4eec\u653e\u7f6e\u8981\u83b7\u53d6\u9879\u76ee\u6570\u91cf\u7684\u53d8\u91cf\u3002\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u4f7f\u7528\u4e09\u4e2a\u8282\u70b9\u6765\u4e86\u89e3\u96c6\u7fa4\u4e2d\u6240\u6709 Kubelet \u662f\u5426\u90fd\u5df2\u9971\u548c\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u4e00\u76f4\u5728\u67e5\u770b\u5ef6\u8fdf\uff0c\u73b0\u5728\u8ba9\u6211\u4eec\u770b\u770b Kubelet \u662f\u5426\u6b63\u5728\u4e22\u5f03\u4e8b\u4ef6\u3002</p> <pre><code>topk(3, increase(kubelet_pleg_discard_events{}[$__rate_interval]))\n</code></pre> <p>\u5206\u89e3\u8fd9\u4e2a\u8bed\u53e5\u3002</p> <ul> <li>\u6211\u4eec\u4f7f\u7528 Grafana \u53d8\u91cf <code>$__rate_interval</code> \u6765\u786e\u4fdd\u5b83\u83b7\u5f97\u6240\u9700\u7684\u56db\u4e2a\u6837\u672c\u3002\u8fd9\u7ed5\u8fc7\u4e86\u76d1\u63a7\u4e2d\u4e00\u4e2a\u590d\u6742\u7684\u4e3b\u9898\uff0c\u4f7f\u7528\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u53d8\u91cf\u3002</li> <li><code>topk</code> \u7ed9\u51fa\u4e86\u524d\u51e0\u4e2a\u7ed3\u679c\uff0c\u6570\u5b57 3 \u5c06\u8fd9\u4e9b\u7ed3\u679c\u9650\u5236\u4e3a\u4e09\u4e2a\u3002\u5bf9\u4e8e\u96c6\u7fa4\u8303\u56f4\u7684\u6307\u6807\uff0c\u8fd9\u662f\u4e00\u4e2a\u6709\u7528\u7684\u51fd\u6570\u3002</li> <li><code>{}</code> \u544a\u8bc9\u6211\u4eec\u6ca1\u6709\u8fc7\u6ee4\u5668\uff0c\u901a\u5e38\u60a8\u4f1a\u5728\u5176\u4e2d\u653e\u7f6e\u6293\u53d6\u89c4\u5219\u7684\u4f5c\u4e1a\u540d\u79f0\uff0c\u4f46\u7531\u4e8e\u8fd9\u4e9b\u540d\u79f0\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u6211\u4eec\u5c06\u5176\u7559\u7a7a\u3002</li> </ul>"},{"location":"zh/scalability/docs/scaling_theory/#_9","title":"\u5c06\u95ee\u9898\u4e00\u5206\u4e3a\u4e8c","text":"<p>\u8981\u89e3\u51b3\u7cfb\u7edf\u4e2d\u7684\u74f6\u9888\uff0c\u6211\u4eec\u5c06\u91c7\u7528\u5bfb\u627e\u4e00\u4e2a\u6307\u6807\u6765\u663e\u793a\u4e0a\u6e38\u6216\u4e0b\u6e38\u662f\u5426\u5b58\u5728\u95ee\u9898\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u5c06\u95ee\u9898\u4e00\u5206\u4e3a\u4e8c\u3002\u8fd9\u4e5f\u5c06\u6210\u4e3a\u6211\u4eec\u663e\u793a\u6307\u6807\u6570\u636e\u7684\u6838\u5fc3\u539f\u5219\u4e4b\u4e00\u3002</p> <p>\u5f00\u59cb\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u4e00\u4e2a\u597d\u5730\u65b9\u662f API \u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u8ba9\u6211\u4eec\u770b\u5230\u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u6216\u63a7\u5236\u5e73\u9762\u662f\u5426\u5b58\u5728\u95ee\u9898\u3002</p>"},{"location":"zh/scalability/docs/workloads/","title":"\u5de5\u4f5c\u8d1f\u8f7d","text":"<p>\u5de5\u4f5c\u8d1f\u8f7d\u4f1a\u5f71\u54cd\u96c6\u7fa4\u53ef\u6269\u5c55\u7684\u89c4\u6a21\u3002\u5927\u91cf\u4f7f\u7528Kubernetes API\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5c06\u9650\u5236\u5355\u4e2a\u96c6\u7fa4\u4e2d\u53ef\u4ee5\u62e5\u6709\u7684\u603b\u5de5\u4f5c\u8d1f\u8f7d\u91cf\uff0c\u4f46\u60a8\u53ef\u4ee5\u66f4\u6539\u4e00\u4e9b\u9ed8\u8ba4\u503c\u6765\u5e2e\u52a9\u51cf\u8f7b\u8d1f\u8f7d\u3002</p> <p>Kubernetes\u96c6\u7fa4\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u4ee5\u8bbf\u95ee\u4e0eKubernetes API\u96c6\u6210\u7684\u529f\u80fd(\u4f8b\u5982Secrets\u548cServiceAccounts)\uff0c\u4f46\u5e76\u975e\u603b\u662f\u9700\u8981\u8fd9\u4e9b\u529f\u80fd\uff0c\u5982\u679c\u4e0d\u4f7f\u7528\u5b83\u4eec\u5e94\u8be5\u5c06\u5176\u7981\u7528\u3002\u9650\u5236\u5de5\u4f5c\u8d1f\u8f7d\u5bf9Kubernetes\u63a7\u5236\u5e73\u9762\u7684\u8bbf\u95ee\u548c\u4f9d\u8d56\u6027\u5c06\u589e\u52a0\u96c6\u7fa4\u4e2d\u53ef\u4ee5\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6570\u91cf\uff0c\u5e76\u901a\u8fc7\u5220\u9664\u5bf9\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4e0d\u5fc5\u8981\u8bbf\u95ee\u548c\u5b9e\u65bd\u6700\u5c0f\u7279\u6743\u5b9e\u8df5\u6765\u63d0\u9ad8\u96c6\u7fa4\u7684\u5b89\u5168\u6027\u3002\u8bf7\u9605\u8bfb\u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u4ee5\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"zh/scalability/docs/workloads/#podipv6","title":"\u5bf9\u4e8ePod\u7f51\u7edc\u4f7f\u7528IPv6","text":"<p>\u60a8\u65e0\u6cd5\u5c06VPC\u4eceIPv4\u8fc7\u6e21\u5230IPv6\uff0c\u56e0\u6b64\u5728\u914d\u7f6e\u96c6\u7fa4\u4e4b\u524d\u542f\u7528IPv6\u5f88\u91cd\u8981\u3002\u5982\u679c\u5728VPC\u4e2d\u542f\u7528\u4e86IPv6\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u60a8\u5fc5\u987b\u4f7f\u7528\u5b83\uff0c\u5982\u679c\u60a8\u7684Pod\u548c\u670d\u52a1\u4f7f\u7528IPv6\uff0c\u60a8\u4ecd\u7136\u53ef\u4ee5\u5c06\u6d41\u91cf\u8def\u7531\u5230\u548c\u4eceIPv4\u5730\u5740\u3002\u8bf7\u53c2\u9605EKS\u7f51\u7edc\u6700\u4f73\u5b9e\u8df5\u4ee5\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002</p> <p>\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528IPv6\u53ef\u4ee5\u907f\u514d\u4e00\u4e9b\u6700\u5e38\u89c1\u7684\u96c6\u7fa4\u548c\u5de5\u4f5c\u8d1f\u8f7d\u6269\u5c55\u9650\u5236\u3002IPv6\u907f\u514d\u4e86IP\u5730\u5740\u8017\u5c3d\u7684\u60c5\u51b5\uff0c\u5373\u7531\u4e8e\u6ca1\u6709\u53ef\u7528\u7684IP\u5730\u5740\u800c\u65e0\u6cd5\u521b\u5efaPod\u548c\u8282\u70b9\u3002\u5b83\u8fd8\u901a\u8fc7\u51cf\u5c11\u6bcf\u4e2a\u8282\u70b9\u7684ENI\u9644\u52a0\u6570\u91cf\u6765\u63d0\u9ad8\u6bcf\u4e2a\u8282\u70b9\u7684\u6027\u80fd\uff0c\u56e0\u4e3aPod\u53ef\u4ee5\u66f4\u5feb\u5730\u83b7\u5f97IP\u5730\u5740\u3002\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728VPC CNI\u4e2d\u4f7f\u7528IPv4\u524d\u7f00\u6a21\u5f0f\u6765\u5b9e\u73b0\u7c7b\u4f3c\u7684\u8282\u70b9\u6027\u80fd\uff0c\u4f46\u60a8\u4ecd\u9700\u786e\u4fddVPC\u4e2d\u6709\u8db3\u591f\u7684IP\u5730\u5740\u53ef\u7528\u3002</p>"},{"location":"zh/scalability/docs/workloads/#_2","title":"\u9650\u5236\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u670d\u52a1\u6570\u91cf","text":"<p>\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6700\u5927\u670d\u52a1\u6570\u91cf\u4e3a5\uff0c000,\u96c6\u7fa4\u4e2d\u7684\u6700\u5927\u670d\u52a1\u6570\u91cf\u4e3a10\uff0c000\u3002\u4e3a\u4e86\u5e2e\u52a9\u7ec4\u7ec7\u5de5\u4f5c\u8d1f\u8f7d\u548c\u670d\u52a1\u3001\u63d0\u9ad8\u6027\u80fd\uff0c\u5e76\u907f\u514d\u547d\u540d\u7a7a\u95f4\u8303\u56f4\u5185\u8d44\u6e90\u7684\u7ea7\u8054\u5f71\u54cd\uff0c\u6211\u4eec\u5efa\u8bae\u5c06\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u670d\u52a1\u6570\u91cf\u9650\u5236\u4e3a500\u3002</p> <p>\u968f\u7740\u96c6\u7fa4\u4e2d\u670d\u52a1\u603b\u6570\u7684\u589e\u52a0\uff0ckube-proxy\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u521b\u5efa\u7684IP\u8868\u89c4\u5219\u6570\u91cf\u4e5f\u4f1a\u589e\u52a0\u3002\u751f\u6210\u6570\u5343\u6761IP\u8868\u89c4\u5219\u5e76\u901a\u8fc7\u8fd9\u4e9b\u89c4\u5219\u8def\u7531\u6570\u636e\u5305\u4f1a\u5bf9\u8282\u70b9\u7684\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\uff0c\u5e76\u589e\u52a0\u7f51\u7edc\u5ef6\u8fdf\u3002</p> <p>\u521b\u5efaKubernetes\u547d\u540d\u7a7a\u95f4\uff0c\u4f7f\u5176\u5305\u542b\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u73af\u5883\uff0c\u53ea\u8981\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u670d\u52a1\u6570\u91cf\u4f4e\u4e8e500\u3002\u8fd9\u5c06\u4f7f\u670d\u52a1\u53d1\u73b0\u7684\u89c4\u6a21\u8db3\u591f\u5c0f\uff0c\u4ece\u800c\u907f\u514d\u670d\u52a1\u53d1\u73b0\u9650\u5236\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u5e2e\u52a9\u60a8\u907f\u514d\u670d\u52a1\u547d\u540d\u51b2\u7a81\u3002\u5e94\u7528\u7a0b\u5e8f\u73af\u5883(\u4f8b\u5982dev\u3001test\u3001prod)\u5e94\u8be5\u4f7f\u7528\u5355\u72ec\u7684EKS\u96c6\u7fa4\uff0c\u800c\u4e0d\u662f\u547d\u540d\u7a7a\u95f4\u3002</p>"},{"location":"zh/scalability/docs/workloads/#elastic-load-balancer","title":"\u4e86\u89e3Elastic Load Balancer\u914d\u989d","text":"<p>\u5728\u521b\u5efa\u670d\u52a1\u65f6\uff0c\u8bf7\u8003\u8651\u5c06\u4f7f\u7528\u4f55\u79cd\u7c7b\u578b\u7684\u8d1f\u8f7d\u5747\u8861(\u4f8b\u5982\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668(NLB)\u6216\u5e94\u7528\u7a0b\u5e8f\u8d1f\u8f7d\u5747\u8861\u5668(ALB))\u3002\u6bcf\u79cd\u8d1f\u8f7d\u5747\u8861\u5668\u7c7b\u578b\u63d0\u4f9b\u4e0d\u540c\u7684\u529f\u80fd\uff0c\u5e76\u4e14\u5177\u6709\u4e0d\u540c\u7684\u914d\u989d\u3002\u67d0\u4e9b\u9ed8\u8ba4\u914d\u989d\u53ef\u4ee5\u8c03\u6574\uff0c\u4f46\u4e5f\u6709\u4e00\u4e9b\u914d\u989d\u4e0a\u9650\u65e0\u6cd5\u66f4\u6539\u3002\u8981\u67e5\u770b\u60a8\u7684\u8d26\u6237\u914d\u989d\u548c\u4f7f\u7528\u60c5\u51b5\uff0c\u8bf7\u5728AWS\u63a7\u5236\u53f0\u4e2d\u67e5\u770b\u670d\u52a1\u914d\u989d\u4eea\u8868\u677f\u3002</p> <p>\u4f8b\u5982\uff0c\u9ed8\u8ba4ALB\u76ee\u6807\u6570\u4e3a1000\u3002\u5982\u679c\u60a8\u7684\u670d\u52a1\u6709\u8d85\u8fc71000\u4e2a\u7aef\u70b9\uff0c\u60a8\u5c06\u9700\u8981\u589e\u52a0\u914d\u989d\u6216\u5c06\u670d\u52a1\u5206\u6563\u5230\u591a\u4e2aALB\u4e0a\uff0c\u6216\u4f7f\u7528Kubernetes Ingress\u3002\u9ed8\u8ba4NLB\u76ee\u6807\u6570\u4e3a3000\uff0c\u4f46\u6bcf\u4e2a\u53ef\u7528\u533a\u9650\u5236\u4e3a500\u4e2a\u76ee\u6807\u3002\u5982\u679c\u60a8\u7684\u96c6\u7fa4\u4e3aNLB\u670d\u52a1\u8fd0\u884c\u8d85\u8fc7500\u4e2aPod\uff0c\u60a8\u5c06\u9700\u8981\u4f7f\u7528\u591a\u4e2a\u53ef\u7528\u533a\u6216\u8bf7\u6c42\u589e\u52a0\u914d\u989d\u9650\u5236\u3002</p> <p>\u4f7f\u7528\u8d1f\u8f7d\u5747\u8861\u5668\u4e0e\u670d\u52a1\u76f8\u8026\u5408\u7684\u66ff\u4ee3\u65b9\u6848\u662f\u4f7f\u7528Ingress\u63a7\u5236\u5668\u3002AWS Load Balancer\u63a7\u5236\u5668\u53ef\u4ee5\u4e3aIngress\u8d44\u6e90\u521b\u5efaALB\uff0c\u4f46\u60a8\u53ef\u4ee5\u8003\u8651\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c\u4e13\u7528\u63a7\u5236\u5668\u3002\u96c6\u7fa4\u5185\u7684Ingress\u63a7\u5236\u5668\u5141\u8bb8\u60a8\u901a\u8fc7\u5728\u96c6\u7fa4\u5185\u8fd0\u884c\u53cd\u5411\u4ee3\u7406\u6765\u4ece\u5355\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\u516c\u5f00\u591a\u4e2aKubernetes\u670d\u52a1\u3002\u63a7\u5236\u5668\u5177\u6709\u4e0d\u540c\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u652f\u6301Gateway API,\u8fd9\u53ef\u80fd\u4f1a\u5e26\u6765\u597d\u5904\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6570\u91cf\u548c\u5927\u5c0f\u3002</p>"},{"location":"zh/scalability/docs/workloads/#route-53global-acceleratorcloudfront","title":"\u4f7f\u7528Route 53\u3001Global Accelerator\u6216CloudFront","text":"<p>\u8981\u4f7f\u7528\u591a\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u670d\u52a1\u4f5c\u4e3a\u5355\u4e2a\u7aef\u70b9\u53ef\u7528\uff0c\u60a8\u9700\u8981\u4f7f\u7528Amazon CloudFront\u3001AWS Global Accelerator\u6216Amazon Route 53\u6765\u516c\u5f00\u6240\u6709\u8d1f\u8f7d\u5747\u8861\u5668\u4f5c\u4e3a\u5355\u4e2a\u9762\u5411\u5ba2\u6237\u7684\u7aef\u70b9\u3002\u6bcf\u4e2a\u9009\u9879\u90fd\u6709\u4e0d\u540c\u7684\u4f18\u70b9\uff0c\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u9700\u6c42\u5355\u72ec\u6216\u7ec4\u5408\u4f7f\u7528\u3002</p> <p>Route 53\u53ef\u4ee5\u5728\u4e00\u4e2a\u901a\u7528\u540d\u79f0\u4e0b\u516c\u5f00\u591a\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5e76\u6839\u636e\u5206\u914d\u7684\u6743\u91cd\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u6bcf\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u60a8\u53ef\u4ee5\u5728\u6587\u6863\u4e2d\u9605\u8bfb\u6709\u5173DNS\u6743\u91cd\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5728AWS Load Balancer Controller\u6587\u6863\u4e2d\u9605\u8bfb\u5982\u4f55\u4e0eKubernetes\u5916\u90e8DNS\u63a7\u5236\u5668\u4e00\u8d77\u5b9e\u73b0\u5b83\u4eec\u3002</p> <p>Global Accelerator\u53ef\u4ee5\u6839\u636e\u8bf7\u6c42IP\u5730\u5740\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u8def\u7531\u5230\u6700\u8fd1\u7684\u533a\u57df\u3002\u5bf9\u4e8e\u90e8\u7f72\u5230\u591a\u4e2a\u533a\u57df\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u8fd9\u53ef\u80fd\u5f88\u6709\u7528\uff0c\u4f46\u5b83\u4e0d\u4f1a\u6539\u5584\u5bf9\u5355\u4e2a\u533a\u57df\u4e2d\u5355\u4e2a\u96c6\u7fa4\u7684\u8def\u7531\u3002\u5c06Route 53\u4e0eGlobal Accelerator\u7ed3\u5408\u4f7f\u7528\u5177\u6709\u989d\u5916\u7684\u597d\u5904\uff0c\u4f8b\u5982\u5065\u5eb7\u68c0\u67e5\u548c\u81ea\u52a8\u6545\u969c\u8f6c\u79fb(\u5982\u679c\u67d0\u4e2a\u53ef\u7528\u533a\u4e0d\u53ef\u7528)\u3002\u60a8\u53ef\u4ee5\u5728\u8fd9\u7bc7\u535a\u5ba2\u6587\u7ae0\u4e2d\u770b\u5230\u4f7f\u7528Global Accelerator\u4e0eRoute 53\u7684\u793a\u4f8b\u3002</p> <p>CloudFront\u53ef\u4ee5\u4e0eRoute 53\u548cGlobal Accelerator\u4e00\u8d77\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\u6765\u8def\u7531\u6d41\u91cf\u5230\u591a\u4e2a\u76ee\u7684\u5730\u3002CloudFront\u7f13\u5b58\u4ece\u6e90\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u8d44\u4ea7\uff0c\u8fd9\u53ef\u80fd\u4f1a\u51cf\u5c11\u5e26\u5bbd\u9700\u6c42\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u60a8\u6b63\u5728\u63d0\u4f9b\u7684\u5185\u5bb9\u3002</p>"},{"location":"zh/scalability/docs/workloads/#endpointslicesendpoints","title":"\u4f7f\u7528EndpointSlices\u800c\u4e0d\u662fEndpoints","text":"<p>\u5728\u53d1\u73b0\u4e0e\u670d\u52a1\u6807\u7b7e\u5339\u914d\u7684Pod\u65f6\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528EndpointSlices\u800c\u4e0d\u662fEndpoints\u3002Endpoints\u662f\u4e00\u79cd\u5728\u5c0f\u89c4\u6a21\u4e0a\u516c\u5f00\u670d\u52a1\u7684\u7b80\u5355\u65b9\u5f0f\uff0c\u4f46\u5927\u578b\u670d\u52a1\u7684\u81ea\u52a8\u6269\u5c55\u6216\u66f4\u65b0\u4f1a\u7ed9Kubernetes\u63a7\u5236\u5e73\u9762\u5e26\u6765\u5927\u91cf\u6d41\u91cf\u3002EndpointSlices\u5177\u6709\u81ea\u52a8\u5206\u7ec4\u529f\u80fd\uff0c\u53ef\u4ee5\u542f\u7528\u8bf8\u5982\u62d3\u6251\u611f\u77e5\u63d0\u793a\u4e4b\u7c7b\u7684\u529f\u80fd\u3002</p> <p>\u5e76\u975e\u6240\u6709\u63a7\u5236\u5668\u90fd\u9ed8\u8ba4\u4f7f\u7528EndpointSlices\u3002\u60a8\u5e94\u8be5\u9a8c\u8bc1\u63a7\u5236\u5668\u8bbe\u7f6e\u5e76\u5728\u9700\u8981\u65f6\u542f\u7528\u5b83\u3002\u5bf9\u4e8eAWS Load Balancer Controller,\u60a8\u5e94\u8be5\u542f\u7528<code>--enable-endpoint-slices</code>\u53ef\u9009\u6807\u5fd7\u4ee5\u4f7f\u7528EndpointSlices\u3002</p>"},{"location":"zh/scalability/docs/workloads/#secrets","title":"\u5982\u679c\u53ef\u80fd\uff0c\u8bf7\u4f7f\u7528\u4e0d\u53ef\u53d8\u548c\u5916\u90e8Secrets","text":"<p>kubelet\u4f1a\u4e3a\u8be5\u8282\u70b9\u4e0aPod\u4f7f\u7528\u7684\u5377\u4e2d\u7684Secrets\u7f13\u5b58\u5f53\u524d\u5bc6\u94a5\u548c\u503c\u3002kubelet\u4f1a\u5bf9Secrets\u8bbe\u7f6e\u76d1\u89c6\u4ee5\u68c0\u6d4b\u66f4\u6539\u3002\u968f\u7740\u96c6\u7fa4\u7684\u6269\u5c55\uff0c\u4e0d\u65ad\u589e\u52a0\u7684\u76d1\u89c6\u4f1a\u5bf9API\u670d\u52a1\u5668\u7684\u6027\u80fd\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\u3002</p> <p>\u6709\u4e24\u79cd\u7b56\u7565\u53ef\u4ee5\u51cf\u5c11\u5bf9Secrets\u7684\u76d1\u89c6\uff1a</p> <ul> <li>\u5bf9\u4e8e\u4e0d\u9700\u8981\u8bbf\u95eeKubernetes\u8d44\u6e90\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6eautomountServiceAccountToken\uff1a false\u6765\u7981\u7528\u81ea\u52a8\u6302\u8f7d\u670d\u52a1\u5e10\u6237Secrets</li> <li>\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684Secrets\u662f\u9759\u6001\u7684\uff0c\u5e76\u4e14\u5c06\u6765\u4e0d\u4f1a\u88ab\u4fee\u6539\uff0c\u8bf7\u5c06Secret\u6807\u8bb0\u4e3a\u4e0d\u53ef\u53d8\u3002kubelet\u4e0d\u4f1a\u4e3a\u4e0d\u53ef\u53d8\u7684Secrets\u7ef4\u62a4API\u76d1\u89c6\u3002</li> </ul> <p>\u8981\u7981\u7528\u81ea\u52a8\u5c06\u670d\u52a1\u5e10\u6237\u6302\u8f7d\u5230Pod\uff0c\u60a8\u53ef\u4ee5\u5728\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u4f7f\u7528\u4ee5\u4e0b\u8bbe\u7f6e\u3002\u5982\u679c\u7279\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981\u670d\u52a1\u5e10\u6237\uff0c\u60a8\u53ef\u4ee5\u8986\u76d6\u8fd9\u4e9b\u8bbe\u7f6e\u3002</p> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: app\nautomountServiceAccountToken: true\n</code></pre> <p>\u5728\u96c6\u7fa4\u4e2d\u7684Secrets\u6570\u91cf\u8d85\u8fc710\uff0c000\u7684\u9650\u5236\u4e4b\u524d\uff0c\u8bf7\u76d1\u63a7\u5b83\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u96c6\u7fa4\u4e2dSecrets\u7684\u603b\u6570\u3002\u60a8\u5e94\u8be5\u901a\u8fc7\u96c6\u7fa4\u76d1\u63a7\u5de5\u5177\u76d1\u63a7\u6b64\u9650\u5236\u3002</p> <pre><code>kubectl get secrets -A | wc -l\n</code></pre> <p>\u60a8\u5e94\u8be5\u8bbe\u7f6e\u76d1\u63a7\uff0c\u5728\u8fbe\u5230\u6b64\u9650\u5236\u4e4b\u524d\u5411\u96c6\u7fa4\u7ba1\u7406\u5458\u53d1\u51fa\u8b66\u62a5\u3002\u8003\u8651\u4f7f\u7528\u5916\u90e8Secrets\u7ba1\u7406\u9009\u9879\uff0c\u5982AWS Key Management Service (AWS KMS)\u6216Hashicorp Vault\u4e0eSecrets Store CSI\u9a71\u52a8\u7a0b\u5e8f\u3002</p>"},{"location":"zh/scalability/docs/workloads/#_3","title":"\u9650\u5236\u90e8\u7f72\u5386\u53f2\u8bb0\u5f55","text":"<p>\u7531\u4e8e\u96c6\u7fa4\u4e2d\u4ecd\u5728\u8ddf\u8e2a\u65e7\u5bf9\u8c61\uff0c\u56e0\u6b64\u5728\u521b\u5efa\u3001\u66f4\u65b0\u6216\u5220\u9664Pod\u65f6\u53ef\u80fd\u4f1a\u53d8\u6162\u3002\u60a8\u53ef\u4ee5\u51cf\u5c11\u90e8\u7f72\u7684<code>revisionHistoryLimit</code>,\u4ee5\u6e05\u7406\u8f83\u65e7\u7684ReplicaSets\uff0c\u4ece\u800c\u964d\u4f4eKubernetes Controller Manager\u8ddf\u8e2a\u7684\u5bf9\u8c61\u603b\u6570\u3002\u90e8\u7f72\u7684\u9ed8\u8ba4\u5386\u53f2\u8bb0\u5f55\u9650\u5236\u4e3a10\u3002</p> <p>\u5982\u679c\u60a8\u7684\u96c6\u7fa4\u901a\u8fc7CronJob\u6216\u5176\u4ed6\u673a\u5236\u521b\u5efa\u4e86\u5927\u91cfJob\u5bf9\u8c61\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528<code>ttlSecondsAfterFinished</code>\u8bbe\u7f6e\u6765\u81ea\u52a8\u6e05\u7406\u96c6\u7fa4\u4e2d\u7684\u65e7Pod\u3002\u8fd9\u5c06\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u540e\u4ece\u4f5c\u4e1a\u5386\u53f2\u8bb0\u5f55\u4e2d\u5220\u9664\u5df2\u6210\u529f\u6267\u884c\u7684\u4f5c\u4e1a\u3002</p>"},{"location":"zh/scalability/docs/workloads/#enableservicelinks","title":"\u9ed8\u8ba4\u7981\u7528enableServiceLinks","text":"<p>\u5f53Pod\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u65f6\uff0ckubelet\u4f1a\u4e3a\u6bcf\u4e2a\u6d3b\u52a8\u670d\u52a1\u6dfb\u52a0\u4e00\u7ec4\u73af\u5883\u53d8\u91cf\u3002Linux\u8fdb\u7a0b\u5bf9\u5176\u73af\u5883\u7684\u5927\u5c0f\u6709\u6700\u5927\u9650\u5236\uff0c\u5982\u679c\u60a8\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u6709\u592a\u591a\u670d\u52a1\uff0c\u53ef\u80fd\u4f1a\u8fbe\u5230\u6b64\u9650\u5236\u3002\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u670d\u52a1\u6570\u91cf\u4e0d\u5e94\u8d85\u8fc75\uff0c000\u3002\u5728\u6b64\u4e4b\u540e\uff0c\u670d\u52a1\u73af\u5883\u53d8\u91cf\u7684\u6570\u91cf\u4f1a\u8d85\u51fashell\u9650\u5236\uff0c\u5bfc\u81f4Pod\u5728\u542f\u52a8\u65f6\u5d29\u6e83\u3002</p> <p>Pod\u4e0d\u5e94\u4f7f\u7528\u670d\u52a1\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u670d\u52a1\u53d1\u73b0\u8fd8\u6709\u5176\u4ed6\u539f\u56e0\u3002\u73af\u5883\u53d8\u91cf\u540d\u79f0\u51b2\u7a81\u3001\u6cc4\u9732\u670d\u52a1\u540d\u79f0\u548c\u603b\u73af\u5883\u5927\u5c0f\u5c31\u662f\u5176\u4e2d\u51e0\u4e2a\u539f\u56e0\u3002\u60a8\u5e94\u8be5\u4f7f\u7528CoreDNS\u6765\u53d1\u73b0\u670d\u52a1\u7aef\u70b9\u3002</p>"},{"location":"zh/scalability/docs/workloads/#webhook","title":"\u9650\u5236\u6bcf\u4e2a\u8d44\u6e90\u7684\u52a8\u6001\u51c6\u5165Webhook\u6570\u91cf","text":"<p>\u52a8\u6001\u51c6\u5165Webhook\u5305\u62ec\u51c6\u5165Webhook\u548c\u53d8\u66f4Webhook\u3002\u5b83\u4eec\u662f\u4e0d\u5c5e\u4e8eKubernetes\u63a7\u5236\u5e73\u9762\u7684API\u7aef\u70b9\uff0c\u5728\u5c06\u8d44\u6e90\u53d1\u9001\u5230Kubernetes API\u65f6\u4f1a\u6309\u987a\u5e8f\u8c03\u7528\u3002\u6bcf\u4e2aWebhook\u7684\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u4e3a10\u79d2\uff0c\u5982\u679c\u60a8\u6709\u591a\u4e2aWebhook\u6216\u4efb\u4f55\u4e00\u4e2aWebhook\u8d85\u65f6\uff0c\u90fd\u4f1a\u589e\u52a0API\u8bf7\u6c42\u6240\u9700\u7684\u65f6\u95f4\u3002</p> <p>\u786e\u4fdd\u60a8\u7684Webhook\u9ad8\u5ea6\u53ef\u7528\u2014\u2014\u5c24\u5176\u662f\u5728\u53ef\u7528\u533a\u53d1\u751f\u6545\u969c\u65f6\u2014\u2014\u5e76\u4e14failurePolicy\u8bbe\u7f6e\u6b63\u786e\uff0c\u4ee5\u62d2\u7edd\u8d44\u6e90\u6216\u5ffd\u7565\u6545\u969c\u3002\u5728\u4e0d\u9700\u8981\u65f6\u4e0d\u8981\u8c03\u7528Webhook\uff0c\u5141\u8bb8--dry-run kubectl\u547d\u4ee4\u7ed5\u8fc7Webhook\u3002</p> <pre><code>apiVersion: admission.k8s.io/v1\nkind: AdmissionReview\nrequest:\n  dryRun: False\n</code></pre> <p>\u53d8\u66f4Webhook\u53ef\u4ee5\u8fde\u7eed\u4fee\u6539\u8d44\u6e90\u3002\u5982\u679c\u60a8\u67095\u4e2a\u53d8\u66f4Webhook\u5e76\u90e8\u7f7250\u4e2a\u8d44\u6e90\uff0cetcd\u5c06\u5b58\u50a8\u6bcf\u4e2a\u8d44\u6e90\u7684\u6240\u6709\u7248\u672c\uff0c\u76f4\u5230\u538b\u7f29\u8fd0\u884c(\u6bcf5\u5206\u949f\u4e00\u6b21)\u4ee5\u5220\u9664\u5df2\u4fee\u6539\u8d44\u6e90\u7684\u65e7\u7248\u672c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5f53etcd\u5220\u9664\u88ab\u53d6\u4ee3\u7684\u8d44\u6e90\u65f6\uff0c\u5c06\u4eceetcd\u4e2d\u5220\u9664200\u4e2a\u8d44\u6e90\u7248\u672c\uff0c\u5e76\u4e14\u6839\u636e\u8d44\u6e90\u7684\u5927\u5c0f\uff0c\u53ef\u80fd\u4f1a\u5728etcd\u4e3b\u673a\u4e0a\u5360\u7528\u5927\u91cf\u7a7a\u95f4\uff0c\u76f4\u5230\u6bcf15\u5206\u949f\u8fdb\u884c\u4e00\u6b21\u788e\u7247\u6574\u7406\u3002</p> <p>\u8fd9\u79cd\u788e\u7247\u6574\u7406\u53ef\u80fd\u4f1a\u5bfc\u81f4etcd\u6682\u505c\uff0c\u4ece\u800c\u53ef\u80fd\u5bf9Kubernetes API\u548c\u63a7\u5236\u5668\u4ea7\u751f\u5176\u4ed6\u5f71\u54cd\u3002\u60a8\u5e94\u8be5\u907f\u514d\u9891\u7e41\u4fee\u6539\u5927\u578b\u8d44\u6e90\u6216\u5728\u77ed\u65f6\u95f4\u5185\u4fee\u6539\u6570\u767e\u4e2a\u8d44\u6e90\u3002</p>"},{"location":"zh/security/docs/","title":"Amazon EKS \u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u6307\u5357","text":"<p>\u672c\u6307\u5357\u63d0\u4f9b\u4e86\u6709\u5173\u5728\u4ea4\u4ed8\u4e1a\u52a1\u4ef7\u503c\u7684\u540c\u65f6\u4fdd\u62a4\u4f9d\u8d56\u4e8e EKS \u7684\u4fe1\u606f\u3001\u7cfb\u7edf\u548c\u8d44\u4ea7\u7684\u5efa\u8bae\uff0c\u5305\u62ec\u98ce\u9669\u8bc4\u4f30\u548c\u7f13\u89e3\u7b56\u7565\u3002\u672c\u6307\u5357\u4e2d\u7684\u6307\u5bfc\u662f AWS \u53d1\u5e03\u7684\u4e00\u7cfb\u5217\u6700\u4f73\u5b9e\u8df5\u6307\u5357\u7684\u4e00\u90e8\u5206\uff0c\u65e8\u5728\u5e2e\u52a9\u5ba2\u6237\u6309\u7167\u6700\u4f73\u5b9e\u8df5\u5b9e\u65bd EKS\u3002\u5173\u4e8e\u6027\u80fd\u3001\u8fd0\u8425\u5353\u8d8a\u3001\u6210\u672c\u4f18\u5316\u548c\u53ef\u9760\u6027\u7684\u6307\u5357\u5c06\u5728\u672a\u6765\u51e0\u4e2a\u6708\u5185\u63a8\u51fa\u3002</p>"},{"location":"zh/security/docs/#_1","title":"\u5982\u4f55\u4f7f\u7528\u672c\u6307\u5357","text":"<p>\u672c\u6307\u5357\u9762\u5411\u8d1f\u8d23\u5b9e\u65bd\u548c\u76d1\u63a7 EKS \u96c6\u7fa4\u53ca\u5176\u652f\u6301\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5b89\u5168\u63a7\u5236\u6709\u6548\u6027\u7684\u5b89\u5168\u4ece\u4e1a\u4eba\u5458\u3002\u672c\u6307\u5357\u6309\u4e3b\u9898\u533a\u57df\u7ec4\u7ec7\uff0c\u4ee5\u4fbf\u4e8e\u9605\u8bfb\u3002\u6bcf\u4e2a\u4e3b\u9898\u90fd\u4ee5\u7b80\u8981\u6982\u8ff0\u5f00\u59cb\uff0c\u7136\u540e\u5217\u51fa\u4e86\u786e\u4fdd EKS \u96c6\u7fa4\u5b89\u5168\u7684\u5efa\u8bae\u548c\u6700\u4f73\u5b9e\u8df5\u3002\u4e3b\u9898\u4e0d\u9700\u6309\u7279\u5b9a\u987a\u5e8f\u9605\u8bfb\u3002</p>"},{"location":"zh/security/docs/#_2","title":"\u4e86\u89e3\u5171\u4eab\u8d23\u4efb\u6a21\u578b","text":"<p>\u5728\u4f7f\u7528 EKS \u7b49\u6258\u7ba1\u670d\u52a1\u65f6\uff0c\u5b89\u5168\u6027\u548c\u5408\u89c4\u6027\u88ab\u89c6\u4e3a\u5171\u4eab\u8d23\u4efb\u3002\u4e00\u822c\u800c\u8a00\uff0cAWS \u8d1f\u8d23\"\u4e91\"\u7684\u5b89\u5168\uff0c\u800c\u60a8\u4f5c\u4e3a\u5ba2\u6237\u5219\u8d1f\u8d23\"\u4e91\u4e2d\"\u7684\u5b89\u5168\u3002\u5bf9\u4e8e EKS\uff0cAWS \u8d1f\u8d23\u7ba1\u7406 EKS \u6258\u7ba1\u7684 Kubernetes \u63a7\u5236\u5e73\u9762\u3002\u8fd9\u5305\u62ec Kubernetes \u63a7\u5236\u5e73\u9762\u8282\u70b9\u3001ETCD \u6570\u636e\u5e93\u4ee5\u53ca AWS \u4ea4\u4ed8\u5b89\u5168\u53ef\u9760\u670d\u52a1\u6240\u9700\u7684\u5176\u4ed6\u57fa\u7840\u8bbe\u65bd\u3002\u4f5c\u4e3a EKS \u7684\u6d88\u8d39\u8005\uff0c\u60a8\u4e3b\u8981\u8d1f\u8d23\u672c\u6307\u5357\u4e2d\u7684\u4e3b\u9898\uff0c\u4f8b\u5982 IAM\u3001Pod \u5b89\u5168\u6027\u3001\u8fd0\u884c\u65f6\u5b89\u5168\u6027\u3001\u7f51\u7edc\u5b89\u5168\u6027\u7b49\u3002</p> <p>\u5728\u57fa\u7840\u8bbe\u65bd\u5b89\u5168\u65b9\u9762\uff0c\u968f\u7740\u4ece\u81ea\u7ba1\u7406\u5de5\u4f5c\u8282\u70b9\u5230\u6258\u7ba1\u8282\u70b9\u7ec4\u518d\u5230 Fargate\uff0cAWS \u5c06\u627f\u62c5\u66f4\u591a\u8d23\u4efb\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e Fargate\uff0cAWS \u5c06\u8d1f\u8d23\u786e\u4fdd\u8fd0\u884c\u60a8\u7684 Pod \u7684\u5e95\u5c42\u5b9e\u4f8b/\u8fd0\u884c\u65f6\u7684\u5b89\u5168\u3002</p> <p></p> <p>AWS \u8fd8\u5c06\u8d1f\u8d23\u4f7f EKS \u4f18\u5316\u7684 AMI \u4fdd\u6301\u6700\u65b0\u7684 Kubernetes \u8865\u4e01\u7248\u672c\u548c\u5b89\u5168\u8865\u4e01\u3002\u4f7f\u7528\u6258\u7ba1\u8282\u70b9\u7ec4 (MNG) \u7684\u5ba2\u6237\u8d1f\u8d23\u901a\u8fc7 EKS API\u3001CLI\u3001Cloudformation \u6216 AWS \u63a7\u5236\u53f0\u5c06\u5176\u8282\u70b9\u7ec4\u5347\u7ea7\u5230\u6700\u65b0\u7684 AMI\u3002\u53e6\u5916\uff0c\u4e0e Fargate \u4e0d\u540c\uff0cMNG \u4e0d\u4f1a\u81ea\u52a8\u6269\u5c55\u60a8\u7684\u57fa\u7840\u8bbe\u65bd/\u96c6\u7fa4\u3002\u8fd9\u53ef\u4ee5\u7531 cluster-autoscaler \u6216\u5176\u4ed6\u6280\u672f(\u5982 Karpenter\u3001AWS \u672c\u5730\u81ea\u52a8\u7f29\u653e\u3001SpotInst \u7684 Ocean \u6216 Atlassian \u7684 Escalator) \u6765\u5904\u7406\u3002</p> <p></p> <p>\u5728\u8bbe\u8ba1\u7cfb\u7edf\u4e4b\u524d\uff0c\u4e86\u89e3\u60a8\u7684\u8d23\u4efb\u4e0e\u670d\u52a1\u63d0\u4f9b\u5546 (AWS) \u7684\u8d23\u4efb\u4e4b\u95f4\u7684\u5206\u754c\u7ebf\u975e\u5e38\u91cd\u8981\u3002</p> <p>\u6709\u5173\u5171\u4eab\u8d23\u4efb\u6a21\u578b\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://aws.amazon.com/compliance/shared-responsibility-model/</p>"},{"location":"zh/security/docs/#_3","title":"\u7b80\u4ecb","text":"<p>\u5728\u4f7f\u7528 EKS \u7b49\u6258\u7ba1 Kubernetes \u670d\u52a1\u65f6\uff0c\u6709\u51e0\u4e2a\u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u9886\u57df\u5f88\u91cd\u8981\uff1a</p> <ul> <li>\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406</li> <li>Pod \u5b89\u5168\u6027</li> <li>\u8fd0\u884c\u65f6\u5b89\u5168\u6027</li> <li>\u7f51\u7edc\u5b89\u5168\u6027</li> <li>\u591a\u79df\u6237</li> <li>\u591a\u8d26\u6237\u7528\u4e8e\u591a\u79df\u6237</li> <li>\u68c0\u6d4b\u63a7\u5236</li> <li>\u57fa\u7840\u8bbe\u65bd\u5b89\u5168\u6027</li> <li>\u6570\u636e\u52a0\u5bc6\u548c\u5bc6\u94a5\u7ba1\u7406</li> <li>\u6cd5\u89c4\u9075\u4ece\u6027</li> <li>\u4e8b\u4ef6\u54cd\u5e94\u548c\u53d6\u8bc1</li> <li>\u955c\u50cf\u5b89\u5168\u6027</li> </ul> <p>\u5728\u8bbe\u8ba1\u4efb\u4f55\u7cfb\u7edf\u65f6\uff0c\u60a8\u90fd\u9700\u8981\u8003\u8651\u5176\u5b89\u5168\u5f71\u54cd\u4ee5\u53ca\u53ef\u80fd\u5f71\u54cd\u5b89\u5168\u6001\u52bf\u7684\u5b9e\u8df5\u3002\u4f8b\u5982\uff0c\u60a8\u9700\u8981\u63a7\u5236\u8c01\u53ef\u4ee5\u5bf9\u4e00\u7ec4\u8d44\u6e90\u6267\u884c\u64cd\u4f5c\u3002\u60a8\u8fd8\u9700\u8981\u80fd\u591f\u5feb\u901f\u8bc6\u522b\u5b89\u5168\u4e8b\u4ef6\uff0c\u4fdd\u62a4\u7cfb\u7edf\u548c\u670d\u52a1\u514d\u53d7\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\uff0c\u5e76\u901a\u8fc7\u6570\u636e\u4fdd\u62a4\u6765\u7ef4\u62a4\u6570\u636e\u7684\u673a\u5bc6\u6027\u548c\u5b8c\u6574\u6027\u3002\u62e5\u6709\u4e00\u5957\u660e\u786e\u5b9a\u4e49\u548c\u7ecf\u8fc7\u6f14\u7ec3\u7684\u54cd\u5e94\u5b89\u5168\u4e8b\u4ef6\u7684\u6d41\u7a0b\u4e5f\u5c06\u63d0\u9ad8\u60a8\u7684\u5b89\u5168\u6001\u52bf\u3002\u8fd9\u4e9b\u5de5\u5177\u548c\u6280\u672f\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u5b83\u4eec\u652f\u6301\u8bf8\u5982\u9632\u6b62\u8d22\u52a1\u635f\u5931\u6216\u9075\u5b88\u76d1\u7ba1\u4e49\u52a1\u7b49\u76ee\u6807\u3002</p> <p>AWS \u901a\u8fc7\u63d0\u4f9b\u4e00\u5957\u4e30\u5bcc\u7684\u5b89\u5168\u670d\u52a1\u6765\u5e2e\u52a9\u7ec4\u7ec7\u5b9e\u73b0\u5176\u5b89\u5168\u548c\u5408\u89c4\u76ee\u6807\uff0c\u8fd9\u4e9b\u670d\u52a1\u662f\u6839\u636e\u5e7f\u6cdb\u7684\u5b89\u5168\u610f\u8bc6\u5ba2\u6237\u7684\u53cd\u9988\u800c\u4e0d\u65ad\u53d1\u5c55\u7684\u3002\u901a\u8fc7\u63d0\u4f9b\u9ad8\u5ea6\u5b89\u5168\u7684\u57fa\u7840\uff0c\u5ba2\u6237\u53ef\u4ee5\u51cf\u5c11\"\u975e\u5dee\u5f02\u5316\u7684\u7e41\u91cd\u5de5\u4f5c\",\u800c\u5c06\u66f4\u591a\u65f6\u95f4\u7528\u4e8e\u5b9e\u73b0\u4e1a\u52a1\u76ee\u6807\u3002</p>"},{"location":"zh/security/docs/#_4","title":"\u53cd\u9988","text":"<p>\u672c\u6307\u5357\u5728 GitHub \u4e0a\u53d1\u5e03\uff0c\u4ee5\u4fbf\u4ece\u66f4\u5e7f\u6cdb\u7684 EKS/Kubernetes \u793e\u533a\u6536\u96c6\u76f4\u63a5\u53cd\u9988\u548c\u5efa\u8bae\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u8ba4\u4e3a\u6211\u4eec\u5e94\u8be5\u5728\u6307\u5357\u4e2d\u5305\u542b\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u8bf7\u5728 GitHub \u5b58\u50a8\u5e93\u4e2d\u63d0\u51fa\u95ee\u9898\u6216\u63d0\u4ea4 PR\u3002\u6211\u4eec\u7684\u76ee\u7684\u662f\u5728\u670d\u52a1\u6dfb\u52a0\u65b0\u529f\u80fd\u6216\u51fa\u73b0\u65b0\u7684\u6700\u4f73\u5b9e\u8df5\u65f6\uff0c\u5b9a\u671f\u66f4\u65b0\u672c\u6307\u5357\u3002</p>"},{"location":"zh/security/docs/#_5","title":"\u8fdb\u4e00\u6b65\u9605\u8bfb","text":"<p>Kubernetes \u5b89\u5168\u767d\u76ae\u4e66,\u7531\u5b89\u5168\u5ba1\u8ba1\u5de5\u4f5c\u7ec4\u8d5e\u52a9\uff0c\u672c\u767d\u76ae\u4e66\u63cf\u8ff0\u4e86 Kubernetes \u653b\u51fb\u9762\u548c\u5b89\u5168\u67b6\u6784\u7684\u5173\u952e\u65b9\u9762\uff0c\u65e8\u5728\u5e2e\u52a9\u5b89\u5168\u4ece\u4e1a\u4eba\u5458\u505a\u51fa\u660e\u667a\u7684\u8bbe\u8ba1\u548c\u5b9e\u65bd\u51b3\u7b56\u3002</p> <p>CNCF \u8fd8\u53d1\u5e03\u4e86\u4e00\u4efd\u767d\u76ae\u4e66\u5173\u4e8e\u4e91\u539f\u751f\u5b89\u5168\u3002\u8be5\u767d\u76ae\u4e66\u68c0\u67e5\u4e86\u6280\u672f\u73af\u5883\u5982\u4f55\u53d1\u5c55\uff0c\u5e76\u5021\u5bfc\u91c7\u7528\u4e0e DevOps \u6d41\u7a0b\u548c\u654f\u6377\u65b9\u6cd5\u76f8\u4e00\u81f4\u7684\u5b89\u5168\u5b9e\u8df5\u3002</p>"},{"location":"zh/security/docs/#_6","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<p>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a</p>"},{"location":"zh/security/docs/compliance/","title":"\u5408\u89c4\u6027","text":"<p>\u5408\u89c4\u6027\u662fAWS\u4e0e\u5176\u670d\u52a1\u6d88\u8d39\u8005\u4e4b\u95f4\u7684\u5171\u540c\u8d23\u4efb\u3002\u4e00\u822c\u800c\u8a00\uff0cAWS\u8d1f\u8d23\"\u4e91\u7684\u5b89\u5168\u6027\",\u800c\u5176\u7528\u6237\u5219\u8d1f\u8d23\"\u4e91\u4e2d\u7684\u5b89\u5168\u6027\"\u3002AWS\u548c\u5176\u7528\u6237\u8d1f\u8d23\u7684\u8303\u56f4\u5c06\u56e0\u670d\u52a1\u800c\u5f02\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8eFargate\uff0cAWS\u8d1f\u8d23\u7ba1\u7406\u5176\u6570\u636e\u4e2d\u5fc3\u7684\u7269\u7406\u5b89\u5168\u6027\u3001\u786c\u4ef6\u3001\u865a\u62df\u57fa\u7840\u8bbe\u65bd(Amazon EC2)\u548c\u5bb9\u5668\u8fd0\u884c\u65f6(Docker)\u3002Fargate\u7684\u7528\u6237\u5219\u8d1f\u8d23\u786e\u4fdd\u5bb9\u5668\u955c\u50cf\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\u3002\u4e86\u89e3\u8c01\u8d1f\u8d23\u4ec0\u4e48\u662f\u8fd0\u884c\u5fc5\u987b\u9075\u5b88\u5408\u89c4\u6807\u51c6\u7684\u5de5\u4f5c\u8d1f\u8f7d\u65f6\u7684\u4e00\u4e2a\u91cd\u8981\u8003\u8651\u56e0\u7d20\u3002</p> <p>\u4e0b\u8868\u663e\u793a\u4e86\u4e0d\u540c\u5bb9\u5668\u670d\u52a1\u7b26\u5408\u7684\u5408\u89c4\u6027\u7a0b\u5e8f\u3002</p> \u5408\u89c4\u6027\u7a0b\u5e8f Amazon ECS \u7f16\u6392\u5668 Amazon EKS \u7f16\u6392\u5668 ECS Fargate Amazon ECR PCI DSS 1\u7ea7 1 1 1 1 HIPAA \u5408\u683c 1 1 1 1 SOC I 1 1 1 1 SOC II 1 1 1 1 SOC III 1 1 1 1 ISO 27001:2013 1 1 1 1 ISO 9001:2015 1 1 1 1 ISO 27017:2015 1 1 1 1 ISO 27018:2019 1 1 1 1 IRAP 1 1 1 1 FedRAMP \u4e2d\u7b49\u7ea7(\u4e1c\u90e8/\u897f\u90e8) 1 1 0 1 FedRAMP \u9ad8\u7ea7(GovCloud) 1 1 0 1 DOD CC SRG 1 DISA \u5ba1\u67e5(IL5) 0 1 HIPAA BAA 1 1 1 1 MTCS 1 1 0 1 C5 1 1 0 1 K-ISMS 1 1 0 1 ENS \u9ad8\u7ea7 1 1 0 1 OSPAR 1 1 0 1 HITRUST CSF 1 1 1 1 <p>\u5408\u89c4\u6027\u72b6\u6001\u4f1a\u968f\u65f6\u95f4\u800c\u53d8\u5316\u3002\u6709\u5173\u6700\u65b0\u72b6\u6001\uff0c\u8bf7\u59cb\u7ec8\u53c2\u8003 https://aws.amazon.com/compliance/services-in-scope/\u3002</p> <p>\u6709\u5173\u4e91\u8ba4\u8bc1\u6a21\u578b\u548c\u6700\u4f73\u5b9e\u8df5\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 AWS \u767d\u76ae\u4e66 Accreditation Models for Secure Cloud Adoption</p>"},{"location":"zh/security/docs/compliance/#_2","title":"\u5de6\u79fb","text":"<p>\u5de6\u79fb\u7684\u6982\u5ff5\u6d89\u53ca\u5728\u8f6f\u4ef6\u5f00\u53d1\u751f\u547d\u5468\u671f\u7684\u65e9\u671f\u6355\u83b7\u653f\u7b56\u8fdd\u89c4\u548c\u9519\u8bef\u3002\u4ece\u5b89\u5168\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5e26\u6765\u5f88\u5927\u597d\u5904\u3002\u4f8b\u5982\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u5728\u5c06\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230\u96c6\u7fa4\u4e4b\u524d\u4fee\u590d\u5176\u914d\u7f6e\u4e2d\u7684\u95ee\u9898\u3002\u63d0\u65e9\u53d1\u73b0\u5e76\u4fee\u590d\u8fd9\u7c7b\u9519\u8bef\u5c06\u6709\u52a9\u4e8e\u9632\u6b62\u8fdd\u53cd\u653f\u7b56\u7684\u914d\u7f6e\u88ab\u90e8\u7f72\u3002</p>"},{"location":"zh/security/docs/compliance/#_3","title":"\u4f5c\u4e3a\u4ee3\u7801\u7684\u653f\u7b56","text":"<p>\u653f\u7b56\u53ef\u4ee5\u88ab\u89c6\u4e3a\u7ba1\u7406\u884c\u4e3a\u7684\u4e00\u7ec4\u89c4\u5219\uff0c\u5373\u5141\u8bb8\u6216\u7981\u6b62\u7684\u884c\u4e3a\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u6709\u4e00\u9879\u653f\u7b56\u89c4\u5b9a\u6240\u6709 Dockerfile \u90fd\u5e94\u5305\u542b\u4e00\u4e2a USER \u6307\u4ee4\uff0c\u4f7f\u5bb9\u5668\u4ee5\u975e root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\u3002\u4f5c\u4e3a\u6587\u6863\uff0c\u8fd9\u6837\u7684\u653f\u7b56\u53ef\u80fd\u96be\u4ee5\u53d1\u73b0\u548c\u6267\u884c\u3002\u968f\u7740\u60a8\u7684\u8981\u6c42\u53d1\u751f\u53d8\u5316\uff0c\u5b83\u4e5f\u53ef\u80fd\u4f1a\u8fc7\u65f6\u3002\u4f7f\u7528\u4f5c\u4e3a\u4ee3\u7801\u7684\u653f\u7b56(PaC)\u89e3\u51b3\u65b9\u6848\uff0c\u60a8\u53ef\u4ee5\u81ea\u52a8\u5316\u5b89\u5168\u6027\u3001\u5408\u89c4\u6027\u548c\u9690\u79c1\u63a7\u5236\uff0c\u4ee5\u68c0\u6d4b\u3001\u9884\u9632\u3001\u51cf\u5c11\u548c\u5e94\u5bf9\u5df2\u77e5\u548c\u6301\u7eed\u7684\u5a01\u80c1\u3002\u6b64\u5916\uff0c\u5b83\u4eec\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\uff0c\u53ef\u4ee5\u5c06\u60a8\u7684\u653f\u7b56\u7f16\u7801\u5e76\u50cf\u7ba1\u7406\u5176\u4ed6\u4ee3\u7801\u5de5\u4ef6\u4e00\u6837\u7ba1\u7406\u5b83\u4eec\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u597d\u5904\u662f\uff0c\u60a8\u53ef\u4ee5\u91cd\u7528 DevOps \u548c GitOps \u7b56\u7565\u6765\u7ba1\u7406\u548c\u4e00\u81f4\u5730\u5e94\u7528\u4e8e\u6574\u4e2a Kubernetes \u96c6\u7fa4\u3002\u6709\u5173 PaC \u9009\u9879\u548c PSP \u7684\u672a\u6765\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Pod \u5b89\u5168\u6027\u3002</p>"},{"location":"zh/security/docs/compliance/#_4","title":"\u5728\u7ba1\u9053\u4e2d\u4f7f\u7528\u4f5c\u4e3a\u4ee3\u7801\u7684\u653f\u7b56\u5de5\u5177\u6765\u68c0\u6d4b\u90e8\u7f72\u524d\u7684\u8fdd\u89c4\u884c\u4e3a","text":"<ul> <li>OPA \u662f CNCF \u7684\u4e00\u4e2a\u5f00\u6e90\u653f\u7b56\u5f15\u64ce\u3002\u5b83\u7528\u4e8e\u505a\u51fa\u653f\u7b56\u51b3\u7b56\uff0c\u53ef\u4ee5\u4ee5\u591a\u79cd\u4e0d\u540c\u65b9\u5f0f\u8fd0\u884c\uff0c\u4f8b\u5982\u4f5c\u4e3a\u8bed\u8a00\u5e93\u6216\u670d\u52a1\u3002OPA \u7b56\u7565\u662f\u7528\u4e00\u79cd\u540d\u4e3a Rego \u7684\u9886\u57df\u7279\u5b9a\u8bed\u8a00(DSL)\u7f16\u5199\u7684\u3002\u867d\u7136\u5b83\u901a\u5e38\u4f5c\u4e3a Gatekeeper \u9879\u76ee\u7684 Kubernetes \u52a8\u6001\u51c6\u5165\u63a7\u5236\u5668\u7684\u4e00\u90e8\u5206\u8fd0\u884c\uff0c\u4f46 OPA \u4e5f\u53ef\u4ee5\u88ab\u7eb3\u5165\u60a8\u7684 CI/CD \u7ba1\u9053\u3002\u8fd9\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u5728\u53d1\u5e03\u5468\u671f\u7684\u65e9\u671f\u83b7\u5f97\u6709\u5173\u5176\u914d\u7f6e\u7684\u53cd\u9988\uff0c\u4ece\u800c\u53ef\u4ee5\u5728\u8fdb\u5165\u751f\u4ea7\u73af\u5883\u4e4b\u524d\u89e3\u51b3\u95ee\u9898\u3002\u4e00\u7ec4\u5e38\u89c1\u7684 OPA \u7b56\u7565\u53ef\u4ee5\u5728\u672c\u9879\u76ee\u7684 GitHub \u5b58\u50a8\u5e93\u4e2d\u627e\u5230\u3002</li> <li>Conftest \u5efa\u7acb\u5728 OPA \u4e4b\u4e0a\uff0c\u5b83\u4e3a\u6d4b\u8bd5 Kubernetes \u914d\u7f6e\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9762\u5411\u5f00\u53d1\u4eba\u5458\u7684\u4f53\u9a8c\u3002</li> <li>Kyverno \u662f\u4e00\u4e2a\u4e3a Kubernetes \u8bbe\u8ba1\u7684\u7b56\u7565\u5f15\u64ce\u3002\u4f7f\u7528 Kyverno\uff0c\u7b56\u7565\u88ab\u7ba1\u7406\u4e3a Kubernetes \u8d44\u6e90\uff0c\u65e0\u9700\u5b66\u4e60\u65b0\u7684\u8bed\u8a00\u5373\u53ef\u7f16\u5199\u7b56\u7565\u3002\u8fd9\u5141\u8bb8\u4f7f\u7528\u719f\u6089\u7684\u5de5\u5177(\u5982 kubectl\u3001git \u548c kustomize)\u6765\u7ba1\u7406\u7b56\u7565\u3002Kyverno \u7b56\u7565\u53ef\u4ee5\u9a8c\u8bc1\u3001\u53d8\u66f4\u548c\u751f\u6210 Kubernetes \u8d44\u6e90\uff0c\u5e76\u786e\u4fdd OCI \u955c\u50cf\u4f9b\u5e94\u94fe\u5b89\u5168\u3002Kyverno CLI \u53ef\u7528\u4e8e\u5728 CI/CD \u7ba1\u9053\u4e2d\u6d4b\u8bd5\u7b56\u7565\u548c\u9a8c\u8bc1\u8d44\u6e90\u3002\u6240\u6709 Kyverno \u793e\u533a\u7b56\u7565\u90fd\u53ef\u4ee5\u5728 Kyverno \u7f51\u7ad9\u4e0a\u627e\u5230\uff0c\u6709\u5173\u5728\u7ba1\u9053\u4e2d\u4f7f\u7528 Kyverno CLI \u7f16\u5199\u6d4b\u8bd5\u7684\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605 policies \u5b58\u50a8\u5e93\u3002</li> </ul>"},{"location":"zh/security/docs/compliance/#_5","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a - \u76d1\u7ba1\u5408\u89c4\u6027</li> <li>kube-bench</li> <li>docker-bench-security</li> <li>AWS Inspector</li> <li>Kubernetes \u5b89\u5168\u5ba1\u67e5 Kubernetes 1.13.4 (2019) \u7684\u7b2c\u4e09\u65b9\u5b89\u5168\u8bc4\u4f30</li> <li>NeuVector by SUSE \u5f00\u6e90\u3001\u96f6\u4fe1\u4efb\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\uff0c\u63d0\u4f9b\u5408\u89c4\u6027\u62a5\u544a\u548c\u81ea\u5b9a\u4e49\u5408\u89c4\u6027\u68c0\u67e5</li> </ul>"},{"location":"zh/security/docs/data/","title":"\u6570\u636e\u52a0\u5bc6\u548c\u5bc6\u94a5\u7ba1\u7406","text":""},{"location":"zh/security/docs/data/#_2","title":"\u9759\u6001\u52a0\u5bc6","text":"<p>\u60a8\u53ef\u4ee5\u5728 Kubernetes \u4e2d\u4f7f\u7528\u4e09\u79cd\u4e0d\u540c\u7684 AWS \u539f\u751f\u5b58\u50a8\u9009\u9879\uff1aEBS\u3001EFS \u548c FSx for Lustre\u3002\u6240\u6709\u4e09\u79cd\u9009\u9879\u90fd\u63d0\u4f9b\u4f7f\u7528\u670d\u52a1\u7ba1\u7406\u5bc6\u94a5\u6216\u5ba2\u6237\u4e3b\u5bc6\u94a5 (CMK) \u7684\u9759\u6001\u52a0\u5bc6\u3002\u5bf9\u4e8e EBS\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5185\u7f6e\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f\u6216 EBS CSI \u9a71\u52a8\u7a0b\u5e8f\u3002\u4e24\u8005\u90fd\u5305\u542b\u7528\u4e8e\u52a0\u5bc6\u5377\u548c\u63d0\u4f9b CMK \u7684\u53c2\u6570\u3002\u5bf9\u4e8e EFS\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 EFS CSI \u9a71\u52a8\u7a0b\u5e8f\uff0c\u4f46\u4e0e EBS \u4e0d\u540c\uff0cEFS CSI \u9a71\u52a8\u7a0b\u5e8f\u4e0d\u652f\u6301\u52a8\u6001\u914d\u7f6e\u3002\u5982\u679c\u60a8\u60f3\u5728 EKS \u4e2d\u4f7f\u7528 EFS\uff0c\u60a8\u9700\u8981\u5728\u521b\u5efa PV \u4e4b\u524d\u9884\u5148\u914d\u7f6e\u6587\u4ef6\u7cfb\u7edf\u7684\u9759\u6001\u52a0\u5bc6\u3002\u6709\u5173 EFS \u6587\u4ef6\u52a0\u5bc6\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u52a0\u5bc6\u9759\u6001\u6570\u636e\u3002\u9664\u4e86\u63d0\u4f9b\u9759\u6001\u52a0\u5bc6\u5916\uff0cEFS \u548c FSx for Lustre \u8fd8\u5305\u62ec\u52a0\u5bc6\u4f20\u8f93\u4e2d\u6570\u636e\u7684\u9009\u9879\u3002FSx for Luster \u9ed8\u8ba4\u6267\u884c\u6b64\u64cd\u4f5c\u3002\u5bf9\u4e8e EFS\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 PV \u7684 <code>mountOptions</code> \u4e2d\u6dfb\u52a0 <code>tls</code> \u53c2\u6570\u6765\u542f\u7528\u4f20\u8f93\u52a0\u5bc6\uff0c\u5982\u4e0b\u4f8b\u6240\u793a\uff1a</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: efs-pv\nspec:\n  capacity:\n    storage: 5Gi\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: efs-sc\n  mountOptions:\n    - tls\n  csi:\n    driver: efs.csi.aws.com\n    volumeHandle: &lt;file_system_id&gt;\n</code></pre> <p>FSx CSI \u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u52a8\u6001\u914d\u7f6e Lustre \u6587\u4ef6\u7cfb\u7edf\u3002\u5b83\u9ed8\u8ba4\u4f7f\u7528\u670d\u52a1\u7ba1\u7406\u5bc6\u94a5\u52a0\u5bc6\u6570\u636e\uff0c\u4f46\u4e5f\u53ef\u4ee5\u9009\u62e9\u63d0\u4f9b\u60a8\u81ea\u5df1\u7684 CMK\uff0c\u5982\u4e0b\u4f8b\u6240\u793a\uff1a</p> <pre><code>kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: fsx-sc\nprovisioner: fsx.csi.aws.com\nparameters:\n  subnetId: subnet-056da83524edbe641\n  securityGroupIds: sg-086f61ea73388fb6b\n  deploymentType: PERSISTENT_1\n  kmsKeyId: &lt;kms_arn&gt;\n</code></pre> <p>Attention</p> <p>\u622a\u81f3 2020 \u5e74 5 \u6708 28 \u65e5\uff0c\u6240\u6709\u5199\u5165 EKS Fargate pod \u4e34\u65f6\u5377\u7684\u6570\u636e\u90fd\u9ed8\u8ba4\u4f7f\u7528\u884c\u4e1a\u6807\u51c6 AES-256 \u52a0\u5bc6\u7b97\u6cd5\u8fdb\u884c\u52a0\u5bc6\u3002\u60a8\u65e0\u9700\u5bf9\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u4efb\u4f55\u4fee\u6539\uff0c\u56e0\u4e3a\u52a0\u5bc6\u548c\u89e3\u5bc6\u7531\u670d\u52a1\u65e0\u7f1d\u5904\u7406\u3002</p>"},{"location":"zh/security/docs/data/#_3","title":"\u52a0\u5bc6\u9759\u6001\u6570\u636e","text":"<p>\u52a0\u5bc6\u9759\u6001\u6570\u636e\u88ab\u8ba4\u4e3a\u662f\u6700\u4f73\u5b9e\u8df5\u3002\u5982\u679c\u60a8\u4e0d\u786e\u5b9a\u662f\u5426\u9700\u8981\u52a0\u5bc6\uff0c\u8bf7\u52a0\u5bc6\u60a8\u7684\u6570\u636e\u3002</p>"},{"location":"zh/security/docs/data/#cmk","title":"\u5b9a\u671f\u8f6e\u6362\u60a8\u7684 CMK","text":"<p>\u914d\u7f6e KMS \u81ea\u52a8\u8f6e\u6362\u60a8\u7684 CMK\u3002\u8fd9\u5c06\u6bcf\u5e74\u8f6e\u6362\u4e00\u6b21\u60a8\u7684\u5bc6\u94a5\uff0c\u540c\u65f6\u65e0\u9650\u671f\u4fdd\u7559\u65e7\u5bc6\u94a5\uff0c\u4ee5\u4fbf\u60a8\u7684\u6570\u636e\u4ecd\u53ef\u89e3\u5bc6\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u8f6e\u6362\u5ba2\u6237\u4e3b\u5bc6\u94a5</p>"},{"location":"zh/security/docs/data/#efs","title":"\u4f7f\u7528 EFS \u8bbf\u95ee\u70b9\u6765\u7b80\u5316\u5bf9\u5171\u4eab\u6570\u636e\u96c6\u7684\u8bbf\u95ee","text":"<p>\u5982\u679c\u60a8\u6709\u5177\u6709\u4e0d\u540c POSIX \u6587\u4ef6\u6743\u9650\u7684\u5171\u4eab\u6570\u636e\u96c6\u6216\u60f3\u901a\u8fc7\u521b\u5efa\u4e0d\u540c\u7684\u6302\u8f7d\u70b9\u6765\u9650\u5236\u5bf9\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u7684\u90e8\u5206\u8bbf\u95ee\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 EFS \u8bbf\u95ee\u70b9\u3002\u8981\u4e86\u89e3\u6709\u5173\u4f7f\u7528\u8bbf\u95ee\u70b9\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://docs.aws.amazon.com/efs/latest/ug/efs-access-points.html\u3002\u5982\u4eca\uff0c\u5982\u679c\u60a8\u60f3\u4f7f\u7528\u8bbf\u95ee\u70b9 (AP)\uff0c\u60a8\u9700\u8981\u5728 PV \u7684 <code>volumeHandle</code> \u53c2\u6570\u4e2d\u5f15\u7528\u8be5 AP\u3002</p> <p>Attention</p> <p>\u622a\u81f3 2021 \u5e74 3 \u6708 23 \u65e5\uff0cEFS CSI \u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u52a8\u6001\u914d\u7f6e EFS \u8bbf\u95ee\u70b9\u3002\u8bbf\u95ee\u70b9\u662f\u8fdb\u5165 EFS \u6587\u4ef6\u7cfb\u7edf\u7684\u5e94\u7528\u7a0b\u5e8f\u7279\u5b9a\u5165\u53e3\u70b9\uff0c\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u5728\u591a\u4e2a pod \u4e4b\u95f4\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u3002\u6bcf\u4e2a EFS \u6587\u4ef6\u7cfb\u7edf\u6700\u591a\u53ef\u4ee5\u6709 120 \u4e2a PV\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4ecb\u7ecd Amazon EFS CSI \u52a8\u6001\u914d\u7f6e\u3002</p>"},{"location":"zh/security/docs/data/#_4","title":"\u5bc6\u94a5\u7ba1\u7406","text":"<p>Kubernetes \u5bc6\u94a5\u7528\u4e8e\u5b58\u50a8\u654f\u611f\u4fe1\u606f\uff0c\u5982\u7528\u6237\u8bc1\u4e66\u3001\u5bc6\u7801\u6216 API \u5bc6\u94a5\u3002\u5b83\u4eec\u4ee5 base64 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u6301\u4e45\u5316\u5b58\u50a8\u5728 etcd \u4e2d\u3002\u5728 EKS \u4e0a\uff0cetcd \u8282\u70b9\u7684 EBS \u5377\u4f7f\u7528 EBS \u52a0\u5bc6\u8fdb\u884c\u52a0\u5bc6\u3002Pod \u53ef\u4ee5\u901a\u8fc7\u5728 <code>podSpec</code> \u4e2d\u5f15\u7528\u5bc6\u94a5\u6765\u68c0\u7d22 Kubernetes \u5bc6\u94a5\u5bf9\u8c61\u3002\u8fd9\u4e9b\u5bc6\u94a5\u53ef\u4ee5\u6620\u5c04\u4e3a\u73af\u5883\u53d8\u91cf\u6216\u6302\u8f7d\u4e3a\u5377\u3002\u6709\u5173\u521b\u5efa\u5bc6\u94a5\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://kubernetes.io/docs/concepts/configuration/secret/\u3002</p> <p>Caution</p> <p>\u7279\u5b9a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709 pod \u90fd\u53ef\u4ee5\u5f15\u7528\u8be5\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u5bc6\u94a5\u3002</p> <p>Caution</p> <p>\u8282\u70b9\u6388\u6743\u5668\u5141\u8bb8 Kubelet \u8bfb\u53d6\u6302\u8f7d\u5230\u8282\u70b9\u7684\u6240\u6709\u5bc6\u94a5\u3002</p>"},{"location":"zh/security/docs/data/#aws-kms-kubernetes","title":"\u4f7f\u7528 AWS KMS \u5bf9 Kubernetes \u5bc6\u94a5\u8fdb\u884c\u4fe1\u5c01\u52a0\u5bc6","text":"<p>\u8fd9\u5141\u8bb8\u60a8\u4f7f\u7528\u552f\u4e00\u7684\u6570\u636e\u52a0\u5bc6\u5bc6\u94a5 (DEK) \u52a0\u5bc6\u60a8\u7684\u5bc6\u94a5\u3002\u7136\u540e\uff0cDEK \u4f7f\u7528\u6765\u81ea AWS KMS \u7684\u5bc6\u94a5\u52a0\u5bc6\u5bc6\u94a5 (KEK) \u8fdb\u884c\u52a0\u5bc6\uff0cKEK \u53ef\u4ee5\u6309\u7167\u5b9a\u671f\u8ba1\u5212\u81ea\u52a8\u8f6e\u6362\u3002\u4f7f\u7528 Kubernetes \u7684 KMS \u63d2\u4ef6\uff0c\u6240\u6709 Kubernetes \u5bc6\u94a5\u90fd\u4ee5\u5bc6\u6587\u5f62\u5f0f\u5b58\u50a8\u5728 etcd \u4e2d\uff0c\u800c\u4e0d\u662f\u660e\u6587\uff0c\u5e76\u4e14\u53ea\u80fd\u7531 Kubernetes API \u670d\u52a1\u5668\u89e3\u5bc6\u3002 \u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4f7f\u7528 EKS \u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u652f\u6301\u5b9e\u73b0\u6df1\u5ea6\u9632\u5fa1</p>"},{"location":"zh/security/docs/data/#kubernetes","title":"\u5ba1\u8ba1 Kubernetes \u5bc6\u94a5\u7684\u4f7f\u7528\u60c5\u51b5","text":"<p>\u5728 EKS \u4e0a\uff0c\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7\u8bb0\u5f55\u5e76\u521b\u5efa CloudWatch \u6307\u6807\u8fc7\u6ee4\u5668\u548c\u8b66\u62a5\uff0c\u4ee5\u5728\u4f7f\u7528\u5bc6\u94a5\u65f6\u5411\u60a8\u53d1\u51fa\u8b66\u62a5\uff08\u53ef\u9009\uff09\u3002\u4ee5\u4e0b\u662f Kubernetes \u5ba1\u8ba1\u65e5\u5fd7\u7684\u6307\u6807\u8fc7\u6ee4\u5668\u793a\u4f8b\uff1a<code>{($.verb=\"get\") &amp;&amp; ($.objectRef.resource=\"secret\")}</code>\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u67e5\u8be2\u4e0e CloudWatch Log Insights \u4e00\u8d77\u4f7f\u7528\uff1a</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| stats count(*) by objectRef.name as secret\n| filter verb=\"get\" and objectRef.resource=\"secrets\"\n</code></pre> <p>\u4e0a\u8ff0\u67e5\u8be2\u5c06\u663e\u793a\u5728\u7279\u5b9a\u65f6\u95f4\u8303\u56f4\u5185\u8bbf\u95ee\u5bc6\u94a5\u7684\u6b21\u6570\u3002</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter verb=\"get\" and objectRef.resource=\"secrets\"\n| display objectRef.namespace, objectRef.name, user.username, responseStatus.code\n</code></pre> <p>\u6b64\u67e5\u8be2\u5c06\u663e\u793a\u5bc6\u94a5\u4ee5\u53ca\u5c1d\u8bd5\u8bbf\u95ee\u5bc6\u94a5\u7684\u7528\u6237\u7684\u547d\u540d\u7a7a\u95f4\u3001\u7528\u6237\u540d\u548c\u54cd\u5e94\u4ee3\u7801\u3002</p>"},{"location":"zh/security/docs/data/#_5","title":"\u5b9a\u671f\u8f6e\u6362\u60a8\u7684\u5bc6\u94a5","text":"<p>Kubernetes \u4e0d\u4f1a\u81ea\u52a8\u8f6e\u6362\u5bc6\u94a5\u3002\u5982\u679c\u60a8\u5fc5\u987b\u8f6e\u6362\u5bc6\u94a5\uff0c\u8bf7\u8003\u8651\u4f7f\u7528\u5916\u90e8\u5bc6\u94a5\u5b58\u50a8\uff0c\u4f8b\u5982 Vault \u6216 AWS Secrets Manager\u3002</p>"},{"location":"zh/security/docs/data/#_6","title":"\u4f7f\u7528\u5355\u72ec\u7684\u547d\u540d\u7a7a\u95f4\u4f5c\u4e3a\u9694\u79bb\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u5bc6\u94a5\u7684\u65b9\u5f0f","text":"<p>\u5982\u679c\u60a8\u6709\u4e0d\u80fd\u5728\u547d\u540d\u7a7a\u95f4\u4e4b\u95f4\u5171\u4eab\u7684\u5bc6\u94a5\uff0c\u8bf7\u4e3a\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u5355\u72ec\u7684\u547d\u540d\u7a7a\u95f4\u3002</p>"},{"location":"zh/security/docs/data/#_7","title":"\u4f7f\u7528\u5377\u6302\u8f7d\u800c\u4e0d\u662f\u73af\u5883\u53d8\u91cf","text":"<p>\u73af\u5883\u53d8\u91cf\u7684\u503c\u53ef\u80fd\u4f1a\u65e0\u610f\u4e2d\u51fa\u73b0\u5728\u65e5\u5fd7\u4e2d\u3002\u6302\u8f7d\u4e3a\u5377\u7684\u5bc6\u94a5\u4f1a\u5b9e\u4f8b\u5316\u4e3a tmpfs \u5377\uff08\u57fa\u4e8e RAM \u7684\u6587\u4ef6\u7cfb\u7edf\uff09\uff0c\u5f53 pod \u88ab\u5220\u9664\u65f6\uff0c\u8fd9\u4e9b\u5377\u4f1a\u81ea\u52a8\u4ece\u8282\u70b9\u4e2d\u5220\u9664\u3002</p>"},{"location":"zh/security/docs/data/#_8","title":"\u4f7f\u7528\u5916\u90e8\u5bc6\u94a5\u63d0\u4f9b\u7a0b\u5e8f","text":"<p>\u6709\u51e0\u79cd\u53ef\u884c\u7684\u66ff\u4ee3\u65b9\u6848\u53ef\u4ee5\u4ee3\u66ff\u4f7f\u7528 Kubernetes \u5bc6\u94a5\uff0c\u5305\u62ec AWS Secrets Manager \u548c Hashicorp \u7684 Vault\u3002\u8fd9\u4e9b\u670d\u52a1\u63d0\u4f9b\u4e86 Kubernetes \u5bc6\u94a5\u6240\u6ca1\u6709\u7684\u529f\u80fd\uff0c\u5982\u7ec6\u7c92\u5ea6\u8bbf\u95ee\u63a7\u5236\u3001\u5f3a\u52a0\u5bc6\u548c\u81ea\u52a8\u8f6e\u6362\u5bc6\u94a5\u3002Bitnami \u7684 Sealed Secrets \u662f\u53e6\u4e00\u79cd\u65b9\u6cd5\uff0c\u5b83\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u6765\u521b\u5efa\"\u5bc6\u5c01\u7684\u5bc6\u94a5\"\u3002\u516c\u94a5\u7528\u4e8e\u52a0\u5bc6\u5bc6\u94a5\uff0c\u800c\u7528\u4e8e\u89e3\u5bc6\u5bc6\u94a5\u7684\u79c1\u94a5\u5219\u4fdd\u5b58\u5728\u96c6\u7fa4\u5185\u90e8\uff0c\u5141\u8bb8\u60a8\u5b89\u5168\u5730\u5c06\u5bc6\u5c01\u7684\u5bc6\u94a5\u5b58\u50a8\u5728 Git \u7b49\u6e90\u4ee3\u7801\u63a7\u5236\u7cfb\u7edf\u4e2d\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4f7f\u7528 Sealed Secrets \u5728 Kubernetes \u4e2d\u7ba1\u7406\u5bc6\u94a5\u90e8\u7f72\u3002</p> <p>\u968f\u7740\u5bf9\u5916\u90e8\u5bc6\u94a5\u5b58\u50a8\u7684\u4f7f\u7528\u4e0d\u65ad\u589e\u52a0\uff0c\u5c06\u5b83\u4eec\u4e0e Kubernetes \u96c6\u6210\u7684\u9700\u6c42\u4e5f\u968f\u4e4b\u589e\u957f\u3002Secret Store CSI \u9a71\u52a8\u7a0b\u5e8f\u662f\u4e00\u4e2a\u793e\u533a\u9879\u76ee\uff0c\u5b83\u4f7f\u7528 CSI \u9a71\u52a8\u7a0b\u5e8f\u6a21\u578b\u4ece\u5916\u90e8\u5bc6\u94a5\u5b58\u50a8\u4e2d\u83b7\u53d6\u5bc6\u94a5\u3002\u76ee\u524d\uff0c\u8be5\u9a71\u52a8\u7a0b\u5e8f\u652f\u6301 AWS Secrets Manager\u3001Azure\u3001Vault \u548c GCP\u3002AWS \u63d0\u4f9b\u7a0b\u5e8f\u540c\u65f6\u652f\u6301 AWS Secrets Manager \u548c AWS Parameter Store\u3002\u5b83\u8fd8\u53ef\u4ee5\u914d\u7f6e\u4e3a\u5728\u5bc6\u94a5\u8fc7\u671f\u65f6\u8f6e\u6362\u5bc6\u94a5\uff0c\u5e76\u53ef\u4ee5\u5c06 AWS Secrets Manager \u5bc6\u94a5\u540c\u6b65\u5230 Kubernetes \u5bc6\u94a5\u3002\u5f53\u60a8\u9700\u8981\u5c06\u5bc6\u94a5\u4f5c\u4e3a\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u5f15\u7528\u800c\u4e0d\u662f\u4ece\u5377\u4e2d\u8bfb\u53d6\u65f6\uff0c\u5bc6\u94a5\u540c\u6b65\u53ef\u80fd\u5f88\u6709\u7528\u3002</p> <p>Note</p> <p>\u5f53\u5bc6\u94a5\u5b58\u50a8 CSI \u9a71\u52a8\u7a0b\u5e8f\u9700\u8981\u83b7\u53d6\u5bc6\u94a5\u65f6\uff0c\u5b83\u4f1a\u5047\u5b9a\u5f15\u7528\u5bc6\u94a5\u7684 pod \u5206\u914d\u7684 IRSA \u89d2\u8272\u3002\u6b64\u64cd\u4f5c\u7684\u4ee3\u7801\u53ef\u5728 \u6b64\u5904 \u627e\u5230\u3002</p> <p>\u6709\u5173 AWS Secrets &amp; Configuration Provider (ASCP) \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b\u8d44\u6e90\uff1a</p> <ul> <li>\u5982\u4f55\u5c06 AWS Secrets Configuration Provider \u4e0e Kubernetes Secret Store CSI \u9a71\u52a8\u7a0b\u5e8f\u4e00\u8d77\u4f7f\u7528</li> <li>\u5c06 Secrets Manager \u5bc6\u94a5\u4e0e Kubernetes Secrets Store CSI \u9a71\u52a8\u7a0b\u5e8f\u96c6\u6210</li> </ul> <p>external-secrets \u662f\u53e6\u4e00\u79cd\u5728 Kubernetes \u4e2d\u4f7f\u7528\u5916\u90e8\u5bc6\u94a5\u5b58\u50a8\u7684\u65b9\u5f0f\u3002\u4e0e CSI \u9a71\u52a8\u7a0b\u5e8f\u4e00\u6837\uff0cexternal-secrets \u4e5f\u53ef\u4ee5\u4e0e\u5404\u79cd\u4e0d\u540c\u7684\u540e\u7aef\u4e00\u8d77\u4f7f\u7528\uff0c\u5305\u62ec AWS Secrets Manager\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0cexternal-secrets \u4e0d\u662f\u4ece\u5916\u90e8\u5bc6\u94a5\u5b58\u50a8\u4e2d\u68c0\u7d22\u5bc6\u94a5\uff0c\u800c\u662f\u5c06\u5bc6\u94a5\u4ece\u8fd9\u4e9b\u540e\u7aef\u590d\u5236\u5230 Kubernetes \u4f5c\u4e3a\u5bc6\u94a5\u3002\u8fd9\u8ba9\u60a8\u53ef\u4ee5\u4f7f\u7528\u9996\u9009\u7684\u5bc6\u94a5\u5b58\u50a8\u6765\u7ba1\u7406\u5bc6\u94a5\uff0c\u5e76\u4ee5 Kubernetes \u539f\u751f\u7684\u65b9\u5f0f\u4e0e\u5bc6\u94a5\u4ea4\u4e92\u3002</p>"},{"location":"zh/security/docs/data/#_9","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a - \u6570\u636e\u52a0\u5bc6\u548c\u5bc6\u94a5\u7ba1\u7406</li> </ul>"},{"location":"zh/security/docs/detective/","title":"\u5ba1\u8ba1\u548c\u65e5\u5fd7\u8bb0\u5f55","text":"<p>\u6536\u96c6\u548c\u5206\u6790[\u5ba1\u8ba1]\u65e5\u5fd7\u5bf9\u4e8e\u5404\u79cd\u4e0d\u540c\u7684\u539f\u56e0\u90fd\u662f\u6709\u7528\u7684\u3002\u65e5\u5fd7\u53ef\u4ee5\u5e2e\u52a9\u8fdb\u884c\u6839\u672c\u539f\u56e0\u5206\u6790\u548c\u5f52\u56e0\uff0c\u5373\u5c06\u67d0\u4e2a\u53d8\u66f4\u5f52\u56e0\u4e8e\u7279\u5b9a\u7528\u6237\u3002\u5f53\u6536\u96c6\u4e86\u8db3\u591f\u591a\u7684\u65e5\u5fd7\u540e\uff0c\u5b83\u4eec\u4e5f\u53ef\u4ee5\u7528\u4e8e\u68c0\u6d4b\u5f02\u5e38\u884c\u4e3a\u3002\u5728 EKS \u4e0a\uff0c\u5ba1\u8ba1\u65e5\u5fd7\u88ab\u53d1\u9001\u5230 Amazon Cloudwatch Logs\u3002EKS \u7684\u5ba1\u8ba1\u7b56\u7565\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: audit.k8s.io/v1beta1\nkind: Policy\nrules:\n  # \u8bb0\u5f55 aws-auth configmap \u7684\u66f4\u6539\n  - level: RequestResponse\n    namespaces: [\"kube-system\"]\n    verbs: [\"update\", \"patch\", \"delete\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"configmaps\"]\n        resourceNames: [\"aws-auth\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: None\n    users: [\"system:kube-proxy\"]\n    verbs: [\"watch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"endpoints\", \"services\", \"services/status\"]\n  - level: None\n    users: [\"kubelet\"] # legacy kubelet identity\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes\", \"nodes/status\"]\n  - level: None\n    userGroups: [\"system:nodes\"]\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes\", \"nodes/status\"]\n  - level: None\n    users:\n      - system:kube-controller-manager\n      - system:kube-scheduler\n      - system:serviceaccount:kube-system:endpoint-controller\n    verbs: [\"get\", \"update\"]\n    namespaces: [\"kube-system\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"endpoints\"]\n  - level: None\n    users: [\"system:apiserver\"]\n    verbs: [\"get\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"namespaces\", \"namespaces/status\", \"namespaces/finalize\"]\n  - level: None\n    users:\n      - system:kube-controller-manager\n    verbs: [\"get\", \"list\"]\n    resources:\n      - group: \"metrics.k8s.io\"\n  - level: None\n    nonResourceURLs:\n      - /healthz*\n      - /version\n      - /swagger*\n  - level: None\n    resources:\n      - group: \"\" # core\n        resources: [\"events\"]\n  - level: Request\n    users: [\"kubelet\", \"system:node-problem-detector\", \"system:serviceaccount:kube-system:node-problem-detector\"]\n    verbs: [\"update\",\"patch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes/status\", \"pods/status\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    userGroups: [\"system:nodes\"]\n    verbs: [\"update\",\"patch\"]\n    resources:\n      - group: \"\" # core\n        resources: [\"nodes/status\", \"pods/status\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    users: [\"system:serviceaccount:kube-system:namespace-controller\"]\n    verbs: [\"deletecollection\"]\n    omitStages:\n      - \"RequestReceived\"\n  # Secrets\u3001ConfigMaps \u548c TokenReviews \u53ef\u80fd\u5305\u542b\u654f\u611f\u548c\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\n  # \u56e0\u6b64\u53ea\u5728\u5143\u6570\u636e\u7ea7\u522b\u8bb0\u5f55\u3002\n  - level: Metadata\n    resources:\n      - group: \"\" # core\n        resources: [\"secrets\", \"configmaps\"]\n      - group: authentication.k8s.io\n        resources: [\"tokenreviews\"]\n    omitStages:\n      - \"RequestReceived\"\n  - level: Request\n    resources:\n      - group: \"\"\n        resources: [\"serviceaccounts/token\"]\n  - level: Request\n    verbs: [\"get\", \"list\", \"watch\"]\n    resources: \n      - group: \"\" # core\n      - group: \"admissionregistration.k8s.io\"\n      - group: \"apiextensions.k8s.io\"\n      - group: \"apiregistration.k8s.io\"\n      - group: \"apps\"\n      - group: \"authentication.k8s.io\"\n      - group: \"authorization.k8s.io\"\n      - group: \"autoscaling\"\n      - group: \"batch\"\n      - group: \"certificates.k8s.io\"\n      - group: \"extensions\"\n      - group: \"metrics.k8s.io\"\n      - group: \"networking.k8s.io\"\n      - group: \"policy\"\n      - group: \"rbac.authorization.k8s.io\"\n      - group: \"scheduling.k8s.io\"\n      - group: \"settings.k8s.io\"\n      - group: \"storage.k8s.io\"\n    omitStages:\n      - \"RequestReceived\"\n  # \u5df2\u77e5 API \u7684\u9ed8\u8ba4\u7ea7\u522b\n  - level: RequestResponse\n    resources: \n      - group: \"\" # core\n      - group: \"admissionregistration.k8s.io\"\n      - group: \"apiextensions.k8s.io\"\n      - group: \"apiregistration.k8s.io\"\n      - group: \"apps\"\n      - group: \"authentication.k8s.io\"\n      - group: \"authorization.k8s.io\"\n      - group: \"autoscaling\"\n      - group: \"batch\"\n      - group: \"certificates.k8s.io\"\n      - group: \"extensions\"\n      - group: \"metrics.k8s.io\"\n      - group: \"networking.k8s.io\"\n      - group: \"policy\"\n      - group: \"rbac.authorization.k8s.io\"\n      - group: \"scheduling.k8s.io\"\n      - group: \"settings.k8s.io\"\n      - group: \"storage.k8s.io\"\n    omitStages:\n      - \"RequestReceived\"\n  # \u6240\u6709\u5176\u4ed6\u8bf7\u6c42\u7684\u9ed8\u8ba4\u7ea7\u522b\u3002\n  - level: Metadata\n    omitStages:\n      - \"RequestReceived\"\n</code></pre>"},{"location":"zh/security/docs/detective/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/security/docs/detective/#_3","title":"\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7","text":"<p>\u5ba1\u8ba1\u65e5\u5fd7\u662f EKS \u7ba1\u7406\u7684 Kubernetes \u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u7684\u4e00\u90e8\u5206\uff0c\u7531 EKS \u7ba1\u7406\u3002\u542f\u7528/\u7981\u7528\u63a7\u5236\u5e73\u9762\u65e5\u5fd7(\u5305\u62ec Kubernetes API \u670d\u52a1\u5668\u3001\u63a7\u5236\u5668\u7ba1\u7406\u5668\u548c\u8c03\u5ea6\u5668\u7684\u65e5\u5fd7\u4ee5\u53ca\u5ba1\u8ba1\u65e5\u5fd7)\u7684\u8bf4\u660e\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\uff0chttps://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html#enabling-control-plane-log-export\u3002</p> <p>Info</p> <p>\u542f\u7528\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u8bb0\u5f55\u65f6\uff0c\u60a8\u5c06\u4e3a\u5728 CloudWatch \u4e2d\u5b58\u50a8\u65e5\u5fd7\u800c\u4ea7\u751f\u6210\u672c\u3002\u8fd9\u5f15\u51fa\u4e86\u4e00\u4e2a\u66f4\u5e7f\u6cdb\u7684\u95ee\u9898\uff0c\u5373\u5b89\u5168\u6027\u7684\u6301\u7eed\u6210\u672c\u3002\u6700\u7ec8\uff0c\u60a8\u5fc5\u987b\u6743\u8861\u8fd9\u4e9b\u6210\u672c\u4e0e\u5b89\u5168\u6f0f\u6d1e\u7684\u6210\u672c\uff0c\u4f8b\u5982\u8d22\u52a1\u635f\u5931\u3001\u58f0\u8a89\u635f\u5bb3\u7b49\u3002\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\uff0c\u901a\u8fc7\u5b9e\u65bd\u672c\u6307\u5357\u4e2d\u7684\u90e8\u5206\u5efa\u8bae\uff0c\u60a8\u5c31\u53ef\u4ee5\u5145\u5206\u4fdd\u62a4\u60a8\u7684\u73af\u5883\u3002</p> <p>Warning</p> <p>CloudWatch Logs \u6761\u76ee\u7684\u6700\u5927\u5927\u5c0f\u4e3a 256KB,\u800c Kubernetes API \u8bf7\u6c42\u7684\u6700\u5927\u5927\u5c0f\u4e3a 1.5MiB\u3002\u5927\u4e8e 256KB \u7684\u65e5\u5fd7\u6761\u76ee\u5c06\u88ab\u622a\u65ad\u6216\u4ec5\u5305\u542b\u8bf7\u6c42\u5143\u6570\u636e\u3002</p>"},{"location":"zh/security/docs/detective/#_4","title":"\u5229\u7528\u5ba1\u8ba1\u5143\u6570\u636e","text":"<p>Kubernetes \u5ba1\u8ba1\u65e5\u5fd7\u5305\u62ec\u4e24\u4e2a\u6ce8\u91ca\uff0c\u7528\u4e8e\u6307\u793a\u8bf7\u6c42\u662f\u5426\u88ab\u6388\u6743 <code>authorization.k8s.io/decision</code> \u4ee5\u53ca\u51b3\u7b56\u7684\u539f\u56e0 <code>authorization.k8s.io/reason</code>\u3002\u4f7f\u7528\u8fd9\u4e9b\u5c5e\u6027\u6765\u786e\u5b9a\u4e3a\u4ec0\u4e48\u5141\u8bb8\u7279\u5b9a\u7684 API \u8c03\u7528\u3002</p>"},{"location":"zh/security/docs/detective/#_5","title":"\u4e3a\u53ef\u7591\u4e8b\u4ef6\u521b\u5efa\u8b66\u62a5","text":"<p>\u521b\u5efa\u4e00\u4e2a\u8b66\u62a5\uff0c\u5728 403 Forbidden \u548c 401 Unauthorized \u54cd\u5e94\u589e\u52a0\u65f6\u81ea\u52a8\u63d0\u9192\u60a8\uff0c\u7136\u540e\u4f7f\u7528\u8bf8\u5982 <code>host</code>\u3001<code>sourceIPs</code> \u548c <code>k8s_user.username</code> \u7b49\u5c5e\u6027\u6765\u627e\u51fa\u8fd9\u4e9b\u8bf7\u6c42\u6765\u81ea\u4f55\u5904\u3002</p>"},{"location":"zh/security/docs/detective/#log-insights","title":"\u4f7f\u7528 Log Insights \u5206\u6790\u65e5\u5fd7","text":"<p>\u4f7f\u7528 CloudWatch Log Insights \u76d1\u63a7\u5bf9 RBAC \u5bf9\u8c61\u7684\u66f4\u6539\uff0c\u4f8b\u5982 Roles\u3001RoleBindings\u3001ClusterRoles \u548c ClusterRoleBindings\u3002\u4e0b\u9762\u662f\u4e00\u4e9b\u793a\u4f8b\u67e5\u8be2\uff1a</p> <p>\u5217\u51fa\u5bf9 <code>aws-auth</code> ConfigMap \u7684\u66f4\u65b0\uff1a</p> <pre><code>fields @timestamp, @message\n| filter @logStream like \"kube-apiserver-audit\"\n| filter verb in [\"update\", \"patch\"]\n| filter objectRef.resource = \"configmaps\" and objectRef.name = \"aws-auth\" and objectRef.namespace = \"kube-system\"\n| sort @timestamp desc\n</code></pre> <p>\u5217\u51fa\u65b0\u521b\u5efa\u7684\u6216\u5bf9\u9a8c\u8bc1 Webhook \u7684\u66f4\u6539\uff1a</p> <pre><code>fields @timestamp, @message\n| filter @logStream like \"kube-apiserver-audit\"\n| filter verb in [\"create\", \"update\", \"patch\"] and responseStatus.code = 201\n| filter objectRef.resource = \"validatingwebhookconfigurations\"\n| sort @timestamp desc\n</code></pre> <p>\u5217\u51fa\u5bf9 Roles \u7684\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\uff1a</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"roles\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\u5217\u51fa\u5bf9 RoleBindings \u7684\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\uff1a</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"rolebindings\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\u5217\u51fa\u5bf9 ClusterRoles \u7684\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\uff1a</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"clusterroles\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\u5217\u51fa\u5bf9 ClusterRoleBindings \u7684\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\uff1a</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"clusterrolebindings\" and verb in [\"create\", \"update\", \"patch\", \"delete\"]\n</code></pre> <p>\u7ed8\u5236\u5bf9 Secrets \u7684\u672a\u6388\u6743\u8bfb\u53d6\u64cd\u4f5c\uff1a</p> <pre><code>fields @timestamp, @message\n| sort @timestamp desc\n| limit 100\n| filter objectRef.resource=\"secrets\" and verb in [\"get\", \"watch\", \"list\"] and responseStatus.code=\"401\"\n| stats count() by bin(1m)\n</code></pre> <p>\u5217\u51fa\u5931\u8d25\u7684\u533f\u540d\u8bf7\u6c42\uff1a</p> <pre><code>fields @timestamp, @message, sourceIPs.0\n| sort @timestamp desc\n| limit 100\n| filter user.username=\"system:anonymous\" and responseStatus.code in [\"401\", \"403\"]\n</code></pre>"},{"location":"zh/security/docs/detective/#cloudtrail","title":"\u5ba1\u8ba1\u60a8\u7684 CloudTrail \u65e5\u5fd7","text":"<p>\u7531\u5229\u7528 IAM Roles for Service Accounts (IRSA) \u7684 pod \u8c03\u7528\u7684 AWS API \u4f1a\u81ea\u52a8\u8bb0\u5f55\u5230 CloudTrail\uff0c\u5e76\u9644\u5e26\u670d\u52a1\u8d26\u6237\u7684\u540d\u79f0\u3002\u5982\u679c\u65e5\u5fd7\u4e2d\u51fa\u73b0\u672a\u660e\u786e\u6388\u6743\u8c03\u7528 API \u7684\u670d\u52a1\u8d26\u6237\u540d\u79f0\uff0c\u5219\u53ef\u80fd\u8868\u793a IAM \u89d2\u8272\u7684\u4fe1\u4efb\u7b56\u7565\u914d\u7f6e\u9519\u8bef\u3002\u603b\u7684\u6765\u8bf4\uff0cCloudtrail \u662f\u5c06 AWS API \u8c03\u7528\u5f52\u56e0\u4e8e\u7279\u5b9a IAM \u4e3b\u4f53\u7684\u4e00\u79cd\u5f88\u597d\u7684\u65b9\u5f0f\u3002</p>"},{"location":"zh/security/docs/detective/#cloudtrail-insights","title":"\u4f7f\u7528 CloudTrail Insights \u53d1\u73b0\u53ef\u7591\u6d3b\u52a8","text":"<p>CloudTrail Insights \u4f1a\u81ea\u52a8\u5206\u6790\u6765\u81ea CloudTrail \u8ddf\u8e2a\u7684\u5199\u5165\u7ba1\u7406\u4e8b\u4ef6\uff0c\u5e76\u5728\u53d1\u73b0\u5f02\u5e38\u6d3b\u52a8\u65f6\u5411\u60a8\u53d1\u51fa\u8b66\u62a5\u3002\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u60a8\u8bc6\u522b\u60a8\u7684 AWS \u8d26\u6237\u4e2d\u5199\u5165 API \u7684\u8c03\u7528\u91cf\u589e\u52a0\u7684\u60c5\u51b5\uff0c\u5305\u62ec\u4f7f\u7528 IRSA \u6765\u627f\u62c5 IAM \u89d2\u8272\u7684 pod\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u5ba3\u5e03\u63a8\u51fa CloudTrail Insights\uff1a\u8bc6\u522b\u548c\u54cd\u5e94\u5f02\u5e38 API \u6d3b\u52a8\u3002</p>"},{"location":"zh/security/docs/detective/#_6","title":"\u5176\u4ed6\u8d44\u6e90","text":"<p>\u968f\u7740\u65e5\u5fd7\u91cf\u7684\u589e\u52a0\uff0c\u4f7f\u7528 Log Insights \u6216\u5176\u4ed6\u65e5\u5fd7\u5206\u6790\u5de5\u5177\u8fdb\u884c\u89e3\u6790\u548c\u8fc7\u6ee4\u53ef\u80fd\u4f1a\u53d8\u5f97\u65e0\u6548\u3002\u4f5c\u4e3a\u66ff\u4ee3\u65b9\u6848\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u8003\u8651\u8fd0\u884c Sysdig Falco \u548c ekscloudwatch\u3002Falco \u5206\u6790\u5ba1\u8ba1\u65e5\u5fd7\u5e76\u6807\u8bb0\u957f\u671f\u7684\u5f02\u5e38\u6216\u6ee5\u7528\u884c\u4e3a\u3002ekscloudwatch \u9879\u76ee\u5c06 CloudWatch \u4e2d\u7684\u5ba1\u8ba1\u65e5\u5fd7\u4e8b\u4ef6\u8f6c\u53d1\u7ed9 Falco \u8fdb\u884c\u5206\u6790\u3002Falco \u63d0\u4f9b\u4e86\u4e00\u7ec4\u9ed8\u8ba4\u5ba1\u8ba1\u89c4\u5219\u4ee5\u53ca\u6dfb\u52a0\u60a8\u81ea\u5df1\u89c4\u5219\u7684\u80fd\u529b\u3002</p> <p>\u53e6\u4e00\u4e2a\u9009\u62e9\u53ef\u80fd\u662f\u5c06\u5ba1\u8ba1\u65e5\u5fd7\u5b58\u50a8\u5728 S3 \u4e2d\uff0c\u5e76\u4f7f\u7528 SageMaker Random Cut Forest \u7b97\u6cd5\u6765\u68c0\u6d4b\u9700\u8981\u8fdb\u4e00\u6b65\u8c03\u67e5\u7684\u5f02\u5e38\u884c\u4e3a\u3002</p>"},{"location":"zh/security/docs/detective/#_7","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<p>\u4ee5\u4e0b\u5546\u4e1a\u548c\u5f00\u6e90\u9879\u76ee\u53ef\u7528\u4e8e\u8bc4\u4f30\u60a8\u7684\u96c6\u7fa4\u4e0e\u65e2\u5b9a\u6700\u4f73\u5b9e\u8df5\u7684\u4e00\u81f4\u6027\uff1a</p> <ul> <li>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a - \u68c0\u6d4b\u63a7\u5236</li> <li>kubeaudit</li> <li>kube-scan \u6839\u636e Kubernetes \u901a\u7528\u914d\u7f6e\u8bc4\u5206\u7cfb\u7edf\u6846\u67b6\u4e3a\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5206\u914d\u98ce\u9669\u8bc4\u5206</li> <li>kubesec.io</li> <li>polaris</li> <li>Starboard</li> <li>Snyk</li> <li>Kubescape Kubescape \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 kubernetes \u5b89\u5168\u5de5\u5177\uff0c\u53ef\u626b\u63cf\u96c6\u7fa4\u3001YAML \u6587\u4ef6\u548c Helm \u56fe\u8868\u3002\u5b83\u6839\u636e\u591a\u4e2a\u6846\u67b6(\u5305\u62ec NSA-CISA \u548c MITRE ATT&amp;CK\u00ae)\u68c0\u6d4b\u9519\u8bef\u914d\u7f6e\u3002</li> </ul>"},{"location":"zh/security/docs/hosts/","title":"\u4fdd\u62a4\u57fa\u7840\u8bbe\u65bd\uff08\u4e3b\u673a\uff09","text":"<p>\u4fdd\u62a4\u5bb9\u5668\u955c\u50cf\u5f88\u91cd\u8981\uff0c\u540c\u6837\u91cd\u8981\u7684\u662f\u8981\u4fdd\u62a4\u8fd0\u884c\u5b83\u4eec\u7684\u57fa\u7840\u8bbe\u65bd\u3002\u672c\u8282\u63a2\u8ba8\u4e86\u7f13\u89e3\u9488\u5bf9\u4e3b\u673a\u53d1\u8d77\u7684\u653b\u51fb\u98ce\u9669\u7684\u4e0d\u540c\u65b9\u5f0f\u3002\u8fd9\u4e9b\u6307\u5bfc\u65b9\u9488\u5e94\u4e0e \u8fd0\u884c\u65f6\u5b89\u5168 \u4e00\u8282\u4e2d\u6982\u8ff0\u7684\u6307\u5bfc\u65b9\u9488\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"zh/security/docs/hosts/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/security/docs/hosts/#_3","title":"\u4f7f\u7528\u9488\u5bf9\u8fd0\u884c\u5bb9\u5668\u8fdb\u884c\u4e86\u4f18\u5316\u7684\u64cd\u4f5c\u7cfb\u7edf","text":"<p>\u8003\u8651\u4f7f\u7528 Flatcar Linux\u3001Project Atomic\u3001RancherOS \u548c Bottlerocket\uff0c\u8fd9\u662f AWS \u4e13\u95e8\u4e3a\u8fd0\u884c Linux \u5bb9\u5668\u800c\u8bbe\u8ba1\u7684\u7279\u6b8a\u64cd\u4f5c\u7cfb\u7edf\u3002\u5b83\u5305\u62ec\u51cf\u5c0f\u7684\u653b\u51fb\u9762\u3001\u5728\u542f\u52a8\u65f6\u9a8c\u8bc1\u7684\u78c1\u76d8\u6620\u50cf\u4ee5\u53ca\u4f7f\u7528 SELinux \u5b9e\u65bd\u7684\u6743\u9650\u8fb9\u754c\u3002</p> <p>\u6216\u8005\uff0c\u4e3a\u60a8\u7684 Kubernetes \u5de5\u4f5c\u8282\u70b9\u4f7f\u7528 EKS \u4f18\u5316\u7684 AMI\u3002EKS \u4f18\u5316\u7684 AMI \u4f1a\u5b9a\u671f\u53d1\u5e03\uff0c\u5e76\u5305\u542b\u8fd0\u884c\u5bb9\u5668\u5316\u5de5\u4f5c\u8d1f\u8f7d\u6240\u9700\u7684\u6700\u5c0f\u64cd\u4f5c\u7cfb\u7edf\u5305\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u96c6\u3002</p> <p>\u8bf7\u53c2\u9605 Amazon EKS AMI RHEL \u6784\u5efa\u89c4\u8303\uff0c\u4e86\u89e3\u4e00\u4e2a\u793a\u4f8b\u914d\u7f6e\u811a\u672c\uff0c\u8be5\u811a\u672c\u53ef\u7528\u4e8e\u4f7f\u7528 Hashicorp Packer \u5728 Red Hat Enterprise Linux \u4e0a\u6784\u5efa\u81ea\u5b9a\u4e49 Amazon EKS AMI\u3002\u6b64\u811a\u672c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7528\u4e8e\u6784\u5efa\u7b26\u5408 STIG \u7684 EKS \u81ea\u5b9a\u4e49 AMI\u3002</p>"},{"location":"zh/security/docs/hosts/#_4","title":"\u4fdd\u6301\u5de5\u4f5c\u8282\u70b9\u64cd\u4f5c\u7cfb\u7edf\u7684\u66f4\u65b0","text":"<p>\u65e0\u8bba\u60a8\u4f7f\u7528\u5bb9\u5668\u4f18\u5316\u7684\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\uff08\u5982 Bottlerocket\uff09\u8fd8\u662f\u66f4\u5927\u4f46\u4ecd\u7136\u7b80\u7ea6\u7684 Amazon \u673a\u5668\u6620\u50cf\uff08\u5982 EKS \u4f18\u5316\u7684 AMI\uff09\uff0c\u6700\u4f73\u505a\u6cd5\u662f\u4f7f\u8fd9\u4e9b\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u6620\u50cf\u4fdd\u6301\u6700\u65b0\u7684\u5b89\u5168\u8865\u4e01\u3002</p> <p>\u5bf9\u4e8e EKS \u4f18\u5316\u7684 AMI\uff0c\u8bf7\u5b9a\u671f\u67e5\u770b CHANGELOG \u548c/\u6216 \u53d1\u5e03\u8bf4\u660e\u9891\u9053\uff0c\u5e76\u81ea\u52a8\u5316\u5c06\u66f4\u65b0\u7684\u5de5\u4f5c\u8282\u70b9\u6620\u50cf\u90e8\u7f72\u5230\u60a8\u7684\u96c6\u7fa4\u4e2d\u3002</p>"},{"location":"zh/security/docs/hosts/#_5","title":"\u5c06\u60a8\u7684\u57fa\u7840\u8bbe\u65bd\u89c6\u4e3a\u4e0d\u53ef\u53d8\u7684\uff0c\u5e76\u81ea\u52a8\u5316\u5de5\u4f5c\u8282\u70b9\u7684\u66ff\u6362","text":"<p>\u5f53\u65b0\u7684\u8865\u4e01\u6216\u66f4\u65b0\u53ef\u7528\u65f6\uff0c\u8bf7\u66ff\u6362\u60a8\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u800c\u4e0d\u662f\u6267\u884c\u5c31\u5730\u5347\u7ea7\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u4e4b\u4e00\u6765\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6700\u65b0\u7684 AMI \u5c06\u5b9e\u4f8b\u6dfb\u52a0\u5230\u73b0\u6709\u7684\u81ea\u52a8\u4f38\u7f29\u7ec4\u4e2d\uff0c\u540c\u65f6\u4f9d\u6b21\u9694\u79bb\u548c\u6392\u7a7a\u8282\u70b9\uff0c\u76f4\u5230\u8be5\u7ec4\u4e2d\u7684\u6240\u6709\u8282\u70b9\u90fd\u5df2\u4f7f\u7528\u6700\u65b0\u7684 AMI \u8fdb\u884c\u4e86\u66ff\u6362\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u5c06\u5b9e\u4f8b\u6dfb\u52a0\u5230\u65b0\u7684\u8282\u70b9\u7ec4\u4e2d\uff0c\u540c\u65f6\u4f9d\u6b21\u9694\u79bb\u548c\u6392\u7a7a\u65e7\u8282\u70b9\u7ec4\u4e2d\u7684\u8282\u70b9\uff0c\u76f4\u5230\u6240\u6709\u8282\u70b9\u90fd\u5df2\u66ff\u6362\u3002EKS \u6258\u7ba1\u8282\u70b9\u7ec4\u4f7f\u7528\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff0c\u5e76\u4e14\u5728\u65b0\u7684 AMI \u53ef\u7528\u65f6\u4f1a\u5728\u63a7\u5236\u53f0\u4e2d\u663e\u793a\u4e00\u6761\u6d88\u606f\u4ee5\u5347\u7ea7\u60a8\u7684\u5de5\u4f5c\u8282\u70b9\u3002<code>eksctl</code> \u4e5f\u6709\u4e00\u79cd\u673a\u5236\uff0c\u53ef\u4ee5\u4f7f\u7528\u6700\u65b0\u7684 AMI \u521b\u5efa\u8282\u70b9\u7ec4\uff0c\u5e76\u5728\u7ec8\u6b62\u5b9e\u4f8b\u4e4b\u524d\u4f18\u96c5\u5730\u9694\u79bb\u548c\u6392\u7a7a\u8282\u70b9\u7ec4\u4e2d\u7684 Pod\u3002\u5982\u679c\u60a8\u51b3\u5b9a\u4f7f\u7528\u5176\u4ed6\u65b9\u6cd5\u6765\u66ff\u6362\u5de5\u4f5c\u8282\u70b9\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u81ea\u52a8\u5316\u8be5\u8fc7\u7a0b\uff0c\u4ee5\u6700\u5c0f\u5316\u4eba\u5de5\u76d1\u7763\uff0c\u56e0\u4e3a\u60a8\u53ef\u80fd\u9700\u8981\u5b9a\u671f\u66ff\u6362\u5de5\u4f5c\u8282\u70b9\uff0c\u56e0\u4e3a\u4f1a\u53d1\u5e03\u65b0\u7684\u66f4\u65b0/\u8865\u4e01\uff0c\u5e76\u4e14\u5728\u5347\u7ea7\u63a7\u5236\u5e73\u9762\u65f6\u4e5f\u9700\u8981\u8fd9\u6837\u505a\u3002</p> <p>\u5bf9\u4e8e EKS Fargate\uff0cAWS \u5c06\u5728\u66f4\u65b0\u53ef\u7528\u65f6\u81ea\u52a8\u66f4\u65b0\u5e95\u5c42\u57fa\u7840\u8bbe\u65bd\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u8fd9\u53ef\u4ee5\u65e0\u7f1d\u5b8c\u6210\uff0c\u4f46\u6709\u65f6\u66f4\u65b0\u4f1a\u5bfc\u81f4\u60a8\u7684 Pod \u88ab\u91cd\u65b0\u8c03\u5ea6\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u5728\u4ee5 Fargate Pod \u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u65f6\u521b\u5efa\u5177\u6709\u591a\u4e2a\u526f\u672c\u7684\u90e8\u7f72\u3002</p>"},{"location":"zh/security/docs/hosts/#kube-bench-kubernetes-cis","title":"\u5b9a\u671f\u8fd0\u884c kube-bench \u4ee5\u9a8c\u8bc1\u662f\u5426\u7b26\u5408 Kubernetes \u7684 CIS \u57fa\u51c6","text":"<p>kube-bench \u662f Aqua \u7684\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u7528\u4e8e\u6839\u636e Kubernetes \u7684 CIS \u57fa\u51c6\u8bc4\u4f30\u60a8\u7684\u96c6\u7fa4\u3002\u8be5\u57fa\u51c6\u63cf\u8ff0\u4e86\u4fdd\u62a4\u975e\u6258\u7ba1 Kubernetes \u96c6\u7fa4\u7684\u6700\u4f73\u5b9e\u8df5\u3002CIS Kubernetes \u57fa\u51c6\u6db5\u76d6\u4e86\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762\u3002\u7531\u4e8e Amazon EKS \u63d0\u4f9b\u4e86\u5b8c\u5168\u6258\u7ba1\u7684\u63a7\u5236\u5e73\u9762\uff0c\u56e0\u6b64\u5e76\u975e CIS Kubernetes \u57fa\u51c6\u4e2d\u7684\u6240\u6709\u5efa\u8bae\u90fd\u9002\u7528\u3002\u4e3a\u4e86\u786e\u4fdd\u6b64\u8303\u56f4\u53cd\u6620\u4e86 Amazon EKS \u7684\u5b9e\u73b0\u65b9\u5f0f\uff0cAWS \u521b\u5efa\u4e86 CIS Amazon EKS \u57fa\u51c6\u3002EKS \u57fa\u51c6\u7ee7\u627f\u81ea CIS Kubernetes \u57fa\u51c6\uff0c\u5e76\u7ed3\u5408\u4e86\u6765\u81ea\u793e\u533a\u7684\u5176\u4ed6\u8f93\u5165\uff0c\u7279\u522b\u8003\u8651\u4e86 EKS \u96c6\u7fa4\u7684\u914d\u7f6e\u3002</p> <p>\u5728 EKS \u96c6\u7fa4\u4e0a\u8fd0\u884c kube-bench \u65f6\uff0c\u8bf7\u6309\u7167 Aqua Security \u7684\u8fd9\u4e9b\u8bf4\u660e\u8fdb\u884c\u64cd\u4f5c\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4ecb\u7ecd CIS Amazon EKS \u57fa\u51c6\u3002</p>"},{"location":"zh/security/docs/hosts/#_6","title":"\u6700\u5c0f\u5316\u5bf9\u5de5\u4f5c\u8282\u70b9\u7684\u8bbf\u95ee","text":"<p>\u4e0e\u5176\u542f\u7528 SSH \u8bbf\u95ee\uff0c\u4e0d\u5982\u5728\u9700\u8981\u8fdc\u7a0b\u8bbf\u95ee\u4e3b\u673a\u65f6\u4f7f\u7528 SSM Session Manager\u3002\u4e0e\u53ef\u80fd\u4e22\u5931\u3001\u590d\u5236\u6216\u5171\u4eab\u7684 SSH \u5bc6\u94a5\u4e0d\u540c\uff0cSession Manager \u5141\u8bb8\u60a8\u4f7f\u7528 IAM \u63a7\u5236\u5bf9 EC2 \u5b9e\u4f8b\u7684\u8bbf\u95ee\u3002\u6b64\u5916\uff0c\u5b83\u8fd8\u63d0\u4f9b\u4e86\u5ba1\u8ba1\u8ddf\u8e2a\u548c\u5728\u5b9e\u4f8b\u4e0a\u8fd0\u884c\u7684\u547d\u4ee4\u7684\u65e5\u5fd7\u3002</p> <p>\u4ece 2020 \u5e74 8 \u6708 19 \u65e5\u8d77\uff0c\u6258\u7ba1\u8282\u70b9\u7ec4\u652f\u6301\u81ea\u5b9a\u4e49 AMI \u548c EC2 \u542f\u52a8\u6a21\u677f\u3002\u8fd9\u5141\u8bb8\u60a8\u5c06 SSM \u4ee3\u7406\u5d4c\u5165\u5230 AMI \u4e2d\u6216\u5728\u5f15\u5bfc\u5de5\u4f5c\u8282\u70b9\u65f6\u5b89\u88c5\u5b83\u3002\u5982\u679c\u60a8\u4e0d\u60f3\u4fee\u6539\u4f18\u5316\u7684 AMI \u6216 ASG \u7684\u542f\u52a8\u6a21\u677f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 DaemonSet \u5b89\u88c5 SSM \u4ee3\u7406\uff0c\u5982\u6b64\u793a\u4f8b\u6240\u793a\u3002</p>"},{"location":"zh/security/docs/hosts/#ssm-ssh-iam","title":"\u7528\u4e8e\u57fa\u4e8e SSM \u7684 SSH \u8bbf\u95ee\u7684\u6700\u5c0f IAM \u7b56\u7565","text":"<p><code>AmazonSSMManagedInstanceCore</code> AWS \u6258\u7ba1\u7b56\u7565\u5305\u542b\u8bb8\u591a\u4e0d\u9700\u8981 SSM Session Manager / SSM RunCommand \u7684\u6743\u9650\uff08\u5982\u679c\u60a8\u53ea\u662f\u60f3\u907f\u514d SSH \u8bbf\u95ee\uff09\u3002\u7279\u522b\u4ee4\u4eba\u5173\u6ce8\u7684\u662f\u5bf9 <code>ssm:GetParameter(s)</code> \u7684 <code>*</code> \u6743\u9650\uff0c\u8fd9\u5c06\u5141\u8bb8\u8be5\u89d2\u8272\u8bbf\u95ee\u53c2\u6570\u5b58\u50a8\u4e2d\u7684\u6240\u6709\u53c2\u6570\uff08\u5305\u62ec\u4f7f\u7528\u914d\u7f6e\u7684 AWS \u6258\u7ba1 KMS \u5bc6\u94a5\u7684 SecureStrings\uff09\u3002</p> <p>\u4ee5\u4e0b IAM \u7b56\u7565\u5305\u542b\u542f\u7528\u901a\u8fc7 SSM Systems Manager \u8bbf\u95ee\u8282\u70b9\u6240\u9700\u7684\u6700\u5c0f\u6743\u9650\u96c6\u3002</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"EnableAccessViaSSMSessionManager\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssmmessages:OpenDataChannel\",\n        \"ssmmessages:OpenControlChannel\",\n        \"ssmmessages:CreateDataChannel\",\n        \"ssmmessages:CreateControlChannel\",\n        \"ssm:UpdateInstanceInformation\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"EnableSSMRunCommand\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssm:UpdateInstanceInformation\",\n        \"ec2messages:SendReply\",\n        \"ec2messages:GetMessages\",\n        \"ec2messages:GetEndpoint\",\n        \"ec2messages:FailMessage\",\n        \"ec2messages:DeleteMessage\",\n        \"ec2messages:AcknowledgeMessage\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n</code></pre> <p>\u4f7f\u7528\u6b64\u7b56\u7565\u5e76\u5b89\u88c5 Session Manager \u63d2\u4ef6\u540e\uff0c\u60a8\u5c31\u53ef\u4ee5\u8fd0\u884c</p> <pre><code>aws ssm start-session --target [INSTANCE_ID_OF_EKS_NODE]\n</code></pre> <p>\u6765\u8bbf\u95ee\u8282\u70b9\u3002</p> <p>Note</p> <p>\u60a8\u4e5f\u53ef\u4ee5\u8003\u8651\u6dfb\u52a0\u6743\u9650\u4ee5\u542f\u7528 Session Manager \u65e5\u5fd7\u8bb0\u5f55\u3002</p>"},{"location":"zh/security/docs/hosts/#_7","title":"\u5c06\u5de5\u4f5c\u8282\u70b9\u90e8\u7f72\u5230\u79c1\u6709\u5b50\u7f51","text":"<p>\u901a\u8fc7\u5c06\u5de5\u4f5c\u8282\u70b9\u90e8\u7f72\u5230\u79c1\u6709\u5b50\u7f51\uff0c\u53ef\u4ee5\u6700\u5c0f\u5316\u5b83\u4eec\u66b4\u9732\u5728\u4e92\u8054\u7f51\u4e0a\u7684\u98ce\u9669\uff0c\u800c\u653b\u51fb\u901a\u5e38\u5c31\u662f\u4ece\u4e92\u8054\u7f51\u53d1\u8d77\u7684\u3002\u4ece 2020 \u5e74 4 \u6708 22 \u65e5\u5f00\u59cb\uff0c\u5728\u6258\u7ba1\u8282\u70b9\u7ec4\u4e2d\u5206\u914d\u7ed9\u8282\u70b9\u7684\u516c\u6709 IP \u5730\u5740\u5c06\u7531\u5b83\u4eec\u90e8\u7f72\u5230\u7684\u5b50\u7f51\u63a7\u5236\u3002\u5728\u6b64\u4e4b\u524d\uff0c\u6258\u7ba1\u8282\u70b9\u7ec4\u4e2d\u7684\u8282\u70b9\u4f1a\u81ea\u52a8\u5206\u914d\u516c\u6709 IP\u3002\u5982\u679c\u60a8\u9009\u62e9\u5c06\u5de5\u4f5c\u8282\u70b9\u90e8\u7f72\u5230\u516c\u6709\u5b50\u7f51\uff0c\u8bf7\u5b9e\u65bd\u9650\u5236\u6027\u7684 AWS \u5b89\u5168\u7ec4\u89c4\u5219\u6765\u9650\u5236\u5b83\u4eec\u7684\u66b4\u9732\u3002</p>"},{"location":"zh/security/docs/hosts/#amazon-inspector","title":"\u8fd0\u884c Amazon Inspector \u4ee5\u8bc4\u4f30\u4e3b\u673a\u7684\u66b4\u9732\u3001\u6f0f\u6d1e\u548c\u504f\u79bb\u6700\u4f73\u5b9e\u8df5\u7684\u60c5\u51b5","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528 Amazon Inspector \u6765\u68c0\u67e5\u662f\u5426\u5b58\u5728\u610f\u5916\u7684\u7f51\u7edc\u8bbf\u95ee\u5230\u60a8\u7684\u8282\u70b9\u4ee5\u53ca\u5e95\u5c42 Amazon EC2 \u5b9e\u4f8b\u4e0a\u7684\u6f0f\u6d1e\u3002</p> <p>\u53ea\u6709\u5728\u5b89\u88c5\u548c\u542f\u7528 Amazon EC2 Systems Manager (SSM) \u4ee3\u7406\u7684\u60c5\u51b5\u4e0b\uff0cAmazon Inspector \u624d\u80fd\u4e3a\u60a8\u7684 Amazon EC2 \u5b9e\u4f8b\u63d0\u4f9b\u5e38\u89c1\u6f0f\u6d1e\u548c\u66b4\u9732 (CVE) \u6570\u636e\u3002\u6b64\u4ee3\u7406\u9884\u5148\u5b89\u88c5\u5728\u591a\u4e2a Amazon Machine Images (AMIs) \u4e0a\uff0c\u5305\u62ec EKS \u4f18\u5316\u7684 Amazon Linux AMI\u3002\u65e0\u8bba SSM \u4ee3\u7406\u72b6\u6001\u5982\u4f55\uff0c\u90fd\u4f1a\u626b\u63cf\u60a8\u6240\u6709\u7684 Amazon EC2 \u5b9e\u4f8b\u4ee5\u68c0\u67e5\u7f51\u7edc\u53ef\u8fbe\u6027\u95ee\u9898\u3002\u6709\u5173\u4e3a Amazon EC2 \u914d\u7f6e\u626b\u63cf\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u626b\u63cf Amazon EC2 \u5b9e\u4f8b\u3002</p> <p>Attention</p> <p>\u65e0\u6cd5\u5728\u7528\u4e8e\u8fd0\u884c Fargate Pod \u7684\u57fa\u7840\u8bbe\u65bd\u4e0a\u8fd0\u884c Inspector\u3002</p>"},{"location":"zh/security/docs/hosts/#_8","title":"\u66ff\u4ee3\u65b9\u6848","text":""},{"location":"zh/security/docs/hosts/#selinux","title":"\u8fd0\u884c SELinux","text":"<p>Info</p> <p>\u53ef\u7528\u4e8e Red Hat Enterprise Linux (RHEL)\u3001CentOS\u3001Bottlerocket \u548c Amazon Linux 2023</p> <p>SELinux \u63d0\u4f9b\u4e86\u4e00\u5c42\u989d\u5916\u7684\u5b89\u5168\u6027\uff0c\u53ef\u4ee5\u5c06\u5bb9\u5668\u4e0e\u5f7c\u6b64\u548c\u4e3b\u673a\u9694\u79bb\u3002SELinux \u5141\u8bb8\u7ba1\u7406\u5458\u5bf9\u6bcf\u4e2a\u7528\u6237\u3001\u5e94\u7528\u7a0b\u5e8f\u3001\u8fdb\u7a0b\u548c\u6587\u4ef6\u5b9e\u65bd\u5f3a\u5236\u8bbf\u95ee\u63a7\u5236 (MAC)\u3002\u53ef\u4ee5\u5c06\u5176\u89c6\u4e3a\u4e00\u4e2a\u540e\u5907\u673a\u5236\uff0c\u6839\u636e\u4e00\u7ec4\u6807\u7b7e\u9650\u5236\u5bf9\u7279\u5b9a\u8d44\u6e90\u6267\u884c\u7684\u64cd\u4f5c\u3002\u5728 EKS \u4e0a\uff0cSELinux \u53ef\u7528\u4e8e\u9632\u6b62\u5bb9\u5668\u8bbf\u95ee\u5f7c\u6b64\u7684\u8d44\u6e90\u3002</p> <p>\u5bb9\u5668 SELinux \u7b56\u7565\u5728 container-selinux \u5305\u4e2d\u5b9a\u4e49\u3002Docker CE \u9700\u8981\u6b64\u5305\uff08\u53ca\u5176\u4f9d\u8d56\u9879\uff09\uff0c\u4ee5\u4fbf\u7531 Docker\uff08\u6216\u5176\u4ed6\u5bb9\u5668\u8fd0\u884c\u65f6\uff09\u521b\u5efa\u7684\u8fdb\u7a0b\u548c\u6587\u4ef6\u4ee5\u6709\u9650\u7684\u7cfb\u7edf\u8bbf\u95ee\u6743\u9650\u8fd0\u884c\u3002\u5bb9\u5668\u5229\u7528 <code>container_t</code> \u6807\u7b7e\uff0c\u8fd9\u662f <code>svirt_lxc_net_t</code> \u7684\u522b\u540d\u3002\u8fd9\u4e9b\u7b56\u7565\u6709\u6548\u5730\u9632\u6b62\u5bb9\u5668\u8bbf\u95ee\u4e3b\u673a\u7684\u67d0\u4e9b\u529f\u80fd\u3002</p> <p>\u5f53\u60a8\u4e3a Docker \u914d\u7f6e SELinux \u65f6\uff0cDocker \u4f1a\u81ea\u52a8\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u6807\u8bb0\u4e3a <code>container_t</code> \u7c7b\u578b\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u5bb9\u5668\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684 MCS \u7ea7\u522b\u3002\u8fd9\u5c06\u9694\u79bb\u5bb9\u5668\u5f7c\u6b64\u4e4b\u95f4\u3002\u5982\u679c\u60a8\u9700\u8981\u66f4\u5bbd\u677e\u7684\u9650\u5236\uff0c\u60a8\u53ef\u4ee5\u5728 SElinux \u4e2d\u521b\u5efa\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u8be5\u914d\u7f6e\u6587\u4ef6\u6388\u4e88\u5bb9\u5668\u8bbf\u95ee\u6587\u4ef6\u7cfb\u7edf\u7279\u5b9a\u533a\u57df\u7684\u6743\u9650\u3002\u8fd9\u7c7b\u4f3c\u4e8e PSP\uff0c\u60a8\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684\u5bb9\u5668/Pod \u521b\u5efa\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u4e3a\u4e00\u822c\u5de5\u4f5c\u8d1f\u8f7d\u8bbe\u7f6e\u4e00\u7ec4\u9650\u5236\u6027\u63a7\u5236\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e3a\u9700\u8981\u7279\u6743\u8bbf\u95ee\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8bbe\u7f6e\u53e6\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u5bb9\u5668\u7684 SELinux \u6709\u4e00\u7ec4\u53ef\u4ee5\u914d\u7f6e\u7684\u9009\u9879\uff0c\u7528\u4e8e\u4fee\u6539\u9ed8\u8ba4\u9650\u5236\u3002\u53ef\u4ee5\u6839\u636e\u9700\u8981\u542f\u7528\u6216\u7981\u7528\u4ee5\u4e0b SELinux \u5e03\u5c14\u503c\uff1a</p> \u5e03\u5c14\u503c \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>container_connect_any</code> <code>off</code> \u5141\u8bb8\u5bb9\u5668\u8bbf\u95ee\u4e3b\u673a\u4e0a\u7684\u7279\u6743\u7aef\u53e3\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u9700\u8981\u5c06\u7aef\u53e3\u6620\u5c04\u5230\u4e3b\u673a\u4e0a\u7684 443 \u6216 80 \u7684\u5bb9\u5668\u3002 <code>container_manage_cgroup</code> <code>off</code> \u5141\u8bb8\u5bb9\u5668\u7ba1\u7406 cgroup \u914d\u7f6e\u3002\u4f8b\u5982\uff0c\u8fd0\u884c systemd \u7684\u5bb9\u5668\u5c06\u9700\u8981\u542f\u7528\u6b64\u9009\u9879\u3002 <code>container_use_cephfs</code> <code>off</code> \u5141\u8bb8\u5bb9\u5668\u4f7f\u7528 ceph \u6587\u4ef6\u7cfb\u7edf\u3002 <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bb9\u5668\u88ab\u5141\u8bb8\u5728 <code>/usr</code> \u4e0b\u8bfb/\u6267\u884c\uff0c\u5e76\u4ece <code>/etc</code> \u8bfb\u53d6\u5927\u90e8\u5206\u5185\u5bb9\u3002<code>/var/lib/docker</code> \u548c <code>/var/lib/containers</code> \u4e0b\u7684\u6587\u4ef6\u5177\u6709 <code>container_var_lib_t</code> \u6807\u7b7e\u3002\u8981\u67e5\u770b\u9ed8\u8ba4\u6807\u7b7e\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u9605 container.fc \u6587\u4ef6\u3002</p> <pre><code>docker container run -it \\\n  -v /var/lib/docker/image/overlay2/repositories.json:/host/repositories.json \\\n\n  centos:7 cat /host/repositories.json\n# cat: /host/repositories.json: \u6743\u9650\u88ab\u62d2\u7edd\n\ndocker container run -it \\\n  -v /etc/passwd:/host/etc/passwd \\\n  centos:7 cat /host/etc/passwd\n# cat: /host/etc/passwd: \u6743\u9650\u88ab\u62d2\u7edd\n</code></pre> <p>\u6807\u8bb0\u4e3a <code>container_file_t</code> \u7684\u6587\u4ef6\u662f\u5bb9\u5668\u552f\u4e00\u53ef\u5199\u7684\u6587\u4ef6\u3002\u5982\u679c\u60a8\u5e0c\u671b\u5377\u6302\u8f7d\u53ef\u5199\uff0c\u60a8\u5c06\u9700\u8981\u5728\u672b\u5c3e\u6307\u5b9a <code>:z</code> \u6216 <code>:Z</code>\u3002</p> <ul> <li><code>:z</code> \u5c06\u91cd\u65b0\u6807\u8bb0\u6587\u4ef6\uff0c\u4ee5\u4fbf\u5bb9\u5668\u53ef\u4ee5\u8bfb/\u5199</li> <li><code>:Z</code> \u5c06\u91cd\u65b0\u6807\u8bb0\u6587\u4ef6\uff0c\u4ee5\u4fbf\u53ea\u6709\u5bb9\u5668\u53ef\u4ee5\u8bfb/\u5199</li> </ul> <pre><code>ls -Z /var/lib/misc\n# -rw-r--r--. root root system_u:object_r:var_lib_t:s0   postfix.aliasesdb-stamp\n\ndocker container run -it \\\n  -v /var/lib/misc:/host/var/lib/misc:z \\\n  centos:7 echo \"\u91cd\u65b0\u6807\u8bb0!\"\n\nls -Z /var/lib/misc\n#-rw-r--r--. root root system_u:object_r:container_file_t:s0 postfix.aliasesdb-stamp\n</code></pre> <pre><code>docker container run -it \\\n  -v /var/log:/host/var/log:Z \\\n  fluentbit:latest\n</code></pre> <p>\u5728 Kubernetes \u4e2d\uff0c\u91cd\u65b0\u6807\u8bb0\u7565\u6709\u4e0d\u540c\u3002\u4e0d\u662f\u8ba9 Docker \u81ea\u52a8\u91cd\u65b0\u6807\u8bb0\u6587\u4ef6\uff0c\u800c\u662f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 MCS \u6807\u7b7e\u6765\u8fd0\u884c Pod\u3002\u652f\u6301\u91cd\u65b0\u6807\u8bb0\u7684\u5377\u5c06\u81ea\u52a8\u91cd\u65b0\u6807\u8bb0\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u8bbf\u95ee\u5b83\u4eec\u3002\u5177\u6709\u5339\u914d\u7684 MCS \u6807\u7b7e\u7684 Pod \u5c06\u80fd\u591f\u8bbf\u95ee\u8be5\u5377\u3002\u5982\u679c\u60a8\u9700\u8981\u4e25\u683c\u7684\u9694\u79bb\uff0c\u8bf7\u4e3a\u6bcf\u4e2a Pod \u8bbe\u7f6e\u4e0d\u540c\u7684 MCS \u6807\u7b7e\u3002</p> <pre><code>securityContext:\n  seLinuxOptions:\n    # \u4e3a\u6bcf\u4e2a\u5bb9\u5668\u63d0\u4f9b\u552f\u4e00\u7684 MCS \u6807\u7b7e\n    # \u60a8\u4e5f\u53ef\u4ee5\u6307\u5b9a\u7528\u6237\u3001\u89d2\u8272\u548c\u7c7b\u578b\n    # \u57fa\u4e8e\u7c7b\u578b\u548c\u7ea7\u522b (svert) \u7684\u5f3a\u5236\u6267\u884c\n    level: s0:c144:c154\n</code></pre> <p>\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c<code>s0:c144:c154</code> \u5bf9\u5e94\u4e8e\u5bb9\u5668\u88ab\u5141\u8bb8\u8bbf\u95ee\u7684\u6587\u4ef6\u5206\u914d\u7684 MCS \u6807\u7b7e\u3002</p> <p>\u5728 EKS \u4e0a\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u7b56\u7565\u4ee5\u5141\u8bb8\u8fd0\u884c\u7279\u6743\u5bb9\u5668\uff08\u5982 FluentD\uff09\uff0c\u5e76\u521b\u5efa SELinux \u7b56\u7565\u4ee5\u5141\u8bb8\u5b83\u4ece\u4e3b\u673a\u4e0a\u7684 /var/log \u8bfb\u53d6\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u6807\u8bb0\u4e3b\u673a\u76ee\u5f55\u3002\u5177\u6709\u76f8\u540c\u6807\u7b7e\u7684 Pod \u5c06\u80fd\u591f\u8bbf\u95ee\u76f8\u540c\u7684\u4e3b\u673a\u5377\u3002</p> <p>\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86 Amazon EKS \u7684\u793a\u4f8b AMI\uff0c\u5176\u4e2d\u5728 CentOS 7 \u548c RHEL 7 \u4e0a\u914d\u7f6e\u4e86 SELinux\u3002\u8fd9\u4e9b AMI \u662f\u4e3a\u6ee1\u8db3\u9ad8\u5ea6\u76d1\u7ba1\u5ba2\u6237\uff08\u5982 STIG\u3001CJIS \u548c C2S\uff09\u7684\u8981\u6c42\u800c\u5f00\u53d1\u7684\u793a\u4f8b\u5b9e\u73b0\u3002</p> <p>Caution</p> <p>SELinux \u5c06\u5ffd\u7565\u7c7b\u578b\u4e3a unconfined \u7684\u5bb9\u5668\u3002</p>"},{"location":"zh/security/docs/hosts/#_9","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>SELinux Kubernetes RBAC \u548c\u4e3a\u672c\u5730\u5e94\u7528\u7a0b\u5e8f\u53d1\u5e03\u5b89\u5168\u7b56\u7565</li> <li>Kubernetes \u7684\u8fed\u4ee3\u5f3a\u5316</li> <li>Audit2Allow</li> <li>SEAlert</li> <li>\u4f7f\u7528 Udica \u4e3a\u5bb9\u5668\u751f\u6210 SELinux \u7b56\u7565 \u63cf\u8ff0\u4e86\u4e00\u4e2a\u5de5\u5177\uff0c\u5b83\u67e5\u770b\u5bb9\u5668\u89c4\u8303\u6587\u4ef6\u4e2d\u7684 Linux \u529f\u80fd\u3001\u7aef\u53e3\u548c\u6302\u8f7d\u70b9\uff0c\u5e76\u751f\u6210\u4e00\u7ec4 SELinux \u89c4\u5219\uff0c\u5141\u8bb8\u5bb9\u5668\u6b63\u5e38\u8fd0\u884c</li> <li>AMI \u5f3a\u5316 \u7528\u4e8e\u6ee1\u8db3\u4e0d\u540c\u76d1\u7ba1\u8981\u6c42\u7684\u64cd\u4f5c\u7cfb\u7edf\u5f3a\u5316\u5267\u672c</li> <li>Keiko Upgrade Manager \u662f Intuit \u7684\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u7528\u4e8e\u534f\u8c03\u5de5\u4f5c\u8282\u70b9\u7684\u8f6e\u6362\u3002</li> <li>Sysdig Secure</li> <li>eksctl</li> </ul>"},{"location":"zh/security/docs/iam/","title":"\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406","text":"<p>\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406 (IAM) \u662f\u4e00\u9879 AWS \u670d\u52a1\uff0c\u6267\u884c\u4e24\u4e2a\u57fa\u672c\u529f\u80fd\uff1a\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\u3002\u8eab\u4efd\u9a8c\u8bc1\u6d89\u53ca\u8eab\u4efd\u9a8c\u8bc1\uff0c\u800c\u6388\u6743\u7ba1\u7406 AWS \u8d44\u6e90\u53ef\u6267\u884c\u7684\u64cd\u4f5c\u3002\u5728 AWS \u4e2d\uff0c\u8d44\u6e90\u53ef\u4ee5\u662f\u53e6\u4e00\u4e2a AWS \u670d\u52a1\uff0c\u4f8b\u5982 EC2\uff0c\u6216\u8005\u662f AWS \u4e3b\u4f53\uff0c\u5982 IAM \u7528\u6237\u6216\u89d2\u8272\u3002\u89c4\u5b9a\u8d44\u6e90\u53ef\u6267\u884c\u64cd\u4f5c\u7684\u89c4\u5219\u8868\u793a\u4e3a IAM \u7b56\u7565\u3002</p>"},{"location":"zh/security/docs/iam/#eks","title":"\u63a7\u5236\u5bf9 EKS \u96c6\u7fa4\u7684\u8bbf\u95ee","text":"<p>Kubernetes \u9879\u76ee\u652f\u6301\u5404\u79cd\u4e0d\u540c\u7684\u7b56\u7565\u6765\u5bf9 kube-apiserver \u670d\u52a1\u7684\u8bf7\u6c42\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4f8b\u5982 Bearer \u4ee4\u724c\u3001X.509 \u8bc1\u4e66\u3001OIDC \u7b49\u3002EKS \u76ee\u524d\u652f\u6301 webhook \u4ee4\u724c\u8eab\u4efd\u9a8c\u8bc1\u3001\u670d\u52a1\u8d26\u6237\u4ee4\u724c\uff0c\u4ee5\u53ca\u4ece 2021 \u5e74 2 \u6708 21 \u65e5\u8d77\u652f\u6301 OIDC \u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>webhook \u8eab\u4efd\u9a8c\u8bc1\u7b56\u7565\u8c03\u7528\u4e00\u4e2a webhook \u6765\u9a8c\u8bc1 bearer \u4ee4\u724c\u3002\u5728 EKS \u4e0a\uff0c\u8fd9\u4e9b bearer \u4ee4\u724c\u662f\u7531 AWS CLI \u6216 aws-iam-authenticator \u5ba2\u6237\u7aef\u5728\u60a8\u8fd0\u884c <code>kubectl</code> \u547d\u4ee4\u65f6\u751f\u6210\u7684\u3002\u5f53\u60a8\u6267\u884c\u547d\u4ee4\u65f6\uff0c\u4ee4\u724c\u4f1a\u4f20\u9012\u7ed9 kube-apiserver\uff0c\u7136\u540e kube-apiserver \u4f1a\u5c06\u5176\u8f6c\u53d1\u7ed9\u8eab\u4efd\u9a8c\u8bc1 webhook\u3002\u5982\u679c\u8bf7\u6c42\u683c\u5f0f\u6b63\u786e\uff0cwebhook \u4f1a\u8c03\u7528\u4ee4\u724c\u6b63\u6587\u4e2d\u5d4c\u5165\u7684\u9884\u7b7e\u540d URL\u3002\u8be5 URL \u9a8c\u8bc1\u8bf7\u6c42\u7684\u7b7e\u540d\u5e76\u5c06\u6709\u5173\u7528\u6237\u7684\u4fe1\u606f\uff08\u4f8b\u5982\u7528\u6237\u7684\u8d26\u6237\u3001Arn \u548c UserId\uff09\u8fd4\u56de\u7ed9 kube-apiserver\u3002</p> <p>\u8981\u5728\u7ec8\u7aef\u7a97\u53e3\u4e2d\u624b\u52a8\u751f\u6210\u8eab\u4efd\u9a8c\u8bc1\u4ee4\u724c\uff0c\u8bf7\u952e\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>aws eks get-token --cluster-name &lt;cluster_name&gt;\n</code></pre> <p>\u60a8\u4e5f\u53ef\u4ee5\u4ee5\u7f16\u7a0b\u65b9\u5f0f\u83b7\u53d6\u4ee4\u724c\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7528 Go \u7f16\u5199\u7684\u793a\u4f8b\uff1a</p> <pre><code>package main\n\nimport (\n  \"fmt\"\n  \"log\"\n  \"sigs.k8s.io/aws-iam-authenticator/pkg/token\"\n)\n\nfunc main()  {\n  g, _ := token.NewGenerator(false, false)\n  tk, err := g.Get(\"&lt;cluster_name&gt;\")\n  if err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(tk)\n}\n</code></pre> <p>\u8f93\u51fa\u5e94\u8be5\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a</p> <pre><code>{\n  \"kind\": \"ExecCredential\",\n  \"apiVersion\": \"client.authentication.k8s.io/v1alpha1\",\n  \"spec\": {},\n  \"status\": {\n    \"expirationTimestamp\": \"2020-02-19T16:08:27Z\",\n    \"token\": \"k8s-aws-v1.aHR0cHM6Ly9zdHMuYW1hem9uYXdzLmNvbS8_QWN0aW9uPUdldENhbGxlcklkZW50aXR5JlZlcnNpb249MjAxMS0wNi0xNSZYLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFKTkdSSUxLTlNSQzJXNVFBJTJGMjAyMDAyMTklMkZ1cy1lYXN0LTElMkZzdHMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDIwMDIxOVQxNTU0MjdaJlgtQW16LUV4cGlyZXM9NjAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JTNCeC1rOHMtYXdzLWlkJlgtQW16LVNpZ25hdHVyZT0yMjBmOGYzNTg1ZTMyMGRkYjVlNjgzYTVjOWE0MDUzMDFhZDc2NTQ2ZjI0ZjI4MTExZmRhZDA5Y2Y2NDhhMzkz\"\n  }\n}\n</code></pre> <p>\u6bcf\u4e2a\u4ee4\u724c\u4ee5 <code>k8s-aws-v1.</code> \u5f00\u5934\uff0c\u540e\u8ddf\u4e00\u4e2a base64 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u3002\u89e3\u7801\u540e\u7684\u5b57\u7b26\u4e32\u5e94\u8be5\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a</p> <pre><code>https://sts.amazonaws.com/?Action=GetCallerIdentity&amp;Version=2011-06-15&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=XXXXJPFRILKNSRC2W5QA%2F20200219%2Fus-xxxx-1%2Fsts%2Faws4_request&amp;X-Amz-Date=20200219T155427Z&amp;X-Amz-Expires=60&amp;X-Amz-SignedHeaders=host%3Bx-k8s-aws-id&amp;X-Amz-Signature=XXXf8f3285e320ddb5e683a5c9a405301ad76546f24f28111fdad09cf648a393\n</code></pre> <p>\u8be5\u4ee4\u724c\u7531\u4e00\u4e2a\u9884\u7b7e\u540d URL \u7ec4\u6210\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a Amazon \u51ed\u8bc1\u548c\u7b7e\u540d\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html\u3002</p> <p>\u8be5\u4ee4\u724c\u7684\u751f\u5b58\u65f6\u95f4 (TTL) \u4e3a 15 \u5206\u949f\uff0c\u4e4b\u540e\u9700\u8981\u751f\u6210\u65b0\u7684\u4ee4\u724c\u3002\u5f53\u60a8\u4f7f\u7528 <code>kubectl</code> \u7b49\u5ba2\u6237\u7aef\u65f6\uff0c\u8fd9\u662f\u81ea\u52a8\u5904\u7406\u7684\uff0c\u4f46\u662f\uff0c\u5982\u679c\u60a8\u4f7f\u7528 Kubernetes \u4eea\u8868\u677f\uff0c\u6bcf\u6b21\u4ee4\u724c\u8fc7\u671f\u65f6\u60a8\u90fd\u9700\u8981\u751f\u6210\u65b0\u7684\u4ee4\u724c\u5e76\u91cd\u65b0\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u4e00\u65e6\u7528\u6237\u7684\u8eab\u4efd\u901a\u8fc7 AWS IAM \u670d\u52a1\u8fdb\u884c\u4e86\u8eab\u4efd\u9a8c\u8bc1\uff0ckube-apiserver \u5c31\u4f1a\u8bfb\u53d6 <code>kube-system</code> \u547d\u540d\u7a7a\u95f4\u4e2d\u7684 <code>aws-auth</code> ConfigMap\uff0c\u4ee5\u786e\u5b9a\u4e0e\u7528\u6237\u5173\u8054\u7684 RBAC \u7ec4\u3002<code>aws-auth</code> ConfigMap \u7528\u4e8e\u5728 IAM \u4e3b\u4f53\uff08\u5373 IAM \u7528\u6237\u548c\u89d2\u8272\uff09\u4e0e Kubernetes RBAC \u7ec4\u4e4b\u95f4\u521b\u5efa\u9759\u6001\u6620\u5c04\u3002RBAC \u7ec4\u53ef\u4ee5\u5728 Kubernetes RoleBindings \u6216 ClusterRoleBindings \u4e2d\u5f15\u7528\u3002\u5b83\u4eec\u7c7b\u4f3c\u4e8e IAM \u89d2\u8272\uff0c\u56e0\u4e3a\u5b83\u4eec\u5b9a\u4e49\u4e86\u53ef\u4ee5\u5bf9 Kubernetes \u8d44\u6e90\uff08\u5bf9\u8c61\uff09\u96c6\u5408\u6267\u884c\u7684\u4e00\u7ec4\u64cd\u4f5c\uff08\u52a8\u8bcd\uff09\u3002</p>"},{"location":"zh/security/docs/iam/#_2","title":"\u96c6\u7fa4\u8bbf\u95ee\u7ba1\u7406\u5668","text":"<p>\u96c6\u7fa4\u8bbf\u95ee\u7ba1\u7406\u5668\u73b0\u5728\u662f\u7ba1\u7406 AWS IAM \u4e3b\u4f53\u5bf9 Amazon EKS \u96c6\u7fa4\u8bbf\u95ee\u7684\u9996\u9009\u65b9\u5f0f\uff0c\u5b83\u662f EKS v1.23 \u53ca\u66f4\u9ad8\u7248\u672c\u96c6\u7fa4\uff08\u65b0\u96c6\u7fa4\u6216\u73b0\u6709\u96c6\u7fa4\uff09\u7684\u4e00\u9879\u53ef\u9009\u529f\u80fd\u3002\u5b83\u7b80\u5316\u4e86 AWS IAM \u548c Kubernetes RBAC \u4e4b\u95f4\u7684\u8eab\u4efd\u6620\u5c04\uff0c\u6d88\u9664\u4e86\u5728 AWS \u548c Kubernetes API \u4e4b\u95f4\u5207\u6362\u6216\u7f16\u8f91 <code>aws-auth</code> ConfigMap \u8fdb\u884c\u8bbf\u95ee\u7ba1\u7406\u7684\u9700\u8981\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u64cd\u4f5c\u5f00\u9500\uff0c\u5e76\u6709\u52a9\u4e8e\u89e3\u51b3\u9519\u8bef\u914d\u7f6e\u95ee\u9898\u3002\u8be5\u5de5\u5177\u8fd8\u5141\u8bb8\u96c6\u7fa4\u7ba1\u7406\u5458\u81ea\u52a8\u64a4\u9500\u6216\u7ec6\u5316\u4e3a\u521b\u5efa\u96c6\u7fa4\u7684 AWS IAM \u4e3b\u4f53\u81ea\u52a8\u6388\u4e88\u7684 <code>cluster-admin</code> \u6743\u9650\u3002</p> <p>\u8be5 API \u4f9d\u8d56\u4e8e\u4e24\u4e2a\u6982\u5ff5\uff1a</p> <ul> <li>\u8bbf\u95ee\u6761\u76ee\uff1a\u76f4\u63a5\u94fe\u63a5\u5230\u5141\u8bb8\u5bf9 Amazon EKS \u96c6\u7fa4\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684 AWS IAM \u4e3b\u4f53\uff08\u7528\u6237\u6216\u89d2\u8272\uff09\u7684\u96c6\u7fa4\u8eab\u4efd\u3002</li> <li>\u8bbf\u95ee\u7b56\u7565\uff1a\u662f Amazon EKS \u7279\u5b9a\u7684\u7b56\u7565\uff0c\u4e3a\u8bbf\u95ee\u6761\u76ee\u63d0\u4f9b\u5728 Amazon EKS \u96c6\u7fa4\u4e2d\u6267\u884c\u64cd\u4f5c\u7684\u6388\u6743\u3002</li> </ul> <p>\u5728\u53d1\u5e03\u65f6\uff0cAmazon EKS \u4ec5\u652f\u6301\u9884\u5b9a\u4e49\u548c AWS \u7ba1\u7406\u7684\u7b56\u7565\u3002\u8bbf\u95ee\u7b56\u7565\u4e0d\u662f IAM \u5b9e\u4f53\uff0c\u7531 Amazon EKS \u5b9a\u4e49\u548c\u7ba1\u7406\u3002</p> <p>\u96c6\u7fa4\u8bbf\u95ee\u7ba1\u7406\u5668\u5141\u8bb8\u5c06\u4e0a\u6e38 RBAC \u4e0e\u652f\u6301\u5141\u8bb8\u548c\u4f20\u9012\uff08\u4f46\u4e0d\u662f\u62d2\u7edd\uff09Kubernetes AuthZ \u51b3\u7b56\u7684\u8bbf\u95ee\u7b56\u7565\u76f8\u7ed3\u5408\u3002\u5982\u679c\u4e0a\u6e38 RBAC \u548c Amazon EKS \u6388\u6743\u8005\u90fd\u65e0\u6cd5\u786e\u5b9a\u8bf7\u6c42\u8bc4\u4f30\u7684\u7ed3\u679c\uff0c\u5219\u4f1a\u53d1\u751f\u62d2\u7edd\u51b3\u7b56\u3002</p> <p>\u4f7f\u7528\u6b64\u529f\u80fd\uff0cAmazon EKS \u652f\u6301\u4e09\u79cd\u8eab\u4efd\u9a8c\u8bc1\u6a21\u5f0f\uff1a</p> <ol> <li><code>CONFIG_MAP</code> \u7ee7\u7eed\u4e13\u95e8\u4f7f\u7528 <code>aws-auth</code> configMap\u3002</li> <li><code>API_AND_CONFIG_MAP</code> \u4ece EKS \u8bbf\u95ee\u6761\u76ee API \u548c <code>aws-auth</code> configMap \u83b7\u53d6\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684 IAM \u4e3b\u4f53\uff0c\u4f18\u5148\u8003\u8651\u8bbf\u95ee\u6761\u76ee\u3002\u7406\u60f3\u7684\u662f\u5c06\u73b0\u6709\u7684 <code>aws-auth</code> \u6743\u9650\u8fc1\u79fb\u5230\u8bbf\u95ee\u6761\u76ee\u3002</li> <li><code>API</code> \u4e13\u95e8\u4f9d\u8d56 EKS \u8bbf\u95ee\u6761\u76ee API\u3002\u8fd9\u662f\u65b0\u7684\u63a8\u8350\u65b9\u6cd5\u3002</li> </ol> <p>\u8981\u5f00\u59cb\u4f7f\u7528\uff0c\u96c6\u7fa4\u7ba1\u7406\u5458\u53ef\u4ee5\u521b\u5efa\u6216\u66f4\u65b0 Amazon EKS \u96c6\u7fa4\uff0c\u5c06\u9996\u9009\u8eab\u4efd\u9a8c\u8bc1\u8bbe\u7f6e\u4e3a <code>API_AND_CONFIG_MAP</code> \u6216 <code>API</code> \u65b9\u6cd5\uff0c\u5e76\u4e3a\u6240\u9700\u7684 AWS IAM \u4e3b\u4f53\u5b9a\u4e49\u8bbf\u95ee\u6761\u76ee\u3002</p> <pre><code>$ aws eks create-cluster \\\n    --name &lt;CLUSTER_NAME&gt; \\\n    --role-arn &lt;CLUSTER_ROLE_ARN&gt; \\\n    --resources-vpc-config subnetIds=&lt;value&gt;,endpointPublicAccess=true,endpointPrivateAccess=true \\\n    --logging '{\"clusterLogging\":[{\"types\":[\"api\",\"audit\",\"authenticator\",\"controllerManager\",\"scheduler\"],\"enabled\":true}]}' \\\n    --access-config authenticationMode=API_AND_CONFIG_MAP,bootstrapClusterCreatorAdminPermissions=false\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u6ca1\u6709\u96c6\u7fa4\u521b\u5efa\u8005\u7ba1\u7406\u5458\u6743\u9650\u7684 Amazon EKS \u96c6\u7fa4\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>update-cluster-config</code> \u547d\u4ee4\u66f4\u65b0 Amazon EKS \u96c6\u7fa4\u914d\u7f6e\u4ee5\u542f\u7528 <code>API</code> authenticationMode\uff0c\u5bf9\u4e8e\u4f7f\u7528 <code>CONFIG_MAP</code> \u7684\u73b0\u6709\u96c6\u7fa4\uff0c\u60a8\u5fc5\u987b\u5148\u66f4\u65b0\u5230 <code>API_AND_CONFIG_MAP</code>\uff0c\u7136\u540e\u518d\u66f4\u65b0\u5230 <code>API</code>\u3002\u8fd9\u4e9b\u64cd\u4f5c\u65e0\u6cd5\u64a4\u6d88\uff0c\u8fd9\u610f\u5473\u7740\u65e0\u6cd5\u4ece <code>API</code> \u5207\u6362\u5230 <code>API_AND_CONFIG_MAP</code> \u6216 <code>CONFIG_MAP</code>\uff0c\u4e5f\u65e0\u6cd5\u4ece <code>API_AND_CONFIG_MAP</code> \u5207\u6362\u5230 <code>CONFIG_MAP</code>\u3002</p> <pre><code>$ aws eks update-cluster-config \\\n    --name &lt;CLUSTER_NAME&gt; \\\n    --access-config authenticationMode=API\n</code></pre> <p>\u8be5 API \u652f\u6301\u547d\u4ee4\u6765\u6dfb\u52a0\u548c\u64a4\u9500\u5bf9\u96c6\u7fa4\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u4ee5\u53ca\u9a8c\u8bc1\u6307\u5b9a\u96c6\u7fa4\u7684\u73b0\u6709\u8bbf\u95ee\u7b56\u7565\u548c\u8bbf\u95ee\u6761\u76ee\u3002\u9ed8\u8ba4\u7b56\u7565\u662f\u6309\u7167\u4ee5\u4e0b\u65b9\u5f0f\u521b\u5efa\u7684\uff0c\u4ee5\u5339\u914d Kubernets RBAC\uff1a</p> EKS \u8bbf\u95ee\u7b56\u7565 Kubernetes RBAC AmazonEKSClusterAdminPolicy cluster-admin AmazonEKSAdminPolicy admin AmazonEKSEditPolicy edit AmazonEKSViewPolicy view <pre><code>$ aws eks list-access-policies\n{\n    \"accessPolicies\": [\n        {\n            \"name\": \"AmazonEKSAdminPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSAdminPolicy\"\n        },\n        {\n            \"name\": \"AmazonEKSClusterAdminPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy\"\n        },\n        {\n            \"name\": \"AmazonEKSEditPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSEditPolicy\"\n        },\n        {\n            \"name\": \"AmazonEKSViewPolicy\",\n            \"arn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSViewPolicy\"\n        }\n    ]\n}\n\n$ aws eks list-access-entries --cluster-name &lt;CLUSTER_NAME&gt;\n\n{\n    \"accessEntries\": []\n}\n</code></pre> <p>\u5f53\u96c6\u7fa4\u5728\u6ca1\u6709\u96c6\u7fa4\u521b\u5efa\u8005\u7ba1\u7406\u5458\u6743\u9650\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u65f6\uff0c\u4e0d\u4f1a\u6709\u53ef\u7528\u7684\u8bbf\u95ee\u6761\u76ee\uff0c\u8fd9\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u521b\u5efa\u7684\u552f\u4e00\u6761\u76ee\u3002</p>"},{"location":"zh/security/docs/iam/#aws-auth-configmap","title":"<code>aws-auth</code> ConfigMap (\u5df2\u5f03\u7528)","text":"<p>Kubernetes \u4e0e AWS \u8eab\u4efd\u9a8c\u8bc1\u96c6\u6210\u7684\u4e00\u79cd\u65b9\u5f0f\u662f\u901a\u8fc7 <code>aws-auth</code> ConfigMap\uff0c\u5b83\u4f4d\u4e8e <code>kube-system</code> \u547d\u540d\u7a7a\u95f4\u4e2d\u3002\u5b83\u8d1f\u8d23\u5c06 AWS IAM \u8eab\u4efd\uff08\u7528\u6237\u3001\u7ec4\u548c\u89d2\u8272\uff09\u8eab\u4efd\u9a8c\u8bc1\u6620\u5c04\u5230 Kubernetes \u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236 (RBAC) \u6388\u6743\u3002\u5728\u60a8\u7684 Amazon EKS \u96c6\u7fa4\u7684\u4f9b\u5e94\u9636\u6bb5\uff0c\u4f1a\u81ea\u52a8\u5728\u96c6\u7fa4\u4e2d\u521b\u5efa <code>aws-auth</code> ConfigMap\u3002\u5b83\u6700\u521d\u662f\u4e3a\u4e86\u5141\u8bb8\u8282\u70b9\u52a0\u5165\u60a8\u7684\u96c6\u7fa4\u800c\u521b\u5efa\u7684\uff0c\u4f46\u5982\u524d\u6240\u8ff0\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6b64 ConfigMap \u4e3a IAM \u4e3b\u4f53\u6dfb\u52a0 RBAC \u8bbf\u95ee\u6743\u9650\u3002</p> <p>\u8981\u68c0\u67e5\u60a8\u96c6\u7fa4\u7684 <code>aws-auth</code> ConfigMap\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u3002</p> <pre><code>kubectl -n kube-system get configmap aws-auth -o yaml\n</code></pre> <p>\u8fd9\u662f <code>aws-auth</code> ConfigMap \u7684\u9ed8\u8ba4\u914d\u7f6e\u793a\u4f8b\u3002</p> <pre><code>apiVersion: v1\ndata:\n  mapRoles: |\n    - groups:\n      - system:bootstrappers\n      - system:nodes\n      - system:node-proxier\n      rolearn: arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:role/kube-system-&lt;SELF_GENERATED_UUID&gt;\n      username: system:node:{{SessionName}}\nkind: ConfigMap\nmetadata:\n  creationTimestamp: \"2023-10-22T18:19:30Z\"\n  name: aws-auth\n  namespace: kube-system\n</code></pre> <p>\u6b64 ConfigMap \u7684\u4e3b\u8981\u90e8\u5206\u4f4d\u4e8e <code>data</code> \u4e0b\u7684 <code>mapRoles</code> \u5757\u4e2d\uff0c\u5b83\u57fa\u672c\u4e0a\u7531 3 \u4e2a\u53c2\u6570\u7ec4\u6210\u3002</p> <ul> <li>groups\uff1a\u8981\u5c06 IAM \u89d2\u8272\u6620\u5c04\u5230\u7684 Kubernetes \u7ec4\u3002\u8fd9\u53ef\u4ee5\u662f\u9ed8\u8ba4\u7ec4\uff0c\u4e5f\u53ef\u4ee5\u662f\u5728 <code>clusterrolebinding</code> \u6216 <code>rolebinding</code> \u4e2d\u6307\u5b9a\u7684\u81ea\u5b9a\u4e49\u7ec4\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u53ea\u58f0\u660e\u4e86\u7cfb\u7edf\u7ec4\u3002</li> <li>rolearn\uff1a\u8981\u6620\u5c04\u5230 Kubernetes \u7ec4\u7684 AWS IAM \u89d2\u8272\u7684 ARN\uff0c\u4f7f\u7528\u4ee5\u4e0b\u683c\u5f0f <code>arn:&lt;PARTITION&gt;:iam::&lt;AWS_ACCOUNT_ID&gt;:role/role-name</code>\u3002</li> <li>username\uff1a\u5728 Kubernetes \u4e2d\u6620\u5c04\u5230 AWS IAM \u89d2\u8272\u7684\u7528\u6237\u540d\u3002\u8fd9\u53ef\u4ee5\u662f\u4efb\u4f55\u81ea\u5b9a\u4e49\u540d\u79f0\u3002</li> </ul> <p>\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728 <code>aws-auth</code> ConfigMap \u7684 <code>data</code> \u4e0b\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684 <code>mapUsers</code> \u914d\u7f6e\u5757\u6765\u6620\u5c04 AWS IAM \u7528\u6237\u7684\u6743\u9650\uff0c\u5c06 rolearn \u53c2\u6570\u66ff\u6362\u4e3a userarn\uff0c\u4f46\u662f\u4f5c\u4e3a\u6700\u4f73\u5b9e\u8df5\uff0c\u59cb\u7ec8\u5efa\u8bae\u4f7f\u7528 <code>mapRoles</code>\u3002</p> <p>\u8981\u7ba1\u7406\u6743\u9650\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u6216\u5220\u9664\u5bf9\u60a8\u7684 Amazon EKS \u96c6\u7fa4\u7684\u8bbf\u95ee\u6743\u9650\u6765\u7f16\u8f91 <code>aws-auth</code> ConfigMap\u3002\u867d\u7136\u53ef\u4ee5\u624b\u52a8\u7f16\u8f91 <code>aws-auth</code> ConfigMap\uff0c\u4f46\u5efa\u8bae\u4f7f\u7528 <code>eksctl</code> \u7b49\u5de5\u5177\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u654f\u611f\u7684\u914d\u7f6e\uff0c\u4e0d\u51c6\u786e\u7684\u914d\u7f6e\u53ef\u80fd\u4f1a\u5c06\u60a8\u9501\u5b9a\u5728 Amazon EKS \u96c6\u7fa4\u4e4b\u5916\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b\u4e0b\u9762\u7684\u5c0f\u8282 \u4f7f\u7528\u5de5\u5177\u5bf9 aws-auth ConfigMap \u8fdb\u884c\u66f4\u6539\u3002</p>"},{"location":"zh/security/docs/iam/#_3","title":"\u96c6\u7fa4\u8bbf\u95ee\u5efa\u8bae","text":""},{"location":"zh/security/docs/iam/#eks_1","title":"\u4f7f EKS \u96c6\u7fa4\u7aef\u70b9\u79c1\u6709\u5316","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u60a8\u914d\u7f6e EKS \u96c6\u7fa4\u65f6\uff0cAPI \u96c6\u7fa4\u7aef\u70b9\u4f1a\u8bbe\u7f6e\u4e3a\u516c\u5171\u7684\uff0c\u5373\u53ef\u4ee5\u4ece\u4e92\u8054\u7f51\u8bbf\u95ee\u3002\u5c3d\u7ba1\u53ef\u4ee5\u4ece\u4e92\u8054\u7f51\u8bbf\u95ee\uff0c\u4f46\u7aef\u70b9\u4ecd\u7136\u88ab\u8ba4\u4e3a\u662f\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u5b83\u8981\u6c42\u6240\u6709 API \u8bf7\u6c42\u90fd\u7531 IAM \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u7136\u540e\u7531 Kubernetes RBAC \u8fdb\u884c\u6388\u6743\u3002\u5c3d\u7ba1\u5982\u6b64\uff0c\u5982\u679c\u60a8\u7684\u516c\u53f8\u5b89\u5168\u7b56\u7565\u8981\u6c42\u60a8\u9650\u5236\u4ece\u4e92\u8054\u7f51\u8bbf\u95ee API \u6216\u9632\u6b62\u60a8\u5c06\u6d41\u91cf\u8def\u7531\u5230\u96c6\u7fa4 VPC \u4e4b\u5916\uff0c\u60a8\u53ef\u4ee5\uff1a</p> <ul> <li>\u5c06 EKS \u96c6\u7fa4\u7aef\u70b9\u914d\u7f6e\u4e3a\u79c1\u6709\u3002\u6709\u5173\u6b64\u4e3b\u9898\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4fee\u6539\u96c6\u7fa4\u7aef\u70b9\u8bbf\u95ee\u3002</li> <li>\u4fdd\u6301\u96c6\u7fa4\u7aef\u70b9\u516c\u5f00\uff0c\u5e76\u6307\u5b9a\u54ea\u4e9b CIDR \u5757\u53ef\u4ee5\u4e0e\u96c6\u7fa4\u7aef\u70b9\u901a\u4fe1\u3002\u8fd9\u4e9b\u5757\u5b9e\u9645\u4e0a\u662f\u4e00\u7ec4\u5141\u8bb8\u8bbf\u95ee\u96c6\u7fa4\u7aef\u70b9\u7684\u516c\u5171 IP \u5730\u5740\u7684\u767d\u540d\u5355\u3002</li> <li>\u914d\u7f6e\u516c\u5171\u8bbf\u95ee\u548c\u4e00\u7ec4\u5141\u8bb8\u7684 CIDR \u5757\uff0c\u5e76\u5c06\u79c1\u6709\u7aef\u70b9\u8bbf\u95ee\u8bbe\u7f6e\u4e3a\u542f\u7528\u3002\u8fd9\u5c06\u5141\u8bb8\u4ece\u7279\u5b9a\u8303\u56f4\u7684\u516c\u5171 IP \u8fdb\u884c\u516c\u5171\u8bbf\u95ee\uff0c\u540c\u65f6\u5f3a\u5236\u6240\u6709 kubelet\uff08\u5de5\u4f5c\u8282\u70b9\uff09\u4e0e Kubernetes API \u4e4b\u95f4\u7684\u7f51\u7edc\u6d41\u91cf\u901a\u8fc7\u5728\u63a7\u5236\u5e73\u9762\u914d\u7f6e\u65f6\u5728\u96c6\u7fa4 VPC \u4e2d\u914d\u7f6e\u7684\u8de8\u8d26\u6237 ENI\u3002</li> </ul>"},{"location":"zh/security/docs/iam/#_4","title":"\u4e0d\u8981\u4f7f\u7528\u670d\u52a1\u8d26\u6237\u4ee4\u724c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1","text":"<p>\u670d\u52a1\u8d26\u6237\u4ee4\u724c\u662f\u4e00\u79cd\u957f\u671f\u7684\u3001\u9759\u6001\u51ed\u8bc1\u3002\u5982\u679c\u5b83\u88ab\u6cc4\u9732\u3001\u4e22\u5931\u6216\u88ab\u76d7\uff0c\u653b\u51fb\u8005\u53ef\u80fd\u80fd\u591f\u6267\u884c\u4e0e\u8be5\u4ee4\u724c\u5173\u8054\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u76f4\u5230\u5220\u9664\u8be5\u670d\u52a1\u8d26\u6237\u4e3a\u6b62\u3002\u6709\u65f6\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u4e3a\u5fc5\u987b\u4ece\u96c6\u7fa4\u5916\u90e8\u6d88\u8d39 Kubernetes API \u7684\u5e94\u7528\u7a0b\u5e8f\u6388\u4e88\u4f8b\u5916\uff0c\u4f8b\u5982 CI/CD \u7ba1\u9053\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u6b64\u7c7b\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728 AWS \u57fa\u7840\u8bbe\u65bd\uff08\u5982 EC2 \u5b9e\u4f8b\uff09\u4e0a\uff0c\u8bf7\u8003\u8651\u4f7f\u7528\u5b9e\u4f8b\u914d\u7f6e\u6587\u4ef6\u5e76\u5c06\u5176\u6620\u5c04\u5230 Kubernetes RBAC \u89d2\u8272\u3002</p>"},{"location":"zh/security/docs/iam/#aws","title":"\u5bf9 AWS \u8d44\u6e90\u91c7\u7528\u6700\u5c0f\u7279\u6743\u8bbf\u95ee","text":"<p>IAM \u7528\u6237\u4e0d\u9700\u8981\u88ab\u5206\u914d\u5bf9 AWS \u8d44\u6e90\u7684\u6743\u9650\u5c31\u53ef\u4ee5\u8bbf\u95ee Kubernetes API\u3002\u5982\u679c\u60a8\u9700\u8981\u4e3a IAM \u7528\u6237\u6388\u4e88\u5bf9 EKS \u96c6\u7fa4\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u8bf7\u5728 <code>aws-auth</code> ConfigMap \u4e2d\u4e3a\u8be5\u7528\u6237\u521b\u5efa\u4e00\u4e2a\u6761\u76ee\uff0c\u5c06\u5176\u6620\u5c04\u5230\u7279\u5b9a\u7684 Kubernetes RBAC \u7ec4\u3002</p>"},{"location":"zh/security/docs/iam/#cluster-admin","title":"\u4ece\u96c6\u7fa4\u521b\u5efa\u8005\u4e3b\u4f53\u4e2d\u5220\u9664 cluster-admin \u6743\u9650","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u521b\u5efa\u7684 Amazon EKS \u96c6\u7fa4\u4f1a\u5c06\u6c38\u4e45\u7684 <code>cluster-admin</code> \u6743\u9650\u7ed1\u5b9a\u5230\u96c6\u7fa4\u521b\u5efa\u8005\u4e3b\u4f53\u3002\u4f7f\u7528\u96c6\u7fa4\u8bbf\u95ee\u7ba1\u7406\u5668 API\uff0c\u53ef\u4ee5\u5728\u521b\u5efa\u96c6\u7fa4\u65f6\u901a\u8fc7\u5c06 <code>--access-config bootstrapClusterCreatorAdminPermissions</code> \u8bbe\u7f6e\u4e3a <code>false</code> \u6765\u521b\u5efa\u6ca1\u6709\u6b64\u6743\u9650\u7684\u96c6\u7fa4\uff0c\u5f53\u4f7f\u7528 <code>API_AND_CONFIG_MAP</code> \u6216 <code>API</code> \u8eab\u4efd\u9a8c\u8bc1\u6a21\u5f0f\u65f6\u3002\u64a4\u9500\u6b64\u8bbf\u95ee\u6743\u9650\u88ab\u89c6\u4e3a\u6700\u4f73\u5b9e\u8df5\uff0c\u4ee5\u907f\u514d\u5bf9\u96c6\u7fa4\u914d\u7f6e\u8fdb\u884c\u4efb\u4f55\u4e0d\u9700\u8981\u7684\u66f4\u6539\u3002\u64a4\u9500\u6b64\u8bbf\u95ee\u6743\u9650\u7684\u8fc7\u7a0b\u4e0e\u64a4\u9500\u5bf9\u96c6\u7fa4\u7684\u4efb\u4f55\u5176\u4ed6\u8bbf\u95ee\u6743\u9650\u7684\u8fc7\u7a0b\u76f8\u540c\u3002</p> <p>\u8be5 API \u8ba9\u60a8\u53ef\u4ee5\u7075\u6d3b\u5730\u4ec5\u5c06 IAM \u4e3b\u4f53\u4e0e\u8bbf\u95ee\u7b56\u7565\u89e3\u9664\u5173\u8054\uff0c\u5728\u672c\u4f8b\u4e2d\u662f <code>AmazonEKSClusterAdminPolicy</code>\u3002</p> <pre><code>$ aws eks list-associated-access-policies \\\n    --cluster-name &lt;CLUSTER_NAME&gt; \\\n    --principal-arn &lt;IAM_PRINCIPAL_ARN&gt;\n\n$ aws eks disassociate-access-policy --cluster-name &lt;CLUSTER_NAME&gt; \\\n    --principal-arn &lt;IAM_PRINCIPAL_ARN. \\\n    --policy-arn arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy\n</code></pre> <p>\u6216\u8005\u5b8c\u5168\u5220\u9664\u4e0e <code>cluster-admin</code> \u6743\u9650\u5173\u8054\u7684\u8bbf\u95ee\u6761\u76ee\u3002</p> <pre><code>$ aws eks list-access-entries --cluster-name &lt;CLUSTER_NAME&gt;\n\n{\n    \"accessEntries\": []\n}\n\n$ aws eks delete-access-entry --cluster-name &lt;CLUSTER_NAME&gt; \\\n  --principal-arn &lt;IAM_PRINCIPAL_ARN&gt;\n</code></pre> <p>\u5728\u53d1\u751f\u4e8b\u6545\u3001\u7d27\u6025\u60c5\u51b5\u6216\u8005\u5f53\u96c6\u7fa4\u65e0\u6cd5\u8bbf\u95ee\u65f6\uff0c\u53ef\u4ee5\u518d\u6b21\u6388\u4e88\u6b64\u8bbf\u95ee\u6743\u9650\u3002</p> <p>\u5982\u679c\u96c6\u7fa4\u4ecd\u7136\u4f7f\u7528 <code>CONFIG_MAP</code> \u8eab\u4efd\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u6240\u6709\u5176\u4ed6\u7528\u6237\u90fd\u5e94\u8be5\u901a\u8fc7 <code>aws-auth</code> ConfigMap \u83b7\u5f97\u5bf9\u96c6\u7fa4\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u5e76\u4e14\u5728\u914d\u7f6e\u4e86 <code>aws-auth</code> ConfigMap \u4e4b\u540e\uff0c\u53ef\u4ee5\u5220\u9664\u5206\u914d\u7ed9\u521b\u5efa\u96c6\u7fa4\u7684\u5b9e\u4f53\u7684\u89d2\u8272\uff0c\u5e76\u4e14\u53ea\u5728\u53d1\u751f\u4e8b\u6545\u3001\u7d27\u6025\u60c5\u51b5\u6216\u8005\u5f53 <code>aws-auth</code> ConfigMap \u635f\u574f\u4e14\u96c6\u7fa4\u65e0\u6cd5\u8bbf\u95ee\u65f6\u624d\u91cd\u65b0\u521b\u5efa\u8be5\u89d2\u8272\u3002\u8fd9\u5728\u751f\u4ea7\u96c6\u7fa4\u4e2d\u7279\u522b\u6709\u7528\u3002</p>"},{"location":"zh/security/docs/iam/#iam","title":"\u5f53\u591a\u4e2a\u7528\u6237\u9700\u8981\u76f8\u540c\u7684\u8bbf\u95ee\u6743\u9650\u65f6\uff0c\u8bf7\u4f7f\u7528 IAM \u89d2\u8272","text":"<p>\u4e0e\u4e3a\u6bcf\u4e2a\u5355\u72ec\u7684 IAM \u7528\u6237\u521b\u5efa\u6761\u76ee\u4e0d\u540c\uff0c\u5141\u8bb8\u8fd9\u4e9b\u7528\u6237\u627f\u62c5 IAM \u89d2\u8272\u5e76\u5c06\u8be5\u89d2\u8272\u6620\u5c04\u5230 Kubernetes RBAC \u7ec4\u3002\u8fd9\u5c06\u66f4\u5bb9\u6613\u7ef4\u62a4\uff0c\u5c24\u5176\u662f\u5728\u9700\u8981\u8bbf\u95ee\u6743\u9650\u7684\u7528\u6237\u6570\u91cf\u589e\u52a0\u65f6\u3002</p> <p>Attention</p> <p>\u5f53\u4f7f\u7528 <code>aws-auth</code> ConfigMap \u6620\u5c04\u7684 IAM \u5b9e\u4f53\u8bbf\u95ee EKS \u96c6\u7fa4\u65f6\uff0c\u63cf\u8ff0\u7684\u7528\u6237\u540d\u5c06\u8bb0\u5f55\u5728 Kubernetes \u5ba1\u8ba1\u65e5\u5fd7\u7684\u7528\u6237\u5b57\u6bb5\u4e2d\u3002\u5982\u679c\u60a8\u4f7f\u7528 IAM \u89d2\u8272\uff0c\u5219\u5b9e\u9645\u627f\u62c5\u8be5\u89d2\u8272\u7684\u7528\u6237\u65e0\u6cd5\u88ab\u8bb0\u5f55\u548c\u5ba1\u8ba1\u3002</p> <p>\u5982\u679c\u4ecd\u5728\u4f7f\u7528 <code>aws-auth</code> configMap \u4f5c\u4e3a\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u5f53\u4e3a IAM \u89d2\u8272\u5206\u914d K8s RBAC \u6743\u9650\u65f6\uff0c\u60a8\u5e94\u8be5\u5728\u7528\u6237\u540d\u4e2d\u5305\u542b {{SessionName}}\u3002\u8fd9\u6837\uff0c\u5ba1\u8ba1\u65e5\u5fd7\u5c06\u8bb0\u5f55\u4f1a\u8bdd\u540d\u79f0\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u8ddf\u8e2a\u8c01\u5b9e\u9645\u627f\u62c5\u4e86\u6b64\u89d2\u8272\uff0c\u4ee5\u53ca CloudTrail \u65e5\u5fd7\u3002</p> <pre><code>- rolearn: arn:aws:iam::XXXXXXXXXXXX:role/testRole\n  username: testRole:{{SessionName}}\n  groups:\n    - system:masters\n</code></pre> <p>\u5728 Kubernetes 1.20 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u4e0d\u518d\u9700\u8981\u8fdb\u884c\u6b64\u66f4\u6539\uff0c\u56e0\u4e3a <code>user.extra.sessionName.0</code> \u5df2\u6dfb\u52a0\u5230 Kubernetes \u5ba1\u8ba1\u65e5\u5fd7\u4e2d\u3002</p>"},{"location":"zh/security/docs/iam/#rolebindings-clusterrolebindings","title":"\u5728\u521b\u5efa RoleBindings \u548c ClusterRoleBindings \u65f6\u91c7\u7528\u6700\u5c0f\u7279\u6743\u8bbf\u95ee","text":"<p>\u4e0e\u524d\u9762\u5173\u4e8e\u6388\u4e88\u5bf9 AWS \u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u7684\u8981\u70b9\u4e00\u6837\uff0cRoleBindings \u548c ClusterRoleBindings \u5e94\u8be5\u53ea\u5305\u542b\u6267\u884c\u7279\u5b9a\u529f\u80fd\u6240\u9700\u7684\u6743\u9650\u96c6\u3002\u9664\u975e\u7edd\u5bf9\u5fc5\u8981\uff0c\u5426\u5219\u8bf7\u907f\u514d\u5728\u60a8\u7684\u89d2\u8272\u548c\u96c6\u7fa4\u89d2\u8272\u4e2d\u4f7f\u7528 <code>[\"*\"]</code>\u3002\u5982\u679c\u60a8\u4e0d\u786e\u5b9a\u8981\u5206\u914d\u54ea\u4e9b\u6743\u9650\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 audit2rbac \u7b49\u5de5\u5177\uff0c\u6839\u636e Kubernetes \u5ba1\u8ba1\u65e5\u5fd7\u4e2d\u89c2\u5bdf\u5230\u7684 API \u8c03\u7528\u81ea\u52a8\u751f\u6210\u89d2\u8272\u548c\u7ed1\u5b9a\u3002</p>"},{"location":"zh/security/docs/iam/#_5","title":"\u4f7f\u7528\u81ea\u52a8\u5316\u6d41\u7a0b\u521b\u5efa\u96c6\u7fa4","text":"<p>\u5982\u524d\u9762\u7684\u6b65\u9aa4\u6240\u793a\uff0c\u5728\u521b\u5efa Amazon EKS \u96c6\u7fa4\u65f6\uff0c\u5982\u679c\u4e0d\u4f7f\u7528 <code>API_AND_CONFIG_MAP</code> \u6216 <code>API</code> \u8eab\u4efd\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u5e76\u4e14\u4e0d\u9009\u62e9\u4e0d\u5c06 <code>cluster-admin</code> \u6743\u9650\u59d4\u6d3e\u7ed9\u96c6\u7fa4\u521b\u5efa\u8005\uff0c\u5219\u521b\u5efa\u96c6\u7fa4\u7684 IAM \u5b9e\u4f53\u7528\u6237\u6216\u89d2\u8272\uff08\u5982\u8054\u5408\u7528\u6237\uff09\u5c06\u81ea\u52a8\u5728\u96c6\u7fa4\u7684 RBAC \u914d\u7f6e\u4e2d\u83b7\u5f97 <code>system:masters</code> \u6743\u9650\u3002\u5373\u4f7f\u5c06\u5220\u9664\u6b64\u6743\u9650\u89c6\u4e3a\u6700\u4f73\u5b9e\u8df5\uff0c\u5982\u679c\u4f7f\u7528 <code>CONFIG_MAP</code> \u8eab\u4efd\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u4f9d\u8d56\u4e8e <code>aws-auth</code> ConfigMap\uff0c\u4e5f\u65e0\u6cd5\u64a4\u9500\u6b64\u8bbf\u95ee\u6743\u9650\u3002\u56e0\u6b64\uff0c\u6700\u597d\u4f7f\u7528\u4e0e\u4e13\u7528 IAM \u89d2\u8272\u76f8\u5173\u8054\u7684\u57fa\u7840\u8bbe\u65bd\u81ea\u52a8\u5316\u7ba1\u9053\u6765\u521b\u5efa\u96c6\u7fa4\uff0c\u8be5\u89d2\u8272\u6ca1\u6709\u5176\u4ed6\u7528\u6237\u6216\u5b9e\u4f53\u53ef\u4ee5\u627f\u62c5\u7684\u6743\u9650\uff0c\u5e76\u5b9a\u671f\u5ba1\u6838\u5bf9\u8be5\u89d2\u8272\u7684\u6743\u9650\u3001\u7b56\u7565\u548c\u8c01\u6709\u6743\u89e6\u53d1\u7ba1\u9053\u7684\u8bbf\u95ee\u6743\u9650\u3002\u6b64\u5916\uff0c\u8be5\u89d2\u8272\u4e0d\u5e94\u7528\u4e8e\u5bf9\u96c6\u7fa4\u6267\u884c\u4f8b\u884c\u64cd\u4f5c\uff0c\u800c\u5e94\u4e13\u95e8\u7528\u4e8e\u901a\u8fc7 SCM \u4ee3\u7801\u66f4\u6539\u7b49\u65b9\u5f0f\u89e6\u53d1\u7ba1\u9053\u7684\u96c6\u7fa4\u7ea7\u64cd\u4f5c\u3002</p>"},{"location":"zh/security/docs/iam/#iam_1","title":"\u4f7f\u7528\u4e13\u7528 IAM \u89d2\u8272\u521b\u5efa\u96c6\u7fa4","text":"<p>\u5f53\u60a8\u521b\u5efa Amazon EKS \u96c6\u7fa4\u65f6\uff0c\u521b\u5efa\u96c6\u7fa4\u7684 IAM \u5b9e\u4f53\u7528\u6237\u6216\u89d2\u8272\uff08\u5982\u8054\u5408\u7528\u6237\uff09\u5c06\u81ea\u52a8\u5728\u96c6\u7fa4\u7684 RBAC \u914d\u7f6e\u4e2d\u83b7\u5f97 <code>system:masters</code> \u6743\u9650\u3002\u6b64\u8bbf\u95ee\u6743\u9650\u65e0\u6cd5\u901a\u8fc7 <code>aws-auth</code> ConfigMap \u8fdb\u884c\u7ba1\u7406\u3002\u56e0\u6b64\uff0c\u6700\u597d\u4f7f\u7528\u4e13\u7528 IAM \u89d2\u8272\u521b\u5efa\u96c6\u7fa4\uff0c\u5e76\u5b9a\u671f\u5ba1\u6838\u8c01\u53ef\u4ee5\u627f\u62c5\u6b64\u89d2\u8272\u3002\u6b64\u89d2\u8272\u4e0d\u5e94\u7528\u4e8e\u5bf9\u96c6\u7fa4\u6267\u884c\u4f8b\u884c\u64cd\u4f5c\uff0c\u800c\u5e94\u5c06\u5176\u4ed6\u7528\u6237\u901a\u8fc7 <code>aws-auth</code> ConfigMap \u6388\u4e88\u5bf9\u96c6\u7fa4\u7684\u8bbf\u95ee\u6743\u9650\u3002\u5728\u914d\u7f6e\u4e86 <code>aws-auth</code> ConfigMap \u4e4b\u540e\uff0c\u5e94\u8be5\u4fdd\u62a4\u8be5\u89d2\u8272\uff0c\u5e76\u4e14\u53ea\u5728\u4e34\u65f6\u63d0\u5347\u7279\u6743\u6a21\u5f0f/\u7d27\u6025\u60c5\u51b5\u4e0b\u4f7f\u7528\uff0c\u4f8b\u5982\u5f53\u96c6\u7fa4\u65e0\u6cd5\u8bbf\u95ee\u65f6\u3002\u8fd9\u5728\u6ca1\u6709\u76f4\u63a5\u7528\u6237\u8bbf\u95ee\u914d\u7f6e\u7684\u96c6\u7fa4\u4e2d\u7279\u522b\u6709\u7528\u3002</p>"},{"location":"zh/security/docs/iam/#_6","title":"\u5b9a\u671f\u5ba1\u6838\u5bf9\u96c6\u7fa4\u7684\u8bbf\u95ee\u6743\u9650","text":"<p>\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u9700\u8981\u8bbf\u95ee\u6743\u9650\u7684\u4eba\u5458\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\u3002\u8ba1\u5212\u5b9a\u671f\u5ba1\u6838 <code>aws-auth</code> ConfigMap\uff0c\u67e5\u770b\u8c01\u88ab\u6388\u4e88\u4e86\u8bbf\u95ee\u6743\u9650\u4ee5\u53ca\u4ed6\u4eec\u88ab\u5206\u914d\u4e86\u54ea\u4e9b\u6743\u9650\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5f00\u6e90\u5de5\u5177\uff0c\u5982 kubectl-who-can \u6216 rbac-lookup \u6765\u68c0\u67e5\u7ed1\u5b9a\u5230\u7279\u5b9a\u670d\u52a1\u8d26\u6237\u3001\u7528\u6237\u6216\u7ec4\u7684\u89d2\u8272\u3002\u6211\u4eec\u5c06\u5728 \u5ba1\u8ba1 \u4e00\u8282\u4e2d\u8fdb\u4e00\u6b65\u63a2\u8ba8\u8fd9\u4e2a\u4e3b\u9898\u3002\u53ef\u4ee5\u5728 NCC \u96c6\u56e2\u7684\u8fd9\u7bc7\u6587\u7ae0 \u4e2d\u627e\u5230\u66f4\u591a\u60f3\u6cd5\u3002</p>"},{"location":"zh/security/docs/iam/#aws-auth-configmap_1","title":"\u5982\u679c\u4f9d\u8d56 <code>aws-auth</code> configMap\uff0c\u8bf7\u4f7f\u7528\u5de5\u5177\u5bf9\u5176\u8fdb\u884c\u66f4\u6539","text":"<p>\u683c\u5f0f\u9519\u8bef\u7684 aws-auth ConfigMap \u53ef\u80fd\u4f1a\u5bfc\u81f4\u60a8\u65e0\u6cd5\u8bbf\u95ee\u96c6\u7fa4\u3002\u5982\u679c\u60a8\u9700\u8981\u5bf9 ConfigMap \u8fdb\u884c\u66f4\u6539\uff0c\u8bf7\u4f7f\u7528\u5de5\u5177\u3002</p> <p>eksctl <code>eksctl</code> CLI \u5305\u62ec\u4e00\u4e2a\u7528\u4e8e\u5c06\u8eab\u4efd\u6620\u5c04\u6dfb\u52a0\u5230 aws-auth ConfigMap \u7684\u547d\u4ee4\u3002</p> <p>\u67e5\u770b CLI \u5e2e\u52a9\uff1a</p> <pre><code>$ eksctl create iamidentitymapping --help\n...\n</code></pre> <p>\u68c0\u67e5\u6620\u5c04\u5230\u60a8\u7684 Amazon EKS \u96c6\u7fa4\u7684\u8eab\u4efd\u3002</p> <pre><code>$ eksctl get iamidentitymapping --cluster $CLUSTER_NAME --region $AWS_REGION\nARN                                                                   USERNAME                        GROUPS                                                  ACCOUNT\narn:aws:iam::788355785855:role/kube-system-&lt;SELF_GENERATED_UUID&gt;      system:node:{{SessionName}}     system:bootstrappers,system:nodes,system:node-proxier  \n</code></pre> <p>\u4f7f IAM \u89d2\u8272\u6210\u4e3a\u96c6\u7fa4\u7ba1\u7406\u5458\uff1a</p> <pre><code>$ eksctl create iamidentitymapping --cluster  &lt;CLUSTER_NAME&gt; --region=&lt;region&gt; --arn arn:aws:iam::123456:role/testing --group system:masters --username admin\n...\n</code></pre> <p>\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b <code>eksctl</code> \u6587\u6863</p> <p>aws-auth by keikoproj</p> <p>keikoproj \u7684 <code>aws-auth</code> \u5305\u62ec CLI \u548c Go \u5e93\u3002</p> <p>\u4e0b\u8f7d\u5e76\u67e5\u770b CLI \u5e2e\u52a9\uff1a</p> <pre><code>$ go get github.com/keikoproj/aws-auth\n...\n$ aws-auth help\n...\n</code></pre> <p>\u6216\u8005\uff0c\u4f7f\u7528 krew \u63d2\u4ef6\u7ba1\u7406\u5668 \u4e3a kubectl \u5b89\u88c5 <code>aws-auth</code>\u3002</p> <pre><code>$ kubectl krew install aws-auth\n...\n$ kubectl aws-auth\n...\n</code></pre> <p>\u5728 GitHub \u4e0a\u67e5\u770b aws-auth \u6587\u6863\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\uff0c\u5305\u62ec Go \u5e93\u3002</p> <p>AWS IAM Authenticator CLI</p> <p><code>aws-iam-authenticator</code> \u9879\u76ee\u5305\u62ec\u4e00\u4e2a\u7528\u4e8e\u66f4\u65b0 ConfigMap \u7684 CLI\u3002</p> <p>\u5728 GitHub \u4e0a\u4e0b\u8f7d\u53d1\u884c\u7248\u3002</p> <p>\u4e3a IAM \u89d2\u8272\u6dfb\u52a0\u96c6\u7fa4\u6743\u9650\uff1a</p> <pre><code>$ ./aws-iam-authenticator add role --rolearn arn:aws:iam::185309785115:role/lil-dev-role-cluster --username lil-dev-user --groups system:masters --kubeconfig ~/.kube/config\n...\n</code></pre>"},{"location":"zh/security/docs/iam/#_7","title":"\u8eab\u4efd\u9a8c\u8bc1\u548c\u8bbf\u95ee\u7ba1\u7406\u7684\u66ff\u4ee3\u65b9\u6cd5","text":"<p>\u867d\u7136 IAM \u662f\u7528\u6237\u9700\u8981\u8bbf\u95ee EKS \u96c6\u7fa4\u65f6\u7684\u9996\u9009\u8eab\u4efd\u9a8c\u8bc1\u65b9\u5f0f\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4f7f\u7528 OIDC \u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f\uff08\u5982 GitHub\uff09\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u4ee3\u7406\u548c Kubernetes \u6a21\u62df\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002AWS Open Source \u535a\u5ba2\u4e0a\u53d1\u5e03\u4e86\u4e24\u79cd\u6b64\u7c7b\u89e3\u51b3\u65b9\u6848\u7684\u6587\u7ae0\uff1a</p> <ul> <li>\u4f7f\u7528 GitHub \u51ed\u636e\u5bf9 EKS \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1 Teleport</li> <li>\u4f7f\u7528 kube-oidc-proxy \u8de8\u591a\u4e2a EKS \u96c6\u7fa4\u5b9e\u73b0\u4e00\u81f4\u7684 OIDC \u8eab\u4efd\u9a8c\u8bc1</li> </ul> <p>Attention</p> <p>EKS \u539f\u751f\u652f\u6301\u65e0\u9700\u4f7f\u7528\u4ee3\u7406\u5373\u53ef\u8fdb\u884c OIDC \u8eab\u4efd\u9a8c\u8bc1\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u9605\u8bfb\u53d1\u5e03\u535a\u5ba2 \u4e3a Amazon EKS \u5f15\u5165 OIDC \u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f\u8eab\u4efd\u9a8c\u8bc1\u3002\u6709\u5173\u5982\u4f55\u4f7f\u7528\u6d41\u884c\u7684\u5f00\u6e90 OIDC \u63d0\u4f9b\u7a0b\u5e8f Dex\uff08\u5177\u6709\u5404\u79cd\u4e0d\u540c\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6cd5\u7684\u8fde\u63a5\u5668\uff09\u914d\u7f6e EKS \u7684\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605 \u4f7f\u7528 Dex \u548c dex-k8s-authenticator \u5bf9 Amazon EKS \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u5982\u535a\u5ba2\u6240\u8ff0\uff0c\u901a\u8fc7 OIDC \u63d0\u4f9b\u7a0b\u5e8f\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u7684\u7528\u6237\u540d/\u7ec4\u5c06\u51fa\u73b0\u5728 Kubernetes \u5ba1\u8ba1\u65e5\u5fd7\u4e2d\u3002</p> <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 AWS SSO \u5c06 AWS \u4e0e\u5916\u90e8\u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f\uff08\u5982 Azure AD\uff09\u8054\u5408\u3002\u5982\u679c\u60a8\u51b3\u5b9a\u4f7f\u7528\u5b83\uff0cAWS CLI v2.0 \u5305\u62ec\u4e00\u4e2a\u9009\u9879\uff0c\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u914d\u7f6e\u6587\u4ef6\uff0c\u4ece\u800c\u8f7b\u677e\u5730\u5c06 SSO \u4f1a\u8bdd\u4e0e\u5f53\u524d CLI \u4f1a\u8bdd\u5173\u8054\u5e76\u627f\u62c5 IAM \u89d2\u8272\u3002\u8bf7\u6ce8\u610f\uff0c\u60a8\u5fc5\u987b\u5728\u8fd0\u884c <code>kubectl</code> \u4e4b\u524d\u627f\u62c5\u4e00\u4e2a\u89d2\u8272\uff0c\u56e0\u4e3a IAM \u89d2\u8272\u7528\u4e8e\u786e\u5b9a\u7528\u6237\u7684 Kubernetes RBAC \u7ec4\u3002</p>"},{"location":"zh/security/docs/iam/#eks-pod","title":"EKS pod \u7684\u8eab\u4efd\u548c\u51ed\u8bc1","text":"<p>\u67d0\u4e9b\u5728 Kubernetes \u96c6\u7fa4\u5185\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u6743\u9650\u6765\u8c03\u7528 Kubernetes API \u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002\u4f8b\u5982\uff0cAWS Load Balancer Controller \u9700\u8981\u80fd\u591f\u5217\u51fa\u670d\u52a1\u7684\u7aef\u70b9\u3002\u63a7\u5236\u5668\u8fd8\u9700\u8981\u80fd\u591f\u8c03\u7528 AWS API \u6765\u914d\u7f6e\u548c\u914d\u7f6e ALB\u3002\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c06\u63a2\u8ba8\u4e3a Pod \u5206\u914d\u6743\u9650\u548c\u7279\u6743\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"zh/security/docs/iam/#kubernetes","title":"Kubernetes \u670d\u52a1\u8d26\u6237","text":"<p>\u670d\u52a1\u8d26\u6237\u662f\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5141\u8bb8\u60a8\u5c06 Kubernetes RBAC \u89d2\u8272\u5206\u914d\u7ed9 pod\u3002\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u90fd\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u670d\u52a1\u8d26\u6237\u3002\u5f53\u60a8\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u90e8\u7f72 pod \u800c\u4e0d\u5f15\u7528\u7279\u5b9a\u670d\u52a1\u8d26\u6237\u65f6\uff0c\u8be5\u547d\u540d\u7a7a\u95f4\u7684\u9ed8\u8ba4\u670d\u52a1\u8d26\u6237\u5c06\u81ea\u52a8\u5206\u914d\u7ed9 Pod\uff0c\u5e76\u4e14\u8be5\u670d\u52a1\u8d26\u6237\uff08JWT\uff09\u4ee4\u724c\u7684 Secret \u5c06\u4f5c\u4e3a\u5377\u6302\u8f7d\u5230 pod \u7684 <code>/var/run/secrets/kubernetes.io/serviceaccount</code> \u76ee\u5f55\u4e0b\u3002\u89e3\u7801\u8be5\u76ee\u5f55\u4e2d\u7684\u670d\u52a1\u8d26\u6237\u4ee4\u724c\u5c06\u663e\u793a\u4ee5\u4e0b\u5143\u6570\u636e\uff1a</p> <pre><code>{\n  \"iss\": \"kubernetes/serviceaccount\",\n  \"kubernetes.io/serviceaccount/namespace\": \"default\",\n  \"kubernetes.io/serviceaccount/secret.name\": \"default-token-5pv4z\",\n  \"kubernetes.io/serviceaccount/service-account.name\": \"default\",\n  \"kubernetes.io/serviceaccount/service-account.uid\": \"3b36ddb5-438c-11ea-9438-063a49b60fba\",\n  \"sub\": \"system:serviceaccount:default:default\"\n}\n</code></pre> <p>\u9ed8\u8ba4\u670d\u52a1\u8d26\u6237\u5bf9 Kubernetes API \u5177\u6709\u4ee5\u4e0b\u6743\u9650\u3002</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  creationTimestamp: \"2020-01-30T18:13:25Z\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:discovery\n  resourceVersion: \"43\"\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/system%3Adiscovery\n  uid: 350d2ab8-438c-11ea-9438-063a49b60fba\nrules:\n- nonResourceURLs:\n  - /api\n  - /api/*\n  - /apis\n  - /apis/*\n  - /healthz\n  - /openapi\n  - /openapi/*\n  - /version\n  - /version/\n  verbs:\n  - get\n</code></pre> <p>\u6b64\u89d2\u8272\u6388\u6743\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u548c\u5df2\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u8bfb\u53d6 API \u4fe1\u606f\uff0c\u5e76\u88ab\u89c6\u4e3a\u53ef\u516c\u5f00\u8bbf\u95ee\u3002</p> <p>\u5f53 Pod \u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528 Kubernetes API \u65f6\uff0c\u9700\u8981\u4e3a\u8be5 Pod \u5206\u914d\u4e00\u4e2a\u660e\u786e\u6388\u4e88\u5b83\u8c03\u7528\u8fd9\u4e9b API \u7684\u6743\u9650\u7684\u670d\u52a1\u8d26\u6237\u3002\u4e0e\u7528\u6237\u8bbf\u95ee\u6743\u9650\u7684\u6307\u5bfc\u539f\u5219\u7c7b\u4f3c\uff0c\u7ed1\u5b9a\u5230\u670d\u52a1\u8d26\u6237\u7684\u89d2\u8272\u6216\u96c6\u7fa4\u89d2\u8272\u5e94\u8be5\u4ec5\u9650\u4e8e\u5e94\u7528\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u6240\u9700\u7684 API \u8d44\u6e90\u548c\u65b9\u6cd5\u3002\u8981\u4f7f\u7528\u975e\u9ed8\u8ba4\u670d\u52a1\u8d26\u6237\uff0c\u53ea\u9700\u5c06 Pod \u7684 <code>spec.serviceAccountName</code> \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u60a8\u5e0c\u671b\u4f7f\u7528\u7684\u670d\u52a1\u8d26\u6237\u7684\u540d\u79f0\u5373\u53ef\u3002\u6709\u5173\u521b\u5efa\u670d\u52a1\u8d26\u6237\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://kubernetes.io/docs/reference/access-authn-authz/rbac/#service-account-permissions\u3002</p> <p>Note</p> <p>\u5728 Kubernetes 1.24 \u4e4b\u524d\uff0cKubernetes \u4f1a\u81ea\u52a8\u4e3a\u6bcf\u4e2a\u670d\u52a1\u8d26\u6237\u521b\u5efa\u4e00\u4e2a secret\u3002\u8be5 secret \u5c06\u6302\u8f7d\u5230 pod \u7684 /var/run/secrets/kubernetes.io/serviceaccount \u76ee\u5f55\u4e0b\uff0cpod \u5c06\u4f7f\u7528\u5b83\u5bf9 Kubernetes API \u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u5728 Kubernetes 1.24 \u4e2d\uff0c\u5f53 pod \u8fd0\u884c\u65f6\uff0c\u5c06\u52a8\u6001\u751f\u6210\u670d\u52a1\u8d26\u6237\u4ee4\u724c\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8be5\u4ee4\u724c\u4ec5\u6709\u6548\u4e00\u5c0f\u65f6\u3002\u4e0d\u4f1a\u4e3a\u670d\u52a1\u8d26\u6237\u521b\u5efa secret\u3002\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u9700\u8981\u5bf9 Kubernetes API \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u96c6\u7fa4\u5916\u90e8\uff08\u4f8b\u5982 Jenkins\uff09\uff0c\u60a8\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>kubernetes.io/service-account-token</code> \u7684 secret\uff0c\u4ee5\u53ca\u4e00\u4e2a\u5f15\u7528\u670d\u52a1\u8d26\u6237\u7684\u6ce8\u91ca\uff0c\u5982 <code>metadata.annotations.kubernetes.io/service-account.name: &lt;SERVICE_ACCOUNT_NAME&gt;</code>\u3002\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u521b\u5efa\u7684 secret \u4e0d\u4f1a\u8fc7\u671f\u3002</p>"},{"location":"zh/security/docs/iam/#iam-irsa","title":"\u670d\u52a1\u8d26\u6237\u7684 IAM \u89d2\u8272 (IRSA)","text":"<p>IRSA \u662f\u4e00\u9879\u529f\u80fd\uff0c\u5141\u8bb8\u60a8\u5c06 IAM \u89d2\u8272\u5206\u914d\u7ed9 Kubernetes \u670d\u52a1\u8d26\u6237\u3002\u5b83\u5229\u7528\u4e86 Kubernetes \u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u79f0\u4e3a \u670d\u52a1\u8d26\u6237\u4ee4\u724c\u5377\u6295\u5f71\u3002\u5f53 Pod \u914d\u7f6e\u4e86\u5f15\u7528 IAM \u89d2\u8272\u7684\u670d\u52a1\u8d26\u6237\u65f6\uff0cKubernetes API \u670d\u52a1\u5668\u5c06\u5728\u542f\u52a8\u65f6\u8c03\u7528\u96c6\u7fa4\u7684\u516c\u5171 OIDC \u53d1\u73b0\u7aef\u70b9\u3002\u8be5\u7aef\u70b9\u4ee5\u52a0\u5bc6\u65b9\u5f0f\u7b7e\u540d Kubernetes \u53d1\u51fa\u7684 OIDC \u4ee4\u724c\uff0c\u5e76\u5c06\u751f\u6210\u7684\u4ee4\u724c\u4f5c\u4e3a\u5377\u6302\u8f7d\u3002\u6b64\u7b7e\u540d\u4ee4\u724c\u5141\u8bb8 Pod \u8c03\u7528\u4e0e IAM \u89d2\u8272\u5173\u8054\u7684 AWS API\u3002\u5f53\u8c03\u7528 AWS API \u65f6\uff0cAWS SDK \u5c06\u8c03\u7528 <code>sts:AssumeRoleWithWebIdentity</code>\u3002\u5728\u9a8c\u8bc1\u4ee4\u724c\u7b7e\u540d\u540e\uff0cIAM \u5c06 Kubernetes \u53d1\u51fa\u7684\u4ee4\u724c\u4e0e\u4e34\u65f6 AWS \u89d2\u8272\u51ed\u8bc1\u8fdb\u884c\u4ea4\u6362\u3002</p> <p>\u4f7f\u7528 IRSA \u65f6\uff0c\u91cd\u8981\u7684\u662f\u91cd\u7528 AWS SDK \u4f1a\u8bdd\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u8c03\u7528 AWS STS\u3002</p> <p>\u89e3\u7801 IRSA \u7684\uff08JWT\uff09\u4ee4\u724c\u5c06\u4ea7\u751f\u7c7b\u4f3c\u4e8e\u4e0b\u9762\u793a\u4f8b\u7684\u8f93\u51fa\uff1a</p> <pre><code>{\n  \"aud\": [\n    \"sts.amazonaws.com\"\n  ],\n  \"exp\": 1582306514,\n  \"iat\": 1582220114,\n  \"iss\": \"https://oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128\",\n  \"kubernetes.io\": {\n    \"namespace\": \"default\",\n    \"pod\": {\n      \"name\": \"alpine-57b5664646-rf966\",\n      \"uid\": \"5a20f883-5407-11ea-a85c-0e62b7a4a436\"\n    },\n    \"serviceaccount\": {\n      \"name\": \"s3-read-only\",\n      \"uid\": \"a720ba5c-5406-11ea-9438-063a49b60fba\"\n    }\n  },\n  \"nbf\": 1582220114,\n  \"sub\": \"system:serviceaccount:default:s3-read-only\"\n}\n</code></pre> <p>\u6b64\u7279\u5b9a\u4ee4\u724c\u6388\u4e88 Pod \u5bf9 S3 \u7684\u53ea\u8bfb\u6743\u9650\uff0c\u65b9\u5f0f\u662f\u627f\u62c5\u4e00\u4e2a IAM \u89d2\u8272\u3002\u5f53\u5e94\u7528\u7a0b\u5e8f\u5c1d\u8bd5\u4ece S3 \u8bfb\u53d6\u65f6\uff0c\u4ee4\u724c\u5c06\u88ab\u4ea4\u6362\u4e3a\u4e00\u7ec4\u4e34\u65f6 IAM \u51ed\u8bc1\uff0c\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a</p> <pre><code>{\n    \"AssumedRoleUser\": {\n        \"AssumedRoleId\": \"AROA36C6WWEJULFUYMPB6:abc\",\n        \"Arn\": \"arn:aws:sts::123456789012:assumed-role/eksctl-winterfell-addon-iamserviceaccount-de-Role1-1D61LT75JH3MB/abc\"\n    },\n    \"Audience\": \"sts.amazonaws.com\",\n    \"Provider\": \"arn:aws:iam::123456789012:oidc-provider/oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128\",\n    \"SubjectFromWebIdentityToken\": \"system:serviceaccount:default:s3-read-only\",\n    \"Credentials\": {\n        \"SecretAccessKey\": \"ORJ+8Adk+wW+nU8FETq7+mOqeA8Z6jlPihnV8hX1\",\n        \"SessionToken\": \"FwoGZXIvYXdzEGMaDMLxAZkuLpmSwYXShiL9A1S0X87VBC1mHCrRe/pB2oes+l1eXxUYnPJyC9ayOoXMvqXQsomq0xs6OqZ3vaa5Iw1HIyA4Cv1suLaOCoU3hNvOIJ6C94H1vU0siQYk7DIq9Av5RZe+uE2FnOctNBvYLd3i0IZo1ajjc00yRK3v24VRq9nQpoPLuqyH2jzlhCEjXuPScPbi5KEVs9fNcOTtgzbVf7IG2gNiwNs5aCpN4Bv/Zv2A6zp5xGz9cWj2f0aD9v66vX4bexOs5t/YYhwuwAvkkJPSIGvxja0xRThnceHyFHKtj0H+bi/PWAtlI8YJcDX69cM30JAHDdQH+ltm/4scFptW1hlvMaP+WReCAaCrsHrAT+yka7ttw5YlUyvZ8EPog+j6fwHlxmrXM9h1BqdikomyJU00gm1++FJelfP+1zAwcyrxCnbRl3ARFrAt8hIlrT6Vyu8WvWtLxcI8KcLcJQb/LgkW+sCTGlYcY8z3zkigJMbYn07ewTL5Ss7LazTJJa758I7PZan/v3xQHd5DEc5WBneiV3iOznDFgup0VAMkIviVjVCkszaPSVEdK2NU7jtrh6Jfm7bU/3P6ZG+CkyDLIa8MBn9KPXeJd/y+jTk5Ii+fIwO/+mDpGNUribg6TPxhzZ8b/XdZO1kS1gVgqjXyVC+M+BRBh6C4H21w/eMzjCtDIpoxt5rGKL6Nu/IFMipoC4fgx6LIIHwtGYMG7SWQi7OsMAkiwZRg0n68/RqWgLzBt/4pfjSRYuk=\",\n        \"Expiration\": \"2020-02-20T18:49:50Z\",\n        \"AccessKeyId\": \"XXXX36C6WWEJUMHA3L7Z\"\n    }\n}\n</code></pre> <p>EKS \u63a7\u5236\u5e73\u9762\u4f5c\u4e3a\u4e00\u90e8\u5206\u8fd0\u884c\u7684\u4e00\u4e2a\u53d8\u5f02 webhook \u5c06 AWS \u89d2\u8272 ARN \u548c\u6307\u5411 Web \u8eab\u4efd\u4ee4\u724c\u6587\u4ef6\u7684\u8def\u5f84\u6ce8\u5165\u5230 Pod \u4e2d\u4f5c\u4e3a\u73af\u5883\u53d8\u91cf\u3002\u8fd9\u4e9b\u503c\u4e5f\u53ef\u4ee5\u624b\u52a8\u63d0\u4f9b\u3002</p> <pre><code>AWS_ROLE_ARN=arn:aws:iam::AWS_ACCOUNT_ID:role/IAM_ROLE_NAME\nAWS_WEB_IDENTITY_TOKEN_FILE=/var/run/secrets/eks.amazonaws.com/serviceaccount/token\n</code></pre> <p>kubelet \u5c06\u5728\u4ee4\u724c\u7684\u751f\u5b58\u65f6\u95f4\u8d85\u8fc7 80% \u6216 24 \u5c0f\u65f6\u540e\u81ea\u52a8\u8f6e\u6362\u6295\u5f71\u7684\u4ee4\u724c\u3002AWS SDK \u8d1f\u8d23\u5728\u4ee4\u724c\u8f6e\u6362\u65f6\u91cd\u65b0\u52a0\u8f7d\u4ee4\u724c\u3002\u6709\u5173 IRSA \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-technical-overview.html\u3002</p>"},{"location":"zh/security/docs/iam/#eks-pod_1","title":"EKS Pod \u8eab\u4efd","text":"<p>EKS Pod \u8eab\u4efd\u662f\u5728 2023 \u5e74 re\uff1aInvent \u4e0a\u63a8\u51fa\u7684\u4e00\u9879\u529f\u80fd\uff0c\u5141\u8bb8\u60a8\u5c06 IAM \u89d2\u8272\u5206\u914d\u7ed9 kubernetes \u670d\u52a1\u8d26\u6237\uff0c\u800c\u65e0\u9700\u4e3a\u60a8\u7684 AWS \u8d26\u6237\u4e2d\u7684\u6bcf\u4e2a\u96c6\u7fa4\u914d\u7f6e\u5f00\u653e ID \u8fde\u63a5 (OIDC) \u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f (IDP)\u3002\u8981\u4f7f\u7528 EKS Pod \u8eab\u4efd\uff0c\u60a8\u5fc5\u987b\u90e8\u7f72\u4e00\u4e2a\u4f5c\u4e3a DaemonSet pod \u5728\u6bcf\u4e2a\u5408\u683c\u7684\u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u4ee3\u7406\u3002\u6b64\u4ee3\u7406\u4f5c\u4e3a EKS \u9644\u52a0\u7ec4\u4ef6\u63d0\u4f9b\u7ed9\u60a8\uff0c\u662f\u4f7f\u7528 EKS Pod \u8eab\u4efd\u529f\u80fd\u7684\u5148\u51b3\u6761\u4ef6\u3002\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u4f7f\u7528\u652f\u6301\u7684 AWS SDK \u7248\u672c\u624d\u80fd\u4f7f\u7528\u6b64\u529f\u80fd\u3002</p> <p>\u5f53\u4e3a Pod \u914d\u7f6e\u4e86 EKS Pod \u8eab\u4efd\u65f6\uff0cEKS \u5c06\u5728 <code>/var/run/secrets/pods.eks.amazonaws.com/serviceaccount/eks-pod-identity-token</code> \u5904\u6302\u8f7d\u548c\u5237\u65b0 pod \u8eab\u4efd\u4ee4\u724c\u3002AWS SDK \u5c06\u4f7f\u7528\u6b64\u4ee4\u724c\u4e0e EKS Pod \u8eab\u4efd\u4ee3\u7406\u901a\u4fe1\uff0c\u4ee3\u7406\u5c06\u4f7f\u7528 pod \u8eab\u4efd\u4ee4\u724c\u548c\u4ee3\u7406\u7684 IAM \u89d2\u8272\u901a\u8fc7\u8c03\u7528 AssumeRoleForPodIdentity API \u4e3a\u60a8\u7684 pod \u521b\u5efa\u4e34\u65f6\u51ed\u8bc1\u3002\u4f20\u9012\u7ed9\u60a8\u7684 pod \u7684 pod \u8eab\u4efd\u4ee4\u724c\u662f\u4ece\u60a8\u7684 EKS \u96c6\u7fa4\u53d1\u51fa\u5e76\u7ecf\u8fc7\u52a0\u5bc6\u7b7e\u540d\u7684 JWT\uff0c\u5176\u4e2d\u5305\u542b\u9002\u7528\u4e8e EKS Pod \u8eab\u4efd\u7684\u9002\u5f53 JWT \u58f0\u660e\u3002</p> <p>\u8981\u4e86\u89e3\u6709\u5173 EKS Pod \u8eab\u4efd\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6b64\u535a\u5ba2\u3002</p> <p>\u60a8\u65e0\u9700\u5bf9\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u884c\u4efb\u4f55\u4fee\u6539\u5373\u53ef\u4f7f\u7528 EKS Pod \u8eab\u4efd\u3002\u652f\u6301\u7684 AWS SDK \u7248\u672c\u5c06\u81ea\u52a8\u4f7f\u7528\u51ed\u8bc1\u63d0\u4f9b\u7a0b\u5e8f\u94fe\u53d1\u73b0\u901a\u8fc7 EKS Pod \u8eab\u4efd\u63d0\u4f9b\u7684\u51ed\u8bc1\u3002\u4e0e IRSA \u4e00\u6837\uff0cEKS pod \u8eab\u4efd\u5728\u60a8\u7684 pod \u4e2d\u8bbe\u7f6e\u53d8\u91cf\uff0c\u4ee5\u6307\u5bfc\u5b83\u4eec\u5982\u4f55\u627e\u5230 AWS \u51ed\u8bc1\u3002</p>"},{"location":"zh/security/docs/iam/#eks-pod-iam","title":"\u4f7f\u7528 EKS Pod \u8eab\u4efd\u7684 IAM \u89d2\u8272","text":"<ul> <li>EKS Pod \u8eab\u4efd\u53ea\u80fd\u76f4\u63a5\u627f\u62c5\u5c5e\u4e8e\u4e0e EKS \u96c6\u7fa4\u76f8\u540c AWS \u8d26\u6237\u7684 IAM \u89d2\u8272\u3002\u8981\u8bbf\u95ee\u53e6\u4e00\u4e2a AWS \u8d26\u6237\u4e2d\u7684 IAM \u89d2\u8272\uff0c\u60a8\u5fc5\u987b\u901a\u8fc7\u5728\u60a8\u7684 SDK \u914d\u7f6e\u4e2d\u914d\u7f6e\u914d\u7f6e\u6587\u4ef6\u6216\u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u627f\u62c5\u8be5\u89d2\u8272\u3002</li> <li>\u5728\u4e3a\u670d\u52a1\u8d26\u6237\u914d\u7f6e EKS Pod \u8eab\u4efd\u65f6\uff0c\u914d\u7f6e Pod \u8eab\u4efd\u5173\u8054\u7684\u4eba\u5458\u6216\u6d41\u7a0b\u5fc5\u987b\u5177\u6709\u5bf9\u8be5\u89d2\u8272\u7684 <code>iam:PassRole</code> \u6743\u9650\u3002</li> <li>\u6bcf\u4e2a\u670d\u52a1\u8d26\u6237\u53ea\u80fd\u901a\u8fc7 EKS Pod \u8eab\u4efd\u4e0e\u4e00\u4e2a IAM \u89d2\u8272\u5173\u8054\uff0c\u4f46\u60a8\u53ef\u4ee5\u5c06\u540c\u4e00 IAM \u89d2\u8272\u4e0e\u591a\u4e2a\u670d\u52a1\u8d26\u6237\u5173\u8054\u3002</li> <li>\u4e0e EKS Pod \u8eab\u4efd\u4e00\u8d77\u4f7f\u7528\u7684 IAM \u89d2\u8272\u5fc5\u987b\u5141\u8bb8 <code>pods.eks.amazonaws.com</code> \u670d\u52a1\u4e3b\u4f53\u627f\u62c5\u5b83\u4eec\uff0c_\u5e76_\u8bbe\u7f6e\u4f1a\u8bdd\u6807\u7b7e\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5141\u8bb8 EKS Pod \u8eab\u4efd\u4f7f\u7528 IAM \u89d2\u8272\u7684\u89d2\u8272\u4fe1\u4efb\u7b56\u7565\u793a\u4f8b\uff1a</li> </ul> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"pods.eks.amazonaws.com\"\n      },\n      \"Action\": [\n        \"sts:AssumeRole\",\n        \"sts:TagSession\"\n      ],\n      \"Condition\": {\n        \"StringEquals\": {\n          \"aws:SourceOrgId\": \"${aws:ResourceOrgId}\"\n        }\n      }\n    }\n  ]\n}\n</code></pre> <p>AWS \u5efa\u8bae\u4f7f\u7528\u6761\u4ef6\u952e\uff08\u5982 <code>aws:SourceOrgId</code>\uff09\u6765\u5e2e\u52a9\u9632\u6b62\u8de8\u670d\u52a1\u6df7\u6dc6\u4ee3\u7406\u95ee\u9898\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u89d2\u8272\u4fe1\u4efb\u7b56\u7565\u4e2d\uff0c<code>ResourceOrgId</code> \u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u7b49\u4e8e AWS \u8d26\u6237\u6240\u5c5e\u7684 AWS Organizations \u7ec4\u7ec7\u7684\u7ec4\u7ec7 ID\u3002EKS \u5728\u4f7f\u7528 EKS Pod \u8eab\u4efd\u627f\u62c5\u89d2\u8272\u65f6\uff0c\u5c06\u4e3a <code>aws:SourceOrgId</code> \u4f20\u9012\u4e00\u4e2a\u7b49\u4e8e\u8be5\u503c\u7684\u503c\u3002</p>"},{"location":"zh/security/docs/iam/#abac-eks-pod","title":"ABAC \u548c EKS Pod \u8eab\u4efd","text":"<p>\u5f53 EKS Pod \u8eab\u4efd\u627f\u62c5 IAM \u89d2\u8272\u65f6\uff0c\u5b83\u4f1a\u8bbe\u7f6e\u4ee5\u4e0b\u4f1a\u8bdd\u6807\u7b7e\uff1a</p> EKS Pod \u8eab\u4efd\u4f1a\u8bdd\u6807\u7b7e \u503c kubernetes-namespace \u4e0e EKS Pod \u8eab\u4efd\u5173\u8054\u7684 pod \u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u3002 kubernetes-service-account \u4e0e EKS Pod \u8eab\u4efd\u5173\u8054\u7684 kubernetes \u670d\u52a1\u8d26\u6237\u7684\u540d\u79f0 eks-cluster-arn EKS \u96c6\u7fa4\u7684 ARN\uff0c\u4f8b\u5982 <code>arn:${Partition}:eks:${Region}:${Account}:cluster/${ClusterName}</code>\u3002\u96c6\u7fa4 ARN \u662f\u552f\u4e00\u7684\uff0c\u4f46\u5982\u679c\u5728\u540c\u4e00\u533a\u57df\u3001\u540c\u4e00 AWS \u8d26\u6237\u4e2d\u5220\u9664\u5e76\u91cd\u65b0\u521b\u5efa\u5177\u6709\u76f8\u540c\u540d\u79f0\u7684\u96c6\u7fa4\uff0c\u5b83\u5c06\u5177\u6709\u76f8\u540c\u7684 ARN\u3002 eks-cluster-name EKS \u96c6\u7fa4\u7684\u540d\u79f0\u3002\u8bf7\u6ce8\u610f\uff0c\u60a8\u7684 AWS \u8d26\u6237\u4e2d\u7684 EKS \u96c6\u7fa4\u540d\u79f0\u53ef\u80fd\u76f8\u540c\uff0c\u5176\u4ed6 AWS \u8d26\u6237\u4e2d\u7684 EKS \u96c6\u7fa4\u4e5f\u53ef\u80fd\u76f8\u540c\u3002 kubernetes-pod-name EKS \u4e2d pod \u7684\u540d\u79f0\u3002 kubernetes-pod-uid EKS \u4e2d pod \u7684 UID\u3002 <p>\u8fd9\u4e9b\u4f1a\u8bdd\u6807\u7b7e\u5141\u8bb8\u60a8\u4f7f\u7528\u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236 (ABAC) \u4ec5\u5411\u7279\u5b9a\u7684 kubernetes \u670d\u52a1\u8d26\u6237\u6388\u4e88\u5bf9\u60a8\u7684 AWS \u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u3002\u8fd9\u6837\u505a\u65f6\uff0c_\u975e\u5e38\u91cd\u8981\u7684\u662f_\u8981\u7406\u89e3 kubernetes \u670d\u52a1\u8d26\u6237\u53ea\u5728\u547d\u540d\u7a7a\u95f4\u5185\u662f\u552f\u4e00\u7684\uff0ckubernetes \u547d\u540d\u7a7a\u95f4\u53ea\u5728 EKS \u96c6\u7fa4\u5185\u662f\u552f\u4e00\u7684\u3002\u53ef\u4ee5\u4f7f\u7528 <code>aws:PrincipalTag/&lt;tag-key&gt;</code> \u5168\u5c40\u6761\u4ef6\u952e\uff08\u5982 <code>aws:PrincipalTag/eks-cluster-arn</code>\uff09\u5728 AWS \u7b56\u7565\u4e2d\u8bbf\u95ee\u8fd9\u4e9b\u4f1a\u8bdd\u6807\u7b7e\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u4ec5\u5411\u7279\u5b9a\u670d\u52a1\u8d26\u6237\u6388\u4e88\u8bbf\u95ee\u60a8\u8d26\u6237\u4e2d AWS \u8d44\u6e90\u7684\u6743\u9650\uff0c\u60a8\u9700\u8981\u4f7f\u7528 IAM \u6216\u8d44\u6e90\u7b56\u7565\u68c0\u67e5 <code>eks-cluster-arn</code> \u548c <code>kubernetes-namespace</code> \u6807\u7b7e\u4ee5\u53ca <code>kubernetes-service-account</code>\uff0c\u4ee5\u786e\u4fdd\u53ea\u6709\u6765\u81ea\u9884\u671f\u96c6\u7fa4\u7684\u8be5\u670d\u52a1\u8d26\u6237\u624d\u80fd\u8bbf\u95ee\u8be5\u8d44\u6e90\uff0c\u56e0\u4e3a\u5176\u4ed6\u96c6\u7fa4\u53ef\u80fd\u5177\u6709\u76f8\u540c\u7684 <code>kubernetes-service-accounts</code> \u548c <code>kubernetes-namespaces</code>\u3002</p> <p>\u6b64\u793a\u4f8b S3 \u5b58\u50a8\u6876\u7b56\u7565\u4ec5\u5728 <code>kubernetes-service-account</code>\u3001<code>kubernetes-namespace</code> \u548c <code>eks-cluster-arn</code> \u90fd\u6ee1\u8db3\u5176\u9884\u671f\u503c\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u5141\u8bb8\u5bf9\u8be5\u5b58\u50a8\u6876\u4e2d\u7684\u5bf9\u8c61\u8fdb\u884c\u8bbf\u95ee\uff0c\u5176\u4e2d EKS \u96c6\u7fa4\u6258\u7ba1\u5728 AWS \u8d26\u6237 <code>111122223333</code> \u4e2d\u3002</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:aws:iam::111122223333:root\"\n            },\n            \"Action\": \"s3:*\",\n            \"Resource\":            [\n                \"arn:aws:s3:::ExampleBucket/*\"\n            ],\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalTag/kubernetes-service-account\": \"s3objectservice\",\n                    \"aws:PrincipalTag/eks-cluster-arn\": \"arn:aws:eks:us-west-2:111122223333:cluster/ProductionCluster\",\n                    \"aws:PrincipalTag/kubernetes-namespace\": \"s3datanamespace\"\n                }\n            }\n        }\n    ]\n}\n</code></pre>"},{"location":"zh/security/docs/iam/#eks-pod-irsa","title":"EKS Pod \u8eab\u4efd\u4e0e IRSA \u7684\u6bd4\u8f83","text":"<p>EKS Pod \u8eab\u4efd\u548c IRSA \u90fd\u662f\u5411 EKS pod \u63d0\u4f9b\u4e34\u65f6 AWS \u51ed\u8bc1\u7684\u9996\u9009\u65b9\u5f0f\u3002\u9664\u975e\u60a8\u6709\u7279\u5b9a\u7684 IRSA \u7528\u4f8b\uff0c\u5426\u5219\u6211\u4eec\u5efa\u8bae\u60a8\u5728\u4f7f\u7528 EKS \u65f6\u4f7f\u7528 EKS Pod \u8eab\u4efd\u3002\u6b64\u8868\u6709\u52a9\u4e8e\u6bd4\u8f83\u8fd9\u4e24\u4e2a\u529f\u80fd\u3002</p> # EKS Pod \u8eab\u4efd IRSA \u9700\u8981\u5728\u60a8\u7684 AWS \u8d26\u6237\u4e2d\u521b\u5efa OIDC IDP \u7684\u6743\u9650\uff1f \u5426 \u662f \u9700\u8981\u4e3a\u6bcf\u4e2a\u96c6\u7fa4\u8bbe\u7f6e\u552f\u4e00\u7684 IDP\uff1f \u5426 \u662f \u8bbe\u7f6e\u76f8\u5173\u4f1a\u8bdd\u6807\u7b7e\u4ee5\u7528\u4e8e ABAC\uff1f \u662f \u5426 \u9700\u8981 iam\uff1aPassRole \u68c0\u67e5\uff1f \u662f \u5426 \u4f7f\u7528\u60a8\u7684 AWS \u8d26\u6237\u7684 AWS STS \u914d\u989d\uff1f \u5426 \u662f \u53ef\u4ee5\u8bbf\u95ee\u5176\u4ed6 AWS \u8d26\u6237\uff1f \u901a\u8fc7\u89d2\u8272\u94fe\u63a5\u95f4\u63a5\u8bbf\u95ee \u901a\u8fc7 sts\uff1aAssumeRoleWithWebIdentity \u76f4\u63a5\u8bbf\u95ee \u4e0e AWS SDK \u517c\u5bb9\uff1f \u662f \u662f \u9700\u8981\u5728\u8282\u70b9\u4e0a\u6709 Pod \u8eab\u4efd\u4ee3\u7406 Daemonset\uff1f \u662f \u5426"},{"location":"zh/security/docs/iam/#eks-pod_2","title":"EKS pod \u7684\u8eab\u4efd\u548c\u51ed\u8bc1\u5efa\u8bae","text":""},{"location":"zh/security/docs/iam/#aws-node-daemonset-irsa","title":"\u66f4\u65b0 aws-node daemonset \u4ee5\u4f7f\u7528 IRSA","text":"<p>\u76ee\u524d\uff0caws-node daemonset \u914d\u7f6e\u4e3a\u4f7f\u7528\u5206\u914d\u7ed9 EC2 \u5b9e\u4f8b\u7684\u89d2\u8272\u6765\u4e3a pod \u5206\u914d IP\u3002\u6b64\u89d2\u8272\u5305\u62ec\u51e0\u4e2a AWS \u6258\u7ba1\u7b56\u7565\uff0c\u4f8b\u5982 AmazonEKS_CNI_Policy \u548c EC2ContainerRegistryReadOnly\uff0c\u8fd9\u5b9e\u9645\u4e0a\u5141\u8bb8\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u6240\u6709pod \u9644\u52a0/\u5206\u79bb ENI\u3001\u5206\u914d/\u53d6\u6d88\u5206\u914d IP \u5730\u5740\u6216\u4ece ECR \u62c9\u53d6\u955c\u50cf\u3002\u7531\u4e8e\u8fd9\u4f1a\u7ed9\u60a8\u7684\u96c6\u7fa4\u5e26\u6765\u98ce\u9669\uff0c\u56e0\u6b64\u5efa\u8bae\u60a8\u66f4\u65b0 aws-node daemonset \u4ee5\u4f7f\u7528 IRSA\u3002\u53ef\u4ee5\u5728\u672c\u6307\u5357\u7684\u5b58\u50a8\u5e93\u4e2d\u627e\u5230\u6267\u884c\u6b64\u64cd\u4f5c\u7684\u811a\u672c\u3002</p> <p>aws-node daemonset \u76ee\u524d\u4e0d\u652f\u6301 EKS Pod \u8eab\u4efd\u3002</p>"},{"location":"zh/security/docs/iam/#_8","title":"\u9650\u5236\u5bf9\u5206\u914d\u7ed9\u5de5\u4f5c\u8282\u70b9\u7684\u5b9e\u4f8b\u914d\u7f6e\u6587\u4ef6\u7684\u8bbf\u95ee","text":"<p>\u5f53\u60a8\u4f7f\u7528 IRSA \u6216 EKS Pod \u8eab\u4efd\u65f6\uff0c\u5b83\u4f1a\u66f4\u65b0 pod \u7684\u51ed\u8bc1\u94fe\u4ee5\u9996\u5148\u4f7f\u7528 IRSA \u6216 EKS Pod \u8eab\u4efd\uff0c\u4f46\u662f\uff0cpod \u4ecd\u7136\u53ef\u4ee5\u7ee7\u627f\u5206\u914d\u7ed9\u5de5\u4f5c\u8282\u70b9\u7684\u5b9e\u4f8b\u914d\u7f6e\u6587\u4ef6\u7684\u6743\u9650\u3002\u4f7f\u7528 IRSA \u6216 EKS Pod \u8eab\u4efd\u65f6\uff0c\u5f3a\u70c8\u5efa\u8bae\u60a8\u963b\u6b62\u8bbf\u95ee\u5b9e\u4f8b\u5143\u6570\u636e\uff0c\u4ee5\u5e2e\u52a9\u786e\u4fdd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ea\u5177\u6709\u6240\u9700\u7684\u6743\u9650\uff0c\u800c\u4e0d\u662f\u5b83\u4eec\u7684\u8282\u70b9\u7684\u6743\u9650\u3002</p> <p>Caution</p> <p>\u963b\u6b62\u8bbf\u95ee\u5b9e\u4f8b\u5143\u6570\u636e\u5c06\u9632\u6b62\u4e0d\u4f7f\u7528 IRSA \u6216 EKS Pod \u8eab\u4efd\u7684 pod \u7ee7\u627f\u5206\u914d\u7ed9\u5de5\u4f5c\u8282\u70b9\u7684\u89d2\u8272\u3002</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u8981\u6c42\u5b9e\u4f8b\u4ec5\u4f7f\u7528 IMDSv2 \u5e76\u5c06\u8dc3\u70b9\u8ba1\u6570\u66f4\u65b0\u4e3a 1 \u6765\u963b\u6b62\u8bbf\u95ee\u5b9e\u4f8b\u5143\u6570\u636e\uff0c\u5982\u4e0b\u4f8b\u6240\u793a\u3002\u60a8\u4e5f\u53ef\u4ee5\u5728\u8282\u70b9\u7ec4\u7684\u542f\u52a8\u6a21\u677f\u4e2d\u5305\u542b\u8fd9\u4e9b\u8bbe\u7f6e\u3002\u4e0d\u8981\u7981\u7528\u5b9e\u4f8b\u5143\u6570\u636e\uff0c\u56e0\u4e3a\u8fd9\u5c06\u963b\u6b62\u4f9d\u8d56\u5b9e\u4f8b\u5143\u6570\u636e\u7684\u7ec4\u4ef6\uff08\u5982\u8282\u70b9\u7ec8\u6b62\u5904\u7406\u7a0b\u5e8f\u7b49\uff09\u6b63\u5e38\u5de5\u4f5c\u3002</p> <pre><code>$ aws ec2 modify-instance-metadata-options --instance-id &lt;value&gt; --http-tokens required --http-put-response-hop-limit 1\n...\n</code></pre> <p>\u5982\u679c\u60a8\u4f7f\u7528 Terraform \u521b\u5efa\u7528\u4e8e\u6258\u7ba1\u8282\u70b9\u7ec4\u7684\u542f\u52a8\u6a21\u677f\uff0c\u8bf7\u6dfb\u52a0\u5143\u6570\u636e\u5757\u4ee5\u914d\u7f6e\u8dc3\u70b9\u8ba1\u6570\uff0c\u5982\u6b64\u4ee3\u7801\u7247\u6bb5\u6240\u793a\uff1a</p> <pre><code>resource \"aws_launch_template\" \"foo\" {\n  name = \"foo\"\n  ...\n    metadata_options {\n    http_endpoint               = \"enabled\"\n    http_tokens                 = \"required\"\n    http_put_response_hop_limit = 1\n    instance_metadata_tags      = \"enabled\"\n  }\n  ...\n</code></pre> <p>\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u64cd\u4f5c\u8282\u70b9\u4e0a\u7684 iptables \u6765\u963b\u6b62 pod \u8bbf\u95ee EC2 \u5143\u6570\u636e\u3002\u6709\u5173\u6b64\u65b9\u6cd5\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u9650\u5236\u5bf9\u5b9e\u4f8b\u5143\u6570\u636e\u670d\u52a1\u7684\u8bbf\u95ee\u3002</p> <p>\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u4f7f\u7528\u8f83\u65e7\u7248\u672c\u7684\u4e0d\u652f\u6301 IRSA \u6216 EKS Pod \u8eab\u4efd\u7684 AWS SDK \u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u60a8\u5e94\u8be5\u66f4\u65b0 SDK \u7248\u672c\u3002</p>"},{"location":"zh/security/docs/iam/#irsa","title":"\u5c06 IRSA \u89d2\u8272\u7684\u4fe1\u4efb\u7b56\u7565\u7684\u8303\u56f4\u7f29\u5c0f\u5230\u670d\u52a1\u8d26\u6237\u540d\u79f0\u3001\u547d\u540d\u7a7a\u95f4\u548c\u96c6\u7fa4","text":"<p>\u4fe1\u4efb\u7b56\u7565\u53ef\u4ee5\u9650\u5b9a\u4e3a\u547d\u540d\u7a7a\u95f4\u6216\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u7279\u5b9a\u670d\u52a1\u8d26\u6237\u3002\u4f7f\u7528 IRSA \u65f6\uff0c\u6700\u597d\u5c3d\u53ef\u80fd\u660e\u786e\u5730\u5236\u5b9a\u89d2\u8272\u4fe1\u4efb\u7b56\u7565\uff0c\u5305\u62ec\u670d\u52a1\u8d26\u6237\u540d\u79f0\u3002\u8fd9\u5c06\u6709\u6548\u9632\u6b62\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u5176\u4ed6 Pod \u627f\u62c5\u8be5\u89d2\u8272\u3002CLI <code>eksctl</code> \u5728\u60a8\u4f7f\u7528\u5b83\u521b\u5efa\u670d\u52a1\u8d26\u6237/IAM \u89d2\u8272\u65f6\u4f1a\u81ea\u52a8\u6267\u884c\u6b64\u64cd\u4f5c\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://eksctl.io/usage/iamserviceaccounts/\u3002</p> <p>\u76f4\u63a5\u4f7f\u7528 IAM \u65f6\uff0c\u8fd9\u662f\u5728\u89d2\u8272\u7684\u4fe1\u4efb\u7b56\u7565\u4e2d\u6dfb\u52a0\u6761\u4ef6\uff0c\u4f7f\u7528\u6761\u4ef6\u6765\u786e\u4fdd <code>:sub</code> \u58f0\u660e\u662f\u60a8\u671f\u671b\u7684\u547d\u540d\u7a7a\u95f4\u548c\u670d\u52a1\u8d26\u6237\u3002\u4f8b\u5982\uff0c\u5728\u6211\u4eec\u4e4b\u524d\u6709\u4e00\u4e2a IRSA \u4ee4\u724c\uff0c\u5176 sub \u58f0\u660e\u4e3a \"system:serviceaccount:default:s3-read-only\"\u3002\u8fd9\u662f <code>default</code> \u547d\u540d\u7a7a\u95f4\uff0c\u670d\u52a1\u8d26\u6237\u662f <code>s3-read-only</code>\u3002\u60a8\u5c06\u4f7f\u7528\u5982\u4e0b\u6761\u4ef6\u6765\u786e\u4fdd\u53ea\u6709\u60a8\u5728\u7ed9\u5b9a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u670d\u52a1\u8d26\u6237\u6765\u81ea\u60a8\u7684\u96c6\u7fa4\u624d\u80fd\u627f\u62c5\u8be5\u89d2\u8272\uff1a</p> <pre><code>  \"Condition\": {\n      \"StringEquals\": {\n          \"oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128:aud\": \"sts.amazonaws.com\",\n          \"oidc.eks.us-west-2.amazonaws.com/id/D43CF17C27A865933144EA99A26FB128:sub\": \"system:serviceaccount:default:s3-read-only\"\n      }\n  }\n</code></pre>"},{"location":"zh/security/docs/iam/#iam_2","title":"\u4e3a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u4e00\u4e2a IAM \u89d2\u8272","text":"<p>\u4f7f\u7528 IRSA \u548c EKS Pod \u8eab\u4efd\u65f6\uff0c\u6700\u4f73\u5b9e\u8df5\u662f\u4e3a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u81ea\u5df1\u7684 IAM \u89d2\u8272\u3002\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u9694\u79bb\u6027\uff0c\u56e0\u4e3a\u60a8\u53ef\u4ee5\u4fee\u6539\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u800c\u4e0d\u5f71\u54cd\u53e6\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u5141\u8bb8\u60a8\u5e94\u7528\u6700\u5c0f\u7279\u6743\u539f\u5219\uff0c\u53ea\u4e3a\u5e94\u7528\u7a0b\u5e8f\u6388\u4e88\u5b83\u6240\u9700\u7684\u6743\u9650\u3002</p> <p>\u4f7f\u7528 EKS Pod \u8eab\u4efd\u7684 ABAC \u65f6\uff0c\u60a8\u53ef\u4ee5\u8de8\u591a\u4e2a\u670d\u52a1\u8d26\u6237\u4f7f\u7528\u901a\u7528 IAM \u89d2\u8272\uff0c\u5e76\u4f9d\u8d56\u5176\u4f1a\u8bdd\u5c5e\u6027\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u3002\u5728\u5927\u89c4\u6a21\u8fd0\u8425\u65f6\uff0c\u8fd9\u5c24\u5176\u6709\u7528\uff0c\u56e0\u4e3a ABAC \u5141\u8bb8\u60a8\u4f7f\u7528\u66f4\u5c11\u7684 IAM \u89d2\u8272\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"zh/security/docs/iam/#imds-imdsv2-ec2-2","title":"\u5f53\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8bbf\u95ee IMDS \u65f6\uff0c\u8bf7\u4f7f\u7528 IMDSv2 \u5e76\u5c06 EC2 \u5b9e\u4f8b\u7684\u8dc3\u70b9\u9650\u5236\u589e\u52a0\u5230 2","text":"<p>IMDSv2 \u8981\u6c42\u60a8\u4f7f\u7528 PUT \u8bf7\u6c42\u6765\u83b7\u53d6\u4f1a\u8bdd\u4ee4\u724c\u3002\u521d\u59cb PUT \u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u4f1a\u8bdd\u4ee4\u724c\u7684 TTL\u3002\u8f83\u65b0\u7248\u672c\u7684 AWS SDK \u5c06\u81ea\u52a8\u5904\u7406\u8fd9\u4e00\u70b9\u4ee5\u53ca\u8be5\u4ee4\u724c\u7684\u7eed\u8ba2\u3002\u8fd8\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cEC2 \u5b9e\u4f8b\u4e0a\u7684\u9ed8\u8ba4\u8dc3\u70b9\u9650\u5236\u6709\u610f\u8bbe\u7f6e\u4e3a 1\uff0c\u4ee5\u9632\u6b62 IP \u8f6c\u53d1\u3002\u56e0\u6b64\uff0c\u5728 EC2 \u5b9e\u4f8b\u4e0a\u8fd0\u884c\u7684\u8bf7\u6c42\u4f1a\u8bdd\u4ee4\u724c\u7684 Pod \u6700\u7ec8\u53ef\u80fd\u4f1a\u8d85\u65f6\u5e76\u56de\u9000\u5230\u4f7f\u7528 IMDSv1 \u6570\u636e\u6d41\u3002EKS \u901a\u8fc7_\u542f\u7528_v1 \u548c v2 \u5e76\u5c06\u8282\u70b9\u4e0a\u7684\u8dc3\u70b9\u9650\u5236\u66f4\u6539\u4e3a 2 \u6765\u6dfb\u52a0\u5bf9 IMDSv2 \u7684\u652f\u6301\uff0c\u8fd9\u4e9b\u8282\u70b9\u662f\u7531 eksctl \u6216\u4f7f\u7528\u5b98\u65b9 CloudFormation \u6a21\u677f\u4f9b\u5e94\u7684\u3002</p>"},{"location":"zh/security/docs/iam/#_9","title":"\u7981\u7528\u81ea\u52a8\u6302\u8f7d\u670d\u52a1\u8d26\u6237\u4ee4\u724c","text":"<p>\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u9700\u8981\u8c03\u7528 Kubernetes API\uff0c\u8bf7\u5728 PodSpec \u4e2d\u5c06 <code>automountServiceAccountToken</code> \u5c5e\u6027\u8bbe\u7f6e\u4e3a <code>false</code>\uff0c\u6216\u8005\u4fee\u8865\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u9ed8\u8ba4\u670d\u52a1\u8d26\u6237\uff0c\u4f7f\u5176\u4e0d\u518d\u81ea\u52a8\u6302\u8f7d\u5230 pod\u3002\u4f8b\u5982\uff1a</p> <pre><code>kubectl patch serviceaccount default -p $'automountServiceAccountToken: false'\n</code></pre>"},{"location":"zh/security/docs/iam/#_10","title":"\u4e3a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u4e13\u7528\u670d\u52a1\u8d26\u6237","text":"<p>\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u90fd\u5e94\u8be5\u6709\u81ea\u5df1\u4e13\u7528\u7684\u670d\u52a1\u8d26\u6237\u3002\u8fd9\u9002\u7528\u4e8e Kubernetes API \u7684\u670d\u52a1\u8d26\u6237\u4ee5\u53ca IRSA \u548c EKS Pod \u8eab\u4efd\u3002</p> <p>Attention</p> <p>\u5982\u679c\u60a8\u5728\u96c6\u7fa4\u5347\u7ea7\u65f6\u91c7\u7528\u84dd/\u7eff\u65b9\u6cd5\u800c\u4e0d\u662f\u6267\u884c\u5c31\u5730\u96c6\u7fa4\u5347\u7ea7\uff0c\u90a3\u4e48\u5728\u4f7f\u7528 IRSA \u65f6\uff0c\u60a8\u9700\u8981\u4f7f\u7528\u65b0\u96c6\u7fa4\u7684 OIDC \u7aef\u70b9\u66f4\u65b0\u6bcf\u4e2a IRSA IAM \u89d2\u8272\u7684\u4fe1\u4efb\u7b56\u7565\u3002\u84dd/\u7eff\u96c6\u7fa4\u5347\u7ea7\u662f\u6307\u5728\u65e7\u96c6\u7fa4\u65c1\u8fb9\u521b\u5efa\u4e00\u4e2a\u8fd0\u884c\u8f83\u65b0\u7248\u672c Kubernetes \u7684\u96c6\u7fa4\uff0c\u7136\u540e\u4f7f\u7528\u8d1f\u8f7d\u5747\u8861\u5668\u6216\u670d\u52a1\u7f51\u683c\u5c06\u670d\u52a1\u4ece\u65e7\u96c6\u7fa4\u65e0\u7f1d\u5207\u6362\u5230\u65b0\u96c6\u7fa4\u3002 \u4f7f\u7528\u84dd/\u7eff\u96c6\u7fa4\u5347\u7ea7\u4e0e EKS Pod \u8eab\u4efd\u65f6\uff0c\u60a8\u9700\u8981\u5728\u65b0\u96c6\u7fa4\u4e2d\u521b\u5efa pod \u8eab\u4efd\u5173\u8054\uff0c\u5c06 IAM \u89d2\u8272\u4e0e\u670d\u52a1\u8d26\u6237\u5173\u8054\u3002\u5982\u679c\u60a8\u6709 <code>sourceArn</code> \u6761\u4ef6\uff0c\u8fd8\u9700\u8981\u66f4\u65b0 IAM \u89d2\u8272\u4fe1\u4efb\u7b56\u7565\u3002</p>"},{"location":"zh/security/docs/iam/#root","title":"\u4ee5\u975e root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u5bb9\u5668\u9ed8\u8ba4\u4ee5 root \u8eab\u4efd\u8fd0\u884c\u3002\u867d\u7136\u8fd9\u5141\u8bb8\u5b83\u4eec\u8bfb\u53d6 Web \u8eab\u4efd\u4ee4\u724c\u6587\u4ef6\uff0c\u4f46\u4ee5 root \u8eab\u4efd\u8fd0\u884c\u5bb9\u5668\u4e0d\u88ab\u89c6\u4e3a\u6700\u4f73\u5b9e\u8df5\u3002\u4f5c\u4e3a\u66ff\u4ee3\u65b9\u6848\uff0c\u8bf7\u8003\u8651\u5728 PodSpec \u4e2d\u6dfb\u52a0 <code>spec.securityContext.runAsUser</code> \u5c5e\u6027\u3002<code>runAsUser</code> \u7684\u503c\u662f\u4efb\u610f\u503c\u3002</p> <p>\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0cPod \u4e2d\u7684\u6240\u6709\u8fdb\u7a0b\u90fd\u5c06\u4ee5 <code>runAsUser</code> \u5b57\u6bb5\u4e2d\u6307\u5b9a\u7684\u7528\u6237 ID \u8fd0\u884c\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: security-context-demo\nspec:\n  securityContext:\n    runAsUser: 1000\n    runAsGroup: 3000\n  containers:\n  - name: sec-ctx-demo\n    image: busybox\n    command: [ \"sh\", \"-c\", \"sleep 1h\" ]\n</code></pre> <p>\u5f53\u60a8\u4ee5\u975e root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\u5bb9\u5668\u65f6\uff0c\u5b83\u4f1a\u963b\u6b62\u5bb9\u5668\u8bfb\u53d6 IRSA \u670d\u52a1\u8d26\u6237\u4ee4\u724c\uff0c\u56e0\u4e3a\u8be5\u4ee4\u724c\u9ed8\u8ba4\u88ab\u5206\u914d 0600 [root] \u6743\u9650\u3002\u5982\u679c\u60a8\u5c06\u5bb9\u5668\u7684 securityContext \u66f4\u65b0\u4e3a\u5305\u542b fsgroup=65534 [Nobody]\uff0c\u5b83\u5c06\u5141\u8bb8\u5bb9\u5668\u8bfb\u53d6\u4ee4\u724c\u3002</p> <pre><code>spec:\n  securityContext:\n    fsGroup: 65534\n</code></pre> <p>\u5728 Kubernetes 1.19 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u4e0d\u518d\u9700\u8981\u8fdb\u884c\u6b64\u66f4\u6539\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u8bfb\u53d6 IRSA \u670d\u52a1\u8d26\u6237\u4ee4\u724c\u800c\u65e0\u9700\u5c06\u5b83\u4eec\u6dfb\u52a0\u5230 Nobody \u7ec4\u3002</p>"},{"location":"zh/security/docs/iam/#_11","title":"\u4e3a\u5e94\u7528\u7a0b\u5e8f\u6388\u4e88\u6700\u5c0f\u7279\u6743\u8bbf\u95ee\u6743\u9650","text":"<p>Action Hero \u662f\u4e00\u4e2a\u5b9e\u7528\u7a0b\u5e8f\uff0c\u60a8\u53ef\u4ee5\u5c06\u5176\u4e0e\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e00\u8d77\u8fd0\u884c\uff0c\u4ee5\u8bc6\u522b\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u6240\u9700\u7684 AWS API \u8c03\u7528\u548c\u76f8\u5e94\u7684 IAM \u6743\u9650\u3002\u5b83\u7c7b\u4f3c\u4e8e IAM Access Advisor\uff0c\u53ef\u5e2e\u52a9\u60a8\u9010\u6b65\u9650\u5236\u5206\u914d\u7ed9\u5e94\u7528\u7a0b\u5e8f\u7684 IAM \u89d2\u8272\u7684\u8303\u56f4\u3002\u6709\u5173\u6388\u4e88\u5bf9 AWS \u8d44\u6e90\u7684\u6700\u5c0f\u7279\u6743\u8bbf\u95ee\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6587\u6863\u3002</p> <p>\u8003\u8651\u4e3a IRSA \u548c Pod \u8eab\u4efd\u4f7f\u7528\u7684 IAM \u89d2\u8272\u8bbe\u7f6e\u6743\u9650\u8fb9\u754c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6743\u9650\u8fb9\u754c\u6765\u786e\u4fdd IRSA \u6216 Pod \u8eab\u4efd\u4f7f\u7528\u7684\u89d2\u8272\u4e0d\u80fd\u8d85\u8fc7\u6700\u5927\u6743\u9650\u7ea7\u522b\u3002\u6709\u5173\u5f00\u59cb\u4f7f\u7528\u6743\u9650\u8fb9\u754c\u4ee5\u53ca\u793a\u4f8b\u6743\u9650\u8fb9\u754c\u7b56\u7565\u7684\u793a\u4f8b\u6307\u5357\uff0c\u8bf7\u53c2\u9605\u6b64 github \u5b58\u50a8\u5e93\u3002</p>"},{"location":"zh/security/docs/iam/#eks_2","title":"\u5ba1\u67e5\u5e76\u64a4\u9500\u5bf9\u60a8\u7684 EKS \u96c6\u7fa4\u7684\u4e0d\u5fc5\u8981\u7684\u533f\u540d\u8bbf\u95ee\u6743\u9650","text":"<p>\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u4e3a\u6240\u6709 API \u64cd\u4f5c\u7981\u7528\u533f\u540d\u8bbf\u95ee\u3002\u901a\u8fc7\u4e3a Kubernetes \u5185\u7f6e\u7528\u6237 system\uff1aanonymous \u521b\u5efa RoleBinding \u6216 ClusterRoleBinding \u6765\u6388\u4e88\u533f\u540d\u8bbf\u95ee\u6743\u9650\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 rbac-lookup \u5de5\u5177\u6765\u8bc6\u522b system\uff1aanonymous \u7528\u6237\u5728\u60a8\u7684\u96c6\u7fa4\u4e0a\u62e5\u6709\u7684\u6743\u9650\uff1a</p> <pre><code>./rbac-lookup | grep -P 'system:(anonymous)|(unauthenticated)'\nsystem:anonymous               cluster-wide        ClusterRole/system:discovery\nsystem:unauthenticated         cluster-wide        ClusterRole/system:discovery\nsystem:unauthenticated         cluster-wide        ClusterRole/system:public-info-viewer\n</code></pre> <p>\u9664 system\uff1apublic-info-viewer \u4e4b\u5916\uff0c\u4efb\u4f55\u5176\u4ed6\u89d2\u8272\u6216\u96c6\u7fa4\u89d2\u8272\u90fd\u4e0d\u5e94\u7ed1\u5b9a\u5230 system\uff1aanonymous \u7528\u6237\u6216 system\uff1aunauthenticated \u7ec4\u3002</p> <p>\u5728\u67d0\u4e9b\u7279\u5b9a\u60c5\u51b5\u4e0b\uff0c\u4e3a\u7279\u5b9a API \u542f\u7528\u533f\u540d\u8bbf\u95ee\u6743\u9650\u53ef\u80fd\u662f\u5408\u7406\u7684\u3002\u5982\u679c\u8fd9\u5bf9\u60a8\u7684\u96c6\u7fa4\u6765\u8bf4\u662f\u5fc5\u9700\u7684\uff0c\u8bf7\u786e\u4fdd\u53ea\u6709\u90a3\u4e9b\u7279\u5b9a API \u53ef\u4ee5\u5728\u4e0d\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\u8bbf\u95ee\uff0c\u5e76\u4e14\u4e0d\u4f1a\u4f7f\u60a8\u7684\u96c6\u7fa4\u9762\u4e34\u98ce\u9669\u3002</p> <p>\u5728 Kubernetes/EKS \u7248\u672c 1.14 \u4e4b\u524d\uff0csystem:unauthenticated \u7ec4\u9ed8\u8ba4\u4e0e system\uff1adiscovery \u548c system\uff1abasic-user ClusterRoles \u5173\u8054\u3002\u8bf7\u6ce8\u610f\uff0c\u5373\u4f7f\u60a8\u5df2\u5c06\u96c6\u7fa4\u66f4\u65b0\u5230 1.14 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u8fd9\u4e9b\u6743\u9650\u53ef\u80fd\u4ecd\u7136\u5728\u60a8\u7684\u96c6\u7fa4\u4e0a\u542f\u7528\uff0c\u56e0\u4e3a\u96c6\u7fa4\u66f4\u65b0\u4e0d\u4f1a\u64a4\u9500\u8fd9\u4e9b\u6743\u9650\u3002 \u8981\u68c0\u67e5\u9664 system\uff1apublic-info-viewer \u4e4b\u5916\u54ea\u4e9b ClusterRoles \u5177\u6709 \"system:unauthenticated\"\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u9700\u8981 jq \u5b9e\u7528\u7a0b\u5e8f\uff09\uff1a</p> <pre><code>kubectl get ClusterRoleBinding -o json | jq -r '.items[] | select(.subjects[]?.name ==\"system:unauthenticated\") | select(.metadata.name != \"system:public-info-viewer\") | .metadata.name'\n</code></pre> <p>\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4ece\u9664 \"system:public-info-viewer\" \u4e4b\u5916\u7684\u6240\u6709\u89d2\u8272\u4e2d\u5220\u9664 \"system:unauthenticated\"\uff1a</p> <pre><code>kubectl get ClusterRoleBinding -o json | jq -r '.items[] | select(.subjects[]?.name ==\"system:unauthenticated\") | select(.metadata.name != \"system:public-info-viewer\") | del(.subjects[] | select(.name ==\"system:unauthenticated\"))' | kubectl apply -f -\n</code></pre> <p>\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 kubectl describe \u548c kubectl edit \u624b\u52a8\u68c0\u67e5\u548c\u5220\u9664\u3002\u8981\u68c0\u67e5 system\uff1aunauthenticated \u7ec4\u5728\u60a8\u7684\u96c6\u7fa4\u4e0a\u662f\u5426\u5177\u6709 system\uff1adiscovery \u6743\u9650\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>kubectl describe clusterrolebindings system:discovery\n\nName:         system:discovery\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate: true\nRole:\n  Kind:  ClusterRole\n  Name:  system:discovery\nSubjects:\n  Kind   Name                    Namespace\n  ----   ----                    ---------\n  Group  system:authenticated\n  Group  system:unauthenticated\n</code></pre> <p>\u8981\u68c0\u67e5 system\uff1aunauthenticated \u7ec4\u5728\u60a8\u7684\u96c6\u7fa4\u4e0a\u662f\u5426\u5177\u6709 system\uff1abasic-user \u6743\u9650\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>kubectl describe clusterrolebindings system:basic-user\n\nName:         system:basic-user\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate: true\nRole:\n  Kind:  ClusterRole\n  Name:  system:basic-user\nSubjects:\n  Kind   Name                    Namespace\n  ----   ----                    ---------\n  Group  system:authenticated\n  Group  system:unauthenticated\n</code></pre> <p>\u5982\u679c system\uff1aunauthenticated \u7ec4\u5728\u60a8\u7684\u96c6\u7fa4\u4e0a\u7ed1\u5b9a\u5230 system\uff1adiscovery \u548c/\u6216 system\uff1abasic-user ClusterRoles\uff0c\u60a8\u5e94\u8be5\u5c06\u8fd9\u4e9b\u89d2\u8272\u4e0e system\uff1aunauthenticated \u7ec4\u89e3\u9664\u5173\u8054\u3002\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u7f16\u8f91 system\uff1adiscovery ClusterRoleBinding\uff1a</p> <pre><code>kubectl edit clusterrolebindings system:discovery\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u5c06\u5728\u7f16\u8f91\u5668\u4e2d\u6253\u5f00 system\uff1adiscovery ClusterRoleBinding \u7684\u5f53\u524d\u5b9a\u4e49\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code># Please edit the object below. Lines beginning with a '#' will be ignored,\n# and an empty file will abort the edit. If an error occurs while saving this file will be\n# reopened with the relevant failures.\n#\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  creationTimestamp: \"2021-06-17T20:50:49Z\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:discovery\n  resourceVersion: \"24502985\"\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/system%3Adiscovery\n  uid: b7936268-5043-431a-a0e1-171a423abeb6\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:discovery\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:authenticated\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:unauthenticated\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684\u7f16\u8f91\u5668\u5c4f\u5e55\u4e2d\u7684 \"subjects\" \u90e8\u5206\u5220\u9664 system\uff1aunauthenticated \u7ec4\u7684\u6761\u76ee\u3002</p> <p>\u5bf9\u4e8e system\uff1abasic-user ClusterRoleBinding \u91cd\u590d\u76f8\u540c\u7684\u6b65\u9aa4\u3002</p>"},{"location":"zh/security/docs/iam/#irsa-aws-sdk","title":"\u91cd\u7528 IRSA \u7684 AWS SDK \u4f1a\u8bdd","text":"<p>\u5f53\u60a8\u4f7f\u7528 IRSA \u65f6\uff0c\u4f7f\u7528 AWS SDK \u7f16\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u4f1a\u4f7f\u7528\u4f20\u9012\u7ed9\u60a8\u7684 pod \u7684\u4ee4\u724c\u8c03\u7528 <code>sts:AssumeRoleWithWebIdentity</code> \u6765\u751f\u6210\u4e34\u65f6 AWS \u51ed\u8bc1\u3002\u8fd9\u4e0e\u5176\u4ed6 AWS \u8ba1\u7b97\u670d\u52a1\u4e0d\u540c\uff0c\u5728\u5176\u4ed6 AWS \u8ba1\u7b97\u670d\u52a1\u4e2d\uff0c\u8ba1\u7b97\u670d\u52a1\u76f4\u63a5\u5411  AWS \u8ba1\u7b97\u8d44\u6e90\uff08\u5982 Lambda \u51fd\u6570\uff09\u63d0\u4f9b\u4e34\u65f6 AWS \u51ed\u8bc1\u3002\u8fd9\u610f\u5473\u7740\u6bcf\u6b21\u521d\u59cb\u5316 AWS SDK \u4f1a\u8bdd\u65f6\uff0c\u90fd\u4f1a\u8fdb\u884c\u4e00\u6b21\u5bf9 <code>AssumeRoleWithWebIdentity</code> \u7684\u8c03\u7528\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5feb\u901f\u6269\u5c55\u5e76\u521d\u59cb\u5316\u4e86\u8bb8\u591a AWS SDK \u4f1a\u8bdd\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230\u6765\u81ea AWS STS \u7684\u8282\u6d41\uff0c\u56e0\u4e3a\u60a8\u7684\u4ee3\u7801\u5c06\u8fdb\u884c\u8bb8\u591a\u5bf9 <code>AssumeRoleWithWebIdentity</code> \u7684\u8c03\u7528\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u91cd\u7528 AWS SDK \u4f1a\u8bdd\uff0c\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u5bf9 <code>AssumeRoleWithWebIdentity</code> \u7684\u8c03\u7528\u3002</p> <p>\u5728\u4ee5\u4e0b\u793a\u4f8b\u4ee3\u7801\u4e2d\uff0c\u4f7f\u7528 boto3 python SDK \u521b\u5efa\u4e86\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u5e76\u4f7f\u7528\u540c\u4e00\u4e2a\u4f1a\u8bdd\u521b\u5efa\u4e86\u7528\u4e8e\u4e0e Amazon S3 \u548c Amazon SQS \u4ea4\u4e92\u7684\u5ba2\u6237\u7aef\u3002<code>AssumeRoleWithWebIdentity</code> \u53ea\u8c03\u7528\u4e00\u6b21\uff0cAWS SDK \u5c06\u5728\u51ed\u8bc1\u8fc7\u671f\u65f6\u81ea\u52a8\u5237\u65b0 <code>my_session</code> \u7684\u51ed\u8bc1\u3002</p> <pre><code>import boto3\n\n# Create your own session\nmy_session = boto3.session.Session()\n\n# Now we can create low-level clients from our session\nsqs = my_session.client('sqs')\ns3 = my_session.client('s3')\n\ns3response = s3.list_buckets()\nsqsresponse = sqs.list_queues()\n\n\n#print the response from the S3 and SQS APIs\nprint(\"s3 response:\")\nprint(s3response)\nprint(\"---\")\nprint(\"sqs response:\")\nprint(sqsresponse)\n</code></pre> <p>\u5982\u679c\u60a8\u6b63\u5728\u5c06\u5e94\u7528\u7a0b\u5e8f\u4ece\u5176\u4ed6 AWS \u8ba1\u7b97\u670d\u52a1\uff08\u5982 EC2\uff09\u8fc1\u79fb\u5230\u4f7f\u7528 IRSA \u7684 EKS\uff0c\u8fd9\u4e00\u70b9\u5c24\u5176\u91cd\u8981\u3002\u5728\u5176\u4ed6\u8ba1\u7b97\u670d\u52a1\u4e0a\uff0c\u521d\u59cb\u5316 AWS SDK \u4f1a\u8bdd\u4e0d\u4f1a\u8c03\u7528 AWS STS\uff0c\u9664\u975e\u60a8\u6307\u793a\u5b83\u8fd9\u6837\u505a\u3002</p>"},{"location":"zh/security/docs/iam/#_12","title":"\u66ff\u4ee3\u65b9\u6cd5","text":"<p>\u867d\u7136 IRSA \u548c EKS Pod \u8eab\u4efd\u662f\u4e3a pod \u5206\u914d AWS \u8eab\u4efd\u7684_\u9996\u9009\u65b9\u5f0f_\uff0c\u4f46\u5b83\u4eec\u9700\u8981\u60a8\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5305\u542b\u6700\u65b0\u7248\u672c\u7684 AWS SDK\u3002\u6709\u5173\u5f53\u524d\u652f\u6301 IRSA \u7684 SDK \u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u9605 https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts-minimum-sdk.html\uff0c\u5bf9\u4e8e EKS Pod \u8eab\u4efd\uff0c\u8bf7\u53c2\u9605 https://docs.aws.amazon.com/eks/latest/userguide/pod-id-minimum-sdk.html\u3002\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528\u517c\u5bb9 SDK \u66f4\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u793e\u533a\u63d0\u4f9b\u4e86\u51e0\u79cd\u4e3a Kubernetes pod \u5206\u914d IAM \u89d2\u8272\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5305\u62ec kube2iam \u548c kiam\u3002\u867d\u7136 AWS \u4e0d\u8ba4\u53ef\u3001\u652f\u6301\u6216\u652f\u6301\u4f7f\u7528\u8fd9\u4e9b\u89e3\u51b3\u65b9\u6848\uff0c\u4f46\u5b83\u4eec\u7ecf\u5e38\u88ab\u5e7f\u5927\u793e\u533a\u7528\u6765\u5b9e\u73b0\u4e0e IRSA \u548c EKS Pod \u8eab\u4efd\u7c7b\u4f3c\u7684\u7ed3\u679c\u3002</p> <p>\u5982\u679c\u60a8\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u975e AWS \u63d0\u4f9b\u7684\u89e3\u51b3\u65b9\u6848\u4e4b\u4e00\uff0c\u8bf7\u8c28\u614e\u884c\u4e8b\u5e76\u786e\u4fdd\u60a8\u4e86\u89e3\u8fd9\u6837\u505a\u7684\u5b89\u5168\u5f71\u54cd\u3002</p>"},{"location":"zh/security/docs/iam/#_13","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a - \u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406</li> <li>Terraform EKS \u84dd\u56fe\u6a21\u5f0f - \u5b8c\u5168\u79c1\u6709 Amazon EKS \u96c6\u7fa4</li> <li>Terraform EKS \u84dd\u56fe\u6a21\u5f0f - Amazon EKS \u96c6\u7fa4\u7684 IAM Identity Center \u5355\u70b9\u767b\u5f55</li> <li>Terraform EKS \u84dd\u56fe\u6a21\u5f0f - Amazon EKS \u96c6\u7fa4\u7684 Okta \u5355\u70b9\u767b\u5f55</li> <li>audit2rbac</li> <li>rbac.dev Kubernetes RBAC \u7684\u5176\u4ed6\u8d44\u6e90\u5217\u8868\uff0c\u5305\u62ec\u535a\u5ba2\u548c\u5de5\u5177</li> <li>Action Hero</li> <li>kube2iam</li> <li>kiam</li> </ul>"},{"location":"zh/security/docs/image/","title":"\u955c\u50cf\u5b89\u5168","text":"<p>\u60a8\u5e94\u8be5\u5c06\u5bb9\u5668\u955c\u50cf\u89c6\u4e3a\u9632\u5fa1\u653b\u51fb\u7684\u7b2c\u4e00\u9053\u9632\u7ebf\u3002\u4e0d\u5b89\u5168\u3001\u6784\u5efa\u4e0d\u5f53\u7684\u955c\u50cf\u53ef\u80fd\u4f1a\u5141\u8bb8\u653b\u51fb\u8005\u9003\u8131\u5bb9\u5668\u7684\u9650\u5236\u5e76\u8bbf\u95ee\u4e3b\u673a\u3002\u4e00\u65e6\u8fdb\u5165\u4e3b\u673a\uff0c\u653b\u51fb\u8005\u5c31\u53ef\u4ee5\u8bbf\u95ee\u654f\u611f\u4fe1\u606f\u6216\u5728\u96c6\u7fa4\u6216\u60a8\u7684 AWS \u8d26\u6237\u4e2d\u6a2a\u5411\u79fb\u52a8\u3002\u4ee5\u4e0b\u6700\u4f73\u5b9e\u8df5\u5c06\u6709\u52a9\u4e8e\u964d\u4f4e\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u7684\u98ce\u9669\u3002</p>"},{"location":"zh/security/docs/image/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/security/docs/image/#_3","title":"\u521b\u5efa\u6700\u5c0f\u955c\u50cf","text":"<p>\u9996\u5148\u4ece\u5bb9\u5668\u955c\u50cf\u4e2d\u5220\u9664\u6240\u6709\u591a\u4f59\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528\u6765\u81ea Dockerhub \u7684\u4e0d\u719f\u6089\u7684\u955c\u50cf\uff0c\u8bf7\u4f7f\u7528\u8bf8\u5982 Dive \u4e4b\u7c7b\u7684\u5e94\u7528\u7a0b\u5e8f\u68c0\u67e5\u955c\u50cf\uff0c\u5b83\u53ef\u4ee5\u5411\u60a8\u663e\u793a\u5bb9\u5668\u6bcf\u4e00\u5c42\u7684\u5185\u5bb9\u3002\u5220\u9664\u6240\u6709\u5e26\u6709 SETUID \u548c SETGID \u4f4d\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ef\u7528\u4e8e\u6743\u9650\u63d0\u5347\uff0c\u5e76\u8003\u8651\u5220\u9664\u6240\u6709 shell \u548c\u5b9e\u7528\u7a0b\u5e8f\uff0c\u5982 nc \u548c curl\uff0c\u5b83\u4eec\u53ef\u7528\u4e8e\u4e0d\u6b63\u5f53\u76ee\u7684\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u627e\u5230\u5e26\u6709 SETUID \u548c SETGID \u4f4d\u7684\u6587\u4ef6\uff1a</p> <pre><code>find / -perm /6000 -type f -exec ls -ld {} \\;\n</code></pre> <p>\u8981\u4ece\u8fd9\u4e9b\u6587\u4ef6\u4e2d\u5220\u9664\u7279\u6b8a\u6743\u9650\uff0c\u8bf7\u5728\u5bb9\u5668\u955c\u50cf\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u6307\u4ee4\uff1a</p> <pre><code>RUN find / -xdev -perm /6000 -type f -exec chmod a-s {} \\; || true\n</code></pre> <p>\u4fd7\u79f0\uff0c\u8fd9\u88ab\u79f0\u4e3a\"\u53bb\u9664\u955c\u50cf\u7684\u7259\u9f7f\"\u3002</p>"},{"location":"zh/security/docs/image/#_4","title":"\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa","text":"<p>\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa\u662f\u521b\u5efa\u6700\u5c0f\u955c\u50cf\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u901a\u5e38\uff0c\u591a\u9636\u6bb5\u6784\u5efa\u7528\u4e8e\u81ea\u52a8\u5316\u6301\u7eed\u96c6\u6210\u5468\u671f\u7684\u67d0\u4e9b\u90e8\u5206\u3002\u4f8b\u5982\uff0c\u591a\u9636\u6bb5\u6784\u5efa\u53ef\u7528\u4e8e lint \u60a8\u7684\u6e90\u4ee3\u7801\u6216\u6267\u884c\u9759\u6001\u4ee3\u7801\u5206\u6790\u3002\u8fd9\u4e3a\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u4e86\u4e00\u4e2a\u673a\u4f1a\uff0c\u53ef\u4ee5\u83b7\u5f97\u8fd1\u4e4e\u5373\u65f6\u7684\u53cd\u9988\uff0c\u800c\u4e0d\u5fc5\u7b49\u5f85\u7ba1\u9053\u6267\u884c\u3002\u4ece\u5b89\u5168\u89d2\u5ea6\u6765\u770b\uff0c\u591a\u9636\u6bb5\u6784\u5efa\u5f88\u6709\u5438\u5f15\u529b\uff0c\u56e0\u4e3a\u5b83\u4eec\u5141\u8bb8\u60a8\u6700\u5c0f\u5316\u63a8\u9001\u5230\u5bb9\u5668\u6ce8\u518c\u8868\u7684\u6700\u7ec8\u955c\u50cf\u7684\u5927\u5c0f\u3002\u4e0d\u5305\u542b\u6784\u5efa\u5de5\u5177\u548c\u5176\u4ed6\u591a\u4f59\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u5bb9\u5668\u955c\u50cf\u53ef\u4ee5\u901a\u8fc7\u51cf\u5c0f\u955c\u50cf\u7684\u653b\u51fb\u9762\u6765\u6539\u5584\u60a8\u7684\u5b89\u5168\u6001\u52bf\u3002\u6709\u5173\u591a\u9636\u6bb5\u6784\u5efa\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Docker \u7684\u591a\u9636\u6bb5\u6784\u5efa\u6587\u6863\u3002</p>"},{"location":"zh/security/docs/image/#sbom","title":"\u4e3a\u60a8\u7684\u5bb9\u5668\u955c\u50cf\u521b\u5efa\u8f6f\u4ef6\u6750\u6599\u6e05\u5355 (SBOM)","text":"<p>\"\u8f6f\u4ef6\u6750\u6599\u6e05\u5355\"(SBOM) \u662f\u6784\u6210\u60a8\u7684\u5bb9\u5668\u955c\u50cf\u7684\u8f6f\u4ef6\u5de5\u4ef6\u7684\u5d4c\u5957\u6e05\u5355\u3002 SBOM \u662f\u8f6f\u4ef6\u5b89\u5168\u548c\u8f6f\u4ef6\u4f9b\u5e94\u94fe\u98ce\u9669\u7ba1\u7406\u7684\u5173\u952e\u7ec4\u6210\u90e8\u5206\u3002\u751f\u6210\u3001\u5728\u4e2d\u592e\u5b58\u50a8\u5e93\u4e2d\u5b58\u50a8 SBOM \u5e76\u626b\u63cf SBOM \u4ee5\u67e5\u627e\u6f0f\u6d1e\u6709\u52a9\u4e8e\u89e3\u51b3\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <ul> <li>\u53ef\u89c1\u6027: \u4e86\u89e3\u6784\u6210\u60a8\u7684\u5bb9\u5668\u955c\u50cf\u7684\u7ec4\u4ef6\u3002\u5728\u4e2d\u592e\u5b58\u50a8\u5e93\u4e2d\u5b58\u50a8\u53ef\u4ee5\u8ba9 SBOM \u968f\u65f6\u88ab\u5ba1\u8ba1\u548c\u626b\u63cf\uff0c\u5373\u4f7f\u5728\u90e8\u7f72\u540e\u4e5f\u53ef\u4ee5\u68c0\u6d4b\u548c\u54cd\u5e94\u65b0\u7684\u6f0f\u6d1e\uff0c\u5982\u96f6\u65e5\u6f0f\u6d1e\u3002</li> <li>\u6765\u6e90\u9a8c\u8bc1: \u786e\u4fdd\u73b0\u6709\u5047\u8bbe\u5173\u4e8e\u5de5\u4ef6\u7684\u6765\u6e90\u5730\u548c\u65b9\u5f0f\u662f\u771f\u5b9e\u7684\uff0c\u4ee5\u53ca\u5de5\u4ef6\u6216\u5176\u9644\u5e26\u7684\u5143\u6570\u636e\u5728\u6784\u5efa\u6216\u4ea4\u4ed8\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u88ab\u7be1\u6539\u3002</li> <li>\u53ef\u4fe1\u5ea6: \u786e\u4fdd\u7ed9\u5b9a\u5de5\u4ef6\u53ca\u5176\u5185\u5bb9\u53ef\u4ee5\u88ab\u4fe1\u4efb\uff0c\u5373\u53ef\u4ee5\u6267\u884c\u5176\u58f0\u79f0\u7684\u529f\u80fd\u3002\u8fd9\u6d89\u53ca\u5bf9\u4ee3\u7801\u662f\u5426\u5b89\u5168\u6267\u884c\u7684\u5224\u65ad\uff0c\u4ee5\u53ca\u5bf9\u6267\u884c\u4ee3\u7801\u7684\u98ce\u9669\u505a\u51fa\u660e\u667a\u51b3\u5b9a\u3002\u53ef\u4fe1\u5ea6\u662f\u901a\u8fc7\u521b\u5efa\u7ecf\u8fc7\u8ba4\u8bc1\u7684\u7ba1\u9053\u6267\u884c\u62a5\u544a\u4ee5\u53ca\u7ecf\u8fc7\u8ba4\u8bc1\u7684 SBOM \u548c\u7ecf\u8fc7\u8ba4\u8bc1\u7684 CVE \u626b\u63cf\u62a5\u544a\u6765\u786e\u4fdd\u7684\uff0c\u4ee5\u5411\u955c\u50cf\u7684\u6d88\u8d39\u8005\u4fdd\u8bc1\u8be5\u955c\u50cf\u786e\u5b9e\u662f\u901a\u8fc7\u5b89\u5168\u65b9\u5f0f(\u7ba1\u9053)\u4f7f\u7528\u5b89\u5168\u7ec4\u4ef6\u521b\u5efa\u7684\u3002</li> <li>\u4f9d\u8d56\u4fe1\u4efb\u9a8c\u8bc1: \u9012\u5f52\u68c0\u67e5\u5de5\u4ef6\u7684\u4f9d\u8d56\u6811\uff0c\u4ee5\u9a8c\u8bc1\u5176\u4f7f\u7528\u7684\u5de5\u4ef6\u7684\u53ef\u4fe1\u5ea6\u548c\u6765\u6e90\u3002SBOM \u4e2d\u7684\u504f\u5dee\u53ef\u4ee5\u5e2e\u52a9\u68c0\u6d4b\u6076\u610f\u6d3b\u52a8\uff0c\u5305\u62ec\u672a\u7ecf\u6388\u6743\u3001\u4e0d\u53d7\u4fe1\u4efb\u7684\u4f9d\u8d56\u9879\u3001\u6e17\u900f\u5c1d\u8bd5\u3002</li> </ul> <p>\u4ee5\u4e0b\u5de5\u5177\u53ef\u7528\u4e8e\u751f\u6210 SBOM\uff1a</p> <ul> <li>Amazon Inspector \u53ef\u7528\u4e8e\u521b\u5efa\u548c\u5bfc\u51fa SBOM\u3002</li> <li>\u4e5f\u53ef\u4ee5\u4f7f\u7528 Anchore \u7684 Syft \u8fdb\u884c SBOM \u751f\u6210\u3002\u4e3a\u4e86\u66f4\u5feb\u5730\u8fdb\u884c\u6f0f\u6d1e\u626b\u63cf\uff0c\u4e3a\u5bb9\u5668\u955c\u50cf\u751f\u6210\u7684 SBOM \u53ef\u4ee5\u7528\u4f5c\u626b\u63cf\u7684\u8f93\u5165\u3002\u7136\u540e\uff0cSBOM \u548c\u626b\u63cf\u62a5\u544a\u7ecf\u8fc7\u8ba4\u8bc1\u5e76\u9644\u52a0\u5230\u955c\u50cf\u4e0a\uff0c\u7136\u540e\u5c06\u955c\u50cf\u63a8\u9001\u5230\u4e2d\u592e OCI \u5b58\u50a8\u5e93(\u5982 Amazon ECR)\u4ee5\u4f9b\u5ba1\u67e5\u548c\u5ba1\u8ba1\u3002</li> </ul> <p>\u901a\u8fc7\u67e5\u770b CNCF \u8f6f\u4ef6\u4f9b\u5e94\u94fe\u6700\u4f73\u5b9e\u8df5\u6307\u5357 \u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u4fdd\u62a4\u60a8\u7684\u8f6f\u4ef6\u4f9b\u5e94\u94fe\u7684\u4fe1\u606f\u3002</p>"},{"location":"zh/security/docs/image/#_5","title":"\u5b9a\u671f\u626b\u63cf\u955c\u50cf\u4ee5\u67e5\u627e\u6f0f\u6d1e","text":"<p>\u4e0e\u5176\u865a\u62df\u673a\u5bf9\u5e94\u7269\u4e00\u6837\uff0c\u5bb9\u5668\u955c\u50cf\u4e5f\u53ef\u80fd\u5305\u542b\u6709\u6f0f\u6d1e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u548c\u5e94\u7528\u7a0b\u5e8f\u5e93\uff0c\u6216\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u800c\u4ea7\u751f\u6f0f\u6d1e\u3002\u9632\u8303\u6f0f\u6d1e\u5229\u7528\u7684\u6700\u4f73\u65b9\u5f0f\u662f\u4f7f\u7528\u955c\u50cf\u626b\u63cf\u5668\u5b9a\u671f\u626b\u63cf\u60a8\u7684\u955c\u50cf\u3002\u5b58\u50a8\u5728 Amazon ECR \u4e2d\u7684\u955c\u50cf\u53ef\u4ee5\u5728\u63a8\u9001\u6216\u6309\u9700(\u5728 24 \u5c0f\u65f6\u5185\u4e00\u6b21)\u8fdb\u884c\u626b\u63cf\u3002ECR \u76ee\u524d\u652f\u6301\u4e24\u79cd\u7c7b\u578b\u7684\u626b\u63cf - \u57fa\u672c\u548c\u589e\u5f3a\u3002\u57fa\u672c\u626b\u63cf\u5229\u7528 Clair \u8fd9\u4e2a\u5f00\u6e90\u955c\u50cf\u626b\u63cf\u89e3\u51b3\u65b9\u6848\uff0c\u65e0\u9700\u4ed8\u8d39\u3002\u589e\u5f3a\u626b\u63cf\u4f7f\u7528 Amazon Inspector \u63d0\u4f9b\u81ea\u52a8\u6301\u7eed\u626b\u63cf\u9700\u8981\u989d\u5916\u4ed8\u8d39\u3002\u626b\u63cf\u955c\u50cf\u540e\uff0c\u7ed3\u679c\u5c06\u8bb0\u5f55\u5230 EventBridge \u4e2d ECR \u7684\u4e8b\u4ef6\u6d41\u4e2d\u3002\u60a8\u4e5f\u53ef\u4ee5\u4ece ECR \u63a7\u5236\u53f0\u67e5\u770b\u626b\u63cf\u7ed3\u679c\u3002\u5177\u6709\u9ad8\u6216\u5173\u952e\u6f0f\u6d1e\u7684\u955c\u50cf\u5e94\u8be5\u88ab\u5220\u9664\u6216\u91cd\u5efa\u3002\u5982\u679c\u5df2\u90e8\u7f72\u7684\u955c\u50cf\u51fa\u73b0\u6f0f\u6d1e\uff0c\u5e94\u5c3d\u5feb\u66ff\u6362\u3002</p> <p>\u4e86\u89e3\u90e8\u7f72\u4e86\u54ea\u4e9b\u6709\u6f0f\u6d1e\u7684\u955c\u50cf\u5bf9\u4e8e\u4fdd\u6301\u73af\u5883\u5b89\u5168\u81f3\u5173\u91cd\u8981\u3002\u867d\u7136\u60a8\u53ef\u4ee5\u81ea\u5df1\u6784\u5efa\u955c\u50cf\u8ddf\u8e2a\u89e3\u51b3\u65b9\u6848\uff0c\u4f46\u5df2\u7ecf\u6709\u51e0\u79cd\u5546\u4e1a\u4ea7\u54c1\u53ef\u4ee5\u5f00\u7bb1\u5373\u7528\u5730\u63d0\u4f9b\u6b64\u529f\u80fd\u548c\u5176\u4ed6\u9ad8\u7ea7\u529f\u80fd\uff0c\u5305\u62ec\uff1a</p> <ul> <li>Grype</li> <li>Palo Alto - Prisma Cloud (twistcli)</li> <li>Aqua</li> <li>Kubei</li> <li>Trivy</li> <li>Snyk</li> </ul> <p>Kubernetes \u9a8c\u8bc1 webhook \u4e5f\u53ef\u7528\u4e8e\u9a8c\u8bc1\u955c\u50cf\u662f\u5426\u6ca1\u6709\u5173\u952e\u6f0f\u6d1e\u3002\u9a8c\u8bc1 webhook \u5728 Kubernetes API \u4e4b\u524d\u88ab\u8c03\u7528\u3002\u5b83\u4eec\u901a\u5e38\u7528\u4e8e\u62d2\u7edd\u4e0d\u7b26\u5408 webhook \u4e2d\u5b9a\u4e49\u7684\u9a8c\u8bc1\u6807\u51c6\u7684\u8bf7\u6c42\u3002\u8fd9\u662f\u4e00\u4e2a\u65e0\u670d\u52a1\u5668 webhook \u7684\u793a\u4f8b\uff0c\u5b83\u8c03\u7528 ECR describeImageScanFindings API \u6765\u786e\u5b9a pod \u662f\u5426\u6b63\u5728\u62c9\u53d6\u6709\u5173\u952e\u6f0f\u6d1e\u7684\u955c\u50cf\u3002\u5982\u679c\u53d1\u73b0\u6f0f\u6d1e\uff0cpod \u5c06\u88ab\u62d2\u7edd\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709 CVE \u5217\u8868\u7684\u4e8b\u4ef6\u6d88\u606f\u3002</p>"},{"location":"zh/security/docs/image/#_6","title":"\u4f7f\u7528\u8ba4\u8bc1\u6765\u9a8c\u8bc1\u5de5\u4ef6\u5b8c\u6574\u6027","text":"<p>\u8ba4\u8bc1\u662f\u4e00\u4e2a\u52a0\u5bc6\u7b7e\u540d\u7684\"\u58f0\u660e\",\u58f0\u660e\u67d0\u4e9b\u4e8b\u60c5 - \u4e00\u4e2a\"\u8c13\u8bcd\",\u4f8b\u5982\u7ba1\u9053\u8fd0\u884c\u6216 SBOM \u6216\u6f0f\u6d1e\u626b\u63cf\u62a5\u544a\uff0c\u5173\u4e8e\u53e6\u4e00\u4ef6\u4e8b - \u4e00\u4e2a\"\u4e3b\u9898\"\u5373\u5bb9\u5668\u955c\u50cf\u662f\u771f\u5b9e\u7684\u3002</p> <p>\u8ba4\u8bc1\u5e2e\u52a9\u7528\u6237\u9a8c\u8bc1\u5de5\u4ef6\u662f\u5426\u6765\u81ea\u8f6f\u4ef6\u4f9b\u5e94\u94fe\u4e2d\u7684\u53ef\u4fe1\u6765\u6e90\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u4f7f\u7528\u5bb9\u5668\u955c\u50cf\u800c\u4e0d\u77e5\u9053\u8be5\u955c\u50cf\u4e2d\u5305\u542b\u4e86\u54ea\u4e9b\u8f6f\u4ef6\u7ec4\u4ef6\u6216\u4f9d\u8d56\u9879\u3002\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u4fe1\u4efb\u5bb9\u5668\u955c\u50cf\u7684\u751f\u4ea7\u8005\u6240\u8bf4\u7684\u5173\u4e8e\u5b58\u5728\u54ea\u4e9b\u8f6f\u4ef6\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u751f\u4ea7\u8005\u7684\u8ba4\u8bc1\u6765\u4f9d\u8d56\u8be5\u5de5\u4ef6\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u5b89\u5168\u5730\u5728\u5de5\u4f5c\u6d41\u4e2d\u4f7f\u7528\u8be5\u5de5\u4ef6\uff0c\u800c\u4e0d\u5fc5\u81ea\u5df1\u8fdb\u884c\u5206\u6790\u3002</p> <ul> <li>\u53ef\u4ee5\u4f7f\u7528 AWS Signer \u6216 Sigstore cosign \u521b\u5efa\u8ba4\u8bc1\u3002</li> <li>Kubernetes \u51c6\u5165\u63a7\u5236\u5668\u5982 Kyverno \u53ef\u7528\u4e8e\u9a8c\u8bc1\u8ba4\u8bc1\u3002</li> <li>\u53c2\u8003\u8fd9\u4e2a\u7814\u8ba8\u4f1a\u4e86\u89e3\u6709\u5173\u5728 AWS \u4e0a\u4f7f\u7528\u5f00\u6e90\u5de5\u5177\u7684\u8f6f\u4ef6\u4f9b\u5e94\u94fe\u7ba1\u7406\u6700\u4f73\u5b9e\u8df5\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u5305\u62ec\u4e3a\u5bb9\u5668\u955c\u50cf\u521b\u5efa\u548c\u9644\u52a0\u8ba4\u8bc1\u7684\u4e3b\u9898\u3002</li> </ul>"},{"location":"zh/security/docs/image/#ecr-iam","title":"\u4e3a ECR \u5b58\u50a8\u5e93\u521b\u5efa IAM \u7b56\u7565","text":"<p>\u5982\u4eca\uff0c\u5728\u5171\u4eab AWS \u8d26\u6237\u4e2d\u6709\u591a\u4e2a\u5f00\u53d1\u56e2\u961f\u72ec\u7acb\u8fd0\u4f5c\u5e76\u4e0d\u7f55\u89c1\u3002\u5982\u679c\u8fd9\u4e9b\u56e2\u961f\u4e0d\u9700\u8981\u5171\u4eab\u8d44\u4ea7\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u521b\u5efa\u4e00\u7ec4 IAM \u7b56\u7565\u6765\u9650\u5236\u6bcf\u4e2a\u56e2\u961f\u53ef\u4ee5\u4e0e\u4e4b\u4ea4\u4e92\u7684\u5b58\u50a8\u5e93\u3002\u5b9e\u73b0\u8fd9\u4e00\u70b9\u7684\u4e00\u4e2a\u597d\u65b9\u6cd5\u662f\u4f7f\u7528 ECR \u547d\u540d\u7a7a\u95f4\u3002\u547d\u540d\u7a7a\u95f4\u662f\u5c06\u7c7b\u4f3c\u7684\u5b58\u50a8\u5e93\u5206\u7ec4\u5728\u4e00\u8d77\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u4f8b\u5982\uff0c\u56e2\u961f A \u7684\u6240\u6709\u6ce8\u518c\u8868\u53ef\u4ee5\u4f7f\u7528 team-a/ \u524d\u7f00\uff0c\u800c\u56e2\u961f B \u7684\u6ce8\u518c\u8868\u53ef\u4ee5\u4f7f\u7528 team-b/ \u524d\u7f00\u3002\u9650\u5236\u8bbf\u95ee\u7684\u7b56\u7565\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AllowPushPull\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ecr:GetDownloadUrlForLayer\",\n        \"ecr:BatchGetImage\",\n        \"ecr:BatchCheckLayerAvailability\",\n        \"ecr:PutImage\",\n        \"ecr:InitiateLayerUpload\",\n        \"ecr:UploadLayerPart\",\n        \"ecr:CompleteLayerUpload\"\n      ],\n      \"Resource\": [\n        \"arn:aws:ecr:&lt;region&gt;:&lt;account_id&gt;:repository/team-a/*\"\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"zh/security/docs/image/#ecr","title":"\u8003\u8651\u4f7f\u7528 ECR \u79c1\u6709\u7aef\u70b9","text":"<p>ECR API \u6709\u4e00\u4e2a\u516c\u5171\u7aef\u70b9\u3002\u56e0\u6b64\uff0c\u53ea\u8981\u8bf7\u6c42\u5df2\u901a\u8fc7 IAM \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\uff0c\u5c31\u53ef\u4ee5\u4ece\u4e92\u8054\u7f51\u8bbf\u95ee ECR \u6ce8\u518c\u8868\u3002\u5bf9\u4e8e\u90a3\u4e9b\u9700\u8981\u5728\u6ca1\u6709\u4e92\u8054\u7f51\u7f51\u5173 (IGW) \u7684\u6c99\u76d2\u73af\u5883\u4e2d\u8fd0\u884c\u7684\u4eba\uff0c\u60a8\u53ef\u4ee5\u4e3a ECR \u914d\u7f6e\u79c1\u6709\u7aef\u70b9\u3002\u521b\u5efa\u79c1\u6709\u7aef\u70b9\u53ef\u4ee5\u8ba9\u60a8\u901a\u8fc7\u79c1\u6709 IP \u5730\u5740\u800c\u4e0d\u662f\u901a\u8fc7\u4e92\u8054\u7f51\u8def\u7531\u6d41\u91cf\u6765\u79c1\u5bc6\u8bbf\u95ee ECR API\u3002\u6709\u5173\u6b64\u4e3b\u9898\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Amazon ECR \u63a5\u53e3 VPC \u7aef\u70b9\u3002</p>"},{"location":"zh/security/docs/image/#ecr_1","title":"\u4e3a ECR \u5b9e\u65bd\u7aef\u70b9\u7b56\u7565","text":"<p>\u9ed8\u8ba4\u7684 ECR \u7aef\u70b9\u7b56\u7565\u5141\u8bb8\u8bbf\u95ee\u8be5\u533a\u57df\u5185\u7684\u6240\u6709 ECR \u5b58\u50a8\u5e93\u3002\u8fd9\u53ef\u80fd\u4f1a\u5141\u8bb8\u653b\u51fb\u8005/\u5185\u90e8\u4eba\u5458\u5c06\u6570\u636e\u6253\u5305\u4e3a\u5bb9\u5668\u955c\u50cf\u5e76\u5c06\u5176\u63a8\u9001\u5230\u53e6\u4e00\u4e2a AWS \u8d26\u6237\u4e2d\u7684\u6ce8\u518c\u8868\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u5916\u6cc4\u3002\u7f13\u89e3\u8fd9\u79cd\u98ce\u9669\u6d89\u53ca\u521b\u5efa\u4e00\u4e2a\u7aef\u70b9\u7b56\u7565\uff0c\u9650\u5236\u5bf9 ECR \u5b58\u50a8\u5e93\u7684 API \u8bbf\u95ee\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u7b56\u7565\u5141\u8bb8\u60a8\u8d26\u6237\u4e2d\u7684\u6240\u6709 AWS \u4e3b\u4f53\u5bf9\u60a8\u7684 ECR \u5b58\u50a8\u5e93\u6267\u884c\u6240\u6709\u64cd\u4f5c\uff1a</p> <pre><code>{\n  \"Statement\": [\n    {\n      \"Sid\": \"LimitECRAccess\",\n      \"Principal\": \"*\",\n      \"Action\": \"*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ecr:&lt;region&gt;:&lt;account_id&gt;:repository/*\"\n    }\n  ]\n}\n</code></pre> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4f7f\u7528\u65b0\u7684 <code>PrincipalOrgID</code> \u5c5e\u6027\u7684\u6761\u4ef6\u6765\u8fdb\u4e00\u6b65\u589e\u5f3a\uff0c\u8fd9\u5c06\u9632\u6b62\u4e0d\u5c5e\u4e8e\u60a8\u7684 AWS \u7ec4\u7ec7\u7684 IAM \u4e3b\u4f53\u63a8\u9001/\u62c9\u53d6\u955c\u50cf\u3002\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 aws:PrincipalOrgID\u3002 \u6211\u4eec\u5efa\u8bae\u5c06\u76f8\u540c\u7684\u7b56\u7565\u5e94\u7528\u4e8e <code>com.amazonaws.&lt;region&gt;.ecr.dkr</code> \u548c <code>com.amazonaws.&lt;region&gt;.ecr.api</code> \u4e24\u4e2a\u7aef\u70b9\u3002 \u7531\u4e8e EKS \u4ece ECR \u4e3a kube-proxy\u3001coredns \u548c aws-node \u62c9\u53d6\u955c\u50cf\uff0c\u60a8\u9700\u8981\u5c06\u6ce8\u518c\u8868\u7684\u8d26\u6237 ID (\u4f8b\u5982 <code>602401143452.dkr.ecr.us-west-2.amazonaws.com/*</code>) \u6dfb\u52a0\u5230\u7aef\u70b9\u7b56\u7565\u4e2d\u8d44\u6e90\u5217\u8868\u4e2d\uff0c\u6216\u4fee\u6539\u7b56\u7565\u4ee5\u5141\u8bb8\u4ece \"*\" \u62c9\u53d6\u5e76\u9650\u5236\u63a8\u9001\u5230\u60a8\u7684\u8d26\u6237 ID\u3002\u4e0b\u8868\u663e\u793a\u4e86 EKS \u955c\u50cf\u6240\u5728\u7684 AWS \u8d26\u6237\u4e0e\u96c6\u7fa4\u533a\u57df\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002</p> \u8d26\u6237\u53f7\u7801 \u533a\u57df 602401143452 \u9664\u4e0b\u9762\u5217\u51fa\u7684\u533a\u57df\u5916\u7684\u6240\u6709\u5546\u4e1a\u533a\u57df --- --- 800184023465 ap-east-1 - \u4e9a\u592a\u5730\u533a(\u9999\u6e2f) 558608220178 me-south-1 - \u4e2d\u4e1c(\u5df4\u6797) 918309763551 cn-north-1 - \u4e2d\u56fd(\u5317\u4eac) 961992271922 cn-northwest-1 - \u4e2d\u56fd(\u5b81\u590f) <p>\u6709\u5173\u4f7f\u7528\u7aef\u70b9\u7b56\u7565\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4f7f\u7528 VPC \u7aef\u70b9\u7b56\u7565\u63a7\u5236\u5bf9 Amazon ECR \u7684\u8bbf\u95ee\u3002</p>"},{"location":"zh/security/docs/image/#ecr_2","title":"\u4e3a ECR \u5b9e\u65bd\u751f\u547d\u5468\u671f\u7b56\u7565","text":"<p>NIST \u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u5b89\u5168\u6307\u5357\u8b66\u544a\u4e86\"\u6ce8\u518c\u8868\u4e2d\u9648\u65e7\u955c\u50cf\"\u7684\u98ce\u9669\uff0c\u6307\u51fa\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u5e94\u8be5\u5220\u9664\u5305\u542b\u6709\u6f0f\u6d1e\u3001\u8fc7\u65f6\u8f6f\u4ef6\u5305\u7684\u65e7\u955c\u50cf\uff0c\u4ee5\u9632\u6b62\u610f\u5916\u90e8\u7f72\u548c\u66b4\u9732\u3002 \u6bcf\u4e2a ECR \u5b58\u50a8\u5e93\u90fd\u53ef\u4ee5\u6709\u4e00\u4e2a\u751f\u547d\u5468\u671f\u7b56\u7565\uff0c\u7528\u4e8e\u8bbe\u7f6e\u955c\u50cf\u8fc7\u671f\u7684\u89c4\u5219\u3002AWS \u5b98\u65b9\u6587\u6863\u63cf\u8ff0\u4e86\u5982\u4f55\u8bbe\u7f6e\u6d4b\u8bd5\u89c4\u5219\u3001\u8bc4\u4f30\u5b83\u4eec\u5e76\u5e94\u7528\u5b83\u4eec\u3002\u5b98\u65b9\u6587\u6863\u4e2d\u6709\u51e0\u4e2a\u751f\u547d\u5468\u671f\u7b56\u7565\u793a\u4f8b,\u663e\u793a\u4e86\u5728\u5b58\u50a8\u5e93\u4e2d\u8fc7\u6ee4\u955c\u50cf\u7684\u4e0d\u540c\u65b9\u5f0f\uff1a</p> <ul> <li>\u6309\u955c\u50cf\u5e74\u9f84\u6216\u8ba1\u6570\u8fc7\u6ee4</li> <li>\u6309\u6807\u8bb0\u6216\u672a\u6807\u8bb0\u955c\u50cf\u8fc7\u6ee4</li> <li>\u6309\u955c\u50cf\u6807\u7b7e\u8fc7\u6ee4\uff0c\u53ef\u4ee5\u5728\u591a\u4e2a\u89c4\u5219\u6216\u5355\u4e2a\u89c4\u5219\u4e2d\u8fdb\u884c</li> </ul> Warning <p>\u5982\u679c\u957f\u671f\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u955c\u50cf\u4ece ECR \u4e2d\u88ab\u6e05\u9664\uff0c\u5728\u91cd\u65b0\u90e8\u7f72\u6216\u6c34\u5e73\u6269\u5c55\u5e94\u7528\u7a0b\u5e8f\u65f6\u53ef\u80fd\u4f1a\u5bfc\u81f4\u955c\u50cf\u62c9\u53d6\u9519\u8bef\u3002\u4f7f\u7528\u955c\u50cf\u751f\u547d\u5468\u671f\u7b56\u7565\u65f6\uff0c\u8bf7\u786e\u4fdd\u60a8\u6709\u826f\u597d\u7684 CI/CD \u5b9e\u8df5\u6765\u4fdd\u6301\u90e8\u7f72\u548c\u5b83\u4eec\u5f15\u7528\u7684\u955c\u50cf\u7684\u6700\u65b0\u72b6\u6001\uff0c\u5e76\u59cb\u7ec8\u521b\u5efa[\u955c\u50cf]\u8fc7\u671f\u89c4\u5219\u4ee5\u8003\u8651\u60a8\u7684\u53d1\u5e03/\u90e8\u7f72\u9891\u7387\u3002</p>"},{"location":"zh/security/docs/image/#_7","title":"\u521b\u5efa\u4e00\u7ec4\u7cbe\u9009\u955c\u50cf","text":"<p>\u4e0e\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u521b\u5efa\u81ea\u5df1\u7684\u955c\u50cf\u4e0d\u540c\uff0c\u8bf7\u8003\u8651\u4e3a\u60a8\u7ec4\u7ec7\u4e2d\u7684\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u5806\u6808\u521b\u5efa\u4e00\u7ec4\u7ecf\u8fc7\u5ba1\u67e5\u7684\u955c\u50cf\u3002\u8fd9\u6837\u505a\uff0c\u5f00\u53d1\u4eba\u5458\u5c31\u53ef\u4ee5\u907f\u514d\u5b66\u4e60\u5982\u4f55\u7f16\u5199 Dockerfile\uff0c\u800c\u4e13\u6ce8\u4e8e\u7f16\u5199\u4ee3\u7801\u3002\u968f\u7740\u66f4\u6539\u5408\u5e76\u5230\u4e3b\u5206\u652f\uff0cCI/CD \u7ba1\u9053\u53ef\u4ee5\u81ea\u52a8\u7f16\u8bd1\u8d44\u4ea7\u3001\u5c06\u5176\u5b58\u50a8\u5728\u5de5\u4ef6\u5b58\u50a8\u5e93\u4e2d\uff0c\u7136\u540e\u5c06\u5de5\u4ef6\u590d\u5236\u5230\u9002\u5f53\u7684\u955c\u50cf\u4e2d\uff0c\u518d\u5c06\u5176\u63a8\u9001\u5230 Docker \u6ce8\u518c\u8868(\u5982 ECR)\u3002\u81f3\u5c11\uff0c\u60a8\u5e94\u8be5\u4e3a\u5f00\u53d1\u4eba\u5458\u521b\u5efa\u4e00\u7ec4\u57fa\u7840\u955c\u50cf\uff0c\u4ee5\u4fbf\u4ed6\u4eec\u521b\u5efa\u81ea\u5df1\u7684 Dockerfile\u3002\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u60a8\u5e0c\u671b\u907f\u514d\u4ece Dockerhub \u62c9\u53d6\u955c\u50cf\uff0c\u56e0\u4e3a 1/ \u60a8\u5e76\u4e0d\u603b\u662f\u77e5\u9053\u955c\u50cf\u4e2d\u5305\u542b\u4ec0\u4e48\uff0c2/ \u5927\u7ea6\u4e94\u5206\u4e4b\u4e00\u7684\u524d 1000 \u4e2a\u955c\u50cf\u5b58\u5728\u6f0f\u6d1e\u3002\u8fd9\u4e9b\u955c\u50cf\u53ca\u5176\u6f0f\u6d1e\u7684\u5217\u8868\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u3002</p>"},{"location":"zh/security/docs/image/#dockerfile-user-root","title":"\u5728 Dockerfile \u4e2d\u6dfb\u52a0 USER \u6307\u4ee4\u4ee5\u975e root \u7528\u6237\u8eab\u4efd\u8fd0\u884c","text":"<p>\u6b63\u5982\u5728 pod \u5b89\u5168\u90e8\u5206\u4e2d\u63d0\u5230\u7684\uff0c\u60a8\u5e94\u8be5\u907f\u514d\u4ee5 root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\u5bb9\u5668\u3002\u867d\u7136\u60a8\u53ef\u4ee5\u5c06\u6b64\u914d\u7f6e\u4e3a podSpec \u7684\u4e00\u90e8\u5206\uff0c\u4f46\u5728 Dockerfile \u4e2d\u4f7f\u7528 <code>USER</code> \u6307\u4ee4\u662f\u4e00\u4e2a\u826f\u597d\u7684\u4e60\u60ef\u3002<code>USER</code> \u6307\u4ee4\u8bbe\u7f6e\u5728 USER \u6307\u4ee4\u4e4b\u540e\u51fa\u73b0\u7684 <code>RUN</code>\u3001<code>ENTRYPOINT</code> \u6216 <code>CMD</code> \u6307\u4ee4\u65f6\u8981\u4f7f\u7528\u7684 UID\u3002</p>"},{"location":"zh/security/docs/image/#dockerfile-lint","title":"\u5bf9 Dockerfile \u8fdb\u884c lint \u68c0\u67e5","text":"<p>Lint \u68c0\u67e5\u53ef\u7528\u4e8e\u9a8c\u8bc1\u60a8\u7684 Dockerfile \u662f\u5426\u7b26\u5408\u521b\u5efa\u5b89\u5168\u955c\u50cf\u7684\u4e00\u7ec4\u9884\u5b9a\u4e49\u51c6\u5219\uff0c\u4f8b\u5982\u5305\u542b <code>USER</code> \u6307\u4ee4\u6216\u8981\u6c42\u6240\u6709\u955c\u50cf\u90fd\u88ab\u6807\u8bb0\u3002dockerfile_lint \u662f RedHat \u7684\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u5b83\u53ef\u4ee5\u9a8c\u8bc1\u5e38\u89c1\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u5e76\u5305\u542b\u4e00\u4e2a\u89c4\u5219\u5f15\u64ce\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u6784\u5efa\u81ea\u5df1\u7684\u89c4\u5219\u6765\u5bf9 Dockerfile \u8fdb\u884c lint \u68c0\u67e5\u3002\u5b83\u53ef\u4ee5\u88ab\u7eb3\u5165 CI \u7ba1\u9053\uff0c\u56e0\u6b64\u8fdd\u53cd\u89c4\u5219\u7684 Dockerfile \u6784\u5efa\u5c06\u81ea\u52a8\u5931\u8d25\u3002</p>"},{"location":"zh/security/docs/image/#scratch","title":"\u4ece Scratch \u6784\u5efa\u955c\u50cf","text":"<p>\u51cf\u5c0f\u5bb9\u5668\u955c\u50cf\u7684\u653b\u51fb\u9762\u5e94\u8be5\u662f\u6784\u5efa\u955c\u50cf\u65f6\u7684\u4e3b\u8981\u76ee\u6807\u3002\u5b9e\u73b0\u8fd9\u4e00\u70b9\u7684\u7406\u60f3\u65b9\u5f0f\u662f\u521b\u5efa\u6700\u5c0f\u955c\u50cf\uff0c\u8fd9\u4e9b\u955c\u50cf\u4e0d\u5305\u542b\u53ef\u7528\u4e8e\u5229\u7528\u6f0f\u6d1e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u5e78\u8fd0\u7684\u662f\uff0cDocker \u6709\u4e00\u79cd\u4ece <code>scratch</code> \u521b\u5efa\u955c\u50cf\u7684\u673a\u5236\u3002\u5bf9\u4e8e\u50cf Go \u8fd9\u6837\u7684\u8bed\u8a00\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u9759\u6001\u94fe\u63a5\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u5728 Dockerfile \u4e2d\u5f15\u7528\u5b83\uff0c\u5982\u4e0b\u4f8b\u6240\u793a\uff1a</p> <pre><code>############################\n# \u6b65\u9aa4 1 \u6784\u5efa\u53ef\u6267\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6\n############################\nFROM golang:alpine AS builder# \u5b89\u88c5 git\u3002\n# \u83b7\u53d6\u4f9d\u8d56\u9879\u9700\u8981 Git\u3002\nRUN apk update &amp;&amp; apk add --no-cache gitWORKDIR $GOPATH/src/mypackage/myapp/COPY . . # \u83b7\u53d6\u4f9d\u8d56\u9879\u3002\n# \u4f7f\u7528 go get\u3002\nRUN go get -d -v# \u6784\u5efa\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\nRUN go build -o /go/bin/hello\n\n############################\n# \u6b65\u9aa4 2 \u6784\u5efa\u5c0f\u578b\u955c\u50cf\n############################\nFROM scratch# \u590d\u5236\u6211\u4eec\u7684\u9759\u6001\u53ef\u6267\u884c\u6587\u4ef6\u3002\nCOPY --from=builder /go/bin/hello /go/bin/hello# \u8fd0\u884c hello \u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\nENTRYPOINT [\"/go/bin/hello\"]\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u53ea\u5305\u542b\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u5bb9\u5668\u955c\u50cf\uff0c\u4f7f\u5176\u6781\u5176\u5b89\u5168\u3002</p>"},{"location":"zh/security/docs/image/#ecr_3","title":"\u4f7f\u7528 ECR \u7684\u4e0d\u53ef\u53d8\u6807\u7b7e","text":"<p>\u4e0d\u53ef\u53d8\u6807\u7b7e\u4f1a\u5f3a\u5236\u60a8\u5728\u6bcf\u6b21\u63a8\u9001\u5230\u955c\u50cf\u5b58\u50a8\u5e93\u65f6\u66f4\u65b0\u955c\u50cf\u6807\u7b7e\u3002\u8fd9\u53ef\u4ee5\u963b\u6b62\u653b\u51fb\u8005\u5728\u4e0d\u66f4\u6539\u955c\u50cf\u6807\u7b7e\u7684\u60c5\u51b5\u4e0b\u7528\u6076\u610f\u7248\u672c\u8986\u76d6\u955c\u50cf\u3002\u6b64\u5916\uff0c\u5b83\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u79cd\u8f7b\u677e\u3001\u552f\u4e00\u5730\u6807\u8bc6\u955c\u50cf\u7684\u65b9\u5f0f\u3002</p>"},{"location":"zh/security/docs/image/#sbom_1","title":"\u4e3a\u955c\u50cf\u3001SBOM\u3001\u7ba1\u9053\u8fd0\u884c\u548c\u6f0f\u6d1e\u62a5\u544a\u7b7e\u540d","text":"<p>\u5f53 Docker \u521a\u63a8\u51fa\u65f6\uff0c\u6ca1\u6709\u52a0\u5bc6\u6a21\u578b\u6765\u9a8c\u8bc1\u5bb9\u5668\u955c\u50cf\u3002\u5728 v2 \u4e2d\uff0cDocker \u4e3a\u955c\u50cf\u6e05\u5355\u6dfb\u52a0\u4e86\u6458\u8981\u3002\u8fd9\u5141\u8bb8\u5bf9\u955c\u50cf\u914d\u7f6e\u8fdb\u884c\u54c8\u5e0c\u8fd0\u7b97\uff0c\u5e76\u4f7f\u7528\u54c8\u5e0c\u751f\u6210\u955c\u50cf ID\u3002\u542f\u7528\u955c\u50cf\u7b7e\u540d\u540e\uff0cDocker \u5f15\u64ce\u5c06\u9a8c\u8bc1\u6e05\u5355\u7684\u7b7e\u540d\uff0c\u786e\u4fdd\u5185\u5bb9\u662f\u7531\u53ef\u4fe1\u6765\u6e90\u751f\u6210\u7684\uff0c\u5e76\u4e14\u6ca1\u6709\u53d1\u751f\u4efb\u4f55\u7be1\u6539\u3002\u4e0b\u8f7d\u6bcf\u4e00\u5c42\u540e\uff0c\u5f15\u64ce\u90fd\u4f1a\u9a8c\u8bc1\u8be5\u5c42\u7684\u6458\u8981\uff0c\u786e\u4fdd\u5185\u5bb9\u4e0e\u6e05\u5355\u4e2d\u6307\u5b9a\u7684\u5185\u5bb9\u76f8\u5339\u914d\u3002\u955c\u50cf\u7b7e\u540d\u5b9e\u9645\u4e0a\u5141\u8bb8\u60a8\u521b\u5efa\u4e00\u4e2a\u5b89\u5168\u7684\u4f9b\u5e94\u94fe\uff0c\u901a\u8fc7\u9a8c\u8bc1\u4e0e\u955c\u50cf\u5173\u8054\u7684\u6570\u5b57\u7b7e\u540d\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 AWS Signer \u6216 Sigstore Cosign \u4e3a\u5bb9\u5668\u955c\u50cf\u7b7e\u540d\uff0c\u4e3a SBOM\u3001\u6f0f\u6d1e\u626b\u63cf\u62a5\u544a\u548c\u7ba1\u9053\u8fd0\u884c\u62a5\u544a\u521b\u5efa\u8ba4\u8bc1\u3002\u8fd9\u4e9b\u8ba4\u8bc1\u786e\u4fdd\u4e86\u955c\u50cf\u7684\u53ef\u4fe1\u5ea6\u548c\u5b8c\u6574\u6027\uff0c\u786e\u5b9e\u662f\u7531\u53ef\u4fe1\u7ba1\u9053\u521b\u5efa\u7684\uff0c\u6ca1\u6709\u4efb\u4f55\u5e72\u6270\u6216\u7be1\u6539\uff0c\u5e76\u4e14\u53ea\u5305\u542b\u7531\u955c\u50cf\u53d1\u5e03\u8005\u9a8c\u8bc1\u548c\u4fe1\u4efb\u7684\u8f6f\u4ef6\u7ec4\u4ef6(\u5728 SBOM \u4e2d\u8bb0\u5f55)\u3002\u8fd9\u4e9b\u8ba4\u8bc1\u53ef\u4ee5\u9644\u52a0\u5230\u5bb9\u5668\u955c\u50cf\u4e0a\u5e76\u63a8\u9001\u5230\u5b58\u50a8\u5e93\u3002</p> <p>\u5728\u4e0b\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5c06\u770b\u5230\u5982\u4f55\u4f7f\u7528\u7ecf\u8fc7\u8ba4\u8bc1\u7684\u5de5\u4ef6\u8fdb\u884c\u5ba1\u8ba1\u548c\u51c6\u5165\u63a7\u5236\u5668\u9a8c\u8bc1\u3002</p>"},{"location":"zh/security/docs/image/#kubernetes","title":"\u4f7f\u7528 Kubernetes \u51c6\u5165\u63a7\u5236\u5668\u8fdb\u884c\u955c\u50cf\u5b8c\u6574\u6027\u9a8c\u8bc1","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u52a8\u6001\u51c6\u5165\u63a7\u5236\u5668\u4ee5\u81ea\u52a8\u5316\u65b9\u5f0f\u5728\u5c06\u955c\u50cf\u90e8\u7f72\u5230\u76ee\u6807 Kubernetes \u96c6\u7fa4\u4e4b\u524d\u9a8c\u8bc1\u955c\u50cf\u7b7e\u540d\u3001\u7ecf\u8fc7\u8ba4\u8bc1\u7684\u5de5\u4ef6\uff0c\u5e76\u4e14\u4ec5\u5728\u5de5\u4ef6\u7684\u5b89\u5168\u5143\u6570\u636e\u7b26\u5408\u51c6\u5165\u63a7\u5236\u5668\u7b56\u7565\u65f6\u624d\u5141\u8bb8\u90e8\u7f72\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a\u7b56\u7565\u6765\u52a0\u5bc6\u9a8c\u8bc1\u955c\u50cf\u7b7e\u540d\u3001\u7ecf\u8fc7\u8ba4\u8bc1\u7684 SBOM\u3001\u7ecf\u8fc7\u8ba4\u8bc1\u7684\u7ba1\u9053\u8fd0\u884c\u62a5\u544a\u6216\u7ecf\u8fc7\u8ba4\u8bc1\u7684 CVE \u626b\u63cf\u62a5\u544a\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u7b56\u7565\u4e2d\u7f16\u5199\u6761\u4ef6\u6765\u68c0\u67e5\u62a5\u544a\u4e2d\u7684\u6570\u636e\uff0c\u4f8b\u5982 CVE \u626b\u63cf\u4e0d\u5e94\u8be5\u6709\u4efb\u4f55\u5173\u952e CVE\u3002\u53ea\u6709\u6ee1\u8db3\u8fd9\u4e9b\u6761\u4ef6\u7684\u955c\u50cf\u624d\u4f1a\u88ab\u51c6\u5165\u63a7\u5236\u5668\u5141\u8bb8\u90e8\u7f72\uff0c\u6240\u6709\u5176\u4ed6\u90e8\u7f72\u90fd\u5c06\u88ab\u62d2\u7edd\u3002</p> <p>\u51c6\u5165\u63a7\u5236\u5668\u7684\u793a\u4f8b\u5305\u62ec\uff1a</p> <ul> <li>Kyverno</li> <li>OPA Gatekeeper</li> <li>Portieris</li> <li>Ratify</li> <li>Kritis</li> <li>Grafeas \u6559\u7a0b</li> <li>Voucher</li> </ul>"},{"location":"zh/security/docs/image/#_8","title":"\u66f4\u65b0\u5bb9\u5668\u955c\u50cf\u4e2d\u7684\u8f6f\u4ef6\u5305","text":"<p>\u60a8\u5e94\u8be5\u5728 Dockerfile \u4e2d\u5305\u542b RUN <code>apt-get update &amp;&amp; apt-get upgrade</code> \u6765\u5347\u7ea7\u955c\u50cf\u4e2d\u7684\u8f6f\u4ef6\u5305\u3002\u867d\u7136\u5347\u7ea7\u9700\u8981\u4ee5 root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\uff0c\u4f46\u8fd9\u53d1\u751f\u5728\u955c\u50cf\u6784\u5efa\u9636\u6bb5\u3002\u5e94\u7528\u7a0b\u5e8f\u4e0d\u9700\u8981\u4ee5 root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\u3002\u60a8\u53ef\u4ee5\u5b89\u88c5\u66f4\u65b0\uff0c\u7136\u540e\u5207\u6362\u5230\u5176\u4ed6\u7528\u6237\u4f7f\u7528 USER \u6307\u4ee4\u3002\u5982\u679c\u60a8\u7684\u57fa\u7840\u955c\u50cf\u4ee5\u975e root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\uff0c\u8bf7\u5207\u6362\u5230 root \u7528\u6237\uff0c\u7136\u540e\u5207\u6362\u56de\u6765;\u4e0d\u8981\u5b8c\u5168\u4f9d\u8d56\u57fa\u7840\u955c\u50cf\u7684\u7ef4\u62a4\u8005\u6765\u5b89\u88c5\u6700\u65b0\u7684\u5b89\u5168\u66f4\u65b0\u3002</p> <p>\u8fd0\u884c <code>apt-get clean</code> \u53ef\u4ee5\u4ece <code>/var/cache/apt/archives/</code> \u4e2d\u5220\u9664\u5b89\u88c5\u7a0b\u5e8f\u6587\u4ef6\u3002\u5b89\u88c5\u8f6f\u4ef6\u5305\u540e\uff0c\u60a8\u8fd8\u53ef\u4ee5\u8fd0\u884c <code>rm -rf /var/lib/apt/lists/*</code>\u3002\u8fd9\u5c06\u5220\u9664\u53ef\u5b89\u88c5\u8f6f\u4ef6\u5305\u7684\u7d22\u5f15\u6587\u4ef6\u6216\u5217\u8868\u3002\u8bf7\u6ce8\u610f\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8f6f\u4ef6\u5305\u7ba1\u7406\u5668\uff0c\u8fd9\u4e9b\u547d\u4ee4\u53ef\u80fd\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u4f8b\u5982\uff1a</p> <pre><code>RUN apt-get update &amp;&amp; apt-get install -y \\\n    curl \\\n    git \\\n    libsqlite3-dev \\\n    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre>"},{"location":"zh/security/docs/image/#_9","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a - \u955c\u50cf\u5b89\u5168</li> <li>docker-slim \u6784\u5efa\u5b89\u5168\u7684\u6700\u5c0f\u955c\u50cf</li> <li>dockle \u9a8c\u8bc1\u60a8\u7684 Dockerfile \u662f\u5426\u7b26\u5408\u521b\u5efa\u5b89\u5168\u955c\u50cf\u7684\u6700\u4f73\u5b9e\u8df5</li> <li>dockerfile-lint Dockerfile \u7684\u57fa\u4e8e\u89c4\u5219\u7684 lint \u5de5\u5177</li> <li>hadolint \u4e00\u4e2a\u667a\u80fd dockerfile lint \u5de5\u5177</li> <li>Gatekeeper \u548c OPA \u57fa\u4e8e\u7b56\u7565\u7684\u51c6\u5165\u63a7\u5236\u5668</li> <li>Kyverno \u4e00\u4e2a\u539f\u751f Kubernetes \u7b56\u7565\u5f15\u64ce</li> <li>in-toto \u5141\u8bb8\u7528\u6237\u9a8c\u8bc1\u4f9b\u5e94\u94fe\u4e2d\u7684\u6b65\u9aa4\u662f\u5426\u6709\u610f\u6267\u884c\uff0c\u4ee5\u53ca\u6b65\u9aa4\u662f\u5426\u7531\u6b63\u786e\u7684\u53c2\u4e0e\u8005\u6267\u884c</li> <li>Notary \u4e00\u4e2a\u7528\u4e8e\u7b7e\u540d\u5bb9\u5668\u955c\u50cf\u7684\u9879\u76ee</li> <li>Notary v2</li> <li>Grafeas \u4e00\u4e2a\u5f00\u653e\u7684\u5de5\u4ef6\u5143\u6570\u636e API\uff0c\u7528\u4e8e\u5ba1\u8ba1\u548c\u7ba1\u7406\u60a8\u7684\u8f6f\u4ef6\u4f9b\u5e94\u94fe</li> <li>SUSE \u7684 NeuVector \u5f00\u6e90\u3001\u96f6\u4fe1\u4efb\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\uff0c\u63d0\u4f9b\u5bb9\u5668\u3001\u955c\u50cf\u548c\u6ce8\u518c\u8868\u626b\u63cf\u4ee5\u67e5\u627e\u6f0f\u6d1e\u3001\u673a\u5bc6\u548c\u5408\u89c4\u6027\u95ee\u9898\u3002</li> </ul>"},{"location":"zh/security/docs/incidents/","title":"\u4e8b\u4ef6\u54cd\u5e94\u548c\u53d6\u8bc1","text":"<p>\u60a8\u5feb\u901f\u5e94\u5bf9\u4e8b\u4ef6\u7684\u80fd\u529b\u53ef\u4ee5\u5e2e\u52a9\u6700\u5c0f\u5316\u8fdd\u89c4\u9020\u6210\u7684\u635f\u5bb3\u3002\u62e5\u6709\u53ef\u9760\u7684\u8b66\u62a5\u7cfb\u7edf\u6765\u8b66\u544a\u60a8\u53ef\u7591\u884c\u4e3a\u662f\u826f\u597d\u4e8b\u4ef6\u54cd\u5e94\u8ba1\u5212\u7684\u7b2c\u4e00\u6b65\u3002\u5f53\u53d1\u751f\u4e8b\u4ef6\u65f6\uff0c\u60a8\u5fc5\u987b\u5feb\u901f\u51b3\u5b9a\u662f\u9500\u6bc1\u5e76\u66ff\u6362\u53d7\u5f71\u54cd\u7684\u5bb9\u5668\uff0c\u8fd8\u662f\u9694\u79bb\u5e76\u68c0\u67e5\u5bb9\u5668\u3002\u5982\u679c\u60a8\u9009\u62e9\u9694\u79bb\u5bb9\u5668\u4f5c\u4e3a\u53d6\u8bc1\u8c03\u67e5\u548c\u6839\u672c\u539f\u56e0\u5206\u6790\u7684\u4e00\u90e8\u5206\uff0c\u90a3\u4e48\u5e94\u8be5\u9075\u5faa\u4ee5\u4e0b\u4e00\u7cfb\u5217\u6d3b\u52a8\uff1a</p>"},{"location":"zh/security/docs/incidents/#_2","title":"\u793a\u4f8b\u4e8b\u4ef6\u54cd\u5e94\u8ba1\u5212","text":""},{"location":"zh/security/docs/incidents/#pod","title":"\u8bc6\u522b\u8fdd\u89c4\u7684 Pod \u548c\u5de5\u4f5c\u8282\u70b9","text":"<p>\u60a8\u7684\u9996\u8981\u884c\u52a8\u5e94\u8be5\u662f\u9694\u79bb\u635f\u5bb3\u3002\u9996\u5148\u786e\u5b9a\u8fdd\u89c4\u53d1\u751f\u7684\u4f4d\u7f6e\uff0c\u5e76\u5c06\u8be5 Pod \u53ca\u5176\u8282\u70b9\u4e0e\u5176\u4f59\u57fa\u7840\u67b6\u6784\u9694\u79bb\u3002</p>"},{"location":"zh/security/docs/incidents/#pod_1","title":"\u4f7f\u7528\u5de5\u4f5c\u8d1f\u8f7d\u540d\u79f0\u8bc6\u522b\u8fdd\u89c4\u7684 Pod \u548c\u5de5\u4f5c\u8282\u70b9","text":"<p>\u5982\u679c\u60a8\u77e5\u9053\u8fdd\u89c4 pod \u7684\u540d\u79f0\u548c\u547d\u540d\u7a7a\u95f4\uff0c\u60a8\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8bc6\u522b\u8fd0\u884c\u8be5 pod \u7684\u5de5\u4f5c\u8282\u70b9\uff1a</p> <pre><code>kubectl get pods &lt;name&gt; --namespace &lt;namespace&gt; -o=jsonpath='{.spec.nodeName}{\"\\n\"}'   \n</code></pre> <p>\u5982\u679c Workload Resource \u5982 Deployment \u88ab\u5165\u4fb5\uff0c\u5219\u5f88\u53ef\u80fd\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u7684\u6240\u6709 pod \u90fd\u88ab\u5165\u4fb5\u3002\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5217\u51fa\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u7684\u6240\u6709 pod \u53ca\u5176\u8fd0\u884c\u7684\u8282\u70b9\uff1a</p> <pre><code>selector=$(kubectl get deployments &lt;name&gt; \\\n --namespace &lt;namespace&gt; -o json | jq -j \\\n'.spec.selector.matchLabels | to_entries | .[] | \"\\(.key)=\\(.value)\"')\n\nkubectl get pods --namespace &lt;namespace&gt; --selector=$selector \\\n-o json | jq -r '.items[] | \"\\(.metadata.name) \\(.spec.nodeName)\"'\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u9002\u7528\u4e8e deployments\u3002\u60a8\u53ef\u4ee5\u5bf9\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90(\u5982 replicasets\u3001statefulsets \u7b49)\u8fd0\u884c\u76f8\u540c\u547d\u4ee4\u3002</p>"},{"location":"zh/security/docs/incidents/#pod_2","title":"\u4f7f\u7528\u670d\u52a1\u8d26\u6237\u540d\u79f0\u8bc6\u522b\u8fdd\u89c4\u7684 Pod \u548c\u5de5\u4f5c\u8282\u70b9","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u67d0\u4e2a\u670d\u52a1\u8d26\u6237\u88ab\u5165\u4fb5\u3002\u4f7f\u7528\u8be5\u670d\u52a1\u8d26\u6237\u7684 pod \u5f88\u53ef\u80fd\u88ab\u5165\u4fb5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8bc6\u522b\u4f7f\u7528\u8be5\u670d\u52a1\u8d26\u6237\u7684\u6240\u6709 pod \u53ca\u5176\u8fd0\u884c\u7684\u8282\u70b9\uff1a</p> <pre><code>kubectl get pods -o json --namespace &lt;namespace&gt; | \\\n    jq -r '.items[] |\n    select(.spec.serviceAccount == \"&lt;service account name&gt;\") |\n    \"\\(.metadata.name) \\(.spec.nodeName)\"'\n</code></pre>"},{"location":"zh/security/docs/incidents/#pod_3","title":"\u8bc6\u522b\u4f7f\u7528\u4e86\u6613\u53d7\u653b\u51fb\u6216\u88ab\u5165\u4fb5\u7684\u955c\u50cf\u7684 Pod \u548c\u5de5\u4f5c\u8282\u70b9","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u5728\u96c6\u7fa4\u4e0a\u7684 pod \u4e2d\u4f7f\u7528\u7684\u5bb9\u5668\u955c\u50cf\u662f\u6076\u610f\u6216\u88ab\u5165\u4fb5\u7684\u3002\u5982\u679c\u53d1\u73b0\u5bb9\u5668\u955c\u50cf\u5305\u542b\u6076\u610f\u8f6f\u4ef6\u3001\u662f\u5df2\u77e5\u7684\u4e0d\u826f\u955c\u50cf\u6216\u5b58\u5728\u88ab\u5229\u7528\u7684 CVE\uff0c\u5219\u8be5\u5bb9\u5668\u955c\u50cf\u5c31\u662f\u6076\u610f\u6216\u88ab\u5165\u4fb5\u7684\u3002\u60a8\u5e94\u8be5\u5c06\u4f7f\u7528\u8be5\u5bb9\u5668\u955c\u50cf\u7684\u6240\u6709 pod \u89c6\u4e3a\u88ab\u5165\u4fb5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8bc6\u522b\u4f7f\u7528\u8be5\u955c\u50cf\u7684 pod \u53ca\u5176\u8fd0\u884c\u7684\u8282\u70b9\uff1a</p> <pre><code>IMAGE=&lt;\u6076\u610f/\u88ab\u5165\u4fb5\u955c\u50cf\u7684\u540d\u79f0&gt;\n\nkubectl get pods -o json --all-namespaces | \\\n    jq -r --arg image \"$IMAGE\" '.items[] | \n    select(.spec.containers[] | .image == $image) | \n    \"\\(.metadata.name) \\(.metadata.namespace) \\(.spec.nodeName)\"'\n</code></pre>"},{"location":"zh/security/docs/incidents/#pod_4","title":"\u901a\u8fc7\u521b\u5efa\u62d2\u7edd\u6240\u6709\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u7684\u7f51\u7edc\u7b56\u7565\u6765\u9694\u79bb Pod","text":"<p>\u62d2\u7edd\u6240\u6709\u6d41\u91cf\u7684\u89c4\u5219\u53ef\u4ee5\u5e2e\u52a9\u963b\u6b62\u5df2\u7ecf\u53d1\u751f\u7684\u653b\u51fb\uff0c\u65b9\u6cd5\u662f\u5207\u65ad\u4e0e pod \u7684\u6240\u6709\u8fde\u63a5\u3002\u4ee5\u4e0b\u7f51\u7edc\u7b56\u7565\u5c06\u5e94\u7528\u4e8e\u5e26\u6709\u6807\u7b7e <code>app=web</code> \u7684 pod\u3002</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\nspec:\n  podSelector:\n    matchLabels: \n      app: web\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre> <p>Attention</p> <p>\u5982\u679c\u653b\u51fb\u8005\u5df2\u83b7\u5f97\u5bf9\u5e95\u5c42\u4e3b\u673a\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u7f51\u7edc\u7b56\u7565\u53ef\u80fd\u65e0\u6548\u3002\u5982\u679c\u60a8\u6000\u7591\u53d1\u751f\u4e86\u8fd9\u79cd\u60c5\u51b5\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 AWS \u5b89\u5168\u7ec4 \u5c06\u53d7\u635f\u4e3b\u673a\u4e0e\u5176\u4ed6\u4e3b\u673a\u9694\u79bb\u3002\u66f4\u6539\u4e3b\u673a\u7684\u5b89\u5168\u7ec4\u65f6\uff0c\u8bf7\u6ce8\u610f\u5b83\u5c06\u5f71\u54cd\u5728\u8be5\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u6240\u6709\u5bb9\u5668\u3002</p>"},{"location":"zh/security/docs/incidents/#pod_5","title":"\u5982\u6709\u5fc5\u8981\uff0c\u64a4\u9500\u5206\u914d\u7ed9 pod \u6216\u5de5\u4f5c\u8282\u70b9\u7684\u4e34\u65f6\u5b89\u5168\u51ed\u8bc1","text":"<p>\u5982\u679c\u5de5\u4f5c\u8282\u70b9\u88ab\u5206\u914d\u4e86\u5141\u8bb8 Pod \u8bbf\u95ee\u5176\u4ed6 AWS \u8d44\u6e90\u7684 IAM \u89d2\u8272\uff0c\u8bf7\u4ece\u5b9e\u4f8b\u4e2d\u5220\u9664\u8fd9\u4e9b\u89d2\u8272\uff0c\u4ee5\u9632\u6b62\u653b\u51fb\u8fdb\u4e00\u6b65\u6269\u5927\u3002\u540c\u6837\uff0c\u5982\u679c Pod \u88ab\u5206\u914d\u4e86 IAM \u89d2\u8272\uff0c\u8bf7\u8bc4\u4f30\u662f\u5426\u53ef\u4ee5\u5b89\u5168\u5730\u4ece\u8be5\u89d2\u8272\u4e2d\u5220\u9664 IAM \u7b56\u7565\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u3002</p>"},{"location":"zh/security/docs/incidents/#_3","title":"\u5c01\u9501\u5de5\u4f5c\u8282\u70b9","text":"<p>\u901a\u8fc7\u5c01\u9501\u53d7\u5f71\u54cd\u7684\u5de5\u4f5c\u8282\u70b9\uff0c\u60a8\u6b63\u5728\u901a\u77e5\u8c03\u5ea6\u7a0b\u5e8f\u907f\u514d\u5c06 pod \u8c03\u5ea6\u5230\u53d7\u5f71\u54cd\u7684\u8282\u70b9\u3002\u8fd9\u5c06\u5141\u8bb8\u60a8\u79fb\u9664\u8282\u70b9\u8fdb\u884c\u53d6\u8bc1\u7814\u7a76\uff0c\u800c\u4e0d\u4f1a\u4e2d\u65ad\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u3002</p> <p>Info</p> <p>\u6b64\u6307\u5bfc\u4e0d\u9002\u7528\u4e8e Fargate\uff0c\u56e0\u4e3a\u6bcf\u4e2a Fargate pod \u90fd\u5728\u81ea\u5df1\u7684\u6c99\u7bb1\u73af\u5883\u4e2d\u8fd0\u884c\u3002\u76f8\u53cd\uff0c\u901a\u8fc7\u5e94\u7528\u62d2\u7edd\u6240\u6709\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u7684\u7f51\u7edc\u7b56\u7565\u6765\u9694\u79bb\u53d7\u5f71\u54cd\u7684 Fargate pod\u3002</p>"},{"location":"zh/security/docs/incidents/#_4","title":"\u5bf9\u53d7\u5f71\u54cd\u7684\u5de5\u4f5c\u8282\u70b9\u542f\u7528\u7ec8\u6b62\u4fdd\u62a4","text":"<p>\u653b\u51fb\u8005\u53ef\u80fd\u8bd5\u56fe\u901a\u8fc7\u7ec8\u6b62\u53d7\u5f71\u54cd\u7684\u8282\u70b9\u6765\u62b9\u53bb\u4ed6\u4eec\u7684\u7f6a\u884c\u3002\u542f\u7528\u7ec8\u6b62\u4fdd\u62a4\u53ef\u4ee5\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u3002\u5b9e\u4f8b\u7f29\u51cf\u4fdd\u62a4\u5c06\u4fdd\u62a4\u8282\u70b9\u514d\u53d7\u7f29\u51cf\u4e8b\u4ef6\u7684\u5f71\u54cd\u3002</p> <p>Warning</p> <p>\u60a8\u65e0\u6cd5\u5bf9 Spot \u5b9e\u4f8b\u542f\u7528\u7ec8\u6b62\u4fdd\u62a4\u3002</p>"},{"location":"zh/security/docs/incidents/#pod_6","title":"\u4f7f\u7528\u6807\u7b7e\u6807\u8bb0\u8fdd\u89c4\u7684 Pod/\u8282\u70b9\uff0c\u8868\u660e\u5b83\u662f\u6d3b\u8dc3\u8c03\u67e5\u7684\u4e00\u90e8\u5206","text":"<p>\u8fd9\u5c06\u4e3a\u96c6\u7fa4\u7ba1\u7406\u5458\u53d1\u51fa\u8b66\u544a\uff0c\u5728\u8c03\u67e5\u5b8c\u6210\u4e4b\u524d\u4e0d\u8981\u5e72\u6270\u53d7\u5f71\u54cd\u7684 Pod/\u8282\u70b9\u3002</p>"},{"location":"zh/security/docs/incidents/#_5","title":"\u6355\u83b7\u5de5\u4f5c\u8282\u70b9\u4e0a\u7684\u6613\u5931\u6027\u5de5\u4ef6","text":"<ul> <li>\u6355\u83b7\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u3002\u8fd9\u5c06\u6355\u83b7 Docker \u5b88\u62a4\u8fdb\u7a0b(\u6216\u5176\u4ed6\u5bb9\u5668\u8fd0\u884c\u65f6)\u53ca\u5176\u6bcf\u4e2a\u5bb9\u5668\u7684\u5b50\u8fdb\u7a0b\u3002\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982 LiME \u548c Volatility \u4e4b\u7c7b\u7684\u5de5\u5177\uff0c\u6216\u901a\u8fc7\u57fa\u4e8e\u5b83\u4eec\u7684\u66f4\u9ad8\u7ea7\u5de5\u5177(\u5982 Automated Forensics Orchestrator for Amazon EC2)\u6765\u5b9e\u73b0\u3002</li> <li>\u5bf9\u8fd0\u884c\u7684\u8fdb\u7a0b\u548c\u6253\u5f00\u7684\u7aef\u53e3\u6267\u884c netstat \u6811\u8f6c\u50a8\u3002\u8fd9\u5c06\u6355\u83b7 docker \u5b88\u62a4\u8fdb\u7a0b\u53ca\u5176\u6bcf\u4e2a\u5bb9\u5668\u7684\u5b50\u8fdb\u7a0b\u3002</li> <li>\u8fd0\u884c\u547d\u4ee4\u4fdd\u5b58\u5bb9\u5668\u7ea7\u522b\u7684\u72b6\u6001\uff0c\u4ee5\u9632\u8bc1\u636e\u88ab\u7be1\u6539\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5bb9\u5668\u8fd0\u884c\u65f6\u7684\u529f\u80fd\u6765\u6355\u83b7\u6709\u5173\u5f53\u524d\u8fd0\u884c\u5bb9\u5668\u7684\u4fe1\u606f\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e Docker\uff0c\u60a8\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</li> <li><code>docker top CONTAINER</code> \u83b7\u53d6\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u3002</li> <li><code>docker logs CONTAINER</code> \u83b7\u53d6\u5b88\u62a4\u7a0b\u5e8f\u7ea7\u522b\u7684\u65e5\u5fd7\u3002</li> <li> <p><code>docker inspect CONTAINER</code> \u83b7\u53d6\u6709\u5173\u5bb9\u5668\u7684\u5404\u79cd\u4fe1\u606f\u3002</p> <p>\u5bf9\u4e8e containerd\uff0c\u53ef\u4ee5\u4f7f\u7528 nerdctl CLI \u4ee3\u66ff <code>docker</code> (\u4f8b\u5982 <code>nerdctl inspect</code>)\u6765\u5b9e\u73b0\u76f8\u540c\u76ee\u7684\u3002\u6839\u636e\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u5176\u4ed6\u547d\u4ee4\u3002\u4f8b\u5982\uff0cDocker \u6709 <code>docker diff</code> \u6765\u67e5\u770b\u5bb9\u5668\u6587\u4ef6\u7cfb\u7edf\u7684\u66f4\u6539\uff0c\u6216 <code>docker checkpoint</code> \u6765\u4fdd\u5b58\u6240\u6709\u5bb9\u5668\u72b6\u6001(\u5305\u62ec\u6613\u5931\u6027\u5185\u5b58(RAM))\u3002\u6709\u5173\u4f7f\u7528 containerd \u6216 CRI-O \u8fd0\u884c\u65f6\u7684\u7c7b\u4f3c\u529f\u80fd\u7684\u8ba8\u8bba\uff0c\u8bf7\u53c2\u9605\u6b64 Kubernetes \u535a\u5ba2\u6587\u7ae0\u3002</p> </li> <li> <p>\u6682\u505c\u5bb9\u5668\u4ee5\u8fdb\u884c\u53d6\u8bc1\u6355\u83b7\u3002</p> </li> <li>\u5feb\u7167\u5b9e\u4f8b\u7684 EBS \u5377\u3002</li> </ul>"},{"location":"zh/security/docs/incidents/#pod_7","title":"\u91cd\u65b0\u90e8\u7f72\u53d7\u635f\u7684 Pod \u6216\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90","text":"<p>\u4e00\u65e6\u60a8\u5df2\u6536\u96c6\u6570\u636e\u8fdb\u884c\u53d6\u8bc1\u5206\u6790\uff0c\u5c31\u53ef\u4ee5\u91cd\u65b0\u90e8\u7f72\u53d7\u635f\u7684 pod \u6216\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u3002</p> <p>\u9996\u5148\u63a8\u51fa\u4fee\u590d\u6240\u5229\u7528\u7684\u6f0f\u6d1e\u5e76\u542f\u52a8\u65b0\u7684\u66ff\u6362 pod\u3002\u7136\u540e\u5220\u9664\u6613\u53d7\u653b\u51fb\u7684 pod\u3002</p> <p>\u5982\u679c\u6613\u53d7\u653b\u51fb\u7684 pod \u7531\u66f4\u9ad8\u7ea7\u522b\u7684 Kubernetes \u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90(\u4f8b\u5982 Deployment \u6216 DaemonSet)\u7ba1\u7406\uff0c\u5220\u9664\u5b83\u4eec\u5c06\u4f1a\u91cd\u65b0\u8c03\u5ea6\u65b0\u7684 pod\u3002\u56e0\u6b64\uff0c\u6613\u53d7\u653b\u51fb\u7684 pod \u5c06\u518d\u6b21\u542f\u52a8\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u5e94\u8be5\u5728\u4fee\u590d\u6f0f\u6d1e\u540e\u90e8\u7f72\u65b0\u7684\u66ff\u6362\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u3002\u7136\u540e\uff0c\u60a8\u5e94\u8be5\u5220\u9664\u6613\u53d7\u653b\u51fb\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p>"},{"location":"zh/security/docs/incidents/#_6","title":"\u5efa\u8bae","text":""},{"location":"zh/security/docs/incidents/#aws","title":"\u67e5\u770b AWS \u5b89\u5168\u4e8b\u4ef6\u54cd\u5e94\u767d\u76ae\u4e66","text":"<p>\u867d\u7136\u672c\u8282\u7b80\u8981\u6982\u8ff0\u4e86\u5904\u7406\u53ef\u7591\u5b89\u5168\u8fdd\u89c4\u7684\u4e00\u4e9b\u5efa\u8bae\uff0c\u4f46\u8be5\u4e3b\u9898\u5728\u767d\u76ae\u4e66 AWS \u5b89\u5168\u4e8b\u4ef6\u54cd\u5e94\u4e2d\u6709\u8be6\u5c3d\u7684\u4ecb\u7ecd\u3002</p>"},{"location":"zh/security/docs/incidents/#_7","title":"\u5b9e\u8df5\u5b89\u5168\u6e38\u620f\u65e5","text":"<p>\u5c06\u60a8\u7684\u5b89\u5168\u4ece\u4e1a\u4eba\u5458\u5206\u4e3a\u7ea2\u961f\u548c\u84dd\u961f\u4e24\u7ec4\u3002\u7ea2\u961f\u5c06\u4e13\u6ce8\u4e8e\u63a2\u6d4b\u4e0d\u540c\u7cfb\u7edf\u7684\u6f0f\u6d1e\uff0c\u800c\u84dd\u961f\u5c06\u8d1f\u8d23\u9632\u5fa1\u3002\u5982\u679c\u60a8\u6ca1\u6709\u8db3\u591f\u7684\u5b89\u5168\u4ece\u4e1a\u4eba\u5458\u7ec4\u5efa\u72ec\u7acb\u7684\u56e2\u961f\uff0c\u8bf7\u8003\u8651\u96c7\u4f63\u4e86\u89e3 Kubernetes \u6f0f\u6d1e\u7684\u5916\u90e8\u5b9e\u4f53\u3002</p> <p>Kubesploit \u662f CyberArk \u7684\u4e00\u4e2a\u6e17\u900f\u6d4b\u8bd5\u6846\u67b6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u8fdb\u884c\u6e38\u620f\u65e5\u3002\u4e0e\u5176\u4ed6\u5de5\u5177\u4e0d\u540c\uff0c\u5b83\u4e0d\u4ec5\u626b\u63cf\u60a8\u7684\u96c6\u7fa4\u5bfb\u627e\u6f0f\u6d1e\uff0c\u8fd8\u6a21\u62df\u4e86\u771f\u5b9e\u4e16\u754c\u7684\u653b\u51fb\u3002\u8fd9\u4e3a\u60a8\u7684\u84dd\u961f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9e\u8df5\u54cd\u5e94\u653b\u51fb\u5e76\u8bc4\u4f30\u5176\u6709\u6548\u6027\u7684\u673a\u4f1a\u3002</p>"},{"location":"zh/security/docs/incidents/#_8","title":"\u5bf9\u60a8\u7684\u96c6\u7fa4\u8fd0\u884c\u6e17\u900f\u6d4b\u8bd5","text":"<p>\u5b9a\u671f\u653b\u51fb\u60a8\u81ea\u5df1\u7684\u96c6\u7fa4\u53ef\u4ee5\u5e2e\u52a9\u60a8\u53d1\u73b0\u6f0f\u6d1e\u548c\u9519\u8bef\u914d\u7f6e\u3002\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u5148\u9075\u5faa\u6e17\u900f\u6d4b\u8bd5\u6307\u5357\u5bf9\u60a8\u7684\u96c6\u7fa4\u8fdb\u884c\u6d4b\u8bd5\u3002</p>"},{"location":"zh/security/docs/incidents/#_9","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>kube-hunter,\u4e00\u4e2a\u7528\u4e8e Kubernetes \u7684\u6e17\u900f\u6d4b\u8bd5\u5de5\u5177\u3002</li> <li>Gremlin,\u4e00\u4e2a\u6df7\u6c8c\u5de5\u7a0b\u5de5\u5177\u5305\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u6a21\u62df\u5bf9\u5e94\u7528\u7a0b\u5e8f\u548c\u57fa\u7840\u8bbe\u65bd\u7684\u653b\u51fb\u3002</li> <li>Attacking and Defending Kubernetes Installations</li> <li>kubesploit</li> <li>NeuVector by SUSE \u5f00\u6e90\u96f6\u4fe1\u4efb\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\uff0c\u63d0\u4f9b\u6f0f\u6d1e\u548c\u98ce\u9669\u62a5\u544a\u4ee5\u53ca\u5b89\u5168\u4e8b\u4ef6\u901a\u77e5</li> <li>Advanced Persistent Threats</li> <li>Kubernetes Practical Attack and Defense</li> <li>Compromising Kubernetes Cluster by Exploiting RBAC Permissions</li> </ul>"},{"location":"zh/security/docs/multiaccount/","title":"\u591a\u8d26\u6237\u7b56\u7565","text":"<p>AWS\u5efa\u8bae\u4f7f\u7528\u591a\u8d26\u6237\u7b56\u7565\u548cAWS\u7ec4\u7ec7\u6765\u5e2e\u52a9\u9694\u79bb\u548c\u7ba1\u7406\u60a8\u7684\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u548c\u6570\u636e\u3002\u4f7f\u7528\u591a\u8d26\u6237\u7b56\u7565\u6709\u8bb8\u591a\u597d\u5904\uff1a</p> <ul> <li>\u589e\u52a0AWS API\u670d\u52a1\u914d\u989d\u3002\u914d\u989d\u662f\u5e94\u7528\u4e8eAWS\u8d26\u6237\u7684\uff0c\u4e3a\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u591a\u4e2a\u8d26\u6237\u53ef\u4ee5\u589e\u52a0\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u7528\u7684\u603b\u914d\u989d\u3002</li> <li>\u66f4\u7b80\u5355\u7684\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406(IAM)\u7b56\u7565\u3002\u6388\u4e88\u5de5\u4f5c\u8d1f\u8f7d\u53ca\u652f\u6301\u5b83\u4eec\u7684\u64cd\u4f5c\u5458\u4ec5\u8bbf\u95ee\u81ea\u5df1\u7684AWS\u8d26\u6237\u7684\u6743\u9650\uff0c\u610f\u5473\u7740\u4e0d\u9700\u8981\u82b1\u8d39\u592a\u591a\u65f6\u95f4\u7cbe\u5fc3\u5236\u5b9a\u7ec6\u7c92\u5ea6\u7684IAM\u7b56\u7565\u6765\u5b9e\u73b0\u6700\u5c0f\u6743\u9650\u539f\u5219\u3002</li> <li>\u6539\u5584AWS\u8d44\u6e90\u9694\u79bb\u3002\u6839\u636e\u8bbe\u8ba1\uff0c\u5728\u4e00\u4e2a\u8d26\u6237\u4e2d\u9884\u7f6e\u7684\u6240\u6709\u8d44\u6e90\u5728\u903b\u8f91\u4e0a\u90fd\u4e0e\u5176\u4ed6\u8d26\u6237\u4e2d\u9884\u7f6e\u7684\u8d44\u6e90\u9694\u79bb\u3002\u8fd9\u79cd\u9694\u79bb\u8fb9\u754c\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u79cd\u9650\u5236\u5e94\u7528\u7a0b\u5e8f\u76f8\u5173\u95ee\u9898\u3001\u9519\u8bef\u914d\u7f6e\u6216\u6076\u610f\u884c\u4e3a\u98ce\u9669\u7684\u65b9\u5f0f\u3002\u5982\u679c\u4e00\u4e2a\u8d26\u6237\u4e2d\u51fa\u73b0\u95ee\u9898\uff0c\u5bf9\u5176\u4ed6\u8d26\u6237\u4e2d\u5305\u542b\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5f71\u54cd\u53ef\u4ee5\u51cf\u5c11\u6216\u6d88\u9664\u3002</li> <li>\u66f4\u591a\u597d\u5904\uff0c\u5982AWS\u591a\u8d26\u6237\u7b56\u7565\u767d\u76ae\u4e66\u6240\u8ff0</li> </ul> <p>\u4ee5\u4e0b\u90e8\u5206\u5c06\u89e3\u91ca\u5982\u4f55\u4f7f\u7528\u96c6\u4e2d\u5f0f\u6216\u5206\u6563\u5f0fEKS\u96c6\u7fa4\u65b9\u6cd5\u4e3a\u60a8\u7684EKS\u5de5\u4f5c\u8d1f\u8f7d\u5b9e\u65bd\u591a\u8d26\u6237\u7b56\u7565\u3002</p>"},{"location":"zh/security/docs/multiaccount/#_2","title":"\u4e3a\u591a\u79df\u6237\u96c6\u7fa4\u89c4\u5212\u591a\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u7b56\u7565","text":"<p>\u5728\u591a\u8d26\u6237AWS\u7b56\u7565\u4e2d\uff0c\u5c5e\u4e8e\u7ed9\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8d44\u6e90(\u5982S3\u5b58\u50a8\u6876\u3001ElastiCache\u96c6\u7fa4\u548cDynamoDB\u8868)\u90fd\u662f\u5728\u5305\u542b\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u6240\u6709\u8d44\u6e90\u7684AWS\u8d26\u6237\u4e2d\u521b\u5efa\u7684\u3002\u8fd9\u4e9b\u88ab\u79f0\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\uff0c\u800cEKS\u96c6\u7fa4\u5219\u90e8\u7f72\u5728\u88ab\u79f0\u4e3a\u96c6\u7fa4\u8d26\u6237\u7684\u8d26\u6237\u4e2d\u3002\u96c6\u7fa4\u8d26\u6237\u5c06\u5728\u4e0b\u4e00\u8282\u4e2d\u63a2\u8ba8\u3002\u5c06\u8d44\u6e90\u90e8\u7f72\u5230\u4e13\u7528\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u7c7b\u4f3c\u4e8e\u5c06kubernetes\u8d44\u6e90\u90e8\u7f72\u5230\u4e13\u7528\u547d\u540d\u7a7a\u95f4\u3002</p> <p>\u5982\u679c\u5408\u9002\u7684\u8bdd\uff0c\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7ec6\u5206\u4e3a\u8f6f\u4ef6\u5f00\u53d1\u751f\u547d\u5468\u671f\u6216\u5176\u4ed6\u8981\u6c42\u3002\u4f8b\u5982\uff0c\u7ed9\u5b9a\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u4ee5\u6709\u4e00\u4e2a\u751f\u4ea7\u8d26\u6237\u3001\u4e00\u4e2a\u5f00\u53d1\u8d26\u6237\uff0c\u6216\u8005\u7528\u4e8e\u5728\u7279\u5b9a\u533a\u57df\u6258\u7ba1\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u5b9e\u4f8b\u7684\u8d26\u6237\u3002\u66f4\u591a\u4fe1\u606f\u53ef\u5728\u6b64AWS\u767d\u76ae\u4e66\u4e2d\u627e\u5230\u3002</p> <p>\u5728\u5b9e\u65bdEKS\u591a\u8d26\u6237\u7b56\u7565\u65f6\uff0c\u60a8\u53ef\u4ee5\u91c7\u7528\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p>"},{"location":"zh/security/docs/multiaccount/#eks","title":"\u96c6\u4e2d\u5f0fEKS\u96c6\u7fa4","text":"<p>\u5728\u8fd9\u79cd\u65b9\u6cd5\u4e2d\uff0c\u60a8\u7684EKS\u96c6\u7fa4\u5c06\u90e8\u7f72\u5728\u4e00\u4e2a\u540d\u4e3a\"\u96c6\u7fa4\u8d26\u6237\"\u7684\u5355\u4e2aAWS\u8d26\u6237\u4e2d\u3002\u4f7f\u7528IAM\u89d2\u8272\u670d\u52a1\u8d26\u6237(IRSA)\u6216EKS Pod\u8eab\u4efd\u6765\u63d0\u4f9b\u4e34\u65f6AWS\u51ed\u8bc1\uff0c\u4ee5\u53caAWS\u8d44\u6e90\u8bbf\u95ee\u7ba1\u7406\u5668(RAM)\u6765\u7b80\u5316\u7f51\u7edc\u8bbf\u95ee\uff0c\u60a8\u53ef\u4ee5\u4e3a\u591a\u79df\u6237EKS\u96c6\u7fa4\u91c7\u7528\u591a\u8d26\u6237\u7b56\u7565\u3002\u96c6\u7fa4\u8d26\u6237\u5c06\u5305\u542bVPC\u3001\u5b50\u7f51\u3001EKS\u96c6\u7fa4\u3001EC2/Fargate\u8ba1\u7b97\u8d44\u6e90(\u5de5\u4f5c\u8282\u70b9)\u4ee5\u53ca\u8fd0\u884cEKS\u96c6\u7fa4\u6240\u9700\u7684\u4efb\u4f55\u5176\u4ed6\u7f51\u7edc\u914d\u7f6e\u3002</p> <p>\u5728\u591a\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u7b56\u7565\u4e2d\uff0cAWS\u8d26\u6237\u901a\u5e38\u4e0ekubernetes\u547d\u540d\u7a7a\u95f4\u76f8\u5bf9\u5e94\uff0c\u4f5c\u4e3a\u9694\u79bb\u8d44\u6e90\u7ec4\u7684\u673a\u5236\u3002\u5728\u5b9e\u65bd\u591a\u8d26\u6237\u7b56\u7565\u7684\u591a\u79df\u6237EKS\u96c6\u7fa4\u65f6\uff0c\u4ecd\u5e94\u9075\u5faa\u79df\u6237\u9694\u79bb\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p> <p>\u5728\u60a8\u7684AWS\u7ec4\u7ec7\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\"\u96c6\u7fa4\u8d26\u6237\",\u800c\u62e5\u6709\u591a\u4e2a\u4e0e\u60a8\u7684\u8f6f\u4ef6\u5f00\u53d1\u751f\u547d\u5468\u671f\u9700\u6c42\u76f8\u7b26\u7684\"\u96c6\u7fa4\u8d26\u6237\"\u662f\u6700\u4f73\u5b9e\u8df5\u3002\u5bf9\u4e8e\u8fd0\u884c\u5728\u975e\u5e38\u5927\u89c4\u6a21\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u591a\u4e2a\"\u96c6\u7fa4\u8d26\u6237\",\u4ee5\u786e\u4fdd\u6240\u6709\u5de5\u4f5c\u8d1f\u8f7d\u90fd\u6709\u8db3\u591f\u7684kubernetes\u548cAWS\u670d\u52a1\u914d\u989d\u3002</p> \u5728\u4e0a\u56fe\u4e2d\uff0cAWS RAM\u7528\u4e8e\u5c06\u5b50\u7f51\u4ece\u96c6\u7fa4\u8d26\u6237\u5171\u4eab\u5230\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u3002\u7136\u540e\u5728EKS pod\u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528IRSA\u6216EKS Pod\u8eab\u4efd\u548c\u89d2\u8272\u94fe\u63a5\u6765\u627f\u62c5\u5176\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684\u89d2\u8272\uff0c\u5e76\u8bbf\u95ee\u5176AWS\u8d44\u6e90\u3002"},{"location":"zh/security/docs/multiaccount/#_3","title":"\u5b9e\u65bd\u591a\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u7b56\u7565\u7684\u591a\u79df\u6237\u96c6\u7fa4","text":""},{"location":"zh/security/docs/multiaccount/#aws","title":"\u4f7f\u7528AWS\u8d44\u6e90\u8bbf\u95ee\u7ba1\u7406\u5668\u5171\u4eab\u5b50\u7f51","text":"<p>AWS\u8d44\u6e90\u8bbf\u95ee\u7ba1\u7406\u5668(RAM)\u5141\u8bb8\u60a8\u8de8AWS\u8d26\u6237\u5171\u4eab\u8d44\u6e90\u3002</p> <p>\u5982\u679c\u60a8\u7684AWS\u7ec4\u7ec7\u5df2\u542f\u7528RAM,\u60a8\u53ef\u4ee5\u5c06VPC\u5b50\u7f51\u4ece\u96c6\u7fa4\u8d26\u6237\u5171\u4eab\u5230\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u3002\u8fd9\u5c06\u5141\u8bb8\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u62e5\u6709\u7684AWS\u8d44\u6e90(\u5982Amazon ElastiCache\u96c6\u7fa4\u6216Amazon\u5173\u7cfb\u6570\u636e\u5e93\u670d\u52a1(RDS)\u6570\u636e\u5e93)\u90e8\u7f72\u5230\u4e0e\u60a8\u7684EKS\u96c6\u7fa4\u76f8\u540c\u7684VPC\u4e2d\uff0c\u5e76\u53ef\u88ab\u8fd0\u884c\u5728\u60a8\u7684EKS\u96c6\u7fa4\u4e0a\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u3002</p> <p>\u8981\u901a\u8fc7RAM\u5171\u4eab\u8d44\u6e90\uff0c\u8bf7\u5728\u96c6\u7fa4\u8d26\u6237\u7684AWS\u63a7\u5236\u53f0\u4e2d\u6253\u5f00RAM\uff0c\u9009\u62e9\"\u8d44\u6e90\u5171\u4eab\"\u548c\"\u521b\u5efa\u8d44\u6e90\u5171\u4eab\"\u3002\u547d\u540d\u60a8\u7684\u8d44\u6e90\u5171\u4eab\u5e76\u9009\u62e9\u8981\u5171\u4eab\u7684\u5b50\u7f51\u3002\u518d\u6b21\u9009\u62e9\"\u4e0b\u4e00\u6b65\",\u8f93\u5165\u60a8\u5e0c\u671b\u4e0e\u4e4b\u5171\u4eab\u5b50\u7f51\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u768412\u4f4d\u6570\u5b57\u8d26\u6237ID\uff0c\u518d\u6b21\u9009\u62e9\"\u4e0b\u4e00\u6b65\",\u7136\u540e\u5355\u51fb\"\u521b\u5efa\u8d44\u6e90\u5171\u4eab\"\u5b8c\u6210\u3002\u5b8c\u6210\u6b64\u6b65\u9aa4\u540e\uff0c\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e9b\u5b50\u7f51\u4e2d\u90e8\u7f72\u8d44\u6e90\u3002</p> <p>\u8d44\u6e90\u5171\u4eab\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7f16\u7a0b\u65b9\u5f0f\u6216\u4f7f\u7528\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u8fdb\u884c\u521b\u5efa\u3002</p>"},{"location":"zh/security/docs/multiaccount/#eks-podirsa","title":"\u5728EKS Pod\u8eab\u4efd\u548cIRSA\u4e4b\u95f4\u505a\u51fa\u9009\u62e9","text":"<p>\u57282023\u5e74\u7684AWS re\uff1aInvent\u5927\u4f1a\u4e0a\uff0cAWS\u63a8\u51fa\u4e86EKS Pod\u8eab\u4efd\uff0c\u4f5c\u4e3a\u4e00\u79cd\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u5411EKS\u4e0a\u7684pod\u63d0\u4f9b\u4e34\u65f6AWS\u51ed\u8bc1\u3002IRSA\u548cEKS Pod\u8eab\u4efd\u90fd\u662f\u5411\u60a8\u7684EKS pod\u63d0\u4f9b\u4e34\u65f6AWS\u51ed\u8bc1\u7684\u6709\u6548\u65b9\u6cd5\uff0c\u5e76\u5c06\u7ee7\u7eed\u5f97\u5230\u652f\u6301\u3002\u60a8\u5e94\u8be5\u8003\u8651\u54ea\u79cd\u65b9\u6cd5\u6700\u80fd\u6ee1\u8db3\u60a8\u7684\u9700\u6c42\u3002</p> <p>\u5728\u4f7f\u7528EKS\u96c6\u7fa4\u548c\u591a\u4e2aAWS\u8d26\u6237\u65f6\uff0cIRSA\u53ef\u4ee5\u76f4\u63a5\u627f\u62c5\u9664EKS\u96c6\u7fa4\u6240\u5728\u8d26\u6237\u4ee5\u5916\u7684\u5176\u4ed6AWS\u8d26\u6237\u4e2d\u7684\u89d2\u8272\uff0c\u800cEKS Pod\u8eab\u4efd\u5219\u9700\u8981\u60a8\u914d\u7f6e\u89d2\u8272\u94fe\u63a5\u3002\u6709\u5173\u6df1\u5165\u6bd4\u8f83\uff0c\u8bf7\u53c2\u9605EKS\u6587\u6863\u3002</p>"},{"location":"zh/security/docs/multiaccount/#iamaws-api","title":"\u4f7f\u7528IAM\u89d2\u8272\u670d\u52a1\u8d26\u6237\u8bbf\u95eeAWS API\u8d44\u6e90","text":"<p>IAM\u89d2\u8272\u670d\u52a1\u8d26\u6237(IRSA)\u5141\u8bb8\u60a8\u5411\u5728EKS\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u4e34\u65f6AWS\u51ed\u8bc1\u3002IRSA\u53ef\u7528\u4e8e\u4ece\u96c6\u7fa4\u8d26\u6237\u83b7\u53d6\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2dIAM\u89d2\u8272\u7684\u4e34\u65f6\u51ed\u8bc1\u3002\u8fd9\u5141\u8bb8\u60a8\u5728\u96c6\u7fa4\u8d26\u6237\u7684EKS\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u65e0\u7f1d\u5730\u4f7f\u7528\u6258\u7ba1\u5728\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684AWS API\u8d44\u6e90(\u5982S3\u5b58\u50a8\u6876)\uff0c\u5e76\u4f7f\u7528IAM\u8eab\u4efd\u9a8c\u8bc1\u8bbf\u95ee\u8bf8\u5982Amazon RDS\u6570\u636e\u5e93\u6216Amazon EFS\u6587\u4ef6\u7cfb\u7edf\u4e4b\u7c7b\u7684\u8d44\u6e90\u3002</p> <p>\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684AWS API\u8d44\u6e90\u548c\u5176\u4ed6\u4f7f\u7528IAM\u8eab\u4efd\u9a8c\u8bc1\u7684\u8d44\u6e90\u53ea\u80fd\u88ab\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684IAM\u89d2\u8272\u51ed\u8bc1\u8bbf\u95ee\uff0c\u9664\u975e\u5df2\u660e\u786e\u542f\u7528\u8de8\u8d26\u6237\u8bbf\u95ee\u3002</p>"},{"location":"zh/security/docs/multiaccount/#irsa","title":"\u542f\u7528IRSA\u8fdb\u884c\u8de8\u8d26\u6237\u8bbf\u95ee","text":"<p>\u8981\u542f\u7528IRSA\uff0c\u4f7f\u96c6\u7fa4\u8d26\u6237\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u80fd\u591f\u8bbf\u95ee\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684\u8d44\u6e90\uff0c\u60a8\u9996\u5148\u5fc5\u987b\u5728\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u521b\u5efa\u4e00\u4e2aIAM OIDC\u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4e0e\u8bbe\u7f6eIRSA\u76f8\u540c\u7684\u8fc7\u7a0b\u6765\u5b8c\u6210\uff0c\u53ea\u662f\u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f\u5c06\u5728\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u521b\u5efa\u3002</p> <p>\u7136\u540e\uff0c\u5728\u4e3aEKS\u4e0a\u7684\u5de5\u4f5c\u8d1f\u8f7d\u914d\u7f6eIRSA\u65f6\uff0c\u60a8\u53ef\u4ee5\u6309\u7167\u4e0e\u6587\u6863\u76f8\u540c\u7684\u6b65\u9aa4,\u4f46\u4f7f\u7528\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u768412\u4f4d\u6570\u5b57\u8d26\u6237ID,\u5982\"\u4ece\u53e6\u4e00\u4e2a\u8d26\u6237\u7684\u96c6\u7fa4\u521b\u5efa\u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f\"\u4e00\u8282\u6240\u8ff0\u3002</p> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u60a8\u5728EKS\u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u80fd\u591f\u76f4\u63a5\u4f7f\u7528\u5176\u670d\u52a1\u8d26\u6237\u6765\u627f\u62c5\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684\u89d2\u8272\uff0c\u5e76\u4f7f\u7528\u8be5\u8d26\u6237\u4e2d\u7684\u8d44\u6e90\u3002</p>"},{"location":"zh/security/docs/multiaccount/#eks-podaws-api","title":"\u4f7f\u7528EKS Pod\u8eab\u4efd\u8bbf\u95eeAWS API\u8d44\u6e90","text":"<p>EKS Pod\u8eab\u4efd\u662f\u4e00\u79cd\u65b0\u7684\u5411EKS\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9bAWS\u51ed\u8bc1\u7684\u65b9\u5f0f\u3002EKS pod\u8eab\u4efd\u7b80\u5316\u4e86AWS\u8d44\u6e90\u7684\u914d\u7f6e\uff0c\u56e0\u4e3a\u60a8\u4e0d\u518d\u9700\u8981\u7ba1\u7406OIDC\u914d\u7f6e\u6765\u5411EKS\u4e0a\u7684pod\u63d0\u4f9bAWS\u51ed\u8bc1\u3002</p>"},{"location":"zh/security/docs/multiaccount/#eks-pod","title":"\u542f\u7528EKS Pod\u8eab\u4efd\u8fdb\u884c\u8de8\u8d26\u6237\u8bbf\u95ee","text":"<p>\u4e0eIRSA\u4e0d\u540c\uff0cEKS Pod\u8eab\u4efd\u53ea\u80fd\u7528\u4e8e\u76f4\u63a5\u6388\u4e88\u5bf9\u540c\u4e00\u8d26\u6237\u4e2dEKS\u96c6\u7fa4\u7684\u89d2\u8272\u7684\u8bbf\u95ee\u6743\u9650\u3002\u8981\u8bbf\u95ee\u53e6\u4e00\u4e2aAWS\u8d26\u6237\u4e2d\u7684\u89d2\u8272\uff0c\u4f7f\u7528EKS Pod\u8eab\u4efd\u7684pod\u5fc5\u987b\u6267\u884c\u89d2\u8272\u94fe\u63a5\u3002</p> <p>\u89d2\u8272\u94fe\u63a5\u53ef\u4ee5\u5728\u5e94\u7528\u7a0b\u5e8f\u7684aws\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528\u5404\u79cdAWS SDK\u4e2d\u53ef\u7528\u7684\u8fdb\u7a0b\u51ed\u8bc1\u63d0\u4f9b\u7a0b\u5e8f\u8fdb\u884c\u914d\u7f6e\u3002\u5728\u914d\u7f6e\u914d\u7f6e\u6587\u4ef6\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528<code>credential_process</code>\u4f5c\u4e3a\u51ed\u8bc1\u6e90\uff0c\u4f8b\u5982\uff1a</p> <pre><code># AWS\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9\n[profile account_b_role] \nsource_profile = account_a_role \nrole_arn = arn:aws:iam::444455556666:role/account-b-role\n\n[profile account_a_role] \ncredential_process = /eks-credential-processrole.sh\n</code></pre> <p>credential_process\u8c03\u7528\u7684\u811a\u672c\u7684\u6765\u6e90\uff1a</p> <pre><code>#!/bin/bash\n# eks-credential-processrole.sh\u7684\u5185\u5bb9\n# \u8fd9\u5c06\u4ecepod\u8eab\u4efd\u4ee3\u7406\u4e2d\u68c0\u7d22\u51ed\u8bc1\uff0c\n# \u5e76\u5728\u5f15\u7528\u914d\u7f6e\u6587\u4ef6\u65f6\u5c06\u5176\u8fd4\u56de\u7ed9AWS SDK\ncurl -H \"Authorization: $(cat $AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE)\" $AWS_CONTAINER_CREDENTIALS_FULL_URI | jq -c '{AccessKeyId: .AccessKeyId, SecretAccessKey: .SecretAccessKey, SessionToken: .Token, Expiration: .Expiration, Version: 1}' \n</code></pre> <p>\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5982\u4e0a\u6240\u793a\u7684aws\u914d\u7f6e\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u8d26\u6237A\u548cB\u7684\u89d2\u8272\uff0c\u5e76\u5728pod\u89c4\u8303\u4e2d\u6307\u5b9aAWS_CONFIG_FILE\u548cAWS_PROFILE\u73af\u5883\u53d8\u91cf\u3002\u5982\u679c\u73af\u5883\u53d8\u91cf\u5df2\u7ecf\u5b58\u5728\u4e8epod\u89c4\u8303\u4e2d\uff0cEKS Pod\u8eab\u4efdWebhook\u4e0d\u4f1a\u8986\u76d6\u5b83\u4eec\u3002</p> <pre><code># Pod\u89c4\u8303\u7247\u6bb5\ncontainers: \n  - name: container-name\n    image: container-image:version\n    env:\n    - name: AWS_CONFIG_FILE\n      value: path-to-customer-provided-aws-config-file\n    - name: AWS_PROFILE\n      value: account_b_role\n</code></pre> <p>\u5728\u4e3aEKS pod\u8eab\u4efd\u914d\u7f6e\u89d2\u8272\u94fe\u63a5\u7684\u89d2\u8272\u4fe1\u4efb\u7b56\u7565\u65f6\uff0c\u60a8\u53ef\u4ee5\u5f15\u7528EKS\u7279\u5b9a\u5c5e\u6027\u4f5c\u4e3a\u4f1a\u8bdd\u6807\u7b7e\uff0c\u5e76\u4f7f\u7528\u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236(ABAC)\u6765\u9650\u5236\u5bf9\u60a8\u7684IAM\u89d2\u8272\u7684\u8bbf\u95ee\uff0c\u53ea\u5141\u8bb8\u7279\u5b9a\u7684EKS Pod\u8eab\u4efd\u4f1a\u8bdd\u8bbf\u95ee\uff0c\u4f8b\u5982pod\u6240\u5c5e\u7684Kubernetes\u670d\u52a1\u8d26\u6237\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9b\u5c5e\u6027\u4e2d\u7684\u4e00\u4e9b\u53ef\u80fd\u4e0d\u662f\u5168\u5c40\u552f\u4e00\u7684\uff0c\u4f8b\u5982\u4e24\u4e2aEKS\u96c6\u7fa4\u53ef\u80fd\u5177\u6709\u76f8\u540c\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u5e76\u4e14\u4e00\u4e2a\u96c6\u7fa4\u53ef\u80fd\u5728\u4e0d\u540c\u547d\u540d\u7a7a\u95f4\u4e2d\u5177\u6709\u76f8\u540c\u540d\u79f0\u7684\u670d\u52a1\u8d26\u6237\u3002\u56e0\u6b64\uff0c\u5728\u901a\u8fc7EKS Pod\u8eab\u4efd\u6388\u4e88\u8bbf\u95ee\u6743\u9650\u65f6\uff0c\u6700\u4f73\u5b9e\u8df5\u662f\u59cb\u7ec8\u8003\u8651\u96c6\u7fa4ARN\u548c\u547d\u540d\u7a7a\u95f4\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u670d\u52a1\u8d26\u6237\u3002</p>"},{"location":"zh/security/docs/multiaccount/#abaceks-pod","title":"ABAC\u548cEKS Pod\u8eab\u4efd\u7684\u8de8\u8d26\u6237\u8bbf\u95ee","text":"<p>\u5728\u4f7f\u7528EKS Pod\u8eab\u4efd\u4f5c\u4e3a\u591a\u8d26\u6237\u7b56\u7565\u7684\u4e00\u90e8\u5206\u6765\u627f\u62c5\u5176\u4ed6\u8d26\u6237\u4e2d\u7684\u89d2\u8272(\u89d2\u8272\u94fe\u63a5)\u65f6\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u4e3a\u6bcf\u4e2a\u9700\u8981\u8bbf\u95ee\u53e6\u4e00\u4e2a\u8d26\u6237\u7684\u670d\u52a1\u8d26\u6237\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684IAM\u89d2\u8272\uff0c\u6216\u8005\u8de8\u591a\u4e2a\u670d\u52a1\u8d26\u6237\u4f7f\u7528\u4e00\u4e2a\u901a\u7528\u7684IAM\u89d2\u8272\uff0c\u5e76\u4f7f\u7528ABAC\u6765\u63a7\u5236\u5b83\u53ef\u4ee5\u8bbf\u95ee\u54ea\u4e9b\u8d26\u6237\u3002</p> <p>\u8981\u4f7f\u7528ABAC\u63a7\u5236\u54ea\u4e9b\u670d\u52a1\u8d26\u6237\u53ef\u4ee5\u901a\u8fc7\u89d2\u8272\u94fe\u63a5\u627f\u62c5\u53e6\u4e00\u4e2a\u8d26\u6237\u4e2d\u7684\u89d2\u8272\uff0c\u60a8\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u89d2\u8272\u4fe1\u4efb\u7b56\u7565\u8bed\u53e5\uff0c\u8be5\u8bed\u53e5\u53ea\u5141\u8bb8\u5728\u5b58\u5728\u9884\u671f\u503c\u65f6\u624d\u80fd\u627f\u62c5\u8be5\u89d2\u8272\u3002\u4ee5\u4e0b\u89d2\u8272\u4fe1\u4efb\u7b56\u7565\u5c06\u53ea\u5141\u8bb8\u6765\u81eaEKS\u96c6\u7fa4\u8d26\u6237(\u8d26\u6237ID 111122223333)\u7684\u89d2\u8272\u627f\u62c5\u8be5\u89d2\u8272\uff0c\u524d\u63d0\u662f<code>kubernetes-service-account</code>\u3001<code>eks-cluster-arn</code>\u548c<code>kubernetes-namespace</code>\u6807\u7b7e\u90fd\u5177\u6709\u9884\u671f\u503c\u3002</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\":  {\n                \"AWS\": \"arn:aws:iam::111122223333:root\"\n            },\n            \"Action\": \"sts:AssumeRole\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalTag/kubernetes-service-account\": \"PayrollApplication\",\n                    \"aws:PrincipalTag/eks-cluster-arn\": \"arn:aws:eks:us-east-1:111122223333:cluster/ProductionCluster\",\n                    \"aws:PrincipalTag/kubernetes-namespace\": \"PayrollNamespace\"\n                }\n            }\n        }\n    ]\n}\n</code></pre> <p>\u5728\u4f7f\u7528\u8fd9\u79cd\u7b56\u7565\u65f6\uff0c\u6700\u4f73\u5b9e\u8df5\u662f\u786e\u4fdd\u901a\u7528IAM\u89d2\u8272\u53ea\u5177\u6709<code>sts:AssumeRole</code>\u6743\u9650\uff0c\u800c\u6ca1\u6709\u5176\u4ed6AWS\u8bbf\u95ee\u6743\u9650\u3002</p> <p>\u5728\u4f7f\u7528ABAC\u65f6\uff0c\u91cd\u8981\u7684\u662f\u8981\u63a7\u5236\u8c01\u6709\u80fd\u529b\u4e3aIAM\u89d2\u8272\u548c\u7528\u6237\u8bbe\u7f6e\u6807\u7b7e\uff0c\u53ea\u5141\u8bb8\u90a3\u4e9b\u786e\u5b9e\u9700\u8981\u8fd9\u6837\u505a\u7684\u4eba\u3002\u80fd\u591f\u4e3aIAM\u89d2\u8272\u6216\u7528\u6237\u8bbe\u7f6e\u6807\u7b7e\u7684\u4eba\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u4e0eEKS Pod\u8eab\u4efd\u8bbe\u7f6e\u7684\u6807\u7b7e\u76f8\u540c\u7684\u6807\u7b7e\uff0c\u4ece\u800c\u53ef\u80fd\u4f1a\u63d0\u5347\u4ed6\u4eec\u7684\u6743\u9650\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528IAM\u7b56\u7565\u6216\u670d\u52a1\u63a7\u5236\u7b56\u7565(SCP)\u6765\u9650\u5236\u8c01\u6709\u6743\u5728IAM\u89d2\u8272\u548c\u7528\u6237\u4e0a\u8bbe\u7f6e<code>kubernetes-</code>\u548c<code>eks-</code>\u6807\u7b7e\u3002</p>"},{"location":"zh/security/docs/multiaccount/#eks_1","title":"\u5206\u6563\u5f0fEKS\u96c6\u7fa4","text":"<p>\u5728\u8fd9\u79cd\u65b9\u6cd5\u4e2d\uff0cEKS\u96c6\u7fa4\u90e8\u7f72\u5728\u5404\u81ea\u7684\u5de5\u4f5c\u8d1f\u8f7dAWS\u8d26\u6237\u4e2d\uff0c\u5e76\u4e0e\u5176\u4ed6AWS\u8d44\u6e90(\u5982Amazon S3\u5b58\u50a8\u6876\u3001VPC\u3001Amazon DynamoDB\u8868\u7b49)\u4e00\u8d77\u5b58\u5728\u3002\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u90fd\u662f\u72ec\u7acb\u7684\u3001\u81ea\u7ed9\u81ea\u8db3\u7684\uff0c\u5e76\u7531\u5404\u81ea\u7684\u4e1a\u52a1\u5355\u4f4d/\u5e94\u7528\u7a0b\u5e8f\u56e2\u961f\u8fdb\u884c\u64cd\u4f5c\u3002\u8fd9\u79cd\u6a21\u578b\u5141\u8bb8\u521b\u5efa\u5404\u79cd\u96c6\u7fa4\u529f\u80fd(AI/ML\u96c6\u7fa4\u3001\u6279\u5904\u7406\u3001\u901a\u7528\u7b49)\u7684\u53ef\u91cd\u7528\u84dd\u56fe\uff0c\u5e76\u6839\u636e\u5e94\u7528\u7a0b\u5e8f\u56e2\u961f\u7684\u8981\u6c42\u63d0\u4f9b\u96c6\u7fa4\u3002\u5e94\u7528\u7a0b\u5e8f\u56e2\u961f\u548c\u5e73\u53f0\u56e2\u961f\u90fd\u5728\u5404\u81ea\u7684GitOps\u5b58\u50a8\u5e93\u4e2d\u64cd\u4f5c\uff0c\u4ee5\u7ba1\u7406\u5bf9\u5de5\u4f5c\u8d1f\u8f7d\u96c6\u7fa4\u7684\u90e8\u7f72\u3002</p> \u5728\u4e0a\u56fe\u4e2d\uff0cAmazon EKS\u96c6\u7fa4\u548c\u5176\u4ed6AWS\u8d44\u6e90\u90e8\u7f72\u5728\u5404\u81ea\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u3002\u7136\u540e\u5728EKS pod\u4e2d\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528IRSA\u6216EKS Pod\u8eab\u4efd\u6765\u8bbf\u95ee\u5176AWS\u8d44\u6e90\u3002 <p>GitOps\u662f\u4e00\u79cd\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u548c\u57fa\u7840\u8bbe\u65bd\u90e8\u7f72\u7684\u65b9\u5f0f\uff0c\u6574\u4e2a\u7cfb\u7edf\u90fd\u662f\u5728Git\u5b58\u50a8\u5e93\u4e2d\u4ee5\u58f0\u660e\u5f0f\u65b9\u5f0f\u63cf\u8ff0\u7684\u3002\u5b83\u662f\u4e00\u79cd\u64cd\u4f5c\u6a21\u578b\uff0c\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4f7f\u7528\u7248\u672c\u63a7\u5236\u3001\u4e0d\u53ef\u53d8\u5de5\u4ef6\u548c\u81ea\u52a8\u5316\u7684\u6700\u4f73\u5b9e\u8df5\u6765\u7ba1\u7406\u591a\u4e2aKubernetes\u96c6\u7fa4\u72b6\u6001\u7684\u80fd\u529b\u3002\u5728\u8fd9\u79cd\u591a\u96c6\u7fa4\u6a21\u578b\u4e2d\uff0c\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u96c6\u7fa4\u90fd\u4f7f\u7528\u591a\u4e2aGit\u5b58\u50a8\u5e93\u8fdb\u884c\u5f15\u5bfc\uff0c\u5141\u8bb8\u6bcf\u4e2a\u56e2\u961f(\u5e94\u7528\u7a0b\u5e8f\u3001\u5e73\u53f0\u3001\u5b89\u5168\u7b49)\u5728\u96c6\u7fa4\u4e0a\u90e8\u7f72\u5404\u81ea\u7684\u66f4\u6539\u3002</p> <p>\u60a8\u5c06\u5728\u6bcf\u4e2a\u8d26\u6237\u4e2d\u4f7f\u7528IAM\u89d2\u8272\u670d\u52a1\u8d26\u6237(IRSA)\u6216EKS Pod\u8eab\u4efd,\u4ee5\u5141\u8bb8\u60a8\u7684EKS\u5de5\u4f5c\u8d1f\u8f7d\u83b7\u53d6\u4e34\u65f6aws\u51ed\u8bc1\uff0c\u4ece\u800c\u5b89\u5168\u5730\u8bbf\u95ee\u5176\u4ed6AWS\u8d44\u6e90\u3002IAM\u89d2\u8272\u5728\u5404\u81ea\u7684\u5de5\u4f5c\u8d1f\u8f7dAWS\u8d26\u6237\u4e2d\u521b\u5efa\uff0c\u5e76\u6620\u5c04\u5230k8s\u670d\u52a1\u8d26\u6237\uff0c\u4ee5\u63d0\u4f9b\u4e34\u65f6IAM\u8bbf\u95ee\u6743\u9650\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u79cd\u65b9\u6cd5\u4e2d\u4e0d\u9700\u8981\u8de8\u8d26\u6237\u8bbf\u95ee\u3002\u8bf7\u6309\u7167IAM\u89d2\u8272\u670d\u52a1\u8d26\u6237\u6587\u6863\u4e2d\u7684\u8bf4\u660e\u5728\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u4e3aIRSA\u8bbe\u7f6e\uff0c\u4ee5\u53caEKS Pod\u8eab\u4efd\u6587\u6863\u4e2d\u7684\u8bf4\u660e\u5728\u6bcf\u4e2a\u8d26\u6237\u4e2d\u8bbe\u7f6eEKS pod\u8eab\u4efd\u3002</p>"},{"location":"zh/security/docs/multiaccount/#_4","title":"\u96c6\u4e2d\u5f0f\u7f51\u7edc","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528AWS RAM\u5c06VPC\u5b50\u7f51\u5171\u4eab\u5230\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\uff0c\u5e76\u5728\u5176\u4e2d\u542f\u52a8Amazon EKS\u96c6\u7fa4\u548c\u5176\u4ed6AWS\u8d44\u6e90\u3002\u8fd9\u5b9e\u73b0\u4e86\u96c6\u4e2d\u5f0f\u7f51\u7edc\u7ba1\u7406/\u7ba1\u7406\u3001\u7b80\u5316\u7684\u7f51\u7edc\u8fde\u63a5\u4ee5\u53ca\u5206\u6563\u5f0fEKS\u96c6\u7fa4\u3002\u6709\u5173\u6b64\u65b9\u6cd5\u7684\u8be6\u7ec6\u6f14\u7ec3\u548c\u6ce8\u610f\u4e8b\u9879\uff0c\u8bf7\u53c2\u9605\u6b64AWS\u535a\u5ba2\u3002</p> \u5728\u4e0a\u56fe\u4e2d\uff0cAWS RAM\u7528\u4e8e\u5c06\u5b50\u7f51\u4ece\u4e2d\u592e\u7f51\u7edc\u8d26\u6237\u5171\u4eab\u5230\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u3002\u7136\u540e\u5728\u8fd9\u4e9b\u5b50\u7f51\u4e2d\u542f\u52a8EKS\u96c6\u7fa4\u548c\u5176\u4ed6AWS\u8d44\u6e90\u3002EKS pod\u4f7f\u7528IRSA\u6216EKS Pod\u8eab\u4efd\u6765\u8bbf\u95ee\u5176AWS\u8d44\u6e90\u3002"},{"location":"zh/security/docs/multiaccount/#eks_2","title":"\u96c6\u4e2d\u5f0f\u4e0e\u5206\u6563\u5f0fEKS\u96c6\u7fa4","text":"<p>\u9009\u62e9\u8fd0\u884c\u96c6\u4e2d\u5f0f\u8fd8\u662f\u5206\u6563\u5f0f\u5c06\u53d6\u51b3\u4e8e\u60a8\u7684\u9700\u6c42\u3002\u4e0b\u8868\u5c55\u793a\u4e86\u6bcf\u79cd\u7b56\u7565\u7684\u4e3b\u8981\u533a\u522b\u3002</p> # \u96c6\u4e2d\u5f0fEKS\u96c6\u7fa4 \u5206\u6563\u5f0fEKS\u96c6\u7fa4 \u96c6\u7fa4\u7ba1\u7406\uff1a \u7ba1\u7406\u5355\u4e2aEKS\u96c6\u7fa4\u66f4\u5bb9\u6613\uff0c\u800c\u4e0d\u662f\u7ba1\u7406\u591a\u4e2a\u96c6\u7fa4 \u9700\u8981\u9ad8\u6548\u7684\u96c6\u7fa4\u7ba1\u7406\u81ea\u52a8\u5316\uff0c\u4ee5\u51cf\u5c11\u7ba1\u7406\u591a\u4e2aEKS\u96c6\u7fa4\u7684\u8fd0\u8425\u5f00\u9500 \u6210\u672c\u6548\u7387\uff1a \u5141\u8bb8\u91cd\u7528EKS\u96c6\u7fa4\u548c\u7f51\u7edc\u8d44\u6e90\uff0c\u4ece\u800c\u63d0\u9ad8\u6210\u672c\u6548\u7387 \u9700\u8981\u4e3a\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u8bbe\u7f6e\u7f51\u7edc\u548c\u96c6\u7fa4\uff0c\u8fd9\u9700\u8981\u989d\u5916\u7684\u8d44\u6e90 \u5f39\u6027\uff1a \u96c6\u4e2d\u5f0f\u96c6\u7fa4\u51fa\u73b0\u6545\u969c\u53ef\u80fd\u4f1a\u5f71\u54cd\u591a\u4e2a\u5de5\u4f5c\u8d1f\u8f7d \u5982\u679c\u4e00\u4e2a\u96c6\u7fa4\u51fa\u73b0\u6545\u969c\uff0c\u635f\u5bb3\u4ec5\u9650\u4e8e\u5728\u8be5\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\u6240\u6709\u5176\u4ed6\u5de5\u4f5c\u8d1f\u8f7d\u90fd\u4e0d\u53d7\u5f71\u54cd \u9694\u79bb\u548c\u5b89\u5168\u6027\uff1a \u4f7f\u7528k8s\u539f\u751f\u6784\u9020(\u5982<code>Namespaces</code>)\u5b9e\u73b0\u9694\u79bb/\u8f6f\u591a\u79df\u6237\u3002\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u80fd\u5171\u4eab\u5e95\u5c42\u8d44\u6e90(\u5982CPU\u3001\u5185\u5b58\u7b49)\u3002AWS\u8d44\u6e90\u88ab\u9694\u79bb\u5230\u5404\u81ea\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u65e0\u6cd5\u4ece\u5176\u4ed6AWS\u8d26\u6237\u8bbf\u95ee\u3002 \u5728\u8ba1\u7b97\u8d44\u6e90\u65b9\u9762\u5b9e\u73b0\u4e86\u66f4\u5f3a\u7684\u9694\u79bb\uff0c\u56e0\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u5728\u5355\u72ec\u7684\u96c6\u7fa4\u548c\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u4e0d\u5171\u4eab\u4efb\u4f55\u8d44\u6e90\u3002AWS\u8d44\u6e90\u88ab\u9694\u79bb\u5230\u5404\u81ea\u7684\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u65e0\u6cd5\u4ece\u5176\u4ed6AWS\u8d26\u6237\u8bbf\u95ee\u3002 \u6027\u80fd\u548c\u53ef\u6269\u5c55\u6027\uff1a \u968f\u7740\u5de5\u4f5c\u8d1f\u8f7d\u89c4\u6a21\u589e\u957f\u5230\u975e\u5e38\u5927\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230\u96c6\u7fa4\u8d26\u6237\u4e2d\u7684kubernetes\u548cAWS\u670d\u52a1\u914d\u989d\u3002\u60a8\u53ef\u4ee5\u90e8\u7f72\u989d\u5916\u7684\u96c6\u7fa4\u8d26\u6237\u4ee5\u8fdb\u4e00\u6b65\u6269\u5c55 \u968f\u7740\u5b58\u5728\u66f4\u591a\u96c6\u7fa4\u548cVPC\uff0c\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u90fd\u6709\u66f4\u591a\u53ef\u7528\u7684k8s\u548cAWS\u670d\u52a1\u914d\u989d \u7f51\u7edc\uff1a \u6bcf\u4e2a\u96c6\u7fa4\u4f7f\u7528\u5355\u4e2aVPC\uff0c\u5141\u8bb8\u8be5\u96c6\u7fa4\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u66f4\u7b80\u5355\u7684\u8fde\u63a5 \u5fc5\u987b\u5728\u5206\u6563\u5f0fEKS\u96c6\u7fa4VPC\u4e4b\u95f4\u5efa\u7acb\u8def\u7531 Kubernetes\u8bbf\u95ee\u7ba1\u7406\uff1a \u9700\u8981\u7ef4\u62a4\u96c6\u7fa4\u4e2d\u7684\u8bb8\u591a\u4e0d\u540c\u89d2\u8272\u548c\u7528\u6237\uff0c\u4ee5\u4e3a\u6240\u6709\u5de5\u4f5c\u8d1f\u8f7d\u56e2\u961f\u63d0\u4f9b\u8bbf\u95ee\u6743\u9650\uff0c\u5e76\u786e\u4fddkubernetes\u8d44\u6e90\u5f97\u5230\u9002\u5f53\u9694\u79bb \u7531\u4e8e\u6bcf\u4e2a\u96c6\u7fa4\u90fd\u4e13\u7528\u4e8e\u4e00\u4e2a\u5de5\u4f5c\u8d1f\u8f7d/\u56e2\u961f\uff0c\u56e0\u6b64\u8bbf\u95ee\u7ba1\u7406\u66f4\u7b80\u5355 AWS\u8bbf\u95ee\u7ba1\u7406\uff1a AWS\u8d44\u6e90\u90e8\u7f72\u5230\u5404\u81ea\u7684\u8d26\u6237\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u80fd\u4f7f\u7528\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684IAM\u89d2\u8272\u8fdb\u884c\u8bbf\u95ee\u3002\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684IAM\u89d2\u8272\u901a\u8fc7IRSA\u6216EKS Pod\u8eab\u4efd\u8de8\u8d26\u6237\u627f\u62c5\u3002 AWS\u8d44\u6e90\u90e8\u7f72\u5230\u5404\u81ea\u7684\u8d26\u6237\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u80fd\u4f7f\u7528\u8be5\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684IAM\u89d2\u8272\u8fdb\u884c\u8bbf\u95ee\u3002\u5de5\u4f5c\u8d1f\u8f7d\u8d26\u6237\u4e2d\u7684IAM\u89d2\u8272\u76f4\u63a5\u901a\u8fc7IRSA\u6216EKS Pod\u8eab\u4efd\u63d0\u4f9b\u7ed9pod\u3002"},{"location":"zh/security/docs/multitenancy/","title":"\u79df\u6237\u9694\u79bb","text":"<p>\u5f53\u6211\u4eec\u8003\u8651\u591a\u79df\u6237\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u5e0c\u671b\u5c06\u4e00\u4e2a\u7528\u6237\u6216\u5e94\u7528\u7a0b\u5e8f\u4e0e\u5728\u5171\u4eab\u57fa\u7840\u8bbe\u65bd\u4e0a\u8fd0\u884c\u7684\u5176\u4ed6\u7528\u6237\u6216\u5e94\u7528\u7a0b\u5e8f\u9694\u79bb\u5f00\u6765\u3002</p> <p>Kubernetes \u662f\u4e00\u4e2a \u5355\u79df\u6237\u7f16\u6392\u5668\uff0c\u5373\u63a7\u5236\u5e73\u9762\u7684\u5355\u4e2a\u5b9e\u4f8b\u5728\u96c6\u7fa4\u5185\u7684\u6240\u6709\u79df\u6237\u4e4b\u95f4\u5171\u4eab\u3002\u4f46\u662f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5404\u79cd Kubernetes \u5bf9\u8c61\u6765\u521b\u5efa\u591a\u79df\u6237\u7684\u5916\u89c2\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u5b9e\u73b0\u547d\u540d\u7a7a\u95f4\u548c\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236 (RBAC) \u6765\u5728\u903b\u8f91\u4e0a\u5c06\u79df\u6237\u76f8\u4e92\u9694\u79bb\u3002\u540c\u6837\uff0c\u53ef\u4ee5\u4f7f\u7528\u914d\u989d\u548c\u9650\u5236\u8303\u56f4\u6765\u63a7\u5236\u6bcf\u4e2a\u79df\u6237\u53ef\u4ee5\u6d88\u8017\u7684\u96c6\u7fa4\u8d44\u6e90\u91cf\u3002\u7136\u800c\uff0c\u96c6\u7fa4\u662f\u63d0\u4f9b\u5f3a\u5927\u5b89\u5168\u8fb9\u754c\u7684\u552f\u4e00\u6784\u9020\u3002\u8fd9\u662f\u56e0\u4e3a\u4e00\u65e6\u653b\u51fb\u8005\u8bbe\u6cd5\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u7684\u4e3b\u673a\uff0c\u4ed6\u4eec\u5c31\u53ef\u4ee5\u68c0\u7d22\u8be5\u4e3b\u673a\u4e0a\u5b89\u88c5\u7684 \u6240\u6709 Secret\u3001ConfigMap \u548c\u5377\u3002\u4ed6\u4eec\u8fd8\u53ef\u4ee5\u4f2a\u88c5 Kubelet\uff0c\u4ece\u800c\u5141\u8bb8\u4ed6\u4eec\u64cd\u7eb5\u8282\u70b9\u7684\u5c5e\u6027\u548c/\u6216\u5728\u96c6\u7fa4\u5185\u6a2a\u5411\u79fb\u52a8\u3002</p> <p>\u4ee5\u4e0b\u51e0\u8282\u5c06\u89e3\u91ca\u5982\u4f55\u5b9e\u73b0\u79df\u6237\u9694\u79bb\uff0c\u540c\u65f6\u7f13\u89e3\u4f7f\u7528 Kubernetes \u7b49\u5355\u79df\u6237\u7f16\u6392\u5668\u7684\u98ce\u9669\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_2","title":"\u8f6f\u591a\u79df\u6237","text":"<p>\u4f7f\u7528\u8f6f\u591a\u79df\u6237\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u672c\u5730 Kubernetes \u6784\u9020(\u4f8b\u5982\u547d\u540d\u7a7a\u95f4\u3001\u89d2\u8272\u548c\u89d2\u8272\u7ed1\u5b9a\u4ee5\u53ca\u7f51\u7edc\u7b56\u7565)\u5728\u79df\u6237\u4e4b\u95f4\u521b\u5efa\u903b\u8f91\u5206\u79bb\u3002\u4f8b\u5982\uff0cRBAC \u53ef\u4ee5\u9632\u6b62\u79df\u6237\u8bbf\u95ee\u6216\u64cd\u7eb5\u5f7c\u6b64\u7684\u8d44\u6e90\u3002\u914d\u989d\u548c\u9650\u5236\u8303\u56f4\u53ef\u4ee5\u63a7\u5236\u6bcf\u4e2a\u79df\u6237\u53ef\u4ee5\u6d88\u8017\u7684\u96c6\u7fa4\u8d44\u6e90\u91cf\uff0c\u800c\u7f51\u7edc\u7b56\u7565\u53ef\u4ee5\u5e2e\u52a9\u9632\u6b62\u90e8\u7f72\u5230\u4e0d\u540c\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u76f8\u4e92\u901a\u4fe1\u3002</p> <p>\u7136\u800c\uff0c\u8fd9\u4e9b\u63a7\u5236\u90fd\u65e0\u6cd5\u9632\u6b62\u6765\u81ea\u4e0d\u540c\u79df\u6237\u7684 pod \u5171\u4eab\u8282\u70b9\u3002\u5982\u679c\u9700\u8981\u66f4\u5f3a\u7684\u9694\u79bb\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8282\u70b9\u9009\u62e9\u5668\u3001\u53cd\u4eb2\u548c\u89c4\u5219\u548c/\u6216\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6\u6765\u5f3a\u5236\u5c06\u6765\u81ea\u4e0d\u540c\u79df\u6237\u7684 pod \u8c03\u5ea6\u5230\u5355\u72ec\u7684\u8282\u70b9\u4e0a;\u901a\u5e38\u79f0\u4e3a \u5355\u79df\u6237\u8282\u70b9\u3002\u5728\u6709\u8bb8\u591a\u79df\u6237\u7684\u73af\u5883\u4e2d\uff0c\u8fd9\u53ef\u80fd\u4f1a\u53d8\u5f97\u76f8\u5f53\u590d\u6742\u548c\u6210\u672c\u9ad8\u6602\u3002</p> <p>Attention</p> <p>\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5b9e\u73b0\u7684\u8f6f\u591a\u79df\u6237\u4e0d\u5141\u8bb8\u60a8\u5411\u79df\u6237\u63d0\u4f9b\u5df2\u8fc7\u6ee4\u7684\u547d\u540d\u7a7a\u95f4\u5217\u8868\uff0c\u56e0\u4e3a\u547d\u540d\u7a7a\u95f4\u662f\u5168\u5c40\u4f5c\u7528\u57df\u7c7b\u578b\u3002\u5982\u679c\u79df\u6237\u6709\u80fd\u529b\u67e5\u770b\u7279\u5b9a\u547d\u540d\u7a7a\u95f4\uff0c\u5b83\u5c31\u53ef\u4ee5\u67e5\u770b\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u547d\u540d\u7a7a\u95f4\u3002</p> <p>Warning</p> <p>\u5728\u8f6f\u591a\u79df\u6237\u73af\u5883\u4e2d\uff0c\u79df\u6237\u9ed8\u8ba4\u4fdd\u7559\u67e5\u8be2 CoreDNS \u4ee5\u83b7\u53d6\u96c6\u7fa4\u5185\u8fd0\u884c\u7684\u6240\u6709\u670d\u52a1\u7684\u80fd\u529b\u3002\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u4ece\u96c6\u7fa4\u4e2d\u7684\u4efb\u4f55 pod \u8fd0\u884c dig SRV <code>*.*.svc.cluster.local</code> \u6765\u5229\u7528\u8fd9\u4e00\u70b9\u3002\u5982\u679c\u60a8\u9700\u8981\u9650\u5236\u8bbf\u95ee\u96c6\u7fa4\u5185\u8fd0\u884c\u7684\u670d\u52a1\u7684 DNS \u8bb0\u5f55\uff0c\u8bf7\u8003\u8651\u4f7f\u7528 CoreDNS \u7684 Firewall \u6216 Policy \u63d2\u4ef6\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://github.com/coredns/policy#kubernetes-metadata-multi-tenancy-policy\u3002</p> <p>Kiosk \u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5b9e\u73b0\u8f6f\u591a\u79df\u6237\u3002\u5b83\u662f\u4f5c\u4e3a\u4e00\u7cfb\u5217 CRD \u548c\u63a7\u5236\u5668\u5b9e\u73b0\u7684\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u8d26\u6237\u548c\u8d26\u6237\u7528\u6237\u7528\u4e8e\u5728\u5171\u4eab Kubernetes \u96c6\u7fa4\u4e2d\u5206\u79bb\u79df\u6237</li> <li>\u81ea\u52a9\u547d\u540d\u7a7a\u95f4\u4f9b\u5e94\u4f9b\u8d26\u6237\u7528\u6237\u4f7f\u7528</li> <li>\u8d26\u6237\u9650\u5236\u786e\u4fdd\u5728\u5171\u4eab\u96c6\u7fa4\u65f6\u7684\u670d\u52a1\u8d28\u91cf\u548c\u516c\u5e73\u6027</li> <li>\u547d\u540d\u7a7a\u95f4\u6a21\u677f\u7528\u4e8e\u5b89\u5168\u7684\u79df\u6237\u9694\u79bb\u548c\u81ea\u52a9\u547d\u540d\u7a7a\u95f4\u521d\u59cb\u5316</li> </ul> <p>Loft \u662f Kiosk \u548c DevSpace \u7ef4\u62a4\u8005\u63d0\u4f9b\u7684\u5546\u4e1a\u4ea7\u54c1\uff0c\u589e\u52a0\u4e86\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u591a\u96c6\u7fa4\u8bbf\u95ee\u7528\u4e8e\u6388\u4e88\u5bf9\u4e0d\u540c\u96c6\u7fa4\u4e2d\u7a7a\u95f4\u7684\u8bbf\u95ee\u6743\u9650</li> <li>\u7761\u7720\u6a21\u5f0f\u5728\u7a7a\u95f2\u671f\u95f4\u7f29\u51cf\u7a7a\u95f4\u4e2d\u7684\u90e8\u7f72</li> <li>\u5355\u70b9\u767b\u5f55\u4e0e GitHub \u7b49 OIDC \u8eab\u4efd\u9a8c\u8bc1\u63d0\u4f9b\u5546\u96c6\u6210</li> </ul> <p>\u8f6f\u591a\u79df\u6237\u53ef\u4ee5\u89e3\u51b3\u4e09\u4e2a\u4e3b\u8981\u7528\u4f8b\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_3","title":"\u4f01\u4e1a\u73af\u5883","text":"<p>\u7b2c\u4e00\u4e2a\u662f\u4f01\u4e1a\u73af\u5883\uff0c\u5176\u4e2d\"\u79df\u6237\"\u662f\u534a\u4fe1\u4efb\u7684\uff0c\u5373\u4ed6\u4eec\u662f\u7ec4\u7ec7\u6388\u6743\u7684\u5458\u5de5\u3001\u627f\u5305\u5546\u6216\u5176\u4ed6\u4eba\u5458\u3002\u6bcf\u4e2a\u79df\u6237\u901a\u5e38\u4e0e\u884c\u653f\u90e8\u95e8\u6216\u56e2\u961f\u7b49\u7ba1\u7406\u90e8\u95e8\u76f8\u5bf9\u5e94\u3002</p> <p>\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\uff0c\u901a\u5e38\u7531\u96c6\u7fa4\u7ba1\u7406\u5458\u8d1f\u8d23\u521b\u5efa\u547d\u540d\u7a7a\u95f4\u548c\u7ba1\u7406\u7b56\u7565\u3002\u4ed6\u4eec\u8fd8\u53ef\u80fd\u5b9e\u65bd\u59d4\u6d3e\u7ba1\u7406\u6a21\u578b\uff0c\u5176\u4e2d\u67d0\u4e9b\u4e2a\u4eba\u88ab\u6388\u4e88\u5bf9\u547d\u540d\u7a7a\u95f4\u7684\u76d1\u7763\u6743\uff0c\u5141\u8bb8\u4ed6\u4eec\u5bf9\u975e\u7b56\u7565\u76f8\u5173\u5bf9\u8c61(\u5982\u90e8\u7f72\u3001\u670d\u52a1\u3001pod\u3001\u4f5c\u4e1a\u7b49)\u6267\u884c CRUD \u64cd\u4f5c\u3002</p> <p>\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\uff0c\u5bb9\u5668\u8fd0\u884c\u65f6\u63d0\u4f9b\u7684\u9694\u79bb\u53ef\u80fd\u662f\u53ef\u63a5\u53d7\u7684\uff0c\u6216\u8005\u53ef\u80fd\u9700\u8981\u901a\u8fc7\u989d\u5916\u7684 pod \u5b89\u5168\u6027\u63a7\u5236\u6765\u589e\u5f3a\u3002\u5982\u679c\u9700\u8981\u66f4\u4e25\u683c\u7684\u9694\u79bb\uff0c\u4e5f\u53ef\u80fd\u9700\u8981\u9650\u5236\u4e0d\u540c\u547d\u540d\u7a7a\u95f4\u4e2d\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\u3002</p>"},{"location":"zh/security/docs/multitenancy/#kubernetes","title":"Kubernetes \u4f5c\u4e3a\u670d\u52a1","text":"<p>\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u8f6f\u591a\u79df\u6237\u53ef\u4ee5\u7528\u4e8e\u5e0c\u671b\u63d0\u4f9b Kubernetes \u4f5c\u4e3a\u670d\u52a1 (KaaS) \u7684\u73af\u5883\u3002\u4f7f\u7528 KaaS\uff0c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6258\u7ba1\u5728\u5171\u4eab\u96c6\u7fa4\u4e2d\uff0c\u4e0e\u4e00\u7ec4\u63a7\u5236\u5668\u548c CRD \u4e00\u8d77\u63d0\u4f9b\u4e00\u7ec4 PaaS \u670d\u52a1\u3002\u79df\u6237\u76f4\u63a5\u4e0e Kubernetes API \u670d\u52a1\u5668\u4ea4\u4e92\uff0c\u5e76\u88ab\u5141\u8bb8\u5bf9\u975e\u7b56\u7565\u5bf9\u8c61\u6267\u884c CRUD \u64cd\u4f5c\u3002\u8fd8\u6709\u4e00\u4e2a\u81ea\u52a9\u670d\u52a1\u5143\u7d20\uff0c\u79df\u6237\u53ef\u80fd\u88ab\u5141\u8bb8\u521b\u5efa\u548c\u7ba1\u7406\u81ea\u5df1\u7684\u547d\u540d\u7a7a\u95f4\u3002\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\uff0c\u5047\u8bbe\u79df\u6237\u8fd0\u884c\u7684\u662f\u4e0d\u53d7\u4fe1\u4efb\u7684\u4ee3\u7801\u3002</p> <p>\u8981\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\u9694\u79bb\u79df\u6237\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5b9e\u65bd\u4e25\u683c\u7684\u7f51\u7edc\u7b56\u7565\u4ee5\u53ca pod \u6c99\u7bb1\u5316\u3002\u6c99\u7bb1\u5316\u662f\u6307\u5728\u5fae\u865a\u62df\u673a(\u5982 Firecracker)\u6216\u7528\u6237\u7a7a\u95f4\u5185\u6838\u4e2d\u8fd0\u884c pod \u7684\u5bb9\u5668\u3002\u4eca\u5929\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 EKS Fargate \u521b\u5efa\u6c99\u7bb1\u5316\u7684 pod\u3002</p>"},{"location":"zh/security/docs/multitenancy/#saas","title":"\u8f6f\u4ef6\u5373\u670d\u52a1 (SaaS)","text":"<p>\u8f6f\u591a\u79df\u6237\u7684\u6700\u540e\u4e00\u4e2a\u7528\u4f8b\u662f\u8f6f\u4ef6\u5373\u670d\u52a1 (SaaS) \u73af\u5883\u3002\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\uff0c\u6bcf\u4e2a\u79df\u6237\u90fd\u4e0e\u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7279\u5b9a \u5b9e\u4f8b \u76f8\u5173\u8054\u3002\u6bcf\u4e2a\u5b9e\u4f8b\u901a\u5e38\u90fd\u6709\u81ea\u5df1\u7684\u6570\u636e\uff0c\u5e76\u4f7f\u7528\u72ec\u7acb\u4e8e Kubernetes RBAC \u7684\u5355\u72ec\u8bbf\u95ee\u63a7\u5236\u3002</p> <p>\u4e0e\u5176\u4ed6\u7528\u4f8b\u4e0d\u540c\uff0cSaaS \u73af\u5883\u4e2d\u7684\u79df\u6237\u4e0d\u76f4\u63a5\u4e0e Kubernetes API \u4ea4\u4e92\u3002\u76f8\u53cd\uff0cSaaS \u5e94\u7528\u7a0b\u5e8f\u8d1f\u8d23\u4e0e Kubernetes API \u4ea4\u4e92\uff0c\u4ee5\u521b\u5efa\u652f\u6301\u6bcf\u4e2a\u79df\u6237\u6240\u9700\u7684\u5bf9\u8c61\u3002</p>"},{"location":"zh/security/docs/multitenancy/#kubernetes_1","title":"Kubernetes \u6784\u9020","text":"<p>\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e2d\uff0c\u90fd\u4f7f\u7528\u4ee5\u4e0b\u6784\u9020\u6765\u9694\u79bb\u79df\u6237\uff1a</p>"},{"location":"zh/security/docs/multitenancy/#_4","title":"\u547d\u540d\u7a7a\u95f4","text":"<p>\u547d\u540d\u7a7a\u95f4\u662f\u5b9e\u73b0\u8f6f\u591a\u79df\u6237\u7684\u57fa\u7840\u3002\u5b83\u4eec\u5141\u8bb8\u60a8\u5c06\u96c6\u7fa4\u5212\u5206\u4e3a\u903b\u8f91\u5206\u533a\u3002\u914d\u989d\u3001\u7f51\u7edc\u7b56\u7565\u3001\u670d\u52a1\u8d26\u6237\u548c\u5b9e\u73b0\u591a\u79df\u6237\u6240\u9700\u7684\u5176\u4ed6\u5bf9\u8c61\u90fd\u5728\u547d\u540d\u7a7a\u95f4\u8303\u56f4\u5185\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_5","title":"\u7f51\u7edc\u7b56\u7565","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u96c6\u7fa4\u4e2d\u7684\u6240\u6709 pod \u90fd\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u3002\u53ef\u4ee5\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u6765\u6539\u53d8\u8fd9\u79cd\u884c\u4e3a\u3002</p> <p>\u7f51\u7edc\u7b56\u7565\u4f7f\u7528\u6807\u7b7e\u6216 IP \u5730\u5740\u8303\u56f4\u6765\u9650\u5236 pod \u4e4b\u95f4\u7684\u901a\u4fe1\u3002\u5728\u9700\u8981\u5728\u79df\u6237\u4e4b\u95f4\u5b9e\u73b0\u4e25\u683c\u7f51\u7edc\u9694\u79bb\u7684\u591a\u79df\u6237\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u5efa\u8bae\u4ece\u4e00\u4e2a\u62d2\u7edd pod \u4e4b\u95f4\u901a\u4fe1\u7684\u9ed8\u8ba4\u89c4\u5219\u5f00\u59cb\uff0c\u4ee5\u53ca\u53e6\u4e00\u4e2a\u5141\u8bb8\u6240\u6709 pod \u67e5\u8be2 DNS \u670d\u52a1\u5668\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u7684\u89c4\u5219\u3002\u6709\u4e86\u8fd9\u4e2a\u57fa\u7840\uff0c\u60a8\u5c31\u53ef\u4ee5\u5f00\u59cb\u6dfb\u52a0\u66f4\u591a\u5141\u8bb8\u5728\u547d\u540d\u7a7a\u95f4\u5185\u901a\u4fe1\u7684\u89c4\u5219\u3002\u6839\u636e\u9700\u8981\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7ec6\u5316\u8fd9\u4e9b\u89c4\u5219\u3002</p> <p>Note</p> <p>Amazon VPC CNI \u73b0\u5728\u652f\u6301 Kubernetes \u7f51\u7edc\u7b56\u7565,\u53ef\u4ee5\u521b\u5efa\u7b56\u7565\u6765\u9694\u79bb\u654f\u611f\u5de5\u4f5c\u8d1f\u8f7d\u5e76\u4fdd\u62a4\u5b83\u4eec\u514d\u53d7\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\uff0c\u5f53\u5728 AWS \u4e0a\u8fd0\u884c Kubernetes \u65f6\u3002\u8fd9\u610f\u5473\u7740\u60a8\u53ef\u4ee5\u5728 Amazon EKS \u96c6\u7fa4\u4e2d\u4f7f\u7528\u7f51\u7edc\u7b56\u7565 API \u7684\u6240\u6709\u529f\u80fd\u3002\u8fd9\u79cd\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u4f7f\u60a8\u80fd\u591f\u5b9e\u73b0\u6700\u5c0f\u7279\u6743\u539f\u5219\uff0c\u786e\u4fdd\u53ea\u6709\u7ecf\u8fc7\u6388\u6743\u7684 pod \u624d\u80fd\u76f8\u4e92\u901a\u4fe1\u3002</p> <p>Attention</p> <p>\u7f51\u7edc\u7b56\u7565\u662f\u5fc5\u8981\u7684\uff0c\u4f46\u4e0d\u8db3\u4ee5\u5b9e\u73b0\u9694\u79bb\u3002\u7f51\u7edc\u7b56\u7565\u7684\u6267\u884c\u9700\u8981\u7b56\u7565\u5f15\u64ce\uff0c\u5982 Calico \u6216 Cilium\u3002</p>"},{"location":"zh/security/docs/multitenancy/#rbac","title":"\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236 (RBAC)","text":"<p>\u89d2\u8272\u548c\u89d2\u8272\u7ed1\u5b9a\u662f\u7528\u4e8e\u5728 Kubernetes \u4e2d\u5b9e\u65bd\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236 (RBAC) \u7684\u5bf9\u8c61\u3002\u89d2\u8272\u5305\u542b\u53ef\u4ee5\u5bf9\u96c6\u7fa4\u4e2d\u5bf9\u8c61\u6267\u884c\u7684\u64cd\u4f5c\u5217\u8868\u3002\u89d2\u8272\u7ed1\u5b9a\u6307\u5b9a\u5e94\u7528\u89d2\u8272\u7684\u4e2a\u4eba\u6216\u7ec4\u3002\u5728\u4f01\u4e1a\u548c KaaS \u73af\u5883\u4e2d\uff0cRBAC \u53ef\u7528\u4e8e\u5141\u8bb8\u9009\u5b9a\u7684\u7ec4\u6216\u4e2a\u4eba\u7ba1\u7406\u5bf9\u8c61\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_6","title":"\u914d\u989d","text":"<p>\u914d\u989d\u7528\u4e8e\u5b9a\u4e49\u6258\u7ba1\u5728\u96c6\u7fa4\u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u9650\u5236\u3002\u4f7f\u7528\u914d\u989d\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a pod \u53ef\u4ee5\u6d88\u8017\u7684\u6700\u5927 CPU \u548c\u5185\u5b58\u91cf\uff0c\u6216\u8005\u9650\u5236\u53ef\u4ee5\u5728\u96c6\u7fa4\u6216\u547d\u540d\u7a7a\u95f4\u4e2d\u5206\u914d\u7684\u8d44\u6e90\u6570\u91cf\u3002\u9650\u5236\u8303\u56f4\u5141\u8bb8\u60a8\u4e3a\u6bcf\u4e2a\u9650\u5236\u58f0\u660e\u6700\u5c0f\u3001\u6700\u5927\u548c\u9ed8\u8ba4\u503c\u3002</p> <p>\u5728\u5171\u4eab\u96c6\u7fa4\u4e2d\u8fc7\u5ea6\u4f7f\u7528\u8d44\u6e90\u901a\u5e38\u662f\u6709\u76ca\u7684\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u60a8\u6700\u5927\u9650\u5ea6\u5730\u5229\u7528\u8d44\u6e90\u3002\u4f46\u662f\uff0c\u5bf9\u96c6\u7fa4\u7684\u65e0\u9650\u5236\u8bbf\u95ee\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8d44\u6e90\u8017\u5c3d\uff0c\u4ece\u800c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u548c\u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u6027\u4e22\u5931\u3002\u5982\u679c pod \u7684\u8bf7\u6c42\u8bbe\u7f6e\u8fc7\u4f4e\uff0c\u5b9e\u9645\u8d44\u6e90\u5229\u7528\u7387\u8d85\u8fc7\u4e86\u8282\u70b9\u7684\u5bb9\u91cf\uff0c\u8282\u70b9\u5c06\u5f00\u59cb\u7ecf\u5386 CPU \u6216\u5185\u5b58\u538b\u529b\u3002\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0cpod \u53ef\u80fd\u4f1a\u5728\u8282\u70b9\u4e0a\u91cd\u65b0\u542f\u52a8\u548c/\u6216\u88ab\u9a71\u9010\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff0c\u60a8\u5e94\u8be5\u8ba1\u5212\u5728\u591a\u79df\u6237\u73af\u5883\u4e2d\u5bf9\u547d\u540d\u7a7a\u95f4\u5b9e\u65bd\u914d\u989d\uff0c\u4ee5\u5f3a\u5236\u79df\u6237\u5728\u96c6\u7fa4\u4e0a\u8c03\u5ea6 pod \u65f6\u6307\u5b9a\u8bf7\u6c42\u548c\u9650\u5236\u3002\u5b83\u8fd8\u5c06\u7f13\u89e3\u6f5c\u5728\u7684\u62d2\u7edd\u670d\u52a1\u653b\u51fb\uff0c\u9650\u5236 pod \u53ef\u4ee5\u6d88\u8017\u7684\u8d44\u6e90\u91cf\u3002</p> <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u914d\u989d\u6765\u6309\u7167\u79df\u6237\u7684\u652f\u51fa\u6765\u5206\u914d\u96c6\u7fa4\u8d44\u6e90\u3002\u8fd9\u5728 KaaS \u573a\u666f\u4e2d\u7279\u522b\u6709\u7528\u3002</p>"},{"location":"zh/security/docs/multitenancy/#pod","title":"Pod \u4f18\u5148\u7ea7\u548c\u62a2\u5360","text":"<p>\u5f53\u60a8\u5e0c\u671b\u4e3a Pod \u76f8\u5bf9\u4e8e\u5176\u4ed6 Pod \u63d0\u4f9b\u66f4\u9ad8\u7684\u91cd\u8981\u6027\u65f6\uff0cPod \u4f18\u5148\u7ea7\u548c\u62a2\u5360\u53ef\u80fd\u4f1a\u5f88\u6709\u7528\u3002\u4f8b\u5982\uff0c\u4f7f\u7528 pod \u4f18\u5148\u7ea7\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u6765\u81ea\u5ba2\u6237 A \u7684 pod \u4ee5\u6bd4\u6765\u81ea\u5ba2\u6237 B \u7684 pod \u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u8fd0\u884c\u3002\u5f53\u53ef\u7528\u5bb9\u91cf\u4e0d\u8db3\u65f6\uff0c\u8c03\u5ea6\u5668\u5c06\u9a71\u9010\u6765\u81ea\u5ba2\u6237 B \u7684\u8f83\u4f4e\u4f18\u5148\u7ea7 pod\uff0c\u4ee5\u5bb9\u7eb3\u6765\u81ea\u5ba2\u6237 A \u7684\u8f83\u9ad8\u4f18\u5148\u7ea7 pod\u3002\u5728\u5ba2\u6237\u613f\u610f\u652f\u4ed8\u66f4\u9ad8\u8d39\u7528\u4ee5\u83b7\u5f97\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684 SaaS \u73af\u5883\u4e2d\uff0c\u8fd9\u53ef\u80fd\u7279\u522b\u65b9\u4fbf\u3002</p> <p>Attention</p> <p>Pod \u4f18\u5148\u7ea7\u53ef\u80fd\u4f1a\u5bf9\u8f83\u4f4e\u4f18\u5148\u7ea7\u7684\u5176\u4ed6 Pod \u4ea7\u751f\u610f\u5916\u5f71\u54cd\u3002\u4f8b\u5982\uff0c\u867d\u7136\u53d7\u5bb3 pod \u4f1a\u88ab\u6b63\u5e38\u7ec8\u6b62\uff0c\u4f46 PodDisruptionBudget \u4e0d\u80fd\u5f97\u5230\u4fdd\u8bc1\uff0c\u8fd9\u53ef\u80fd\u4f1a\u7834\u574f\u4f9d\u8d56\u4e8e Pod \u4ef2\u88c1\u7684\u8f83\u4f4e\u4f18\u5148\u7ea7\u5e94\u7528\u7a0b\u5e8f\uff0c\u8bf7\u53c2\u9605 \u62a2\u5360\u7684\u9650\u5236\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_7","title":"\u7f13\u89e3\u63a7\u5236","text":"<p>\u4f5c\u4e3a\u591a\u79df\u6237\u73af\u5883\u7684\u7ba1\u7406\u5458\uff0c\u60a8\u7684\u4e3b\u8981\u5173\u6ce8\u70b9\u662f\u9632\u6b62\u653b\u51fb\u8005\u8bbf\u95ee\u5e95\u5c42\u4e3b\u673a\u3002\u5e94\u8003\u8651\u4ee5\u4e0b\u63a7\u5236\u63aa\u65bd\u6765\u7f13\u89e3\u8fd9\u79cd\u98ce\u9669\uff1a</p>"},{"location":"zh/security/docs/multitenancy/#_8","title":"\u5bb9\u5668\u7684\u6c99\u7bb1\u5316\u6267\u884c\u73af\u5883","text":"<p>\u6c99\u7bb1\u5316\u662f\u4e00\u79cd\u6280\u672f\uff0c\u6bcf\u4e2a\u5bb9\u5668\u90fd\u5728\u81ea\u5df1\u7684\u9694\u79bb\u865a\u62df\u673a\u4e2d\u8fd0\u884c\u3002\u6267\u884c pod \u6c99\u7bb1\u5316\u7684\u6280\u672f\u5305\u62ec Firecracker \u548c Weave \u7684 Firekube\u3002</p> <p>\u6709\u5173\u5c06 Firecracker \u4f5c\u4e3a EKS \u652f\u6301\u7684\u8fd0\u884c\u65f6\u7684\u5de5\u4f5c\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://threadreaderapp.com/thread/1238496944684597248.html\u3002</p>"},{"location":"zh/security/docs/multitenancy/#opa-gatekeeper","title":"\u5f00\u653e\u7b56\u7565\u4ee3\u7406 (OPA) \u548c Gatekeeper","text":"<p>Gatekeeper \u662f\u4e00\u4e2a Kubernetes \u51c6\u5165\u63a7\u5236\u5668\uff0c\u7528\u4e8e\u6267\u884c\u4f7f\u7528 OPA \u521b\u5efa\u7684\u7b56\u7565\u3002\u4f7f\u7528 OPA\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u7b56\u7565\uff0c\u5c06\u6765\u81ea\u79df\u6237\u7684 pod \u5728\u5355\u72ec\u7684\u5b9e\u4f8b\u4e0a\u8fd0\u884c\uff0c\u6216\u4ee5\u6bd4\u5176\u4ed6\u79df\u6237\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u8fd0\u884c\u3002\u8be5\u9879\u76ee\u7684 GitHub \u5b58\u50a8\u5e93\u4e2d\u5305\u542b\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684 OPA \u7b56\u7565\u96c6\u5408\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a\u5b9e\u9a8c\u6027\u7684 OPA CoreDNS \u63d2\u4ef6,\u5141\u8bb8\u60a8\u4f7f\u7528 OPA \u6765\u8fc7\u6ee4/\u63a7\u5236 CoreDNS \u8fd4\u56de\u7684\u8bb0\u5f55\u3002</p>"},{"location":"zh/security/docs/multitenancy/#kyverno","title":"Kyverno","text":"<p>Kyverno \u662f\u4e00\u4e2a Kubernetes \u539f\u751f\u7b56\u7565\u5f15\u64ce\uff0c\u53ef\u4ee5\u4f7f\u7528\u4f5c\u4e3a Kubernetes \u8d44\u6e90\u7684\u7b56\u7565\u6765\u9a8c\u8bc1\u3001\u53d8\u66f4\u548c\u751f\u6210\u914d\u7f6e\u3002Kyverno \u4f7f\u7528 Kustomize \u98ce\u683c\u7684\u8986\u76d6\u8fdb\u884c\u9a8c\u8bc1\uff0c\u652f\u6301 JSON Patch \u548c\u7b56\u7565\u5408\u5e76\u4fee\u8865\u8fdb\u884c\u53d8\u66f4\uff0c\u5e76\u4e14\u53ef\u4ee5\u6839\u636e\u7075\u6d3b\u7684\u89e6\u53d1\u5668\u5728\u547d\u540d\u7a7a\u95f4\u4e4b\u95f4\u514b\u9686\u8d44\u6e90\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 Kyverno \u9694\u79bb\u547d\u540d\u7a7a\u95f4\u3001\u5b9e\u65bd pod \u5b89\u5168\u6027\u548c\u5176\u4ed6\u6700\u4f73\u5b9e\u8df5\uff0c\u4ee5\u53ca\u751f\u6210\u9ed8\u8ba4\u914d\u7f6e(\u5982\u7f51\u7edc\u7b56\u7565)\u3002\u8be5\u9879\u76ee\u7684 GitHub \u5b58\u50a8\u5e93\u4e2d\u5305\u542b\u4e86\u4e00\u4e9b\u793a\u4f8b\u3002Kyverno \u7f51\u7ad9\u4e0a\u7684 \u7b56\u7565\u5e93\u4e2d\u4e5f\u5305\u542b\u4e86\u8bb8\u591a\u5176\u4ed6\u793a\u4f8b\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_9","title":"\u5c06\u79df\u6237\u5de5\u4f5c\u8d1f\u8f7d\u9694\u79bb\u5230\u7279\u5b9a\u8282\u70b9","text":"<p>\u5728\u8f6f\u591a\u79df\u6237\u6a21\u578b\u4e2d\uff0c\u5c06\u79df\u6237\u5de5\u4f5c\u8d1f\u8f7d\u9650\u5236\u5728\u7279\u5b9a\u8282\u70b9\u4e0a\u8fd0\u884c\u53ef\u4ee5\u589e\u52a0\u9694\u79bb\u3002\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u7279\u5b9a\u79df\u6237\u7684\u5de5\u4f5c\u8d1f\u8f7d\u53ea\u5728\u4e3a\u8be5\u79df\u6237\u914d\u7f6e\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\u3002\u4e3a\u5b9e\u73b0\u6b64\u9694\u79bb\uff0c\u4f7f\u7528\u672c\u5730 Kubernetes \u5c5e\u6027(\u8282\u70b9\u4eb2\u548c\u6027\u3001\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6)\u6765\u9488\u5bf9\u7279\u5b9a\u8282\u70b9\u8fdb\u884c pod \u8c03\u5ea6\uff0c\u5e76\u9632\u6b62\u6765\u81ea\u5176\u4ed6\u79df\u6237\u7684 pod \u88ab\u8c03\u5ea6\u5230\u7279\u5b9a\u79df\u6237\u7684\u8282\u70b9\u4e0a\u3002</p>"},{"location":"zh/security/docs/multitenancy/#1-","title":"\u7b2c 1 \u90e8\u5206 - \u8282\u70b9\u4eb2\u548c\u6027","text":"<p>Kubernetes \u8282\u70b9\u4eb2\u548c\u6027\u7528\u4e8e\u57fa\u4e8e\u8282\u70b9 \u6807\u7b7e\u9488\u5bf9\u8282\u70b9\u8fdb\u884c\u8c03\u5ea6\u3002\u4f7f\u7528\u8282\u70b9\u4eb2\u548c\u6027\u89c4\u5219\uff0cpod \u4f1a\u88ab\u5438\u5f15\u5230\u4e0e\u9009\u62e9\u5668\u9879\u5339\u914d\u7684\u7279\u5b9a\u8282\u70b9\u3002\u5728\u4e0b\u9762\u7684 pod \u89c4\u8303\u4e2d\uff0c<code>requiredDuringSchedulingIgnoredDuringExecution</code> \u8282\u70b9\u4eb2\u548c\u6027\u88ab\u5e94\u7528\u4e8e\u76f8\u5e94\u7684 pod\u3002\u7ed3\u679c\u662f pod \u5c06\u9488\u5bf9\u5e26\u6709\u4ee5\u4e0b\u952e/\u503c\u6807\u7b7e\u7684\u8282\u70b9\uff1a <code>node-restriction.kubernetes.io/tenant: tenants-x</code>\u3002</p> <pre><code>...\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: node-restriction.kubernetes.io/tenant\n            operator: In\n            values:\n            - tenants-x\n...\n</code></pre> <p>\u4f7f\u7528\u6b64\u8282\u70b9\u4eb2\u548c\u6027\uff0c\u6807\u7b7e\u5728\u8c03\u5ea6\u671f\u95f4\u662f\u5fc5\u9700\u7684\uff0c\u4f46\u5728\u6267\u884c\u671f\u95f4\u4e0d\u662f\u5fc5\u9700\u7684;\u5982\u679c\u5e95\u5c42\u8282\u70b9\u7684\u6807\u7b7e\u53d1\u751f\u53d8\u5316\uff0cpod \u4e0d\u4f1a\u4ec5\u56e0\u4e3a\u8be5\u6807\u7b7e\u66f4\u6539\u800c\u88ab\u9a71\u9010\u3002\u4f46\u662f\uff0c\u672a\u6765\u7684\u8c03\u5ea6\u53ef\u80fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002</p> <p>Warning</p> <p>\u6807\u7b7e\u524d\u7f00 <code>node-restriction.kubernetes.io/</code> \u5728 Kubernetes \u4e2d\u6709\u7279\u6b8a\u542b\u4e49\u3002NodeRestriction \u5728 EKS \u96c6\u7fa4\u4e2d\u542f\u7528\uff0c\u9632\u6b62 <code>kubelet</code> \u6dfb\u52a0/\u5220\u9664/\u66f4\u65b0\u5177\u6709\u6b64\u524d\u7f00\u7684\u6807\u7b7e\u3002\u653b\u51fb\u8005\u65e0\u6cd5\u4f7f\u7528 <code>kubelet</code> \u7684\u51ed\u636e\u6765\u66f4\u65b0\u8282\u70b9\u5bf9\u8c61\u6216\u4fee\u6539\u7cfb\u7edf\u8bbe\u7f6e\u4ee5\u5c06\u8fd9\u4e9b\u6807\u7b7e\u4f20\u9012\u7ed9 <code>kubelet</code>,\u56e0\u4e3a <code>kubelet</code> \u4e0d\u5141\u8bb8\u4fee\u6539\u8fd9\u4e9b\u6807\u7b7e\u3002\u5982\u679c\u4e3a pod \u5230\u8282\u70b9\u8c03\u5ea6\u4f7f\u7528\u4e86\u6b64\u524d\u7f00\uff0c\u5b83\u53ef\u4ee5\u9632\u6b62\u653b\u51fb\u8005\u901a\u8fc7\u4fee\u6539\u8282\u70b9\u6807\u7b7e\u6765\u5438\u5f15\u4e0d\u540c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u96c6\u5230\u8282\u70b9\u7684\u60c5\u51b5\u3002</p> <p>Info</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 \u8282\u70b9\u9009\u62e9\u5668\u800c\u4e0d\u662f\u8282\u70b9\u4eb2\u548c\u6027\u3002\u4f46\u662f\uff0c\u8282\u70b9\u4eb2\u548c\u6027\u66f4\u5177\u8868\u73b0\u529b\uff0c\u5e76\u5141\u8bb8\u5728 pod \u8c03\u5ea6\u671f\u95f4\u8003\u8651\u66f4\u591a\u6761\u4ef6\u3002\u6709\u5173\u5dee\u5f02\u548c\u66f4\u9ad8\u7ea7\u8c03\u5ea6\u9009\u62e9\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 CNCF \u535a\u5ba2\u6587\u7ae0 \u9ad8\u7ea7 Kubernetes pod \u5230\u8282\u70b9\u8c03\u5ea6\u3002</p>"},{"location":"zh/security/docs/multitenancy/#2-","title":"\u7b2c 2 \u90e8\u5206 - \u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6","text":"<p>\u5438\u5f15 pod \u5230\u8282\u70b9\u53ea\u662f\u8fd9\u79cd\u4e09\u90e8\u66f2\u65b9\u6cd5\u7684\u7b2c\u4e00\u90e8\u5206\u3002\u4e3a\u4e86\u4f7f\u8fd9\u79cd\u65b9\u6cd5\u6709\u6548\uff0c\u6211\u4eec\u5fc5\u987b\u963b\u6b62\u672a\u7ecf\u6388\u6743\u7684 pod \u8c03\u5ea6\u5230\u5b83\u4eec\u4e0d\u88ab\u6388\u6743\u7684\u8282\u70b9\u4e0a\u3002\u4e3a\u4e86\u963b\u6b62\u4e0d\u9700\u8981\u6216\u672a\u7ecf\u6388\u6743\u7684 pod\uff0cKubernetes \u4f7f\u7528\u8282\u70b9 \u6c61\u70b9\u3002\u6c61\u70b9\u7528\u4e8e\u5728\u8282\u70b9\u4e0a\u8bbe\u7f6e\u6761\u4ef6\uff0c\u4ee5\u9632\u6b62 pod \u88ab\u8c03\u5ea6\u3002\u4e0b\u9762\u7684\u6c61\u70b9\u4f7f\u7528\u952e\u503c\u5bf9 <code>tenant: tenants-x</code>\u3002</p> <pre><code>...\n    taints:\n      - key: tenant\n        value: tenants-x\n        effect: NoSchedule\n...\n</code></pre> <p>\u7ed9\u5b9a\u4e0a\u8ff0\u8282\u70b9 <code>taint</code>,\u53ea\u6709 \u5bb9\u5fcd \u8be5\u6c61\u70b9\u7684 pod \u624d\u80fd\u88ab\u5141\u8bb8\u8c03\u5ea6\u5230\u8be5\u8282\u70b9\u3002\u4e3a\u4e86\u5141\u8bb8\u6388\u6743\u7684 pod \u88ab\u8c03\u5ea6\u5230\u8282\u70b9\uff0c\u76f8\u5e94\u7684 pod \u89c4\u8303\u5fc5\u987b\u5305\u542b\u5bf9\u8be5\u6c61\u70b9\u7684 <code>toleration</code>,\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>...\n  tolerations:\n  - effect: NoSchedule\n    key: tenant\n    operator: Equal\n    value: tenants-x\n...\n</code></pre> <p>\u5177\u6709\u4e0a\u8ff0 <code>toleration</code> \u7684 pod \u4e0d\u4f1a\u56e0\u4e3a\u8be5\u7279\u5b9a\u6c61\u70b9\u800c\u88ab\u963b\u6b62\u8c03\u5ea6\u5230\u8282\u70b9\u3002\u6c61\u70b9\u4e5f\u88ab Kubernetes \u7528\u4e8e\u5728\u67d0\u4e9b\u6761\u4ef6\u4e0b(\u5982\u8282\u70b9\u8d44\u6e90\u538b\u529b)\u4e34\u65f6\u505c\u6b62 pod \u8c03\u5ea6\u3002\u4f7f\u7528\u8282\u70b9\u4eb2\u548c\u6027\u3001\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u6709\u6548\u5730\u5c06\u6240\u9700\u7684 pod \u5438\u5f15\u5230\u7279\u5b9a\u8282\u70b9\uff0c\u5e76\u963b\u6b62\u4e0d\u9700\u8981\u7684 pod\u3002</p> <p>Attention</p> <p>\u67d0\u4e9b Kubernetes pod \u9700\u8981\u5728\u6240\u6709\u8282\u70b9\u4e0a\u8fd0\u884c\u3002\u8fd9\u4e9b pod \u7684\u793a\u4f8b\u5305\u62ec\u7531 \u5bb9\u5668\u7f51\u7edc\u63a5\u53e3 (CNI) \u548c kube-proxy daemonsets \u542f\u52a8\u7684 pod\u3002\u4e3a\u6b64\uff0c\u8fd9\u4e9b pod \u7684\u89c4\u8303\u5305\u542b\u975e\u5e38\u5bbd\u677e\u7684\u5bb9\u5fcd\u5ea6\uff0c\u4ee5\u5bb9\u5fcd\u4e0d\u540c\u7684\u6c61\u70b9\u3002\u5e94\u5f53\u6ce8\u610f\u4e0d\u8981\u66f4\u6539\u8fd9\u4e9b\u5bb9\u5fcd\u5ea6\u3002\u66f4\u6539\u8fd9\u4e9b\u5bb9\u5fcd\u5ea6\u53ef\u80fd\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u64cd\u4f5c\u4e0d\u6b63\u786e\u3002\u6b64\u5916\uff0c\u7b56\u7565\u7ba1\u7406\u5de5\u5177(\u5982 OPA/Gatekeeper \u548c Kyverno)\u53ef\u7528\u4e8e\u7f16\u5199\u9a8c\u8bc1\u7b56\u7565\uff0c\u4ee5\u9632\u6b62\u672a\u7ecf\u6388\u6743\u7684 pod \u4f7f\u7528\u8fd9\u4e9b\u5bbd\u677e\u7684\u5bb9\u5fcd\u5ea6\u3002</p>"},{"location":"zh/security/docs/multitenancy/#3-","title":"\u7b2c 3 \u90e8\u5206 - \u57fa\u4e8e\u7b56\u7565\u7684\u8282\u70b9\u9009\u62e9\u7ba1\u7406","text":"<p>\u6709\u51e0\u79cd\u5de5\u5177\u53ef\u7528\u4e8e\u5e2e\u52a9\u7ba1\u7406 pod \u89c4\u8303\u7684\u8282\u70b9\u4eb2\u548c\u6027\u548c\u5bb9\u5fcd\u5ea6\uff0c\u5305\u62ec\u5728 CICD \u7ba1\u9053\u4e2d\u5b9e\u65bd\u89c4\u5219\u3002\u4f46\u662f\uff0c\u9694\u79bb\u7684\u5b9e\u65bd\u4e5f\u5e94\u8be5\u5728 Kubernetes \u96c6\u7fa4\u7ea7\u522b\u8fdb\u884c\u3002\u4e3a\u6b64\uff0c\u53ef\u4ee5\u4f7f\u7528\u7b56\u7565\u7ba1\u7406\u5de5\u5177\u6765 \u53d8\u66f4 \u4f20\u5165\u7684 Kubernetes API \u670d\u52a1\u5668\u8bf7\u6c42\uff0c\u6839\u636e\u8bf7\u6c42\u8d1f\u8f7d\u5e94\u7528\u4e0a\u8ff0\u8282\u70b9\u4eb2\u548c\u6027\u89c4\u5219\u548c\u5bb9\u5fcd\u5ea6\u3002</p> <p>\u4f8b\u5982\uff0c\u53ef\u4ee5\u4e3a tenants-x \u547d\u540d\u7a7a\u95f4\u4e2d\u7684 pod \u6dfb\u52a0\u6807\u8bb0\uff0c\u4ee5\u5141\u8bb8\u5728 tenants-x \u8282\u70b9\u4e0a\u8fdb\u884c\u8c03\u5ea6\u3002\u5229\u7528\u914d\u7f6e\u4e3a\u4f7f\u7528 Kubernetes \u53d8\u66f4\u51c6\u5165 Webhook \u7684\u7b56\u7565\u7ba1\u7406\u5de5\u5177\uff0c\u53ef\u4ee5\u4f7f\u7528\u7b56\u7565\u6765\u53d8\u66f4\u4f20\u5165\u7684 pod \u89c4\u8303\u3002\u53d8\u66f4\u4f1a\u6dfb\u52a0\u6240\u9700\u7684\u5143\u7d20\u4ee5\u5141\u8bb8\u6240\u9700\u7684\u8c03\u5ea6\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 OPA/Gatekeeper \u6dfb\u52a0\u8282\u70b9\u4eb2\u548c\u6027\u7684\u7b56\u7565\u793a\u4f8b\u3002</p> <pre><code>apiVersion: mutations.gatekeeper.sh/v1alpha1\nkind: Assign\nmetadata:\n  name: mutator-add-nodeaffinity-pod\n  annotations:\n    aws-eks-best-practices/description: &gt;-\n      Adds Node affinity - https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity\nspec:\n  applyTo:\n  - groups: [\"\"]\n    kinds: [\"Pod\"]\n    versions: [\"v1\"]\n  match:\n    namespaces: [\"tenants-x\"]\n  location: \"spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms\"\n  parameters:\n    assign:\n      value: \n        - matchExpressions:\n          - key: \"tenant\"\n            operator: In\n            values:\n            - \"tenants-x\"\n</code></pre> <p>\u4e0a\u8ff0\u7b56\u7565\u5e94\u7528\u4e8e Kubernetes API \u670d\u52a1\u5668\u8bf7\u6c42\uff0c\u4ee5\u5c06 pod \u5e94\u7528\u4e8e tenants-x \u547d\u540d\u7a7a\u95f4\u3002\u8be5\u7b56\u7565\u6dfb\u52a0\u4e86 <code>requiredDuringSchedulingIgnoredDuringExecution</code> \u8282\u70b9\u4eb2\u548c\u6027\u89c4\u5219\uff0c\u4ee5\u4fbf\u5c06 pod \u5438\u5f15\u5230\u5e26\u6709 <code>tenant: tenants-x</code> \u6807\u7b7e\u7684\u8282\u70b9\u3002</p> <p>\u4e0b\u9762\u7684\u7b2c\u4e8c\u4e2a\u7b56\u7565\u4f7f\u7528\u76f8\u540c\u7684\u76ee\u6807\u547d\u540d\u7a7a\u95f4\u548c\u7ec4\u3001\u79cd\u7c7b\u548c\u7248\u672c\u5339\u914d\u6761\u4ef6\uff0c\u5c06\u5bb9\u5fcd\u5ea6\u6dfb\u52a0\u5230\u540c\u4e00 pod \u89c4\u8303\u4e2d\u3002</p> <pre><code>apiVersion: mutations.gatekeeper.sh/v1alpha1\nkind: Assign\nmetadata:\n  name: mutator-add-toleration-pod\n  annotations:\n    aws-eks-best-practices/description: &gt;-\n      Adds toleration - https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\nspec:\n  applyTo:\n  - groups: [\"\"]\n    kinds: [\"Pod\"]\n    versions: [\"v1\"]\n  match:\n    namespaces: [\"tenants-x\"]\n  location: \"spec.tolerations\"\n  parameters:\n    assign:\n      value: \n      - key: \"tenant\"\n        operator: \"Equal\"\n        value: \"tenants-x\"\n        effect: \"NoSchedule\"\n</code></pre> <p>\u4e0a\u8ff0\u7b56\u7565\u4e13\u95e8\u9488\u5bf9 pod;\u8fd9\u662f\u7531\u4e8e\u7b56\u7565\u4e2d <code>location</code> \u5143\u7d20\u4e2d\u53d8\u66f4\u5143\u7d20\u7684\u8def\u5f84\u3002\u53ef\u4ee5\u7f16\u5199\u5176\u4ed6\u7b56\u7565\u6765\u5904\u7406\u521b\u5efa pod \u7684\u8d44\u6e90\uff0c\u5982 Deployment \u548c Job \u8d44\u6e90\u3002\u5217\u51fa\u7684\u7b56\u7565\u548c\u5176\u4ed6\u793a\u4f8b\u53ef\u4ee5\u5728\u672c\u6307\u5357\u7684\u914d\u5957 GitHub \u9879\u76ee\u4e2d\u67e5\u770b\u3002</p> <p>\u8fd9\u4e24\u4e2a\u53d8\u66f4\u7684\u7ed3\u679c\u662f\uff0cpod \u88ab\u5438\u5f15\u5230\u6240\u9700\u7684\u8282\u70b9\uff0c\u540c\u65f6\u4e5f\u4e0d\u4f1a\u88ab\u7279\u5b9a\u8282\u70b9\u7684\u6c61\u70b9\u6392\u65a5\u3002\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a <code>kubectl</code> \u8c03\u7528\u7684\u8f93\u51fa\u7247\u6bb5\uff0c\u7528\u4e8e\u83b7\u53d6\u5e26\u6709 <code>tenant=tenants-x</code> \u6807\u7b7e\u7684\u8282\u70b9\uff0c\u4ee5\u53ca\u83b7\u53d6 <code>tenants-x</code> \u547d\u540d\u7a7a\u95f4\u4e2d\u7684 pod\u3002</p> <pre><code>kubectl get nodes -l tenant=tenants-x\nNAME                                        \nip-10-0-11-255...\nip-10-0-28-81...\nip-10-0-43-107...\n\nkubectl -n tenants-x get pods -owide\nNAME                                  READY   STATUS    RESTARTS   AGE   IP            NODE\ntenant-test-deploy-58b895ff87-2q7xw   1/1     Running   0          13s   10.0.42.143   ip-10-0-43-107...\ntenant-test-deploy-58b895ff87-9b6hg   1/1     Running   0          13s   10.0.18.145   ip-10-0-28-81...\ntenant-test-deploy-58b895ff87-nxvw5   1/1     Running   0          13s   10.0.30.117   ip-10-0-28-81...\ntenant-test-deploy-58b895ff87-vw796   1/1     Running   0          13s   10.0.3.113    ip-10-0-11-255...\ntenant-test-pod                       1/1     Running   0          13s   10.0.35.83    ip-10-0-43-107...\n</code></pre> <p>\u6b63\u5982\u6211\u4eec\u4ece\u4e0a\u9762\u7684\u8f93\u51fa\u4e2d\u770b\u5230\u7684\uff0c\u6240\u6709 pod \u90fd\u88ab\u8c03\u5ea6\u5230\u5e26\u6709 <code>tenant=tenants-x</code> \u6807\u7b7e\u7684\u8282\u70b9\u4e0a\u3002\u7b80\u5355\u5730\u8bf4\uff0c\u8fd9\u4e9b pod \u53ea\u4f1a\u5728\u6240\u9700\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u800c\u5176\u4ed6\u6ca1\u6709\u6240\u9700\u4eb2\u548c\u6027\u548c\u5bb9\u5fcd\u5ea6\u7684 pod \u5219\u4e0d\u4f1a\u3002\u79df\u6237\u5de5\u4f5c\u8d1f\u8f7d\u5b9e\u9645\u4e0a\u662f\u9694\u79bb\u7684\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u53d8\u66f4\u540e\u7684 pod \u89c4\u8303\u793a\u4f8b\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: tenant-test-pod\n  namespace: tenants-x\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: tenant\n            operator: In\n            values:\n            - tenants-x\n...\n  tolerations:\n  - effect: NoSchedule\n    key: tenant\n    operator: Equal\n    value: tenants-x\n...\n</code></pre> <p>Attention</p> <p>\u96c6\u6210\u5230 Kubernetes API \u670d\u52a1\u5668\u8bf7\u6c42\u6d41\u7a0b\u7684\u7b56\u7565\u7ba1\u7406\u5de5\u5177\uff0c\u4f7f\u7528\u53d8\u66f4\u548c\u9a8c\u8bc1\u51c6\u5165 Webhook\uff0c\u65e8\u5728\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u54cd\u5e94 API \u670d\u52a1\u5668\u7684\u8bf7\u6c42\u3002\u8fd9\u901a\u5e38\u662f 3 \u79d2\u6216\u66f4\u77ed\u3002\u5982\u679c Webhook \u8c03\u7528\u672a\u80fd\u5728\u914d\u7f6e\u7684\u65f6\u95f4\u5185\u8fd4\u56de\u54cd\u5e94\uff0c\u5219\u4f20\u5165 API \u670d\u52a1\u5668\u8bf7\u6c42\u7684\u53d8\u66f4\u548c/\u6216\u9a8c\u8bc1\u53ef\u80fd\u4f1a\u6216\u53ef\u80fd\u4e0d\u4f1a\u53d1\u751f\u3002\u8fd9\u79cd\u884c\u4e3a\u53d6\u51b3\u4e8e\u51c6\u5165 Webhook \u914d\u7f6e\u662f\u8bbe\u7f6e\u4e3a Fail Open \u8fd8\u662f Fail Close\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u4e3a OPA/Gatekeeper \u7f16\u5199\u7684\u7b56\u7565\u3002\u4f46\u662f\uff0c\u4e5f\u6709\u5176\u4ed6\u7b56\u7565\u7ba1\u7406\u5de5\u5177\u53ef\u4ee5\u5904\u7406\u6211\u4eec\u7684\u8282\u70b9\u9009\u62e9\u7528\u4f8b\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a Kyverno \u7b56\u7565\u6765\u5904\u7406\u8282\u70b9\u4eb2\u548c\u6027\u53d8\u66f4\u3002</p> <p>Tip</p> <p>\u5982\u679c\u64cd\u4f5c\u6b63\u786e\uff0c\u53d8\u66f4\u7b56\u7565\u5c06\u5bf9\u4f20\u5165\u7684 API \u670d\u52a1\u5668\u8bf7\u6c42\u8d1f\u8f7d\u4ea7\u751f\u6240\u9700\u7684\u66f4\u6539\u3002\u4f46\u662f\uff0c\u4e5f\u5e94\u8be5\u5305\u62ec\u9a8c\u8bc1\u7b56\u7565\uff0c\u4ee5\u5728\u66f4\u6539\u6301\u4e45\u5316\u4e4b\u524d\u9a8c\u8bc1\u6240\u9700\u7684\u66f4\u6539\u662f\u5426\u53d1\u751f\u3002\u5728\u4f7f\u7528\u8fd9\u4e9b\u7b56\u7565\u8fdb\u884c\u79df\u6237\u5230\u8282\u70b9\u9694\u79bb\u65f6\uff0c\u8fd9\u4e00\u70b9\u5c24\u5176\u91cd\u8981\u3002\u5b9a\u671f\u68c0\u67e5\u96c6\u7fa4\u662f\u5426\u5b58\u5728\u4e0d\u9700\u8981\u7684\u914d\u7f6e\u4e5f\u662f\u4e2a\u597d\u4e3b\u610f\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_10","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li> <p>k-rail \u65e8\u5728\u5e2e\u52a9\u60a8\u901a\u8fc7\u5b9e\u65bd\u67d0\u4e9b\u7b56\u7565\u6765\u4fdd\u62a4\u591a\u79df\u6237\u73af\u5883\u3002</p> </li> <li> <p>\u4f7f\u7528 Amazon EKS \u7684\u591a\u79df\u6237 SaaS \u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u5168\u5b9e\u8df5</p> </li> </ul>"},{"location":"zh/security/docs/multitenancy/#_11","title":"\u786c\u591a\u79df\u6237","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u4e3a\u6bcf\u4e2a\u79df\u6237\u914d\u7f6e\u5355\u72ec\u7684\u96c6\u7fa4\u6765\u5b9e\u73b0\u786c\u591a\u79df\u6237\u3002\u867d\u7136\u8fd9\u5728\u79df\u6237\u4e4b\u95f4\u63d0\u4f9b\u4e86\u975e\u5e38\u5f3a\u5927\u7684\u9694\u79bb\uff0c\u4f46\u4e5f\u6709\u51e0\u4e2a\u7f3a\u70b9\u3002</p> <p>\u9996\u5148\uff0c\u5f53\u60a8\u6709\u8bb8\u591a\u79df\u6237\u65f6\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5f88\u5feb\u5c31\u4f1a\u53d8\u5f97\u6602\u8d35\u3002\u4e0d\u4ec5\u60a8\u5fc5\u987b\u4e3a\u6bcf\u4e2a\u96c6\u7fa4\u652f\u4ed8\u63a7\u5236\u5e73\u9762\u6210\u672c\uff0c\u800c\u4e14\u60a8\u5c06\u65e0\u6cd5\u5728\u96c6\u7fa4\u4e4b\u95f4\u5171\u4eab\u8ba1\u7b97\u8d44\u6e90\u3002\u6700\u7ec8\uff0c\u60a8\u5c06\u9047\u5230\u8d44\u6e90\u788e\u7247\u5316\u7684\u60c5\u51b5\uff0c\u5176\u4e2d\u4e00\u90e8\u5206\u96c6\u7fa4\u5229\u7528\u4e0d\u8db3\uff0c\u800c\u53e6\u4e00\u90e8\u5206\u96c6\u7fa4\u5219\u8fc7\u5ea6\u5229\u7528\u3002</p> <p>\u5176\u6b21\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u8d2d\u4e70\u6216\u6784\u5efa\u7279\u6b8a\u5de5\u5177\u6765\u7ba1\u7406\u6240\u6709\u8fd9\u4e9b\u96c6\u7fa4\u3002\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u7ba1\u7406\u6570\u767e\u6216\u6570\u5343\u4e2a\u96c6\u7fa4\u53ef\u80fd\u4f1a\u53d8\u5f97\u8fc7\u4e8e\u7e41\u91cd\u3002</p> <p>\u6700\u540e\uff0c\u4e3a\u6bcf\u4e2a\u79df\u6237\u521b\u5efa\u4e00\u4e2a\u96c6\u7fa4\u5c06\u6bd4\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u6162\u3002\u4f46\u662f\uff0c\u5728\u9ad8\u5ea6\u76d1\u7ba1\u7684\u884c\u4e1a\u6216\u9700\u8981\u5f3a\u9694\u79bb\u7684 SaaS \u73af\u5883\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u91c7\u7528\u786c\u79df\u6237\u65b9\u6cd5\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_12","title":"\u672a\u6765\u65b9\u5411","text":"<p>Kubernetes \u793e\u533a\u5df2\u7ecf\u8ba4\u8bc6\u5230\u8f6f\u591a\u79df\u6237\u7684\u5f53\u524d\u7f3a\u9677\u4ee5\u53ca\u786c\u591a\u79df\u6237\u7684\u6311\u6218\u3002\u591a\u79df\u6237\u7279\u522b\u5174\u8da3\u5c0f\u7ec4 (SIG) \u6b63\u8bd5\u56fe\u901a\u8fc7\u51e0\u4e2a\u5b75\u5316\u9879\u76ee(\u5305\u62ec\u5206\u5c42\u547d\u540d\u7a7a\u95f4\u63a7\u5236\u5668 (HNC) \u548c\u865a\u62df\u96c6\u7fa4)\u6765\u89e3\u51b3\u8fd9\u4e9b\u7f3a\u9677\u3002</p> <p>HNC \u63d0\u6848 (KEP) \u63cf\u8ff0\u4e86\u4e00\u79cd\u5728\u547d\u540d\u7a7a\u95f4\u4e4b\u95f4\u521b\u5efa\u7236\u5b50\u5173\u7cfb\u7684\u65b9\u5f0f\uff0c\u5177\u6709 [policy] \u5bf9\u8c61\u7ee7\u627f\u4ee5\u53ca\u79df\u6237\u7ba1\u7406\u5458\u521b\u5efa\u5b50\u547d\u540d\u7a7a\u95f4\u7684\u80fd\u529b\u3002</p> <p>\u865a\u62df\u96c6\u7fa4\u63d0\u6848\u63cf\u8ff0\u4e86\u4e3a\u6bcf\u4e2a\u79df\u6237\u5728\u96c6\u7fa4\u5185\u521b\u5efa\u5355\u72ec\u7684\u63a7\u5236\u5e73\u9762\u670d\u52a1\u5b9e\u4f8b(\u4e5f\u79f0\u4e3a\"Kubernetes on Kubernetes\")\u7684\u673a\u5236\uff0c\u5305\u62ec API \u670d\u52a1\u5668\u3001\u63a7\u5236\u5668\u7ba1\u7406\u5668\u548c\u8c03\u5ea6\u5668\u3002</p> <p>\u591a\u79df\u6237\u57fa\u51c6\u63d0\u6848\u63d0\u4f9b\u4e86\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u8fdb\u884c\u9694\u79bb\u548c\u5206\u6bb5\u5171\u4eab\u96c6\u7fa4\u7684\u6307\u5357\uff0c\u4ee5\u53ca\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177 kubectl-mtb \u6765\u9a8c\u8bc1\u5bf9\u8fd9\u4e9b\u6307\u5357\u7684\u9075\u4ece\u6027\u3002</p>"},{"location":"zh/security/docs/multitenancy/#_13","title":"\u591a\u96c6\u7fa4\u7ba1\u7406\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>Banzai Cloud</li> <li>Kommander</li> <li>Lens</li> <li>Nirmata</li> <li>Rafay</li> <li>Rancher</li> <li>Weave Flux</li> </ul>"},{"location":"zh/security/docs/network/","title":"\u7f51\u7edc\u5b89\u5168","text":"<p>\u7f51\u7edc\u5b89\u5168\u6709\u51e0\u4e2a\u65b9\u9762\u3002\u7b2c\u4e00\u4e2a\u6d89\u53ca\u5e94\u7528\u89c4\u5219\u6765\u9650\u5236\u7f51\u7edc\u6d41\u91cf\u5728\u670d\u52a1\u4e4b\u95f4\u7684\u6d41\u52a8\u3002\u7b2c\u4e8c\u4e2a\u6d89\u53ca\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u5bf9\u6d41\u91cf\u8fdb\u884c\u52a0\u5bc6\u3002\u5728 EKS \u4e0a\u5b9e\u73b0\u8fd9\u4e9b\u5b89\u5168\u63aa\u65bd\u7684\u673a\u5236\u5404\u4e0d\u76f8\u540c\uff0c\u4f46\u901a\u5e38\u5305\u62ec\u4ee5\u4e0b\u51e0\u9879\uff1a</p>"},{"location":"zh/security/docs/network/#_2","title":"\u6d41\u91cf\u63a7\u5236","text":"<ul> <li>\u7f51\u7edc\u7b56\u7565</li> <li>\u5b89\u5168\u7ec4</li> </ul>"},{"location":"zh/security/docs/network/#_3","title":"\u7f51\u7edc\u52a0\u5bc6","text":"<ul> <li>\u670d\u52a1\u7f51\u683c</li> <li>\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3 (CNI)</li> <li>Ingress \u63a7\u5236\u5668\u548c\u8d1f\u8f7d\u5747\u8861\u5668</li> <li>Nitro \u5b9e\u4f8b</li> <li>ACM \u79c1\u6709 CA \u4e0e cert-manager</li> </ul>"},{"location":"zh/security/docs/network/#_4","title":"\u7f51\u7edc\u7b56\u7565","text":"<p>\u5728 Kubernetes \u96c6\u7fa4\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6240\u6709 Pod \u4e4b\u95f4\u7684\u901a\u4fe1\u90fd\u662f\u5141\u8bb8\u7684\u3002\u867d\u7136\u8fd9\u79cd\u7075\u6d3b\u6027\u53ef\u80fd\u6709\u52a9\u4e8e\u4fc3\u8fdb\u5b9e\u9a8c\uff0c\u4f46\u5b83\u5e76\u4e0d\u88ab\u8ba4\u4e3a\u662f\u5b89\u5168\u7684\u3002Kubernetes \u7f51\u7edc\u7b56\u7565\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u79cd\u9650\u5236 Pod \u4e4b\u95f4\u7f51\u7edc\u6d41\u91cf(\u901a\u5e38\u79f0\u4e3a\u4e1c\u897f\u5411\u6d41\u91cf)\u4ee5\u53ca Pod \u548c\u5916\u90e8\u670d\u52a1\u4e4b\u95f4\u7f51\u7edc\u6d41\u91cf\u7684\u673a\u5236\u3002Kubernetes \u7f51\u7edc\u7b56\u7565\u5728 OSI \u6a21\u578b\u7684\u7b2c 3 \u5c42\u548c\u7b2c 4 \u5c42\u8fd0\u884c\u3002\u7f51\u7edc\u7b56\u7565\u4f7f\u7528 pod\u3001\u547d\u540d\u7a7a\u95f4\u9009\u62e9\u5668\u548c\u6807\u7b7e\u6765\u8bc6\u522b\u6e90\u548c\u76ee\u6807 pod\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5305\u62ec IP \u5730\u5740\u3001\u7aef\u53e3\u53f7\u3001\u534f\u8bae\u6216\u8fd9\u4e9b\u7684\u7ec4\u5408\u3002\u7f51\u7edc\u7b56\u7565\u53ef\u4ee5\u5e94\u7528\u4e8e pod \u7684\u5165\u7ad9\u6216\u51fa\u7ad9\u8fde\u63a5\uff0c\u901a\u5e38\u79f0\u4e3a\u5165\u7ad9\u548c\u51fa\u7ad9\u89c4\u5219\u3002</p> <p>\u901a\u8fc7 Amazon VPC CNI \u63d2\u4ef6\u7684\u539f\u751f\u7f51\u7edc\u7b56\u7565\u652f\u6301\uff0c\u60a8\u53ef\u4ee5\u5b9e\u73b0\u7f51\u7edc\u7b56\u7565\u6765\u4fdd\u62a4 kubernetes \u96c6\u7fa4\u4e2d\u7684\u7f51\u7edc\u6d41\u91cf\u3002\u8fd9\u4e0e\u4e0a\u6e38 Kubernetes \u7f51\u7edc\u7b56\u7565 API \u96c6\u6210\uff0c\u786e\u4fdd\u4e0e Kubernetes \u6807\u51c6\u7684\u517c\u5bb9\u6027\u548c\u9075\u4ece\u6027\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0a\u6e38 API \u652f\u6301\u7684\u4e0d\u540c\u6807\u8bc6\u7b26\u6765\u5b9a\u4e49\u7b56\u7565\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u90fd\u88ab\u5141\u8bb8\u8fdb\u5165 pod\u3002\u5f53\u6307\u5b9a\u4e86\u4e00\u4e2a\u5177\u6709 policyType Ingress \u7684\u7f51\u7edc\u7b56\u7565\u65f6\uff0c\u53ea\u6709\u6765\u81ea pod \u6240\u5728\u8282\u70b9\u7684\u8fde\u63a5\u4ee5\u53ca\u5165\u7ad9\u89c4\u5219\u5141\u8bb8\u7684\u8fde\u63a5\u624d\u80fd\u8fdb\u5165 pod\u3002\u51fa\u7ad9\u89c4\u5219\u4e5f\u662f\u5982\u6b64\u3002\u5982\u679c\u5b9a\u4e49\u4e86\u591a\u4e2a\u89c4\u5219\uff0c\u90a3\u4e48\u5728\u505a\u51fa\u51b3\u7b56\u65f6\u4f1a\u8003\u8651\u6240\u6709\u89c4\u5219\u7684\u5e76\u96c6\u3002\u56e0\u6b64\uff0c\u8bc4\u4f30\u7684\u987a\u5e8f\u4e0d\u4f1a\u5f71\u54cd\u7b56\u7565\u7ed3\u679c\u3002</p> <p>\u6ce8\u610f</p> <p>\u5f53\u60a8\u9996\u6b21\u914d\u7f6e EKS \u96c6\u7fa4\u65f6\uff0cVPC CNI \u7f51\u7edc\u7b56\u7565\u529f\u80fd\u9ed8\u8ba4\u662f\u4e0d\u542f\u7528\u7684\u3002\u8bf7\u786e\u4fdd\u60a8\u90e8\u7f72\u4e86\u652f\u6301\u7684 VPC CNI \u63d2\u4ef6\u7248\u672c\uff0c\u5e76\u5728 vpc-cni \u63d2\u4ef6\u4e0a\u5c06 <code>ENABLE_NETWORK_POLICY</code> \u6807\u5fd7\u8bbe\u7f6e\u4e3a <code>true</code> \u4ee5\u542f\u7528\u6b64\u529f\u80fd\u3002\u6709\u5173\u8be6\u7ec6\u8bf4\u660e\uff0c\u8bf7\u53c2\u9605 Amazon EKS \u7528\u6237\u6307\u5357\u3002</p>"},{"location":"zh/security/docs/network/#_5","title":"\u5efa\u8bae","text":""},{"location":"zh/security/docs/network/#-","title":"\u5f00\u59cb\u4f7f\u7528\u7f51\u7edc\u7b56\u7565 - \u9075\u5faa\u6700\u5c0f\u7279\u6743\u539f\u5219","text":""},{"location":"zh/security/docs/network/#_6","title":"\u521b\u5efa\u9ed8\u8ba4\u62d2\u7edd\u7b56\u7565","text":"<p>\u4e0e RBAC \u7b56\u7565\u4e00\u6837\uff0c\u5efa\u8bae\u5728\u7f51\u7edc\u7b56\u7565\u4e2d\u9075\u5faa\u6700\u5c0f\u7279\u6743\u8bbf\u95ee\u539f\u5219\u3002\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u62d2\u7edd\u6240\u6709\u7b56\u7565\uff0c\u8be5\u7b56\u7565\u9650\u5236\u4e86\u547d\u540d\u7a7a\u95f4\u5185\u7684\u6240\u6709\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u3002</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\n  namespace: default\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n</code></pre> <p></p> <p>\u63d0\u793a</p> <p>\u4e0a\u56fe\u662f\u7531 Tufin \u7684\u7f51\u7edc\u7b56\u7565\u67e5\u770b\u5668\u521b\u5efa\u7684\u3002</p>"},{"location":"zh/security/docs/network/#dns","title":"\u521b\u5efa\u4e00\u4e2a\u89c4\u5219\u4ee5\u5141\u8bb8 DNS \u67e5\u8be2","text":"<p>\u4e00\u65e6\u60a8\u8bbe\u7f6e\u4e86\u9ed8\u8ba4\u7684\u5168\u90e8\u62d2\u7edd\u89c4\u5219\uff0c\u60a8\u5c31\u53ef\u4ee5\u5f00\u59cb\u5c42\u5c42\u6dfb\u52a0\u5176\u4ed6\u89c4\u5219\uff0c\u4f8b\u5982\u5141\u8bb8 pod \u67e5\u8be2 CoreDNS \u8fdb\u884c\u540d\u79f0\u89e3\u6790\u7684\u89c4\u5219\u3002</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-dns-access\n  namespace: default\nspec:\n  podSelector:\n    matchLabels: {}\n  policyTypes:\n  - Egress\n  egress:\n  - to:\n    - namespaceSelector:\n        matchLabels:\n          kubernetes.io/metadata.name: kube-system\n      podSelector:\n        matchLabels:\n          k8s-app: kube-dns\n    ports:\n    - protocol: UDP\n      port: 53\n</code></pre> <p></p>"},{"location":"zh/security/docs/network/#pod","title":"\u9010\u6b65\u6dfb\u52a0\u89c4\u5219\u4ee5\u9009\u62e9\u6027\u5730\u5141\u8bb8\u6d41\u91cf\u5728\u547d\u540d\u7a7a\u95f4/pod \u4e4b\u95f4\u6d41\u52a8","text":"<p>\u4e86\u89e3\u5e94\u7528\u7a0b\u5e8f\u9700\u6c42\uff0c\u5e76\u6839\u636e\u9700\u8981\u521b\u5efa\u7ec6\u7c92\u5ea6\u7684\u5165\u7ad9\u548c\u51fa\u7ad9\u89c4\u5219\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u5c06\u7aef\u53e3 80 \u4e0a\u7684\u5165\u7ad9\u6d41\u91cf\u9650\u5236\u4e3a\u4ece <code>client-one</code> \u5230 <code>app-one</code>\u3002\u8fd9\u6709\u52a9\u4e8e\u6700\u5c0f\u5316\u653b\u51fb\u9762\uff0c\u964d\u4f4e\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u7684\u98ce\u9669\u3002</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-ingress-app-one\n  namespace: default\nspec:\n  podSelector:\n    matchLabels:\n      k8s-app: app-one\n  policyTypes:\n  - Ingress\n  ingress:\n  - from:\n    - podSelector:\n        matchLabels:\n          k8s-app: client-one\n    ports:\n    - protocol: TCP\n      port: 80\n</code></pre> <p></p>"},{"location":"zh/security/docs/network/#_7","title":"\u76d1\u63a7\u7f51\u7edc\u7b56\u7565\u6267\u884c","text":"<ul> <li>\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u7f16\u8f91\u5668</li> <li>\u7f51\u7edc\u7b56\u7565\u7f16\u8f91\u5668 \u6709\u52a9\u4e8e\u53ef\u89c6\u5316\u3001\u5b89\u5168\u8bc4\u5206\u3001\u4ece\u7f51\u7edc\u6d41\u65e5\u5fd7\u81ea\u52a8\u751f\u6210</li> <li>\u4ee5\u4ea4\u4e92\u65b9\u5f0f\u6784\u5efa\u7f51\u7edc\u7b56\u7565</li> <li>\u5ba1\u8ba1\u65e5\u5fd7</li> <li>\u5b9a\u671f\u5ba1\u67e5\u60a8\u7684 EKS \u96c6\u7fa4\u7684\u5ba1\u8ba1\u65e5\u5fd7</li> <li>\u5ba1\u8ba1\u65e5\u5fd7\u63d0\u4f9b\u4e86\u6709\u5173\u5728\u60a8\u7684\u96c6\u7fa4\u4e0a\u6267\u884c\u7684\u64cd\u4f5c\u7684\u5927\u91cf\u4fe1\u606f\uff0c\u5305\u62ec\u5bf9\u7f51\u7edc\u7b56\u7565\u7684\u66f4\u6539</li> <li>\u4f7f\u7528\u6b64\u4fe1\u606f\u8ddf\u8e2a\u60a8\u7684\u7f51\u7edc\u7b56\u7565\u968f\u65f6\u95f4\u7684\u53d8\u5316\uff0c\u5e76\u68c0\u6d4b\u4efb\u4f55\u672a\u7ecf\u6388\u6743\u6216\u610f\u5916\u7684\u66f4\u6539</li> <li>\u81ea\u52a8\u5316\u6d4b\u8bd5</li> <li>\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u6a21\u62df\u751f\u4ea7\u73af\u5883\u7684\u6d4b\u8bd5\u73af\u5883\u6765\u5b9e\u73b0\u81ea\u52a8\u5316\u6d4b\u8bd5\uff0c\u5e76\u5b9a\u671f\u90e8\u7f72\u8bd5\u56fe\u8fdd\u53cd\u60a8\u7684\u7f51\u7edc\u7b56\u7565\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</li> <li>\u76d1\u63a7\u6307\u6807</li> <li>\u914d\u7f6e\u60a8\u7684\u53ef\u89c2\u5bdf\u6027\u4ee3\u7406\u4ece VPC CNI \u8282\u70b9\u4ee3\u7406\u4e2d\u6293\u53d6 Prometheus \u6307\u6807\uff0c\u8fd9\u5141\u8bb8\u76d1\u63a7\u4ee3\u7406\u5065\u5eb7\u72b6\u51b5\u548c SDK \u9519\u8bef\u3002</li> <li>\u5b9a\u671f\u5ba1\u6838\u7f51\u7edc\u7b56\u7565</li> <li>\u5b9a\u671f\u5ba1\u6838\u60a8\u7684\u7f51\u7edc\u7b56\u7565\uff0c\u4ee5\u786e\u4fdd\u5b83\u4eec\u6ee1\u8db3\u60a8\u5f53\u524d\u7684\u5e94\u7528\u7a0b\u5e8f\u8981\u6c42\u3002\u968f\u7740\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u53d1\u5c55\uff0c\u5ba1\u6838\u4e3a\u60a8\u63d0\u4f9b\u4e86\u673a\u4f1a\u6765\u5220\u9664\u5197\u4f59\u7684\u5165\u7ad9\u3001\u51fa\u7ad9\u89c4\u5219\uff0c\u5e76\u786e\u4fdd\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8fc7\u591a\u7684\u6743\u9650\u3002</li> <li>\u4f7f\u7528 Open Policy Agent (OPA) \u786e\u4fdd\u7f51\u7edc\u7b56\u7565\u7684\u5b58\u5728</li> <li>\u4f7f\u7528\u5982\u4e0b\u6240\u793a\u7684 OPA \u7b56\u7565\uff0c\u4ee5\u786e\u4fdd\u5728\u4e0a\u7ebf\u5e94\u7528\u7a0b\u5e8f pod \u4e4b\u524d\u7f51\u7edc\u7b56\u7565\u59cb\u7ec8\u5b58\u5728\u3002\u5982\u679c\u6ca1\u6709\u76f8\u5e94\u7684\u7f51\u7edc\u7b56\u7565\uff0c\u6b64\u7b56\u7565\u5c06\u62d2\u7edd\u4e0a\u7ebf\u5e26\u6709\u6807\u7b7e <code>k8s-app: sample-app</code> \u7684 k8s pod\u3002</li> </ul> <pre><code>package kubernetes.admission\nimport data.kubernetes.networkpolicies\n\ndeny[msg] {\n    input.request.kind.kind == \"Pod\"\n    pod_label_value := {v[\"k8s-app\"] | v := input.request.object.metadata.labels}\n    contains_label(pod_label_value, \"sample-app\")\n    np_label_value := {v[\"k8s-app\"] | v := networkpolicies[_].spec.podSelector.matchLabels}\n    not contains_label(np_label_value, \"sample-app\")\n    msg:= sprintf(\"The Pod %v could not be created because it is missing an associated Network Policy.\", [input.request.object.metadata.name])\n}\ncontains_label(arr, val) {\n    arr[_] == val\n}\n</code></pre>"},{"location":"zh/security/docs/network/#_8","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"zh/security/docs/network/#vpc-network-policy-controller","title":"\u76d1\u63a7 vpc-network-policy-controller \u548c\u8282\u70b9\u4ee3\u7406\u65e5\u5fd7","text":"<p>\u542f\u7528 EKS \u63a7\u5236\u5e73\u9762\u63a7\u5236\u5668\u7ba1\u7406\u5668\u65e5\u5fd7\uff0c\u4ee5\u8bca\u65ad\u7f51\u7edc\u7b56\u7565\u529f\u80fd\u3002\u60a8\u53ef\u4ee5\u5c06\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u6d41\u5f0f\u4f20\u8f93\u5230 CloudWatch \u65e5\u5fd7\u7ec4\uff0c\u5e76\u4f7f\u7528 CloudWatch \u65e5\u5fd7\u6d1e\u5bdf \u6267\u884c\u9ad8\u7ea7\u67e5\u8be2\u3002\u4ece\u65e5\u5fd7\u4e2d\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b\u54ea\u4e9b pod \u7aef\u70b9\u5bf9\u8c61\u88ab\u89e3\u6790\u4e3a\u7f51\u7edc\u7b56\u7565\u3001\u7b56\u7565\u7684\u534f\u8c03\u72b6\u6001\uff0c\u5e76\u8c03\u8bd5\u7b56\u7565\u662f\u5426\u6309\u9884\u671f\u5de5\u4f5c\u3002</p> <p>\u6b64\u5916\uff0cAmazon VPC CNI \u5141\u8bb8\u60a8\u542f\u7528\u4ece EKS \u5de5\u4f5c\u8282\u70b9\u6536\u96c6\u548c\u5bfc\u51fa\u7b56\u7565\u6267\u884c\u65e5\u5fd7\u5230 Amazon Cloudwatch \u7684\u529f\u80fd\u3002\u542f\u7528\u540e\uff0c\u60a8\u53ef\u4ee5\u5229\u7528 CloudWatch \u5bb9\u5668\u6d1e\u5bdf \u6765\u63d0\u4f9b\u4e0e\u7f51\u7edc\u7b56\u7565\u76f8\u5173\u7684\u4f7f\u7528\u60c5\u51b5\u6d1e\u5bdf\u3002</p> <p>Amazon VPC CNI \u8fd8\u9644\u5e26\u4e86\u4e00\u4e2a SDK\uff0c\u63d0\u4f9b\u4e86\u4e0e\u8282\u70b9\u4e0a\u7684 eBPF \u7a0b\u5e8f\u4ea4\u4e92\u7684\u63a5\u53e3\u3002\u5f53 <code>aws-node</code> \u90e8\u7f72\u5230\u8282\u70b9\u4e0a\u65f6\uff0c\u5c31\u4f1a\u5b89\u88c5\u8be5 SDK\u3002\u60a8\u53ef\u4ee5\u5728\u8282\u70b9\u4e0a\u7684 <code>/opt/cni/bin</code> \u76ee\u5f55\u4e0b\u627e\u5230\u5df2\u5b89\u88c5\u7684 SDK \u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u5728\u542f\u52a8\u65f6\uff0cSDK \u652f\u6301\u57fa\u672c\u529f\u80fd\uff0c\u5982\u68c0\u67e5 eBPF \u7a0b\u5e8f\u548c\u6620\u5c04\u3002</p> <pre><code>sudo /opt/cni/bin/aws-eks-na-cli ebpf progs\n</code></pre>"},{"location":"zh/security/docs/network/#_9","title":"\u8bb0\u5f55\u7f51\u7edc\u6d41\u91cf\u5143\u6570\u636e","text":"<p>AWS VPC \u6d41\u65e5\u5fd7\u6355\u83b7\u6d41\u7ecf VPC \u7684\u6d41\u91cf\u7684\u5143\u6570\u636e\uff0c\u4f8b\u5982\u6e90\u548c\u76ee\u6807 IP \u5730\u5740\u548c\u7aef\u53e3\u4ee5\u53ca\u63a5\u53d7/\u4e22\u5f03\u7684\u6570\u636e\u5305\u3002\u53ef\u4ee5\u5206\u6790\u6b64\u4fe1\u606f\uff0c\u4ee5\u67e5\u627e VPC \u5185\u8d44\u6e90(\u5305\u62ec Pod)\u4e4b\u95f4\u7684\u53ef\u7591\u6216\u5f02\u5e38\u6d3b\u52a8\u3002\u4f46\u662f\uff0c\u7531\u4e8e pod \u7684 IP \u5730\u5740\u5728\u66ff\u6362\u65f6\u7ecf\u5e38\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u6b64\u4ec5\u4f9d\u8d56\u6d41\u65e5\u5fd7\u53ef\u80fd\u662f\u4e0d\u591f\u7684\u3002Calico Enterprise \u901a\u8fc7 pod \u6807\u7b7e\u548c\u5176\u4ed6\u5143\u6570\u636e\u6269\u5c55\u4e86\u6d41\u65e5\u5fd7\uff0c\u4f7f\u5f97\u66f4\u5bb9\u6613\u89e3\u6790 pod \u4e4b\u95f4\u7684\u6d41\u91cf\u6d41\u3002</p>"},{"location":"zh/security/docs/network/#_10","title":"\u5b89\u5168\u7ec4","text":"<p>EKS \u4f7f\u7528 AWS VPC \u5b89\u5168\u7ec4 (SG) \u6765\u63a7\u5236 Kubernetes \u63a7\u5236\u5e73\u9762\u548c\u96c6\u7fa4\u7684\u5de5\u4f5c\u8282\u70b9\u4e4b\u95f4\u7684\u6d41\u91cf\u3002\u5b89\u5168\u7ec4\u4e5f\u7528\u4e8e\u63a7\u5236\u5de5\u4f5c\u8282\u70b9\u4e0e\u5176\u4ed6 VPC \u8d44\u6e90\u3001\u5916\u90e8 IP \u5730\u5740\u4e4b\u95f4\u7684\u6d41\u91cf\u3002\u5f53\u60a8\u914d\u7f6e EKS \u96c6\u7fa4(\u4f7f\u7528 Kubernetes \u7248\u672c 1.14-eks.3 \u6216\u66f4\u9ad8\u7248\u672c)\u65f6\uff0c\u4f1a\u4e3a\u60a8\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u96c6\u7fa4\u5b89\u5168\u7ec4\u3002\u6b64\u5b89\u5168\u7ec4\u5141\u8bb8 EKS \u63a7\u5236\u5e73\u9762\u548c\u6258\u7ba1\u8282\u70b9\u7ec4\u4e4b\u95f4\u7684\u65e0\u963b\u788d\u901a\u4fe1\u3002\u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\uff0c\u5efa\u8bae\u60a8\u5c06\u96c6\u7fa4 SG \u6dfb\u52a0\u5230\u6240\u6709\u8282\u70b9\u7ec4\uff0c\u5305\u62ec\u975e\u6258\u7ba1\u8282\u70b9\u7ec4\u3002</p> <p>\u5728 Kubernetes \u7248\u672c 1.14 \u548c EKS \u7248\u672c eks.3 \u4e4b\u524d\uff0cEKS \u63a7\u5236\u5e73\u9762\u548c\u8282\u70b9\u7ec4\u914d\u7f6e\u4e86\u5355\u72ec\u7684\u5b89\u5168\u7ec4\u3002EKS \u63a7\u5236\u5e73\u9762\u548c\u8282\u70b9\u7ec4\u5b89\u5168\u7ec4\u7684\u6700\u5c0f\u548c\u5efa\u8bae\u89c4\u5219\u53ef\u4ee5\u5728 https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html \u4e2d\u627e\u5230\u3002_\u63a7\u5236\u5e73\u9762\u5b89\u5168\u7ec4_\u7684\u6700\u5c0f\u89c4\u5219\u5141\u8bb8\u4ece\u5de5\u4f5c\u8282\u70b9 SG \u8fdb\u5165\u7aef\u53e3 443\u3002\u8fd9\u4e2a\u89c4\u5219\u5141\u8bb8 kubelet \u4e0e Kubernetes API \u670d\u52a1\u5668\u901a\u4fe1\u3002\u5b83\u8fd8\u5305\u62ec\u7aef\u53e3 10250 \u7684\u51fa\u7ad9\u6d41\u91cf\u5230\u5de5\u4f5c\u8282\u70b9 SG;10250 \u662f kubelet \u76d1\u542c\u7684\u7aef\u53e3\u3002\u7c7b\u4f3c\u5730\uff0c_\u8282\u70b9\u7ec4_\u89c4\u5219\u5141\u8bb8\u4ece\u63a7\u5236\u5e73\u9762 SG \u8fdb\u5165\u7aef\u53e3 10250\uff0c\u5e76\u5141\u8bb8\u7aef\u53e3 443 \u7684\u51fa\u7ad9\u6d41\u91cf\u5230\u63a7\u5236\u5e73\u9762 SG\u3002\u6700\u540e\uff0c\u8fd8\u6709\u4e00\u6761\u89c4\u5219\u5141\u8bb8\u8282\u70b9\u7ec4\u5185\u8282\u70b9\u4e4b\u95f4\u7684\u65e0\u963b\u788d\u901a\u4fe1\u3002</p> <p>\u5982\u679c\u60a8\u9700\u8981\u63a7\u5236\u96c6\u7fa4\u5185\u8fd0\u884c\u7684\u670d\u52a1\u4e0e\u96c6\u7fa4\u5916\u8fd0\u884c\u7684\u670d\u52a1(\u5982 RDS \u6570\u636e\u5e93)\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u8bf7\u8003\u8651\u4e3a pod \u4f7f\u7528\u5b89\u5168\u7ec4\u3002\u4f7f\u7528\u5b89\u5168\u7ec4\u4e3a pod\uff0c\u60a8\u53ef\u4ee5\u5c06\u4e00\u4e2a\u73b0\u6709\u7684\u5b89\u5168\u7ec4\u5206\u914d\u7ed9\u4e00\u7ec4 pod\u3002</p> <p>\u8b66\u544a</p> <p>\u5982\u679c\u60a8\u5f15\u7528\u4e86\u5728\u521b\u5efa pod \u4e4b\u524d\u4e0d\u5b58\u5728\u7684\u5b89\u5168\u7ec4\uff0c\u5219 pod \u5c06\u65e0\u6cd5\u88ab\u8c03\u5ea6\u3002</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa <code>SecurityGroupPolicy</code> \u5bf9\u8c61\u5e76\u6307\u5b9a <code>PodSelector</code> \u6216 <code>ServiceAccountSelector</code> \u6765\u63a7\u5236\u5206\u914d\u7ed9\u54ea\u4e9b pod \u7684\u5b89\u5168\u7ec4\u3002\u5c06\u9009\u62e9\u5668\u8bbe\u7f6e\u4e3a <code>{}</code> \u5c06\u628a <code>SecurityGroupPolicy</code> \u4e2d\u5f15\u7528\u7684 SG \u5206\u914d\u7ed9\u547d\u540d\u7a7a\u95f4\u6216\u547d\u540d\u7a7a\u95f4\u4e2d\u6240\u6709\u670d\u52a1\u5e10\u6237\u4e2d\u7684\u6240\u6709 pod\u3002\u5728\u5b9e\u73b0\u5b89\u5168\u7ec4\u4e3a pod \u4e4b\u524d\uff0c\u8bf7\u52a1\u5fc5\u719f\u6089\u6240\u6709\u6ce8\u610f\u4e8b\u9879\u3002</p> <p>\u91cd\u8981</p> <p>\u5982\u679c\u60a8\u4f7f\u7528 SG \u4e3a pod\uff0c\u60a8\u5fc5\u987b\u521b\u5efa\u5141\u8bb8\u7aef\u53e3 53 \u51fa\u7ad9\u5230\u96c6\u7fa4\u5b89\u5168\u7ec4\u7684\u89c4\u5219\u3002\u540c\u6837\uff0c\u60a8\u5fc5\u987b\u66f4\u65b0\u96c6\u7fa4\u5b89\u5168\u7ec4\u4ee5\u63a5\u53d7\u6765\u81ea pod \u5b89\u5168\u7ec4\u7684\u7aef\u53e3 53 \u5165\u7ad9\u6d41\u91cf\u3002</p> <p>\u91cd\u8981</p> <p>\u5b89\u5168\u7ec4\u7684\u9650\u5236\u5728\u4f7f\u7528\u5b89\u5168\u7ec4\u4e3a pod \u65f6\u4ecd\u7136\u9002\u7528\uff0c\u56e0\u6b64\u8bf7\u8c28\u614e\u4f7f\u7528\u3002</p> <p>\u91cd\u8981</p> <p>\u60a8\u5fc5\u987b\u4e3a pod \u914d\u7f6e\u7684\u6240\u6709\u63a2\u6d4b\u521b\u5efa\u6765\u81ea\u96c6\u7fa4\u5b89\u5168\u7ec4(kubelet)\u7684\u5165\u7ad9\u6d41\u91cf\u89c4\u5219\u3002</p> <p>\u91cd\u8981</p> <p>\u5b89\u5168\u7ec4\u4e3a pod \u4f9d\u8d56\u4e8e\u4e00\u4e2a\u79f0\u4e3a ENI \u6c47\u805a\u7684\u529f\u80fd\uff0c\u8be5\u529f\u80fd\u65e8\u5728\u63d0\u9ad8 EC2 \u5b9e\u4f8b\u7684 ENI \u5bc6\u5ea6\u3002\u5f53 pod \u88ab\u5206\u914d\u7ed9\u4e00\u4e2a SG \u65f6\uff0cVPC \u63a7\u5236\u5668\u4f1a\u5c06\u8282\u70b9\u7ec4\u4e2d\u7684\u4e00\u4e2a\u5206\u652f ENI \u4e0e\u8be5 pod \u5173\u8054\u3002\u5982\u679c\u5728\u8c03\u5ea6 pod \u65f6\u8282\u70b9\u7ec4\u4e2d\u6ca1\u6709\u8db3\u591f\u7684\u5206\u652f ENI\uff0c\u5219 pod \u5c06\u4fdd\u6301\u6302\u8d77\u72b6\u6001\u3002\u5b9e\u4f8b\u53ef\u4ee5\u652f\u6301\u7684\u5206\u652f ENI \u6570\u91cf\u56e0\u5b9e\u4f8b\u7c7b\u578b/\u7cfb\u5217\u800c\u6709\u6240\u4e0d\u540c\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://docs.aws.amazon.com/eks/latest/userguide/security-groups-for-pods.html#supported-instance-types\u3002</p> <p>\u867d\u7136\u5b89\u5168\u7ec4\u4e3a pod \u63d0\u4f9b\u4e86\u4e00\u79cd AWS \u539f\u751f\u7684\u65b9\u5f0f\u6765\u63a7\u5236\u96c6\u7fa4\u5185\u5916\u7684\u7f51\u7edc\u6d41\u91cf\uff0c\u800c\u65e0\u9700\u7b56\u7565\u5b88\u62a4\u7a0b\u5e8f\u7684\u5f00\u9500\uff0c\u4f46\u4e5f\u6709\u5176\u4ed6\u9009\u62e9\u3002\u4f8b\u5982\uff0cCilium \u7b56\u7565\u5f15\u64ce\u5141\u8bb8\u60a8\u5728\u7f51\u7edc\u7b56\u7565\u4e2d\u5f15\u7528 DNS \u540d\u79f0\u3002Calico Enterprise \u5305\u62ec\u4e00\u4e2a\u5c06\u7f51\u7edc\u7b56\u7565\u6620\u5c04\u5230 AWS \u5b89\u5168\u7ec4\u7684\u9009\u9879\u3002\u5982\u679c\u60a8\u5df2\u7ecf\u5b9e\u73b0\u4e86\u670d\u52a1\u7f51\u683c(\u5982 Istio)\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u51fa\u53e3\u7f51\u5173\u6765\u9650\u5236\u7f51\u7edc\u51fa\u53e3\u5230\u7279\u5b9a\u7684\u5b8c\u5168\u9650\u5b9a\u57df\u6216 IP \u5730\u5740\u3002\u6709\u5173\u6b64\u9009\u9879\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u9605\u8bfb\u5173\u4e8e Istio \u4e2d\u51fa\u53e3\u6d41\u91cf\u63a7\u5236\u7684\u4e09\u90e8\u5206\u7cfb\u5217\u3002</p>"},{"location":"zh/security/docs/network/#pod_1","title":"\u4f55\u65f6\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u4e0e\u5b89\u5168\u7ec4\u4e3a pod\uff1f","text":""},{"location":"zh/security/docs/network/#kubernetes","title":"\u4f55\u65f6\u4f7f\u7528 Kubernetes \u7f51\u7edc\u7b56\u7565","text":"<ul> <li>\u63a7\u5236 pod \u5230 pod \u7684\u6d41\u91cf</li> <li>\u9002\u5408\u63a7\u5236\u96c6\u7fa4\u5185 pod \u4e4b\u95f4\u7684\u7f51\u7edc\u6d41\u91cf(\u4e1c\u897f\u5411\u6d41\u91cf)</li> <li>\u5728 IP \u5730\u5740\u6216\u7aef\u53e3\u7ea7\u522b(OSI \u7b2c 3 \u5c42\u6216\u7b2c 4 \u5c42)\u63a7\u5236\u6d41\u91cf</li> </ul>"},{"location":"zh/security/docs/network/#aws-pod-sgp","title":"\u4f55\u65f6\u4f7f\u7528 AWS \u5b89\u5168\u7ec4\u4e3a pod (SGP)","text":"<ul> <li>\u5229\u7528\u73b0\u6709\u7684 AWS \u914d\u7f6e</li> <li>\u5982\u679c\u60a8\u5df2\u7ecf\u6709\u4e00\u7ec4\u590d\u6742\u7684 EC2 \u5b89\u5168\u7ec4\u6765\u7ba1\u7406\u5bf9 AWS \u670d\u52a1\u7684\u8bbf\u95ee\uff0c\u5e76\u4e14\u60a8\u6b63\u5728\u5c06\u5e94\u7528\u7a0b\u5e8f\u4ece EC2 \u5b9e\u4f8b\u8fc1\u79fb\u5230 EKS\uff0cSGP \u53ef\u4ee5\u6210\u4e3a\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u9009\u62e9\uff0c\u5141\u8bb8\u60a8\u91cd\u7528\u5b89\u5168\u7ec4\u8d44\u6e90\u5e76\u5c06\u5176\u5e94\u7528\u4e8e\u60a8\u7684 pod\u3002</li> <li>\u63a7\u5236\u5bf9 AWS \u670d\u52a1\u7684\u8bbf\u95ee</li> <li>\u5982\u679c\u60a8\u5728 EKS \u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u4e0e\u5176\u4ed6 AWS \u670d\u52a1(\u5982 RDS \u6570\u636e\u5e93)\u901a\u4fe1\uff0c\u8bf7\u4f7f\u7528 SGP \u4f5c\u4e3a\u63a7\u5236\u4ece pod \u5230 AWS \u670d\u52a1\u7684\u6d41\u91cf\u7684\u6709\u6548\u673a\u5236\u3002</li> <li>\u9694\u79bb Pod \u548c\u8282\u70b9\u6d41\u91cf</li> <li>\u5982\u679c\u60a8\u60f3\u5b8c\u5168\u5206\u79bb pod \u6d41\u91cf\u548c\u5176\u4f59\u8282\u70b9\u6d41\u91cf\uff0c\u8bf7\u5728 <code>POD_SECURITY_GROUP_ENFORCING_MODE=strict</code> \u6a21\u5f0f\u4e0b\u4f7f\u7528 SGP\u3002</li> </ul>"},{"location":"zh/security/docs/network/#pod_2","title":"\u4f7f\u7528 <code>\u5b89\u5168\u7ec4\u4e3a pod</code> \u548c <code>\u7f51\u7edc\u7b56\u7565</code> \u7684\u6700\u4f73\u5b9e\u8df5","text":"<ul> <li>\u5206\u5c42\u5b89\u5168</li> <li>\u7ed3\u5408\u4f7f\u7528 SGP \u548c kubernetes \u7f51\u7edc\u7b56\u7565\uff0c\u91c7\u7528\u5206\u5c42\u5b89\u5168\u65b9\u6cd5</li> <li>\u4f7f\u7528 SGP \u9650\u5236\u5bf9\u96c6\u7fa4\u5916\u90e8 AWS \u670d\u52a1\u7684\u7f51\u7edc\u7ea7\u8bbf\u95ee\uff0c\u800c kubernetes \u7f51\u7edc\u7b56\u7565\u53ef\u4ee5\u9650\u5236\u96c6\u7fa4\u5185 pod \u4e4b\u95f4\u7684\u7f51\u7edc\u6d41\u91cf</li> <li>\u6700\u5c0f\u7279\u6743\u539f\u5219</li> <li>\u53ea\u5141\u8bb8 pod \u6216\u547d\u540d\u7a7a\u95f4\u4e4b\u95f4\u5fc5\u8981\u7684\u6d41\u91cf</li> <li>\u5206\u6bb5\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f</li> <li>\u5c3d\u53ef\u80fd\u901a\u8fc7\u7f51\u7edc\u7b56\u7565\u5bf9\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u5206\u6bb5\uff0c\u4ee5\u51cf\u5c11\u5e94\u7528\u7a0b\u5e8f\u53d7\u635f\u65f6\u7684\u5f71\u54cd\u8303\u56f4</li> <li>\u4fdd\u6301\u7b56\u7565\u7b80\u5355\u660e\u4e86</li> <li>Kubernetes \u7f51\u7edc\u7b56\u7565\u53ef\u4ee5\u975e\u5e38\u7ec6\u81f4\u548c\u590d\u6742\uff0c\u6700\u597d\u4fdd\u6301\u5b83\u4eec\u5c3d\u53ef\u80fd\u7b80\u5355\uff0c\u4ee5\u964d\u4f4e\u9519\u8bef\u914d\u7f6e\u7684\u98ce\u9669\u5e76\u7b80\u5316\u7ba1\u7406\u5f00\u9500</li> <li>\u51cf\u5c11\u653b\u51fb\u9762</li> <li>\u901a\u8fc7\u9650\u5236\u5e94\u7528\u7a0b\u5e8f\u7684\u66b4\u9732\u6765\u6700\u5c0f\u5316\u653b\u51fb\u9762</li> </ul> <p>\u6ce8\u610f</p> <p>\u5b89\u5168\u7ec4\u4e3a pod \u63d0\u4f9b\u4e86\u4e24\u79cd\u6267\u884c\u6a21\u5f0f\uff1a<code>strict</code> \u548c <code>standard</code>\u3002\u5f53\u5728 EKS \u96c6\u7fa4\u4e2d\u540c\u65f6\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u548c\u5b89\u5168\u7ec4\u4e3a pod \u529f\u80fd\u65f6\uff0c\u60a8\u5fc5\u987b\u4f7f\u7528 <code>standard</code> \u6a21\u5f0f\u3002</p> <p>\u5728\u7f51\u7edc\u5b89\u5168\u65b9\u9762\uff0c\u5206\u5c42\u65b9\u6cd5\u901a\u5e38\u662f\u6700\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6848\u3002\u7ed3\u5408\u4f7f\u7528 kubernetes \u7f51\u7edc\u7b56\u7565\u548c SGP \u53ef\u4ee5\u4e3a\u60a8\u5728 EKS \u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u4e00\u4e2a\u5065\u58ee\u7684\u6df1\u5ea6\u9632\u5fa1\u7b56\u7565\u3002</p>"},{"location":"zh/security/docs/network/#kubernetes_1","title":"\u670d\u52a1\u7f51\u683c\u7b56\u7565\u6267\u884c\u6216 Kubernetes \u7f51\u7edc\u7b56\u7565","text":"<p><code>\u670d\u52a1\u7f51\u683c</code>\u662f\u4e00\u4e2a\u4e13\u7528\u7684\u57fa\u7840\u8bbe\u65bd\u5c42\uff0c\u60a8\u53ef\u4ee5\u5c06\u5176\u6dfb\u52a0\u5230\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002\u5b83\u5141\u8bb8\u60a8\u900f\u660e\u5730\u6dfb\u52a0\u8bf8\u5982\u53ef\u89c2\u5bdf\u6027\u3001\u6d41\u91cf\u7ba1\u7406\u548c\u5b89\u5168\u6027\u7b49\u529f\u80fd\uff0c\u800c\u65e0\u9700\u5c06\u5b83\u4eec\u6dfb\u52a0\u5230\u60a8\u81ea\u5df1\u7684\u4ee3\u7801\u4e2d\u3002</p> <p>\u670d\u52a1\u7f51\u683c\u5728 OSI \u6a21\u578b\u7684\u7b2c 7 \u5c42(\u5e94\u7528\u7a0b\u5e8f)\u5f3a\u5236\u6267\u884c\u7b56\u7565\uff0c\u800c kubernetes \u7f51\u7edc\u7b56\u7565\u5728\u7b2c 3 \u5c42(\u7f51\u7edc)\u548c\u7b2c 4 \u5c42(\u4f20\u8f93)\u8fd0\u884c\u3002\u5728\u8fd9\u4e2a\u9886\u57df\u6709\u8bb8\u591a\u4ea7\u54c1\uff0c\u5982 AWS AppMesh\u3001Istio\u3001Linkerd \u7b49\u3002</p>"},{"location":"zh/security/docs/network/#_11","title":"\u4f55\u65f6\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u8fdb\u884c\u7b56\u7565\u6267\u884c","text":"<ul> <li>\u5df2\u7ecf\u6295\u8d44\u4e86\u670d\u52a1\u7f51\u683c</li> <li>\u9700\u8981\u66f4\u9ad8\u7ea7\u7684\u529f\u80fd\uff0c\u5982\u6d41\u91cf\u7ba1\u7406\u3001\u53ef\u89c2\u5bdf\u6027\u548c\u5b89\u5168\u6027</li> <li>\u6d41\u91cf\u63a7\u5236\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u65ad\u8def\u5668\u3001\u901f\u7387\u9650\u5236\u3001\u8d85\u65f6\u7b49</li> <li>\u5bf9\u60a8\u7684\u670d\u52a1\u6027\u80fd\u7684\u8be6\u7ec6\u6d1e\u5bdf(\u5ef6\u8fdf\u3001\u9519\u8bef\u7387\u3001\u6bcf\u79d2\u8bf7\u6c42\u6570\u3001\u8bf7\u6c42\u91cf\u7b49)</li> <li>\u60a8\u60f3\u5b9e\u73b0\u548c\u5229\u7528\u670d\u52a1\u7f51\u683c\u7684\u5b89\u5168\u529f\u80fd\uff0c\u5982 mTLS</li> </ul>"},{"location":"zh/security/docs/network/#kubernetes_2","title":"\u5bf9\u4e8e\u7b80\u5355\u7684\u7528\u4f8b\uff0c\u9009\u62e9 Kubernetes \u7f51\u7edc\u7b56\u7565","text":"<ul> <li>\u9650\u5236\u54ea\u4e9b pod \u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1</li> <li>\u7f51\u7edc\u7b56\u7565\u6240\u9700\u7684\u8d44\u6e90\u8f83\u5c11\uff0c\u56e0\u6b64\u5bf9\u4e8e\u7b80\u5355\u7684\u7528\u4f8b\u6216\u8f83\u5c0f\u7684\u96c6\u7fa4\uff0c\u8fd0\u884c\u548c\u7ba1\u7406\u670d\u52a1\u7f51\u683c\u7684\u5f00\u9500\u53ef\u80fd\u662f\u4e0d\u5408\u7406\u7684</li> </ul> <p>\u63d0\u793a</p> <p>\u7f51\u7edc\u7b56\u7565\u548c\u670d\u52a1\u7f51\u683c\u4e5f\u53ef\u4ee5\u4e00\u8d77\u4f7f\u7528\u3002\u4f7f\u7528\u7f51\u7edc\u7b56\u7565\u63d0\u4f9b\u57fa\u7ebf\u5b89\u5168\u7ea7\u522b\u548c pod \u4e4b\u95f4\u7684\u9694\u79bb\uff0c\u7136\u540e\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u6dfb\u52a0\u6d41\u91cf\u7ba1\u7406\u3001\u53ef\u89c2\u5bdf\u6027\u548c\u5b89\u5168\u6027\u7b49\u5176\u4ed6\u529f\u80fd\u3002</p>"},{"location":"zh/security/docs/network/#_12","title":"\u7b2c\u4e09\u65b9\u7f51\u7edc\u7b56\u7565\u5f15\u64ce","text":"<p>\u5f53\u60a8\u6709\u9ad8\u7ea7\u7b56\u7565\u9700\u6c42\u65f6\uff0c\u5982\u5168\u5c40\u7f51\u7edc\u7b56\u7565\u3001\u652f\u6301\u57fa\u4e8e DNS \u4e3b\u673a\u540d\u7684\u89c4\u5219\u3001\u7b2c 7 \u5c42\u89c4\u5219\u3001\u57fa\u4e8e\u670d\u52a1\u5e10\u6237\u7684\u89c4\u5219\u4ee5\u53ca\u663e\u5f0f\u62d2\u7edd/\u65e5\u5fd7\u64cd\u4f5c\u7b49\uff0c\u8bf7\u8003\u8651\u7b2c\u4e09\u65b9\u7f51\u7edc\u7b56\u7565\u5f15\u64ce\u3002Calico \u662f Tigera \u7684\u4e00\u4e2a\u5f00\u6e90\u7b56\u7565\u5f15\u64ce\uff0c\u53ef\u4ee5\u5f88\u597d\u5730\u4e0e EKS \u914d\u5408\u4f7f\u7528\u3002\u9664\u4e86\u5b9e\u73b0 Kubernetes \u7f51\u7edc\u7b56\u7565\u7684\u5168\u5957\u529f\u80fd\u5916\uff0cCalico \u8fd8\u652f\u6301\u6269\u5c55\u7684\u7f51\u7edc\u7b56\u7565\uff0c\u63d0\u4f9b\u4e86\u66f4\u4e30\u5bcc\u7684\u529f\u80fd\u96c6\uff0c\u5305\u62ec\u5bf9\u7b2c 7 \u5c42\u89c4\u5219(\u5982 HTTP)\u7684\u652f\u6301\uff0c\u5f53\u4e0e Istio \u96c6\u6210\u65f6\u3002Calico \u7b56\u7565\u53ef\u4ee5\u5728\u547d\u540d\u7a7a\u95f4\u3001Pod\u3001\u670d\u52a1\u5e10\u6237\u6216\u5168\u5c40\u8303\u56f4\u5185\u5b9a\u4e49\u3002\u5f53\u7b56\u7565\u8303\u56f4\u4e3a\u670d\u52a1\u5e10\u6237\u65f6\uff0c\u5b83\u4f1a\u5c06\u4e00\u7ec4\u5165\u7ad9/\u51fa\u7ad9\u89c4\u5219\u4e0e\u8be5\u670d\u52a1\u5e10\u6237\u5173\u8054\u3002\u901a\u8fc7\u9002\u5f53\u7684 RBAC \u89c4\u5219\uff0c\u60a8\u53ef\u4ee5\u9632\u6b62\u56e2\u961f\u8986\u76d6\u8fd9\u4e9b\u89c4\u5219\uff0c\u4ece\u800c\u5141\u8bb8 IT \u5b89\u5168\u4e13\u4e1a\u4eba\u5458\u5b89\u5168\u5730\u59d4\u6d3e\u547d\u540d\u7a7a\u95f4\u7ba1\u7406\u3002Isovalent \u662f Cilium \u7684\u7ef4\u62a4\u8005\uff0c\u4ed6\u4eec\u4e5f\u6269\u5c55\u4e86\u7f51\u7edc\u7b56\u7565\uff0c\u5305\u62ec\u5bf9\u7b2c 7 \u5c42\u89c4\u5219(\u5982 HTTP)\u7684\u90e8\u5206\u652f\u6301\u3002Cilium \u8fd8\u652f\u6301 DNS \u4e3b\u673a\u540d\uff0c\u8fd9\u5bf9\u4e8e\u9650\u5236 Kubernetes \u670d\u52a1/Pod \u4e0e VPC \u5185\u5916\u7684\u8d44\u6e90\u4e4b\u95f4\u7684\u6d41\u91cf\u975e\u5e38\u6709\u7528\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0cCalico Enterprise \u5305\u62ec\u4e00\u4e2a\u529f\u80fd\uff0c\u53ef\u4ee5\u5c06 Kubernetes \u7f51\u7edc\u7b56\u7565\u6620\u5c04\u5230 AWS \u5b89\u5168\u7ec4\uff0c\u4ee5\u53ca DNS \u4e3b\u673a\u540d\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728 https://github.com/ahmetb/kubernetes-network-policy-recipes \u627e\u5230\u5e38\u89c1 Kubernetes \u7f51\u7edc\u7b56\u7565\u7684\u5217\u8868\u3002\u7c7b\u4f3c\u7684 Calico \u89c4\u5219\u53ef\u4ee5\u5728 https://docs.projectcalico.org/security/calico-network-policy \u4e2d\u627e\u5230\u3002</p>"},{"location":"zh/security/docs/network/#amazon-vpc-cni","title":"\u8fc1\u79fb\u5230 Amazon VPC CNI \u7f51\u7edc\u7b56\u7565\u5f15\u64ce","text":"<p>\u4e3a\u4e86\u4fdd\u6301\u4e00\u81f4\u6027\u5e76\u907f\u514d pod \u901a\u4fe1\u884c\u4e3a\u51fa\u73b0\u610f\u5916\uff0c\u5efa\u8bae\u5728\u60a8\u7684\u96c6\u7fa4\u4e2d\u53ea\u90e8\u7f72\u4e00\u4e2a\u7f51\u7edc\u7b56\u7565\u5f15\u64ce\u3002\u5982\u679c\u60a8\u60f3\u4ece\u7b2c\u4e09\u65b9\u8fc1\u79fb\u5230 VPC CNI \u7f51\u7edc\u7b56\u7565\u5f15\u64ce\uff0c\u6211\u4eec\u5efa\u8bae\u5728\u542f\u7528 VPC CNI \u7f51\u7edc\u7b56\u7565\u652f\u6301\u4e4b\u524d\uff0c\u5148\u5c06\u73b0\u6709\u7684\u7b2c\u4e09\u65b9\u7f51\u7edc\u7b56\u7565 CRD \u8f6c\u6362\u4e3a Kubernetes \u7f51\u7edc\u7b56\u7565\u8d44\u6e90\u3002\u7136\u540e\uff0c\u5728\u5355\u72ec\u7684\u6d4b\u8bd5\u96c6\u7fa4\u4e2d\u6d4b\u8bd5\u8f6c\u6362\u540e\u7684\u7b56\u7565\u3002\u8fd9\u6837\u53ef\u4ee5\u8ba9\u60a8\u8bc6\u522b\u5e76\u89e3\u51b3\u4efb\u4f55\u6f5c\u5728\u7684\u95ee\u9898\u6216 pod \u901a\u4fe1\u884c\u4e3a\u4e0d\u4e00\u81f4\u3002</p>"},{"location":"zh/security/docs/network/#_13","title":"\u8fc1\u79fb\u5de5\u5177","text":"<p>\u4e3a\u4e86\u534f\u52a9\u60a8\u7684\u8fc1\u79fb\u8fc7\u7a0b\uff0c\u6211\u4eec\u5f00\u53d1\u4e86\u4e00\u4e2a\u540d\u4e3a K8s \u7f51\u7edc\u7b56\u7565\u8fc1\u79fb\u5668\u7684\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5c06\u60a8\u73b0\u6709\u7684 Calico/Cilium \u7f51\u7edc\u7b56\u7565 CRD \u8f6c\u6362\u4e3a Kubernetes \u539f\u751f\u7f51\u7edc\u7b56\u7565\u3002\u8f6c\u6362\u540e\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u5728\u8fd0\u884c VPC CNI \u7f51\u7edc\u7b56\u7565\u63a7\u5236\u5668\u7684\u65b0\u96c6\u7fa4\u4e0a\u6d4b\u8bd5\u8f6c\u6362\u540e\u7684\u7f51\u7edc\u7b56\u7565\u3002\u8be5\u5de5\u5177\u65e8\u5728\u5e2e\u52a9\u60a8\u7b80\u5316\u8fc1\u79fb\u8fc7\u7a0b\uff0c\u5e76\u786e\u4fdd\u987a\u5229\u8fc7\u6e21\u3002</p> <p>\u91cd\u8981</p> <p>\u8fc1\u79fb\u5de5\u5177\u53ea\u4f1a\u8f6c\u6362\u4e0e\u539f\u751f kubernetes \u7f51\u7edc\u7b56\u7565 API \u517c\u5bb9\u7684\u7b2c\u4e09\u65b9\u7b56\u7565\u3002\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528\u7b2c\u4e09\u65b9\u63d2\u4ef6\u63d0\u4f9b\u7684\u9ad8\u7ea7\u7f51\u7edc\u7b56\u7565\u529f\u80fd\uff0c\u8fc1\u79fb\u5de5\u5177\u5c06\u8df3\u8fc7\u5e76\u62a5\u544a\u8fd9\u4e9b\u529f\u80fd\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u76ee\u524d AWS VPC CNI \u7f51\u7edc\u7b56\u7565\u5de5\u7a0b\u56e2\u961f\u4e0d\u652f\u6301\u8fc1\u79fb\u5de5\u5177\uff0c\u5b83\u662f\u4ee5\u6700\u5927\u52aa\u529b\u7684\u65b9\u5f0f\u63d0\u4f9b\u7ed9\u5ba2\u6237\u7684\u3002\u6211\u4eec\u9f13\u52b1\u60a8\u5229\u7528\u8fd9\u4e2a\u5de5\u5177\u6765\u4fc3\u8fdb\u60a8\u7684\u8fc1\u79fb\u8fc7\u7a0b\u3002\u5982\u679c\u60a8\u5728\u4f7f\u7528\u8be5\u5de5\u5177\u65f6\u9047\u5230\u4efb\u4f55\u95ee\u9898\u6216\u9519\u8bef\uff0c\u6211\u4eec\u6073\u8bf7\u60a8\u5728 GitHub issue \u4e2d\u63d0\u51fa\u3002\u60a8\u7684\u53cd\u9988\u5bf9\u6211\u4eec\u6765\u8bf4\u662f\u5b9d\u8d35\u7684\uff0c\u5c06\u6709\u52a9\u4e8e\u6211\u4eec\u4e0d\u65ad\u6539\u8fdb\u6211\u4eec\u7684\u670d\u52a1\u3002</p>"},{"location":"zh/security/docs/network/#_14","title":"\u5176\u4ed6\u8d44\u6e90","text":"<ul> <li>Kubernetes &amp; Tigera: \u7f51\u7edc\u7b56\u7565\u3001\u5b89\u5168\u6027\u548c\u5ba1\u8ba1</li> <li>Calico Enterprise</li> <li>Cilium</li> <li>NetworkPolicy \u7f16\u8f91\u5668 \u6765\u81ea Cilium \u7684\u4ea4\u4e92\u5f0f\u7b56\u7565\u7f16\u8f91\u5668</li> <li>Inspektor Gadget advise network-policy gadget \u6839\u636e\u7f51\u7edc\u6d41\u91cf\u5206\u6790\u5efa\u8bae\u7f51\u7edc\u7b56\u7565</li> </ul>"},{"location":"zh/security/docs/network/#_15","title":"\u4f20\u8f93\u4e2d\u7684\u52a0\u5bc6","text":"<p>\u9700\u8981\u7b26\u5408 PCI\u3001HIPAA \u6216\u5176\u4ed6\u6cd5\u89c4\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u9700\u8981\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u52a0\u5bc6\u6570\u636e\u3002\u5982\u4eca\uff0cTLS \u662f\u52a0\u5bc6\u7ebf\u8def\u4e0a\u6570\u636e\u7684\u4e8b\u5b9e\u6807\u51c6\u3002TLS \u4e0e\u5176\u524d\u8eab SSL \u4e00\u6837\uff0c\u4f7f\u7528\u52a0\u5bc6\u534f\u8bae\u5728\u7f51\u7edc\u4e0a\u63d0\u4f9b\u5b89\u5168\u901a\u4fe1\u3002TLS \u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\uff0c\u5176\u4e2d\u52a0\u5bc6\u6570\u636e\u7684\u5bc6\u94a5\u662f\u57fa\u4e8e\u4f1a\u8bdd\u5f00\u59cb\u65f6\u534f\u5546\u7684\u5171\u4eab\u5bc6\u94a5\u751f\u6210\u7684\u3002\u4ee5\u4e0b\u662f\u5728 Kubernetes \u73af\u5883\u4e2d\u52a0\u5bc6\u6570\u636e\u7684\u4e00\u4e9b\u65b9\u5f0f\u3002</p>"},{"location":"zh/security/docs/network/#nitro","title":"Nitro \u5b9e\u4f8b","text":"<p>\u5728\u4ee5\u4e0b Nitro \u5b9e\u4f8b\u7c7b\u578b(\u5982 C5n\u3001G4\u3001I3en\u3001M5dn\u3001M5n\u3001P3dn\u3001R5dn \u548c R5n)\u4e4b\u95f4\u4ea4\u6362\u7684\u6d41\u91cf\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u52a0\u5bc6\u3002\u5f53\u5b58\u5728\u4e2d\u95f4\u8df3\u8f6c(\u5982\u4f20\u8f93\u7f51\u5173\u6216\u8d1f\u8f7d\u5747\u8861\u5668)\u65f6\uff0c\u6d41\u91cf\u4e0d\u4f1a\u88ab\u52a0\u5bc6\u3002\u6709\u5173\u4f20\u8f93\u4e2d\u7684\u52a0\u5bc6\u4ee5\u53ca\u652f\u6301\u9ed8\u8ba4\u7f51\u7edc\u52a0\u5bc6\u7684\u5b8c\u6574\u5b9e\u4f8b\u7c7b\u578b\u5217\u8868\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4f20\u8f93\u4e2d\u7684\u52a0\u5bc6\u3002</p>"},{"location":"zh/security/docs/network/#cni","title":"\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3 (CNI)","text":"<p>WeaveNet \u53ef\u4ee5\u914d\u7f6e\u4e3a\u4f7f\u7528 NaCl \u52a0\u5bc6\u81ea\u52a8\u52a0\u5bc6\u6240\u6709\u8896\u5957\u6d41\u91cf\uff0c\u5e76\u4f7f\u7528 IPsec ESP \u52a0\u5bc6\u5feb\u901f\u6570\u636e\u8def\u5f84\u6d41\u91cf\u3002</p>"},{"location":"zh/security/docs/network/#_16","title":"\u670d\u52a1\u7f51\u683c","text":"<p>\u4f20\u8f93\u4e2d\u7684\u52a0\u5bc6\u4e5f\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u7f51\u683c(\u5982 App Mesh\u3001Linkerd v2 \u548c Istio)\u6765\u5b9e\u73b0\u3002AppMesh \u652f\u6301\u4f7f\u7528 X.509 \u8bc1\u4e66\u6216 Envoy \u7684 Secret Discovery Service(SDS) \u8fdb\u884c mTLS\u3002Linkerd \u548c Istio \u90fd\u652f\u6301 mTLS\u3002</p> <p>aws-app-mesh-examples GitHub \u5b58\u50a8\u5e93\u63d0\u4f9b\u4e86\u4f7f\u7528 X.509 \u8bc1\u4e66\u548c SPIRE \u4f5c\u4e3a SDS \u63d0\u4f9b\u7a0b\u5e8f\u914d\u7f6e Envoy \u5bb9\u5668\u7684 mTLS \u7684\u6f14\u7ec3\uff1a</p> <ul> <li>\u4f7f\u7528 X.509 \u8bc1\u4e66\u914d\u7f6e mTLS</li> <li>\u4f7f\u7528 SPIRE (SDS) \u914d\u7f6e TLS</li> </ul> <p>App Mesh \u8fd8\u652f\u6301\u4f7f\u7528 AWS Certificate Manager (ACM) \u9881\u53d1\u7684\u79c1\u6709\u8bc1\u4e66\u6216\u5b58\u50a8\u5728\u865a\u62df\u8282\u70b9\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u8bc1\u4e66\u8fdb\u884c TLS \u52a0\u5bc6\u3002</p> <p>aws-app-mesh-examples GitHub \u5b58\u50a8\u5e93\u63d0\u4f9b\u4e86\u4f7f\u7528 ACM \u9881\u53d1\u7684\u8bc1\u4e66\u548c\u4e0e\u60a8\u7684 Envoy \u5bb9\u5668\u4e00\u8d77\u6253\u5305\u7684\u8bc1\u4e66\u914d\u7f6e TLS \u7684\u6f14\u7ec3\uff1a</p> <ul> <li>\u4f7f\u7528\u6587\u4ef6\u63d0\u4f9b\u7684 TLS \u8bc1\u4e66\u914d\u7f6e TLS</li> <li>\u4f7f\u7528 AWS Certificate Manager \u914d\u7f6e TLS</li> </ul>"},{"location":"zh/security/docs/network/#ingress","title":"Ingress \u63a7\u5236\u5668\u548c\u8d1f\u8f7d\u5747\u8861\u5668","text":"<p>Ingress \u63a7\u5236\u5668\u662f\u4e00\u79cd\u667a\u80fd\u8def\u7531\u6765\u81ea\u96c6\u7fa4\u5916\u90e8\u7684 HTTP/S \u6d41\u91cf\u5230\u96c6\u7fa4\u5185\u90e8\u8fd0\u884c\u7684\u670d\u52a1\u7684\u65b9\u5f0f\u3002\u901a\u5e38\uff0c\u8fd9\u4e9b Ingress \u524d\u9762\u662f\u4e00\u4e2a\u7b2c 4 \u5c42\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5982\u7ecf\u5178\u8d1f\u8f7d\u5747\u8861\u5668\u6216\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668 (NLB)\u3002\u52a0\u5bc6\u6d41\u91cf\u53ef\u4ee5\u5728\u7f51\u7edc\u4e2d\u7684\u4e0d\u540c\u4f4d\u7f6e\u7ec8\u6b62\uff0c\u4f8b\u5982\u5728\u8d1f\u8f7d\u5747\u8861\u5668\u3001Ingress \u8d44\u6e90\u6216 Pod \u4e0a\u3002\u60a8\u7ec8\u6b62 SSL \u8fde\u63a5\u7684\u65b9\u5f0f\u548c\u4f4d\u7f6e\u5c06\u6700\u7ec8\u7531\u60a8\u7ec4\u7ec7\u7684\u7f51\u7edc\u5b89\u5168\u7b56\u7565\u51b3\u5b9a\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u8981\u6c42\u7aef\u5230\u7aef\u52a0\u5bc6\u7684\u7b56\u7565\uff0c\u60a8\u5c06\u4e0d\u5f97\u4e0d\u5728 Pod \u4e0a\u89e3\u5bc6\u6d41\u91cf\u3002\u8fd9\u5c06\u7ed9\u60a8\u7684 Pod \u5e26\u6765\u989d\u5916\u7684\u8d1f\u62c5\uff0c\u56e0\u4e3a\u5b83\u5fc5\u987b\u82b1\u8d39\u5468\u671f\u5efa\u7acb\u521d\u59cb\u63e1\u624b\u3002\u603b\u7684\u6765\u8bf4\uff0cSSL/TLS \u5904\u7406\u662f\u975e\u5e38\u8017\u8d39 CPU \u7684\u3002\u56e0\u6b64\uff0c\u5982\u679c\u60a8\u6709\u7075\u6d3b\u6027\uff0c\u8bf7\u5c1d\u8bd5\u5728 Ingress \u6216\u8d1f\u8f7d\u5747\u8861\u5668\u4e0a\u6267\u884c SSL \u5378\u8f7d\u3002</p>"},{"location":"zh/security/docs/network/#aws-elastic","title":"\u4f7f\u7528 AWS Elastic \u8d1f\u8f7d\u5747\u8861\u5668\u8fdb\u884c\u52a0\u5bc6","text":"<p>AWS \u5e94\u7528\u7a0b\u5e8f\u8d1f\u8f7d\u5747\u8861\u5668 (ALB) \u548c \u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u5668 (NLB) \u90fd\u652f\u6301\u4f20\u8f93\u52a0\u5bc6 (SSL \u548c TLS)\u3002ALB \u7684 <code>alb.ingress.kubernetes.io/certificate-arn</code> \u6ce8\u89e3\u5141\u8bb8\u60a8\u6307\u5b9a\u8981\u6dfb\u52a0\u5230 ALB \u7684\u8bc1\u4e66\u3002\u5982\u679c\u7701\u7565\u4e86\u6ce8\u89e3\uff0c\u63a7\u5236\u5668\u5c06\u5c1d\u8bd5\u901a\u8fc7\u4f7f\u7528\u4e3b\u673a\u5b57\u6bb5\u5339\u914d\u53ef\u7528\u7684 AWS Certificate Manager (ACM) \u8bc1\u4e66\u6765\u5411\u9700\u8981\u5b83\u7684\u76d1\u542c\u5668\u6dfb\u52a0\u8bc1\u4e66\u3002\u4ece EKS v1.15 \u5f00\u59cb\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u6240\u793a\u7684 <code>service.beta.kubernetes.io/aws-load-balancer-ssl-cert</code> \u6ce8\u89e3\u4e0e NLB \u4e00\u8d77\u4f7f\u7528\u3002</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: demo-app\n  namespace: default\n  labels:\n    app: demo-app\n  annotations:\n     service.beta.kubernetes.io/aws-load-balancer-type: \"nlb\"\n     service.beta.kubernetes.io/aws-load-balancer-ssl-cert: \"&lt;certificate ARN&gt;\"\n     service.beta.kubernetes.io/aws-load-balancer-ssl-ports: \"443\"\n     service.beta.kubernetes.io/aws-load-balancer-backend-protocol: \"http\"\nspec:\n  type: LoadBalancer\n  ports:\n  - port: 443\n    targetPort: 80\n    protocol: TCP\n  selector:\n    app: demo-app\n---\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  name: nginx\n  namespace: default\n  labels:\n    app: demo-app\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: demo-app\n  template:\n    metadata:\n      labels:\n        app: demo-app\n    spec:\n      containers:\n        - name: nginx\n          image: nginx\n          ports:\n            - containerPort: 443\n              protocol: TCP\n            - containerPort: 80\n              protocol: TCP\n</code></pre> <p>\u4ee5\u4e0b\u662f SSL/TLS \u7ec8\u6b62\u7684\u5176\u4ed6\u793a\u4f8b\u3002</p> <ul> <li>\u4ee5 GitOps \u65b9\u5f0f\u4f7f\u7528 Contour \u548c Let's Encrypt \u4fdd\u62a4 EKS Ingress</li> <li>\u5982\u4f55\u4f7f\u7528 ACM \u7ec8\u6b62 Amazon EKS \u5de5\u4f5c\u8d1f\u8f7d\u4e0a\u7684 HTTPS \u6d41\u91cf\uff1f</li> </ul> <p>\u6ce8\u610f</p> <p>\u4e00\u4e9b Ingress\uff0c\u5982 AWS LB \u63a7\u5236\u5668\uff0c\u4f7f\u7528\u6ce8\u89e3\u800c\u4e0d\u662f\u4f5c\u4e3a Ingress \u89c4\u8303\u7684\u4e00\u90e8\u5206\u6765\u5b9e\u73b0 SSL/TLS\u3002</p>"},{"location":"zh/security/docs/network/#acm-ca-cert-manager","title":"ACM \u79c1\u6709 CA \u4e0e cert-manager","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528 ACM \u79c1\u6709\u8bc1\u4e66\u9881\u53d1\u673a\u6784 (CA) \u548c cert-manager (\u4e00\u4e2a\u6d41\u884c\u7684 Kubernetes \u63d2\u4ef6\uff0c\u7528\u4e8e\u5206\u53d1\u3001\u7eed\u8ba2\u548c\u540a\u9500\u8bc1\u4e66)\u6765\u542f\u7528 TLS \u548c mTLS\uff0c\u4ece\u800c\u4fdd\u62a4\u60a8\u5728 EKS \u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5305\u62ec Ingress\u3001Pod \u548c Pod \u4e4b\u95f4\u7684\u901a\u4fe1\u3002ACM \u79c1\u6709 CA \u662f\u4e00\u4e2a\u9ad8\u5ea6\u53ef\u7528\u3001\u5b89\u5168\u7684\u6258\u7ba1 CA\uff0c\u65e0\u9700\u652f\u4ed8\u7ba1\u7406\u81ea\u5df1\u7684 CA \u7684\u524d\u671f\u548c\u7ef4\u62a4\u6210\u672c\u3002\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528\u9ed8\u8ba4\u7684 Kubernetes \u8bc1\u4e66\u9881\u53d1\u673a\u6784\uff0c\u90a3\u4e48\u6709\u673a\u4f1a\u901a\u8fc7 ACM \u79c1\u6709 CA \u6765\u63d0\u9ad8\u60a8\u7684\u5b89\u5168\u6027\u5e76\u6ee1\u8db3\u5408\u89c4\u6027\u8981\u6c42\u3002ACM \u79c1\u6709 CA \u5728 FIPS 140-2 \u7ea7\u522b 3 \u786c\u4ef6\u5b89\u5168\u6a21\u5757(\u975e\u5e38\u5b89\u5168)\u4e2d\u4fdd\u62a4\u79c1\u94a5\uff0c\u800c\u9ed8\u8ba4 CA \u5c06\u5bc6\u94a5\u7f16\u7801\u5b58\u50a8\u5728\u5185\u5b58(\u4e0d\u592a\u5b89\u5168)\u4e2d\u3002\u96c6\u4e2d\u5f0f CA \u8fd8\u4e3a\u60a8\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u63a7\u5236\u548c\u5ba1\u8ba1\u80fd\u529b\uff0c\u53ef\u4ee5\u7ba1\u7406 Kubernetes \u73af\u5883\u5185\u5916\u7684\u79c1\u6709\u8bc1\u4e66\u3002</p>"},{"location":"zh/security/docs/network/#tls-ca","title":"\u7528\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\u76f8\u4e92 TLS \u7684\u77ed\u671f CA \u6a21\u5f0f","text":"<p>\u5728 EKS \u4e2d\u4f7f\u7528 ACM \u79c1\u6709 CA \u8fdb\u884c mTLS \u65f6\uff0c\u5efa\u8bae\u60a8\u4f7f\u7528\u77ed\u671f\u8bc1\u4e66\u548c_\u77ed\u671f CA \u6a21\u5f0f_\u3002\u867d\u7136\u5728\u901a\u7528 CA \u6a21\u5f0f\u4e0b\u4e5f\u53ef\u4ee5\u9881\u53d1\u77ed\u671f\u8bc1\u4e66\uff0c\u4f46\u5bf9\u4e8e\u9700\u8981\u9891\u7e41\u9881\u53d1\u65b0\u8bc1\u4e66\u7684\u7528\u4f8b\uff0c\u4f7f\u7528\u77ed\u671f CA \u6a21\u5f0f\u7684\u6210\u672c\u6548\u76ca\u66f4\u9ad8(\u6bd4\u901a\u7528\u6a21\u5f0f\u4fbf\u5b9c\u7ea6 75%)\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u5e94\u5c1d\u8bd5\u5c06\u79c1\u6709\u8bc1\u4e66\u7684\u6709\u6548\u671f\u4e0e EKS \u96c6\u7fa4\u4e2d\u7684 pod \u751f\u547d\u5468\u671f\u4fdd\u6301\u4e00\u81f4\u3002\u5728\u6b64\u4e86\u89e3\u6709\u5173 ACM \u79c1\u6709 CA \u53ca\u5176\u4f18\u52bf\u7684\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"zh/security/docs/network/#acm","title":"ACM \u8bbe\u7f6e\u8bf4\u660e","text":"<p>\u9996\u5148\u6309\u7167 ACM \u79c1\u6709 CA \u6280\u672f\u6587\u6863\u4e2d\u63d0\u4f9b\u7684\u6b65\u9aa4\u521b\u5efa\u4e00\u4e2a\u79c1\u6709 CA\u3002\u521b\u5efa\u79c1\u6709 CA \u540e\uff0c\u6309\u7167\u5e38\u89c4\u5b89\u88c5\u8bf4\u660e\u5b89\u88c5 cert-manager\u3002\u5b89\u88c5 cert-manager \u540e\uff0c\u6309\u7167 GitHub \u4e0a\u7684\u8bbe\u7f6e\u8bf4\u660e\u5b89\u88c5\u79c1\u6709 CA Kubernetes cert-manager \u63d2\u4ef6\u3002\u8be5\u63d2\u4ef6\u5141\u8bb8 cert-manager \u4ece ACM \u79c1\u6709 CA \u8bf7\u6c42\u79c1\u6709\u8bc1\u4e66\u3002</p> <p>\u73b0\u5728\u60a8\u5df2\u7ecf\u62e5\u6709\u4e86\u4e00\u4e2a\u79c1\u6709 CA \u548c\u4e00\u4e2a\u5b89\u88c5\u4e86 cert-manager \u548c\u63d2\u4ef6\u7684 EKS \u96c6\u7fa4\uff0c\u662f\u65f6\u5019\u8bbe\u7f6e\u6743\u9650\u5e76\u521b\u5efa issuer \u4e86\u3002\u66f4\u65b0 EKS \u8282\u70b9\u89d2\u8272\u7684 IAM \u6743\u9650\uff0c\u4ee5\u5141\u8bb8\u8bbf\u95ee ACM \u79c1\u6709 CA\u3002\u5c06 <code>&lt;CA_ARN&gt;</code> \u66ff\u6362\u4e3a\u60a8\u7684\u79c1\u6709 CA \u7684\u503c\uff1a</p> <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"awspcaissuer\",\n            \"Action\": [\n                \"acm-pca:DescribeCertificateAuthority\",\n                \"acm-pca:GetCertificate\",\n                \"acm-pca:IssueCertificate\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"&lt;CA_ARN&gt;\"\n        }\n    ]\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 IAM \u89d2\u8272\u670d\u52a1\u5e10\u6237\uff0c\u6216 IRSA\u3002\u8bf7\u53c2\u9605\u4e0b\u9762\u7684\u9644\u52a0\u8d44\u6e90\u90e8\u5206\uff0c\u4e86\u89e3\u5b8c\u6574\u793a\u4f8b\u3002</p> <p>\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a cluster-issuer.yaml \u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\u6587\u4ef6\uff0c\u5728 Amazon EKS \u4e2d\u521b\u5efa\u4e00\u4e2a Issuer\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5c06 <code>&lt;CA_ARN&gt;</code> \u548c <code>&lt;Region&gt;</code> \u4fe1\u606f\u66ff\u6362\u4e3a\u60a8\u7684\u79c1\u6709 CA\u3002</p> <pre><code>apiVersion: awspca.cert-manager.io/v1beta1\nkind: AWSPCAClusterIssuer\nmetadata:\n          name: demo-test-root-ca\nspec:\n          arn: &lt;CA_ARN&gt;\n          region: &lt;Region&gt;\n</code></pre> <p>\u90e8\u7f72\u60a8\u521b\u5efa\u7684 Issuer\u3002</p> <pre><code>kubectl apply -f cluster-issuer.yaml\n</code></pre> <p>\u60a8\u7684 EKS \u96c6\u7fa4\u73b0\u5df2\u914d\u7f6e\u4e3a\u4ece\u79c1\u6709 CA \u8bf7\u6c42\u8bc1\u4e66\u3002\u73b0\u5728\u60a8\u53ef\u4ee5\u4f7f\u7528 cert-manager \u7684 <code>Certificate</code> \u8d44\u6e90\u6765\u9881\u53d1\u8bc1\u4e66\uff0c\u65b9\u6cd5\u662f\u5c06 <code>issuerRef</code> \u5b57\u6bb5\u7684\u503c\u66f4\u6539\u4e3a\u60a8\u4e0a\u9762\u521b\u5efa\u7684\u79c1\u6709 CA Issuer\u3002\u6709\u5173\u5982\u4f55\u6307\u5b9a\u548c\u8bf7\u6c42\u8bc1\u4e66\u8d44\u6e90\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b cert-manager \u7684\u8bc1\u4e66\u8d44\u6e90\u6307\u5357\u3002\u5728\u6b64\u5904\u67e5\u770b\u793a\u4f8b\u3002</p>"},{"location":"zh/security/docs/network/#acm-ca-istio-cert-manager","title":"ACM \u79c1\u6709 CA \u4e0e Istio \u548c cert-manager","text":"<p>\u5982\u679c\u60a8\u5728 EKS \u96c6\u7fa4\u4e2d\u8fd0\u884c Istio\uff0c\u60a8\u53ef\u4ee5\u7981\u7528 Istio \u63a7\u5236\u5e73\u9762(\u7279\u522b\u662f <code>istiod</code>)\u5145\u5f53\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784 (CA) \u7684\u529f\u80fd\uff0c\u5e76\u5c06 ACM \u79c1\u6709 CA \u914d\u7f6e\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4 mTLS \u7684\u6839 CA\u3002\u5982\u679c\u60a8\u91c7\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u8bf7\u8003\u8651\u5728 ACM \u79c1\u6709 CA \u4e2d\u4f7f\u7528_\u77ed\u671f CA \u6a21\u5f0f_\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4e0a\u4e00\u8282\u548c\u8fd9\u7bc7\u535a\u5ba2\u6587\u7ae0\u3002</p>"},{"location":"zh/security/docs/network/#istio","title":"Istio \u4e2d\u8bc1\u4e66\u7b7e\u540d\u7684\u5de5\u4f5c\u65b9\u5f0f(\u9ed8\u8ba4)","text":"<p>Kubernetes \u4e2d\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4f7f\u7528\u670d\u52a1\u5e10\u6237\u8fdb\u884c\u6807\u8bc6\u3002\u5982\u679c\u60a8\u6ca1\u6709\u6307\u5b9a\u670d\u52a1\u5e10\u6237\uff0cKubernetes \u4f1a\u81ea\u52a8\u4e3a\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5206\u914d\u4e00\u4e2a\u3002\u6b64\u5916\uff0c\u670d\u52a1\u5e10\u6237\u4f1a\u81ea\u52a8\u6302\u8f7d\u4e00\u4e2a\u5173\u8054\u7684\u4ee4\u724c\u3002\u8be5\u4ee4\u724c\u7528\u4e8e\u670d\u52a1\u5e10\u6237\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5411 Kubernetes API \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u670d\u52a1\u5e10\u6237\u53ef\u80fd\u8db3\u4ee5\u4f5c\u4e3a Kubernetes \u7684\u8eab\u4efd\uff0c\u4f46 Istio \u6709\u81ea\u5df1\u7684\u8eab\u4efd\u7ba1\u7406\u7cfb\u7edf\u548c CA\u3002\u5f53\u5de5\u4f5c\u8d1f\u8f7d\u53ca\u5176 envoy \u8fb9\u8f66\u4ee3\u7406\u542f\u52a8\u65f6\uff0c\u5b83\u9700\u8981\u4ece Istio \u83b7\u5f97\u4e00\u4e2a\u5206\u914d\u7684\u8eab\u4efd\uff0c\u4ee5\u88ab\u89c6\u4e3a\u53ef\u4fe1\u4efb\u5e76\u88ab\u5141\u8bb8\u4e0e\u7f51\u683c\u4e2d\u7684\u5176\u4ed6\u670d\u52a1\u901a\u4fe1\u3002</p> <p>\u4e3a\u4e86\u4ece Istio \u83b7\u5f97\u8fd9\u4e2a\u8eab\u4efd\uff0c<code>istio-agent</code> \u4f1a\u5411 Istio \u63a7\u5236\u5e73\u9762\u53d1\u9001\u4e00\u4e2a\u79f0\u4e3a\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42(\u6216 CSR)\u7684\u8bf7\u6c42\u3002\u6b64 CSR \u5305\u542b\u670d\u52a1\u5e10\u6237\u4ee4\u724c\uff0c\u4ee5\u4fbf\u5728\u5904\u7406\u4e4b\u524d\u53ef\u4ee5\u9a8c\u8bc1\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8eab\u4efd\u3002\u6b64\u9a8c\u8bc1\u8fc7\u7a0b\u7531 <code>istiod</code> \u5904\u7406\uff0c\u5b83\u5145\u5f53\u6ce8\u518c\u673a\u6784(\u6216 RA)\u548c CA\u3002RA \u5145\u5f53\u5b88\u95e8\u4eba\uff0c\u786e\u4fdd\u53ea\u6709\u7ecf\u8fc7\u9a8c\u8bc1\u7684 CSR \u624d\u80fd\u901a\u8fc7\u5e76\u53d1\u9001\u5230 CA\u3002\u4e00\u65e6 CSR \u88ab\u9a8c\u8bc1\uff0c\u5b83\u5c06\u88ab\u8f6c\u53d1\u5230 CA\uff0cCA \u5c06\u9881\u53d1\u4e00\u4e2a\u5305\u542b SPIFFE \u8eab\u4efd\u548c\u670d\u52a1\u5e10\u6237\u7684\u8bc1\u4e66\u3002\u8be5\u8bc1\u4e66\u79f0\u4e3a SPIFFE \u53ef\u9a8c\u8bc1\u8eab\u4efd\u6587\u6863(\u6216 SVID)\u3002SVID \u88ab\u5206\u914d\u7ed9\u8bf7\u6c42\u670d\u52a1\uff0c\u7528\u4e8e\u8bc6\u522b\u76ee\u7684\u548c\u52a0\u5bc6\u670d\u52a1\u4e4b\u95f4\u4f20\u8f93\u7684\u6d41\u91cf\u3002</p> <p></p>"},{"location":"zh/security/docs/network/#istio-acm-ca","title":"\u5728 Istio \u4e2d\u4f7f\u7528 ACM \u79c1\u6709 CA \u7684\u8bc1\u4e66\u7b7e\u540d\u5de5\u4f5c\u65b9\u5f0f","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u540d\u4e3a Istio \u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\u4ee3\u7406(istio-csr)\u7684 cert-manager \u63d2\u4ef6\u5c06 Istio \u4e0e ACM \u79c1\u6709 CA \u96c6\u6210\u3002\u8be5\u4ee3\u7406\u5141\u8bb8 Istio \u5de5\u4f5c\u8d1f\u8f7d\u548c\u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\u4f7f\u7528 cert manager \u53d1\u884c\u8005(\u5728\u672c\u4f8b\u4e2d\u662f ACM \u79c1\u6709 CA)\u8fdb\u884c\u4fdd\u62a4\u3002istio-csr \u4ee3\u7406\u516c\u5f00\u4e86\u4e0e istiod \u5728\u9ed8\u8ba4\u914d\u7f6e\u4e2d\u63d0\u4f9b\u7684\u76f8\u540c\u7684\u670d\u52a1\uff0c\u7528\u4e8e\u9a8c\u8bc1\u4f20\u5165\u7684 CSR\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u5728\u9a8c\u8bc1\u4e4b\u540e\uff0c\u5b83\u4f1a\u5c06\u8bf7\u6c42\u8f6c\u6362\u4e3a cert manager \u652f\u6301\u7684\u8d44\u6e90(\u5373\u4e0e\u5916\u90e8 CA \u53d1\u884c\u8005\u7684\u96c6\u6210)\u3002</p> <p>\u6bcf\u5f53\u6709\u6765\u81ea\u5de5\u4f5c\u8d1f\u8f7d\u7684 CSR \u65f6\uff0c\u5b83\u5c06\u88ab\u8f6c\u53d1\u5230 istio-csr,\u540e\u8005\u5c06\u4ece ACM \u79c1\u6709 CA \u8bf7\u6c42\u8bc1\u4e66\u3002istio-csr \u4e0e ACM \u79c1\u6709 CA \u4e4b\u95f4\u7684\u901a\u4fe1\u7531 AWS \u79c1\u6709 CA \u53d1\u884c\u8005\u63d2\u4ef6\u542f\u7528\u3002Cert manager \u4f7f\u7528\u6b64\u63d2\u4ef6\u4ece ACM \u79c1\u6709 CA \u8bf7\u6c42 TLS \u8bc1\u4e66\u3002\u53d1\u884c\u8005\u63d2\u4ef6\u5c06\u4e0e ACM \u79c1\u6709 CA \u670d\u52a1\u901a\u4fe1\uff0c\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u8bf7\u6c42\u7b7e\u540d\u8bc1\u4e66\u3002\u4e00\u65e6\u8bc1\u4e66\u88ab\u7b7e\u540d\uff0c\u5b83\u5c06\u88ab\u8fd4\u56de\u7ed9 istio-csr,\u540e\u8005\u5c06\u8bfb\u53d6\u7b7e\u540d\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u5176\u8fd4\u56de\u7ed9\u53d1\u8d77 CSR \u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p> <p></p>"},{"location":"zh/security/docs/network/#istio-ca","title":"Istio \u4e0e\u79c1\u6709 CA \u8bbe\u7f6e\u8bf4\u660e","text":"<ol> <li>\u9996\u5148\u6309\u7167\u672c\u8282\u4e2d\u7684\u76f8\u540c[\u8bbe\u7f6e\u8bf4\u660e]\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9aa4\uff1a</li> <li>\u521b\u5efa\u4e00\u4e2a\u79c1\u6709 CA</li> <li>\u5b89\u88c5 cert-manager</li> <li>\u5b89\u88c5\u53d1\u884c\u8005\u63d2\u4ef6</li> <li>\u8bbe\u7f6e\u6743\u9650\u5e76\u521b\u5efa\u4e00\u4e2a\u53d1\u884c\u8005\u3002\u8be5\u53d1\u884c\u8005\u4ee3\u8868 CA\uff0c\u7528\u4e8e\u7b7e\u7f72 <code>istiod</code> \u548c\u7f51\u683c\u5de5\u4f5c\u8d1f\u8f7d\u8bc1\u4e66\u3002\u5b83\u5c06\u4e0e ACM \u79c1\u6709 CA \u901a\u4fe1\u3002</li> <li>\u521b\u5efa\u4e00\u4e2a <code>istio-system</code> \u547d\u540d\u7a7a\u95f4\u3002\u8fd9\u662f\u5c06\u90e8\u7f72 <code>istiod \u8bc1\u4e66</code>\u548c\u5176\u4ed6 Istio \u8d44\u6e90\u7684\u5730\u65b9\u3002</li> <li> <p>\u5b89\u88c5\u914d\u7f6e\u4e3a\u4f7f\u7528 AWS \u79c1\u6709 CA \u53d1\u884c\u8005\u63d2\u4ef6\u7684 Istio CSR\u3002\u60a8\u53ef\u4ee5\u4fdd\u7559\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\uff0c\u4ee5\u9a8c\u8bc1\u5b83\u4eec\u662f\u5426\u83b7\u5f97\u6279\u51c6\u548c\u7b7e\u540d(<code>preserveCertificateRequests=true</code>)\u3002</p> <pre><code>helm install -n cert-manager cert-manager-istio-csr jetstack/cert-manager-istio-csr \\\n--set \"app.certmanager.issuer.group=awspca.cert-manager.io\" \\\n--set \"app.certmanager.issuer.kind=AWSPCAClusterIssuer\" \\\n--set \"app.certmanager.issuer.name=&lt;the-name-of-the-issuer-you-created&gt;\" \\\n--set \"app.certmanager.preserveCertificateRequests=true\" \\\n--set \"app.server.maxCertificateDuration=48h\" \\\n--set \"app.tls.certificateDuration=24h\" \\\n--set \"app.tls.istiodCertificateDuration=24h\" \\\n--set \"app.tls.rootCAFile=/var/run/secrets/istio-csr/ca.pem\" \\\n--set \"volumeMounts[0].name=root-ca\" \\\n--set \"volumeMounts[0].mountPath=/var/run/secrets/istio-csr\" \\\n--set \"volumes[0].name=root-ca\" \\\n--set \"volumes[0].secret.secretName=istio-root-ca\"\n</code></pre> </li> <li> <p>\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e\u5b89\u88c5 Istio\uff0c\u4ee5\u5c06 <code>istiod</code> \u66ff\u6362\u4e3a <code>cert-manager istio-csr</code> \u4f5c\u4e3a\u7f51\u683c\u7684\u8bc1\u4e66\u63d0\u4f9b\u7a0b\u5e8f\u3002\u6b64\u8fc7\u7a0b\u53ef\u4ee5\u4f7f\u7528 Istio Operator \u8fdb\u884c\u3002</p> <pre><code>apiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nmetadata:\n  name: istio\n  namespace: istio-system\nspec:\n  profile: \"demo\"\n  hub: gcr.io/istio-release\n  values:\n  global:\n    # Change certificate provider to cert-manager istio agent for istio agent\n    caAddress: cert-manager-istio-csr.cert-manager.svc:443\n  components:\n    pilot:\n      k8s:\n        env:\n          # Disable istiod CA Sever functionality\n        - name: ENABLE_CA_SERVER\n          value: \"false\"\n        overlays:\n        - apiVersion: apps/v1\n          kind: Deployment\n          name: istiod\n          patches:\n\n            # Mount istiod serving and webhook certificate from Secret mount\n          - path: spec.template.spec.containers.[name:discovery].args[7]\n            value: \"--tlsCertFile=/etc/cert-manager/tls/tls.crt\"\n          - path: spec.template.spec.containers.[name:discovery].args[8]\n            value: \"--tlsKeyFile=/etc/cert-manager/tls/tls.key\"\n          - path: spec.template.spec.containers.[name:discovery].args[9]\n            value: \"--caCertFile=/etc/cert-manager/ca/root-cert.pem\"\n\n          - path: spec.template.spec.containers.[name:discovery].volumeMounts[6]\n            value:\n              name: cert-manager\n              mountPath: \"/etc/cert-manager/tls\"\n              readOnly: true\n          - path: spec.template.spec.containers.[name:discovery].volumeMounts[7]\n            value:\n              name: ca-root-cert\n              mountPath: \"/etc/cert-manager/ca\"\n              readOnly: true\n\n          - path: spec.template.spec.volumes[6]\n            value:\n              name: cert-manager\n              secret:\n                secretName: istiod-tls\n          - path: spec.template.spec.volumes[7]\n            value:\n              name: ca-root-cert\n              configMap:\n                defaultMode: 420\n                name: istio-ca-root-cert\n</code></pre> </li> <li> <p>\u90e8\u7f72\u60a8\u521b\u5efa\u7684\u4e0a\u8ff0\u81ea\u5b9a\u4e49\u8d44\u6e90\u3002</p> <pre><code>istioctl operator init\nkubectl apply -f istio-custom-config.yaml\n</code></pre> </li> <li> <p>\u73b0\u5728\u60a8\u53ef\u4ee5\u5728 EKS \u96c6\u7fa4\u4e2d\u7684\u7f51\u683c\u4e2d\u90e8\u7f72\u4e00\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u5e76\u5f3a\u5236\u6267\u884c mTLS\u3002</p> </li> </ol> <p></p>"},{"location":"zh/security/docs/network/#_17","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a - \u7f51\u7edc\u5b89\u5168</li> <li>\u5982\u4f55\u5728 EKS \u4e2d\u5b9e\u73b0 cert-manager \u548c ACM \u79c1\u6709 CA \u63d2\u4ef6\u4ee5\u542f\u7528 TLS\u3002</li> <li>\u4f7f\u7528\u65b0\u7684 AWS \u8d1f\u8f7d\u5747\u8861\u5668\u63a7\u5236\u5668\u548c ACM \u79c1\u6709 CA \u5728 Amazon EKS \u4e0a\u8bbe\u7f6e\u7aef\u5230\u7aef TLS \u52a0\u5bc6\u3002</li> <li>\u79c1\u6709 CA Kubernetes cert-manager \u63d2\u4ef6\u5728 GitHub \u4e0a\u3002</li> <li>\u79c1\u6709 CA Kubernetes cert-manager \u63d2\u4ef6\u7528\u6237\u6307\u5357\u3002</li> <li>\u5982\u4f55\u4f7f\u7528 AWS \u79c1\u6709\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u77ed\u671f\u8bc1\u4e66\u6a21\u5f0f</li> <li>\u5728 Kubernetes \u4e2d\u9a8c\u8bc1\u670d\u52a1\u7f51\u683c TLS\uff0c\u4f7f\u7528 ksniff \u548c Wireshark</li> <li>ksniff</li> <li>egress-operator \u4e00\u4e2a\u64cd\u4f5c\u5458\u548c DNS \u63d2\u4ef6\uff0c\u7528\u4e8e\u63a7\u5236\u4ece\u96c6\u7fa4\u51fa\u53e3\u7684\u6d41\u91cf\uff0c\u65e0\u9700\u534f\u8bae\u68c0\u67e5</li> <li>NeuVector by SUSE \u5f00\u6e90\u3001\u96f6\u4fe1\u4efb\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\uff0c\u63d0\u4f9b\u7b56\u7565\u7f51\u7edc\u89c4\u5219\u3001\u6570\u636e\u4e22\u5931\u9632\u62a4 (DLP)\u3001Web \u5e94\u7528\u7a0b\u5e8f\u9632\u706b\u5899 (WAF) \u548c\u7f51\u7edc\u5a01\u80c1\u7b7e\u540d\u3002</li> </ul>"},{"location":"zh/security/docs/pods/","title":"Pod \u5b89\u5168\u6027","text":"<p>Pod \u89c4\u8303\u5305\u62ec\u5404\u79cd\u4e0d\u540c\u7684\u5c5e\u6027\uff0c\u53ef\u4ee5\u52a0\u5f3a\u6216\u524a\u5f31\u60a8\u7684\u6574\u4f53\u5b89\u5168\u6001\u52bf\u3002\u4f5c\u4e3a Kubernetes \u4ece\u4e1a\u4eba\u5458\uff0c\u60a8\u7684\u4e3b\u8981\u5173\u6ce8\u70b9\u5e94\u8be5\u662f\u9632\u6b62\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u9003\u79bb\u5bb9\u5668\u9694\u79bb\u8fb9\u754c\u5e76\u83b7\u5f97\u5bf9\u5e95\u5c42\u4e3b\u673a\u7684\u8bbf\u95ee\u6743\u9650\u3002</p>"},{"location":"zh/security/docs/pods/#linux","title":"Linux \u529f\u80fd","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u5728 [Linux] \u6839\u7528\u6237\u7684\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u3002\u5c3d\u7ba1\u6839\u5728\u5bb9\u5668\u5185\u7684\u64cd\u4f5c\u90e8\u5206\u53d7\u5230\u5bb9\u5668\u8fd0\u884c\u65f6\u5206\u914d\u7ed9\u5bb9\u5668\u7684 Linux \u529f\u80fd\u96c6\u7684\u7ea6\u675f\uff0c\u4f46\u8fd9\u4e9b\u9ed8\u8ba4\u6743\u9650\u53ef\u80fd\u5141\u8bb8\u653b\u51fb\u8005\u5347\u7ea7\u4ed6\u4eec\u7684\u6743\u9650\u548c/\u6216\u8bbf\u95ee\u7ed1\u5b9a\u5230\u4e3b\u673a\u7684\u654f\u611f\u4fe1\u606f\uff0c\u5305\u62ec Secret \u548c ConfigMap\u3002\u4e0b\u9762\u662f\u5206\u914d\u7ed9\u5bb9\u5668\u7684\u9ed8\u8ba4\u529f\u80fd\u5217\u8868\u3002\u6709\u5173\u6bcf\u4e2a\u529f\u80fd\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 http://man7.org/linux/man-pages/man7/capabilities.7.html\u3002</p> <p><code>CAP_AUDIT_WRITE, CAP_CHOWN, CAP_DAC_OVERRIDE, CAP_FOWNER, CAP_FSETID, CAP_KILL, CAP_MKNOD, CAP_NET_BIND_SERVICE, CAP_NET_RAW, CAP_SETGID, CAP_SETUID, CAP_SETFCAP, CAP_SETPCAP, CAP_SYS_CHROOT</code></p> <p>\u4fe1\u606f</p> <p>EC2 \u548c Fargate pod \u9ed8\u8ba4\u5206\u914d\u4e86\u4e0a\u8ff0\u529f\u80fd\u3002\u6b64\u5916\uff0c\u53ea\u80fd\u4ece Fargate pod \u4e2d\u5220\u9664 Linux \u529f\u80fd\u3002</p> <p>\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\u7684 Pod \u7ee7\u627f\u4e86\u4e3b\u673a\u4e0a\u4e0e root \u76f8\u5173\u7684\u6240\u6709 Linux \u529f\u80fd\u3002\u5982\u679c\u53ef\u80fd\u7684\u8bdd\uff0c\u5e94\u8be5\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u3002</p>"},{"location":"zh/security/docs/pods/#_1","title":"\u8282\u70b9\u6388\u6743","text":"<p>\u6240\u6709 Kubernetes \u5de5\u4f5c\u8282\u70b9\u90fd\u4f7f\u7528\u4e00\u79cd\u79f0\u4e3a \u8282\u70b9\u6388\u6743 \u7684\u6388\u6743\u6a21\u5f0f\u3002\u8282\u70b9\u6388\u6743\u5141\u8bb8\u6765\u81ea kubelet \u7684\u6240\u6709 API \u8bf7\u6c42\uff0c\u5e76\u5141\u8bb8\u8282\u70b9\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <p>\u8bfb\u53d6\u64cd\u4f5c\uff1a</p> <ul> <li>\u670d\u52a1</li> <li>\u7aef\u70b9</li> <li>\u8282\u70b9</li> <li>pod</li> <li>\u4e0e\u7ed1\u5b9a\u5230 kubelet \u8282\u70b9\u7684 pod \u76f8\u5173\u7684 secret\u3001configmap\u3001\u6301\u4e45\u5377\u58f0\u660e\u548c\u6301\u4e45\u5377</li> </ul> <p>\u5199\u5165\u64cd\u4f5c\uff1a</p> <ul> <li>\u8282\u70b9\u548c\u8282\u70b9\u72b6\u6001(\u542f\u7528 <code>NodeRestriction</code> \u51c6\u5165\u63d2\u4ef6\u4ee5\u9650\u5236 kubelet \u4ec5\u4fee\u6539\u81ea\u5df1\u7684\u8282\u70b9)</li> <li>pod \u548c pod \u72b6\u6001(\u542f\u7528 <code>NodeRestriction</code> \u51c6\u5165\u63d2\u4ef6\u4ee5\u9650\u5236 kubelet \u4ec5\u4fee\u6539\u7ed1\u5b9a\u5230\u81ea\u8eab\u7684 pod)</li> <li>\u4e8b\u4ef6</li> </ul> <p>\u4e0e\u8eab\u4efd\u9a8c\u8bc1\u76f8\u5173\u7684\u64cd\u4f5c\uff1a</p> <ul> <li>\u8bfb/\u5199\u8bbf\u95ee CertificateSigningRequest (CSR) API \u4ee5\u8fdb\u884c TLS \u5f15\u5bfc</li> <li>\u521b\u5efa TokenReview \u548c SubjectAccessReview \u7684\u80fd\u529b\uff0c\u7528\u4e8e\u59d4\u6258\u8eab\u4efd\u9a8c\u8bc1/\u6388\u6743\u68c0\u67e5</li> </ul> <p>EKS \u4f7f\u7528 \u8282\u70b9\u9650\u5236\u51c6\u5165\u63a7\u5236\u5668,\u5b83\u53ea\u5141\u8bb8\u8282\u70b9\u4fee\u6539\u6709\u9650\u7684\u8282\u70b9\u5c5e\u6027\u548c\u7ed1\u5b9a\u5230\u8be5\u8282\u70b9\u7684 pod \u5bf9\u8c61\u3002\u7136\u800c\uff0c\u5982\u679c\u653b\u51fb\u8005\u8bbe\u6cd5\u8bbf\u95ee\u4e3b\u673a\uff0c\u4ed6\u4eec\u4ecd\u7136\u53ef\u4ee5\u4ece Kubernetes API \u83b7\u53d6\u6709\u5173\u73af\u5883\u7684\u654f\u611f\u4fe1\u606f\uff0c\u4ece\u800c\u5141\u8bb8\u4ed6\u4eec\u5728\u96c6\u7fa4\u5185\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\u3002</p>"},{"location":"zh/security/docs/pods/#pod_1","title":"Pod \u5b89\u5168\u89e3\u51b3\u65b9\u6848","text":""},{"location":"zh/security/docs/pods/#pod-psp","title":"Pod \u5b89\u5168\u7b56\u7565 (PSP)","text":"<p>\u8fc7\u53bb\uff0c\u4f7f\u7528 Pod \u5b89\u5168\u7b56\u7565 (PSP) \u8d44\u6e90\u6765\u6307\u5b9a pod \u5728\u521b\u5efa\u4e4b\u524d\u5fc5\u987b\u6ee1\u8db3\u7684\u4e00\u7ec4\u8981\u6c42\u3002\u4ece Kubernetes \u7248\u672c 1.21 \u5f00\u59cb\uff0cPSP \u5df2\u88ab\u5f03\u7528\u3002\u5b83\u4eec\u8ba1\u5212\u5728 Kubernetes \u7248\u672c 1.25 \u4e2d\u88ab\u5220\u9664\u3002</p> <p>\u6ce8\u610f</p> <p>PSP \u5728 Kubernetes \u7248\u672c 1.21 \u4e2d\u5df2\u88ab\u5f03\u7528\u3002\u60a8\u5c06\u6709\u5927\u7ea6 2 \u5e74\u7684\u65f6\u95f4\u6765\u8fc7\u6e21\u5230\u66ff\u4ee3\u65b9\u6848\uff0c\u76f4\u5230\u7248\u672c 1.25\u3002\u8fd9\u4e2a\u6587\u6863\u89e3\u91ca\u4e86\u5f03\u7528 PSP \u7684\u52a8\u673a\u3002</p>"},{"location":"zh/security/docs/pods/#pod_2","title":"\u8fc1\u79fb\u5230\u65b0\u7684 pod \u5b89\u5168\u89e3\u51b3\u65b9\u6848","text":"<p>\u7531\u4e8e PSP \u5728 Kubernetes v1.25 \u4e2d\u5df2\u88ab\u5220\u9664\uff0c\u96c6\u7fa4\u7ba1\u7406\u5458\u548c\u64cd\u4f5c\u5458\u5fc5\u987b\u7528\u5176\u4ed6\u5b89\u5168\u63a7\u5236\u6765\u66ff\u6362\u3002\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u6ee1\u8db3\u8fd9\u79cd\u9700\u6c42\uff1a</p> <ul> <li>Kubernetes \u751f\u6001\u7cfb\u7edf\u4e2d\u7684\u7b56\u7565\u5373\u4ee3\u7801 (PAC) \u89e3\u51b3\u65b9\u6848</li> <li>Kubernetes Pod \u5b89\u5168\u6807\u51c6 (PSS)</li> </ul> <p>PAC \u548c PSS \u89e3\u51b3\u65b9\u6848\u90fd\u53ef\u4ee5\u4e0e PSP \u5171\u5b58;\u5728 PSP \u88ab\u5220\u9664\u4e4b\u524d\uff0c\u5b83\u4eec\u53ef\u4ee5\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528\u3002\u8fd9\u6709\u52a9\u4e8e\u5728\u4ece PSP \u8fc1\u79fb\u65f6\u91c7\u7528\u3002\u5728\u8003\u8651\u4ece PSP \u8fc1\u79fb\u5230 PSS \u65f6\uff0c\u8bf7\u53c2\u9605\u6b64\u6587\u6863\u3002</p> <p>Kyverno \u662f\u4e0b\u9762\u6982\u8ff0\u7684 PAC \u89e3\u51b3\u65b9\u6848\u4e4b\u4e00\uff0c\u5728\u535a\u5ba2\u6587\u7ae0\u4e2d\u6982\u8ff0\u4e86\u4ece PSP \u8fc1\u79fb\u5230\u5176\u89e3\u51b3\u65b9\u6848\u7684\u5177\u4f53\u6307\u5bfc\uff0c\u5305\u62ec\u7c7b\u4f3c\u7684\u7b56\u7565\u3001\u529f\u80fd\u6bd4\u8f83\u548c\u8fc1\u79fb\u7a0b\u5e8f\u3002\u5173\u4e8e\u4f7f\u7528 Kyverno \u8fc1\u79fb\u5230 Pod \u5b89\u5168\u51c6\u5165 (PSA) \u7684\u66f4\u591a\u4fe1\u606f\u548c\u6307\u5bfc\u5df2\u5728 AWS \u535a\u5ba2 \u6b64\u5904 \u53d1\u5e03\u3002</p>"},{"location":"zh/security/docs/pods/#pac","title":"\u7b56\u7565\u5373\u4ee3\u7801 (PAC)","text":"<p>\u7b56\u7565\u5373\u4ee3\u7801 (PAC) \u89e3\u51b3\u65b9\u6848\u63d0\u4f9b\u4e86\u4fdd\u62a4\u63aa\u65bd\uff0c\u901a\u8fc7\u89c4\u5b9a\u548c\u81ea\u52a8\u5316\u63a7\u5236\u6765\u6307\u5bfc\u96c6\u7fa4\u7528\u6237\uff0c\u5e76\u9632\u6b62\u4e0d\u5e0c\u671b\u7684\u884c\u4e3a\u3002PAC \u4f7f\u7528 Kubernetes \u52a8\u6001\u51c6\u5165\u63a7\u5236\u5668\u901a\u8fc7 webhook \u8c03\u7528\u62e6\u622a Kubernetes API \u670d\u52a1\u5668\u8bf7\u6c42\u6d41\uff0c\u5e76\u6839\u636e\u4ee5\u4ee3\u7801\u5f62\u5f0f\u7f16\u5199\u548c\u5b58\u50a8\u7684\u7b56\u7565\u5bf9\u8bf7\u6c42\u8d1f\u8f7d\u8fdb\u884c\u53d8\u66f4\u548c\u9a8c\u8bc1\u3002\u53d8\u66f4\u548c\u9a8c\u8bc1\u53d1\u751f\u5728 API \u670d\u52a1\u5668\u8bf7\u6c42\u5bfc\u81f4\u96c6\u7fa4\u53d1\u751f\u66f4\u6539\u4e4b\u524d\u3002PAC \u89e3\u51b3\u65b9\u6848\u4f7f\u7528\u7b56\u7565\u6765\u5339\u914d\u548c\u5904\u7406 API \u670d\u52a1\u5668\u8bf7\u6c42\u8d1f\u8f7d\uff0c\u57fa\u4e8e\u5206\u7c7b\u548c\u503c\u3002</p> <p>Kubernetes \u751f\u6001\u7cfb\u7edf\u4e2d\u6709\u51e0\u79cd\u5f00\u6e90 PAC \u89e3\u51b3\u65b9\u6848\u53ef\u7528\u3002\u8fd9\u4e9b\u89e3\u51b3\u65b9\u6848\u4e0d\u662f Kubernetes \u9879\u76ee\u7684\u4e00\u90e8\u5206;\u5b83\u4eec\u6765\u81ea Kubernetes \u751f\u6001\u7cfb\u7edf\u3002\u4e0b\u9762\u5217\u51fa\u4e86\u4e00\u4e9b PAC \u89e3\u51b3\u65b9\u6848\u3002</p> <ul> <li>OPA/Gatekeeper</li> <li>Open Policy Agent (OPA)</li> <li>Kyverno</li> <li>Kubewarden</li> <li>jsPolicy</li> </ul> <p>\u6709\u5173 PAC \u89e3\u51b3\u65b9\u6848\u7684\u66f4\u591a\u4fe1\u606f\u4ee5\u53ca\u5982\u4f55\u5e2e\u52a9\u60a8\u9009\u62e9\u9002\u5408\u60a8\u9700\u6c42\u7684\u5408\u9002\u89e3\u51b3\u65b9\u6848\uff0c\u8bf7\u53c2\u9605\u4e0b\u9762\u7684\u94fe\u63a5\u3002</p> <ul> <li>Kubernetes \u7684\u57fa\u4e8e\u7b56\u7565\u7684\u5bf9\u7b56 \u2013 \u7b2c 1 \u90e8\u5206</li> <li>Kubernetes \u7684\u57fa\u4e8e\u7b56\u7565\u7684\u5bf9\u7b56 \u2013 \u7b2c 2 \u90e8\u5206</li> </ul>"},{"location":"zh/security/docs/pods/#pod-pss-pod-psa","title":"Pod \u5b89\u5168\u6807\u51c6 (PSS) \u548c Pod \u5b89\u5168\u51c6\u5165 (PSA)","text":"<p>\u4e3a\u4e86\u5e94\u5bf9 PSP \u5f03\u7528\u548c\u5bf9\u5f00\u7bb1\u5373\u7528\u7684 Kubernetes \u5185\u7f6e\u89e3\u51b3\u65b9\u6848\u63a7\u5236 pod \u5b89\u5168\u6027\u7684\u6301\u7eed\u9700\u6c42\uff0cKubernetes Auth \u7279\u522b\u5174\u8da3\u5c0f\u7ec4\u521b\u5efa\u4e86 Pod \u5b89\u5168\u6807\u51c6 (PSS) \u548c Pod \u5b89\u5168\u51c6\u5165 (PSA)\u3002PSA \u5de5\u4f5c\u5305\u62ec\u4e00\u4e2a \u51c6\u5165\u63a7\u5236\u5668 webhook \u9879\u76ee,\u5b83\u5b9e\u73b0\u4e86 PSS \u4e2d\u5b9a\u4e49\u7684\u63a7\u5236\u3002\u8fd9\u79cd\u51c6\u5165\u63a7\u5236\u5668\u65b9\u6cd5\u7c7b\u4f3c\u4e8e PAC \u89e3\u51b3\u65b9\u6848\u4e2d\u4f7f\u7528\u7684\u65b9\u6cd5\u3002</p> <p>\u6839\u636e Kubernetes \u6587\u6863\uff0cPSS \"\u5b9a\u4e49\u4e86\u4e09\u79cd\u4e0d\u540c\u7684\u7b56\u7565\uff0c\u5e7f\u6cdb\u6db5\u76d6\u4e86\u5b89\u5168\u8303\u56f4\u3002\u8fd9\u4e9b\u7b56\u7565\u662f\u7d2f\u79ef\u7684\uff0c\u8303\u56f4\u4ece\u9ad8\u5ea6\u5bbd\u677e\u5230\u9ad8\u5ea6\u9650\u5236\u3002\"</p> <p>\u8fd9\u4e9b\u7b56\u7565\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u7279\u6743\uff1a \u4e0d\u53d7\u9650\u5236(\u4e0d\u5b89\u5168)\u7684\u7b56\u7565\uff0c\u63d0\u4f9b\u6700\u5e7f\u6cdb\u7684\u6743\u9650\u7ea7\u522b\u3002\u6b64\u7b56\u7565\u5141\u8bb8\u5df2\u77e5\u7684\u6743\u9650\u5347\u7ea7\u3002\u8fd9\u662f\u6ca1\u6709\u7b56\u7565\u7684\u60c5\u51b5\u3002\u8fd9\u5bf9\u4e8e\u9700\u8981\u7279\u6743\u8bbf\u95ee\u7684\u5e94\u7528\u7a0b\u5e8f(\u5982\u65e5\u5fd7\u4ee3\u7406\u3001CNI\u3001\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f\u548c\u5176\u4ed6\u7cfb\u7edf\u8303\u56f4\u7684\u5e94\u7528\u7a0b\u5e8f)\u5f88\u6709\u7528\u3002</p> </li> <li> <p>\u57fa\u7ebf\uff1a \u6700\u5c0f\u9650\u5236\u6027\u7b56\u7565\uff0c\u53ef\u9632\u6b62\u5df2\u77e5\u7684\u6743\u9650\u5347\u7ea7\u3002\u5141\u8bb8\u9ed8\u8ba4(\u6700\u5c0f\u6307\u5b9a)\u7684 Pod \u914d\u7f6e\u3002\u57fa\u7ebf\u7b56\u7565\u7981\u6b62\u4f7f\u7528 hostNetwork\u3001hostPID\u3001hostIPC\u3001hostPath\u3001hostPort,\u65e0\u6cd5\u6dfb\u52a0 Linux \u529f\u80fd\uff0c\u4ee5\u53ca\u5176\u4ed6\u51e0\u4e2a\u9650\u5236\u3002</p> </li> <li> <p>\u53d7\u9650\uff1a \u9ad8\u5ea6\u9650\u5236\u7684\u7b56\u7565\uff0c\u9075\u5faa\u5f53\u524d\u7684 Pod \u5f3a\u5316\u6700\u4f73\u5b9e\u8df5\u3002\u8be5\u7b56\u7565\u7ee7\u627f\u81ea\u57fa\u7ebf\u5e76\u6dfb\u52a0\u4e86\u8fdb\u4e00\u6b65\u7684\u9650\u5236\uff0c\u4f8b\u5982\u65e0\u6cd5\u4ee5 root \u6216 root \u7ec4\u8eab\u4efd\u8fd0\u884c\u3002\u53d7\u9650\u7b56\u7565\u53ef\u80fd\u4f1a\u5f71\u54cd\u5e94\u7528\u7a0b\u5e8f\u7684\u529f\u80fd\u3002\u5b83\u4eec\u4e3b\u8981\u9488\u5bf9\u8fd0\u884c\u5b89\u5168\u5173\u952e\u5e94\u7528\u7a0b\u5e8f\u3002</p> </li> </ul> <p>\u8fd9\u4e9b\u7b56\u7565\u5b9a\u4e49\u4e86 pod \u6267\u884c\u914d\u7f6e\u6587\u4ef6,\u5206\u4e3a\u4e09\u4e2a\u7279\u6743\u4e0e\u53d7\u9650\u8bbf\u95ee\u7ea7\u522b\u3002</p> <p>\u4e3a\u4e86\u5b9e\u73b0 PSS \u5b9a\u4e49\u7684\u63a7\u5236\uff0cPSA \u4ee5\u4e09\u79cd\u6a21\u5f0f\u8fd0\u884c\uff1a</p> <ul> <li> <p>enforce: \u8fdd\u53cd\u7b56\u7565\u5c06\u5bfc\u81f4 pod \u88ab\u62d2\u7edd\u3002</p> </li> <li> <p>audit: \u8fdd\u53cd\u7b56\u7565\u5c06\u89e6\u53d1\u5728\u5ba1\u8ba1\u65e5\u5fd7\u4e2d\u6dfb\u52a0\u5ba1\u8ba1\u6ce8\u91ca\u5230\u8bb0\u5f55\u7684\u4e8b\u4ef6\uff0c\u4f46\u5176\u4ed6\u60c5\u51b5\u4e0b\u5141\u8bb8\u3002</p> </li> <li> <p>warn: \u8fdd\u53cd\u7b56\u7565\u5c06\u89e6\u53d1\u9762\u5411\u7528\u6237\u7684\u8b66\u544a\uff0c\u4f46\u5176\u4ed6\u60c5\u51b5\u4e0b\u5141\u8bb8\u3002</p> </li> </ul> <p>\u8fd9\u4e9b\u6a21\u5f0f\u548c\u914d\u7f6e\u6587\u4ef6(\u9650\u5236)\u7ea7\u522b\u4f7f\u7528\u6807\u7b7e\u5728 Kubernetes \u547d\u540d\u7a7a\u95f4\u7ea7\u522b\u8fdb\u884c\u914d\u7f6e\uff0c\u5982\u4e0b\u4f8b\u6240\u793a\u3002</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/enforce: restricted\n</code></pre> <p>\u5f53\u5355\u72ec\u4f7f\u7528\u65f6\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u6a21\u5f0f\u4f1a\u4ea7\u751f\u4e0d\u540c\u7684\u54cd\u5e94\uff0c\u4ece\u800c\u5bfc\u81f4\u4e0d\u540c\u7684\u7528\u6237\u4f53\u9a8c\u3002enforce \u6a21\u5f0f\u5c06\u963b\u6b62\u521b\u5efa\u8fdd\u53cd\u914d\u7f6e\u9650\u5236\u7ea7\u522b\u7684 pod\u3002\u4f46\u662f\uff0c\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u521b\u5efa pod \u7684\u975e pod Kubernetes \u5bf9\u8c61(\u5982 Deployment)\u5c06\u4e0d\u4f1a\u88ab\u963b\u6b62\u5e94\u7528\u5230\u96c6\u7fa4\uff0c\u5373\u4f7f\u5176\u4e2d\u7684 podSpec \u8fdd\u53cd\u4e86\u5e94\u7528\u7684 PSS\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cDeployment \u5c06\u88ab\u5e94\u7528\uff0c\u800c pod \u5c06\u88ab\u963b\u6b62\u5e94\u7528\u3002</p> <p>\u8fd9\u662f\u4e00\u79cd\u56f0\u96be\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u56e0\u4e3a\u6ca1\u6709\u7acb\u5373\u7684\u8ff9\u8c61\u8868\u660e\u6210\u529f\u5e94\u7528\u7684 Deployment \u5bf9\u8c61\u63a9\u76d6\u4e86 pod \u521b\u5efa\u5931\u8d25\u3002\u8fdd\u89c4\u7684 podSpec \u5c06\u4e0d\u4f1a\u521b\u5efa pod\u3002\u4f7f\u7528 <code>kubectl get deploy &lt;DEPLOYMENT_NAME&gt; -oyaml</code> \u68c0\u67e5 Deployment \u8d44\u6e90\u5c06\u66b4\u9732\u5931\u8d25 pod \u7684 <code>.status.conditions</code> \u5143\u7d20\u4e2d\u7684\u6d88\u606f\uff0c\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>...\nstatus:\n  conditions:\n    - lastTransitionTime: \"2022-01-20T01:02:08Z\"\n      lastUpdateTime: \"2022-01-20T01:02:08Z\"\n      message: 'pods \"test-688f68dc87-tw587\" is forbidden: violates PodSecurity \"restricted:latest\":\n        allowPrivilegeEscalation != false (container \"test\" must set securityContext.allowPrivilegeEscalation=false),\n        unrestricted capabilities (container \"test\" must set securityContext.capabilities.drop=[\"ALL\"]),\n        runAsNonRoot != true (pod or container \"test\" must set securityContext.runAsNonRoot=true),\n        seccompProfile (pod or container \"test\" must set securityContext.seccompProfile.type\n        to \"RuntimeDefault\" or \"Localhost\")'\n      reason: FailedCreate\n      status: \"True\"\n      type: ReplicaFailure\n...\n</code></pre> <p>\u5728 audit \u548c warn \u6a21\u5f0f\u4e0b\uff0cpod \u9650\u5236\u4e0d\u4f1a\u963b\u6b62\u8fdd\u89c4 pod \u88ab\u521b\u5efa\u548c\u542f\u52a8\u3002\u4f46\u662f\uff0c\u5728\u8fd9\u4e9b\u6a21\u5f0f\u4e0b\uff0c\u5f53 pod \u4ee5\u53ca\u521b\u5efa pod \u7684\u5bf9\u8c61\u5305\u542b\u8fdd\u89c4 podSpec \u65f6\uff0c\u4f1a\u5206\u522b\u89e6\u53d1 API \u670d\u52a1\u5668\u5ba1\u8ba1\u65e5\u5fd7\u4e8b\u4ef6\u7684\u5ba1\u8ba1\u6ce8\u91ca\u548c\u5411 API \u670d\u52a1\u5668\u5ba2\u6237\u7aef(\u5982 kubectl)\u53d1\u51fa\u8b66\u544a\u3002\u4e0b\u9762\u662f <code>kubectl</code> Warning \u6d88\u606f\u3002</p> <pre><code>Warning: would violate PodSecurity \"restricted:latest\": allowPrivilegeEscalation != false (container \"test\" must set securityContext.allowPrivilegeEscalation=false), unrestricted capabilities (container \"test\" must set securityContext.capabilities.drop=[\"ALL\"]), runAsNonRoot != true (pod or container \"test\" must set securityContext.runAsNonRoot=true), seccompProfile (pod or container \"test\" must set securityContext.seccompProfile.type to \"RuntimeDefault\" or \"Localhost\")\ndeployment.apps/test created\n</code></pre> <p>PSA audit \u548c warn \u6a21\u5f0f\u5728\u5f15\u5165 PSS \u65f6\u4e0d\u4f1a\u5bf9\u96c6\u7fa4\u64cd\u4f5c\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\uff0c\u56e0\u6b64\u5f88\u6709\u7528\u3002</p> <p>PSA \u64cd\u4f5c\u6a21\u5f0f\u4e0d\u662f\u4e92\u65a5\u7684\uff0c\u53ef\u4ee5\u4ee5\u7d2f\u79ef\u7684\u65b9\u5f0f\u4f7f\u7528\u3002\u5982\u4e0b\u6240\u793a\uff0c\u591a\u4e2a\u6a21\u5f0f\u53ef\u4ee5\u5728\u5355\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u914d\u7f6e\u3002</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/audit: restricted\n    pod-security.kubernetes.io/enforce: restricted\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5728\u5e94\u7528 Deployment \u65f6\u63d0\u4f9b\u4e86\u53cb\u597d\u7684\u8b66\u544a\u548c\u5ba1\u8ba1\u6ce8\u91ca\uff0c\u540c\u65f6\u8fd8\u63d0\u4f9b\u4e86\u8fdd\u89c4\u7684\u5f3a\u5236\u6267\u884c\u3002\u4e8b\u5b9e\u4e0a\uff0c\u591a\u4e2a PSA \u6807\u7b7e\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u7ea7\u522b\uff0c\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/enforce: baseline\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0cPSA \u88ab\u914d\u7f6e\u4e3a\u5141\u8bb8\u521b\u5efa\u6ee1\u8db3 baseline \u914d\u7f6e\u6587\u4ef6\u7ea7\u522b\u7684\u6240\u6709 pod\uff0c\u7136\u540e\u5bf9\u8fdd\u53cd restricted \u914d\u7f6e\u6587\u4ef6\u7ea7\u522b\u7684 pod(\u548c\u521b\u5efa pod \u7684\u5bf9\u8c61)\u53d1\u51fa\u8b66\u544a\u3002\u8fd9\u662f\u4e00\u79cd\u6709\u7528\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u786e\u5b9a\u4ece baseline \u5230 restricted \u914d\u7f6e\u6587\u4ef6\u65f6\u53ef\u80fd\u4ea7\u751f\u7684\u5f71\u54cd\u3002</p>"},{"location":"zh/security/docs/pods/#pod_3","title":"\u73b0\u6709 Pod","text":"<p>\u5982\u679c\u4f7f\u7528\u66f4\u4e25\u683c\u7684 PSS \u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u4e86\u5305\u542b\u73b0\u6709 pod \u7684\u547d\u540d\u7a7a\u95f4\uff0caudit \u548c warn \u6a21\u5f0f\u5c06\u4ea7\u751f\u9002\u5f53\u7684\u6d88\u606f;\u4f46\u662f\uff0cenforce \u6a21\u5f0f\u4e0d\u4f1a\u5220\u9664 pod\u3002\u4e0b\u9762\u662f\u8b66\u544a\u6d88\u606f\u3002</p> <pre><code>Warning: existing pods in namespace \"policy-test\" violate the new PodSecurity enforce level \"restricted:latest\"\nWarning: test-688f68dc87-htm8x: allowPrivilegeEscalation != false, unrestricted capabilities, runAsNonRoot != true, seccompProfile\nnamespace/policy-test configured\n</code></pre>"},{"location":"zh/security/docs/pods/#_2","title":"\u8c41\u514d","text":"<p>PSA \u4f7f\u7528 Exemptions \u6765\u6392\u9664\u5bf9\u672c\u5e94\u5e94\u7528\u7684 pod \u7684\u8fdd\u89c4\u6267\u884c\u3002\u8fd9\u4e9b\u8c41\u514d\u5982\u4e0b\u6240\u5217\u3002</p> <ul> <li> <p>\u7528\u6237\u540d\uff1a \u6765\u81ea\u5177\u6709\u8c41\u514d\u7684\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1(\u6216\u6a21\u62df)\u7528\u6237\u540d\u7684\u8bf7\u6c42\u5c06\u88ab\u5ffd\u7565\u3002</p> </li> <li> <p>RuntimeClassName: \u6307\u5b9a\u4e86\u8c41\u514d\u7684\u8fd0\u884c\u65f6\u7c7b\u540d\u7684 pod \u548c\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u5c06\u88ab\u5ffd\u7565\u3002</p> </li> <li> <p>\u547d\u540d\u7a7a\u95f4\uff1a \u4f4d\u4e8e\u8c41\u514d\u547d\u540d\u7a7a\u95f4\u4e2d\u7684 pod \u548c\u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u5c06\u88ab\u5ffd\u7565\u3002</p> </li> </ul> <p>\u8fd9\u4e9b\u8c41\u514d\u4f5c\u4e3a API \u670d\u52a1\u5668\u914d\u7f6e\u7684\u4e00\u90e8\u5206\u9759\u6001\u5e94\u7528\u4e8e PSA \u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u3002</p> <p>\u5728 Validating Webhook \u5b9e\u73b0\u4e2d\uff0c\u8c41\u514d\u53ef\u4ee5\u5728 Kubernetes ConfigMap \u8d44\u6e90\u4e2d\u914d\u7f6e\uff0c\u8be5\u8d44\u6e90\u4f5c\u4e3a\u5377\u88ab\u6302\u8f7d\u5230 pod-security-webhook \u5bb9\u5668\u4e2d\u3002</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: pod-security-webhook\n  namespace: pod-security-webhook\ndata:\n  podsecurityconfiguration.yaml: |\n    apiVersion: pod-security.admission.config.k8s.io/v1\n    kind: PodSecurityConfiguration\n    defaults:\n      enforce: \"restricted\"\n      enforce-version: \"latest\"\n      audit: \"restricted\"\n      audit-version: \"latest\"\n      warn: \"restricted\"\n      warn-version: \"latest\"\n    exemptions:\n      # Array of authenticated usernames to exempt.\n      usernames: []\n      # Array of runtime class names to exempt.\n      runtimeClasses: []\n      # Array of namespaces to exempt.\n      namespaces: [\"kube-system\",\"policy-test1\"]\n</code></pre> <p>\u5982\u4e0a\u9762\u7684 ConfigMap YAML \u6240\u793a\uff0c\u5df2\u5c06\u96c6\u7fa4\u8303\u56f4\u7684\u9ed8\u8ba4 PSS \u7ea7\u522b\u8bbe\u7f6e\u4e3a\u6240\u6709 PSA \u6a21\u5f0f(audit\u3001enforce \u548c warn)\u7684 restricted\u3002\u8fd9\u5f71\u54cd\u6240\u6709\u547d\u540d\u7a7a\u95f4\uff0c\u9664\u4e86\u90a3\u4e9b\u88ab\u8c41\u514d\u7684\u547d\u540d\u7a7a\u95f4\uff1a <code>namespaces: [\"kube-system\",\"policy-test1\"]</code>\u3002\u6b64\u5916\uff0c\u5728\u4e0b\u9762\u7684 ValidatingWebhookConfiguration \u8d44\u6e90\u4e2d\uff0cpod-security-webhook \u547d\u540d\u7a7a\u95f4\u4e5f\u88ab\u8c41\u514d\u4e8e\u914d\u7f6e\u7684 PSS\u3002</p> <pre><code>...\nwebhooks:\n  # Audit annotations will be prefixed with this name\n  - name: \"pod-security-webhook.kubernetes.io\"\n    # Fail-closed admission webhooks can present operational challenges.\n    # You may want to consider using a failure policy of Ignore, but should \n    # consider the security tradeoffs.\n    failurePolicy: Fail\n    namespaceSelector:\n      # Exempt the webhook itself to avoid a circular dependency.\n      matchExpressions:\n        - key: kubernetes.io/metadata.name\n          operator: NotIn\n          values: [\"pod-security-webhook\"]\n...\n</code></pre> <p>\u6ce8\u610f</p> <p>Pod \u5b89\u5168\u51c6\u5165\u5728 Kubernetes v1.25 \u4e2d\u5df2\u7ecf\u6bd5\u4e1a\u4e3a\u7a33\u5b9a\u7248\u672c\u3002\u5982\u679c\u60a8\u60f3\u5728\u9ed8\u8ba4\u542f\u7528\u8be5\u529f\u80fd\u4e4b\u524d\u4f7f\u7528 Pod \u5b89\u5168\u51c6\u5165\u529f\u80fd\uff0c\u60a8\u9700\u8981\u5b89\u88c5\u52a8\u6001\u51c6\u5165\u63a7\u5236\u5668(\u53d8\u66f4 webhook)\u3002\u5b89\u88c5\u548c\u914d\u7f6e webhook \u7684\u8bf4\u660e\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u3002</p>"},{"location":"zh/security/docs/pods/#pod_4","title":"\u5728\u7b56\u7565\u5373\u4ee3\u7801\u548c Pod \u5b89\u5168\u6807\u51c6\u4e4b\u95f4\u505a\u51fa\u9009\u62e9","text":"<p>Pod \u5b89\u5168\u6807\u51c6 (PSS) \u7684\u5f00\u53d1\u662f\u4e3a\u4e86\u53d6\u4ee3 Pod \u5b89\u5168\u7b56\u7565 (PSP)\uff0c\u901a\u8fc7\u63d0\u4f9b\u4e00\u4e2a\u5185\u7f6e\u4e8e Kubernetes \u7684\u89e3\u51b3\u65b9\u6848\uff0c\u800c\u4e0d\u9700\u8981\u4f7f\u7528\u6765\u81ea Kubernetes \u751f\u6001\u7cfb\u7edf\u7684\u89e3\u51b3\u65b9\u6848\u3002\u4e0d\u8fc7\uff0c\u7b56\u7565\u5373\u4ee3\u7801 (PAC) \u89e3\u51b3\u65b9\u6848\u8981\u7075\u6d3b\u5f97\u591a\u3002</p> <p>\u4ee5\u4e0b\u4f18\u7f3a\u70b9\u5217\u8868\u65e8\u5728\u5e2e\u52a9\u60a8\u5c31 pod \u5b89\u5168\u89e3\u51b3\u65b9\u6848\u505a\u51fa\u66f4\u660e\u667a\u7684\u51b3\u5b9a\u3002</p>"},{"location":"zh/security/docs/pods/#pod_5","title":"\u7b56\u7565\u5373\u4ee3\u7801(\u4e0e Pod \u5b89\u5168\u6807\u51c6\u76f8\u6bd4)","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u66f4\u7075\u6d3b\u3001\u66f4\u7ec6\u7c92\u5ea6(\u5982\u679c\u9700\u8981\uff0c\u53ef\u4ee5\u7ec6\u5316\u5230\u8d44\u6e90\u7684\u5c5e\u6027)</li> <li>\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8e pod\uff0c\u53ef\u4ee5\u7528\u4e8e\u4e0d\u540c\u7684\u8d44\u6e90\u548c\u64cd\u4f5c</li> <li>\u4e0d\u4ec5\u4ec5\u5728\u547d\u540d\u7a7a\u95f4\u7ea7\u522b\u5e94\u7528</li> <li>\u6bd4 Pod \u5b89\u5168\u6807\u51c6\u66f4\u6210\u719f</li> <li>\u51b3\u7b56\u53ef\u4ee5\u57fa\u4e8e API \u670d\u52a1\u5668\u8bf7\u6c42\u8d1f\u8f7d\u4e2d\u7684\u4efb\u4f55\u5185\u5bb9\uff0c\u4ee5\u53ca\u73b0\u6709\u96c6\u7fa4\u8d44\u6e90\u548c\u5916\u90e8\u6570\u636e(\u53d6\u51b3\u4e8e\u89e3\u51b3\u65b9\u6848)</li> <li>\u652f\u6301\u5728\u9a8c\u8bc1\u4e4b\u524d\u53d8\u66f4 API \u670d\u52a1\u5668\u8bf7\u6c42(\u53d6\u51b3\u4e8e\u89e3\u51b3\u65b9\u6848)</li> <li>\u53ef\u4ee5\u751f\u6210\u8865\u5145\u7b56\u7565\u548c Kubernetes \u8d44\u6e90(\u53d6\u51b3\u4e8e\u89e3\u51b3\u65b9\u6848 - \u4ece pod \u7b56\u7565\u5f00\u59cb\uff0cKyverno \u53ef\u4ee5 \u81ea\u52a8\u751f\u6210\u66f4\u9ad8\u7ea7\u63a7\u5236\u5668(\u5982 Deployment)\u7684\u7b56\u7565\u3002Kyverno \u8fd8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 Generate Rules \u5728\u521b\u5efa\u65b0\u8d44\u6e90\u6216\u66f4\u65b0\u6e90\u65f6\u751f\u6210\u5176\u4ed6 Kubernetes \u8d44\u6e90\u3002)</li> <li>\u53ef\u4ee5\u5411\u5de6\u79fb\u52a8\uff0c\u8fdb\u5165 CICD \u7ba1\u9053\uff0c\u5728\u8c03\u7528 Kubernetes API \u670d\u52a1\u5668\u4e4b\u524d(\u53d6\u51b3\u4e8e\u89e3\u51b3\u65b9\u6848)</li> <li>\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u4e0e\u5b89\u5168\u65e0\u5173\u7684\u884c\u4e3a\uff0c\u4f8b\u5982\u6700\u4f73\u5b9e\u8df5\u3001\u7ec4\u7ec7\u6807\u51c6\u7b49</li> <li>\u53ef\u4ee5\u5728\u975e Kubernetes \u7528\u4f8b\u4e2d\u4f7f\u7528(\u53d6\u51b3\u4e8e\u89e3\u51b3\u65b9\u6848)</li> <li>\u7531\u4e8e\u7075\u6d3b\u6027\uff0c\u7528\u6237\u4f53\u9a8c\u53ef\u4ee5\u6839\u636e\u7528\u6237\u9700\u6c42\u8fdb\u884c\u8c03\u6574</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4e0d\u662f\u5185\u7f6e\u4e8e Kubernetes \u4e2d</li> <li>\u66f4\u590d\u6742\uff0c\u5b66\u4e60\u3001\u914d\u7f6e\u548c\u652f\u6301\u90fd\u66f4\u52a0\u56f0\u96be</li> <li>\u7f16\u5199\u7b56\u7565\u53ef\u80fd\u9700\u8981\u65b0\u7684\u6280\u80fd/\u8bed\u8a00/\u80fd\u529b</li> </ul>"},{"location":"zh/security/docs/pods/#pod_6","title":"Pod \u5b89\u5168\u51c6\u5165(\u4e0e\u7b56\u7565\u5373\u4ee3\u7801\u76f8\u6bd4)","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u5185\u7f6e\u4e8e Kubernetes \u4e2d</li> <li>\u914d\u7f6e\u66f4\u7b80\u5355</li> <li>\u65e0\u9700\u4f7f\u7528\u65b0\u8bed\u8a00\u6216\u7f16\u5199\u7b56\u7565</li> <li>\u5982\u679c\u96c6\u7fa4\u9ed8\u8ba4\u51c6\u5165\u7ea7\u522b\u914d\u7f6e\u4e3a privileged\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u6807\u7b7e\u5c06\u547d\u540d\u7a7a\u95f4\u9009\u5165 pod \u5b89\u5168\u914d\u7f6e\u6587\u4ef6\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4e0d\u5982\u7b56\u7565\u5373\u4ee3\u7801\u90a3\u4e48\u7075\u6d3b\u6216\u7ec6\u7c92\u5ea6</li> <li>\u53ea\u6709 3 \u4e2a\u9650\u5236\u7ea7\u522b</li> <li>\u4e3b\u8981\u5173\u6ce8 pod</li> </ul>"},{"location":"zh/security/docs/pods/#_3","title":"\u603b\u7ed3","text":"<p>\u5982\u679c\u60a8\u76ee\u524d\u8fd8\u6ca1\u6709\u9664 PSP \u4e4b\u5916\u7684 pod \u5b89\u5168\u89e3\u51b3\u65b9\u6848\uff0c\u5e76\u4e14\u60a8\u6240\u9700\u7684 pod \u5b89\u5168\u6001\u52bf\u7b26\u5408 Pod \u5b89\u5168\u6807\u51c6 (PSS) \u5b9a\u4e49\u7684\u6a21\u578b\uff0c\u90a3\u4e48\u91c7\u7528 PSS \u800c\u4e0d\u662f\u7b56\u7565\u5373\u4ee3\u7801\u89e3\u51b3\u65b9\u6848\u53ef\u80fd\u662f\u4e00\u6761\u66f4\u7b80\u5355\u7684\u8def\u5f84\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u7684 pod \u5b89\u5168\u6001\u52bf\u4e0d\u7b26\u5408 PSS \u6a21\u578b\uff0c\u6216\u8005\u60a8\u9884\u8ba1\u5c06\u6dfb\u52a0\u8d85\u51fa PSS \u5b9a\u4e49\u8303\u56f4\u7684\u5176\u4ed6\u63a7\u5236\uff0c\u90a3\u4e48\u7b56\u7565\u5373\u4ee3\u7801\u89e3\u51b3\u65b9\u6848\u4f3c\u4e4e\u66f4\u5408\u9002\u3002</p>"},{"location":"zh/security/docs/pods/#_4","title":"\u5efa\u8bae","text":""},{"location":"zh/security/docs/pods/#pod-psa","title":"\u4e3a\u83b7\u5f97\u66f4\u597d\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u4f7f\u7528\u591a\u4e2a Pod \u5b89\u5168\u51c6\u5165 (PSA) \u6a21\u5f0f","text":"<p>\u5982\u524d\u6240\u8ff0\uff0cPSA enforce \u6a21\u5f0f\u53ef\u4ee5\u9632\u6b62\u8fdd\u53cd PSS \u7684 pod \u88ab\u5e94\u7528\uff0c\u4f46\u4e0d\u4f1a\u963b\u6b62\u66f4\u9ad8\u7ea7\u522b\u7684\u63a7\u5236\u5668(\u5982 Deployment)\u3002\u4e8b\u5b9e\u4e0a\uff0cDeployment \u5c06\u88ab\u6210\u529f\u5e94\u7528\uff0c\u800c\u6ca1\u6709\u4efb\u4f55\u8ff9\u8c61\u8868\u660e pod \u672a\u80fd\u88ab\u5e94\u7528\u3002\u867d\u7136\u60a8\u53ef\u4ee5\u4f7f\u7528 kubectl \u68c0\u67e5 Deployment \u5bf9\u8c61\uff0c\u5e76\u53d1\u73b0\u6765\u81ea PSA \u7684\u5931\u8d25 pod \u6d88\u606f\uff0c\u4f46\u7528\u6237\u4f53\u9a8c\u53ef\u4ee5\u66f4\u597d\u3002\u4e3a\u4e86\u6539\u5584\u7528\u6237\u4f53\u9a8c\uff0c\u5e94\u8be5\u4f7f\u7528\u591a\u4e2a PSA \u6a21\u5f0f(audit\u3001enforce\u3001warn)\u3002</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: policy-test\n  labels:\n    pod-security.kubernetes.io/audit: restricted\n    pod-security.kubernetes.io/enforce: restricted\n    pod-security.kubernetes.io/warn: restricted\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5b9a\u4e49\u4e86 enforce \u6a21\u5f0f\uff0c\u5f53\u5c1d\u8bd5\u5c06\u5305\u542b PSS \u8fdd\u89c4\u7684 podSpec \u7684 Deployment \u6e05\u5355\u5e94\u7528\u5230 Kubernetes API \u670d\u52a1\u5668\u65f6\uff0cDeployment \u5c06\u88ab\u6210\u529f\u5e94\u7528\uff0c\u4f46 pod \u4e0d\u4f1a\u3002\u800c\u4e14\uff0c\u7531\u4e8e audit \u548c warn \u6a21\u5f0f\u4e5f\u5df2\u542f\u7528\uff0cAPI \u670d\u52a1\u5668\u5ba2\u6237\u7aef\u5c06\u6536\u5230\u8b66\u544a\u6d88\u606f\uff0cAPI \u670d\u52a1\u5668\u5ba1\u8ba1\u65e5\u5fd7\u4e8b\u4ef6\u4e5f\u5c06\u88ab\u6ce8\u91ca\u6d88\u606f\u3002</p>"},{"location":"zh/security/docs/pods/#_5","title":"\u9650\u5236\u53ef\u4ee5\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\u7684\u5bb9\u5668","text":"<p>\u5982\u524d\u6240\u8ff0\uff0c\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\u7684\u5bb9\u5668\u7ee7\u627f\u4e86\u4e3b\u673a\u4e0a\u4e0e root \u76f8\u5173\u7684\u6240\u6709 Linux \u529f\u80fd\u3002\u5f88\u5c11\u6709\u5bb9\u5668\u9700\u8981\u8fd9\u79cd\u7c7b\u578b\u7684\u7279\u6743\u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002\u6709\u591a\u79cd\u65b9\u6cd5\u53ef\u4ee5\u7528\u6765\u9650\u5236\u5bb9\u5668\u7684\u6743\u9650\u548c\u529f\u80fd\u3002</p> <p>\u6ce8\u610f</p> <p>Fargate \u662f\u4e00\u79cd\u542f\u52a8\u7c7b\u578b\uff0c\u53ef\u8ba9\u60a8\u5728 AWS \u7ba1\u7406\u7684\u57fa\u7840\u8bbe\u65bd\u4e0a\u8fd0\u884c\"\u65e0\u670d\u52a1\u5668\"\u5bb9\u5668(pod \u4e2d\u7684\u5bb9\u5668)\u3002\u4f7f\u7528 Fargate\uff0c\u60a8\u65e0\u6cd5\u8fd0\u884c\u7279\u6743\u5bb9\u5668\u6216\u914d\u7f6e pod \u4f7f\u7528 hostNetwork \u6216 hostPort\u3002</p>"},{"location":"zh/security/docs/pods/#root","title":"\u4e0d\u8981\u4ee5 root \u8eab\u4efd\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u8fdb\u7a0b","text":"<p>\u6240\u6709\u5bb9\u5668\u9ed8\u8ba4\u90fd\u4ee5 root \u8eab\u4efd\u8fd0\u884c\u3002\u5982\u679c\u653b\u51fb\u8005\u80fd\u591f\u5229\u7528\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u6f0f\u6d1e\u5e76\u83b7\u5f97\u5bf9\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u7684 shell \u8bbf\u95ee\u6743\u9650\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5e26\u6765\u95ee\u9898\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u7f13\u89e3\u8fd9\u79cd\u98ce\u9669\u3002\u9996\u5148\uff0c\u4ece\u5bb9\u5668\u955c\u50cf\u4e2d\u5220\u9664 shell\u3002\u5176\u6b21\uff0c\u5728 Dockerfile \u4e2d\u6dfb\u52a0 USER \u6307\u4ee4\u6216\u4ee5\u975e root \u7528\u6237\u8eab\u4efd\u5728 pod \u4e2d\u8fd0\u884c\u5bb9\u5668\u3002Kubernetes podSpec \u5305\u62ec\u4e00\u7ec4\u5b57\u6bb5\uff0c\u5728 <code>spec.securityContext</code> \u4e0b\uff0c\u8ba9\u60a8\u53ef\u4ee5\u6307\u5b9a\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u7528\u6237\u548c/\u6216\u7ec4\u3002\u8fd9\u4e9b\u5b57\u6bb5\u5206\u522b\u662f <code>runAsUser</code> \u548c <code>runAsGroup</code>\u3002</p> <p>\u8981\u5728\u96c6\u7fa4\u4e2d\u5f3a\u5236\u4f7f\u7528 Kubernetes podSpec \u4e2d\u7684 <code>spec.securityContext</code> \u53ca\u5176\u5173\u8054\u5143\u7d20\uff0c\u53ef\u4ee5\u6dfb\u52a0\u7b56\u7565\u5373\u4ee3\u7801\u6216 Pod \u5b89\u5168\u6807\u51c6\u3002\u8fd9\u4e9b\u89e3\u51b3\u65b9\u6848\u5141\u8bb8\u60a8\u7f16\u5199\u548c/\u6216\u4f7f\u7528\u7b56\u7565\u6216\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u5c06\u8bf7\u6c42\u8d1f\u8f7d\u6301\u4e45\u5316\u5230 etcd \u4e4b\u524d\uff0c\u53ef\u4ee5\u9a8c\u8bc1\u4f20\u5165\u7684 Kubernetes API \u670d\u52a1\u5668\u8bf7\u6c42\u8d1f\u8f7d\u3002\u6b64\u5916\uff0c\u7b56\u7565\u5373\u4ee3\u7801\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u53d8\u66f4\u4f20\u5165\u7684\u8bf7\u6c42\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u8fd8\u53ef\u4ee5\u751f\u6210\u65b0\u7684\u8bf7\u6c42\u3002</p>"},{"location":"zh/security/docs/pods/#docker-docker","title":"\u6c38\u8fdc\u4e0d\u8981\u5728 Docker \u4e2d\u8fd0\u884c Docker \u6216\u5728\u5bb9\u5668\u4e2d\u6302\u8f7d\u5957\u63a5\u5b57","text":"<p>\u867d\u7136\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u65b9\u4fbf\u5730\u8ba9\u60a8\u5728 Docker \u5bb9\u5668\u4e2d\u6784\u5efa/\u8fd0\u884c\u955c\u50cf\uff0c\u4f46\u60a8\u57fa\u672c\u4e0a\u662f\u5728\u653e\u5f03\u5bf9\u8282\u70b9\u7684\u5b8c\u5168\u63a7\u5236\u6743\uff0c\u8ba9\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u6765\u63a7\u5236\u3002\u5982\u679c\u60a8\u9700\u8981\u5728 Kubernetes \u4e0a\u6784\u5efa\u5bb9\u5668\u955c\u50cf\uff0c\u8bf7\u4f7f\u7528 Kaniko\u3001buildah \u6216\u6784\u5efa\u670d\u52a1(\u5982 CodeBuild)\u3002</p> <p>\u63d0\u793a</p> <p>\u7528\u4e8e CICD \u5904\u7406(\u5982\u6784\u5efa\u5bb9\u5668\u955c\u50cf)\u7684 Kubernetes \u96c6\u7fa4\u5e94\u4e0e\u8fd0\u884c\u66f4\u901a\u7528\u5de5\u4f5c\u8d1f\u8f7d\u7684\u96c6\u7fa4\u9694\u79bb\u3002</p>"},{"location":"zh/security/docs/pods/#hostpath-hostpath","title":"\u9650\u5236 hostPath \u7684\u4f7f\u7528\uff0c\u6216\u8005\u5982\u679c\u5fc5\u987b\u4f7f\u7528 hostPath\uff0c\u5219\u9650\u5236\u53ef\u4ee5\u4f7f\u7528\u7684\u524d\u7f00\u5e76\u5c06\u5377\u914d\u7f6e\u4e3a\u53ea\u8bfb","text":"<p><code>hostPath</code> \u662f\u4e00\u79cd\u5377\uff0c\u76f4\u63a5\u5c06\u4e3b\u673a\u4e0a\u7684\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\u3002\u5f88\u5c11\u6709 pod \u9700\u8981\u8fd9\u79cd\u7c7b\u578b\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u4f46\u5982\u679c\u9700\u8981\uff0c\u60a8\u9700\u8981\u610f\u8bc6\u5230\u98ce\u9669\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4ee5 root \u8eab\u4efd\u8fd0\u884c\u7684 pod \u5c06\u5bf9 hostPath \u66b4\u9732\u7684\u6587\u4ef6\u7cfb\u7edf\u5177\u6709\u5199\u5165\u6743\u9650\u3002\u8fd9\u53ef\u80fd\u5141\u8bb8\u653b\u51fb\u8005\u4fee\u6539 kubelet \u8bbe\u7f6e\u3001\u521b\u5efa\u6307\u5411\u672a\u76f4\u63a5\u66b4\u9732\u7684\u76ee\u5f55\u6216\u6587\u4ef6(\u4f8b\u5982 /etc/shadow)\u7684\u7b26\u53f7\u94fe\u63a5\u3001\u5b89\u88c5 ssh \u5bc6\u94a5\u3001\u8bfb\u53d6\u6302\u8f7d\u5230\u4e3b\u673a\u7684 secret \u4ee5\u53ca\u6267\u884c\u5176\u4ed6\u6076\u610f\u64cd\u4f5c\u3002\u4e3a\u4e86\u51cf\u8f7b hostPath \u5e26\u6765\u7684\u98ce\u9669\uff0c\u8bf7\u5c06 <code>spec.containers.volumeMounts</code> \u914d\u7f6e\u4e3a <code>readOnly</code>,\u4f8b\u5982\uff1a</p> <pre><code>volumeMounts:\n- name: hostPath-volume\n    readOnly: true\n    mountPath: /host-path\n</code></pre> <p>\u60a8\u8fd8\u5e94\u8be5\u4f7f\u7528\u7b56\u7565\u5373\u4ee3\u7801\u89e3\u51b3\u65b9\u6848\u6765\u9650\u5236\u53ef\u4ee5\u4f7f\u7528 <code>hostPath</code> \u5377\u7684\u76ee\u5f55\uff0c\u6216\u8005\u5b8c\u5168\u963b\u6b62\u4f7f\u7528 <code>hostPath</code>\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Pod \u5b89\u5168\u6807\u51c6\u7684 Baseline \u6216 Restricted \u7b56\u7565\u6765\u9632\u6b62\u4f7f\u7528 <code>hostPath</code>\u3002</p> <p>\u6709\u5173\u7279\u6743\u5347\u7ea7\u7684\u5371\u9669\u6027\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u9605\u8bfb Seth Art \u7684\u535a\u5ba2 Bad Pods: Kubernetes Pod Privilege Escalation\u3002</p>"},{"location":"zh/security/docs/pods/#dos","title":"\u4e3a\u6bcf\u4e2a\u5bb9\u5668\u8bbe\u7f6e\u8bf7\u6c42\u548c\u9650\u5236\uff0c\u4ee5\u907f\u514d\u8d44\u6e90\u4e89\u7528\u548c DoS \u653b\u51fb","text":"<p>\u6ca1\u6709\u8bf7\u6c42\u6216\u9650\u5236\u7684 pod \u7406\u8bba\u4e0a\u53ef\u4ee5\u6d88\u8017\u4e3b\u673a\u4e0a\u7684\u6240\u6709\u53ef\u7528\u8d44\u6e90\u3002\u5f53\u989d\u5916\u7684 pod \u88ab\u8c03\u5ea6\u5230\u8282\u70b9\u65f6\uff0c\u8282\u70b9\u53ef\u80fd\u4f1a\u9047\u5230 CPU \u6216\u5185\u5b58\u538b\u529b\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4 Kubelet \u7ec8\u6b62\u6216\u4ece\u8282\u70b9\u4e2d\u9010\u51fa pod\u3002\u867d\u7136\u60a8\u65e0\u6cd5\u5b8c\u5168\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff0c\u4f46\u8bbe\u7f6e\u8bf7\u6c42\u548c\u9650\u5236\u5c06\u6709\u52a9\u4e8e\u6700\u5c0f\u5316\u8d44\u6e90\u4e89\u7528\u5e76\u51cf\u8f7b\u7f16\u5199\u4e0d\u4f73\u7684\u5e94\u7528\u7a0b\u5e8f\u6d88\u8017\u8fc7\u591a\u8d44\u6e90\u7684\u98ce\u9669\u3002</p> <p><code>podSpec</code> \u5141\u8bb8\u60a8\u4e3a CPU \u548c\u5185\u5b58\u6307\u5b9a\u8bf7\u6c42\u548c\u9650\u5236\u3002CPU \u88ab\u89c6\u4e3a\u53ef\u538b\u7f29\u8d44\u6e90\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u8fc7\u5ea6\u4f7f\u7528\u3002\u5185\u5b58\u662f\u4e0d\u53ef\u538b\u7f29\u7684\uff0c\u5373\u4e0d\u80fd\u5728\u591a\u4e2a\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u3002</p> <p>\u5f53\u60a8\u4e3a CPU \u6216\u5185\u5b58\u6307\u5b9a requests \u65f6\uff0c\u60a8\u5b9e\u9645\u4e0a\u662f\u5728\u6307\u5b9a\u5bb9\u5668\u4fdd\u8bc1\u83b7\u5f97\u7684 \u5185\u5b58 \u91cf\u3002Kubernetes \u6c47\u603b pod \u4e2d\u6240\u6709\u5bb9\u5668\u7684\u8bf7\u6c42\uff0c\u4ee5\u786e\u5b9a\u5c06 pod \u8c03\u5ea6\u5230\u54ea\u4e2a\u8282\u70b9\u3002\u5982\u679c\u5bb9\u5668\u8d85\u8fc7\u8bf7\u6c42\u7684\u5185\u5b58\u91cf\uff0c\u5982\u679c\u8282\u70b9\u4e0a\u5b58\u5728\u5185\u5b58\u538b\u529b\uff0c\u5b83\u53ef\u80fd\u4f1a\u88ab\u7ec8\u6b62\u3002</p> <p>Limits \u662f\u5bb9\u5668\u5141\u8bb8\u6d88\u8017\u7684\u6700\u5927 CPU \u548c\u5185\u5b58\u8d44\u6e90\u91cf\uff0c\u76f4\u63a5\u5bf9\u5e94\u4e8e\u4e3a\u5bb9\u5668\u521b\u5efa\u7684 cgroup \u7684 <code>memory.limit_in_bytes</code> \u503c\u3002\u8d85\u8fc7\u5185\u5b58\u9650\u5236\u7684\u5bb9\u5668\u5c06\u88ab OOM \u7ec8\u6b62\u3002\u5982\u679c\u5bb9\u5668\u8d85\u8fc7\u5176 CPU \u9650\u5236\uff0c\u5b83\u5c06\u88ab\u8282\u6d41\u3002</p> <p>\u63d0\u793a</p> <p>\u4f7f\u7528\u5bb9\u5668 <code>resources.limits</code> \u65f6\uff0c\u5f3a\u70c8\u5efa\u8bae\u57fa\u4e8e\u8d1f\u8f7d\u6d4b\u8bd5\u6765\u786e\u5b9a\u7cbe\u786e\u7684\u5bb9\u5668\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5(\u4e5f\u79f0\u4e3a\u8d44\u6e90\u5360\u7528)\u3002\u5982\u679c\u6ca1\u6709\u51c6\u786e\u53ef\u4fe1\u7684\u8d44\u6e90\u5360\u7528\uff0c\u53ef\u4ee5\u9002\u5f53\u586b\u5145\u5bb9\u5668 <code>resources.limits</code>\u3002\u4f8b\u5982\uff0c<code>resources.limits.memory</code> \u53ef\u4ee5\u6bd4\u53ef\u89c2\u5bdf\u5230\u7684\u6700\u5927\u503c\u9ad8\u51fa 20-30%,\u4ee5\u8003\u8651\u6f5c\u5728\u7684\u5185\u5b58\u8d44\u6e90\u9650\u5236\u4e0d\u51c6\u786e\u6027\u3002</p> <p>Kubernetes \u4f7f\u7528\u4e09\u4e2a\u670d\u52a1\u8d28\u91cf (QoS) \u7c7b\u6765\u786e\u5b9a\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4f18\u5148\u7ea7\u3002\u8fd9\u4e9b\u5305\u62ec\uff1a</p> <ul> <li>guaranteed</li> <li>burstable</li> <li>best-effort</li> </ul> <p>\u5982\u679c\u672a\u8bbe\u7f6e\u9650\u5236\u548c\u8bf7\u6c42\uff0c\u5219 pod \u88ab\u914d\u7f6e\u4e3a best-effort(\u6700\u4f4e\u4f18\u5148\u7ea7)\u3002\u5f53\u5185\u5b58\u4e0d\u8db3\u65f6\uff0cbest-effort pod \u5c06\u662f\u7b2c\u4e00\u4e2a\u88ab\u7ec8\u6b62\u7684\u3002\u5982\u679c\u5728 pod \u5185\u7684\u6240\u6709\u5bb9\u5668\u4e0a\u8bbe\u7f6e\u4e86\u9650\u5236\uff0c\u6216\u8005\u8bf7\u6c42\u548c\u9650\u5236\u8bbe\u7f6e\u4e3a\u76f8\u540c\u7684\u503c\u4e14\u4e0d\u7b49\u4e8e 0\uff0c\u5219 pod \u88ab\u914d\u7f6e\u4e3a guaranteed(\u6700\u9ad8\u4f18\u5148\u7ea7)\u3002guaranteed pod \u4e0d\u4f1a\u88ab\u7ec8\u6b62\uff0c\u9664\u975e\u5b83\u4eec\u8d85\u8fc7\u914d\u7f6e\u7684\u5185\u5b58\u9650\u5236\u3002\u5982\u679c\u9650\u5236\u548c\u8bf7\u6c42\u914d\u7f6e\u4e3a\u4e0d\u540c\u7684\u503c\u4e14\u4e0d\u7b49\u4e8e 0\uff0c\u6216\u8005 pod \u5185\u7684\u4e00\u4e2a\u5bb9\u5668\u8bbe\u7f6e\u4e86\u9650\u5236\u800c\u5176\u4ed6\u5bb9\u5668\u6ca1\u6709\u8bbe\u7f6e\u6216\u4e3a\u4e0d\u540c\u8d44\u6e90\u8bbe\u7f6e\u4e86\u9650\u5236\uff0c\u5219 pod \u88ab\u914d\u7f6e\u4e3a burstable(\u4e2d\u7b49\u4f18\u5148\u7ea7)\u3002\u8fd9\u4e9b pod \u6709\u4e00\u4e9b\u8d44\u6e90\u4fdd\u8bc1\uff0c\u4f46\u4e00\u65e6\u8d85\u8fc7\u8bf7\u6c42\u7684\u5185\u5b58\u5c31\u53ef\u80fd\u88ab\u7ec8\u6b62\u3002</p> <p>\u6ce8\u610f</p> <p>\u8bf7\u6c42\u4e0d\u4f1a\u5f71\u54cd\u5bb9\u5668 cgroup \u7684 <code>memory_limit_in_bytes</code> \u503c;cgroup \u9650\u5236\u8bbe\u7f6e\u4e3a\u4e3b\u673a\u4e0a\u53ef\u7528\u7684\u5185\u5b58\u91cf\u3002\u4f46\u662f\uff0c\u5982\u679c\u5c06\u8bf7\u6c42\u503c\u8bbe\u7f6e\u5f97\u592a\u4f4e\uff0c\u5f53\u8282\u70b9\u9047\u5230\u5185\u5b58\u538b\u529b\u65f6\uff0ckubelet \u53ef\u80fd\u4f1a\u5c06 pod \u5217\u4e3a\u7ec8\u6b62\u76ee\u6807\u3002</p> \u7c7b\u522b \u4f18\u5148\u7ea7 \u6761\u4ef6 \u7ec8\u6b62\u6761\u4ef6 Guaranteed \u6700\u9ad8 limit = request != 0 \u4ec5\u5728\u8d85\u8fc7\u5185\u5b58\u9650\u5236\u65f6 Burstable \u4e2d\u7b49 limit != request != 0 \u5982\u679c\u8d85\u8fc7\u8bf7\u6c42\u5185\u5b58\uff0c\u53ef\u80fd\u4f1a\u88ab\u7ec8\u6b62 Best-Effort \u6700\u4f4e limit &amp; request \u672a\u8bbe\u7f6e \u5f53\u5185\u5b58\u4e0d\u8db3\u65f6\u9996\u5148\u88ab\u7ec8\u6b62 <p>\u6709\u5173\u8d44\u6e90 QoS \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Kubernetes \u6587\u6863\u3002</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u547d\u540d\u7a7a\u95f4\u4e0a\u8bbe\u7f6e \u8d44\u6e90\u914d\u989d\u6216\u521b\u5efa \u9650\u5236\u8303\u56f4\u6765\u5f3a\u5236\u4f7f\u7528\u8bf7\u6c42\u548c\u9650\u5236\u3002\u8d44\u6e90\u914d\u989d\u5141\u8bb8\u60a8\u6307\u5b9a\u5206\u914d\u7ed9\u547d\u540d\u7a7a\u95f4\u7684\u603b\u8d44\u6e90\u91cf\uff0c\u4f8b\u5982 CPU \u548c RAM\u3002\u5f53\u5e94\u7528\u5230\u547d\u540d\u7a7a\u95f4\u65f6\uff0c\u5b83\u4f1a\u5f3a\u5236\u60a8\u4e3a\u90e8\u7f72\u5230\u8be5\u547d\u540d\u7a7a\u95f4\u7684\u6240\u6709\u5bb9\u5668\u6307\u5b9a\u8bf7\u6c42\u548c\u9650\u5236\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u9650\u5236\u8303\u56f4\u8ba9\u60a8\u53ef\u4ee5\u66f4\u7cbe\u7ec6\u5730\u63a7\u5236\u547d\u540d\u7a7a\u95f4\u5185\u7684\u8d44\u6e90\u5206\u914d\u3002\u4f7f\u7528\u9650\u5236\u8303\u56f4\uff0c\u60a8\u53ef\u4ee5\u4e3a pod \u6216\u547d\u540d\u7a7a\u95f4\u5185\u7684\u6bcf\u4e2a\u5bb9\u5668\u8bbe\u7f6e CPU \u548c\u5185\u5b58\u8d44\u6e90\u7684\u6700\u5c0f/\u6700\u5927\u503c\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u6765\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u8bf7\u6c42/\u9650\u5236\u503c\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u7684\u8bdd\u3002</p> <p>\u7b56\u7565\u5373\u4ee3\u7801\u89e3\u51b3\u65b9\u6848\u53ef\u7528\u4e8e\u5f3a\u5236\u6267\u884c\u8bf7\u6c42\u548c\u9650\u5236\uff0c\u6216\u8005\u5728\u521b\u5efa\u547d\u540d\u7a7a\u95f4\u65f6\u751a\u81f3\u521b\u5efa\u8d44\u6e90\u914d\u989d\u548c\u9650\u5236\u8303\u56f4\u3002</p>"},{"location":"zh/security/docs/pods/#_6","title":"\u4e0d\u8981\u5141\u8bb8\u7279\u6743\u5347\u7ea7","text":"<p>\u7279\u6743\u5347\u7ea7\u5141\u8bb8\u8fdb\u7a0b\u66f4\u6539\u5176\u8fd0\u884c\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u3002Sudo \u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\uff0c\u5177\u6709 SUID \u6216 SGID \u4f4d\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e5f\u662f\u5982\u6b64\u3002\u7279\u6743\u5347\u7ea7\u57fa\u672c\u4e0a\u662f\u4e00\u79cd\u8ba9\u7528\u6237\u4ee5\u53e6\u4e00\u4e2a\u7528\u6237\u6216\u7ec4\u7684\u6743\u9650\u6267\u884c\u6587\u4ef6\u7684\u65b9\u5f0f\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0\u53d8\u66f4\u7b56\u7565\u5373\u4ee3\u7801\u7b56\u7565\u5c06 <code>allowPrivilegeEscalation</code> \u8bbe\u7f6e\u4e3a <code>false</code>,\u6216\u8005\u5728 <code>podSpec</code> \u4e2d\u8bbe\u7f6e <code>securityContext.allowPrivilegeEscalation</code>,\u6765\u9632\u6b62\u5bb9\u5668\u4f7f\u7528\u7279\u6743\u5347\u7ea7\u3002\u7b56\u7565\u5373\u4ee3\u7801\u7b56\u7565\u8fd8\u53ef\u4ee5\u7528\u4e8e\u9632\u6b62 API \u670d\u52a1\u5668\u8bf7\u6c42\u5728\u68c0\u6d4b\u5230\u9519\u8bef\u8bbe\u7f6e\u65f6\u6210\u529f\u3002Pod \u5b89\u5168\u6807\u51c6\u4e5f\u53ef\u4ee5\u7528\u4e8e\u9632\u6b62 pod \u4f7f\u7528\u7279\u6743\u5347\u7ea7\u3002</p>"},{"location":"zh/security/docs/pods/#serviceaccount","title":"\u7981\u7528 ServiceAccount \u4ee4\u724c\u6302\u8f7d","text":"<p>\u5bf9\u4e8e\u4e0d\u9700\u8981\u8bbf\u95ee Kubernetes API \u7684 pod\uff0c\u60a8\u53ef\u4ee5\u5728 pod \u89c4\u8303\u6216\u5bf9\u4e8e\u4f7f\u7528\u7279\u5b9a ServiceAccount \u7684\u6240\u6709 pod \u4e0a\u7981\u7528\u81ea\u52a8\u6302\u8f7d ServiceAccount \u4ee4\u724c\u3002</p> <p>\u6ce8\u610f</p> <p>\u7981\u7528 ServiceAccount \u6302\u8f7d\u5e76\u4e0d\u4f1a\u963b\u6b62 pod \u901a\u8fc7\u7f51\u7edc\u8bbf\u95ee Kubernetes API\u3002\u8981\u9632\u6b62 pod \u901a\u8fc7\u7f51\u7edc\u8bbf\u95ee Kubernetes API\uff0c\u60a8\u9700\u8981\u4fee\u6539 EKS \u96c6\u7fa4\u7aef\u70b9\u8bbf\u95ee\u5e76\u4f7f\u7528 NetworkPolicy \u963b\u6b62 pod \u8bbf\u95ee\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-no-automount\nspec:\n  automountServiceAccountToken: false\n</code></pre> <pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: sa-no-automount\nautomountServiceAccountToken: false\n</code></pre>"},{"location":"zh/security/docs/pods/#_7","title":"\u7981\u7528\u670d\u52a1\u53d1\u73b0","text":"<p>\u5bf9\u4e8e\u4e0d\u9700\u8981\u67e5\u627e\u6216\u8c03\u7528\u96c6\u7fa4\u5185\u670d\u52a1\u7684 pod\uff0c\u60a8\u53ef\u4ee5\u51cf\u5c11\u63d0\u4f9b\u7ed9 pod \u7684\u4fe1\u606f\u91cf\u3002\u60a8\u53ef\u4ee5\u5c06 Pod \u7684 DNS \u7b56\u7565\u8bbe\u7f6e\u4e3a\u4e0d\u4f7f\u7528 CoreDNS\uff0c\u5e76\u4e14\u4e0d\u5c06\u670d\u52a1\u66b4\u9732\u4e3a pod \u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u73af\u5883\u53d8\u91cf\u3002\u6709\u5173\u670d\u52a1\u94fe\u63a5\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Kubernetes \u5173\u4e8e\u73af\u5883\u53d8\u91cf\u7684\u6587\u6863\u3002pod \u7684 DNS \u7b56\u7565\u7684\u9ed8\u8ba4\u503c\u4e3a \"ClusterFirst\",\u5b83\u4f7f\u7528\u96c6\u7fa4\u5185 DNS\uff0c\u800c\u975e\u9ed8\u8ba4\u503c \"Default\" \u4f7f\u7528\u5e95\u5c42\u8282\u70b9\u7684 DNS \u89e3\u6790\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Kubernetes \u5173\u4e8e Pod DNS \u7b56\u7565\u7684\u6587\u6863\u3002</p> <p>\u6ce8\u610f</p> <p>\u7981\u7528\u670d\u52a1\u94fe\u63a5\u548c\u66f4\u6539 pod \u7684 DNS \u7b56\u7565\u5e76\u4e0d\u4f1a\u963b\u6b62 pod \u901a\u8fc7\u7f51\u7edc\u8bbf\u95ee\u96c6\u7fa4\u5185 DNS \u670d\u52a1\u3002\u653b\u51fb\u8005\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u96c6\u7fa4\u5185 DNS \u670d\u52a1\u6765\u679a\u4e3e\u670d\u52a1\u3002(\u4f8b\u5982\uff1a <code>dig SRV *.*.svc.cluster.local @$CLUSTER_DNS_IP</code>)\u8981\u9632\u6b62\u96c6\u7fa4\u5185\u670d\u52a1\u53d1\u73b0\uff0c\u8bf7\u4f7f\u7528 NetworkPolicy \u963b\u6b62 pod \u8bbf\u95ee</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-no-service-info\nspec:\n    dnsPolicy: Default # \"Default\" \u4e0d\u662f\u771f\u6b63\u7684\u9ed8\u8ba4\u503c\n    enableServiceLinks: false\n</code></pre>"},{"location":"zh/security/docs/pods/#_8","title":"\u5c06\u60a8\u7684\u955c\u50cf\u914d\u7f6e\u4e3a\u53ea\u8bfb\u6839\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5c06\u60a8\u7684\u955c\u50cf\u914d\u7f6e\u4e3a\u53ea\u8bfb\u6839\u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u9632\u6b62\u653b\u51fb\u8005\u8986\u76d6\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u5199\u5165\u6587\u4ef6\u7cfb\u7edf\uff0c\u8bf7\u8003\u8651\u5199\u5165\u4e34\u65f6\u76ee\u5f55\u6216\u9644\u52a0\u5e76\u6302\u8f7d\u5377\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e pod \u7684 SecurityContext \u6765\u5f3a\u5236\u6267\u884c\u6b64\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>...\nsecurityContext:\n  readOnlyRootFilesystem: true\n...\n</code></pre> <p>\u7b56\u7565\u5373\u4ee3\u7801\u548c Pod \u5b89\u5168\u6807\u51c6\u53ef\u7528\u4e8e\u5f3a\u5236\u6267\u884c\u6b64\u884c\u4e3a\u3002</p> <p>\u4fe1\u606f</p> <p>\u6839\u636e Kubernetes \u4e2d\u7684 Windows \u5bb9\u5668,\u5bf9\u4e8e\u5728 Windows \u4e0a\u8fd0\u884c\u7684\u5bb9\u5668\uff0c<code>securityContext.readOnlyRootFilesystem</code> \u4e0d\u80fd\u8bbe\u7f6e\u4e3a <code>true</code>,\u56e0\u4e3a\u6ce8\u518c\u8868\u548c\u7cfb\u7edf\u8fdb\u7a0b\u9700\u8981\u5728\u5bb9\u5668\u5185\u90e8\u5177\u6709\u5199\u5165\u8bbf\u95ee\u6743\u9650\u624d\u80fd\u8fd0\u884c\u3002</p>"},{"location":"zh/security/docs/pods/#_9","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>Amazon EKS \u5b89\u5168\u6c89\u6d78\u5f0f\u7814\u8ba8\u4f1a - Pod \u5b89\u5168</li> <li>open-policy-agent/gatekeeper-library: OPA Gatekeeper \u7b56\u7565\u5e93,\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u5e93\u4f5c\u4e3a PSP \u7684\u66ff\u4ee3\u54c1\u3002</li> <li>Kyverno \u7b56\u7565\u5e93</li> <li>\u4e00\u7ec4\u5e38\u89c1\u7684 OPA \u548c Kyverno \u7b56\u7565\u7528\u4e8e EKS\u3002</li> <li>\u57fa\u4e8e\u7b56\u7565\u7684\u5bf9\u7b56\uff1a\u7b2c 1 \u90e8\u5206</li> <li>\u57fa\u4e8e\u7b56\u7565\u7684\u5bf9\u7b56\uff1a\u7b2c 2 \u90e8\u5206</li> <li>Pod \u5b89\u5168\u7b56\u7565\u8fc1\u79fb\u5668 \u4e00\u4e2a\u5c06 PSP \u8f6c\u6362\u4e3a OPA/Gatekeeper\u3001KubeWarden \u6216 Kyverno \u7b56\u7565\u7684\u5de5\u5177</li> <li>NeuVector by SUSE \u5f00\u6e90\u3001\u96f6\u4fe1\u4efb\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\uff0c\u63d0\u4f9b\u8fdb\u7a0b\u548c\u6587\u4ef6\u7cfb\u7edf\u7b56\u7565\u4ee5\u53ca\u51c6\u5165\u63a7\u5236\u89c4\u5219\u3002</li> </ul>"},{"location":"zh/security/docs/runtime/","title":"\u8fd0\u884c\u65f6\u5b89\u5168","text":"<p>\u8fd0\u884c\u65f6\u5b89\u5168\u4e3a\u60a8\u7684\u5bb9\u5668\u5728\u8fd0\u884c\u65f6\u63d0\u4f9b\u4e3b\u52a8\u4fdd\u62a4\u3002\u5176\u7406\u5ff5\u662f\u68c0\u6d4b\u548c/\u6216\u9632\u6b62\u5728\u5bb9\u5668\u5185\u90e8\u53d1\u751f\u6076\u610f\u6d3b\u52a8\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7Linux\u5185\u6838\u6216\u4e0eKubernetes\u96c6\u6210\u7684\u5185\u6838\u6269\u5c55\u4e2d\u7684\u591a\u79cd\u673a\u5236\u6765\u5b9e\u73b0\uff0c\u4f8b\u5982Linux\u529f\u80fd\u3001\u5b89\u5168\u8ba1\u7b97(seccomp)\u3001AppArmor\u6216SELinux\u3002\u8fd8\u6709\u4e00\u4e9b\u9009\u9879\uff0c\u5982Amazon GuardDuty\u548c\u7b2c\u4e09\u65b9\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5efa\u7acb\u57fa\u7ebf\u5e76\u68c0\u6d4b\u5f02\u5e38\u6d3b\u52a8\uff0c\u800c\u65e0\u9700\u624b\u52a8\u914d\u7f6eLinux\u5185\u6838\u673a\u5236\u3002</p> <p>Attention</p> <p>Kubernetes\u76ee\u524d\u6ca1\u6709\u4efb\u4f55\u672c\u5730\u673a\u5236\u5c06seccomp\u3001AppArmor\u6216SELinux\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5230\u8282\u70b9\u4e0a\u3002\u5b83\u4eec\u8981\u4e48\u5fc5\u987b\u624b\u52a8\u52a0\u8f7d\uff0c\u8981\u4e48\u5728\u5f15\u5bfc\u8282\u70b9\u65f6\u5b89\u88c5\u3002\u8fd9\u5fc5\u987b\u5728\u5f15\u7528\u5b83\u4eec\u4e4b\u524d\u5b8c\u6210\uff0c\u56e0\u4e3a\u8c03\u5ea6\u7a0b\u5e8f\u4e0d\u77e5\u9053\u54ea\u4e9b\u8282\u70b9\u6709\u914d\u7f6e\u6587\u4ef6\u3002\u8bf7\u53c2\u9605\u4e0b\u9762\u5982\u4f55\u4f7f\u7528\u5de5\u5177(\u5982Security Profiles Operator)\u6765\u5e2e\u52a9\u81ea\u52a8\u5c06\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u5230\u8282\u70b9\u4e0a\u3002</p>"},{"location":"zh/security/docs/runtime/#kubernetes","title":"\u5b89\u5168\u4e0a\u4e0b\u6587\u548cKubernetes\u5185\u7f6e\u63a7\u5236","text":"<p>\u8bb8\u591aLinux\u8fd0\u884c\u65f6\u5b89\u5168\u673a\u5236\u4e0eKubernetes\u7d27\u5bc6\u96c6\u6210\uff0c\u53ef\u4ee5\u901a\u8fc7Kubernetes \u5b89\u5168\u4e0a\u4e0b\u6587\u8fdb\u884c\u914d\u7f6e\u3002\u5176\u4e2d\u4e00\u4e2a\u9009\u9879\u662f<code>privileged</code>\u6807\u5fd7\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a<code>false</code>,\u5982\u679c\u542f\u7528\uff0c\u57fa\u672c\u76f8\u5f53\u4e8e\u4e3b\u673a\u4e0a\u7684root\u3002\u5728\u751f\u4ea7\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u542f\u7528\u7279\u6743\u6a21\u5f0f\u51e0\u4e4e\u603b\u662f\u4e0d\u5408\u9002\u7684\uff0c\u4f46\u8fd8\u6709\u8bb8\u591a\u5176\u4ed6\u63a7\u5236\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4e3a\u5bb9\u5668\u63d0\u4f9b\u66f4\u7ec6\u7c92\u5ea6\u7684\u7279\u6743\u3002</p>"},{"location":"zh/security/docs/runtime/#linux","title":"Linux\u529f\u80fd","text":"<p>Linux\u529f\u80fd\u5141\u8bb8\u60a8\u5728\u4e0d\u63d0\u4f9broot\u7528\u6237\u7684\u6240\u6709\u80fd\u529b\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u67d0\u4e9b\u529f\u80fd\u6388\u4e88Pod\u6216\u5bb9\u5668\u3002\u793a\u4f8b\u5305\u62ec<code>CAP_NET_ADMIN</code>,\u5141\u8bb8\u914d\u7f6e\u7f51\u7edc\u63a5\u53e3\u6216\u9632\u706b\u5899\uff0c\u6216<code>CAP_SYS_TIME</code>,\u5141\u8bb8\u64cd\u4f5c\u7cfb\u7edf\u65f6\u949f\u3002</p>"},{"location":"zh/security/docs/runtime/#seccomp","title":"Seccomp","text":"<p>\u4f7f\u7528\u5b89\u5168\u8ba1\u7b97(seccomp)\uff0c\u60a8\u53ef\u4ee5\u9632\u6b62\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u5411\u5e95\u5c42\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u53d1\u51fa\u67d0\u4e9b\u7cfb\u7edf\u8c03\u7528\u3002\u867d\u7136Linux\u64cd\u4f5c\u7cfb\u7edf\u6709\u51e0\u767e\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u4f46\u5927\u90e8\u5206\u90fd\u4e0d\u662f\u8fd0\u884c\u5bb9\u5668\u6240\u5fc5\u9700\u7684\u3002\u901a\u8fc7\u9650\u5236\u5bb9\u5668\u53ef\u4ee5\u53d1\u51fa\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u60a8\u53ef\u4ee5\u6709\u6548\u5730\u51cf\u5c0f\u5e94\u7528\u7a0b\u5e8f\u7684\u653b\u51fb\u9762\u3002</p> <p>Seccomp\u901a\u8fc7\u62e6\u622a\u7cfb\u7edf\u8c03\u7528\u5e76\u53ea\u5141\u8bb8\u901a\u8fc7\u5df2\u5141\u8bb8\u5217\u8868\u7684\u7cfb\u7edf\u8c03\u7528\u6765\u5de5\u4f5c\u3002Docker\u6709\u4e00\u4e2a\u9ed8\u8ba4seccomp\u914d\u7f6e\u6587\u4ef6\uff0c\u9002\u7528\u4e8e\u5927\u591a\u6570\u901a\u7528\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5176\u4ed6\u5bb9\u5668\u8fd0\u884c\u65f6(\u5982containerd)\u4e5f\u63d0\u4f9b\u4e86\u53ef\u6bd4\u7684\u9ed8\u8ba4\u503c\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728Pod\u89c4\u8303\u7684<code>securityContext</code>\u90e8\u5206\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5c06\u5bb9\u5668\u6216Pod\u914d\u7f6e\u4e3a\u4f7f\u7528\u5bb9\u5668\u8fd0\u884c\u65f6\u7684\u9ed8\u8ba4seccomp\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>securityContext:\n  seccompProfile:\n    type: RuntimeDefault\n</code></pre> <p>\u4ece1.22\u7248\u672c\u5f00\u59cb(alpha\u7248\uff0c1.27\u7248\u672c\u7a33\u5b9a)\uff0c\u4e0a\u9762\u7684<code>RuntimeDefault</code>\u53ef\u4ee5\u4f7f\u7528\u5355\u4e2akubelet\u6807\u5fd7(<code>--seccomp-default</code>)\u7528\u4e8e\u8282\u70b9\u4e0a\u7684\u6240\u6709Pod\u3002\u7136\u540e\uff0c\u53ea\u6709\u5728\u9700\u8981\u5176\u4ed6\u914d\u7f6e\u6587\u4ef6\u65f6\uff0c\u624d\u9700\u8981\u5728<code>securityContext</code>\u4e2d\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4e3a\u9700\u8981\u989d\u5916\u6743\u9650\u7684\u5185\u5bb9\u521b\u5efa\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u624b\u52a8\u6267\u884c\u8fd9\u4e00\u64cd\u4f5c\u53ef\u80fd\u975e\u5e38\u7e41\u7410\uff0c\u4f46\u6709\u4e00\u4e9b\u5de5\u5177(\u5982Inspektor Gadget(\u4e5f\u5728\u7f51\u7edc\u5b89\u5168\u90e8\u5206\u4e2d\u63a8\u8350\u7528\u4e8e\u751f\u6210\u7f51\u7edc\u7b56\u7565)\u548cSecurity Profiles Operator)\u652f\u6301\u4f7f\u7528eBPF\u6216\u65e5\u5fd7\u8bb0\u5f55\u57fa\u7ebf\u7279\u6743\u8981\u6c42\u4f5c\u4e3aseccomp\u914d\u7f6e\u6587\u4ef6\u3002Security Profiles Operator\u8fdb\u4e00\u6b65\u5141\u8bb8\u81ea\u52a8\u5c06\u8bb0\u5f55\u7684\u914d\u7f6e\u6587\u4ef6\u90e8\u7f72\u5230\u8282\u70b9\uff0c\u4ee5\u4f9bPod\u548c\u5bb9\u5668\u4f7f\u7528\u3002</p>"},{"location":"zh/security/docs/runtime/#apparmorselinux","title":"AppArmor\u548cSELinux","text":"<p>AppArmor\u548cSELinux\u88ab\u79f0\u4e3a\u5f3a\u5236\u8bbf\u95ee\u63a7\u5236\u6216MAC\u7cfb\u7edf\u3002\u5b83\u4eec\u5728\u6982\u5ff5\u4e0a\u4e0eseccomp\u7c7b\u4f3c\uff0c\u4f46\u5177\u6709\u4e0d\u540c\u7684API\u548c\u529f\u80fd\uff0c\u5141\u8bb8\u5bf9\u7279\u5b9a\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84\u6216\u7f51\u7edc\u7aef\u53e3\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u3002\u5bf9\u8fd9\u4e9b\u5de5\u5177\u7684\u652f\u6301\u53d6\u51b3\u4e8eLinux\u53d1\u884c\u7248\uff0cDebian/Ubuntu\u652f\u6301AppArmor\uff0cRHEL/CentOS/Bottlerocket/Amazon Linux 2023\u652f\u6301SELinux\u3002\u53e6\u8bf7\u53c2\u9605\u57fa\u7840\u8bbe\u65bd\u5b89\u5168\u90e8\u5206\u4ee5\u8fdb\u4e00\u6b65\u8ba8\u8bbaSELinux\u3002</p> <p>AppArmor\u548cSELinux\u90fd\u4e0eKubernetes\u96c6\u6210\uff0c\u4f46\u622a\u81f3Kubernetes 1.28,AppArmor\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u901a\u8fc7\u6ce8\u89e3\u6307\u5b9a\uff0c\u800cSELinux\u6807\u7b7e\u53ef\u4ee5\u901a\u8fc7\u5b89\u5168\u4e0a\u4e0b\u6587\u4e2d\u7684SELinuxOptions\u5b57\u6bb5\u76f4\u63a5\u8bbe\u7f6e\u3002</p> <p>\u4e0eseccomp\u914d\u7f6e\u6587\u4ef6\u4e00\u6837\uff0c\u4e0a\u9762\u63d0\u5230\u7684Security Profiles Operator\u53ef\u4ee5\u5e2e\u52a9\u5c06\u914d\u7f6e\u6587\u4ef6\u90e8\u7f72\u5230\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u4e0a\u3002(\u672a\u6765\uff0c\u8be5\u9879\u76ee\u8fd8\u65e8\u5728\u4e3aAppArmor\u548cSELinux\u751f\u6210\u914d\u7f6e\u6587\u4ef6\uff0c\u5c31\u50cf\u5b83\u4e3aseccomp\u6240\u505a\u7684\u90a3\u6837\u3002)</p>"},{"location":"zh/security/docs/runtime/#_2","title":"\u5efa\u8bae","text":""},{"location":"zh/security/docs/runtime/#amazon-guarddutyeks","title":"\u4f7f\u7528Amazon GuardDuty\u8fdb\u884c\u8fd0\u884c\u65f6\u76d1\u63a7\u5e76\u68c0\u6d4b\u5bf9\u60a8\u7684EKS\u73af\u5883\u7684\u5a01\u80c1","text":"<p>\u5982\u679c\u60a8\u76ee\u524d\u6ca1\u6709\u6301\u7eed\u76d1\u63a7EKS\u8fd0\u884c\u65f6\u548c\u5206\u6790EKS\u5ba1\u8ba1\u65e5\u5fd7\u3001\u626b\u63cf\u6076\u610f\u8f6f\u4ef6\u548c\u5176\u4ed6\u53ef\u7591\u6d3b\u52a8\u7684\u89e3\u51b3\u65b9\u6848\uff0cAmazon\u5f3a\u70c8\u5efa\u8bae\u5e0c\u671b\u4ee5\u7b80\u5355\u3001\u5feb\u901f\u3001\u5b89\u5168\u3001\u53ef\u6269\u5c55\u548c\u7ecf\u6d4e\u9ad8\u6548\u7684\u4e00\u952e\u65b9\u5f0f\u4fdd\u62a4\u5176AWS\u73af\u5883\u7684\u5ba2\u6237\u4f7f\u7528Amazon GuardDuty\u3002Amazon GuardDuty\u662f\u4e00\u79cd\u5b89\u5168\u76d1\u63a7\u670d\u52a1\uff0c\u53ef\u5206\u6790\u548c\u5904\u7406\u57fa\u7840\u6570\u636e\u6e90\uff0c\u5982AWS CloudTrail\u7ba1\u7406\u4e8b\u4ef6\u3001AWS CloudTrail\u4e8b\u4ef6\u65e5\u5fd7\u3001VPC\u6d41\u65e5\u5fd7(\u6765\u81eaAmazon EC2\u5b9e\u4f8b)\u3001Kubernetes\u5ba1\u8ba1\u65e5\u5fd7\u548cDNS\u65e5\u5fd7\u3002\u5b83\u8fd8\u5305\u62ecEKS\u8fd0\u884c\u65f6\u76d1\u63a7\u3002\u5b83\u4f7f\u7528\u4e0d\u65ad\u66f4\u65b0\u7684\u5a01\u80c1\u60c5\u62a5\u6e90(\u5982\u6076\u610fIP\u5730\u5740\u548c\u57df\u540d\u5217\u8868)\uff0c\u5e76\u4f7f\u7528\u673a\u5668\u5b66\u4e60\u6765\u8bc6\u522b\u60a8\u7684AWS\u73af\u5883\u4e2d\u610f\u5916\u3001\u53ef\u80fd\u672a\u7ecf\u6388\u6743\u548c\u6076\u610f\u7684\u6d3b\u52a8\u3002\u8fd9\u53ef\u80fd\u5305\u62ec\u7279\u6743\u5347\u7ea7\u3001\u4f7f\u7528\u66b4\u9732\u7684\u51ed\u8bc1\u6216\u4e0e\u6076\u610fIP\u5730\u5740\u3001\u57df\u540d\u901a\u4fe1\u3001\u60a8\u7684Amazon EC2\u5b9e\u4f8b\u548cEKS\u5bb9\u5668\u5de5\u4f5c\u8d1f\u8f7d\u4e0a\u5b58\u5728\u6076\u610f\u8f6f\u4ef6\uff0c\u6216\u53d1\u73b0\u53ef\u7591\u7684API\u6d3b\u52a8\u7b49\u95ee\u9898\u3002GuardDuty\u901a\u8fc7\u5728GuardDuty\u63a7\u5236\u53f0\u6216\u901a\u8fc7Amazon EventBridge\u751f\u6210\u5b89\u5168\u53d1\u73b0\u6765\u901a\u77e5\u60a8AWS\u73af\u5883\u7684\u72b6\u6001\u3002GuardDuty\u8fd8\u652f\u6301\u5c06\u60a8\u7684\u53d1\u73b0\u5bfc\u51fa\u5230Amazon\u7b80\u5355\u5b58\u50a8\u670d\u52a1(S3)\u5b58\u50a8\u6876\uff0c\u5e76\u4e0e\u5176\u4ed6\u670d\u52a1(\u5982AWS Security Hub\u548cDetective)\u96c6\u6210\u3002</p> <p>\u89c2\u770b\u6b64AWS\u5728\u7ebf\u6280\u672f\u8ba8\u8bba\"\u4f7f\u7528Amazon GuardDuty\u589e\u5f3a\u5bf9Amazon EKS\u7684\u5a01\u80c1\u68c0\u6d4b - AWS\u5728\u7ebf\u6280\u672f\u8ba8\u8bba\",\u4e86\u89e3\u5982\u4f55\u5206\u6b65\u5728\u51e0\u5206\u949f\u5185\u542f\u7528\u8fd9\u4e9b\u989d\u5916\u7684EKS\u5b89\u5168\u529f\u80fd\u3002</p>"},{"location":"zh/security/docs/runtime/#_3","title":"\u53ef\u9009\uff1a\u4f7f\u7528\u7b2c\u4e09\u65b9\u89e3\u51b3\u65b9\u6848\u8fdb\u884c\u8fd0\u884c\u65f6\u76d1\u63a7","text":"<p>\u5982\u679c\u60a8\u4e0d\u719f\u6089Linux\u5b89\u5168\uff0c\u521b\u5efa\u548c\u7ba1\u7406seccomp\u548cApparmor\u914d\u7f6e\u6587\u4ef6\u53ef\u80fd\u4f1a\u5f88\u56f0\u96be\u3002\u5982\u679c\u60a8\u6ca1\u6709\u65f6\u95f4\u6210\u4e3a\u4e13\u5bb6\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u7b2c\u4e09\u65b9\u5546\u4e1a\u89e3\u51b3\u65b9\u6848\u3002\u8bb8\u591a\u89e3\u51b3\u65b9\u6848\u5df2\u7ecf\u8d85\u8d8a\u4e86\u9759\u6001\u914d\u7f6e\u6587\u4ef6(\u5982Apparmor\u548cseccomp)\uff0c\u5f00\u59cb\u4f7f\u7528\u673a\u5668\u5b66\u4e60\u6765\u963b\u6b62\u6216\u53d1\u51fa\u53ef\u7591\u6d3b\u52a8\u7684\u8b66\u62a5\u3002\u5176\u4e2d\u4e00\u4e9b\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u5728\u4e0b\u9762\u7684\u5de5\u5177\u90e8\u5206\u627e\u5230\u3002\u66f4\u591a\u9009\u9879\u53ef\u4ee5\u5728AWS Marketplace for Containers\u4e0a\u627e\u5230\u3002</p>"},{"location":"zh/security/docs/runtime/#seccomplinux","title":"\u5728\u7f16\u5199seccomp\u7b56\u7565\u4e4b\u524d\uff0c\u8003\u8651\u6dfb\u52a0/\u5220\u9664Linux\u529f\u80fd","text":"<p>\u529f\u80fd\u6d89\u53ca\u53ef\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8bbf\u95ee\u7684\u5185\u6838\u51fd\u6570\u4e2d\u7684\u5404\u79cd\u68c0\u67e5\u3002\u5982\u679c\u68c0\u67e5\u5931\u8d25\uff0c\u7cfb\u7edf\u8c03\u7528\u901a\u5e38\u4f1a\u8fd4\u56de\u9519\u8bef\u3002\u8be5\u68c0\u67e5\u53ef\u4ee5\u5728\u7279\u5b9a\u7cfb\u7edf\u8c03\u7528\u7684\u5f00\u5934\u7acb\u5373\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u5728\u53ef\u80fd\u901a\u8fc7\u591a\u4e2a\u4e0d\u540c\u7cfb\u7edf\u8c03\u7528\u8bbf\u95ee\u7684\u5185\u6838\u7684\u66f4\u6df1\u5c42\u6b21\u6267\u884c(\u4f8b\u5982\u5199\u5165\u7279\u5b9a\u7684\u7279\u6743\u6587\u4ef6)\u3002\u53e6\u4e00\u65b9\u9762\uff0cseccomp\u662f\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u8fc7\u6ee4\u5668\uff0c\u5728\u8fd0\u884c\u4efb\u4f55\u7cfb\u7edf\u8c03\u7528\u4e4b\u524d\u90fd\u4f1a\u5e94\u7528\u3002\u8fdb\u7a0b\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u5141\u8bb8\u5b83\u4eec\u64a4\u9500\u8fd0\u884c\u67d0\u4e9b\u7cfb\u7edf\u8c03\u7528\u6216\u67d0\u4e9b\u7cfb\u7edf\u8c03\u7528\u7684\u7279\u5b9a\u53c2\u6570\u7684\u6743\u9650\u3002</p> <p>\u5728\u4f7f\u7528seccomp\u4e4b\u524d\uff0c\u8bf7\u8003\u8651\u6dfb\u52a0/\u5220\u9664Linux\u529f\u80fd\u662f\u5426\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u6240\u9700\u7684\u63a7\u5236\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4e3a\u5bb9\u5668\u8bbe\u7f6e\u529f\u80fd\u3002</p>"},{"location":"zh/security/docs/runtime/#podpsp","title":"\u67e5\u770b\u662f\u5426\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528Pod\u5b89\u5168\u7b56\u7565(PSP)\u6765\u5b9e\u73b0\u60a8\u7684\u76ee\u6807","text":"<p>Pod\u5b89\u5168\u7b56\u7565\u63d0\u4f9b\u4e86\u8bb8\u591a\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u6539\u5584\u60a8\u7684\u5b89\u5168\u6001\u52bf\uff0c\u800c\u4e0d\u4f1a\u5f15\u5165\u8fc7\u591a\u7684\u590d\u6742\u6027\u3002\u5728\u5f00\u59cb\u6784\u5efaseccomp\u548cApparmor\u914d\u7f6e\u6587\u4ef6\u4e4b\u524d\uff0c\u8bf7\u63a2\u7d22PSP\u4e2d\u63d0\u4f9b\u7684\u9009\u9879\u3002</p> <p>Warning</p> <p>\u4eceKubernetes 1.25\u5f00\u59cb\uff0cPSP\u5df2\u88ab\u5220\u9664\u5e76\u66ff\u6362\u4e3aPod\u5b89\u5168\u51c6\u5165\u63a7\u5236\u5668\u3002\u7b2c\u4e09\u65b9\u66ff\u4ee3\u65b9\u6848\u5305\u62ecOPA/Gatekeeper\u548cKyverno\u3002\u7528\u4e8e\u5b9e\u73b0PSP\u4e2d\u5e38\u89c1\u7b56\u7565\u7684Gatekeeper\u7ea6\u675f\u548c\u7ea6\u675f\u6a21\u677f\u96c6\u5408\u53ef\u4ee5\u4eceGitHub\u4e0a\u7684Gatekeeper\u5e93\u5b58\u50a8\u5e93\u4e2d\u63d0\u53d6\u3002\u800c\u4e14\uff0cPSP\u7684\u8bb8\u591a\u66ff\u4ee3\u65b9\u6848\u90fd\u53ef\u4ee5\u5728Kyverno\u7b56\u7565\u5e93\u4e2d\u627e\u5230\uff0c\u5305\u62ec\u5b8c\u6574\u7684Pod\u5b89\u5168\u6807\u51c6\u96c6\u5408\u3002</p>"},{"location":"zh/security/docs/runtime/#_4","title":"\u5de5\u5177\u548c\u8d44\u6e90","text":"<ul> <li>\u5728\u5f00\u59cb\u4e4b\u524d\u4f60\u5e94\u8be5\u77e5\u9053\u76847\u4ef6\u4e8b</li> <li>AppArmor Loader</li> <li>\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u8282\u70b9</li> <li>Security Profiles Operator\u662f\u4e00\u4e2aKubernetes\u589e\u5f3a\u529f\u80fd\uff0c\u65e8\u5728\u8ba9\u7528\u6237\u66f4\u5bb9\u6613\u5728Kubernetes\u96c6\u7fa4\u4e2d\u4f7f\u7528SELinux\u3001seccomp\u548cAppArmor\u3002\u5b83\u63d0\u4f9b\u4e86\u4ece\u6b63\u5728\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u751f\u6210\u914d\u7f6e\u6587\u4ef6\u4ee5\u53ca\u5c06\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5230Kubernetes\u8282\u70b9\u4ee5\u4f9bPod\u548c\u5bb9\u5668\u4f7f\u7528\u7684\u529f\u80fd\u3002</li> <li>Inspektor Gadget\u5141\u8bb8\u68c0\u67e5\u3001\u8ddf\u8e2a\u548c\u5206\u6790Kubernetes\u4e0a\u8bb8\u591a\u8fd0\u884c\u65f6\u884c\u4e3a\u65b9\u9762\uff0c\u5305\u62ec\u534f\u52a9\u751f\u6210seccomp\u914d\u7f6e\u6587\u4ef6\u3002</li> <li>Aqua</li> <li>Qualys</li> <li>Stackrox</li> <li>Sysdig Secure</li> <li>Prisma</li> <li>NeuVector by SUSE \u5f00\u6e90\u7684\u96f6\u4fe1\u4efb\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\uff0c\u63d0\u4f9b\u8fdb\u7a0b\u914d\u7f6e\u6587\u4ef6\u89c4\u5219\u548c\u6587\u4ef6\u8bbf\u95ee\u89c4\u5219\u3002</li> </ul>"},{"location":"zh/upgrades/","title":"\u96c6\u7fa4\u5347\u7ea7\u7684\u6700\u4f73\u5b9e\u8df5","text":"<p>\u672c\u6307\u5357\u5411\u96c6\u7fa4\u7ba1\u7406\u5458\u5c55\u793a\u5982\u4f55\u89c4\u5212\u548c\u6267\u884cAmazon EKS\u5347\u7ea7\u7b56\u7565\u3002\u5b83\u8fd8\u63cf\u8ff0\u4e86\u5982\u4f55\u5347\u7ea7\u81ea\u7ba1\u7406\u8282\u70b9\u3001\u6258\u7ba1\u8282\u70b9\u7ec4\u3001Karpenter\u8282\u70b9\u548cFargate\u8282\u70b9\u3002\u5b83\u4e0d\u5305\u62ec\u6709\u5173EKS Anywhere\u3001\u81ea\u7ba1\u7406Kubernetes\u3001AWS Outposts\u6216AWS Local Zones\u7684\u6307\u5bfc\u3002</p>"},{"location":"zh/upgrades/#_2","title":"\u6982\u8ff0","text":"<p>Kubernetes\u7248\u672c\u5305\u62ec\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762\u3002\u4e3a\u786e\u4fdd\u987a\u5229\u8fd0\u884c\uff0c\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762\u5e94\u8fd0\u884c\u76f8\u540c\u7684Kubernetes\u5c0f\u7248\u672c\uff0c\u59821.24\u3002\u867d\u7136AWS\u7ba1\u7406\u548c\u5347\u7ea7\u63a7\u5236\u5e73\u9762\uff0c\u4f46\u66f4\u65b0\u6570\u636e\u5e73\u9762\u4e2d\u7684\u5de5\u4f5c\u8282\u70b9\u662f\u60a8\u7684\u8d23\u4efb\u3002</p> <ul> <li>\u63a7\u5236\u5e73\u9762 - \u63a7\u5236\u5e73\u9762\u7684\u7248\u672c\u7531Kubernetes API\u670d\u52a1\u5668\u786e\u5b9a\u3002\u5728Amazon EKS\u96c6\u7fa4\u4e2d\uff0cAWS\u8d1f\u8d23\u7ba1\u7406\u6b64\u7ec4\u4ef6\u3002\u53ef\u4ee5\u901a\u8fc7AWS API\u542f\u52a8\u63a7\u5236\u5e73\u9762\u5347\u7ea7\u3002</li> <li>\u6570\u636e\u5e73\u9762 - \u6570\u636e\u5e73\u9762\u7248\u672c\u4e0e\u8fd0\u884c\u5728\u60a8\u5404\u4e2a\u8282\u70b9\u4e0a\u7684Kubelet\u7248\u672c\u76f8\u5173\u8054\u3002\u540c\u4e00\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u53ef\u80fd\u8fd0\u884c\u4e0d\u540c\u7684\u7248\u672c\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c<code>kubectl get nodes</code>\u6765\u68c0\u67e5\u6240\u6709\u8282\u70b9\u7684\u7248\u672c\u3002</li> </ul>"},{"location":"zh/upgrades/#_3","title":"\u5347\u7ea7\u524d","text":"<p>\u5982\u679c\u60a8\u8ba1\u5212\u5728Amazon EKS\u4e2d\u5347\u7ea7Kubernetes\u7248\u672c\uff0c\u5728\u5f00\u59cb\u5347\u7ea7\u4e4b\u524d\uff0c\u6709\u4e00\u4e9b\u91cd\u8981\u7684\u653f\u7b56\u3001\u5de5\u5177\u548c\u7a0b\u5e8f\u9700\u8981\u60a8\u843d\u5b9e\u3002</p> <ul> <li>\u4e86\u89e3\u5f03\u7528\u653f\u7b56 - \u6df1\u5165\u4e86\u89e3Kubernetes\u5f03\u7528\u653f\u7b56\u7684\u5de5\u4f5c\u65b9\u5f0f\u3002\u6ce8\u610f\u4efb\u4f55\u53ef\u80fd\u5f71\u54cd\u60a8\u73b0\u6709\u5e94\u7528\u7a0b\u5e8f\u7684\u5373\u5c06\u53d1\u751f\u7684\u53d8\u5316\u3002Kubernetes\u7684\u65b0\u7248\u672c\u901a\u5e38\u4f1a\u9010\u6b65\u6dd8\u6c70\u67d0\u4e9bAPI\u548c\u529f\u80fd\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u51fa\u73b0\u95ee\u9898\u3002</li> <li>\u67e5\u770bKubernetes\u53d8\u66f4\u65e5\u5fd7 - \u5f7b\u5e95\u67e5\u770bKubernetes\u53d8\u66f4\u65e5\u5fd7\u4ee5\u53caAmazon EKS Kubernetes\u7248\u672c,\u4e86\u89e3\u53ef\u80fd\u5bf9\u60a8\u7684\u96c6\u7fa4\u4ea7\u751f\u5f71\u54cd\u7684\u4efb\u4f55\u5185\u5bb9\uff0c\u4f8b\u5982\u53ef\u80fd\u5f71\u54cd\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u91cd\u5927\u53d8\u66f4\u3002</li> <li>\u8bc4\u4f30\u96c6\u7fa4\u63d2\u4ef6\u7684\u517c\u5bb9\u6027 - \u5f53\u65b0\u7248\u672c\u53d1\u5e03\u6216\u5728\u60a8\u5c06\u96c6\u7fa4\u5347\u7ea7\u5230\u65b0\u7684Kubernetes\u5c0f\u7248\u672c\u540e\uff0cAmazon EKS\u4e0d\u4f1a\u81ea\u52a8\u66f4\u65b0\u63d2\u4ef6\u3002\u67e5\u770b\u66f4\u65b0\u63d2\u4ef6,\u4e86\u89e3\u4efb\u4f55\u73b0\u6709\u96c6\u7fa4\u63d2\u4ef6\u4e0e\u60a8\u6253\u7b97\u5347\u7ea7\u5230\u7684\u96c6\u7fa4\u7248\u672c\u7684\u517c\u5bb9\u6027\u3002</li> <li>\u542f\u7528\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u8bb0\u5f55 - \u542f\u7528\u63a7\u5236\u5e73\u9762\u65e5\u5fd7\u8bb0\u5f55,\u4ee5\u6355\u83b7\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u51fa\u73b0\u7684\u65e5\u5fd7\u3001\u9519\u8bef\u6216\u95ee\u9898\u3002\u8003\u8651\u67e5\u770b\u8fd9\u4e9b\u65e5\u5fd7\u4ee5\u68c0\u67e5\u4efb\u4f55\u5f02\u5e38\u60c5\u51b5\u3002\u5728\u975e\u751f\u4ea7\u73af\u5883\u4e2d\u6d4b\u8bd5\u96c6\u7fa4\u5347\u7ea7\uff0c\u6216\u5c06\u81ea\u52a8\u5316\u6d4b\u8bd5\u96c6\u6210\u5230\u60a8\u7684\u6301\u7eed\u96c6\u6210\u5de5\u4f5c\u6d41\u4e2d\uff0c\u4ee5\u8bc4\u4f30\u7248\u672c\u4e0e\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3001\u63a7\u5236\u5668\u548c\u81ea\u5b9a\u4e49\u96c6\u6210\u7684\u517c\u5bb9\u6027\u3002</li> <li>\u63a2\u7d22eksctl\u8fdb\u884c\u96c6\u7fa4\u7ba1\u7406 - \u8003\u8651\u4f7f\u7528eksctl\u6765\u7ba1\u7406\u60a8\u7684EKS\u96c6\u7fa4\u3002\u5b83\u4e3a\u60a8\u63d0\u4f9b\u4e86\u66f4\u65b0\u63a7\u5236\u5e73\u9762\u3001\u7ba1\u7406\u63d2\u4ef6\u548c\u5904\u7406\u5de5\u4f5c\u8282\u70b9\u66f4\u65b0\u7684\u80fd\u529b\u3002</li> <li>\u9009\u62e9\u6258\u7ba1\u8282\u70b9\u7ec4\u6216EKS on Fargate - \u901a\u8fc7\u4f7f\u7528EKS\u6258\u7ba1\u8282\u70b9\u7ec4\u6216EKS on Fargate,\u53ef\u4ee5\u7b80\u5316\u548c\u81ea\u52a8\u5316\u5de5\u4f5c\u8282\u70b9\u5347\u7ea7\u3002\u8fd9\u4e9b\u9009\u9879\u53ef\u4ee5\u7b80\u5316\u8be5\u8fc7\u7a0b\u5e76\u51cf\u5c11\u624b\u52a8\u5e72\u9884\u3002</li> <li>\u5229\u7528kubectl Convert\u63d2\u4ef6 - \u5229\u7528kubectl convert\u63d2\u4ef6\u6765\u4fc3\u8fdbKubernetes\u6e05\u5355\u6587\u4ef6\u5728\u4e0d\u540cAPI\u7248\u672c\u4e4b\u95f4\u7684\u8f6c\u6362\u3002\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u786e\u4fdd\u60a8\u7684\u914d\u7f6e\u4e0e\u65b0\u7684Kubernetes\u7248\u672c\u4fdd\u6301\u517c\u5bb9\u3002</li> </ul>"},{"location":"zh/upgrades/#_4","title":"\u4fdd\u6301\u96c6\u7fa4\u7684\u6700\u65b0\u72b6\u6001","text":"<p>\u4fdd\u6301\u4e0eKubernetes\u66f4\u65b0\u540c\u6b65\u5bf9\u4e8e\u5b89\u5168\u9ad8\u6548\u7684EKS\u73af\u5883\u81f3\u5173\u91cd\u8981\uff0c\u8fd9\u53cd\u6620\u4e86Amazon EKS\u4e2d\u7684\u5171\u4eab\u8d23\u4efb\u6a21\u578b\u3002\u901a\u8fc7\u5c06\u8fd9\u4e9b\u7b56\u7565\u96c6\u6210\u5230\u60a8\u7684\u64cd\u4f5c\u5de5\u4f5c\u6d41\u4e2d\uff0c\u60a8\u5c31\u53ef\u4ee5\u4fdd\u6301\u6700\u65b0\u3001\u5b89\u5168\u7684\u96c6\u7fa4\uff0c\u5145\u5206\u5229\u7528\u6700\u65b0\u7684\u529f\u80fd\u548c\u6539\u8fdb\u3002\u7b56\u7565\uff1a</p> <ul> <li>\u652f\u6301\u7248\u672c\u653f\u7b56 - \u4e0eKubernetes\u793e\u533a\u4fdd\u6301\u4e00\u81f4\uff0cAmazon EKS\u901a\u5e38\u63d0\u4f9b\u4e09\u4e2a\u6d3b\u8dc3\u7684Kubernetes\u7248\u672c\uff0c\u540c\u65f6\u6bcf\u5e74\u5f03\u7528\u7b2c\u56db\u4e2a\u7248\u672c\u3002\u5728\u7248\u672c\u5230\u8fbe\u5176\u652f\u6301\u7ec8\u6b62\u65e5\u671f\u524d\u81f3\u5c1160\u5929\uff0c\u5c06\u53d1\u51fa\u5f03\u7528\u901a\u77e5\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605EKS\u7248\u672c\u5e38\u89c1\u95ee\u9898\u89e3\u7b54\u3002</li> <li>\u81ea\u52a8\u5347\u7ea7\u653f\u7b56 - \u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5728EKS\u96c6\u7fa4\u4e2d\u4e0eKubernetes\u66f4\u65b0\u4fdd\u6301\u540c\u6b65\u3002Kubernetes\u793e\u533a\u652f\u6301(\u5305\u62ec\u9519\u8bef\u4fee\u590d\u548c\u5b89\u5168\u8865\u4e01)\u901a\u5e38\u4f1a\u5728\u4e00\u5e74\u540e\u505c\u6b62\u652f\u6301\u65e7\u7248\u672c\u3002\u5f03\u7528\u7684\u7248\u672c\u53ef\u80fd\u4e5f\u7f3a\u4e4f\u6f0f\u6d1e\u62a5\u544a\uff0c\u5b58\u5728\u6f5c\u5728\u98ce\u9669\u3002\u5982\u679c\u672a\u4e3b\u52a8\u5728\u7248\u672c\u751f\u547d\u5468\u671f\u7ed3\u675f\u524d\u8fdb\u884c\u5347\u7ea7\uff0c\u5c06\u4f1a\u89e6\u53d1\u81ea\u52a8\u5347\u7ea7\uff0c\u8fd9\u53ef\u80fd\u4f1a\u4e2d\u65ad\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u548c\u7cfb\u7edf\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605EKS\u7248\u672c\u652f\u6301\u653f\u7b56\u3002</li> <li>\u521b\u5efa\u5347\u7ea7\u8fd0\u884c\u624b\u518c - \u5efa\u7acb\u7ba1\u7406\u5347\u7ea7\u7684\u660e\u786e\u6d41\u7a0b\u3002\u4f5c\u4e3a\u4e3b\u52a8\u65b9\u6cd5\u7684\u4e00\u90e8\u5206\uff0c\u5236\u5b9a\u9002\u5408\u60a8\u5347\u7ea7\u6d41\u7a0b\u7684\u8fd0\u884c\u624b\u518c\u548c\u4e13\u95e8\u5de5\u5177\u3002\u8fd9\u4e0d\u4ec5\u589e\u5f3a\u4e86\u60a8\u7684\u51c6\u5907\u5de5\u4f5c\uff0c\u800c\u4e14\u8fd8\u7b80\u5316\u4e86\u590d\u6742\u7684\u8fc7\u6e21\u3002\u5c06\u81f3\u5c11\u6bcf\u5e74\u5347\u7ea7\u4e00\u6b21\u96c6\u7fa4\u4f5c\u4e3a\u6807\u51c6\u505a\u6cd5\u3002\u8fd9\u79cd\u505a\u6cd5\u4f7f\u60a8\u4e0e\u4e0d\u65ad\u53d1\u5c55\u7684\u6280\u672f\u4fdd\u6301\u4e00\u81f4\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u73af\u5883\u7684\u6548\u7387\u548c\u5b89\u5168\u6027\u3002</li> </ul>"},{"location":"zh/upgrades/#eks","title":"\u67e5\u770bEKS\u53d1\u5e03\u65e5\u5386","text":"<p>\u67e5\u770bEKS Kubernetes\u53d1\u5e03\u65e5\u5386,\u4e86\u89e3\u65b0\u7248\u672c\u7684\u53d1\u5e03\u65f6\u95f4\u4ee5\u53ca\u7279\u5b9a\u7248\u672c\u7684\u652f\u6301\u7ec8\u6b62\u65f6\u95f4\u3002\u901a\u5e38\uff0cEKS\u6bcf\u5e74\u53d1\u5e03\u4e09\u4e2aKubernetes\u5c0f\u7248\u672c\uff0c\u6bcf\u4e2a\u5c0f\u7248\u672c\u7684\u652f\u6301\u671f\u7ea6\u4e3a14\u4e2a\u6708\u3002</p> <p>\u6b64\u5916\uff0c\u8bf7\u67e5\u770b\u4e0a\u6e38Kubernetes\u53d1\u5e03\u4fe1\u606f\u3002</p>"},{"location":"zh/upgrades/#_5","title":"\u4e86\u89e3\u5171\u4eab\u8d23\u4efb\u6a21\u578b\u5982\u4f55\u5e94\u7528\u4e8e\u96c6\u7fa4\u5347\u7ea7","text":"<p>\u60a8\u8d1f\u8d23\u542f\u52a8\u5bf9\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762\u7684\u5347\u7ea7\u3002\u4e86\u89e3\u5982\u4f55\u542f\u52a8\u5347\u7ea7\u3002\u5f53\u60a8\u542f\u52a8\u96c6\u7fa4\u5347\u7ea7\u65f6\uff0cAWS\u8d1f\u8d23\u5347\u7ea7\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u3002\u60a8\u8d1f\u8d23\u5347\u7ea7\u6570\u636e\u5e73\u9762\uff0c\u5305\u62ecFargate pods\u548c\u5176\u4ed6\u63d2\u4ef6\u3002\u60a8\u5fc5\u987b\u9a8c\u8bc1\u548c\u89c4\u5212\u5728\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5347\u7ea7\uff0c\u4ee5\u786e\u4fdd\u5728\u96c6\u7fa4\u5347\u7ea7\u540e\u5b83\u4eec\u7684\u53ef\u7528\u6027\u548c\u64cd\u4f5c\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\u3002</p>"},{"location":"zh/upgrades/#_6","title":"\u5c31\u5730\u5347\u7ea7\u96c6\u7fa4","text":"<p>EKS\u652f\u6301\u5c31\u5730\u96c6\u7fa4\u5347\u7ea7\u7b56\u7565\u3002\u8fd9\u53ef\u4ee5\u4fdd\u7559\u96c6\u7fa4\u8d44\u6e90\uff0c\u5e76\u4fdd\u6301\u96c6\u7fa4\u914d\u7f6e\u7684\u4e00\u81f4\u6027(\u4f8b\u5982\uff0cAPI\u7aef\u70b9\u3001OIDC\u3001ENI\u3001\u8d1f\u8f7d\u5747\u8861\u5668)\u3002\u8fd9\u5bf9\u96c6\u7fa4\u7528\u6237\u7684\u5e72\u6270\u8f83\u5c0f\uff0c\u5e76\u4e14\u5b83\u5c06\u4f7f\u7528\u96c6\u7fa4\u4e2d\u73b0\u6709\u7684\u5de5\u4f5c\u8d1f\u8f7d\u548c\u8d44\u6e90\uff0c\u800c\u65e0\u9700\u60a8\u91cd\u65b0\u90e8\u7f72\u5de5\u4f5c\u8d1f\u8f7d\u6216\u8fc1\u79fb\u5916\u90e8\u8d44\u6e90(\u4f8b\u5982DNS\u3001\u5b58\u50a8)\u3002</p> <p>\u5728\u6267\u884c\u5c31\u5730\u96c6\u7fa4\u5347\u7ea7\u65f6\uff0c\u8bf7\u6ce8\u610f\u4e00\u6b21\u53ea\u80fd\u6267\u884c\u4e00\u4e2a\u5c0f\u7248\u672c\u5347\u7ea7(\u4f8b\u5982\uff0c\u4ece1.24\u5347\u7ea7\u52301.25)\u3002</p> <p>\u8fd9\u610f\u5473\u7740\u5982\u679c\u60a8\u9700\u8981\u66f4\u65b0\u591a\u4e2a\u7248\u672c\uff0c\u5219\u9700\u8981\u8fdb\u884c\u4e00\u7cfb\u5217\u8fde\u7eed\u5347\u7ea7\u3002\u89c4\u5212\u8fde\u7eed\u5347\u7ea7\u66f4\u52a0\u590d\u6742\uff0c\u5e76\u4e14\u5b58\u5728\u66f4\u9ad8\u7684\u505c\u673a\u98ce\u9669\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bc4\u4f30\u84dd/\u7eff\u96c6\u7fa4\u5347\u7ea7\u7b56\u7565\u3002</p>"},{"location":"zh/upgrades/#_7","title":"\u6309\u987a\u5e8f\u5347\u7ea7\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762","text":"<p>\u8981\u5347\u7ea7\u96c6\u7fa4\uff0c\u60a8\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ol> <li>\u67e5\u770bKubernetes\u548cEKS\u53d1\u884c\u8bf4\u660e\u3002</li> <li>\u5907\u4efd\u96c6\u7fa4\u3002(\u53ef\u9009)</li> <li>\u8bc6\u522b\u5e76\u4fee\u590d\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u5df2\u5f03\u7528\u548c\u5df2\u5220\u9664\u7684API\u4f7f\u7528\u60c5\u51b5\u3002</li> <li>\u786e\u4fdd\u4f7f\u7528\u7684\u6258\u7ba1\u8282\u70b9\u7ec4(\u5982\u679c\u6709)\u4e0e\u63a7\u5236\u5e73\u9762\u8fd0\u884c\u76f8\u540c\u7684Kubernetes\u7248\u672c\u3002EKS\u6258\u7ba1\u8282\u70b9\u7ec4\u548c\u7531EKS Fargate\u914d\u7f6e\u6587\u4ef6\u521b\u5efa\u7684\u8282\u70b9\u4ec5\u652f\u6301\u63a7\u5236\u5e73\u9762\u548c\u6570\u636e\u5e73\u9762\u4e4b\u95f4\u76841\u4e2a\u5c0f\u7248\u672c\u504f\u5dee\u3002</li> <li>\u4f7f\u7528AWS\u63a7\u5236\u53f0\u6216cli\u5347\u7ea7\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u3002</li> <li>\u67e5\u770b\u63d2\u4ef6\u517c\u5bb9\u6027\u3002\u6839\u636e\u9700\u8981\u5347\u7ea7\u60a8\u7684Kubernetes\u63d2\u4ef6\u548c\u81ea\u5b9a\u4e49\u63a7\u5236\u5668\u3002</li> <li>\u66f4\u65b0kubectl\u3002</li> <li>\u5347\u7ea7\u96c6\u7fa4\u6570\u636e\u5e73\u9762\u3002\u5c06\u60a8\u7684\u8282\u70b9\u5347\u7ea7\u5230\u4e0e\u5347\u7ea7\u540e\u7684\u96c6\u7fa4\u76f8\u540c\u7684Kubernetes\u5c0f\u7248\u672c\u3002</li> </ol>"},{"location":"zh/upgrades/#eks_1","title":"\u4f7f\u7528EKS\u6587\u6863\u521b\u5efa\u5347\u7ea7\u6e05\u5355","text":"<p>EKS Kubernetes\u7248\u672c\u6587\u6863\u5305\u62ec\u6bcf\u4e2a\u7248\u672c\u7684\u8be6\u7ec6\u66f4\u6539\u5217\u8868\u3002\u4e3a\u6bcf\u6b21\u5347\u7ea7\u6784\u5efa\u6e05\u5355\u3002</p> <p>\u5bf9\u4e8e\u7279\u5b9a\u7684EKS\u7248\u672c\u5347\u7ea7\u6307\u5357\uff0c\u8bf7\u67e5\u770b\u6bcf\u4e2a\u7248\u672c\u7684\u6587\u6863\uff0c\u4e86\u89e3\u503c\u5f97\u6ce8\u610f\u7684\u53d8\u66f4\u548c\u6ce8\u610f\u4e8b\u9879\u3002</p> <ul> <li>EKS 1.27</li> <li>EKS 1.26</li> <li>EKS 1.25</li> <li>EKS 1.24</li> <li>EKS 1.23</li> <li>EKS 1.22</li> </ul>"},{"location":"zh/upgrades/#kubernetes-api","title":"\u4f7f\u7528Kubernetes API\u5347\u7ea7\u63d2\u4ef6\u548c\u7ec4\u4ef6","text":"<p>\u5728\u5347\u7ea7\u96c6\u7fa4\u4e4b\u524d\uff0c\u60a8\u5e94\u8be5\u4e86\u89e3\u60a8\u6b63\u5728\u4f7f\u7528\u7684Kubernetes\u7ec4\u4ef6\u7248\u672c\u3002\u5217\u51fa\u96c6\u7fa4\u7ec4\u4ef6\uff0c\u5e76\u8bc6\u522b\u76f4\u63a5\u4f7f\u7528Kubernetes API\u7684\u7ec4\u4ef6\u3002\u8fd9\u5305\u62ec\u5173\u952e\u96c6\u7fa4\u7ec4\u4ef6\uff0c\u5982\u76d1\u63a7\u548c\u65e5\u5fd7\u8bb0\u5f55\u4ee3\u7406\u3001\u96c6\u7fa4\u81ea\u52a8\u6269\u7f29\u5668\u3001\u5bb9\u5668\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f(\u4f8b\u5982EBS CSI\u3001EFS CSI)\u3001Ingress\u63a7\u5236\u5668\u4ee5\u53ca\u4efb\u4f55\u5176\u4ed6\u76f4\u63a5\u4f9d\u8d56Kubernetes API\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6216\u63d2\u4ef6\u3002</p> <p>\u63d0\u793a</p> <p>\u5173\u952e\u96c6\u7fa4\u7ec4\u4ef6\u901a\u5e38\u5b89\u88c5\u5728<code>*-system</code>\u547d\u540d\u7a7a\u95f4\u4e2d</p> <pre><code>kubectl get ns | grep '-system'\n</code></pre> <p>\u4e00\u65e6\u8bc6\u522b\u51fa\u4f9d\u8d56Kubernetes API\u7684\u7ec4\u4ef6\uff0c\u8bf7\u67e5\u770b\u5176\u6587\u6863\u4ee5\u4e86\u89e3\u7248\u672c\u517c\u5bb9\u6027\u548c\u5347\u7ea7\u8981\u6c42\u3002\u4f8b\u5982\uff0c\u8bf7\u53c2\u9605AWS Load Balancer Controller\u6587\u6863\u4ee5\u4e86\u89e3\u7248\u672c\u517c\u5bb9\u6027\u3002\u5728\u7ee7\u7eed\u96c6\u7fa4\u5347\u7ea7\u4e4b\u524d\uff0c\u53ef\u80fd\u9700\u8981\u5347\u7ea7\u6216\u66f4\u6539\u67d0\u4e9b\u7ec4\u4ef6\u7684\u914d\u7f6e\u3002\u9700\u8981\u68c0\u67e5\u7684\u4e00\u4e9b\u5173\u952e\u7ec4\u4ef6\u5305\u62ecCoreDNS\u3001kube-proxy\u3001VPC CNI\u548c\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f\u3002</p> <p>\u96c6\u7fa4\u901a\u5e38\u5305\u542b\u8bb8\u591a\u4f7f\u7528Kubernetes API\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u5bf9\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u529f\u80fd(\u5982Ingress\u63a7\u5236\u5668\u3001\u6301\u7eed\u4ea4\u4ed8\u7cfb\u7edf\u548c\u76d1\u63a7\u5de5\u5177)\u662f\u5fc5\u9700\u7684\u3002\u5f53\u60a8\u5347\u7ea7EKS\u96c6\u7fa4\u65f6\uff0c\u60a8\u8fd8\u5fc5\u987b\u5347\u7ea7\u60a8\u7684\u63d2\u4ef6\u548c\u7b2c\u4e09\u65b9\u5de5\u5177\uff0c\u4ee5\u786e\u4fdd\u5b83\u4eec\u4e0e\u65b0\u7248\u672c\u517c\u5bb9\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u63d2\u4ef6\u53ca\u5176\u76f8\u5173\u5347\u7ea7\u6587\u6863\u7684\u793a\u4f8b\uff1a</p> <ul> <li>Amazon VPC CNI: \u6709\u5173\u6bcf\u4e2a\u96c6\u7fa4\u7248\u672c\u63a8\u8350\u7684Amazon VPC CNI\u63d2\u4ef6\u7248\u672c\uff0c\u8bf7\u53c2\u9605\u66f4\u65b0Kubernetes\u81ea\u7ba1\u7406\u63d2\u4ef6\u7684Amazon VPC CNI\u63d2\u4ef6\u3002\u5f53\u4f5c\u4e3aAmazon EKS\u63d2\u4ef6\u5b89\u88c5\u65f6\uff0c\u5b83\u53ea\u80fd\u4e00\u6b21\u5347\u7ea7\u4e00\u4e2a\u5c0f\u7248\u672c\u3002</li> <li>kube-proxy: \u8bf7\u53c2\u9605\u66f4\u65b0Kubernetes kube-proxy\u81ea\u7ba1\u7406\u63d2\u4ef6\u3002</li> <li>CoreDNS: \u8bf7\u53c2\u9605\u66f4\u65b0CoreDNS\u81ea\u7ba1\u7406\u63d2\u4ef6\u3002</li> <li>AWS Load Balancer Controller: AWS Load Balancer Controller\u9700\u8981\u4e0e\u60a8\u90e8\u7f72\u7684EKS\u7248\u672c\u517c\u5bb9\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u5b89\u88c5\u6307\u5357\u3002</li> <li>Amazon Elastic Block Store (Amazon EBS) Container Storage Interface (CSI) \u9a71\u52a8\u7a0b\u5e8f\uff1a \u6709\u5173\u5b89\u88c5\u548c\u5347\u7ea7\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4f5c\u4e3aAmazon EKS\u63d2\u4ef6\u7ba1\u7406Amazon EBS CSI\u9a71\u52a8\u7a0b\u5e8f\u3002</li> <li>Amazon Elastic File System (Amazon EFS) Container Storage Interface (CSI) \u9a71\u52a8\u7a0b\u5e8f\uff1a \u6709\u5173\u5b89\u88c5\u548c\u5347\u7ea7\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605Amazon EFS CSI\u9a71\u52a8\u7a0b\u5e8f\u3002</li> <li>Kubernetes Metrics Server: \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605GitHub\u4e0a\u7684metrics-server\u3002</li> <li>Kubernetes Cluster Autoscaler: \u8981\u5347\u7ea7Kubernetes Cluster Autoscaler\u7684\u7248\u672c\uff0c\u8bf7\u5728\u90e8\u7f72\u4e2d\u66f4\u6539\u955c\u50cf\u7684\u7248\u672c\u3002Cluster Autoscaler\u4e0eKubernetes\u8c03\u5ea6\u7a0b\u5e8f\u7d27\u5bc6\u8026\u5408\u3002\u60a8\u9700\u8981\u5728\u5347\u7ea7\u96c6\u7fa4\u65f6\u59cb\u7ec8\u5347\u7ea7\u5b83\u3002\u67e5\u770bGitHub\u53d1\u884c\u7248,\u627e\u5230\u4e0e\u60a8\u7684Kubernetes\u5c0f\u7248\u672c\u5bf9\u5e94\u7684\u6700\u65b0\u53d1\u884c\u7248\u5730\u5740\u3002</li> <li>Karpenter: \u6709\u5173\u5b89\u88c5\u548c\u5347\u7ea7\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605Karpenter\u6587\u6863\u3002</li> </ul>"},{"location":"zh/upgrades/#eks_2","title":"\u5728\u5347\u7ea7\u524d\u9a8c\u8bc1\u57fa\u672c\u7684EKS\u8981\u6c42","text":"<p>AWS\u8981\u6c42\u60a8\u7684\u8d26\u6237\u4e2d\u5177\u6709\u67d0\u4e9b\u8d44\u6e90\uff0c\u4ee5\u5b8c\u6210\u5347\u7ea7\u8fc7\u7a0b\u3002\u5982\u679c\u8fd9\u4e9b\u8d44\u6e90\u4e0d\u5b58\u5728\uff0c\u5219\u65e0\u6cd5\u5347\u7ea7\u96c6\u7fa4\u3002\u63a7\u5236\u5e73\u9762\u5347\u7ea7\u9700\u8981\u4ee5\u4e0b\u8d44\u6e90\uff1a</p> <ol> <li>\u53ef\u7528IP\u5730\u5740\uff1aAmazon EKS\u9700\u8981\u60a8\u5728\u521b\u5efa\u96c6\u7fa4\u65f6\u6307\u5b9a\u7684\u5b50\u7f51\u4e2d\u6700\u591a5\u4e2a\u53ef\u7528IP\u5730\u5740\uff0c\u4ee5\u4fbf\u66f4\u65b0\u96c6\u7fa4\u3002\u5982\u679c\u6ca1\u6709\uff0c\u8bf7\u5728\u6267\u884c\u7248\u672c\u66f4\u65b0\u4e4b\u524d\u66f4\u65b0\u96c6\u7fa4\u914d\u7f6e\u4ee5\u5305\u542b\u65b0\u7684\u96c6\u7fa4\u5b50\u7f51\u3002</li> <li>EKS IAM\u89d2\u8272\uff1a\u63a7\u5236\u5e73\u9762IAM\u89d2\u8272\u4ecd\u5b58\u5728\u4e8e\u8d26\u6237\u4e2d\uff0c\u5e76\u5177\u6709\u5fc5\u8981\u7684\u6743\u9650\u3002</li> <li>\u5982\u679c\u60a8\u7684\u96c6\u7fa4\u542f\u7528\u4e86\u5bc6\u94a5\u52a0\u5bc6\uff0c\u8bf7\u786e\u4fdd\u96c6\u7fa4IAM\u89d2\u8272\u5177\u6709\u4f7f\u7528AWS Key Management Service (AWS KMS)\u5bc6\u94a5\u7684\u6743\u9650\u3002</li> </ol>"},{"location":"zh/upgrades/#ip","title":"\u9a8c\u8bc1\u53ef\u7528IP\u5730\u5740","text":"<p>\u8981\u66f4\u65b0\u96c6\u7fa4\uff0cAmazon EKS\u9700\u8981\u60a8\u5728\u521b\u5efa\u96c6\u7fa4\u65f6\u6307\u5b9a\u7684\u5b50\u7f51\u4e2d\u6700\u591a5\u4e2a\u53ef\u7528IP\u5730\u5740\u3002</p> <p>\u8981\u9a8c\u8bc1\u60a8\u7684\u5b50\u7f51\u662f\u5426\u6709\u8db3\u591f\u7684IP\u5730\u5740\u6765\u5347\u7ea7\u96c6\u7fa4\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>CLUSTER=&lt;cluster name&gt;\naws ec2 describe-subnets --subnet-ids \\\n  $(aws eks describe-cluster --name ${CLUSTER} \\\n  --query 'cluster.resourcesVpcConfig.subnetIds' \\\n  --output text) \\\n  --query 'Subnets[*].[SubnetId,AvailabilityZone,AvailableIpAddressCount]' \\\n  --output table\n\n----------------------------------------------------\n|                  DescribeSubnets                 |\n+---------------------------+--------------+-------+\n|  subnet-067fa8ee8476abbd6 |  us-east-1a  |  8184 |\n|  subnet-0056f7403b17d2b43 |  us-east-1b  |  8153 |\n|  subnet-09586f8fb3addbc8c |  us-east-1a  |  8120 |\n|  subnet-047f3d276a22c6bce |  us-east-1b  |  8184 |\n+---------------------------+--------------+-------+\n</code></pre> <p>VPC CNI Metrics Helper\u53ef\u7528\u4e8e\u4e3aVPC\u6307\u6807\u521b\u5efaCloudWatch\u4eea\u8868\u677f\u3002 \u5982\u679c\u60a8\u5728\u6700\u521d\u521b\u5efa\u96c6\u7fa4\u65f6\u6307\u5b9a\u7684\u5b50\u7f51\u4e2d\u7684IP\u5730\u5740\u7528\u5c3d\uff0cAmazon EKS\u5efa\u8bae\u5728\u5f00\u59cbKubernetes\u7248\u672c\u5347\u7ea7\u4e4b\u524d\u4f7f\u7528\"UpdateClusterConfiguration\"API\u66f4\u65b0\u96c6\u7fa4\u5b50\u7f51\u3002\u8bf7\u9a8c\u8bc1\u60a8\u5c06\u63d0\u4f9b\u7684\u65b0\u5b50\u7f51\uff1a</p> <ul> <li>\u5c5e\u4e8e\u96c6\u7fa4\u521b\u5efa\u671f\u95f4\u9009\u62e9\u7684\u76f8\u540c\u4e00\u7ec4\u53ef\u7528\u533a\u3002</li> <li>\u5c5e\u4e8e\u96c6\u7fa4\u521b\u5efa\u671f\u95f4\u63d0\u4f9b\u7684\u76f8\u540cVPC</li> </ul> <p>\u8bf7\u8003\u8651\u5c06\u989d\u5916\u7684CIDR\u5757\u4e0e\u73b0\u6709\u7684\u96c6\u7fa4VPC\u5173\u8054\uff0c\u4ece\u800c\u6709\u6548\u6269\u5c55\u60a8\u7684IP\u5730\u5740\u6c60\u3002AWS\u5141\u8bb8\u5c06\u989d\u5916\u7684CIDR\u5757\u4e0e\u73b0\u6709\u96c6\u7fa4VPC\u5173\u8054\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5f15\u5165\u989d\u5916\u7684\u79c1\u6709IP\u8303\u56f4(RFC 1918)\u6216(\u5982\u679c\u5fc5\u8981)\u516c\u5171IP\u8303\u56f4(\u975eRFC 1918)\u6765\u5b9e\u73b0\u3002\u60a8\u5fc5\u987b\u6dfb\u52a0\u65b0\u7684VPC CIDR\u5757\u5e76\u5141\u8bb8VPC\u5237\u65b0\u5b8c\u6210\uff0c\u7136\u540eAmazon EKS\u624d\u80fd\u4f7f\u7528\u65b0\u7684CIDR\u3002\u4e4b\u540e\uff0c\u60a8\u53ef\u4ee5\u6839\u636e\u65b0\u8bbe\u7f6e\u7684CIDR\u5757\u66f4\u65b0\u5b50\u7f51\u3002</p>"},{"location":"zh/upgrades/#eks-iam","title":"\u9a8c\u8bc1EKS IAM\u89d2\u8272","text":"<p>\u8981\u9a8c\u8bc1IAM\u89d2\u8272\u5728\u60a8\u7684\u8d26\u6237\u4e2d\u53ef\u7528\u5e76\u5177\u6709\u6b63\u786e\u7684assume role\u7b56\u7565\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>CLUSTER=&lt;cluster name&gt;\nROLE_ARN=$(aws eks describe-cluster --name ${CLUSTER} \\\n  --query 'cluster.roleArn' --output text)\naws iam get-role --role-name ${ROLE_ARN##*/} \\\n  --query 'Role.AssumeRolePolicyDocument'\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"eks.amazonaws.com\"\n            },\n            \"Action\": \"sts:AssumeRole\"\n        }\n    ]\n}\n</code></pre>"},{"location":"zh/upgrades/#eks_3","title":"\u8fc1\u79fb\u5230EKS\u63d2\u4ef6","text":"<p>Amazon EKS\u4f1a\u4e3a\u6bcf\u4e2a\u96c6\u7fa4\u81ea\u52a8\u5b89\u88c5\u63d2\u4ef6\uff0c\u5982Amazon VPC CNI\u63d2\u4ef6for Kubernetes\u3001<code>kube-proxy</code>\u548cCoreDNS\u3002\u63d2\u4ef6\u53ef\u4ee5\u662f\u81ea\u7ba1\u7406\u7684\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3aAmazon EKS\u63d2\u4ef6\u5b89\u88c5\u3002Amazon EKS\u63d2\u4ef6\u662f\u4f7f\u7528EKS API\u7ba1\u7406\u63d2\u4ef6\u7684\u53e6\u4e00\u79cd\u65b9\u5f0f\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528Amazon EKS\u63d2\u4ef6\u901a\u8fc7\u5355\u4e2a\u547d\u4ee4\u66f4\u65b0\u7248\u672c\u3002\u4f8b\u5982\uff1a</p> <pre><code>aws eks update-addon \u2014cluster-name my-cluster \u2014addon-name vpc-cni \u2014addon-version version-number \\\n--service-account-role-arn arn:aws:iam::111122223333:role/role-name \u2014configuration-values '{}' \u2014resolve-conflicts PRESERVE\n</code></pre> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u68c0\u67e5\u662f\u5426\u6709\u4efb\u4f55EKS\u63d2\u4ef6\uff1a</p> <pre><code>aws eks list-addons --cluster-name &lt;cluster name&gt;\n</code></pre> <p>\u8b66\u544a</p> <p>\u5728\u63a7\u5236\u5e73\u9762\u5347\u7ea7\u671f\u95f4\uff0cEKS\u63d2\u4ef6\u4e0d\u4f1a\u81ea\u52a8\u5347\u7ea7\u3002\u60a8\u5fc5\u987b\u542f\u52a8EKS\u63d2\u4ef6\u66f4\u65b0\uff0c\u5e76\u9009\u62e9\u6240\u9700\u7684\u7248\u672c\u3002</p> <ul> <li>\u60a8\u8d1f\u8d23\u4ece\u6240\u6709\u53ef\u7528\u7248\u672c\u4e2d\u9009\u62e9\u517c\u5bb9\u7248\u672c\u3002\u67e5\u770b\u6709\u5173\u63d2\u4ef6\u7248\u672c\u517c\u5bb9\u6027\u7684\u6307\u5bfc\u3002</li> <li>Amazon EKS\u63d2\u4ef6\u53ea\u80fd\u4e00\u6b21\u5347\u7ea7\u4e00\u4e2a\u5c0f\u7248\u672c\u3002</li> </ul> <p>\u4e86\u89e3\u6709\u5173\u54ea\u4e9b\u7ec4\u4ef6\u53ef\u4f5c\u4e3aEKS\u63d2\u4ef6\u4ee5\u53ca\u5982\u4f55\u5165\u95e8\u7684\u66f4\u591a\u4fe1\u606f\u3002</p> <p>\u4e86\u89e3\u5982\u4f55\u4e3aEKS\u63d2\u4ef6\u63d0\u4f9b\u81ea\u5b9a\u4e49\u914d\u7f6e\u3002</p>"},{"location":"zh/upgrades/#api","title":"\u5728\u5347\u7ea7\u63a7\u5236\u5e73\u9762\u4e4b\u524d\u8bc6\u522b\u5e76\u4fee\u590d\u5df2\u5220\u9664\u7684API\u4f7f\u7528\u60c5\u51b5","text":"<p>\u5728\u5347\u7ea7EKS\u63a7\u5236\u5e73\u9762\u4e4b\u524d\uff0c\u60a8\u5e94\u8be5\u8bc6\u522b\u5df2\u5220\u9664API\u7684\u4f7f\u7528\u60c5\u51b5\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u53ef\u4ee5\u68c0\u67e5\u6b63\u5728\u8fd0\u884c\u7684\u96c6\u7fa4\u6216\u9759\u6001\u6e32\u67d3\u7684Kubernetes\u6e05\u5355\u6587\u4ef6\u7684\u5de5\u5177\u3002</p> <p>\u5bf9\u9759\u6001\u6e05\u5355\u6587\u4ef6\u8fdb\u884c\u626b\u63cf\u901a\u5e38\u66f4\u52a0\u51c6\u786e\u3002\u5982\u679c\u9488\u5bf9\u5b9e\u65f6\u96c6\u7fa4\u8fd0\u884c\uff0c\u8fd9\u4e9b\u5de5\u5177\u53ef\u80fd\u4f1a\u8fd4\u56de\u8bef\u62a5\u3002</p> <p>Kubernetes\u5f03\u7528\u7684API\u5e76\u4e0d\u610f\u5473\u7740\u8be5API\u5df2\u88ab\u5220\u9664\u3002\u60a8\u5e94\u8be5\u67e5\u770bKubernetes\u5f03\u7528\u653f\u7b56\u4ee5\u4e86\u89e3API\u5220\u9664\u5bf9\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5f71\u54cd\u3002</p>"},{"location":"zh/upgrades/#cluster-insights","title":"Cluster Insights","text":"<p>Cluster Insights\u662f\u4e00\u9879\u529f\u80fd\uff0c\u53ef\u63d0\u4f9b\u6709\u5173\u53ef\u80fd\u5f71\u54cd\u5347\u7ea7EKS\u96c6\u7fa4\u5230\u66f4\u65b0\u7248\u672c\u7684Kubernetes\u7684\u95ee\u9898\u7684\u53d1\u73b0\u3002\u8fd9\u4e9b\u53d1\u73b0\u7531Amazon EKS\u7b56\u5212\u548c\u7ba1\u7406\uff0c\u5e76\u63d0\u4f9b\u4e86\u5982\u4f55\u4fee\u590d\u5b83\u4eec\u7684\u5efa\u8bae\u3002\u901a\u8fc7\u5229\u7528Cluster Insights\uff0c\u60a8\u53ef\u4ee5\u6700\u5c0f\u5316\u5347\u7ea7\u5230\u66f4\u65b0\u7684Kubernetes\u7248\u672c\u6240\u9700\u7684\u5de5\u4f5c\u91cf\u3002</p> <p>\u8981\u67e5\u770bEKS\u96c6\u7fa4\u7684\u89c1\u89e3\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a <pre><code>aws eks list-insights --region &lt;region-code&gt; --cluster-name &lt;my-cluster&gt;\n\n{\n    \"insights\": [\n        {\n            \"category\": \"UPGRADE_READINESS\", \n            \"name\": \"Deprecated APIs removed in Kubernetes v1.29\", \n            \"insightStatus\": {\n                \"status\": \"PASSING\", \n                \"reason\": \"No deprecated API usage detected within the last 30 days.\"\n            }, \n            \"kubernetesVersion\": \"1.29\", \n            \"lastTransitionTime\": 1698774710.0, \n            \"lastRefreshTime\": 1700157422.0, \n            \"id\": \"123e4567-e89b-42d3-a456-579642341238\", \n            \"description\": \"Checks for usage of deprecated APIs that are scheduled for removal in Kubernetes v1.29. Upgrading your cluster before migrating to the updated APIs supported by v1.29 could cause application impact.\"\n        }\n    ]\n}\n</code></pre></p> <p>\u8981\u83b7\u53d6\u6536\u5230\u7684\u89c1\u89e3\u7684\u66f4\u591a\u63cf\u8ff0\u6027\u8f93\u51fa\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a <pre><code>aws eks describe-insight --region &lt;region-code&gt; --id &lt;insight-id&gt; --cluster-name &lt;my-cluster&gt;\n</code></pre></p> <p>\u60a8\u4e5f\u53ef\u4ee5\u5728Amazon EKS\u63a7\u5236\u53f0\u4e2d\u67e5\u770b\u89c1\u89e3\u3002\u4ece\u96c6\u7fa4\u5217\u8868\u4e2d\u9009\u62e9\u60a8\u7684\u96c6\u7fa4\u540e\uff0c\u89c1\u89e3\u53d1\u73b0\u4f4d\u4e8e<code>Upgrade Insights</code>\u9009\u9879\u5361\u4e0b\u3002</p> <p>\u5982\u679c\u60a8\u53d1\u73b0\u96c6\u7fa4\u89c1\u89e3\u7684<code>\"status\": ERROR</code>,\u5219\u5fc5\u987b\u5728\u6267\u884c\u96c6\u7fa4\u5347\u7ea7\u4e4b\u524d\u89e3\u51b3\u8be5\u95ee\u9898\u3002\u8fd0\u884c<code>aws eks describe-insight</code>\u547d\u4ee4\uff0c\u5b83\u5c06\u5206\u4eab\u4ee5\u4e0b\u4fee\u590d\u5efa\u8bae\uff1a</p> <p>\u53d7\u5f71\u54cd\u7684\u8d44\u6e90\uff1a <pre><code>\"resources\": [\n      {\n        \"insightStatus\": {\n          \"status\": \"ERROR\"\n        },\n        \"kubernetesResourceUri\": \"/apis/policy/v1beta1/podsecuritypolicies/null\"\n      }\n]\n</code></pre></p> <p>\u5df2\u5f03\u7528\u7684API\uff1a <pre><code>\"deprecationDetails\": [\n      {\n        \"usage\": \"/apis/flowcontrol.apiserver.k8s.io/v1beta2/flowschemas\", \n        \"replacedWith\": \"/apis/flowcontrol.apiserver.k8s.io/v1beta3/flowschemas\", \n        \"stopServingVersion\": \"1.29\", \n        \"clientStats\": [], \n        \"startServingReplacementVersion\": \"1.26\"\n      }\n]\n</code></pre></p> <p>\u5efa\u8bae\u91c7\u53d6\u7684\u884c\u52a8\uff1a <pre><code>\"recommendation\": \"Update manifests and API clients to use newer Kubernetes APIs if applicable before upgrading to Kubernetes v1.26.\"\n</code></pre></p> <p>\u5229\u7528EKS\u63a7\u5236\u53f0\u6216CLI\u4e2d\u7684\u96c6\u7fa4\u89c1\u89e3\u53ef\u52a0\u5feb\u6210\u529f\u5347\u7ea7EKS\u96c6\u7fa4\u7248\u672c\u7684\u8fc7\u7a0b\u3002\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u7684\u8d44\u6e90\uff1a * \u5b98\u65b9EKS\u6587\u6863 * Cluster Insights\u53d1\u5e03\u535a\u5ba2\u3002</p>"},{"location":"zh/upgrades/#kube-no-trouble","title":"Kube-no-trouble","text":"<p>Kube-no-trouble\u662f\u4e00\u4e2a\u5f00\u6e90\u547d\u4ee4\u884c\u5b9e\u7528\u7a0b\u5e8f\uff0c\u5e26\u6709\u547d\u4ee4<code>kubent</code>\u3002\u5f53\u60a8\u5728\u6ca1\u6709\u4efb\u4f55\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c<code>kubent</code>\u65f6\uff0c\u5b83\u5c06\u4f7f\u7528\u60a8\u5f53\u524d\u7684KubeConfig\u4e0a\u4e0b\u6587\u5e76\u626b\u63cf\u96c6\u7fa4\uff0c\u5e76\u6253\u5370\u51fa\u54ea\u4e9bAPI\u5c06\u88ab\u5f03\u7528\u548c\u5220\u9664\u7684\u62a5\u544a\u3002</p> <pre><code>kubent\n\n4:17PM INF &gt;&gt;&gt; Kube No Trouble `kubent` &lt;&lt;&lt;\n4:17PM INF version 0.7.0 (git sha d1bb4e5fd6550b533b2013671aa8419d923ee042)\n4:17PM INF Initializing collectors and retrieving data\n4:17PM INF Target K8s version is 1.24.8-eks-ffeb93d\n4:l INF Retrieved 93 resources from collector name=Cluster\n4:17PM INF Retrieved 16 resources from collector name=\"Helm v3\"\n4:17PM INF Loaded ruleset name=custom.rego.tmpl\n4:17PM INF Loaded ruleset name=deprecated-1-16.rego\n4:17PM INF Loaded ruleset name=deprecated-1-22.rego\n4:17PM INF Loaded ruleset name=deprecated-1-25.rego\n4:17PM INF Loaded ruleset name=deprecated-1-26.rego\n4:17PM INF Loaded ruleset name=deprecated-future.rego\n__________________________________________________________________________________________\n&gt;&gt;&gt; Deprecated APIs removed in 1.25 &lt;&lt;&lt;\n------------------------------------------------------------------------------------------\nKIND                NAMESPACE     NAME             API_VERSION      REPLACE_WITH (SINCE)\nPodSecurityPolicy   &lt;undefined&gt;   eks.privileged   policy/v1beta1   &lt;removed&gt; (1.21.0)\n</code></pre> <p>\u5b83\u8fd8\u53ef\u7528\u4e8e\u626b\u63cf\u9759\u6001\u6e05\u5355\u6587\u4ef6\u548cHelm\u5305\u3002\u5efa\u8bae\u5c06<code>kubent</code>\u4f5c\u4e3a\u6301\u7eed\u96c6\u6210(CI)\u8fc7\u7a0b\u7684\u4e00\u90e8\u5206\u8fd0\u884c\uff0c\u4ee5\u5728\u90e8\u7f72\u6e05\u5355\u4e4b\u524d\u8bc6\u522b\u95ee\u9898\u3002\u626b\u63cf\u6e05\u5355\u4e5f\u6bd4\u626b\u63cf\u5b9e\u65f6\u96c6\u7fa4\u66f4\u52a0\u51c6\u786e\u3002</p> <p>Kube-no-trouble\u63d0\u4f9b\u4e86\u4e00\u4e2a\u793a\u4f8b\u670d\u52a1\u8d26\u6237\u548c\u89d2\u8272,\u5177\u6709\u626b\u63cf\u96c6\u7fa4\u7684\u9002\u5f53\u6743\u9650\u3002</p>"},{"location":"zh/upgrades/#pluto","title":"Pluto","text":"<p>\u53e6\u4e00\u4e2a\u9009\u62e9\u662fpluto,\u5b83\u7c7b\u4f3c\u4e8e<code>kubent</code>,\u56e0\u4e3a\u5b83\u652f\u6301\u626b\u63cf\u5b9e\u65f6\u96c6\u7fa4\u3001\u6e05\u5355\u6587\u4ef6\u3001Helm\u56fe\u8868\uff0c\u5e76\u4e14\u60a8\u53ef\u4ee5\u5728CI\u8fc7\u7a0b\u4e2d\u5305\u542bGitHub Action\u3002</p> <pre><code>pluto detect-all-in-cluster\n\nNAME             KIND                VERSION          REPLACEMENT   REMOVED   DEPRECATED   REPL AVAIL  \neks.privileged   PodSecurityPolicy   policy/v1beta1                 false     true         true\n</code></pre>"},{"location":"zh/upgrades/#_8","title":"\u8d44\u6e90","text":"<p>\u8981\u5728\u5347\u7ea7EKS\u63a7\u5236\u5e73\u9762\u4e4b\u524d\u9a8c\u8bc1\u60a8\u7684\u96c6\u7fa4\u4e0d\u4f7f\u7528\u5df2\u5f03\u7528\u7684API\uff0c\u60a8\u5e94\u8be5\u76d1\u63a7\uff1a</p> <ul> <li>\u81eaKubernetes v1.19\u8d77\u7684\u6307\u6807<code>apiserver_requested_deprecated_apis</code>:</li> </ul> <pre><code>kubectl get --raw /metrics | grep apiserver_requested_deprecated_apis\n\napiserver_requested_deprecated_apis{group=\"policy\",removed_release=\"1.25\",resource=\"podsecuritypolicies\",subresource=\"\",version=\"v1beta1\"} 1\n</code></pre> <ul> <li>\u5ba1\u8ba1\u65e5\u5fd7\u4e2d<code>k8s.io/deprecated</code>\u8bbe\u7f6e\u4e3a<code>true</code>\u7684\u4e8b\u4ef6\uff1a</li> </ul> <pre><code>CLUSTER=\"&lt;cluster_name&gt;\"\nQUERY_ID=$(aws logs start-query \\\n --log-group-name /aws/eks/${CLUSTER}/cluster \\\n --start-time $(date -u --date=\"-30 minutes\" \"+%s\") # or date -v-30M \"+%s\" on MacOS \\\n --end-time $(date \"+%s\") \\\n --query-string 'fields @message | filter `annotations.k8s.io/deprecated`=\"true\"' \\\n --query queryId --output text)\n\necho \"Query started (query id: $QUERY_ID), please hold ...\" &amp;&amp; sleep 5 # give it some time to query\n\naws logs get-query-results --query-id $QUERY_ID\n</code></pre> <p>\u5982\u679c\u4f7f\u7528\u4e86\u5df2\u5f03\u7528\u7684API\uff0c\u5c06\u8f93\u51fa\u4ee5\u4e0b\u884c\uff1a</p> <pre><code>{\n    \"results\": [\n        [\n            {\n                \"field\": \"@message\",\n                \"value\": \"{\\\"kind\\\":\\\"Event\\\",\\\"apiVersion\\\":\\\"audit.k8s.io/v1\\\",\\\"level\\\":\\\"Request\\\",\\\"auditID\\\":\\\"8f7883c6-b3d5-42d7-967a-1121c6f22f01\\\",\\\"stage\\\":\\\"ResponseComplete\\\",\\\"requestURI\\\":\\\"/apis/policy/v1beta1/podsecuritypolicies?allowWatchBookmarks=true\\\\u0026resourceVersion=4131\\\\u0026timeout=9m19s\\\\u0026timeoutSeconds=559\\\\u0026watch=true\\\",\\\"verb\\\":\\\"watch\\\",\\\"user\\\":{\\\"username\\\":\\\"system:apiserver\\\",\\\"uid\\\":\\\"8aabfade-da52-47da-83b4-46b16cab30fa\\\",\\\"groups\\\":[\\\"system:masters\\\"]},\\\"sourceIPs\\\":[\\\"::1\\\"],\\\"userAgent\\\":\\\"kube-apiserver/v1.24.16 (linux/amd64) kubernetes/af930c1\\\",\\\"objectRef\\\":{\\\"resource\\\":\\\"podsecuritypolicies\\\",\\\"apiGroup\\\":\\\"policy\\\",\\\"apiVersion\\\":\\\"v1beta1\\\"},\\\"responseStatus\\\":{\\\"metadata\\\":{},\\\"code\\\":200},\\\"requestReceivedTimestamp\\\":\\\"2023-10-04T12:36:11.849075Z\\\",\\\"stageTimestamp\\\":\\\"2023-10-04T12:45:30.850483Z\\\",\\\"annotations\\\":{\\\"authorization.k8s.io/decision\\\":\\\"allow\\\",\\\"authorization.k8s.io/reason\\\":\\\"\\\",\\\"k8s.io/deprecated\\\":\\\"true\\\",\\\"k8s.io/removed-release\\\":\\\"1.25\\\"}}\"\n            },\n[...]\n</code></pre>"},{"location":"zh/upgrades/#kubectl-convertkubernetes","title":"\u4f7f\u7528kubectl-convert\u66f4\u65b0Kubernetes\u5de5\u4f5c\u8d1f\u8f7d\u3002\u66f4\u65b0\u6e05\u5355","text":"<p>\u5728\u8bc6\u522b\u9700\u8981\u66f4\u65b0\u7684\u5de5\u4f5c\u8d1f\u8f7d\u548c\u6e05\u5355\u540e\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5728\u6e05\u5355\u6587\u4ef6\u4e2d\u66f4\u6539\u8d44\u6e90\u7c7b\u578b(\u4f8b\u5982\uff0c\u4ecePodSecurityPolicies\u66f4\u6539\u4e3aPodSecurityStandards)\u3002\u8fd9\u5c06\u9700\u8981\u66f4\u65b0\u8d44\u6e90\u89c4\u8303\u5e76\u8fdb\u884c\u989d\u5916\u7814\u7a76\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u8981\u66ff\u6362\u7684\u8d44\u6e90\u3002</p> <p>\u5982\u679c\u8d44\u6e90\u7c7b\u578b\u4fdd\u6301\u4e0d\u53d8\u4f46\u9700\u8981\u66f4\u65b0API\u7248\u672c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528<code>kubectl-convert</code>\u547d\u4ee4\u81ea\u52a8\u8f6c\u6362\u6e05\u5355\u6587\u4ef6\u3002\u4f8b\u5982\uff0c\u5c06\u8f83\u65e7\u7684Deployment\u8f6c\u6362\u4e3a<code>apps/v1</code>\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605Kubernetes\u7f51\u7ad9\u4e0a\u7684\u5b89\u88c5kubectl convert\u63d2\u4ef6\u3002</p> <p><code>kubectl-convert -f &lt;file&gt; --output-version &lt;group&gt;/&lt;version&gt;</code></p>"},{"location":"zh/upgrades/#poddisruptionbudgetstopologyspreadconstraints","title":"\u914d\u7f6ePodDisruptionBudgets\u548ctopologySpreadConstraints\u4ee5\u786e\u4fdd\u5728\u5347\u7ea7\u6570\u636e\u5e73\u9762\u65f6\u5de5\u4f5c\u8d1f\u8f7d\u7684\u53ef\u7528\u6027","text":"<p>\u786e\u4fdd\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u5177\u6709\u9002\u5f53\u7684PodDisruptionBudgets\u548ctopologySpreadConstraints,\u4ee5\u786e\u4fdd\u5728\u5347\u7ea7\u6570\u636e\u5e73\u9762\u65f6\u5de5\u4f5c\u8d1f\u8f7d\u7684\u53ef\u7528\u6027\u3002\u5e76\u975e\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u90fd\u9700\u8981\u76f8\u540c\u7ea7\u522b\u7684\u53ef\u7528\u6027\uff0c\u56e0\u6b64\u60a8\u9700\u8981\u9a8c\u8bc1\u5de5\u4f5c\u8d1f\u8f7d\u7684\u89c4\u6a21\u548c\u8981\u6c42\u3002</p> <p>\u786e\u4fdd\u5de5\u4f5c\u8d1f\u8f7d\u5206\u5e03\u5728\u591a\u4e2a\u53ef\u7528\u533a\u548c\u591a\u4e2a\u4e3b\u673a\u4e0a\uff0c\u5e76\u4f7f\u7528\u62d3\u6251\u6269\u5c55\u5c06\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u81ea\u52a8\u8fc1\u79fb\u5230\u65b0\u7684\u6570\u636e\u5e73\u9762\u63d0\u4f9b\u66f4\u9ad8\u7684\u4fe1\u5fc3\uff0c\u800c\u4e0d\u4f1a\u53d1\u751f\u4efb\u4f55\u4e8b\u6545\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u793a\u4f8b\uff0c\u5b83\u5c06\u59cb\u7ec8\u4fdd\u630180%\u7684\u526f\u672c\u53ef\u7528\uff0c\u5e76\u8de8\u533a\u57df\u548c\u4e3b\u673a\u5206\u5e03\u526f\u672c</p> <pre><code>apiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: myapp\nspec:\n  minAvailable: \"80%\"\n  selector:\n    matchLabels:\n      app: myapp\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp\nspec:\n  replicas: 10\n  selector:\n    matchLabels:\n      app: myapp\n  template:\n    metadata:\n      labels:\n        app: myapp\n    spec:\n      containers:\n      - image: public.ecr.aws/eks-distro/kubernetes/pause:3.2\n        name: myapp\n        resources:\n          requests:\n            cpu: \"1\"\n            memory: 256M\n      topologySpreadConstraints:\n      - labelSelector:\n          matchLabels:\n            app: host-zone-spread\n        maxSkew: 2\n        topologyKey: kubernetes.io/hostname\n        whenUnsatisfiable: DoNotSchedule\n      - labelSelector:\n          matchLabels:\n            app: host-zone-spread\n        maxSkew: 2\n        topologyKey: topology.kubernetes.io/zone\n        whenUnsatisfiable: DoNotSchedule\n</code></pre> <p>AWS Resilience Hub\u5df2\u5c06Amazon Elastic Kubernetes Service (Amazon EKS)\u4f5c\u4e3a\u652f\u6301\u7684\u8d44\u6e90\u3002Resilience Hub\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5355\u4e00\u4f4d\u7f6e\uff0c\u7528\u4e8e\u5b9a\u4e49\u3001\u9a8c\u8bc1\u548c\u8ddf\u8e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u5f39\u6027\uff0c\u4ee5\u907f\u514d\u7531\u4e8e\u8f6f\u4ef6\u3001\u57fa\u7840\u8bbe\u65bd\u6216\u64cd\u4f5c\u4e2d\u65ad\u800c\u5bfc\u81f4\u7684\u4e0d\u5fc5\u8981\u7684\u505c\u673a\u65f6\u95f4\u3002</p>"},{"location":"zh/upgrades/#karpenter","title":"\u4f7f\u7528\u6258\u7ba1\u8282\u70b9\u7ec4\u6216Karpenter\u6765\u7b80\u5316\u6570\u636e\u5e73\u9762\u5347\u7ea7","text":"<p>\u6258\u7ba1\u8282\u70b9\u7ec4\u548cKarpenter\u90fd\u53ef\u4ee5\u7b80\u5316\u8282\u70b9\u5347\u7ea7\uff0c\u4f46\u5b83\u4eec\u91c7\u7528\u4e86\u4e0d\u540c\u7684\u65b9\u6cd5\u3002</p> <p>\u6258\u7ba1\u8282\u70b9\u7ec4\u53ef\u81ea\u52a8\u6267\u884c\u8282\u70b9\u7684\u4f9b\u5e94\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002\u8fd9\u610f\u5473\u7740\u60a8\u53ef\u4ee5\u901a\u8fc7\u5355\u4e2a\u64cd\u4f5c\u521b\u5efa\u3001\u81ea\u52a8\u66f4\u65b0\u6216\u7ec8\u6b62\u8282\u70b9\u3002</p> <p>\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e2d\uff0cKarpenter\u4f7f\u7528\u6700\u65b0\u7684\u517c\u5bb9EKS\u4f18\u5316AMI\u81ea\u52a8\u521b\u5efa\u65b0\u8282\u70b9\u3002\u5f53EKS\u53d1\u5e03\u66f4\u65b0\u7684EKS\u4f18\u5316AMI\u6216\u96c6\u7fa4\u5347\u7ea7\u65f6\uff0cKarpenter\u5c06\u81ea\u52a8\u5f00\u59cb\u4f7f\u7528\u8fd9\u4e9b\u955c\u50cf\u3002Karpenter\u8fd8\u5b9e\u73b0\u4e86\u8282\u70b9\u8fc7\u671f\u6765\u66f4\u65b0\u8282\u70b9\u3002</p> <p>Karpenter\u53ef\u4ee5\u914d\u7f6e\u4e3a\u4f7f\u7528\u81ea\u5b9a\u4e49AMI\u3002\u5982\u679c\u60a8\u5728Karpenter\u4e2d\u4f7f\u7528\u81ea\u5b9a\u4e49AMI\uff0c\u5219\u9700\u8981\u8d1f\u8d23kubelet\u7684\u7248\u672c\u3002</p>"},{"location":"zh/upgrades/#_9","title":"\u5728\u5347\u7ea7\u524d\u786e\u8ba4\u73b0\u6709\u8282\u70b9\u4e0e\u63a7\u5236\u5e73\u9762\u7684\u7248\u672c\u517c\u5bb9\u6027","text":"<p>\u5728Amazon EKS\u4e2d\u7ee7\u7eedKubernetes\u5347\u7ea7\u4e4b\u524d\uff0c\u786e\u4fdd\u60a8\u7684\u6258\u7ba1\u8282\u70b9\u7ec4\u3001\u81ea\u7ba1\u7406\u8282\u70b9\u4e0e\u63a7\u5236\u5e73\u9762\u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u81f3\u5173\u91cd\u8981\u3002\u517c\u5bb9\u6027\u7531\u60a8\u4f7f\u7528\u7684Kubernetes\u7248\u672c\u51b3\u5b9a\uff0c\u5e76\u4e14\u56e0\u4e0d\u540c\u60c5\u51b5\u800c\u6709\u6240\u4e0d\u540c\u3002\u7b56\u7565\uff1a</p> <ul> <li>Kubernetes v1.28+ - \u4eceKubernetes\u7248\u672c1.28\u5f00\u59cb\uff0c\u6838\u5fc3\u7ec4\u4ef6\u91c7\u7528\u4e86\u66f4\u5bbd\u677e\u7684\u7248\u672c\u7b56\u7565\u3002\u5177\u4f53\u800c\u8a00\uff0cKubernetes API\u670d\u52a1\u5668\u548ckubelet\u4e4b\u95f4\u652f\u6301\u7684\u7248\u672c\u504f\u5dee\u5df2\u4ecen-2\u6269\u5c55\u5230n-3\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684EKS\u63a7\u5236\u5e73\u9762\u7248\u672c\u662f1.28,\u60a8\u53ef\u4ee5\u5b89\u5168\u5730\u4f7f\u75281.25\u53ca\u66f4\u9ad8\u7248\u672c\u7684kubelet\u3002\u8fd9\u79cd\u7248\u672c\u504f\u5dee\u9002\u7528\u4e8eAWS Fargate\u3001\u6258\u7ba1\u8282\u70b9\u7ec4\u548c\u81ea\u7ba1\u7406\u8282\u70b9\u3002\u51fa\u4e8e\u5b89\u5168\u539f\u56e0\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4fdd\u6301Amazon Machine Image (AMI)\u7248\u672c\u7684\u6700\u65b0\u72b6\u6001\u3002\u8f83\u65e7\u7684kubelet\u7248\u672c\u53ef\u80fd\u5b58\u5728\u6f5c\u5728\u7684\u5e38\u89c1\u6f0f\u6d1e\u548c\u66b4\u9732(CVE)\uff0c\u8fd9\u53ef\u80fd\u4f1a\u8d85\u8fc7\u4f7f\u7528\u8f83\u65e7kubelet\u7248\u672c\u7684\u597d\u5904\u3002</li> <li>Kubernetes &lt; v1.28 - \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f1.28\u4e4b\u524d\u7684\u7248\u672c\uff0cAPI\u670d\u52a1\u5668\u548ckubelet\u4e4b\u95f4\u652f\u6301\u7684\u7248\u672c\u504f\u5dee\u4e3an-2\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684EKS\u7248\u672c\u662f1.27,\u60a8\u53ef\u4ee5\u4f7f\u7528\u7684\u6700\u65e7kubelet\u7248\u672c\u662f1.25\u3002\u6b64\u7248\u672c\u504f\u5dee\u9002\u7528\u4e8eAWS Fargate\u3001\u6258\u7ba1\u8282\u70b9\u7ec4\u548c\u81ea\u7ba1\u7406\u8282\u70b9\u3002</li> </ul>"},{"location":"zh/upgrades/#karpenter_1","title":"\u4e3aKarpenter\u7ba1\u7406\u7684\u8282\u70b9\u542f\u7528\u8282\u70b9\u8fc7\u671f","text":"<p>Karpenter\u5b9e\u73b0\u8282\u70b9\u5347\u7ea7\u7684\u4e00\u79cd\u65b9\u5f0f\u662f\u4f7f\u7528\u8282\u70b9\u8fc7\u671f\u7684\u6982\u5ff5\u3002\u8fd9\u51cf\u5c11\u4e86\u8282\u70b9\u5347\u7ea7\u6240\u9700\u7684\u89c4\u5212\u3002\u5f53\u60a8\u4e3aprovisioner\u8bbe\u7f6ettlSecondsUntilExpired\u503c\u65f6\uff0c\u8fd9\u5c06\u6fc0\u6d3b\u8282\u70b9\u8fc7\u671f\u3002\u8282\u70b9\u8fbe\u5230\u5b9a\u4e49\u7684\u79d2\u6570\u5e74\u9f84\u540e\uff0c\u5b83\u4eec\u5c06\u88ab\u5b89\u5168\u5730\u8017\u5c3d\u548c\u5220\u9664\u3002\u5373\u4f7f\u5b83\u4eec\u6b63\u5728\u4f7f\u7528\uff0c\u4e5f\u662f\u5982\u6b64\uff0c\u4ece\u800c\u5141\u8bb8\u60a8\u4f7f\u7528\u65b0\u4f9b\u5e94\u7684\u5347\u7ea7\u5b9e\u4f8b\u66ff\u6362\u8282\u70b9\u3002\u5f53\u8282\u70b9\u88ab\u66ff\u6362\u65f6\uff0cKarpenter\u5c06\u4f7f\u7528\u6700\u65b0\u7684EKS\u4f18\u5316AMI\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605Karpenter\u7f51\u7ad9\u4e0a\u7684\u53bb\u4f9b\u5e94\u3002</p> <p>Karpenter\u4e0d\u4f1a\u81ea\u52a8\u4e3a\u6b64\u503c\u6dfb\u52a0\u6296\u52a8\u3002\u4e3a\u9632\u6b62\u8fc7\u591a\u7684\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u65ad\uff0c\u8bf7\u5b9a\u4e49pod\u4e2d\u65ad\u9884\u7b97,\u5982Kubernetes\u6587\u6863\u6240\u793a\u3002</p> <p>\u5982\u679c\u60a8\u5728provisioner\u4e0a\u914d\u7f6e\u4e86ttlSecondsUntilExpired,\u8fd9\u5c06\u5e94\u7528\u4e8e\u4e0e\u8be5provisioner\u5173\u8054\u7684\u73b0\u6709\u8282\u70b9\u3002</p>"},{"location":"zh/upgrades/#karpenterdrift","title":"\u5bf9\u4e8eKarpenter\u7ba1\u7406\u7684\u8282\u70b9\u4f7f\u7528Drift\u529f\u80fd","text":"<p>Karpenter\u7684Drift\u529f\u80fd\u53ef\u4ee5\u81ea\u52a8\u5c06Karpenter\u4f9b\u5e94\u7684\u8282\u70b9\u5347\u7ea7\u5230\u4e0eEKS\u63a7\u5236\u5e73\u9762\u4fdd\u6301\u540c\u6b65\u3002\u76ee\u524d\u9700\u8981\u4f7f\u7528\u529f\u80fd\u95e8\u542f\u7528Karpenter Drift\u3002Karpenter\u7684\u9ed8\u8ba4\u914d\u7f6e\u4f7f\u7528\u4e0eEKS\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u76f8\u540c\u7684\u4e3b\u8981\u548c\u6b21\u8981\u7248\u672c\u7684\u6700\u65b0EKS\u4f18\u5316AMI\u3002</p> <p>EKS\u96c6\u7fa4\u5347\u7ea7\u5b8c\u6210\u540e\uff0cKarpenter\u7684Drift\u529f\u80fd\u5c06\u68c0\u6d4b\u5230Karpenter\u4f9b\u5e94\u7684\u8282\u70b9\u6b63\u5728\u4f7f\u7528\u4e0a\u4e00\u4e2a\u96c6\u7fa4\u7248\u672c\u7684EKS\u4f18\u5316AMI\uff0c\u5e76\u81ea\u52a8\u5c01\u9501\u3001\u8017\u5c3d\u548c\u66ff\u6362\u8fd9\u4e9b\u8282\u70b9\u3002\u4e3a\u652f\u6301pod\u79fb\u52a8\u5230\u65b0\u8282\u70b9\uff0c\u8bf7\u9075\u5faaKubernetes\u6700\u4f73\u5b9e\u8df5\uff0c\u8bbe\u7f6e\u9002\u5f53\u7684pod\u8d44\u6e90\u914d\u989d\u5e76\u4f7f\u7528pod\u4e2d\u65ad\u9884\u7b97(PDB)\u3002Karpenter\u7684\u53bb\u4f9b\u5e94\u5c06\u6839\u636epod\u8d44\u6e90\u8bf7\u6c42\u9884\u5148\u542f\u52a8\u66ff\u6362\u8282\u70b9\uff0c\u5e76\u5728\u53bb\u4f9b\u5e94\u8282\u70b9\u65f6\u5c06\u9075\u5b88PDB\u3002</p>"},{"location":"zh/upgrades/#eksctl","title":"\u4f7f\u7528eksctl\u81ea\u52a8\u5347\u7ea7\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4","text":"<p>\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4\u662f\u5728\u60a8\u7684\u8d26\u6237\u4e2d\u90e8\u7f72\u5e76\u9644\u52a0\u5230\u96c6\u7fa4\u4e4b\u5916\u7684EC2\u5b9e\u4f8b\u3002\u8fd9\u4e9b\u901a\u5e38\u7531\u67d0\u79cd\u5f62\u5f0f\u7684\u81ea\u52a8\u5316\u5de5\u5177\u90e8\u7f72\u548c\u7ba1\u7406\u3002\u8981\u5347\u7ea7\u81ea\u7ba1\u7406\u8282\u70b9\u7ec4\uff0c\u60a8\u5e94\u53c2\u8003\u60a8\u7684\u5de5\u5177\u6587\u6863\u3002</p> <p>\u4f8b\u5982\uff0ceksctl\u652f\u6301\u5220\u9664\u548c\u8017\u5c3d\u81ea\u7ba1\u7406\u8282\u70b9\u3002</p> <p>\u4e00\u4e9b\u5e38\u89c1\u5de5\u5177\u5305\u62ec\uff1a</p> <ul> <li>eksctl</li> <li>kOps</li> <li>EKS Blueprints</li> </ul>"},{"location":"zh/upgrades/#_10","title":"\u5728\u5347\u7ea7\u524d\u5907\u4efd\u96c6\u7fa4","text":"<p>Kubernetes\u7684\u65b0\u7248\u672c\u4f1a\u5bf9\u60a8\u7684Amazon EKS\u96c6\u7fa4\u5f15\u5165\u91cd\u5927\u53d8\u66f4\u3002\u5347\u7ea7\u96c6\u7fa4\u540e\uff0c\u60a8\u65e0\u6cd5\u964d\u7ea7\u3002</p> <p>Velero\u662f\u4e00\u4e2a\u793e\u533a\u652f\u6301\u7684\u5f00\u6e90\u5de5\u5177\uff0c\u53ef\u7528\u4e8e\u5bf9\u73b0\u6709\u96c6\u7fa4\u8fdb\u884c\u5907\u4efd\u5e76\u5c06\u5907\u4efd\u5e94\u7528\u4e8e\u65b0\u96c6\u7fa4\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u60a8\u53ea\u80fd\u4e3aEKS\u5f53\u524d\u652f\u6301\u7684Kubernetes\u7248\u672c\u521b\u5efa\u65b0\u96c6\u7fa4\u3002\u5982\u679c\u60a8\u5f53\u524d\u8fd0\u884c\u7684\u96c6\u7fa4\u7248\u672c\u4ecd\u53d7\u652f\u6301\u4e14\u5347\u7ea7\u5931\u8d25\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u539f\u59cb\u7248\u672c\u521b\u5efa\u65b0\u96c6\u7fa4\u5e76\u6062\u590d\u6570\u636e\u5e73\u9762\u3002\u8bf7\u6ce8\u610f\uff0cAWS\u8d44\u6e90(\u5305\u62ecIAM)\u4e0d\u5305\u542b\u5728Velero\u7684\u5907\u4efd\u4e2d\u3002\u8fd9\u4e9b\u8d44\u6e90\u9700\u8981\u91cd\u65b0\u521b\u5efa\u3002</p>"},{"location":"zh/upgrades/#fargate","title":"\u5728\u5347\u7ea7\u63a7\u5236\u5e73\u9762\u540e\u91cd\u65b0\u542f\u52a8Fargate\u90e8\u7f72","text":"<p>\u8981\u5347\u7ea7Fargate\u6570\u636e\u5e73\u9762\u8282\u70b9\uff0c\u60a8\u9700\u8981\u91cd\u65b0\u90e8\u7f72\u5de5\u4f5c\u8d1f\u8f7d\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528<code>-o wide</code>\u9009\u9879\u5217\u51fa\u6240\u6709pod\u6765\u8bc6\u522b\u5728fargate\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\u4efb\u4f55\u4ee5<code>fargate-</code>\u5f00\u5934\u7684\u8282\u70b9\u540d\u79f0\u90fd\u9700\u8981\u5728\u96c6\u7fa4\u4e2d\u91cd\u65b0\u90e8\u7f72\u3002</p>"},{"location":"zh/upgrades/#_11","title":"\u8bc4\u4f30\u84dd/\u7eff\u96c6\u7fa4\u4f5c\u4e3a\u5c31\u5730\u96c6\u7fa4\u5347\u7ea7\u7684\u66ff\u4ee3\u65b9\u6848","text":"<p>\u4e00\u4e9b\u5ba2\u6237\u66f4\u559c\u6b22\u91c7\u7528\u84dd/\u7eff\u5347\u7ea7\u7b56\u7565\u3002\u8fd9\u53ef\u80fd\u6709\u4e00\u4e9b\u597d\u5904\uff0c\u4f46\u4e5f\u5e94\u8be5\u8003\u8651\u4e00\u4e9b\u7f3a\u70b9\u3002</p> <p>\u4f18\u70b9\u5305\u62ec\uff1a</p> <ul> <li>\u53ef\u4ee5\u4e00\u6b21\u66f4\u6539\u591a\u4e2aEKS\u7248\u672c(\u4f8b\u5982\uff0c\u4ece1.23\u5347\u7ea7\u52301.25)</li> <li>\u80fd\u591f\u5207\u6362\u56de\u65e7\u96c6\u7fa4</li> <li>\u521b\u5efa\u65b0\u96c6\u7fa4\uff0c\u53ef\u80fd\u4f1a\u4f7f\u7528\u66f4\u65b0\u7684\u7cfb\u7edf\u8fdb\u884c\u7ba1\u7406(\u4f8b\u5982terraform)</li> <li>\u5de5\u4f5c\u8d1f\u8f7d\u53ef\u4ee5\u5355\u72ec\u8fc1\u79fb</li> </ul> <p>\u4e00\u4e9b\u7f3a\u70b9\u5305\u62ec\uff1a</p> <ul> <li>API\u7aef\u70b9\u548cOIDC\u53d1\u751f\u53d8\u5316\uff0c\u9700\u8981\u66f4\u65b0\u4f7f\u7528\u8005(\u4f8b\u5982kubectl\u548cCI/CD)</li> <li>\u5728\u8fc1\u79fb\u671f\u95f4\u9700\u8981\u5e76\u884c\u8fd0\u884c2\u4e2a\u96c6\u7fa4\uff0c\u8fd9\u53ef\u80fd\u4f1a\u589e\u52a0\u6210\u672c\u5e76\u9650\u5236\u533a\u57df\u5bb9\u91cf</li> <li>\u5982\u679c\u5de5\u4f5c\u8d1f\u8f7d\u76f8\u4e92\u4f9d\u8d56\uff0c\u5219\u9700\u8981\u66f4\u591a\u534f\u8c03\u4ee5\u4e00\u8d77\u8fc1\u79fb</li> <li>\u8d1f\u8f7d\u5747\u8861\u5668\u548c\u5916\u90e8DNS\u65e0\u6cd5\u8f7b\u6613\u8de8\u591a\u4e2a\u96c6\u7fa4</li> </ul> <p>\u867d\u7136\u53ef\u4ee5\u91c7\u7528\u8fd9\u79cd\u7b56\u7565\uff0c\u4f46\u4e0e\u5c31\u5730\u5347\u7ea7\u76f8\u6bd4\uff0c\u5b83\u66f4\u52a0\u6602\u8d35\u5e76\u9700\u8981\u66f4\u591a\u65f6\u95f4\u8fdb\u884c\u534f\u8c03\u548c\u5de5\u4f5c\u8d1f\u8f7d\u8fc1\u79fb\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u9700\u8981\u8fd9\u6837\u505a\uff0c\u5e76\u4e14\u5e94\u8be5\u8fdb\u884c\u4ed4\u7ec6\u89c4\u5212\u3002</p> <p>\u901a\u8fc7\u9ad8\u5ea6\u81ea\u52a8\u5316\u548c\u58f0\u660e\u5f0f\u7cfb\u7edf(\u5982GitOps)\uff0c\u8fd9\u53ef\u80fd\u4f1a\u66f4\u5bb9\u6613\u505a\u5230\u3002\u60a8\u9700\u8981\u4e3a\u6709\u72b6\u6001\u5de5\u4f5c\u8d1f\u8f7d\u91c7\u53d6\u989d\u5916\u7684\u9884\u9632\u63aa\u65bd\uff0c\u4ee5\u4fbf\u5907\u4efd\u548c\u8fc1\u79fb\u6570\u636e\u5230\u65b0\u96c6\u7fa4\u3002</p> <p>\u67e5\u770b\u4ee5\u4e0b\u535a\u5ba2\u6587\u7ae0\u4ee5\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\uff1a</p> <ul> <li>Kubernetes\u96c6\u7fa4\u5347\u7ea7\uff1a\u84dd/\u7eff\u90e8\u7f72\u7b56\u7565</li> <li>\u7528\u4e8e\u65e0\u72b6\u6001ArgoCD\u5de5\u4f5c\u8d1f\u8f7d\u7684\u84dd/\u7eff\u6216\u91d1\u4e1d\u96c0Amazon EKS\u96c6\u7fa4\u8fc1\u79fb</li> </ul>"},{"location":"zh/upgrades/#kubernetes-","title":"\u8ddf\u8e2aKubernetes\u9879\u76ee\u4e2d\u8ba1\u5212\u7684\u91cd\u5927\u53d8\u66f4 - \u63d0\u524d\u601d\u8003","text":"<p>\u4e0d\u8981\u53ea\u5173\u6ce8\u4e0b\u4e00\u4e2a\u7248\u672c\u3002\u5728\u65b0\u7248\u672c\u7684Kubernetes\u53d1\u5e03\u65f6\u8fdb\u884c\u5ba1\u67e5\uff0c\u5e76\u8bc6\u522b\u91cd\u5927\u53d8\u66f4\u3002\u4f8b\u5982\uff0c\u4e00\u4e9b\u5e94\u7528\u7a0b\u5e8f\u76f4\u63a5\u4f7f\u7528\u4e86docker API\uff0c\u800c\u5bf9Docker\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u63a5\u53e3(CRI)(\u4e5f\u79f0\u4e3aDockershim)\u7684\u652f\u6301\u5728Kubernetes <code>1.24</code>\u4e2d\u88ab\u5220\u9664\u3002\u8fd9\u79cd\u53d8\u66f4\u9700\u8981\u66f4\u591a\u65f6\u95f4\u6765\u51c6\u5907\u3002</p> <p>\u67e5\u770b\u60a8\u8981\u5347\u7ea7\u5230\u7684\u7248\u672c\u7684\u6240\u6709\u8bb0\u5f55\u7684\u66f4\u6539\uff0c\u5e76\u6ce8\u610f\u4efb\u4f55\u5fc5\u9700\u7684\u5347\u7ea7\u6b65\u9aa4\u3002\u8fd8\u8981\u6ce8\u610fAmazon EKS\u6258\u7ba1\u96c6\u7fa4\u7279\u6709\u7684\u4efb\u4f55\u8981\u6c42\u6216\u7a0b\u5e8f\u3002</p> <ul> <li>Kubernetes\u53d8\u66f4\u65e5\u5fd7</li> </ul>"},{"location":"zh/upgrades/#_12","title":"\u7279\u6027\u5220\u9664\u7684\u5177\u4f53\u6307\u5bfc","text":""},{"location":"zh/upgrades/#125dockershim-detector-for-docker-socket-dds","title":"1.25\u4e2d\u5220\u9664Dockershim - \u4f7f\u7528Detector for Docker Socket (DDS)","text":"<p>1.25\u7684EKS\u4f18\u5316AMI\u4e0d\u518d\u5305\u542b\u5bf9Dockershim\u7684\u652f\u6301\u3002\u5982\u679c\u60a8\u4f9d\u8d56Dockershim\uff0c\u4f8b\u5982\u60a8\u6b63\u5728\u6302\u8f7dDocker\u5957\u63a5\u5b57\uff0c\u5219\u9700\u8981\u5728\u5c06\u5de5\u4f5c\u8282\u70b9\u5347\u7ea7\u52301.25\u4e4b\u524d\u5220\u9664\u8fd9\u4e9b\u4f9d\u8d56\u9879\u3002</p> <p>\u5728\u5347\u7ea7\u52301.25\u4e4b\u524d\uff0c\u627e\u51fa\u60a8\u5bf9Docker\u5957\u63a5\u5b57\u7684\u4f9d\u8d56\u3002\u6211\u4eec\u5efa\u8bae\u4f7f\u7528Detector for Docker Socket (DDS),\u4e00\u4e2akubectl\u63d2\u4ef6\u3002\u3002</p>"},{"location":"zh/upgrades/#125podsecuritypolicy-pod-security-standards","title":"1.25\u4e2d\u5220\u9664PodSecurityPolicy - \u8fc1\u79fb\u5230Pod Security Standards\u6216\u7b56\u7565\u5373\u4ee3\u7801\u89e3\u51b3\u65b9\u6848","text":"<p><code>PodSecurityPolicy</code>\u5728Kubernetes 1.21\u4e2d\u88ab\u5f03\u7528,\u5e76\u5728Kubernetes 1.25\u4e2d\u88ab\u5220\u9664\u3002\u5982\u679c\u60a8\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528PodSecurityPolicy\uff0c\u90a3\u4e48\u5728\u5c06\u96c6\u7fa4\u5347\u7ea7\u52301.25\u7248\u672c\u4e4b\u524d\uff0c\u60a8\u5fc5\u987b\u8fc1\u79fb\u5230\u5185\u7f6e\u7684Kubernetes Pod Security Standards (PSS)\u6216\u7b56\u7565\u5373\u4ee3\u7801\u89e3\u51b3\u65b9\u6848\uff0c\u4ee5\u907f\u514d\u5bf9\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u9020\u6210\u4e2d\u65ad\u3002</p> <p>AWS\u5728EKS\u6587\u6863\u4e2d\u53d1\u5e03\u4e86\u8be6\u7ec6\u7684\u5e38\u89c1\u95ee\u9898\u89e3\u7b54\u3002</p> <p>\u67e5\u770bPod Security Standards (PSS)\u548cPod Security Admission (PSA)\u6700\u4f73\u5b9e\u8df5\u3002</p> <p>\u67e5\u770bKubernetes\u7f51\u7ad9\u4e0a\u7684PodSecurityPolicy\u5f03\u7528\u535a\u5ba2\u6587\u7ae0\u3002</p>"},{"location":"zh/upgrades/#123-csi","title":"1.23\u4e2d\u5f03\u7528\u5185\u7f6e\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f - \u8fc1\u79fb\u5230\u5bb9\u5668\u5b58\u50a8\u63a5\u53e3(CSI)\u9a71\u52a8\u7a0b\u5e8f","text":"<p>\u5bb9\u5668\u5b58\u50a8\u63a5\u53e3(CSI)\u65e8\u5728\u5e2e\u52a9Kubernetes\u53d6\u4ee3\u5176\u73b0\u6709\u7684\u5185\u7f6e\u5b58\u50a8\u9a71\u52a8\u7a0b\u5e8f\u673a\u5236\u3002Amazon EBS\u5bb9\u5668\u5b58\u50a8\u63a5\u53e3(CSI)\u8fc1\u79fb\u529f\u80fd\u5728Amazon EKS <code>1.23</code>\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u96c6\u7fa4\u4e2d\u9ed8\u8ba4\u542f\u7528\u3002\u5982\u679c\u60a8\u57281.22\u6216\u66f4\u65e9\u7248\u672c\u7684\u96c6\u7fa4\u4e0a\u8fd0\u884cpods\uff0c\u90a3\u4e48\u5728\u5c06\u96c6\u7fa4\u66f4\u65b0\u52301.23\u7248\u672c\u4e4b\u524d\uff0c\u60a8\u5fc5\u987b\u5b89\u88c5Amazon EBS CSI\u9a71\u52a8\u7a0b\u5e8f,\u4ee5\u907f\u514d\u670d\u52a1\u4e2d\u65ad\u3002</p> <p>\u67e5\u770bAmazon EBS CSI\u8fc1\u79fb\u5e38\u89c1\u95ee\u9898\u89e3\u7b54\u3002</p>"},{"location":"zh/upgrades/#_13","title":"\u5176\u4ed6\u8d44\u6e90","text":""},{"location":"zh/upgrades/#clowdhaus-eks","title":"ClowdHaus EKS\u5347\u7ea7\u6307\u5357","text":"<p>ClowdHaus EKS\u5347\u7ea7\u6307\u5357\u662f\u4e00\u4e2aCLI\uff0c\u53ef\u5e2e\u52a9\u5347\u7ea7Amazon EKS\u96c6\u7fa4\u3002\u5b83\u53ef\u4ee5\u5206\u6790\u96c6\u7fa4\u662f\u5426\u5b58\u5728\u4efb\u4f55\u9700\u8981\u5728\u5347\u7ea7\u4e4b\u524d\u4fee\u590d\u7684\u6f5c\u5728\u95ee\u9898\u3002</p>"},{"location":"zh/upgrades/#gonogo","title":"GoNoGo","text":"<p>GoNoGo\u662f\u4e00\u4e2aalpha\u9636\u6bb5\u7684\u5de5\u5177\uff0c\u7528\u4e8e\u786e\u5b9a\u96c6\u7fa4\u63d2\u4ef6\u7684\u5347\u7ea7\u7f6e\u4fe1\u5ea6\u3002</p>"},{"location":"zh/windows/docs/ami/","title":"Amazon EKS \u4f18\u5316\u7684 Windows AMI \u7ba1\u7406","text":"<p>Windows Amazon EKS \u4f18\u5316\u7684 AMI \u662f\u57fa\u4e8e Windows Server 2019 \u548c Windows Server 2022 \u6784\u5efa\u7684\u3002\u5b83\u4eec\u88ab\u914d\u7f6e\u4e3a Amazon EKS \u8282\u70b9\u7684\u57fa\u7840\u955c\u50cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAMI \u5305\u62ec\u4ee5\u4e0b\u7ec4\u4ef6\uff1a - kubelet - kube-proxy - AWS IAM Authenticator for Kubernetes - csi-proxy - containerd</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2 AWS Systems Manager Parameter Store API \u4ee5\u7f16\u7a0b\u65b9\u5f0f\u68c0\u7d22 Amazon EKS \u4f18\u5316\u7684 AMI ID\u3002\u6b64\u53c2\u6570\u6d88\u9664\u4e86\u60a8\u624b\u52a8\u67e5\u627e Amazon EKS \u4f18\u5316\u7684 AMI ID \u7684\u9700\u6c42\u3002\u6709\u5173 Systems Manager Parameter Store API \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 GetParameter\u3002\u60a8\u7684\u7528\u6237\u8d26\u6237\u5fc5\u987b\u5177\u6709 ssm\uff1aGetParameter IAM \u6743\u9650\u624d\u80fd\u68c0\u7d22 Amazon EKS \u4f18\u5316\u7684 AMI \u5143\u6570\u636e\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u68c0\u7d22 Windows Server 2019 LTSC Core \u7684\u6700\u65b0 Amazon EKS \u4f18\u5316 AMI \u7684 AMI ID\u3002AMI \u540d\u79f0\u4e2d\u5217\u51fa\u7684\u7248\u672c\u53f7\u4e0e\u76f8\u5e94\u7684 Kubernetes \u6784\u5efa\u7248\u672c\u76f8\u5173\u3002</p> <pre><code>aws ssm get-parameter --name /aws/service/ami-windows-latest/Windows_Server-2019-English-Core-EKS_Optimized-1.21/image_id --region us-east-1 --query \"Parameter.Value\" --output text\n</code></pre> <p>\u793a\u4f8b\u8f93\u51fa\uff1a</p> <pre><code>ami-09770b3eec4552d4e\n</code></pre>"},{"location":"zh/windows/docs/ami/#amazon-eks-windows-ami_1","title":"\u7ba1\u7406\u60a8\u81ea\u5df1\u7684 Amazon EKS \u4f18\u5316\u7684 Windows AMI","text":"<p>\u751f\u4ea7\u73af\u5883\u7684\u4e00\u4e2a\u91cd\u8981\u6b65\u9aa4\u662f\u5728\u6574\u4e2a Amazon EKS \u96c6\u7fa4\u4e2d\u4fdd\u6301\u76f8\u540c\u7684 Amazon EKS \u4f18\u5316\u7684 Windows AMI \u548c kubelet \u7248\u672c\u3002</p> <p>\u5728\u6574\u4e2a Amazon EKS \u96c6\u7fa4\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u7248\u672c\u53ef\u4ee5\u51cf\u5c11\u6545\u969c\u6392\u9664\u65f6\u95f4\u5e76\u63d0\u9ad8\u96c6\u7fa4\u4e00\u81f4\u6027\u3002Amazon EC2 Image Builder \u6709\u52a9\u4e8e\u521b\u5efa\u548c\u7ef4\u62a4\u81ea\u5b9a\u4e49\u7684 Amazon EKS \u4f18\u5316\u7684 Windows AMI\uff0c\u4ee5\u4fbf\u5728 Amazon EKS \u96c6\u7fa4\u4e2d\u4f7f\u7528\u3002</p> <p>\u4f7f\u7528 Amazon EC2 Image Builder \u53ef\u4ee5\u9009\u62e9 Windows Server \u7248\u672c\u3001AWS Windows Server AMI \u53d1\u5e03\u65e5\u671f\u548c/\u6216\u64cd\u4f5c\u7cfb\u7edf\u6784\u5efa\u7248\u672c\u3002\u6784\u5efa\u7ec4\u4ef6\u6b65\u9aa4\u5141\u8bb8\u60a8\u9009\u62e9\u73b0\u6709\u7684 EKS \u4f18\u5316\u7684 Windows \u5de5\u4ef6\u4ee5\u53ca kubelet \u7248\u672c\u3002\u66f4\u591a\u4fe1\u606f\uff1ahttps://docs.aws.amazon.com/eks/latest/userguide/eks-custom-ami-windows.html</p> <p></p> <p>\u6ce8\u610f\uff1a \u5728\u9009\u62e9\u57fa\u7840\u955c\u50cf\u4e4b\u524d\uff0c\u8bf7\u67e5\u9605 Windows Server \u7248\u672c\u548c\u8bb8\u53ef \u90e8\u5206\uff0c\u4e86\u89e3\u6709\u5173\u53d1\u5e03\u6e20\u9053\u66f4\u65b0\u7684\u91cd\u8981\u8be6\u7ec6\u4fe1\u606f\u3002</p>"},{"location":"zh/windows/docs/ami/#eks-ami","title":"\u4e3a\u81ea\u5b9a\u4e49 EKS \u4f18\u5316\u7684 AMI \u914d\u7f6e\u66f4\u5feb\u7684\u542f\u52a8","text":"<p>\u4f7f\u7528\u81ea\u5b9a\u4e49 Windows Amazon EKS \u4f18\u5316\u7684 AMI \u65f6\uff0c\u901a\u8fc7\u542f\u7528 Fast Launch \u529f\u80fd\uff0cWindows \u5de5\u4f5c\u8282\u70b9\u53ef\u4ee5\u542f\u52a8\u901f\u5ea6\u63d0\u9ad8 65%\u3002\u6b64\u529f\u80fd\u7ef4\u62a4\u4e86\u4e00\u7ec4\u9884\u7f6e\u7684\u5feb\u7167\uff0c\u8fd9\u4e9b\u5feb\u7167\u5df2\u7ecf\u5b8c\u6210\u4e86 Sysprep specialize\u3001Windows Out of Box Experience (OOBE) \u6b65\u9aa4\u548c\u6240\u9700\u7684\u91cd\u65b0\u542f\u52a8\u3002\u5728\u540e\u7eed\u542f\u52a8\u65f6\u4f7f\u7528\u8fd9\u4e9b\u5feb\u7167\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u6269\u5c55\u6216\u66ff\u6362\u8282\u70b9\u7684\u65f6\u95f4\u3002\u53ea\u80fd\u901a\u8fc7 EC2 \u63a7\u5236\u53f0\u6216\u5728 AWS CLI \u4e2d\u4e3a\u60a8\u62e5\u6709\u7684 AMI \u542f\u7528 Fast Launch\uff0c\u5e76\u4e14\u53ef\u4ee5\u914d\u7f6e\u7ef4\u62a4\u7684\u5feb\u7167\u6570\u91cf\u3002</p> <p>\u6ce8\u610f\uff1a Fast Launch \u4e0e\u9ed8\u8ba4\u7684 Amazon \u63d0\u4f9b\u7684 EKS \u4f18\u5316\u7684 AMI \u4e0d\u517c\u5bb9\uff0c\u5728\u5c1d\u8bd5\u542f\u7528\u5b83\u4e4b\u524d\uff0c\u8bf7\u5148\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49 AMI\u3002</p> <p>\u66f4\u591a\u4fe1\u606f\uff1aAWS Windows AMIs - \u914d\u7f6e\u60a8\u7684 AMI \u4ee5\u5b9e\u73b0\u66f4\u5feb\u7684\u542f\u52a8</p>"},{"location":"zh/windows/docs/ami/#ami-windows","title":"\u5728\u81ea\u5b9a\u4e49 AMI \u4e0a\u7f13\u5b58 Windows \u57fa\u7840\u5c42","text":"<p>Windows \u5bb9\u5668\u955c\u50cf\u6bd4 Linux \u5bb9\u5668\u955c\u50cf\u5927\u3002\u5982\u679c\u60a8\u6b63\u5728\u8fd0\u884c\u4efb\u4f55\u57fa\u4e8e .NET Framework \u7684\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e73\u5747\u955c\u50cf\u5927\u5c0f\u7ea6\u4e3a 8.24GB\u3002\u5728 pod \u8c03\u5ea6\u671f\u95f4\uff0c\u5fc5\u987b\u5728\u78c1\u76d8\u4e0a\u5b8c\u5168\u62c9\u53d6\u548c\u63d0\u53d6\u5bb9\u5668\u955c\u50cf\uff0c\u7136\u540e pod \u624d\u80fd\u8fbe\u5230 Running \u72b6\u6001\u3002</p> <p>\u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u5bb9\u5668\u8fd0\u884c\u65f6 (containerd) \u4f1a\u5e76\u884c\u62c9\u53d6\u548c\u63d0\u53d6\u6574\u4e2a\u5bb9\u5668\u955c\u50cf\u5230\u78c1\u76d8\u4e2d\u3002\u62c9\u53d6\u64cd\u4f5c\u662f\u4e00\u4e2a\u5e76\u884c\u8fc7\u7a0b\uff0c\u8fd9\u610f\u5473\u7740\u5bb9\u5668\u8fd0\u884c\u65f6\u5e76\u884c\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\u5c42\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u63d0\u53d6\u64cd\u4f5c\u662f\u4e00\u4e2a\u987a\u5e8f\u8fc7\u7a0b\uff0c\u5e76\u4e14\u662f I/O \u5bc6\u96c6\u578b\u7684\u3002\u56e0\u6b64\uff0c\u5bb9\u5668\u955c\u50cf\u53ef\u80fd\u9700\u8981\u8d85\u8fc7 8 \u5206\u949f\u624d\u80fd\u5b8c\u5168\u63d0\u53d6\u5e76\u51c6\u5907\u597d\u4f9b\u5bb9\u5668\u8fd0\u884c\u65f6 (containerd) \u4f7f\u7528\uff0c\u7ed3\u679c\u662f pod \u542f\u52a8\u65f6\u95f4\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f\u3002</p> <p>\u5982 Patching Windows Server and Container \u4e3b\u9898\u4e2d\u6240\u8ff0\uff0c\u6709\u4e00\u4e2a\u9009\u9879\u53ef\u4ee5\u4f7f\u7528 EKS \u6784\u5efa\u81ea\u5b9a\u4e49 AMI\u3002\u5728\u51c6\u5907 AMI \u671f\u95f4\uff0c\u60a8\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684 EC2 Image builder \u7ec4\u4ef6\u6765\u672c\u5730\u62c9\u53d6\u6240\u6709\u5fc5\u9700\u7684 Windows \u5bb9\u5668\u955c\u50cf\uff0c\u7136\u540e\u751f\u6210 AMI\u3002\u8fd9\u79cd\u7b56\u7565\u5c06\u5927\u5927\u51cf\u5c11 pod \u8fbe\u5230 Running \u72b6\u6001\u6240\u9700\u7684\u65f6\u95f4\u3002</p> <p>\u5728 Amazon EC2 Image Builder \u4e0a\uff0c\u521b\u5efa\u4e00\u4e2a \u7ec4\u4ef6 \u6765\u4e0b\u8f7d\u5fc5\u9700\u7684\u955c\u50cf\uff0c\u5e76\u5c06\u5176\u9644\u52a0\u5230 Image recipe\u3002\u4ee5\u4e0b\u793a\u4f8b\u4ece ECR \u5b58\u50a8\u5e93\u4e2d\u62c9\u53d6\u7279\u5b9a\u955c\u50cf\u3002</p> <pre><code>name: ContainerdPull\ndescription: \u6b64\u7ec4\u4ef6\u62c9\u53d6\u7f13\u5b58\u7b56\u7565\u6240\u9700\u7684\u5bb9\u5668\u955c\u50cf\u3002\nschemaVersion: 1.0\n\nphases:\n  - name: build\n    steps:\n      - name: containerdpull\n        action: ExecutePowerShell\n        inputs:\n          commands:\n            - Set-ExecutionPolicy Unrestricted -Force\n            - (Get-ECRLoginCommand).Password | docker login --username AWS --password-stdin 111000111000.dkr.ecr.us-east-1.amazonaws.com\n            - ctr image pull mcr.microsoft.com/dotnet/framework/aspnet:latest\n            - ctr image pull 111000111000.dkr.ecr.us-east-1.amazonaws.com/myappcontainerimage:latest\n</code></pre> <p>\u8981\u786e\u4fdd\u4ee5\u4e0b\u7ec4\u4ef6\u6309\u9884\u671f\u5de5\u4f5c\uff0c\u8bf7\u68c0\u67e5 EC2 Image builder \u4f7f\u7528\u7684 IAM \u89d2\u8272 (EC2InstanceProfileForImageBuilder) \u662f\u5426\u9644\u52a0\u4e86\u4ee5\u4e0b\u7b56\u7565\uff1a</p> <p></p>"},{"location":"zh/windows/docs/ami/#_1","title":"\u535a\u5ba2\u6587\u7ae0","text":"<p>\u5728\u4ee5\u4e0b\u535a\u5ba2\u6587\u7ae0\u4e2d\uff0c\u60a8\u5c06\u627e\u5230\u5982\u4f55\u4e3a\u81ea\u5b9a\u4e49 Amazon EKS Windows AMI \u5b9e\u73b0\u7f13\u5b58\u7b56\u7565\u7684\u5206\u6b65\u8bf4\u660e\uff1a</p> <p>\u4f7f\u7528 EC2 Image builder \u548c\u955c\u50cf\u7f13\u5b58\u7b56\u7565\u52a0\u901f Windows \u5bb9\u5668\u542f\u52a8\u65f6\u95f4</p>"},{"location":"zh/windows/docs/gmsa/","title":"\u4e3a Windows Pod \u548c\u5bb9\u5668\u914d\u7f6e gMSA","text":""},{"location":"zh/windows/docs/gmsa/#gmsa","title":"\u4ec0\u4e48\u662f gMSA \u8d26\u6237","text":"<p>\u57fa\u4e8e Windows \u7684\u5e94\u7528\u7a0b\u5e8f\uff08\u5982 .NET \u5e94\u7528\u7a0b\u5e8f\uff09\u901a\u5e38\u4f7f\u7528 Active Directory \u4f5c\u4e3a\u8eab\u4efd\u63d0\u4f9b\u7a0b\u5e8f\uff0c\u4f7f\u7528 NTLM \u6216 Kerberos \u534f\u8bae\u63d0\u4f9b\u6388\u6743/\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\u5668\u9700\u8981\u4e0e Active Directory \u4ea4\u6362 Kerberos \u7968\u8bc1\uff0c\u56e0\u6b64\u9700\u8981\u52a0\u5165\u57df\u3002Windows \u5bb9\u5668\u4e0d\u652f\u6301\u52a0\u5165\u57df\uff0c\u5e76\u4e14\u7531\u4e8e\u5bb9\u5668\u662f\u4e34\u65f6\u8d44\u6e90\uff0c\u8fd9\u6837\u505a\u4e5f\u6ca1\u6709\u592a\u5927\u610f\u4e49\uff0c\u4f1a\u7ed9 Active Directory RID \u6c60\u5e26\u6765\u8d1f\u62c5\u3002</p> <p>\u4f46\u662f\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u5229\u7528 gMSA Active Directory \u8d26\u6237\u4e3a\u8d44\u6e90\uff08\u5982 Windows \u5bb9\u5668\u3001NLB \u548c\u670d\u52a1\u5668\u7fa4\uff09\u534f\u5546 Windows \u8eab\u4efd\u9a8c\u8bc1\u3002</p>"},{"location":"zh/windows/docs/gmsa/#windows-gmsa","title":"Windows \u5bb9\u5668\u548c gMSA \u7684\u4f7f\u7528\u573a\u666f","text":"<p>\u5229\u7528 Windows \u8eab\u4efd\u9a8c\u8bc1\u5e76\u4ee5 Windows \u5bb9\u5668\u5f62\u5f0f\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ece gMSA \u83b7\u76ca\uff0c\u56e0\u4e3a Windows \u8282\u70b9\u5c06\u4ee3\u8868\u5bb9\u5668\u4ea4\u6362 Kerberos \u7968\u8bc1\u3002\u6709\u4e24\u79cd\u9009\u62e9\u53ef\u4ee5\u8bbe\u7f6e Windows \u5de5\u4f5c\u8282\u70b9\u4ee5\u652f\u6301 gMSA \u96c6\u6210\uff1a</p>"},{"location":"zh/windows/docs/gmsa/#1-windows","title":"1 - \u52a0\u5165\u57df\u7684 Windows \u5de5\u4f5c\u8282\u70b9","text":"<p>\u5728\u6b64\u8bbe\u7f6e\u4e2d\uff0cWindows \u5de5\u4f5c\u8282\u70b9\u52a0\u5165\u4e86 Active Directory \u57df\uff0c\u5e76\u4e14 Windows \u5de5\u4f5c\u8282\u70b9\u7684 AD \u8ba1\u7b97\u673a\u8d26\u6237\u7528\u4e8e\u5bf9 Active Directory \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u5e76\u68c0\u7d22\u8981\u4e0e Pod \u4e00\u8d77\u4f7f\u7528\u7684 gMSA \u8eab\u4efd\u3002</p> <p>\u5728\u52a0\u5165\u57df\u7684\u65b9\u6cd5\u4e2d\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u5730\u4f7f\u7528\u73b0\u6709\u7684 Active Directory GPO \u6765\u7ba1\u7406\u548c\u52a0\u56fa\u60a8\u7684 Windows \u5de5\u4f5c\u8282\u70b9\uff1b\u4f46\u662f\uff0c\u5b83\u4f1a\u4ea7\u751f\u989d\u5916\u7684\u64cd\u4f5c\u5f00\u9500\uff0c\u5e76\u5728 Windows \u5de5\u4f5c\u8282\u70b9\u52a0\u5165 Kubernetes \u96c6\u7fa4\u65f6\u5ef6\u8fdf\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u5728\u8282\u70b9\u542f\u52a8\u671f\u95f4\u989d\u5916\u91cd\u542f\uff0c\u5e76\u5728 Kubernetes \u96c6\u7fa4\u7ec8\u6b62\u8282\u70b9\u540e\u6e05\u7406 Active Directory \u5783\u573e\u3002</p> <p>\u5728\u4ee5\u4e0b\u535a\u5ba2\u6587\u7ae0\u4e2d\uff0c\u60a8\u5c06\u627e\u5230\u6709\u5173\u5982\u4f55\u5b9e\u73b0\u52a0\u5165\u57df\u7684 Windows \u5de5\u4f5c\u8282\u70b9\u65b9\u6cd5\u7684\u8be6\u7ec6\u5206\u6b65\u8bf4\u660e\uff1a</p> <p>Amazon EKS Windows Pod \u4e0a\u7684 Windows \u8eab\u4efd\u9a8c\u8bc1</p>"},{"location":"zh/windows/docs/gmsa/#2-windows","title":"2 - \u65e0\u57df Windows \u5de5\u4f5c\u8282\u70b9","text":"<p>\u5728\u6b64\u8bbe\u7f6e\u4e2d\uff0cWindows \u5de5\u4f5c\u8282\u70b9\u672a\u52a0\u5165 Active Directory \u57df\uff0c\u5e76\u4e14\u4f7f\u7528\"\u53ef\u79fb\u690d\"\u8eab\u4efd\uff08\u7528\u6237/\u5bc6\u7801\uff09\u5bf9 Active Directory \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u5e76\u68c0\u7d22\u8981\u4e0e Pod \u4e00\u8d77\u4f7f\u7528\u7684 gMSA \u8eab\u4efd\u3002</p> <p></p> <p>\u53ef\u79fb\u690d\u8eab\u4efd\u662f Active Directory \u7528\u6237\uff1b\u8be5\u8eab\u4efd\uff08\u7528\u6237/\u5bc6\u7801\uff09\u5b58\u50a8\u5728 AWS Secrets Manager \u6216 AWS Systems Manager Parameter Store \u4e2d\uff0c\u5e76\u4e14 AWS \u5f00\u53d1\u7684\u63d2\u4ef6 ccg_plugin \u5c06\u7528\u4e8e\u4ece AWS Secrets Manager \u6216 AWS Systems Manager Parameter Store \u68c0\u7d22\u6b64\u8eab\u4efd\uff0c\u5e76\u5c06\u5176\u4f20\u9012\u7ed9 containerd \u4ee5\u68c0\u7d22 gMSA \u8eab\u4efd\u5e76\u4f7f\u5176\u53ef\u7528\u4e8e Pod\u3002</p> <p>\u5728\u8fd9\u79cd\u65e0\u57df\u65b9\u6cd5\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5728\u4f7f\u7528 gMSA \u65f6\u907f\u514d\u5728 Windows \u5de5\u4f5c\u8282\u70b9\u542f\u52a8\u671f\u95f4\u4e0e Active Directory \u4ea4\u4e92\uff0c\u5e76\u51cf\u5c11 Active Directory \u7ba1\u7406\u5458\u7684\u64cd\u4f5c\u5f00\u9500\u3002</p> <p>\u5728\u4ee5\u4e0b\u535a\u5ba2\u6587\u7ae0\u4e2d\uff0c\u60a8\u5c06\u627e\u5230\u6709\u5173\u5982\u4f55\u5b9e\u73b0\u65e0\u57df Windows \u5de5\u4f5c\u8282\u70b9\u65b9\u6cd5\u7684\u8be6\u7ec6\u5206\u6b65\u8bf4\u660e\uff1a</p> <p>Amazon EKS Windows Pod \u7684\u65e0\u57df Windows \u8eab\u4efd\u9a8c\u8bc1</p>"},{"location":"zh/windows/docs/gmsa/#_1","title":"\u91cd\u8981\u6ce8\u610f\u4e8b\u9879","text":"<p>\u5c3d\u7ba1 Pod \u80fd\u591f\u4f7f\u7528 gMSA \u8d26\u6237\uff0c\u4f46\u4e5f\u9700\u8981\u76f8\u5e94\u5730\u8bbe\u7f6e\u5e94\u7528\u7a0b\u5e8f\u6216\u670d\u52a1\u4ee5\u652f\u6301 Windows \u8eab\u4efd\u9a8c\u8bc1\uff0c\u4f8b\u5982\uff0c\u4e3a\u4e86\u8bbe\u7f6e Microsoft IIS \u4ee5\u652f\u6301 Windows \u8eab\u4efd\u9a8c\u8bc1\uff0c\u60a8\u5e94\u8be5\u901a\u8fc7 dockerfile \u8fdb\u884c\u51c6\u5907\uff1a</p> <pre><code>RUN Install-WindowsFeature -Name Web-Windows-Auth -IncludeAllSubFeature\nRUN Import-Module WebAdministration; Set-ItemProperty 'IIS:\\AppPools\\SiteName' -name processModel.identityType -value 2\nRUN Import-Module WebAdministration; Set-WebConfigurationProperty -Filter '/system.webServer/security/authentication/anonymousAuthentication' -Name Enabled -Value False -PSPath 'IIS:\\' -Location 'SiteName'\nRUN Import-Module WebAdministration; Set-WebConfigurationProperty -Filter '/system.webServer/security/authentication/windowsAuthentication' -Name Enabled -Value True -PSPath 'IIS:\\' -Location 'SiteName'\n</code></pre>"},{"location":"zh/windows/docs/hardening/","title":"Windows \u5de5\u4f5c\u8282\u70b9\u52a0\u56fa","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u52a0\u56fa\u662f\u4e00\u79cd\u7ec4\u5408\u64cd\u4f5c\u7cfb\u7edf\u914d\u7f6e\u3001\u6253\u8865\u4e01\u548c\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u8f6f\u4ef6\u5305\u7684\u505a\u6cd5\uff0c\u65e8\u5728\u9501\u5b9a\u7cfb\u7edf\u5e76\u51cf\u5c11\u653b\u51fb\u9762\u3002\u6700\u4f73\u5b9e\u8df5\u662f\u6839\u636e\u516c\u53f8\u7684\u8981\u6c42\u51c6\u5907\u81ea\u5df1\u7684 EKS \u4f18\u5316 Windows AMI \u5e76\u8fdb\u884c\u52a0\u56fa\u914d\u7f6e\u3002</p> <p>AWS \u6bcf\u6708\u90fd\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u65b0\u7684 EKS \u4f18\u5316 Windows AMI\uff0c\u5176\u4e2d\u5305\u542b\u6700\u65b0\u7684 Windows Server \u5b89\u5168\u8865\u4e01\u3002\u4f46\u662f\uff0c\u65e0\u8bba\u4f7f\u7528\u81ea\u7ba1\u7406\u8fd8\u662f\u6258\u7ba1\u8282\u70b9\u7ec4\uff0c\u7528\u6237\u4ecd\u6709\u8d23\u4efb\u901a\u8fc7\u5e94\u7528\u5fc5\u8981\u7684\u64cd\u4f5c\u7cfb\u7edf\u914d\u7f6e\u6765\u52a0\u56fa\u5176 AMI\u3002</p> <p>\u5fae\u8f6f\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5de5\u5177\uff0c\u5982 Microsoft Security Compliance Toolkit \u548c Security Baselines,\u53ef\u5e2e\u52a9\u60a8\u6839\u636e\u5b89\u5168\u7b56\u7565\u9700\u6c42\u5b9e\u73b0\u52a0\u56fa\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u8fd8\u5e94\u5728 Amazon EKS \u4f18\u5316 Windows AMI \u4e4b\u4e0a\u5b9e\u65bd CIS \u57fa\u51c6\u3002</p>"},{"location":"zh/windows/docs/hardening/#windows-server-core","title":"\u901a\u8fc7 Windows Server Core \u51cf\u5c11\u653b\u51fb\u9762","text":"<p>Windows Server Core \u662f EKS \u4f18\u5316 Windows AMI \u4e2d\u63d0\u4f9b\u7684\u4e00\u79cd\u6700\u5c0f\u5b89\u88c5\u9009\u9879\u3002\u90e8\u7f72 Windows Server Core \u6709\u51e0\u4e2a\u597d\u5904\u3002\u9996\u5148\uff0c\u5b83\u7684\u78c1\u76d8\u5360\u7528\u7a7a\u95f4\u76f8\u5bf9\u8f83\u5c0f\uff0cServer Core \u4e3a 6GB\uff0c\u800c Windows Server \u684c\u9762\u4f53\u9a8c\u7248\u4e3a 10GB\u3002\u5176\u6b21\uff0c\u7531\u4e8e\u4ee3\u7801\u5e93\u548c\u53ef\u7528 API \u8f83\u5c0f\uff0c\u56e0\u6b64\u653b\u51fb\u9762\u4e5f\u8f83\u5c0f\u3002</p> <p>\u65e0\u8bba Amazon EKS \u652f\u6301\u54ea\u4e2a\u7248\u672c\uff0cAWS \u6bcf\u6708\u90fd\u4f1a\u4e3a\u5ba2\u6237\u63d0\u4f9b\u65b0\u7684 Amazon EKS \u4f18\u5316 Windows AMI\uff0c\u5176\u4e2d\u5305\u542b\u6700\u65b0\u7684 Microsoft \u5b89\u5168\u8865\u4e01\u3002\u4f5c\u4e3a\u6700\u4f73\u5b9e\u8df5\uff0c\u5fc5\u987b\u4f7f\u7528\u57fa\u4e8e\u6700\u65b0 Amazon EKS \u4f18\u5316 AMI \u7684\u65b0\u8282\u70b9\u66ff\u6362 Windows \u5de5\u4f5c\u8282\u70b9\u3002\u4efb\u4f55\u8fd0\u884c\u8d85\u8fc7 45 \u5929\u4e14\u672a\u66f4\u65b0\u6216\u672a\u66ff\u6362\u8282\u70b9\u7684\u505a\u6cd5\u90fd\u4e0d\u7b26\u5408\u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"zh/windows/docs/hardening/#rdp","title":"\u907f\u514d RDP \u8fde\u63a5","text":"<p>\u8fdc\u7a0b\u684c\u9762\u534f\u8bae (RDP) \u662f\u4e00\u79cd\u7531 Microsoft \u5f00\u53d1\u7684\u8fde\u63a5\u534f\u8bae\uff0c\u7528\u4e8e\u4e3a\u7528\u6237\u63d0\u4f9b\u56fe\u5f62\u754c\u9762\uff0c\u4ee5\u4fbf\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u5230\u53e6\u4e00\u53f0 Windows \u8ba1\u7b97\u673a\u3002</p> <p>\u4f5c\u4e3a\u6700\u4f73\u5b9e\u8df5\uff0c\u60a8\u5e94\u5c06 Windows \u5de5\u4f5c\u8282\u70b9\u89c6\u4e3a\u4e34\u65f6\u4e3b\u673a\u3002\u8fd9\u610f\u5473\u7740\u4e0d\u5141\u8bb8\u7ba1\u7406\u8fde\u63a5\u3001\u66f4\u65b0\u548c\u6545\u969c\u6392\u67e5\u3002\u4efb\u4f55\u4fee\u6539\u548c\u66f4\u65b0\u90fd\u5e94\u4f5c\u4e3a\u65b0\u7684\u81ea\u5b9a\u4e49 AMI \u5b9e\u65bd\uff0c\u5e76\u901a\u8fc7\u66f4\u65b0\u81ea\u52a8\u4f38\u7f29\u7ec4\u8fdb\u884c\u66ff\u6362\u3002\u8bf7\u53c2\u9605\u4fee\u8865 Windows \u670d\u52a1\u5668\u548c\u5bb9\u5668\u548cAmazon EKS \u4f18\u5316 Windows AMI \u7ba1\u7406\u3002</p> <p>\u5728\u90e8\u7f72\u671f\u95f4\u901a\u8fc7\u5c06 ssh \u5c5e\u6027\u7684\u503c\u8bbe\u7f6e\u4e3a false \u6765\u7981\u7528 Windows \u8282\u70b9\u4e0a\u7684 RDP \u8fde\u63a5\uff0c\u5982\u4e0b\u4f8b\u6240\u793a\uff1a</p> <pre><code>nodeGroups:\n- name: windows-ng\n  instanceType: c5.xlarge\n  minSize: 1\n  volumeSize: 50\n  amiFamily: WindowsServer2019CoreContainer\n  ssh:\n    allow: false\n</code></pre> <p>\u5982\u679c\u9700\u8981\u8bbf\u95ee Windows \u8282\u70b9\uff0c\u8bf7\u4f7f\u7528 AWS System Manager Session Manager \u901a\u8fc7 AWS \u63a7\u5236\u53f0\u548c SSM \u4ee3\u7406\u5efa\u7acb\u5b89\u5168\u7684 PowerShell \u4f1a\u8bdd\u3002\u8981\u4e86\u89e3\u5982\u4f55\u5b9e\u65bd\u6b64\u89e3\u51b3\u65b9\u6848\uff0c\u8bf7\u89c2\u770b Securely Access Windows Instances Using AWS Systems Manager Session Manager</p> <p>\u4e3a\u4e86\u4f7f\u7528 System Manager Session Manager\uff0c\u5fc5\u987b\u5c06\u9644\u52a0 IAM \u7b56\u7565\u5e94\u7528\u4e8e\u7528\u4e8e\u542f\u52a8 Windows \u5de5\u4f5c\u8282\u70b9\u7684 IAM \u89d2\u8272\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u5176\u4e2d\u5728 <code>eksctl</code> \u96c6\u7fa4\u6e05\u5355\u4e2d\u6307\u5b9a\u4e86 AmazonSSMManagedInstanceCore:</p> <pre><code> nodeGroups:\n- name: windows-ng\n  instanceType: c5.xlarge\n  minSize: 1\n  volumeSize: 50\n  amiFamily: WindowsServer2019CoreContainer\n  ssh:\n    allow: false\n  iam:\n    attachPolicyARNs:\n      - arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy\n      - arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy\n      - arn:aws:iam::aws:policy/ElasticLoadBalancingFullAccess\n      - arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly\n      - arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore\n</code></pre>"},{"location":"zh/windows/docs/hardening/#amazon-inspector","title":"Amazon Inspector","text":"<p>Amazon Inspector \u662f\u4e00\u79cd\u81ea\u52a8\u5316\u5b89\u5168\u8bc4\u4f30\u670d\u52a1\uff0c\u53ef\u5e2e\u52a9\u63d0\u9ad8\u90e8\u7f72\u5728 AWS \u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\u548c\u5408\u89c4\u6027\u3002Amazon Inspector \u4f1a\u81ea\u52a8\u8bc4\u4f30\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u5b58\u5728\u66b4\u9732\u3001\u6f0f\u6d1e\u548c\u504f\u79bb\u6700\u4f73\u5b9e\u8df5\u7684\u60c5\u51b5\u3002\u6267\u884c\u8bc4\u4f30\u540e\uff0cAmazon Inspector \u4f1a\u751f\u6210\u4e00\u4efd\u8be6\u7ec6\u7684\u5b89\u5168\u53d1\u73b0\u5217\u8868\uff0c\u6309\u4e25\u91cd\u7ea7\u522b\u6392\u5217\u4f18\u5148\u7ea7\u3002\u60a8\u53ef\u4ee5\u76f4\u63a5\u67e5\u770b\u8fd9\u4e9b\u53d1\u73b0\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u8be6\u7ec6\u8bc4\u4f30\u62a5\u544a\u7684\u4e00\u90e8\u5206\u67e5\u770b\uff0c\u8fd9\u4e9b\u62a5\u544a\u53ef\u901a\u8fc7 Amazon Inspector \u63a7\u5236\u53f0\u6216 API \u83b7\u53d6\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 Amazon Inspector \u5728 Windows \u5de5\u4f5c\u8282\u70b9\u4e0a\u8fd0\u884c CIS \u57fa\u51c6\u8bc4\u4f30\uff0c\u53ea\u9700\u6267\u884c\u4ee5\u4e0b\u4efb\u52a1\u5373\u53ef\u5728 Windows Server Core \u4e0a\u5b89\u88c5\u5b83\uff1a</p> <ol> <li>\u4e0b\u8f7d\u4ee5\u4e0b .exe \u6587\u4ef6\uff1a https://inspector-agent.amazonaws.com/windows/installer/latest/AWSAgentInstall.exe</li> <li>\u5c06\u4ee3\u7406\u4f20\u8f93\u5230 Windows \u5de5\u4f5c\u8282\u70b9\u3002</li> <li>\u5728 PowerShell \u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u5b89\u88c5 Amazon Inspector \u4ee3\u7406\uff1a <code>.\\AWSAgentInstall.exe /install</code></li> </ol> <p>\u4e0b\u9762\u662f\u9996\u6b21\u8fd0\u884c\u540e\u7684\u8f93\u51fa\u3002\u5982\u60a8\u6240\u89c1\uff0c\u5b83\u6839\u636e CVE \u6570\u636e\u5e93\u751f\u6210\u4e86\u53d1\u73b0\u7ed3\u679c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u7ed3\u679c\u6765\u52a0\u56fa\u60a8\u7684\u5de5\u4f5c\u8282\u70b9\u6216\u57fa\u4e8e\u52a0\u56fa\u914d\u7f6e\u521b\u5efa AMI\u3002</p> <p></p> <p>\u6709\u5173 Amazon Inspector \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u5305\u62ec\u5982\u4f55\u5b89\u88c5 Amazon Inspector \u4ee3\u7406\u3001\u8bbe\u7f6e CIS \u57fa\u51c6\u8bc4\u4f30\u4ee5\u53ca\u751f\u6210\u62a5\u544a\uff0c\u8bf7\u89c2\u770b Improving the security and compliance of Windows Workloads with Amazon Inspector \u89c6\u9891\u3002</p>"},{"location":"zh/windows/docs/hardening/#amazon-guardduty","title":"Amazon GuardDuty","text":"<p>Amazon GuardDuty \u662f\u4e00\u79cd\u5a01\u80c1\u68c0\u6d4b\u670d\u52a1\uff0c\u53ef\u6301\u7eed\u76d1\u63a7\u6076\u610f\u6d3b\u52a8\u548c\u672a\u7ecf\u6388\u6743\u7684\u884c\u4e3a\uff0c\u4ee5\u4fdd\u62a4\u60a8\u7684 AWS \u8d26\u6237\u3001\u5de5\u4f5c\u8d1f\u8f7d\u548c\u5b58\u50a8\u5728 Amazon S3 \u4e2d\u7684\u6570\u636e\u3002\u501f\u52a9\u4e91\uff0c\u53ef\u4ee5\u7b80\u5316\u8d26\u6237\u548c\u7f51\u7edc\u6d3b\u52a8\u7684\u6536\u96c6\u548c\u805a\u5408\uff0c\u4f46\u5b89\u5168\u56e2\u961f\u6301\u7eed\u5206\u6790\u4e8b\u4ef6\u65e5\u5fd7\u6570\u636e\u4ee5\u67e5\u627e\u6f5c\u5728\u5a01\u80c1\u53ef\u80fd\u4f1a\u8017\u8d39\u5927\u91cf\u65f6\u95f4\u3002</p> <p>\u901a\u8fc7\u4f7f\u7528 Amazon GuardDuty\uff0c\u60a8\u53ef\u4ee5\u4e86\u89e3\u9488\u5bf9 Windows \u5de5\u4f5c\u8282\u70b9\u7684\u6076\u610f\u6d3b\u52a8\uff0c\u5982 RDP \u66b4\u529b\u7834\u89e3\u548c\u7aef\u53e3\u63a2\u6d4b\u653b\u51fb\u3002</p> <p>\u89c2\u770b Threat Detection for Windows Workloads using Amazon GuardDuty \u89c6\u9891\uff0c\u4e86\u89e3\u5982\u4f55\u5728\u4f18\u5316\u7684 EKS Windows AMI \u4e0a\u5b9e\u65bd\u548c\u8fd0\u884c CIS \u57fa\u51c6\u3002</p>"},{"location":"zh/windows/docs/hardening/#amazon-ec2-windows","title":"Amazon EC2 \u4e2d\u7684 Windows \u5b89\u5168\u6027","text":"<p>\u9605\u8bfb Security best practices for Amazon EC2 Windows instances,\u4ee5\u5728\u6bcf\u4e2a\u5c42\u9762\u5b9e\u65bd\u5b89\u5168\u63a7\u5236\u3002</p>"},{"location":"zh/windows/docs/images/","title":"\u5bb9\u5668\u955c\u50cf\u626b\u63cf","text":"<p>\u955c\u50cf\u626b\u63cf\u662f\u4e00\u9879\u81ea\u52a8\u5316\u6f0f\u6d1e\u8bc4\u4f30\u529f\u80fd\uff0c\u901a\u8fc7\u626b\u63cf\u5e7f\u6cdb\u7684\u64cd\u4f5c\u7cfb\u7edf\u6f0f\u6d1e\uff0c\u6709\u52a9\u4e8e\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u955c\u50cf\u7684\u5b89\u5168\u6027\u3002</p> <p>\u76ee\u524d\uff0cAmazon Elastic Container Registry (ECR) \u53ea\u80fd\u626b\u63cf Linux \u5bb9\u5668\u955c\u50cf\u7684\u6f0f\u6d1e\u3002\u4f46\u662f\uff0c\u6709\u7b2c\u4e09\u65b9\u5de5\u5177\u53ef\u4ee5\u4e0e\u73b0\u6709\u7684 CI/CD \u7ba1\u9053\u96c6\u6210\uff0c\u7528\u4e8e Windows \u5bb9\u5668\u955c\u50cf\u626b\u63cf\u3002</p> <ul> <li>Anchore</li> <li>PaloAlto Prisma Cloud </li> <li>Trend Micro - Deep Security Smart Check</li> </ul> <p>\u8981\u4e86\u89e3\u5982\u4f55\u5c06\u8fd9\u4e9b\u89e3\u51b3\u65b9\u6848\u4e0e Amazon Elastic Container Repository (ECR) \u96c6\u6210\uff0c\u8bf7\u67e5\u770b\uff1a</p> <ul> <li>Anchore, \u5728 Amazon Elastic Container Registry (ECR) \u4e0a\u626b\u63cf\u955c\u50cf</li> <li>PaloAlto, \u5728 Amazon Elastic Container Registry (ECR) \u4e0a\u626b\u63cf\u955c\u50cf</li> <li>TrendMicro, \u5728 Amazon Elastic Container Registry (ECR) \u4e0a\u626b\u63cf\u955c\u50cf</li> </ul>"},{"location":"zh/windows/docs/licensing/","title":"Windows Server \u7248\u672c\u548c\u8bb8\u53ef\u8bc1","text":""},{"location":"zh/windows/docs/licensing/#windows-server_1","title":"Windows Server \u7248\u672c","text":"<p>Amazon EKS \u4f18\u5316\u7684 Windows AMI \u57fa\u4e8e Windows Server 2019 \u548c 2022 Datacenter \u7248\u672c\uff0c\u91c7\u7528\u957f\u671f\u670d\u52a1\u901a\u9053 (LTSC)\u3002Datacenter \u7248\u672c\u5bf9\u8fd0\u884c\u5728\u5de5\u4f5c\u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u6570\u91cf\u6ca1\u6709\u9650\u5236\u3002\u66f4\u591a\u4fe1\u606f\uff1a https://docs.microsoft.com/en-us/virtualization/windowscontainers/about/faq</p>"},{"location":"zh/windows/docs/licensing/#ltsc","title":"\u957f\u671f\u670d\u52a1\u901a\u9053 (LTSC)","text":"<p>\u4ee5\u524d\u79f0\u4e3a\"\u957f\u671f\u670d\u52a1\u5206\u652f\"\uff0c\u8fd9\u662f\u60a8\u5df2\u7ecf\u719f\u6089\u7684\u53d1\u5e03\u6a21\u5f0f\uff0cWindows Server \u7684\u65b0\u4e3b\u8981\u7248\u672c\u6bcf 2-3 \u5e74\u53d1\u5e03\u4e00\u6b21\u3002\u7528\u6237\u6709\u6743\u83b7\u5f97 5 \u5e74\u7684\u4e3b\u6d41\u652f\u6301\u548c 5 \u5e74\u7684\u5ef6\u957f\u652f\u6301\u3002</p>"},{"location":"zh/windows/docs/licensing/#_1","title":"\u8bb8\u53ef\u8bc1","text":"<p>\u542f\u52a8\u5e26\u6709 Windows Server \u57fa\u7840 AMI \u7684 Amazon EC2 \u5b9e\u4f8b\u65f6\uff0cAmazon \u4e3a\u60a8\u627f\u62c5\u8bb8\u53ef\u8d39\u7528\u548c\u8bb8\u53ef\u5408\u89c4\u6027\u3002</p>"},{"location":"zh/windows/docs/logging/","title":"\u65e5\u5fd7\u8bb0\u5f55","text":"<p>\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u5c06\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u76f4\u63a5\u8f93\u51fa\u5230STDOUT\u3002\u5bb9\u5668\u8fd0\u884c\u65f6\u6355\u83b7\u8fd9\u4e9b\u65e5\u5fd7\u5e76\u5bf9\u5176\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c - \u901a\u5e38\u662f\u5199\u5165\u6587\u4ef6\u3002\u8fd9\u4e9b\u6587\u4ef6\u5b58\u50a8\u5728\u4f55\u5904\u53d6\u51b3\u4e8e\u5bb9\u5668\u8fd0\u884c\u65f6\u548c\u914d\u7f6e\u3002</p> <p>Windows pod\u7684\u4e00\u4e2a\u6839\u672c\u533a\u522b\u662f\u5b83\u4eec\u4e0d\u4f1a\u751f\u6210STDOUT\u3002\u60a8\u53ef\u4ee5\u8fd0\u884c LogMonitor \u6765\u4ece\u8fd0\u884c\u4e2d\u7684Windows\u5bb9\u5668\u68c0\u7d22ETW (Windows\u4e8b\u4ef6\u8ddf\u8e2a)\u3001Windows\u4e8b\u4ef6\u65e5\u5fd7\u548c\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u7279\u5b9a\u65e5\u5fd7\uff0c\u5e76\u5c06\u683c\u5f0f\u5316\u7684\u65e5\u5fd7\u8f93\u51fa\u7ba1\u9053\u8f93\u51fa\u5230STDOUT\u3002\u7136\u540e\u53ef\u4ee5\u4f7f\u7528fluent-bit\u6216fluentd\u5c06\u8fd9\u4e9b\u65e5\u5fd7\u6d41\u5f0f\u4f20\u8f93\u5230\u60a8\u671f\u671b\u7684\u76ee\u7684\u5730\uff0c\u5982Amazon CloudWatch\u3002</p> <p>\u65e5\u5fd7\u6536\u96c6\u673a\u5236\u4eceKubernetes pod\u4e2d\u68c0\u7d22STDOUT/STDERR\u65e5\u5fd7\u3002DaemonSet \u662f\u6536\u96c6\u5bb9\u5668\u65e5\u5fd7\u7684\u5e38\u7528\u65b9\u5f0f\u3002\u5b83\u4f7f\u60a8\u80fd\u591f\u72ec\u7acb\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7ba1\u7406\u65e5\u5fd7\u8def\u7531/\u8fc7\u6ee4/\u4e30\u5bcc\u3002\u53ef\u4ee5\u4f7f\u7528fluentd DaemonSet\u5c06\u8fd9\u4e9b\u65e5\u5fd7\u548c\u4efb\u4f55\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u751f\u6210\u7684\u65e5\u5fd7\u6d41\u5f0f\u4f20\u8f93\u5230\u6240\u9700\u7684\u65e5\u5fd7\u805a\u5408\u5668\u3002</p> <p>\u6709\u5173\u4eceWindows\u5de5\u4f5c\u8d1f\u8f7d\u6d41\u5f0f\u4f20\u8f93\u65e5\u5fd7\u5230CloudWatch\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6b64\u5904</p>"},{"location":"zh/windows/docs/logging/#_2","title":"\u65e5\u5fd7\u8bb0\u5f55\u5efa\u8bae","text":"<p>\u5728Kubernetes\u4e2d\u8fd0\u884cWindows\u5de5\u4f5c\u8d1f\u8f7d\u65f6\uff0c\u4e00\u822c\u7684\u65e5\u5fd7\u8bb0\u5f55\u6700\u4f73\u5b9e\u8df5\u5e76\u65e0\u4e0d\u540c\u3002</p> <ul> <li>\u59cb\u7ec8\u8bb0\u5f55\u7ed3\u6784\u5316\u65e5\u5fd7\u6761\u76ee(JSON/SYSLOG),\u8fd9\u4f7f\u5904\u7406\u65e5\u5fd7\u6761\u76ee\u66f4\u52a0\u5bb9\u6613\uff0c\u56e0\u4e3a\u6709\u8bb8\u591a\u9488\u5bf9\u6b64\u7c7b\u7ed3\u6784\u5316\u683c\u5f0f\u7684\u9884\u7f16\u5199\u89e3\u6790\u5668\u3002</li> <li>\u96c6\u4e2d\u65e5\u5fd7 - \u53ef\u4ee5\u4f7f\u7528\u4e13\u7528\u7684\u65e5\u5fd7\u5bb9\u5668\u4e13\u95e8\u6536\u96c6\u548c\u8f6c\u53d1\u6240\u6709\u5bb9\u5668\u7684\u65e5\u5fd7\u6d88\u606f\u5230\u76ee\u7684\u5730</li> <li>\u9664\u975e\u5728\u8c03\u8bd5\u65f6\uff0c\u5426\u5219\u4fdd\u6301\u65e5\u5fd7\u8be6\u7ec6\u7a0b\u5ea6\u8f83\u4f4e\u3002\u8be6\u7ec6\u7a0b\u5ea6\u4f1a\u7ed9\u65e5\u5fd7\u57fa\u7840\u8bbe\u65bd\u5e26\u6765\u5f88\u5927\u538b\u529b\uff0c\u91cd\u8981\u4e8b\u4ef6\u53ef\u80fd\u4f1a\u88ab\u566a\u97f3\u6df9\u6ca1\u3002</li> <li> <p>\u59cb\u7ec8\u8bb0\u5f55\u5e94\u7528\u7a0b\u5e8f\u4fe1\u606f\u4ee5\u53ca\u4e8b\u52a1/\u8bf7\u6c42ID\u4ee5\u4fbf\u8ffd\u6eaf\u3002Kubernetes\u5bf9\u8c61\u4e0d\u643a\u5e26\u5e94\u7528\u7a0b\u5e8f\u540d\u79f0\uff0c\u4f8b\u5982pod\u540d\u79f0<code>windows-twryrqyw</code>\u5728\u8c03\u8bd5\u65e5\u5fd7\u65f6\u53ef\u80fd\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u3002\u8fd9\u6709\u52a9\u4e8e\u5728\u805a\u5408\u65e5\u5fd7\u4e2d\u8ffd\u6eaf\u548c\u6392\u67e5\u5e94\u7528\u7a0b\u5e8f\u95ee\u9898\u3002</p> <p>\u751f\u6210\u8fd9\u4e9b\u4e8b\u52a1/\u5173\u8054ID\u7684\u65b9\u5f0f\u53d6\u51b3\u4e8e\u7f16\u7a0b\u6784\u9020\u3002\u4f46\u4e00\u79cd\u975e\u5e38\u5e38\u89c1\u7684\u6a21\u5f0f\u662f\u4f7f\u7528\u65e5\u5fd7Aspect/Interceptor,\u5b83\u53ef\u4ee5\u4f7f\u7528MDC(\u6620\u5c04\u8bca\u65ad\u4e0a\u4e0b\u6587)\u4e3a\u6bcf\u4e2a\u4f20\u5165\u8bf7\u6c42\u6ce8\u5165\u552f\u4e00\u7684\u4e8b\u52a1/\u5173\u8054ID\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> </li> </ul> <pre><code>import org.slf4j.MDC;\nimport java.util.UUID;\nClass LoggingAspect { //interceptor\n\n    @Before(value = \"execution(* *.*(..))\")\n    func before(...) {\n        transactionId = generateTransactionId();\n        MDC.put(CORRELATION_ID, transactionId);\n    }\n\n    func generateTransactionId() {\n        return UUID.randomUUID().toString();\n    }\n}\n</code></pre>"},{"location":"zh/windows/docs/monitoring/","title":"\u76d1\u63a7","text":"<p>Prometheus \u662f\u4e00\u4e2a CNCF \u6bd5\u4e1a\u9879\u76ee\uff0c\u5b83\u4e0e Kubernetes \u6709\u7740\u539f\u751f\u96c6\u6210\uff0c\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684\u76d1\u63a7\u7cfb\u7edf\u3002Prometheus \u6536\u96c6\u6709\u5173\u5bb9\u5668\u3001Pod\u3001\u8282\u70b9\u548c\u96c6\u7fa4\u7684\u6307\u6807\u3002\u6b64\u5916\uff0cPrometheus \u5229\u7528 AlertsManager\uff0c\u8ba9\u60a8\u53ef\u4ee5\u7f16\u7a0b\u8bbe\u7f6e\u8b66\u62a5\uff0c\u4ee5\u4fbf\u5728\u96c6\u7fa4\u51fa\u73b0\u95ee\u9898\u65f6\u8b66\u544a\u60a8\u3002Prometheus \u5c06\u6307\u6807\u6570\u636e\u5b58\u50a8\u4e3a\u7531\u6307\u6807\u540d\u79f0\u548c\u952e/\u503c\u5bf9\u6807\u8bc6\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002Prometheus \u5305\u542b\u4e00\u79cd\u540d\u4e3a PromQL \u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u5373 Prometheus \u67e5\u8be2\u8bed\u8a00\u3002</p> <p>\u4e0b\u56fe\u663e\u793a\u4e86 Prometheus \u6307\u6807\u6536\u96c6\u7684\u9ad8\u7ea7\u67b6\u6784\uff1a</p> <p></p> <p>Prometheus \u4f7f\u7528\u62c9\u53d6\u673a\u5236\uff0c\u901a\u8fc7\u5bfc\u51fa\u5668\u4ece\u76ee\u6807\u6293\u53d6\u6307\u6807\uff0c\u5e76\u4f7f\u7528 kube state metrics \u4ece Kubernetes API \u6293\u53d6\u6307\u6807\u3002\u8fd9\u610f\u5473\u7740\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u5fc5\u987b\u516c\u5f00\u5305\u542b Prometheus \u683c\u5f0f\u6307\u6807\u7684 HTTP(S) \u7aef\u70b9\u3002\u7136\u540e\uff0cPrometheus \u5c06\u6839\u636e\u5176\u914d\u7f6e\u5b9a\u671f\u4ece\u8fd9\u4e9b HTTP(S) \u7aef\u70b9\u62c9\u53d6\u6307\u6807\u3002</p> <p>\u5bfc\u51fa\u5668\u53ef\u8ba9\u60a8\u5c06\u7b2c\u4e09\u65b9\u6307\u6807\u4f5c\u4e3a Prometheus \u683c\u5f0f\u6307\u6807\u8fdb\u884c\u6d88\u8d39\u3002\u901a\u5e38\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90e8\u7f72\u4e00\u4e2a Prometheus \u5bfc\u51fa\u5668\u3002\u6709\u5173\u5b8c\u6574\u7684\u5bfc\u51fa\u5668\u5217\u8868\uff0c\u8bf7\u53c2\u9605 Prometheus \u5bfc\u51fa\u5668\u3002\u867d\u7136 node exporter \u9002\u5408\u5bfc\u51fa Linux \u8282\u70b9\u7684\u4e3b\u673a\u786c\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u6307\u6807\uff0c\u4f46\u5b83\u4e0d\u9002\u7528\u4e8e Windows \u8282\u70b9\u3002</p> <p>\u5728\u4f7f\u7528\u7a33\u5b9a\u7684 Prometheus Helm \u56fe\u8868\u7684 \u6df7\u5408\u8282\u70b9 EKS \u96c6\u7fa4\u4e2d\u5305\u542b Windows \u8282\u70b9\u65f6\uff0c\u60a8\u5c06\u5728 Windows \u8282\u70b9\u4e0a\u770b\u5230\u5931\u8d25\u7684 Pod\uff0c\u56e0\u4e3a\u6b64\u5bfc\u51fa\u5668\u4e0d\u9002\u7528\u4e8e Windows\u3002\u60a8\u9700\u8981\u5355\u72ec\u5904\u7406 Windows \u5de5\u4f5c\u8282\u70b9\u6c60\uff0c\u800c\u662f\u5728 Windows \u5de5\u4f5c\u8282\u70b9\u7ec4\u4e0a\u5b89\u88c5 Windows \u5bfc\u51fa\u5668\u3002</p> <p>\u4e3a\u4e86\u4e3a Windows \u8282\u70b9\u8bbe\u7f6e Prometheus \u76d1\u63a7\uff0c\u60a8\u9700\u8981\u5728 Windows \u670d\u52a1\u5668\u672c\u8eab\u4e0a\u4e0b\u8f7d\u5e76\u5b89\u88c5 WMI \u5bfc\u51fa\u5668\uff0c\u7136\u540e\u5728 Prometheus \u914d\u7f6e\u6587\u4ef6\u7684\u6293\u53d6\u914d\u7f6e\u4e2d\u8bbe\u7f6e\u76ee\u6807\u3002 \u53d1\u5e03\u9875\u9762\u63d0\u4f9b\u4e86\u6240\u6709\u53ef\u7528\u7684 .msi \u5b89\u88c5\u7a0b\u5e8f\uff0c\u5305\u62ec\u76f8\u5e94\u7684\u529f\u80fd\u96c6\u548c\u9519\u8bef\u4fee\u590d\u3002\u5b89\u88c5\u7a0b\u5e8f\u5c06\u628a windows_exporter \u8bbe\u7f6e\u4e3a Windows \u670d\u52a1\uff0c\u5e76\u5728 Windows \u9632\u706b\u5899\u4e2d\u521b\u5efa\u4e00\u4e2a\u4f8b\u5916\u3002\u5982\u679c\u5728\u4e0d\u5e26\u4efb\u4f55\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\u5b89\u88c5\u7a0b\u5e8f\uff0c\u5bfc\u51fa\u5668\u5c06\u4f7f\u7528\u9ed8\u8ba4\u8bbe\u7f6e\u8fd0\u884c\uff0c\u5305\u62ec\u542f\u7528\u7684\u6536\u96c6\u5668\u3001\u7aef\u53e3\u7b49\u3002</p> <p>\u60a8\u53ef\u4ee5\u67e5\u770b\u672c\u6307\u5357\u7684 \u8c03\u5ea6\u6700\u4f73\u5b9e\u8df5\u90e8\u5206\uff0c\u5176\u4e2d\u5efa\u8bae\u4f7f\u7528\u6c61\u70b9/\u5bb9\u5fcd\u5ea6\u6216 RuntimeClass \u6765\u9009\u62e9\u6027\u5730\u4ec5\u5c06\u8282\u70b9\u5bfc\u51fa\u5668\u90e8\u7f72\u5230 Linux \u8282\u70b9\uff0c\u800c\u5728\u5f15\u5bfc\u8282\u70b9\u65f6\u6216\u4f7f\u7528\u60a8\u9009\u62e9\u7684\u914d\u7f6e\u7ba1\u7406\u5de5\u5177(\u4f8b\u5982 chef\u3001Ansible\u3001SSM \u7b49)\u5728 Windows \u8282\u70b9\u4e0a\u5b89\u88c5 Windows \u5bfc\u51fa\u5668\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u4e0e\u5728 Linux \u8282\u70b9\u4e0a\u4f5c\u4e3a DaemonSet \u5b89\u88c5\u8282\u70b9\u5bfc\u51fa\u5668\u4e0d\u540c\uff0c\u5728 Windows \u8282\u70b9\u4e0a\uff0cWMI \u5bfc\u51fa\u5668\u5b89\u88c5\u5728\u4e3b\u673a\u672c\u8eab\u4e0a\u3002\u5bfc\u51fa\u5668\u5c06\u5bfc\u51fa CPU \u4f7f\u7528\u7387\u3001\u5185\u5b58\u548c\u78c1\u76d8 I/O \u4f7f\u7528\u7387\u7b49\u6307\u6807\uff0c\u8fd8\u53ef\u7528\u4e8e\u76d1\u63a7 IIS \u7ad9\u70b9\u548c\u5e94\u7528\u7a0b\u5e8f\u3001\u7f51\u7edc\u63a5\u53e3\u548c\u670d\u52a1\u3002</p> <p>windows_exporter \u5c06\u9ed8\u8ba4\u516c\u5f00\u542f\u7528\u7684\u6240\u6709\u6536\u96c6\u5668\u7684\u6240\u6709\u6307\u6807\u3002\u8fd9\u662f\u6536\u96c6\u6307\u6807\u7684\u63a8\u8350\u65b9\u5f0f\uff0c\u4ee5\u907f\u514d\u51fa\u9519\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u9ad8\u7ea7\u7528\u9014\uff0cwindows_exporter \u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u53ef\u9009\u7684\u6536\u96c6\u5668\u5217\u8868\u6765\u8fc7\u6ee4\u6307\u6807\u3002Prometheus \u914d\u7f6e\u4e2d\u7684 collect[] \u53c2\u6570\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002</p> <p>Windows \u7684\u9ed8\u8ba4\u5b89\u88c5\u6b65\u9aa4\u5305\u62ec\u5728\u5f15\u5bfc\u8fc7\u7a0b\u4e2d\u4e0b\u8f7d\u5e76\u542f\u52a8\u5bfc\u51fa\u5668\u4f5c\u4e3a\u670d\u52a1\uff0c\u5e76\u5e26\u6709\u53c2\u6570\uff0c\u4f8b\u5982\u60a8\u8981\u8fc7\u6ee4\u7684\u6536\u96c6\u5668\u3002</p> <pre><code>&gt; Powershell Invoke-WebRequest https://github.com/prometheus-community/windows_exporter/releases/download/v0.13.0/windows_exporter-0.13.0-amd64.msi -OutFile &lt;DOWNLOADPATH&gt;\n\n&gt; msiexec /i &lt;DOWNLOADPATH&gt; ENABLED_COLLECTORS=\"cpu,cs,logical_disk,net,os,system,container,memory\"\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u7aef\u53e3 9182 \u4e0a\u7684 /metrics \u7aef\u70b9\u6293\u53d6\u6307\u6807\u3002 \u6b64\u65f6\uff0cPrometheus \u53ef\u4ee5\u901a\u8fc7\u5728 Prometheus \u914d\u7f6e\u4e2d\u6dfb\u52a0\u4ee5\u4e0b scrape_config \u6765\u6d88\u8d39\u6307\u6807</p> <pre><code>scrape_configs:\n    - job_name: \"prometheus\"\n      static_configs:\n        - targets: ['localhost:9090']\n    ...\n    - job_name: \"wmi_exporter\"\n      scrape_interval: 10s\n      static_configs:\n        - targets: ['&lt;windows-node1-ip&gt;:9182', '&lt;windows-node2-ip&gt;:9182', ...]\n</code></pre> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u91cd\u65b0\u52a0\u8f7d Prometheus \u914d\u7f6e</p> <pre><code>&gt; ps aux | grep prometheus\n&gt; kill HUP &lt;PID&gt;\n</code></pre> <p>\u4e00\u79cd\u66f4\u597d\u3001\u66f4\u63a8\u8350\u7684\u6dfb\u52a0\u76ee\u6807\u7684\u65b9\u5f0f\u662f\u4f7f\u7528\u4e00\u79cd\u540d\u4e3a ServiceMonitor \u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\uff0c\u5b83\u662f Prometheus \u64cd\u4f5c\u5668\u7684\u4e00\u90e8\u5206\uff0c\u63d0\u4f9b\u4e86 ServiceMonitor \u5bf9\u8c61\u7684\u5b9a\u4e49\u548c\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u8be5\u63a7\u5236\u5668\u5c06\u6fc0\u6d3b\u6211\u4eec\u5b9a\u4e49\u7684 ServiceMonitor \u5e76\u81ea\u52a8\u6784\u5efa\u6240\u9700\u7684 Prometheus \u914d\u7f6e\u3002</p> <p>ServiceMonitor \u58f0\u660e\u6027\u5730\u6307\u5b9a\u4e86\u5e94\u8be5\u5982\u4f55\u76d1\u63a7 Kubernetes \u670d\u52a1\u7ec4\uff0c\u7528\u4e8e\u5728 Kubernetes \u4e2d\u5b9a\u4e49\u60a8\u5e0c\u671b\u4ece\u4e2d\u6293\u53d6\u6307\u6807\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5728 ServiceMonitor \u4e2d\uff0c\u6211\u4eec\u6307\u5b9a\u4e86\u64cd\u4f5c\u5458\u53ef\u4ee5\u7528\u6765\u8bc6\u522b\u6211\u4eec\u5e0c\u671b\u76d1\u63a7\u7684 Kubernetes \u670d\u52a1(\u8fdb\u800c\u8bc6\u522b Pod)\u7684 Kubernetes \u6807\u7b7e\u3002</p> <p>\u4e3a\u4e86\u5229\u7528 ServiceMonitor\uff0c\u8bf7\u521b\u5efa\u4e00\u4e2a\u6307\u5411\u7279\u5b9a Windows \u76ee\u6807\u7684 Endpoint \u5bf9\u8c61\u3001\u4e00\u4e2a\u65e0\u5934\u670d\u52a1\u548c\u4e00\u4e2a\u7528\u4e8e Windows \u8282\u70b9\u7684 ServiceMontor\u3002</p> <pre><code>apiVersion: v1\nkind: Endpoints\nmetadata:\n  labels:\n    k8s-app: wmiexporter\n  name: wmiexporter\n  namespace: kube-system\nsubsets:\n- addresses:\n  - ip: NODE-ONE-IP\n    targetRef:\n      kind: Node\n      name: NODE-ONE-NAME\n  - ip: NODE-TWO-IP\n    targetRef:\n      kind: Node\n      name: NODE-TWO-NAME\n  - ip: NODE-THREE-IP\n    targetRef:\n      kind: Node\n      name: NODE-THREE-NAME\n  ports:\n  - name: http-metrics\n    port: 9182\n    protocol: TCP\n\n---\napiVersion: v1\nkind: Service ##\u65e0\u5934\u670d\u52a1\nmetadata:\n  labels:\n    k8s-app: wmiexporter\n  name: wmiexporter\n  namespace: kube-system\nspec:\n  clusterIP: None\n  ports:\n  - name: http-metrics\n    port: 9182\n    protocol: TCP\n    targetPort: 9182\n  sessionAffinity: None\n  type: ClusterIP\n\n---\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor ##\u81ea\u5b9a\u4e49 ServiceMonitor \u5bf9\u8c61\nmetadata:\n  labels:\n    k8s-app: wmiexporter\n  name: wmiexporter\n  namespace: monitoring\nspec:\n  endpoints:\n  - interval: 30s\n    port: http-metrics\n  jobLabel: k8s-app\n  namespaceSelector:\n    matchNames:\n    - kube-system\n  selector:\n    matchLabels:\n      k8s-app: wmiexporter\n</code></pre> <p>\u6709\u5173\u64cd\u4f5c\u5458\u548c ServiceMonitor \u7684\u4f7f\u7528\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b\u5b98\u65b9 \u64cd\u4f5c\u5458\u6587\u6863\u3002\u8bf7\u6ce8\u610f\uff0cPrometheus \u652f\u6301\u4f7f\u7528\u8bb8\u591a \u670d\u52a1\u53d1\u73b0\u9009\u9879\u8fdb\u884c\u52a8\u6001\u76ee\u6807\u53d1\u73b0\u3002</p>"},{"location":"zh/windows/docs/networking/","title":"Windows \u7f51\u7edc","text":""},{"location":"zh/windows/docs/networking/#windows_1","title":"Windows \u5bb9\u5668\u7f51\u7edc\u6982\u8ff0","text":"<p>Windows \u5bb9\u5668\u4e0e Linux \u5bb9\u5668\u6709\u6839\u672c\u7684\u4e0d\u540c\u3002Linux \u5bb9\u5668\u4f7f\u7528 Linux \u6784\u9020\uff0c\u5982\u547d\u540d\u7a7a\u95f4\u3001\u8054\u5408\u6587\u4ef6\u7cfb\u7edf\u548c cgroups\u3002\u5728 Windows \u4e0a\uff0c\u8fd9\u4e9b\u6784\u9020\u7531 Host Compute Service (HCS) \u4ece containerd \u62bd\u8c61\u51fa\u6765\u3002HCS \u5145\u5f53\u4f4d\u4e8e Windows \u4e0a\u5bb9\u5668\u5b9e\u73b0\u4e4b\u4e0a\u7684 API \u5c42\u3002Windows \u5bb9\u5668\u8fd8\u5229\u7528\u4e86 Host Network Service (HNS)\uff0c\u5b83\u5b9a\u4e49\u4e86\u8282\u70b9\u4e0a\u7684\u7f51\u7edc\u62d3\u6251\u3002</p> <p></p> <p>\u4ece\u7f51\u7edc\u89d2\u5ea6\u6765\u770b\uff0cHCS \u548c HNS \u4f7f Windows \u5bb9\u5668\u7684\u529f\u80fd\u7c7b\u4f3c\u4e8e\u865a\u62df\u673a\u3002\u4f8b\u5982\uff0c\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6bcf\u4e2a\u5bb9\u5668\u90fd\u6709\u4e00\u4e2a\u8fde\u63a5\u5230 Hyper-V \u865a\u62df\u4ea4\u6362\u673a (vSwitch) \u7684\u865a\u62df\u7f51\u7edc\u9002\u914d\u5668 (vNIC)\u3002</p>"},{"location":"zh/windows/docs/networking/#ip","title":"IP \u5730\u5740\u7ba1\u7406","text":"<p>Amazon EKS \u4e2d\u7684\u8282\u70b9\u4f7f\u7528\u5176\u5f39\u6027\u7f51\u7edc\u63a5\u53e3 (ENI) \u8fde\u63a5\u5230 AWS VPC \u7f51\u7edc\u3002\u76ee\u524d\uff0c\u6bcf\u4e2a Windows \u5de5\u4f5c\u8282\u70b9\u4ec5\u652f\u6301\u4e00\u4e2a ENI\u3002Windows \u8282\u70b9\u7684 IP \u5730\u5740\u7ba1\u7406\u7531\u8fd0\u884c\u5728\u63a7\u5236\u5e73\u9762\u4e0a\u7684 VPC Resource Controller \u6267\u884c\u3002\u6709\u5173 Windows \u8282\u70b9 IP \u5730\u5740\u7ba1\u7406\u5de5\u4f5c\u6d41\u7a0b\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u3002</p> <p>Windows \u5de5\u4f5c\u8282\u70b9\u53ef\u4ee5\u652f\u6301\u7684 Pod \u6570\u91cf\u53d6\u51b3\u4e8e\u8282\u70b9\u7684\u5927\u5c0f\u548c\u53ef\u7528 IPv4 \u5730\u5740\u7684\u6570\u91cf\u3002\u60a8\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8ba1\u7b97\u8282\u70b9\u4e0a\u53ef\u7528\u7684 IPv4 \u5730\u5740\uff1a - \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u4f1a\u4e3a ENI \u5206\u914d\u8f85\u52a9 IPv4 \u5730\u5740\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff1a   <pre><code>\u53ef\u7528\u4e8e Pod \u7684\u603b IPv4 \u5730\u5740\u6570 = \u4e3b\u63a5\u53e3\u652f\u6301\u7684 IPv4 \u5730\u5740\u6570 - 1\n</code></pre>   \u6211\u4eec\u4ece\u603b\u6570\u4e2d\u51cf\u53bb 1\uff0c\u56e0\u4e3a\u4e00\u4e2a IPv4 \u5730\u5740\u5c06\u7528\u4f5c ENI \u7684\u4e3b\u5730\u5740\uff0c\u56e0\u6b64\u65e0\u6cd5\u5206\u914d\u7ed9 Pod\u3002</p> <ul> <li>\u5982\u679c\u96c6\u7fa4\u5df2\u914d\u7f6e\u4e3a\u901a\u8fc7\u542f\u7528 \u524d\u7f00\u59d4\u6d3e\u529f\u80fd \u5b9e\u73b0\u9ad8 Pod \u5bc6\u5ea6\uff0c\u5219-   <pre><code>\u53ef\u7528\u4e8e Pod \u7684\u603b IPv4 \u5730\u5740\u6570 = (\u4e3b\u63a5\u53e3\u652f\u6301\u7684 IPv4 \u5730\u5740\u6570 - 1) * 16\n</code></pre>   \u5728\u8fd9\u91cc\uff0cVPC Resource Controller \u5c06\u5206\u914d <code>/28 \u524d\u7f00</code>\u800c\u4e0d\u662f\u5206\u914d\u8f85\u52a9 IPv4 \u5730\u5740\uff0c\u56e0\u6b64\u53ef\u7528\u7684 IPv4 \u5730\u5740\u603b\u6570\u5c06\u589e\u52a0 16 \u500d\u3002</li> </ul> <p>\u4f7f\u7528\u4e0a\u9762\u7684\u516c\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e m5.large \u5b9e\u4f8b\u8ba1\u7b97 Windows \u5de5\u4f5c\u8282\u70b9\u7684\u6700\u5927 Pod \u6570\u91cf\u5982\u4e0b\uff1a - \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u8f85\u52a9 IP \u6a21\u5f0f\u4e0b\u8fd0\u884c\u65f6-   <pre><code>\u6bcf\u4e2a ENI 10 \u4e2a\u8f85\u52a9 IPv4 \u5730\u5740 - 1 = 9 \u4e2a\u53ef\u7528 IPv4 \u5730\u5740\n</code></pre> - \u4f7f\u7528 <code>prefix delegation</code> \u65f6-   <pre><code>(\u6bcf\u4e2a ENI 10 \u4e2a\u8f85\u52a9 IPv4 \u5730\u5740 - 1) * 16 = 144 \u4e2a\u53ef\u7528 IPv4 \u5730\u5740\n</code></pre></p> <p>\u6709\u5173\u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u53ef\u4ee5\u652f\u6301\u591a\u5c11 IP \u5730\u5740\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u6bcf\u79cd\u5b9e\u4f8b\u7c7b\u578b\u7684\u6bcf\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684 IP \u5730\u5740\u3002</p> <p>\u53e6\u4e00\u4e2a\u5173\u952e\u8003\u8651\u56e0\u7d20\u662f\u7f51\u7edc\u6d41\u91cf\u7684\u6d41\u52a8\u3002\u5bf9\u4e8e Windows\uff0c\u5982\u679c\u8282\u70b9\u4e0a\u6709\u8d85\u8fc7 100 \u4e2a\u670d\u52a1\uff0c\u5c31\u5b58\u5728\u7aef\u53e3\u8017\u5c3d\u7684\u98ce\u9669\u3002\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0c\u8282\u70b9\u5c06\u5f00\u59cb\u629b\u51fa\u4ee5\u4e0b\u9519\u8bef\u6d88\u606f\uff1a</p> <p>\"Policy creation failed: hcnCreateLoadBalancer failed in Win32: The specified port already exists.\"</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5229\u7528\u4e86\u76f4\u63a5\u670d\u52a1\u5668\u8fd4\u56de (Direct Server Return\uff0c DSR)\u3002DSR \u662f\u4e00\u79cd\u975e\u5bf9\u79f0\u7f51\u7edc\u8d1f\u8f7d\u5206\u5e03\u7684\u5b9e\u73b0\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u8bf7\u6c42\u548c\u54cd\u5e94\u6d41\u91cf\u4f7f\u7528\u4e0d\u540c\u7684\u7f51\u7edc\u8def\u5f84\u3002\u8fd9\u4e00\u529f\u80fd\u52a0\u5feb\u4e86 Pod \u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u5e76\u964d\u4f4e\u4e86\u7aef\u53e3\u8017\u5c3d\u7684\u98ce\u9669\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5efa\u8bae\u5728 Windows \u8282\u70b9\u4e0a\u542f\u7528 DSR\u3002</p> <p>DSR \u5728 Windows Server SAC EKS \u4f18\u5316 AMI \u4e2d\u9ed8\u8ba4\u542f\u7528\u3002\u5bf9\u4e8e Windows Server 2019 LTSC EKS \u4f18\u5316 AMI\uff0c\u60a8\u9700\u8981\u5728\u5b9e\u4f8b\u4f9b\u5e94\u671f\u95f4\u4f7f\u7528\u4e0b\u9762\u7684\u811a\u672c\u542f\u7528\u5b83\uff0c\u5e76\u5728 <code>eksctl</code> nodeGroup \u4e2d\u4f7f\u7528 Windows Server 2019 Full \u6216 Core \u4f5c\u4e3a amiFamily\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 eksctl \u81ea\u5b9a\u4e49 AMI\u3002</p> <p><pre><code>nodeGroups:\n- name: windows-ng\n  instanceType: c5.xlarge\n  minSize: 1\n  volumeSize: 50\n  amiFamily: WindowsServer2019CoreContainer\n  ssh:\n    allow: false\n</code></pre> \u4e3a\u4e86\u5728 Windows Server 2019 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u4f7f\u7528 DSR\uff0c\u60a8\u9700\u8981\u5728\u5b9e\u4f8b\u542f\u52a8\u671f\u95f4\u6307\u5b9a\u4ee5\u4e0b kube-proxy \u6807\u5fd7\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u4e0e \u81ea\u7ba1\u7406\u8282\u70b9\u7ec4\u542f\u52a8\u6a21\u677f \u5173\u8054\u7684 userdata \u811a\u672c\u6765\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002</p> <pre><code>&lt;powershell&gt;\n[string]$EKSBinDir = \"$env:ProgramFiles\\Amazon\\EKS\"\n[string]$EKSBootstrapScriptName = 'Start-EKSBootstrap.ps1'\n[string]$EKSBootstrapScriptFile = \"$EKSBinDir\\$EKSBootstrapScriptName\"\n(Get-Content $EKSBootstrapScriptFile).replace('\"--proxy-mode=kernelspace\",', '\"--proxy-mode=kernelspace\", \"--feature-gates WinDSR=true\", \"--enable-dsr\",') | Set-Content $EKSBootstrapScriptFile \n&amp; $EKSBootstrapScriptFile -EKSClusterName \"eks-windows\" -APIServerEndpoint \"https://&lt;REPLACE-EKS-CLUSTER-CONFIG-API-SERVER&gt;\" -Base64ClusterCA \"&lt;REPLACE-EKSCLUSTER-CONFIG-DETAILS-CA&gt;\" -DNSClusterIP \"172.20.0.10\" -KubeletExtraArgs \"--node-labels=alpha.eksctl.io/cluster-name=eks-windows,alpha.eksctl.io/nodegroup-name=windows-ng-ltsc2019 --register-with-taints=\" 3&gt;&amp;1 4&gt;&amp;1 5&gt;&amp;1 6&gt;&amp;1\n&lt;/powershell&gt;\n</code></pre> <p>\u53ef\u4ee5\u6309\u7167 Microsoft \u7f51\u7edc\u535a\u5ba2 \u548c Windows Containers on AWS \u5b9e\u9a8c\u5ba4\u4e2d\u7684\u8bf4\u660e\u9a8c\u8bc1 DSR \u7684\u542f\u7528\u60c5\u51b5\u3002</p> <p></p>"},{"location":"zh/windows/docs/networking/#cni","title":"\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3 (CNI) \u9009\u9879","text":"<p>AWSVPC CNI \u662f Windows \u548c Linux \u5de5\u4f5c\u8282\u70b9\u7684\u4e8b\u5b9e\u4e0a\u7684 CNI \u63d2\u4ef6\u3002\u867d\u7136 AWSVPC CNI \u6ee1\u8db3\u4e86\u8bb8\u591a\u5ba2\u6237\u7684\u9700\u6c42\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u8003\u8651\u4f7f\u7528\u8986\u76d6\u7f51\u7edc\u7b49\u66ff\u4ee3\u65b9\u6848\u6765\u907f\u514d IP \u8017\u5c3d\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528 Calico CNI \u4ee3\u66ff AWSVPC CNI\u3002Project Calico \u662f\u7531 Tigera \u5f00\u53d1\u7684\u5f00\u6e90\u8f6f\u4ef6\u3002\u8be5\u8f6f\u4ef6\u5305\u62ec\u4e00\u4e2a\u4e0e EKS \u517c\u5bb9\u7684 CNI\u3002\u6709\u5173\u5728 EKS \u4e2d\u5b89\u88c5 Calico CNI \u7684\u8bf4\u660e\uff0c\u53ef\u4ee5\u5728 Project Calico EKS \u5b89\u88c5\u9875\u9762\u4e0a\u627e\u5230\u3002</p>"},{"location":"zh/windows/docs/networking/#_1","title":"\u7f51\u7edc\u7b56\u7565","text":"<p>\u5c06 Kubernetes \u96c6\u7fa4\u4e2d Pod \u4e4b\u95f4\u7684\u9ed8\u8ba4\u5f00\u653e\u901a\u4fe1\u6a21\u5f0f\u66f4\u6539\u4e3a\u57fa\u4e8e\u7f51\u7edc\u7b56\u7565\u9650\u5236\u8bbf\u95ee\u88ab\u8ba4\u4e3a\u662f\u6700\u4f73\u5b9e\u8df5\u3002\u5f00\u6e90\u7684 Project Calico \u5bf9\u9002\u7528\u4e8e Linux \u548c Windows \u8282\u70b9\u7684\u7f51\u7edc\u7b56\u7565\u63d0\u4f9b\u4e86\u5f3a\u5927\u652f\u6301\u3002\u6b64\u529f\u80fd\u72ec\u7acb\u4e8e\u4f7f\u7528 Calico CNI\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5efa\u8bae\u5b89\u88c5 Calico \u5e76\u5c06\u5176\u7528\u4e8e\u7f51\u7edc\u7b56\u7565\u7ba1\u7406\u3002</p> <p>\u6709\u5173\u5728 EKS \u4e2d\u5b89\u88c5 Calico \u7684\u8bf4\u660e\uff0c\u53ef\u4ee5\u5728 \u5728 Amazon EKS \u4e0a\u5b89\u88c5 Calico \u9875\u9762\u4e0a\u627e\u5230\u3002</p> <p>\u6b64\u5916\uff0cAmazon EKS \u5b89\u5168\u6700\u4f73\u5b9e\u8df5\u6307\u5357 - \u7f51\u7edc\u90e8\u5206\u4e2d\u63d0\u4f9b\u7684\u5efa\u8bae\u540c\u6837\u9002\u7528\u4e8e\u5177\u6709 Windows \u5de5\u4f5c\u8282\u70b9\u7684 EKS \u96c6\u7fa4\uff0c\u4f46\u76ee\u524d Windows \u4e0d\u652f\u6301\u67d0\u4e9b\u529f\u80fd\uff0c\u5982\"Pod \u7684\u5b89\u5168\u7ec4\"\u3002</p>"},{"location":"zh/windows/docs/oom/","title":"\u907f\u514dOOM\u9519\u8bef","text":"<p>Windows\u6ca1\u6709\u50cfLinux\u90a3\u6837\u7684\u5185\u5b58\u4e0d\u8db3\u8fdb\u7a0b\u7ec8\u6b62\u673a\u5236\u3002Windows\u603b\u662f\u5c06\u6240\u6709\u7528\u6237\u6a21\u5f0f\u5185\u5b58\u5206\u914d\u89c6\u4e3a\u865a\u62df\u7684\uff0c\u5e76\u4e14\u9875\u9762\u6587\u4ef6\u662f\u5f3a\u5236\u6027\u7684\u3002\u5176\u51c0\u6548\u679c\u662f\uff0cWindows\u4e0d\u4f1a\u50cfLinux\u90a3\u6837\u8fbe\u5230\u5185\u5b58\u4e0d\u8db3\u6761\u4ef6\u3002\u8fdb\u7a0b\u5c06\u6362\u9875\u5230\u78c1\u76d8\u800c\u4e0d\u662f\u88ab\u7ec8\u6b62\u5185\u5b58\u4e0d\u8db3(OOM)\u3002\u5982\u679c\u5185\u5b58\u8fc7\u5ea6\u4f9b\u5e94\u5e76\u4e14\u6240\u6709\u7269\u7406\u5185\u5b58\u90fd\u5df2\u8017\u5c3d\uff0c\u90a3\u4e48\u6362\u9875\u53ef\u80fd\u4f1a\u964d\u4f4e\u6027\u80fd\u3002</p>"},{"location":"zh/windows/docs/oom/#kubelet","title":"\u4e3a\u7cfb\u7edf\u548ckubelet\u4fdd\u7559\u5185\u5b58","text":"<p>\u4e0eLinux\u4e0d\u540c\uff0c\u5728Linux\u4e2d<code>--kubelet-reserve</code>\u6355\u83b7kubernetes\u7cfb\u7edf\u5b88\u62a4\u8fdb\u7a0b(\u5982kubelet\u3001\u5bb9\u5668\u8fd0\u884c\u65f6\u7b49)\u7684\u8d44\u6e90\u9884\u7559\uff0c\u800c<code>--system-reserve</code>\u6355\u83b7\u64cd\u4f5c\u7cfb\u7edf\u7cfb\u7edf\u5b88\u62a4\u8fdb\u7a0b(\u5982sshd\u3001udev\u7b49)\u7684\u8d44\u6e90\u9884\u7559\u3002\u5728Windows\u4e0a\uff0c\u8fd9\u4e9b\u6807\u5fd7\u4e0d\u4f1a\u6355\u83b7\u548c\u8bbe\u7f6e\u5bf9kubelet\u6216\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u8fdb\u7a0b\u7684\u5185\u5b58\u9650\u5236\u3002</p> <p>\u4f46\u662f\uff0c\u60a8\u53ef\u4ee5\u7ed3\u5408\u4f7f\u7528\u8fd9\u4e9b\u6807\u5fd7\u6765\u7ba1\u7406NodeAllocatable,\u4ee5\u51cf\u5c11\u8282\u70b9\u4e0a\u7684\u5bb9\u91cf\uff0c\u5e76\u4f7f\u7528Pod\u6e05\u5355\u5185\u5b58\u8d44\u6e90\u9650\u5236\u6765\u63a7\u5236\u6bcf\u4e2aPod\u7684\u5185\u5b58\u5206\u914d\u3002\u4f7f\u7528\u8fd9\u79cd\u7b56\u7565\uff0c\u60a8\u53ef\u4ee5\u66f4\u597d\u5730\u63a7\u5236\u5185\u5b58\u5206\u914d\uff0c\u5e76\u4e14\u6709\u4e00\u79cd\u6700\u5c0f\u5316Windows\u8282\u70b9\u5185\u5b58\u4e0d\u8db3(OOM)\u7684\u673a\u5236\u3002</p> <p>\u5728Windows\u8282\u70b9\u4e0a\uff0c\u6700\u4f73\u5b9e\u8df5\u662f\u81f3\u5c11\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u548c\u8fdb\u7a0b\u4fdd\u75592GB\u5185\u5b58\u3002\u4f7f\u7528<code>--kubelet-reserve</code>\u548c/\u6216<code>--system-reserve</code>\u6765\u51cf\u5c11NodeAllocatable\u3002</p> <p>\u6839\u636eAmazon EKS\u81ea\u7ba1\u7406Windows\u8282\u70b9\u6587\u6863\uff0c\u4f7f\u7528CloudFormation\u6a21\u677f\u542f\u52a8\u4e00\u4e2a\u65b0\u7684Windows\u8282\u70b9\u7ec4\uff0c\u5e76\u5bf9kubelet\u914d\u7f6e\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002CloudFormation\u6709\u4e00\u4e2a\u540d\u4e3a<code>BootstrapArguments</code>\u7684\u5143\u7d20\uff0c\u5b83\u4e0e<code>KubeletExtraArgs</code>\u76f8\u540c\u3002\u4f7f\u7528\u4ee5\u4e0b\u6807\u5fd7\u548c\u503c\uff1a</p> <pre><code>--kube-reserved memory=0.5Gi,ephemeral-storage=1Gi --system-reserved memory=1.5Gi,ephemeral-storage=1Gi --eviction-hard memory.available&lt;200Mi,nodefs.available&lt;10%\"\n</code></pre> <p>\u5982\u679c\u4f7f\u7528eksctl\u8fdb\u884c\u90e8\u7f72\uff0c\u8bf7\u67e5\u770b\u4ee5\u4e0b\u6587\u6863\u4ee5\u81ea\u5b9a\u4e49kubelet\u914d\u7f6ehttps://eksctl.io/usage/customizing-the-kubelet/</p>"},{"location":"zh/windows/docs/oom/#windows","title":"Windows\u5bb9\u5668\u5185\u5b58\u9700\u6c42","text":"<p>\u6839\u636eMicrosoft\u6587\u6863,NANO\u7248\u672c\u7684Windows Server\u57fa\u7840\u955c\u50cf\u81f3\u5c11\u9700\u898130MB\uff0c\u800cServer Core\u9700\u898145MB\u3002\u968f\u7740\u6dfb\u52a0Windows\u7ec4\u4ef6(\u5982.NET Framework\u3001Web\u670d\u52a1IIS\u548c\u5e94\u7528\u7a0b\u5e8f)\uff0c\u8fd9\u4e9b\u6570\u5b57\u4f1a\u589e\u52a0\u3002</p> <p>\u4e86\u89e3\u60a8\u7684Windows\u5bb9\u5668\u955c\u50cf\u6240\u9700\u7684\u6700\u5c0f\u5185\u5b58\u91cf(\u5373\u57fa\u7840\u955c\u50cf\u52a0\u4e0a\u5176\u5e94\u7528\u7a0b\u5e8f\u5c42)\u975e\u5e38\u91cd\u8981\uff0c\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3aPod\u89c4\u8303\u4e2d\u5bb9\u5668\u7684\u8d44\u6e90/\u8bf7\u6c42\u3002\u60a8\u8fd8\u5e94\u8be5\u8bbe\u7f6e\u4e00\u4e2a\u9650\u5236\uff0c\u4ee5\u9632\u6b62Pod\u5728\u5e94\u7528\u7a0b\u5e8f\u95ee\u9898\u7684\u60c5\u51b5\u4e0b\u6d88\u8017\u6240\u6709\u53ef\u7528\u7684\u8282\u70b9\u5185\u5b58\u3002</p> <p>\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5f53Kubernetes\u8c03\u5ea6\u7a0b\u5e8f\u5c1d\u8bd5\u5c06Pod\u653e\u7f6e\u5728\u8282\u70b9\u4e0a\u65f6\uff0cPod\u7684\u8bf7\u6c42\u7528\u4e8e\u786e\u5b9a\u54ea\u4e2a\u8282\u70b9\u6709\u8db3\u591f\u7684\u53ef\u7528\u8d44\u6e90\u8fdb\u884c\u8c03\u5ea6\u3002</p> <pre><code> spec:\n  - name: iis\n    image: mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2019\n    resources:\n      limits:\n        cpu: 1\n        memory: 800Mi\n      requests:\n        cpu: .1\n        memory: 128Mi\n</code></pre>"},{"location":"zh/windows/docs/oom/#_1","title":"\u7ed3\u8bba","text":"<p>\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u6700\u5c0f\u5316\u5185\u5b58\u8017\u5c3d\u7684\u98ce\u9669\uff0c\u4f46\u4e0d\u80fd\u5b8c\u5168\u9632\u6b62\u5185\u5b58\u8017\u5c3d\u3002\u4f7f\u7528Amazon CloudWatch Metrics\uff0c\u60a8\u53ef\u4ee5\u8bbe\u7f6e\u8b66\u62a5\u548c\u8865\u6551\u63aa\u65bd\uff0c\u4ee5\u9632\u53d1\u751f\u5185\u5b58\u8017\u5c3d\u3002</p>"},{"location":"zh/windows/docs/patching/","title":"\u4e3a Windows \u670d\u52a1\u5668\u548c\u5bb9\u5668\u6253\u8865\u4e01","text":"<p>\u4e3a Windows \u670d\u52a1\u5668\u6253\u8865\u4e01\u662f Windows \u7ba1\u7406\u5458\u7684\u6807\u51c6\u7ba1\u7406\u4efb\u52a1\u3002\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u5de5\u5177\u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\uff0c\u5982 Amazon System Manager - Patch Manager\u3001WSUS\u3001System Center Configuration Manager \u7b49\u3002\u4f46\u662f\uff0cAmazon EKS \u96c6\u7fa4\u4e2d\u7684 Windows \u8282\u70b9\u4e0d\u5e94\u88ab\u89c6\u4e3a\u666e\u901a\u7684 Windows \u670d\u52a1\u5668\u3002\u5b83\u4eec\u5e94\u88ab\u89c6\u4e3a\u4e0d\u53ef\u53d8\u7684\u670d\u52a1\u5668\u3002\u7b80\u800c\u8a00\u4e4b\uff0c\u907f\u514d\u66f4\u65b0\u73b0\u6709\u8282\u70b9\uff0c\u53ea\u9700\u57fa\u4e8e\u65b0\u7684\u66f4\u65b0\u540e\u7684 AMI \u542f\u52a8\u65b0\u8282\u70b9\u5373\u53ef\u3002</p> <p>\u4f7f\u7528 EC2 Image Builder \u60a8\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u914d\u65b9\u548c\u6dfb\u52a0\u7ec4\u4ef6\u6765\u81ea\u52a8\u6784\u5efa AMI\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u4e86 \u7ec4\u4ef6,\u8fd9\u4e9b\u7ec4\u4ef6\u53ef\u4ee5\u662f AWS \u9884\u5148\u6784\u5efa\u7684 (Amazon \u7ba1\u7406\u7684)\uff0c\u4e5f\u53ef\u4ee5\u662f\u60a8\u81ea\u5df1\u521b\u5efa\u7684 (\u6211\u62e5\u6709\u7684)\u3002\u8bf7\u7279\u522b\u6ce8\u610f\u540d\u4e3a update-windows \u7684 Amazon \u7ba1\u7406\u7ec4\u4ef6\uff0c\u5b83\u4f1a\u5728\u901a\u8fc7 EC2 Image Builder \u7ba1\u9053\u751f\u6210 AMI \u4e4b\u524d\u66f4\u65b0 Windows Server\u3002</p> <p></p> <p>EC2 Image Builder \u5141\u8bb8\u60a8\u57fa\u4e8e Amazon \u7ba1\u7406\u7684\u516c\u5171 AMI \u6784\u5efa AMI\uff0c\u5e76\u6839\u636e\u60a8\u7684\u4e1a\u52a1\u9700\u6c42\u5bf9\u5176\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5c06\u8fd9\u4e9b AMI \u4e0e\u542f\u52a8\u6a21\u677f\u5173\u8054\uff0c\u4ece\u800c\u5141\u8bb8\u60a8\u5c06\u65b0\u7684 AMI \u94fe\u63a5\u5230\u7531 EKS \u8282\u70b9\u7ec4\u521b\u5efa\u7684\u81ea\u52a8\u4f38\u7f29\u7ec4\u3002\u5b8c\u6210\u540e\uff0c\u60a8\u53ef\u4ee5\u5f00\u59cb\u7ec8\u6b62\u73b0\u6709\u7684 Windows \u8282\u70b9\uff0c\u65b0\u8282\u70b9\u5c06\u57fa\u4e8e\u65b0\u7684\u66f4\u65b0\u540e\u7684 AMI \u542f\u52a8\u3002</p>"},{"location":"zh/windows/docs/patching/#windows_1","title":"\u63a8\u9001\u548c\u62c9\u53d6 Windows \u955c\u50cf","text":"<p>Amazon \u53d1\u5e03\u4e86\u5305\u542b\u4e24\u4e2a\u7f13\u5b58\u7684 Windows \u5bb9\u5668\u955c\u50cf\u7684 EKS \u4f18\u5316 AMI\u3002</p> <pre><code>mcr.microsoft.com/windows/servercore\nmcr.microsoft.com/windows/nanoserver\n</code></pre> <p></p> <p>\u7f13\u5b58\u7684\u955c\u50cf\u4f1a\u968f\u7740\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u66f4\u65b0\u800c\u66f4\u65b0\u3002\u5f53 Microsoft \u53d1\u5e03\u76f4\u63a5\u5f71\u54cd Windows \u5bb9\u5668\u57fa\u7840\u955c\u50cf\u7684\u65b0 Windows \u66f4\u65b0\u65f6\uff0c\u8be5\u66f4\u65b0\u5c06\u4f5c\u4e3a\u666e\u901a Windows \u66f4\u65b0\u5728\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u542f\u52a8\u3002\u4fdd\u6301\u73af\u5883\u7684\u6700\u65b0\u72b6\u6001\u53ef\u4ee5\u5728\u8282\u70b9\u548c\u5bb9\u5668\u7ea7\u522b\u63d0\u4f9b\u66f4\u5b89\u5168\u7684\u73af\u5883\u3002</p> <p>Windows \u5bb9\u5668\u955c\u50cf\u7684\u5927\u5c0f\u4f1a\u5f71\u54cd\u63a8\u9001/\u62c9\u53d6\u64cd\u4f5c\uff0c\u4ece\u800c\u5bfc\u81f4\u5bb9\u5668\u542f\u52a8\u65f6\u95f4\u53d8\u6162\u3002\u7f13\u5b58 Windows \u5bb9\u5668\u955c\u50cf \u5141\u8bb8\u5728 AMI \u6784\u5efa\u521b\u5efa\u65f6\u800c\u4e0d\u662f\u5bb9\u5668\u542f\u52a8\u65f6\u8fdb\u884c\u6602\u8d35\u7684 I/O \u64cd\u4f5c (\u6587\u4ef6\u63d0\u53d6)\u3002\u56e0\u6b64\uff0c\u6240\u6709\u5fc5\u9700\u7684\u955c\u50cf\u5c42\u90fd\u5c06\u5728 AMI \u4e0a\u63d0\u53d6\uff0c\u5e76\u51c6\u5907\u5c31\u7eea\u4ee5\u4f9b\u4f7f\u7528\uff0c\u4ece\u800c\u52a0\u5feb Windows \u5bb9\u5668\u542f\u52a8\u5e76\u5f00\u59cb\u63a5\u53d7\u6d41\u91cf\u7684\u65f6\u95f4\u3002\u5728\u63a8\u9001\u64cd\u4f5c\u671f\u95f4\uff0c\u53ea\u6709\u6784\u6210\u60a8\u955c\u50cf\u7684\u5c42\u4f1a\u88ab\u4e0a\u4f20\u5230\u5b58\u50a8\u5e93\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\uff0c\u5728 Amazon ECR \u4e0a\uff0cfluentd-windows-sac2004 \u955c\u50cf\u4ec5\u6709 390.18MB\u3002\u8fd9\u662f\u5728\u63a8\u9001\u64cd\u4f5c\u671f\u95f4\u4e0a\u4f20\u7684\u6570\u91cf\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u5c06 fluentd Windows ltsc \u955c\u50cf\u63a8\u9001\u5230 Amazon ECR \u5b58\u50a8\u5e93\u3002\u5b58\u50a8\u5728 ECR \u4e2d\u7684\u5c42\u7684\u5927\u5c0f\u4e3a 533.05MB\u3002</p> <p></p> <p>\u4ece <code>docker image ls</code> \u7684\u8f93\u51fa\u53ef\u4ee5\u770b\u5230\uff0cfluentd v1.14-windows-ltsc2019-1 \u5728\u78c1\u76d8\u4e0a\u7684\u5927\u5c0f\u4e3a 6.96GB,\u4f46\u8fd9\u5e76\u4e0d\u610f\u5473\u7740\u5b83\u4e0b\u8f7d\u548c\u63d0\u53d6\u4e86\u90a3\u4e48\u591a\u6570\u636e\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5728\u62c9\u53d6\u64cd\u4f5c\u671f\u95f4\uff0c\u53ea\u4f1a\u4e0b\u8f7d\u548c\u63d0\u53d6 \u538b\u7f29\u7684 533.05MB\u3002</p> <pre><code>REPOSITORY                                                              TAG                        IMAGE ID       CREATED         SIZE\n111122223333.dkr.ecr.us-east-1.amazonaws.com/fluentd-windows-coreltsc   latest                     721afca2c725   7 weeks ago     6.96GB\nfluent/fluentd                                                          v1.14-windows-ltsc2019-1   721afca2c725   7 weeks ago     6.96GB\namazonaws.com/eks/pause-windows                                         latest                     6392f69ae6e7   10 months ago   255MB\n</code></pre> <p>size \u5217\u663e\u793a\u4e86\u955c\u50cf\u7684\u603b\u5927\u5c0f\u4e3a 6.96GB\u3002\u5206\u89e3\u5982\u4e0b\uff1a</p> <ul> <li>Windows Server Core 2019 LTSC \u57fa\u7840\u955c\u50cf = 5.74GB</li> <li>Fluentd \u672a\u538b\u7f29\u57fa\u7840\u955c\u50cf = 6.96GB</li> <li>\u78c1\u76d8\u4e0a\u7684\u5dee\u5f02 = 1.2GB</li> <li>Fluentd \u538b\u7f29\u540e\u7684\u6700\u7ec8\u955c\u50cf ECR = 533.05MB</li> </ul> <p>\u57fa\u7840\u955c\u50cf\u5df2\u7ecf\u5b58\u5728\u4e8e\u672c\u5730\u78c1\u76d8\u4e0a\uff0c\u56e0\u6b64\u78c1\u76d8\u4e0a\u7684\u603b\u91cf\u589e\u52a0\u4e86 1.2GB\u3002\u4e0b\u6b21\u770b\u5230 size \u5217\u4e2d\u7684 GB \u6570\u91cf\u65f6\uff0c\u4e0d\u8981\u592a\u62c5\u5fc3\uff0c\u53ef\u80fd\u5df2\u7ecf\u6709 70% \u4ee5\u4e0a\u662f\u4f5c\u4e3a\u7f13\u5b58\u7684\u5bb9\u5668\u955c\u50cf\u5b58\u5728\u4e8e\u78c1\u76d8\u4e0a\u3002</p>"},{"location":"zh/windows/docs/patching/#_1","title":"\u53c2\u8003","text":"<p>\u4f7f\u7528 EC2 Image Builder \u548c\u955c\u50cf\u7f13\u5b58\u7b56\u7565\u52a0\u5feb Windows \u5bb9\u5668\u542f\u52a8\u65f6\u95f4</p>"},{"location":"zh/windows/docs/scheduling/","title":"\u8c03\u5ea6","text":"<p>\uff03 \u8fd0\u884c\u5f02\u6784\u5de5\u4f5c\u8d1f\u8f7d\u00b6</p> <p>Kubernetes \u652f\u6301\u5f02\u6784\u96c6\u7fa4\uff0c\u5728\u540c\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528 Linux \u548c Windows \u8282\u70b9\u3002\u5728\u8be5\u96c6\u7fa4\u4e2d\uff0c\u60a8\u53ef\u4ee5\u6df7\u5408\u8fd0\u884c\u5728 Linux \u4e0a\u7684 Pod \u548c\u5728 Windows \u4e0a\u7684 Pod\u3002\u60a8\u751a\u81f3\u53ef\u4ee5\u5728\u540c\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u8fd0\u884c\u591a\u4e2a\u7248\u672c\u7684 Windows\u3002\u4f46\u662f\uff0c\u5728\u505a\u51fa\u8fd9\u4e2a\u51b3\u5b9a\u65f6\uff0c\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u56e0\u7d20(\u5982\u4e0b\u6240\u8ff0)\u3002</p> <p>\uff03 \u5c06 POD \u5206\u914d\u7ed9\u8282\u70b9\u7684\u6700\u4f73\u5b9e\u8df5</p> <p>\u4e3a\u4e86\u5c06 Linux \u548c Windows \u5de5\u4f5c\u8d1f\u8f7d\u4fdd\u7559\u5728\u5404\u81ea\u7279\u5b9a\u64cd\u4f5c\u7cfb\u7edf\u7684\u8282\u70b9\u4e0a\uff0c\u60a8\u9700\u8981\u4f7f\u7528\u8282\u70b9\u9009\u62e9\u5668\u548c\u6c61\u70b9/\u5bb9\u5fcd\u5ea6\u7684\u7ec4\u5408\u3002\u5728\u5f02\u6784\u73af\u5883\u4e2d\u8c03\u5ea6\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4e3b\u8981\u76ee\u6807\u662f\u907f\u514d\u7834\u574f\u73b0\u6709 Linux \u5de5\u4f5c\u8d1f\u8f7d\u7684\u517c\u5bb9\u6027\u3002</p>"},{"location":"zh/windows/docs/scheduling/#_1","title":"\u786e\u4fdd\u7279\u5b9a\u64cd\u4f5c\u7cfb\u7edf\u7684\u5de5\u4f5c\u8d1f\u8f7d\u843d\u5728\u9002\u5f53\u7684\u5bb9\u5668\u4e3b\u673a\u4e0a","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 nodeSelectors \u786e\u4fdd Windows \u5bb9\u5668\u53ef\u4ee5\u5728\u9002\u5f53\u7684\u4e3b\u673a\u4e0a\u8c03\u5ea6\u3002\u5f53\u4eca\u6240\u6709 Kubernetes \u8282\u70b9\u90fd\u5177\u6709\u4ee5\u4e0b\u9ed8\u8ba4\u6807\u7b7e\uff1a</p> <pre><code>kubernetes.io/os = [windows|linux]\nkubernetes.io/arch = [amd64|arm64|...]\n</code></pre> <p>\u5982\u679c Pod \u89c4\u8303\u4e0d\u5305\u542b\u8bf8\u5982 <code>\"kubernetes.io/os\": windows</code> \u4e4b\u7c7b\u7684 nodeSelector\uff0c\u5219\u8be5 Pod \u53ef\u80fd\u4f1a\u88ab\u8c03\u5ea6\u5230\u4efb\u4f55\u4e3b\u673a\uff0c\u65e0\u8bba\u662f Windows \u8fd8\u662f Linux\u3002\u8fd9\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\uff0c\u56e0\u4e3a Windows \u5bb9\u5668\u53ea\u80fd\u5728 Windows \u4e0a\u8fd0\u884c\uff0c\u800c Linux \u5bb9\u5668\u53ea\u80fd\u5728 Linux \u4e0a\u8fd0\u884c\u3002</p> <p>\u5728\u4f01\u4e1a\u73af\u5883\u4e2d\uff0c\u62e5\u6709\u5927\u91cf\u9884\u5148\u5b58\u5728\u7684 Linux \u5bb9\u5668\u90e8\u7f72\u4ee5\u53ca\u73b0\u6210\u7684\u914d\u7f6e(\u5982 Helm \u56fe\u8868)\u7684\u751f\u6001\u7cfb\u7edf\u662f\u5f88\u5e38\u89c1\u7684\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u4e0d\u613f\u610f\u66f4\u6539\u90e8\u7f72\u7684 nodeSelectors\u3002\u66ff\u4ee3\u65b9\u6848\u662f\u4f7f\u7528\u6c61\u70b9\u3002</p> <p>\u4f8b\u5982\uff1a <code>--register-with-taints='os=windows:NoSchedule'</code></p> <p>\u5982\u679c\u60a8\u4f7f\u7528 EKS\uff0ceksctl \u63d0\u4f9b\u4e86\u901a\u8fc7 clusterConfig \u5e94\u7528\u6c61\u70b9\u7684\u65b9\u5f0f\uff1a</p> <pre><code>NodeGroups:\n  - name: windows-ng\n    amiFamily: WindowsServer2022FullContainer\n    ...\n    labels:\n      nodeclass: windows2022\n    taints:\n      os: \"windows:NoSchedule\"\n</code></pre> <p>\u4e3a\u6240\u6709 Windows \u8282\u70b9\u6dfb\u52a0\u6c61\u70b9\u540e\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u5c06\u4e0d\u4f1a\u5728\u8fd9\u4e9b\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod\uff0c\u9664\u975e\u5b83\u4eec\u5bb9\u5fcd\u8be5\u6c61\u70b9\u3002Pod \u6e05\u5355\u793a\u4f8b\uff1a</p> <pre><code>nodeSelector:\n    kubernetes.io/os: windows\ntolerations:\n    - key: \"os\"\n      operator: \"Equal\"\n      value: \"windows\"\n      effect: \"NoSchedule\"\n</code></pre>"},{"location":"zh/windows/docs/scheduling/#windows","title":"\u5728\u540c\u4e00\u96c6\u7fa4\u4e2d\u5904\u7406\u591a\u4e2a Windows \u7248\u672c","text":"<p>\u6bcf\u4e2a Pod \u4f7f\u7528\u7684 Windows \u5bb9\u5668\u57fa\u7840\u6620\u50cf\u5fc5\u987b\u4e0e\u8282\u70b9\u4f7f\u7528\u7684\u76f8\u540c\u5185\u6838\u7248\u672c\u5339\u914d\u3002\u5982\u679c\u60a8\u60f3\u5728\u540c\u4e00\u96c6\u7fa4\u4e2d\u4f7f\u7528\u591a\u4e2a Windows Server \u7248\u672c\uff0c\u90a3\u4e48\u60a8\u5e94\u8be5\u8bbe\u7f6e\u989d\u5916\u7684\u8282\u70b9\u6807\u7b7e\u3001nodeSelectors \u6216\u5229\u7528\u540d\u4e3a windows-build \u7684\u6807\u7b7e\u3002</p> <p>Kubernetes 1.17 \u81ea\u52a8\u4e3a Windows \u8282\u70b9\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u6807\u7b7e node.kubernetes.io/windows-build,\u4ee5\u7b80\u5316\u540c\u4e00\u96c6\u7fa4\u4e2d\u591a\u4e2a Windows \u7248\u672c\u7684\u7ba1\u7406\u3002\u5982\u679c\u60a8\u8fd0\u884c\u7684\u662f\u65e7\u7248\u672c\uff0c\u5219\u5efa\u8bae\u624b\u52a8\u4e3a Windows \u8282\u70b9\u6dfb\u52a0\u6b64\u6807\u7b7e\u3002</p> <p>\u8be5\u6807\u7b7e\u53cd\u6620\u4e86\u9700\u8981\u5339\u914d\u4ee5\u5b9e\u73b0\u517c\u5bb9\u6027\u7684 Windows \u4e3b\u7248\u672c\u53f7\u3001\u6b21\u7248\u672c\u53f7\u548c\u5185\u90e8\u7248\u672c\u53f7\u3002\u4e0b\u9762\u662f\u5f53\u524d\u6bcf\u4e2a Windows Server \u7248\u672c\u4f7f\u7528\u7684\u503c\u3002</p> <p>\u91cd\u8981\u7684\u662f\u8981\u6ce8\u610f\uff0cWindows Server \u6b63\u5728\u5c06 Long-Term Servicing Channel (LTSC) \u4f5c\u4e3a\u4e3b\u8981\u53d1\u5e03\u6e20\u9053\u3002Windows Server Semi-Annual Channel (SAC) \u5df2\u4e8e 2022 \u5e74 8 \u6708 9 \u65e5\u505c\u6b62\u4f7f\u7528\u3002\u5c06\u4e0d\u4f1a\u6709\u672a\u6765\u7684 Windows Server SAC \u7248\u672c\u3002</p> \u4ea7\u54c1\u540d\u79f0 \u5185\u90e8\u7248\u672c\u53f7 Server full 2022 LTSC 10.0.20348 Server core 2019 LTSC 10.0.17763 <p>\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\u5185\u90e8\u7248\u672c\u53f7\uff1a</p> <pre><code>kubectl get nodes -o wide\n</code></pre> <p>KERNEL-VERSION \u8f93\u51fa\u4e0e Windows \u64cd\u4f5c\u7cfb\u7edf\u5185\u90e8\u7248\u672c\u53f7\u5339\u914d\u3002</p> <pre><code>NAME                          STATUS   ROLES    AGE   VERSION                INTERNAL-IP   EXTERNAL-IP     OS-IMAGE                         KERNEL-VERSION                  CONTAINER-RUNTIME\nip-10-10-2-235.ec2.internal   Ready    &lt;none&gt;   23m   v1.24.7-eks-fb459a0    10.10.2.235   3.236.30.157    Windows Server 2022 Datacenter   10.0.20348.1607                 containerd://1.6.6\nip-10-10-31-27.ec2.internal   Ready    &lt;none&gt;   23m   v1.24.7-eks-fb459a0    10.10.31.27   44.204.218.24   Windows Server 2019 Datacenter   10.0.17763.4131                 containerd://1.6.6\nip-10-10-7-54.ec2.internal    Ready    &lt;none&gt;   31m   v1.24.11-eks-a59e1f0   10.10.7.54    3.227.8.172     Amazon Linux 2                   5.10.173-154.642.amzn2.x86_64   containerd://1.6.19\n</code></pre> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u5728 Pod \u6e05\u5355\u4e2d\u5e94\u7528\u4e86\u989d\u5916\u7684 nodeSelector\uff0c\u4ee5\u4fbf\u5728\u8fd0\u884c\u4e0d\u540c Windows \u8282\u70b9\u7ec4\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u65f6\u5339\u914d\u6b63\u786e\u7684 Windows \u5185\u90e8\u7248\u672c\u53f7\u3002</p> <pre><code>nodeSelector:\n    kubernetes.io/os: windows\n    node.kubernetes.io/windows-build: '10.0.20348'\ntolerations:\n    - key: \"os\"\n    operator: \"Equal\"\n    value: \"windows\"\n    effect: \"NoSchedule\"\n</code></pre>"},{"location":"zh/windows/docs/scheduling/#runtimeclass-pod-nodeselector-toleration","title":"\u4f7f\u7528 RuntimeClass \u7b80\u5316 Pod \u6e05\u5355\u4e2d\u7684 NodeSelector \u548c Toleration","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u5229\u7528 RuntimeClass \u6765\u7b80\u5316\u4f7f\u7528\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6\u7684\u8fc7\u7a0b\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a RuntimeClass \u5bf9\u8c61\u6765\u5b9e\u73b0\uff0c\u8be5\u5bf9\u8c61\u7528\u4e8e\u5c01\u88c5\u8fd9\u4e9b\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6\u3002</p> <p>\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u6e05\u5355\u521b\u5efa RuntimeClass\uff1a</p> <pre><code>apiVersion: node.k8s.io/v1beta1\nkind: RuntimeClass\nmetadata:\n  name: windows-2022\nhandler: 'docker'\nscheduling:\n  nodeSelector:\n    kubernetes.io/os: 'windows'\n    kubernetes.io/arch: 'amd64'\n    node.kubernetes.io/windows-build: '10.0.20348'\n  tolerations:\n  - effect: NoSchedule\n    key: os\n    operator: Equal\n    value: \"windows\"\n</code></pre> <p>\u521b\u5efa Runtimeclass \u540e\uff0c\u4f7f\u7528 Pod \u6e05\u5355\u4e2d\u7684 Spec \u5206\u914d\u5b83\uff1a</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: iis-2022\n  labels:\n    app: iis-2022\nspec:\n  replicas: 1\n  template:\n    metadata:\n      name: iis-2022\n      labels:\n        app: iis-2022\n    spec:\n      runtimeClassName: windows-2022\n      containers:\n      - name: iis\n</code></pre>"},{"location":"zh/windows/docs/scheduling/#_2","title":"\u6258\u7ba1\u8282\u70b9\u7ec4\u652f\u6301","text":"<p>\u4e3a\u4e86\u5e2e\u52a9\u5ba2\u6237\u4ee5\u66f4\u52a0\u6d41\u7545\u7684\u65b9\u5f0f\u8fd0\u884c\u5176 Windows \u5e94\u7528\u7a0b\u5e8f\uff0cAWS \u4e8e 2022 \u5e74 12 \u6708 15 \u65e5\u63a8\u51fa\u4e86\u5bf9 Amazon EKS \u6258\u7ba1\u8282\u70b9\u7ec4 (MNG) \u652f\u6301 Windows \u5bb9\u5668\u7684\u652f\u6301\u3002\u4e3a\u4e86\u5e2e\u52a9\u7edf\u4e00\u8fd0\u7ef4\u56e2\u961f\uff0cWindows MNG \u4f7f\u7528\u4e0e Linux MNG \u76f8\u540c\u7684\u5de5\u4f5c\u6d41\u7a0b\u548c\u5de5\u5177\u542f\u7528\u3002\u652f\u6301 Windows Server 2019 \u548c 2022 \u7684\u5b8c\u6574\u548c\u6838\u5fc3 AMI (Amazon Machine Image) \u7248\u672c\u3002</p> <p>\u6258\u7ba1\u8282\u70b9\u7ec4 (MNG) \u652f\u6301\u4ee5\u4e0b AMI \u7cfb\u5217\u3002</p> AMI \u7cfb\u5217 WINDOWS_CORE_2019_x86_64 WINDOWS_FULL_2019_x86_64 WINDOWS_CORE_2022_x86_64 WINDOWS_FULL_2022_x86_64"},{"location":"zh/windows/docs/scheduling/#_3","title":"\u5176\u4ed6\u6587\u6863","text":"<p>AWS \u5b98\u65b9\u6587\u6863\uff1a https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html</p> <p>\u8981\u66f4\u597d\u5730\u4e86\u89e3 Pod \u7f51\u7edc (CNI) \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u8bf7\u67e5\u770b\u4ee5\u4e0b\u94fe\u63a5\uff1a https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html</p> <p>AWS \u535a\u5ba2\u5173\u4e8e\u5728 EKS \u4e0a\u90e8\u7f72 Windows \u6258\u7ba1\u8282\u70b9\u7ec4\uff1a https://aws.amazon.com/blogs/containers/deploying-amazon-eks-windows-managed-node-groups/</p>"},{"location":"zh/windows/docs/security/","title":"Pod \u5b89\u5168\u4e0a\u4e0b\u6587","text":"<p>Pod \u5b89\u5168\u7b56\u7565 (PSP) \u548c Pod \u5b89\u5168\u6807\u51c6 (PSS) \u662f\u5728 Kubernetes \u4e2d\u5b9e\u65bd\u5b89\u5168\u6027\u7684\u4e24\u79cd\u4e3b\u8981\u65b9\u5f0f\u3002\u8bf7\u6ce8\u610f\uff0c\u4ece Kubernetes v1.21 \u5f00\u59cb\uff0cPodSecurityPolicy \u5df2\u88ab\u5f03\u7528\uff0c\u5c06\u5728 v1.25 \u4e2d\u88ab\u79fb\u9664\uff0c\u800c Pod \u5b89\u5168\u6807\u51c6 (PSS) \u662f Kubernetes \u63a8\u8350\u7684\u5b9e\u65bd\u5b89\u5168\u6027\u7684\u65b9\u6cd5\u3002</p> <p>Pod \u5b89\u5168\u7b56\u7565 (PSP) \u662f Kubernetes \u4e2d\u5b9e\u73b0\u5b89\u5168\u7b56\u7565\u7684\u539f\u751f\u89e3\u51b3\u65b9\u6848\u3002PSP \u662f\u4e00\u79cd\u96c6\u7fa4\u7ea7\u522b\u7684\u8d44\u6e90\uff0c\u7528\u4e8e\u63a7\u5236 Pod \u89c4\u8303\u4e2d\u4e0e\u5b89\u5168\u76f8\u5173\u7684\u65b9\u9762\u3002\u4f7f\u7528 Pod \u5b89\u5168\u7b56\u7565\uff0c\u60a8\u53ef\u4ee5\u5b9a\u4e49\u4e00\u7ec4 Pod \u5fc5\u987b\u6ee1\u8db3\u7684\u6761\u4ef6\uff0c\u624d\u80fd\u88ab\u96c6\u7fa4\u63a5\u53d7\u3002 PSP \u529f\u80fd\u81ea Kubernetes \u65e9\u671f\u5c31\u5df2\u5b58\u5728\uff0c\u65e8\u5728\u963b\u6b62\u9519\u8bef\u914d\u7f6e\u7684 Pod \u5728\u7ed9\u5b9a\u96c6\u7fa4\u4e0a\u521b\u5efa\u3002</p> <p>\u6709\u5173 Pod \u5b89\u5168\u7b56\u7565\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003 Kubernetes \u6587\u6863\u3002\u6839\u636e Kubernetes \u5f03\u7528\u653f\u7b56,\u5728\u529f\u80fd\u88ab\u5f03\u7528\u540e\u4e5d\u4e2a\u6708\uff0c\u65e7\u7248\u672c\u5c06\u505c\u6b62\u83b7\u5f97\u652f\u6301\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0cPod \u5b89\u5168\u6807\u51c6 (PSS) \u662f\u63a8\u8350\u7684\u5b89\u5168\u65b9\u6cd5\uff0c\u901a\u5e38\u901a\u8fc7\u5b89\u5168\u4e0a\u4e0b\u6587\u5728 Pod \u6e05\u5355\u4e2d\u7684 Pod \u548c\u5bb9\u5668\u89c4\u8303\u4e2d\u5b9a\u4e49\u3002PSS \u662f Kubernetes \u9879\u76ee\u56e2\u961f\u4e3a Pod \u5b9a\u4e49\u7684\u89e3\u51b3\u5b89\u5168\u76f8\u5173\u6700\u4f73\u5b9e\u8df5\u7684\u5b98\u65b9\u6807\u51c6\u3002\u5b83\u5b9a\u4e49\u4e86\u8bf8\u5982\u57fa\u7ebf(\u6700\u5c0f\u9650\u5236\u6027\uff0c\u9ed8\u8ba4)\u3001\u7279\u6743(\u65e0\u9650\u5236)\u548c\u53d7\u9650(\u6700\u4e25\u683c)\u7b49\u7b56\u7565\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u4ece\u57fa\u7ebf\u914d\u7f6e\u6587\u4ef6\u5f00\u59cb\u3002PSS \u57fa\u7ebf\u914d\u7f6e\u6587\u4ef6\u5728\u5b89\u5168\u6027\u548c\u6f5c\u5728\u6469\u64e6\u4e4b\u95f4\u63d0\u4f9b\u4e86\u826f\u597d\u7684\u5e73\u8861\uff0c\u53ea\u9700\u8981\u6700\u5c11\u7684\u4f8b\u5916\u5217\u8868\uff0c\u56e0\u6b64\u5b83\u662f\u5de5\u4f5c\u8d1f\u8f7d\u5b89\u5168\u7684\u826f\u597d\u8d77\u70b9\u3002\u5982\u679c\u60a8\u5f53\u524d\u6b63\u5728\u4f7f\u7528 PSP\uff0c\u6211\u4eec\u5efa\u8bae\u5207\u6362\u5230 PSS\u3002\u6709\u5173 PSS \u7b56\u7565\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u53ef\u4ee5\u5728 Kubernetes \u6587\u6863\u4e2d\u627e\u5230\u3002\u8fd9\u4e9b\u7b56\u7565\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u5de5\u5177(\u5305\u62ec\u6765\u81ea OPA \u548c Kyverno \u7684\u5de5\u5177)\u6765\u5b9e\u65bd\u3002\u4f8b\u5982\uff0cKyverno \u5728\u8fd9\u91cc\u63d0\u4f9b\u4e86\u5b8c\u6574\u7684 PSS \u7b56\u7565\u96c6\u5408\u3002</p> <p>\u5b89\u5168\u4e0a\u4e0b\u6587\u8bbe\u7f6e\u5141\u8bb8\u60a8\u4e3a\u9009\u5b9a\u8fdb\u7a0b\u6388\u4e88\u7279\u6743\u3001\u4f7f\u7528\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\u9650\u5236\u5355\u4e2a\u7a0b\u5e8f\u7684\u529f\u80fd\u3001\u5141\u8bb8\u7279\u6743\u5347\u7ea7\u3001\u8fc7\u6ee4\u7cfb\u7edf\u8c03\u7528\u7b49\u3002</p> <p>\u5728\u5b89\u5168\u4e0a\u4e0b\u6587\u65b9\u9762\uff0cKubernetes \u4e2d\u7684 Windows Pod \u4e0e\u57fa\u4e8e Linux \u7684\u6807\u51c6\u5de5\u4f5c\u8d1f\u8f7d\u76f8\u6bd4\u5b58\u5728\u4e00\u4e9b\u9650\u5236\u548c\u533a\u522b\u3002</p> <p>Windows \u4f7f\u7528\u6bcf\u4e2a\u5bb9\u5668\u4e00\u4e2a\u4f5c\u4e1a\u5bf9\u8c61\u548c\u7cfb\u7edf\u547d\u540d\u7a7a\u95f4\u8fc7\u6ee4\u5668\u6765\u5305\u542b\u5bb9\u5668\u4e2d\u7684\u6240\u6709\u8fdb\u7a0b\uff0c\u5e76\u4e0e\u4e3b\u673a\u903b\u8f91\u9694\u79bb\u3002\u65e0\u6cd5\u5728\u6ca1\u6709\u547d\u540d\u7a7a\u95f4\u8fc7\u6ee4\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c Windows \u5bb9\u5668\u3002\u8fd9\u610f\u5473\u7740\u65e0\u6cd5\u5728\u4e3b\u673a\u4e0a\u4e0b\u6587\u4e2d\u65ad\u8a00\u7cfb\u7edf\u7279\u6743\uff0c\u56e0\u6b64 Windows \u4e0a\u4e0d\u63d0\u4f9b\u7279\u6743\u5bb9\u5668\u3002</p> <p>\u4ee5\u4e0b <code>windowsOptions</code> \u662f\u552f\u4e00\u8bb0\u5f55\u7684 Windows \u5b89\u5168\u4e0a\u4e0b\u6587\u9009\u9879,\u800c\u5176\u4f59\u9009\u9879\u662f\u4e00\u822c\u7684 \u5b89\u5168\u4e0a\u4e0b\u6587\u9009\u9879</p> <p>\u6709\u5173\u5728 Windows \u4e0e Linux \u4e2d\u652f\u6301\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u5c5e\u6027\u5217\u8868\uff0c\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863\u6b64\u5904\u3002</p> <p>Pod \u7279\u5b9a\u8bbe\u7f6e\u9002\u7528\u4e8e\u6240\u6709\u5bb9\u5668\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5c06\u4f7f\u7528 PodSecurityContext \u4e2d\u7684\u9009\u9879\u3002\u5982\u679c\u5728 SecurityContext \u548c PodSecurityContext \u4e2d\u90fd\u8bbe\u7f6e\u4e86\uff0c\u5219 SecurityContext \u4e2d\u6307\u5b9a\u7684\u503c\u4f18\u5148\u3002</p> <p>\u4f8b\u5982\uff0cPod \u548c\u5bb9\u5668\u7684 runAsUserName \u8bbe\u7f6e\u662f Linux \u7279\u5b9a runAsUser \u8bbe\u7f6e\u7684\u7c97\u7565\u7b49\u4ef7\u7269\uff0c\u5728\u4ee5\u4e0b\u6e05\u5355\u4e2d\uff0cPod \u7ea7\u522b\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u4e8e\u6240\u6709\u5bb9\u5668</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: run-as-username-pod-demo\nspec:\n  securityContext:\n    windowsOptions:\n      runAsUserName: \"ContainerUser\"\n  containers:\n  - name: run-as-username-demo\n    ...\n  nodeSelector:\n    kubernetes.io/os: windows\n</code></pre> <p>\u800c\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c\u5bb9\u5668\u7ea7\u522b\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u4f1a\u8986\u76d6 Pod \u7ea7\u522b\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: run-as-username-container-demo\nspec:\n  securityContext:\n    windowsOptions:\n      runAsUserName: \"ContainerUser\"\n  containers:\n  - name: run-as-username-demo\n    ..\n    securityContext:\n        windowsOptions:\n            runAsUserName: \"ContainerAdministrator\"\n  nodeSelector:\n    kubernetes.io/os: windows\n</code></pre> <p>runAsUserName \u5b57\u6bb5\u7684\u53ef\u63a5\u53d7\u503c\u793a\u4f8b\uff1aContainerAdministrator\u3001ContainerUser\u3001NT AUTHORITY\\NETWORK SERVICE\u3001NT AUTHORITY\\LOCAL SERVICE</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4ee5 ContainerUser \u8eab\u4efd\u8fd0\u884c Windows Pod \u4e2d\u7684\u5bb9\u5668\u662f\u4e2a\u597d\u4e3b\u610f\u3002\u5bb9\u5668\u548c\u4e3b\u673a\u4e4b\u95f4\u4e0d\u5171\u4eab\u7528\u6237\uff0c\u4f46 ContainerAdministrator \u5728\u5bb9\u5668\u5185\u786e\u5b9e\u62e5\u6709\u989d\u5916\u7684\u7279\u6743\u3002\u8bf7\u6ce8\u610f\uff0c\u9700\u8981\u6ce8\u610f \u9650\u5236\u3002</p> <p>\u4f7f\u7528 ContainerAdministrator \u7684\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\u662f\u8bbe\u7f6e PATH\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 USER \u6307\u4ee4\u6267\u884c\u6b64\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>USER ContainerAdministrator\nRUN setx /M PATH \"%PATH%;C:/your/path\"\nUSER ContainerUser\n</code></pre> <p>\u53e6\u8bf7\u6ce8\u610f\uff0c\u79d8\u5bc6\u4ee5\u660e\u6587\u5f62\u5f0f\u5199\u5165\u8282\u70b9\u7684\u5377(\u4e0e Linux \u4e0a\u7684 tmpfs/\u5185\u5b58\u4e2d\u4e0d\u540c)\u3002\u8fd9\u610f\u5473\u7740\u60a8\u5fc5\u987b\u6267\u884c\u4ee5\u4e0b\u4e24\u9879\u64cd\u4f5c\uff1a</p> <ul> <li>\u4f7f\u7528\u6587\u4ef6 ACL \u6765\u4fdd\u62a4\u79d8\u5bc6\u6587\u4ef6\u4f4d\u7f6e</li> <li>\u4f7f\u7528 BitLocker \u8fdb\u884c\u5377\u7ea7\u52a0\u5bc6</li> </ul>"},{"location":"zh/windows/docs/storage/","title":"\u6301\u4e45\u5b58\u50a8\u9009\u9879","text":""},{"location":"zh/windows/docs/storage/#_2","title":"\u4ec0\u4e48\u662f\u5185\u7f6e\u4e0e\u5916\u7f6e\u5377\u63d2\u4ef6\uff1f","text":"<p>\u5728\u5f15\u5165\u5bb9\u5668\u5b58\u50a8\u63a5\u53e3(CSI)\u4e4b\u524d\uff0c\u6240\u6709\u5377\u63d2\u4ef6\u90fd\u662f\u5185\u7f6e\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u662f\u4e0eKubernetes\u6838\u5fc3\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e00\u8d77\u6784\u5efa\u3001\u94fe\u63a5\u3001\u7f16\u8bd1\u548c\u53d1\u5e03\u7684\uff0c\u5e76\u6269\u5c55\u4e86Kubernetes\u6838\u5fc3API\u3002\u8fd9\u610f\u5473\u7740\u5411Kubernetes\u6dfb\u52a0\u65b0\u7684\u5b58\u50a8\u7cfb\u7edf(\u5377\u63d2\u4ef6)\u9700\u8981\u5c06\u4ee3\u7801\u5408\u5e76\u5230Kubernetes\u6838\u5fc3\u4ee3\u7801\u5e93\u4e2d\u3002</p> <p>\u5916\u7f6e\u5377\u63d2\u4ef6\u72ec\u7acb\u4e8eKubernetes\u4ee3\u7801\u5e93\u5f00\u53d1\uff0c\u5e76\u4f5c\u4e3a\u6269\u5c55\u90e8\u7f72(\u5b89\u88c5)\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u8fd9\u4f7f\u4f9b\u5e94\u5546\u80fd\u591f\u72ec\u7acb\u4e8eKubernetes\u53d1\u5e03\u5468\u671f\u5355\u72ec\u66f4\u65b0\u9a71\u52a8\u7a0b\u5e8f\u3002\u8fd9\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u662f\u56e0\u4e3aKubernetes\u521b\u5efa\u4e86\u4e00\u4e2a\u5b58\u50a8\u63a5\u53e3\u6216CSI\uff0c\u4e3a\u4f9b\u5e94\u5546\u63d0\u4f9b\u4e86\u4e00\u79cd\u4e0ek8s\u63a5\u53e3\u7684\u6807\u51c6\u65b9\u5f0f\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728https://docs.aws.amazon.com/eks/latest/userguide/storage.html\u4e0a\u67e5\u770b\u6709\u5173Amazon Elastic Kubernetes Services (EKS)\u5b58\u50a8\u7c7b\u548cCSI\u9a71\u52a8\u7a0b\u5e8f\u7684\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"zh/windows/docs/storage/#windows","title":"Windows\u7684\u5185\u7f6e\u5377\u63d2\u4ef6","text":"<p>Kubernetes\u5377\u4f7f\u9700\u8981\u6570\u636e\u6301\u4e45\u6027\u7684\u5e94\u7528\u7a0b\u5e8f\u80fd\u591f\u90e8\u7f72\u5728Kubernetes\u4e0a\u3002\u6301\u4e45\u5377\u7684\u7ba1\u7406\u5305\u62ec\u5377\u7684\u914d\u7f6e/\u53d6\u6d88\u914d\u7f6e/\u8c03\u6574\u5927\u5c0f\u3001\u5c06\u5377\u9644\u52a0/\u5206\u79bb\u5230/\u4eceKubernetes\u8282\u70b9\uff0c\u4ee5\u53ca\u5c06\u5377\u6302\u8f7d/\u5378\u8f7d\u5230/\u4ecepod\u4e2d\u7684\u5355\u4e2a\u5bb9\u5668\u3002\u5b9e\u73b0\u7279\u5b9a\u5b58\u50a8\u540e\u7aef\u6216\u534f\u8bae\u7684\u8fd9\u4e9b\u5377\u7ba1\u7406\u64cd\u4f5c\u7684\u4ee3\u7801\u4ee5Kubernetes\u5377\u63d2\u4ef6\u7684\u5f62\u5f0f\u53d1\u5e03(\u5185\u7f6e\u5377\u63d2\u4ef6)\u3002\u5728Amazon Elastic Kubernetes Services (EKS)\u4e0a\uff0c\u652f\u6301\u4ee5\u4e0b\u7c7b\u522b\u7684Kubernetes\u5377\u63d2\u4ef6\u5728Windows\u4e0a\u8fd0\u884c\uff1a</p> <p>\u5185\u7f6e\u5377\u63d2\u4ef6\uff1a awsElasticBlockStore</p> <p>\u4e3a\u4e86\u5728Windows\u8282\u70b9\u4e0a\u4f7f\u7528\u5185\u7f6e\u5377\u63d2\u4ef6\uff0c\u6709\u5fc5\u8981\u521b\u5efa\u4e00\u4e2a\u989d\u5916\u7684StorageClass\u6765\u4f7f\u7528NTFS\u4f5c\u4e3afsType\u3002\u5728EKS\u4e0a\uff0c\u9ed8\u8ba4\u7684StorageClass\u4f7f\u7528ext4\u4f5c\u4e3a\u9ed8\u8ba4\u7684fsType\u3002</p> <p>StorageClass\u4e3a\u7ba1\u7406\u5458\u63d0\u4f9b\u4e86\u4e00\u79cd\u63cf\u8ff0\u4ed6\u4eec\u63d0\u4f9b\u7684\"\u5b58\u50a8\u7c7b\"\u7684\u65b9\u5f0f\u3002\u4e0d\u540c\u7684\u7c7b\u53ef\u80fd\u6620\u5c04\u5230\u670d\u52a1\u8d28\u91cf\u7ea7\u522b\u3001\u5907\u4efd\u7b56\u7565\u6216\u7531\u96c6\u7fa4\u7ba1\u7406\u5458\u786e\u5b9a\u7684\u4efb\u610f\u7b56\u7565\u3002Kubernetes\u5bf9\u7c7b\u4ee3\u8868\u4ec0\u4e48\u6ca1\u6709\u4efb\u4f55\u610f\u89c1\u3002\u8fd9\u4e2a\u6982\u5ff5\u5728\u5176\u4ed6\u5b58\u50a8\u7cfb\u7edf\u4e2d\u6709\u65f6\u88ab\u79f0\u4e3a\"\u914d\u7f6e\u6587\u4ef6\"\u3002</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u68c0\u67e5\u5b83\uff1a</p> <pre><code>kubectl describe storageclass gp2\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>Name:            gp2\nIsDefaultClass:  Yes\nAnnotations:     kubectl.kubernetes.io/last-applied-configuration={\"apiVersion\":\"storage.k8s.io/v1\",\"kind\":\"StorageClas\n\",\"metadata\":{\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"},\"name\":\"gp2\"},\"parameters\":{\"fsType\"\n\"ext4\",\"type\":\"gp2\"},\"provisioner\":\"kubernetes.io/aws-ebs\",\"volumeBindingMode\":\"WaitForFirstConsumer\"}\n,storageclass.kubernetes.io/is-default-class=true\nProvisioner:           kubernetes.io/aws-ebs\nParameters:            fsType=ext4,type=gp2\nAllowVolumeExpansion:  &lt;unset&gt;\nMountOptions:          &lt;none&gt;\nReclaimPolicy:         Delete\nVolumeBindingMode:     WaitForFirstConsumer\nEvents:                &lt;none&gt;\n</code></pre> <p>\u8981\u521b\u5efa\u652f\u6301NTFS\u7684\u65b0StorageClass\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u6e05\u5355\uff1a</p> <pre><code>kind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: gp2-windows\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp2\n  fsType: ntfs\nvolumeBindingMode: WaitForFirstConsumer\n</code></pre> <p>\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efaStorageClass\uff1a</p> <pre><code>kubectl apply -f NTFSStorageClass.yaml\n</code></pre> <p>\u4e0b\u4e00\u6b65\u662f\u521b\u5efa\u6301\u4e45\u5377\u58f0\u660e(PVC)\u3002</p> <p>\u6301\u4e45\u5377(PV)\u662f\u7531\u7ba1\u7406\u5458\u9884\u5148\u914d\u7f6e\u6216\u4f7f\u7528PVC\u52a8\u6001\u914d\u7f6e\u7684\u96c6\u7fa4\u4e2d\u7684\u4e00\u5757\u5b58\u50a8\u3002\u5b83\u662f\u96c6\u7fa4\u4e2d\u7684\u4e00\u79cd\u8d44\u6e90\uff0c\u5c31\u50cf\u8282\u70b9\u662f\u96c6\u7fa4\u8d44\u6e90\u4e00\u6837\u3002\u6b64API\u5bf9\u8c61\u6355\u83b7\u4e86\u5b58\u50a8\u5b9e\u73b0\u7684\u7ec6\u8282\uff0c\u65e0\u8bba\u662fNFS\u3001iSCSI\u8fd8\u662f\u7279\u5b9a\u4e8e\u4e91\u63d0\u4f9b\u5546\u7684\u5b58\u50a8\u7cfb\u7edf\u3002</p> <p>\u6301\u4e45\u5377\u58f0\u660e(PVC)\u662f\u7528\u6237\u5bf9\u5b58\u50a8\u7684\u8bf7\u6c42\u3002\u58f0\u660e\u53ef\u4ee5\u8bf7\u6c42\u7279\u5b9a\u5927\u5c0f\u548c\u8bbf\u95ee\u6a21\u5f0f(\u4f8b\u5982\uff0c\u5b83\u4eec\u53ef\u4ee5\u4ee5ReadWriteOnce\u3001ReadOnlyMany\u6216ReadWriteMany\u6a21\u5f0f\u6302\u8f7d)\u3002</p> <p>\u7528\u6237\u9700\u8981\u5177\u6709\u4e0d\u540c\u5c5e\u6027(\u5982\u6027\u80fd)\u7684\u6301\u4e45\u5377\u6765\u6ee1\u8db3\u4e0d\u540c\u7684\u7528\u4f8b\u9700\u6c42\u3002\u96c6\u7fa4\u7ba1\u7406\u5458\u9700\u8981\u80fd\u591f\u63d0\u4f9b\u5404\u79cd\u4e0d\u540c\u4e8e\u4ec5\u5927\u5c0f\u548c\u8bbf\u95ee\u6a21\u5f0f\u7684\u6301\u4e45\u5377\uff0c\u800c\u65e0\u9700\u5411\u7528\u6237\u516c\u5f00\u8fd9\u4e9b\u5377\u7684\u5b9e\u73b0\u7ec6\u8282\u3002\u4e3a\u4e86\u6ee1\u8db3\u8fd9\u4e9b\u9700\u6c42\uff0c\u5c31\u6709\u4e86StorageClass\u8d44\u6e90\u3002</p> <p>\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0cPVC\u662f\u5728windows\u547d\u540d\u7a7a\u95f4\u4e2d\u521b\u5efa\u7684\u3002</p> <pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: ebs-windows-pv-claim\n  namespace: windows\nspec: \n  accessModes:\n    - ReadWriteOnce\n  storageClassName: gp2-windows\n  resources: \n    requests:\n      storage: 1Gi\n</code></pre> <p>\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efaPVC\uff1a</p> <pre><code>kubectl apply -f persistent-volume-claim.yaml\n</code></pre> <p>\u4ee5\u4e0b\u6e05\u5355\u521b\u5efa\u4e86\u4e00\u4e2aWindows Pod\uff0c\u5c06\u5377\u6302\u8f7d\u8bbe\u7f6e\u4e3a<code>C:\\Data</code>,\u5e76\u4f7f\u7528PVC\u4f5c\u4e3a\u9644\u52a0\u5230<code>C:\\Data</code>\u7684\u5b58\u50a8\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: windows-server-ltsc2019\n  namespace: windows\nspec:\n  selector:\n    matchLabels:\n      app: windows-server-ltsc2019\n      tier: backend\n      track: stable\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: windows-server-ltsc2019\n        tier: backend\n        track: stable\n    spec:\n      containers:\n      - name: windows-server-ltsc2019\n        image: mcr.microsoft.com/windows/servercore:ltsc2019\n        ports:\n        - name: http\n          containerPort: 80\n        imagePullPolicy: IfNotPresent\n        volumeMounts:\n        - mountPath: \"C:\\\\data\"\n          name: test-volume\n      volumes:\n        - name: test-volume\n          persistentVolumeClaim:\n            claimName: ebs-windows-pv-claim\n      nodeSelector:\n        kubernetes.io/os: windows\n        node.kubernetes.io/windows-build: '10.0.17763'\n</code></pre> <p>\u901a\u8fc7PowerShell\u8bbf\u95eeWindows pod\u6765\u6d4b\u8bd5\u7ed3\u679c\uff1a</p> <pre><code>kubectl exec -it podname powershell -n windows\n</code></pre> <p>\u5728Windows Pod\u5185\uff0c\u8fd0\u884c\uff1a <code>ls</code></p> <p>\u8f93\u51fa\uff1a</p> <pre><code>PS C:\\&gt; ls\n\n\n    Directory: C:\\\n\n\nMode                 LastWriteTime         Length Name\n----                 -------------         ------ ----\nd-----          3/8/2021   1:54 PM                data\nd-----          3/8/2021   3:37 PM                inetpub\nd-r---          1/9/2021   7:26 AM                Program Files\nd-----          1/9/2021   7:18 AM                Program Files (x86)\nd-r---          1/9/2021   7:28 AM                Users\nd-----          3/8/2021   3:36 PM                var\nd-----          3/8/2021   3:36 PM                Windows\n-a----         12/7/2019   4:20 AM           5510 License.txt\n</code></pre> <p>data\u76ee\u5f55\u7531EBS\u5377\u63d0\u4f9b\u3002</p>"},{"location":"zh/windows/docs/storage/#windows_1","title":"Windows\u7684\u5916\u7f6e\u63d2\u4ef6","text":"<p>\u4e0eCSI\u63d2\u4ef6\u76f8\u5173\u7684\u4ee3\u7801\u4f5c\u4e3a\u5916\u7f6e\u811a\u672c\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u53d1\u5e03\uff0c\u901a\u5e38\u4ee5\u5bb9\u5668\u955c\u50cf\u7684\u5f62\u5f0f\u5206\u53d1\uff0c\u5e76\u4f7f\u7528\u6807\u51c6\u7684Kubernetes\u6784\u9020(\u5982DaemonSet\u548cStatefulSet)\u8fdb\u884c\u90e8\u7f72\u3002CSI\u63d2\u4ef6\u5904\u7406Kubernetes\u4e2d\u7684\u5404\u79cd\u5377\u7ba1\u7406\u64cd\u4f5c\u3002CSI\u63d2\u4ef6\u901a\u5e38\u7531\u8282\u70b9\u63d2\u4ef6(\u4f5c\u4e3aDaemonSet\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c)\u548c\u63a7\u5236\u5668\u63d2\u4ef6\u7ec4\u6210\u3002</p> <p>CSI\u8282\u70b9\u63d2\u4ef6(\u5c24\u5176\u662f\u90a3\u4e9b\u4e0e\u4f5c\u4e3a\u5757\u8bbe\u5907\u6216\u901a\u8fc7\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u66b4\u9732\u7684\u6301\u4e45\u5377\u76f8\u5173\u7684\u63d2\u4ef6)\u9700\u8981\u6267\u884c\u5404\u79cd\u7279\u6743\u64cd\u4f5c\uff0c\u5982\u626b\u63cf\u78c1\u76d8\u8bbe\u5907\u3001\u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf\u7b49\u3002\u8fd9\u4e9b\u64cd\u4f5c\u56e0\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u800c\u5f02\u3002\u5bf9\u4e8eLinux\u5de5\u4f5c\u8282\u70b9\uff0c\u5bb9\u5668\u5316\u7684CSI\u8282\u70b9\u63d2\u4ef6\u901a\u5e38\u4f5c\u4e3a\u7279\u6743\u5bb9\u5668\u90e8\u7f72\u3002\u5bf9\u4e8eWindows\u5de5\u4f5c\u8282\u70b9\uff0c\u5bb9\u5668\u5316CSI\u8282\u70b9\u63d2\u4ef6\u7684\u7279\u6743\u64cd\u4f5c\u4f7f\u7528csi-proxy\u652f\u6301\uff0c\u8fd9\u662f\u4e00\u4e2a\u7531\u793e\u533a\u7ba1\u7406\u7684\u72ec\u7acb\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u9700\u8981\u9884\u5148\u5b89\u88c5\u5728\u6bcf\u4e2aWindows\u8282\u70b9\u4e0a\u3002</p> <p>Amazon EKS\u4f18\u5316\u7684Windows AMI\u4ece2022\u5e744\u6708\u5f00\u59cb\u5305\u542bCSI\u4ee3\u7406\u3002\u5ba2\u6237\u53ef\u4ee5\u5728Windows\u8282\u70b9\u4e0a\u4f7f\u7528SMB CSI\u9a71\u52a8\u7a0b\u5e8f\u6765\u8bbf\u95eeAmazon FSx for Windows File Server\u3001Amazon FSx for NetApp ONTAP SMB\u5171\u4eab\u548c/\u6216AWS Storage Gateway - File Gateway\u3002</p> <p>\u4ee5\u4e0b\u535a\u5ba2\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u5982\u4f55\u8bbe\u7f6eSMB CSI\u9a71\u52a8\u7a0b\u5e8f\u4ee5\u4f7f\u7528Amazon FSx for Windows File Server\u4f5c\u4e3aWindows Pod\u7684\u6301\u4e45\u5b58\u50a8\u3002</p>"},{"location":"zh/windows/docs/storage/#amazon-fsx-for-windows-file-server","title":"Amazon FSx for Windows File Server","text":"<p>\u4e00\u79cd\u9009\u62e9\u662f\u901a\u8fc7SMB\u7684\u4e00\u4e2a\u540d\u4e3aSMB\u5168\u5c40\u6620\u5c04\u7684\u529f\u80fd\u4f7f\u7528Amazon FSx for Windows File Server\uff0c\u8be5\u529f\u80fd\u4f7f\u5f97\u53ef\u4ee5\u5728\u4e3b\u673a\u4e0a\u6302\u8f7dSMB\u5171\u4eab\uff0c\u7136\u540e\u5c06\u8be5\u5171\u4eab\u4e0a\u7684\u76ee\u5f55\u4f20\u9012\u5230\u5bb9\u5668\u4e2d\u3002\u5bb9\u5668\u4e0d\u9700\u8981\u914d\u7f6e\u7279\u5b9a\u7684\u670d\u52a1\u5668\u3001\u5171\u4eab\u3001\u7528\u6237\u540d\u6216\u5bc6\u7801 - \u8fd9\u4e00\u5207\u90fd\u5728\u4e3b\u673a\u4e0a\u5904\u7406\u3002\u5bb9\u5668\u7684\u5de5\u4f5c\u65b9\u5f0f\u5c31\u50cf\u5b83\u6709\u672c\u5730\u5b58\u50a8\u4e00\u6837\u3002</p> <p>SMB\u5168\u5c40\u6620\u5c04\u5bf9\u7f16\u6392\u5668\u662f\u900f\u660e\u7684\uff0c\u5e76\u4e14\u901a\u8fc7HostPath\u6302\u8f7d\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5e26\u6765\u5b89\u5168\u9690\u60a3\u3002</p> <p>\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u8def\u5f84<code>G:\\Directory\\app-state</code>\u662fWindows\u8282\u70b9\u4e0a\u7684SMB\u5171\u4eab\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-fsx\nspec:\n  containers:\n  - name: test-fsx\n    image: mcr.microsoft.com/windows/servercore:ltsc2019\n    command:\n      - powershell.exe\n      - -command\n      - \"Add-WindowsFeature Web-Server; Invoke-WebRequest -UseBasicParsing -Uri 'https://dotnetbinaries.blob.core.windows.net/servicemonitor/2.0.1.6/ServiceMonitor.exe' -OutFile 'C:\\\\ServiceMonitor.exe'; echo '&lt;html&gt;&lt;body&gt;&lt;br/&gt;&lt;br/&gt;&lt;marquee&gt;&lt;H1&gt;Hello EKS!!!&lt;H1&gt;&lt;marquee&gt;&lt;/body&gt;&lt;html&gt;' &gt; C:\\\\inetpub\\\\wwwroot\\\\default.html; C:\\\\ServiceMonitor.exe 'w3svc'; \"\n    volumeMounts:\n      - mountPath: C:\\dotnetapp\\app-state\n        name: test-mount\n  volumes:\n    - name: test-mount\n      hostPath: \n        path: G:\\Directory\\app-state\n        type: Directory\n  nodeSelector:\n      beta.kubernetes.io/os: windows\n      beta.kubernetes.io/arch: amd64\n</code></pre> <p>\u4ee5\u4e0b\u535a\u5ba2\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u5982\u4f55\u8bbe\u7f6eAmazon FSx for Windows File Server\u4f5c\u4e3aWindows Pod\u7684\u6301\u4e45\u5b58\u50a8\u3002</p>"}]}